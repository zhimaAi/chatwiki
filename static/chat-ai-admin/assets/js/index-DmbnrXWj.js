var s2=Object.defineProperty;var l2=(n,e,t)=>e in n?s2(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var xo=(n,e,t)=>l2(n,typeof e!="symbol"?e+"":e,t);import{t as u2,u as d2,v as c2,w as f2,x as h2,y as p2,z as v2,A as Pp,B as E1,C as gy,D as g2,E as Ko}from"./index-DGyn5jM5.js";import{u as $r}from"./robot-DHvU2P3E.js";import{b as _t,d as Fr,F as Pv,ac as C1,ak as os,al as m2,a9 as k1,am as y2,h as _2,ah as b2,ai as x2}from"../../index-OnalErht.js";import{e as Gt,ab as Yl,f as ke,o as Yt,Y as ae,_ as G,ae as qe,a5 as S,k as B,a2 as U,G as Be,a7 as Ae,F as rt,a9 as gt,ad as dn,a1 as Ve,aa as w2,n as To,am as S2,B as nn,A as pa,u as ze,j as Pi,a3 as as,c as Et,af as Sn,a6 as Ti,E as O1,r as qt,w as Jt,y as vn,X as E2,J as Ki,l as pn,K as va,d as Es,s as C2,g as k2,a4 as O2,ah as M1,aj as gc,p as Jo,an as M2,m as N2,a8 as ga,ag as Kl,b as N1}from"./vue-chunks-Ci-XTWEs.js";import{p as Kr,a4 as A2,g as Cs,ay as ju,a8 as mc,z as Nn,B as Bn,aD as yc,aE as T2,I as dr,b as _c,c as bc,D as xc,au as D2,ab as An,M as yr,F as Jr,e as ci,u as Or,v as Mr,X as ma,Q as wc,ar as Sc,aF as lo,aB as Jl,O as Zr,K as ya,E as _a,aA as L2,aG as Rv,y as A1,q as T1,R as D1,T as P2,av as R2,ah as Ec,ad as I2,ag as L1,a as Cn,aC as B2,ap as Jn,ai as j2,aH as ba,a9 as Iv,aI as P1,a7 as H2,aJ as $2,aK as on,aL as It,aM as ss,aN as Zl,aO as Bf,aP as Za,aQ as zt,aR as Lo,aS as Di,aT as da,aU as ls,aV as Er,s as F2,aW as z2,aX as Ll,aY as Rp,aZ as U2,a_ as R1,a$ as V2,b0 as W2,b1 as my,b2 as G2,b3 as Ip,b4 as I1,b5 as q2,b6 as B1,b7 as Hu,b8 as X2,b9 as Y2,ba as gl,ao as Cc,ac as Bv,bb as j1,bc as H1,bd as $1,a3 as K2,be as J2,d as Qa,an as Z2,aw as Q2}from"./ui-antd-BgeWxFcI.js";import{u as eC}from"./global-DqP7WgZx.js";import{_ as yy}from"./empty-BFmzY9bl.js";import{g as tC,a as nC,b as rC,c as iC,_ as oC,d as aC,e as sC,f as lC,h as uC,i as dC,j as cC,k as fC,l as hC,m as pC,n as vC,o as gC,p as mC,q as yC,r as _C,s as bC,t as xC,u as wC,v as SC,w as EC,x as CC,y as kC,z as OC,A as MC,B as NC,C as AC,D as TC,E as DC,F as LC,G as PC,H as RC,I as IC,J as BC,K as jC,L as HC,M as $C,N as FC,O as zC,P as UC,Q as VC,R as WC,S as GC,T as qC,U as XC,V as YC,W as KC,X as JC,Y as ZC,Z as QC,$ as ek,a0 as tk,a1 as nk,a2 as rk,a3 as ik,a4 as ok,a5 as ak,a6 as sk,a7 as lk,a8 as uk,a9 as dk,aa as ck,ab as fk,ac as hk,ad as pk,ae as vk,af as gk,ag as mk,ah as yk,ai as _k,aj as bk,ak as xk,al as wk,am as Sk,an as Ek,ao as Ck,ap as kk,aq as Ok,ar as Mk,as as Nk,at as Ak,au as Tk,av as Dk,aw as Lk,ax as Pk,ay as Rk,az as Ik,aA as Bk,aB as jk,aC as Hk,aD as $k,aE as Fk,aF as zk,aG as Uk,aH as Vk,aI as Wk,aJ as Gk,aK as qk,aL as Xk,aM as Yk,aN as Kk,aO as Jk,aP as Zk,aQ as Qk,aR as eO,aS as tO,aT as nO,aU as rO,aV as iO,aW as oO,aX as aO,aY as sO,aZ as lO,a_ as uO,a$ as dO,b0 as cO,b1 as fO,b2 as hO,b3 as pO,b4 as vO,b5 as gO,b6 as mO,b7 as yO,b8 as _O,b9 as bO,ba as xO,bb as wO,bc as SO,bd as EO,be as CO,bf as kO,bg as OO,bh as MO,bi as NO,bj as AO,bk as TO,bl as DO,bm as LO,bn as PO,bo as RO,bp as IO,bq as BO,br as jO,bs as HO,bt as $O,bu as FO,bv as zO,bw as UO,bx as VO,by as WO,bz as GO,bA as qO,bB as XO,bC as YO,bD as KO,bE as JO,bF as ZO,bG as QO,bH as eM,bI as tM,bJ as nM,bK as rM,bL as iM,bM as oM,bN as aM,bO as sM,bP as lM,bQ as uM,bR as dM,bS as cM,bT as fM,bU as hM,bV as pM,bW as vM,bX as gM,bY as mM,bZ as yM,b_ as _M,b$ as bM,c0 as xM,c1 as wM,c2 as SM,c3 as EM,c4 as CM,c5 as kM,c6 as OM,c7 as MM,c8 as NM,c9 as AM,ca as TM,cb as DM,cc as LM,cd as PM,ce as RM,cf as IM,cg as BM,ch as jM,ci as HM,cj as $M,ck as FM,cl as zM,cm as UM,cn as VM,co as WM,cp as GM,cq as qM,cr as XM,cs as YM,ct as KM,cu as JM,cv as ZM,cw as QM,cx as eN,cy as tN,cz as nN,cA as rN,cB as iN,cC as oN,cD as aN,cE as sN,cF as lN,cG as uN,cH as ks,cI as jv,cJ as dN,cK as F1,cL as cN,cM as fN}from"./styles-NzgKa3Vv.js";import{M as kc}from"./model-select-BWi4a3Y6.js";import{_ as z1}from"./index-CEJalHa4.js";import{_ as Hv}from"./empty-CzGZrENG.js";import{a as hN,g as pN}from"./index-CzOC2Wxl.js";import{h as U1}from"./index-DXDs1xHg.js";import{d as vN}from"./vuedraggable.umd-DJBjom-v.js";import{g as V1}from"./thirdMcp-I3Lp92Ti.js";import{r as W1,g as G1}from"./index-ekVIF3nC.js";import{c as q1}from"./utils-ChQO-_r6.js";import{r as gN,a as mN,b as X1,c as Ql,d as Y1,e as $v,f as Fv,g as Oc,h as eu,i as yN,j as zv,k as _N,l as K1,m as J1,n as bN,o as Z1,p as xN,q as Uv,s as wN,t as SN,u as EN,v as CN,w as kN,x as ON,y as MN,z as NN,A as AN,B as TN,C as DN,D as LN,E as Q1,F as PN,G as RN,H as IN,I as ex,J as tx,K as BN,L as nx,M as jN,N as HN,O as $N,P as FN,Q as zN,R as UN,S as VN,T as WN,U as GN,V as qN,W as XN,X as YN,Y as KN,Z as JN,_ as ZN,$ as QN}from"./index-Ds5Umk46.js";import{T as eA}from"./top-header-BKMNjfID.js";import{a as tA}from"./add-group-DBCwDjxp.js";import"./cu-scroll-BmUgdtgQ.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const nA={key:0,class:"sidebar-handle-wrapper"},rA={class:"sidebar-container"},iA={class:"sidebar-menus"},oA=["onClick"],aA={class:"menu-name"},sA={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(n){const e=eC(),t=w2(),r=Yl(),i=Gt(()=>r.path.split("/")[3]),o=ke(!0),a=ke(!0);function l(){o.value=!o.value,a.value=!1,e.setHideLayoutTopAndBottom(o.value)}const u=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"未知问题",value:"unknown_issue",path:"/robot/config/unknown_issue",iconName:"unknown-issue"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],d=f=>{if(f.isNewWindowOpen){window.open(`/#${f.path}?robot_key=${r.query.robot_key}&id=${r.query.id}`);return}t.push({path:f.path,query:r.query})};return Yt(()=>{setTimeout(()=>{a.value=!1},3e3)}),(f,h)=>{const v=Kr,y=Fr;return G(),ae("div",{class:dn(["sidebar-wrapper",{"is-hide":o.value}])},[n.showSidebarBtn?(G(),ae("div",nA,[B(v,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:a.value,"onUpdate:open":h[0]||(h[0]=x=>a.value=x),arrow:!1},{title:U(()=>[Be(Ae(o.value?"展开":"收起"),1)]),default:U(()=>[S("span",{class:"sidebar-handle",onClick:l},h[1]||(h[1]=[S("span",{class:"handle-line handle-line01"},null,-1),S("span",{class:"handle-line handle-line02"},null,-1)]))]),_:1},8,["open"])])):qe("",!0),S("div",rA,[S("div",iA,[(G(),ae(rt,null,gt(u,x=>S("div",{class:dn(["sidebar-menu",{active:i.value==x.value}]),key:x.value,onClick:w=>d(x)},[o.value?(G(),Ve(v,{key:0,placement:"bottom"},{title:U(()=>[S("span",null,Ae(x.label),1)]),default:U(()=>[B(y,{name:x.iconName,class:"menu-icon",size:"16"},null,8,["name"])]),_:2},1024)):(G(),Ve(y,{key:1,name:x.iconName,class:"menu-icon",size:"16"},null,8,["name"])),S("span",aA,Ae(x.label),1)],10,oA)),64))])])],2)}}},lA=_t(sA,[["__scopeId","data-v-70985664"]]),uA={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(n){n!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${n}%`,this.previousValue=n)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.$emit("update:modelValue",n.value),this.$emit("zoom-change",n.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleFitView(){this.isShowMenu=!1,this.$emit("fitView")},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const n=this.currentValue.replace("%","").trim(),e=parseInt(n.replace(/[^\d]/g,""),10);if(!n){this.currentValue=`${this.previousValue}%`;return}if(isNaN(e)){this.currentValue=`${this.previousValue}%`;return}let t=e;t>800&&(t=800),t<1&&(t=1),this.currentValue=`${t}%`,this.previousValue=t,this.$emit("update:modelValue",t),this.$emit("zoom-change",t)},300)},handleBlur(){clearTimeout(this.debounceTimer);const n=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(n)&&n>=1&&n<=800?(this.$emit("update:modelValue",n),this.$emit("zoom-change",n),this.currentValue=`${n}%`,this.previousValue=n):this.currentValue=`${this.previousValue}%`},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(n.target)&&n.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},dA={class:"zoom-select"},cA={class:"zoom-select-options"},fA=["onClick"];function hA(n,e,t,r,i,o){return G(),ae("div",dA,[S("div",{class:"zoom-select-label",onClick:e[4]||(e[4]=nn(()=>{},["stop"]))},[To(S("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>i.currentValue=a),onInput:e[1]||(e[1]=(...a)=>o.handleInput&&o.handleInput(...a)),onFocus:e[2]||(e[2]=(...a)=>o.showMenu&&o.showMenu(...a)),onBlur:e[3]||(e[3]=(...a)=>o.handleBlur&&o.handleBlur(...a))},null,544),[[S2,i.currentValue]])]),To(S("div",cA,[(G(!0),ae(rt,null,gt(i.menus,a=>(G(),ae("div",{class:"zoom-select-option",key:a.value,onClick:l=>o.handleMenu(a)},Ae(a.label),9,fA))),128)),e[6]||(e[6]=S("div",{class:"option-line"},null,-1)),S("div",{class:"zoom-select-option",onClick:e[5]||(e[5]=a=>o.handleFitView())},"全览")],512),[[pa,i.isShowMenu]])])}const pA=_t(uA,[["render",hA],["__scopeId","data-v-c34f40df"]]),vA={class:"node-list-popup"},gA={class:"tabs-box"},mA={class:"node-list-popup-content"},yA={key:0,class:"node-list"},_A={class:"node-type"},bA={class:"node-flex-box"},xA=["onMousedown"],wA=["src","alt"],SA={class:"node-name"},EA={key:1,class:"node-box"},CA={class:"search-box"},kA={key:0,class:"node-list"},OA={class:"node-info-pop"},MA={class:"info"},NA=["src"],AA={class:"name"},TA={class:"extra"},DA=["onClick"],LA=["src"],PA={class:"info"},RA={class:"name"},IA={class:"total"},BA={class:"mcp-tools"},jA={class:"params-box"},HA={class:"param-item"},$A={class:"field"},FA={class:"name"},zA={class:"desc"},UA={class:"field"},VA={class:"name"},WA={class:"type"},GA={key:0,class:"required"},qA={class:"desc"},XA=["onMousedown"],YA={key:1,class:"empty-box"},KA={key:2,class:"node-box"},JA={class:"node-list"},ZA=["onClick"],QA={class:"node-info"},eT=["src"],tT={class:"info"},nT={class:"name"},rT={class:"more-link",href:"/#/plugins/index?active=2",target:"_blank"},iT={key:1,class:"empty-box"},oT={href:"/#/plugins/index?active=2",target:"_blank"},aT={__name:"node-list-popup",props:{type:{type:String,default:""}},emits:["addNode","mouseMove"],setup(n,{emit:e}){const t=e,r=n,i=Gt(()=>tC(r.type)),o=ke([]),a=ke([]),l=ke(1),u=ke("");Yt(()=>{nC().then(w=>{a.value=w}),rC().then(w=>{o.value=w})});const d=Gt(()=>u.value?a.value.filter(w=>(w.description+w.name).indexOf(u.value)>-1):a.value),f=(w,_)=>{w.preventDefault();let b=!1;const E=w.clientX,k=w.clientY,O=JSON.parse(JSON.stringify(_)),N=document.createElement("div");N.classList.add("node-item-ghost"),N.innerHTML=w.currentTarget.innerHTML,document.body.appendChild(N);const I=H=>{N.style.left=`${H.clientX+5}px`,N.style.top=`${H.clientY+5}px`};I(w);const T=H=>{!b&&(Math.abs(H.clientX-E)>5||Math.abs(H.clientY-k)>5)&&(b=!0),I(H),t("mouseMove")},L=H=>{document.body.removeChild(N),window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",L),b?t("addNode",{node:O,event:H}):h(O)};window.addEventListener("mousemove",T),window.addEventListener("mouseup",L,{once:!0})},h=w=>{w=JSON.parse(JSON.stringify(w)),t("addNode",{node:w})},v=(w,_,b)=>{let E=iC(_,b);f(w,E)};function y(w){l.value=w}function x(){window.open("/#/robot/list?active=3&mcp=2","_blank")}return(w,_)=>{const b=Fr,E=A2,k=mc;return G(),ae("div",vA,[S("div",gA,[S("div",{class:dn(["tab-item",{active:l.value==1}]),onClick:_[0]||(_[0]=O=>y(1))},[B(b,{name:"base-node-type"}),_[4]||(_[4]=Be(" 基础功能 "))],2),S("div",{class:dn(["tab-item",{active:l.value==3}]),onClick:_[1]||(_[1]=O=>y(3))},[B(b,{name:"plugin-node-type"}),_[5]||(_[5]=Be(" 插件 "))],2),S("div",{class:dn(["tab-item",{active:l.value==2}]),onClick:_[2]||(_[2]=O=>y(2))},[B(b,{name:"mcp-node-type"}),_[6]||(_[6]=Be(" MCP "))],2)]),S("div",mA,[l.value==1?(G(!0),ae(rt,{key:0},gt(i.value,O=>(G(),ae(rt,{key:O.key},[O.hidden?qe("",!0):(G(),ae("div",yA,[S("div",_A,Ae(O.name),1),S("div",bA,[(G(!0),ae(rt,null,gt(O.nodes,N=>(G(),ae(rt,{key:N.type},[N.hidden?qe("",!0):(G(),ae("div",{key:0,class:"node-item",onMousedown:I=>f(I,N)},[S("img",{src:N.properties.node_icon,alt:N.properties.node_name},null,8,wA),S("div",SA,Ae(N.properties.node_name),1)],40,xA))],64))),128))])]))],64))),128)):l.value==2?(G(),ae("div",EA,[S("div",CA,[B(E,{value:u.value,"onUpdate:value":_[3]||(_[3]=O=>u.value=O),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),d.value.length?(G(),ae("div",kA,[(G(!0),ae(rt,null,gt(d.value,(O,N)=>(G(),ae("div",{key:N,class:"node-item"},[B(k,{placement:"right"},{content:U(()=>[S("div",OA,[S("div",MA,[S("img",{class:"avatar",src:O.avatar},null,8,NA),S("div",AA,Ae(O.name),1)]),S("div",null,Ae(O.url),1),S("div",TA,"可用工具："+Ae(O.tools.length),1)])]),default:U(()=>[S("div",{class:"node-info",onClick:I=>O.expand=!O.expand},[S("img",{class:"avatar",src:O.avatar},null,8,LA),S("div",PA,[S("span",RA,Ae(O.name),1),S("span",IA,[Be(Ae(O.tools.length)+" ",1),O.expand?(G(),Ve(ze(Cs),{key:0})):(G(),Ve(ze(ju),{key:1}))])])],8,DA)]),_:2},1024),To(S("div",BA,[(G(!0),ae(rt,null,gt(O.tools,(I,T)=>(G(),Ve(k,{key:T,placement:"right"},{content:U(()=>[S("div",jA,[S("div",HA,[S("div",$A,[S("span",FA,Ae(I.name),1)]),S("div",zA,Ae(I.description),1)]),(G(!0),ae(rt,null,gt(I.inputSchema.properties,(L,H)=>(G(),ae("div",{key:H,class:"param-item"},[S("div",UA,[S("span",VA,Ae(H),1),S("span",WA,Ae(L.type),1),I.inputSchema.required&&I.inputSchema.required.includes(H)?(G(),ae("span",GA,"必填")):qe("",!0)]),S("div",qA,Ae(L.description),1)]))),128))])]),default:U(()=>[S("div",{class:"node-tool-item",onMousedown:L=>v(L,O,I)},Ae(I.name),41,XA)]),_:2},1024))),128))],512),[[pa,O.expand]])]))),128))])):(G(),ae("div",YA,[_[8]||(_[8]=S("img",{style:{height:"200px"},src:yy},null,-1)),_[9]||(_[9]=S("div",null,"暂无可用MCP插件",-1)),S("a",{onClick:x},[_[7]||(_[7]=Be("去添加")),B(ze(ju))])]))])):l.value==3?(G(),ae("div",KA,[o.value.length?(G(),ae(rt,{key:0},[S("div",JA,[(G(!0),ae(rt,null,gt(o.value,O=>(G(),ae("div",{onClick:N=>h(O),key:O.type,class:"node-item"},[S("div",QA,[S("img",{class:"avatar",src:O.properties.node_icon},null,8,eT),S("div",tT,[S("span",nT,Ae(O.properties.node_name),1)])])],8,ZA))),128))]),S("a",rT,[_[10]||(_[10]=Be("更多插件 ")),B(ze(ju))])],64)):(G(),ae("div",iT,[_[12]||(_[12]=S("img",{style:{height:"200px"},src:yy},null,-1)),_[13]||(_[13]=S("div",null,"暂无可用插件",-1)),S("a",oT,[_[11]||(_[11]=Be("去添加")),B(ze(ju))])]))])):qe("",!0)])])}}},Vv=_t(aT,[["__scopeId","data-v-3e57afb0"]]),sT={class:"custom-control-warpper"},lT={class:"custom-control-body"},uT={class:"custom-control"},dT={class:"control-item zoom-control"},cT={class:"control-item"},fT={class:"control-item"},hT={class:"control-item"},pT={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoomChange","autoLayout"],setup(n,{emit:e}){const t=e,r=n,{eventCenter:i}=r.lf.graphModel,o=ke(100),a=()=>{r.lf.fitView()},l=()=>{let k=o.value/100;r.lf.zoom(k),t("zoomChange",k)},u=k=>{o.value=k,l()},d=()=>{let k=o.value-10;k<1&&(k=1),o.value=k,l()},f=()=>{let k=o.value+10;k>800&&(k=800),o.value=k,l()},h=ke(!1),v=ke(null),y=k=>{let O=Math.floor(k.transform.SCALE_X*100);o.value=O},x=()=>{t("runTest")},w=()=>{t("autoLayout")},_=k=>{h.value&&(v.value.contains(k.target)||(h.value=!1))},b=()=>{h.value&&(h.value=!1)},E=k=>{t("addNode",k),h.value=!1};return Yt(()=>{document.addEventListener("click",_),i.on("graph:transform",y)}),Pi(()=>{document.removeEventListener("click",_),i.off("graph:transform",y)}),(k,O)=>{const N=Fr,I=Bn;return G(),ae("div",sT,[S("div",lT,[S("div",uT,[S("div",dT,[S("div",{class:"action-btn zoom-btn",onClick:d},[B(N,{name:"minus",size:"16"})]),B(pA,{modelValue:o.value,"onUpdate:modelValue":O[0]||(O[0]=T=>o.value=T),onZoomChange:u,onFitView:a},null,8,["modelValue"]),S("div",{class:"action-btn zoom-btn",onClick:f},[B(N,{name:"plus",size:"16"})])]),O[5]||(O[5]=S("i",{class:"control-line"},null,-1)),S("div",cT,[B(I,{type:"primary",onClick:O[1]||(O[1]=nn(T=>h.value=!0,["stop"]))},{icon:U(()=>[B(ze(Nn))]),default:U(()=>[O[2]||(O[2]=S("span",null,"新建节点",-1))]),_:1,__:[2]})]),S("div",fT,[B(I,{onClick:x,style:{"background-color":"#00ad3a"},type:"primary"},{default:U(()=>[B(ze(yc)),O[3]||(O[3]=S("span",null,"运行测试",-1))]),_:1,__:[3]})]),S("div",hT,[B(I,{onClick:w,type:"default"},{default:U(()=>[B(ze(T2)),O[4]||(O[4]=S("span",null,"整理画布",-1))]),_:1,__:[4]})])]),To(S("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:v},[B(Vv,{onAddNode:E,type:"float-btn",onMouseMove:b})],512),[[pa,h.value]])])])}}},vT=_t(pT,[["__scopeId","data-v-45cd1458"]]),gT={},mT={class:"node-form-layout"},yT={class:"layout-header"},_T={class:"layout-body"};function bT(n,e){return G(),ae("div",mT,[S("div",yT,[as(n.$slots,"header",{},void 0,!0)]),S("div",_T,[as(n.$slots,"default",{},void 0,!0)])])}const tr=_t(gT,[["render",bT],["__scopeId","data-v-a5d11f7a"]]),xT={class:"node-form-header"},wT={class:"node-title"},ST={class:"title-left"},ET=["src"],CT={class:"title-conttent"},kT={class:"title-right"},OT={class:"node-desc"},MT={__name:"node-form-header",props:{iconName:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},setup(n){const e=Et("changeTitle"),t=Et("deleteNode"),r=Et("close"),i=n;let o=null;const a=v=>new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":uN,"../../../../assets/svg/ai-generate-white.svg":lN,"../../../../assets/svg/ai-generate.svg":sN,"../../../../assets/svg/ai-mark.svg":aN,"../../../../assets/svg/ai.svg":oN,"../../../../assets/svg/alert-icon.svg":iN,"../../../../assets/svg/ali-ocr.svg":rN,"../../../../assets/svg/analysis.svg":nN,"../../../../assets/svg/anthrop.svg":tN,"../../../../assets/svg/applet.svg":eN,"../../../../assets/svg/arrow-down.svg":QM,"../../../../assets/svg/arrow-left.svg":ZM,"../../../../assets/svg/arrow-right.svg":JM,"../../../../assets/svg/attachment.svg":KM,"../../../../assets/svg/auth.svg":YM,"../../../../assets/svg/auto-reply.svg":XM,"../../../../assets/svg/azure.svg":qM,"../../../../assets/svg/baichuan.svg":GM,"../../../../assets/svg/base-node-type.svg":WM,"../../../../assets/svg/book.svg":VM,"../../../../assets/svg/chat-cache.svg":UM,"../../../../assets/svg/chat-mode.svg":zM,"../../../../assets/svg/chat-robot-icon.svg":FM,"../../../../assets/svg/chat.svg":$M,"../../../../assets/svg/check-arrow-filled.svg":HM,"../../../../assets/svg/circularNeedle.svg":jM,"../../../../assets/svg/client.svg":BM,"../../../../assets/svg/close-circle.svg":IM,"../../../../assets/svg/cmd.svg":RM,"../../../../assets/svg/code-run-node.svg":PM,"../../../../assets/svg/cohere.svg":LM,"../../../../assets/svg/collaborator.svg":DM,"../../../../assets/svg/collapse-close.svg":TM,"../../../../assets/svg/collapse-open.svg":AM,"../../../../assets/svg/colour-edit.svg":NM,"../../../../assets/svg/comment-search.svg":MM,"../../../../assets/svg/common-quession.svg":OM,"../../../../assets/svg/cu-doc-active.svg":kM,"../../../../assets/svg/cu-doc-icon.svg":CM,"../../../../assets/svg/custom-group-node.svg":EM,"../../../../assets/svg/data-node.svg":SM,"../../../../assets/svg/data-security.svg":wM,"../../../../assets/svg/database-menu-icon.svg":xM,"../../../../assets/svg/deepseek.svg":bM,"../../../../assets/svg/delete.svg":_M,"../../../../assets/svg/ding-group-node.svg":yM,"../../../../assets/svg/direct-connection.svg":mM,"../../../../assets/svg/dislike-active.svg":gM,"../../../../assets/svg/dislike.svg":vM,"../../../../assets/svg/doc-active-menu-icon.svg":pM,"../../../../assets/svg/doc-directory.svg":hM,"../../../../assets/svg/doc-draft.svg":fM,"../../../../assets/svg/doc-file.svg":cM,"../../../../assets/svg/doc-file2.svg":dM,"../../../../assets/svg/doc-icon-active.svg":uM,"../../../../assets/svg/doc-icon.svg":lM,"../../../../assets/svg/doc-menu-icon.svg":sM,"../../../../assets/svg/document.svg":aM,"../../../../assets/svg/download.svg":oM,"../../../../assets/svg/drag.svg":iM,"../../../../assets/svg/duiwaifuwu.svg":rM,"../../../../assets/svg/economic-active.svg":nM,"../../../../assets/svg/economic.svg":tM,"../../../../assets/svg/edit-02.svg":eM,"../../../../assets/svg/edit.svg":QO,"../../../../assets/svg/empty-document.svg":ZO,"../../../../assets/svg/empty.svg":JO,"../../../../assets/svg/end-node.svg":KO,"../../../../assets/svg/enterprise-active.svg":YO,"../../../../assets/svg/enterprise.svg":XO,"../../../../assets/svg/enterprise2.svg":qO,"../../../../assets/svg/expand.svg":GO,"../../../../assets/svg/explain-node.svg":WO,"../../../../assets/svg/export-record.svg":VO,"../../../../assets/svg/eye-open.svg":UO,"../../../../assets/svg/field-menu-icon.svg":zO,"../../../../assets/svg/file-icon.svg":FO,"../../../../assets/svg/file-search.svg":$O,"../../../../assets/svg/finance.svg":HO,"../../../../assets/svg/function-center.svg":jO,"../../../../assets/svg/gemini.svg":BO,"../../../../assets/svg/generate-icon.svg":IO,"../../../../assets/svg/gou.svg":RO,"../../../../assets/svg/government.svg":PO,"../../../../assets/svg/graph-icon.svg":LO,"../../../../assets/svg/guanlianzhishiku.svg":DO,"../../../../assets/svg/high-active.svg":TO,"../../../../assets/svg/high.svg":AO,"../../../../assets/svg/http-node.svg":NO,"../../../../assets/svg/huanyingyu.svg":MO,"../../../../assets/svg/huoshanyinqin.svg":OO,"../../../../assets/svg/img-icon.svg":kO,"../../../../assets/svg/input.svg":CO,"../../../../assets/svg/jibenpeizhi.svg":EO,"../../../../assets/svg/jichupeizhi.svg":SO,"../../../../assets/svg/jina.svg":wO,"../../../../assets/svg/judge-node.svg":xO,"../../../../assets/svg/knowledge-base-node.svg":bO,"../../../../assets/svg/knowledge-config-active-icon.svg":_O,"../../../../assets/svg/knowledge-config-icon.svg":yO,"../../../../assets/svg/law.svg":mO,"../../../../assets/svg/liaotianceshi.svg":gO,"../../../../assets/svg/like-active.svg":vO,"../../../../assets/svg/like-icon.svg":pO,"../../../../assets/svg/like.svg":hO,"../../../../assets/svg/lingyiwanwu.svg":fO,"../../../../assets/svg/link-icon-active.svg":cO,"../../../../assets/svg/link-icon.svg":dO,"../../../../assets/svg/link-left.svg":uO,"../../../../assets/svg/lock-icon.svg":lO,"../../../../assets/svg/login-success.svg":sO,"../../../../assets/svg/logout.svg":aO,"../../../../assets/svg/loop-2.svg":oO,"../../../../assets/svg/loop-3.svg":iO,"../../../../assets/svg/loop-icon.svg":rO,"../../../../assets/svg/manufacture.svg":nO,"../../../../assets/svg/mcp-node-type.svg":tO,"../../../../assets/svg/mcp-node.svg":eO,"../../../../assets/svg/medical-treatment.svg":Qk,"../../../../assets/svg/menu-expand.svg":Zk,"../../../../assets/svg/message.svg":Jk,"../../../../assets/svg/minus.svg":Kk,"../../../../assets/svg/mix-icon.svg":Yk,"../../../../assets/svg/more-compatible.svg":Xk,"../../../../assets/svg/moxingshezhi.svg":qk,"../../../../assets/svg/multimode-box.svg":Gk,"../../../../assets/svg/nav-chat.svg":Wk,"../../../../assets/svg/nav-doc.svg":Vk,"../../../../assets/svg/nav-explore.svg":Uk,"../../../../assets/svg/nav-find.svg":zk,"../../../../assets/svg/nav-library.svg":Fk,"../../../../assets/svg/nav-robot.svg":$k,"../../../../assets/svg/nav-search.svg":Hk,"../../../../assets/svg/network.svg":jk,"../../../../assets/svg/open-ai.svg":Bk,"../../../../assets/svg/ordinary-segmentation.svg":Ik,"../../../../assets/svg/out-the-box.svg":Rk,"../../../../assets/svg/output.svg":Pk,"../../../../assets/svg/parameter-extraction-node.svg":Lk,"../../../../assets/svg/pc.svg":Dk,"../../../../assets/svg/pdf-img.svg":Tk,"../../../../assets/svg/pdf-ocr.svg":Ak,"../../../../assets/svg/pdf-text.svg":Nk,"../../../../assets/svg/phone.svg":Mk,"../../../../assets/svg/plugin-node-type.svg":Ok,"../../../../assets/svg/plus.svg":kk,"../../../../assets/svg/point-h.svg":Ck,"../../../../assets/svg/problem-optimization-node.svg":Ek,"../../../../assets/svg/problem-optimization.svg":Sk,"../../../../assets/svg/prompt-icon.svg":wk,"../../../../assets/svg/put-away.svg":xk,"../../../../assets/svg/qa-feedback.svg":bk,"../../../../assets/svg/question-node.svg":_k,"../../../../assets/svg/quick-Instruction.svg":yk,"../../../../assets/svg/quote-file.svg":mk,"../../../../assets/svg/quotes.svg":gk,"../../../../assets/svg/recommendation.svg":vk,"../../../../assets/svg/reply-content.svg":pk,"../../../../assets/svg/reply-settings.svg":hk,"../../../../assets/svg/retail.svg":fk,"../../../../assets/svg/reward-points.svg":ck,"../../../../assets/svg/right-fork-icon.svg":dk,"../../../../assets/svg/robot_auto_reply.svg":uk,"../../../../assets/svg/robot_subscribe_reply.svg":lk,"../../../../assets/svg/save-draft.svg":sk,"../../../../assets/svg/sdk.svg":ak,"../../../../assets/svg/search-check-icon.svg":ok,"../../../../assets/svg/search-right.svg":ik,"../../../../assets/svg/search-tip.svg":rk,"../../../../assets/svg/search.svg":nk,"../../../../assets/svg/segmentation-down.svg":tk,"../../../../assets/svg/segmentation-icon.svg":ek,"../../../../assets/svg/segmentation-up.svg":QC,"../../../../assets/svg/segmentation.svg":ZC,"../../../../assets/svg/select-disabled.svg":JC,"../../../../assets/svg/semantic-segmentation.svg":KC,"../../../../assets/svg/sensitive-icon.svg":YC,"../../../../assets/svg/seo-gray.svg":XC,"../../../../assets/svg/seo-highlight.svg":qC,"../../../../assets/svg/seo-light.svg":GC,"../../../../assets/svg/session-record.svg":WC,"../../../../assets/svg/session.svg":VC,"../../../../assets/svg/set-keywords.svg":UC,"../../../../assets/svg/setting.svg":zC,"../../../../assets/svg/share.svg":FC,"../../../../assets/svg/similarity.svg":$C,"../../../../assets/svg/skii.svg":HC,"../../../../assets/svg/source-energy.svg":jC,"../../../../assets/svg/specify-reply-node.svg":BC,"../../../../assets/svg/start-node.svg":IC,"../../../../assets/svg/statistical-analysis.svg":RC,"../../../../assets/svg/success.svg":PC,"../../../../assets/svg/suggested-issues.svg":LC,"../../../../assets/svg/support.svg":DC,"../../../../assets/svg/switch-mobile.svg":TC,"../../../../assets/svg/system-setting.svg":AC,"../../../../assets/svg/team-manage-active.svg":NC,"../../../../assets/svg/team-manage.svg":MC,"../../../../assets/svg/team-manage2.svg":OC,"../../../../assets/svg/tengxunhunyuan.svg":kC,"../../../../assets/svg/test-active-menu-icon.svg":CC,"../../../../assets/svg/test-menu-icon.svg":EC,"../../../../assets/svg/think.svg":SC,"../../../../assets/svg/tongyiqianwen.svg":wC,"../../../../assets/svg/unit.svg":xC,"../../../../assets/svg/unknown-issue.svg":bC,"../../../../assets/svg/unknown-prompt.svg":_C,"../../../../assets/svg/use-token-active.svg":yC,"../../../../assets/svg/use-token.svg":mC,"../../../../assets/svg/user-icon.svg":gC,"../../../../assets/svg/variable-assignment-node.svg":vC,"../../../../assets/svg/vector-icon.svg":pC,"../../../../assets/svg/wenxinyiyan.svg":hC,"../../../../assets/svg/workflow-robot-icon.svg":fC,"../../../../assets/svg/workflow.svg":cC,"../../../../assets/svg/wx-app-icon.svg":dC,"../../../../assets/svg/xitongtishici.svg":uC,"../../../../assets/svg/xunfeixinghuo.svg":lC,"../../../../assets/svg/yuezhianmian.svg":sC,"../../../../assets/svg/zhipuai.svg":aC,"../../../../assets/svg/zm-plugins-node.svg":oC})[`../../../../assets/svg/${v}.svg`],import.meta.url).href,l=Gt(()=>a(i.iconName)),u=ke(i.title),d=()=>{o&&clearTimeout(o),o=setTimeout(()=>{e(u.value)},250)},f=()=>{t()},h=()=>{r()};return(v,y)=>{const x=dr,w=Fr,_=bc,b=_c,E=xc;return G(),ae("div",xT,[S("div",wT,[S("div",ST,[as(v.$slots,"node-icon",{},()=>[l.value?(G(),ae("img",{key:0,class:"node-icon",src:l.value},null,8,ET)):qe("",!0)],!0)]),S("div",CT,[B(x,{class:"node-name-input",value:u.value,"onUpdate:value":y[0]||(y[0]=k=>u.value=k),placeholder:"请输入节点名称",onChange:nn(d,["stop"])},null,8,["value"])]),S("div",kT,[n.hideMenus?qe("",!0):(G(),Ve(E,{key:0},{overlay:U(()=>[B(b,{style:{width:"100px"}},{default:U(()=>[B(_,{onClick:y[2]||(y[2]=k=>f())},{default:U(()=>y[3]||(y[3]=[S("a",{href:"javascript:;"},"删除",-1)])),_:1,__:[3]})]),_:1})]),default:U(()=>[S("div",{class:"action-btn delete-btn",onClick:y[1]||(y[1]=nn(()=>{},["prevent"]))},[B(w,{name:"point-h",class:"btn-icon"})])]),_:1})),S("div",{class:"action-btn close-btn",onClick:h},[B(ze(D2),{class:"btn-icon",style:{"font-size":"12px"}})])])]),S("div",OT,[as(v.$slots,"desc",{},()=>[Be(Ae(i.desc),1)],!0)])])}}},nr=_t(MT,[["__scopeId","data-v-96804834"]]),Wv="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",NT="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",AT=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"array<string>",value:"array<string>"}],TT={emits:["close","update-node"],components:{NodeFormLayout:tr,NodeFormHeader:nr,QuestionCircleOutlined:An,PlusOutlined:Nn},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],show:!1,typOptions:[...AT],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let n=JSON.parse(this.node.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global},methods:{update(){let n=JSON.parse(this.node.node_params);n.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(n)};this.$emit("update-node",e)},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(n,e){this.formState={...n},this.editIndex=e,this.show=!0},handleDel(n){this.diy_global.splice(n,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},DT={class:"start-node-form"},LT={class:"node-form-content"},PT={class:"start-node"},RT={class:"start-node-options"},IT={class:"options-item-body"},BT={class:"option-label"},jT={class:"option-type"},HT={class:"start-node-options"},$T={class:"options-title"},FT={class:"options-item-body"},zT={class:"option-label"},UT={class:"option-type"},VT={class:"item-actions-box"},WT={class:"action-items-box"};function GT(n,e,t,r,i,o){const a=Sn("NodeFormHeader"),l=Sn("QuestionCircleOutlined"),u=Kr,d=Fr,f=Sn("PlusOutlined"),h=Bn,v=dr,y=ci,x=Mr,w=Or,_=ma,b=wc,E=Jr,k=yr,O=Sn("NodeFormLayout");return G(),Ve(O,null,{header:U(()=>[B(a,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:U(()=>e[5]||(e[5]=[S("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])),_:1},8,["title","iconName"])]),default:U(()=>[S("div",DT,[S("div",LT,[S("div",PT,[S("div",RT,[e[6]||(e[6]=S("div",{class:"options-title"},[S("div",null,[S("img",{src:Wv,alt:"",class:"title-icon"}),Be("输出")])],-1)),(G(!0),ae(rt,null,gt(i.sys_global,N=>(G(),ae("div",{class:dn(["options-item",{"is-required":N.required}]),key:N.key},[S("div",IT,[S("div",BT,Ae(N.key),1),S("div",jT,Ae(N.typ),1)])],2))),128))]),S("div",HT,[S("div",$T,[e[8]||(e[8]=S("div",null,[S("img",{src:NT,alt:"",class:"title-icon"}),S("span",null,"自定义全局变量")],-1)),S("div",null,[B(u,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:U(()=>e[7]||(e[7]=[S("div",null,[Be(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),S("br"),Be(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),S("br"),Be(" 2、通过api访问时，可以再API中传递参数值"),S("br"),Be(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])),default:U(()=>[B(l,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(G(!0),ae(rt,null,gt(i.diy_global,(N,I)=>(G(),ae("div",{class:dn(["options-item diy-options-item",{"is-required":N.required}]),key:N.key},[S("div",FT,[S("div",zT,Ae(N.key),1),S("div",UT,Ae(N.typ),1)]),S("div",VT,[B(d,{class:"action-btn",name:"edit-02",onClick:T=>o.handleEdit(N,I)},null,8,["onClick"]),B(d,{class:"action-btn",name:"close-circle",onClick:T=>o.handleDel(I)},null,8,["onClick"])])],2))),128)),S("div",WT,[B(h,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:o.handleAdd},{icon:U(()=>[B(f)]),default:U(()=>[e[9]||(e[9]=Be(" 添加全局变量 "))]),_:1,__:[9]},8,["onClick"])])]),B(k,{open:i.show,"onUpdate:open":e[4]||(e[4]=N=>i.show=N),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:o.handleOk},{default:U(()=>[B(E,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:U(()=>[B(y,{label:"变量名",name:"key"},{default:U(()=>[B(v,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=N=>i.formState.key=N),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),B(y,{label:"类型",name:"typ"},{default:U(()=>[B(w,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=N=>i.formState.typ=N)},{default:U(()=>[(G(!0),ae(rt,null,gt(i.typOptions,N=>(G(),Ve(x,{value:N.value,key:N.value},{default:U(()=>[S("span",null,Ae(N.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),B(y,{label:"必填",name:"required"},{default:U(()=>[B(_,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=N=>i.formState.required=N)},null,8,["checked"])]),_:1}),B(y,{label:"描述",name:"desc"},{default:U(()=>[B(b,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=N=>i.formState.desc=N),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const qT=_t(TT,[["render",GT],["__scopeId","data-v-e347a198"]]),XT={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right"}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(n){n&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(n){const e=[],t=[],r=(i,o)=>{if(!i||i.length===0)return!1;for(let a=0;a<i.length;a++){const l=i[a],u=l[this.valueKey];if(u===n)return e[o]=l,t[o]=u,!0;if(l[this.childrenKey]&&l[this.childrenKey].length>0){if(e[o]=l,t[o]=u,r(l[this.childrenKey],o+1))return!0;e[o]=null,t[o]=null}}return!1};r(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(n){if(!n||n.length===0)return;const e=[];let t=this.options;for(let r=0;r<n.length;r++){const i=n[r],o=t.find(a=>a[this.valueKey]===i);if(o)e.push(o),t=o[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let n=0;n<this.selectedPath.length;n++){const e=this.selectedPath[n];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:n+1})}},handleSelect(n,e){this.hasChildren(n)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(n),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(n[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(n)&&this.activePath.push({title:n[this.labelKey],options:n[this.childrenKey],level:e+1}),this.$emit("select",n,this.selectedPath,e),(this.checkAnyLevel||!this.hasChildren(n))&&(this.$emit("change",n[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:n[this.valueKey]))},isActive(n,e){return!this.selectedPath||this.selectedPath.length<=e?!1:n[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(n){return n[this.childrenKey]&&n[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const n=this.$el;if(!n)return;const e=n.getBoundingClientRect(),t=window.innerWidth,r=180;e.right+r>t&&e.left>r?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",r)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",r))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},YT={class:"cascade-panel"},KT={class:"cascade-panel-body"},JT=["onClick"],ZT={class:"item-content"},QT={class:"item-label"},eD={key:0,class:"item-icon"},tD={key:0,class:"cascade-panel-empty"};function nD(n,e,t,r,i,o){return G(),ae("div",YT,[S("div",{class:dn(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(G(!0),ae(rt,null,gt(i.activePath,(a,l)=>(G(),ae("div",{class:"cascade-panel-list",key:l},[S("div",KT,[(G(!0),ae(rt,null,gt(a.options,u=>(G(),ae("div",{class:dn(["cascade-panel-item",{active:o.isActive(u,l)}]),key:u.value,onClick:d=>o.handleSelect(u,l)},[S("div",ZT,[S("span",QT,Ae(u.label),1),o.hasChildren(u)?(G(),ae("span",eD,e[0]||(e[0]=[S("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[S("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)]))):qe("",!0)])],10,JT))),128)),a.options&&a.options.length===0?(G(),ae("div",tD," 暂无数据 ")):qe("",!0)])]))),128))],2)])}const rD=_t(XT,[["render",nD],["__scopeId","data-v-9e580d45"]]),rx=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...rx(t.children)):e.push(t)}),e},iD={name:"JMention",components:{CascadePanel:rD},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(n){n.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(n){n.target.closest(".dropdown-list")&&n.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1,this.showAtList=!1},onFocus(){this.$emit("focus")},onOpen(n){this.$emit("open",n)},getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(r=>{let i="";this.type==="textarea"?r.nodeName==="BR"?i=`
`:r.classList&&r.classList.contains("j-mention-at")?i=r.dataset.value:i=r.textContent:r.classList&&r.classList.contains("j-mention-at")?i=r.dataset.value:r.nodeName==="BR"?i="":i=r.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let r={};this.selectedList.forEach(o=>{!r[o.value]&&t.indexOf(o.value)!==-1&&(r[o.value]=o)});let i=Object.values(r);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],r=rx(this.options),i=[...t,...r].filter(a=>a&&a.value&&a.value!=""&&a.typ!=="node");const o=new Set;i.forEach(a=>{const l=new RegExp(`(${a.value})`,"g");if(l.test(this.defaultValue)&&!o.has(a.value)){let u=a.node_name+"."+a.text;u=u.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${a.node_id}" contentEditable="false" data-value="${a.value}">${u}</span> `),o.add(a.value),this.selectOption(a,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},dropDownKeydown(n){const{keyCode:e}=n;if(!this.showDropdown){if(e===13&&this.type==="input"){n.preventDefault(),n.stopPropagation();return}return}if(![13,38,40].includes(e)||(n.preventDefault(),n.stopPropagation(),e===13))return;const r={38:-1,40:1};this.chooseIndex+=r[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),r=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,r);else if(i.nodeType===Node.ELEMENT_NODE){const a=i.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?o+=u.textContent.slice(0,r):o+=u.textContent)}}return o.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,r=e.startContainer;let i="";if(r.nodeType===Node.TEXT_NODE)i=r.textContent.slice(0,t);else if(r.nodeType===Node.ELEMENT_NODE){const a=r.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?i+=u.textContent.slice(0,t):i+=u.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),r=await this.getDropdownListSize(),i=window.innerWidth,o=window.innerHeight;let a=t.bottom,l=t.left;return a+r.height>o&&(a=t.top-r.height),l+r.width>i&&(l=t.right-r.width),a<0&&(a=0),l<0&&(l=0),{top:a,left:l}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let r=t.dataset.value;const i=this.options.find(o=>o.value==r);this.selectedList.push(i),this.selectedIdSet.add(r)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(n){this.updateValue();const e=this.getLastChar();if(n.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{top:t,left:r}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${r}px; top:${t}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),a=o.startOffset,l=o.startContainer;let u=a-t,d=l;if(u<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){u=f.textContent.length-t,d=f;break}f=f.previousSibling}}if(d.nodeType===Node.TEXT_NODE){d.replaceData(u,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${n}`;const h=document.createElement("span");h.contentEditable=!0,h.innerHTML+="&nbsp;",h.classList.add("at-space");for(const x in e)f.dataset[x]=e[x];const v=document.createRange();v.setStart(d,u),v.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),h.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(n,e,t){let r=t[t.length-1];delete r.children,this.selectOption(r)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1,this.showAtList=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const r={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,r),this.initShowOptionList(),this.updateValue())},handleDirectionChange(n,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),r=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!r)return;const i=parseFloat(t[1]),o=parseFloat(r[1]);let a;n==="left"?a=i-e:a=i+e,this.positionStyle=`left:${a}px; top:${o}px;`}}},oD={style:{width:"100%",position:"relative"}},aD={class:"mention-input-warpper",ref:"JMentionContainer"},sD=["placeholder"],lD={key:0,class:"placeholder"};function uD(n,e,t,r,i,o){const a=Sn("CascadePanel");return G(),ae("div",oD,[e[5]||(e[5]=S("div",null,null,-1)),(G(),Ve(O1,{to:"body"},[i.showDropdown?(G(),ae("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:Ti(i.positionStyle)},[B(a,{options:i.showOptions,onChange:o.onSelectOption,onDirectionChange:o.handleDirectionChange},null,8,["options","onChange","onDirectionChange"])],4)):qe("",!0)])),S("div",aD,[S("div",{ref:"JMention",style:Ti([t.inputStyle]),class:dn(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onWheel:e[0]||(e[0]=nn(()=>{},["stop"])),onFocus:e[1]||(e[1]=(...l)=>o.onFocus&&o.onFocus(...l)),onInput:e[2]||(e[2]=(...l)=>o.divInput&&o.divInput(...l)),onKeydown:e[3]||(e[3]=(...l)=>o.dropDownKeydown&&o.dropDownKeydown(...l)),onClick:e[4]||(e[4]=(...l)=>o.clickJMention&&o.clickJMention(...l))},null,46,sD),i.localValue.length==0?(G(),ae("span",lD,Ae(t.placeholder),1)):qe("",!0)],512)])}const er=_t(iD,[["render",uD],["__scopeId","data-v-e07dded7"]]),dD={class:"problem-optimization-form"},cD={class:"gray-block"},fD={class:"flex-block-item"},hD={class:"number-box"},pD={class:"number-slider-box"},vD={class:"number-input-box"},gD={class:"number-box"},mD={class:"number-slider-box"},yD={class:"number-input-box"},_D={class:"number-box"},bD={class:"number-box"},xD={class:"number-slider-box"},wD={class:"number-input-box"},SD={class:"field-list-item"},ED={class:"field-label"},CD={class:"field-type"},kD={class:"diy-form-item"},OD={class:"form-content"},MD={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=$r(),o=ke(null),a=Gt(()=>i.modelList),l=ke([]),u=ke([]),d=ke(!1),f=()=>{d.value=!d.value},h=(V,q)=>{b.prompt=V,b.prompt_tags=q};function v(){const V=r.lf.getNodeModelById(r.nodeId);if(V){let q=V.getAllParentVariable();u.value=y(q)}}function y(V){return V.forEach(q=>{q.typ=="node"?q.node_type==1?q.value="global":q.value=q.node_id:q.value=q.key,q.children&&q.children.length>0&&(q.children=y(q.children))}),V}const x=()=>{const V=r.lf.getNodeModelById(r.nodeId);if(V){let q=V.getAllParentVariable();l.value=q}};function w(V){if(V){let q=V.split("."),D=q[0],W=q.filter(($,pe)=>pe>0).join(".");return[D,W]}return["global","question"]}const _=ke(),b=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1}),E=()=>{const V=r.node.dataRaw||r.node.node_params||"{}",q=JSON.stringify({question_optimize:JSON.parse(V).question_optimize||{}}),D=JSON.stringify({question_optimize:{...b,question_value:b.question_value.join("."),model_config_id:b.model_config_id?+b.model_config_id:b.model_config_id}});q!=D&&t("update-node",{...r.node,...b,node_params:D})},k=()=>{try{let V=r.node.dataRaw||r.node.node_params||"{}",q=JSON.parse(V).question_optimize||{};q=JSON.parse(JSON.stringify(q));let{model_config_id:D,use_model:W,context_pair:$,temperature:pe,max_token:De,prompt:de,prompt_tags:Se,question_value:me,enable_thinking:ve}=q;x(),v(),b.model_config_id=D,b.use_model=W,b.context_pair=$||0,b.temperature=pe,b.max_token=De,b.prompt=de,b.enable_thinking=ve,b.prompt_tags=Se||[],b.question_value=w(me),!b.model_config_id&&a.value.length>0&&(b.model_config_id=a.value[0].id,b.use_model=a.value[0].children[0].name)}catch(V){}};Jt(()=>b,()=>{E()},{deep:!0});const O=ke(null),N=V=>{b.prompt="",V.prompt_type==1?b.prompt=V.markdown:b.prompt=V.prompt,vn(()=>{o.value.initData()})},I=V=>{V||v()},T=ke({}),L=(V,q)=>{T.value=q},H=Gt(()=>{if(!b.model_config_id)return!1;let V=b.model_config_id+"#"+b.use_model;return T.value[V]}),X=()=>{t("close")};return Yt(()=>{k()}),(V,q)=>{const D=Bn,W=ci,$=Kr,pe=Jl,De=lo,de=Zr,Se=ma,me=ya,ve=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:X},null,8,["title","iconName"])]),default:U(()=>[S("div",dD,[S("div",{class:"node-form-content",onMousedown:q[11]||(q[11]=nn(()=>{},["stop"]))},[B(ve,{ref_key:"formRef",ref:_,layout:"vertical",model:b},{default:U(()=>[S("div",cD,[q[24]||(q[24]=S("div",{class:"gray-block-title"},"输入",-1)),B(W,{label:"LLM模型",name:"use_model"},{default:U(()=>[S("div",fD,[B(kc,{modelType:"LLM",modeName:b.use_model,"onUpdate:modeName":q[0]||(q[0]=Re=>b.use_model=Re),modeId:b.model_config_id,"onUpdate:modeId":q[1]||(q[1]=Re=>b.model_config_id=Re),onLoaded:L,style:{width:"348px"}},null,8,["modeName","modeId"]),B(D,{onClick:f},{default:U(()=>[q[12]||(q[12]=Be("高级设置 ")),d.value?(G(),Ve(ze(Cs),{key:0})):(G(),Ve(ze(Sc),{key:1}))]),_:1,__:[12]})])]),_:1}),d.value?(G(),Ve(W,{key:0,name:"temperature"},{label:U(()=>[q[14]||(q[14]=S("span",null,"温度 ",-1)),B($,null,{title:U(()=>q[13]||(q[13]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",hD,[S("div",pD,[B(De,null,{default:U(()=>[B(pe,{class:"custom-slider",value:b.temperature,"onUpdate:value":q[2]||(q[2]=Re=>b.temperature=Re),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),S("div",vD,[B(de,{value:b.temperature,"onUpdate:value":q[3]||(q[3]=Re=>b.temperature=Re),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):qe("",!0),d.value?(G(),Ve(W,{key:1,name:"max_token"},{label:U(()=>[q[16]||(q[16]=S("span",null,"最大token ",-1)),B($,null,{title:U(()=>q[15]||(q[15]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",gD,[S("div",mD,[B(De,null,{default:U(()=>[B(pe,{class:"custom-slider",value:b.max_token,"onUpdate:value":q[4]||(q[4]=Re=>b.max_token=Re),min:0,max:100*1024},null,8,["value"])]),_:1})]),S("div",yD,[B(de,{value:b.max_token,"onUpdate:value":q[5]||(q[5]=Re=>b.max_token=Re),min:0,max:100*1024},null,8,["value"])])])]),_:1})):qe("",!0),d.value&&H.value?(G(),Ve(W,{key:2,name:"enable_thinking"},{label:U(()=>[q[18]||(q[18]=S("span",null,"深度思考 ",-1)),B($,null,{title:U(()=>q[17]||(q[17]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",_D,[B(Se,{checked:b.enable_thinking,"onUpdate:checked":q[6]||(q[6]=Re=>b.enable_thinking=Re)},null,8,["checked"])])]),_:1})):qe("",!0),B(W,{name:"context_pair"},{label:U(()=>[q[20]||(q[20]=S("span",null,"上下文数量 ",-1)),B($,null,{title:U(()=>q[19]||(q[19]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",bD,[S("div",xD,[B(De,null,{default:U(()=>[B(pe,{class:"custom-slider",value:b.context_pair,"onUpdate:value":q[7]||(q[7]=Re=>b.context_pair=Re),min:0,max:50},null,8,["value"])]),_:1})]),S("div",wD,[B(de,{value:b.context_pair,"onUpdate:value":q[8]||(q[8]=Re=>b.context_pair=Re),min:0,max:50},null,8,["value"])])])]),_:1}),B(W,{name:"prompt",class:"width-100"},{label:U(()=>q[21]||(q[21]=[S("div",{class:"space-between-box"},[S("div",null,"对话背景")],-1)])),default:U(()=>[B(er,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:b.prompt_tags,defaultValue:b.prompt,ref_key:"atInputRef",ref:o,onOpen:x,onChange:q[9]||(q[9]=(Re,Ie)=>h(Re,Ie)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:U(({label:Re,payload:Ie})=>[S("div",SD,[S("div",ED,Ae(Re),1),S("div",CD,Ae(Ie.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),q[22]||(q[22]=S("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),S("div",kD,[q[23]||(q[23]=S("div",{class:"form-label"},"用户问题",-1)),S("div",OD,[B(me,{value:b.question_value,"onUpdate:value":q[10]||(q[10]=Re=>b.question_value=Re),onDropdownVisibleChange:I,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:Re})=>Re.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),q[25]||(q[25]=S("div",{class:"gray-block mt16"},[S("div",{class:"gray-block-title"},"输出"),S("div",{class:"options-item"},[S("div",{class:"option-label"},"问题优化结果"),S("div",{class:"option-type"},"string")])],-1))]),_:1,__:[25]},8,["model"]),B(z1,{onOk:N,ref_key:"importPromptRef",ref:O},null,512)],32)])]),_:1})}}},ND=_t(MD,[["__scopeId","data-v-1885fba6"]]),AD={class:"input-box"},TD={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(n,{expose:e,emit:t}){const r=ke(!1),i=t;Jt(()=>r.value,h=>{h||i("ok")});const o=n,a=ke(null),l=()=>{r.value=!0,vn(()=>{a.value.refresh()})},u=h=>{i("open",h)},d=(h,v)=>{i("change",h,v)},f=()=>{r.value=!1};return e({show:l}),(h,v)=>{const y=Bn,x=yr;return G(),ae("div",null,[B(x,{open:r.value,"onUpdate:open":v[1]||(v[1]=w=>r.value=w),title:"字段详情",width:746},{footer:U(()=>[B(y,{type:"primary",onClick:f},{default:U(()=>v[2]||(v[2]=[Be("确定")])),_:1,__:[2]})]),default:U(()=>[S("div",AD,[B(er,{inputStyle:"height: 550px;",options:o.options,defaultSelectedList:o.defaultSelectedList,defaultValue:o.defaultValue,placeholder:o.placeholder,type:o.type,ref_key:"atInputRef",ref:a,onOpen:u,onChange:v[0]||(v[0]=(w,_)=>d(w,_))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},ix=_t(TD,[["__scopeId","data-v-62373f0f"]]),DD={class:"problem-optimization-form"},LD={class:"gray-block"},PD={class:"flex-block-item"},RD={class:"number-box"},ID={class:"number-slider-box"},BD={class:"number-input-box"},jD={class:"number-box"},HD={class:"number-slider-box"},$D={class:"number-input-box"},FD={class:"number-box"},zD={class:"number-box"},UD={class:"number-slider-box"},VD={class:"number-input-box"},WD={class:"space-between-box"},GD={class:"field-list-item"},qD={class:"field-label"},XD={class:"field-type"},YD={class:"diy-form-item"},KD={class:"form-content"},JD={class:"diy-form-item mt12"},ZD={class:"form-content"},QD={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=Et("getNode"),o=$r(),a=ke(null),l=Gt(()=>o.modelList),u=ke([]),d=ke([]),f=ke(!1),h=ke(),v=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0}),y=()=>{f.value=!f.value},x=(De,de)=>{v.prompt=De,v.prompt_tags=de};function w(){let De=i().getAllParentVariable();d.value=b(De)}const _=Gt(()=>d.value.filter(de=>de.node_type==5));function b(De){return De.forEach(de=>{de.typ=="node"?de.node_type==1?de.value="global":de.value=de.node_id:de.value=de.key,de.children&&de.children.length>0&&(de.children=b(de.children))}),De}const E=()=>{let De=i().getAllParentVariable();u.value=De};function k(De){if(De){let de=De.split("."),Se=de[0],me=de.filter((ve,Re)=>Re>0).join(".");return[Se,me]}return["global","question"]}const O=ke(null),N=()=>{O.value.show()},I=De=>{v.prompt="",De.prompt_type==1?v.prompt=De.markdown:v.prompt=De.prompt,vn(()=>{a.value.initData()})},T=ke(null),L=()=>{T.value.show()},H=()=>{a.value.refresh()},X=()=>{const De=JSON.stringify({llm:{...v,question_value:v.question_value.join("."),model_config_id:v.model_config_id?+v.model_config_id:v.model_config_id}});t("update-node",{...r.node,...v,node_params:De})},V=()=>{try{let De=r.node.dataRaw||r.node.node_params||"{}",de=JSON.parse(De).llm||{};de=JSON.parse(JSON.stringify(de));let{model_config_id:Se,use_model:me,context_pair:ve,temperature:Re,max_token:Ie,prompt:ce,prompt_tags:ue,question_value:K,enable_thinking:ie,libs_node_key:ne}=de;E(),w(),v.model_config_id=Se,v.use_model=me,v.context_pair=ve||0,v.temperature=Re,v.max_token=Ie,v.prompt=ce,v.enable_thinking=ie,v.prompt_tags=ue||[],v.libs_node_key=ne,v.question_value=k(K),!v.model_config_id&&l.value.length>0&&(v.model_config_id=l.value[0].id,v.use_model=l.value[0].children[0].name)}catch(De){}};Jt(()=>v,()=>{X()},{deep:!0});const q=De=>{De||w()},D=ke({}),W=(De,de)=>{D.value=de},$=Gt(()=>{if(!v.model_config_id)return!1;let De=v.model_config_id+"#"+v.use_model;return D.value[De]}),pe=()=>{t("close")};return Yt(()=>{V()}),(De,de)=>{const Se=Bn,me=ci,ve=Kr,Re=Jl,Ie=lo,ce=Zr,ue=ma,K=_a,ie=ya,ne=Mr,fe=Or,he=Jr,be=z1;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:pe},null,8,["title","iconName"])]),default:U(()=>[S("div",DD,[S("div",{class:"node-form-content",onMousedown:de[12]||(de[12]=nn(()=>{},["stop"]))},[B(he,{ref_key:"formRef",ref:h,layout:"vertical",model:v},{default:U(()=>[S("div",LD,[de[28]||(de[28]=S("div",{class:"gray-block-title"},"输入",-1)),B(me,{label:"LLM模型",name:"use_model"},{default:U(()=>[S("div",PD,[B(kc,{modelType:"LLM",modeName:v.use_model,"onUpdate:modeName":de[0]||(de[0]=xe=>v.use_model=xe),modeId:v.model_config_id,"onUpdate:modeId":de[1]||(de[1]=xe=>v.model_config_id=xe),onLoaded:W,style:{width:"348px"}},null,8,["modeName","modeId"]),B(Se,{onClick:y},{default:U(()=>[de[14]||(de[14]=Be("高级设置 ")),f.value?(G(),Ve(ze(Cs),{key:0})):(G(),Ve(ze(Sc),{key:1}))]),_:1,__:[14]})])]),_:1}),f.value?(G(),Ve(me,{key:0,name:"temperature"},{label:U(()=>[de[16]||(de[16]=S("span",null,"温度 ",-1)),B(ve,null,{title:U(()=>de[15]||(de[15]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",RD,[S("div",ID,[B(Ie,null,{default:U(()=>[B(Re,{class:"custom-slider",value:v.temperature,"onUpdate:value":de[2]||(de[2]=xe=>v.temperature=xe),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),S("div",BD,[B(ce,{value:v.temperature,"onUpdate:value":de[3]||(de[3]=xe=>v.temperature=xe),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):qe("",!0),f.value?(G(),Ve(me,{key:1,name:"max_token"},{label:U(()=>[de[18]||(de[18]=S("span",null,"最大token ",-1)),B(ve,null,{title:U(()=>de[17]||(de[17]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",jD,[S("div",HD,[B(Ie,null,{default:U(()=>[B(Re,{class:"custom-slider",value:v.max_token,"onUpdate:value":de[4]||(de[4]=xe=>v.max_token=xe),min:0,max:100*1024},null,8,["value"])]),_:1})]),S("div",$D,[B(ce,{value:v.max_token,"onUpdate:value":de[5]||(de[5]=xe=>v.max_token=xe),min:0,max:100*1024},null,8,["value"])])])]),_:1})):qe("",!0),f.value&&$.value?(G(),Ve(me,{key:2,name:"enable_thinking"},{label:U(()=>[de[20]||(de[20]=S("span",null,"深度思考 ",-1)),B(ve,null,{title:U(()=>de[19]||(de[19]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",FD,[B(ue,{checked:v.enable_thinking,"onUpdate:checked":de[6]||(de[6]=xe=>v.enable_thinking=xe)},null,8,["checked"])])]),_:1})):qe("",!0),B(me,{name:"context_pair"},{label:U(()=>[de[22]||(de[22]=S("span",null,"上下文数量 ",-1)),B(ve,null,{title:U(()=>de[21]||(de[21]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",zD,[S("div",UD,[B(Ie,null,{default:U(()=>[B(Re,{class:"custom-slider",value:v.context_pair,"onUpdate:value":de[7]||(de[7]=xe=>v.context_pair=xe),min:0,max:50},null,8,["value"])]),_:1})]),S("div",VD,[B(ce,{value:v.context_pair,"onUpdate:value":de[8]||(de[8]=xe=>v.context_pair=xe),min:0,max:50},null,8,["value"])])])]),_:1}),B(me,{name:"prompt",class:"width-100"},{label:U(()=>[S("div",WD,[de[24]||(de[24]=S("div",null,"提示词",-1)),B(K,{gap:8},{default:U(()=>[S("div",{class:"btn-hover-wrap",onClick:N},[B(ze(L2)),de[23]||(de[23]=Be("从提示词库导入 "))]),S("div",{class:"btn-hover-wrap",onClick:L},[B(ze(Rv))])]),_:1})])]),default:U(()=>[B(er,{type:"textarea",inputStyle:"height: 100px;",options:u.value,defaultSelectedList:v.prompt_tags,defaultValue:v.prompt,ref_key:"atInputRef",ref:a,onOpen:E,onChange:de[9]||(de[9]=(xe,Ze)=>x(xe,Ze)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:U(({label:xe,payload:Ze})=>[S("div",GD,[S("div",qD,Ae(xe),1),S("div",XD,Ae(Ze.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),de[25]||(de[25]=S("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[25]}),S("div",YD,[de[26]||(de[26]=S("div",{class:"form-label"},"用户问题",-1)),S("div",KD,[B(ie,{value:v.question_value,"onUpdate:value":de[10]||(de[10]=xe=>v.question_value=xe),onDropdownVisibleChange:q,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:xe})=>xe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),S("div",JD,[de[27]||(de[27]=S("div",{class:"form-label"},"知识库引用",-1)),S("div",ZD,[B(fe,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:q,value:v.libs_node_key,"onUpdate:value":de[11]||(de[11]=xe=>v.libs_node_key=xe),style:{width:"220px"}},{default:U(()=>[(G(!0),ae(rt,null,gt(_.value,xe=>(G(),Ve(ne,{value:xe.node_id,key:xe.node_id},{default:U(()=>[Be(Ae(xe.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),de[29]||(de[29]=S("div",{class:"gray-block mt16"},[S("div",{class:"gray-block-title"},"输出"),S("div",{class:"options-item"},[S("div",{class:"option-label"},"AI回复内容"),S("div",{class:"option-type"},"string")])],-1))]),_:1,__:[29]},8,["model"])],32),B(be,{onOk:I,ref_key:"importPromptRef",ref:O},null,512),B(ix,{options:u.value,defaultSelectedList:v.prompt_tags,defaultValue:v.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:E,onChange:de[13]||(de[13]=(xe,Ze)=>x(xe,Ze)),onOk:H,ref_key:"fullAtInputRef",ref:T},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},eL=_t(QD,[["__scopeId","data-v-2f503b31"]]),Os="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Po=E2("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(n=>{this.formListQueue.push(n)});this.formListLoading=!0;try{const n=await pN();this.formList=n.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(n){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:n}){if(this.formFieldListMap[n]&&this.formFieldListMap[n].length>0)return[...this.formFieldListMap[n]];if(this.formFieldListLoadingMap[n])return new Promise(e=>{this.formFieldListQueueMap[n]||(this.formFieldListQueueMap[n]=[]),this.formFieldListQueueMap[n].push(e)});this.formFieldListLoadingMap[n]=!0;try{const e=await hN({form_id:n});this.formFieldListMap[n]=e.data||[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(r=>r(t)),this.formFieldListQueueMap[n]=[]),t}catch(e){this.formFieldListMap[n]=[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(r=>r(t)),this.formFieldListQueueMap[n]=[]),t}finally{this.formFieldListLoadingMap[n]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:n}){return this.formFieldListMap[n]=[],this.formFieldListLoadingMap[n]=!1,this.formFieldListQueueMap[n]=[],await this.getFormFieldList({form_id:n})}}}),tL={class:"field-select-box"},nL={key:0,class:"field-list-box"},rL={key:1,class:"empty-box"},iL={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const r=t,i=Po(),o=qt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),a=ke([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),l=ke([]),u=(x,w)=>{o.selectedRowKeys=x,o.selectedRows=w},d=({formId:x,selectedRowKeys:w,selectedRows:_})=>{o.formId=x,o.selectedRowKeys=w,o.selectedRows=_,y(),o.show=!0},f=()=>{window.open("/#/database/details/field-manage?form_id="+o.formId)},h=()=>{r("ok",o.selectedRowKeys,o.selectedRows),o.show=!1},v=ke(!1),y=()=>{v.value=!0,i.getFormFieldList({form_id:o.formId}).then(x=>{v.value=!1,x.forEach(w=>{w.value="",w.id=w.id*1}),l.value=x}).catch(()=>{v.value=!1})};return e({open:d}),(x,w)=>{const _=A1,b=yr;return G(),Ve(b,{width:"746px",open:o.show,"onUpdate:open":w[0]||(w[0]=E=>o.show=E),title:"关联数据表",onOk:h,"ok-text":"确定","cancel-text":"取消"},{default:U(()=>[S("div",tL,[l.value.length?(G(),ae("div",nL,[B(_,{rowKey:"name","row-selection":{selectedRowKeys:o.selectedRowKeys,onChange:u},dataSource:l.value,columns:a.value,loading:v.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):qe("",!0),l.value.length?qe("",!0):(G(),ae("div",rL,[w[2]||(w[2]=S("img",{src:Hv,alt:""},null,-1)),S("div",null,[w[1]||(w[1]=Be(" 暂无字段, 请先去数据表添加 ")),S("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},oL=_t(iL,[["__scopeId","data-v-226c889a"]]),aL={class:"field-list"},sL={class:"field-list-row"},lL={key:0,class:"field-list-col field-list-col-head field-value-head"},uL={key:1,class:"field-list-col field-list-col-head field-del-head"},dL={key:0,class:"field-list-row"},cL={class:"field-list-col field-value-col"},fL={class:"field-list-col field-name-col"},hL={class:"field-list-col field-type-col"},pL={key:0,class:"field-list-col field-value-col"},vL={key:1,class:"field-list-col field-del-col"},gL=["onClick"],mL={key:0,class:"add-btn-box"},yL={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,r=n,i=Et("getNode"),o=qt({list:r.list});Jt(()=>r.list,w=>{o.list=w});const a=ke([]),l=()=>{let w=i().getAllParentVariable();a.value=w||[]},u=()=>{l()},d=(w,_,b,E)=>{o.list[E].value=w,o.list[E].atTags=_,v()},f=(w,_)=>{o.list=[..._],v()},h=w=>{o.list.splice(w,1),v()},v=()=>{t("change",[...o.list])},y=ke(),x=()=>{y.value.open({formId:r.formId,selectedRows:r.list,selectedRowKeys:r.list.map(w=>w.name)})};return Yt(()=>{l()}),(w,_)=>{const b=dr,E=Kr,k=Fr,O=Bn;return G(),ae("div",null,[S("div",aL,[S("div",sL,[_[0]||(_[0]=S("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),_[1]||(_[1]=S("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(G(),ae("div",lL,"字段值")):qe("",!0),r.showDelete?(G(),ae("div",uL)):qe("",!0)]),n.showEmptyFieldRow?(G(),ae("div",dL,[_[2]||(_[2]=S("div",{class:"field-list-col field-name-col"},"--",-1)),_[3]||(_[3]=S("div",{class:"field-list-col field-type-col"},"--",-1)),S("div",cL,[B(E,{title:"请先选择数据库"},{default:U(()=>[B(b,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):qe("",!0),(G(!0),ae(rt,null,gt(o.list,(N,I)=>(G(),ae("div",{class:"field-list-row",key:N.name},[S("div",fL,Ae(N.name),1),S("div",hL,Ae(N.type),1),n.showInput?(G(),ae("div",pL,[B(er,{options:a.value,defaultValue:N.value,defaultSelectedList:N.atTags,onOpen:u,onChange:(T,L)=>d(T,L,N,I),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):qe("",!0),r.showDelete?(G(),ae("div",vL,[S("span",{class:"del-btn",onClick:T=>h(I)},[B(k,{class:"del-icon",name:"close-circle"})],8,gL)])):qe("",!0)]))),128))]),r.showAdd?(G(),ae("div",mL,[B(O,{class:"add-btn",type:"dashed",block:"",onClick:x},{default:U(()=>[B(ze(Nn)),_[4]||(_[4]=Be(" 添加更新字段"))]),_:1,__:[4]})])):qe("",!0),B(oL,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:y,onOk:f},null,8,["formId"])])}}},Gv=_t(yL,[["__scopeId","data-v-8972aaa9"]]),_L={class:"library-checkbox-box"},bL={class:"list-box",ref:"scrollContainer"},xL={class:"library-name"},wL={class:"library-desc"},SL={key:1,class:"empty-box"},EL={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const r=t,i=n,o=ke(),a=ke(!1),l=h=>{o.value=h,a.value=!0},u=()=>{a.value=!1,d()},d=()=>{let h=i.options.filter(v=>v.id===o.value);r("ok",o.value,JSON.parse(JSON.stringify(h[0])))},f=()=>{window.open("/#/database/list")};return e({open:l}),(h,v)=>{const y=D1,x=T1,w=yr;return G(),Ve(w,{width:"746px",open:a.value,"onUpdate:open":v[1]||(v[1]=_=>a.value=_),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:u},{default:U(()=>[S("div",_L,[n.options.length?(G(),Ve(x,{key:0,value:o.value,"onUpdate:value":v[0]||(v[0]=_=>o.value=_),style:{width:"100%"}},{default:U(()=>[S("div",bL,[(G(!0),ae(rt,null,gt(i.options,_=>(G(),ae("div",{class:"list-item-wraapper",key:_.id},[B(y,{class:"list-item",value:_.id},{default:U(()=>[S("div",xL,Ae(_.name),1),S("div",wL,Ae(_.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):qe("",!0),n.options.length?qe("",!0):(G(),ae("div",SL,[v[3]||(v[3]=S("img",{src:Hv,alt:""},null,-1)),S("div",null,[v[2]||(v[2]=Be(" 暂无数据表, 请先去添加数据表 ")),S("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},CL=_t(EL,[["__scopeId","data-v-51756847"]]),kL={class:""},OL={key:0,class:"data-table-info"},ML={class:"data-table-name"},NL={class:"data-table-desc"},AL={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:e}){const t=e,r=n,i=ke(null),o=Gt(()=>{let d=r.options.filter(f=>f.id===r.value);return d.length?d[0]:null}),a=()=>{i.value.open()},l=(d,f)=>{t("update:value",d),t("change",d,f)},u=()=>{t("update:value",""),t("change","")};return(d,f)=>{const h=Fr,v=Bn;return G(),ae("div",kL,[r.value?(G(),ae("div",OL,[S("div",ML,Ae(o.value?o.value.name:r.title),1),S("div",NL,Ae(o.value?o.value.description:r.description),1),B(h,{class:"del-btn",name:"close-circle",onClick:u})])):(G(),Ve(v,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:a},{default:U(()=>[B(ze(Nn)),f[0]||(f[0]=Be(" 选择数据表"))]),_:1,__:[0]})),B(CL,{ref_key:"tableSelectAlertRef",ref:i,onOk:l,options:n.options},null,8,["options"])])}}},Mc=_t(AL,[["__scopeId","data-v-618f643f"]]),TL={class:"add-data-form"},DL={class:"node-box-content"},LL={class:"setting-box"},PL={class:"setting-box"},RL={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=Po();let o={};const a=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=(y,x)=>{x?(a.formData.form_name=x.name,a.formData.form_description=x.description,v(x.id)):(a.formData.form_name="",a.formData.form_description="",a.formData.datas=[]),f()},u=y=>{a.formData.datas=y,f()},d=()=>{let y=r.node.dataRaw||r.node.node_params||"{}";o=JSON.parse(y),a.formData=o.form_insert,f()},f=()=>{o.form_insert=Ki(a.formData),t("update-node",{...r.node,node_params:JSON.stringify(o)})},h=async()=>{const y=await i.getFormList();a.tableList=y},v=async y=>{i.getFormFieldList({form_id:y}).then(x=>{x.forEach(w=>{w.id=w.id*1}),a.formData.datas=x,f()}).catch(()=>{})};return Yt(()=>{h(),d()}),(y,x)=>(G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:U(()=>x[1]||(x[1]=[S("span",null,[Be("在指定数据表中插入数据，可以在数据库中维护数据表 "),S("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[S("div",TL,[S("div",DL,[x[2]||(x[2]=S("div",{class:"node-box-title"},[S("img",{class:"input-icon",src:Os,alt:""}),S("span",{class:"text"},"输入")],-1)),x[3]||(x[3]=S("div",{class:"setting-label"},[S("span",null,"数据表")],-1)),S("div",LL,[B(Mc,{options:a.tableList,title:a.formData.form_name,description:a.formData.form_description,value:a.formData.form_id,"onUpdate:value":x[0]||(x[0]=w=>a.formData.form_id=w),onChange:l},null,8,["options","title","description","value"])]),x[4]||(x[4]=S("div",{class:"setting-label"},[S("span",null,"插入数据"),S("span",{class:"tip"},"（不填写字段值则为空）")],-1)),S("div",PL,[B(Gv,{"form-id":a.formData.form_id,showEmptyFieldRow:a.formData.form_id=="",list:a.formData.datas,showAdd:!1,showDelete:!1,onChange:u},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},IL=_t(RL,[["__scopeId","data-v-9c25c5a9"]]),BL={class:"library-checkbox-box"},jL={class:"list-tools"},HL={class:"list-box",ref:"scrollContainer"},$L={class:"library-name"},FL={class:"library-desc"},zL={__name:"library-select-alert",emits:["change","close"],setup(n,{expose:e,emit:t}){const r=t,i=qt({indeterminate:!1,checkAll:!1,checkedList:[]}),o=ke(!1),a=b=>{v(),i.checkedList=b,o.value=!0},l=()=>{o.value=!1,h()},u=ke(""),d=()=>{v()},f=ke([]),h=()=>{r("change",[...i.checkedList])},v=async()=>{const b=await Pv({library_name:u.value,type:""});if(b){let E=b.data||[];f.value=E}},y=ke(!1),x=async()=>{y.value=!0,await v(),y.value=!1,Cn.success("刷新完成")},w=()=>{window.open("/#/library/add")},_=()=>{r("close")};return e({open:a}),(b,E)=>{const k=dr,O=Bn,N=L1,I=I2,T=Ec,L=yr;return G(),Ve(L,{width:"746px",open:o.value,"onUpdate:open":E[2]||(E[2]=H=>o.value=H),title:"关联知识库",onCancel:_,onOk:l,okText:"确定",cancelText:"取消"},{default:U(()=>[S("div",BL,[S("div",jL,[S("div",null,[B(k,{style:{width:"282px"},value:u.value,"onUpdate:value":E[0]||(E[0]=H=>u.value=H),placeholder:"请输入知识库名称搜索",onChange:d},{suffix:U(()=>[B(ze(P2),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),S("div",null,[B(O,{style:{"margin-right":"8px"},onClick:x},{default:U(()=>[B(ze(R2)),E[3]||(E[3]=Be(" 刷新 "))]),_:1,__:[3]}),B(O,{type:"primary",ghost:"",onClick:w},{default:U(()=>E[4]||(E[4]=[Be("新建知识库")])),_:1,__:[4]})])]),B(T,{spinning:y.value,delay:100},{default:U(()=>[B(I,{value:i.checkedList,"onUpdate:value":E[1]||(E[1]=H=>i.checkedList=H),style:{width:"100%"}},{default:U(()=>[S("div",HL,[(G(!0),ae(rt,null,gt(f.value,H=>(G(),ae("div",{class:"list-item-wraapper",key:H.id},[B(N,{class:"list-item",value:H.id},{default:U(()=>[S("div",$L,Ae(H.library_name),1),S("div",FL,Ae(H.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},UL=_t(zL,[["__scopeId","data-v-ae6d969c"]]),VL={class:"recall-settings-box"},WL={class:"form-box"},GL={class:"form-item is-required"},qL={class:"form-item-body"},XL={class:"retrieval-mode-items"},YL=["onClick"],KL={class:"retrieval-mode-title"},JL={class:"title-text"},ZL={class:"retrieval-mode-desc"},QL={class:"form-item"},eP={class:"form-item-label"},tP={class:"form-item-body"},nP={class:"number-box"},rP={class:"number-slider-box"},iP={class:"number-input-box"},oP={class:"form-item"},aP={class:"form-item-label"},sP={class:"form-item-body"},lP={class:"number-box"},uP={class:"number-slider-box"},dP={class:"number-input-box"},cP={class:"form-item"},fP={class:"form-item-label"},hP={class:"form-item-body"},pP=["src"],vP={__name:"recall-settings-alert",emits:["change"],setup(n,{expose:e,emit:t}){const r=t,i=ke([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=qt({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),a=ke(!1),l=w=>{x(),o.rerank_status=w.rerank_status||0,o.rerank_use_model=w.rerank_use_model||void 0,o.rerank_model_config_id=w.rerank_model_config_id||"",o.top_k=w.top_k,o.similarity=w.similarity,o.search_type=w.search_type,a.value=!0},u=(w,_)=>{o.rerank_model_config_id=_.rerank_model_config_id},d=w=>{o.search_type=w},f=()=>o.rerank_status==1&&!o.rerank_model_config_id,h=()=>{if(f())return Cn.error("请选择Rerank模型");a.value=!1,v()},v=()=>{r("change",Ki(o))},y=ke([]),x=()=>{U1({model_type:"RERANK"}).then(w=>{let _=w.data||[];y.value=_.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})};return e({open:l}),(w,_)=>{const b=Fr,E=Kr,k=Jl,O=Zr,N=ma,I=_a,T=Mr,L=B2,H=Or,X=yr;return G(),Ve(X,{width:"472px",open:a.value,"onUpdate:open":_[6]||(_[6]=V=>a.value=V),title:"召回设置",onOk:h,okText:"确定",cancelText:"取消"},{default:U(()=>[S("div",VL,[S("div",WL,[S("div",GL,[_[7]||(_[7]=S("div",{class:"form-item-label"},[S("span",null,"检索模式")],-1)),S("div",qL,[S("div",XL,[(G(!0),ae(rt,null,gt(i.value,V=>(G(),ae("div",{class:dn(["retrieval-mode-item",{active:o.search_type==V.value}]),key:V.value,onClick:q=>d(V.value)},[o.search_type==V.value?(G(),Ve(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):qe("",!0),S("div",KL,[B(b,{name:V.iconName,class:"title-icon"},null,8,["name"]),S("span",JL,Ae(V.title),1),V.isRecommendation?(G(),Ve(b,{key:0,class:"recommendation-icon",name:"recommendation"})):qe("",!0)]),S("div",ZL,Ae(V.desc),1)],10,YL))),128))])])]),S("div",QL,[S("div",eP,[_[9]||(_[9]=S("span",null,"Top K ",-1)),B(E,null,{title:U(()=>_[8]||(_[8]=[Be("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),S("div",tP,[S("div",nP,[S("div",rP,[B(k,{class:"custom-slider",value:o.top_k,"onUpdate:value":_[0]||(_[0]=V=>o.top_k=V),min:1,max:10},null,8,["value"])]),S("div",iP,[B(O,{value:o.top_k,"onUpdate:value":_[1]||(_[1]=V=>o.top_k=V),min:1,max:10},null,8,["value"])])])])]),S("div",oP,[S("div",aP,[_[11]||(_[11]=S("span",null,"相似度阈值 ",-1)),B(E,null,{title:U(()=>_[10]||(_[10]=[Be("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),S("div",sP,[S("div",lP,[S("div",uP,[B(k,{class:"custom-slider",value:o.similarity,"onUpdate:value":_[2]||(_[2]=V=>o.similarity=V),min:0,max:1,step:.01},null,8,["value"])]),S("div",dP,[B(O,{value:o.similarity,"onUpdate:value":_[3]||(_[3]=V=>o.similarity=V),min:0,max:1,step:.01},null,8,["value"])])])])]),S("div",cP,[S("div",fP,[_[12]||(_[12]=S("span",null,"Rerank模型",-1)),_[13]||(_[13]=Be("   ")),B(N,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":_[4]||(_[4]=V=>o.rerank_status=V)},null,8,["checked"])]),S("div",hP,[B(H,{value:o.rerank_use_model,"onUpdate:value":_[5]||(_[5]=V=>o.rerank_use_model=V),placeholder:"请选择Rerank模型",onChange:u,style:{width:"320px"}},{default:U(()=>[(G(!0),ae(rt,null,gt(y.value,V=>(G(),Ve(L,{key:V.id},{label:U(()=>[B(I,{align:"center",gap:8},{default:U(()=>[S("img",{class:"model-icon",src:V.icon,alt:""},null,8,pP),Be(Ae(V.name),1)]),_:2},1024)]),default:U(()=>[(G(!0),ae(rt,null,gt(V.children,q=>(G(),Ve(T,{value:q,rerank_model_config_id:V.id,key:q},{default:U(()=>[S("span",null,Ae(q),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},gP=_t(vP,[["__scopeId","data-v-56081df4"]]),mP={class:"problem-optimization-form"},yP={class:"node-form-content"},_P={class:"gray-block"},bP={class:"avatar-box"},xP=["src"],wP={class:"content-box"},SP={class:"list-name"},EP={class:"list-intro"},CP=["onClick"],kP={class:"btn-block"},OP={class:"diy-form-item"},MP={class:"form-content"},NP={class:"form-content"},AP={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=ke([]);function o(){const L=r.lf.getNodeModelById(r.nodeId);if(L){let H=L.getAllParentVariable();i.value=a(H)}}function a(L){return L.forEach(H=>{H.typ=="node"?H.node_type==1?H.value="global":H.value=H.node_id:H.value=H.key,H.children&&H.children.length>0&&(H.children=a(H.children))}),L}function l(L){if(L){let H=L.split("."),X=H[0],V=H.filter((q,D)=>D>0).join(".");return[X,V]}return["global","question"]}const u=ke(),d=qt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:""}),f=()=>{const L=JSON.stringify({libs:{...d,rerank_model_config_id:d.rerank_model_config_id?+d.rerank_model_config_id:void 0,question_value:d.question_value.join("."),library_ids:d.library_ids.join(",")}});t("update-node",{...r.node,...d,node_params:L})},h=()=>{try{let L=r.node.dataRaw||r.node.node_params||"{}",H=JSON.parse(L).libs||{};o(),H=JSON.parse(JSON.stringify(H));for(let X in H)X=="library_ids"?d[X]=H[X]?H[X].split(","):[]:X=="question_value"?d.question_value=l(H.question_value):d[X]=H[X]}catch(L){}},v=ke([]),y=ke(null),x=Gt(()=>v.value.filter(L=>d.library_ids.includes(L.id))),w=L=>{let H=d.library_ids.indexOf(L.id);d.library_ids.splice(H,1)},_=L=>{N(),d.library_ids=[...L]},b=()=>{y.value.open([...d.library_ids])},E=ke(null),k=()=>{E.value.open(Ki(d))},O=L=>{d.rerank_status=L.rerank_status,d.rerank_use_model=L.rerank_use_model,d.rerank_model_config_id=L.rerank_model_config_id,d.top_k=L.top_k,d.similarity=L.similarity,d.search_type=L.search_type},N=async()=>{const L=await Pv({type:""});L&&(v.value=L.data||[])};Jt(()=>d,()=>{f()},{deep:!0});const I=L=>{L||o()},T=()=>{t("close")};return Yt(()=>{h(),N()}),(L,H)=>{const X=Bn,V=ci,q=ya,D=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:T},null,8,["title","iconName"])]),default:U(()=>[S("div",mP,[S("div",yP,[B(D,{ref_key:"formRef",ref:u,layout:"vertical",model:d},{default:U(()=>[S("div",_P,[H[4]||(H[4]=S("div",{class:"gray-block-title"},"输入",-1)),B(V,{label:"关联知识库"},{default:U(()=>[(G(!0),ae(rt,null,gt(x.value,W=>(G(),ae("div",{class:"konwledge-list-item",key:W.id},[S("div",bP,[S("img",{src:W.avatar,alt:""},null,8,xP)]),S("div",wP,[S("div",SP,Ae(W.library_name),1),S("div",EP,Ae(W.library_intro),1)]),S("div",{class:"btn-hover-wrap",onClick:$=>w(W)},[B(ze(Jn))],8,CP)]))),128)),S("div",kP,[S("div",null,[B(X,{onClick:b,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>H[1]||(H[1]=[Be("添加知识库")])),_:1,__:[1]},8,["icon"])]),S("div",null,[B(X,{onClick:k,icon:pn(ze(j2)),block:"",type:"dashed"},{default:U(()=>H[2]||(H[2]=[Be("召回设置")])),_:1,__:[2]},8,["icon"])])])]),_:1}),S("div",OP,[H[3]||(H[3]=S("div",{class:"form-label"},"用户问题",-1)),S("div",MP,[S("div",NP,[B(q,{value:d.question_value,"onUpdate:value":H[0]||(H[0]=W=>d.question_value=W),onDropdownVisibleChange:I,style:{width:"220px"},options:i.value,allowClear:!1,displayRender:({labels:W})=>W.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),H[5]||(H[5]=S("div",{class:"gray-block mt16"},[S("div",{class:"gray-block-title"},"输出"),S("div",{class:"options-item"},[S("div",{class:"option-label"},"知识库引用"),S("div",{class:"option-type"},"string")])],-1))]),_:1,__:[5]},8,["model"]),B(UL,{ref_key:"librarySelectAlertRef",ref:y,onClose:N,onChange:_},null,512),B(gP,{ref_key:"recallSettingsAlertRef",ref:E,onChange:O},null,512)])])]),_:1})}}},TP=_t(AP,[["__scopeId","data-v-711d67f3"]]),us="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%20class='design-iconfont'%3e%3cpath%20d='M10%200V16M10%2032V16M10%2016H23'%20stroke='%23BFBFBF'%20stroke-linejoin='round'/%3e%3c/svg%3e",DP={class:"sub-field-item"},LP=["onClick"],PP=["onClick"],RP={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Gt(()=>e.level>2?e.typOptions.filter(u=>u.value!="object"):e.typOptions),r=Gt(()=>e.level==2?"180px":"146px"),i=(u,d)=>{d[u].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(u,d)=>{d.splice(u,1)},a=u=>{u.subs=[]},l=u=>u.typ=="object"&&e.level<=2;return(u,d)=>{const f=dr,h=Mr,v=Or,y=Sn("SubsKey",!0);return G(!0),ae(rt,null,gt(e.data,(x,w)=>(G(),ae("div",{class:dn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:x.cu_key},[S("div",DP,[d[0]||(d[0]=S("img",{class:"fork-icon",src:us,alt:""},null,-1)),B(f,{class:"mr12",style:Ti({width:r.value}),value:x.key,"onUpdate:value":_=>x.key=_,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=S("img",{class:"fork-icon",src:us,alt:""},null,-1)),B(v,{class:"mr12",onChange:_=>a(x),value:x.typ,"onUpdate:value":_=>x.typ=_,placeholder:"请选择",style:Ti({width:r.value})},{default:U(()=>[(G(!0),ae(rt,null,gt(t.value,_=>(G(),Ve(h,{value:_.value},{default:U(()=>[Be(Ae(_.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(x)?(G(),ae("div",{key:0,class:"btn-hover-wrap mr12",onClick:_=>i(w,e.data)},[B(ze(ba))],8,LP)):qe("",!0),S("div",{class:"btn-hover-wrap",onClick:_=>o(w,e.data)},[B(ze(Jn))],8,PP)]),x.subs&&x.subs.length>0?(G(),Ve(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:x.subs},null,8,["level","typOptions","data"])):qe("",!0)],2))),128)}}},IP=_t(RP,[["__scopeId","data-v-01969e8c"]]);var _y={exports:{}},fd={exports:{}},BP=fd.exports,by;function Ro(){return by||(by=1,function(n,e){(function(t,r){n.exports=r()})(BP,function(){var t=navigator.userAgent,r=navigator.platform,i=/gecko\/\d/i.test(t),o=/MSIE \d/.test(t),a=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),l=/Edge\/(\d+)/.exec(t),u=o||a||l,d=u&&(o?document.documentMode||6:+(l||a)[1]),f=!l&&/WebKit\//.test(t),h=f&&/Qt\/\d+\.\d+/.test(t),v=!l&&/Chrome\/(\d+)/.exec(t),y=v&&+v[1],x=/Opera\//.test(t),w=/Apple Computer/.test(navigator.vendor),_=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),b=/PhantomJS/.test(t),E=w&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),k=/Android/.test(t),O=E||k||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),N=E||/Mac/.test(r),I=/\bCrOS\b/.test(t),T=/win/i.test(r),L=x&&t.match(/Version\/(\d*\.\d*)/);L&&(L=Number(L[1])),L&&L>=15&&(x=!1,f=!0);var H=N&&(h||x&&(L==null||L<12.11)),X=i||u&&d>=9;function V(s){return new RegExp("(^|\\s)"+s+"(?:$|\\s)\\s*")}var q=function(s,c){var g=s.className,p=V(c).exec(g);if(p){var m=g.slice(p.index+p[0].length);s.className=g.slice(0,p.index)+(m?p[1]+m:"")}};function D(s){for(var c=s.childNodes.length;c>0;--c)s.removeChild(s.firstChild);return s}function W(s,c){return D(s).appendChild(c)}function $(s,c,g,p){var m=document.createElement(s);if(g&&(m.className=g),p&&(m.style.cssText=p),typeof c=="string")m.appendChild(document.createTextNode(c));else if(c)for(var C=0;C<c.length;++C)m.appendChild(c[C]);return m}function pe(s,c,g,p){var m=$(s,c,g,p);return m.setAttribute("role","presentation"),m}var De;document.createRange?De=function(s,c,g,p){var m=document.createRange();return m.setEnd(p||s,g),m.setStart(s,c),m}:De=function(s,c,g){var p=document.body.createTextRange();try{p.moveToElementText(s.parentNode)}catch{return p}return p.collapse(!0),p.moveEnd("character",g),p.moveStart("character",c),p};function de(s,c){if(c.nodeType==3&&(c=c.parentNode),s.contains)return s.contains(c);do if(c.nodeType==11&&(c=c.host),c==s)return!0;while(c=c.parentNode)}function Se(s){var c=s.ownerDocument||s,g;try{g=s.activeElement}catch{g=c.body||null}for(;g&&g.shadowRoot&&g.shadowRoot.activeElement;)g=g.shadowRoot.activeElement;return g}function me(s,c){var g=s.className;V(c).test(g)||(s.className+=(g?" ":"")+c)}function ve(s,c){for(var g=s.split(" "),p=0;p<g.length;p++)g[p]&&!V(g[p]).test(c)&&(c+=" "+g[p]);return c}var Re=function(s){s.select()};E?Re=function(s){s.selectionStart=0,s.selectionEnd=s.value.length}:u&&(Re=function(s){try{s.select()}catch{}});function Ie(s){return s.display.wrapper.ownerDocument}function ce(s){return ue(s.display.wrapper)}function ue(s){return s.getRootNode?s.getRootNode():s.ownerDocument}function K(s){return Ie(s).defaultView}function ie(s){var c=Array.prototype.slice.call(arguments,1);return function(){return s.apply(null,c)}}function ne(s,c,g){c||(c={});for(var p in s)s.hasOwnProperty(p)&&(g!==!1||!c.hasOwnProperty(p))&&(c[p]=s[p]);return c}function fe(s,c,g,p,m){c==null&&(c=s.search(/[^\s\u00a0]/),c==-1&&(c=s.length));for(var C=p||0,M=m||0;;){var R=s.indexOf("	",C);if(R<0||R>=c)return M+(c-C);M+=R-C,M+=g-M%g,C=R+1}}var he=function(){this.id=null,this.f=null,this.time=0,this.handler=ie(this.onTimeout,this)};he.prototype.onTimeout=function(s){s.id=0,s.time<=+new Date?s.f():setTimeout(s.handler,s.time-+new Date)},he.prototype.set=function(s,c){this.f=c;var g=+new Date+s;(!this.id||g<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,s),this.time=g)};function be(s,c){for(var g=0;g<s.length;++g)if(s[g]==c)return g;return-1}var xe=50,Ze={toString:function(){return"CodeMirror.Pass"}},We={scroll:!1},St={origin:"*mouse"},pt={origin:"+move"};function Ht(s,c,g){for(var p=0,m=0;;){var C=s.indexOf("	",p);C==-1&&(C=s.length);var M=C-p;if(C==s.length||m+M>=c)return p+Math.min(M,c-m);if(m+=C-p,m+=g-m%g,p=C+1,m>=c)return p}}var Qt=[""];function te(s){for(;Qt.length<=s;)Qt.push(A(Qt)+" ");return Qt[s]}function A(s){return s[s.length-1]}function F(s,c){for(var g=[],p=0;p<s.length;p++)g[p]=c(s[p],p);return g}function Z(s,c,g){for(var p=0,m=g(c);p<s.length&&g(s[p])<=m;)p++;s.splice(p,0,c)}function J(){}function se(s,c){var g;return Object.create?g=Object.create(s):(J.prototype=s,g=new J),c&&ne(c,g),g}var oe=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ge(s){return/\w/.test(s)||s>""&&(s.toUpperCase()!=s.toLowerCase()||oe.test(s))}function Te(s,c){return c?c.source.indexOf("\\w")>-1&&ge(s)?!0:c.test(s):ge(s)}function Le(s){for(var c in s)if(s.hasOwnProperty(c)&&s[c])return!1;return!0}var Ue=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function tt(s){return s.charCodeAt(0)>=768&&Ue.test(s)}function vt(s,c,g){for(;(g<0?c>0:c<s.length)&&tt(s.charAt(c));)c+=g;return c}function bt(s,c,g){for(var p=c>g?-1:1;;){if(c==g)return c;var m=(c+g)/2,C=p<0?Math.ceil(m):Math.floor(m);if(C==c)return s(C)?c:g;s(C)?g=C:c=C+p}}function Lt(s,c,g,p){if(!s)return p(c,g,"ltr",0);for(var m=!1,C=0;C<s.length;++C){var M=s[C];(M.from<g&&M.to>c||c==g&&M.to==c)&&(p(Math.max(M.from,c),Math.min(M.to,g),M.level==1?"rtl":"ltr",C),m=!0)}m||p(c,g,"ltr")}var Qe=null;function ht(s,c,g){var p;Qe=null;for(var m=0;m<s.length;++m){var C=s[m];if(C.from<c&&C.to>c)return m;C.to==c&&(C.from!=C.to&&g=="before"?p=m:Qe=m),C.from==c&&(C.from!=C.to&&g!="before"?p=m:Qe=m)}return p??Qe}var Rt=function(){var s="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",c="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function g(z){return z<=247?s.charAt(z):1424<=z&&z<=1524?"R":1536<=z&&z<=1785?c.charAt(z-1536):1774<=z&&z<=2220?"r":8192<=z&&z<=8203?"w":z==8204?"b":"L"}var p=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,m=/[stwN]/,C=/[LRr]/,M=/[Lb1n]/,R=/[1n]/;function j(z,re,le){this.level=z,this.from=re,this.to=le}return function(z,re){var le=re=="ltr"?"L":"R";if(z.length==0||re=="ltr"&&!p.test(z))return!1;for(var Ce=z.length,_e=[],Fe=0;Fe<Ce;++Fe)_e.push(g(z.charCodeAt(Fe)));for(var Ge=0,nt=le;Ge<Ce;++Ge){var ut=_e[Ge];ut=="m"?_e[Ge]=nt:nt=ut}for(var yt=0,dt=le;yt<Ce;++yt){var xt=_e[yt];xt=="1"&&dt=="r"?_e[yt]="n":C.test(xt)&&(dt=xt,xt=="r"&&(_e[yt]="R"))}for(var At=1,Nt=_e[0];At<Ce-1;++At){var Vt=_e[At];Vt=="+"&&Nt=="1"&&_e[At+1]=="1"?_e[At]="1":Vt==","&&Nt==_e[At+1]&&(Nt=="1"||Nt=="n")&&(_e[At]=Nt),Nt=Vt}for(var gn=0;gn<Ce;++gn){var Xn=_e[gn];if(Xn==",")_e[gn]="N";else if(Xn=="%"){var En=void 0;for(En=gn+1;En<Ce&&_e[En]=="%";++En);for(var Br=gn&&_e[gn-1]=="!"||En<Ce&&_e[En]=="1"?"1":"N",xr=gn;xr<En;++xr)_e[xr]=Br;gn=En-1}}for(var jn=0,wr=le;jn<Ce;++jn){var Zn=_e[jn];wr=="L"&&Zn=="1"?_e[jn]="L":C.test(Zn)&&(wr=Zn)}for(var Fn=0;Fn<Ce;++Fn)if(m.test(_e[Fn])){var Hn=void 0;for(Hn=Fn+1;Hn<Ce&&m.test(_e[Hn]);++Hn);for(var Mn=(Fn?_e[Fn-1]:le)=="L",Sr=(Hn<Ce?_e[Hn]:le)=="L",$a=Mn==Sr?Mn?"L":"R":le,bo=Fn;bo<Hn;++bo)_e[bo]=$a;Fn=Hn-1}for(var or=[],Hi,Yn=0;Yn<Ce;)if(M.test(_e[Yn])){var Rf=Yn;for(++Yn;Yn<Ce&&M.test(_e[Yn]);++Yn);or.push(new j(0,Rf,Yn))}else{var ro=Yn,Xo=or.length,Yo=re=="rtl"?1:0;for(++Yn;Yn<Ce&&_e[Yn]!="L";++Yn);for(var pr=ro;pr<Yn;)if(R.test(_e[pr])){ro<pr&&(or.splice(Xo,0,new j(1,ro,pr)),Xo+=Yo);var Fa=pr;for(++pr;pr<Yn&&R.test(_e[pr]);++pr);or.splice(Xo,0,new j(2,Fa,pr)),Xo+=Yo,ro=pr}else++pr;ro<Yn&&or.splice(Xo,0,new j(1,ro,Yn))}return re=="ltr"&&(or[0].level==1&&(Hi=z.match(/^\s+/))&&(or[0].from=Hi[0].length,or.unshift(new j(0,0,Hi[0].length))),A(or).level==1&&(Hi=z.match(/\s+$/))&&(A(or).to-=Hi[0].length,or.push(new j(0,Ce-Hi[0].length,Ce)))),re=="rtl"?or.reverse():or}}();function st(s,c){var g=s.order;return g==null&&(g=s.order=Rt(s.text,c)),g}var cn=[],Ne=function(s,c,g){if(s.addEventListener)s.addEventListener(c,g,!1);else if(s.attachEvent)s.attachEvent("on"+c,g);else{var p=s._handlers||(s._handlers={});p[c]=(p[c]||cn).concat(g)}};function it(s,c){return s._handlers&&s._handlers[c]||cn}function ct(s,c,g){if(s.removeEventListener)s.removeEventListener(c,g,!1);else if(s.detachEvent)s.detachEvent("on"+c,g);else{var p=s._handlers,m=p&&p[c];if(m){var C=be(m,g);C>-1&&(p[c]=m.slice(0,C).concat(m.slice(C+1)))}}}function Xe(s,c){var g=it(s,c);if(g.length)for(var p=Array.prototype.slice.call(arguments,2),m=0;m<g.length;++m)g[m].apply(null,p)}function et(s,c,g){return typeof c=="string"&&(c={type:c,preventDefault:function(){this.defaultPrevented=!0}}),Xe(s,g||c.type,s,c),Ft(c)||c.codemirrorIgnore}function lt(s){var c=s._handlers&&s._handlers.cursorActivity;if(c)for(var g=s.curOp.cursorActivityHandlers||(s.curOp.cursorActivityHandlers=[]),p=0;p<c.length;++p)be(g,c[p])==-1&&g.push(c[p])}function we(s,c){return it(s,c).length>0}function Je(s){s.prototype.on=function(c,g){Ne(this,c,g)},s.prototype.off=function(c,g){ct(this,c,g)}}function ft(s){s.preventDefault?s.preventDefault():s.returnValue=!1}function Ct(s){s.stopPropagation?s.stopPropagation():s.cancelBubble=!0}function Ft(s){return s.defaultPrevented!=null?s.defaultPrevented:s.returnValue==!1}function Kt(s){ft(s),Ct(s)}function rr(s){return s.target||s.srcElement}function bn(s){var c=s.which;return c==null&&(s.button&1?c=1:s.button&2?c=3:s.button&4&&(c=2)),N&&s.ctrlKey&&c==1&&(c=3),c}var Un=function(){if(u&&d<9)return!1;var s=$("div");return"draggable"in s||"dragDrop"in s}(),Qr;function ei(s){if(Qr==null){var c=$("span","​");W(s,$("span",[c,document.createTextNode("x")])),s.firstChild.offsetHeight!=0&&(Qr=c.offsetWidth<=1&&c.offsetHeight>2&&!(u&&d<8))}var g=Qr?$("span","​"):$("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return g.setAttribute("cm-text",""),g}var en;function Tr(s){if(en!=null)return en;var c=W(s,document.createTextNode("AخA")),g=De(c,0,1).getBoundingClientRect(),p=De(c,1,2).getBoundingClientRect();return D(s),!g||g.left==g.right?!1:en=p.right-g.right<3}var Pn=`

b`.split(/\n/).length!=3?function(s){for(var c=0,g=[],p=s.length;c<=p;){var m=s.indexOf(`
`,c);m==-1&&(m=s.length);var C=s.slice(c,s.charAt(m-1)=="\r"?m-1:m),M=C.indexOf("\r");M!=-1?(g.push(C.slice(0,M)),c+=M+1):(g.push(C),c=m+1)}return g}:function(s){return s.split(/\r\n?|\n/)},Dr=window.getSelection?function(s){try{return s.selectionStart!=s.selectionEnd}catch{return!1}}:function(s){var c;try{c=s.ownerDocument.selection.createRange()}catch{}return!c||c.parentElement()!=s?!1:c.compareEndPoints("StartToEnd",c)!=0},hi=function(){var s=$("div");return"oncopy"in s?!0:(s.setAttribute("oncopy","return;"),typeof s.oncopy=="function")}(),Tt=null;function Ii(s){if(Tt!=null)return Tt;var c=W(s,$("span","x")),g=c.getBoundingClientRect(),p=De(c,0,1).getBoundingClientRect();return Tt=Math.abs(g.left-p.left)>1}var Vr={},Vn={};function cr(s,c){arguments.length>2&&(c.dependencies=Array.prototype.slice.call(arguments,2)),Vr[s]=c}function fr(s,c){Vn[s]=c}function Lr(s){if(typeof s=="string"&&Vn.hasOwnProperty(s))s=Vn[s];else if(s&&typeof s.name=="string"&&Vn.hasOwnProperty(s.name)){var c=Vn[s.name];typeof c=="string"&&(c={name:c}),s=se(c,s),s.name=c.name}else{if(typeof s=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(s))return Lr("application/xml");if(typeof s=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(s))return Lr("application/json")}return typeof s=="string"?{name:s}:s||{name:"null"}}function ti(s,c){c=Lr(c);var g=Vr[c.name];if(!g)return ti(s,"text/plain");var p=g(s,c);if(Pr.hasOwnProperty(c.name)){var m=Pr[c.name];for(var C in m)m.hasOwnProperty(C)&&(p.hasOwnProperty(C)&&(p["_"+C]=p[C]),p[C]=m[C])}if(p.name=c.name,c.helperType&&(p.helperType=c.helperType),c.modeProps)for(var M in c.modeProps)p[M]=c.modeProps[M];return p}var Pr={};function Wr(s,c){var g=Pr.hasOwnProperty(s)?Pr[s]:Pr[s]={};ne(c,g)}function Q(s,c){if(c===!0)return c;if(s.copyState)return s.copyState(c);var g={};for(var p in c){var m=c[p];m instanceof Array&&(m=m.concat([])),g[p]=m}return g}function Oe(s,c){for(var g;s.innerMode&&(g=s.innerMode(c),!(!g||g.mode==s));)c=g.state,s=g.mode;return g||{mode:s,state:c}}function Ye(s,c,g){return s.startState?s.startState(c,g):!0}var at=function(s,c,g){this.pos=this.start=0,this.string=s,this.tabSize=c||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=g};at.prototype.eol=function(){return this.pos>=this.string.length},at.prototype.sol=function(){return this.pos==this.lineStart},at.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},at.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},at.prototype.eat=function(s){var c=this.string.charAt(this.pos),g;if(typeof s=="string"?g=c==s:g=c&&(s.test?s.test(c):s(c)),g)return++this.pos,c},at.prototype.eatWhile=function(s){for(var c=this.pos;this.eat(s););return this.pos>c},at.prototype.eatSpace=function(){for(var s=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>s},at.prototype.skipToEnd=function(){this.pos=this.string.length},at.prototype.skipTo=function(s){var c=this.string.indexOf(s,this.pos);if(c>-1)return this.pos=c,!0},at.prototype.backUp=function(s){this.pos-=s},at.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=fe(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?fe(this.string,this.lineStart,this.tabSize):0)},at.prototype.indentation=function(){return fe(this.string,null,this.tabSize)-(this.lineStart?fe(this.string,this.lineStart,this.tabSize):0)},at.prototype.match=function(s,c,g){if(typeof s=="string"){var p=function(M){return g?M.toLowerCase():M},m=this.string.substr(this.pos,s.length);if(p(m)==p(s))return c!==!1&&(this.pos+=s.length),!0}else{var C=this.string.slice(this.pos).match(s);return C&&C.index>0?null:(C&&c!==!1&&(this.pos+=C[0].length),C)}},at.prototype.current=function(){return this.string.slice(this.start,this.pos)},at.prototype.hideFirstChars=function(s,c){this.lineStart+=s;try{return c()}finally{this.lineStart-=s}},at.prototype.lookAhead=function(s){var c=this.lineOracle;return c&&c.lookAhead(s)},at.prototype.baseToken=function(){var s=this.lineOracle;return s&&s.baseToken(this.pos)};function Ke(s,c){if(c-=s.first,c<0||c>=s.size)throw new Error("There is no line "+(c+s.first)+" in the document.");for(var g=s;!g.lines;)for(var p=0;;++p){var m=g.children[p],C=m.chunkSize();if(c<C){g=m;break}c-=C}return g.lines[c]}function Ut(s,c,g){var p=[],m=c.line;return s.iter(c.line,g.line+1,function(C){var M=C.text;m==g.line&&(M=M.slice(0,g.ch)),m==c.line&&(M=M.slice(c.ch)),p.push(M),++m}),p}function yn(s,c,g){var p=[];return s.iter(c,g,function(m){p.push(m.text)}),p}function ee(s,c){var g=c-s.height;if(g)for(var p=s;p;p=p.parent)p.height+=g}function P(s){if(s.parent==null)return null;for(var c=s.parent,g=be(c.lines,s),p=c.parent;p;c=p,p=p.parent)for(var m=0;p.children[m]!=c;++m)g+=p.children[m].chunkSize();return g+c.first}function Y(s,c){var g=s.first;e:do{for(var p=0;p<s.children.length;++p){var m=s.children[p],C=m.height;if(c<C){s=m;continue e}c-=C,g+=m.chunkSize()}return g}while(!s.lines);for(var M=0;M<s.lines.length;++M){var R=s.lines[M],j=R.height;if(c<j)break;c-=j}return g+M}function ye(s,c){return c>=s.first&&c<s.first+s.size}function Pe(s,c){return String(s.lineNumberFormatter(c+s.firstLineNumber))}function Ee(s,c,g){if(g===void 0&&(g=null),!(this instanceof Ee))return new Ee(s,c,g);this.line=s,this.ch=c,this.sticky=g}function Me(s,c){return s.line-c.line||s.ch-c.ch}function ot(s,c){return s.sticky==c.sticky&&Me(s,c)==0}function wt(s){return Ee(s.line,s.ch)}function Pt(s,c){return Me(s,c)<0?c:s}function Rn(s,c){return Me(s,c)<0?s:c}function Rs(s,c){return Math.max(s.first,Math.min(c,s.first+s.size-1))}function Bt(s,c){if(c.line<s.first)return Ee(s.first,0);var g=s.first+s.size-1;return c.line>g?Ee(g,Ke(s,g).text.length):Rr(c,Ke(s,c.line).text.length)}function Rr(s,c){var g=s.ch;return g==null||g>c?Ee(s.line,c):g<0?Ee(s.line,0):s}function wa(s,c){for(var g=[],p=0;p<c.length;p++)g[p]=Bt(s,c[p]);return g}var uo=function(s,c){this.state=s,this.lookAhead=c},xn=function(s,c,g,p){this.state=c,this.doc=s,this.line=g,this.maxLookAhead=p||0,this.baseTokens=null,this.baseTokenPos=1};xn.prototype.lookAhead=function(s){var c=this.doc.getLine(this.line+s);return c!=null&&s>this.maxLookAhead&&(this.maxLookAhead=s),c},xn.prototype.baseToken=function(s){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=s;)this.baseTokenPos+=2;var c=this.baseTokens[this.baseTokenPos+1];return{type:c&&c.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-s}},xn.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},xn.fromSaved=function(s,c,g){return c instanceof uo?new xn(s,Q(s.mode,c.state),g,c.lookAhead):new xn(s,Q(s.mode,c),g)},xn.prototype.save=function(s){var c=s!==!1?Q(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new uo(c,this.maxLookAhead):c};function Gr(s,c,g,p){var m=[s.state.modeGen],C={};Cg(s,c.text,s.doc.mode,g,function(z,re){return m.push(z,re)},C,p);for(var M=g.state,R=function(z){g.baseTokens=m;var re=s.state.overlays[z],le=1,Ce=0;g.state=!0,Cg(s,c.text,re.mode,g,function(_e,Fe){for(var Ge=le;Ce<_e;){var nt=m[le];nt>_e&&m.splice(le,1,_e,m[le+1],nt),le+=2,Ce=Math.min(_e,nt)}if(Fe)if(re.opaque)m.splice(Ge,le-Ge,_e,"overlay "+Fe),le=Ge+2;else for(;Ge<le;Ge+=2){var ut=m[Ge+1];m[Ge+1]=(ut?ut+" ":"")+"overlay "+Fe}},C),g.state=M,g.baseTokens=null,g.baseTokenPos=1},j=0;j<s.state.overlays.length;++j)R(j);return{styles:m,classes:C.bgClass||C.textClass?C:null}}function lu(s,c,g){if(!c.styles||c.styles[0]!=s.state.modeGen){var p=co(s,P(c)),m=c.text.length>s.options.maxHighlightLength&&Q(s.doc.mode,p.state),C=Gr(s,c,p);m&&(p.state=m),c.stateAfter=p.save(!m),c.styles=C.styles,C.classes?c.styleClasses=C.classes:c.styleClasses&&(c.styleClasses=null),g===s.doc.highlightFrontier&&(s.doc.modeFrontier=Math.max(s.doc.modeFrontier,++s.doc.highlightFrontier))}return c.styles}function co(s,c,g){var p=s.doc,m=s.display;if(!p.mode.startState)return new xn(p,!0,c);var C=uS(s,c,g),M=C>p.first&&Ke(p,C-1).stateAfter,R=M?xn.fromSaved(p,M,C):new xn(p,Ye(p.mode),C);return p.iter(C,c,function(j){Uc(s,j.text,R);var z=R.line;j.stateAfter=z==c-1||z%5==0||z>=m.viewFrom&&z<m.viewTo?R.save():null,R.nextLine()}),g&&(p.modeFrontier=R.line),R}function Uc(s,c,g,p){var m=s.doc.mode,C=new at(c,s.options.tabSize,g);for(C.start=C.pos=p||0,c==""&&xg(m,g.state);!C.eol();)Vc(m,C,g.state),C.start=C.pos}function xg(s,c){if(s.blankLine)return s.blankLine(c);if(s.innerMode){var g=Oe(s,c);if(g.mode.blankLine)return g.mode.blankLine(g.state)}}function Vc(s,c,g,p){for(var m=0;m<10;m++){p&&(p[0]=Oe(s,g).mode);var C=s.token(c,g);if(c.pos>c.start)return C}throw new Error("Mode "+s.name+" failed to advance stream.")}var wg=function(s,c,g){this.start=s.start,this.end=s.pos,this.string=s.current(),this.type=c||null,this.state=g};function Sg(s,c,g,p){var m=s.doc,C=m.mode,M;c=Bt(m,c);var R=Ke(m,c.line),j=co(s,c.line,g),z=new at(R.text,s.options.tabSize,j),re;for(p&&(re=[]);(p||z.pos<c.ch)&&!z.eol();)z.start=z.pos,M=Vc(C,z,j.state),p&&re.push(new wg(z,M,Q(m.mode,j.state)));return p?re:new wg(z,M,j.state)}function Eg(s,c){if(s)for(;;){var g=s.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!g)break;s=s.slice(0,g.index)+s.slice(g.index+g[0].length);var p=g[1]?"bgClass":"textClass";c[p]==null?c[p]=g[2]:new RegExp("(?:^|\\s)"+g[2]+"(?:$|\\s)").test(c[p])||(c[p]+=" "+g[2])}return s}function Cg(s,c,g,p,m,C,M){var R=g.flattenSpans;R==null&&(R=s.options.flattenSpans);var j=0,z=null,re=new at(c,s.options.tabSize,p),le,Ce=s.options.addModeClass&&[null];for(c==""&&Eg(xg(g,p.state),C);!re.eol();){if(re.pos>s.options.maxHighlightLength?(R=!1,M&&Uc(s,c,p,re.pos),re.pos=c.length,le=null):le=Eg(Vc(g,re,p.state,Ce),C),Ce){var _e=Ce[0].name;_e&&(le="m-"+(le?_e+" "+le:_e))}if(!R||z!=le){for(;j<re.start;)j=Math.min(re.start,j+5e3),m(j,z);z=le}re.start=re.pos}for(;j<re.pos;){var Fe=Math.min(re.pos,j+5e3);m(Fe,z),j=Fe}}function uS(s,c,g){for(var p,m,C=s.doc,M=g?-1:c-(s.doc.mode.innerMode?1e3:100),R=c;R>M;--R){if(R<=C.first)return C.first;var j=Ke(C,R-1),z=j.stateAfter;if(z&&(!g||R+(z instanceof uo?z.lookAhead:0)<=C.modeFrontier))return R;var re=fe(j.text,null,s.options.tabSize);(m==null||p>re)&&(m=R-1,p=re)}return m}function dS(s,c){if(s.modeFrontier=Math.min(s.modeFrontier,c),!(s.highlightFrontier<c-10)){for(var g=s.first,p=c-1;p>g;p--){var m=Ke(s,p).stateAfter;if(m&&(!(m instanceof uo)||p+m.lookAhead<c)){g=p+1;break}}s.highlightFrontier=Math.min(s.highlightFrontier,g)}}var kg=!1,Zi=!1;function cS(){kg=!0}function fS(){Zi=!0}function uu(s,c,g){this.marker=s,this.from=c,this.to=g}function Is(s,c){if(s)for(var g=0;g<s.length;++g){var p=s[g];if(p.marker==c)return p}}function hS(s,c){for(var g,p=0;p<s.length;++p)s[p]!=c&&(g||(g=[])).push(s[p]);return g}function pS(s,c,g){var p=g&&window.WeakSet&&(g.markedSpans||(g.markedSpans=new WeakSet));p&&s.markedSpans&&p.has(s.markedSpans)?s.markedSpans.push(c):(s.markedSpans=s.markedSpans?s.markedSpans.concat([c]):[c],p&&p.add(s.markedSpans)),c.marker.attachLine(s)}function vS(s,c,g){var p;if(s)for(var m=0;m<s.length;++m){var C=s[m],M=C.marker,R=C.from==null||(M.inclusiveLeft?C.from<=c:C.from<c);if(R||C.from==c&&M.type=="bookmark"&&(!g||!C.marker.insertLeft)){var j=C.to==null||(M.inclusiveRight?C.to>=c:C.to>c);(p||(p=[])).push(new uu(M,C.from,j?null:C.to))}}return p}function gS(s,c,g){var p;if(s)for(var m=0;m<s.length;++m){var C=s[m],M=C.marker,R=C.to==null||(M.inclusiveRight?C.to>=c:C.to>c);if(R||C.from==c&&M.type=="bookmark"&&(!g||C.marker.insertLeft)){var j=C.from==null||(M.inclusiveLeft?C.from<=c:C.from<c);(p||(p=[])).push(new uu(M,j?null:C.from-c,C.to==null?null:C.to-c))}}return p}function Wc(s,c){if(c.full)return null;var g=ye(s,c.from.line)&&Ke(s,c.from.line).markedSpans,p=ye(s,c.to.line)&&Ke(s,c.to.line).markedSpans;if(!g&&!p)return null;var m=c.from.ch,C=c.to.ch,M=Me(c.from,c.to)==0,R=vS(g,m,M),j=gS(p,C,M),z=c.text.length==1,re=A(c.text).length+(z?m:0);if(R)for(var le=0;le<R.length;++le){var Ce=R[le];if(Ce.to==null){var _e=Is(j,Ce.marker);_e?z&&(Ce.to=_e.to==null?null:_e.to+re):Ce.to=m}}if(j)for(var Fe=0;Fe<j.length;++Fe){var Ge=j[Fe];if(Ge.to!=null&&(Ge.to+=re),Ge.from==null){var nt=Is(R,Ge.marker);nt||(Ge.from=re,z&&(R||(R=[])).push(Ge))}else Ge.from+=re,z&&(R||(R=[])).push(Ge)}R&&(R=Og(R)),j&&j!=R&&(j=Og(j));var ut=[R];if(!z){var yt=c.text.length-2,dt;if(yt>0&&R)for(var xt=0;xt<R.length;++xt)R[xt].to==null&&(dt||(dt=[])).push(new uu(R[xt].marker,null,null));for(var At=0;At<yt;++At)ut.push(dt);ut.push(j)}return ut}function Og(s){for(var c=0;c<s.length;++c){var g=s[c];g.from!=null&&g.from==g.to&&g.marker.clearWhenEmpty!==!1&&s.splice(c--,1)}return s.length?s:null}function mS(s,c,g){var p=null;if(s.iter(c.line,g.line+1,function(_e){if(_e.markedSpans)for(var Fe=0;Fe<_e.markedSpans.length;++Fe){var Ge=_e.markedSpans[Fe].marker;Ge.readOnly&&(!p||be(p,Ge)==-1)&&(p||(p=[])).push(Ge)}}),!p)return null;for(var m=[{from:c,to:g}],C=0;C<p.length;++C)for(var M=p[C],R=M.find(0),j=0;j<m.length;++j){var z=m[j];if(!(Me(z.to,R.from)<0||Me(z.from,R.to)>0)){var re=[j,1],le=Me(z.from,R.from),Ce=Me(z.to,R.to);(le<0||!M.inclusiveLeft&&!le)&&re.push({from:z.from,to:R.from}),(Ce>0||!M.inclusiveRight&&!Ce)&&re.push({from:R.to,to:z.to}),m.splice.apply(m,re),j+=re.length-3}}return m}function Mg(s){var c=s.markedSpans;if(c){for(var g=0;g<c.length;++g)c[g].marker.detachLine(s);s.markedSpans=null}}function Ng(s,c){if(c){for(var g=0;g<c.length;++g)c[g].marker.attachLine(s);s.markedSpans=c}}function du(s){return s.inclusiveLeft?-1:0}function cu(s){return s.inclusiveRight?1:0}function Gc(s,c){var g=s.lines.length-c.lines.length;if(g!=0)return g;var p=s.find(),m=c.find(),C=Me(p.from,m.from)||du(s)-du(c);if(C)return-C;var M=Me(p.to,m.to)||cu(s)-cu(c);return M||c.id-s.id}function Ag(s,c){var g=Zi&&s.markedSpans,p;if(g)for(var m=void 0,C=0;C<g.length;++C)m=g[C],m.marker.collapsed&&(c?m.from:m.to)==null&&(!p||Gc(p,m.marker)<0)&&(p=m.marker);return p}function Tg(s){return Ag(s,!0)}function fu(s){return Ag(s,!1)}function yS(s,c){var g=Zi&&s.markedSpans,p;if(g)for(var m=0;m<g.length;++m){var C=g[m];C.marker.collapsed&&(C.from==null||C.from<c)&&(C.to==null||C.to>c)&&(!p||Gc(p,C.marker)<0)&&(p=C.marker)}return p}function Dg(s,c,g,p,m){var C=Ke(s,c),M=Zi&&C.markedSpans;if(M)for(var R=0;R<M.length;++R){var j=M[R];if(j.marker.collapsed){var z=j.marker.find(0),re=Me(z.from,g)||du(j.marker)-du(m),le=Me(z.to,p)||cu(j.marker)-cu(m);if(!(re>=0&&le<=0||re<=0&&le>=0)&&(re<=0&&(j.marker.inclusiveRight&&m.inclusiveLeft?Me(z.to,g)>=0:Me(z.to,g)>0)||re>=0&&(j.marker.inclusiveRight&&m.inclusiveLeft?Me(z.from,p)<=0:Me(z.from,p)<0)))return!0}}}function pi(s){for(var c;c=Tg(s);)s=c.find(-1,!0).line;return s}function _S(s){for(var c;c=fu(s);)s=c.find(1,!0).line;return s}function bS(s){for(var c,g;c=fu(s);)s=c.find(1,!0).line,(g||(g=[])).push(s);return g}function qc(s,c){var g=Ke(s,c),p=pi(g);return g==p?c:P(p)}function Lg(s,c){if(c>s.lastLine())return c;var g=Ke(s,c),p;if(!fo(s,g))return c;for(;p=fu(g);)g=p.find(1,!0).line;return P(g)+1}function fo(s,c){var g=Zi&&c.markedSpans;if(g){for(var p=void 0,m=0;m<g.length;++m)if(p=g[m],!!p.marker.collapsed){if(p.from==null)return!0;if(!p.marker.widgetNode&&p.from==0&&p.marker.inclusiveLeft&&Xc(s,c,p))return!0}}}function Xc(s,c,g){if(g.to==null){var p=g.marker.find(1,!0);return Xc(s,p.line,Is(p.line.markedSpans,g.marker))}if(g.marker.inclusiveRight&&g.to==c.text.length)return!0;for(var m=void 0,C=0;C<c.markedSpans.length;++C)if(m=c.markedSpans[C],m.marker.collapsed&&!m.marker.widgetNode&&m.from==g.to&&(m.to==null||m.to!=g.from)&&(m.marker.inclusiveLeft||g.marker.inclusiveRight)&&Xc(s,c,m))return!0}function Qi(s){s=pi(s);for(var c=0,g=s.parent,p=0;p<g.lines.length;++p){var m=g.lines[p];if(m==s)break;c+=m.height}for(var C=g.parent;C;g=C,C=g.parent)for(var M=0;M<C.children.length;++M){var R=C.children[M];if(R==g)break;c+=R.height}return c}function hu(s){if(s.height==0)return 0;for(var c=s.text.length,g,p=s;g=Tg(p);){var m=g.find(0,!0);p=m.from.line,c+=m.from.ch-m.to.ch}for(p=s;g=fu(p);){var C=g.find(0,!0);c-=p.text.length-C.from.ch,p=C.to.line,c+=p.text.length-C.to.ch}return c}function Yc(s){var c=s.display,g=s.doc;c.maxLine=Ke(g,g.first),c.maxLineLength=hu(c.maxLine),c.maxLineChanged=!0,g.iter(function(p){var m=hu(p);m>c.maxLineLength&&(c.maxLineLength=m,c.maxLine=p)})}var Sa=function(s,c,g){this.text=s,Ng(this,c),this.height=g?g(this):1};Sa.prototype.lineNo=function(){return P(this)},Je(Sa);function xS(s,c,g,p){s.text=c,s.stateAfter&&(s.stateAfter=null),s.styles&&(s.styles=null),s.order!=null&&(s.order=null),Mg(s),Ng(s,g);var m=p?p(s):1;m!=s.height&&ee(s,m)}function wS(s){s.parent=null,Mg(s)}var SS={},ES={};function Pg(s,c){if(!s||/^\s*$/.test(s))return null;var g=c.addModeClass?ES:SS;return g[s]||(g[s]=s.replace(/\S+/g,"cm-$&"))}function Rg(s,c){var g=pe("span",null,null,f?"padding-right: .1px":null),p={pre:pe("pre",[g],"CodeMirror-line"),content:g,col:0,pos:0,cm:s,trailingSpace:!1,splitSpaces:s.getOption("lineWrapping")};c.measure={};for(var m=0;m<=(c.rest?c.rest.length:0);m++){var C=m?c.rest[m-1]:c.line,M=void 0;p.pos=0,p.addToken=kS,Tr(s.display.measure)&&(M=st(C,s.doc.direction))&&(p.addToken=MS(p.addToken,M)),p.map=[];var R=c!=s.display.externalMeasured&&P(C);NS(C,p,lu(s,C,R)),C.styleClasses&&(C.styleClasses.bgClass&&(p.bgClass=ve(C.styleClasses.bgClass,p.bgClass||"")),C.styleClasses.textClass&&(p.textClass=ve(C.styleClasses.textClass,p.textClass||""))),p.map.length==0&&p.map.push(0,0,p.content.appendChild(ei(s.display.measure))),m==0?(c.measure.map=p.map,c.measure.cache={}):((c.measure.maps||(c.measure.maps=[])).push(p.map),(c.measure.caches||(c.measure.caches=[])).push({}))}if(f){var j=p.content.lastChild;(/\bcm-tab\b/.test(j.className)||j.querySelector&&j.querySelector(".cm-tab"))&&(p.content.className="cm-tab-wrap-hack")}return Xe(s,"renderLine",s,c.line,p.pre),p.pre.className&&(p.textClass=ve(p.pre.className,p.textClass||"")),p}function CS(s){var c=$("span","•","cm-invalidchar");return c.title="\\u"+s.charCodeAt(0).toString(16),c.setAttribute("aria-label",c.title),c}function kS(s,c,g,p,m,C,M){if(c){var R=s.splitSpaces?OS(c,s.trailingSpace):c,j=s.cm.state.specialChars,z=!1,re;if(!j.test(c))s.col+=c.length,re=document.createTextNode(R),s.map.push(s.pos,s.pos+c.length,re),u&&d<9&&(z=!0),s.pos+=c.length;else{re=document.createDocumentFragment();for(var le=0;;){j.lastIndex=le;var Ce=j.exec(c),_e=Ce?Ce.index-le:c.length-le;if(_e){var Fe=document.createTextNode(R.slice(le,le+_e));u&&d<9?re.appendChild($("span",[Fe])):re.appendChild(Fe),s.map.push(s.pos,s.pos+_e,Fe),s.col+=_e,s.pos+=_e}if(!Ce)break;le+=_e+1;var Ge=void 0;if(Ce[0]=="	"){var nt=s.cm.options.tabSize,ut=nt-s.col%nt;Ge=re.appendChild($("span",te(ut),"cm-tab")),Ge.setAttribute("role","presentation"),Ge.setAttribute("cm-text","	"),s.col+=ut}else Ce[0]=="\r"||Ce[0]==`
`?(Ge=re.appendChild($("span",Ce[0]=="\r"?"␍":"␤","cm-invalidchar")),Ge.setAttribute("cm-text",Ce[0]),s.col+=1):(Ge=s.cm.options.specialCharPlaceholder(Ce[0]),Ge.setAttribute("cm-text",Ce[0]),u&&d<9?re.appendChild($("span",[Ge])):re.appendChild(Ge),s.col+=1);s.map.push(s.pos,s.pos+1,Ge),s.pos++}}if(s.trailingSpace=R.charCodeAt(c.length-1)==32,g||p||m||z||C||M){var yt=g||"";p&&(yt+=p),m&&(yt+=m);var dt=$("span",[re],yt,C);if(M)for(var xt in M)M.hasOwnProperty(xt)&&xt!="style"&&xt!="class"&&dt.setAttribute(xt,M[xt]);return s.content.appendChild(dt)}s.content.appendChild(re)}}function OS(s,c){if(s.length>1&&!/  /.test(s))return s;for(var g=c,p="",m=0;m<s.length;m++){var C=s.charAt(m);C==" "&&g&&(m==s.length-1||s.charCodeAt(m+1)==32)&&(C=" "),p+=C,g=C==" "}return p}function MS(s,c){return function(g,p,m,C,M,R,j){m=m?m+" cm-force-border":"cm-force-border";for(var z=g.pos,re=z+p.length;;){for(var le=void 0,Ce=0;Ce<c.length&&(le=c[Ce],!(le.to>z&&le.from<=z));Ce++);if(le.to>=re)return s(g,p,m,C,M,R,j);s(g,p.slice(0,le.to-z),m,C,null,R,j),C=null,p=p.slice(le.to-z),z=le.to}}}function Ig(s,c,g,p){var m=!p&&g.widgetNode;m&&s.map.push(s.pos,s.pos+c,m),!p&&s.cm.display.input.needsContentAttribute&&(m||(m=s.content.appendChild(document.createElement("span"))),m.setAttribute("cm-marker",g.id)),m&&(s.cm.display.input.setUneditable(m),s.content.appendChild(m)),s.pos+=c,s.trailingSpace=!1}function NS(s,c,g){var p=s.markedSpans,m=s.text,C=0;if(!p){for(var M=1;M<g.length;M+=2)c.addToken(c,m.slice(C,C=g[M]),Pg(g[M+1],c.cm.options));return}for(var R=m.length,j=0,z=1,re="",le,Ce,_e=0,Fe,Ge,nt,ut,yt;;){if(_e==j){Fe=Ge=nt=Ce="",yt=null,ut=null,_e=1/0;for(var dt=[],xt=void 0,At=0;At<p.length;++At){var Nt=p[At],Vt=Nt.marker;if(Vt.type=="bookmark"&&Nt.from==j&&Vt.widgetNode)dt.push(Vt);else if(Nt.from<=j&&(Nt.to==null||Nt.to>j||Vt.collapsed&&Nt.to==j&&Nt.from==j)){if(Nt.to!=null&&Nt.to!=j&&_e>Nt.to&&(_e=Nt.to,Ge=""),Vt.className&&(Fe+=" "+Vt.className),Vt.css&&(Ce=(Ce?Ce+";":"")+Vt.css),Vt.startStyle&&Nt.from==j&&(nt+=" "+Vt.startStyle),Vt.endStyle&&Nt.to==_e&&(xt||(xt=[])).push(Vt.endStyle,Nt.to),Vt.title&&((yt||(yt={})).title=Vt.title),Vt.attributes)for(var gn in Vt.attributes)(yt||(yt={}))[gn]=Vt.attributes[gn];Vt.collapsed&&(!ut||Gc(ut.marker,Vt)<0)&&(ut=Nt)}else Nt.from>j&&_e>Nt.from&&(_e=Nt.from)}if(xt)for(var Xn=0;Xn<xt.length;Xn+=2)xt[Xn+1]==_e&&(Ge+=" "+xt[Xn]);if(!ut||ut.from==j)for(var En=0;En<dt.length;++En)Ig(c,0,dt[En]);if(ut&&(ut.from||0)==j){if(Ig(c,(ut.to==null?R+1:ut.to)-j,ut.marker,ut.from==null),ut.to==null)return;ut.to==j&&(ut=!1)}}if(j>=R)break;for(var Br=Math.min(R,_e);;){if(re){var xr=j+re.length;if(!ut){var jn=xr>Br?re.slice(0,Br-j):re;c.addToken(c,jn,le?le+Fe:Fe,nt,j+jn.length==_e?Ge:"",Ce,yt)}if(xr>=Br){re=re.slice(Br-j),j=Br;break}j=xr,nt=""}re=m.slice(C,C=g[z++]),le=Pg(g[z++],c.cm.options)}}}function Bg(s,c,g){this.line=c,this.rest=bS(c),this.size=this.rest?P(A(this.rest))-g+1:1,this.node=this.text=null,this.hidden=fo(s,c)}function pu(s,c,g){for(var p=[],m,C=c;C<g;C=m){var M=new Bg(s.doc,Ke(s.doc,C),C);m=C+M.size,p.push(M)}return p}var Ea=null;function AS(s){Ea?Ea.ops.push(s):s.ownsGroup=Ea={ops:[s],delayedCallbacks:[]}}function TS(s){var c=s.delayedCallbacks,g=0;do{for(;g<c.length;g++)c[g].call(null);for(var p=0;p<s.ops.length;p++){var m=s.ops[p];if(m.cursorActivityHandlers)for(;m.cursorActivityCalled<m.cursorActivityHandlers.length;)m.cursorActivityHandlers[m.cursorActivityCalled++].call(null,m.cm)}}while(g<c.length)}function DS(s,c){var g=s.ownsGroup;if(g)try{TS(g)}finally{Ea=null,c(g)}}var Bs=null;function Wn(s,c){var g=it(s,c);if(g.length){var p=Array.prototype.slice.call(arguments,2),m;Ea?m=Ea.delayedCallbacks:Bs?m=Bs:(m=Bs=[],setTimeout(LS,0));for(var C=function(R){m.push(function(){return g[R].apply(null,p)})},M=0;M<g.length;++M)C(M)}}function LS(){var s=Bs;Bs=null;for(var c=0;c<s.length;++c)s[c]()}function jg(s,c,g,p){for(var m=0;m<c.changes.length;m++){var C=c.changes[m];C=="text"?RS(s,c):C=="gutter"?$g(s,c,g,p):C=="class"?Kc(s,c):C=="widget"&&IS(s,c,p)}c.changes=null}function js(s){return s.node==s.text&&(s.node=$("div",null,null,"position: relative"),s.text.parentNode&&s.text.parentNode.replaceChild(s.node,s.text),s.node.appendChild(s.text),u&&d<8&&(s.node.style.zIndex=2)),s.node}function PS(s,c){var g=c.bgClass?c.bgClass+" "+(c.line.bgClass||""):c.line.bgClass;if(g&&(g+=" CodeMirror-linebackground"),c.background)g?c.background.className=g:(c.background.parentNode.removeChild(c.background),c.background=null);else if(g){var p=js(c);c.background=p.insertBefore($("div",null,g),p.firstChild),s.display.input.setUneditable(c.background)}}function Hg(s,c){var g=s.display.externalMeasured;return g&&g.line==c.line?(s.display.externalMeasured=null,c.measure=g.measure,g.built):Rg(s,c)}function RS(s,c){var g=c.text.className,p=Hg(s,c);c.text==c.node&&(c.node=p.pre),c.text.parentNode.replaceChild(p.pre,c.text),c.text=p.pre,p.bgClass!=c.bgClass||p.textClass!=c.textClass?(c.bgClass=p.bgClass,c.textClass=p.textClass,Kc(s,c)):g&&(c.text.className=g)}function Kc(s,c){PS(s,c),c.line.wrapClass?js(c).className=c.line.wrapClass:c.node!=c.text&&(c.node.className="");var g=c.textClass?c.textClass+" "+(c.line.textClass||""):c.line.textClass;c.text.className=g||""}function $g(s,c,g,p){if(c.gutter&&(c.node.removeChild(c.gutter),c.gutter=null),c.gutterBackground&&(c.node.removeChild(c.gutterBackground),c.gutterBackground=null),c.line.gutterClass){var m=js(c);c.gutterBackground=$("div",null,"CodeMirror-gutter-background "+c.line.gutterClass,"left: "+(s.options.fixedGutter?p.fixedPos:-p.gutterTotalWidth)+"px; width: "+p.gutterTotalWidth+"px"),s.display.input.setUneditable(c.gutterBackground),m.insertBefore(c.gutterBackground,c.text)}var C=c.line.gutterMarkers;if(s.options.lineNumbers||C){var M=js(c),R=c.gutter=$("div",null,"CodeMirror-gutter-wrapper","left: "+(s.options.fixedGutter?p.fixedPos:-p.gutterTotalWidth)+"px");if(R.setAttribute("aria-hidden","true"),s.display.input.setUneditable(R),M.insertBefore(R,c.text),c.line.gutterClass&&(R.className+=" "+c.line.gutterClass),s.options.lineNumbers&&(!C||!C["CodeMirror-linenumbers"])&&(c.lineNumber=R.appendChild($("div",Pe(s.options,g),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+p.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+s.display.lineNumInnerWidth+"px"))),C)for(var j=0;j<s.display.gutterSpecs.length;++j){var z=s.display.gutterSpecs[j].className,re=C.hasOwnProperty(z)&&C[z];re&&R.appendChild($("div",[re],"CodeMirror-gutter-elt","left: "+p.gutterLeft[z]+"px; width: "+p.gutterWidth[z]+"px"))}}}function IS(s,c,g){c.alignable&&(c.alignable=null);for(var p=V("CodeMirror-linewidget"),m=c.node.firstChild,C=void 0;m;m=C)C=m.nextSibling,p.test(m.className)&&c.node.removeChild(m);Fg(s,c,g)}function BS(s,c,g,p){var m=Hg(s,c);return c.text=c.node=m.pre,m.bgClass&&(c.bgClass=m.bgClass),m.textClass&&(c.textClass=m.textClass),Kc(s,c),$g(s,c,g,p),Fg(s,c,p),c.node}function Fg(s,c,g){if(zg(s,c.line,c,g,!0),c.rest)for(var p=0;p<c.rest.length;p++)zg(s,c.rest[p],c,g,!1)}function zg(s,c,g,p,m){if(c.widgets)for(var C=js(g),M=0,R=c.widgets;M<R.length;++M){var j=R[M],z=$("div",[j.node],"CodeMirror-linewidget"+(j.className?" "+j.className:""));j.handleMouseEvents||z.setAttribute("cm-ignore-events","true"),jS(j,z,g,p),s.display.input.setUneditable(z),m&&j.above?C.insertBefore(z,g.gutter||g.text):C.appendChild(z),Wn(j,"redraw")}}function jS(s,c,g,p){if(s.noHScroll){(g.alignable||(g.alignable=[])).push(c);var m=p.wrapperWidth;c.style.left=p.fixedPos+"px",s.coverGutter||(m-=p.gutterTotalWidth,c.style.paddingLeft=p.gutterTotalWidth+"px"),c.style.width=m+"px"}s.coverGutter&&(c.style.zIndex=5,c.style.position="relative",s.noHScroll||(c.style.marginLeft=-p.gutterTotalWidth+"px"))}function Hs(s){if(s.height!=null)return s.height;var c=s.doc.cm;if(!c)return 0;if(!de(document.body,s.node)){var g="position: relative;";s.coverGutter&&(g+="margin-left: -"+c.display.gutters.offsetWidth+"px;"),s.noHScroll&&(g+="width: "+c.display.wrapper.clientWidth+"px;"),W(c.display.measure,$("div",[s.node],null,g))}return s.height=s.node.parentNode.offsetHeight}function eo(s,c){for(var g=rr(c);g!=s.wrapper;g=g.parentNode)if(!g||g.nodeType==1&&g.getAttribute("cm-ignore-events")=="true"||g.parentNode==s.sizer&&g!=s.mover)return!0}function vu(s){return s.lineSpace.offsetTop}function Jc(s){return s.mover.offsetHeight-s.lineSpace.offsetHeight}function Ug(s){if(s.cachedPaddingH)return s.cachedPaddingH;var c=W(s.measure,$("pre","x","CodeMirror-line-like")),g=window.getComputedStyle?window.getComputedStyle(c):c.currentStyle,p={left:parseInt(g.paddingLeft),right:parseInt(g.paddingRight)};return!isNaN(p.left)&&!isNaN(p.right)&&(s.cachedPaddingH=p),p}function Bi(s){return xe-s.display.nativeBarWidth}function $o(s){return s.display.scroller.clientWidth-Bi(s)-s.display.barWidth}function Zc(s){return s.display.scroller.clientHeight-Bi(s)-s.display.barHeight}function HS(s,c,g){var p=s.options.lineWrapping,m=p&&$o(s);if(!c.measure.heights||p&&c.measure.width!=m){var C=c.measure.heights=[];if(p){c.measure.width=m;for(var M=c.text.firstChild.getClientRects(),R=0;R<M.length-1;R++){var j=M[R],z=M[R+1];Math.abs(j.bottom-z.bottom)>2&&C.push((j.bottom+z.top)/2-g.top)}}C.push(g.bottom-g.top)}}function Vg(s,c,g){if(s.line==c)return{map:s.measure.map,cache:s.measure.cache};if(s.rest){for(var p=0;p<s.rest.length;p++)if(s.rest[p]==c)return{map:s.measure.maps[p],cache:s.measure.caches[p]};for(var m=0;m<s.rest.length;m++)if(P(s.rest[m])>g)return{map:s.measure.maps[m],cache:s.measure.caches[m],before:!0}}}function $S(s,c){c=pi(c);var g=P(c),p=s.display.externalMeasured=new Bg(s.doc,c,g);p.lineN=g;var m=p.built=Rg(s,p);return p.text=m.pre,W(s.display.lineMeasure,m.pre),p}function Wg(s,c,g,p){return ji(s,Ca(s,c),g,p)}function Qc(s,c){if(c>=s.display.viewFrom&&c<s.display.viewTo)return s.display.view[Uo(s,c)];var g=s.display.externalMeasured;if(g&&c>=g.lineN&&c<g.lineN+g.size)return g}function Ca(s,c){var g=P(c),p=Qc(s,g);p&&!p.text?p=null:p&&p.changes&&(jg(s,p,g,of(s)),s.curOp.forceUpdate=!0),p||(p=$S(s,c));var m=Vg(p,c,g);return{line:c,view:p,rect:null,map:m.map,cache:m.cache,before:m.before,hasHeights:!1}}function ji(s,c,g,p,m){c.before&&(g=-1);var C=g+(p||""),M;return c.cache.hasOwnProperty(C)?M=c.cache[C]:(c.rect||(c.rect=c.view.text.getBoundingClientRect()),c.hasHeights||(HS(s,c.view,c.rect),c.hasHeights=!0),M=zS(s,c,g,p),M.bogus||(c.cache[C]=M)),{left:M.left,right:M.right,top:m?M.rtop:M.top,bottom:m?M.rbottom:M.bottom}}var Gg={left:0,right:0,top:0,bottom:0};function qg(s,c,g){for(var p,m,C,M,R,j,z=0;z<s.length;z+=3)if(R=s[z],j=s[z+1],c<R?(m=0,C=1,M="left"):c<j?(m=c-R,C=m+1):(z==s.length-3||c==j&&s[z+3]>c)&&(C=j-R,m=C-1,c>=j&&(M="right")),m!=null){if(p=s[z+2],R==j&&g==(p.insertLeft?"left":"right")&&(M=g),g=="left"&&m==0)for(;z&&s[z-2]==s[z-3]&&s[z-1].insertLeft;)p=s[(z-=3)+2],M="left";if(g=="right"&&m==j-R)for(;z<s.length-3&&s[z+3]==s[z+4]&&!s[z+5].insertLeft;)p=s[(z+=3)+2],M="right";break}return{node:p,start:m,end:C,collapse:M,coverStart:R,coverEnd:j}}function FS(s,c){var g=Gg;if(c=="left")for(var p=0;p<s.length&&(g=s[p]).left==g.right;p++);else for(var m=s.length-1;m>=0&&(g=s[m]).left==g.right;m--);return g}function zS(s,c,g,p){var m=qg(c.map,g,p),C=m.node,M=m.start,R=m.end,j=m.collapse,z;if(C.nodeType==3){for(var re=0;re<4;re++){for(;M&&tt(c.line.text.charAt(m.coverStart+M));)--M;for(;m.coverStart+R<m.coverEnd&&tt(c.line.text.charAt(m.coverStart+R));)++R;if(u&&d<9&&M==0&&R==m.coverEnd-m.coverStart?z=C.parentNode.getBoundingClientRect():z=FS(De(C,M,R).getClientRects(),p),z.left||z.right||M==0)break;R=M,M=M-1,j="right"}u&&d<11&&(z=US(s.display.measure,z))}else{M>0&&(j=p="right");var le;s.options.lineWrapping&&(le=C.getClientRects()).length>1?z=le[p=="right"?le.length-1:0]:z=C.getBoundingClientRect()}if(u&&d<9&&!M&&(!z||!z.left&&!z.right)){var Ce=C.parentNode.getClientRects()[0];Ce?z={left:Ce.left,right:Ce.left+Oa(s.display),top:Ce.top,bottom:Ce.bottom}:z=Gg}for(var _e=z.top-c.rect.top,Fe=z.bottom-c.rect.top,Ge=(_e+Fe)/2,nt=c.view.measure.heights,ut=0;ut<nt.length-1&&!(Ge<nt[ut]);ut++);var yt=ut?nt[ut-1]:0,dt=nt[ut],xt={left:(j=="right"?z.right:z.left)-c.rect.left,right:(j=="left"?z.left:z.right)-c.rect.left,top:yt,bottom:dt};return!z.left&&!z.right&&(xt.bogus=!0),s.options.singleCursorHeightPerLine||(xt.rtop=_e,xt.rbottom=Fe),xt}function US(s,c){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!Ii(s))return c;var g=screen.logicalXDPI/screen.deviceXDPI,p=screen.logicalYDPI/screen.deviceYDPI;return{left:c.left*g,right:c.right*g,top:c.top*p,bottom:c.bottom*p}}function Xg(s){if(s.measure&&(s.measure.cache={},s.measure.heights=null,s.rest))for(var c=0;c<s.rest.length;c++)s.measure.caches[c]={}}function Yg(s){s.display.externalMeasure=null,D(s.display.lineMeasure);for(var c=0;c<s.display.view.length;c++)Xg(s.display.view[c])}function $s(s){Yg(s),s.display.cachedCharWidth=s.display.cachedTextHeight=s.display.cachedPaddingH=null,s.options.lineWrapping||(s.display.maxLineChanged=!0),s.display.lineNumChars=null}function Kg(s){return v&&k?-(s.body.getBoundingClientRect().left-parseInt(getComputedStyle(s.body).marginLeft)):s.defaultView.pageXOffset||(s.documentElement||s.body).scrollLeft}function Jg(s){return v&&k?-(s.body.getBoundingClientRect().top-parseInt(getComputedStyle(s.body).marginTop)):s.defaultView.pageYOffset||(s.documentElement||s.body).scrollTop}function ef(s){var c=pi(s),g=c.widgets,p=0;if(g)for(var m=0;m<g.length;++m)g[m].above&&(p+=Hs(g[m]));return p}function gu(s,c,g,p,m){if(!m){var C=ef(c);g.top+=C,g.bottom+=C}if(p=="line")return g;p||(p="local");var M=Qi(c);if(p=="local"?M+=vu(s.display):M-=s.display.viewOffset,p=="page"||p=="window"){var R=s.display.lineSpace.getBoundingClientRect();M+=R.top+(p=="window"?0:Jg(Ie(s)));var j=R.left+(p=="window"?0:Kg(Ie(s)));g.left+=j,g.right+=j}return g.top+=M,g.bottom+=M,g}function Zg(s,c,g){if(g=="div")return c;var p=c.left,m=c.top;if(g=="page")p-=Kg(Ie(s)),m-=Jg(Ie(s));else if(g=="local"||!g){var C=s.display.sizer.getBoundingClientRect();p+=C.left,m+=C.top}var M=s.display.lineSpace.getBoundingClientRect();return{left:p-M.left,top:m-M.top}}function mu(s,c,g,p,m){return p||(p=Ke(s.doc,c.line)),gu(s,p,Wg(s,p,c.ch,m),g)}function vi(s,c,g,p,m,C){p=p||Ke(s.doc,c.line),m||(m=Ca(s,p));function M(Fe,Ge){var nt=ji(s,m,Fe,Ge?"right":"left",C);return Ge?nt.left=nt.right:nt.right=nt.left,gu(s,p,nt,g)}var R=st(p,s.doc.direction),j=c.ch,z=c.sticky;if(j>=p.text.length?(j=p.text.length,z="before"):j<=0&&(j=0,z="after"),!R)return M(z=="before"?j-1:j,z=="before");function re(Fe,Ge,nt){var ut=R[Ge],yt=ut.level==1;return M(nt?Fe-1:Fe,yt!=nt)}var le=ht(R,j,z),Ce=Qe,_e=re(j,le,z=="before");return Ce!=null&&(_e.other=re(j,Ce,z!="before")),_e}function Qg(s,c){var g=0;c=Bt(s.doc,c),s.options.lineWrapping||(g=Oa(s.display)*c.ch);var p=Ke(s.doc,c.line),m=Qi(p)+vu(s.display);return{left:g,right:g,top:m,bottom:m+p.height}}function tf(s,c,g,p,m){var C=Ee(s,c,g);return C.xRel=m,p&&(C.outside=p),C}function nf(s,c,g){var p=s.doc;if(g+=s.display.viewOffset,g<0)return tf(p.first,0,null,-1,-1);var m=Y(p,g),C=p.first+p.size-1;if(m>C)return tf(p.first+p.size-1,Ke(p,C).text.length,null,1,1);c<0&&(c=0);for(var M=Ke(p,m);;){var R=VS(s,M,m,c,g),j=yS(M,R.ch+(R.xRel>0||R.outside>0?1:0));if(!j)return R;var z=j.find(1);if(z.line==m)return z;M=Ke(p,m=z.line)}}function em(s,c,g,p){p-=ef(c);var m=c.text.length,C=bt(function(M){return ji(s,g,M-1).bottom<=p},m,0);return m=bt(function(M){return ji(s,g,M).top>p},C,m),{begin:C,end:m}}function tm(s,c,g,p){g||(g=Ca(s,c));var m=gu(s,c,ji(s,g,p),"line").top;return em(s,c,g,m)}function rf(s,c,g,p){return s.bottom<=g?!1:s.top>g?!0:(p?s.left:s.right)>c}function VS(s,c,g,p,m){m-=Qi(c);var C=Ca(s,c),M=ef(c),R=0,j=c.text.length,z=!0,re=st(c,s.doc.direction);if(re){var le=(s.options.lineWrapping?GS:WS)(s,c,g,C,re,p,m);z=le.level!=1,R=z?le.from:le.to-1,j=z?le.to:le.from-1}var Ce=null,_e=null,Fe=bt(function(At){var Nt=ji(s,C,At);return Nt.top+=M,Nt.bottom+=M,rf(Nt,p,m,!1)?(Nt.top<=m&&Nt.left<=p&&(Ce=At,_e=Nt),!0):!1},R,j),Ge,nt,ut=!1;if(_e){var yt=p-_e.left<_e.right-p,dt=yt==z;Fe=Ce+(dt?0:1),nt=dt?"after":"before",Ge=yt?_e.left:_e.right}else{!z&&(Fe==j||Fe==R)&&Fe++,nt=Fe==0?"after":Fe==c.text.length?"before":ji(s,C,Fe-(z?1:0)).bottom+M<=m==z?"after":"before";var xt=vi(s,Ee(g,Fe,nt),"line",c,C);Ge=xt.left,ut=m<xt.top?-1:m>=xt.bottom?1:0}return Fe=vt(c.text,Fe,1),tf(g,Fe,nt,ut,p-Ge)}function WS(s,c,g,p,m,C,M){var R=bt(function(le){var Ce=m[le],_e=Ce.level!=1;return rf(vi(s,Ee(g,_e?Ce.to:Ce.from,_e?"before":"after"),"line",c,p),C,M,!0)},0,m.length-1),j=m[R];if(R>0){var z=j.level!=1,re=vi(s,Ee(g,z?j.from:j.to,z?"after":"before"),"line",c,p);rf(re,C,M,!0)&&re.top>M&&(j=m[R-1])}return j}function GS(s,c,g,p,m,C,M){var R=em(s,c,p,M),j=R.begin,z=R.end;/\s/.test(c.text.charAt(z-1))&&z--;for(var re=null,le=null,Ce=0;Ce<m.length;Ce++){var _e=m[Ce];if(!(_e.from>=z||_e.to<=j)){var Fe=_e.level!=1,Ge=ji(s,p,Fe?Math.min(z,_e.to)-1:Math.max(j,_e.from)).right,nt=Ge<C?C-Ge+1e9:Ge-C;(!re||le>nt)&&(re=_e,le=nt)}}return re||(re=m[m.length-1]),re.from<j&&(re={from:j,to:re.to,level:re.level}),re.to>z&&(re={from:re.from,to:z,level:re.level}),re}var Fo;function ka(s){if(s.cachedTextHeight!=null)return s.cachedTextHeight;if(Fo==null){Fo=$("pre",null,"CodeMirror-line-like");for(var c=0;c<49;++c)Fo.appendChild(document.createTextNode("x")),Fo.appendChild($("br"));Fo.appendChild(document.createTextNode("x"))}W(s.measure,Fo);var g=Fo.offsetHeight/50;return g>3&&(s.cachedTextHeight=g),D(s.measure),g||1}function Oa(s){if(s.cachedCharWidth!=null)return s.cachedCharWidth;var c=$("span","xxxxxxxxxx"),g=$("pre",[c],"CodeMirror-line-like");W(s.measure,g);var p=c.getBoundingClientRect(),m=(p.right-p.left)/10;return m>2&&(s.cachedCharWidth=m),m||10}function of(s){for(var c=s.display,g={},p={},m=c.gutters.clientLeft,C=c.gutters.firstChild,M=0;C;C=C.nextSibling,++M){var R=s.display.gutterSpecs[M].className;g[R]=C.offsetLeft+C.clientLeft+m,p[R]=C.clientWidth}return{fixedPos:af(c),gutterTotalWidth:c.gutters.offsetWidth,gutterLeft:g,gutterWidth:p,wrapperWidth:c.wrapper.clientWidth}}function af(s){return s.scroller.getBoundingClientRect().left-s.sizer.getBoundingClientRect().left}function nm(s){var c=ka(s.display),g=s.options.lineWrapping,p=g&&Math.max(5,s.display.scroller.clientWidth/Oa(s.display)-3);return function(m){if(fo(s.doc,m))return 0;var C=0;if(m.widgets)for(var M=0;M<m.widgets.length;M++)m.widgets[M].height&&(C+=m.widgets[M].height);return g?C+(Math.ceil(m.text.length/p)||1)*c:C+c}}function sf(s){var c=s.doc,g=nm(s);c.iter(function(p){var m=g(p);m!=p.height&&ee(p,m)})}function zo(s,c,g,p){var m=s.display;if(!g&&rr(c).getAttribute("cm-not-content")=="true")return null;var C,M,R=m.lineSpace.getBoundingClientRect();try{C=c.clientX-R.left,M=c.clientY-R.top}catch{return null}var j=nf(s,C,M),z;if(p&&j.xRel>0&&(z=Ke(s.doc,j.line).text).length==j.ch){var re=fe(z,z.length,s.options.tabSize)-z.length;j=Ee(j.line,Math.max(0,Math.round((C-Ug(s.display).left)/Oa(s.display))-re))}return j}function Uo(s,c){if(c>=s.display.viewTo||(c-=s.display.viewFrom,c<0))return null;for(var g=s.display.view,p=0;p<g.length;p++)if(c-=g[p].size,c<0)return p}function _r(s,c,g,p){c==null&&(c=s.doc.first),g==null&&(g=s.doc.first+s.doc.size),p||(p=0);var m=s.display;if(p&&g<m.viewTo&&(m.updateLineNumbers==null||m.updateLineNumbers>c)&&(m.updateLineNumbers=c),s.curOp.viewChanged=!0,c>=m.viewTo)Zi&&qc(s.doc,c)<m.viewTo&&po(s);else if(g<=m.viewFrom)Zi&&Lg(s.doc,g+p)>m.viewFrom?po(s):(m.viewFrom+=p,m.viewTo+=p);else if(c<=m.viewFrom&&g>=m.viewTo)po(s);else if(c<=m.viewFrom){var C=yu(s,g,g+p,1);C?(m.view=m.view.slice(C.index),m.viewFrom=C.lineN,m.viewTo+=p):po(s)}else if(g>=m.viewTo){var M=yu(s,c,c,-1);M?(m.view=m.view.slice(0,M.index),m.viewTo=M.lineN):po(s)}else{var R=yu(s,c,c,-1),j=yu(s,g,g+p,1);R&&j?(m.view=m.view.slice(0,R.index).concat(pu(s,R.lineN,j.lineN)).concat(m.view.slice(j.index)),m.viewTo+=p):po(s)}var z=m.externalMeasured;z&&(g<z.lineN?z.lineN+=p:c<z.lineN+z.size&&(m.externalMeasured=null))}function ho(s,c,g){s.curOp.viewChanged=!0;var p=s.display,m=s.display.externalMeasured;if(m&&c>=m.lineN&&c<m.lineN+m.size&&(p.externalMeasured=null),!(c<p.viewFrom||c>=p.viewTo)){var C=p.view[Uo(s,c)];if(C.node!=null){var M=C.changes||(C.changes=[]);be(M,g)==-1&&M.push(g)}}}function po(s){s.display.viewFrom=s.display.viewTo=s.doc.first,s.display.view=[],s.display.viewOffset=0}function yu(s,c,g,p){var m=Uo(s,c),C,M=s.display.view;if(!Zi||g==s.doc.first+s.doc.size)return{index:m,lineN:g};for(var R=s.display.viewFrom,j=0;j<m;j++)R+=M[j].size;if(R!=c){if(p>0){if(m==M.length-1)return null;C=R+M[m].size-c,m++}else C=R-c;c+=C,g+=C}for(;qc(s.doc,g)!=g;){if(m==(p<0?0:M.length-1))return null;g+=p*M[m-(p<0?1:0)].size,m+=p}return{index:m,lineN:g}}function qS(s,c,g){var p=s.display,m=p.view;m.length==0||c>=p.viewTo||g<=p.viewFrom?(p.view=pu(s,c,g),p.viewFrom=c):(p.viewFrom>c?p.view=pu(s,c,p.viewFrom).concat(p.view):p.viewFrom<c&&(p.view=p.view.slice(Uo(s,c))),p.viewFrom=c,p.viewTo<g?p.view=p.view.concat(pu(s,p.viewTo,g)):p.viewTo>g&&(p.view=p.view.slice(0,Uo(s,g)))),p.viewTo=g}function rm(s){for(var c=s.display.view,g=0,p=0;p<c.length;p++){var m=c[p];!m.hidden&&(!m.node||m.changes)&&++g}return g}function Fs(s){s.display.input.showSelection(s.display.input.prepareSelection())}function im(s,c){c===void 0&&(c=!0);var g=s.doc,p={},m=p.cursors=document.createDocumentFragment(),C=p.selection=document.createDocumentFragment(),M=s.options.$customCursor;M&&(c=!0);for(var R=0;R<g.sel.ranges.length;R++)if(!(!c&&R==g.sel.primIndex)){var j=g.sel.ranges[R];if(!(j.from().line>=s.display.viewTo||j.to().line<s.display.viewFrom)){var z=j.empty();if(M){var re=M(s,j);re&&lf(s,re,m)}else(z||s.options.showCursorWhenSelecting)&&lf(s,j.head,m);z||XS(s,j,C)}}return p}function lf(s,c,g){var p=vi(s,c,"div",null,null,!s.options.singleCursorHeightPerLine),m=g.appendChild($("div"," ","CodeMirror-cursor"));if(m.style.left=p.left+"px",m.style.top=p.top+"px",m.style.height=Math.max(0,p.bottom-p.top)*s.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(s.getWrapperElement().className)){var C=mu(s,c,"div",null,null),M=C.right-C.left;m.style.width=(M>0?M:s.defaultCharWidth())+"px"}if(p.other){var R=g.appendChild($("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));R.style.display="",R.style.left=p.other.left+"px",R.style.top=p.other.top+"px",R.style.height=(p.other.bottom-p.other.top)*.85+"px"}}function _u(s,c){return s.top-c.top||s.left-c.left}function XS(s,c,g){var p=s.display,m=s.doc,C=document.createDocumentFragment(),M=Ug(s.display),R=M.left,j=Math.max(p.sizerWidth,$o(s)-p.sizer.offsetLeft)-M.right,z=m.direction=="ltr";function re(dt,xt,At,Nt){xt<0&&(xt=0),xt=Math.round(xt),Nt=Math.round(Nt),C.appendChild($("div",null,"CodeMirror-selected","position: absolute; left: "+dt+`px;
                             top: `+xt+"px; width: "+(At??j-dt)+`px;
                             height: `+(Nt-xt)+"px"))}function le(dt,xt,At){var Nt=Ke(m,dt),Vt=Nt.text.length,gn,Xn;function En(jn,wr){return mu(s,Ee(dt,jn),"div",Nt,wr)}function Br(jn,wr,Zn){var Fn=tm(s,Nt,null,jn),Hn=wr=="ltr"==(Zn=="after")?"left":"right",Mn=Zn=="after"?Fn.begin:Fn.end-(/\s/.test(Nt.text.charAt(Fn.end-1))?2:1);return En(Mn,Hn)[Hn]}var xr=st(Nt,m.direction);return Lt(xr,xt||0,At??Vt,function(jn,wr,Zn,Fn){var Hn=Zn=="ltr",Mn=En(jn,Hn?"left":"right"),Sr=En(wr-1,Hn?"right":"left"),$a=xt==null&&jn==0,bo=At==null&&wr==Vt,or=Fn==0,Hi=!xr||Fn==xr.length-1;if(Sr.top-Mn.top<=3){var Yn=(z?$a:bo)&&or,Rf=(z?bo:$a)&&Hi,ro=Yn?R:(Hn?Mn:Sr).left,Xo=Rf?j:(Hn?Sr:Mn).right;re(ro,Mn.top,Xo-ro,Mn.bottom)}else{var Yo,pr,Fa,If;Hn?(Yo=z&&$a&&or?R:Mn.left,pr=z?j:Br(jn,Zn,"before"),Fa=z?R:Br(wr,Zn,"after"),If=z&&bo&&Hi?j:Sr.right):(Yo=z?Br(jn,Zn,"before"):R,pr=!z&&$a&&or?j:Mn.right,Fa=!z&&bo&&Hi?R:Sr.left,If=z?Br(wr,Zn,"after"):j),re(Yo,Mn.top,pr-Yo,Mn.bottom),Mn.bottom<Sr.top&&re(R,Mn.bottom,null,Sr.top),re(Fa,Sr.top,If-Fa,Sr.bottom)}(!gn||_u(Mn,gn)<0)&&(gn=Mn),_u(Sr,gn)<0&&(gn=Sr),(!Xn||_u(Mn,Xn)<0)&&(Xn=Mn),_u(Sr,Xn)<0&&(Xn=Sr)}),{start:gn,end:Xn}}var Ce=c.from(),_e=c.to();if(Ce.line==_e.line)le(Ce.line,Ce.ch,_e.ch);else{var Fe=Ke(m,Ce.line),Ge=Ke(m,_e.line),nt=pi(Fe)==pi(Ge),ut=le(Ce.line,Ce.ch,nt?Fe.text.length+1:null).end,yt=le(_e.line,nt?0:null,_e.ch).start;nt&&(ut.top<yt.top-2?(re(ut.right,ut.top,null,ut.bottom),re(R,yt.top,yt.left,yt.bottom)):re(ut.right,ut.top,yt.left-ut.right,ut.bottom)),ut.bottom<yt.top&&re(R,ut.bottom,null,yt.top)}g.appendChild(C)}function uf(s){if(s.state.focused){var c=s.display;clearInterval(c.blinker);var g=!0;c.cursorDiv.style.visibility="",s.options.cursorBlinkRate>0?c.blinker=setInterval(function(){s.hasFocus()||Ma(s),c.cursorDiv.style.visibility=(g=!g)?"":"hidden"},s.options.cursorBlinkRate):s.options.cursorBlinkRate<0&&(c.cursorDiv.style.visibility="hidden")}}function om(s){s.hasFocus()||(s.display.input.focus(),s.state.focused||cf(s))}function df(s){s.state.delayingBlurEvent=!0,setTimeout(function(){s.state.delayingBlurEvent&&(s.state.delayingBlurEvent=!1,s.state.focused&&Ma(s))},100)}function cf(s,c){s.state.delayingBlurEvent&&!s.state.draggingText&&(s.state.delayingBlurEvent=!1),s.options.readOnly!="nocursor"&&(s.state.focused||(Xe(s,"focus",s,c),s.state.focused=!0,me(s.display.wrapper,"CodeMirror-focused"),!s.curOp&&s.display.selForContextMenu!=s.doc.sel&&(s.display.input.reset(),f&&setTimeout(function(){return s.display.input.reset(!0)},20)),s.display.input.receivedFocus()),uf(s))}function Ma(s,c){s.state.delayingBlurEvent||(s.state.focused&&(Xe(s,"blur",s,c),s.state.focused=!1,q(s.display.wrapper,"CodeMirror-focused")),clearInterval(s.display.blinker),setTimeout(function(){s.state.focused||(s.display.shift=!1)},150))}function bu(s){for(var c=s.display,g=c.lineDiv.offsetTop,p=Math.max(0,c.scroller.getBoundingClientRect().top),m=c.lineDiv.getBoundingClientRect().top,C=0,M=0;M<c.view.length;M++){var R=c.view[M],j=s.options.lineWrapping,z=void 0,re=0;if(!R.hidden){if(m+=R.line.height,u&&d<8){var le=R.node.offsetTop+R.node.offsetHeight;z=le-g,g=le}else{var Ce=R.node.getBoundingClientRect();z=Ce.bottom-Ce.top,!j&&R.text.firstChild&&(re=R.text.firstChild.getBoundingClientRect().right-Ce.left-1)}var _e=R.line.height-z;if((_e>.005||_e<-.005)&&(m<p&&(C-=_e),ee(R.line,z),am(R.line),R.rest))for(var Fe=0;Fe<R.rest.length;Fe++)am(R.rest[Fe]);if(re>s.display.sizerWidth){var Ge=Math.ceil(re/Oa(s.display));Ge>s.display.maxLineLength&&(s.display.maxLineLength=Ge,s.display.maxLine=R.line,s.display.maxLineChanged=!0)}}}Math.abs(C)>2&&(c.scroller.scrollTop+=C)}function am(s){if(s.widgets)for(var c=0;c<s.widgets.length;++c){var g=s.widgets[c],p=g.node.parentNode;p&&(g.height=p.offsetHeight)}}function xu(s,c,g){var p=g&&g.top!=null?Math.max(0,g.top):s.scroller.scrollTop;p=Math.floor(p-vu(s));var m=g&&g.bottom!=null?g.bottom:p+s.wrapper.clientHeight,C=Y(c,p),M=Y(c,m);if(g&&g.ensure){var R=g.ensure.from.line,j=g.ensure.to.line;R<C?(C=R,M=Y(c,Qi(Ke(c,R))+s.wrapper.clientHeight)):Math.min(j,c.lastLine())>=M&&(C=Y(c,Qi(Ke(c,j))-s.wrapper.clientHeight),M=j)}return{from:C,to:Math.max(M,C+1)}}function YS(s,c){if(!et(s,"scrollCursorIntoView")){var g=s.display,p=g.sizer.getBoundingClientRect(),m=null,C=g.wrapper.ownerDocument;if(c.top+p.top<0?m=!0:c.bottom+p.top>(C.defaultView.innerHeight||C.documentElement.clientHeight)&&(m=!1),m!=null&&!b){var M=$("div","​",null,`position: absolute;
                         top: `+(c.top-g.viewOffset-vu(s.display))+`px;
                         height: `+(c.bottom-c.top+Bi(s)+g.barHeight)+`px;
                         left: `+c.left+"px; width: "+Math.max(2,c.right-c.left)+"px;");s.display.lineSpace.appendChild(M),M.scrollIntoView(m),s.display.lineSpace.removeChild(M)}}}function KS(s,c,g,p){p==null&&(p=0);var m;!s.options.lineWrapping&&c==g&&(g=c.sticky=="before"?Ee(c.line,c.ch+1,"before"):c,c=c.ch?Ee(c.line,c.sticky=="before"?c.ch-1:c.ch,"after"):c);for(var C=0;C<5;C++){var M=!1,R=vi(s,c),j=!g||g==c?R:vi(s,g);m={left:Math.min(R.left,j.left),top:Math.min(R.top,j.top)-p,right:Math.max(R.left,j.left),bottom:Math.max(R.bottom,j.bottom)+p};var z=ff(s,m),re=s.doc.scrollTop,le=s.doc.scrollLeft;if(z.scrollTop!=null&&(Us(s,z.scrollTop),Math.abs(s.doc.scrollTop-re)>1&&(M=!0)),z.scrollLeft!=null&&(Vo(s,z.scrollLeft),Math.abs(s.doc.scrollLeft-le)>1&&(M=!0)),!M)break}return m}function JS(s,c){var g=ff(s,c);g.scrollTop!=null&&Us(s,g.scrollTop),g.scrollLeft!=null&&Vo(s,g.scrollLeft)}function ff(s,c){var g=s.display,p=ka(s.display);c.top<0&&(c.top=0);var m=s.curOp&&s.curOp.scrollTop!=null?s.curOp.scrollTop:g.scroller.scrollTop,C=Zc(s),M={};c.bottom-c.top>C&&(c.bottom=c.top+C);var R=s.doc.height+Jc(g),j=c.top<p,z=c.bottom>R-p;if(c.top<m)M.scrollTop=j?0:c.top;else if(c.bottom>m+C){var re=Math.min(c.top,(z?R:c.bottom)-C);re!=m&&(M.scrollTop=re)}var le=s.options.fixedGutter?0:g.gutters.offsetWidth,Ce=s.curOp&&s.curOp.scrollLeft!=null?s.curOp.scrollLeft:g.scroller.scrollLeft-le,_e=$o(s)-g.gutters.offsetWidth,Fe=c.right-c.left>_e;return Fe&&(c.right=c.left+_e),c.left<10?M.scrollLeft=0:c.left<Ce?M.scrollLeft=Math.max(0,c.left+le-(Fe?0:10)):c.right>_e+Ce-3&&(M.scrollLeft=c.right+(Fe?0:10)-_e),M}function hf(s,c){c!=null&&(wu(s),s.curOp.scrollTop=(s.curOp.scrollTop==null?s.doc.scrollTop:s.curOp.scrollTop)+c)}function Na(s){wu(s);var c=s.getCursor();s.curOp.scrollToPos={from:c,to:c,margin:s.options.cursorScrollMargin}}function zs(s,c,g){(c!=null||g!=null)&&wu(s),c!=null&&(s.curOp.scrollLeft=c),g!=null&&(s.curOp.scrollTop=g)}function ZS(s,c){wu(s),s.curOp.scrollToPos=c}function wu(s){var c=s.curOp.scrollToPos;if(c){s.curOp.scrollToPos=null;var g=Qg(s,c.from),p=Qg(s,c.to);sm(s,g,p,c.margin)}}function sm(s,c,g,p){var m=ff(s,{left:Math.min(c.left,g.left),top:Math.min(c.top,g.top)-p,right:Math.max(c.right,g.right),bottom:Math.max(c.bottom,g.bottom)+p});zs(s,m.scrollLeft,m.scrollTop)}function Us(s,c){Math.abs(s.doc.scrollTop-c)<2||(i||vf(s,{top:c}),lm(s,c,!0),i&&vf(s),Gs(s,100))}function lm(s,c,g){c=Math.max(0,Math.min(s.display.scroller.scrollHeight-s.display.scroller.clientHeight,c)),!(s.display.scroller.scrollTop==c&&!g)&&(s.doc.scrollTop=c,s.display.scrollbars.setScrollTop(c),s.display.scroller.scrollTop!=c&&(s.display.scroller.scrollTop=c))}function Vo(s,c,g,p){c=Math.max(0,Math.min(c,s.display.scroller.scrollWidth-s.display.scroller.clientWidth)),!((g?c==s.doc.scrollLeft:Math.abs(s.doc.scrollLeft-c)<2)&&!p)&&(s.doc.scrollLeft=c,hm(s),s.display.scroller.scrollLeft!=c&&(s.display.scroller.scrollLeft=c),s.display.scrollbars.setScrollLeft(c))}function Vs(s){var c=s.display,g=c.gutters.offsetWidth,p=Math.round(s.doc.height+Jc(s.display));return{clientHeight:c.scroller.clientHeight,viewHeight:c.wrapper.clientHeight,scrollWidth:c.scroller.scrollWidth,clientWidth:c.scroller.clientWidth,viewWidth:c.wrapper.clientWidth,barLeft:s.options.fixedGutter?g:0,docHeight:p,scrollHeight:p+Bi(s)+c.barHeight,nativeBarWidth:c.nativeBarWidth,gutterWidth:g}}var Wo=function(s,c,g){this.cm=g;var p=this.vert=$("div",[$("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),m=this.horiz=$("div",[$("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");p.tabIndex=m.tabIndex=-1,s(p),s(m),Ne(p,"scroll",function(){p.clientHeight&&c(p.scrollTop,"vertical")}),Ne(m,"scroll",function(){m.clientWidth&&c(m.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,u&&d<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Wo.prototype.update=function(s){var c=s.scrollWidth>s.clientWidth+1,g=s.scrollHeight>s.clientHeight+1,p=s.nativeBarWidth;if(g){this.vert.style.display="block",this.vert.style.bottom=c?p+"px":"0";var m=s.viewHeight-(c?p:0);this.vert.firstChild.style.height=Math.max(0,s.scrollHeight-s.clientHeight+m)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(c){this.horiz.style.display="block",this.horiz.style.right=g?p+"px":"0",this.horiz.style.left=s.barLeft+"px";var C=s.viewWidth-s.barLeft-(g?p:0);this.horiz.firstChild.style.width=Math.max(0,s.scrollWidth-s.clientWidth+C)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&s.clientHeight>0&&(p==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:g?p:0,bottom:c?p:0}},Wo.prototype.setScrollLeft=function(s){this.horiz.scrollLeft!=s&&(this.horiz.scrollLeft=s),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Wo.prototype.setScrollTop=function(s){this.vert.scrollTop!=s&&(this.vert.scrollTop=s),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Wo.prototype.zeroWidthHack=function(){var s=N&&!_?"12px":"18px";this.horiz.style.height=this.vert.style.width=s,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new he,this.disableVert=new he},Wo.prototype.enableZeroWidthBar=function(s,c,g){s.style.visibility="";function p(){var m=s.getBoundingClientRect(),C=g=="vert"?document.elementFromPoint(m.right-1,(m.top+m.bottom)/2):document.elementFromPoint((m.right+m.left)/2,m.bottom-1);C!=s?s.style.visibility="hidden":c.set(1e3,p)}c.set(1e3,p)},Wo.prototype.clear=function(){var s=this.horiz.parentNode;s.removeChild(this.horiz),s.removeChild(this.vert)};var Ws=function(){};Ws.prototype.update=function(){return{bottom:0,right:0}},Ws.prototype.setScrollLeft=function(){},Ws.prototype.setScrollTop=function(){},Ws.prototype.clear=function(){};function Aa(s,c){c||(c=Vs(s));var g=s.display.barWidth,p=s.display.barHeight;um(s,c);for(var m=0;m<4&&g!=s.display.barWidth||p!=s.display.barHeight;m++)g!=s.display.barWidth&&s.options.lineWrapping&&bu(s),um(s,Vs(s)),g=s.display.barWidth,p=s.display.barHeight}function um(s,c){var g=s.display,p=g.scrollbars.update(c);g.sizer.style.paddingRight=(g.barWidth=p.right)+"px",g.sizer.style.paddingBottom=(g.barHeight=p.bottom)+"px",g.heightForcer.style.borderBottom=p.bottom+"px solid transparent",p.right&&p.bottom?(g.scrollbarFiller.style.display="block",g.scrollbarFiller.style.height=p.bottom+"px",g.scrollbarFiller.style.width=p.right+"px"):g.scrollbarFiller.style.display="",p.bottom&&s.options.coverGutterNextToScrollbar&&s.options.fixedGutter?(g.gutterFiller.style.display="block",g.gutterFiller.style.height=p.bottom+"px",g.gutterFiller.style.width=c.gutterWidth+"px"):g.gutterFiller.style.display=""}var dm={native:Wo,null:Ws};function cm(s){s.display.scrollbars&&(s.display.scrollbars.clear(),s.display.scrollbars.addClass&&q(s.display.wrapper,s.display.scrollbars.addClass)),s.display.scrollbars=new dm[s.options.scrollbarStyle](function(c){s.display.wrapper.insertBefore(c,s.display.scrollbarFiller),Ne(c,"mousedown",function(){s.state.focused&&setTimeout(function(){return s.display.input.focus()},0)}),c.setAttribute("cm-not-content","true")},function(c,g){g=="horizontal"?Vo(s,c):Us(s,c)},s),s.display.scrollbars.addClass&&me(s.display.wrapper,s.display.scrollbars.addClass)}var QS=0;function Go(s){s.curOp={cm:s,viewChanged:!1,startHeight:s.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++QS,markArrays:null},AS(s.curOp)}function qo(s){var c=s.curOp;c&&DS(c,function(g){for(var p=0;p<g.ops.length;p++)g.ops[p].cm.curOp=null;eE(g)})}function eE(s){for(var c=s.ops,g=0;g<c.length;g++)tE(c[g]);for(var p=0;p<c.length;p++)nE(c[p]);for(var m=0;m<c.length;m++)rE(c[m]);for(var C=0;C<c.length;C++)iE(c[C]);for(var M=0;M<c.length;M++)oE(c[M])}function tE(s){var c=s.cm,g=c.display;sE(c),s.updateMaxLine&&Yc(c),s.mustUpdate=s.viewChanged||s.forceUpdate||s.scrollTop!=null||s.scrollToPos&&(s.scrollToPos.from.line<g.viewFrom||s.scrollToPos.to.line>=g.viewTo)||g.maxLineChanged&&c.options.lineWrapping,s.update=s.mustUpdate&&new Su(c,s.mustUpdate&&{top:s.scrollTop,ensure:s.scrollToPos},s.forceUpdate)}function nE(s){s.updatedDisplay=s.mustUpdate&&pf(s.cm,s.update)}function rE(s){var c=s.cm,g=c.display;s.updatedDisplay&&bu(c),s.barMeasure=Vs(c),g.maxLineChanged&&!c.options.lineWrapping&&(s.adjustWidthTo=Wg(c,g.maxLine,g.maxLine.text.length).left+3,c.display.sizerWidth=s.adjustWidthTo,s.barMeasure.scrollWidth=Math.max(g.scroller.clientWidth,g.sizer.offsetLeft+s.adjustWidthTo+Bi(c)+c.display.barWidth),s.maxScrollLeft=Math.max(0,g.sizer.offsetLeft+s.adjustWidthTo-$o(c))),(s.updatedDisplay||s.selectionChanged)&&(s.preparedSelection=g.input.prepareSelection())}function iE(s){var c=s.cm;s.adjustWidthTo!=null&&(c.display.sizer.style.minWidth=s.adjustWidthTo+"px",s.maxScrollLeft<c.doc.scrollLeft&&Vo(c,Math.min(c.display.scroller.scrollLeft,s.maxScrollLeft),!0),c.display.maxLineChanged=!1);var g=s.focus&&s.focus==Se(ce(c));s.preparedSelection&&c.display.input.showSelection(s.preparedSelection,g),(s.updatedDisplay||s.startHeight!=c.doc.height)&&Aa(c,s.barMeasure),s.updatedDisplay&&mf(c,s.barMeasure),s.selectionChanged&&uf(c),c.state.focused&&s.updateInput&&c.display.input.reset(s.typing),g&&om(s.cm)}function oE(s){var c=s.cm,g=c.display,p=c.doc;if(s.updatedDisplay&&fm(c,s.update),g.wheelStartX!=null&&(s.scrollTop!=null||s.scrollLeft!=null||s.scrollToPos)&&(g.wheelStartX=g.wheelStartY=null),s.scrollTop!=null&&lm(c,s.scrollTop,s.forceScroll),s.scrollLeft!=null&&Vo(c,s.scrollLeft,!0,!0),s.scrollToPos){var m=KS(c,Bt(p,s.scrollToPos.from),Bt(p,s.scrollToPos.to),s.scrollToPos.margin);YS(c,m)}var C=s.maybeHiddenMarkers,M=s.maybeUnhiddenMarkers;if(C)for(var R=0;R<C.length;++R)C[R].lines.length||Xe(C[R],"hide");if(M)for(var j=0;j<M.length;++j)M[j].lines.length&&Xe(M[j],"unhide");g.wrapper.offsetHeight&&(p.scrollTop=c.display.scroller.scrollTop),s.changeObjs&&Xe(c,"changes",c,s.changeObjs),s.update&&s.update.finish()}function Ir(s,c){if(s.curOp)return c();Go(s);try{return c()}finally{qo(s)}}function Gn(s,c){return function(){if(s.curOp)return c.apply(s,arguments);Go(s);try{return c.apply(s,arguments)}finally{qo(s)}}}function hr(s){return function(){if(this.curOp)return s.apply(this,arguments);Go(this);try{return s.apply(this,arguments)}finally{qo(this)}}}function qn(s){return function(){var c=this.cm;if(!c||c.curOp)return s.apply(this,arguments);Go(c);try{return s.apply(this,arguments)}finally{qo(c)}}}function Gs(s,c){s.doc.highlightFrontier<s.display.viewTo&&s.state.highlight.set(c,ie(aE,s))}function aE(s){var c=s.doc;if(!(c.highlightFrontier>=s.display.viewTo)){var g=+new Date+s.options.workTime,p=co(s,c.highlightFrontier),m=[];c.iter(p.line,Math.min(c.first+c.size,s.display.viewTo+500),function(C){if(p.line>=s.display.viewFrom){var M=C.styles,R=C.text.length>s.options.maxHighlightLength?Q(c.mode,p.state):null,j=Gr(s,C,p,!0);R&&(p.state=R),C.styles=j.styles;var z=C.styleClasses,re=j.classes;re?C.styleClasses=re:z&&(C.styleClasses=null);for(var le=!M||M.length!=C.styles.length||z!=re&&(!z||!re||z.bgClass!=re.bgClass||z.textClass!=re.textClass),Ce=0;!le&&Ce<M.length;++Ce)le=M[Ce]!=C.styles[Ce];le&&m.push(p.line),C.stateAfter=p.save(),p.nextLine()}else C.text.length<=s.options.maxHighlightLength&&Uc(s,C.text,p),C.stateAfter=p.line%5==0?p.save():null,p.nextLine();if(+new Date>g)return Gs(s,s.options.workDelay),!0}),c.highlightFrontier=p.line,c.modeFrontier=Math.max(c.modeFrontier,p.line),m.length&&Ir(s,function(){for(var C=0;C<m.length;C++)ho(s,m[C],"text")})}}var Su=function(s,c,g){var p=s.display;this.viewport=c,this.visible=xu(p,s.doc,c),this.editorIsHidden=!p.wrapper.offsetWidth,this.wrapperHeight=p.wrapper.clientHeight,this.wrapperWidth=p.wrapper.clientWidth,this.oldDisplayWidth=$o(s),this.force=g,this.dims=of(s),this.events=[]};Su.prototype.signal=function(s,c){we(s,c)&&this.events.push(arguments)},Su.prototype.finish=function(){for(var s=0;s<this.events.length;s++)Xe.apply(null,this.events[s])};function sE(s){var c=s.display;!c.scrollbarsClipped&&c.scroller.offsetWidth&&(c.nativeBarWidth=c.scroller.offsetWidth-c.scroller.clientWidth,c.heightForcer.style.height=Bi(s)+"px",c.sizer.style.marginBottom=-c.nativeBarWidth+"px",c.sizer.style.borderRightWidth=Bi(s)+"px",c.scrollbarsClipped=!0)}function lE(s){if(s.hasFocus())return null;var c=Se(ce(s));if(!c||!de(s.display.lineDiv,c))return null;var g={activeElt:c};if(window.getSelection){var p=K(s).getSelection();p.anchorNode&&p.extend&&de(s.display.lineDiv,p.anchorNode)&&(g.anchorNode=p.anchorNode,g.anchorOffset=p.anchorOffset,g.focusNode=p.focusNode,g.focusOffset=p.focusOffset)}return g}function uE(s){if(!(!s||!s.activeElt||s.activeElt==Se(ue(s.activeElt)))&&(s.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(s.activeElt.nodeName)&&s.anchorNode&&de(document.body,s.anchorNode)&&de(document.body,s.focusNode))){var c=s.activeElt.ownerDocument,g=c.defaultView.getSelection(),p=c.createRange();p.setEnd(s.anchorNode,s.anchorOffset),p.collapse(!1),g.removeAllRanges(),g.addRange(p),g.extend(s.focusNode,s.focusOffset)}}function pf(s,c){var g=s.display,p=s.doc;if(c.editorIsHidden)return po(s),!1;if(!c.force&&c.visible.from>=g.viewFrom&&c.visible.to<=g.viewTo&&(g.updateLineNumbers==null||g.updateLineNumbers>=g.viewTo)&&g.renderedView==g.view&&rm(s)==0)return!1;pm(s)&&(po(s),c.dims=of(s));var m=p.first+p.size,C=Math.max(c.visible.from-s.options.viewportMargin,p.first),M=Math.min(m,c.visible.to+s.options.viewportMargin);g.viewFrom<C&&C-g.viewFrom<20&&(C=Math.max(p.first,g.viewFrom)),g.viewTo>M&&g.viewTo-M<20&&(M=Math.min(m,g.viewTo)),Zi&&(C=qc(s.doc,C),M=Lg(s.doc,M));var R=C!=g.viewFrom||M!=g.viewTo||g.lastWrapHeight!=c.wrapperHeight||g.lastWrapWidth!=c.wrapperWidth;qS(s,C,M),g.viewOffset=Qi(Ke(s.doc,g.viewFrom)),s.display.mover.style.top=g.viewOffset+"px";var j=rm(s);if(!R&&j==0&&!c.force&&g.renderedView==g.view&&(g.updateLineNumbers==null||g.updateLineNumbers>=g.viewTo))return!1;var z=lE(s);return j>4&&(g.lineDiv.style.display="none"),dE(s,g.updateLineNumbers,c.dims),j>4&&(g.lineDiv.style.display=""),g.renderedView=g.view,uE(z),D(g.cursorDiv),D(g.selectionDiv),g.gutters.style.height=g.sizer.style.minHeight=0,R&&(g.lastWrapHeight=c.wrapperHeight,g.lastWrapWidth=c.wrapperWidth,Gs(s,400)),g.updateLineNumbers=null,!0}function fm(s,c){for(var g=c.viewport,p=!0;;p=!1){if(!p||!s.options.lineWrapping||c.oldDisplayWidth==$o(s)){if(g&&g.top!=null&&(g={top:Math.min(s.doc.height+Jc(s.display)-Zc(s),g.top)}),c.visible=xu(s.display,s.doc,g),c.visible.from>=s.display.viewFrom&&c.visible.to<=s.display.viewTo)break}else p&&(c.visible=xu(s.display,s.doc,g));if(!pf(s,c))break;bu(s);var m=Vs(s);Fs(s),Aa(s,m),mf(s,m),c.force=!1}c.signal(s,"update",s),(s.display.viewFrom!=s.display.reportedViewFrom||s.display.viewTo!=s.display.reportedViewTo)&&(c.signal(s,"viewportChange",s,s.display.viewFrom,s.display.viewTo),s.display.reportedViewFrom=s.display.viewFrom,s.display.reportedViewTo=s.display.viewTo)}function vf(s,c){var g=new Su(s,c);if(pf(s,g)){bu(s),fm(s,g);var p=Vs(s);Fs(s),Aa(s,p),mf(s,p),g.finish()}}function dE(s,c,g){var p=s.display,m=s.options.lineNumbers,C=p.lineDiv,M=C.firstChild;function R(Fe){var Ge=Fe.nextSibling;return f&&N&&s.display.currentWheelTarget==Fe?Fe.style.display="none":Fe.parentNode.removeChild(Fe),Ge}for(var j=p.view,z=p.viewFrom,re=0;re<j.length;re++){var le=j[re];if(!le.hidden)if(!le.node||le.node.parentNode!=C){var Ce=BS(s,le,z,g);C.insertBefore(Ce,M)}else{for(;M!=le.node;)M=R(M);var _e=m&&c!=null&&c<=z&&le.lineNumber;le.changes&&(be(le.changes,"gutter")>-1&&(_e=!1),jg(s,le,z,g)),_e&&(D(le.lineNumber),le.lineNumber.appendChild(document.createTextNode(Pe(s.options,z)))),M=le.node.nextSibling}z+=le.size}for(;M;)M=R(M)}function gf(s){var c=s.gutters.offsetWidth;s.sizer.style.marginLeft=c+"px",Wn(s,"gutterChanged",s)}function mf(s,c){s.display.sizer.style.minHeight=c.docHeight+"px",s.display.heightForcer.style.top=c.docHeight+"px",s.display.gutters.style.height=c.docHeight+s.display.barHeight+Bi(s)+"px"}function hm(s){var c=s.display,g=c.view;if(!(!c.alignWidgets&&(!c.gutters.firstChild||!s.options.fixedGutter))){for(var p=af(c)-c.scroller.scrollLeft+s.doc.scrollLeft,m=c.gutters.offsetWidth,C=p+"px",M=0;M<g.length;M++)if(!g[M].hidden){s.options.fixedGutter&&(g[M].gutter&&(g[M].gutter.style.left=C),g[M].gutterBackground&&(g[M].gutterBackground.style.left=C));var R=g[M].alignable;if(R)for(var j=0;j<R.length;j++)R[j].style.left=C}s.options.fixedGutter&&(c.gutters.style.left=p+m+"px")}}function pm(s){if(!s.options.lineNumbers)return!1;var c=s.doc,g=Pe(s.options,c.first+c.size-1),p=s.display;if(g.length!=p.lineNumChars){var m=p.measure.appendChild($("div",[$("div",g)],"CodeMirror-linenumber CodeMirror-gutter-elt")),C=m.firstChild.offsetWidth,M=m.offsetWidth-C;return p.lineGutter.style.width="",p.lineNumInnerWidth=Math.max(C,p.lineGutter.offsetWidth-M)+1,p.lineNumWidth=p.lineNumInnerWidth+M,p.lineNumChars=p.lineNumInnerWidth?g.length:-1,p.lineGutter.style.width=p.lineNumWidth+"px",gf(s.display),!0}return!1}function yf(s,c){for(var g=[],p=!1,m=0;m<s.length;m++){var C=s[m],M=null;if(typeof C!="string"&&(M=C.style,C=C.className),C=="CodeMirror-linenumbers")if(c)p=!0;else continue;g.push({className:C,style:M})}return c&&!p&&g.push({className:"CodeMirror-linenumbers",style:null}),g}function vm(s){var c=s.gutters,g=s.gutterSpecs;D(c),s.lineGutter=null;for(var p=0;p<g.length;++p){var m=g[p],C=m.className,M=m.style,R=c.appendChild($("div",null,"CodeMirror-gutter "+C));M&&(R.style.cssText=M),C=="CodeMirror-linenumbers"&&(s.lineGutter=R,R.style.width=(s.lineNumWidth||1)+"px")}c.style.display=g.length?"":"none",gf(s)}function qs(s){vm(s.display),_r(s),hm(s)}function cE(s,c,g,p){var m=this;this.input=g,m.scrollbarFiller=$("div",null,"CodeMirror-scrollbar-filler"),m.scrollbarFiller.setAttribute("cm-not-content","true"),m.gutterFiller=$("div",null,"CodeMirror-gutter-filler"),m.gutterFiller.setAttribute("cm-not-content","true"),m.lineDiv=pe("div",null,"CodeMirror-code"),m.selectionDiv=$("div",null,null,"position: relative; z-index: 1"),m.cursorDiv=$("div",null,"CodeMirror-cursors"),m.measure=$("div",null,"CodeMirror-measure"),m.lineMeasure=$("div",null,"CodeMirror-measure"),m.lineSpace=pe("div",[m.measure,m.lineMeasure,m.selectionDiv,m.cursorDiv,m.lineDiv],null,"position: relative; outline: none");var C=pe("div",[m.lineSpace],"CodeMirror-lines");m.mover=$("div",[C],null,"position: relative"),m.sizer=$("div",[m.mover],"CodeMirror-sizer"),m.sizerWidth=null,m.heightForcer=$("div",null,null,"position: absolute; height: "+xe+"px; width: 1px;"),m.gutters=$("div",null,"CodeMirror-gutters"),m.lineGutter=null,m.scroller=$("div",[m.sizer,m.heightForcer,m.gutters],"CodeMirror-scroll"),m.scroller.setAttribute("tabIndex","-1"),m.wrapper=$("div",[m.scrollbarFiller,m.gutterFiller,m.scroller],"CodeMirror"),v&&y>=105&&(m.wrapper.style.clipPath="inset(0px)"),m.wrapper.setAttribute("translate","no"),u&&d<8&&(m.gutters.style.zIndex=-1,m.scroller.style.paddingRight=0),!f&&!(i&&O)&&(m.scroller.draggable=!0),s&&(s.appendChild?s.appendChild(m.wrapper):s(m.wrapper)),m.viewFrom=m.viewTo=c.first,m.reportedViewFrom=m.reportedViewTo=c.first,m.view=[],m.renderedView=null,m.externalMeasured=null,m.viewOffset=0,m.lastWrapHeight=m.lastWrapWidth=0,m.updateLineNumbers=null,m.nativeBarWidth=m.barHeight=m.barWidth=0,m.scrollbarsClipped=!1,m.lineNumWidth=m.lineNumInnerWidth=m.lineNumChars=null,m.alignWidgets=!1,m.cachedCharWidth=m.cachedTextHeight=m.cachedPaddingH=null,m.maxLine=null,m.maxLineLength=0,m.maxLineChanged=!1,m.wheelDX=m.wheelDY=m.wheelStartX=m.wheelStartY=null,m.shift=!1,m.selForContextMenu=null,m.activeTouch=null,m.gutterSpecs=yf(p.gutters,p.lineNumbers),vm(m),g.init(m)}var Eu=0,to=null;u?to=-.53:i?to=15:v?to=-.7:w&&(to=-1/3);function gm(s){var c=s.wheelDeltaX,g=s.wheelDeltaY;return c==null&&s.detail&&s.axis==s.HORIZONTAL_AXIS&&(c=s.detail),g==null&&s.detail&&s.axis==s.VERTICAL_AXIS?g=s.detail:g==null&&(g=s.wheelDelta),{x:c,y:g}}function fE(s){var c=gm(s);return c.x*=to,c.y*=to,c}function mm(s,c){v&&y==102&&(s.display.chromeScrollHack==null?s.display.sizer.style.pointerEvents="none":clearTimeout(s.display.chromeScrollHack),s.display.chromeScrollHack=setTimeout(function(){s.display.chromeScrollHack=null,s.display.sizer.style.pointerEvents=""},100));var g=gm(c),p=g.x,m=g.y,C=to;c.deltaMode===0&&(p=c.deltaX,m=c.deltaY,C=1);var M=s.display,R=M.scroller,j=R.scrollWidth>R.clientWidth,z=R.scrollHeight>R.clientHeight;if(p&&j||m&&z){if(m&&N&&f){e:for(var re=c.target,le=M.view;re!=R;re=re.parentNode)for(var Ce=0;Ce<le.length;Ce++)if(le[Ce].node==re){s.display.currentWheelTarget=re;break e}}if(p&&!i&&!x&&C!=null){m&&z&&Us(s,Math.max(0,R.scrollTop+m*C)),Vo(s,Math.max(0,R.scrollLeft+p*C)),(!m||m&&z)&&ft(c),M.wheelStartX=null;return}if(m&&C!=null){var _e=m*C,Fe=s.doc.scrollTop,Ge=Fe+M.wrapper.clientHeight;_e<0?Fe=Math.max(0,Fe+_e-50):Ge=Math.min(s.doc.height,Ge+_e+50),vf(s,{top:Fe,bottom:Ge})}Eu<20&&c.deltaMode!==0&&(M.wheelStartX==null?(M.wheelStartX=R.scrollLeft,M.wheelStartY=R.scrollTop,M.wheelDX=p,M.wheelDY=m,setTimeout(function(){if(M.wheelStartX!=null){var nt=R.scrollLeft-M.wheelStartX,ut=R.scrollTop-M.wheelStartY,yt=ut&&M.wheelDY&&ut/M.wheelDY||nt&&M.wheelDX&&nt/M.wheelDX;M.wheelStartX=M.wheelStartY=null,yt&&(to=(to*Eu+yt)/(Eu+1),++Eu)}},200)):(M.wheelDX+=p,M.wheelDY+=m))}}var qr=function(s,c){this.ranges=s,this.primIndex=c};qr.prototype.primary=function(){return this.ranges[this.primIndex]},qr.prototype.equals=function(s){if(s==this)return!0;if(s.primIndex!=this.primIndex||s.ranges.length!=this.ranges.length)return!1;for(var c=0;c<this.ranges.length;c++){var g=this.ranges[c],p=s.ranges[c];if(!ot(g.anchor,p.anchor)||!ot(g.head,p.head))return!1}return!0},qr.prototype.deepCopy=function(){for(var s=[],c=0;c<this.ranges.length;c++)s[c]=new ln(wt(this.ranges[c].anchor),wt(this.ranges[c].head));return new qr(s,this.primIndex)},qr.prototype.somethingSelected=function(){for(var s=0;s<this.ranges.length;s++)if(!this.ranges[s].empty())return!0;return!1},qr.prototype.contains=function(s,c){c||(c=s);for(var g=0;g<this.ranges.length;g++){var p=this.ranges[g];if(Me(c,p.from())>=0&&Me(s,p.to())<=0)return g}return-1};var ln=function(s,c){this.anchor=s,this.head=c};ln.prototype.from=function(){return Rn(this.anchor,this.head)},ln.prototype.to=function(){return Pt(this.anchor,this.head)},ln.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function gi(s,c,g){var p=s&&s.options.selectionsMayTouch,m=c[g];c.sort(function(Ce,_e){return Me(Ce.from(),_e.from())}),g=be(c,m);for(var C=1;C<c.length;C++){var M=c[C],R=c[C-1],j=Me(R.to(),M.from());if(p&&!M.empty()?j>0:j>=0){var z=Rn(R.from(),M.from()),re=Pt(R.to(),M.to()),le=R.empty()?M.from()==M.head:R.from()==R.head;C<=g&&--g,c.splice(--C,2,new ln(le?re:z,le?z:re))}}return new qr(c,g)}function vo(s,c){return new qr([new ln(s,c||s)],0)}function go(s){return s.text?Ee(s.from.line+s.text.length-1,A(s.text).length+(s.text.length==1?s.from.ch:0)):s.to}function ym(s,c){if(Me(s,c.from)<0)return s;if(Me(s,c.to)<=0)return go(c);var g=s.line+c.text.length-(c.to.line-c.from.line)-1,p=s.ch;return s.line==c.to.line&&(p+=go(c).ch-c.to.ch),Ee(g,p)}function _f(s,c){for(var g=[],p=0;p<s.sel.ranges.length;p++){var m=s.sel.ranges[p];g.push(new ln(ym(m.anchor,c),ym(m.head,c)))}return gi(s.cm,g,s.sel.primIndex)}function _m(s,c,g){return s.line==c.line?Ee(g.line,s.ch-c.ch+g.ch):Ee(g.line+(s.line-c.line),s.ch)}function hE(s,c,g){for(var p=[],m=Ee(s.first,0),C=m,M=0;M<c.length;M++){var R=c[M],j=_m(R.from,m,C),z=_m(go(R),m,C);if(m=R.to,C=z,g=="around"){var re=s.sel.ranges[M],le=Me(re.head,re.anchor)<0;p[M]=new ln(le?z:j,le?j:z)}else p[M]=new ln(j,j)}return new qr(p,s.sel.primIndex)}function bf(s){s.doc.mode=ti(s.options,s.doc.modeOption),Xs(s)}function Xs(s){s.doc.iter(function(c){c.stateAfter&&(c.stateAfter=null),c.styles&&(c.styles=null)}),s.doc.modeFrontier=s.doc.highlightFrontier=s.doc.first,Gs(s,100),s.state.modeGen++,s.curOp&&_r(s)}function bm(s,c){return c.from.ch==0&&c.to.ch==0&&A(c.text)==""&&(!s.cm||s.cm.options.wholeLineUpdateBefore)}function xf(s,c,g,p){function m(yt){return g?g[yt]:null}function C(yt,dt,xt){xS(yt,dt,xt,p),Wn(yt,"change",yt,c)}function M(yt,dt){for(var xt=[],At=yt;At<dt;++At)xt.push(new Sa(z[At],m(At),p));return xt}var R=c.from,j=c.to,z=c.text,re=Ke(s,R.line),le=Ke(s,j.line),Ce=A(z),_e=m(z.length-1),Fe=j.line-R.line;if(c.full)s.insert(0,M(0,z.length)),s.remove(z.length,s.size-z.length);else if(bm(s,c)){var Ge=M(0,z.length-1);C(le,le.text,_e),Fe&&s.remove(R.line,Fe),Ge.length&&s.insert(R.line,Ge)}else if(re==le)if(z.length==1)C(re,re.text.slice(0,R.ch)+Ce+re.text.slice(j.ch),_e);else{var nt=M(1,z.length-1);nt.push(new Sa(Ce+re.text.slice(j.ch),_e,p)),C(re,re.text.slice(0,R.ch)+z[0],m(0)),s.insert(R.line+1,nt)}else if(z.length==1)C(re,re.text.slice(0,R.ch)+z[0]+le.text.slice(j.ch),m(0)),s.remove(R.line+1,Fe);else{C(re,re.text.slice(0,R.ch)+z[0],m(0)),C(le,Ce+le.text.slice(j.ch),_e);var ut=M(1,z.length-1);Fe>1&&s.remove(R.line+1,Fe-1),s.insert(R.line+1,ut)}Wn(s,"change",s,c)}function mo(s,c,g){function p(m,C,M){if(m.linked)for(var R=0;R<m.linked.length;++R){var j=m.linked[R];if(j.doc!=C){var z=M&&j.sharedHist;g&&!z||(c(j.doc,z),p(j.doc,m,z))}}}p(s,null,!0)}function xm(s,c){if(c.cm)throw new Error("This document is already in use.");s.doc=c,c.cm=s,sf(s),bf(s),wm(s),s.options.direction=c.direction,s.options.lineWrapping||Yc(s),s.options.mode=c.modeOption,_r(s)}function wm(s){(s.doc.direction=="rtl"?me:q)(s.display.lineDiv,"CodeMirror-rtl")}function pE(s){Ir(s,function(){wm(s),_r(s)})}function Cu(s){this.done=[],this.undone=[],this.undoDepth=s?s.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=s?s.maxGeneration:1}function wf(s,c){var g={from:wt(c.from),to:go(c),text:Ut(s,c.from,c.to)};return Cm(s,g,c.from.line,c.to.line+1),mo(s,function(p){return Cm(p,g,c.from.line,c.to.line+1)},!0),g}function Sm(s){for(;s.length;){var c=A(s);if(c.ranges)s.pop();else break}}function vE(s,c){if(c)return Sm(s.done),A(s.done);if(s.done.length&&!A(s.done).ranges)return A(s.done);if(s.done.length>1&&!s.done[s.done.length-2].ranges)return s.done.pop(),A(s.done)}function Em(s,c,g,p){var m=s.history;m.undone.length=0;var C=+new Date,M,R;if((m.lastOp==p||m.lastOrigin==c.origin&&c.origin&&(c.origin.charAt(0)=="+"&&m.lastModTime>C-(s.cm?s.cm.options.historyEventDelay:500)||c.origin.charAt(0)=="*"))&&(M=vE(m,m.lastOp==p)))R=A(M.changes),Me(c.from,c.to)==0&&Me(c.from,R.to)==0?R.to=go(c):M.changes.push(wf(s,c));else{var j=A(m.done);for((!j||!j.ranges)&&ku(s.sel,m.done),M={changes:[wf(s,c)],generation:m.generation},m.done.push(M);m.done.length>m.undoDepth;)m.done.shift(),m.done[0].ranges||m.done.shift()}m.done.push(g),m.generation=++m.maxGeneration,m.lastModTime=m.lastSelTime=C,m.lastOp=m.lastSelOp=p,m.lastOrigin=m.lastSelOrigin=c.origin,R||Xe(s,"historyAdded")}function gE(s,c,g,p){var m=c.charAt(0);return m=="*"||m=="+"&&g.ranges.length==p.ranges.length&&g.somethingSelected()==p.somethingSelected()&&new Date-s.history.lastSelTime<=(s.cm?s.cm.options.historyEventDelay:500)}function mE(s,c,g,p){var m=s.history,C=p&&p.origin;g==m.lastSelOp||C&&m.lastSelOrigin==C&&(m.lastModTime==m.lastSelTime&&m.lastOrigin==C||gE(s,C,A(m.done),c))?m.done[m.done.length-1]=c:ku(c,m.done),m.lastSelTime=+new Date,m.lastSelOrigin=C,m.lastSelOp=g,p&&p.clearRedo!==!1&&Sm(m.undone)}function ku(s,c){var g=A(c);g&&g.ranges&&g.equals(s)||c.push(s)}function Cm(s,c,g,p){var m=c["spans_"+s.id],C=0;s.iter(Math.max(s.first,g),Math.min(s.first+s.size,p),function(M){M.markedSpans&&((m||(m=c["spans_"+s.id]={}))[C]=M.markedSpans),++C})}function yE(s){if(!s)return null;for(var c,g=0;g<s.length;++g)s[g].marker.explicitlyCleared?c||(c=s.slice(0,g)):c&&c.push(s[g]);return c?c.length?c:null:s}function _E(s,c){var g=c["spans_"+s.id];if(!g)return null;for(var p=[],m=0;m<c.text.length;++m)p.push(yE(g[m]));return p}function km(s,c){var g=_E(s,c),p=Wc(s,c);if(!g)return p;if(!p)return g;for(var m=0;m<g.length;++m){var C=g[m],M=p[m];if(C&&M)e:for(var R=0;R<M.length;++R){for(var j=M[R],z=0;z<C.length;++z)if(C[z].marker==j.marker)continue e;C.push(j)}else M&&(g[m]=M)}return g}function Ta(s,c,g){for(var p=[],m=0;m<s.length;++m){var C=s[m];if(C.ranges){p.push(g?qr.prototype.deepCopy.call(C):C);continue}var M=C.changes,R=[];p.push({changes:R});for(var j=0;j<M.length;++j){var z=M[j],re=void 0;if(R.push({from:z.from,to:z.to,text:z.text}),c)for(var le in z)(re=le.match(/^spans_(\d+)$/))&&be(c,Number(re[1]))>-1&&(A(R)[le]=z[le],delete z[le])}}return p}function Sf(s,c,g,p){if(p){var m=s.anchor;if(g){var C=Me(c,m)<0;C!=Me(g,m)<0?(m=c,c=g):C!=Me(c,g)<0&&(c=g)}return new ln(m,c)}else return new ln(g||c,c)}function Ou(s,c,g,p,m){m==null&&(m=s.cm&&(s.cm.display.shift||s.extend)),ir(s,new qr([Sf(s.sel.primary(),c,g,m)],0),p)}function Om(s,c,g){for(var p=[],m=s.cm&&(s.cm.display.shift||s.extend),C=0;C<s.sel.ranges.length;C++)p[C]=Sf(s.sel.ranges[C],c[C],null,m);var M=gi(s.cm,p,s.sel.primIndex);ir(s,M,g)}function Ef(s,c,g,p){var m=s.sel.ranges.slice(0);m[c]=g,ir(s,gi(s.cm,m,s.sel.primIndex),p)}function Mm(s,c,g,p){ir(s,vo(c,g),p)}function bE(s,c,g){var p={ranges:c.ranges,update:function(m){this.ranges=[];for(var C=0;C<m.length;C++)this.ranges[C]=new ln(Bt(s,m[C].anchor),Bt(s,m[C].head))},origin:g&&g.origin};return Xe(s,"beforeSelectionChange",s,p),s.cm&&Xe(s.cm,"beforeSelectionChange",s.cm,p),p.ranges!=c.ranges?gi(s.cm,p.ranges,p.ranges.length-1):c}function Nm(s,c,g){var p=s.history.done,m=A(p);m&&m.ranges?(p[p.length-1]=c,Mu(s,c,g)):ir(s,c,g)}function ir(s,c,g){Mu(s,c,g),mE(s,s.sel,s.cm?s.cm.curOp.id:NaN,g)}function Mu(s,c,g){(we(s,"beforeSelectionChange")||s.cm&&we(s.cm,"beforeSelectionChange"))&&(c=bE(s,c,g));var p=g&&g.bias||(Me(c.primary().head,s.sel.primary().head)<0?-1:1);Am(s,Dm(s,c,p,!0)),!(g&&g.scroll===!1)&&s.cm&&s.cm.getOption("readOnly")!="nocursor"&&Na(s.cm)}function Am(s,c){c.equals(s.sel)||(s.sel=c,s.cm&&(s.cm.curOp.updateInput=1,s.cm.curOp.selectionChanged=!0,lt(s.cm)),Wn(s,"cursorActivity",s))}function Tm(s){Am(s,Dm(s,s.sel,null,!1))}function Dm(s,c,g,p){for(var m,C=0;C<c.ranges.length;C++){var M=c.ranges[C],R=c.ranges.length==s.sel.ranges.length&&s.sel.ranges[C],j=Nu(s,M.anchor,R&&R.anchor,g,p),z=M.head==M.anchor?j:Nu(s,M.head,R&&R.head,g,p);(m||j!=M.anchor||z!=M.head)&&(m||(m=c.ranges.slice(0,C)),m[C]=new ln(j,z))}return m?gi(s.cm,m,c.primIndex):c}function Da(s,c,g,p,m){var C=Ke(s,c.line);if(C.markedSpans)for(var M=0;M<C.markedSpans.length;++M){var R=C.markedSpans[M],j=R.marker,z="selectLeft"in j?!j.selectLeft:j.inclusiveLeft,re="selectRight"in j?!j.selectRight:j.inclusiveRight;if((R.from==null||(z?R.from<=c.ch:R.from<c.ch))&&(R.to==null||(re?R.to>=c.ch:R.to>c.ch))){if(m&&(Xe(j,"beforeCursorEnter"),j.explicitlyCleared))if(C.markedSpans){--M;continue}else break;if(!j.atomic)continue;if(g){var le=j.find(p<0?1:-1),Ce=void 0;if((p<0?re:z)&&(le=Lm(s,le,-p,le&&le.line==c.line?C:null)),le&&le.line==c.line&&(Ce=Me(le,g))&&(p<0?Ce<0:Ce>0))return Da(s,le,c,p,m)}var _e=j.find(p<0?-1:1);return(p<0?z:re)&&(_e=Lm(s,_e,p,_e.line==c.line?C:null)),_e?Da(s,_e,c,p,m):null}}return c}function Nu(s,c,g,p,m){var C=p||1,M=Da(s,c,g,C,m)||!m&&Da(s,c,g,C,!0)||Da(s,c,g,-C,m)||!m&&Da(s,c,g,-C,!0);return M||(s.cantEdit=!0,Ee(s.first,0))}function Lm(s,c,g,p){return g<0&&c.ch==0?c.line>s.first?Bt(s,Ee(c.line-1)):null:g>0&&c.ch==(p||Ke(s,c.line)).text.length?c.line<s.first+s.size-1?Ee(c.line+1,0):null:new Ee(c.line,c.ch+g)}function Pm(s){s.setSelection(Ee(s.firstLine(),0),Ee(s.lastLine()),We)}function Rm(s,c,g){var p={canceled:!1,from:c.from,to:c.to,text:c.text,origin:c.origin,cancel:function(){return p.canceled=!0}};return g&&(p.update=function(m,C,M,R){m&&(p.from=Bt(s,m)),C&&(p.to=Bt(s,C)),M&&(p.text=M),R!==void 0&&(p.origin=R)}),Xe(s,"beforeChange",s,p),s.cm&&Xe(s.cm,"beforeChange",s.cm,p),p.canceled?(s.cm&&(s.cm.curOp.updateInput=2),null):{from:p.from,to:p.to,text:p.text,origin:p.origin}}function La(s,c,g){if(s.cm){if(!s.cm.curOp)return Gn(s.cm,La)(s,c,g);if(s.cm.state.suppressEdits)return}if(!((we(s,"beforeChange")||s.cm&&we(s.cm,"beforeChange"))&&(c=Rm(s,c,!0),!c))){var p=kg&&!g&&mS(s,c.from,c.to);if(p)for(var m=p.length-1;m>=0;--m)Im(s,{from:p[m].from,to:p[m].to,text:m?[""]:c.text,origin:c.origin});else Im(s,c)}}function Im(s,c){if(!(c.text.length==1&&c.text[0]==""&&Me(c.from,c.to)==0)){var g=_f(s,c);Em(s,c,g,s.cm?s.cm.curOp.id:NaN),Ys(s,c,g,Wc(s,c));var p=[];mo(s,function(m,C){!C&&be(p,m.history)==-1&&($m(m.history,c),p.push(m.history)),Ys(m,c,null,Wc(m,c))})}}function Au(s,c,g){var p=s.cm&&s.cm.state.suppressEdits;if(!(p&&!g)){for(var m=s.history,C,M=s.sel,R=c=="undo"?m.done:m.undone,j=c=="undo"?m.undone:m.done,z=0;z<R.length&&(C=R[z],!(g?C.ranges&&!C.equals(s.sel):!C.ranges));z++);if(z!=R.length){for(m.lastOrigin=m.lastSelOrigin=null;;)if(C=R.pop(),C.ranges){if(ku(C,j),g&&!C.equals(s.sel)){ir(s,C,{clearRedo:!1});return}M=C}else if(p){R.push(C);return}else break;var re=[];ku(M,j),j.push({changes:re,generation:m.generation}),m.generation=C.generation||++m.maxGeneration;for(var le=we(s,"beforeChange")||s.cm&&we(s.cm,"beforeChange"),Ce=function(Ge){var nt=C.changes[Ge];if(nt.origin=c,le&&!Rm(s,nt,!1))return R.length=0,{};re.push(wf(s,nt));var ut=Ge?_f(s,nt):A(R);Ys(s,nt,ut,km(s,nt)),!Ge&&s.cm&&s.cm.scrollIntoView({from:nt.from,to:go(nt)});var yt=[];mo(s,function(dt,xt){!xt&&be(yt,dt.history)==-1&&($m(dt.history,nt),yt.push(dt.history)),Ys(dt,nt,null,km(dt,nt))})},_e=C.changes.length-1;_e>=0;--_e){var Fe=Ce(_e);if(Fe)return Fe.v}}}}function Bm(s,c){if(c!=0&&(s.first+=c,s.sel=new qr(F(s.sel.ranges,function(m){return new ln(Ee(m.anchor.line+c,m.anchor.ch),Ee(m.head.line+c,m.head.ch))}),s.sel.primIndex),s.cm)){_r(s.cm,s.first,s.first-c,c);for(var g=s.cm.display,p=g.viewFrom;p<g.viewTo;p++)ho(s.cm,p,"gutter")}}function Ys(s,c,g,p){if(s.cm&&!s.cm.curOp)return Gn(s.cm,Ys)(s,c,g,p);if(c.to.line<s.first){Bm(s,c.text.length-1-(c.to.line-c.from.line));return}if(!(c.from.line>s.lastLine())){if(c.from.line<s.first){var m=c.text.length-1-(s.first-c.from.line);Bm(s,m),c={from:Ee(s.first,0),to:Ee(c.to.line+m,c.to.ch),text:[A(c.text)],origin:c.origin}}var C=s.lastLine();c.to.line>C&&(c={from:c.from,to:Ee(C,Ke(s,C).text.length),text:[c.text[0]],origin:c.origin}),c.removed=Ut(s,c.from,c.to),g||(g=_f(s,c)),s.cm?xE(s.cm,c,p):xf(s,c,p),Mu(s,g,We),s.cantEdit&&Nu(s,Ee(s.firstLine(),0))&&(s.cantEdit=!1)}}function xE(s,c,g){var p=s.doc,m=s.display,C=c.from,M=c.to,R=!1,j=C.line;s.options.lineWrapping||(j=P(pi(Ke(p,C.line))),p.iter(j,M.line+1,function(_e){if(_e==m.maxLine)return R=!0,!0})),p.sel.contains(c.from,c.to)>-1&&lt(s),xf(p,c,g,nm(s)),s.options.lineWrapping||(p.iter(j,C.line+c.text.length,function(_e){var Fe=hu(_e);Fe>m.maxLineLength&&(m.maxLine=_e,m.maxLineLength=Fe,m.maxLineChanged=!0,R=!1)}),R&&(s.curOp.updateMaxLine=!0)),dS(p,C.line),Gs(s,400);var z=c.text.length-(M.line-C.line)-1;c.full?_r(s):C.line==M.line&&c.text.length==1&&!bm(s.doc,c)?ho(s,C.line,"text"):_r(s,C.line,M.line+1,z);var re=we(s,"changes"),le=we(s,"change");if(le||re){var Ce={from:C,to:M,text:c.text,removed:c.removed,origin:c.origin};le&&Wn(s,"change",s,Ce),re&&(s.curOp.changeObjs||(s.curOp.changeObjs=[])).push(Ce)}s.display.selForContextMenu=null}function Pa(s,c,g,p,m){var C;p||(p=g),Me(p,g)<0&&(C=[p,g],g=C[0],p=C[1]),typeof c=="string"&&(c=s.splitLines(c)),La(s,{from:g,to:p,text:c,origin:m})}function jm(s,c,g,p){g<s.line?s.line+=p:c<s.line&&(s.line=c,s.ch=0)}function Hm(s,c,g,p){for(var m=0;m<s.length;++m){var C=s[m],M=!0;if(C.ranges){C.copied||(C=s[m]=C.deepCopy(),C.copied=!0);for(var R=0;R<C.ranges.length;R++)jm(C.ranges[R].anchor,c,g,p),jm(C.ranges[R].head,c,g,p);continue}for(var j=0;j<C.changes.length;++j){var z=C.changes[j];if(g<z.from.line)z.from=Ee(z.from.line+p,z.from.ch),z.to=Ee(z.to.line+p,z.to.ch);else if(c<=z.to.line){M=!1;break}}M||(s.splice(0,m+1),m=0)}}function $m(s,c){var g=c.from.line,p=c.to.line,m=c.text.length-(p-g)-1;Hm(s.done,g,p,m),Hm(s.undone,g,p,m)}function Ks(s,c,g,p){var m=c,C=c;return typeof c=="number"?C=Ke(s,Rs(s,c)):m=P(c),m==null?null:(p(C,m)&&s.cm&&ho(s.cm,m,g),C)}function Js(s){this.lines=s,this.parent=null;for(var c=0,g=0;g<s.length;++g)s[g].parent=this,c+=s[g].height;this.height=c}Js.prototype={chunkSize:function(){return this.lines.length},removeInner:function(s,c){for(var g=s,p=s+c;g<p;++g){var m=this.lines[g];this.height-=m.height,wS(m),Wn(m,"delete")}this.lines.splice(s,c)},collapse:function(s){s.push.apply(s,this.lines)},insertInner:function(s,c,g){this.height+=g,this.lines=this.lines.slice(0,s).concat(c).concat(this.lines.slice(s));for(var p=0;p<c.length;++p)c[p].parent=this},iterN:function(s,c,g){for(var p=s+c;s<p;++s)if(g(this.lines[s]))return!0}};function Zs(s){this.children=s;for(var c=0,g=0,p=0;p<s.length;++p){var m=s[p];c+=m.chunkSize(),g+=m.height,m.parent=this}this.size=c,this.height=g,this.parent=null}Zs.prototype={chunkSize:function(){return this.size},removeInner:function(s,c){this.size-=c;for(var g=0;g<this.children.length;++g){var p=this.children[g],m=p.chunkSize();if(s<m){var C=Math.min(c,m-s),M=p.height;if(p.removeInner(s,C),this.height-=M-p.height,m==C&&(this.children.splice(g--,1),p.parent=null),(c-=C)==0)break;s=0}else s-=m}if(this.size-c<25&&(this.children.length>1||!(this.children[0]instanceof Js))){var R=[];this.collapse(R),this.children=[new Js(R)],this.children[0].parent=this}},collapse:function(s){for(var c=0;c<this.children.length;++c)this.children[c].collapse(s)},insertInner:function(s,c,g){this.size+=c.length,this.height+=g;for(var p=0;p<this.children.length;++p){var m=this.children[p],C=m.chunkSize();if(s<=C){if(m.insertInner(s,c,g),m.lines&&m.lines.length>50){for(var M=m.lines.length%25+25,R=M;R<m.lines.length;){var j=new Js(m.lines.slice(R,R+=25));m.height-=j.height,this.children.splice(++p,0,j),j.parent=this}m.lines=m.lines.slice(0,M),this.maybeSpill()}break}s-=C}},maybeSpill:function(){if(!(this.children.length<=10)){var s=this;do{var c=s.children.splice(s.children.length-5,5),g=new Zs(c);if(s.parent){s.size-=g.size,s.height-=g.height;var m=be(s.parent.children,s);s.parent.children.splice(m+1,0,g)}else{var p=new Zs(s.children);p.parent=s,s.children=[p,g],s=p}g.parent=s.parent}while(s.children.length>10);s.parent.maybeSpill()}},iterN:function(s,c,g){for(var p=0;p<this.children.length;++p){var m=this.children[p],C=m.chunkSize();if(s<C){var M=Math.min(c,C-s);if(m.iterN(s,M,g))return!0;if((c-=M)==0)break;s=0}else s-=C}}};var Qs=function(s,c,g){if(g)for(var p in g)g.hasOwnProperty(p)&&(this[p]=g[p]);this.doc=s,this.node=c};Qs.prototype.clear=function(){var s=this.doc.cm,c=this.line.widgets,g=this.line,p=P(g);if(!(p==null||!c)){for(var m=0;m<c.length;++m)c[m]==this&&c.splice(m--,1);c.length||(g.widgets=null);var C=Hs(this);ee(g,Math.max(0,g.height-C)),s&&(Ir(s,function(){Fm(s,g,-C),ho(s,p,"widget")}),Wn(s,"lineWidgetCleared",s,this,p))}},Qs.prototype.changed=function(){var s=this,c=this.height,g=this.doc.cm,p=this.line;this.height=null;var m=Hs(this)-c;m&&(fo(this.doc,p)||ee(p,p.height+m),g&&Ir(g,function(){g.curOp.forceUpdate=!0,Fm(g,p,m),Wn(g,"lineWidgetChanged",g,s,P(p))}))},Je(Qs);function Fm(s,c,g){Qi(c)<(s.curOp&&s.curOp.scrollTop||s.doc.scrollTop)&&hf(s,g)}function wE(s,c,g,p){var m=new Qs(s,g,p),C=s.cm;return C&&m.noHScroll&&(C.display.alignWidgets=!0),Ks(s,c,"widget",function(M){var R=M.widgets||(M.widgets=[]);if(m.insertAt==null?R.push(m):R.splice(Math.min(R.length,Math.max(0,m.insertAt)),0,m),m.line=M,C&&!fo(s,M)){var j=Qi(M)<s.scrollTop;ee(M,M.height+Hs(m)),j&&hf(C,m.height),C.curOp.forceUpdate=!0}return!0}),C&&Wn(C,"lineWidgetAdded",C,m,typeof c=="number"?c:P(c)),m}var zm=0,yo=function(s,c){this.lines=[],this.type=c,this.doc=s,this.id=++zm};yo.prototype.clear=function(){if(!this.explicitlyCleared){var s=this.doc.cm,c=s&&!s.curOp;if(c&&Go(s),we(this,"clear")){var g=this.find();g&&Wn(this,"clear",g.from,g.to)}for(var p=null,m=null,C=0;C<this.lines.length;++C){var M=this.lines[C],R=Is(M.markedSpans,this);s&&!this.collapsed?ho(s,P(M),"text"):s&&(R.to!=null&&(m=P(M)),R.from!=null&&(p=P(M))),M.markedSpans=hS(M.markedSpans,R),R.from==null&&this.collapsed&&!fo(this.doc,M)&&s&&ee(M,ka(s.display))}if(s&&this.collapsed&&!s.options.lineWrapping)for(var j=0;j<this.lines.length;++j){var z=pi(this.lines[j]),re=hu(z);re>s.display.maxLineLength&&(s.display.maxLine=z,s.display.maxLineLength=re,s.display.maxLineChanged=!0)}p!=null&&s&&this.collapsed&&_r(s,p,m+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,s&&Tm(s.doc)),s&&Wn(s,"markerCleared",s,this,p,m),c&&qo(s),this.parent&&this.parent.clear()}},yo.prototype.find=function(s,c){s==null&&this.type=="bookmark"&&(s=1);for(var g,p,m=0;m<this.lines.length;++m){var C=this.lines[m],M=Is(C.markedSpans,this);if(M.from!=null&&(g=Ee(c?C:P(C),M.from),s==-1))return g;if(M.to!=null&&(p=Ee(c?C:P(C),M.to),s==1))return p}return g&&{from:g,to:p}},yo.prototype.changed=function(){var s=this,c=this.find(-1,!0),g=this,p=this.doc.cm;!c||!p||Ir(p,function(){var m=c.line,C=P(c.line),M=Qc(p,C);if(M&&(Xg(M),p.curOp.selectionChanged=p.curOp.forceUpdate=!0),p.curOp.updateMaxLine=!0,!fo(g.doc,m)&&g.height!=null){var R=g.height;g.height=null;var j=Hs(g)-R;j&&ee(m,m.height+j)}Wn(p,"markerChanged",p,s)})},yo.prototype.attachLine=function(s){if(!this.lines.length&&this.doc.cm){var c=this.doc.cm.curOp;(!c.maybeHiddenMarkers||be(c.maybeHiddenMarkers,this)==-1)&&(c.maybeUnhiddenMarkers||(c.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(s)},yo.prototype.detachLine=function(s){if(this.lines.splice(be(this.lines,s),1),!this.lines.length&&this.doc.cm){var c=this.doc.cm.curOp;(c.maybeHiddenMarkers||(c.maybeHiddenMarkers=[])).push(this)}},Je(yo);function Ra(s,c,g,p,m){if(p&&p.shared)return SE(s,c,g,p,m);if(s.cm&&!s.cm.curOp)return Gn(s.cm,Ra)(s,c,g,p,m);var C=new yo(s,m),M=Me(c,g);if(p&&ne(p,C,!1),M>0||M==0&&C.clearWhenEmpty!==!1)return C;if(C.replacedWith&&(C.collapsed=!0,C.widgetNode=pe("span",[C.replacedWith],"CodeMirror-widget"),p.handleMouseEvents||C.widgetNode.setAttribute("cm-ignore-events","true"),p.insertLeft&&(C.widgetNode.insertLeft=!0)),C.collapsed){if(Dg(s,c.line,c,g,C)||c.line!=g.line&&Dg(s,g.line,c,g,C))throw new Error("Inserting collapsed marker partially overlapping an existing one");fS()}C.addToHistory&&Em(s,{from:c,to:g,origin:"markText"},s.sel,NaN);var R=c.line,j=s.cm,z;if(s.iter(R,g.line+1,function(le){j&&C.collapsed&&!j.options.lineWrapping&&pi(le)==j.display.maxLine&&(z=!0),C.collapsed&&R!=c.line&&ee(le,0),pS(le,new uu(C,R==c.line?c.ch:null,R==g.line?g.ch:null),s.cm&&s.cm.curOp),++R}),C.collapsed&&s.iter(c.line,g.line+1,function(le){fo(s,le)&&ee(le,0)}),C.clearOnEnter&&Ne(C,"beforeCursorEnter",function(){return C.clear()}),C.readOnly&&(cS(),(s.history.done.length||s.history.undone.length)&&s.clearHistory()),C.collapsed&&(C.id=++zm,C.atomic=!0),j){if(z&&(j.curOp.updateMaxLine=!0),C.collapsed)_r(j,c.line,g.line+1);else if(C.className||C.startStyle||C.endStyle||C.css||C.attributes||C.title)for(var re=c.line;re<=g.line;re++)ho(j,re,"text");C.atomic&&Tm(j.doc),Wn(j,"markerAdded",j,C)}return C}var el=function(s,c){this.markers=s,this.primary=c;for(var g=0;g<s.length;++g)s[g].parent=this};el.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var s=0;s<this.markers.length;++s)this.markers[s].clear();Wn(this,"clear")}},el.prototype.find=function(s,c){return this.primary.find(s,c)},Je(el);function SE(s,c,g,p,m){p=ne(p),p.shared=!1;var C=[Ra(s,c,g,p,m)],M=C[0],R=p.widgetNode;return mo(s,function(j){R&&(p.widgetNode=R.cloneNode(!0)),C.push(Ra(j,Bt(j,c),Bt(j,g),p,m));for(var z=0;z<j.linked.length;++z)if(j.linked[z].isParent)return;M=A(C)}),new el(C,M)}function Um(s){return s.findMarks(Ee(s.first,0),s.clipPos(Ee(s.lastLine())),function(c){return c.parent})}function EE(s,c){for(var g=0;g<c.length;g++){var p=c[g],m=p.find(),C=s.clipPos(m.from),M=s.clipPos(m.to);if(Me(C,M)){var R=Ra(s,C,M,p.primary,p.primary.type);p.markers.push(R),R.parent=p}}}function CE(s){for(var c=function(p){var m=s[p],C=[m.primary.doc];mo(m.primary.doc,function(j){return C.push(j)});for(var M=0;M<m.markers.length;M++){var R=m.markers[M];be(C,R.doc)==-1&&(R.parent=null,m.markers.splice(M--,1))}},g=0;g<s.length;g++)c(g)}var kE=0,br=function(s,c,g,p,m){if(!(this instanceof br))return new br(s,c,g,p,m);g==null&&(g=0),Zs.call(this,[new Js([new Sa("",null)])]),this.first=g,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=g;var C=Ee(g,0);this.sel=vo(C),this.history=new Cu(null),this.id=++kE,this.modeOption=c,this.lineSep=p,this.direction=m=="rtl"?"rtl":"ltr",this.extend=!1,typeof s=="string"&&(s=this.splitLines(s)),xf(this,{from:C,to:C,text:s}),ir(this,vo(C),We)};br.prototype=se(Zs.prototype,{constructor:br,iter:function(s,c,g){g?this.iterN(s-this.first,c-s,g):this.iterN(this.first,this.first+this.size,s)},insert:function(s,c){for(var g=0,p=0;p<c.length;++p)g+=c[p].height;this.insertInner(s-this.first,c,g)},remove:function(s,c){this.removeInner(s-this.first,c)},getValue:function(s){var c=yn(this,this.first,this.first+this.size);return s===!1?c:c.join(s||this.lineSeparator())},setValue:qn(function(s){var c=Ee(this.first,0),g=this.first+this.size-1;La(this,{from:c,to:Ee(g,Ke(this,g).text.length),text:this.splitLines(s),origin:"setValue",full:!0},!0),this.cm&&zs(this.cm,0,0),ir(this,vo(c),We)}),replaceRange:function(s,c,g,p){c=Bt(this,c),g=g?Bt(this,g):c,Pa(this,s,c,g,p)},getRange:function(s,c,g){var p=Ut(this,Bt(this,s),Bt(this,c));return g===!1?p:g===""?p.join(""):p.join(g||this.lineSeparator())},getLine:function(s){var c=this.getLineHandle(s);return c&&c.text},getLineHandle:function(s){if(ye(this,s))return Ke(this,s)},getLineNumber:function(s){return P(s)},getLineHandleVisualStart:function(s){return typeof s=="number"&&(s=Ke(this,s)),pi(s)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(s){return Bt(this,s)},getCursor:function(s){var c=this.sel.primary(),g;return s==null||s=="head"?g=c.head:s=="anchor"?g=c.anchor:s=="end"||s=="to"||s===!1?g=c.to():g=c.from(),g},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:qn(function(s,c,g){Mm(this,Bt(this,typeof s=="number"?Ee(s,c||0):s),null,g)}),setSelection:qn(function(s,c,g){Mm(this,Bt(this,s),Bt(this,c||s),g)}),extendSelection:qn(function(s,c,g){Ou(this,Bt(this,s),c&&Bt(this,c),g)}),extendSelections:qn(function(s,c){Om(this,wa(this,s),c)}),extendSelectionsBy:qn(function(s,c){var g=F(this.sel.ranges,s);Om(this,wa(this,g),c)}),setSelections:qn(function(s,c,g){if(s.length){for(var p=[],m=0;m<s.length;m++)p[m]=new ln(Bt(this,s[m].anchor),Bt(this,s[m].head||s[m].anchor));c==null&&(c=Math.min(s.length-1,this.sel.primIndex)),ir(this,gi(this.cm,p,c),g)}}),addSelection:qn(function(s,c,g){var p=this.sel.ranges.slice(0);p.push(new ln(Bt(this,s),Bt(this,c||s))),ir(this,gi(this.cm,p,p.length-1),g)}),getSelection:function(s){for(var c=this.sel.ranges,g,p=0;p<c.length;p++){var m=Ut(this,c[p].from(),c[p].to());g=g?g.concat(m):m}return s===!1?g:g.join(s||this.lineSeparator())},getSelections:function(s){for(var c=[],g=this.sel.ranges,p=0;p<g.length;p++){var m=Ut(this,g[p].from(),g[p].to());s!==!1&&(m=m.join(s||this.lineSeparator())),c[p]=m}return c},replaceSelection:function(s,c,g){for(var p=[],m=0;m<this.sel.ranges.length;m++)p[m]=s;this.replaceSelections(p,c,g||"+input")},replaceSelections:qn(function(s,c,g){for(var p=[],m=this.sel,C=0;C<m.ranges.length;C++){var M=m.ranges[C];p[C]={from:M.from(),to:M.to(),text:this.splitLines(s[C]),origin:g}}for(var R=c&&c!="end"&&hE(this,p,c),j=p.length-1;j>=0;j--)La(this,p[j]);R?Nm(this,R):this.cm&&Na(this.cm)}),undo:qn(function(){Au(this,"undo")}),redo:qn(function(){Au(this,"redo")}),undoSelection:qn(function(){Au(this,"undo",!0)}),redoSelection:qn(function(){Au(this,"redo",!0)}),setExtending:function(s){this.extend=s},getExtending:function(){return this.extend},historySize:function(){for(var s=this.history,c=0,g=0,p=0;p<s.done.length;p++)s.done[p].ranges||++c;for(var m=0;m<s.undone.length;m++)s.undone[m].ranges||++g;return{undo:c,redo:g}},clearHistory:function(){var s=this;this.history=new Cu(this.history),mo(this,function(c){return c.history=s.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(s){return s&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(s){return this.history.generation==(s||this.cleanGeneration)},getHistory:function(){return{done:Ta(this.history.done),undone:Ta(this.history.undone)}},setHistory:function(s){var c=this.history=new Cu(this.history);c.done=Ta(s.done.slice(0),null,!0),c.undone=Ta(s.undone.slice(0),null,!0)},setGutterMarker:qn(function(s,c,g){return Ks(this,s,"gutter",function(p){var m=p.gutterMarkers||(p.gutterMarkers={});return m[c]=g,!g&&Le(m)&&(p.gutterMarkers=null),!0})}),clearGutter:qn(function(s){var c=this;this.iter(function(g){g.gutterMarkers&&g.gutterMarkers[s]&&Ks(c,g,"gutter",function(){return g.gutterMarkers[s]=null,Le(g.gutterMarkers)&&(g.gutterMarkers=null),!0})})}),lineInfo:function(s){var c;if(typeof s=="number"){if(!ye(this,s)||(c=s,s=Ke(this,s),!s))return null}else if(c=P(s),c==null)return null;return{line:c,handle:s,text:s.text,gutterMarkers:s.gutterMarkers,textClass:s.textClass,bgClass:s.bgClass,wrapClass:s.wrapClass,widgets:s.widgets}},addLineClass:qn(function(s,c,g){return Ks(this,s,c=="gutter"?"gutter":"class",function(p){var m=c=="text"?"textClass":c=="background"?"bgClass":c=="gutter"?"gutterClass":"wrapClass";if(!p[m])p[m]=g;else{if(V(g).test(p[m]))return!1;p[m]+=" "+g}return!0})}),removeLineClass:qn(function(s,c,g){return Ks(this,s,c=="gutter"?"gutter":"class",function(p){var m=c=="text"?"textClass":c=="background"?"bgClass":c=="gutter"?"gutterClass":"wrapClass",C=p[m];if(C)if(g==null)p[m]=null;else{var M=C.match(V(g));if(!M)return!1;var R=M.index+M[0].length;p[m]=C.slice(0,M.index)+(!M.index||R==C.length?"":" ")+C.slice(R)||null}else return!1;return!0})}),addLineWidget:qn(function(s,c,g){return wE(this,s,c,g)}),removeLineWidget:function(s){s.clear()},markText:function(s,c,g){return Ra(this,Bt(this,s),Bt(this,c),g,g&&g.type||"range")},setBookmark:function(s,c){var g={replacedWith:c&&(c.nodeType==null?c.widget:c),insertLeft:c&&c.insertLeft,clearWhenEmpty:!1,shared:c&&c.shared,handleMouseEvents:c&&c.handleMouseEvents};return s=Bt(this,s),Ra(this,s,s,g,"bookmark")},findMarksAt:function(s){s=Bt(this,s);var c=[],g=Ke(this,s.line).markedSpans;if(g)for(var p=0;p<g.length;++p){var m=g[p];(m.from==null||m.from<=s.ch)&&(m.to==null||m.to>=s.ch)&&c.push(m.marker.parent||m.marker)}return c},findMarks:function(s,c,g){s=Bt(this,s),c=Bt(this,c);var p=[],m=s.line;return this.iter(s.line,c.line+1,function(C){var M=C.markedSpans;if(M)for(var R=0;R<M.length;R++){var j=M[R];!(j.to!=null&&m==s.line&&s.ch>=j.to||j.from==null&&m!=s.line||j.from!=null&&m==c.line&&j.from>=c.ch)&&(!g||g(j.marker))&&p.push(j.marker.parent||j.marker)}++m}),p},getAllMarks:function(){var s=[];return this.iter(function(c){var g=c.markedSpans;if(g)for(var p=0;p<g.length;++p)g[p].from!=null&&s.push(g[p].marker)}),s},posFromIndex:function(s){var c,g=this.first,p=this.lineSeparator().length;return this.iter(function(m){var C=m.text.length+p;if(C>s)return c=s,!0;s-=C,++g}),Bt(this,Ee(g,c))},indexFromPos:function(s){s=Bt(this,s);var c=s.ch;if(s.line<this.first||s.ch<0)return 0;var g=this.lineSeparator().length;return this.iter(this.first,s.line,function(p){c+=p.text.length+g}),c},copy:function(s){var c=new br(yn(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return c.scrollTop=this.scrollTop,c.scrollLeft=this.scrollLeft,c.sel=this.sel,c.extend=!1,s&&(c.history.undoDepth=this.history.undoDepth,c.setHistory(this.getHistory())),c},linkedDoc:function(s){s||(s={});var c=this.first,g=this.first+this.size;s.from!=null&&s.from>c&&(c=s.from),s.to!=null&&s.to<g&&(g=s.to);var p=new br(yn(this,c,g),s.mode||this.modeOption,c,this.lineSep,this.direction);return s.sharedHist&&(p.history=this.history),(this.linked||(this.linked=[])).push({doc:p,sharedHist:s.sharedHist}),p.linked=[{doc:this,isParent:!0,sharedHist:s.sharedHist}],EE(p,Um(this)),p},unlinkDoc:function(s){if(s instanceof wn&&(s=s.doc),this.linked)for(var c=0;c<this.linked.length;++c){var g=this.linked[c];if(g.doc==s){this.linked.splice(c,1),s.unlinkDoc(this),CE(Um(this));break}}if(s.history==this.history){var p=[s.id];mo(s,function(m){return p.push(m.id)},!0),s.history=new Cu(null),s.history.done=Ta(this.history.done,p),s.history.undone=Ta(this.history.undone,p)}},iterLinkedDocs:function(s){mo(this,s)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(s){return this.lineSep?s.split(this.lineSep):Pn(s)},lineSeparator:function(){return this.lineSep||`
`},setDirection:qn(function(s){s!="rtl"&&(s="ltr"),s!=this.direction&&(this.direction=s,this.iter(function(c){return c.order=null}),this.cm&&pE(this.cm))})}),br.prototype.eachLine=br.prototype.iter;var Vm=0;function OE(s){var c=this;if(Wm(c),!(et(c,s)||eo(c.display,s))){ft(s),u&&(Vm=+new Date);var g=zo(c,s,!0),p=s.dataTransfer.files;if(!(!g||c.isReadOnly()))if(p&&p.length&&window.FileReader&&window.File)for(var m=p.length,C=Array(m),M=0,R=function(){++M==m&&Gn(c,function(){g=Bt(c.doc,g);var _e={from:g,to:g,text:c.doc.splitLines(C.filter(function(Fe){return Fe!=null}).join(c.doc.lineSeparator())),origin:"paste"};La(c.doc,_e),Nm(c.doc,vo(Bt(c.doc,g),Bt(c.doc,go(_e))))})()},j=function(_e,Fe){if(c.options.allowDropFileTypes&&be(c.options.allowDropFileTypes,_e.type)==-1){R();return}var Ge=new FileReader;Ge.onerror=function(){return R()},Ge.onload=function(){var nt=Ge.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(nt)){R();return}C[Fe]=nt,R()},Ge.readAsText(_e)},z=0;z<p.length;z++)j(p[z],z);else{if(c.state.draggingText&&c.doc.sel.contains(g)>-1){c.state.draggingText(s),setTimeout(function(){return c.display.input.focus()},20);return}try{var re=s.dataTransfer.getData("Text");if(re){var le;if(c.state.draggingText&&!c.state.draggingText.copy&&(le=c.listSelections()),Mu(c.doc,vo(g,g)),le)for(var Ce=0;Ce<le.length;++Ce)Pa(c.doc,"",le[Ce].anchor,le[Ce].head,"drag");c.replaceSelection(re,"around","paste"),c.display.input.focus()}}catch{}}}}function ME(s,c){if(u&&(!s.state.draggingText||+new Date-Vm<100)){Kt(c);return}if(!(et(s,c)||eo(s.display,c))&&(c.dataTransfer.setData("Text",s.getSelection()),c.dataTransfer.effectAllowed="copyMove",c.dataTransfer.setDragImage&&!w)){var g=$("img",null,null,"position: fixed; left: 0; top: 0;");g.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",x&&(g.width=g.height=1,s.display.wrapper.appendChild(g),g._top=g.offsetTop),c.dataTransfer.setDragImage(g,0,0),x&&g.parentNode.removeChild(g)}}function NE(s,c){var g=zo(s,c);if(g){var p=document.createDocumentFragment();lf(s,g,p),s.display.dragCursor||(s.display.dragCursor=$("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),s.display.lineSpace.insertBefore(s.display.dragCursor,s.display.cursorDiv)),W(s.display.dragCursor,p)}}function Wm(s){s.display.dragCursor&&(s.display.lineSpace.removeChild(s.display.dragCursor),s.display.dragCursor=null)}function Gm(s){if(document.getElementsByClassName){for(var c=document.getElementsByClassName("CodeMirror"),g=[],p=0;p<c.length;p++){var m=c[p].CodeMirror;m&&g.push(m)}g.length&&g[0].operation(function(){for(var C=0;C<g.length;C++)s(g[C])})}}var qm=!1;function AE(){qm||(TE(),qm=!0)}function TE(){var s;Ne(window,"resize",function(){s==null&&(s=setTimeout(function(){s=null,Gm(DE)},100))}),Ne(window,"blur",function(){return Gm(Ma)})}function DE(s){var c=s.display;c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.scrollbarsClipped=!1,s.setSize()}for(var _o={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},tl=0;tl<10;tl++)_o[tl+48]=_o[tl+96]=String(tl);for(var Tu=65;Tu<=90;Tu++)_o[Tu]=String.fromCharCode(Tu);for(var nl=1;nl<=12;nl++)_o[nl+111]=_o[nl+63235]="F"+nl;var no={};no.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},no.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},no.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},no.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},no.default=N?no.macDefault:no.pcDefault;function LE(s){var c=s.split(/-(?!$)/);s=c[c.length-1];for(var g,p,m,C,M=0;M<c.length-1;M++){var R=c[M];if(/^(cmd|meta|m)$/i.test(R))C=!0;else if(/^a(lt)?$/i.test(R))g=!0;else if(/^(c|ctrl|control)$/i.test(R))p=!0;else if(/^s(hift)?$/i.test(R))m=!0;else throw new Error("Unrecognized modifier name: "+R)}return g&&(s="Alt-"+s),p&&(s="Ctrl-"+s),C&&(s="Cmd-"+s),m&&(s="Shift-"+s),s}function PE(s){var c={};for(var g in s)if(s.hasOwnProperty(g)){var p=s[g];if(/^(name|fallthrough|(de|at)tach)$/.test(g))continue;if(p=="..."){delete s[g];continue}for(var m=F(g.split(" "),LE),C=0;C<m.length;C++){var M=void 0,R=void 0;C==m.length-1?(R=m.join(" "),M=p):(R=m.slice(0,C+1).join(" "),M="...");var j=c[R];if(!j)c[R]=M;else if(j!=M)throw new Error("Inconsistent bindings for "+R)}delete s[g]}for(var z in c)s[z]=c[z];return s}function Ia(s,c,g,p){c=Du(c);var m=c.call?c.call(s,p):c[s];if(m===!1)return"nothing";if(m==="...")return"multi";if(m!=null&&g(m))return"handled";if(c.fallthrough){if(Object.prototype.toString.call(c.fallthrough)!="[object Array]")return Ia(s,c.fallthrough,g,p);for(var C=0;C<c.fallthrough.length;C++){var M=Ia(s,c.fallthrough[C],g,p);if(M)return M}}}function Xm(s){var c=typeof s=="string"?s:_o[s.keyCode];return c=="Ctrl"||c=="Alt"||c=="Shift"||c=="Mod"}function Ym(s,c,g){var p=s;return c.altKey&&p!="Alt"&&(s="Alt-"+s),(H?c.metaKey:c.ctrlKey)&&p!="Ctrl"&&(s="Ctrl-"+s),(H?c.ctrlKey:c.metaKey)&&p!="Mod"&&(s="Cmd-"+s),!g&&c.shiftKey&&p!="Shift"&&(s="Shift-"+s),s}function Km(s,c){if(x&&s.keyCode==34&&s.char)return!1;var g=_o[s.keyCode];return g==null||s.altGraphKey?!1:(s.keyCode==3&&s.code&&(g=s.code),Ym(g,s,c))}function Du(s){return typeof s=="string"?no[s]:s}function Ba(s,c){for(var g=s.doc.sel.ranges,p=[],m=0;m<g.length;m++){for(var C=c(g[m]);p.length&&Me(C.from,A(p).to)<=0;){var M=p.pop();if(Me(M.from,C.from)<0){C.from=M.from;break}}p.push(C)}Ir(s,function(){for(var R=p.length-1;R>=0;R--)Pa(s.doc,"",p[R].from,p[R].to,"+delete");Na(s)})}function Cf(s,c,g){var p=vt(s.text,c+g,g);return p<0||p>s.text.length?null:p}function kf(s,c,g){var p=Cf(s,c.ch,g);return p==null?null:new Ee(c.line,p,g<0?"after":"before")}function Of(s,c,g,p,m){if(s){c.doc.direction=="rtl"&&(m=-m);var C=st(g,c.doc.direction);if(C){var M=m<0?A(C):C[0],R=m<0==(M.level==1),j=R?"after":"before",z;if(M.level>0||c.doc.direction=="rtl"){var re=Ca(c,g);z=m<0?g.text.length-1:0;var le=ji(c,re,z).top;z=bt(function(Ce){return ji(c,re,Ce).top==le},m<0==(M.level==1)?M.from:M.to-1,z),j=="before"&&(z=Cf(g,z,1))}else z=m<0?M.to:M.from;return new Ee(p,z,j)}}return new Ee(p,m<0?g.text.length:0,m<0?"before":"after")}function RE(s,c,g,p){var m=st(c,s.doc.direction);if(!m)return kf(c,g,p);g.ch>=c.text.length?(g.ch=c.text.length,g.sticky="before"):g.ch<=0&&(g.ch=0,g.sticky="after");var C=ht(m,g.ch,g.sticky),M=m[C];if(s.doc.direction=="ltr"&&M.level%2==0&&(p>0?M.to>g.ch:M.from<g.ch))return kf(c,g,p);var R=function(ut,yt){return Cf(c,ut instanceof Ee?ut.ch:ut,yt)},j,z=function(ut){return s.options.lineWrapping?(j=j||Ca(s,c),tm(s,c,j,ut)):{begin:0,end:c.text.length}},re=z(g.sticky=="before"?R(g,-1):g.ch);if(s.doc.direction=="rtl"||M.level==1){var le=M.level==1==p<0,Ce=R(g,le?1:-1);if(Ce!=null&&(le?Ce<=M.to&&Ce<=re.end:Ce>=M.from&&Ce>=re.begin)){var _e=le?"before":"after";return new Ee(g.line,Ce,_e)}}var Fe=function(ut,yt,dt){for(var xt=function(gn,Xn){return Xn?new Ee(g.line,R(gn,1),"before"):new Ee(g.line,gn,"after")};ut>=0&&ut<m.length;ut+=yt){var At=m[ut],Nt=yt>0==(At.level!=1),Vt=Nt?dt.begin:R(dt.end,-1);if(At.from<=Vt&&Vt<At.to||(Vt=Nt?At.from:R(At.to,-1),dt.begin<=Vt&&Vt<dt.end))return xt(Vt,Nt)}},Ge=Fe(C+p,p,re);if(Ge)return Ge;var nt=p>0?re.end:R(re.begin,-1);return nt!=null&&!(p>0&&nt==c.text.length)&&(Ge=Fe(p>0?0:m.length-1,p,z(nt)),Ge)?Ge:null}var rl={selectAll:Pm,singleSelection:function(s){return s.setSelection(s.getCursor("anchor"),s.getCursor("head"),We)},killLine:function(s){return Ba(s,function(c){if(c.empty()){var g=Ke(s.doc,c.head.line).text.length;return c.head.ch==g&&c.head.line<s.lastLine()?{from:c.head,to:Ee(c.head.line+1,0)}:{from:c.head,to:Ee(c.head.line,g)}}else return{from:c.from(),to:c.to()}})},deleteLine:function(s){return Ba(s,function(c){return{from:Ee(c.from().line,0),to:Bt(s.doc,Ee(c.to().line+1,0))}})},delLineLeft:function(s){return Ba(s,function(c){return{from:Ee(c.from().line,0),to:c.from()}})},delWrappedLineLeft:function(s){return Ba(s,function(c){var g=s.charCoords(c.head,"div").top+5,p=s.coordsChar({left:0,top:g},"div");return{from:p,to:c.from()}})},delWrappedLineRight:function(s){return Ba(s,function(c){var g=s.charCoords(c.head,"div").top+5,p=s.coordsChar({left:s.display.lineDiv.offsetWidth+100,top:g},"div");return{from:c.from(),to:p}})},undo:function(s){return s.undo()},redo:function(s){return s.redo()},undoSelection:function(s){return s.undoSelection()},redoSelection:function(s){return s.redoSelection()},goDocStart:function(s){return s.extendSelection(Ee(s.firstLine(),0))},goDocEnd:function(s){return s.extendSelection(Ee(s.lastLine()))},goLineStart:function(s){return s.extendSelectionsBy(function(c){return Jm(s,c.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(s){return s.extendSelectionsBy(function(c){return Zm(s,c.head)},{origin:"+move",bias:1})},goLineEnd:function(s){return s.extendSelectionsBy(function(c){return IE(s,c.head.line)},{origin:"+move",bias:-1})},goLineRight:function(s){return s.extendSelectionsBy(function(c){var g=s.cursorCoords(c.head,"div").top+5;return s.coordsChar({left:s.display.lineDiv.offsetWidth+100,top:g},"div")},pt)},goLineLeft:function(s){return s.extendSelectionsBy(function(c){var g=s.cursorCoords(c.head,"div").top+5;return s.coordsChar({left:0,top:g},"div")},pt)},goLineLeftSmart:function(s){return s.extendSelectionsBy(function(c){var g=s.cursorCoords(c.head,"div").top+5,p=s.coordsChar({left:0,top:g},"div");return p.ch<s.getLine(p.line).search(/\S/)?Zm(s,c.head):p},pt)},goLineUp:function(s){return s.moveV(-1,"line")},goLineDown:function(s){return s.moveV(1,"line")},goPageUp:function(s){return s.moveV(-1,"page")},goPageDown:function(s){return s.moveV(1,"page")},goCharLeft:function(s){return s.moveH(-1,"char")},goCharRight:function(s){return s.moveH(1,"char")},goColumnLeft:function(s){return s.moveH(-1,"column")},goColumnRight:function(s){return s.moveH(1,"column")},goWordLeft:function(s){return s.moveH(-1,"word")},goGroupRight:function(s){return s.moveH(1,"group")},goGroupLeft:function(s){return s.moveH(-1,"group")},goWordRight:function(s){return s.moveH(1,"word")},delCharBefore:function(s){return s.deleteH(-1,"codepoint")},delCharAfter:function(s){return s.deleteH(1,"char")},delWordBefore:function(s){return s.deleteH(-1,"word")},delWordAfter:function(s){return s.deleteH(1,"word")},delGroupBefore:function(s){return s.deleteH(-1,"group")},delGroupAfter:function(s){return s.deleteH(1,"group")},indentAuto:function(s){return s.indentSelection("smart")},indentMore:function(s){return s.indentSelection("add")},indentLess:function(s){return s.indentSelection("subtract")},insertTab:function(s){return s.replaceSelection("	")},insertSoftTab:function(s){for(var c=[],g=s.listSelections(),p=s.options.tabSize,m=0;m<g.length;m++){var C=g[m].from(),M=fe(s.getLine(C.line),C.ch,p);c.push(te(p-M%p))}s.replaceSelections(c)},defaultTab:function(s){s.somethingSelected()?s.indentSelection("add"):s.execCommand("insertTab")},transposeChars:function(s){return Ir(s,function(){for(var c=s.listSelections(),g=[],p=0;p<c.length;p++)if(c[p].empty()){var m=c[p].head,C=Ke(s.doc,m.line).text;if(C){if(m.ch==C.length&&(m=new Ee(m.line,m.ch-1)),m.ch>0)m=new Ee(m.line,m.ch+1),s.replaceRange(C.charAt(m.ch-1)+C.charAt(m.ch-2),Ee(m.line,m.ch-2),m,"+transpose");else if(m.line>s.doc.first){var M=Ke(s.doc,m.line-1).text;M&&(m=new Ee(m.line,1),s.replaceRange(C.charAt(0)+s.doc.lineSeparator()+M.charAt(M.length-1),Ee(m.line-1,M.length-1),m,"+transpose"))}}g.push(new ln(m,m))}s.setSelections(g)})},newlineAndIndent:function(s){return Ir(s,function(){for(var c=s.listSelections(),g=c.length-1;g>=0;g--)s.replaceRange(s.doc.lineSeparator(),c[g].anchor,c[g].head,"+input");c=s.listSelections();for(var p=0;p<c.length;p++)s.indentLine(c[p].from().line,null,!0);Na(s)})},openLine:function(s){return s.replaceSelection(`
`,"start")},toggleOverwrite:function(s){return s.toggleOverwrite()}};function Jm(s,c){var g=Ke(s.doc,c),p=pi(g);return p!=g&&(c=P(p)),Of(!0,s,p,c,1)}function IE(s,c){var g=Ke(s.doc,c),p=_S(g);return p!=g&&(c=P(p)),Of(!0,s,g,c,-1)}function Zm(s,c){var g=Jm(s,c.line),p=Ke(s.doc,g.line),m=st(p,s.doc.direction);if(!m||m[0].level==0){var C=Math.max(g.ch,p.text.search(/\S/)),M=c.line==g.line&&c.ch<=C&&c.ch;return Ee(g.line,M?0:C,g.sticky)}return g}function Lu(s,c,g){if(typeof c=="string"&&(c=rl[c],!c))return!1;s.display.input.ensurePolled();var p=s.display.shift,m=!1;try{s.isReadOnly()&&(s.state.suppressEdits=!0),g&&(s.display.shift=!1),m=c(s)!=Ze}finally{s.display.shift=p,s.state.suppressEdits=!1}return m}function BE(s,c,g){for(var p=0;p<s.state.keyMaps.length;p++){var m=Ia(c,s.state.keyMaps[p],g,s);if(m)return m}return s.options.extraKeys&&Ia(c,s.options.extraKeys,g,s)||Ia(c,s.options.keyMap,g,s)}var jE=new he;function il(s,c,g,p){var m=s.state.keySeq;if(m){if(Xm(c))return"handled";if(/\'$/.test(c)?s.state.keySeq=null:jE.set(50,function(){s.state.keySeq==m&&(s.state.keySeq=null,s.display.input.reset())}),Qm(s,m+" "+c,g,p))return!0}return Qm(s,c,g,p)}function Qm(s,c,g,p){var m=BE(s,c,p);return m=="multi"&&(s.state.keySeq=c),m=="handled"&&Wn(s,"keyHandled",s,c,g),(m=="handled"||m=="multi")&&(ft(g),uf(s)),!!m}function ey(s,c){var g=Km(c,!0);return g?c.shiftKey&&!s.state.keySeq?il(s,"Shift-"+g,c,function(p){return Lu(s,p,!0)})||il(s,g,c,function(p){if(typeof p=="string"?/^go[A-Z]/.test(p):p.motion)return Lu(s,p)}):il(s,g,c,function(p){return Lu(s,p)}):!1}function HE(s,c,g){return il(s,"'"+g+"'",c,function(p){return Lu(s,p,!0)})}var Mf=null;function ty(s){var c=this;if(!(s.target&&s.target!=c.display.input.getField())&&(c.curOp.focus=Se(ce(c)),!et(c,s))){u&&d<11&&s.keyCode==27&&(s.returnValue=!1);var g=s.keyCode;c.display.shift=g==16||s.shiftKey;var p=ey(c,s);x&&(Mf=p?g:null,!p&&g==88&&!hi&&(N?s.metaKey:s.ctrlKey)&&c.replaceSelection("",null,"cut")),i&&!N&&!p&&g==46&&s.shiftKey&&!s.ctrlKey&&document.execCommand&&document.execCommand("cut"),g==18&&!/\bCodeMirror-crosshair\b/.test(c.display.lineDiv.className)&&$E(c)}}function $E(s){var c=s.display.lineDiv;me(c,"CodeMirror-crosshair");function g(p){(p.keyCode==18||!p.altKey)&&(q(c,"CodeMirror-crosshair"),ct(document,"keyup",g),ct(document,"mouseover",g))}Ne(document,"keyup",g),Ne(document,"mouseover",g)}function ny(s){s.keyCode==16&&(this.doc.sel.shift=!1),et(this,s)}function ry(s){var c=this;if(!(s.target&&s.target!=c.display.input.getField())&&!(eo(c.display,s)||et(c,s)||s.ctrlKey&&!s.altKey||N&&s.metaKey)){var g=s.keyCode,p=s.charCode;if(x&&g==Mf){Mf=null,ft(s);return}if(!(x&&(!s.which||s.which<10)&&ey(c,s))){var m=String.fromCharCode(p??g);m!="\b"&&(HE(c,s,m)||c.display.input.onKeyPress(s))}}}var FE=400,Nf=function(s,c,g){this.time=s,this.pos=c,this.button=g};Nf.prototype.compare=function(s,c,g){return this.time+FE>s&&Me(c,this.pos)==0&&g==this.button};var ol,al;function zE(s,c){var g=+new Date;return al&&al.compare(g,s,c)?(ol=al=null,"triple"):ol&&ol.compare(g,s,c)?(al=new Nf(g,s,c),ol=null,"double"):(ol=new Nf(g,s,c),al=null,"single")}function iy(s){var c=this,g=c.display;if(!(et(c,s)||g.activeTouch&&g.input.supportsTouch())){if(g.input.ensurePolled(),g.shift=s.shiftKey,eo(g,s)){f||(g.scroller.draggable=!1,setTimeout(function(){return g.scroller.draggable=!0},100));return}if(!Af(c,s)){var p=zo(c,s),m=bn(s),C=p?zE(p,m):"single";K(c).focus(),m==1&&c.state.selectingText&&c.state.selectingText(s),!(p&&UE(c,m,p,C,s))&&(m==1?p?WE(c,p,C,s):rr(s)==g.scroller&&ft(s):m==2?(p&&Ou(c.doc,p),setTimeout(function(){return g.input.focus()},20)):m==3&&(X?c.display.input.onContextMenu(s):df(c)))}}}function UE(s,c,g,p,m){var C="Click";return p=="double"?C="Double"+C:p=="triple"&&(C="Triple"+C),C=(c==1?"Left":c==2?"Middle":"Right")+C,il(s,Ym(C,m),m,function(M){if(typeof M=="string"&&(M=rl[M]),!M)return!1;var R=!1;try{s.isReadOnly()&&(s.state.suppressEdits=!0),R=M(s,g)!=Ze}finally{s.state.suppressEdits=!1}return R})}function VE(s,c,g){var p=s.getOption("configureMouse"),m=p?p(s,c,g):{};if(m.unit==null){var C=I?g.shiftKey&&g.metaKey:g.altKey;m.unit=C?"rectangle":c=="single"?"char":c=="double"?"word":"line"}return(m.extend==null||s.doc.extend)&&(m.extend=s.doc.extend||g.shiftKey),m.addNew==null&&(m.addNew=N?g.metaKey:g.ctrlKey),m.moveOnDrag==null&&(m.moveOnDrag=!(N?g.altKey:g.ctrlKey)),m}function WE(s,c,g,p){u?setTimeout(ie(om,s),0):s.curOp.focus=Se(ce(s));var m=VE(s,g,p),C=s.doc.sel,M;s.options.dragDrop&&Un&&!s.isReadOnly()&&g=="single"&&(M=C.contains(c))>-1&&(Me((M=C.ranges[M]).from(),c)<0||c.xRel>0)&&(Me(M.to(),c)>0||c.xRel<0)?GE(s,p,c,m):qE(s,p,c,m)}function GE(s,c,g,p){var m=s.display,C=!1,M=Gn(s,function(z){f&&(m.scroller.draggable=!1),s.state.draggingText=!1,s.state.delayingBlurEvent&&(s.hasFocus()?s.state.delayingBlurEvent=!1:df(s)),ct(m.wrapper.ownerDocument,"mouseup",M),ct(m.wrapper.ownerDocument,"mousemove",R),ct(m.scroller,"dragstart",j),ct(m.scroller,"drop",M),C||(ft(z),p.addNew||Ou(s.doc,g,null,null,p.extend),f&&!w||u&&d==9?setTimeout(function(){m.wrapper.ownerDocument.body.focus({preventScroll:!0}),m.input.focus()},20):m.input.focus())}),R=function(z){C=C||Math.abs(c.clientX-z.clientX)+Math.abs(c.clientY-z.clientY)>=10},j=function(){return C=!0};f&&(m.scroller.draggable=!0),s.state.draggingText=M,M.copy=!p.moveOnDrag,Ne(m.wrapper.ownerDocument,"mouseup",M),Ne(m.wrapper.ownerDocument,"mousemove",R),Ne(m.scroller,"dragstart",j),Ne(m.scroller,"drop",M),s.state.delayingBlurEvent=!0,setTimeout(function(){return m.input.focus()},20),m.scroller.dragDrop&&m.scroller.dragDrop()}function oy(s,c,g){if(g=="char")return new ln(c,c);if(g=="word")return s.findWordAt(c);if(g=="line")return new ln(Ee(c.line,0),Bt(s.doc,Ee(c.line+1,0)));var p=g(s,c);return new ln(p.from,p.to)}function qE(s,c,g,p){u&&df(s);var m=s.display,C=s.doc;ft(c);var M,R,j=C.sel,z=j.ranges;if(p.addNew&&!p.extend?(R=C.sel.contains(g),R>-1?M=z[R]:M=new ln(g,g)):(M=C.sel.primary(),R=C.sel.primIndex),p.unit=="rectangle")p.addNew||(M=new ln(g,g)),g=zo(s,c,!0,!0),R=-1;else{var re=oy(s,g,p.unit);p.extend?M=Sf(M,re.anchor,re.head,p.extend):M=re}p.addNew?R==-1?(R=z.length,ir(C,gi(s,z.concat([M]),R),{scroll:!1,origin:"*mouse"})):z.length>1&&z[R].empty()&&p.unit=="char"&&!p.extend?(ir(C,gi(s,z.slice(0,R).concat(z.slice(R+1)),0),{scroll:!1,origin:"*mouse"}),j=C.sel):Ef(C,R,M,St):(R=0,ir(C,new qr([M],0),St),j=C.sel);var le=g;function Ce(dt){if(Me(le,dt)!=0)if(le=dt,p.unit=="rectangle"){for(var xt=[],At=s.options.tabSize,Nt=fe(Ke(C,g.line).text,g.ch,At),Vt=fe(Ke(C,dt.line).text,dt.ch,At),gn=Math.min(Nt,Vt),Xn=Math.max(Nt,Vt),En=Math.min(g.line,dt.line),Br=Math.min(s.lastLine(),Math.max(g.line,dt.line));En<=Br;En++){var xr=Ke(C,En).text,jn=Ht(xr,gn,At);gn==Xn?xt.push(new ln(Ee(En,jn),Ee(En,jn))):xr.length>jn&&xt.push(new ln(Ee(En,jn),Ee(En,Ht(xr,Xn,At))))}xt.length||xt.push(new ln(g,g)),ir(C,gi(s,j.ranges.slice(0,R).concat(xt),R),{origin:"*mouse",scroll:!1}),s.scrollIntoView(dt)}else{var wr=M,Zn=oy(s,dt,p.unit),Fn=wr.anchor,Hn;Me(Zn.anchor,Fn)>0?(Hn=Zn.head,Fn=Rn(wr.from(),Zn.anchor)):(Hn=Zn.anchor,Fn=Pt(wr.to(),Zn.head));var Mn=j.ranges.slice(0);Mn[R]=XE(s,new ln(Bt(C,Fn),Hn)),ir(C,gi(s,Mn,R),St)}}var _e=m.wrapper.getBoundingClientRect(),Fe=0;function Ge(dt){var xt=++Fe,At=zo(s,dt,!0,p.unit=="rectangle");if(At)if(Me(At,le)!=0){s.curOp.focus=Se(ce(s)),Ce(At);var Nt=xu(m,C);(At.line>=Nt.to||At.line<Nt.from)&&setTimeout(Gn(s,function(){Fe==xt&&Ge(dt)}),150)}else{var Vt=dt.clientY<_e.top?-20:dt.clientY>_e.bottom?20:0;Vt&&setTimeout(Gn(s,function(){Fe==xt&&(m.scroller.scrollTop+=Vt,Ge(dt))}),50)}}function nt(dt){s.state.selectingText=!1,Fe=1/0,dt&&(ft(dt),m.input.focus()),ct(m.wrapper.ownerDocument,"mousemove",ut),ct(m.wrapper.ownerDocument,"mouseup",yt),C.history.lastSelOrigin=null}var ut=Gn(s,function(dt){dt.buttons===0||!bn(dt)?nt(dt):Ge(dt)}),yt=Gn(s,nt);s.state.selectingText=yt,Ne(m.wrapper.ownerDocument,"mousemove",ut),Ne(m.wrapper.ownerDocument,"mouseup",yt)}function XE(s,c){var g=c.anchor,p=c.head,m=Ke(s.doc,g.line);if(Me(g,p)==0&&g.sticky==p.sticky)return c;var C=st(m);if(!C)return c;var M=ht(C,g.ch,g.sticky),R=C[M];if(R.from!=g.ch&&R.to!=g.ch)return c;var j=M+(R.from==g.ch==(R.level!=1)?0:1);if(j==0||j==C.length)return c;var z;if(p.line!=g.line)z=(p.line-g.line)*(s.doc.direction=="ltr"?1:-1)>0;else{var re=ht(C,p.ch,p.sticky),le=re-M||(p.ch-g.ch)*(R.level==1?-1:1);re==j-1||re==j?z=le<0:z=le>0}var Ce=C[j+(z?-1:0)],_e=z==(Ce.level==1),Fe=_e?Ce.from:Ce.to,Ge=_e?"after":"before";return g.ch==Fe&&g.sticky==Ge?c:new ln(new Ee(g.line,Fe,Ge),p)}function ay(s,c,g,p){var m,C;if(c.touches)m=c.touches[0].clientX,C=c.touches[0].clientY;else try{m=c.clientX,C=c.clientY}catch{return!1}if(m>=Math.floor(s.display.gutters.getBoundingClientRect().right))return!1;p&&ft(c);var M=s.display,R=M.lineDiv.getBoundingClientRect();if(C>R.bottom||!we(s,g))return Ft(c);C-=R.top-M.viewOffset;for(var j=0;j<s.display.gutterSpecs.length;++j){var z=M.gutters.childNodes[j];if(z&&z.getBoundingClientRect().right>=m){var re=Y(s.doc,C),le=s.display.gutterSpecs[j];return Xe(s,g,s,re,le.className,c),Ft(c)}}}function Af(s,c){return ay(s,c,"gutterClick",!0)}function sy(s,c){eo(s.display,c)||YE(s,c)||et(s,c,"contextmenu")||X||s.display.input.onContextMenu(c)}function YE(s,c){return we(s,"gutterContextMenu")?ay(s,c,"gutterContextMenu",!1):!1}function ly(s){s.display.wrapper.className=s.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+s.options.theme.replace(/(^|\s)\s*/g," cm-s-"),$s(s)}var ja={toString:function(){return"CodeMirror.Init"}},uy={},Pu={};function KE(s){var c=s.optionHandlers;function g(p,m,C,M){s.defaults[p]=m,C&&(c[p]=M?function(R,j,z){z!=ja&&C(R,j,z)}:C)}s.defineOption=g,s.Init=ja,g("value","",function(p,m){return p.setValue(m)},!0),g("mode",null,function(p,m){p.doc.modeOption=m,bf(p)},!0),g("indentUnit",2,bf,!0),g("indentWithTabs",!1),g("smartIndent",!0),g("tabSize",4,function(p){Xs(p),$s(p),_r(p)},!0),g("lineSeparator",null,function(p,m){if(p.doc.lineSep=m,!!m){var C=[],M=p.doc.first;p.doc.iter(function(j){for(var z=0;;){var re=j.text.indexOf(m,z);if(re==-1)break;z=re+m.length,C.push(Ee(M,re))}M++});for(var R=C.length-1;R>=0;R--)Pa(p.doc,m,C[R],Ee(C[R].line,C[R].ch+m.length))}}),g("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(p,m,C){p.state.specialChars=new RegExp(m.source+(m.test("	")?"":"|	"),"g"),C!=ja&&p.refresh()}),g("specialCharPlaceholder",CS,function(p){return p.refresh()},!0),g("electricChars",!0),g("inputStyle",O?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),g("spellcheck",!1,function(p,m){return p.getInputField().spellcheck=m},!0),g("autocorrect",!1,function(p,m){return p.getInputField().autocorrect=m},!0),g("autocapitalize",!1,function(p,m){return p.getInputField().autocapitalize=m},!0),g("rtlMoveVisually",!T),g("wholeLineUpdateBefore",!0),g("theme","default",function(p){ly(p),qs(p)},!0),g("keyMap","default",function(p,m,C){var M=Du(m),R=C!=ja&&Du(C);R&&R.detach&&R.detach(p,M),M.attach&&M.attach(p,R||null)}),g("extraKeys",null),g("configureMouse",null),g("lineWrapping",!1,ZE,!0),g("gutters",[],function(p,m){p.display.gutterSpecs=yf(m,p.options.lineNumbers),qs(p)},!0),g("fixedGutter",!0,function(p,m){p.display.gutters.style.left=m?af(p.display)+"px":"0",p.refresh()},!0),g("coverGutterNextToScrollbar",!1,function(p){return Aa(p)},!0),g("scrollbarStyle","native",function(p){cm(p),Aa(p),p.display.scrollbars.setScrollTop(p.doc.scrollTop),p.display.scrollbars.setScrollLeft(p.doc.scrollLeft)},!0),g("lineNumbers",!1,function(p,m){p.display.gutterSpecs=yf(p.options.gutters,m),qs(p)},!0),g("firstLineNumber",1,qs,!0),g("lineNumberFormatter",function(p){return p},qs,!0),g("showCursorWhenSelecting",!1,Fs,!0),g("resetSelectionOnContextMenu",!0),g("lineWiseCopyCut",!0),g("pasteLinesPerSelection",!0),g("selectionsMayTouch",!1),g("readOnly",!1,function(p,m){m=="nocursor"&&(Ma(p),p.display.input.blur()),p.display.input.readOnlyChanged(m)}),g("screenReaderLabel",null,function(p,m){m=m===""?null:m,p.display.input.screenReaderLabelChanged(m)}),g("disableInput",!1,function(p,m){m||p.display.input.reset()},!0),g("dragDrop",!0,JE),g("allowDropFileTypes",null),g("cursorBlinkRate",530),g("cursorScrollMargin",0),g("cursorHeight",1,Fs,!0),g("singleCursorHeightPerLine",!0,Fs,!0),g("workTime",100),g("workDelay",100),g("flattenSpans",!0,Xs,!0),g("addModeClass",!1,Xs,!0),g("pollInterval",100),g("undoDepth",200,function(p,m){return p.doc.history.undoDepth=m}),g("historyEventDelay",1250),g("viewportMargin",10,function(p){return p.refresh()},!0),g("maxHighlightLength",1e4,Xs,!0),g("moveInputWithCursor",!0,function(p,m){m||p.display.input.resetPosition()}),g("tabindex",null,function(p,m){return p.display.input.getField().tabIndex=m||""}),g("autofocus",null),g("direction","ltr",function(p,m){return p.doc.setDirection(m)},!0),g("phrases",null)}function JE(s,c,g){var p=g&&g!=ja;if(!c!=!p){var m=s.display.dragFunctions,C=c?Ne:ct;C(s.display.scroller,"dragstart",m.start),C(s.display.scroller,"dragenter",m.enter),C(s.display.scroller,"dragover",m.over),C(s.display.scroller,"dragleave",m.leave),C(s.display.scroller,"drop",m.drop)}}function ZE(s){s.options.lineWrapping?(me(s.display.wrapper,"CodeMirror-wrap"),s.display.sizer.style.minWidth="",s.display.sizerWidth=null):(q(s.display.wrapper,"CodeMirror-wrap"),Yc(s)),sf(s),_r(s),$s(s),setTimeout(function(){return Aa(s)},100)}function wn(s,c){var g=this;if(!(this instanceof wn))return new wn(s,c);this.options=c=c?ne(c):{},ne(uy,c,!1);var p=c.value;typeof p=="string"?p=new br(p,c.mode,null,c.lineSeparator,c.direction):c.mode&&(p.modeOption=c.mode),this.doc=p;var m=new wn.inputStyles[c.inputStyle](this),C=this.display=new cE(s,p,m,c);C.wrapper.CodeMirror=this,ly(this),c.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),cm(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new he,keySeq:null,specialChars:null},c.autofocus&&!O&&C.input.focus(),u&&d<11&&setTimeout(function(){return g.display.input.reset(!0)},20),QE(this),AE(),Go(this),this.curOp.forceUpdate=!0,xm(this,p),c.autofocus&&!O||this.hasFocus()?setTimeout(function(){g.hasFocus()&&!g.state.focused&&cf(g)},20):Ma(this);for(var M in Pu)Pu.hasOwnProperty(M)&&Pu[M](this,c[M],ja);pm(this),c.finishInit&&c.finishInit(this);for(var R=0;R<Tf.length;++R)Tf[R](this);qo(this),f&&c.lineWrapping&&getComputedStyle(C.lineDiv).textRendering=="optimizelegibility"&&(C.lineDiv.style.textRendering="auto")}wn.defaults=uy,wn.optionHandlers=Pu;function QE(s){var c=s.display;Ne(c.scroller,"mousedown",Gn(s,iy)),u&&d<11?Ne(c.scroller,"dblclick",Gn(s,function(j){if(!et(s,j)){var z=zo(s,j);if(!(!z||Af(s,j)||eo(s.display,j))){ft(j);var re=s.findWordAt(z);Ou(s.doc,re.anchor,re.head)}}})):Ne(c.scroller,"dblclick",function(j){return et(s,j)||ft(j)}),Ne(c.scroller,"contextmenu",function(j){return sy(s,j)}),Ne(c.input.getField(),"contextmenu",function(j){c.scroller.contains(j.target)||sy(s,j)});var g,p={end:0};function m(){c.activeTouch&&(g=setTimeout(function(){return c.activeTouch=null},1e3),p=c.activeTouch,p.end=+new Date)}function C(j){if(j.touches.length!=1)return!1;var z=j.touches[0];return z.radiusX<=1&&z.radiusY<=1}function M(j,z){if(z.left==null)return!0;var re=z.left-j.left,le=z.top-j.top;return re*re+le*le>20*20}Ne(c.scroller,"touchstart",function(j){if(!et(s,j)&&!C(j)&&!Af(s,j)){c.input.ensurePolled(),clearTimeout(g);var z=+new Date;c.activeTouch={start:z,moved:!1,prev:z-p.end<=300?p:null},j.touches.length==1&&(c.activeTouch.left=j.touches[0].pageX,c.activeTouch.top=j.touches[0].pageY)}}),Ne(c.scroller,"touchmove",function(){c.activeTouch&&(c.activeTouch.moved=!0)}),Ne(c.scroller,"touchend",function(j){var z=c.activeTouch;if(z&&!eo(c,j)&&z.left!=null&&!z.moved&&new Date-z.start<300){var re=s.coordsChar(c.activeTouch,"page"),le;!z.prev||M(z,z.prev)?le=new ln(re,re):!z.prev.prev||M(z,z.prev.prev)?le=s.findWordAt(re):le=new ln(Ee(re.line,0),Bt(s.doc,Ee(re.line+1,0))),s.setSelection(le.anchor,le.head),s.focus(),ft(j)}m()}),Ne(c.scroller,"touchcancel",m),Ne(c.scroller,"scroll",function(){c.scroller.clientHeight&&(Us(s,c.scroller.scrollTop),Vo(s,c.scroller.scrollLeft,!0),Xe(s,"scroll",s))}),Ne(c.scroller,"mousewheel",function(j){return mm(s,j)}),Ne(c.scroller,"DOMMouseScroll",function(j){return mm(s,j)}),Ne(c.wrapper,"scroll",function(){return c.wrapper.scrollTop=c.wrapper.scrollLeft=0}),c.dragFunctions={enter:function(j){et(s,j)||Kt(j)},over:function(j){et(s,j)||(NE(s,j),Kt(j))},start:function(j){return ME(s,j)},drop:Gn(s,OE),leave:function(j){et(s,j)||Wm(s)}};var R=c.input.getField();Ne(R,"keyup",function(j){return ny.call(s,j)}),Ne(R,"keydown",Gn(s,ty)),Ne(R,"keypress",Gn(s,ry)),Ne(R,"focus",function(j){return cf(s,j)}),Ne(R,"blur",function(j){return Ma(s,j)})}var Tf=[];wn.defineInitHook=function(s){return Tf.push(s)};function sl(s,c,g,p){var m=s.doc,C;g==null&&(g="add"),g=="smart"&&(m.mode.indent?C=co(s,c).state:g="prev");var M=s.options.tabSize,R=Ke(m,c),j=fe(R.text,null,M);R.stateAfter&&(R.stateAfter=null);var z=R.text.match(/^\s*/)[0],re;if(!p&&!/\S/.test(R.text))re=0,g="not";else if(g=="smart"&&(re=m.mode.indent(C,R.text.slice(z.length),R.text),re==Ze||re>150)){if(!p)return;g="prev"}g=="prev"?c>m.first?re=fe(Ke(m,c-1).text,null,M):re=0:g=="add"?re=j+s.options.indentUnit:g=="subtract"?re=j-s.options.indentUnit:typeof g=="number"&&(re=j+g),re=Math.max(0,re);var le="",Ce=0;if(s.options.indentWithTabs)for(var _e=Math.floor(re/M);_e;--_e)Ce+=M,le+="	";if(Ce<re&&(le+=te(re-Ce)),le!=z)return Pa(m,le,Ee(c,0),Ee(c,z.length),"+input"),R.stateAfter=null,!0;for(var Fe=0;Fe<m.sel.ranges.length;Fe++){var Ge=m.sel.ranges[Fe];if(Ge.head.line==c&&Ge.head.ch<z.length){var nt=Ee(c,z.length);Ef(m,Fe,new ln(nt,nt));break}}}var mi=null;function Ru(s){mi=s}function Df(s,c,g,p,m){var C=s.doc;s.display.shift=!1,p||(p=C.sel);var M=+new Date-200,R=m=="paste"||s.state.pasteIncoming>M,j=Pn(c),z=null;if(R&&p.ranges.length>1)if(mi&&mi.text.join(`
`)==c){if(p.ranges.length%mi.text.length==0){z=[];for(var re=0;re<mi.text.length;re++)z.push(C.splitLines(mi.text[re]))}}else j.length==p.ranges.length&&s.options.pasteLinesPerSelection&&(z=F(j,function(ut){return[ut]}));for(var le=s.curOp.updateInput,Ce=p.ranges.length-1;Ce>=0;Ce--){var _e=p.ranges[Ce],Fe=_e.from(),Ge=_e.to();_e.empty()&&(g&&g>0?Fe=Ee(Fe.line,Fe.ch-g):s.state.overwrite&&!R?Ge=Ee(Ge.line,Math.min(Ke(C,Ge.line).text.length,Ge.ch+A(j).length)):R&&mi&&mi.lineWise&&mi.text.join(`
`)==j.join(`
`)&&(Fe=Ge=Ee(Fe.line,0)));var nt={from:Fe,to:Ge,text:z?z[Ce%z.length]:j,origin:m||(R?"paste":s.state.cutIncoming>M?"cut":"+input")};La(s.doc,nt),Wn(s,"inputRead",s,nt)}c&&!R&&cy(s,c),Na(s),s.curOp.updateInput<2&&(s.curOp.updateInput=le),s.curOp.typing=!0,s.state.pasteIncoming=s.state.cutIncoming=-1}function dy(s,c){var g=s.clipboardData&&s.clipboardData.getData("Text");if(g)return s.preventDefault(),!c.isReadOnly()&&!c.options.disableInput&&c.hasFocus()&&Ir(c,function(){return Df(c,g,0,null,"paste")}),!0}function cy(s,c){if(!(!s.options.electricChars||!s.options.smartIndent))for(var g=s.doc.sel,p=g.ranges.length-1;p>=0;p--){var m=g.ranges[p];if(!(m.head.ch>100||p&&g.ranges[p-1].head.line==m.head.line)){var C=s.getModeAt(m.head),M=!1;if(C.electricChars){for(var R=0;R<C.electricChars.length;R++)if(c.indexOf(C.electricChars.charAt(R))>-1){M=sl(s,m.head.line,"smart");break}}else C.electricInput&&C.electricInput.test(Ke(s.doc,m.head.line).text.slice(0,m.head.ch))&&(M=sl(s,m.head.line,"smart"));M&&Wn(s,"electricInput",s,m.head.line)}}}function fy(s){for(var c=[],g=[],p=0;p<s.doc.sel.ranges.length;p++){var m=s.doc.sel.ranges[p].head.line,C={anchor:Ee(m,0),head:Ee(m+1,0)};g.push(C),c.push(s.getRange(C.anchor,C.head))}return{text:c,ranges:g}}function Lf(s,c,g,p){s.setAttribute("autocorrect",g?"on":"off"),s.setAttribute("autocapitalize",p?"on":"off"),s.setAttribute("spellcheck",!!c)}function hy(){var s=$("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),c=$("div",[s],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return f?s.style.width="1000px":s.setAttribute("wrap","off"),E&&(s.style.border="1px solid black"),c}function e2(s){var c=s.optionHandlers,g=s.helpers={};s.prototype={constructor:s,focus:function(){K(this).focus(),this.display.input.focus()},setOption:function(p,m){var C=this.options,M=C[p];C[p]==m&&p!="mode"||(C[p]=m,c.hasOwnProperty(p)&&Gn(this,c[p])(this,m,M),Xe(this,"optionChange",this,p))},getOption:function(p){return this.options[p]},getDoc:function(){return this.doc},addKeyMap:function(p,m){this.state.keyMaps[m?"push":"unshift"](Du(p))},removeKeyMap:function(p){for(var m=this.state.keyMaps,C=0;C<m.length;++C)if(m[C]==p||m[C].name==p)return m.splice(C,1),!0},addOverlay:hr(function(p,m){var C=p.token?p:s.getMode(this.options,p);if(C.startState)throw new Error("Overlays may not be stateful.");Z(this.state.overlays,{mode:C,modeSpec:p,opaque:m&&m.opaque,priority:m&&m.priority||0},function(M){return M.priority}),this.state.modeGen++,_r(this)}),removeOverlay:hr(function(p){for(var m=this.state.overlays,C=0;C<m.length;++C){var M=m[C].modeSpec;if(M==p||typeof p=="string"&&M.name==p){m.splice(C,1),this.state.modeGen++,_r(this);return}}}),indentLine:hr(function(p,m,C){typeof m!="string"&&typeof m!="number"&&(m==null?m=this.options.smartIndent?"smart":"prev":m=m?"add":"subtract"),ye(this.doc,p)&&sl(this,p,m,C)}),indentSelection:hr(function(p){for(var m=this.doc.sel.ranges,C=-1,M=0;M<m.length;M++){var R=m[M];if(R.empty())R.head.line>C&&(sl(this,R.head.line,p,!0),C=R.head.line,M==this.doc.sel.primIndex&&Na(this));else{var j=R.from(),z=R.to(),re=Math.max(C,j.line);C=Math.min(this.lastLine(),z.line-(z.ch?0:1))+1;for(var le=re;le<C;++le)sl(this,le,p);var Ce=this.doc.sel.ranges;j.ch==0&&m.length==Ce.length&&Ce[M].from().ch>0&&Ef(this.doc,M,new ln(j,Ce[M].to()),We)}}}),getTokenAt:function(p,m){return Sg(this,p,m)},getLineTokens:function(p,m){return Sg(this,Ee(p),m,!0)},getTokenTypeAt:function(p){p=Bt(this.doc,p);var m=lu(this,Ke(this.doc,p.line)),C=0,M=(m.length-1)/2,R=p.ch,j;if(R==0)j=m[2];else for(;;){var z=C+M>>1;if((z?m[z*2-1]:0)>=R)M=z;else if(m[z*2+1]<R)C=z+1;else{j=m[z*2+2];break}}var re=j?j.indexOf("overlay "):-1;return re<0?j:re==0?null:j.slice(0,re-1)},getModeAt:function(p){var m=this.doc.mode;return m.innerMode?s.innerMode(m,this.getTokenAt(p).state).mode:m},getHelper:function(p,m){return this.getHelpers(p,m)[0]},getHelpers:function(p,m){var C=[];if(!g.hasOwnProperty(m))return C;var M=g[m],R=this.getModeAt(p);if(typeof R[m]=="string")M[R[m]]&&C.push(M[R[m]]);else if(R[m])for(var j=0;j<R[m].length;j++){var z=M[R[m][j]];z&&C.push(z)}else R.helperType&&M[R.helperType]?C.push(M[R.helperType]):M[R.name]&&C.push(M[R.name]);for(var re=0;re<M._global.length;re++){var le=M._global[re];le.pred(R,this)&&be(C,le.val)==-1&&C.push(le.val)}return C},getStateAfter:function(p,m){var C=this.doc;return p=Rs(C,p??C.first+C.size-1),co(this,p+1,m).state},cursorCoords:function(p,m){var C,M=this.doc.sel.primary();return p==null?C=M.head:typeof p=="object"?C=Bt(this.doc,p):C=p?M.from():M.to(),vi(this,C,m||"page")},charCoords:function(p,m){return mu(this,Bt(this.doc,p),m||"page")},coordsChar:function(p,m){return p=Zg(this,p,m||"page"),nf(this,p.left,p.top)},lineAtHeight:function(p,m){return p=Zg(this,{top:p,left:0},m||"page").top,Y(this.doc,p+this.display.viewOffset)},heightAtLine:function(p,m,C){var M=!1,R;if(typeof p=="number"){var j=this.doc.first+this.doc.size-1;p<this.doc.first?p=this.doc.first:p>j&&(p=j,M=!0),R=Ke(this.doc,p)}else R=p;return gu(this,R,{top:0,left:0},m||"page",C||M).top+(M?this.doc.height-Qi(R):0)},defaultTextHeight:function(){return ka(this.display)},defaultCharWidth:function(){return Oa(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(p,m,C,M,R){var j=this.display;p=vi(this,Bt(this.doc,p));var z=p.bottom,re=p.left;if(m.style.position="absolute",m.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(m),j.sizer.appendChild(m),M=="over")z=p.top;else if(M=="above"||M=="near"){var le=Math.max(j.wrapper.clientHeight,this.doc.height),Ce=Math.max(j.sizer.clientWidth,j.lineSpace.clientWidth);(M=="above"||p.bottom+m.offsetHeight>le)&&p.top>m.offsetHeight?z=p.top-m.offsetHeight:p.bottom+m.offsetHeight<=le&&(z=p.bottom),re+m.offsetWidth>Ce&&(re=Ce-m.offsetWidth)}m.style.top=z+"px",m.style.left=m.style.right="",R=="right"?(re=j.sizer.clientWidth-m.offsetWidth,m.style.right="0px"):(R=="left"?re=0:R=="middle"&&(re=(j.sizer.clientWidth-m.offsetWidth)/2),m.style.left=re+"px"),C&&JS(this,{left:re,top:z,right:re+m.offsetWidth,bottom:z+m.offsetHeight})},triggerOnKeyDown:hr(ty),triggerOnKeyPress:hr(ry),triggerOnKeyUp:ny,triggerOnMouseDown:hr(iy),execCommand:function(p){if(rl.hasOwnProperty(p))return rl[p].call(null,this)},triggerElectric:hr(function(p){cy(this,p)}),findPosH:function(p,m,C,M){var R=1;m<0&&(R=-1,m=-m);for(var j=Bt(this.doc,p),z=0;z<m&&(j=Pf(this.doc,j,R,C,M),!j.hitSide);++z);return j},moveH:hr(function(p,m){var C=this;this.extendSelectionsBy(function(M){return C.display.shift||C.doc.extend||M.empty()?Pf(C.doc,M.head,p,m,C.options.rtlMoveVisually):p<0?M.from():M.to()},pt)}),deleteH:hr(function(p,m){var C=this.doc.sel,M=this.doc;C.somethingSelected()?M.replaceSelection("",null,"+delete"):Ba(this,function(R){var j=Pf(M,R.head,p,m,!1);return p<0?{from:j,to:R.head}:{from:R.head,to:j}})}),findPosV:function(p,m,C,M){var R=1,j=M;m<0&&(R=-1,m=-m);for(var z=Bt(this.doc,p),re=0;re<m;++re){var le=vi(this,z,"div");if(j==null?j=le.left:le.left=j,z=py(this,le,R,C),z.hitSide)break}return z},moveV:hr(function(p,m){var C=this,M=this.doc,R=[],j=!this.display.shift&&!M.extend&&M.sel.somethingSelected();if(M.extendSelectionsBy(function(re){if(j)return p<0?re.from():re.to();var le=vi(C,re.head,"div");re.goalColumn!=null&&(le.left=re.goalColumn),R.push(le.left);var Ce=py(C,le,p,m);return m=="page"&&re==M.sel.primary()&&hf(C,mu(C,Ce,"div").top-le.top),Ce},pt),R.length)for(var z=0;z<M.sel.ranges.length;z++)M.sel.ranges[z].goalColumn=R[z]}),findWordAt:function(p){var m=this.doc,C=Ke(m,p.line).text,M=p.ch,R=p.ch;if(C){var j=this.getHelper(p,"wordChars");(p.sticky=="before"||R==C.length)&&M?--M:++R;for(var z=C.charAt(M),re=Te(z,j)?function(le){return Te(le,j)}:/\s/.test(z)?function(le){return/\s/.test(le)}:function(le){return!/\s/.test(le)&&!Te(le)};M>0&&re(C.charAt(M-1));)--M;for(;R<C.length&&re(C.charAt(R));)++R}return new ln(Ee(p.line,M),Ee(p.line,R))},toggleOverwrite:function(p){p!=null&&p==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?me(this.display.cursorDiv,"CodeMirror-overwrite"):q(this.display.cursorDiv,"CodeMirror-overwrite"),Xe(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Se(ce(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:hr(function(p,m){zs(this,p,m)}),getScrollInfo:function(){var p=this.display.scroller;return{left:p.scrollLeft,top:p.scrollTop,height:p.scrollHeight-Bi(this)-this.display.barHeight,width:p.scrollWidth-Bi(this)-this.display.barWidth,clientHeight:Zc(this),clientWidth:$o(this)}},scrollIntoView:hr(function(p,m){p==null?(p={from:this.doc.sel.primary().head,to:null},m==null&&(m=this.options.cursorScrollMargin)):typeof p=="number"?p={from:Ee(p,0),to:null}:p.from==null&&(p={from:p,to:null}),p.to||(p.to=p.from),p.margin=m||0,p.from.line!=null?ZS(this,p):sm(this,p.from,p.to,p.margin)}),setSize:hr(function(p,m){var C=this,M=function(j){return typeof j=="number"||/^\d+$/.test(String(j))?j+"px":j};p!=null&&(this.display.wrapper.style.width=M(p)),m!=null&&(this.display.wrapper.style.height=M(m)),this.options.lineWrapping&&Yg(this);var R=this.display.viewFrom;this.doc.iter(R,this.display.viewTo,function(j){if(j.widgets){for(var z=0;z<j.widgets.length;z++)if(j.widgets[z].noHScroll){ho(C,R,"widget");break}}++R}),this.curOp.forceUpdate=!0,Xe(this,"refresh",this)}),operation:function(p){return Ir(this,p)},startOperation:function(){return Go(this)},endOperation:function(){return qo(this)},refresh:hr(function(){var p=this.display.cachedTextHeight;_r(this),this.curOp.forceUpdate=!0,$s(this),zs(this,this.doc.scrollLeft,this.doc.scrollTop),gf(this.display),(p==null||Math.abs(p-ka(this.display))>.5||this.options.lineWrapping)&&sf(this),Xe(this,"refresh",this)}),swapDoc:hr(function(p){var m=this.doc;return m.cm=null,this.state.selectingText&&this.state.selectingText(),xm(this,p),$s(this),this.display.input.reset(),zs(this,p.scrollLeft,p.scrollTop),this.curOp.forceScroll=!0,Wn(this,"swapDoc",this,m),m}),phrase:function(p){var m=this.options.phrases;return m&&Object.prototype.hasOwnProperty.call(m,p)?m[p]:p},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Je(s),s.registerHelper=function(p,m,C){g.hasOwnProperty(p)||(g[p]=s[p]={_global:[]}),g[p][m]=C},s.registerGlobalHelper=function(p,m,C,M){s.registerHelper(p,m,M),g[p]._global.push({pred:C,val:M})}}function Pf(s,c,g,p,m){var C=c,M=g,R=Ke(s,c.line),j=m&&s.direction=="rtl"?-g:g;function z(){var yt=c.line+j;return yt<s.first||yt>=s.first+s.size?!1:(c=new Ee(yt,c.ch,c.sticky),R=Ke(s,yt))}function re(yt){var dt;if(p=="codepoint"){var xt=R.text.charCodeAt(c.ch+(g>0?0:-1));if(isNaN(xt))dt=null;else{var At=g>0?xt>=55296&&xt<56320:xt>=56320&&xt<57343;dt=new Ee(c.line,Math.max(0,Math.min(R.text.length,c.ch+g*(At?2:1))),-g)}}else m?dt=RE(s.cm,R,c,g):dt=kf(R,c,g);if(dt==null)if(!yt&&z())c=Of(m,s.cm,R,c.line,j);else return!1;else c=dt;return!0}if(p=="char"||p=="codepoint")re();else if(p=="column")re(!0);else if(p=="word"||p=="group")for(var le=null,Ce=p=="group",_e=s.cm&&s.cm.getHelper(c,"wordChars"),Fe=!0;!(g<0&&!re(!Fe));Fe=!1){var Ge=R.text.charAt(c.ch)||`
`,nt=Te(Ge,_e)?"w":Ce&&Ge==`
`?"n":!Ce||/\s/.test(Ge)?null:"p";if(Ce&&!Fe&&!nt&&(nt="s"),le&&le!=nt){g<0&&(g=1,re(),c.sticky="after");break}if(nt&&(le=nt),g>0&&!re(!Fe))break}var ut=Nu(s,c,C,M,!0);return ot(C,ut)&&(ut.hitSide=!0),ut}function py(s,c,g,p){var m=s.doc,C=c.left,M;if(p=="page"){var R=Math.min(s.display.wrapper.clientHeight,K(s).innerHeight||m(s).documentElement.clientHeight),j=Math.max(R-.5*ka(s.display),3);M=(g>0?c.bottom:c.top)+g*j}else p=="line"&&(M=g>0?c.bottom+3:c.top-3);for(var z;z=nf(s,C,M),!!z.outside;){if(g<0?M<=0:M>=m.height){z.hitSide=!0;break}M+=g*5}return z}var fn=function(s){this.cm=s,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new he,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};fn.prototype.init=function(s){var c=this,g=this,p=g.cm,m=g.div=s.lineDiv;m.contentEditable=!0,Lf(m,p.options.spellcheck,p.options.autocorrect,p.options.autocapitalize);function C(R){for(var j=R.target;j;j=j.parentNode){if(j==m)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(j.className))break}return!1}Ne(m,"paste",function(R){!C(R)||et(p,R)||dy(R,p)||d<=11&&setTimeout(Gn(p,function(){return c.updateFromDOM()}),20)}),Ne(m,"compositionstart",function(R){c.composing={data:R.data,done:!1}}),Ne(m,"compositionupdate",function(R){c.composing||(c.composing={data:R.data,done:!1})}),Ne(m,"compositionend",function(R){c.composing&&(R.data!=c.composing.data&&c.readFromDOMSoon(),c.composing.done=!0)}),Ne(m,"touchstart",function(){return g.forceCompositionEnd()}),Ne(m,"input",function(){c.composing||c.readFromDOMSoon()});function M(R){if(!(!C(R)||et(p,R))){if(p.somethingSelected())Ru({lineWise:!1,text:p.getSelections()}),R.type=="cut"&&p.replaceSelection("",null,"cut");else if(p.options.lineWiseCopyCut){var j=fy(p);Ru({lineWise:!0,text:j.text}),R.type=="cut"&&p.operation(function(){p.setSelections(j.ranges,0,We),p.replaceSelection("",null,"cut")})}else return;if(R.clipboardData){R.clipboardData.clearData();var z=mi.text.join(`
`);if(R.clipboardData.setData("Text",z),R.clipboardData.getData("Text")==z){R.preventDefault();return}}var re=hy(),le=re.firstChild;Lf(le),p.display.lineSpace.insertBefore(re,p.display.lineSpace.firstChild),le.value=mi.text.join(`
`);var Ce=Se(ue(m));Re(le),setTimeout(function(){p.display.lineSpace.removeChild(re),Ce.focus(),Ce==m&&g.showPrimarySelection()},50)}}Ne(m,"copy",M),Ne(m,"cut",M)},fn.prototype.screenReaderLabelChanged=function(s){s?this.div.setAttribute("aria-label",s):this.div.removeAttribute("aria-label")},fn.prototype.prepareSelection=function(){var s=im(this.cm,!1);return s.focus=Se(ue(this.div))==this.div,s},fn.prototype.showSelection=function(s,c){!s||!this.cm.display.view.length||((s.focus||c)&&this.showPrimarySelection(),this.showMultipleSelections(s))},fn.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},fn.prototype.showPrimarySelection=function(){var s=this.getSelection(),c=this.cm,g=c.doc.sel.primary(),p=g.from(),m=g.to();if(c.display.viewTo==c.display.viewFrom||p.line>=c.display.viewTo||m.line<c.display.viewFrom){s.removeAllRanges();return}var C=Iu(c,s.anchorNode,s.anchorOffset),M=Iu(c,s.focusNode,s.focusOffset);if(!(C&&!C.bad&&M&&!M.bad&&Me(Rn(C,M),p)==0&&Me(Pt(C,M),m)==0)){var R=c.display.view,j=p.line>=c.display.viewFrom&&vy(c,p)||{node:R[0].measure.map[2],offset:0},z=m.line<c.display.viewTo&&vy(c,m);if(!z){var re=R[R.length-1].measure,le=re.maps?re.maps[re.maps.length-1]:re.map;z={node:le[le.length-1],offset:le[le.length-2]-le[le.length-3]}}if(!j||!z){s.removeAllRanges();return}var Ce=s.rangeCount&&s.getRangeAt(0),_e;try{_e=De(j.node,j.offset,z.offset,z.node)}catch{}_e&&(!i&&c.state.focused?(s.collapse(j.node,j.offset),_e.collapsed||(s.removeAllRanges(),s.addRange(_e))):(s.removeAllRanges(),s.addRange(_e)),Ce&&s.anchorNode==null?s.addRange(Ce):i&&this.startGracePeriod()),this.rememberSelection()}},fn.prototype.startGracePeriod=function(){var s=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){s.gracePeriod=!1,s.selectionChanged()&&s.cm.operation(function(){return s.cm.curOp.selectionChanged=!0})},20)},fn.prototype.showMultipleSelections=function(s){W(this.cm.display.cursorDiv,s.cursors),W(this.cm.display.selectionDiv,s.selection)},fn.prototype.rememberSelection=function(){var s=this.getSelection();this.lastAnchorNode=s.anchorNode,this.lastAnchorOffset=s.anchorOffset,this.lastFocusNode=s.focusNode,this.lastFocusOffset=s.focusOffset},fn.prototype.selectionInEditor=function(){var s=this.getSelection();if(!s.rangeCount)return!1;var c=s.getRangeAt(0).commonAncestorContainer;return de(this.div,c)},fn.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||Se(ue(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},fn.prototype.blur=function(){this.div.blur()},fn.prototype.getField=function(){return this.div},fn.prototype.supportsTouch=function(){return!0},fn.prototype.receivedFocus=function(){var s=this,c=this;this.selectionInEditor()?setTimeout(function(){return s.pollSelection()},20):Ir(this.cm,function(){return c.cm.curOp.selectionChanged=!0});function g(){c.cm.state.focused&&(c.pollSelection(),c.polling.set(c.cm.options.pollInterval,g))}this.polling.set(this.cm.options.pollInterval,g)},fn.prototype.selectionChanged=function(){var s=this.getSelection();return s.anchorNode!=this.lastAnchorNode||s.anchorOffset!=this.lastAnchorOffset||s.focusNode!=this.lastFocusNode||s.focusOffset!=this.lastFocusOffset},fn.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var s=this.getSelection(),c=this.cm;if(k&&v&&this.cm.display.gutterSpecs.length&&t2(s.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var g=Iu(c,s.anchorNode,s.anchorOffset),p=Iu(c,s.focusNode,s.focusOffset);g&&p&&Ir(c,function(){ir(c.doc,vo(g,p),We),(g.bad||p.bad)&&(c.curOp.selectionChanged=!0)})}}},fn.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var s=this.cm,c=s.display,g=s.doc.sel.primary(),p=g.from(),m=g.to();if(p.ch==0&&p.line>s.firstLine()&&(p=Ee(p.line-1,Ke(s.doc,p.line-1).length)),m.ch==Ke(s.doc,m.line).text.length&&m.line<s.lastLine()&&(m=Ee(m.line+1,0)),p.line<c.viewFrom||m.line>c.viewTo-1)return!1;var C,M,R;p.line==c.viewFrom||(C=Uo(s,p.line))==0?(M=P(c.view[0].line),R=c.view[0].node):(M=P(c.view[C].line),R=c.view[C-1].node.nextSibling);var j=Uo(s,m.line),z,re;if(j==c.view.length-1?(z=c.viewTo-1,re=c.lineDiv.lastChild):(z=P(c.view[j+1].line)-1,re=c.view[j+1].node.previousSibling),!R)return!1;for(var le=s.doc.splitLines(n2(s,R,re,M,z)),Ce=Ut(s.doc,Ee(M,0),Ee(z,Ke(s.doc,z).text.length));le.length>1&&Ce.length>1;)if(A(le)==A(Ce))le.pop(),Ce.pop(),z--;else if(le[0]==Ce[0])le.shift(),Ce.shift(),M++;else break;for(var _e=0,Fe=0,Ge=le[0],nt=Ce[0],ut=Math.min(Ge.length,nt.length);_e<ut&&Ge.charCodeAt(_e)==nt.charCodeAt(_e);)++_e;for(var yt=A(le),dt=A(Ce),xt=Math.min(yt.length-(le.length==1?_e:0),dt.length-(Ce.length==1?_e:0));Fe<xt&&yt.charCodeAt(yt.length-Fe-1)==dt.charCodeAt(dt.length-Fe-1);)++Fe;if(le.length==1&&Ce.length==1&&M==p.line)for(;_e&&_e>p.ch&&yt.charCodeAt(yt.length-Fe-1)==dt.charCodeAt(dt.length-Fe-1);)_e--,Fe++;le[le.length-1]=yt.slice(0,yt.length-Fe).replace(/^\u200b+/,""),le[0]=le[0].slice(_e).replace(/\u200b+$/,"");var At=Ee(M,_e),Nt=Ee(z,Ce.length?A(Ce).length-Fe:0);if(le.length>1||le[0]||Me(At,Nt))return Pa(s.doc,le,At,Nt,"+input"),!0},fn.prototype.ensurePolled=function(){this.forceCompositionEnd()},fn.prototype.reset=function(){this.forceCompositionEnd()},fn.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},fn.prototype.readFromDOMSoon=function(){var s=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(s.readDOMTimeout=null,s.composing)if(s.composing.done)s.composing=null;else return;s.updateFromDOM()},80))},fn.prototype.updateFromDOM=function(){var s=this;(this.cm.isReadOnly()||!this.pollContent())&&Ir(this.cm,function(){return _r(s.cm)})},fn.prototype.setUneditable=function(s){s.contentEditable="false"},fn.prototype.onKeyPress=function(s){s.charCode==0||this.composing||(s.preventDefault(),this.cm.isReadOnly()||Gn(this.cm,Df)(this.cm,String.fromCharCode(s.charCode==null?s.keyCode:s.charCode),0))},fn.prototype.readOnlyChanged=function(s){this.div.contentEditable=String(s!="nocursor")},fn.prototype.onContextMenu=function(){},fn.prototype.resetPosition=function(){},fn.prototype.needsContentAttribute=!0;function vy(s,c){var g=Qc(s,c.line);if(!g||g.hidden)return null;var p=Ke(s.doc,c.line),m=Vg(g,p,c.line),C=st(p,s.doc.direction),M="left";if(C){var R=ht(C,c.ch);M=R%2?"right":"left"}var j=qg(m.map,c.ch,M);return j.offset=j.collapse=="right"?j.end:j.start,j}function t2(s){for(var c=s;c;c=c.parentNode)if(/CodeMirror-gutter-wrapper/.test(c.className))return!0;return!1}function Ha(s,c){return c&&(s.bad=!0),s}function n2(s,c,g,p,m){var C="",M=!1,R=s.doc.lineSeparator(),j=!1;function z(_e){return function(Fe){return Fe.id==_e}}function re(){M&&(C+=R,j&&(C+=R),M=j=!1)}function le(_e){_e&&(re(),C+=_e)}function Ce(_e){if(_e.nodeType==1){var Fe=_e.getAttribute("cm-text");if(Fe){le(Fe);return}var Ge=_e.getAttribute("cm-marker"),nt;if(Ge){var ut=s.findMarks(Ee(p,0),Ee(m+1,0),z(+Ge));ut.length&&(nt=ut[0].find(0))&&le(Ut(s.doc,nt.from,nt.to).join(R));return}if(_e.getAttribute("contenteditable")=="false")return;var yt=/^(pre|div|p|li|table|br)$/i.test(_e.nodeName);if(!/^br$/i.test(_e.nodeName)&&_e.textContent.length==0)return;yt&&re();for(var dt=0;dt<_e.childNodes.length;dt++)Ce(_e.childNodes[dt]);/^(pre|p)$/i.test(_e.nodeName)&&(j=!0),yt&&(M=!0)}else _e.nodeType==3&&le(_e.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;Ce(c),c!=g;)c=c.nextSibling,j=!1;return C}function Iu(s,c,g){var p;if(c==s.display.lineDiv){if(p=s.display.lineDiv.childNodes[g],!p)return Ha(s.clipPos(Ee(s.display.viewTo-1)),!0);c=null,g=0}else for(p=c;;p=p.parentNode){if(!p||p==s.display.lineDiv)return null;if(p.parentNode&&p.parentNode==s.display.lineDiv)break}for(var m=0;m<s.display.view.length;m++){var C=s.display.view[m];if(C.node==p)return r2(C,c,g)}}function r2(s,c,g){var p=s.text.firstChild,m=!1;if(!c||!de(p,c))return Ha(Ee(P(s.line),0),!0);if(c==p&&(m=!0,c=p.childNodes[g],g=0,!c)){var C=s.rest?A(s.rest):s.line;return Ha(Ee(P(C),C.text.length),m)}var M=c.nodeType==3?c:null,R=c;for(!M&&c.childNodes.length==1&&c.firstChild.nodeType==3&&(M=c.firstChild,g&&(g=M.nodeValue.length));R.parentNode!=p;)R=R.parentNode;var j=s.measure,z=j.maps;function re(nt,ut,yt){for(var dt=-1;dt<(z?z.length:0);dt++)for(var xt=dt<0?j.map:z[dt],At=0;At<xt.length;At+=3){var Nt=xt[At+2];if(Nt==nt||Nt==ut){var Vt=P(dt<0?s.line:s.rest[dt]),gn=xt[At]+yt;return(yt<0||Nt!=nt)&&(gn=xt[At+(yt?1:0)]),Ee(Vt,gn)}}}var le=re(M,R,g);if(le)return Ha(le,m);for(var Ce=R.nextSibling,_e=M?M.nodeValue.length-g:0;Ce;Ce=Ce.nextSibling){if(le=re(Ce,Ce.firstChild,0),le)return Ha(Ee(le.line,le.ch-_e),m);_e+=Ce.textContent.length}for(var Fe=R.previousSibling,Ge=g;Fe;Fe=Fe.previousSibling){if(le=re(Fe,Fe.firstChild,-1),le)return Ha(Ee(le.line,le.ch+Ge),m);Ge+=Fe.textContent.length}}var In=function(s){this.cm=s,this.prevInput="",this.pollingFast=!1,this.polling=new he,this.hasSelection=!1,this.composing=null,this.resetting=!1};In.prototype.init=function(s){var c=this,g=this,p=this.cm;this.createField(s);var m=this.textarea;s.wrapper.insertBefore(this.wrapper,s.wrapper.firstChild),E&&(m.style.width="0px"),Ne(m,"input",function(){u&&d>=9&&c.hasSelection&&(c.hasSelection=null),g.poll()}),Ne(m,"paste",function(M){et(p,M)||dy(M,p)||(p.state.pasteIncoming=+new Date,g.fastPoll())});function C(M){if(!et(p,M)){if(p.somethingSelected())Ru({lineWise:!1,text:p.getSelections()});else if(p.options.lineWiseCopyCut){var R=fy(p);Ru({lineWise:!0,text:R.text}),M.type=="cut"?p.setSelections(R.ranges,null,We):(g.prevInput="",m.value=R.text.join(`
`),Re(m))}else return;M.type=="cut"&&(p.state.cutIncoming=+new Date)}}Ne(m,"cut",C),Ne(m,"copy",C),Ne(s.scroller,"paste",function(M){if(!(eo(s,M)||et(p,M))){if(!m.dispatchEvent){p.state.pasteIncoming=+new Date,g.focus();return}var R=new Event("paste");R.clipboardData=M.clipboardData,m.dispatchEvent(R)}}),Ne(s.lineSpace,"selectstart",function(M){eo(s,M)||ft(M)}),Ne(m,"compositionstart",function(){var M=p.getCursor("from");g.composing&&g.composing.range.clear(),g.composing={start:M,range:p.markText(M,p.getCursor("to"),{className:"CodeMirror-composing"})}}),Ne(m,"compositionend",function(){g.composing&&(g.poll(),g.composing.range.clear(),g.composing=null)})},In.prototype.createField=function(s){this.wrapper=hy(),this.textarea=this.wrapper.firstChild;var c=this.cm.options;Lf(this.textarea,c.spellcheck,c.autocorrect,c.autocapitalize)},In.prototype.screenReaderLabelChanged=function(s){s?this.textarea.setAttribute("aria-label",s):this.textarea.removeAttribute("aria-label")},In.prototype.prepareSelection=function(){var s=this.cm,c=s.display,g=s.doc,p=im(s);if(s.options.moveInputWithCursor){var m=vi(s,g.sel.primary().head,"div"),C=c.wrapper.getBoundingClientRect(),M=c.lineDiv.getBoundingClientRect();p.teTop=Math.max(0,Math.min(c.wrapper.clientHeight-10,m.top+M.top-C.top)),p.teLeft=Math.max(0,Math.min(c.wrapper.clientWidth-10,m.left+M.left-C.left))}return p},In.prototype.showSelection=function(s){var c=this.cm,g=c.display;W(g.cursorDiv,s.cursors),W(g.selectionDiv,s.selection),s.teTop!=null&&(this.wrapper.style.top=s.teTop+"px",this.wrapper.style.left=s.teLeft+"px")},In.prototype.reset=function(s){if(!(this.contextMenuPending||this.composing&&s)){var c=this.cm;if(this.resetting=!0,c.somethingSelected()){this.prevInput="";var g=c.getSelection();this.textarea.value=g,c.state.focused&&Re(this.textarea),u&&d>=9&&(this.hasSelection=g)}else s||(this.prevInput=this.textarea.value="",u&&d>=9&&(this.hasSelection=null));this.resetting=!1}},In.prototype.getField=function(){return this.textarea},In.prototype.supportsTouch=function(){return!1},In.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!O||Se(ue(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},In.prototype.blur=function(){this.textarea.blur()},In.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},In.prototype.receivedFocus=function(){this.slowPoll()},In.prototype.slowPoll=function(){var s=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){s.poll(),s.cm.state.focused&&s.slowPoll()})},In.prototype.fastPoll=function(){var s=!1,c=this;c.pollingFast=!0;function g(){var p=c.poll();!p&&!s?(s=!0,c.polling.set(60,g)):(c.pollingFast=!1,c.slowPoll())}c.polling.set(20,g)},In.prototype.poll=function(){var s=this,c=this.cm,g=this.textarea,p=this.prevInput;if(this.contextMenuPending||this.resetting||!c.state.focused||Dr(g)&&!p&&!this.composing||c.isReadOnly()||c.options.disableInput||c.state.keySeq)return!1;var m=g.value;if(m==p&&!c.somethingSelected())return!1;if(u&&d>=9&&this.hasSelection===m||N&&/[\uf700-\uf7ff]/.test(m))return c.display.input.reset(),!1;if(c.doc.sel==c.display.selForContextMenu){var C=m.charCodeAt(0);if(C==8203&&!p&&(p="​"),C==8666)return this.reset(),this.cm.execCommand("undo")}for(var M=0,R=Math.min(p.length,m.length);M<R&&p.charCodeAt(M)==m.charCodeAt(M);)++M;return Ir(c,function(){Df(c,m.slice(M),p.length-M,null,s.composing?"*compose":null),m.length>1e3||m.indexOf(`
`)>-1?g.value=s.prevInput="":s.prevInput=m,s.composing&&(s.composing.range.clear(),s.composing.range=c.markText(s.composing.start,c.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},In.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},In.prototype.onKeyPress=function(){u&&d>=9&&(this.hasSelection=null),this.fastPoll()},In.prototype.onContextMenu=function(s){var c=this,g=c.cm,p=g.display,m=c.textarea;c.contextMenuPending&&c.contextMenuPending();var C=zo(g,s),M=p.scroller.scrollTop;if(!C||x)return;var R=g.options.resetSelectionOnContextMenu;R&&g.doc.sel.contains(C)==-1&&Gn(g,ir)(g.doc,vo(C),We);var j=m.style.cssText,z=c.wrapper.style.cssText,re=c.wrapper.offsetParent.getBoundingClientRect();c.wrapper.style.cssText="position: static",m.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(s.clientY-re.top-5)+"px; left: "+(s.clientX-re.left-5)+`px;
      z-index: 1000; background: `+(u?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var le;f&&(le=m.ownerDocument.defaultView.scrollY),p.input.focus(),f&&m.ownerDocument.defaultView.scrollTo(null,le),p.input.reset(),g.somethingSelected()||(m.value=c.prevInput=" "),c.contextMenuPending=_e,p.selForContextMenu=g.doc.sel,clearTimeout(p.detectingSelectAll);function Ce(){if(m.selectionStart!=null){var Ge=g.somethingSelected(),nt="​"+(Ge?m.value:"");m.value="⇚",m.value=nt,c.prevInput=Ge?"":"​",m.selectionStart=1,m.selectionEnd=nt.length,p.selForContextMenu=g.doc.sel}}function _e(){if(c.contextMenuPending==_e&&(c.contextMenuPending=!1,c.wrapper.style.cssText=z,m.style.cssText=j,u&&d<9&&p.scrollbars.setScrollTop(p.scroller.scrollTop=M),m.selectionStart!=null)){(!u||u&&d<9)&&Ce();var Ge=0,nt=function(){p.selForContextMenu==g.doc.sel&&m.selectionStart==0&&m.selectionEnd>0&&c.prevInput=="​"?Gn(g,Pm)(g):Ge++<10?p.detectingSelectAll=setTimeout(nt,500):(p.selForContextMenu=null,p.input.reset())};p.detectingSelectAll=setTimeout(nt,200)}}if(u&&d>=9&&Ce(),X){Kt(s);var Fe=function(){ct(window,"mouseup",Fe),setTimeout(_e,20)};Ne(window,"mouseup",Fe)}else setTimeout(_e,50)},In.prototype.readOnlyChanged=function(s){s||this.reset(),this.textarea.disabled=s=="nocursor",this.textarea.readOnly=!!s},In.prototype.setUneditable=function(){},In.prototype.needsContentAttribute=!1;function i2(s,c){if(c=c?ne(c):{},c.value=s.value,!c.tabindex&&s.tabIndex&&(c.tabindex=s.tabIndex),!c.placeholder&&s.placeholder&&(c.placeholder=s.placeholder),c.autofocus==null){var g=Se(ue(s));c.autofocus=g==s||s.getAttribute("autofocus")!=null&&g==document.body}function p(){s.value=R.getValue()}var m;if(s.form&&(Ne(s.form,"submit",p),!c.leaveSubmitMethodAlone)){var C=s.form;m=C.submit;try{var M=C.submit=function(){p(),C.submit=m,C.submit(),C.submit=M}}catch{}}c.finishInit=function(j){j.save=p,j.getTextArea=function(){return s},j.toTextArea=function(){j.toTextArea=isNaN,p(),s.parentNode.removeChild(j.getWrapperElement()),s.style.display="",s.form&&(ct(s.form,"submit",p),!c.leaveSubmitMethodAlone&&typeof s.form.submit=="function"&&(s.form.submit=m))}},s.style.display="none";var R=wn(function(j){return s.parentNode.insertBefore(j,s.nextSibling)},c);return R}function o2(s){s.off=ct,s.on=Ne,s.wheelEventPixels=fE,s.Doc=br,s.splitLines=Pn,s.countColumn=fe,s.findColumn=Ht,s.isWordChar=ge,s.Pass=Ze,s.signal=Xe,s.Line=Sa,s.changeEnd=go,s.scrollbarModel=dm,s.Pos=Ee,s.cmpPos=Me,s.modes=Vr,s.mimeModes=Vn,s.resolveMode=Lr,s.getMode=ti,s.modeExtensions=Pr,s.extendMode=Wr,s.copyState=Q,s.startState=Ye,s.innerMode=Oe,s.commands=rl,s.keyMap=no,s.keyName=Km,s.isModifierKey=Xm,s.lookupKey=Ia,s.normalizeKeyMap=PE,s.StringStream=at,s.SharedTextMarker=el,s.TextMarker=yo,s.LineWidget=Qs,s.e_preventDefault=ft,s.e_stopPropagation=Ct,s.e_stop=Kt,s.addClass=me,s.contains=de,s.rmClass=q,s.keyNames=_o}KE(wn),e2(wn);var a2="iter insert remove copy getEditor constructor".split(" ");for(var Bu in br.prototype)br.prototype.hasOwnProperty(Bu)&&be(a2,Bu)<0&&(wn.prototype[Bu]=function(s){return function(){return s.apply(this.doc,arguments)}}(br.prototype[Bu]));return Je(br),wn.inputStyles={textarea:In,contenteditable:fn},wn.defineMode=function(s){!wn.defaults.mode&&s!="null"&&(wn.defaults.mode=s),cr.apply(this,arguments)},wn.defineMIME=fr,wn.defineMode("null",function(){return{token:function(s){return s.skipToEnd()}}}),wn.defineMIME("text/plain","null"),wn.defineExtension=function(s,c){wn.prototype[s]=c},wn.defineDocExtension=function(s,c){br.prototype[s]=c},wn.fromTextArea=i2,o2(wn),wn.version="5.65.19",wn})}(fd)),fd.exports}var xy;function jP(){return xy||(xy=1,function(n,e){(function(t){t(Ro())})(function(t){t.defineMode("javascript",function(r,i){var o=r.indentUnit,a=i.statementIndent,l=i.jsonld,u=i.json||l,d=i.trackScope!==!1,f=i.typescript,h=i.wordCharacters||/[\w$\xa1-\uffff]/,v=function(){function P(wt){return{type:wt,style:"keyword"}}var Y=P("keyword a"),ye=P("keyword b"),Pe=P("keyword c"),Ee=P("keyword d"),Me=P("operator"),ot={type:"atom",style:"atom"};return{if:P("if"),while:Y,with:Y,else:ye,do:ye,try:ye,finally:ye,return:Ee,break:Ee,continue:Ee,new:P("new"),delete:Pe,void:Pe,throw:Pe,debugger:P("debugger"),var:P("var"),const:P("var"),let:P("var"),function:P("function"),catch:P("catch"),for:P("for"),switch:P("switch"),case:P("case"),default:P("default"),in:Me,typeof:Me,instanceof:Me,true:ot,false:ot,null:ot,undefined:ot,NaN:ot,Infinity:ot,this:P("this"),class:P("class"),super:P("atom"),yield:Pe,export:P("export"),import:P("import"),extends:Pe,await:Pe}}(),y=/[+\-*&%=<>!?|~^@]/,x=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function w(P){for(var Y=!1,ye,Pe=!1;(ye=P.next())!=null;){if(!Y){if(ye=="/"&&!Pe)return;ye=="["?Pe=!0:Pe&&ye=="]"&&(Pe=!1)}Y=!Y&&ye=="\\"}}var _,b;function E(P,Y,ye){return _=P,b=ye,Y}function k(P,Y){var ye=P.next();if(ye=='"'||ye=="'")return Y.tokenize=O(ye),Y.tokenize(P,Y);if(ye=="."&&P.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return E("number","number");if(ye=="."&&P.match(".."))return E("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(ye))return E(ye);if(ye=="="&&P.eat(">"))return E("=>","operator");if(ye=="0"&&P.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return E("number","number");if(/\d/.test(ye))return P.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),E("number","number");if(ye=="/")return P.eat("*")?(Y.tokenize=N,N(P,Y)):P.eat("/")?(P.skipToEnd(),E("comment","comment")):ee(P,Y,1)?(w(P),P.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),E("regexp","string-2")):(P.eat("="),E("operator","operator",P.current()));if(ye=="`")return Y.tokenize=I,I(P,Y);if(ye=="#"&&P.peek()=="!")return P.skipToEnd(),E("meta","meta");if(ye=="#"&&P.eatWhile(h))return E("variable","property");if(ye=="<"&&P.match("!--")||ye=="-"&&P.match("->")&&!/\S/.test(P.string.slice(0,P.start)))return P.skipToEnd(),E("comment","comment");if(y.test(ye))return(ye!=">"||!Y.lexical||Y.lexical.type!=">")&&(P.eat("=")?(ye=="!"||ye=="=")&&P.eat("="):/[<>*+\-|&?]/.test(ye)&&(P.eat(ye),ye==">"&&P.eat(ye))),ye=="?"&&P.eat(".")?E("."):E("operator","operator",P.current());if(h.test(ye)){P.eatWhile(h);var Pe=P.current();if(Y.lastType!="."){if(v.propertyIsEnumerable(Pe)){var Ee=v[Pe];return E(Ee.type,Ee.style,Pe)}if(Pe=="async"&&P.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return E("async","keyword",Pe)}return E("variable","variable",Pe)}}function O(P){return function(Y,ye){var Pe=!1,Ee;if(l&&Y.peek()=="@"&&Y.match(x))return ye.tokenize=k,E("jsonld-keyword","meta");for(;(Ee=Y.next())!=null&&!(Ee==P&&!Pe);)Pe=!Pe&&Ee=="\\";return Pe||(ye.tokenize=k),E("string","string")}}function N(P,Y){for(var ye=!1,Pe;Pe=P.next();){if(Pe=="/"&&ye){Y.tokenize=k;break}ye=Pe=="*"}return E("comment","comment")}function I(P,Y){for(var ye=!1,Pe;(Pe=P.next())!=null;){if(!ye&&(Pe=="`"||Pe=="$"&&P.eat("{"))){Y.tokenize=k;break}ye=!ye&&Pe=="\\"}return E("quasi","string-2",P.current())}var T="([{}])";function L(P,Y){Y.fatArrowAt&&(Y.fatArrowAt=null);var ye=P.string.indexOf("=>",P.start);if(!(ye<0)){if(f){var Pe=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(P.string.slice(P.start,ye));Pe&&(ye=Pe.index)}for(var Ee=0,Me=!1,ot=ye-1;ot>=0;--ot){var wt=P.string.charAt(ot),Pt=T.indexOf(wt);if(Pt>=0&&Pt<3){if(!Ee){++ot;break}if(--Ee==0){wt=="("&&(Me=!0);break}}else if(Pt>=3&&Pt<6)++Ee;else if(h.test(wt))Me=!0;else if(/["'\/`]/.test(wt))for(;;--ot){if(ot==0)return;var Rn=P.string.charAt(ot-1);if(Rn==wt&&P.string.charAt(ot-2)!="\\"){ot--;break}}else if(Me&&!Ee){++ot;break}}Me&&!Ee&&(Y.fatArrowAt=ot)}}var H={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function X(P,Y,ye,Pe,Ee,Me){this.indented=P,this.column=Y,this.type=ye,this.prev=Ee,this.info=Me,Pe!=null&&(this.align=Pe)}function V(P,Y){if(!d)return!1;for(var ye=P.localVars;ye;ye=ye.next)if(ye.name==Y)return!0;for(var Pe=P.context;Pe;Pe=Pe.prev)for(var ye=Pe.vars;ye;ye=ye.next)if(ye.name==Y)return!0}function q(P,Y,ye,Pe,Ee){var Me=P.cc;for(D.state=P,D.stream=Ee,D.marked=null,D.cc=Me,D.style=Y,P.lexical.hasOwnProperty("align")||(P.lexical.align=!0);;){var ot=Me.length?Me.pop():u?be:fe;if(ot(ye,Pe)){for(;Me.length&&Me[Me.length-1].lex;)Me.pop()();return D.marked?D.marked:ye=="variable"&&V(P,Pe)?"variable-2":Y}}}var D={state:null,marked:null,cc:null};function W(){for(var P=arguments.length-1;P>=0;P--)D.cc.push(arguments[P])}function $(){return W.apply(null,arguments),!0}function pe(P,Y){for(var ye=Y;ye;ye=ye.next)if(ye.name==P)return!0;return!1}function De(P){var Y=D.state;if(D.marked="def",!!d){if(Y.context){if(Y.lexical.info=="var"&&Y.context&&Y.context.block){var ye=de(P,Y.context);if(ye!=null){Y.context=ye;return}}else if(!pe(P,Y.localVars)){Y.localVars=new ve(P,Y.localVars);return}}i.globalVars&&!pe(P,Y.globalVars)&&(Y.globalVars=new ve(P,Y.globalVars))}}function de(P,Y){if(Y)if(Y.block){var ye=de(P,Y.prev);return ye?ye==Y.prev?Y:new me(ye,Y.vars,!0):null}else return pe(P,Y.vars)?Y:new me(Y.prev,new ve(P,Y.vars),!1);else return null}function Se(P){return P=="public"||P=="private"||P=="protected"||P=="abstract"||P=="readonly"}function me(P,Y,ye){this.prev=P,this.vars=Y,this.block=ye}function ve(P,Y){this.name=P,this.next=Y}var Re=new ve("this",new ve("arguments",null));function Ie(){D.state.context=new me(D.state.context,D.state.localVars,!1),D.state.localVars=Re}function ce(){D.state.context=new me(D.state.context,D.state.localVars,!0),D.state.localVars=null}Ie.lex=ce.lex=!0;function ue(){D.state.localVars=D.state.context.vars,D.state.context=D.state.context.prev}ue.lex=!0;function K(P,Y){var ye=function(){var Pe=D.state,Ee=Pe.indented;if(Pe.lexical.type=="stat")Ee=Pe.lexical.indented;else for(var Me=Pe.lexical;Me&&Me.type==")"&&Me.align;Me=Me.prev)Ee=Me.indented;Pe.lexical=new X(Ee,D.stream.column(),P,null,Pe.lexical,Y)};return ye.lex=!0,ye}function ie(){var P=D.state;P.lexical.prev&&(P.lexical.type==")"&&(P.indented=P.lexical.indented),P.lexical=P.lexical.prev)}ie.lex=!0;function ne(P){function Y(ye){return ye==P?$():P==";"||ye=="}"||ye==")"||ye=="]"?W():$(Y)}return Y}function fe(P,Y){return P=="var"?$(K("vardef",Y),Ct,ne(";"),ie):P=="keyword a"?$(K("form"),Ze,fe,ie):P=="keyword b"?$(K("form"),fe,ie):P=="keyword d"?D.stream.match(/^\s*$/,!1)?$():$(K("stat"),St,ne(";"),ie):P=="debugger"?$(ne(";")):P=="{"?$(K("}"),ce,bt,ie,ue):P==";"?$():P=="if"?(D.state.lexical.info=="else"&&D.state.cc[D.state.cc.length-1]==ie&&D.state.cc.pop()(),$(K("form"),Ze,fe,ie,Qr)):P=="function"?$(Pn):P=="for"?$(K("form"),ce,ei,fe,ue,ie):P=="class"||f&&Y=="interface"?(D.marked="keyword",$(K("form",P=="class"?P:Y),Vr,ie)):P=="variable"?f&&Y=="declare"?(D.marked="keyword",$(fe)):f&&(Y=="module"||Y=="enum"||Y=="type")&&D.stream.match(/^\s*\w/,!1)?(D.marked="keyword",Y=="enum"?$(Ke):Y=="type"?$(hi,ne("operator"),st,ne(";")):$(K("form"),Ft,ne("{"),K("}"),bt,ie,ie)):f&&Y=="namespace"?(D.marked="keyword",$(K("form"),be,fe,ie)):f&&Y=="abstract"?(D.marked="keyword",$(fe)):$(K("stat"),oe):P=="switch"?$(K("form"),Ze,ne("{"),K("}","switch"),ce,bt,ie,ie,ue):P=="case"?$(be,ne(":")):P=="default"?$(ne(":")):P=="catch"?$(K("form"),Ie,he,fe,ie,ue):P=="export"?$(K("stat"),Lr,ie):P=="import"?$(K("stat"),Pr,ie):P=="async"?$(fe):Y=="@"?$(be,fe):W(K("stat"),be,ne(";"),ie)}function he(P){if(P=="(")return $(Tt,ne(")"))}function be(P,Y){return We(P,Y,!1)}function xe(P,Y){return We(P,Y,!0)}function Ze(P){return P!="("?W():$(K(")"),St,ne(")"),ie)}function We(P,Y,ye){if(D.state.fatArrowAt==D.stream.start){var Pe=ye?F:A;if(P=="(")return $(Ie,K(")"),tt(Tt,")"),ie,ne("=>"),Pe,ue);if(P=="variable")return W(Ie,Ft,ne("=>"),Pe,ue)}var Ee=ye?Ht:pt;return H.hasOwnProperty(P)?$(Ee):P=="function"?$(Pn,Ee):P=="class"||f&&Y=="interface"?(D.marked="keyword",$(K("form"),Ii,ie)):P=="keyword c"||P=="async"?$(ye?xe:be):P=="("?$(K(")"),St,ne(")"),ie,Ee):P=="operator"||P=="spread"?$(ye?xe:be):P=="["?$(K("]"),at,ie,Ee):P=="{"?vt(Te,"}",null,Ee):P=="quasi"?W(Qt,Ee):P=="new"?$(Z(ye)):$()}function St(P){return P.match(/[;\}\)\],]/)?W():W(be)}function pt(P,Y){return P==","?$(St):Ht(P,Y,!1)}function Ht(P,Y,ye){var Pe=ye==!1?pt:Ht,Ee=ye==!1?be:xe;if(P=="=>")return $(Ie,ye?F:A,ue);if(P=="operator")return/\+\+|--/.test(Y)||f&&Y=="!"?$(Pe):f&&Y=="<"&&D.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?$(K(">"),tt(st,">"),ie,Pe):Y=="?"?$(be,ne(":"),Ee):$(Ee);if(P=="quasi")return W(Qt,Pe);if(P!=";"){if(P=="(")return vt(xe,")","call",Pe);if(P==".")return $(ge,Pe);if(P=="[")return $(K("]"),St,ne("]"),ie,Pe);if(f&&Y=="as")return D.marked="keyword",$(st,Pe);if(P=="regexp")return D.state.lastType=D.marked="operator",D.stream.backUp(D.stream.pos-D.stream.start-1),$(Ee)}}function Qt(P,Y){return P!="quasi"?W():Y.slice(Y.length-2)!="${"?$(Qt):$(St,te)}function te(P){if(P=="}")return D.marked="string-2",D.state.tokenize=I,$(Qt)}function A(P){return L(D.stream,D.state),W(P=="{"?fe:be)}function F(P){return L(D.stream,D.state),W(P=="{"?fe:xe)}function Z(P){return function(Y){return Y=="."?$(P?se:J):Y=="variable"&&f?$(we,P?Ht:pt):W(P?xe:be)}}function J(P,Y){if(Y=="target")return D.marked="keyword",$(pt)}function se(P,Y){if(Y=="target")return D.marked="keyword",$(Ht)}function oe(P){return P==":"?$(ie,fe):W(pt,ne(";"),ie)}function ge(P){if(P=="variable")return D.marked="property",$()}function Te(P,Y){if(P=="async")return D.marked="property",$(Te);if(P=="variable"||D.style=="keyword"){if(D.marked="property",Y=="get"||Y=="set")return $(Le);var ye;return f&&D.state.fatArrowAt==D.stream.start&&(ye=D.stream.match(/^\s*:\s*/,!1))&&(D.state.fatArrowAt=D.stream.pos+ye[0].length),$(Ue)}else{if(P=="number"||P=="string")return D.marked=l?"property":D.style+" property",$(Ue);if(P=="jsonld-keyword")return $(Ue);if(f&&Se(Y))return D.marked="keyword",$(Te);if(P=="[")return $(be,Lt,ne("]"),Ue);if(P=="spread")return $(xe,Ue);if(Y=="*")return D.marked="keyword",$(Te);if(P==":")return W(Ue)}}function Le(P){return P!="variable"?W(Ue):(D.marked="property",$(Pn))}function Ue(P){if(P==":")return $(xe);if(P=="(")return W(Pn)}function tt(P,Y,ye){function Pe(Ee,Me){if(ye?ye.indexOf(Ee)>-1:Ee==","){var ot=D.state.lexical;return ot.info=="call"&&(ot.pos=(ot.pos||0)+1),$(function(wt,Pt){return wt==Y||Pt==Y?W():W(P)},Pe)}return Ee==Y||Me==Y?$():ye&&ye.indexOf(";")>-1?W(P):$(ne(Y))}return function(Ee,Me){return Ee==Y||Me==Y?$():W(P,Pe)}}function vt(P,Y,ye){for(var Pe=3;Pe<arguments.length;Pe++)D.cc.push(arguments[Pe]);return $(K(Y,ye),tt(P,Y),ie)}function bt(P){return P=="}"?$():W(fe,bt)}function Lt(P,Y){if(f){if(P==":")return $(st);if(Y=="?")return $(Lt)}}function Qe(P,Y){if(f&&(P==":"||Y=="in"))return $(st)}function ht(P){if(f&&P==":")return D.stream.match(/^\s*\w+\s+is\b/,!1)?$(be,Rt,st):$(st)}function Rt(P,Y){if(Y=="is")return D.marked="keyword",$()}function st(P,Y){if(Y=="keyof"||Y=="typeof"||Y=="infer"||Y=="readonly")return D.marked="keyword",$(Y=="typeof"?xe:st);if(P=="variable"||Y=="void")return D.marked="type",$(lt);if(Y=="|"||Y=="&")return $(st);if(P=="string"||P=="number"||P=="atom")return $(lt);if(P=="[")return $(K("]"),tt(st,"]",","),ie,lt);if(P=="{")return $(K("}"),Ne,ie,lt);if(P=="(")return $(tt(et,")"),cn,lt);if(P=="<")return $(tt(st,">"),st);if(P=="quasi")return W(ct,lt)}function cn(P){if(P=="=>")return $(st)}function Ne(P){return P.match(/[\}\)\]]/)?$():P==","||P==";"?$(Ne):W(it,Ne)}function it(P,Y){if(P=="variable"||D.style=="keyword")return D.marked="property",$(it);if(Y=="?"||P=="number"||P=="string")return $(it);if(P==":")return $(st);if(P=="[")return $(ne("variable"),Qe,ne("]"),it);if(P=="(")return W(Dr,it);if(!P.match(/[;\}\)\],]/))return $()}function ct(P,Y){return P!="quasi"?W():Y.slice(Y.length-2)!="${"?$(ct):$(st,Xe)}function Xe(P){if(P=="}")return D.marked="string-2",D.state.tokenize=I,$(ct)}function et(P,Y){return P=="variable"&&D.stream.match(/^\s*[?:]/,!1)||Y=="?"?$(et):P==":"?$(st):P=="spread"?$(et):W(st)}function lt(P,Y){if(Y=="<")return $(K(">"),tt(st,">"),ie,lt);if(Y=="|"||P=="."||Y=="&")return $(st);if(P=="[")return $(st,ne("]"),lt);if(Y=="extends"||Y=="implements")return D.marked="keyword",$(st);if(Y=="?")return $(st,ne(":"),st)}function we(P,Y){if(Y=="<")return $(K(">"),tt(st,">"),ie,lt)}function Je(){return W(st,ft)}function ft(P,Y){if(Y=="=")return $(st)}function Ct(P,Y){return Y=="enum"?(D.marked="keyword",$(Ke)):W(Ft,Lt,bn,Un)}function Ft(P,Y){if(f&&Se(Y))return D.marked="keyword",$(Ft);if(P=="variable")return De(Y),$();if(P=="spread")return $(Ft);if(P=="[")return vt(rr,"]");if(P=="{")return vt(Kt,"}")}function Kt(P,Y){return P=="variable"&&!D.stream.match(/^\s*:/,!1)?(De(Y),$(bn)):(P=="variable"&&(D.marked="property"),P=="spread"?$(Ft):P=="}"?W():P=="["?$(be,ne("]"),ne(":"),Kt):$(ne(":"),Ft,bn))}function rr(){return W(Ft,bn)}function bn(P,Y){if(Y=="=")return $(xe)}function Un(P){if(P==",")return $(Ct)}function Qr(P,Y){if(P=="keyword b"&&Y=="else")return $(K("form","else"),fe,ie)}function ei(P,Y){if(Y=="await")return $(ei);if(P=="(")return $(K(")"),en,ie)}function en(P){return P=="var"?$(Ct,Tr):P=="variable"?$(Tr):W(Tr)}function Tr(P,Y){return P==")"?$():P==";"?$(Tr):Y=="in"||Y=="of"?(D.marked="keyword",$(be,Tr)):W(be,Tr)}function Pn(P,Y){if(Y=="*")return D.marked="keyword",$(Pn);if(P=="variable")return De(Y),$(Pn);if(P=="(")return $(Ie,K(")"),tt(Tt,")"),ie,ht,fe,ue);if(f&&Y=="<")return $(K(">"),tt(Je,">"),ie,Pn)}function Dr(P,Y){if(Y=="*")return D.marked="keyword",$(Dr);if(P=="variable")return De(Y),$(Dr);if(P=="(")return $(Ie,K(")"),tt(Tt,")"),ie,ht,ue);if(f&&Y=="<")return $(K(">"),tt(Je,">"),ie,Dr)}function hi(P,Y){if(P=="keyword"||P=="variable")return D.marked="type",$(hi);if(Y=="<")return $(K(">"),tt(Je,">"),ie)}function Tt(P,Y){return Y=="@"&&$(be,Tt),P=="spread"?$(Tt):f&&Se(Y)?(D.marked="keyword",$(Tt)):f&&P=="this"?$(Lt,bn):W(Ft,Lt,bn)}function Ii(P,Y){return P=="variable"?Vr(P,Y):Vn(P,Y)}function Vr(P,Y){if(P=="variable")return De(Y),$(Vn)}function Vn(P,Y){if(Y=="<")return $(K(">"),tt(Je,">"),ie,Vn);if(Y=="extends"||Y=="implements"||f&&P==",")return Y=="implements"&&(D.marked="keyword"),$(f?st:be,Vn);if(P=="{")return $(K("}"),cr,ie)}function cr(P,Y){if(P=="async"||P=="variable"&&(Y=="static"||Y=="get"||Y=="set"||f&&Se(Y))&&D.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return D.marked="keyword",$(cr);if(P=="variable"||D.style=="keyword")return D.marked="property",$(fr,cr);if(P=="number"||P=="string")return $(fr,cr);if(P=="[")return $(be,Lt,ne("]"),fr,cr);if(Y=="*")return D.marked="keyword",$(cr);if(f&&P=="(")return W(Dr,cr);if(P==";"||P==",")return $(cr);if(P=="}")return $();if(Y=="@")return $(be,cr)}function fr(P,Y){if(Y=="!"||Y=="?")return $(fr);if(P==":")return $(st,bn);if(Y=="=")return $(xe);var ye=D.state.lexical.prev,Pe=ye&&ye.info=="interface";return W(Pe?Dr:Pn)}function Lr(P,Y){return Y=="*"?(D.marked="keyword",$(Ye,ne(";"))):Y=="default"?(D.marked="keyword",$(be,ne(";"))):P=="{"?$(tt(ti,"}"),Ye,ne(";")):W(fe)}function ti(P,Y){if(Y=="as")return D.marked="keyword",$(ne("variable"));if(P=="variable")return W(xe,ti)}function Pr(P){return P=="string"?$():P=="("?W(be):P=="."?W(pt):W(Wr,Q,Ye)}function Wr(P,Y){return P=="{"?vt(Wr,"}"):(P=="variable"&&De(Y),Y=="*"&&(D.marked="keyword"),$(Oe))}function Q(P){if(P==",")return $(Wr,Q)}function Oe(P,Y){if(Y=="as")return D.marked="keyword",$(Wr)}function Ye(P,Y){if(Y=="from")return D.marked="keyword",$(be)}function at(P){return P=="]"?$():W(tt(xe,"]"))}function Ke(){return W(K("form"),Ft,ne("{"),K("}"),tt(Ut,"}"),ie,ie)}function Ut(){return W(Ft,bn)}function yn(P,Y){return P.lastType=="operator"||P.lastType==","||y.test(Y.charAt(0))||/[,.]/.test(Y.charAt(0))}function ee(P,Y,ye){return Y.tokenize==k&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(Y.lastType)||Y.lastType=="quasi"&&/\{\s*$/.test(P.string.slice(0,P.pos-(ye||0)))}return{startState:function(P){var Y={tokenize:k,lastType:"sof",cc:[],lexical:new X((P||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new me(null,null,!1),indented:P||0};return i.globalVars&&typeof i.globalVars=="object"&&(Y.globalVars=i.globalVars),Y},token:function(P,Y){if(P.sol()&&(Y.lexical.hasOwnProperty("align")||(Y.lexical.align=!1),Y.indented=P.indentation(),L(P,Y)),Y.tokenize!=N&&P.eatSpace())return null;var ye=Y.tokenize(P,Y);return _=="comment"?ye:(Y.lastType=_=="operator"&&(b=="++"||b=="--")?"incdec":_,q(Y,ye,_,b,P))},indent:function(P,Y){if(P.tokenize==N||P.tokenize==I)return t.Pass;if(P.tokenize!=k)return 0;var ye=Y&&Y.charAt(0),Pe=P.lexical,Ee;if(!/^\s*else\b/.test(Y))for(var Me=P.cc.length-1;Me>=0;--Me){var ot=P.cc[Me];if(ot==ie)Pe=Pe.prev;else if(ot!=Qr&&ot!=ue)break}for(;(Pe.type=="stat"||Pe.type=="form")&&(ye=="}"||(Ee=P.cc[P.cc.length-1])&&(Ee==pt||Ee==Ht)&&!/^[,\.=+\-*:?[\(]/.test(Y));)Pe=Pe.prev;a&&Pe.type==")"&&Pe.prev.type=="stat"&&(Pe=Pe.prev);var wt=Pe.type,Pt=ye==wt;return wt=="vardef"?Pe.indented+(P.lastType=="operator"||P.lastType==","?Pe.info.length+1:0):wt=="form"&&ye=="{"?Pe.indented:wt=="form"?Pe.indented+o:wt=="stat"?Pe.indented+(yn(P,Y)?a||o:0):Pe.info=="switch"&&!Pt&&i.doubleIndentSwitch!=!1?Pe.indented+(/^(?:case|default)\b/.test(Y)?o:2*o):Pe.align?Pe.column+(Pt?0:1):Pe.indented+(Pt?0:o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:u?null:"/*",blockCommentEnd:u?null:"*/",blockCommentContinue:u?null:" * ",lineComment:u?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:u?"json":"javascript",jsonldMode:l,jsonMode:u,expressionAllowed:ee,skipExpression:function(P){q(P,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})}()),_y.exports}jP();var wy={exports:{}},Sy;function ox(){return Sy||(Sy=1,function(n,e){(function(t){t(Ro())})(function(t){function r(l,u,d,f){if(d&&d.call){var h=d;d=null}else var h=a(l,d,"rangeFinder");typeof u=="number"&&(u=t.Pos(u,0));var v=a(l,d,"minFoldSize");function y(b){var E=h(l,u);if(!E||E.to.line-E.from.line<v)return null;if(f==="fold")return E;for(var k=l.findMarksAt(E.from),O=0;O<k.length;++O)if(k[O].__isFold){if(!b)return null;E.cleared=!0,k[O].clear()}return E}var x=y(!0);if(a(l,d,"scanUp"))for(;!x&&u.line>l.firstLine();)u=t.Pos(u.line-1,0),x=y(!1);if(!(!x||x.cleared||f==="unfold")){var w=i(l,d,x);t.on(w,"mousedown",function(b){_.clear(),t.e_preventDefault(b)});var _=l.markText(x.from,x.to,{replacedWith:w,clearOnEnter:a(l,d,"clearOnEnter"),__isFold:!0});_.on("clear",function(b,E){t.signal(l,"unfold",l,b,E)}),t.signal(l,"fold",l,x.from,x.to)}}function i(l,u,d){var f=a(l,u,"widget");if(typeof f=="function"&&(f=f(d.from,d.to)),typeof f=="string"){var h=document.createTextNode(f);f=document.createElement("span"),f.appendChild(h),f.className="CodeMirror-foldmarker"}else f&&(f=f.cloneNode(!0));return f}t.newFoldFunction=function(l,u){return function(d,f){r(d,f,{rangeFinder:l,widget:u})}},t.defineExtension("foldCode",function(l,u,d){r(this,l,u,d)}),t.defineExtension("isFolded",function(l){for(var u=this.findMarksAt(l),d=0;d<u.length;++d)if(u[d].__isFold)return!0}),t.commands.toggleFold=function(l){l.foldCode(l.getCursor())},t.commands.fold=function(l){l.foldCode(l.getCursor(),null,"fold")},t.commands.unfold=function(l){l.foldCode(l.getCursor(),{scanUp:!1},"unfold")},t.commands.foldAll=function(l){l.operation(function(){for(var u=l.firstLine(),d=l.lastLine();u<=d;u++)l.foldCode(t.Pos(u,0),{scanUp:!1},"fold")})},t.commands.unfoldAll=function(l){l.operation(function(){for(var u=l.firstLine(),d=l.lastLine();u<=d;u++)l.foldCode(t.Pos(u,0),{scanUp:!1},"unfold")})},t.registerHelper("fold","combine",function(){var l=Array.prototype.slice.call(arguments,0);return function(u,d){for(var f=0;f<l.length;++f){var h=l[f](u,d);if(h)return h}}}),t.registerHelper("fold","auto",function(l,u){for(var d=l.getHelpers(u,"fold"),f=0;f<d.length;f++){var h=d[f](l,u);if(h)return h}});var o={rangeFinder:t.fold.auto,widget:"↔",minFoldSize:0,scanUp:!1,clearOnEnter:!0};t.defineOption("foldOptions",null);function a(l,u,d){if(u&&u[d]!==void 0)return u[d];var f=l.options.foldOptions;return f&&f[d]!==void 0?f[d]:o[d]}t.defineExtension("foldOption",function(l,u){return a(this,l,u)})})}()),wy.exports}ox();var Ey={exports:{}},Cy;function HP(){return Cy||(Cy=1,function(n,e){(function(t){t(Ro(),ox())})(function(t){t.defineOption("foldGutter",!1,function(_,b,E){E&&E!=t.Init&&(_.clearGutter(_.state.foldGutter.options.gutter),_.state.foldGutter=null,_.off("gutterClick",h),_.off("changes",y),_.off("viewportChange",x),_.off("fold",w),_.off("unfold",w),_.off("swapDoc",y),_.off("optionChange",v)),b&&(_.state.foldGutter=new i(o(b)),f(_),_.on("gutterClick",h),_.on("changes",y),_.on("viewportChange",x),_.on("fold",w),_.on("unfold",w),_.on("swapDoc",y),_.on("optionChange",v))});var r=t.Pos;function i(_){this.options=_,this.from=this.to=0}function o(_){return _===!0&&(_={}),_.gutter==null&&(_.gutter="CodeMirror-foldgutter"),_.indicatorOpen==null&&(_.indicatorOpen="CodeMirror-foldgutter-open"),_.indicatorFolded==null&&(_.indicatorFolded="CodeMirror-foldgutter-folded"),_}function a(_,b){for(var E=_.findMarks(r(b,0),r(b+1,0)),k=0;k<E.length;++k)if(E[k].__isFold){var O=E[k].find(-1);if(O&&O.line===b)return E[k]}}function l(_){if(typeof _=="string"){var b=document.createElement("div");return b.className=_+" CodeMirror-guttermarker-subtle",b}else return _.cloneNode(!0)}function u(_,b,E){var k=_.state.foldGutter.options,O=b-1,N=_.foldOption(k,"minFoldSize"),I=_.foldOption(k,"rangeFinder"),T=typeof k.indicatorFolded=="string"&&d(k.indicatorFolded),L=typeof k.indicatorOpen=="string"&&d(k.indicatorOpen);_.eachLine(b,E,function(H){++O;var X=null,V=H.gutterMarkers;if(V&&(V=V[k.gutter]),a(_,O)){if(T&&V&&T.test(V.className))return;X=l(k.indicatorFolded)}else{var q=r(O,0),D=I&&I(_,q);if(D&&D.to.line-D.from.line>=N){if(L&&V&&L.test(V.className))return;X=l(k.indicatorOpen)}}!X&&!V||_.setGutterMarker(H,k.gutter,X)})}function d(_){return new RegExp("(^|\\s)"+_+"(?:$|\\s)\\s*")}function f(_){var b=_.getViewport(),E=_.state.foldGutter;E&&(_.operation(function(){u(_,b.from,b.to)}),E.from=b.from,E.to=b.to)}function h(_,b,E){var k=_.state.foldGutter;if(k){var O=k.options;if(E==O.gutter){var N=a(_,b);N?N.clear():_.foldCode(r(b,0),O)}}}function v(_,b){b=="mode"&&y(_)}function y(_){var b=_.state.foldGutter;if(b){var E=b.options;b.from=b.to=0,clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout(function(){f(_)},E.foldOnChangeTimeSpan||600)}}function x(_){var b=_.state.foldGutter;if(b){var E=b.options;clearTimeout(b.changeUpdate),b.changeUpdate=setTimeout(function(){var k=_.getViewport();b.from==b.to||k.from-b.to>20||b.from-k.to>20?f(_):_.operation(function(){k.from<b.from&&(u(_,k.from,b.from),b.from=k.from),k.to>b.to&&(u(_,b.to,k.to),b.to=k.to)})},E.updateViewportTimeSpan||400)}}function w(_,b){var E=_.state.foldGutter;if(E){var k=b.line;k>=E.from&&k<E.to&&u(_,k,k+1)}}})}()),Ey.exports}HP();var ky={exports:{}},Oy;function $P(){return Oy||(Oy=1,function(n,e){(function(t){t(Ro())})(function(t){function r(i){return function(o,a){var l=a.line,u=o.getLine(l);function d(w){for(var _,b=a.ch,E=0;;){var k=b<=0?-1:u.lastIndexOf(w[0],b-1);if(k==-1){if(E==1)break;E=1,b=u.length;continue}if(E==1&&k<a.ch)break;if(_=o.getTokenTypeAt(t.Pos(l,k+1)),!/^(comment|string)/.test(_))return{ch:k+1,tokenType:_,pair:w};b=k-1}}function f(w){var _=1,b=o.lastLine(),E,k=w.ch,O;e:for(var N=l;N<=b;++N)for(var I=o.getLine(N),T=N==l?k:0;;){var L=I.indexOf(w.pair[0],T),H=I.indexOf(w.pair[1],T);if(L<0&&(L=I.length),H<0&&(H=I.length),T=Math.min(L,H),T==I.length)break;if(o.getTokenTypeAt(t.Pos(N,T+1))==w.tokenType){if(T==L)++_;else if(!--_){E=N,O=T;break e}}++T}return E==null||l==E?null:{from:t.Pos(l,k),to:t.Pos(E,O)}}for(var h=[],v=0;v<i.length;v++){var y=d(i[v]);y&&h.push(y)}h.sort(function(w,_){return w.ch-_.ch});for(var v=0;v<h.length;v++){var x=f(h[v]);if(x)return x}return null}}t.registerHelper("fold","brace",r([["{","}"],["[","]"]])),t.registerHelper("fold","brace-paren",r([["{","}"],["[","]"],["(",")"]])),t.registerHelper("fold","import",function(i,o){function a(v){if(v<i.firstLine()||v>i.lastLine())return null;var y=i.getTokenAt(t.Pos(v,1));if(/\S/.test(y.string)||(y=i.getTokenAt(t.Pos(v,y.end+1))),y.type!="keyword"||y.string!="import")return null;for(var x=v,w=Math.min(i.lastLine(),v+10);x<=w;++x){var _=i.getLine(x),b=_.indexOf(";");if(b!=-1)return{startCh:y.end,end:t.Pos(x,b)}}}var l=o.line,u=a(l),d;if(!u||a(l-1)||(d=a(l-2))&&d.end.line==l-1)return null;for(var f=u.end;;){var h=a(f.line+1);if(h==null)break;f=h.end}return{from:i.clipPos(t.Pos(l,u.startCh+1)),to:f}}),t.registerHelper("fold","include",function(i,o){function a(h){if(h<i.firstLine()||h>i.lastLine())return null;var v=i.getTokenAt(t.Pos(h,1));if(/\S/.test(v.string)||(v=i.getTokenAt(t.Pos(h,v.end+1))),v.type=="meta"&&v.string.slice(0,8)=="#include")return v.start+8}var l=o.line,u=a(l);if(u==null||a(l-1)!=null)return null;for(var d=l;;){var f=a(d+1);if(f==null)break;++d}return{from:t.Pos(l,u+1),to:i.clipPos(t.Pos(d))}})})}()),ky.exports}$P();var My={exports:{}},Ny;function FP(){return Ny||(Ny=1,function(n,e){(function(t){t(Ro())})(function(t){var r="CodeMirror-activeline",i="CodeMirror-activeline-background",o="CodeMirror-activeline-gutter";t.defineOption("styleActiveLine",!1,function(f,h,v){var y=v==t.Init?!1:v;h!=y&&(y&&(f.off("beforeSelectionChange",d),a(f),delete f.state.activeLines),h&&(f.state.activeLines=[],u(f,f.listSelections()),f.on("beforeSelectionChange",d)))});function a(f){for(var h=0;h<f.state.activeLines.length;h++)f.removeLineClass(f.state.activeLines[h],"wrap",r),f.removeLineClass(f.state.activeLines[h],"background",i),f.removeLineClass(f.state.activeLines[h],"gutter",o)}function l(f,h){if(f.length!=h.length)return!1;for(var v=0;v<f.length;v++)if(f[v]!=h[v])return!1;return!0}function u(f,h){for(var v=[],y=0;y<h.length;y++){var x=h[y],w=f.getOption("styleActiveLine");if(!(typeof w=="object"&&w.nonEmpty?x.anchor.line!=x.head.line:!x.empty())){var _=f.getLineHandleVisualStart(x.head.line);v[v.length-1]!=_&&v.push(_)}}l(f.state.activeLines,v)||f.operation(function(){a(f);for(var b=0;b<v.length;b++)f.addLineClass(v[b],"wrap",r),f.addLineClass(v[b],"background",i),f.addLineClass(v[b],"gutter",o);f.state.activeLines=v})}function d(f,h){u(f,h.ranges)}})}()),My.exports}FP();var zP=Ro();const ax=va(zP);var Ay={exports:{}},Ty;function UP(){return Ty||(Ty=1,function(n,e){(function(t){t(Ro())})(function(t){var r=t.Pos,i="http://www.w3.org/2000/svg";function o(A,F){this.mv=A,this.type=F,this.classes=F=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}o.prototype={constructor:o,init:function(A,F,Z){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=t(A,ne({value:F,readOnly:!this.mv.options.allowEditingOriginals},ne(Z))),this.mv.options.connect=="align"&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new Ze(this.edit)),this.orig.state.trackAlignable=new Ze(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.lockButton.setAttribute("aria-label",this.lockButton.title),this.orig.state.diffViews=[this];var J=Z.chunkClassLocation||"background";Object.prototype.toString.call(J)!="[object Array]"&&(J=[J]),this.classes.classLocation=J,this.diff=pe(W(F),W(Z.value),this.mv.options.ignoreWhitespace),this.chunks=De(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=Z.showDifferences!==!1},registerEvents:function(A){this.forceUpdate=u(this),v(this,!0,!1),d(this,A)},setShowDifferences:function(A){A=A!==!1,A!=this.showDifferences&&(this.showDifferences=A,this.forceUpdate("full"))}};function a(A){A.diffOutOfDate&&(A.diff=pe(A.orig.getValue(),A.edit.getValue(),A.mv.options.ignoreWhitespace),A.chunks=De(A.diff),A.diffOutOfDate=!1,t.signal(A.edit,"updateDiff",A.diff))}var l=!1;function u(A){var F={from:0,to:0,marked:[]},Z={from:0,to:0,marked:[]},J,se=!1;function oe(tt){l=!0,se=!1,tt=="full"&&(A.svg&&K(A.svg),A.copyButtons&&K(A.copyButtons),x(A.edit,F.marked,A.classes),x(A.orig,Z.marked,A.classes),F.from=F.to=Z.from=Z.to=0),a(A),A.showDifferences&&(w(A.edit,A.diff,F,DIFF_INSERT,A.classes),w(A.orig,A.diff,Z,DIFF_DELETE,A.classes)),A.mv.options.connect=="align"&&T(A),E(A),A.needsScrollSync!=null&&f(A,A.needsScrollSync),l=!1}function ge(tt){l||(A.dealigned=!0,Te(tt))}function Te(tt){l||se||(clearTimeout(J),tt===!0&&(se=!0),J=setTimeout(oe,tt===!0?20:250))}function Le(tt,vt){A.diffOutOfDate||(A.diffOutOfDate=!0,F.from=F.to=Z.from=Z.to=0),ge(vt.text.length-1!=vt.to.line-vt.from.line)}function Ue(){A.diffOutOfDate=!0,A.dealigned=!0,oe("full")}return A.edit.on("change",Le),A.orig.on("change",Le),A.edit.on("swapDoc",Ue),A.orig.on("swapDoc",Ue),A.mv.options.connect=="align"&&(t.on(A.edit.state.trackAlignable,"realign",ge),t.on(A.orig.state.trackAlignable,"realign",ge)),A.edit.on("viewportChange",function(){Te(!1)}),A.orig.on("viewportChange",function(){Te(!1)}),oe(),oe}function d(A,F){A.edit.on("scroll",function(){f(A,!0)&&E(A)}),A.orig.on("scroll",function(){f(A,!1)&&E(A),F&&f(F,!0)&&E(F)})}function f(A,F){if(A.diffOutOfDate)return A.lockScroll&&A.needsScrollSync==null&&(A.needsScrollSync=F),!1;if(A.needsScrollSync=null,!A.lockScroll)return!0;var Z,J,se=+new Date;if(F?(Z=A.edit,J=A.orig):(Z=A.orig,J=A.edit),Z.state.scrollSetBy==A&&(Z.state.scrollSetAt||0)+250>se)return!1;var oe=Z.getScrollInfo();if(A.mv.options.connect=="align")Lt=oe.top;else{var ge=.5*oe.clientHeight,Te=oe.top+ge,Le=Z.lineAtHeight(Te,"local"),Ue=me(A.chunks,Le,F),tt=h(Z,F?Ue.edit:Ue.orig),vt=h(J,F?Ue.orig:Ue.edit),bt=(Te-tt.top)/(tt.bot-tt.top),Lt=vt.top-ge+bt*(vt.bot-vt.top),Qe,ht;if(Lt>oe.top&&(ht=oe.top/ge)<1)Lt=Lt*ht+oe.top*(1-ht);else if((Qe=oe.height-oe.clientHeight-oe.top)<ge){var Rt=J.getScrollInfo(),st=Rt.height-Rt.clientHeight-Lt;st>Qe&&(ht=Qe/ge)<1&&(Lt=Lt*ht+(Rt.height-Rt.clientHeight-Qe)*(1-ht))}}return J.scrollTo(oe.left,Lt),J.state.scrollSetAt=se,J.state.scrollSetBy=A,!0}function h(A,F){var Z=F.after;return Z==null&&(Z=A.lastLine()+1),{top:A.heightAtLine(F.before||0,"local"),bot:A.heightAtLine(Z,"local")}}function v(A,F,Z){A.lockScroll=F,F&&Z!=!1&&f(A,DIFF_INSERT)&&E(A),(F?t.addClass:t.rmClass)(A.lockButton,"CodeMirror-merge-scrolllock-enabled")}function y(A,F,Z){for(var J=Z.classLocation,se=0;se<J.length;se++)A.removeLineClass(F,J[se],Z.chunk),A.removeLineClass(F,J[se],Z.start),A.removeLineClass(F,J[se],Z.end)}function x(A,F,Z){for(var J=0;J<F.length;++J){var se=F[J];se instanceof t.TextMarker?se.clear():se.parent&&y(A,se,Z)}F.length=0}function w(A,F,Z,J,se){var oe=A.getViewport();A.operation(function(){Z.from==Z.to||oe.from-Z.to>20||Z.from-oe.to>20?(x(A,Z.marked,se),b(A,F,J,Z.marked,oe.from,oe.to,se),Z.from=oe.from,Z.to=oe.to):(oe.from<Z.from&&(b(A,F,J,Z.marked,oe.from,Z.from,se),Z.from=oe.from),oe.to>Z.to&&(b(A,F,J,Z.marked,Z.to,oe.to,se),Z.to=oe.to))})}function _(A,F,Z,J,se,oe){for(var ge=Z.classLocation,Te=A.getLineHandle(F),Le=0;Le<ge.length;Le++)J&&A.addLineClass(Te,ge[Le],Z.chunk),se&&A.addLineClass(Te,ge[Le],Z.start),oe&&A.addLineClass(Te,ge[Le],Z.end);return Te}function b(A,F,Z,J,se,oe,ge){var Te=r(0,0),Le=r(se,0),Ue=A.clipPos(r(oe-1)),tt=Z==DIFF_DELETE?ge.del:ge.insert;function vt(et,lt){for(var we=Math.max(se,et),Je=Math.min(oe,lt),ft=we;ft<Je;++ft)J.push(_(A,ft,ge,!0,ft==et,ft==lt-1));et==lt&&we==lt&&Je==lt&&(we?J.push(_(A,we-1,ge,!1,!1,!0)):J.push(_(A,we,ge,!1,!0,!1)))}for(var bt=0,Lt=!1,Qe=0;Qe<F.length;++Qe){var ht=F[Qe],Rt=ht[0],st=ht[1];if(Rt==DIFF_EQUAL){var cn=Te.line+(Se(F,Qe)?0:1);fe(Te,st);var Ne=Te.line+(de(F,Qe)?1:0);Ne>cn&&(Lt&&(vt(bt,cn),Lt=!1),bt=Ne)}else if(Lt=!0,Rt==Z){var it=fe(Te,st,!0),ct=St(Le,Te),Xe=We(Ue,it);pt(ct,Xe)||J.push(A.markText(ct,Xe,{className:tt})),Te=it}}Lt&&vt(bt,Te.line+1)}function E(A){if(A.showDifferences){if(A.svg){K(A.svg);var F=A.gap.offsetWidth;ie(A.svg,"width",F,"height",A.gap.offsetHeight)}A.copyButtons&&K(A.copyButtons);for(var Z=A.edit.getViewport(),J=A.orig.getViewport(),se=A.mv.wrap.getBoundingClientRect().top,oe=se-A.edit.getScrollerElement().getBoundingClientRect().top+A.edit.getScrollInfo().top,ge=se-A.orig.getScrollerElement().getBoundingClientRect().top+A.orig.getScrollInfo().top,Te=0;Te<A.chunks.length;Te++){var Le=A.chunks[Te];Le.editFrom<=Z.to&&Le.editTo>=Z.from&&Le.origFrom<=J.to&&Le.origTo>=J.from&&X(A,Le,ge,oe,F)}}}function k(A,F){for(var Z=0,J=0,se=0;se<F.length;se++){var oe=F[se];if(oe.editTo>A&&oe.editFrom<=A)return null;if(oe.editFrom>A)break;Z=oe.editTo,J=oe.origTo}return J+(A-Z)}function O(A,F,Z){for(var J=A.state.trackAlignable,se=A.firstLine(),oe=0,ge=[],Te=0;;Te++){for(var Le=F[Te],Ue=Le?Z?Le.origFrom:Le.editFrom:1e9;oe<J.alignable.length;oe+=2){var tt=J.alignable[oe]+1;if(!(tt<=se))if(tt<=Ue)ge.push(tt);else break}if(!Le)break;ge.push(se=Z?Le.origTo:Le.editTo)}return ge}function N(A,F,Z,J){var se=0,oe=0,ge=0,Te=0;e:for(;;se++){var Le=A[se],Ue=F[oe];if(!Le&&Ue==null)break;for(var tt=Le?Le[0]:1e9,vt=Ue??1e9;ge<Z.length;){var bt=Z[ge];if(bt.origFrom<=vt&&bt.origTo>vt){oe++,se--;continue e}if(bt.editTo>tt){if(bt.editFrom<=tt)continue e;break}Te+=bt.origTo-bt.origFrom-(bt.editTo-bt.editFrom),ge++}if(tt==vt-Te)Le[J]=vt,oe++;else if(tt<vt-Te)Le[J]=tt+Te;else{var Lt=[vt-Te,null,null];Lt[J]=vt,A.splice(se,0,Lt),oe++}}}function I(A,F){var Z=O(A.edit,A.chunks,!1),J=[];if(F)for(var se=0,oe=0;se<F.chunks.length;se++){for(var ge=F.chunks[se].editTo;oe<Z.length&&Z[oe]<ge;)oe++;(oe==Z.length||Z[oe]!=ge)&&Z.splice(oe++,0,ge)}for(var se=0;se<Z.length;se++)J.push([Z[se],null,null]);return N(J,O(A.orig,A.chunks,!0),A.chunks,1),F&&N(J,O(F.orig,F.chunks,!0),F.chunks,2),J}function T(A,F){if(!(!A.dealigned&&!F)){if(!A.orig.curOp)return A.orig.operation(function(){T(A,F)});A.dealigned=!1;var Z=A.mv.left==A?A.mv.right:A.mv.left;Z&&(a(Z),Z.dealigned=!1);for(var J=I(A,Z),se=A.mv.aligners,oe=0;oe<se.length;oe++)se[oe].clear();se.length=0;var ge=[A.edit,A.orig],Te=[],Le=[];Z&&ge.push(Z.orig);for(var oe=0;oe<ge.length;oe++)Te.push(ge[oe].getScrollInfo().top),Le.push(-ge[oe].getScrollerElement().getBoundingClientRect().top);(Le[0]!=Le[1]||ge.length==3&&Le[1]!=Le[2])&&L(ge,Le,[0,0,0],se);for(var Ue=0;Ue<J.length;Ue++)L(ge,Le,J[Ue],se);for(var oe=0;oe<ge.length;oe++)ge[oe].scrollTo(null,Te[oe])}}function L(A,F,Z,J){for(var se=-1e8,oe=[],ge=0;ge<A.length;ge++)if(Z[ge]!=null){var Te=A[ge].heightAtLine(Z[ge],"local")-F[ge];oe[ge]=Te,se=Math.max(se,Te)}for(var ge=0;ge<A.length;ge++)if(Z[ge]!=null){var Le=se-oe[ge];Le>1&&J.push(H(A[ge],Z[ge],Le))}}function H(A,F,Z){var J=!0;F>A.lastLine()&&(F--,J=!1);var se=document.createElement("div");return se.className="CodeMirror-merge-spacer",se.style.height=Z+"px",se.style.minWidth="1px",A.addLineWidget(F,se,{height:Z,above:J,mergeSpacer:!0,handleMouseEvents:!0})}function X(A,F,Z,J,se){var oe=A.type=="left",ge=A.orig.heightAtLine(F.origFrom,"local",!0)-Z;if(A.svg){var Te=ge,Le=A.edit.heightAtLine(F.editFrom,"local",!0)-J;if(oe){var Ue=Te;Te=Le,Le=Ue}var tt=A.orig.heightAtLine(F.origTo,"local",!0)-Z,vt=A.edit.heightAtLine(F.editTo,"local",!0)-J;if(oe){var Ue=tt;tt=vt,vt=Ue}var bt=" C "+se/2+" "+Le+" "+se/2+" "+Te+" "+(se+2)+" "+Te,Lt=" C "+se/2+" "+tt+" "+se/2+" "+vt+" -1 "+vt;ie(A.svg.appendChild(document.createElementNS(i,"path")),"d","M -1 "+Le+bt+" L "+(se+2)+" "+tt+Lt+" z","class",A.classes.connect)}if(A.copyButtons){var Qe=A.copyButtons.appendChild(ue("div",A.type=="left"?"⇝":"⇜","CodeMirror-merge-copy")),ht=A.mv.options.allowEditingOriginals;if(Qe.title=A.edit.phrase(ht?"Push to left":"Revert chunk"),Qe.chunk=F,Qe.style.top=(F.origTo>F.origFrom?ge:A.edit.heightAtLine(F.editFrom,"local")-J)+"px",Qe.setAttribute("role","button"),Qe.setAttribute("tabindex","0"),Qe.setAttribute("aria-label",Qe.title),ht){var Rt=A.edit.heightAtLine(F.editFrom,"local")-J,st=A.copyButtons.appendChild(ue("div",A.type=="right"?"⇝":"⇜","CodeMirror-merge-copy-reverse"));st.title="Push to right",st.chunk={editFrom:F.origFrom,editTo:F.origTo,origFrom:F.editFrom,origTo:F.editTo},st.style.top=Rt+"px",A.type=="right"?st.style.left="2px":st.style.right="2px",st.setAttribute("role","button"),st.setAttribute("tabindex","0"),st.setAttribute("aria-label",st.title)}}}function V(A,F,Z,J){if(!A.diffOutOfDate){var se=J.origTo>Z.lastLine()?r(J.origFrom-1):r(J.origFrom,0),oe=r(J.origTo,0),ge=J.editTo>F.lastLine()?r(J.editFrom-1):r(J.editFrom,0),Te=r(J.editTo,0),Le=A.mv.options.revertChunk;Le?Le(A.mv,Z,se,oe,F,ge,Te):F.replaceRange(Z.getRange(se,oe),ge,Te)}}var q=t.MergeView=function(A,F){if(!(this instanceof q))return new q(A,F);this.options=F;var Z=F.origLeft,J=F.origRight==null?F.orig:F.origRight,se=Z!=null,oe=J!=null,ge=1+(se?1:0)+(oe?1:0),Te=[],Le=this.left=null,Ue=this.right=null,tt=this;if(se){Le=this.left=new o(this,"left");var vt=ue("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");Te.push(vt),Te.push(D(Le))}var bt=ue("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");if(Te.push(bt),oe){Ue=this.right=new o(this,"right"),Te.push(D(Ue));var Lt=ue("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");Te.push(Lt)}(oe?Lt:bt).className+=" CodeMirror-merge-pane-rightmost",Te.push(ue("div",null,null,"height: 0; clear: both;"));var Qe=this.wrap=A.appendChild(ue("div",Te,"CodeMirror-merge CodeMirror-merge-"+ge+"pane"));this.edit=t(bt,ne(F)),Le&&Le.init(vt,Z,F),Ue&&Ue.init(Lt,J,F),F.collapseIdentical&&this.editor().operation(function(){ce(tt,F.collapseIdentical)}),F.connect=="align"&&(this.aligners=[],T(this.left||this.right,!0)),Le&&Le.registerEvents(Ue),Ue&&Ue.registerEvents(Le);var ht=function(){Le&&E(Le),Ue&&E(Ue)};t.on(window,"resize",ht);var Rt=setInterval(function(){for(var st=Qe.parentNode;st&&st!=document.body;st=st.parentNode);st||(clearInterval(Rt),t.off(window,"resize",ht))},5e3)};function D(A){var F=A.lockButton=ue("div",null,"CodeMirror-merge-scrolllock");F.setAttribute("role","button"),F.setAttribute("tabindex","0");var Z=ue("div",[F],"CodeMirror-merge-scrolllock-wrap");t.on(F,"click",function(){v(A,!A.lockScroll)}),t.on(F,"keyup",function(ge){(ge.key==="Enter"||ge.code==="Space")&&v(A,!A.lockScroll)});var J=[Z];if(A.mv.options.revertButtons!==!1){A.copyButtons=ue("div",null,"CodeMirror-merge-copybuttons-"+A.type);var se=function(ge){var Te=ge.target||ge.srcElement;if(Te.chunk){if(Te.className=="CodeMirror-merge-copy-reverse"){V(A,A.orig,A.edit,Te.chunk);return}V(A,A.edit,A.orig,Te.chunk)}};t.on(A.copyButtons,"click",se),t.on(A.copyButtons,"keyup",function(ge){(ge.key==="Enter"||ge.code==="Space")&&se(ge)}),J.unshift(A.copyButtons)}if(A.mv.options.connect!="align"){var oe=document.createElementNS&&document.createElementNS(i,"svg");oe&&!oe.createSVGRect&&(oe=null),A.svg=oe,oe&&J.push(oe)}return A.gap=ue("div",J,"CodeMirror-merge-gap")}q.prototype={constructor:q,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(A){this.right&&this.right.setShowDifferences(A),this.left&&this.left.setShowDifferences(A)},rightChunks:function(){if(this.right)return a(this.right),this.right.chunks},leftChunks:function(){if(this.left)return a(this.left),this.left.chunks}};function W(A){return typeof A=="string"?A:A.getValue()}var $;function pe(A,F,Z){$||($=new diff_match_patch);for(var J=$.diff_main(A,F),se=0;se<J.length;++se){var oe=J[se];(Z?!/[^ \t]/.test(oe[1]):!oe[1])?J.splice(se--,1):se&&J[se-1][0]==oe[0]&&(J.splice(se--,1),J[se][1]+=oe[1])}return J}function De(A){var F=[];if(!A.length)return F;for(var Z=0,J=0,se=r(0,0),oe=r(0,0),ge=0;ge<A.length;++ge){var Te=A[ge],Le=Te[0];if(Le==DIFF_EQUAL){var Ue=!Se(A,ge)||se.line<Z||oe.line<J?1:0,tt=se.line+Ue,vt=oe.line+Ue;fe(se,Te[1],null,oe);var bt=de(A,ge)?1:0,Lt=se.line+bt,Qe=oe.line+bt;Lt>tt&&(ge&&F.push({origFrom:J,origTo:vt,editFrom:Z,editTo:tt}),Z=Lt,J=Qe)}else fe(Le==DIFF_INSERT?se:oe,Te[1])}return(Z<=se.line||J<=oe.line)&&F.push({origFrom:J,origTo:oe.line+1,editFrom:Z,editTo:se.line+1}),F}function de(A,F){if(F==A.length-1)return!0;var Z=A[F+1][1];return Z.length==1&&F<A.length-2||Z.charCodeAt(0)!=10?!1:F==A.length-2?!0:(Z=A[F+2][1],(Z.length>1||F==A.length-3)&&Z.charCodeAt(0)==10)}function Se(A,F){if(F==0)return!0;var Z=A[F-1][1];return Z.charCodeAt(Z.length-1)!=10?!1:F==1?!0:(Z=A[F-2][1],Z.charCodeAt(Z.length-1)==10)}function me(A,F,Z){for(var J,se,oe,ge,Te=0;Te<A.length;Te++){var Le=A[Te],Ue=Z?Le.editFrom:Le.origFrom,tt=Z?Le.editTo:Le.origTo;se==null&&(Ue>F?(se=Le.editFrom,ge=Le.origFrom):tt>F&&(se=Le.editTo,ge=Le.origTo)),tt<=F?(J=Le.editTo,oe=Le.origTo):Ue<=F&&(J=Le.editFrom,oe=Le.origFrom)}return{edit:{before:J,after:se},orig:{before:oe,after:ge}}}function ve(A,F,Z){A.addLineClass(F,"wrap","CodeMirror-merge-collapsed-line");var J=document.createElement("span");J.className="CodeMirror-merge-collapsed-widget",J.title=A.phrase("Identical text collapsed. Click to expand.");var se=A.markText(r(F,0),r(Z-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:J,clearOnEnter:!0});function oe(){se.clear(),A.removeLineClass(F,"wrap","CodeMirror-merge-collapsed-line")}return se.explicitlyCleared&&oe(),t.on(J,"click",oe),se.on("clear",oe),t.on(J,"click",oe),{mark:se,clear:oe}}function Re(A,F){var Z=[];function J(){for(var Te=0;Te<Z.length;Te++)Z[Te].clear()}for(var se=0;se<F.length;se++){var oe=F[se],ge=ve(oe.cm,oe.line,oe.line+A);Z.push(ge),ge.mark.on("clear",J)}return Z[0].mark}function Ie(A,F,Z,J){for(var se=0;se<A.chunks.length;se++)for(var oe=A.chunks[se],ge=oe.editFrom-F;ge<oe.editTo+F;ge++){var Te=ge+Z;Te>=0&&Te<J.length&&(J[Te]=!1)}}function ce(A,F){typeof F!="number"&&(F=2);for(var Z=[],J=A.editor(),se=J.firstLine(),oe=se,ge=J.lastLine();oe<=ge;oe++)Z.push(!0);A.left&&Ie(A.left,F,se,Z),A.right&&Ie(A.right,F,se,Z);for(var Te=0;Te<Z.length;Te++)if(Z[Te]){for(var Le=Te+se,Ue=1;Te<Z.length-1&&Z[Te+1];Te++,Ue++);if(Ue>F){var tt=[{line:Le,cm:J}];A.left&&tt.push({line:k(Le,A.left.chunks),cm:A.left.orig}),A.right&&tt.push({line:k(Le,A.right.chunks),cm:A.right.orig});var vt=Re(Ue,tt);A.options.onCollapse&&A.options.onCollapse(A,Le,Ue,vt)}}}function ue(A,F,Z,J){var se=document.createElement(A);if(Z&&(se.className=Z),J&&(se.style.cssText=J),typeof F=="string")se.appendChild(document.createTextNode(F));else if(F)for(var oe=0;oe<F.length;++oe)se.appendChild(F[oe]);return se}function K(A){for(var F=A.childNodes.length;F>0;--F)A.removeChild(A.firstChild)}function ie(A){for(var F=1;F<arguments.length;F+=2)A.setAttribute(arguments[F],arguments[F+1])}function ne(A,F){F||(F={});for(var Z in A)A.hasOwnProperty(Z)&&(F[Z]=A[Z]);return F}function fe(A,F,Z,J){for(var se=Z?r(A.line,A.ch):A,oe=0;;){var ge=F.indexOf(`
`,oe);if(ge==-1)break;++se.line,J&&++J.line,oe=ge+1}return se.ch=(oe?0:se.ch)+(F.length-oe),J&&(J.ch=(oe?0:J.ch)+(F.length-oe)),se}var he=1,be=2,xe=4;function Ze(A){this.cm=A,this.alignable=[],this.height=A.doc.height;var F=this;A.on("markerAdded",function(Z,J){if(J.collapsed){var se=J.find(1);se!=null&&F.set(se.line,xe)}}),A.on("markerCleared",function(Z,J,se,oe){oe!=null&&J.collapsed&&F.check(oe,xe,F.hasMarker)}),A.on("markerChanged",this.signal.bind(this)),A.on("lineWidgetAdded",function(Z,J,se){J.mergeSpacer||(J.above?F.set(se-1,be):F.set(se,he))}),A.on("lineWidgetCleared",function(Z,J,se){J.mergeSpacer||(J.above?F.check(se-1,be,F.hasWidgetBelow):F.check(se,he,F.hasWidget))}),A.on("lineWidgetChanged",this.signal.bind(this)),A.on("change",function(Z,J){var se=J.from.line,oe=J.to.line-J.from.line,ge=J.text.length-1,Te=se+ge;(oe||ge)&&F.map(se,oe,ge),F.check(Te,xe,F.hasMarker),(oe||ge)&&F.check(J.from.line,xe,F.hasMarker)}),A.on("viewportChange",function(){F.cm.doc.height!=F.height&&F.signal()})}Ze.prototype={signal:function(){t.signal(this,"realign"),this.height=this.cm.doc.height},set:function(A,F){for(var Z=-1;Z<this.alignable.length;Z+=2){var J=this.alignable[Z]-A;if(J==0){if((this.alignable[Z+1]&F)==F)return;this.alignable[Z+1]|=F,this.signal();return}if(J>0)break}this.signal(),this.alignable.splice(Z,0,A,F)},find:function(A){for(var F=0;F<this.alignable.length;F+=2)if(this.alignable[F]==A)return F;return-1},check:function(A,F,Z){var J=this.find(A);if(!(J==-1||!(this.alignable[J+1]&F))&&!Z.call(this,A)){this.signal();var se=this.alignable[J+1]&~F;se?this.alignable[J+1]=se:this.alignable.splice(J,2)}},hasMarker:function(A){var F=this.cm.getLineHandle(A);if(F.markedSpans){for(var Z=0;Z<F.markedSpans.length;Z++)if(F.markedSpans[Z].marker.collapsed&&F.markedSpans[Z].to!=null)return!0}return!1},hasWidget:function(A){var F=this.cm.getLineHandle(A);if(F.widgets){for(var Z=0;Z<F.widgets.length;Z++)if(!F.widgets[Z].above&&!F.widgets[Z].mergeSpacer)return!0}return!1},hasWidgetBelow:function(A){if(A==this.cm.lastLine())return!1;var F=this.cm.getLineHandle(A+1);if(F.widgets){for(var Z=0;Z<F.widgets.length;Z++)if(F.widgets[Z].above&&!F.widgets[Z].mergeSpacer)return!0}return!1},map:function(A,F,Z){for(var J=Z-F,se=A+F,oe=-1,ge=-1,Te=0;Te<this.alignable.length;Te+=2){var Le=this.alignable[Te];Le==A&&this.alignable[Te+1]&be&&(oe=Te),Le==se&&this.alignable[Te+1]&be&&(ge=Te),!(Le<=A)&&(Le<se?this.alignable.splice(Te--,2):this.alignable[Te]+=J)}if(oe>-1){var Ue=this.alignable[oe+1];Ue==be?this.alignable.splice(oe,2):this.alignable[oe+1]=Ue&~be}ge>-1&&Z&&this.set(A+Z,be)}};function We(A,F){return(A.line-F.line||A.ch-F.ch)<0?A:F}function St(A,F){return(A.line-F.line||A.ch-F.ch)>0?A:F}function pt(A,F){return A.line==F.line&&A.ch==F.ch}function Ht(A,F,Z){for(var J=A.length-1;J>=0;J--){var se=A[J],oe=(Z?se.origTo:se.editTo)-1;if(oe<F)return oe}}function Qt(A,F,Z){for(var J=0;J<A.length;J++){var se=A[J],oe=Z?se.origFrom:se.editFrom;if(oe>F)return oe}}function te(A,F){var Z=null,J=A.state.diffViews,se=A.getCursor().line;if(J)for(var oe=0;oe<J.length;oe++){var ge=J[oe],Te=A==ge.orig;a(ge);var Le=F<0?Ht(ge.chunks,se,Te):Qt(ge.chunks,se,Te);Le!=null&&(Z==null||(F<0?Le>Z:Le<Z))&&(Z=Le)}if(Z!=null)A.setCursor(Z,0);else return t.Pass}t.commands.goNextDiff=function(A){return te(A,1)},t.commands.goPrevDiff=function(A){return te(A,-1)}})}()),Ay.exports}UP();var jf={exports:{}},Dy;function VP(){return Dy||(Dy=1,function(n){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,r=1,i=0;e.Diff=function(o,a){return[o,a]},e.prototype.diff_main=function(o,a,l,u){typeof u>"u"&&(this.Diff_Timeout<=0?u=Number.MAX_VALUE:u=new Date().getTime()+this.Diff_Timeout*1e3);var d=u;if(o==null||a==null)throw new Error("Null input. (diff_main)");if(o==a)return o?[new e.Diff(i,o)]:[];typeof l>"u"&&(l=!0);var f=l,h=this.diff_commonPrefix(o,a),v=o.substring(0,h);o=o.substring(h),a=a.substring(h),h=this.diff_commonSuffix(o,a);var y=o.substring(o.length-h);o=o.substring(0,o.length-h),a=a.substring(0,a.length-h);var x=this.diff_compute_(o,a,f,d);return v&&x.unshift(new e.Diff(i,v)),y&&x.push(new e.Diff(i,y)),this.diff_cleanupMerge(x),x},e.prototype.diff_compute_=function(o,a,l,u){var d;if(!o)return[new e.Diff(r,a)];if(!a)return[new e.Diff(t,o)];var f=o.length>a.length?o:a,h=o.length>a.length?a:o,v=f.indexOf(h);if(v!=-1)return d=[new e.Diff(r,f.substring(0,v)),new e.Diff(i,h),new e.Diff(r,f.substring(v+h.length))],o.length>a.length&&(d[0][0]=d[2][0]=t),d;if(h.length==1)return[new e.Diff(t,o),new e.Diff(r,a)];var y=this.diff_halfMatch_(o,a);if(y){var x=y[0],w=y[1],_=y[2],b=y[3],E=y[4],k=this.diff_main(x,_,l,u),O=this.diff_main(w,b,l,u);return k.concat([new e.Diff(i,E)],O)}return l&&o.length>100&&a.length>100?this.diff_lineMode_(o,a,u):this.diff_bisect_(o,a,u)},e.prototype.diff_lineMode_=function(o,a,l){var u=this.diff_linesToChars_(o,a);o=u.chars1,a=u.chars2;var d=u.lineArray,f=this.diff_main(o,a,!1,l);this.diff_charsToLines_(f,d),this.diff_cleanupSemantic(f),f.push(new e.Diff(i,""));for(var h=0,v=0,y=0,x="",w="";h<f.length;){switch(f[h][0]){case r:y++,w+=f[h][1];break;case t:v++,x+=f[h][1];break;case i:if(v>=1&&y>=1){f.splice(h-v-y,v+y),h=h-v-y;for(var _=this.diff_main(x,w,!1,l),b=_.length-1;b>=0;b--)f.splice(h,0,_[b]);h=h+_.length}y=0,v=0,x="",w="";break}h++}return f.pop(),f},e.prototype.diff_bisect_=function(o,a,l){for(var u=o.length,d=a.length,f=Math.ceil((u+d)/2),h=f,v=2*f,y=new Array(v),x=new Array(v),w=0;w<v;w++)y[w]=-1,x[w]=-1;y[h+1]=0,x[h+1]=0;for(var _=u-d,b=_%2!=0,E=0,k=0,O=0,N=0,I=0;I<f&&!(new Date().getTime()>l);I++){for(var T=-I+E;T<=I-k;T+=2){var L=h+T,H;T==-I||T!=I&&y[L-1]<y[L+1]?H=y[L+1]:H=y[L-1]+1;for(var X=H-T;H<u&&X<d&&o.charAt(H)==a.charAt(X);)H++,X++;if(y[L]=H,H>u)k+=2;else if(X>d)E+=2;else if(b){var V=h+_-T;if(V>=0&&V<v&&x[V]!=-1){var q=u-x[V];if(H>=q)return this.diff_bisectSplit_(o,a,H,X,l)}}}for(var D=-I+O;D<=I-N;D+=2){var V=h+D,q;D==-I||D!=I&&x[V-1]<x[V+1]?q=x[V+1]:q=x[V-1]+1;for(var W=q-D;q<u&&W<d&&o.charAt(u-q-1)==a.charAt(d-W-1);)q++,W++;if(x[V]=q,q>u)N+=2;else if(W>d)O+=2;else if(!b){var L=h+_-D;if(L>=0&&L<v&&y[L]!=-1){var H=y[L],X=h+H-L;if(q=u-q,H>=q)return this.diff_bisectSplit_(o,a,H,X,l)}}}}return[new e.Diff(t,o),new e.Diff(r,a)]},e.prototype.diff_bisectSplit_=function(o,a,l,u,d){var f=o.substring(0,l),h=a.substring(0,u),v=o.substring(l),y=a.substring(u),x=this.diff_main(f,h,!1,d),w=this.diff_main(v,y,!1,d);return x.concat(w)},e.prototype.diff_linesToChars_=function(o,a){var l=[],u={};l[0]="";function d(y){for(var x="",w=0,_=-1,b=l.length;_<y.length-1;){_=y.indexOf(`
`,w),_==-1&&(_=y.length-1);var E=y.substring(w,_+1);(u.hasOwnProperty?u.hasOwnProperty(E):u[E]!==void 0)?x+=String.fromCharCode(u[E]):(b==f&&(E=y.substring(w),_=y.length),x+=String.fromCharCode(b),u[E]=b,l[b++]=E),w=_+1}return x}var f=4e4,h=d(o);f=65535;var v=d(a);return{chars1:h,chars2:v,lineArray:l}},e.prototype.diff_charsToLines_=function(o,a){for(var l=0;l<o.length;l++){for(var u=o[l][1],d=[],f=0;f<u.length;f++)d[f]=a[u.charCodeAt(f)];o[l][1]=d.join("")}},e.prototype.diff_commonPrefix=function(o,a){if(!o||!a||o.charAt(0)!=a.charAt(0))return 0;for(var l=0,u=Math.min(o.length,a.length),d=u,f=0;l<d;)o.substring(f,d)==a.substring(f,d)?(l=d,f=l):u=d,d=Math.floor((u-l)/2+l);return d},e.prototype.diff_commonSuffix=function(o,a){if(!o||!a||o.charAt(o.length-1)!=a.charAt(a.length-1))return 0;for(var l=0,u=Math.min(o.length,a.length),d=u,f=0;l<d;)o.substring(o.length-d,o.length-f)==a.substring(a.length-d,a.length-f)?(l=d,f=l):u=d,d=Math.floor((u-l)/2+l);return d},e.prototype.diff_commonOverlap_=function(o,a){var l=o.length,u=a.length;if(l==0||u==0)return 0;l>u?o=o.substring(l-u):l<u&&(a=a.substring(0,l));var d=Math.min(l,u);if(o==a)return d;for(var f=0,h=1;;){var v=o.substring(d-h),y=a.indexOf(v);if(y==-1)return f;h+=y,(y==0||o.substring(d-h)==a.substring(0,h))&&(f=h,h++)}},e.prototype.diff_halfMatch_=function(o,a){if(this.Diff_Timeout<=0)return null;var l=o.length>a.length?o:a,u=o.length>a.length?a:o;if(l.length<4||u.length*2<l.length)return null;var d=this;function f(k,O,N){for(var I=k.substring(N,N+Math.floor(k.length/4)),T=-1,L="",H,X,V,q;(T=O.indexOf(I,T+1))!=-1;){var D=d.diff_commonPrefix(k.substring(N),O.substring(T)),W=d.diff_commonSuffix(k.substring(0,N),O.substring(0,T));L.length<W+D&&(L=O.substring(T-W,T)+O.substring(T,T+D),H=k.substring(0,N-W),X=k.substring(N+D),V=O.substring(0,T-W),q=O.substring(T+D))}return L.length*2>=k.length?[H,X,V,q,L]:null}var h=f(l,u,Math.ceil(l.length/4)),v=f(l,u,Math.ceil(l.length/2)),y;if(!h&&!v)return null;v?h?y=h[4].length>v[4].length?h:v:y=v:y=h;var x,w,_,b;o.length>a.length?(x=y[0],w=y[1],_=y[2],b=y[3]):(_=y[0],b=y[1],x=y[2],w=y[3]);var E=y[4];return[x,w,_,b,E]},e.prototype.diff_cleanupSemantic=function(o){for(var a=!1,l=[],u=0,d=null,f=0,h=0,v=0,y=0,x=0;f<o.length;)o[f][0]==i?(l[u++]=f,h=y,v=x,y=0,x=0,d=o[f][1]):(o[f][0]==r?y+=o[f][1].length:x+=o[f][1].length,d&&d.length<=Math.max(h,v)&&d.length<=Math.max(y,x)&&(o.splice(l[u-1],0,new e.Diff(t,d)),o[l[u-1]+1][0]=r,u--,u--,f=u>0?l[u-1]:-1,h=0,v=0,y=0,x=0,d=null,a=!0)),f++;for(a&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),f=1;f<o.length;){if(o[f-1][0]==t&&o[f][0]==r){var w=o[f-1][1],_=o[f][1],b=this.diff_commonOverlap_(w,_),E=this.diff_commonOverlap_(_,w);b>=E?(b>=w.length/2||b>=_.length/2)&&(o.splice(f,0,new e.Diff(i,_.substring(0,b))),o[f-1][1]=w.substring(0,w.length-b),o[f+1][1]=_.substring(b),f++):(E>=w.length/2||E>=_.length/2)&&(o.splice(f,0,new e.Diff(i,w.substring(0,E))),o[f-1][0]=r,o[f-1][1]=_.substring(0,_.length-E),o[f+1][0]=t,o[f+1][1]=w.substring(E),f++),f++}f++}},e.prototype.diff_cleanupSemanticLossless=function(o){function a(E,k){if(!E||!k)return 6;var O=E.charAt(E.length-1),N=k.charAt(0),I=O.match(e.nonAlphaNumericRegex_),T=N.match(e.nonAlphaNumericRegex_),L=I&&O.match(e.whitespaceRegex_),H=T&&N.match(e.whitespaceRegex_),X=L&&O.match(e.linebreakRegex_),V=H&&N.match(e.linebreakRegex_),q=X&&E.match(e.blanklineEndRegex_),D=V&&k.match(e.blanklineStartRegex_);return q||D?5:X||V?4:I&&!L&&H?3:L||H?2:I||T?1:0}for(var l=1;l<o.length-1;){if(o[l-1][0]==i&&o[l+1][0]==i){var u=o[l-1][1],d=o[l][1],f=o[l+1][1],h=this.diff_commonSuffix(u,d);if(h){var v=d.substring(d.length-h);u=u.substring(0,u.length-h),d=v+d.substring(0,d.length-h),f=v+f}for(var y=u,x=d,w=f,_=a(u,d)+a(d,f);d.charAt(0)===f.charAt(0);){u+=d.charAt(0),d=d.substring(1)+f.charAt(0),f=f.substring(1);var b=a(u,d)+a(d,f);b>=_&&(_=b,y=u,x=d,w=f)}o[l-1][1]!=y&&(y?o[l-1][1]=y:(o.splice(l-1,1),l--),o[l][1]=x,w?o[l+1][1]=w:(o.splice(l+1,1),l--))}l++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(o){for(var a=!1,l=[],u=0,d=null,f=0,h=!1,v=!1,y=!1,x=!1;f<o.length;)o[f][0]==i?(o[f][1].length<this.Diff_EditCost&&(y||x)?(l[u++]=f,h=y,v=x,d=o[f][1]):(u=0,d=null),y=x=!1):(o[f][0]==t?x=!0:y=!0,d&&(h&&v&&y&&x||d.length<this.Diff_EditCost/2&&h+v+y+x==3)&&(o.splice(l[u-1],0,new e.Diff(t,d)),o[l[u-1]+1][0]=r,u--,d=null,h&&v?(y=x=!0,u=0):(u--,f=u>0?l[u-1]:-1,y=x=!1),a=!0)),f++;a&&this.diff_cleanupMerge(o)},e.prototype.diff_cleanupMerge=function(o){o.push(new e.Diff(i,""));for(var a=0,l=0,u=0,d="",f="",h;a<o.length;)switch(o[a][0]){case r:u++,f+=o[a][1],a++;break;case t:l++,d+=o[a][1],a++;break;case i:l+u>1?(l!==0&&u!==0&&(h=this.diff_commonPrefix(f,d),h!==0&&(a-l-u>0&&o[a-l-u-1][0]==i?o[a-l-u-1][1]+=f.substring(0,h):(o.splice(0,0,new e.Diff(i,f.substring(0,h))),a++),f=f.substring(h),d=d.substring(h)),h=this.diff_commonSuffix(f,d),h!==0&&(o[a][1]=f.substring(f.length-h)+o[a][1],f=f.substring(0,f.length-h),d=d.substring(0,d.length-h))),a-=l+u,o.splice(a,l+u),d.length&&(o.splice(a,0,new e.Diff(t,d)),a++),f.length&&(o.splice(a,0,new e.Diff(r,f)),a++),a++):a!==0&&o[a-1][0]==i?(o[a-1][1]+=o[a][1],o.splice(a,1)):a++,u=0,l=0,d="",f="";break}o[o.length-1][1]===""&&o.pop();var v=!1;for(a=1;a<o.length-1;)o[a-1][0]==i&&o[a+1][0]==i&&(o[a][1].substring(o[a][1].length-o[a-1][1].length)==o[a-1][1]?(o[a][1]=o[a-1][1]+o[a][1].substring(0,o[a][1].length-o[a-1][1].length),o[a+1][1]=o[a-1][1]+o[a+1][1],o.splice(a-1,1),v=!0):o[a][1].substring(0,o[a+1][1].length)==o[a+1][1]&&(o[a-1][1]+=o[a+1][1],o[a][1]=o[a][1].substring(o[a+1][1].length)+o[a+1][1],o.splice(a+1,1),v=!0)),a++;v&&this.diff_cleanupMerge(o)},e.prototype.diff_xIndex=function(o,a){var l=0,u=0,d=0,f=0,h;for(h=0;h<o.length&&(o[h][0]!==r&&(l+=o[h][1].length),o[h][0]!==t&&(u+=o[h][1].length),!(l>a));h++)d=l,f=u;return o.length!=h&&o[h][0]===t?f:f+(a-d)},e.prototype.diff_prettyHtml=function(o){for(var a=[],l=/&/g,u=/</g,d=/>/g,f=/\n/g,h=0;h<o.length;h++){var v=o[h][0],y=o[h][1],x=y.replace(l,"&amp;").replace(u,"&lt;").replace(d,"&gt;").replace(f,"&para;<br>");switch(v){case r:a[h]='<ins style="background:#e6ffe6;">'+x+"</ins>";break;case t:a[h]='<del style="background:#ffe6e6;">'+x+"</del>";break;case i:a[h]="<span>"+x+"</span>";break}}return a.join("")},e.prototype.diff_text1=function(o){for(var a=[],l=0;l<o.length;l++)o[l][0]!==r&&(a[l]=o[l][1]);return a.join("")},e.prototype.diff_text2=function(o){for(var a=[],l=0;l<o.length;l++)o[l][0]!==t&&(a[l]=o[l][1]);return a.join("")},e.prototype.diff_levenshtein=function(o){for(var a=0,l=0,u=0,d=0;d<o.length;d++){var f=o[d][0],h=o[d][1];switch(f){case r:l+=h.length;break;case t:u+=h.length;break;case i:a+=Math.max(l,u),l=0,u=0;break}}return a+=Math.max(l,u),a},e.prototype.diff_toDelta=function(o){for(var a=[],l=0;l<o.length;l++)switch(o[l][0]){case r:a[l]="+"+encodeURI(o[l][1]);break;case t:a[l]="-"+o[l][1].length;break;case i:a[l]="="+o[l][1].length;break}return a.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(o,a){for(var l=[],u=0,d=0,f=a.split(/\t/g),h=0;h<f.length;h++){var v=f[h].substring(1);switch(f[h].charAt(0)){case"+":try{l[u++]=new e.Diff(r,decodeURI(v))}catch{throw new Error("Illegal escape in diff_fromDelta: "+v)}break;case"-":case"=":var y=parseInt(v,10);if(isNaN(y)||y<0)throw new Error("Invalid number in diff_fromDelta: "+v);var x=o.substring(d,d+=y);f[h].charAt(0)=="="?l[u++]=new e.Diff(i,x):l[u++]=new e.Diff(t,x);break;default:if(f[h])throw new Error("Invalid diff operation in diff_fromDelta: "+f[h])}}if(d!=o.length)throw new Error("Delta length ("+d+") does not equal source text length ("+o.length+").");return l},e.prototype.match_main=function(o,a,l){if(o==null||a==null||l==null)throw new Error("Null input. (match_main)");return l=Math.max(0,Math.min(l,o.length)),o==a?0:o.length?o.substring(l,l+a.length)==a?l:this.match_bitap_(o,a,l):-1},e.prototype.match_bitap_=function(o,a,l){if(a.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var u=this.match_alphabet_(a),d=this;function f(H,X){var V=H/a.length,q=Math.abs(l-X);return d.Match_Distance?V+q/d.Match_Distance:q?1:V}var h=this.Match_Threshold,v=o.indexOf(a,l);v!=-1&&(h=Math.min(f(0,v),h),v=o.lastIndexOf(a,l+a.length),v!=-1&&(h=Math.min(f(0,v),h)));var y=1<<a.length-1;v=-1;for(var x,w,_=a.length+o.length,b,E=0;E<a.length;E++){for(x=0,w=_;x<w;)f(E,l+w)<=h?x=w:_=w,w=Math.floor((_-x)/2+x);_=w;var k=Math.max(1,l-w+1),O=Math.min(l+w,o.length)+a.length,N=Array(O+2);N[O+1]=(1<<E)-1;for(var I=O;I>=k;I--){var T=u[o.charAt(I-1)];if(E===0?N[I]=(N[I+1]<<1|1)&T:N[I]=(N[I+1]<<1|1)&T|((b[I+1]|b[I])<<1|1)|b[I+1],N[I]&y){var L=f(E,I-1);if(L<=h)if(h=L,v=I-1,v>l)k=Math.max(1,2*l-v);else break}}if(f(E+1,l)>h)break;b=N}return v},e.prototype.match_alphabet_=function(o){for(var a={},l=0;l<o.length;l++)a[o.charAt(l)]=0;for(var l=0;l<o.length;l++)a[o.charAt(l)]|=1<<o.length-l-1;return a},e.prototype.patch_addContext_=function(o,a){if(a.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var l=a.substring(o.start2,o.start2+o.length1),u=0;a.indexOf(l)!=a.lastIndexOf(l)&&l.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)u+=this.Patch_Margin,l=a.substring(o.start2-u,o.start2+o.length1+u);u+=this.Patch_Margin;var d=a.substring(o.start2-u,o.start2);d&&o.diffs.unshift(new e.Diff(i,d));var f=a.substring(o.start2+o.length1,o.start2+o.length1+u);f&&o.diffs.push(new e.Diff(i,f)),o.start1-=d.length,o.start2-=d.length,o.length1+=d.length+f.length,o.length2+=d.length+f.length}},e.prototype.patch_make=function(o,a,l){var u,d;if(typeof o=="string"&&typeof a=="string"&&typeof l>"u")u=o,d=this.diff_main(u,a,!0),d.length>2&&(this.diff_cleanupSemantic(d),this.diff_cleanupEfficiency(d));else if(o&&typeof o=="object"&&typeof a>"u"&&typeof l>"u")d=o,u=this.diff_text1(d);else if(typeof o=="string"&&a&&typeof a=="object"&&typeof l>"u")u=o,d=a;else if(typeof o=="string"&&typeof a=="string"&&l&&typeof l=="object")u=o,d=l;else throw new Error("Unknown call format to patch_make.");if(d.length===0)return[];for(var f=[],h=new e.patch_obj,v=0,y=0,x=0,w=u,_=u,b=0;b<d.length;b++){var E=d[b][0],k=d[b][1];switch(!v&&E!==i&&(h.start1=y,h.start2=x),E){case r:h.diffs[v++]=d[b],h.length2+=k.length,_=_.substring(0,x)+k+_.substring(x);break;case t:h.length1+=k.length,h.diffs[v++]=d[b],_=_.substring(0,x)+_.substring(x+k.length);break;case i:k.length<=2*this.Patch_Margin&&v&&d.length!=b+1?(h.diffs[v++]=d[b],h.length1+=k.length,h.length2+=k.length):k.length>=2*this.Patch_Margin&&v&&(this.patch_addContext_(h,w),f.push(h),h=new e.patch_obj,v=0,w=_,y=x);break}E!==r&&(y+=k.length),E!==t&&(x+=k.length)}return v&&(this.patch_addContext_(h,w),f.push(h)),f},e.prototype.patch_deepCopy=function(o){for(var a=[],l=0;l<o.length;l++){var u=o[l],d=new e.patch_obj;d.diffs=[];for(var f=0;f<u.diffs.length;f++)d.diffs[f]=new e.Diff(u.diffs[f][0],u.diffs[f][1]);d.start1=u.start1,d.start2=u.start2,d.length1=u.length1,d.length2=u.length2,a[l]=d}return a},e.prototype.patch_apply=function(o,a){if(o.length==0)return[a,[]];o=this.patch_deepCopy(o);var l=this.patch_addPadding(o);a=l+a+l,this.patch_splitMax(o);for(var u=0,d=[],f=0;f<o.length;f++){var h=o[f].start2+u,v=this.diff_text1(o[f].diffs),y,x=-1;if(v.length>this.Match_MaxBits?(y=this.match_main(a,v.substring(0,this.Match_MaxBits),h),y!=-1&&(x=this.match_main(a,v.substring(v.length-this.Match_MaxBits),h+v.length-this.Match_MaxBits),(x==-1||y>=x)&&(y=-1))):y=this.match_main(a,v,h),y==-1)d[f]=!1,u-=o[f].length2-o[f].length1;else{d[f]=!0,u=y-h;var w;if(x==-1?w=a.substring(y,y+v.length):w=a.substring(y,x+this.Match_MaxBits),v==w)a=a.substring(0,y)+this.diff_text2(o[f].diffs)+a.substring(y+v.length);else{var _=this.diff_main(v,w,!1);if(v.length>this.Match_MaxBits&&this.diff_levenshtein(_)/v.length>this.Patch_DeleteThreshold)d[f]=!1;else{this.diff_cleanupSemanticLossless(_);for(var b=0,E,k=0;k<o[f].diffs.length;k++){var O=o[f].diffs[k];O[0]!==i&&(E=this.diff_xIndex(_,b)),O[0]===r?a=a.substring(0,y+E)+O[1]+a.substring(y+E):O[0]===t&&(a=a.substring(0,y+E)+a.substring(y+this.diff_xIndex(_,b+O[1].length))),O[0]!==t&&(b+=O[1].length)}}}}}return a=a.substring(l.length,a.length-l.length),[a,d]},e.prototype.patch_addPadding=function(o){for(var a=this.Patch_Margin,l="",u=1;u<=a;u++)l+=String.fromCharCode(u);for(var u=0;u<o.length;u++)o[u].start1+=a,o[u].start2+=a;var d=o[0],f=d.diffs;if(f.length==0||f[0][0]!=i)f.unshift(new e.Diff(i,l)),d.start1-=a,d.start2-=a,d.length1+=a,d.length2+=a;else if(a>f[0][1].length){var h=a-f[0][1].length;f[0][1]=l.substring(f[0][1].length)+f[0][1],d.start1-=h,d.start2-=h,d.length1+=h,d.length2+=h}if(d=o[o.length-1],f=d.diffs,f.length==0||f[f.length-1][0]!=i)f.push(new e.Diff(i,l)),d.length1+=a,d.length2+=a;else if(a>f[f.length-1][1].length){var h=a-f[f.length-1][1].length;f[f.length-1][1]+=l.substring(0,h),d.length1+=h,d.length2+=h}return l},e.prototype.patch_splitMax=function(o){for(var a=this.Match_MaxBits,l=0;l<o.length;l++)if(!(o[l].length1<=a)){var u=o[l];o.splice(l--,1);for(var d=u.start1,f=u.start2,h="";u.diffs.length!==0;){var v=new e.patch_obj,y=!0;for(v.start1=d-h.length,v.start2=f-h.length,h!==""&&(v.length1=v.length2=h.length,v.diffs.push(new e.Diff(i,h)));u.diffs.length!==0&&v.length1<a-this.Patch_Margin;){var x=u.diffs[0][0],w=u.diffs[0][1];x===r?(v.length2+=w.length,f+=w.length,v.diffs.push(u.diffs.shift()),y=!1):x===t&&v.diffs.length==1&&v.diffs[0][0]==i&&w.length>2*a?(v.length1+=w.length,d+=w.length,y=!1,v.diffs.push(new e.Diff(x,w)),u.diffs.shift()):(w=w.substring(0,a-v.length1-this.Patch_Margin),v.length1+=w.length,d+=w.length,x===i?(v.length2+=w.length,f+=w.length):y=!1,v.diffs.push(new e.Diff(x,w)),w==u.diffs[0][1]?u.diffs.shift():u.diffs[0][1]=u.diffs[0][1].substring(w.length))}h=this.diff_text2(v.diffs),h=h.substring(h.length-this.Patch_Margin);var _=this.diff_text1(u.diffs).substring(0,this.Patch_Margin);_!==""&&(v.length1+=_.length,v.length2+=_.length,v.diffs.length!==0&&v.diffs[v.diffs.length-1][0]===i?v.diffs[v.diffs.length-1][1]+=_:v.diffs.push(new e.Diff(i,_))),y||o.splice(++l,0,v)}}},e.prototype.patch_toText=function(o){for(var a=[],l=0;l<o.length;l++)a[l]=o[l];return a.join("")},e.prototype.patch_fromText=function(o){var a=[];if(!o)return a;for(var l=o.split(`
`),u=0,d=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;u<l.length;){var f=l[u].match(d);if(!f)throw new Error("Invalid patch string: "+l[u]);var h=new e.patch_obj;for(a.push(h),h.start1=parseInt(f[1],10),f[2]===""?(h.start1--,h.length1=1):f[2]=="0"?h.length1=0:(h.start1--,h.length1=parseInt(f[2],10)),h.start2=parseInt(f[3],10),f[4]===""?(h.start2--,h.length2=1):f[4]=="0"?h.length2=0:(h.start2--,h.length2=parseInt(f[4],10)),u++;u<l.length;){var v=l[u].charAt(0);try{var y=decodeURI(l[u].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+y)}if(v=="-")h.diffs.push(new e.Diff(t,y));else if(v=="+")h.diffs.push(new e.Diff(r,y));else if(v==" ")h.diffs.push(new e.Diff(i,y));else{if(v=="@")break;if(v!=="")throw new Error('Invalid patch mode "'+v+'" in: '+y)}u++}}return a},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var o,a;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?a=this.start2+",0":this.length2==1?a=this.start2+1:a=this.start2+1+","+this.length2;for(var l=["@@ -"+o+" +"+a+` @@
`],u,d=0;d<this.diffs.length;d++){switch(this.diffs[d][0]){case r:u="+";break;case t:u="-";break;case i:u=" ";break}l[d+1]=u+encodeURI(this.diffs[d][1])+`
`}return l.join("").replace(/%20/g," ")},n.exports=e,n.exports.diff_match_patch=e,n.exports.DIFF_DELETE=t,n.exports.DIFF_INSERT=r,n.exports.DIFF_EQUAL=i}(jf)),jf.exports}var WP=VP();const GP=va(WP);var Ly={exports:{}},Py;function qP(){return Py||(Py=1,function(n,e){(function(t){t(Ro())})(function(t){t.defineSimpleMode=function(v,y){t.defineMode(v,function(x){return t.simpleMode(x,y)})},t.simpleMode=function(v,y){r(y,"start");var x={},w=y.meta||{},_=!1;for(var b in y)if(b!=w&&y.hasOwnProperty(b))for(var E=x[b]=[],k=y[b],O=0;O<k.length;O++){var N=k[O];E.push(new a(N,y)),(N.indent||N.dedent)&&(_=!0)}var I={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:_?[]:null}},copyState:function(L){var H={state:L.state,pending:L.pending,local:L.local,localState:null,indent:L.indent&&L.indent.slice(0)};L.localState&&(H.localState=t.copyState(L.local.mode,L.localState)),L.stack&&(H.stack=L.stack.slice(0));for(var X=L.persistentStates;X;X=X.next)H.persistentStates={mode:X.mode,spec:X.spec,state:X.state==L.localState?H.localState:t.copyState(X.mode,X.state),next:H.persistentStates};return H},token:l(x,v),innerMode:function(L){return L.local&&{mode:L.local.mode,state:L.localState}},indent:h(x,w)};if(w)for(var T in w)w.hasOwnProperty(T)&&(I[T]=w[T]);return I};function r(v,y){if(!v.hasOwnProperty(y))throw new Error("Undefined state "+y+" in simple mode")}function i(v,y){if(!v)return/(?:)/;var x="";return v instanceof RegExp?(v.ignoreCase&&(x="i"),v.unicode&&(x+="u"),v=v.source):v=String(v),new RegExp((y===!1?"":"^")+"(?:"+v+")",x)}function o(v){if(!v)return null;if(v.apply)return v;if(typeof v=="string")return v.replace(/\./g," ");for(var y=[],x=0;x<v.length;x++)y.push(v[x]&&v[x].replace(/\./g," "));return y}function a(v,y){(v.next||v.push)&&r(y,v.next||v.push),this.regex=i(v.regex),this.token=o(v.token),this.data=v}function l(v,y){return function(x,w){if(w.pending){var _=w.pending.shift();return w.pending.length==0&&(w.pending=null),x.pos+=_.text.length,_.token}if(w.local)if(w.local.end&&x.match(w.local.end)){var b=w.local.endToken||null;return w.local=w.localState=null,b}else{var b=w.local.mode.token(x,w.localState),E;return w.local.endScan&&(E=w.local.endScan.exec(x.current()))&&(x.pos=x.start+E.index),b}for(var k=v[w.state],O=0;O<k.length;O++){var N=k[O],I=(!N.data.sol||x.sol())&&x.match(N.regex);if(I){N.data.next?w.state=N.data.next:N.data.push?((w.stack||(w.stack=[])).push(w.state),w.state=N.data.push):N.data.pop&&w.stack&&w.stack.length&&(w.state=w.stack.pop()),N.data.mode&&d(y,w,N.data.mode,N.token),N.data.indent&&w.indent.push(x.indentation()+y.indentUnit),N.data.dedent&&w.indent.pop();var T=N.token;if(T&&T.apply&&(T=T(I)),I.length>2&&N.token&&typeof N.token!="string"){for(var L=2;L<I.length;L++)I[L]&&(w.pending||(w.pending=[])).push({text:I[L],token:N.token[L-1]});return x.backUp(I[0].length-(I[1]?I[1].length:0)),T[0]}else return T&&T.join?T[0]:T}}return x.next(),null}}function u(v,y){if(v===y)return!0;if(!v||typeof v!="object"||!y||typeof y!="object")return!1;var x=0;for(var w in v)if(v.hasOwnProperty(w)){if(!y.hasOwnProperty(w)||!u(v[w],y[w]))return!1;x++}for(var w in y)y.hasOwnProperty(w)&&x--;return x==0}function d(v,y,x,w){var _;if(x.persistent)for(var b=y.persistentStates;b&&!_;b=b.next)(x.spec?u(x.spec,b.spec):x.mode==b.mode)&&(_=b);var E=_?_.mode:x.mode||t.getMode(v,x.spec),k=_?_.state:t.startState(E);x.persistent&&!_&&(y.persistentStates={mode:E,spec:x.spec,state:k,next:y.persistentStates}),y.localState=k,y.local={mode:E,end:x.end&&i(x.end),endScan:x.end&&x.forceEnd!==!1&&i(x.end,!1),endToken:w&&w.join?w[w.length-1]:w}}function f(v,y){for(var x=0;x<y.length;x++)if(y[x]===v)return!0}function h(v,y){return function(x,w,_){if(x.local&&x.local.mode.indent)return x.local.mode.indent(x.localState,w,_);if(x.indent==null||x.local||y.dontIndentStates&&f(x.state,y.dontIndentStates)>-1)return t.Pass;var b=x.indent.length-1,E=v[x.state];e:for(;;){for(var k=0;k<E.length;k++){var O=E[k];if(O.data.dedent&&O.data.dedentIfLineStart!==!1){var N=O.regex.exec(w);if(N&&N[0]){b--,(O.next||O.push)&&(E=v[O.next||O.push]),w=w.slice(N[0].length);continue e}}}break}return b<0?0:x.indent[b]}}})}()),Ly.exports}qP();!window.CodeMirror&&(window.CodeMirror=ax);const tu=window.CodeMirror||ax,XP=Es({name:"DefaultMode",props:{name:{type:String,default:`cm-textarea-${+new Date}`},value:{type:String,default:""},content:{type:String,default:""},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>null},placeholder:{type:String,default:""}},emits:{ready:n=>n,"update:cminstance":n=>n},setup(n,{emit:e}){const t=ke(),r=ke(null),i=()=>{r.value=gc(tu.fromTextArea(t.value,n.options)),e("update:cminstance",r.value);const o=Jt(()=>n.cminstance,a=>{var l;a&&((l=n.cminstance)==null||l.setValue(n.value||n.content)),e("ready",ze(r)),o==null||o()},{deep:!0})};return Yt(()=>{i()}),{textarea:t,initialize:i}}}),qv=(n,e)=>{const t=n.__vccOpts||n;for(const[r,i]of e)t[r]=i;return t},YP=["name","placeholder"];function KP(n,e,t,r,i,o){return G(),ae("textarea",{ref:"textarea",name:n.$props.name,placeholder:n.$props.placeholder},null,8,YP)}const Ry=qv(XP,[["render",KP]]);window.diff_match_patch=GP;window.DIFF_DELETE=-1;window.DIFF_INSERT=1;window.DIFF_EQUAL=0;const JP=Es({name:"MergeMode",props:{options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})}},emits:["update:cminstance","ready"],setup(n,{emit:e}){const t=ke(),r=ke(),i=()=>{t.value=gc(tu.MergeView(r.value,n.options)),e("update:cminstance",t.value),e("ready",t)};return Yt(()=>{i()}),{mergeView:r,initialize:i}}}),ZP={ref:"mergeView"};function QP(n,e,t,r,i,o){return G(),ae("div",ZP,null,512)}const e3=qv(JP,[["render",QP]]);function t3(n){const e=/#link#(.+)#link#/g,t=[];let r;for(r=e.exec(n);r;){const i=document.createElement("a"),o=JSON.parse(r[1]),a=Object.entries(o);for(const[l,u]of a)i.setAttribute(l,u);i.className="editor_custom_link",i.innerHTML="logDownload",t.push({start:r.index,end:r.index+r[0].length,node:i}),r=e.exec(n)}return t}function n3(n){const e=[];function t(){const r=/#log<(\w*)>log#((.|\r\n|\n)*?)#log<(\w*)>log#/g;let i;for(i=r.exec(n);i;){const o=i[0].replace(/\r\n/g,`
`).split(`
`),a=i[2].replace(/\r\n/g,`
`).split(`
`),l=document.createElement("span"),u=i[1];l.className=`c-editor--log__${u}`;let d=0;for(let f=0;f<o.length;f++){const h=o[f],v=a[f],y=l.cloneNode(!1);y.innerText=v,e.push({start:i.index+d,end:i.index+d+h.length,node:y}),d=d+h.length+1}i=r.exec(n)}}return t(),e}const $u=[{regex:/(\[.*?\])([ \t]*)(<error>[ \t])(.+)/,token:["tag","","error.strong","error.strong"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<info>)(.+)(.?)/,token:["tag","","bracket","bracket","hr"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<warning>)(.+)(.?)/,token:["tag","","comment","comment","hr"],sol:!0}];tu.defineSimpleMode("fclog",{start:[...$u,{regex:/.*/,token:"hr"}],error:[...$u,{regex:/.*/,token:"error.strong"}],info:[...$u,{regex:/.*/,token:"bracket"}],warning:[...$u,{regex:/.*\[/,token:"comment"}]});tu.defineSimpleMode("log",{start:[{regex:/^[=]+[^=]*[=]+/,token:"strong"},{regex:/([^\w])([A-Z][\w]*)/,token:["","string"]},{regex:/(^[A-Z][\w]*)/,token:"string"}]});const r3=Es({name:"CodemirrorFclog",props:{value:{type:String,default:""},name:{type:String,default:`cm-textarea-${+new Date}`},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},placeholder:{type:String,default:""}},emits:["update:cminstance","ready"],setup(n,{emit:e}){const t=ke(),r=ke(null),i=(a=n.cminstance)=>{a.getAllMarks().forEach(d=>d.clear());const l=a.getValue(),u=[].concat(t3(l)).concat(n3(l));for(let d=0;d<u.length;d++){const f=u[d];a.markText(a.posFromIndex(f.start),a.posFromIndex(f.end),{replacedWith:f.node})}},o=()=>{var a;r.value=gc(tu.fromTextArea(t.value,n.options)),e("update:cminstance",ze(r)),(a=r.value)==null||a.on("change",i)};return Jt(()=>n.cminstance,a=>{var l;a&&(i(n.cminstance),(l=n.cminstance)==null||l.setValue(n.value),e("ready",r))},{deep:!0,immediate:!0}),Yt(()=>{o()}),{initialize:o,textarea:t}}}),i3=["name","placeholder"];function o3(n,e,t,r,i,o){return G(),ae("textarea",{ref:"textarea",name:n.$props.name,placeholder:n.$props.placeholder},null,8,i3)}const a3=qv(r3,[["render",o3]]),sx={"update:value":()=>!0,change:(n,e)=>({value:n,cm:e}),input:()=>!0,ready:n=>n},s3=["changes","scroll","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],l3=()=>{const n={};return s3.forEach(e=>{n[e]=(...t)=>t}),n},u3={...sx,...l3()},Hf={mode:"text",theme:"default",lineNumbers:!0,smartIndent:!0,indentUnit:2,styleActiveLine:!0};function d3(n){Promise.resolve().then(()=>{const e=n.getScrollInfo();n.scrollTo(e.left,e.height)})}const c3=({props:n,cminstance:e,emit:t,internalInstance:r,content:i})=>{const o=Gt(()=>{var l;return n.merge?(l=ze(e))==null?void 0:l.editor():ze(e)}),a=()=>{const l=[];return Object.keys(r==null?void 0:r.vnode.props).forEach(u=>{if(u.startsWith("on")){const d=u.replace(u[2],u[2].toLowerCase()).slice(2);!sx[d]&&l.push(d)}}),l};return{listenerEvents:()=>{o.value.on("change",u=>{const d=u.getValue();d===i.value&&d!==""||(i.value=d,t("update:value",i.value||""),t("input",i.value||" "),Promise.resolve().then(()=>{t("change",i.value,u)}),n.keepCursorInEnd&&d3(u))});const l={};a().filter(u=>!l[u]&&(l[u]=!0)).forEach(u=>{o.value.on(u,(...d)=>{t(u,...d)})})}}};function f3({props:n,cminstance:e,presetRef:t}){const r=ke("100%"),i=ke("100%"),o=Gt(()=>{var v;return n.merge?(v=ze(e))==null?void 0:v.editor():ze(e)}),a=()=>{vn(()=>{var v;(v=o.value)==null||v.refresh()})},l=v=>v?!(v&&isNaN(+v)):!1,u=(v=n.width,y=n.height)=>{var x;let w="100%",_="100%";l(v)?w=`${String(v)}px`:v&&(w=v),l(y)?_=`${String(y)}px`:y&&(_=y),r.value=w,i.value=_,(x=o.value)==null||x.setSize("100%","100%")},d=()=>{var v;const y=(v=o.value)==null?void 0:v.getWrapperElement();y==null||y.remove()},f=()=>{var v,y,x;const w=(v=o.value)==null?void 0:v.getDoc().getHistory();(y=t.value)==null||y.initialize(),d(),(x=o.value)==null||x.getDoc().setHistory(w)},h=()=>{const v=document.querySelector(".CodeMirror-gutters");return(v==null?void 0:v.style.left.replace("px",""))!=="0"};return{reload:f,refresh:a,resize:u,destroy:d,containerWidth:r,containerHeight:i,reviseStyle:()=>{if(a(),!h())return;const v=setInterval(()=>{h()?a():clearInterval(v)},60),y=setTimeout(()=>{clearInterval(v),clearTimeout(y)},400)}}}const h3=Es({__name:"index",props:{value:{type:String,default:""},options:{type:Object,default:()=>Hf},globalOptions:{type:Object,default:()=>Hf},placeholder:{type:String,default:""},border:{type:Boolean,default:!1},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},originalStyle:{type:Boolean,default:!1},keepCursorInEnd:{type:Boolean,default:!1},merge:{type:Boolean,default:!1},name:{type:String,default:""},marker:{type:Function,default:()=>null},unseenLines:{type:Array,default:()=>[]}},emits:u3,setup(n,{expose:e,emit:t}){var r,i,o;typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value(V){if(V==null)throw new TypeError("Cannot convert undefined or null to object");const q=Object(V);for(let D=1;D<arguments.length;D++){const W=arguments[D];if(W!=null)for(const $ in W)Object.prototype.hasOwnProperty.call(W,$)&&(q[$]=W[$])}return q},writable:!0,configurable:!0});const a=n,l=t,u=ke(null),d=ke(""),f=C2(Ry),h=ke({foldGutter:!0,...Hf,...a.globalOptions,...a.options,gutters:[...new Set(["CodeMirror-linenumbers","CodeMirror-foldgutter",...((r=a.options)==null?void 0:r.gutters)||[]])]}),v=k2(),y=a.name||((o=(i=v==null?void 0:v.parent)==null?void 0:i.type)==null?void 0:o.name)||void 0,x=ke(null),w=Gt(()=>{var V;return a.merge?(V=ze(u))==null?void 0:V.editor():ze(u)}),{refresh:_,resize:b,destroy:E,containerHeight:k,containerWidth:O,reviseStyle:N}=f3({props:a,cminstance:u,presetRef:x}),{listenerEvents:I}=c3({props:a,cminstance:u,emit:l,internalInstance:v,content:d}),T=()=>{a.unseenLines!==void 0&&a.marker!==void 0&&a.unseenLines.forEach(V=>{var q,D;const W=(q=u.value)==null?void 0:q.lineInfo(V);(D=u.value)==null||D.setGutterMarker(V,"breakpoints",W!=null&&W.gutterMarkers?null:a.marker())})},L=V=>{var q,D;const W=(q=u.value)==null?void 0:q.getValue();V!==W&&((D=u.value)==null||D.setValue(V),d.value=V,N()),T()},H=()=>{I(),T(),b(a.width,a.height),l("ready",u.value),Jt([()=>a.width,()=>a.height],([V,q])=>{b(V,q)},{deep:!0})},X=()=>{if(a.options.mode==="fclog"||a.options.mode==="log"){f.value=a3;return}if(a.merge){f.value=e3;return}f.value=Ry};return Jt(()=>a.options,V=>{var q;for(const D in a.options)(q=w.value)==null||q.setOption(D,ze(V[D]))},{deep:!0}),Jt(()=>a.value,V=>{L(V)}),Jt(()=>a.merge,X,{immediate:!0}),Pi(()=>{E()}),e({cminstance:u,resize:b,refresh:_,destroy:E}),(V,q)=>(G(),ae("div",{class:dn(["codemirror-container",{merge:V.$props.merge,bordered:V.$props.border||V.$props.merge&&!a.originalStyle,"original-style":a.originalStyle}]),style:Ti({height:ze(k),width:ze(O)})},[(G(),Ve(M1(f.value),O2({ref_key:"presetRef",ref:x,cminstance:u.value,"onUpdate:cminstance":q[0]||(q[0]=D=>u.value=D),style:{height:"100%"}},{...V.$props,...V.$attrs,options:h.value,name:ze(y),content:d.value},{onReady:H}),null,16,["cminstance"]))],6))}});function p3(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}p3(`.codemirror-container {
  position: relative;
  display: inline-block;
  height: 100%;
  width: fit-content;
  font-size: 13px;
  overflow: hidden;
}
.codemirror-container.bordered {
  border: 1px solid #aaaaaa;
}

.codemirror-container .editor_custom_link {
  cursor: pointer;
  color: #1474f1;
  text-decoration: underline;
}
.codemirror-container .editor_custom_link:hover {
  color: #04b4fa;
}
.codemirror-container:not(.original-style) .CodeMirror-lines .CodeMirror-placeholder.CodeMirror-line-like {
  color: #666;
}
.codemirror-container:not(.original-style) .CodeMirror,
.codemirror-container:not(.original-style) .CodeMirror-merge-pane {
  height: 100%;
  font-family: consolas !important;
}
.codemirror-container:not(.original-style) .CodeMirror-merge,
.codemirror-container:not(.original-style) .CodeMirror-merge-right .CodeMirror {
  height: 100%;
  border: none !important;
}
.codemirror-container:not(.original-style) .c-editor--log__error {
  color: #bb0606;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__info {
  color: #333333;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__warning {
  color: #ee9900;
}
.codemirror-container:not(.original-style) .c-editor--log__success {
  color: #669600;
}
.codemirror-container:not(.original-style) .cm-header,
.codemirror-container:not(.original-style) .cm-strong {
  font-weight: bold;
}
`);const Iy={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(n,{expose:e,emit:t}){const r=t,i=ke(""),o=n;Jt(()=>o.value,v=>{i.value=v},{immediate:!0});const a={mode:"text/javascript",theme:"dracula"},l=ke(null),u=v=>{r("update:value",v)},d=()=>{l.value.refresh()},f=()=>{},h=()=>{};return e({handleRefresh:d}),(v,y)=>(G(),ae("div",null,[B(ze(h3),{onWheel:y[0]||(y[0]=nn(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":y[1]||(y[1]=x=>i.value=x),options:a,ref_key:"cmRef",ref:l,height:o.height,width:o.width,onChange:u,onInput:h,onReady:f},null,8,["value","height","width"])]))}},v3={class:"problem-optimization-form"},g3={class:"node-form-content"},m3={class:"gray-block"},y3={class:"array-form-box"},_3={class:"flex-block-item"},b3=["onClick"],x3={class:"code-edit-box"},w3={class:"title-block"},S3={class:"code-box"},E3={class:"flex-block-item"},C3={class:"gray-block mt16"},k3={class:"output-box"},O3={class:"flex-block-item",style:{gap:"12px"}},M3=["onClick"],N3=["onClick"],A3={key:0,class:"sub-field-box"},T3={style:{margin:"40px 0 24px 0"}},By=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,D3={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=ke([]);function o(){const q=r.lf.getNodeModelById(r.nodeId);if(q){let D=q.getAllParentVariable();i.value=a(D)}}function a(q){return q.forEach(D=>{D.typ=="node"?D.node_type==1?D.value="global":D.value=D.node_id:D.value=D.key,D.children&&D.children.length>0&&(D.children=a(D.children))}),q}const l=ke(),u=qt({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),d=()=>{u.main_func=By};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function h(q){return q.forEach(D=>{D.cu_key=Math.random()*1e4,D.subs&&D.subs.length?h(D.subs):D.subs=[]}),q}const v=()=>{const q=JSON.stringify({code_run:{...u,params:y()}});t("update-node",{...r.node,...u,node_params:q})};function y(){let q=[];return u.params.forEach(D=>{q.push({field:D.field,variable:D.variable&&D.variable.length>0?D.variable.join("."):""})}),q}const x=()=>{try{let q=r.node.dataRaw||r.node.node_params||"{}",D=JSON.parse(q).code_run||{};D=JSON.parse(JSON.stringify(D)),o();for(let W in D){if(W=="params"){D[W]&&D[W].length>0?u[W]=D[W].map($=>({...$,cu_key:Math.random()*1e4})):u[W]=[];continue}if(W=="output"){u.output=h(D[W]);continue}u[W]=D[W]}u.main_func=u.main_func||By,u.params=u.params.map(W=>{let $="";for(let pe=0;pe<f.length;pe++)if(W.variable.indexOf(f[pe])>-1){$=f[pe];break}if($!=""){let pe=W.variable.split(".");W.variable=[pe[0],$]}else W.variable=W.variable.split(".");return{...W,key:Math.random()*1e4}})}catch(q){}};Jt(()=>u,()=>{v()},{deep:!0});const w=()=>{u.params.push({key:"",value:"",cu_key:Math.random()*1e4})},_=q=>{u.params.splice(q,1)},b=()=>{u.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},E=q=>{u.output.splice(q,1)},k=q=>{q.subs=[]},O=q=>{u.output[q].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},N=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],I=q=>{q||o()},T=ke(!1),L=ke(null),H=()=>{T.value=!0,L.value&&L.value.handleRefresh()},X=()=>{T.value=!1},V=()=>{t("close")};return Yt(()=>{x()}),(q,D)=>{const W=dr,$=lo,pe=ya,De=ci,de=Bn,Se=_a,me=Zr,ve=Mr,Re=Or,Ie=yr,ce=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:V},null,8,["title","iconName"])]),default:U(()=>[S("div",v3,[S("div",g3,[B(ce,{ref_key:"formRef",ref:l,layout:"vertical",model:u},{default:U(()=>[S("div",m3,[D[10]||(D[10]=S("div",{class:"gray-block-title"},"输入",-1)),S("div",y3,[D[6]||(D[6]=S("div",{class:"form-item-label"},"自定义输入参数",-1)),(G(!0),ae(rt,null,gt(u.params,(ue,K)=>(G(),ae("div",{class:"form-item-list",key:K},[B(De,{label:null,name:["params",K,"variable"]},{default:U(()=>[S("div",_3,[B($,null,{default:U(()=>[B(W,{style:{width:"190px"},value:ue.field,"onUpdate:value":ie=>ue.field=ie,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),B(pe,{value:ue.variable,"onUpdate:value":ie=>ue.variable=ie,onDropdownVisibleChange:I,style:{width:"400px"},options:i.value,allowClear:!1,displayRender:({labels:ie})=>ie.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),S("div",{class:"btn-hover-wrap",onClick:ie=>_(K)},[B(ze(Jn))],8,b3)])]),_:2},1032,["name"])]))),128)),B(de,{onClick:w,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>D[5]||(D[5]=[Be("添加参数")])),_:1,__:[5]},8,["icon"])]),S("div",x3,[S("div",w3,[D[7]||(D[7]=S("div",null,"JavaScript 代码",-1)),B(Se,{gap:16,align:"center"},{default:U(()=>[S("a",{onClick:d},"还原为模板"),S("div",{class:"btn-hover-wrap",onClick:H},[B(ze(Rv))])]),_:1})]),S("div",S3,[B(Iy,{value:u.main_func,"onUpdate:value":D[0]||(D[0]=ue=>u.main_func=ue),width:410,height:170},null,8,["value"])])]),B(De,{name:"timeout",class:"mt16"},{label:U(()=>[B(Se,{gap:2},{default:U(()=>D[8]||(D[8]=[Be("超时时长")])),_:1,__:[8]})]),default:U(()=>[S("div",E3,[B(me,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:u.timeout,"onUpdate:value":D[1]||(D[1]=ue=>u.timeout=ue),min:0,max:3e3},null,8,["value"]),D[9]||(D[9]=Be(" 秒 "))])]),_:1})]),S("div",C3,[D[13]||(D[13]=S("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),S("div",k3,[D[12]||(D[12]=S("div",{class:"output-block"},[S("div",{class:"output-item"},"参数Key"),S("div",{class:"output-item"},"类型")],-1)),S("div",{class:"array-form-box",onMousedown:D[2]||(D[2]=nn(()=>{},["stop"]))},[(G(!0),ae(rt,null,gt(u.output,(ue,K)=>(G(),ae("div",{class:"form-item-list",key:K},[B(De,{label:null,name:["output",K,"key"]},{default:U(()=>[S("div",O3,[B(W,{style:{width:"214px"},value:ue.key,"onUpdate:value":ie=>ue.key=ie,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B($,null,{default:U(()=>[B(Re,{onChange:ie=>k(ue),value:ue.typ,"onUpdate:value":ie=>ue.typ=ie,placeholder:"请选择",style:{width:"214px"}},{default:U(()=>[(G(),ae(rt,null,gt(N,ie=>B(ve,{value:ie.value,key:ie.value},{default:U(()=>[Be(Ae(ie.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),ue.typ=="object"?(G(),ae("div",{key:0,class:"btn-hover-wrap",onClick:ie=>O(K)},[B(ze(ba))],8,M3)):qe("",!0),S("div",{class:"btn-hover-wrap",onClick:ie=>E(K)},[B(ze(Jn))],8,N3)]),ue.subs&&ue.subs.length>0?(G(),ae("div",A3,[B($,null,{default:U(()=>[B(IP,{data:ue.subs,level:2,typOptions:N},null,8,["data"])]),_:2},1024)])):qe("",!0)]),_:2},1032,["name"])]))),128)),B(de,{onClick:b,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>D[11]||(D[11]=[Be("添加参数")])),_:1,__:[11]},8,["icon"])],32)])]),D[15]||(D[15]=S("div",{class:"gray-block mt16"},[S("div",{class:"gray-block-title"},"异常处理"),S("div",null,"运行代码报错时执行该分支")],-1)),B(Ie,{open:T.value,"onUpdate:open":D[4]||(D[4]=ue=>T.value=ue),title:"编辑代码",width:746},{footer:U(()=>[B(de,{type:"primary",onClick:X},{default:U(()=>D[14]||(D[14]=[Be("确定")])),_:1,__:[14]})]),default:U(()=>[S("div",T3,[B(Iy,{ref_key:"codeEditBoxRef",ref:L,value:u.main_func,"onUpdate:value":D[3]||(D[3]=ue=>u.main_func=ue),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1,__:[15]},8,["model"])])])]),_:1})}}},L3=_t(D3,[["__scopeId","data-v-f417e76c"]]),P3={class:"sub-field-item"},R3=["onClick"],I3=["onClick"],B3={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Gt(()=>e.level>2?e.typOptions.filter(u=>u.value!="object"):e.typOptions),r=Gt(()=>e.level==2?"180px":"146px"),i=(u,d)=>{d[u].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(u,d)=>{d.splice(u,1)},a=u=>{u.subs=[]},l=u=>u.typ=="object"&&e.level<=2;return(u,d)=>{const f=dr,h=Mr,v=Or,y=Sn("SubsKey",!0);return G(!0),ae(rt,null,gt(e.data,(x,w)=>(G(),ae("div",{class:dn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:x.cu_key},[S("div",P3,[d[0]||(d[0]=S("img",{class:"fork-icon",src:us,alt:""},null,-1)),B(f,{class:"mr12",style:Ti({width:r.value}),value:x.key,"onUpdate:value":_=>x.key=_,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=S("img",{class:"fork-icon",src:us,alt:""},null,-1)),B(v,{class:"mr12",onChange:_=>a(x),value:x.typ,"onUpdate:value":_=>x.typ=_,placeholder:"请选择",style:Ti({width:r.value})},{default:U(()=>[(G(!0),ae(rt,null,gt(t.value,_=>(G(),Ve(h,{value:_.value},{default:U(()=>[Be(Ae(_.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(x)?(G(),ae("div",{key:0,class:"btn-hover-wrap mr12",onClick:_=>i(w,e.data)},[B(ze(ba))],8,R3)):qe("",!0),S("div",{class:"btn-hover-wrap",onClick:_=>o(w,e.data)},[B(ze(Jn))],8,I3)]),x.subs&&x.subs.length>0?(G(),Ve(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:x.subs},null,8,["level","typOptions","data"])):qe("",!0)],2))),128)}}},j3=_t(B3,[["__scopeId","data-v-31e10652"]]),H3={class:"problem-optimization-form"},$3={class:"node-form-content"},F3={class:"gray-block"},z3={class:"flex-block-item"},U3={class:"array-form-box"},V3={class:"flex-block-item"},W3={class:"at-input-flex1"},G3={class:"field-list-item"},q3={class:"field-label"},X3={class:"field-type"},Y3=["onClick"],K3={class:"array-form-box"},J3={class:"flex-block-item"},Z3={class:"at-input-flex1"},Q3={class:"field-list-item"},eR={class:"field-label"},tR={class:"field-type"},nR=["onClick"],rR={key:0},iR={key:0,class:"array-form-box"},oR={class:"flex-block-item"},aR={class:"at-input-flex1"},sR={class:"field-list-item"},lR={class:"field-label"},uR={class:"field-type"},dR=["onClick"],cR={class:"field-list-item"},fR={class:"field-label"},hR={class:"field-type"},pR={class:"flex-block-item"},vR={class:"gray-block mt16"},gR={class:"output-box"},mR={class:"flex-block-item",style:{gap:"12px"}},yR=["onClick"],_R=["onClick"],bR={key:0,class:"sub-field-box"},xR={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=ke([]),o=qt({}),a=(X,V,q)=>{if(X){let D=`at_input_${V}_${q}`;o[D]=X}},l=(X,V,q,D)=>{X=="body_raw"?(f.body_raw=V,f.body_raw_tags=q):(D.tags=q,D.value=V)},u=()=>{const X=r.lf.getNodeModelById(r.nodeId);if(X){let V=X.getAllParentVariable();V.forEach(q=>{q.tags=q.tags||[]}),i.value=V}},d=ke(),f=qt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function h(X){return X.forEach(V=>{V.cu_key=Math.random()*1e4,V.subs&&V.subs.length?h(V.subs):V.subs=[]}),X}const v=()=>{const X=JSON.stringify({curl:{...f}});t("update-node",{...r.node,...f,node_params:X})},y=()=>{try{let X=r.node.dataRaw||r.node.node_params||"{}",V=JSON.parse(X).curl||{};V=JSON.parse(JSON.stringify(V)),u();for(let q in V){if(q=="headers"||q=="params"||q=="body"){V[q]&&V[q].length>0?f[q]=V[q].map(D=>({...D,cu_key:Math.random()*1e4})):f[q]=[];continue}if(q=="output"){f.output=h(V[q]);continue}f[q]=V[q]}}catch(X){}};Jt(()=>f,()=>{v()},{deep:!0});const x=()=>{f.headers.push({key:"",value:"",cu_key:Math.random()*1e4})},w=X=>{f.headers.splice(X,1)},_=()=>{f.params.push({key:"",value:"",cu_key:Math.random()*1e4})},b=X=>{f.params.splice(X,1)},E=()=>{f.body.push({key:"",value:"",cu_key:Math.random()*1e4})},k=X=>{f.body.splice(X,1)},O=()=>{f.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},N=X=>{f.output.splice(X,1)},I=X=>{X.subs=[]},T=X=>{f.output[X].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},L=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],H=()=>{t("close")};return Yt(()=>{y()}),(X,V)=>{const q=Mr,D=Or,W=lo,$=dr,pe=ci,De=Bn,de=D1,Se=T1,me=_a,ve=Zr,Re=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:H},null,8,["title","iconName"])]),default:U(()=>[S("div",H3,[S("div",$3,[B(Re,{ref_key:"formRef",ref:d,layout:"vertical",model:f},{default:U(()=>[S("div",F3,[V[19]||(V[19]=S("div",{class:"gray-block-title"},"输入",-1)),B(pe,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:U(()=>[S("div",z3,[B(W,null,{default:U(()=>[B(D,{value:f.method,"onUpdate:value":V[0]||(V[0]=Ie=>f.method=Ie),style:{width:"120px"}},{default:U(()=>[B(q,{value:"POST"},{default:U(()=>V[7]||(V[7]=[Be("POST")])),_:1,__:[7]}),B(q,{value:"GET"},{default:U(()=>V[8]||(V[8]=[Be("GET")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),B($,{class:"flex1",value:f.rawurl,"onUpdate:value":V[1]||(V[1]=Ie=>f.rawurl=Ie),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),S("div",U3,[V[10]||(V[10]=S("div",{class:"form-item-label"},"HEADERS",-1)),(G(!0),ae(rt,null,gt(f.headers,(Ie,ce)=>(G(),ae("div",{class:"form-item-list",key:ce},[B(pe,{label:null,name:["headers",ce,"value"]},{default:U(()=>[S("div",V3,[B(W,null,{default:U(()=>[B($,{style:{width:"120px"},value:Ie.key,"onUpdate:value":ue=>Ie.key=ue,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),S("div",W3,[B(er,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ue=>a(ue,"headers",ce),options:i.value,defaultSelectedList:Ie.tags,defaultValue:Ie.value,onOpen:u,onChange:(ue,K)=>l("headers",ue,K,Ie,ce),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:ue,payload:K})=>[S("div",G3,[S("div",q3,Ae(ue),1),S("div",X3,Ae(K.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),S("div",{class:"btn-hover-wrap",onClick:ue=>w(ce)},[B(ze(Jn))],8,Y3)])]),_:2},1032,["name"])]))),128)),B(De,{onClick:x,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>V[9]||(V[9]=[Be("添加参数")])),_:1,__:[9]},8,["icon"])]),S("div",K3,[V[12]||(V[12]=S("div",{class:"form-item-label"},"PARAMS",-1)),(G(!0),ae(rt,null,gt(f.params,(Ie,ce)=>(G(),ae("div",{class:"form-item-list",key:ce},[B(pe,{label:null,name:["params",ce,"value"]},{default:U(()=>[S("div",J3,[B(W,null,{default:U(()=>[B($,{style:{width:"120px"},value:Ie.key,"onUpdate:value":ue=>Ie.key=ue,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),S("div",Z3,[B(er,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ue=>a(ue,"params",ce),options:i.value,defaultSelectedList:Ie.tags,defaultValue:Ie.value,onOpen:u,onChange:(ue,K)=>l("params",ue,K,Ie,ce),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:ue,payload:K})=>[S("div",Q3,[S("div",eR,Ae(ue),1),S("div",tR,Ae(K.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),S("div",{class:"btn-hover-wrap",onClick:ue=>b(ce)},[B(ze(Jn))],8,nR)])]),_:2},1032,["name"])]))),128)),B(De,{onClick:_,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>V[11]||(V[11]=[Be("添加参数")])),_:1,__:[11]},8,["icon"])]),f.method=="POST"?(G(),ae("div",rR,[B(pe,{label:"BODY",name:"type",class:"line-height-22"},{default:U(()=>[B(Se,{value:f.type,"onUpdate:value":V[2]||(V[2]=Ie=>f.type=Ie)},{default:U(()=>[B(de,{value:0},{default:U(()=>V[13]||(V[13]=[Be("none")])),_:1,__:[13]}),B(de,{value:1},{default:U(()=>V[14]||(V[14]=[Be("x-www-form-urlencoded")])),_:1,__:[14]}),B(de,{value:2},{default:U(()=>V[15]||(V[15]=[Be("JSON")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),f.type==1?(G(),ae("div",iR,[(G(!0),ae(rt,null,gt(f.body,(Ie,ce)=>(G(),ae("div",{class:"form-item-list",key:ce},[B(pe,{label:null,name:["body",ce,"value"],rules:{required:!0}},{default:U(()=>[S("div",oR,[B(W,null,{default:U(()=>[B($,{style:{width:"120px"},value:Ie.key,"onUpdate:value":ue=>Ie.key=ue,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),S("div",aR,[B(er,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ue=>a(ue,"body",ce),options:i.value,defaultSelectedList:Ie.tags,defaultValue:Ie.value,onOpen:u,onChange:(ue,K)=>l("body",ue,K,Ie,ce),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:ue,payload:K})=>[S("div",sR,[S("div",lR,Ae(ue),1),S("div",uR,Ae(K.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),S("div",{class:"btn-hover-wrap",onClick:ue=>k(ce)},[B(ze(Jn))],8,dR)])]),_:2},1032,["name"])]))),128)),B(De,{onClick:E,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>V[16]||(V[16]=[Be("添加参数")])),_:1,__:[16]},8,["icon"])])):qe("",!0),f.type==2?(G(),Ve(pe,{key:1,label:null,name:"body_raw"},{default:U(()=>[B(er,{type:"textarea",options:i.value,defaultSelectedList:f.body_raw_tags,defaultValue:f.body_raw,ref:Ie=>a(Ie,"body","body_raw"),onOpen:u,onChange:V[3]||(V[3]=(Ie,ce)=>l("body_raw",Ie,ce)),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:Ie,payload:ce})=>[S("div",cR,[S("div",fR,Ae(Ie),1),S("div",hR,Ae(ce.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):qe("",!0)])):qe("",!0),B(pe,{name:"timeout"},{label:U(()=>[B(me,{gap:2},{default:U(()=>V[17]||(V[17]=[Be("超时时长")])),_:1,__:[17]})]),default:U(()=>[S("div",pR,[B(ve,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:f.timeout,"onUpdate:value":V[4]||(V[4]=Ie=>f.timeout=Ie),min:0,max:3e3},null,8,["value"]),V[18]||(V[18]=Be(" 秒 "))])]),_:1})]),S("div",vR,[S("div",{class:"gray-block-title",onClick:V[5]||(V[5]=(...Ie)=>X.test&&X.test(...Ie))},"输出 (输出字段提取)"),S("div",gR,[V[21]||(V[21]=S("div",{class:"output-block"},[S("div",{class:"output-item"},"参数Key"),S("div",{class:"output-item"},"类型")],-1)),S("div",{class:"array-form-box",onMousedown:V[6]||(V[6]=nn(()=>{},["stop"]))},[(G(!0),ae(rt,null,gt(f.output,(Ie,ce)=>(G(),ae("div",{class:"form-item-list",key:ce},[B(pe,{label:null,name:["output",ce,"key"]},{default:U(()=>[S("div",mR,[B($,{style:{width:"214px"},value:Ie.key,"onUpdate:value":ue=>Ie.key=ue,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(W,null,{default:U(()=>[B(D,{onChange:ue=>I(Ie),value:Ie.typ,"onUpdate:value":ue=>Ie.typ=ue,placeholder:"请选择",style:{width:"214px"}},{default:U(()=>[(G(),ae(rt,null,gt(L,ue=>B(q,{value:ue.value,key:ue.value},{default:U(()=>[Be(Ae(ue.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),Ie.typ=="object"?(G(),ae("div",{key:0,class:"btn-hover-wrap",onClick:ue=>T(ce)},[B(ze(ba))],8,yR)):qe("",!0),S("div",{class:"btn-hover-wrap",onClick:ue=>N(ce)},[B(ze(Jn))],8,_R)]),Ie.subs&&Ie.subs.length>0?(G(),ae("div",bR,[B(W,null,{default:U(()=>[B(j3,{data:Ie.subs,level:2,typOptions:L},null,8,["data"])]),_:2},1024)])):qe("",!0)]),_:2},1032,["name"])]))),128)),B(De,{onClick:O,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>V[20]||(V[20]=[Be("添加参数")])),_:1,__:[20]},8,["icon"])],32)])])]),_:1},8,["model"])])])]),_:1})}}},wR=_t(xR,[["__scopeId","data-v-299c49ec"]]),zn={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},lx={string:[zn.EQUALITY.IS,zn.EQUALITY.IS_NOT,zn.TEXT.CONTAIN,zn.TEXT.NOT_CONTAIN,zn.NULLABILITY.EMPTY,zn.NULLABILITY.NOT_EMPTY],integer:[zn.COMPARISON.GT,zn.COMPARISON.LT,zn.COMPARISON.GTE,zn.COMPARISON.LTE,zn.EQUALITY.EQ,zn.COMPARISON.BETWEEN],number:[zn.COMPARISON.GT,zn.COMPARISON.LT,zn.COMPARISON.GTE,zn.COMPARISON.LTE,zn.EQUALITY.EQ,zn.COMPARISON.BETWEEN],boolean:[zn.BOOLEAN.TRUE,zn.BOOLEAN.FALSE]},ux=n=>lx[n]||[],Xv=(n,e)=>{const r=ux(e).find(i=>i.value===n);return(r==null?void 0:r.label)||n},SR={class:"query-condition-filter"},ER={class:"condition-select-box"},CR={class:"select-wrapper"},kR={class:"field-items"},OR={class:"field-select-box"},MR={class:"operator-select-box"},NR={class:"field-value-box"},AR={key:0,class:"site-input-group-wrapper"},TR={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},DR={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},LR=["onClick"],PR={class:"add-btn-box"},RR={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(n,{emit:e}){const t=e,r=n,i=Et("getNode"),o=qt({list:r.where,type:r.type});Jt(()=>r.where,k=>{o.list=k}),Jt(()=>r.type,k=>{o.type=k});const a=Gt(()=>r.where.length>1),l=Gt(()=>lx),u=ke([]),d=()=>{let k=i().getAllParentVariable();u.value=k||[]},f=()=>{d()},h=()=>{let k={type:o.type,list:o.list};t("change",k)},v=(k,O,N,I)=>{o.list[I].rule_value1=k,o.list[I].atTags=O,h()},y=(k,O,N,I)=>{o.list[I].rule_value2=k,o.list[I].atTags2=O,h()},x=()=>{let k={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list.push(k),h()},w=k=>{o.list.splice(k,1),h()},_=(k,O)=>{let N=ux(O.type),I={form_field_id:O.value,field_name:O.name,field_type:O.type,rule:N[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list[k]=I,h()},b=(k,O)=>{let N=o.list[k];N.rule=O.value,N.rule_value1="",N.rule_value2="",N.atTags=[],N.atTags2=[],h()},E=({key:k})=>{o.type=k,t("changeType",k),h()};return Yt(()=>{d()}),(k,O)=>{const N=bc,I=_c,T=xc,L=Mr,H=Or,X=dr,V=Fr,q=Bn,D=Kr;return G(),ae("div",{class:dn(["query-condition-filter-warpper",{"is-multiple":a.value}])},[S("div",SR,[O[5]||(O[5]=S("div",{class:"auxiliary-line"},null,-1)),S("div",ER,[S("div",CR,[B(T,null,{overlay:U(()=>[B(I,{style:{width:"100px"},onClick:E},{default:U(()=>[(G(),Ve(N,{key:1},{default:U(()=>O[1]||(O[1]=[S("a",{href:"javascript:;"},"且",-1)])),_:1,__:[1]})),(G(),Ve(N,{key:2},{default:U(()=>O[2]||(O[2]=[S("a",{href:"javascript:;"},"或",-1)])),_:1,__:[2]}))]),_:1})]),default:U(()=>[S("a",{class:"ant-dropdown-link",onClick:O[0]||(O[0]=nn(()=>{},["prevent"]))},[Be(Ae(o.type==1?"且":"或")+" ",1),B(ze(Cs))])]),_:1})])]),S("div",kR,[(G(!0),ae(rt,null,gt(o.list,(W,$)=>(G(),ae("div",{class:"field-item",key:W.field},[S("div",OR,[B(H,{style:{width:"100px"},value:W.form_field_id,"onUpdate:value":pe=>W.form_field_id=pe,onChange:(pe,De)=>_($,De)},{default:U(()=>[B(L,{value:0,type:"integer",name:"ID",key:"id"},{default:U(()=>O[3]||(O[3]=[Be("ID")])),_:1,__:[3]}),(G(!0),ae(rt,null,gt(r.fieldOptions,pe=>(G(),Ve(L,{value:pe.id,type:pe.type,name:pe.name,key:pe.id},{default:U(()=>[Be(Ae(pe.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),S("div",MR,[B(H,{value:W.rule,"onUpdate:value":pe=>W.rule=pe,style:{width:"100px"},onChange:(pe,De)=>b($,De)},{default:U(()=>[(G(!0),ae(rt,null,gt(l.value[W.field_type],pe=>(G(),Ve(L,{value:pe.value,key:pe.value},{default:U(()=>[Be(Ae(pe.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),S("div",NR,[W.rule==="between"?(G(),ae("div",AR,[S("div",TR,[B(er,{options:u.value,defaultValue:W.rule_value1,defaultSelectedList:W.atTags,onOpen:f,onChange:(pe,De)=>v(pe,De,W,$),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),O[4]||(O[4]=S("span",{class:"site-input-split"},"~",-1)),S("div",DR,[B(er,{options:u.value,defaultValue:W.rule_value2,defaultSelectedList:W.atTags2,onOpen:f,onChange:(pe,De)=>y(pe,De,W,$),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(W.field_type)?(G(),Ve(X,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(W.field_type)?(G(),Ve(er,{key:2,options:u.value,defaultValue:W.rule_value1,defaultSelectedList:W.atTags,onOpen:f,onChange:(pe,De)=>v(pe,De,W,$),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(G(),Ve(er,{key:3,options:u.value,defaultValue:W.rule_value1,defaultSelectedList:W.atTags,onOpen:f,onChange:(pe,De)=>v(pe,De,W,$),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),S("span",{class:"field-del-btn",onClick:pe=>w($)},[B(V,{class:"del-icon",name:"close-circle"})],8,LR)]))),128))])]),S("div",PR,[n.disabled?(G(),Ve(D,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:U(()=>[S("span",null,[B(q,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:U(()=>[B(ze(Nn)),O[6]||(O[6]=Be(" 添加条件 "))]),_:1,__:[6]})])]),_:1})):(G(),Ve(q,{key:1,class:"add-btn",type:"dashed",block:"",onClick:x},{default:U(()=>[B(ze(Nn)),O[7]||(O[7]=Be(" 添加条件 "))]),_:1,__:[7]}))])],2)}}},Yv=_t(RR,[["__scopeId","data-v-c3ccab04"]]),IR={class:"delete-data-form"},BR={class:"node-box-content"},jR={class:"setting-box"},HR={class:"setting-box"},$R={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=Et("setData"),r=Po();let i={};const o=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),a=({type:x,list:w})=>{o.formData.typ=x,o.formData.where=w,d()},l=(x,w)=>{w?(o.formData.form_name=w.name,o.formData.form_description=w.description,y(w.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.where=[]),d()},u=()=>{let x=e.node.dataRaw||"{}";i=JSON.parse(x);let w=f(i.form_delete.where||[]);i.form_delete.where=w,o.formData=i.form_delete,o.formData.form_id&&y(o.formData.form_id),d()},d=()=>{let x={...Ki(o.formData)};x.where=h(x.where),i.form_delete=x,t({...e.node,node_params:JSON.stringify(i)})},f=x=>{let w=[];return x.forEach(_=>{let b=JSON.parse(JSON.stringify(_)),E=b.rule.split("_");b.form_field_id=b.form_field_id*1,b.field_type=E[0],E.shift(),b.rule=E.join("_"),w.push(b)}),w},h=x=>{let w=[];return x.forEach(_=>{let b=JSON.parse(JSON.stringify(_));b.form_field_id=b.form_field_id*1,b.rule=_.field_type+"_"+_.rule,w.push(b)}),w},v=async()=>{const x=await r.getFormList();x&&(o.tableList=x)},y=async x=>{r.getFormFieldList({form_id:x}).then(w=>{w.forEach(_=>{_.id=_.id*1}),o.fieldList=w}).catch(()=>{})};return Yt(()=>{v(),u()}),(x,w)=>(G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:U(()=>w[1]||(w[1]=[S("span",null,[Be("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),S("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[S("div",IR,[S("div",BR,[w[2]||(w[2]=S("div",{class:"node-box-title"},[S("img",{class:"input-icon",src:Os,alt:""}),S("span",{class:"text"},"输入")],-1)),w[3]||(w[3]=S("div",{class:"setting-label"},[S("span",null,"数据表")],-1)),S("div",jR,[B(Mc,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":w[0]||(w[0]=_=>o.formData.form_id=_),onChange:l},null,8,["options","title","description","value"])]),w[4]||(w[4]=S("div",{class:"setting-label"},[S("span",null,"删除条件")],-1)),S("div",HR,[B(Yv,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},FR=_t($R,[["__scopeId","data-v-35e370b4"]]),zR={class:"variable-node"},UR={class:"node-form-content"},VR={class:"gray-block"},WR={class:"field-items"},GR={class:"field-name-box"},qR={class:"field-value-box"},XR={class:"field-value-option"},YR={class:"option-label"},KR={class:"option-type"},JR={class:"field-actions"},ZR={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=ke([]),o=ke([]);function a(){const b=r.lf.getNodeModelById(r.nodeId);if(b){let E=b.properties.loop_parent_key;if(E){const N=r.lf.getNodeModelById(E);if(N){o.value=N.properties.intermediate_params.map(I=>({label:I.key,value:E+"."+I.key}));return}}let O=b.getGlobalVariable().diy_global||[];O.forEach(N=>{N.label=N.key,N.value="global."+N.key}),o.value=O||[]}}function l(){const b=r.lf.getNodeModelById(r.nodeId);if(b){let E=b.getAllParentVariable();i.value=E}}const u=ke([]),d=()=>{let b=JSON.parse(r.node.node_params);b.assign=[...u.value],t("update-node",{...r.node,node_params:JSON.stringify(b)})},f=()=>{try{let b=r.node.dataRaw||r.node.node_params||"{}",E=JSON.parse(b).assign||[];E=JSON.parse(JSON.stringify(E)),E.forEach(k=>{k.tags=k.tags||[]}),u.value=E,a()}catch(b){}},h=b=>{b&&l()},v=(b,E,k)=>{k.tags=E,k.value=b,d()},y=()=>{u.value.push({variable:void 0,value:""}),d()},x=b=>{u.value.splice(b,1),d()},w=b=>{b&&a()},_=()=>{t("close")};return Yt(()=>{f()}),(b,E)=>{const k=Mr,O=Or,N=Bn;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:_},null,8,["title","iconName"])]),default:U(()=>[S("div",zR,[S("div",UR,[S("div",VR,[S("div",WR,[(G(!0),ae(rt,null,gt(u.value,(I,T)=>(G(),ae("div",{class:"field-item",key:T},[S("div",GR,[B(O,{style:{width:"100%"},placeholder:"请输入选择变量",value:I.variable,"onUpdate:value":L=>I.variable=L,onDropdownVisibleChange:w,onChange:d},{default:U(()=>[(G(!0),ae(rt,null,gt(o.value,L=>(G(),Ve(k,{value:L.value,key:L.key},{default:U(()=>[S("span",null,Ae(L.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),S("div",qR,[B(er,{ref_for:!0,ref:"atInput"+T,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:I.tags,defaultValue:I.value,onOpen:h,onChange:(L,H)=>v(L,H,I,T),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:L,payload:H})=>[S("div",XR,[S("div",YR,Ae(L),1),S("div",KR,Ae(H.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),S("div",JR,[B(ze(Jn),{class:"action-btn",onClick:L=>x(T)},null,8,["onClick"])])]))),128))]),S("div",null,[B(N,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:y},{icon:U(()=>[B(ze(Nn))]),default:U(()=>[E[0]||(E[0]=Be(" 添加赋值变量 "))]),_:1,__:[0]})])])])])]),_:1})}}},QR=_t(ZR,[["__scopeId","data-v-fb25df05"]]),eI={class:"update-data-form"},tI={class:"node-box-content"},nI={class:"setting-box"},rI={class:"setting-box"},iI={class:"setting-box"},oI={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Po();let i={};const o=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),a=({type:w,list:_})=>{o.formData.typ=w,o.formData.where=_,f()},l=(w,_)=>{_?(o.formData.form_name=_.name,o.formData.form_description=_.description,x(_.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.datas=[],o.formData.where=[],o.formData.typ=1),f()},u=w=>{o.formData.datas=w,f()},d=()=>{let w=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(w);let _=h(i.form_update.where||[]);i.form_update.where=_,o.formData=i.form_update,o.formData.form_id&&x(o.formData.form_id),f()},f=()=>{let w={...Ki(o.formData)};w.where=v(w.where),i.form_update=w,t({...e.node,node_params:JSON.stringify(i)})},h=w=>{let _=[];return w.forEach(b=>{let E=JSON.parse(JSON.stringify(b)),k=E.rule.split("_");E.form_field_id=E.form_field_id*1,E.field_type=k[0],k.shift(),E.rule=k.join("_"),_.push(E)}),_},v=w=>{let _=[];return w.forEach(b=>{let E=JSON.parse(JSON.stringify(b));E.form_field_id=E.form_field_id*1,E.rule=b.field_type+"_"+b.rule,_.push(E)}),_},y=async()=>{const w=await r.getFormList();w&&(o.tableList=w)},x=async w=>{r.getFormFieldList({form_id:w}).then(_=>{_.forEach(b=>{b.id=b.id*1}),o.fieldList=_}).catch(()=>{})};return Yt(()=>{y(),d()}),(w,_)=>(G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:U(()=>_[1]||(_[1]=[S("span",null,[Be("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),S("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[S("div",eI,[S("div",tI,[_[2]||(_[2]=S("div",{class:"node-box-title"},[S("img",{class:"input-icon",src:Os,alt:""}),S("span",{class:"text"},"输入")],-1)),_[3]||(_[3]=S("div",{class:"setting-label"},[S("span",null,"数据表")],-1)),S("div",nI,[B(Mc,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":_[0]||(_[0]=b=>o.formData.form_id=b),onChange:l},null,8,["options","title","description","value"])]),_[4]||(_[4]=S("div",{class:"setting-label"},[S("span",null,"更新条件")],-1)),S("div",rI,[B(Yv,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])]),_[5]||(_[5]=S("div",{class:"setting-label"},[S("span",null,"更新数据")],-1)),S("div",iI,[B(Gv,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showEmptyFieldRow:o.formData.form_id=="",list:o.formData.datas,onChange:u},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},aI=_t(oI,[["__scopeId","data-v-60a76ec1"]]),dx={__name:"add-params-modal",emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const r=t,i=ke(!1),o=ke("新增参数");let a="add";const l=(b,E)=>E?/^[a-zA-Z_]+$/.test(E)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let u=0;const d=qt({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),f=()=>{i.value=!0},h=()=>{Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),a="add",o.value="新增参数",i.value=!0},v=b=>{u=b,Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),a="addSub",o.value="新增参数",i.value=!0},y=(b,E)=>{u=E,Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(d,{...b}),a="edit",o.value="编辑参数",i.value=!0},x=ke(null),w=()=>{x.value.validate().then(()=>{a=="add"&&r("add",{...d}),a=="addSub"&&r("addSub",{...d},u),a=="edit"&&r("edit",{...d},u),i.value=!1})},_=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:f,add:h,edit:y,addSub:v}),(b,E)=>{const k=dr,O=ci,N=Mr,I=Or,T=ma,L=wc,H=Jr,X=yr;return G(),ae("div",null,[B(X,{open:i.value,"onUpdate:open":E[5]||(E[5]=V=>i.value=V),title:o.value,onOk:w,width:472,"ok-text":"确定","cancel-text":"取消"},{default:U(()=>[B(H,{ref_key:"formRef",ref:x,layout:"vertical",model:d,style:{margin:"24px 0"}},{default:U(()=>[B(O,{label:"参数key",name:"key",rules:[{required:!0,validator:(V,q)=>l(V,q)}]},{default:U(()=>[B(k,{value:d.key,"onUpdate:value":E[0]||(E[0]=V=>d.key=V),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),B(O,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:U(()=>[B(I,{value:d.typ,"onUpdate:value":E[1]||(E[1]=V=>d.typ=V),placeholder:"请选择",style:{width:"100%"}},{default:U(()=>[(G(),ae(rt,null,gt(_,V=>B(N,{value:V.value},{default:U(()=>[Be(Ae(V.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),B(O,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:U(()=>[B(T,{checked:d.required,"onUpdate:checked":E[2]||(E[2]=V=>d.required=V)},null,8,["checked"])]),_:1}),B(O,{label:"默认值",name:"default",rules:[{required:d.required,message:"请输入默认值"}]},{default:U(()=>[B(k,{value:d.default,"onUpdate:value":E[3]||(E[3]=V=>d.default=V),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),B(O,{label:"枚举值",name:"enum"},{default:U(()=>[B(L,{style:{height:"80px"},value:d.enum,"onUpdate:value":E[4]||(E[4]=V=>d.enum=V),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},sI={class:"sub-field-item"},lI=["onClick"],uI=["onClick"],dI=["onClick"],cI={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Gt(()=>e.level>2?e.typOptions.filter(y=>y.value!="object"):e.typOptions),r=Gt(()=>e.level==2?"180px":"146px");let i=0;const o=(y,x)=>{x.splice(y,1)},a=y=>{y.subs=[]},l=ke(null),u=y=>{i=y,l.value.add()},d=(y,x)=>{l.value.edit(y,x)},f=y=>{e.data[i].subs.push(y)},h=(y,x)=>{e.data.splice(x,1,y)},v=y=>y.typ=="object"&&e.level<=2;return(y,x)=>{const w=dr,_=Mr,b=Or,E=Sn("SubsKey",!0);return G(),ae(rt,null,[(G(!0),ae(rt,null,gt(e.data,(k,O)=>(G(),ae("div",{class:dn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:k.cu_key},[S("div",sI,[x[0]||(x[0]=S("img",{class:"fork-icon",src:us,alt:""},null,-1)),B(w,{class:"mr12",style:Ti({width:r.value}),value:k.key,"onUpdate:value":N=>k.key=N,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),x[1]||(x[1]=S("img",{class:"fork-icon",src:us,alt:""},null,-1)),B(b,{class:"mr12",onChange:N=>a(k),value:k.typ,"onUpdate:value":N=>k.typ=N,placeholder:"请选择",style:Ti({width:r.value})},{default:U(()=>[(G(!0),ae(rt,null,gt(t.value,N=>(G(),Ve(_,{value:N.value},{default:U(()=>[Be(Ae(N.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),v(k)?(G(),ae("div",{key:0,class:"btn-hover-wrap mr12",onClick:N=>u(O,e.data)},[B(ze(ba))],8,lI)):qe("",!0),S("div",{class:"btn-hover-wrap mr12",onClick:N=>d(k,O)},[B(ze(Iv))],8,uI),S("div",{class:"btn-hover-wrap",onClick:N=>o(O,e.data)},[B(ze(Jn))],8,dI)]),k.subs&&k.subs.length>0?(G(),Ve(E,{key:0,level:e.level+1,typOptions:e.typOptions,data:k.subs},null,8,["level","typOptions","data"])):qe("",!0)],2))),128)),B(dx,{onAdd:f,onEdit:h,ref_key:"addParamsModalRef",ref:l},null,512)],64)}}},fI=_t(cI,[["__scopeId","data-v-f6bf59d5"]]),hI={class:"problem-optimization-form"},pI={class:"node-form-content"},vI={class:"gray-block"},gI={class:"flex-block-item"},mI={class:"number-box"},yI={class:"number-slider-box"},_I={class:"number-input-box"},bI={class:"number-box"},xI={class:"number-slider-box"},wI={class:"number-input-box"},SI={class:"number-box"},EI={class:"number-box"},CI={class:"number-slider-box"},kI={class:"number-input-box"},OI={class:"field-list-item"},MI={class:"field-label"},NI={class:"field-type"},AI={class:"diy-form-item"},TI={class:"form-content"},DI={class:"gray-block mt16"},LI={class:"output-box"},PI={class:"array-form-box"},RI={class:"flex-block-item",style:{gap:"12px"}},II=["onClick"],BI=["onClick"],jI=["onClick"],HI={key:0,class:"sub-field-box"},$I={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=$r(),o=ke(null),a=Gt(()=>i.modelList),l=ke([]),u=ke([]),d=ke(!1),f=()=>{d.value=!d.value},h=(me,ve)=>{b.prompt=me,b.prompt_tags=ve};function v(){const me=r.lf.getNodeModelById(r.nodeId);if(me){let ve=me.getAllParentVariable();u.value=y(ve)}}function y(me){return me.forEach(ve=>{ve.typ=="node"?ve.node_type==1?ve.value="global":ve.value=ve.node_id:ve.value=ve.key,ve.children&&ve.children.length>0&&(ve.children=y(ve.children))}),me}const x=()=>{const me=r.lf.getNodeModelById(r.nodeId);if(me){let ve=me.getAllParentVariable();l.value=ve}};function w(me){if(me){let ve=me.split("."),Re=ve[0],Ie=ve.filter((ce,ue)=>ue>0).join(".");return[Re,Ie]}return["global","question"]}const _=ke(),b=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[]}),E=()=>{const me=JSON.stringify({params_extractor:{...b,question_value:b.question_value.join("."),model_config_id:b.model_config_id?+b.model_config_id:b.model_config_id}});t("update-node",{...r.node,...b,node_params:me})},k=()=>{try{let me=r.node.dataRaw||r.node.node_params||"{}",ve=JSON.parse(me).params_extractor||{};ve=JSON.parse(JSON.stringify(ve)),x(),v();for(let Re in ve){if(Re=="output"){b.output=O(ve[Re]);continue}if(Re=="question_value"){b.question_value=w(ve[Re]);continue}b[Re]=ve[Re]}!b.model_config_id&&a.value.length>0&&(b.model_config_id=a.value[0].id,b.use_model=a.value[0].children[0].name)}catch(me){}};Jt(()=>b,()=>{E()},{deep:!0});function O(me){return me.forEach(ve=>{ve.cu_key=Math.random()*1e4,ve.subs&&ve.subs.length?O(ve.subs):ve.subs=[]}),me}const N=ke(null),I=()=>{N.value.add()},T=(me,ve)=>{N.value.edit(me,ve)},L=me=>{b.output.push(me)},H=(me,ve)=>{b.output.splice(ve,1,me)},X=me=>{b.output.splice(me,1)},V=me=>{me.subs=[]},q=me=>{N.value.addSub(me)},D=(me,ve)=>{b.output[ve].subs.push(me)},W=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],$=me=>{me||v()},pe=ke({}),De=(me,ve)=>{pe.value=ve},de=Gt(()=>{if(!b.model_config_id)return!1;let me=b.model_config_id+"#"+b.use_model;return pe.value[me]}),Se=()=>{t("close")};return Yt(()=>{k()}),(me,ve)=>{const Re=Bn,Ie=ci,ce=Kr,ue=Jl,K=lo,ie=Zr,ne=ma,fe=ya,he=dr,be=Mr,xe=Or,Ze=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:Se},null,8,["title","iconName"])]),default:U(()=>[S("div",hI,[S("div",pI,[B(Ze,{ref_key:"formRef",ref:_,layout:"vertical",model:b},{default:U(()=>[S("div",vI,[ve[24]||(ve[24]=S("div",{class:"gray-block-title"},"输入",-1)),B(Ie,{label:"LLM模型",name:"use_model"},{default:U(()=>[S("div",gI,[B(kc,{modelType:"LLM",modeName:b.use_model,"onUpdate:modeName":ve[0]||(ve[0]=We=>b.use_model=We),modeId:b.model_config_id,"onUpdate:modeId":ve[1]||(ve[1]=We=>b.model_config_id=We),onLoaded:De,style:{width:"348px"}},null,8,["modeName","modeId"]),B(Re,{onClick:f},{default:U(()=>[ve[12]||(ve[12]=Be("高级设置 ")),d.value?(G(),Ve(ze(Cs),{key:0})):(G(),Ve(ze(Sc),{key:1}))]),_:1,__:[12]})])]),_:1}),d.value?(G(),Ve(Ie,{key:0,name:"temperature"},{label:U(()=>[ve[14]||(ve[14]=S("span",null,"温度 ",-1)),B(ce,null,{title:U(()=>ve[13]||(ve[13]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",mI,[S("div",yI,[B(K,null,{default:U(()=>[B(ue,{class:"custom-slider",value:b.temperature,"onUpdate:value":ve[2]||(ve[2]=We=>b.temperature=We),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),S("div",_I,[B(ie,{value:b.temperature,"onUpdate:value":ve[3]||(ve[3]=We=>b.temperature=We),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):qe("",!0),d.value?(G(),Ve(Ie,{key:1,name:"max_token"},{label:U(()=>[ve[16]||(ve[16]=S("span",null,"最大token ",-1)),B(ce,null,{title:U(()=>ve[15]||(ve[15]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",bI,[S("div",xI,[B(K,null,{default:U(()=>[B(ue,{class:"custom-slider",value:b.max_token,"onUpdate:value":ve[4]||(ve[4]=We=>b.max_token=We),min:0,max:100*1024},null,8,["value"])]),_:1})]),S("div",wI,[B(ie,{value:b.max_token,"onUpdate:value":ve[5]||(ve[5]=We=>b.max_token=We),min:0,max:100*1024},null,8,["value"])])])]),_:1})):qe("",!0),d.value&&de.value?(G(),Ve(Ie,{key:2,name:"enable_thinking"},{label:U(()=>[ve[18]||(ve[18]=S("span",null,"深度思考 ",-1)),B(ce,null,{title:U(()=>ve[17]||(ve[17]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",SI,[B(ne,{checked:b.enable_thinking,"onUpdate:checked":ve[6]||(ve[6]=We=>b.enable_thinking=We)},null,8,["checked"])])]),_:1})):qe("",!0),B(Ie,{name:"context_pair"},{label:U(()=>[ve[20]||(ve[20]=S("span",null,"上下文数量 ",-1)),B(ce,null,{title:U(()=>ve[19]||(ve[19]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",EI,[S("div",CI,[B(K,null,{default:U(()=>[B(ue,{class:"custom-slider",value:b.context_pair,"onUpdate:value":ve[7]||(ve[7]=We=>b.context_pair=We),min:0,max:50},null,8,["value"])]),_:1})]),S("div",kI,[B(ie,{value:b.context_pair,"onUpdate:value":ve[8]||(ve[8]=We=>b.context_pair=We),min:0,max:50},null,8,["value"])])])]),_:1}),B(Ie,{name:"prompt",class:"width-100"},{label:U(()=>ve[21]||(ve[21]=[S("div",{class:"space-between-box"},[S("div",null,"提示词")],-1)])),default:U(()=>[B(er,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:b.prompt_tags,defaultValue:b.prompt,ref_key:"atInputRef",ref:o,onOpen:x,onChange:ve[9]||(ve[9]=(We,St)=>h(We,St)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:U(({label:We,payload:St})=>[S("div",OI,[S("div",MI,Ae(We),1),S("div",NI,Ae(St.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),ve[22]||(ve[22]=S("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),S("div",AI,[ve[23]||(ve[23]=S("div",{class:"form-label"},"用户问题",-1)),S("div",TI,[B(fe,{value:b.question_value,"onUpdate:value":ve[10]||(ve[10]=We=>b.question_value=We),onDropdownVisibleChange:$,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:We})=>We.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),S("div",DI,[S("div",{class:"gray-block-title",onClick:ve[11]||(ve[11]=(...We)=>me.test&&me.test(...We))},"输出 (输出字段提取)"),S("div",LI,[ve[26]||(ve[26]=S("div",{class:"output-block"},[S("div",{class:"output-item"},"参数Key"),S("div",{class:"output-item"},"类型")],-1)),S("div",PI,[(G(!0),ae(rt,null,gt(b.output,(We,St)=>(G(),ae("div",{class:"form-item-list",key:St},[B(Ie,{label:null,name:["output",St,"key"]},{default:U(()=>[S("div",RI,[B(he,{style:{width:"214px"},value:We.key,"onUpdate:value":pt=>We.key=pt,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(K,null,{default:U(()=>[B(xe,{onChange:pt=>V(We),value:We.typ,"onUpdate:value":pt=>We.typ=pt,placeholder:"请选择",style:{width:"214px"}},{default:U(()=>[(G(),ae(rt,null,gt(W,pt=>B(be,{value:pt.value,key:pt.value},{default:U(()=>[Be(Ae(pt.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),We.typ=="object"?(G(),ae("div",{key:0,class:"btn-hover-wrap",onClick:pt=>q(St)},[B(ze(ba))],8,II)):qe("",!0),S("div",{class:"btn-hover-wrap",onClick:pt=>T(We,St)},[B(ze(Iv))],8,BI),S("div",{class:"btn-hover-wrap",onClick:pt=>X(St)},[B(ze(Jn))],8,jI)]),We.subs&&We.subs.length>0?(G(),ae("div",HI,[B(K,null,{default:U(()=>[B(fI,{data:We.subs,level:2,typOptions:W},null,8,["data"])]),_:2},1024)])):qe("",!0)]),_:2},1032,["name"])]))),128)),B(Re,{onClick:I,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>ve[25]||(ve[25]=[Be("添加参数")])),_:1,__:[25]},8,["icon"])])])])]),_:1},8,["model"])]),B(dx,{onAdd:L,onEdit:H,onAddSub:D,ref_key:"addParamsModalRef",ref:N},null,512)])]),_:1})}}},FI=_t($I,[["__scopeId","data-v-00547038"]]),zI={class:"collapse-panel-warpper"},UI={class:"collapse-panel-header"},VI={class:"title-text"},WI={class:"collapse-panel-body"},GI={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(n){const t=ke(n.defaultCollapsed),r=()=>{t.value=!t.value};return(i,o)=>{const a=Fr;return G(),ae("div",zI,[S("div",UI,[S("div",{class:"collapse-panel-title",onClick:nn(r,["stop"])},[S("span",VI,[Be(Ae(n.title)+" ",1),n.count?(G(),ae(rt,{key:0},[Be("（"+Ae(n.count)+"）",1)],64)):qe("",!0)]),B(a,{name:"arrow-down",class:dn(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])])]),To(S("div",WI,[as(i.$slots,"default",{},void 0,!0)],512),[[pa,!t.value]])])}}},$f=_t(GI,[["__scopeId","data-v-9f89b1e9"]]),qI={class:"field-select-box"},XI={key:0,class:"field-list-box"},YI={key:1,class:"empty-box"},KI={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const r=t,i=qt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),o=ke([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),a=ke([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),l=(f,h)=>{i.selectedRowKeys=f,i.selectedRows=h},u=({formId:f,selectedRowKeys:h,selectedRows:v})=>{i.formId=f,i.selectedRowKeys=h,i.selectedRows=v,i.show=!0},d=()=>{r("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:u}),(f,h)=>{const v=A1,y=yr;return G(),Ve(y,{width:"746px",open:i.show,"onUpdate:open":h[1]||(h[1]=x=>i.show=x),title:"关联数据表",onOk:d,"ok-text":"确定","cancel-text":"取消"},{default:U(()=>[S("div",qI,[a.value.length?(G(),ae("div",XI,[B(v,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:l},dataSource:a.value,columns:o.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):qe("",!0),a.value.length?qe("",!0):(G(),ae("div",YI,[h[3]||(h[3]=S("img",{src:Hv,alt:""},null,-1)),S("div",null,[h[2]||(h[2]=Be(" 暂无字段, 请先去数据表添加 ")),S("a",{onClick:h[0]||(h[0]=(...x)=>f.openAddLibrary&&f.openAddLibrary(...x))}," 去添加")])]))])]),_:1},8,["open"])}}},JI=_t(KI,[["__scopeId","data-v-e0fc750c"]]),ZI={class:"field-list"},QI={class:"field-list-col field-drag-col"},e8={class:"drag-btn"},t8={class:"field-list-col field-name-col"},n8={class:"field-name-box"},r8={class:"field-name"},i8={class:"field-type-tag"},o8={class:"field-list-col field-value-col"},a8={key:0,class:"field-list-col field-del-col"},s8={class:"add-btn-box"},l8={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,r=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],o=ke([]);Jt(()=>r.list,v=>{o.value=v.map(y=>({...y,is_asc:y.is_asc?1:0}))});const a=v=>{o.value.splice(v,1),d()},l=(v,y)=>{o.value=y.map(x=>({...x})),d()},u=()=>{d()},d=()=>{let v=o.value.map(y=>({...y,is_asc:y.is_asc==1}));t("change",v)},f=ke(),h=()=>{f.value.open({formId:r.formId,selectedRows:r.list,selectedRowKeys:r.list.map(v=>v.name)})};return(v,y)=>{const x=Mr,w=Or,_=Fr,b=Bn,E=Kr;return G(),ae("div",null,[S("div",ZI,[(G(!0),ae(rt,null,gt(o.value,k=>(G(),ae("div",{class:"field-list-row",key:k.name},[S("div",QI,[S("span",e8,[B(ze(P1))])]),S("div",t8,[S("div",n8,[S("span",r8,Ae(k.name),1),S("span",i8,Ae(k.type),1)])]),S("div",o8,[B(w,{value:k.is_asc,"onUpdate:value":O=>k.is_asc=O,style:{width:"100%"},onChange:u},{default:U(()=>[(G(),ae(rt,null,gt(i,O=>B(x,{value:O.value,key:O.key},{default:U(()=>[Be(Ae(O.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value"])]),r.showDelete?(G(),ae("div",a8,[S("span",{class:"del-btn",onClick:y[0]||(y[0]=O=>a(v.index))},[B(_,{class:"del-icon",name:"close-circle"})])])):qe("",!0)]))),128))]),S("div",s8,[n.disabled?(G(),Ve(E,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:U(()=>[S("span",null,[B(b,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:U(()=>[B(ze(Nn)),y[1]||(y[1]=Be(" 添加排序字段 "))]),_:1,__:[1]})])]),_:1})):(G(),Ve(b,{key:1,class:"add-btn",type:"dashed",block:"",onClick:h},{default:U(()=>[B(ze(Nn)),y[2]||(y[2]=Be(" 添加排序字段 "))]),_:1,__:[2]}))]),B(JI,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:f,onOk:l},null,8,["formId"])])}}},u8=_t(l8,[["__scopeId","data-v-fbdcd109"]]),d8={class:"field-item"},c8={class:"field-name"},f8={class:"field-type"},h8={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=ke([]);return(r,i)=>{const o=Fr,a=H2;return G(),ae("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=nn(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=nn(()=>{},["stop"]))},[B(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:U(({switcherCls:l})=>[S("span",{class:dn(l)},[B(o,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:U(({dataRef:l})=>[S("div",d8,[S("span",c8,Ae(l.title),1),S("span",f8,Ae(l.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},p8=_t(h8,[["__scopeId","data-v-2c5047db"]]),v8={class:"select-data-form"},g8={class:"node-box-content"},m8={class:"setting-box"},y8={class:"setting-box"},_8={class:"node-box-content"},b8={class:"setting-box"},x8={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=n,t=Et("setData"),r=Po();let i={};const o=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),a=Gt(()=>[{title:"output_list",key:"output_list",type:"array<object>",children:o.formData.fields.map(k=>({title:k.name,key:k.name,type:k.type}))},{title:"row_num",key:"row_num",type:"integer"}]),l=({type:E,list:k})=>{o.formData.typ=E,o.formData.where=k,y()},u=E=>{o.formData.order=[...E],y()},d=(E,k)=>{k?(o.formData.form_name=k.name,o.formData.form_description=k.description,b(k.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.typ=1,o.formData.fields=[],o.formData.where=[],o.formData.order=[],o.formData.limit=100),y()},f=E=>{o.formData.fields=E,y()},h=()=>{y()},v=()=>{let E=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(E);let k=x(i.form_select.where||[]);i.form_select.where=k,o.formData=i.form_select,o.formData.form_id&&b(o.formData.form_id),y()},y=()=>{let E={...Ki(o.formData)};E.where=w(E.where),i.form_select=E,t({...e.node,node_params:JSON.stringify(i)})},x=E=>{let k=[];return E.forEach(O=>{let N=JSON.parse(JSON.stringify(O)),I=N.rule.split("_");N.form_field_id=N.form_field_id*1,N.field_type=I[0],I.shift(),N.rule=I.join("_"),k.push(N)}),k},w=E=>{let k=[];return E.forEach(O=>{let N=JSON.parse(JSON.stringify(O));N.form_field_id=N.form_field_id*1,N.rule=O.field_type+"_"+O.rule,k.push(N)}),k},_=async()=>{const E=await r.getFormList();E&&(o.tableList=E)},b=async E=>{r.getFormFieldList({form_id:E}).then(k=>{k.forEach(O=>{O.id=O.id*1}),o.fieldList=k}).catch(()=>{})};return Yt(()=>{_(),v()}),(E,k)=>{const O=Zr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:U(()=>k[8]||(k[8]=[S("span",null,[Be("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),S("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[S("div",v8,[S("div",g8,[k[9]||(k[9]=S("div",{class:"node-box-title"},[S("img",{class:"input-icon",src:Os,alt:""}),S("span",{class:"text"},"输入")],-1)),k[10]||(k[10]=S("div",{class:"setting-label"},[S("span",null,"数据表")],-1)),S("div",m8,[B(Mc,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":k[0]||(k[0]=N=>o.formData.form_id=N),onChange:d},null,8,["options","title","description","value"])]),S("div",y8,[B($f,{title:"查询条件",count:o.formData.where.length},{default:U(()=>[B(Yv,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:l},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),S("div",{class:"setting-box",onWheel:k[1]||(k[1]=nn(()=>{},["stop"])),onTouchmove:k[2]||(k[2]=nn(()=>{},["stop"]))},[B($f,{title:"查询字段",count:o.formData.fields.length},{default:U(()=>[B(Gv,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showInput:!1,showEmptyFieldRow:o.formData.form_id=="",list:o.formData.fields,onChange:f},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),S("div",{class:"setting-box",onWheel:k[3]||(k[3]=nn(()=>{},["stop"])),onTouchmove:k[4]||(k[4]=nn(()=>{},["stop"]))},[B($f,{title:"排序",count:o.formData.order.length},{default:U(()=>[B(u8,{"form-id":o.formData.form_id,disabled:!o.formData.form_id,list:o.formData.order,onChange:u},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),k[11]||(k[11]=S("div",{class:"setting-label"},[S("span",null,"查询数量")],-1)),S("div",{class:"setting-box",onWheel:k[6]||(k[6]=nn(()=>{},["stop"])),onTouchmove:k[7]||(k[7]=nn(()=>{},["stop"]))},[B(O,{min:1,max:1e3,value:o.formData.limit,"onUpdate:value":k[5]||(k[5]=N=>o.formData.limit=N),disabled:!o.formData.form_id,style:{width:"205px"},onChange:h},null,8,["value","disabled"])],32)]),S("div",_8,[k[12]||(k[12]=S("div",{class:"node-box-title"},[S("img",{class:"input-icon",src:Wv,alt:""}),S("span",{class:"text"},"输出")],-1)),S("div",b8,[B(p8,{treeData:a.value},null,8,["treeData"])])])])]),_:1})}}},w8=_t(x8,[["__scopeId","data-v-2499b36b"]]),S8={class:"problem-optimization-form"},E8={class:"gray-block"},C8={class:"flex-block-item"},k8={class:"number-box"},O8={class:"number-slider-box"},M8={class:"number-input-box"},N8={class:"number-box"},A8={class:"number-slider-box"},T8={class:"number-input-box"},D8={class:"number-box"},L8={class:"number-box"},P8={class:"number-slider-box"},R8={class:"number-input-box"},I8={class:"gray-block mt16"},B8={class:"array-form-box"},j8={class:"flex-block-item"},H8=["onClick"],$8={class:"form-item-list"},F8={class:"flex-block-item"},z8={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=$r(),o=Gt(()=>i.modelList),a=ke(!1),l=()=>{a.value=!a.value},u=ke(),d=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]}),f=()=>{const k=JSON.stringify({cate:{...d,model_config_id:d.model_config_id?+d.model_config_id:d.model_config_id}});t("update-node",{...r.node,...d,node_params:k})},h=()=>{try{let k=r.node.dataRaw||r.node.node_params||"{}",O=JSON.parse(k).cate||{};O=JSON.parse(JSON.stringify(O));for(let N in O)if(N=="categorys")if(O.categorys&&O.categorys.length>0){let I=O.categorys.map(T=>({...T,key:Math.random()*1e4}));d[N]=I}else d[N]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else d[N]=O[N];!d.model_config_id&&o.value.length>0&&(d.model_config_id=o.value[0].id,d.use_model=o.value[0].children[0].name)}catch(k){}};Jt(()=>d,()=>{f()},{deep:!0});const v=()=>{d.categorys.push({category:"",next_node_key:"",key:Math.random()*1e4})},y=k=>{d.categorys.splice(k,1)},x=()=>Promise.resolve(),w=ke({}),_=(k,O)=>{w.value=O},b=Gt(()=>{if(!d.model_config_id)return!1;let k=d.model_config_id+"#"+d.use_model;return w.value[k]}),E=()=>{t("close")};return Yt(()=>{h()}),(k,O)=>{const N=Bn,I=ci,T=Kr,L=Jl,H=lo,X=Zr,V=ma,q=dr,D=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:E},null,8,["title","iconName"])]),default:U(()=>[S("div",S8,[S("div",{class:"node-form-content",onMousedown:O[9]||(O[9]=nn(()=>{},["stop"]))},[B(D,{ref_key:"formRef",ref:u,layout:"vertical",model:d},{default:U(()=>[S("div",E8,[O[19]||(O[19]=S("div",{class:"gray-block-title"},"输入",-1)),B(I,{label:"LLM模型",name:"use_model"},{default:U(()=>[S("div",C8,[B(kc,{modelType:"LLM",modeName:d.use_model,"onUpdate:modeName":O[0]||(O[0]=W=>d.use_model=W),modeId:d.model_config_id,"onUpdate:modeId":O[1]||(O[1]=W=>d.model_config_id=W),onLoaded:_,style:{width:"348px"}},null,8,["modeName","modeId"]),B(N,{onClick:l},{default:U(()=>[O[10]||(O[10]=Be("高级设置 ")),a.value?(G(),Ve(ze(Cs),{key:0})):(G(),Ve(ze(Sc),{key:1}))]),_:1,__:[10]})])]),_:1}),a.value?(G(),Ve(I,{key:0,name:"temperature"},{label:U(()=>[O[12]||(O[12]=S("span",null,"温度 ",-1)),B(T,null,{title:U(()=>O[11]||(O[11]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",k8,[S("div",O8,[B(H,null,{default:U(()=>[B(L,{class:"custom-slider",value:d.temperature,"onUpdate:value":O[2]||(O[2]=W=>d.temperature=W),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),S("div",M8,[B(X,{value:d.temperature,"onUpdate:value":O[3]||(O[3]=W=>d.temperature=W),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):qe("",!0),a.value?(G(),Ve(I,{key:1,name:"max_token"},{label:U(()=>[O[14]||(O[14]=S("span",null,"最大token ",-1)),B(T,null,{title:U(()=>O[13]||(O[13]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",N8,[S("div",A8,[B(H,null,{default:U(()=>[B(L,{class:"custom-slider",value:d.max_token,"onUpdate:value":O[4]||(O[4]=W=>d.max_token=W),min:0,max:100*1024},null,8,["value"])]),_:1})]),S("div",T8,[B(X,{value:d.max_token,"onUpdate:value":O[5]||(O[5]=W=>d.max_token=W),min:0,max:100*1024},null,8,["value"])])])]),_:1})):qe("",!0),a.value&&b.value?(G(),Ve(I,{key:2,name:"enable_thinking"},{label:U(()=>[O[16]||(O[16]=S("span",null,"深度思考 ",-1)),B(T,null,{title:U(()=>O[15]||(O[15]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",D8,[B(V,{checked:d.enable_thinking,"onUpdate:checked":O[6]||(O[6]=W=>d.enable_thinking=W)},null,8,["checked"])])]),_:1})):qe("",!0),B(I,{name:"context_pair"},{label:U(()=>[O[18]||(O[18]=S("span",null,"上下文数量 ",-1)),B(T,null,{title:U(()=>O[17]||(O[17]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[B(ze(An),{class:"question-icon"})]),_:1})]),default:U(()=>[S("div",L8,[S("div",P8,[B(H,null,{default:U(()=>[B(L,{class:"custom-slider",value:d.context_pair,"onUpdate:value":O[7]||(O[7]=W=>d.context_pair=W),min:0,max:50},null,8,["value"])]),_:1})]),S("div",R8,[B(X,{value:d.context_pair,"onUpdate:value":O[8]||(O[8]=W=>d.context_pair=W),min:0,max:50},null,8,["value"])])])]),_:1}),O[20]||(O[20]=S("div",{class:"diy-form-item"},[S("div",{class:"form-label"},"用户问题"),S("div",{class:"form-content"},"流程开始>用户问题")],-1))]),S("div",I8,[O[22]||(O[22]=S("div",{class:"gray-block-title"},"问题分类设置",-1)),S("div",B8,[(G(!0),ae(rt,null,gt(d.categorys,(W,$)=>(G(),ae("div",{class:"form-item-list",key:W.key},[B(I,{label:null,name:["categorys",$,"category"],rules:{required:!0,validator:(pe,De)=>x(pe,De)}},{default:U(()=>[S("div",j8,[B(q,{class:"flex1",value:W.category,"onUpdate:value":pe=>W.category=pe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),S("div",{class:"btn-hover-wrap",onClick:pe=>y($)},[B(ze(Jn))],8,H8)])]),_:2},1032,["name","rules"])]))),128)),S("div",$8,[B(I,{label:null},{default:U(()=>[S("div",F8,[B(q,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),B(N,{onClick:v,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>O[21]||(O[21]=[Be("添加问题分类")])),_:1,__:[21]},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},U8=_t(z8,[["__scopeId","data-v-b7e48f9a"]]),V8={class:"judge-node-form"},W8={class:"gray-block-title"},G8=["onClick"],q8={class:"condition-list-box"},X8={class:"left-select-box"},Y8={class:"condition-body"},K8=["onClick"],J8={class:"btn-wrap"},Z8={class:"add-btn-block"},Q8={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})},nodeId:{type:String,default:""},lf:{type:Object,default:null}},setup(n){const e=n,t=Et("getNode"),r=Et("setData"),i=ke(),o=qt({term:[]}),a=ke([]);function l(){let T=t().getAllParentVariable(),H=e.lf.getNodeModelById(e.nodeId).properties.loop_parent_key,X=u(T);if(H){T=T.filter(q=>q.node_type!="25"),X=u(T);const V=e.lf.getNodeModelById(H);V&&(X=[...X,{label:V.properties.node_name,node_id:V.id,node_type:V.properties.node_type,typ:"node",value:V.id,children:d(V.properties.intermediate_params,V)}])}a.value=X}function u(T){return T.forEach(L=>{L.typ=="node"?L.node_type==1?L.value="global":L.value=L.node_id:L.value=L.key,L.children&&L.children.length>0&&(L.children=u(L.children))}),T}function d(T,L){let H=[];return T&&T.length&&T.forEach(X=>{X.key&&H.push({id:L.id,key:X.key,value:X.key,label:X.key,node_id:L.id,node_name:L.properties.node_name,node_type:L.properties.node_type,original_value:L.id+"."+X.key,text:X.key,typ:X.typ})}),H}const f=T=>{T||l()};let h=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const v=()=>{try{let T=JSON.parse(e.node.node_params).term||[];T=T.map(L=>{let H=L.terms.map(X=>{let V="";for(let q=0;q<h.length;q++)if(X.variable.indexOf(h[q])>-1){V=h[q];break}if(V!=""){let q=X.variable.split(".");X.variable=[q[0],V]}else X.variable=X.variable.split(".");return{...X,type:X.type>0?X.type:1,key:Math.random()*1e4}});return{...L,is_or:L.is_or?1:0,terms:H,key:Math.random()*1e4}}),o.term=T,y()}catch(T){}},y=()=>{let T=JSON.parse(JSON.stringify(o.term));T=T.map(L=>({is_or:L.is_or==1,next_node_key:L.next_node_key,terms:L.terms.map(H=>({variable:H.variable.join("."),is_mult:H.is_mult,type:H.type,value:H.value}))})),r({...e.node,term:T,node_params:JSON.stringify({term:T})})},x=T=>{o.term[T].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},w=(T,L)=>{o.term[T].terms.splice(L,1)},_=()=>{o.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},b=T=>{o.term.splice(T,1)},E=T=>{let L=N(T);T.is_mult=L.includes("array"),T.type=void 0};let k=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],O=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function N(T){let L="";if(T.variable&&T.variable.length>0){let H=a.value.filter(X=>X.key==T.variable[0]);H&&H.length&&(L=H[0].typ),L=="object"&&(H[0]&&H[0].children&&(H=H[0].subs.filter(X=>X.key==T.variable[1])),H&&H.length&&(L=H[0].typ),L=="object"&&(H[0]&&H[0].children&&(H=H[0].subs.filter(X=>X.key==T.variable[2])),H&&H.length&&(L=H[0].typ)))}return L}function I(T){if(!T.variable)return[];let L=N(T);return L==""?T.is_mult?O:k:L=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:L.includes("array")?O:k}return Jt(()=>o,()=>{y()},{deep:!0}),Yt(()=>{l(),v()}),(T,L)=>{const H=_a,X=Mr,V=Or,q=ya,D=dr,W=Bn,$=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:U(()=>L[2]||(L[2]=[S("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])),_:1},8,["title","iconName"])]),default:U(()=>[S("div",V8,[S("div",{class:"form-block",onMousedown:L[1]||(L[1]=nn(()=>{},["stop"]))},[B($,{ref_key:"formRef",ref:i,layout:"vertical",model:o},{default:U(()=>[B(ze(vN),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:o.term,"onUpdate:modelValue":L[0]||(L[0]=pe=>o.term=pe),"item-key":"key"},{item:U(({element:pe,index:De})=>[(G(),ae("div",{class:"gray-block",key:pe.key},[S("div",W8,[B(H,{gap:8},{default:U(()=>[B(ze(P1),{class:"icon drag-btn"}),Be(Ae(De==0?"if":"else if"),1)]),_:2},1024),o.term.length>1?(G(),ae("div",{key:0,class:"btn-hover-wrap",onClick:de=>b(De)},[B(ze(Jn))],8,G8)):qe("",!0)]),S("div",q8,[S("div",X8,[B(V,{size:"small",value:pe.is_or,"onUpdate:value":de=>pe.is_or=de,bordered:!1,style:{width:"64px"}},{default:U(()=>[B(X,{value:0},{default:U(()=>L[3]||(L[3]=[Be("and")])),_:1,__:[3]}),B(X,{value:1},{default:U(()=>L[4]||(L[4]=[Be("or")])),_:1,__:[4]})]),_:2},1032,["value","onUpdate:value"])]),S("div",Y8,[(G(!0),ae(rt,null,gt(pe.terms,(de,Se)=>(G(),ae("div",{class:"condition-item",key:de.key},[B(q,{value:de.variable,"onUpdate:value":me=>de.variable=me,onChange:me=>E(de),onDropdownVisibleChange:f,style:{width:"160px"},options:a.value,allowClear:!1,displayRender:({labels:me})=>me.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),B(V,{value:de.type,"onUpdate:value":me=>de.type=me,style:{width:"120px"},placeholder:"请选择"},{default:U(()=>[(G(!0),ae(rt,null,gt(I(de),me=>(G(),Ve(X,{value:me.value,key:me.value},{default:U(()=>[Be(Ae(me.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),de.type!=5&&de.type!=6?(G(),Ve(D,{key:0,placeholder:"请输入",value:de.value,"onUpdate:value":me=>de.value=me,style:{width:"150px"}},null,8,["value","onUpdate:value"])):qe("",!0),S("div",{class:"btn-hover-wrap",onClick:me=>w(De,Se)},[B(ze(Jn))],8,K8)]))),128))])]),S("div",J8,[B(W,{onClick:de=>x(De),icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>L[5]||(L[5]=[Be("添加条件")])),_:2,__:[5]},1032,["onClick","icon"])])]))]),_:1},8,["modelValue"]),S("div",Z8,[B(W,{onClick:_,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>L[6]||(L[6]=[Be("添加分支")])),_:1,__:[6]},8,["icon"])]),L[7]||(L[7]=S("div",{class:"gray-block mt8"},[S("div",{class:"gray-block-title"},"else"),S("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1,__:[7]},8,["model"])],32)])]),_:1})}}},e4=_t(Q8,[["__scopeId","data-v-dd140f55"]]),t4={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:nr,AtInput:er,FullscreenOutlined:Rv,FullAtInput:ix,NodeFormLayout:tr},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.update()}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const r=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=r.content,this.formState.content_tags=r.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){ks.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},n4={class:"specify-reply-form"},r4={class:"node-content"},i4={class:"form-item-label"},o4={class:"flex-between-box"},a4={class:"form-item-body"};function s4(n,e,t,r,i,o){const a=Sn("NodeFormHeader"),l=Sn("FullscreenOutlined"),u=Sn("at-input"),d=Sn("FullAtInput"),f=Sn("NodeFormLayout");return G(),Ve(f,null,{header:U(()=>[B(a,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:U(()=>[S("div",n4,[S("div",r4,[e[5]||(e[5]=S("div",{class:"form-label"},"输出",-1)),S("div",{class:"form-item",onMousedown:e[2]||(e[2]=nn(()=>{},["stop"]))},[S("div",i4,[S("div",o4,[e[4]||(e[4]=S("div",null,"消息内容",-1)),S("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...h)=>o.handleOpenFullAtModal&&o.handleOpenFullAtModal(...h))},[B(l)])])]),S("div",a4,[B(u,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:o.showAtList,onChange:e[1]||(e[1]=(h,v)=>o.changeValue(h,v))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),B(d,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:o.showAtList,onChange:e[3]||(e[3]=(h,v)=>o.changeValue(h,v)),onOk:o.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const l4=_t(t4,[["render",s4],["__scopeId","data-v-a5be1c4a"]]),u4=["src"],d4={class:"mcp-form"},c4={class:"node-options"},f4={class:"options-item-tit"},h4={class:"option-label"},p4={class:"option-type"},v4={class:"field-list-item"},g4={class:"field-label"},m4={class:"field-type"},y4={class:"desc"},_4={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=Et("getNode"),t=Et("setData"),r=n,i=qt({mcpInfo:{},toolInfo:{}}),o=qt({params:{}}),a=ke([]);let l={};function u(){d(),l=JSON.parse(r.node.node_params),v()}function d(){a.value=e().getAllParentVariable()}function f(y,x,w){y.value=x,y.tags=w,h()}function h(){let y={arguments:{},tag_map:{}};for(let x in o.params){let w=o.params[x].value,_=i.toolInfo.inputSchema.properties[x]||{};_.type=="string"?w=String(w):["number","integer"].includes(_.type)&&(w=Number(w)),y.arguments[x]=w,y.tag_map[x]=o.params[x].tags}l.mcp.arguments=y.arguments,l.mcp.tag_map=y.tag_map||[],t({...r.node,node_params:JSON.stringify(l)})}const v=()=>{V1({provider_id:l.mcp.provider_id}).then(y=>{var E;i.mcpInfo=(y==null?void 0:y.data)||{};let x=C1((E=i.mcpInfo)==null?void 0:E.tools,[]);i.toolInfo=x.find(k=>k.name==l.mcp.tool_name);let w=i.toolInfo.inputSchema||{},_=(w==null?void 0:w.properties)||{},b=(w==null?void 0:w.required)||[];_=JSON.parse(JSON.stringify(_));for(let k in _)_[k].value=String(l.mcp.arguments[k]||""),_[k].tags=l.mcp.tag_map?l.mcp.tag_map[k]:[],_[k].required=b.includes(k);o.params=_})};return Yt(()=>{u()}),(y,x)=>(G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name},{"node-icon":U(()=>[S("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,u4)]),desc:U(()=>[S("span",null,Ae(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:U(()=>[S("div",d4,[S("div",c4,[x[0]||(x[0]=S("div",{class:"options-title"},[S("div",null,[S("img",{src:Os,class:"title-icon"}),Be("输入")])],-1)),(G(!0),ae(rt,null,gt(o.params,(w,_)=>(G(),ae("div",{key:_,class:dn(["options-item",{"is-required":w.required}])},[S("div",f4,[S("div",h4,Ae(_),1),S("div",p4,Ae(w.type),1)]),S("div",null,[B(er,{type:"textarea",inputStyle:"height: 64px;",options:a.value,defaultSelectedList:w.tags,defaultValue:w.value,ref_for:!0,ref:"atInputRef",onOpen:d,onChange:(b,E)=>f(w,b,E),placeholder:"请输入内容，键入“/”可以插入变量"},{option:U(({label:b,payload:E})=>[S("div",v4,[S("div",g4,Ae(b),1),S("div",m4,Ae(E.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),S("div",y4,Ae(w.description),1)],2))),128))]),x[1]||(x[1]=S("div",{class:"node-options"},[S("div",{class:"options-title"},[S("div",null,[S("img",{src:Wv,class:"title-icon"}),Be("输出")])]),S("div",{class:"options-item"},[S("div",{class:"options-item-tit"},[S("div",{class:"option-label"},"输出")]),S("div",{class:"options-item-tit"},[S("div",{class:"option-label"},"text"),S("div",{class:"option-type"},"string")]),S("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},b4=_t(_4,[["__scopeId","data-v-4f6234c7"]]),x4="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%2331gmof37u__clip0_10933_119689)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M4.33325%2011.6719H2.33325V13.6719'/%3e%3cpath%20d='M13.6667%2013.6719H11.6667V11.6719'/%3e%3cpath%20d='M11.6667%204.32813H13.6667V2.32812'/%3e%3cpath%20d='M2.33325%202.32812H4.33325V4.32813'/%3e%3cpath%20d='M4.33325%202.42969C2.52585%203.62217%201.33325%205.67097%201.33325%207.99834C1.33325%208.3382%201.35869%208.67214%201.40775%208.99834'/%3e%3cpath%20d='M9.00005%2014.5974C8.67385%2014.6464%208.33991%2014.6719%208.00005%2014.6719C5.67268%2014.6719%203.62388%2013.4793%202.4314%2011.6719'/%3e%3cpath%20d='M14.5922%207C14.6413%207.3262%2014.6667%207.66013%2014.6667%208C14.6667%2010.3274%2013.4741%2012.3762%2011.6667%2013.5687'/%3e%3cpath%20d='M7%201.40262C7.3262%201.35356%207.66013%201.32812%208%201.32812C10.3274%201.32812%2012.3762%202.52072%2013.5687%204.32813'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='31gmof37u__clip0_10933_119689'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",w4="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_12353_121923)'%3e%3cpath%20d='M3.99992%201.33594H1.33325V4.0026H3.99992V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%2012H12V14.6667H14.6667V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M3.99992%2012H1.33325V14.6667H3.99992V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%201.33594H12V4.0026H14.6667V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M2.66675%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M13.3333%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%202.66406H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%2013.3359H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.33325%205.33594H8.53325V7.46927H10.6666V10.6693H7.46659V8.53594H5.33325V5.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_12353_121923'%3e%3crect%20width='16'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",S4="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2010.3307H12.6667V1.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.99992%207H3.33325V14.3333'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%203.66406L12.6667%201.66406L10.6667%203.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.33325%2012.3359L3.33325%2014.3359L1.33325%2012.3359'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",E4="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",C4={class:"problem-optimization-form"},k4={class:"node-form-content"},O4={class:"gray-block"},M4={class:"gray-block-title"},N4={class:"flex-form-item"},A4={key:0,class:"gray-block"},T4={class:"gray-block-title"},D4={class:"output-box"},L4={class:"array-form-box"},P4={class:"flex-block-item",style:{gap:"12px"}};const R4={class:"gray-block"},I4={class:"gray-block-title"},B4={class:"output-box"},j4={class:"array-form-box"},H4={class:"flex-block-item",style:{gap:"12px"}},$4={style:{width:"40%"}},F4={class:"field-list-item"},z4={class:"field-label"},U4={class:"field-type"},V4=["onClick"],W4={class:"gray-block"},G4={class:"gray-block-title"},q4={class:"output-box"},X4={class:"array-form-box"},Y4={class:"flex-block-item",style:{gap:"12px"}},K4=["onClick"],J4={__name:"custom-group-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,r=n,i=Et("getNode"),o=ke([]),a=ke([]);ke([]);const l=qt({}),u=(de,Se,me)=>{if(de){let ve=`at_input_${Se}_${me}`;l[ve]=de}},d=(de,Se,me)=>{me.tags=Se,me.value=de};function f(de){return de.forEach(Se=>{Se.typ=="node"?Se.node_type==1?Se.value="global":Se.value=Se.node_id:Se.value=Se.key,Se.children&&Se.children.length>0&&(Se.children=f(Se.children))}),de}const h=()=>{let de=i().getAllParentVariable();de.forEach(Se=>{Se.tags=Se.tags||[]}),de=de.filter(Se=>Se.group_node_key!=Se.loop_parent_key).filter(Se=>Se.node_id!=Se.group_node_key),o.value=de};function v(){let de=i().getAllParentVariable();de=f(de),a.value=y(de)}function y(de){let Se=[];return de.forEach(me=>{let ve=[];me.children&&me.children.length>0&&(ve=me.children.filter(Re=>Re.typ.toLowerCase().includes("array"))),ve.length>0&&Se.push({...me,children:ve})}),Se.filter(me=>me.group_node_key!=me.loop_parent_key).filter(me=>me.node_id!=me.group_node_key)}const x=de=>{de||v()},w=ke(),_={key:"",typ:"",value:"",cu_key:Math.random()*1e4},b={key:"",typ:"",value:"",cu_key:Math.random()*1e4},E={key:"",typ:"",value:"",cu_key:Math.random()*1e4},k=qt({loop_type:"array",loop_number:"",loop_arrays:[],intermediate_params:[],output:[]}),O=Gt(()=>{let de=k.intermediate_params,Se=[];return de.forEach(me=>{me.key&&Se.push({children:[],id:r.nodeId,key:me.key,label:me.key,node_id:r.nodeId,node_name:r.node.node_name,node_type:"25",original_value:r.nodeId+"."+me.key,text:me.key,typ:me.typ,value:me.key})}),Se.length>0?[{label:r.node.node_name,node_id:r.nodeId,node_type:"25",typ:"node",value:r.nodeId,children:Se}]:[]}),N=()=>{const de=JSON.stringify({loop:{...k,loop_arrays:k.loop_arrays.map(Se=>({...Se,value:Se.value?Se.value.join("."):""})),output:k.output.map(Se=>({...Se,value:Se.value?Se.value.join("."):""}))}});t("update-node",{...r.node,...k,node_params:de})};function I(de){if(de){let Se=de.split("."),me=Se[0],ve=Se.filter((Re,Ie)=>Ie>0).join(".");return[me,ve]}return[]}const T=()=>{try{let de=r.node.dataRaw||r.node.node_params||"{}",Se=JSON.parse(de).loop||{};Se=JSON.parse(JSON.stringify(Se)),h(),v(),k.loop_type=Se.loop_type,k.loop_number=Se.loop_number,k.loop_arrays=Se.loop_arrays.map(me=>({...me,value:I(me.value)})),k.intermediate_params=Se.intermediate_params.map(me=>({...me})),k.output=Se.output.map(me=>({...me,value:I(me.value)})),k.loop_arrays.length==0&&(k.loop_arrays=[_]),k.intermediate_params.length==0&&(k.intermediate_params=[b]),k.output.length==0&&(k.output=[E])}catch(de){}};Jt(()=>k,()=>{N()},{deep:!0});const L=()=>{k.loop_arrays.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},H=de=>{k.loop_arrays.splice(de,1)},X=(de,Se)=>{if(de&&de.length){let me=a.value.filter(ve=>ve.value==de[0])[0].children;me&&me.length&&(Se.typ=me.filter(ve=>ve.value==de[1])[0].typ)}else Se.typ=""},V=()=>{k.intermediate_params.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},q=de=>{k.intermediate_params.splice(de,1)},D=()=>{k.output.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},W=de=>{k.output.splice(de,1)},$=(de,Se)=>{if(de&&de.length){let me=O.value.filter(ve=>ve.value==de[0])[0].children;me&&me.length&&(Se.typ=me.filter(ve=>ve.value==de[1])[0].typ)}else Se.typ=""},pe=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],De=()=>{t("close")};return Yt(()=>{T()}),(de,Se)=>{const me=Kr,ve=Mr,Re=Or,Ie=Zr,ce=dr,ue=ya,K=lo,ie=ci,ne=Bn,fe=Jr;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于通过设定循环次数和逻辑，重复执行一系列任务",onClose:De},null,8,["title","iconName"])]),default:U(()=>[S("div",C4,[S("div",k4,[B(fe,{ref_key:"formRef",ref:w,layout:"vertical",model:k},{default:U(()=>[S("div",O4,[S("div",M4,[Se[3]||(Se[3]=S("img",{src:x4,alt:""},null,-1)),Se[4]||(Se[4]=Be(" 循环设置 ")),B(me,null,{title:U(()=>Se[2]||(Se[2]=[Be("如果引用数组，循环次数为数组的长度；如果指定次数，循环次数为指定的次数；")])),default:U(()=>[B(ze(An))]),_:1})]),S("div",N4,[Se[7]||(Se[7]=S("div",{class:"form-label"},"循环类型",-1)),B(Re,{value:k.loop_type,"onUpdate:value":Se[0]||(Se[0]=he=>k.loop_type=he),style:{width:"170px"}},{default:U(()=>[B(ve,{value:"array"},{default:U(()=>Se[5]||(Se[5]=[Be("使用数组循环")])),_:1,__:[5]}),B(ve,{value:"number"},{default:U(()=>Se[6]||(Se[6]=[Be("指定循环次数")])),_:1,__:[6]})]),_:1},8,["value"]),k.loop_type=="number"?(G(),Ve(Ie,{key:0,placeholder:"请输入",style:{flex:"1"},value:k.loop_number,"onUpdate:value":Se[1]||(Se[1]=he=>k.loop_number=he),min:1,max:100},null,8,["value"])):qe("",!0)])]),k.loop_type=="array"?(G(),ae("div",A4,[S("div",T4,[Se[9]||(Se[9]=S("img",{src:w4,alt:""},null,-1)),Se[10]||(Se[10]=Be(" 循环数组 ")),B(me,null,{title:U(()=>Se[8]||(Se[8]=[Be("仅支持引用数组，循环次数为数组的长度")])),default:U(()=>[B(ze(An))]),_:1})]),S("div",D4,[Se[12]||(Se[12]=S("div",{class:"output-block"},[S("div",{class:"output-item"},"参数Key"),S("div",{class:"output-item"},"类型"),S("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),S("div",L4,[(G(!0),ae(rt,null,gt(k.loop_arrays,(he,be)=>(G(),ae("div",{class:"form-item-list",key:he.cu_key},[B(ie,{label:null},{default:U(()=>[S("div",P4,[B(ce,{style:{width:"25%"},value:he.key,"onUpdate:value":xe=>he.key=xe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(K,null,{default:U(()=>[B(ce,{style:{width:"25%"},value:he.typ,"onUpdate:value":xe=>he.typ=xe,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),B(ue,{onChange:xe=>X(xe,he),value:he.value,"onUpdate:value":xe=>he.value=xe,onDropdownVisibleChange:x,style:{width:"50%"},options:a.value,allowClear:!1,displayRender:({labels:xe})=>xe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),qe("",!0)])]),_:2},1024)]))),128)),k.loop_arrays.length==0?(G(),Ve(ne,{key:0,onClick:L,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>Se[11]||(Se[11]=[Be("添加参数")])),_:1,__:[11]},8,["icon"])):qe("",!0)])])])):qe("",!0),S("div",R4,[S("div",I4,[Se[14]||(Se[14]=S("img",{src:S4,alt:""},null,-1)),Se[15]||(Se[15]=Be(" 中间变量 ")),B(me,null,{title:U(()=>Se[13]||(Se[13]=[Be("变量可在多次循环中实现共享，可用于在多次循环中传递变量")])),default:U(()=>[B(ze(An))]),_:1})]),S("div",B4,[Se[17]||(Se[17]=S("div",{class:"output-block"},[S("div",{class:"output-item"},"参数Key"),S("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),S("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),S("div",j4,[(G(!0),ae(rt,null,gt(k.intermediate_params,(he,be)=>(G(),ae("div",{class:"form-item-list",key:he.cu_key},[B(ie,{label:null},{default:U(()=>[S("div",H4,[B(ce,{style:{width:"25%"},value:he.key,"onUpdate:value":xe=>he.key=xe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(K,null,{default:U(()=>[B(Re,{value:he.typ,"onUpdate:value":xe=>he.typ=xe,placeholder:"请选择",style:{width:"25%"}},{default:U(()=>[(G(),ae(rt,null,gt(pe,xe=>B(ve,{value:xe.value,key:xe.value},{default:U(()=>[Be(Ae(xe.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value"]),S("div",$4,[B(er,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:xe=>u(xe,"intermediate_params",be),options:o.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:h,onChange:(xe,Ze)=>d(xe,Ze,he,be),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:xe,payload:Ze})=>[S("div",F4,[S("div",z4,Ae(xe),1),S("div",U4,Ae(Ze.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])])]),_:2},1024),S("div",{class:"btn-hover-wrap",onClick:xe=>q(be)},[B(ze(Jn))],8,V4)])]),_:2},1024)]))),128)),B(ne,{onClick:V,icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>Se[16]||(Se[16]=[Be("添加参数")])),_:1,__:[16]},8,["icon"])])])]),S("div",W4,[S("div",G4,[Se[19]||(Se[19]=S("img",{src:E4,alt:""},null,-1)),Se[20]||(Se[20]=Be(" 输出 ")),B(me,null,{title:U(()=>Se[18]||(Se[18]=[Be("循环完成后输出的内容，仅支持引用循环体中节点的输出变量")])),default:U(()=>[B(ze(An))]),_:1})]),S("div",q4,[Se[22]||(Se[22]=S("div",{class:"output-block"},[S("div",{class:"output-item"},"参数Key"),S("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),S("div",{class:"output-item",style:{width:"38%"}},"参数值")],-1)),S("div",X4,[(G(!0),ae(rt,null,gt(k.output,(he,be)=>(G(),ae("div",{class:"form-item-list",key:he.cu_key},[B(ie,{label:null},{default:U(()=>[S("div",Y4,[B(ce,{style:{width:"25%"},value:he.key,"onUpdate:value":xe=>he.key=xe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(K,null,{default:U(()=>[B(ce,{style:{width:"25%"},value:he.typ,"onUpdate:value":xe=>he.typ=xe,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),B(ue,{onChange:xe=>$(xe,he),value:he.value,"onUpdate:value":xe=>he.value=xe,onDropdownVisibleChange:x,style:{width:"40%"},options:O.value,allowClear:!1,displayRender:({labels:xe})=>xe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),S("div",{class:"btn-hover-wrap",onClick:xe=>W(be)},[B(ze(Jn))],8,K4)])]),_:2},1024)]))),128)),B(ne,{onClick:nn(D,["stop"]),icon:pn(ze(Nn)),block:"",type:"dashed"},{default:U(()=>Se[21]||(Se[21]=[Be("添加参数")])),_:1,__:[21]},8,["icon"])])])])]),_:1},8,["model"])])])]),_:1})}}},Z4=_t(J4,[["__scopeId","data-v-4f430887"]]),Q4=["src"],eB={class:"mcp-form"},tB={class:"node-options"},nB={class:"options-item-tit"},rB={class:"option-label"},iB={class:"option-type"},oB={class:"field-list-item"},aB={class:"field-label"},sB={class:"field-type"},lB={class:"desc"},uB={__name:"zm-plugins-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=Et("getNode"),t=Et("setData"),r=n,i=qt({}),o=ke({}),a=ke([]);let l={};function u(){h(),l=JSON.parse(r.node.node_params),f(),d()}function d(){var x;G1({name:(x=l==null?void 0:l.plugin)==null?void 0:x.name}).then(w=>{let _=(w==null?void 0:w.data)||{};o.value=_.remote})}function f(){var x;W1({name:((x=l==null?void 0:l.plugin)==null?void 0:x.name)||"",action:"default/get-schema",params:{}}).then(w=>{var _;Object.assign(i,(w==null?void 0:w.data)||{});for(let b in i)i[b].value=String((l==null?void 0:l.plugin.params[b])||""),i[b].tags=l.tag_map?(_=l==null?void 0:l.plugin)==null?void 0:_.tag_map[b]:[]})}function h(){a.value=e().getAllParentVariable()}function v(x,w,_){x.value=w,x.tags=_,y()}function y(){let x={params:{},tag_map:{}};for(let w in i){let _=i[w].value;i[w].type=="string"?_=String(_):["number","integer"].includes(i[w].type)&&(_=Number(_)),x.params[w]=_,x.tag_map[w]=i[w].tags}l.plugin.params=x.params,l.plugin.tag_map=x.tag_map,t({...r.node,node_params:JSON.stringify(l)})}return Yt(()=>{u()}),(x,w)=>{const _=Ec;return G(),Ve(tr,null,{header:U(()=>[B(nr,{title:n.node.node_name,desc:o.value.description},{"node-icon":U(()=>[o.value.icon?(G(),ae("img",{key:0,class:"node-icon",src:o.value.icon},null,8,Q4)):(G(),Ve(_,{key:1,size:"small"}))]),_:1},8,["title","desc"])]),default:U(()=>[S("div",eB,[S("div",tB,[w[0]||(w[0]=S("div",{class:"options-title"},[S("div",null,[S("img",{src:Os,class:"title-icon"}),Be("输入")])],-1)),(G(!0),ae(rt,null,gt(i,(b,E)=>(G(),ae("div",{key:E,class:dn(["options-item",{"is-required":b.required}])},[S("div",nB,[S("div",rB,Ae(E),1),S("div",iB,Ae(b.type),1)]),S("div",null,[B(er,{type:"textarea",inputStyle:"height: 64px;",options:a.value,defaultSelectedList:b.tags,defaultValue:b.value,ref_for:!0,ref:"atInputRef",onOpen:h,onChange:(k,O)=>v(b,k,O),placeholder:"请输入内容，键入“/”可以插入变量"},{option:U(({label:k,payload:O})=>[S("div",oB,[S("div",aB,Ae(k),1),S("div",sB,Ae(O.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),S("div",lB,Ae(b.description),1)],2))),128))])])]),_:1})}}},dB=_t(uB,[["__scopeId","data-v-deca9c48"]]),cB=["width"],fB={class:"node-form-drawer-body"},hB=["node-key"],pB={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(n,{expose:e,emit:t}){const r={"start-node":qT,"problem-optimization-node":ND,"ai-dialogue-node":eL,"add-data-node":IL,"knowledge-base-node":TP,"code-run-node":L3,"http-node":wR,"delete-data-node":FR,"variable-assignment-node":QR,"update-data-node":aI,"parameter-extraction-node":FI,"select-data-node":w8,"question-node":U8,"judge-node":e4,"specify-reply-node":l4,"mcp-node":b4,"custom-group":Z4,"zm-plugins-node":dB},i=t,o=n,a=Gt({get:()=>o.open,set:E=>i("update:open",E)}),l=()=>{a.value=!1},u=Gt(()=>({"delete-data-node":600,"update-data-node":600,"select-data-node":600,"judge-node":600,"custom-group":568})[o.nodeType]||480),d=()=>o.lf.getNodeModelById(o.nodeId),f=()=>o.lf.graphModel,h=E=>{_(E)},v=E=>{i("change-title",E)},y=()=>{a.value=!1;let E=d();f().eventCenter.emit("custom:node:delete",E)};Jo("lf",o.lf),Jo("getNode",d),Jo("getGraph",f),Jo("setData",h),Jo("changeTitle",v),Jo("deleteNode",y),Jo("close",l);const x=Gt(()=>{const E=`${o.nodeType}`;return r[E]||null}),w=ke(null),_=E=>{clearTimeout(w.value),w.value=setTimeout(()=>{E.dataRaw=E.node_params,i("update-node",E)},300)},b=()=>{a.value=!1};return e({open}),(E,k)=>{const O=Bn,N=$2;return G(),Ve(N2,{name:"slide-right",appear:""},{default:U(()=>[a.value?(G(),ae("div",{key:0,width:u.value,style:Ti({width:u.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:M2(b,["esc"])},[S("div",fB,[S("div",{class:"drawer-form","node-key":o.nodeType},[x.value?(G(),Ve(M1(x.value),{lf:o.lf,"node-id":o.nodeId,"node-type":o.nodeType,node:o.node,key:o.nodeId,onClose:b,onUpdateNode:_},null,40,["lf","node-id","node-type","node"])):(G(),Ve(N,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:U(()=>[B(O,{type:"primary",onClick:b},{default:U(()=>k[0]||(k[0]=[Be("关闭")])),_:1,__:[0]})]),_:1}))],8,hB)])],44,cB)):qe("",!0)]),_:1})}}},vB=_t(pB,[["__scopeId","data-v-2e27c805"]]);var Nc,Xt,cx,ta,jy,fx,hx,px,Kv,Bp,jp,Pl={},vx=[],gB=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,nu=Array.isArray;function ao(n,e){for(var t in e)n[t]=e[t];return n}function Jv(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function mt(n,e,t){var r,i,o,a={};for(o in e)o=="key"?r=e[o]:o=="ref"?i=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?Nc.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(o in n.defaultProps)a[o]===void 0&&(a[o]=n.defaultProps[o]);return hd(n,a,r,i,null)}function hd(n,e,t,r,i){var o={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++cx,__i:-1,__u:0};return i==null&&Xt.vnode!=null&&Xt.vnode(o),o}function Ac(){return{current:null}}function ds(n){return n.children}function Zt(n,e){this.props=n,this.context=e}function cs(n,e){if(e==null)return n.__?cs(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?cs(n):null}function gx(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return gx(n)}}function Hy(n){(!n.__d&&(n.__d=!0)&&ta.push(n)&&!xd.__r++||jy!=Xt.debounceRendering)&&((jy=Xt.debounceRendering)||fx)(xd)}function xd(){for(var n,e,t,r,i,o,a,l=1;ta.length;)ta.length>l&&ta.sort(hx),n=ta.shift(),l=ta.length,n.__d&&(t=void 0,r=void 0,i=(r=(e=n).__v).__e,o=[],a=[],e.__P&&((t=ao({},r)).__v=r.__v+1,Xt.vnode&&Xt.vnode(t),Zv(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,o,i??cs(r),!!(32&r.__u),a),t.__v=r.__v,t.__.__k[t.__i]=t,_x(o,t,a),r.__e=r.__=null,t.__e!=i&&gx(t)));xd.__r=0}function mx(n,e,t,r,i,o,a,l,u,d,f){var h,v,y,x,w,_,b,E=r&&r.__k||vx,k=e.length;for(u=mB(t,e,E,u,k),h=0;h<k;h++)(y=t.__k[h])!=null&&(v=y.__i==-1?Pl:E[y.__i]||Pl,y.__i=h,_=Zv(n,y,v,i,o,a,l,u,d,f),x=y.__e,y.ref&&v.ref!=y.ref&&(v.ref&&Qv(v.ref,null,y),f.push(y.ref,y.__c||x,y)),w==null&&x!=null&&(w=x),(b=!!(4&y.__u))||v.__k===y.__k?u=yx(y,u,n,b):typeof y.type=="function"&&_!==void 0?u=_:x&&(u=x.nextSibling),y.__u&=-7);return t.__e=w,u}function mB(n,e,t,r,i){var o,a,l,u,d,f=t.length,h=f,v=0;for(n.__k=new Array(i),o=0;o<i;o++)(a=e[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(u=o+v,(a=n.__k[o]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?hd(null,a,null,null,null):nu(a)?hd(ds,{children:a},null,null,null):a.constructor==null&&a.__b>0?hd(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=n,a.__b=n.__b+1,l=null,(d=a.__i=yB(a,t,u,h))!=-1&&(h--,(l=t[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(i>f?v--:i<f&&v++),typeof a.type!="function"&&(a.__u|=4)):d!=u&&(d==u-1?v--:d==u+1?v++:(d>u?v--:v++,a.__u|=4))):n.__k[o]=null;if(h)for(o=0;o<f;o++)(l=t[o])!=null&&(2&l.__u)==0&&(l.__e==r&&(r=cs(l)),xx(l,l));return r}function yx(n,e,t,r){var i,o;if(typeof n.type=="function"){for(i=n.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=n,e=yx(i[o],e,t,r));return e}n.__e!=e&&(r&&(e&&n.type&&!e.parentNode&&(e=cs(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function wd(n,e){return e=e||[],n==null||typeof n=="boolean"||(nu(n)?n.some(function(t){wd(t,e)}):e.push(n)),e}function yB(n,e,t,r){var i,o,a,l=n.key,u=n.type,d=e[t],f=d!=null&&(2&d.__u)==0;if(d===null&&n.key==null||f&&l==d.key&&u==d.type)return t;if(r>(f?1:0)){for(i=t-1,o=t+1;i>=0||o<e.length;)if((d=e[a=i>=0?i--:o++])!=null&&(2&d.__u)==0&&l==d.key&&u==d.type)return a}return-1}function $y(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||gB.test(e)?t:t+"px"}function Fu(n,e,t,r,i){var o,a;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||$y(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||$y(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(px,"$1")),a=e.toLowerCase(),e=a in n||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+o]=t,t?r?t.u=r.u:(t.u=Kv,n.addEventListener(e,o?jp:Bp,o)):n.removeEventListener(e,o?jp:Bp,o);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Fy(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Kv++;else if(e.t<t.u)return;return t(Xt.event?Xt.event(e):e)}}}function Zv(n,e,t,r,i,o,a,l,u,d){var f,h,v,y,x,w,_,b,E,k,O,N,I,T,L,H,X,V=e.type;if(e.constructor!=null)return null;128&t.__u&&(u=!!(32&t.__u),o=[l=e.__e=t.__e]),(f=Xt.__b)&&f(e);e:if(typeof V=="function")try{if(b=e.props,E="prototype"in V&&V.prototype.render,k=(f=V.contextType)&&r[f.__c],O=f?k?k.props.value:f.__:r,t.__c?_=(h=e.__c=t.__c).__=h.__E:(E?e.__c=h=new V(b,O):(e.__c=h=new Zt(b,O),h.constructor=V,h.render=bB),k&&k.sub(h),h.props=b,h.state||(h.state={}),h.context=O,h.__n=r,v=h.__d=!0,h.__h=[],h._sb=[]),E&&h.__s==null&&(h.__s=h.state),E&&V.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=ao({},h.__s)),ao(h.__s,V.getDerivedStateFromProps(b,h.__s))),y=h.props,x=h.state,h.__v=e,v)E&&V.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),E&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(E&&V.getDerivedStateFromProps==null&&b!==y&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(b,O),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(b,h.__s,O)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(q){q&&(q.__=e)}),N=0;N<h._sb.length;N++)h.__h.push(h._sb[N]);h._sb=[],h.__h.length&&a.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(b,h.__s,O),E&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(y,x,w)})}if(h.context=O,h.props=b,h.__P=n,h.__e=!1,I=Xt.__r,T=0,E){for(h.state=h.__s,h.__d=!1,I&&I(e),f=h.render(h.props,h.state,h.context),L=0;L<h._sb.length;L++)h.__h.push(h._sb[L]);h._sb=[]}else do h.__d=!1,I&&I(e),f=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++T<25);h.state=h.__s,h.getChildContext!=null&&(r=ao(ao({},r),h.getChildContext())),E&&!v&&h.getSnapshotBeforeUpdate!=null&&(w=h.getSnapshotBeforeUpdate(y,x)),H=f,f!=null&&f.type===ds&&f.key==null&&(H=bx(f.props.children)),l=mx(n,nu(H)?H:[H],e,t,r,i,o,a,l,u,d),h.base=e.__e,e.__u&=-161,h.__h.length&&a.push(h),_&&(h.__E=h.__=null)}catch(q){if(e.__v=null,u||o!=null)if(q.then){for(e.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,e.__e=l}else{for(X=o.length;X--;)Jv(o[X]);Hp(e)}else e.__e=t.__e,e.__k=t.__k,q.then||Hp(e);Xt.__e(q,e,t)}else o==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):l=e.__e=_B(t.__e,e,t,r,i,o,a,u,d);return(f=Xt.diffed)&&f(e),128&e.__u?void 0:l}function Hp(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Hp)}function _x(n,e,t){for(var r=0;r<t.length;r++)Qv(t[r],t[++r],t[++r]);Xt.__c&&Xt.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(o){o.call(i)})}catch(o){Xt.__e(o,i.__v)}})}function bx(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:nu(n)?n.map(bx):ao({},n)}function _B(n,e,t,r,i,o,a,l,u){var d,f,h,v,y,x,w,_=t.props,b=e.props,E=e.type;if(E=="svg"?i="http://www.w3.org/2000/svg":E=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),o!=null){for(d=0;d<o.length;d++)if((y=o[d])&&"setAttribute"in y==!!E&&(E?y.localName==E:y.nodeType==3)){n=y,o[d]=null;break}}if(n==null){if(E==null)return document.createTextNode(b);n=document.createElementNS(i,E,b.is&&b),l&&(Xt.__m&&Xt.__m(e,o),l=!1),o=null}if(E==null)_===b||l&&n.data==b||(n.data=b);else{if(o=o&&Nc.call(n.childNodes),_=t.props||Pl,!l&&o!=null)for(_={},d=0;d<n.attributes.length;d++)_[(y=n.attributes[d]).name]=y.value;for(d in _)if(y=_[d],d!="children"){if(d=="dangerouslySetInnerHTML")h=y;else if(!(d in b)){if(d=="value"&&"defaultValue"in b||d=="checked"&&"defaultChecked"in b)continue;Fu(n,d,null,y,i)}}for(d in b)y=b[d],d=="children"?v=y:d=="dangerouslySetInnerHTML"?f=y:d=="value"?x=y:d=="checked"?w=y:l&&typeof y!="function"||_[d]===y||Fu(n,d,y,_[d],i);if(f)l||h&&(f.__html==h.__html||f.__html==n.innerHTML)||(n.innerHTML=f.__html),e.__k=[];else if(h&&(n.innerHTML=""),mx(e.type=="template"?n.content:n,nu(v)?v:[v],e,t,r,E=="foreignObject"?"http://www.w3.org/1999/xhtml":i,o,a,o?o[0]:t.__k&&cs(t,0),l,u),o!=null)for(d=o.length;d--;)Jv(o[d]);l||(d="value",E=="progress"&&x==null?n.removeAttribute("value"):x!=null&&(x!==n[d]||E=="progress"&&!x||E=="option"&&x!=_[d])&&Fu(n,d,x,_[d],i),d="checked",w!=null&&w!=n[d]&&Fu(n,d,w,_[d],i))}return n}function Qv(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(i){Xt.__e(i,t)}}function xx(n,e,t){var r,i;if(Xt.unmount&&Xt.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||Qv(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){Xt.__e(o,e)}r.base=r.__P=null}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&xx(r[i],e,t||typeof n.type!="function");t||Jv(n.__e),n.__c=n.__=n.__e=void 0}function bB(n,e,t){return this.constructor(n,t)}function xB(n,e,t){var r,i,o,a;e==document&&(e=document.documentElement),Xt.__&&Xt.__(n,e),i=(r=!1)?null:e.__k,o=[],a=[],Zv(e,n=e.__k=mt(ds,null,[n]),i||Pl,Pl,e.namespaceURI,i?null:e.firstChild?Nc.call(e.childNodes):null,o,i?i.__e:e.firstChild,r,a),_x(o,n,a)}Nc=vx.slice,Xt={__e:function(n,e,t,r){for(var i,o,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(n)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),a=i.__d),a)return i.__E=i}catch(l){n=l}throw n}},cx=0,Zt.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ao({},this.state),typeof n=="function"&&(n=n(ao({},t),this.props)),n&&ao(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Hy(this))},Zt.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Hy(this))},Zt.prototype.render=ds,ta=[],fx=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,hx=function(n,e){return n.__v.__b-e.__v.__b},xd.__r=0,px=/(PointerCapture)$|Capture$/i,Kv=0,Bp=Fy(!1),jp=Fy(!0);var wB="An invariant failed, however the error is obfuscated because this is a production build.",Sd=[];Object.freeze(Sd);var eg={};Object.freeze(eg);function Hr(){return++Mt.mobxGuid}function sn(n){throw sa(!1,n),"X"}function sa(n,e){if(!n)throw new Error("[mobx] "+(e||wB))}function wx(n){var e=!1;return function(){if(!e)return e=!0,n.apply(this,arguments)}}var zu=function(){};function SB(n){var e=[];return n.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function tg(n){return n!==null&&typeof n=="object"}function Ms(n){if(n===null||typeof n!="object")return!1;var e=Object.getPrototypeOf(n);return e===Object.prototype||e===null}function EB(n){if(As(n)||zr(n))return n;if(Array.isArray(n))return new Map(n);if(Ms(n)){var e=new Map;for(var t in n)e.set(t,n[t]);return e}else return sn("Cannot convert to map from '"+n+"'")}function Ns(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function CB(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function kB(n,e){var t=Object.getOwnPropertyDescriptor(n,e);return!t||t.configurable!==!1&&t.writable!==!1}function Io(n,e){var t="isMobX"+n;return e.prototype[t]=!0,function(r){return tg(r)&&r[t]===!0}}function As(n){return n instanceof Map}function ru(n){return n instanceof Set}function Sx(n){var e=new Set;for(var t in n)e.add(t);return Object.getOwnPropertySymbols(n).forEach(function(r){Object.getOwnPropertyDescriptor(n,r).enumerable&&e.add(r)}),Array.from(e)}function ko(n){return n&&n.toString?n.toString():new String(n).toString()}function Ex(n){return n===null?null:typeof n=="object"?""+n:n}var OB=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,$t=Symbol("mobx administration"),Ts=function(){function n(e){e===void 0&&(e="Atom@"+Hr()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=un.NOT_TRACKING}return n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.reportObserved=function(){return Rx(this)},n.prototype.reportChanged=function(){Oi(),YB(this),Mi()},n.prototype.toString=function(){return this.name},n}(),ng=Io("Atom",Ts);function rg(n,e,t){e===void 0&&(e=zu),t===void 0&&(t=zu);var r=new Ts(n);return e!==zu&&l6(r,e),t!==zu&&Fx(r,t),r}function MB(n,e){return Jx(n,e)}function NB(n,e){return Object.is(n,e)}var fs={structural:MB,default:NB};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var $p=function(n,e){return $p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},$p(n,e)};function AB(n,e){$p(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ed=function(){return Ed=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Ed.apply(this,arguments)};function Wi(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],t=0;return e?e.call(n):{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}function es(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o}function ig(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(es(arguments[e]));return n}var Cd=Symbol("mobx did run lazy initializers"),fl=Symbol("mobx pending decorators"),TB={},DB={};function LB(n,e){var t=e?TB:DB;return t[n]||(t[n]={configurable:!0,enumerable:e,get:function(){return ca(this),this[n]},set:function(r){ca(this),this[n]=r}})}function ca(n){var e,t;if(n[Cd]!==!0){var r=n[fl];if(r){Ns(n,Cd,!0);var i=ig(Object.getOwnPropertySymbols(r),Object.keys(r));try{for(var o=Wi(i),a=o.next();!a.done;a=o.next()){var l=a.value,u=r[l];u.propertyCreator(n,u.prop,u.descriptor,u.decoratorTarget,u.decoratorArguments)}}catch(d){e={error:d}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}}}function Cx(n,e){return function(){var r,i=function(a,l,u,d){if(d===!0)return e(a,l,u,a,r),null;if(!Object.prototype.hasOwnProperty.call(a,fl)){var f=a[fl];Ns(a,fl,Ed({},f))}return a[fl][l]={prop:l,propertyCreator:e,descriptor:u,decoratorTarget:a,decoratorArguments:r},LB(l,n)};return PB(arguments)?(r=Sd,i.apply(null,arguments)):(r=Array.prototype.slice.call(arguments),i)}}function PB(n){return(n.length===2||n.length===3)&&(typeof n[1]=="string"||typeof n[1]=="symbol")||n.length===4&&n[3]===!0}function iu(n,e,t){return gs(n)?n:Array.isArray(n)?$e.array(n,{name:t}):Ms(n)?$e.object(n,void 0,{name:t}):As(n)?$e.map(n,{name:t}):ru(n)?$e.set(n,{name:t}):n}function RB(n,e,t){return n==null||Ri(n)||Ji(n)||zr(n)||di(n)?n:Array.isArray(n)?$e.array(n,{name:t,deep:!1}):Ms(n)?$e.object(n,void 0,{name:t,deep:!1}):As(n)?$e.map(n,{name:t,deep:!1}):ru(n)?$e.set(n,{name:t,deep:!1}):sn(!1)}function Tc(n){return n}function IB(n,e,t){return Jx(n,e)?e:n}function Dc(n){sa(n);var e=Cx(!0,function(r,i,o,a,l){var u=o?o.initializer?o.initializer.call(r):o.value:void 0;ug(r).addObservableProp(i,u,n)}),t=e;return t.enhancer=n,t}var kx={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(kx);function Ja(n){return n==null?kx:typeof n=="string"?{name:n,deep:!0,proxy:!0}:n}var og=Dc(iu),BB=Dc(RB),Ox=Dc(Tc),jB=Dc(IB);function Uu(n){return n.defaultDecorator?n.defaultDecorator.enhancer:n.deep===!1?Tc:iu}function HB(n,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return og.apply(null,arguments);if(gs(n))return n;var r=Ms(n)?$e.object(n,e,t):Array.isArray(n)?$e.array(n,e):As(n)?$e.map(n,e):ru(n)?$e.set(n,e):n;if(r!==n)return r;sn(!1)}var zy={box:function(n,e){arguments.length>2&&ll("box");var t=Ja(e);return new ua(n,Uu(t),t.name,!0,t.equals)},array:function(n,e){arguments.length>2&&ll("array");var t=Ja(e);return S6(n,Uu(t),t.name)},map:function(n,e){arguments.length>2&&ll("map");var t=Ja(e);return new lg(n,Uu(t),t.name)},set:function(n,e){arguments.length>2&&ll("set");var t=Ja(e);return new Yx(n,Uu(t),t.name)},object:function(n,e,t){typeof arguments[1]=="string"&&ll("object");var r=Ja(t);if(r.proxy===!1)return Gp({},n,e,r);var i=Ux(r),o=Gp({},void 0,void 0,r),a=b6(o);return Vx(a,n,e,i),a},ref:Ox,shallow:BB,deep:og,struct:jB},$e=HB;Object.keys(zy).forEach(function(n){return $e[n]=zy[n]});function ll(n){sn("Expected one or two arguments to observable."+n+". Did you accidentally try to use observable."+n+" as decorator?")}var kd=Cx(!1,function(n,e,t,r,i){var o=t.get,a=t.set,l=i[0]||{};ug(n).addComputedProp(n,e,Ed({get:o,set:a,context:n},l))}),$B=kd({equals:fs.structural}),hn=function(e,t,r){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return kd.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new ps(i)};hn.struct=$B;var un;(function(n){n[n.NOT_TRACKING=-1]="NOT_TRACKING",n[n.UP_TO_DATE=0]="UP_TO_DATE",n[n.POSSIBLY_STALE=1]="POSSIBLY_STALE",n[n.STALE=2]="STALE"})(un||(un={}));var Gi;(function(n){n[n.NONE=0]="NONE",n[n.LOG=1]="LOG",n[n.BREAK=2]="BREAK"})(Gi||(Gi={}));var Od=function(){function n(e){this.cause=e}return n}();function hl(n){return n instanceof Od}function Fp(n){switch(n.dependenciesState){case un.UP_TO_DATE:return!1;case un.NOT_TRACKING:case un.STALE:return!0;case un.POSSIBLY_STALE:{for(var e=ag(!0),t=Ds(),r=n.observing,i=r.length,o=0;o<i;o++){var a=r[o];if(vs(a)){if(Mt.disableErrorBoundaries)a.get();else try{a.get()}catch{return No(t),ml(e),!0}if(n.dependenciesState===un.STALE)return No(t),ml(e),!0}}return Ax(n),No(t),ml(e),!1}}}function hs(n){var e=n.observers.size>0;Mt.computationDepth>0&&e&&sn(!1),!Mt.allowStateChanges&&(e||Mt.enforceActions==="strict")&&sn(!1)}function Mx(n,e,t){var r=ag(!0);Ax(n),n.newObserving=new Array(n.observing.length+100),n.unboundDepsCount=0,n.runId=++Mt.runId;var i=Mt.trackingDerivation;Mt.trackingDerivation=n;var o;if(Mt.disableErrorBoundaries===!0)o=e.call(t);else try{o=e.call(t)}catch(a){o=new Od(a)}return Mt.trackingDerivation=i,FB(n),ml(r),o}function FB(n){for(var e=n.observing,t=n.observing=n.newObserving,r=un.UP_TO_DATE,i=0,o=n.unboundDepsCount,a=0;a<o;a++){var l=t[a];l.diffValue===0&&(l.diffValue=1,i!==a&&(t[i]=l),i++),l.dependenciesState>r&&(r=l.dependenciesState)}for(t.length=i,n.newObserving=null,o=e.length;o--;){var l=e[o];l.diffValue===0&&Lx(l,n),l.diffValue=0}for(;i--;){var l=t[i];l.diffValue===1&&(l.diffValue=0,XB(l,n))}r!==un.UP_TO_DATE&&(n.dependenciesState=r,n.onBecomeStale())}function zp(n){var e=n.observing;n.observing=[];for(var t=e.length;t--;)Lx(e[t],n);n.dependenciesState=un.NOT_TRACKING}function Nx(n){var e=Ds();try{return n()}finally{No(e)}}function Ds(){var n=Mt.trackingDerivation;return Mt.trackingDerivation=null,n}function No(n){Mt.trackingDerivation=n}function ag(n){var e=Mt.allowStateReads;return Mt.allowStateReads=n,e}function ml(n){Mt.allowStateReads=n}function Ax(n){if(n.dependenciesState!==un.UP_TO_DATE){n.dependenciesState=un.UP_TO_DATE;for(var e=n.observing,t=e.length;t--;)e[t].lowestObserverState=un.UP_TO_DATE}}var Md=0,zB=1,Uy=Object.getOwnPropertyDescriptor(function(){},"name");Uy&&Uy.configurable;function la(n,e,t){var r=function(){return Tx(n,e,t||this,arguments)};return r.isMobxAction=!0,r}function Tx(n,e,t,r){var i=UB();try{return e.apply(t,r)}catch(o){throw i.error=o,o}finally{VB(i)}}function UB(n,e,t){var r=li(),i=0,o=Ds();Oi();var a=Lc(!0),l=ag(!0),u={prevDerivation:o,prevAllowStateChanges:a,prevAllowStateReads:l,notifySpy:r,startTime:i,actionId:zB++,parentActionId:Md};return Md=u.actionId,u}function VB(n){Md!==n.actionId&&sn("invalid action stack. did you forget to finish an action?"),Md=n.parentActionId,n.error!==void 0&&(Mt.suppressReactionErrors=!0),Pc(n.prevAllowStateChanges),ml(n.prevAllowStateReads),Mi(),No(n.prevDerivation),n.notifySpy,Mt.suppressReactionErrors=!1}function Lc(n){var e=Mt.allowStateChanges;return Mt.allowStateChanges=n,e}function Pc(n){Mt.allowStateChanges=n}var ua=function(n){AB(e,n);function e(t,r,i,o,a){i===void 0&&(i="ObservableValue@"+Hr()),a===void 0&&(a=fs.default);var l=n.call(this,i)||this;return l.enhancer=r,l.name=i,l.equals=a,l.hasUnreportedChange=!1,l.value=r(t,void 0,i),l}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==Mt.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(hs(this),qi(this)){var r=Xi(this,{object:this,type:"update",newValue:t});if(!r)return Mt.UNCHANGED;t=r.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?Mt.UNCHANGED:t},e.prototype.setNewValue=function(t){var r=this.value;this.value=t,this.reportChanged(),Ni(this)&&Ai(this,{type:"update",object:this,newValue:t,oldValue:r})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return ou(this,t)},e.prototype.observe=function(t,r){return r&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),au(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return Ex(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e}(Ts),WB=Io("ObservableValue",ua),ps=function(){function n(e){this.dependenciesState=un.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=un.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+Hr(),this.value=new Od(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=Gi.NONE,sa(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+Hr(),e.set&&(this.setter=la(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?fs.structural:fs.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return n.prototype.onBecomeStale=function(){JB(this)},n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.get=function(){this.isComputing&&sn("Cycle detected in computation "+this.name+": "+this.derivation),Mt.inBatch===0&&this.observers.size===0&&!this.keepAlive?Fp(this)&&(this.warnAboutUntrackedRead(),Oi(),this.value=this.computeValue(!1),Mi()):(Rx(this),Fp(this)&&this.trackAndCompute()&&KB(this));var e=this.value;if(hl(e))throw e.cause;return e},n.prototype.peek=function(){var e=this.computeValue(!1);if(hl(e))throw e.cause;return e},n.prototype.set=function(e){if(this.setter){sa(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else sa(!1,!1)},n.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===un.NOT_TRACKING,r=this.computeValue(!0),i=t||hl(e)||hl(r)||!this.equals(e,r);return i&&(this.value=r),i},n.prototype.computeValue=function(e){this.isComputing=!0,Mt.computationDepth++;var t;if(e)t=Mx(this,this.derivation,this.scope);else if(Mt.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(r){t=new Od(r)}return Mt.computationDepth--,this.isComputing=!1,t},n.prototype.suspend=function(){this.keepAlive||(zp(this),this.value=void 0)},n.prototype.observe=function(e,t){var r=this,i=!0,o=void 0;return o6(function(){var a=r.get();if(!i||t){var l=Ds();e({type:"update",object:r,newValue:a,oldValue:o}),No(l)}i=!1,o=a})},n.prototype.warnAboutUntrackedRead=function(){},n.prototype.toJSON=function(){return this.get()},n.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},n.prototype.valueOf=function(){return Ex(this.get())},n.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},n}(),vs=Io("ComputedValue",ps),pd=function(){function n(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return n}(),GB={};function Up(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:GB}var vd=!0,Dx=!1,Mt=function(){var n=Up();return n.__mobxInstanceCount>0&&!n.__mobxGlobals&&(vd=!1),n.__mobxGlobals&&n.__mobxGlobals.version!==new pd().version&&(vd=!1),vd?n.__mobxGlobals?(n.__mobxInstanceCount+=1,n.__mobxGlobals.UNCHANGED||(n.__mobxGlobals.UNCHANGED={}),n.__mobxGlobals):(n.__mobxInstanceCount=1,n.__mobxGlobals=new pd):(setTimeout(function(){Dx||sn("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new pd)}();function qB(){(Mt.pendingReactions.length||Mt.inBatch||Mt.isRunningReactions)&&sn("isolateGlobalState should be called before MobX is running any reactions"),Dx=!0,vd&&(--Up().__mobxInstanceCount===0&&(Up().__mobxGlobals=void 0),Mt=new pd)}function Vp(){return Mt}function XB(n,e){n.observers.add(e),n.lowestObserverState>e.dependenciesState&&(n.lowestObserverState=e.dependenciesState)}function Lx(n,e){n.observers.delete(e),n.observers.size===0&&Px(n)}function Px(n){n.isPendingUnobservation===!1&&(n.isPendingUnobservation=!0,Mt.pendingUnobservations.push(n))}function Oi(){Mt.inBatch++}function Mi(){if(--Mt.inBatch===0){jx();for(var n=Mt.pendingUnobservations,e=0;e<n.length;e++){var t=n[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof ps&&t.suspend())}Mt.pendingUnobservations=[]}}function Rx(n){var e=Mt.trackingDerivation;return e!==null?(e.runId!==n.lastAccessedBy&&(n.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=n,n.isBeingObserved||(n.isBeingObserved=!0,n.onBecomeObserved())),!0):(n.observers.size===0&&Mt.inBatch>0&&Px(n),!1)}function YB(n){n.lowestObserverState!==un.STALE&&(n.lowestObserverState=un.STALE,n.observers.forEach(function(e){e.dependenciesState===un.UP_TO_DATE&&(e.isTracing!==Gi.NONE&&Ix(e,n),e.onBecomeStale()),e.dependenciesState=un.STALE}))}function KB(n){n.lowestObserverState!==un.STALE&&(n.lowestObserverState=un.STALE,n.observers.forEach(function(e){e.dependenciesState===un.POSSIBLY_STALE?e.dependenciesState=un.STALE:e.dependenciesState===un.UP_TO_DATE&&(n.lowestObserverState=un.UP_TO_DATE)}))}function JB(n){n.lowestObserverState===un.UP_TO_DATE&&(n.lowestObserverState=un.POSSIBLY_STALE,n.observers.forEach(function(e){e.dependenciesState===un.UP_TO_DATE&&(e.dependenciesState=un.POSSIBLY_STALE,e.isTracing!==Gi.NONE&&Ix(e,n),e.onBecomeStale())}))}function Ix(n,e){if(""+n.name+e.name,n.isTracing===Gi.BREAK){var t=[];Bx(d6(n),t,1),new Function(`debugger;
/*
Tracing '`+n.name+`'

You are entering this break point because derivation '`+n.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(n instanceof ps?n.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function Bx(n,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+n.name),n.dependencies&&n.dependencies.forEach(function(r){return Bx(r,e,t+1)})}var Rl=function(){function n(e,t,r,i){e===void 0&&(e="Reaction@"+Hr()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=r,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=un.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+Hr(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=Gi.NONE}return n.prototype.onBecomeStale=function(){this.schedule()},n.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,Mt.pendingReactions.push(this),jx())},n.prototype.isScheduled=function(){return this._isScheduled},n.prototype.runReaction=function(){if(!this.isDisposed){if(Oi(),this._isScheduled=!1,Fp(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&li()}catch(e){this.reportExceptionInDerivation(e)}}Mi()}},n.prototype.track=function(e){if(!this.isDisposed){Oi(),this._isRunning=!0;var t=Mx(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&zp(this),hl(t)&&this.reportExceptionInDerivation(t.cause),Mi()}},n.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(Mt.disableErrorBoundaries)throw e;var r="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";Mt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(r,e),Mt.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(Oi(),zp(this),Mi()))},n.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[$t]=this,e},n.prototype.toString=function(){return"Reaction["+this.name+"]"},n.prototype.trace=function(e){e===void 0&&(e=!1),m6(this,e)},n}(),Vy=100,Wp=function(n){return n()};function jx(){Mt.inBatch>0||Mt.isRunningReactions||Wp(ZB)}function ZB(){Mt.isRunningReactions=!0;for(var n=Mt.pendingReactions,e=0;n.length>0;){++e===Vy&&(console.error("Reaction doesn't converge to a stable state after "+Vy+" iterations."+(" Probably there is a cycle in the reactive function: "+n[0])),n.splice(0));for(var t=n.splice(0),r=0,i=t.length;r<i;r++)t[r].runReaction()}Mt.isRunningReactions=!1}var Nd=Io("Reaction",Rl);function QB(n){var e=Wp;Wp=function(t){return n(function(){return e(t)})}}function li(){return!1}function e6(n){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function t6(){sn(!1)}function Wy(n){return function(e,t,r){if(r){if(r.value)return{value:la(n,r.value),enumerable:!1,configurable:!0,writable:!0};var i=r.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return la(n,i.call(this))}}}return n6(n).apply(this,arguments)}}function n6(n){return function(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){Ns(this,t,je(n,i))}})}}function r6(n,e,t,r){return r===!0?(Ff(n,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return Ff(this,e,t.value||t.initializer.call(this)),this[e]},set:t6}:{enumerable:!1,configurable:!0,set:function(i){Ff(this,e,i)},get:function(){}}}var je=function(e,t,r,i){if(arguments.length===1&&typeof e=="function")return la(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return la(e,t);if(arguments.length===1&&typeof e=="string")return Wy(e);if(i===!0)Ns(e,t,la(e.name||t,r.value,this));else return Wy(t).apply(null,arguments)};je.bound=r6;function i6(n,e){var t=typeof n=="string"?n:n.name||"<unnamed action>",r=typeof n=="function"?n:e;return Tx(t,r,this,void 0)}function Ff(n,e,t){Ns(n,e,la(e,t.bind(n)))}function o6(n,e){e===void 0&&(e=eg);var t=e&&e.name||n.name||"Autorun@"+Hr(),r=!e.scheduler&&!e.delay,i;if(r)i=new Rl(t,function(){this.track(l)},e.onError,e.requiresObservable);else{var o=Hx(e),a=!1;i=new Rl(t,function(){a||(a=!0,o(function(){a=!1,i.isDisposed||i.track(l)}))},e.onError,e.requiresObservable)}function l(){n(i)}return i.schedule(),i.getDisposer()}var a6=function(n){return n()};function Hx(n){return n.scheduler?n.scheduler:n.delay?function(e){return setTimeout(e,n.delay)}:a6}function $x(n,e,t){t===void 0&&(t=eg);var r=t.name||"Reaction@"+Hr(),i=je(r,t.onError?s6(t.onError,e):e),o=!t.scheduler&&!t.delay,a=Hx(t),l=!0,u=!1,d,f=t.compareStructural?fs.structural:t.equals||fs.default,h=new Rl(r,function(){l||o?v():u||(u=!0,a(v))},t.onError,t.requiresObservable);function v(){if(u=!1,!h.isDisposed){var y=!1;h.track(function(){var x=n(h);y=l||!f(d,x),d=x}),l&&t.fireImmediately&&i(d,h),!l&&y===!0&&i(d,h),l&&(l=!1)}}return h.schedule(),h.getDisposer()}function s6(n,e){return function(){try{return e.apply(this,arguments)}catch(t){n.call(this,t)}}}function l6(n,e,t){return zx("onBecomeObserved",n,e)}function Fx(n,e,t){return zx("onBecomeUnobserved",n,e)}function zx(n,e,t,r){var i=Do(e),o=t,a=n+"Listeners";i[a]?i[a].add(o):i[a]=new Set([o]);var l=i[n];return typeof l!="function"?sn(!1):function(){var u=i[a];u&&(u.delete(o),u.size===0&&delete i[a])}}function u6(n){var e=n.enforceActions,t=n.computedRequiresReaction,r=n.computedConfigurable,i=n.disableErrorBoundaries,o=n.reactionScheduler,a=n.reactionRequiresObservable,l=n.observableRequiresReaction;if(qB(),e!==void 0){var u=void 0;switch(e){case!0:case"observed":u=!0;break;case!1:case"never":u=!1;break;case"strict":case"always":u="strict";break;default:sn("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}Mt.enforceActions=u,Mt.allowStateChanges=!(u===!0||u==="strict")}t!==void 0&&(Mt.computedRequiresReaction=!!t),a!==void 0&&(Mt.reactionRequiresObservable=!!a),l!==void 0&&(Mt.observableRequiresReaction=!!l,Mt.allowStateReads=!Mt.observableRequiresReaction),r!==void 0&&(Mt.computedConfigurable=!!r),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),Mt.disableErrorBoundaries=!!i),o&&QB(o)}function Gp(n,e,t,r){r=Ja(r);var i=Ux(r);return ca(n),ug(n,r.name,i.enhancer),e&&Vx(n,e,t,i),n}function Ux(n){return n.defaultDecorator||(n.deep===!1?Ox:og)}function Vx(n,e,t,r){var i,o,a,l,u,d;Oi();try{var a=OB(e);try{for(var f=Wi(a),h=f.next();!h.done;h=f.next()){var d=h.value,v=Object.getOwnPropertyDescriptor(e,d),y=t&&d in t?t[d]:v.get?kd:r,x=y(n,d,v,!0);x&&Object.defineProperty(n,d,x)}}catch(_){i={error:_}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}finally{Mi()}}function d6(n,e){return Wx(Do(n,e))}function Wx(n){var e={name:n.name};return n.observing&&n.observing.length>0&&(e.dependencies=SB(n.observing).map(Wx)),e}function Gx(n,e){if(n==null)return!1;if(e!==void 0){if(Ri(n)===!1||!n[$t].values.has(e))return!1;var t=Do(n,e);return vs(t)}return vs(n)}function c6(n){return arguments.length>1?sn(!1):Gx(n)}function Gy(n,e){return typeof e!="string"?sn(!1):Gx(n,e)}function f6(n,e){return n==null?!1:Ri(n)||!!n[$t]||ng(n)||Nd(n)||vs(n)}function gs(n){return arguments.length!==1&&sn(!1),f6(n)}function ms(n){return Ri(n)?n[$t].getKeys():zr(n)||di(n)?Array.from(n.keys()):Ji(n)?n.map(function(e,t){return t}):sn(!1)}function h6(n){return Ri(n)?ms(n).map(function(e){return n[e]}):zr(n)?ms(n).map(function(e){return n.get(e)}):di(n)?Array.from(n.values()):Ji(n)?n.slice():sn(!1)}function p6(n){return Ri(n)?ms(n).map(function(e){return[e,n[e]]}):zr(n)?ms(n).map(function(e){return[e,n.get(e)]}):di(n)?Array.from(n.entries()):Ji(n)?n.map(function(e,t){return[t,e]}):sn(!1)}function sg(n,e,t){if(arguments.length===2&&!di(n)){Oi();var r=e;try{for(var i in r)sg(n,i,r[i])}finally{Mi()}return}if(Ri(n)){var o=n[$t],a=o.values.get(e);a?o.write(e,t):o.addObservableProp(e,t,o.defaultEnhancer)}else if(zr(n))n.set(e,t);else if(di(n))n.add(e);else if(Ji(n))typeof e!="number"&&(e=parseInt(e,10)),sa(e>=0,"Not a valid index: '"+e+"'"),Oi(),e>=n.length&&(n.length=e+1),n[e]=t,Mi();else return sn(!1)}function qx(n,e,t,r){return v6(n,e,t)}function v6(n,e,t){return Rc(n).observe(e,t)}var g6={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function za(n,e,t,r){return r.detectCycles&&n.set(e,t),t}function wo(n,e,t){if(!e.recurseEverything&&!gs(n)||typeof n!="object")return n;if(n===null)return null;if(n instanceof Date)return n;if(WB(n))return wo(n.get(),e,t);gs(n)&&ms(n);var r=e.detectCycles===!0;if(r&&n!==null&&t.has(n))return t.get(n);if(Ji(n)||Array.isArray(n)){var i=za(t,n,[],e),o=n.map(function(y){return wo(y,e,t)});i.length=o.length;for(var a=0,l=o.length;a<l;a++)i[a]=o[a];return i}if(di(n)||Object.getPrototypeOf(n)===Set.prototype)if(e.exportMapsAsObjects===!1){var u=za(t,n,new Set,e);return n.forEach(function(y){u.add(wo(y,e,t))}),u}else{var d=za(t,n,[],e);return n.forEach(function(y){d.push(wo(y,e,t))}),d}if(zr(n)||Object.getPrototypeOf(n)===Map.prototype)if(e.exportMapsAsObjects===!1){var f=za(t,n,new Map,e);return n.forEach(function(y,x){f.set(x,wo(y,e,t))}),f}else{var h=za(t,n,{},e);return n.forEach(function(y,x){h[x]=wo(y,e,t)}),h}var v=za(t,n,{},e);return Sx(n).forEach(function(y){v[y]=wo(n[y],e,t)}),v}function wi(n,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=g6),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),wo(n,e,t)}function m6(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=!1;typeof n[n.length-1]=="boolean"&&(t=n.pop());var r=y6(n);if(!r)return sn(!1);r.isTracing===Gi.NONE&&""+r.name,r.isTracing=t?Gi.BREAK:Gi.LOG}function y6(n){switch(n.length){case 0:return Mt.trackingDerivation;case 1:return Do(n[0]);case 2:return Do(n[0],n[1])}}function Ei(n,e){e===void 0&&(e=void 0),Oi();try{return n.apply(e)}finally{Mi()}}function Vu(n){return n[$t]}function Wu(n){return typeof n=="string"||typeof n=="number"||typeof n=="symbol"}var _6={has:function(n,e){if(e===$t||e==="constructor"||e===Cd)return!0;var t=Vu(n);return Wu(e)?t.has(e):e in n},get:function(n,e){if(e===$t||e==="constructor"||e===Cd)return n[e];var t=Vu(n),r=t.values.get(e);if(r instanceof Ts){var i=r.get();return i===void 0&&t.has(e),i}return Wu(e)&&t.has(e),n[e]},set:function(n,e,t){return Wu(e)?(sg(n,e,t),!0):!1},deleteProperty:function(n,e){if(!Wu(e))return!1;var t=Vu(n);return t.remove(e),!0},ownKeys:function(n){var e=Vu(n);return e.keysAtom.reportObserved(),Reflect.ownKeys(n)},preventExtensions:function(n){return sn("Dynamic observable objects cannot be frozen"),!1}};function b6(n){var e=new Proxy(n,_6);return n[$t].proxy=e,e}function qi(n){return n.interceptors!==void 0&&n.interceptors.length>0}function ou(n,e){var t=n.interceptors||(n.interceptors=[]);return t.push(e),wx(function(){var r=t.indexOf(e);r!==-1&&t.splice(r,1)})}function Xi(n,e){var t=Ds();try{for(var r=ig(n.interceptors||[]),i=0,o=r.length;i<o&&(e=r[i](e),sa(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{No(t)}}function Ni(n){return n.changeListeners!==void 0&&n.changeListeners.length>0}function au(n,e){var t=n.changeListeners||(n.changeListeners=[]);return t.push(e),wx(function(){var r=t.indexOf(e);r!==-1&&t.splice(r,1)})}function Ai(n,e){var t=Ds(),r=n.changeListeners;if(r){r=r.slice();for(var i=0,o=r.length;i<o;i++)r[i](e);No(t)}}var x6=1e4,w6={get:function(n,e){return e===$t?n[$t]:e==="length"?n[$t].getArrayLength():typeof e=="number"?oo.get.call(n,e):typeof e=="string"&&!isNaN(e)?oo.get.call(n,parseInt(e)):oo.hasOwnProperty(e)?oo[e]:n[e]},set:function(n,e,t){return e==="length"&&n[$t].setArrayLength(t),typeof e=="number"&&oo.set.call(n,e,t),typeof e=="symbol"||isNaN(e)?n[e]=t:oo.set.call(n,parseInt(e),t),!0},preventExtensions:function(n){return sn("Observable arrays cannot be frozen"),!1}};function S6(n,e,t,r){t===void 0&&(t="ObservableArray@"+Hr()),r===void 0&&(r=!1);var i=new Xx(t,e,r);CB(i.values,$t,i);var o=new Proxy(i.values,w6);if(i.proxy=o,n&&n.length){var a=Lc(!0);i.spliceWithArray(0,0,n),Pc(a)}return o}var Xx=function(){function n(e,t,r){this.owned=r,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new Ts(e||"ObservableArray@"+Hr()),this.enhancer=function(i,o){return t(i,o,e+"[..]")}}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},n.prototype.intercept=function(e){return ou(this,e)},n.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),au(this,e)},n.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},n.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var r=new Array(e-t),i=0;i<e-t;i++)r[i]=void 0;this.spliceWithArray(t,0,r)}else this.spliceWithArray(e,t-e)},n.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},n.prototype.spliceWithArray=function(e,t,r){var i=this;hs(this.atom);var o=this.values.length;if(e===void 0?e=0:e>o?e=o:e<0&&(e=Math.max(0,o+e)),arguments.length===1?t=o-e:t==null?t=0:t=Math.max(0,Math.min(t,o-e)),r===void 0&&(r=Sd),qi(this)){var a=Xi(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:r});if(!a)return Sd;t=a.removedCount,r=a.added}r=r.length===0?r:r.map(function(u){return i.enhancer(u,void 0)});var l=this.spliceItemsIntoValues(e,t,r);return(t!==0||r.length!==0)&&this.notifyArraySplice(e,r,l),this.dehanceValues(l)},n.prototype.spliceItemsIntoValues=function(e,t,r){var i;if(r.length<x6)return(i=this.values).splice.apply(i,ig([e,t],r));var o=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(r,this.values.slice(e+t)),o},n.prototype.notifyArrayChildUpdate=function(e,t,r){var i=!this.owned&&li(),o=Ni(this),a=o||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:r}:null;this.atom.reportChanged(),o&&Ai(this,a)},n.prototype.notifyArraySplice=function(e,t,r){var i=!this.owned&&li(),o=Ni(this),a=o||i?{object:this.proxy,type:"splice",index:e,removed:r,added:t,removedCount:r.length,addedCount:t.length}:null;this.atom.reportChanged(),o&&Ai(this,a)},n}(),oo={intercept:function(n){return this[$t].intercept(n)},observe:function(n,e){e===void 0&&(e=!1);var t=this[$t];return t.observe(n,e)},clear:function(){return this.splice(0)},replace:function(n){var e=this[$t];return e.spliceWithArray(0,e.values.length,n)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=this[$t];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(n);case 2:return i.spliceWithArray(n,e)}return i.spliceWithArray(n,e,t)},spliceWithArray:function(n,e,t){var r=this[$t];return r.spliceWithArray(n,e,t)},push:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[$t];return t.spliceWithArray(t.values.length,0,n),t.values.length},pop:function(){return this.splice(Math.max(this[$t].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[$t];return t.spliceWithArray(0,0,n),t.values.length},reverse:function(){var n=this.slice();return n.reverse.apply(n,arguments)},sort:function(n){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(n){var e=this[$t],t=e.dehanceValues(e.values).indexOf(n);return t>-1?(this.splice(t,1),!0):!1},get:function(n){var e=this[$t];if(e){if(n<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[n]);console.warn("[mobx.array] Attempt to read an array index ("+n+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(n,e){var t=this[$t],r=t.values;if(n<r.length){hs(t.atom);var i=r[n];if(qi(t)){var o=Xi(t,{type:"update",object:t.proxy,index:n,newValue:e});if(!o)return;e=o.newValue}e=t.enhancer(e,i);var a=e!==i;a&&(r[n]=e,t.notifyArrayChildUpdate(n,e,i))}else if(n===r.length)t.spliceWithArray(n,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+n+" is larger than "+r.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(n){typeof Array.prototype[n]=="function"&&(oo[n]=function(){var e=this[$t];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[n].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(n){typeof Array.prototype[n]=="function"&&(oo[n]=function(e,t){var r=this,i=this[$t];i.atom.reportObserved();var o=i.dehanceValues(i.values);return o[n](function(a,l){return e.call(t,a,l,r)},t)})});["reduce","reduceRight"].forEach(function(n){oo[n]=function(){var e=this,t=this[$t];t.atom.reportObserved();var r=arguments[0];return arguments[0]=function(i,o,a){return o=t.dehanceValue(o),r(i,o,a,e)},t.values[n].apply(t.values,arguments)}});var E6=Io("ObservableArrayAdministration",Xx);function Ji(n){return tg(n)&&E6(n[$t])}var qy,C6={},lg=function(){function n(e,t,r){if(t===void 0&&(t=iu),r===void 0&&(r="ObservableMap@"+Hr()),this.enhancer=t,this.name=r,this[qy]=C6,this._keysAtom=rg(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return n.prototype._has=function(e){return this._data.has(e)},n.prototype.has=function(e){var t=this;if(!Mt.trackingDerivation)return this._has(e);var r=this._hasMap.get(e);if(!r){var i=r=new ua(this._has(e),Tc,this.name+"."+ko(e)+"?",!1);this._hasMap.set(e,i),Fx(i,function(){return t._hasMap.delete(e)})}return r.get()},n.prototype.set=function(e,t){var r=this._has(e);if(qi(this)){var i=Xi(this,{type:r?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return r?this._updateValue(e,t):this._addValue(e,t),this},n.prototype.delete=function(e){var t=this;if(hs(this._keysAtom),qi(this)){var r=Xi(this,{type:"delete",object:this,name:e});if(!r)return!1}if(this._has(e)){var i=li(),o=Ni(this),r=o||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return Ei(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var l=t._data.get(e);l.setNewValue(void 0),t._data.delete(e)}),o&&Ai(this,r),!0}return!1},n.prototype._updateHasMapEntry=function(e,t){var r=this._hasMap.get(e);r&&r.setNewValue(t)},n.prototype._updateValue=function(e,t){var r=this._data.get(e);if(t=r.prepareNewValue(t),t!==Mt.UNCHANGED){var i=li(),o=Ni(this),a=o||i?{type:"update",object:this,oldValue:r.value,name:e,newValue:t}:null;r.setNewValue(t),o&&Ai(this,a)}},n.prototype._addValue=function(e,t){var r=this;hs(this._keysAtom),Ei(function(){var l=new ua(t,r.enhancer,r.name+"."+ko(e),!1);r._data.set(e,l),t=l.value,r._updateHasMapEntry(e,!0),r._keysAtom.reportChanged()});var i=li(),o=Ni(this),a=o||i?{type:"add",object:this,name:e,newValue:t}:null;o&&Ai(this,a)},n.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},n.prototype.values=function(){var e=this,t=this.keys();return Ad({next:function(){var r=t.next(),i=r.done,o=r.value;return{done:i,value:i?void 0:e.get(o)}}})},n.prototype.entries=function(){var e=this,t=this.keys();return Ad({next:function(){var r=t.next(),i=r.done,o=r.value;return{done:i,value:i?void 0:[o,e.get(o)]}}})},n.prototype[qy=$t,Symbol.iterator]=function(){return this.entries()},n.prototype.forEach=function(e,t){var r,i;try{for(var o=Wi(this),a=o.next();!a.done;a=o.next()){var l=es(a.value,2),u=l[0],d=l[1];e.call(t,d,u,this)}}catch(f){r={error:f}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},n.prototype.merge=function(e){var t=this;return zr(e)&&(e=e.toJS()),Ei(function(){var r=Lc(!0);try{Ms(e)?Sx(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var o=es(i,2),a=o[0],l=o[1];return t.set(a,l)}):As(e)?(e.constructor!==Map&&sn("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,o){return t.set(o,i)})):e!=null&&sn("Cannot initialize map from "+e)}finally{Pc(r)}}),this},n.prototype.clear=function(){var e=this;Ei(function(){Nx(function(){var t,r;try{for(var i=Wi(e.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;e.delete(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}})})},n.prototype.replace=function(e){var t=this;return Ei(function(){var r,i,o,a,l=EB(e),u=new Map,d=!1;try{for(var f=Wi(t._data.keys()),h=f.next();!h.done;h=f.next()){var v=h.value;if(!l.has(v)){var y=t.delete(v);if(y)d=!0;else{var x=t._data.get(v);u.set(v,x)}}}}catch(L){r={error:L}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}try{for(var w=Wi(l.entries()),_=w.next();!_.done;_=w.next()){var b=es(_.value,2),v=b[0],x=b[1],E=t._data.has(v);if(t.set(v,x),t._data.has(v)){var k=t._data.get(v);u.set(v,k),E||(d=!0)}}}catch(L){o={error:L}}finally{try{_&&!_.done&&(a=w.return)&&a.call(w)}finally{if(o)throw o.error}}if(!d)if(t._data.size!==u.size)t._keysAtom.reportChanged();else for(var O=t._data.keys(),N=u.keys(),I=O.next(),T=N.next();!I.done;){if(I.value!==T.value){t._keysAtom.reportChanged();break}I=O.next(),T=N.next()}t._data=u}),this},Object.defineProperty(n.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.toPOJO=function(){var e,t,r={};try{for(var i=Wi(this),o=i.next();!o.done;o=i.next()){var a=es(o.value,2),l=a[0],u=a[1];r[typeof l=="symbol"?l:ko(l)]=u}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},n.prototype.toJS=function(){return new Map(this)},n.prototype.toJSON=function(){return this.toPOJO()},n.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return ko(t)+": "+(""+e.get(t))}).join(", ")+" }]"},n.prototype.observe=function(e,t){return au(this,e)},n.prototype.intercept=function(e){return ou(this,e)},n}(),zr=Io("ObservableMap",lg),Xy,k6={},Yx=function(){function n(e,t,r){if(t===void 0&&(t=iu),r===void 0&&(r="ObservableSet@"+Hr()),this.name=r,this[Xy]=k6,this._data=new Set,this._atom=rg(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,o){return t(i,o,r)},e&&this.replace(e)}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.clear=function(){var e=this;Ei(function(){Nx(function(){var t,r;try{for(var i=Wi(e._data.values()),o=i.next();!o.done;o=i.next()){var a=o.value;e.delete(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}})})},n.prototype.forEach=function(e,t){var r,i;try{for(var o=Wi(this),a=o.next();!a.done;a=o.next()){var l=a.value;e.call(t,l,l,this)}}catch(u){r={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},Object.defineProperty(n.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.add=function(e){var t=this;if(hs(this._atom),qi(this)){var r=Xi(this,{type:"add",object:this,newValue:e});if(!r)return this}if(!this.has(e)){Ei(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=li(),o=Ni(this),r=o||i?{type:"add",object:this,newValue:e}:null;o&&Ai(this,r)}return this},n.prototype.delete=function(e){var t=this;if(qi(this)){var r=Xi(this,{type:"delete",object:this,oldValue:e});if(!r)return!1}if(this.has(e)){var i=li(),o=Ni(this),r=o||i?{type:"delete",object:this,oldValue:e}:null;return Ei(function(){t._atom.reportChanged(),t._data.delete(e)}),o&&Ai(this,r),!0}return!1},n.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},n.prototype.entries=function(){var e=0,t=Array.from(this.keys()),r=Array.from(this.values());return Ad({next:function(){var i=e;return e+=1,i<r.length?{value:[t[i],r[i]],done:!1}:{done:!0}}})},n.prototype.keys=function(){return this.values()},n.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,r=Array.from(this._data.values());return Ad({next:function(){return t<r.length?{value:e.dehanceValue(r[t++]),done:!1}:{done:!0}}})},n.prototype.replace=function(e){var t=this;return di(e)&&(e=e.toJS()),Ei(function(){var r=Lc(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):ru(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&sn("Cannot initialize set from "+e)}finally{Pc(r)}}),this},n.prototype.observe=function(e,t){return au(this,e)},n.prototype.intercept=function(e){return ou(this,e)},n.prototype.toJS=function(){return new Set(this)},n.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},n.prototype[Xy=$t,Symbol.iterator]=function(){return this.values()},n}(),di=Io("ObservableSet",Yx),Kx=function(){function n(e,t,r,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=r,this.defaultEnhancer=i,this.keysAtom=new Ts(r+".keys")}return n.prototype.read=function(e){return this.values.get(e).get()},n.prototype.write=function(e,t){var r=this.target,i=this.values.get(e);if(i instanceof ps){i.set(t);return}if(qi(this)){var o=Xi(this,{type:"update",object:this.proxy||r,name:e,newValue:t});if(!o)return;t=o.newValue}if(t=i.prepareNewValue(t),t!==Mt.UNCHANGED){var a=Ni(this),l=li(),o=a||l?{type:"update",object:this.proxy||r,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),a&&Ai(this,o)}},n.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),r=t.get(e);if(r)return r.get();var i=!!this.values.get(e);return r=new ua(i,Tc,this.name+"."+ko(e)+"?",!1),t.set(e,r),r.get()},n.prototype.addObservableProp=function(e,t,r){r===void 0&&(r=this.defaultEnhancer);var i=this.target;if(qi(this)){var o=Xi(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!o)return;t=o.newValue}var a=new ua(t,r,this.name+"."+ko(e),!1);this.values.set(e,a),t=a.value,Object.defineProperty(i,e,O6(e)),this.notifyPropertyAddition(e,t)},n.prototype.addComputedProp=function(e,t,r){var i=this.target;r.name=r.name||this.name+"."+ko(t),this.values.set(t,new ps(r)),(e===i||kB(e,t))&&Object.defineProperty(e,t,M6(t))},n.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(qi(this)){var r=Xi(this,{object:this.proxy||t,name:e,type:"remove"});if(!r)return}try{Oi();var i=Ni(this),o=li(),a=this.values.get(e),l=a&&a.get();if(a&&a.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var u=this.pendingKeys.get(e);u&&u.set(!1)}delete this.target[e];var r=i||o?{type:"remove",object:this.proxy||t,oldValue:l,name:e}:null;i&&Ai(this,r)}finally{Mi()}}},n.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},n.prototype.observe=function(e,t){return au(this,e)},n.prototype.intercept=function(e){return ou(this,e)},n.prototype.notifyPropertyAddition=function(e,t){var r=Ni(this),i=li(),o=r||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(r&&Ai(this,o),this.pendingKeys){var a=this.pendingKeys.get(e);a&&a.set(!0)}this.keysAtom.reportChanged()},n.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var r=[];try{for(var i=Wi(this.values),o=i.next();!o.done;o=i.next()){var a=es(o.value,2),l=a[0],u=a[1];u instanceof ua&&r.push(l)}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},n}();function ug(n,e,t){if(e===void 0&&(e=""),t===void 0&&(t=iu),Object.prototype.hasOwnProperty.call(n,$t))return n[$t];Ms(n)||(e=(n.constructor.name||"ObservableObject")+"@"+Hr()),e||(e="ObservableObject@"+Hr());var r=new Kx(n,new Map,ko(e),t);return Ns(n,$t,r),r}var Yy=Object.create(null),Ky=Object.create(null);function O6(n){return Yy[n]||(Yy[n]={configurable:!0,enumerable:!0,get:function(){return this[$t].read(n)},set:function(e){this[$t].write(n,e)}})}function Jy(n){var e=n[$t];return e||(ca(n),n[$t])}function M6(n){return Ky[n]||(Ky[n]={configurable:Mt.computedConfigurable,enumerable:!1,get:function(){return Jy(this).read(n)},set:function(e){Jy(this).write(n,e)}})}var N6=Io("ObservableObjectAdministration",Kx);function Ri(n){return tg(n)?(ca(n),N6(n[$t])):!1}function Do(n,e){if(typeof n=="object"&&n!==null){if(Ji(n))return e!==void 0&&sn(!1),n[$t].atom;if(di(n))return n[$t];if(zr(n)){var t=n;if(e===void 0)return t._keysAtom;var r=t._data.get(e)||t._hasMap.get(e);return r||sn(!1),r}if(ca(n),e&&!n[$t]&&n[e],Ri(n)){if(!e)return sn(!1);var r=n[$t].values.get(e);return r||sn(!1),r}if(ng(n)||vs(n)||Nd(n))return n}else if(typeof n=="function"&&Nd(n[$t]))return n[$t];return sn(!1)}function Rc(n,e){if(n||sn("Expecting some object"),e!==void 0)return Rc(Do(n,e));if(ng(n)||vs(n)||Nd(n)||zr(n)||di(n))return n;if(ca(n),n[$t])return n[$t];sn(!1)}function A6(n,e){var t;return e!==void 0?t=Do(n,e):Ri(n)||zr(n)||di(n)?t=Rc(n):t=Do(n),t.name}var Zy=Object.prototype.toString;function Jx(n,e,t){return t===void 0&&(t=-1),qp(n,e,t)}function qp(n,e,t,r,i){if(n===e)return n!==0||1/n===1/e;if(n==null||e==null)return!1;if(n!==n)return e!==e;var o=typeof n;if(o!=="function"&&o!=="object"&&typeof e!="object")return!1;var a=Zy.call(n);if(a!==Zy.call(e))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+n==""+e;case"[object Number]":return+n!=+n?+e!=+e:+n==0?1/+n===1/e:+n==+e;case"[object Date]":case"[object Boolean]":return+n==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(n)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}n=Qy(n),e=Qy(e);var l=a==="[object Array]";if(!l){if(typeof n!="object"||typeof e!="object")return!1;var u=n.constructor,d=e.constructor;if(u!==d&&!(typeof u=="function"&&u instanceof u&&typeof d=="function"&&d instanceof d)&&"constructor"in n&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),r=r||[],i=i||[];for(var f=r.length;f--;)if(r[f]===n)return i[f]===e;if(r.push(n),i.push(e),l){if(f=n.length,f!==e.length)return!1;for(;f--;)if(!qp(n[f],e[f],t-1,r,i))return!1}else{var h=Object.keys(n),v=void 0;if(f=h.length,Object.keys(e).length!==f)return!1;for(;f--;)if(v=h[f],!(T6(e,v)&&qp(n[v],e[v],t-1,r,i)))return!1}return r.pop(),i.pop(),!0}function Qy(n){return Ji(n)?n.slice():As(n)||zr(n)||ru(n)||di(n)?Array.from(n.entries()):n}function T6(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ad(n){return n[Symbol.iterator]=D6,n}function D6(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:e6,extras:{getDebugName:A6},$mobx:$t});function L6(n){return!(n.prototype&&n.prototype.render)&&!Zt.isPrototypeOf(n)}function Zx(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,r=t===void 0?"":t,i=e.suffix,o=i===void 0?"":i,a=n.displayName||n.name||n.constructor&&n.constructor.name||"<component>";return r+a+o}var e_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qx=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},ew=function(){function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),tw=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},nw=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},t_=console;function P6(n){var e=Vp().allowStateChanges;return Vp().allowStateChanges=n,e}function R6(n){Vp().allowStateChanges=n}function I6(n,e,t,r,i){var o=P6(n),a=void 0;try{a=e(t,r,i)}finally{R6(o)}return a}function n_(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=n[e],i=rw[e],o=r?t===!0?function(){i.apply(this,arguments),r.apply(this,arguments)}:function(){r.apply(this,arguments),i.apply(this,arguments)}:i;n[e]=o}function r_(n,e){if(n==null||e==null||(typeof n>"u"?"undefined":e_(n))!=="object"||(typeof e>"u"?"undefined":e_(e))!=="object")return n!==e;var t=Object.keys(n);if(t.length!==Object.keys(e).length)return!0;for(var r=void 0,i=t.length-1;r=t[i];i--)if(e[r]!==n[r])return!0;return!1}var rw={componentWillMount:function(){var e=this,t=Zx(this),r=!1,i=!1;function o(h){var v=this[h],y=rg("reactive "+h);Object.defineProperty(this,h,{configurable:!0,enumerable:!0,get:function(){return y.reportObserved(),v},set:function(w){!i&&r_(v,w)?(v=w,r=!0,y.reportChanged(),r=!1):v=w}})}o.call(this,"props"),o.call(this,"state");var a=this.render.bind(this),l=null,u=!1,d=function(){return l=new Rl(t+".render()",function(){if(!u&&(u=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var v=!0;try{i=!0,r||Zt.prototype.forceUpdate.call(e),v=!1}finally{i=!1,v&&l.dispose()}}}),l.reactComponent=e,f.$mobx=l,e.render=f,f(e.props,e.state,e.context)},f=function(v,y,x){u=!1;var w=void 0,_=void 0;if(l.track(function(){try{_=I6(!1,a,v,y,x)}catch(b){w=b}}),w)throw w;return _};this.render=d},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:r_(this.props,e)}};function dg(n){if(arguments.length>1&&t_.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),n.isMobxInjector===!0&&t_.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),L6(n)){var e,t;return dg((t=e=function(i){tw(o,i);function o(){return Qx(this,o),nw(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return ew(o,[{key:"render",value:function(){return n.call(this,this.props,this.context)}}]),o}(Zt),e.displayName=Zx(n),t))}if(!n)throw new Error("Please pass a valid component to 'observer'");var r=n.prototype||n;return B6(r),n.isMobXReactObserver=!0,n}function B6(n){n_(n,"componentWillMount",!0),n_(n,"componentDidMount"),n.shouldComponentUpdate||(n.shouldComponentUpdate=rw.shouldComponentUpdate)}var j6=dg(function(n){var e=n.children;return e[0]()});j6.displayName="Observer";var H6=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $6(n,e){return e={exports:{}},n(e,e.exports),e.exports}$6(function(n,e){(function(t,r){n.exports=r()})(H6,function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,o=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,l=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,d=u&&u(Object);return function f(h,v,y){if(typeof v!="string"){if(d){var x=u(v);x&&x!==d&&f(h,x,y)}var w=o(v);a&&(w=w.concat(a(v)));for(var _=0;_<w.length;++_){var b=w[_];if(!t[b]&&!r[b]&&(!y||!y[b])){var E=l(v,b);try{i(h,b,E)}catch{}}}return h}return h}})});var i_={children:!0,key:!0,ref:!0},o_=console;(function(n){tw(e,n);function e(){return Qx(this,e),nw(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ew(e,[{key:"render",value:function(r){var i=r.children;return i.length>1?mt("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var r={},i=this.context.mobxStores;if(i)for(var o in i)r[o]=i[o];for(var a in this.props)!i_[a]&&a!=="suppressChangedStoreWarning"&&(r[a]=this.props[a]);return{mobxStores:r}}},{key:"componentWillReceiveProps",value:function(r){if(Object.keys(r).length!==Object.keys(this.props).length&&o_.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!r.suppressChangedStoreWarning)for(var i in r)!i_[i]&&this.props[i]!==r[i]&&o_.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Zt);if(!Zt)throw new Error("mobx-preact requires Preact to be available");var Ui,zf,a_,iw=[],lr=Xt,s_=lr.__b,l_=lr.__r,u_=lr.diffed,d_=lr.__c,c_=lr.unmount,f_=lr.__;function F6(){for(var n;n=iw.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(gd),n.__H.__h.forEach(Xp),n.__H.__h=[]}catch(e){n.__H.__h=[],lr.__e(e,n.__v)}}lr.__b=function(n){Ui=null,s_&&s_(n)},lr.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),f_&&f_(n,e)},lr.__r=function(n){l_&&l_(n);var e=(Ui=n.__c).__H;e&&(zf===Ui?(e.__h=[],Ui.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(gd),e.__h.forEach(Xp),e.__h=[])),zf=Ui},lr.diffed=function(n){u_&&u_(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(iw.push(e)!==1&&a_===lr.requestAnimationFrame||((a_=lr.requestAnimationFrame)||z6)(F6)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),zf=Ui=null},lr.__c=function(n,e){e.some(function(t){try{t.__h.forEach(gd),t.__h=t.__h.filter(function(r){return!r.__||Xp(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],lr.__e(r,t.__v)}}),d_&&d_(n,e)},lr.unmount=function(n){c_&&c_(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{gd(r)}catch(i){e=i}}),t.__H=void 0,e&&lr.__e(e,t.__v))};var h_=typeof requestAnimationFrame=="function";function z6(n){var e,t=function(){clearTimeout(r),h_&&cancelAnimationFrame(e),setTimeout(n)},r=setTimeout(t,35);h_&&(e=requestAnimationFrame(t))}function gd(n){var e=Ui,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),Ui=e}function Xp(n){var e=Ui;n.__c=n.__(),Ui=e}function U6(n,e){for(var t in e)n[t]=e[t];return n}function p_(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var r in e)if(r!=="__source"&&n[r]!==e[r])return!0;return!1}function v_(n,e){this.props=n,this.context=e}(v_.prototype=new Zt).isPureReactComponent=!0,v_.prototype.shouldComponentUpdate=function(n,e){return p_(this.props,n)||p_(this.state,e)};var g_=Xt.__b;Xt.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),g_&&g_(n)};var V6=Xt.__e;Xt.__e=function(n,e,t,r){if(n.then){for(var i,o=e;o=o.__;)if((i=o.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(n,e)}V6(n,e,t,r)};var m_=Xt.unmount;function ow(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),n.__c.__H=null),(n=U6({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c.__e=!0,n.__c=null),n.__k=n.__k&&n.__k.map(function(r){return ow(r,e,t)})),n}function aw(n,e,t){return n&&t&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(r){return aw(r,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=t)),n}function Uf(){this.__u=0,this.o=null,this.__b=null}function sw(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function Gu(){this.i=null,this.l=null}Xt.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&32&n.__u&&(n.type=null),m_&&m_(n)},(Uf.prototype=new Zt).__c=function(n,e){var t=e.__c,r=this;r.o==null&&(r.o=[]),r.o.push(t);var i=sw(r.__v),o=!1,a=function(){o||(o=!0,t.__R=null,i?i(l):l())};t.__R=a;var l=function(){if(!--r.__u){if(r.state.__a){var u=r.state.__a;r.__v.__k[0]=aw(u,u.__c.__P,u.__c.__O)}var d;for(r.setState({__a:r.__b=null});d=r.o.pop();)d.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),n.then(a,a)},Uf.prototype.componentWillUnmount=function(){this.o=[]},Uf.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=ow(this.__b,t,r.__O=r.__P)}this.__b=null}var i=e.__a&&mt(ds,null,n.fallback);return i&&(i.__u&=-33),[mt(ds,null,e.__a?null:n.children),i]};var y_=function(n,e,t){if(++t[1]===t[0]&&n.l.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(t=n.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.i=t=t[2]}};(Gu.prototype=new Zt).__a=function(n){var e=this,t=sw(e.__v),r=e.l.get(n);return r[0]++,function(i){var o=function(){e.props.revealOrder?(r.push(i),y_(e,n,r)):i()};t?t(o):o()}},Gu.prototype.render=function(n){this.i=null,this.l=new Map;var e=wd(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return n.children},Gu.prototype.componentDidUpdate=Gu.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(e,t){y_(n,t,e)})};var W6=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,G6=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,q6=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,X6=/[A-Z0-9]/g,Y6=typeof document<"u",K6=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};function __(n,e,t){return e.__k==null&&(e.textContent=""),xB(n,e),typeof t=="function"&&t(),n?n.__c:null}Zt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Zt.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var b_=Xt.event;function J6(){}function Z6(){return this.cancelBubble}function Q6(){return this.defaultPrevented}Xt.event=function(n){return b_&&(n=b_(n)),n.persist=J6,n.isPropagationStopped=Z6,n.isDefaultPrevented=Q6,n.nativeEvent=n};var e5={enumerable:!1,configurable:!0,get:function(){return this.class}},x_=Xt.vnode;Xt.vnode=function(n){typeof n.type=="string"&&function(e){var t=e.props,r=e.type,i={},o=r.indexOf("-")===-1;for(var a in t){var l=t[a];if(!(a==="value"&&"defaultValue"in t&&l==null||Y6&&a==="children"&&r==="noscript"||a==="class"||a==="className")){var u=a.toLowerCase();a==="defaultValue"&&"value"in t&&t.value==null?a="value":a==="download"&&l===!0?l="":u==="translate"&&l==="no"?l=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?a="ondblclick":u!=="onchange"||r!=="input"&&r!=="textarea"||K6(t.type)?u==="onfocus"?a="onfocusin":u==="onblur"?a="onfocusout":q6.test(a)&&(a=u):u=a="oninput":o&&G6.test(a)?a=a.replace(X6,"-$&").toLowerCase():l===null&&(l=void 0),u==="oninput"&&i[a=u]&&(a="oninputCapture"),i[a]=l}}r=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=wd(t.children).forEach(function(d){d.props.selected=i.value.indexOf(d.props.value)!=-1})),r=="select"&&i.defaultValue!=null&&(i.value=wd(t.children).forEach(function(d){d.props.selected=i.multiple?i.defaultValue.indexOf(d.props.value)!=-1:i.defaultValue==d.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",e5)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i}(n),n.$$typeof=W6,x_&&x_(n)};var w_=Xt.__r;Xt.__r=function(n){w_&&w_(n),n.__c};var S_=Xt.diffed;Xt.diffed=function(n){S_&&S_(n);var e=n.props,t=n.__e;t!=null&&n.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var t5=0;function He(n,e,t,r,i,o){e||(e={});var a,l,u=e;if("ref"in u)for(l in u={},e)l=="ref"?a=e[l]:u[l]=e[l];var d={type:n,props:u,key:t,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--t5,__i:-1,__u:0,__source:i,__self:o};if(typeof n=="function"&&(a=n.defaultProps))for(l in a)u[l]===void 0&&(u[l]=a[l]);return Xt.vnode&&Xt.vnode(d),d}var n5=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t},Il;(function(n){function e(t){var r=n5(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return on({},n.defaults,r)}n.get=e})(Il||(Il={}));(function(n){n.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(Il||(Il={}));var E_={node:!1,edge:!1},r5={node:!0,edge:!0},i5=function(n){return!n||typeof n=="boolean"?n===!0?It(r5):It(E_):ss(It(E_),n)},o5=function(){return Zl(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function mr(n){try{return JSON.parse(JSON.stringify(n))}catch{return n}}var qu=200,a5=9999,s5=10,tn;(function(n){n[n.DEFAULT=1]="DEFAULT",n[n.TEXT_EDIT=2]="TEXT_EDIT",n[n.SHOW_MENU=3]="SHOW_MENU",n[n.ALLOW_CONNECT=4]="ALLOW_CONNECT",n[n.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(tn||(tn={}));var kn;(function(n){n.NODE="node",n.EDGE="edge",n.GRAPH="graph"})(kn||(kn={}));var Wt;(function(n){n.NODE="node",n.CIRCLE_NODE="circle-node",n.POLYGON_NODE="polygon-node",n.RECT_NODE="rect-node",n.TEXT_NODE="text-node",n.ELLIPSE_NODE="ellipse-node",n.DIAMOND_NODE="diamond-node",n.HTML_NODE="html-node",n.CUSTOM_HTML_NODE="custom-html-node",n.EDGE="edge",n.LINE_EDGE="line-edge",n.POLYLINE_EDGE="polyline-edge",n.BEZIER_EDGE="bezier-edge",n.GRAPH="graph"})(Wt||(Wt={}));var kt;(function(n){n.ELEMENT_CLICK="element:click",n.NODE_ADD="node:add",n.NODE_DELETE="node:delete",n.NODE_CLICK="node:click",n.NODE_DBCLICK="node:dbclick",n.NODE_GROUP_COPY="node:group-copy-add",n.NODE_DND_ADD="node:dnd-add",n.NODE_DND_DRAG="node:dnd-drag",n.NODE_MOUSEDOWN="node:mousedown",n.NODE_DRAGSTART="node:dragstart",n.NODE_DRAG="node:drag",n.NODE_DROP="node:drop",n.NODE_MOUSEUP="node:mouseup",n.NODE_MOUSEMOVE="node:mousemove",n.NODE_MOUSEENTER="node:mouseenter",n.NODE_MOUSELEAVE="node:mouseleave",n.NODE_CONTEXTMENU="node:contextmenu",n.NODE_ROTATE="node:rotate",n.NODE_RESIZE="node:resize",n.NODE_FOCUS="node:focus",n.NODE_BLUR="node:blur",n.NODE_PROPERTIES_CHANGE="node:properties-change",n.NODE_PROPERTIES_DELETE="node:properties-delete",n.EDGE_ADD="edge:add",n.EDGE_DELETE="edge:delete",n.EDGE_CLICK="edge:click",n.EDGE_DBCLICK="edge:dbclick",n.EDGE_FOCUS="edge:focus",n.EDGE_BLUR="edge:blur",n.EDGE_MOUSEENTER="edge:mouseenter",n.EDGE_MOUSELEAVE="edge:mouseleave",n.EDGE_CONTEXTMENU="edge:contextmenu",n.EDGE_ADJUST="edge:adjust",n.EDGE_EXCHANGE_NODE="edge:exchange-node",n.ANCHOR_CLICK="anchor:click",n.ANCHOR_MOUSEDOWN="anchor:mousedown",n.ANCHOR_DRAGSTART="anchor:dragstart",n.ANCHOR_DRAG="anchor:drag",n.ANCHOR_DROP="anchor:drop",n.ANCHOR_DRAGEND="anchor:dragend",n.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",n.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",n.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",n.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",n.ADJUST_POINT_DRAG="adjustPoint:drag",n.ADJUST_POINT_DROP="adjustPoint:drop",n.ADJUST_POINT_DRAGEND="adjustPoint:dragend",n.BLANK_MOUSEDOWN="blank:mousedown",n.BLANK_DRAGSTART="blank:dragstart",n.BLANK_DRAG="blank:drag",n.BLANK_DROP="blank:drop",n.BLANK_MOUSEMOVE="blank:mousemove",n.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",n.BLANK_MOUSEUP="blank:mouseup",n.BLANK_CLICK="blank:click",n.BLANK_CONTEXTMENU="blank:contextmenu",n.SELECTION_MOUSEDOWN="selection:mousedown",n.SELECTION_DRAGSTART="selection:dragstart",n.SELECTION_DRAG="selection:drag",n.SELECTION_DROP="selection:drop",n.SELECTION_MOUSEMOVE="selection:mousemove",n.SELECTION_MOUSEUP="selection:mouseup",n.SELECTION_CONTEXTMENU="selection:contextmenu",n.CONNECTION_NOT_ALLOWED="connection:not-allowed",n.TEXT_MOUSEDOWN="text:mousedown",n.TEXT_DRAGSTART="text:dragstart",n.TEXT_DRAG="text:drag",n.TEXT_DROP="text:drop",n.TEXT_CLICK="text:click",n.TEXT_DBCLICK="text:dbclick",n.TEXT_BLUR="text:blur",n.TEXT_MOUSEMOVE="text:mousemove",n.TEXT_MOUSEUP="text:mouseup",n.TEXT_FOCUS="text:focus",n.TEXT_ADD="text:add",n.TEXT_UPDATE="text:update",n.TEXT_CLEAR="text:clear",n.LABEL_MOUSEDOWN="label:mousedown",n.LABEL_DRAGSTART="label:dragstart",n.LABEL_DRAG="label:drag",n.LABEL_DROP="label:drop",n.LABEL_CLICK="label:click",n.LABEL_DBCLICK="label:dbclick",n.LABEL_BLUR="label:blur",n.LABEL_MOUSEMOVE="label:mousemove",n.LABEL_MOUSEUP="label:mouseup",n.LABEL_FOCUS="label:focus",n.LABEL_ADD="label:add",n.LABEL_UPDATE="label:update",n.LABEL_CLEAR="label:clear",n.LABEL_DELETE="label:delete",n.LABEL_SHOULD_ADD="label:should-add",n.LABEL_BATCH_ADD="label:batch-add",n.LABEL_SHOULD_UPDATE="label:should-update",n.LABEL_SHOULD_DELETE="label:should-delete",n.LABEL_BATCH_DELETE="label:batch-delete",n.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",n.HISTORY_CHANGE="history:change",n.GRAPH_TRANSFORM="graph:transform",n.GRAPH_RENDERED="graph:rendered",n.GRAPH_UPDATED="graph:updated",n.EDIT_CONFIG_CHANGED="editConfig:changed"})(kt||(kt={}));var Ci;(function(n){n[n.DEFAULT=0]="DEFAULT",n[n.INCREASE=1]="INCREASE"})(Ci||(Ci={}));var _n;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(_n||(_n={}));var ui;(function(n){n.TEXT="text",n.LABEL="label"})(ui||(ui={}));var l5=0,fi=function(){function n(e){var t=e.onDragStart,r=t===void 0?Bf:t,i=e.onDragging,o=i===void 0?Bf:i,a=e.onDragEnd,l=a===void 0?Bf:a,u=e.eventType,d=u===void 0?"":u,f=e.eventCenter,h=e.step,v=h===void 0?1:h,y=e.isStopPropagation,x=y===void 0?!0:y,w=e.model,_=e.data,b=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(E){var k,O,N=window==null?void 0:window.document;if(E.button===l5){b.isStopPropagation&&E.stopPropagation(),b.isStartDragging=!0,b.startX=E.clientX,b.startY=E.clientY,N.addEventListener("mousemove",b.handleMouseMove,!1),N.addEventListener("mouseup",b.handleMouseUp,!1);var I=(k=b.model)===null||k===void 0?void 0:k.getData();(O=b.eventCenter)===null||O===void 0||O.emit(kt["".concat(b.eventType,"_MOUSEDOWN")],{e:E,data:b.data||I}),b.startTime=new Date().getTime()}},this.handleMouseMove=function(E){var k,O;if(b.isStopPropagation&&E.stopPropagation(),!!b.isStartDragging&&(b.sumDeltaX+=E.clientX-b.startX,b.sumDeltaY+=E.clientY-b.startY,b.startX=E.clientX,b.startY=E.clientY,b.step<=1||Math.abs(b.sumDeltaX)>b.step||Math.abs(b.sumDeltaY)>b.step)){var N=b.sumDeltaX%b.step,I=b.sumDeltaY%b.step,T=b.sumDeltaX-N,L=b.sumDeltaY-I;b.sumDeltaX=N,b.sumDeltaY=I;var H=(k=b.model)===null||k===void 0?void 0:k.getData();b.isDragging||((O=b.eventCenter)===null||O===void 0||O.emit(kt["".concat(b.eventType,"_DRAGSTART")],{e:E,data:b.data||H}),b.onDragStart({event:E})),b.isDragging=!0,Promise.resolve().then(function(){var X,V;b.onDragging({deltaX:T,deltaY:L,event:E}),(X=b.eventCenter)===null||X===void 0||X.emit(kt["".concat(b.eventType,"_MOUSEMOVE")],{deltaX:T,deltaY:L,e:E,data:b.data||H}),(V=b.eventCenter)===null||V===void 0||V.emit(kt["".concat(b.eventType,"_DRAG")],{e:E,data:b.data||H})})}},this.handleMouseUp=function(E){var k=window.document;b.isStartDragging=!1,b.isStopPropagation&&E.stopPropagation(),Promise.resolve().then(function(){var O,N,I;k.removeEventListener("mousemove",b.handleMouseMove,!1),k.removeEventListener("mouseup",b.handleMouseUp,!1);var T=(O=b.model)===null||O===void 0?void 0:O.getData();(N=b.eventCenter)===null||N===void 0||N.emit(kt["".concat(b.eventType,"_MOUSEUP")],{e:E,data:b.data||T}),b.isDragging&&(b.isDragging=!1,b.onDragEnd({event:E}),(I=b.eventCenter)===null||I===void 0||I.emit(kt["".concat(b.eventType,"_DROP")],{e:E,data:b.data||T}))})},this.cancelDrag=function(){var E=window==null?void 0:window.document;E.removeEventListener("mousemove",b.handleMouseMove,!1),E.removeEventListener("mouseup",b.handleMouseUp,!1),b.onDragEnd({event:void 0}),b.isDragging=!1},this.destroy=function(){b.isStartDragging&&b.cancelDrag()},this.onDragStart=r,this.onDragging=o,this.onDragEnd=l,this.step=v,this.isStopPropagation=x,this.eventType=d,this.eventCenter=f,this.model=w,this.data=_}return n.prototype.setStep=function(e){this.step=e},n.prototype.setModel=function(e){this.model=e},n}(),u5=function(n){var e=n.x,t=n.y,r=n.width,i=n.height;return{x:e-r/2,y:t-i/2,x1:e+r/2,y1:t+i/2}},d5=function(n){var e=n.startPoint,t=n.endPoint,r=(e.x+t.x)/2,i=(e.y+t.y)/2,o=Math.abs(e.x-t.x)+10,a=Math.abs(e.y-t.y)+10;return{x:r-o/2,y:i-a/2,x1:r+o/2,y1:i+a/2}},c5=function(n){var e=n.points,t=fa(e),r=Hl(t,8),i=r.x,o=r.y,a=r.width,l=r.height;return{x:i-a/2,y:o-l/2,x1:i+a/2,y1:o+l/2}},f5=function(n){var e=n.path,t=cg(e),r=Hl(t,8),i=r.x,o=r.y,a=r.width,l=r.height;return{x:i-a/2,y:o-l/2,x1:i+a/2,y1:o+l/2}},h5=function(n){if(n.modelType===Wt.LINE_EDGE)return d5(n);if(n.modelType===Wt.POLYLINE_EDGE)return c5(n);if(n.modelType===Wt.BEZIER_EDGE)return f5(n)},p5=function(n,e,t,r){var i=(e.y-n.y)*(r.x-t.x)-(n.x-e.x)*(t.y-r.y);if(i===0)return!1;var o=((e.x-n.x)*(r.x-t.x)*(t.y-n.y)+(e.y-n.y)*(r.x-t.x)*n.x-(r.y-t.y)*(e.x-n.x)*t.x)/i,a=-((e.y-n.y)*(r.y-t.y)*(t.x-n.x)+(e.x-n.x)*(r.y-t.y)*n.y-(r.x-t.x)*(e.y-n.y)*t.y)/i;return(o-n.x)*(o-e.x)<=0&&(a-n.y)*(a-e.y)<=0&&(o-t.x)*(o-r.x)<=0&&(a-t.y)*(a-r.y)<=0?{x:o,y:a}:!1},Bl=function(n,e,t){var r=n.x,i=n.y,o=e.x,a=e.y,l=t.x,u=t.y,d=(u-a)/(l-o),f=a-d*o;return(r>=o&&r<=l||r<=o&&r>=l)&&(i>=a&&i<=u||i<=a&&i>=u)&&Math.abs(i-d*r-f)<Number.EPSILON},jl=function(n){var e=n.start,t=n.end,r=n.offset,i=n.verticalLength,o=n.type,a={leftX:0,leftY:0,rightX:0,rightY:0},l=Math.atan((t.y-e.y)/(t.x-e.x)),u=Math.atan(r/i),d=Math.sqrt(i*i+r*r);return o==="start"?t.x>=e.x?(a.leftX=e.x+d*Math.sin(l+u),a.leftY=e.y-d*Math.cos(l+u),a.rightX=e.x-d*Math.sin(l-u),a.rightY=e.y+d*Math.cos(l-u)):(a.leftX=e.x-d*Math.sin(l+u),a.leftY=e.y+d*Math.cos(l+u),a.rightX=e.x+d*Math.sin(l-u),a.rightY=e.y-d*Math.cos(l-u)):o==="end"&&(t.x>=e.x?(a.leftX=t.x+d*Math.sin(l-u),a.leftY=t.y-d*Math.cos(l-u),a.rightX=t.x-d*Math.sin(l+u),a.rightY=t.y+d*Math.cos(l+u)):(a.leftX=t.x-d*Math.sin(l-u),a.leftY=t.y+d*Math.cos(l-u),a.rightX=t.x+d*Math.sin(l+u),a.rightY=t.y-d*Math.cos(l+u))),a},ts=function(){return ts=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ts.apply(this,arguments)},ai=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Oo=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},v5=function(n,e){return Math.abs(n.centerX-e.centerX)*2<n.width+e.width&&Math.abs(n.centerY-e.centerY)*2<n.height+e.height},Yp=function(n){var e=[],t={};return n.forEach(function(r){var i="".concat(r.x,"-").concat(r.y);r.id=i,t[i]=r}),Object.keys(t).forEach(function(r){e.push(t[r])}),e},Td=function(n,e){return n.width===0&&n.height===0?n:{x:n.x,y:n.y,centerX:n.centerX,centerY:n.centerY,minX:n.minX-e,minY:n.minY-e,maxX:n.maxX+e,maxY:n.maxY+e,height:n.height+2*e,width:n.width+2*e}},g5=function(n,e){var t=Math.abs(n.x-e.centerX),r=Math.abs(n.y-e.centerY);return t/e.width>r/e.height?_n.HORIZONTAL:_n.VERTICAL},Dd=function(n,e,t){var r=g5(t,e);return r===_n.HORIZONTAL?{x:t.x>n.centerX?n.maxX:n.minX,y:t.y}:{x:t.x,y:t.y>n.centerY?n.maxY:n.minY}},C_=function(n,e){var t=Math.min(n.minX,e.minX),r=Math.min(n.minY,e.minY),i=Math.max(n.maxX,e.maxX),o=Math.max(n.maxY,e.maxY);return{x:(t+i)/2,y:(r+o)/2,centerX:(t+i)/2,centerY:(r+o)/2,minX:t,minY:r,maxX:i,maxY:o,height:o-r,width:i-t}},Hl=function(n,e){n===void 0&&(n=[]);var t=[],r=[];n.forEach(function(f){t.push(f.x),r.push(f.y)});var i=Math.min.apply(Math,Oo([],ai(t),!1)),o=Math.max.apply(Math,Oo([],ai(t),!1)),a=Math.min.apply(Math,Oo([],ai(r),!1)),l=Math.max.apply(Math,Oo([],ai(r),!1)),u=o-i,d=l-a;return e&&(u+=e,d+=e),{centerX:(i+o)/2,centerY:(a+l)/2,maxX:o,maxY:l,minX:i,minY:a,x:(i+o)/2,y:(a+l)/2,height:d,width:u}},Ld=function(n){var e=n.minX,t=n.minY,r=n.maxX,i=n.maxY;return[{x:e,y:t},{x:r,y:t},{x:r,y:i},{x:e,y:i}]},Xu=function(n,e){var t=n.x,r=n.y;return t<e.minX||t>e.maxX||r<e.minY||r>e.maxY},m5=function(n,e){return e<n.minX||e>n.maxX?[]:[{x:e,y:n.minY},{x:e,y:n.maxY}]},y5=function(n,e){return e<n.minY||e>n.maxY?[]:[{x:n.minX,y:e},{x:n.maxX,y:e}]},_5=function(n,e){return Oo(Oo([],ai(m5(n,e.x)),!1),ai(y5(n,e.y)),!1)},Kp=function(n,e){return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},b5=function(n,e){var t=-2,r=0;return e.forEach(function(i){i&&(n.x===i.x&&(r+=t),n.y===i.y&&(r+=t))}),r},k_=function(n,e,t,r,i){return Kp(n,e)+Kp(n,t)+b5(n,[e,t,r,i])},lw=function(n,e,t,r,i){i||(i=0),n.unshift(e[r]),t[r]&&t[r]!==r&&i<=100&&lw(n,e,t,t[r],i+1)},x5=function(n,e){var t=n.indexOf(e);t>-1&&n.splice(t,1)},pl=function(n,e,t,r){var i=e.x-n.x,o=e.y-n.y,a=r.x-t.x,l=r.y-t.y,u=(-o*(n.x-t.x)+i*(n.y-t.y))/(-a*o+i*l),d=(a*(n.y-t.y)-l*(n.x-t.x))/(-a*o+i*l);return u>=0&&u<=1&&d>=0&&d<=1},O_=function(n,e,t){if(t.width===0&&t.height===0)return!1;var r=ai(Ld(t),4),i=r[0],o=r[1],a=r[2],l=r[3];return pl(n,e,i,o)||pl(n,e,i,l)||pl(n,e,o,a)||pl(n,e,a,l)},w5=function(n,e,t,r){var i=[];return n.forEach(function(o){o!==e&&(o.x===e.x||o.y===e.y)&&!O_(o,e,t)&&!O_(o,e,r)&&i.push(o)}),Yp(i)},S5=function(n,e,t,r,i,o,a){var l=[],u=[e],d={},f={},h={};e.id&&(f[e.id]=0,h[e.id]=k_(e,t,e));var v={};n.forEach(function(w){w.id&&(v[w.id]=w)});for(var y=function(){var w,_=1/0;if(u.forEach(function(E){E.id&&h[E.id]<_&&(_=h[E.id],w=E)}),w===t&&t.id){var b=[];return lw(b,v,d,t.id),{value:b}}if(!w)return{value:[e,t]};x5(u,w),l.push(w),w5(n,w,r,i).forEach(function(E){if(l.indexOf(E)===-1&&(u.indexOf(E)===-1&&u.push(E),w!=null&&w.id&&(E!=null&&E.id))){var k=h[w.id]+Kp(w,E);if(f[E.id]&&k>=f[E.id])return;d[E.id]=w.id,f[E.id]=k,h[E.id]=f[E.id]+k_(E,t,e,o,a)}})};u.length;){var x=y();if(typeof x=="object")return x.value}return[e,t]},M_=function(n){return Xr(n)},uw=function(n){for(var e=1;e<n.length-1;){var t=n[e-1],r=n[e],i=n[e+1];t.x===r.x&&r.x===i.x||t.y===r.y&&r.y===i.y?n.splice(e,1):e++}return n},N_=function(n,e,t,r,i){var o=M_(t),a=M_(r),l=Td(o,i),u=Td(a,i),d=Dd(l,o,n),f=Dd(u,a,e);if(v5(l,u)){var h=C5(n,e,d,f);return Oo(Oo([n,d],ai(h),!1),[f,e],!1)}var v=Hl([d,f]),y=C_(l,v),x=C_(u,v),w=[];w=w.concat(Ld(y)),w=w.concat(Ld(x));var _={x:(n.x+e.x)/2,y:(n.y+e.y)/2};[v,y,x].forEach(function(E){w=w.concat(_5(E,_).filter(function(k){return Xu(k,l)&&Xu(k,u)}))}),[{x:d.x,y:f.y},{x:f.x,y:d.y}].forEach(function(E){Xu(E,l)&&Xu(E,u)&&w.push(E)}),w.unshift(d),w.push(f),w=Yp(w);var b=S5(w,d,f,o,a,n,e);return b.unshift(n),b.push(e),b.length>2&&(b=uw(b)),Yp(b)},E5=function(n){if(n.length===1){var e=ai(n,1),t=e[0];return[t,t]}else{for(var r=n[0],i=n[1],o=ki(r.x,r.y,i.x,i.y),a=1;a<n.length-1;a++){var l=n[a],u=n[a+1],d=ki(l.x,l.y,u.x,u.y);d>o&&(o=d,r=l,i=u)}return[r,i]}},A_=function(n,e,t){var r=so(n,t),i=so(e,t);return r&&i},T_=function(n,e,t){var r=so(n,t),i=so(e,t),o=r&&i,a=r||i;return!o&&a},D_=function(n,e,t){for(var r=void 0,i=Xr(t),o=Ld(i),a=0;a<o.length;a++){var l=pl(n,e,o[a],o[(a+1)%o.length]);l&&(r=[o[a],o[(a+1)%o.length]])}if(r)return p5(n,e,r[0],r[1])},Pd=function(n,e){var t=void 0;return n.x===e.x?t=_n.VERTICAL:n.y===e.y&&(t=_n.HORIZONTAL),t},fa=function(n){var e=n.split(" "),t=[];return e&&e.forEach(function(r){var i=ai(r.split(","),2),o=i[0],a=i[1];t.push({x:Number(o),y:Number(a)})}),t},C5=function(n,e,t,r){var i=[],o=Pd(n,t),a=Pd(e,r);if(o===a)n.y===t.y?(i.push({x:t.x,y:(t.y+r.y)/2}),i.push({x:r.x,y:(t.y+r.y)/2})):(i.push({x:(t.x+r.x)/2,y:t.y}),i.push({x:(t.x+r.x)/2,y:r.y}));else{var l={x:t.x,y:r.y},u=Bl(l,n,t),d=Bl(l,e,r);if(u||d)l={x:r.x,y:t.y};else{var f=L_(l,n,t),h=L_(l,e,r);f&&h&&(l={x:r.x,y:t.y})}i.push(l)}return i},L_=function(n,e,t){return n.x===e.x&&n.x===t.x||n.y===e.y&&n.y===t.y},dw=function(n){if(!n)return 0;for(var e=0,t=0;t<n.length;t++){var r=n.charCodeAt(t);n.match(/[A-Z]/)?e+=1.5:r>=1&&r<=126||r>=65376&&r<=65439?e+=1:e+=2}return e},k5=function(n){var e=n.start,t=n.end,r;if(e.x===t.x&&e.y===t.y)r="";else{var i={start:e,end:t,offset:10,verticalLength:5},o=jl(ts(ts({},i),{type:"start"})),a=jl(ts(ts({},i),{type:"end"}));r="M".concat(o.leftX," ").concat(o.leftY,`
    L`).concat(o.rightX," ").concat(o.rightY,`
    L`).concat(a.rightX," ").concat(a.rightY,`
    L`).concat(a.leftX," ").concat(a.leftY," z")}return{d:r,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},P_=function(n){var e=n.start,t=n.end,r=n.sourceNode,i=n.targetNode,o=n.offset,a=Xr(r),l=Xr(i),u=Td(a,o),d=Td(l,o),f=Dd(u,a,e),h=Dd(d,l,t);return{sNext:f,ePre:h}},cg=function(n){var e=n.replace(/M/g,"").replace(/C/g,",").split(","),t=Yu(e[0]),r=Yu(e[1]),i=Yu(e[2]),o=Yu(e[3]);return[t,r,i,o]},Yu=function(n){var e=ai(n.replace(/(^\s*)/g,"").split(" "),2),t=e[0],r=e[1];return{x:+t,y:+r}},R_=function(n,e){var t=ai(n,4),r=t[0],i=t[1],o=t[2],a=t[3],l=gj(r,i,o,a,e);return[l,n[3]]},cw=function(n,e){for(var t=n.x,r=n.y,i=fa(e),o=Number.MAX_SAFE_INTEGER,a,l=[],u=0;u<i.length;u++)l.push({start:i[u],end:i[(u+1)%i.length]});if(l.forEach(function(v){var y=v.start,x=v.end;if(y.x===x.x){var w={x:y.x,y:r},_=Bl(w,y,x);if(_){var b=Math.abs(y.x-t);b<o&&(o=b,a=w)}}else if(y.y===x.y){var w={x:t,y:y.y},_=Bl(w,y,x);if(_){var b=Math.abs(y.y-r);b<o&&(o=b,a=w)}}}),!a){var d=l[0],f=d.start,h=d.end;a={x:f.x+(h.x-f.x)/2,y:f.y+(h.y-f.y)/2}}return a},O5=function(n){return Za(n,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},I_=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))};function M5(n,e){return typeof e!="function"?function(t,r,i){return Object.assign({type:n.edgeType},i)}:function(t,r,i){var o=e(t,r,i);return o?typeof o=="string"?Object.assign({},i,{type:o}):Object.assign({type:o},i):{type:n.edgeType}}}var N5=function(n){var e=n.rows,t=n.rowsLength,r=n.fontSize,i=0;return zt(e,function(o){var a=dw(o);i=a>i?a:i}),{width:Math.ceil(i/2)*r+r/4,height:t*(r+2)+r/4}},Ua=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Ku=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};function ys(n,e,t){return t&&e*Math.round(n/e)||n}function A5(n,e,t){if(!n)return[];var r=Math.min.apply(Math,Ku([],Ua(n.map(function(w){return w[0]})),!1)),i=Math.max.apply(Math,Ku([],Ua(n.map(function(w){return w[0]})),!1)),o=Math.min.apply(Math,Ku([],Ua(n.map(function(w){return w[1]})),!1)),a=Math.max.apply(Math,Ku([],Ua(n.map(function(w){return w[1]})),!1)),l=-r,u=-o,d=n.map(function(w){var _=Ua(w,2),b=_[0],E=_[1];return[b+l,E+u]}),f=i-r,h=a-o,v=e?e/f:1,y=t?t/h:1,x=Math.min(v,y);return d.map(function(w){var _=Ua(w,2),b=_[0],E=_[1];return[b*x,E*x]})}var Vf=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Wf=function(n,e,t){var r=Vf(n,2),i=r[0],o=r[1],a=Vf(e,2),l=a[0],u=a[1],d=Vf(t,2),f=d[0],h=d[1];return i>l&&i<f&&o>u&&o<h},fw=function(n,e){var t=e.multipleSelectKey,r=!1;switch(t){case"meta":r=n.metaKey;break;case"alt":r=n.altKey;break;case"shift":r=n.shiftKey;break;case"ctrl":r=n.ctrlKey;break;default:r=!1;break}return r},fg=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function B_(n,e){return n instanceof ur&&e instanceof ur}var hw=function(n){fg(e,n);function e(t,r,i){var o=n.call(this,3)||this;return o[0]=t,o[1]=r,o[2]=i,o.x=t,o.y=r,o.z=i,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.add=function(t){if(B_(this,t))return new ur(this.x+t.x,this.y+t.y);var r=this.z+t.z;return new Jp((this.x+t.x)/r,(this.y+t.y)/r)},e.prototype.subtract=function(t){if(B_(this,t))return new ur(this.x-t.x,this.y-t.y);var r=this.z-t.z;return r===0?new ur(this.x-t.x,this.y-t.y):new Jp((this.x-t.x)/r,(this.y-t.y)/r)},e}(Array),ur=function(n){fg(e,n);function e(t,r,i){var o=n.call(this,t,r,i??0)||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var r=this;return t.reduce(function(i,o,a){return i+o*r[a]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var r=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return r>=0?i:-i},e}(hw),Jp=function(n){fg(e,n);function e(t,r){var i=n.call(this,t,r,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e}(hw),Ic=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Va=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Gf=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},su=function(n){Ic(e,n);function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=n.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(o,a){i[a]=o}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return Gf([],Va(this.map(function(r){return r[t]})),!1)},e.prototype.transpose=function(){for(var t=[],r=0;r<this.columns;r++)t.push(this.getColumn(r));return new(e.bind.apply(e,Gf([void 0],Va(t),!1)))},e.prototype.cross=function(t){var r=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var o=this.getRow(i),a=function(u){var d=t.getColumn(u);r[i][u]=o.reduce(function(f,h,v){return f+h*d[v]},0)},l=0;l<t.columns;l++)a(l);return new(e.bind.apply(e,Gf([void 0],Va(r),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new Jp(t[0],t[1])})},e.prototype.toString=function(){var t=Va(this[0],2),r=t[0],i=t[1],o=Va(this[1],2),a=o[0],l=o[1],u=Va(this[2],2),d=u[0],f=u[1];return"matrix(".concat(r," ").concat(i," ").concat(a," ").concat(l," ").concat(d," ").concat(f,")")},e.prototype.translate=function(t,r){return this.cross(new Rd(t,r))},e.prototype.rotate=function(t){return this.cross(new T5(t))},e.prototype.scale=function(t,r){return this.cross(new D5(t,r))},e}(Array),T5=function(n){Ic(e,n);function e(t){var r=n.call(this,new ur(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new ur(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new ur(0,0,1))||this;return Object.setPrototypeOf(r,e.prototype),r}return e.prototype.inverse=function(){return this.transpose()},e}(su),D5=function(n){Ic(e,n);function e(t,r){var i=n.call(this,new ur(t,0,0),new ur(0,r,0),new ur(0,0,1))||this;return i.sx=t,i.sy=r,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(su),Rd=function(n){Ic(e,n);function e(t,r){var i=n.call(this,new ur(1,0,0),new ur(0,1,0),new ur(t,r,1))||this;return i.tx=t,i.ty=r,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(su);u6({});var Id=function(){return Id=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Id.apply(this,arguments)},L5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Zp=function(n){var e=n.anchors;return e},Bd=function(n,e){for(var t=e.nodes,r,i=t.length-1;i>=0;i--){var o=t[i],a=I5(n,o);if(a){var l=o.getTargetAnchor(n);if(l){var u={node:o,anchorIndex:l.index,anchor:l.anchor};(!r||P5(o,r.node,e))&&(r=u)}}}return r},P5=function(n,e,t){return n.zIndex>e.zIndex?!0:t.nodesMap[n.id].index>t.nodesMap[e.id].index},R5=function(n,e){for(var t=Zp(e),r,i=Number.MAX_SAFE_INTEGER,o=0;o<t.length;o++){var a=ki(n.x,n.y,t[o].x,t[o].y);a<i&&(i=a,r={index:o,anchor:Id(Id({},t[o]),{x:t[o].x,y:t[o].y,id:t[o].id})})}return r},ki=function(n,e,t,r){return Math.hypot(n-t,e-r)},so=function(n,e,t){t===void 0&&(t=0);var r=!1,i=Xr(e),o=L5(new su([n.x,n.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),a=o[0],l=o[1],u={x:a,y:l};return u.x>=i.minX-t&&u.x<=i.maxX+t&&u.y>=i.minY-t&&u.y<=i.maxY+t&&(r=!0),r},I5=function(n,e){return so(n,e,5)},Xr=function(n){var e=n.x,t=n.y,r=n.width,i=n.height;return{minX:e-r/2,minY:t-i/2,maxX:e+r/2,maxY:t+i/2,x:e,y:t,width:r,height:i,centerX:e,centerY:t}},B5=function(n){var e=n,t=e.x,r=e.y,i=e.width,o=e.height,a=e.radius;return[{x:t-i/2+a,y:r-o/2+a,r:a},{x:t+i/2-a,y:r-o/2+a,r:a},{x:t-i/2+a,y:r+o/2-a,r:a},{x:t+i/2-a,y:r+o/2-a,r:a}]},j_=function(n,e,t){var r=B5(t),i,o=Number.MAX_SAFE_INTEGER;return r.forEach(function(a){var l=ki(n.x,n.y,a.x,a.y);l<o&&(o=l,i=a)}),Qp(n,e,i)},Qp=function(n,e,t){var r,i=t.x,o=t.y,a=t.r;if(e===_n.HORIZONTAL){var l=i-Math.sqrt(a*a-(n.y-o)*(n.y-o)),u=i+Math.sqrt(a*a-(n.y-o)*(n.y-o)),d=Math.abs(l-n.x)<Math.abs(u-n.x)?l:u;r={x:d,y:n.y}}else if(e===_n.VERTICAL){var f=o-Math.sqrt(a*a-(n.x-i)*(n.x-i)),h=o+Math.sqrt(a*a-(n.x-i)*(n.x-i)),v=Math.abs(f-n.y)<Math.abs(h-n.y)?f:h;r={x:n.x,y:v}}return r},H_=function(n,e){var t=e,r=!1,i=t.x,o=t.y,a=t.width,l=t.height,u=t.radius,d={minX:i-a/2+u,maxX:i+a/2-u,minY:o-l/2+u,maxY:o+l/2-u};return n.y===o+l/2||n.y===o-l/2?r=n.x>d.minX&&n.x<d.maxX:(n.x===i+a/2||n.x===i-a/2)&&(r=n.y>d.minY&&n.y<d.maxY),r},$_=function(n,e,t){var r,i=t,o=i.x,a=i.y,l=i.rx,u=i.ry;if(e===_n.HORIZONTAL){var d=o-Math.sqrt(l*l-(n.y-a)*(n.y-a)*l*l/(u*u)),f=o+Math.sqrt(l*l-(n.y-a)*(n.y-a)*l*l/(u*u)),h=Math.abs(d-n.x)<Math.abs(f-n.x)?d:f;r={x:h,y:n.y}}else if(e===_n.VERTICAL){var v=a-Math.sqrt(u*u-(n.x-o)*(n.x-o)*u*u/(l*l)),y=a+Math.sqrt(u*u-(n.x-o)*(n.x-o)*u*u/(l*l)),x=Math.abs(v-n.y)<Math.abs(y-n.y)?v:y;r={x:n.x,y:x}}return r},Ju=function(n,e,t){for(var r=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,o,a=[],l=0;l<r.length;l++)a.push({start:r[l],end:r[(l+1)%r.length]});return a.forEach(function(u){var d=u.start,f=u.end,h=d,v=f;d.x>f.x&&(h=f,v=d);var y={x:n.x,y:n.y};if(h.x===v.x&&e===_n.HORIZONTAL&&(y={x:h.x,y:n.y}),h.y===v.y&&e===_n.VERTICAL&&(y={x:n.x,y:h.y}),h.x!==v.x&&h.y!==v.y){var x=(v.y-h.y)/(v.x-h.x),w=(h.x*v.y-v.x*h.y)/(h.x-v.x);e===_n.HORIZONTAL?y={x:(n.y-w)/x,y:n.y}:e===_n.VERTICAL&&(y={x:n.x,y:x*n.x+w})}var _=Bl(y,d,f);if(_){var b=ki(y.x,y.y,n.x,n.y);b<i&&(i=b,o=y)}}),o},j5=function(n){var e=Za(n,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},F_=function(n,e,t,r){var i=n.x,o=n.y;return e.x>n.x?i=n.x+t/2:e.x<n.x&&(i=n.x-t/2),e.y>n.y?o=n.y+r/2:e.y<n.y&&(o=n.y-r/2),{x:i,y:o}},pw=function(n){var e=n.rows,t=n.style,r=n.rowsLength,i=n.className,o=document.createElement("div");o.className=i,o.style.fontSize="".concat(t.fontSize),o.style.width="".concat(t.width),o.style.lineHeight="".concat(t.lineHeight),o.style.padding="".concat(t.padding),t.fontFamily&&(o.style.fontFamily="".concat(t.fontFamily)),r>1?e.forEach(function(l){var u=document.createElement("div");u.textContent=l,o.appendChild(u)}):o.textContent=e[0],document.body.appendChild(o);var a=o.clientHeight;return document.body.removeChild(o),a},z_=function(n){var e=n.rows,t=n.rowsLength,r=n.fontSize,i=0;return e&&e.forEach(function(o){var a=dw(o);i=a>i?a:i}),{width:Math.ceil(i/2)*r+r/4,height:t*(r+2)+r/4}},jd=function(n){return typeof n!="object"?{isAllPass:!!n,msg:n?"":"不允许连接"}:n};let Zu;const H5=new Uint8Array(16);function $5(){if(!Zu&&(Zu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Zu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zu(H5)}const sr=[];for(let n=0;n<256;++n)sr.push((n+256).toString(16).slice(1));function F5(n,e=0){return sr[n[e+0]]+sr[n[e+1]]+sr[n[e+2]]+sr[n[e+3]]+"-"+sr[n[e+4]]+sr[n[e+5]]+"-"+sr[n[e+6]]+sr[n[e+7]]+"-"+sr[n[e+8]]+sr[n[e+9]]+"-"+sr[n[e+10]]+sr[n[e+11]]+sr[n[e+12]]+sr[n[e+13]]+sr[n[e+14]]+sr[n[e+15]]}const z5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),U_={randomUUID:z5};function U5(n,e,t){if(U_.randomUUID&&!n)return U_.randomUUID();n=n||{};const r=n.random||(n.rng||$5)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,F5(r)}var Ao=function(){return U5()},yl=new Map,vw=function(n){var e=Ao();function t(){n();var i=yl.get(e);if(i){var o=window.requestAnimationFrame(t);yl.set(e,o)}}var r=window.requestAnimationFrame(t);return yl.set(e,r),e},Hd=function(n){var e=yl.get(n);e&&(window.cancelAnimationFrame(e),yl.delete(n))},$l=function(){return $l=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$l.apply(this,arguments)},V5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function gw(n){var e=n.x,t=e===void 0?0:e,r=n.y,i=r===void 0?0:r,o=n.value,a=n.fontSize,l=a===void 0?12:a,u=n.fill,d=u===void 0?"currentColor":u,f=n.overflowMode,h=f===void 0?"default":f,v=n.textWidth,y=v===void 0?void 0:v,x=n.model,w={x:t,y:i,fill:d,fontSize:l,textAnchor:"middle",dominantBaseline:"central"};if(zt(Lo(n),function(N){var I=V5(N,2),T=I[0],L=I[1];typeof L!="object"&&(w[T]=L)}),o){var _=String(o).split(/[\r\n]/g),b=_.length;if(h!=="default"){var E=x.BaseType,k=x.modelType;if(E===kn.NODE&&k!==Wt.TEXT_NODE||E===kn.EDGE&&y)return W5(n)}if(b>1){var O=_.map(function(N,I){var T=l+2,L=(I-(b-1)/2)*T;return He("tspan",{className:"lf-text-tspan",x:t,y:i+L,children:N})});return He("text",$l({},w,{children:O}))}return He("text",$l({},w,{children:o}))}return null}function W5(n){var e=n.x,t=n.y,r=n.value,i=n.model,o=n.textWidth,a=n.fontSize,l=a===void 0?12:a,u=n.lineHeight,d=n.fontFamily,f=d===void 0?"":d,h=n.wrapPadding,v=h===void 0?"0, 0":h,y=n.overflowMode,x=i.width,w=i.height,_=i.textHeight,b=o||x,E=String(r).split(/[\r\n]/g),k=E.length,O=pw({rows:E,style:{fontSize:"".concat(l,"px"),width:"".concat(b,"px"),fontFamily:f,lineHeight:u,padding:v},rowsLength:k,className:"lf-get-text-height"}),N=w>O?w:O;_&&(N=_);var I=y==="ellipsis";return I&&(N=l+2),He("g",{children:He("foreignObject",{width:b,height:N,x:e-b/2,y:t-N/2,style:{overflow:"visible",textAlign:"left"},children:He("div",{className:"lf-node-text-auto-wrap",style:{minHeight:N,width:b,padding:v},children:He("div",{className:I?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:I?E.join(""):"",style:$l({},n),children:E.map(function(T){return He("div",{className:"lf-node-text--auto-wrap-inner",children:T})})})})})})}var ev=function(){return ev=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ev.apply(this,arguments)},G5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function _s(n){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return zt(Lo(n),function(t){var r=G5(t,2),i=r[0],o=r[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),He("line",ev({},e))}var tv=function(){return tv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},tv.apply(this,arguments)},q5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function si(n){var e=n.x,t=n.y,r=n.width,i=n.height,o=n.className,a=n.strokeWidth,l=n.radius,u=l===void 0?0:l,d=e-r/2,f=t-i/2,h={};return h["stroke-width"]=a,zt(Lo(n),function(v){var y=q5(v,2),x=y[0],w=y[1];typeof w!="object"&&(h[x]=w)}),o?h.className="lf-basic-shape ".concat(o):h.className="lf-basic-shape",u&&(h.rx=u,h.ry=u),h.x=d,h.y=f,He("rect",tv({},h))}var nv=function(){return nv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},nv.apply(this,arguments)},X5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function Fl(n){var e={d:""};return zt(Lo(n),function(t){var r=X5(t,2),i=r[0],o=r[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),He("path",nv({},e))}var rv=function(){return rv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},rv.apply(this,arguments)},Y5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function bs(n){var e=n.x,t=e===void 0?0:e,r=n.y,i=r===void 0?0:r,o=n.r,a=o===void 0?4:o,l=n.className,u={cx:t,cy:i,r:a,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return zt(Lo(n),function(d){var f=Y5(d,2),h=f[0],v=f[1];typeof v!="object"&&(u[h]=v)}),l?u.className="lf-basic-shape ".concat(l):u.className="lf-basic-shape",He("circle",rv({},u))}var iv=function(){return iv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},iv.apply(this,arguments)},K5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function J5(n){var e=n.x,t=e===void 0?0:e,r=n.y,i=r===void 0?0:r,o=n.rx,a=o===void 0?4:o,l=n.ry,u=l===void 0?4:l,d=n.className,f={cx:t,cy:i,rx:a,ry:u,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return zt(Lo(n),function(h){var v=K5(h,2),y=v[0],x=v[1];typeof x!="object"&&(f[y]=x)}),d?f.className="lf-basic-shape ".concat(d):f.className="lf-basic-shape",He("ellipse",iv({},f))}var $d=function(){return $d=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$d.apply(this,arguments)},Z5=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function Q5(n,e){var t=n.map(function(E){return{x:E[0],y:E[1]}}),r=t.length;if(r<3)return"";for(var i=Math.abs(e),o="",a=0;a<r;a++){var l=t[(a-1+r)%r],u=t[a],d=t[(a+1)%r],f={x:u.x-l.x,y:u.y-l.y},h={x:d.x-u.x,y:d.y-u.y},v=Math.hypot(f.x,f.y),y=Math.hypot(h.x,h.y),x={x:f.x/v,y:f.y/v},w={x:h.x/y,y:h.y/y},_={x:u.x-x.x*i,y:u.y-x.y*i},b={x:u.x+w.x*i,y:u.y+w.y*i};a===0?o+="M ".concat(_.x," ").concat(_.y," "):o+="L ".concat(_.x," ").concat(_.y," "),o+="Q ".concat(u.x," ").concat(u.y," ").concat(b.x," ").concat(b.y," ")}return o+="Z",o}function hg(n){var e=n.points,t=e===void 0?[]:e,r=n.className,i=n.radius,o={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(zt(Lo(n),function(l){var u=Z5(l,2),d=u[0],f=u[1];typeof f!="object"&&(o[d]=f)}),r?o.classNmae="lf-basic-shape ".concat(r):o.className="lf-basic-shape",i){var a=Q5(t,i);return o.d=a,He("path",$d({},o))}else return o.points=t.map(function(l){return l.join(",")}).join(" "),He("polygon",$d({},o))}var ov=function(){return ov=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ov.apply(this,arguments)},ej=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o};function tj(n){var e=n.className,t={points:"",fill:"none"};return zt(Lo(n),function(r){var i=ej(r,2),o=i[0],a=i[1];(o==="style"||typeof a!="object")&&(t[o]=a)}),e&&(t.className="".concat(e)),He("polyline",ov({},t))}var mw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),zl=function(){return zl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},zl.apply(this,arguments)},nj=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t},rj=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},rn;(function(n){n[n.LEFT_TOP=0]="LEFT_TOP",n[n.RIGHT_TOP=1]="RIGHT_TOP",n[n.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",n[n.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(rn||(rn={}));var ij=function(n){mw(e,n);function e(t){var r=n.call(this)||this;r.isShiftPressed=!1,r.bindKeyboardEvents=function(){document.addEventListener("keydown",r.handleKeyDown),document.addEventListener("keyup",r.handleKeyUp)},r.handleKeyDown=function(l){l.key==="Shift"&&(r.isShiftPressed=!0)},r.handleKeyUp=function(l){l.key==="Shift"&&(r.isShiftPressed=!1)},r.updateEdgePointByAnchors=function(){var l=r.nodeModel,u=l.id,d=l.anchors,f=r.graphModel.getNodeEdges(u);zt(f,function(h){if(h.sourceNodeId===u){var v=da(d,function(y){return y.id===h.sourceAnchorId});v&&h.updateStartPoint({x:v.x,y:v.y})}else if(h.targetNodeId===u){var v=da(d,function(x){return x.id===h.targetAnchorId});v&&h.updateEndPoint({x:v.x,y:v.y})}})},r.triggerResizeEvent=function(l,u,d,f,h,v){r.graphModel.eventCenter.emit(kt.NODE_RESIZE,{preData:l,data:u,deltaX:d,deltaY:f,index:h,model:v})},r.recalcResizeInfo=function(l,u,d,f,h){d===void 0&&(d=1),f===void 0&&(f=!1),h===void 0&&(h=!1);var v=It(u),y=v.deltaX,x=v.deltaY,w=v.width,_=v.height,b=v.PCTResizeInfo;if(b){var E=4,k=0,O=0;switch(l){case rn.LEFT_TOP:O=(y*-1-x)/E;break;case rn.RIGHT_TOP:O=(y-x)/E;break;case rn.RIGHT_BOTTOM:O=(y+x)/E;break;case rn.LEFT_BOTTOM:O=(y*-1+x)/E;break}O!==0&&(k=Math.round(O/b.ResizeBasis.basisHeight*1e5)/1e3),b.ResizePCT.widthPCT=Math.max(Math.min(b.ResizePCT.widthPCT+k,b.ScaleLimit.maxScaleLimit),b.ScaleLimit.minScaleLimit),b.ResizePCT.heightPCT=Math.max(Math.min(b.ResizePCT.heightPCT+k,b.ScaleLimit.maxScaleLimit),b.ScaleLimit.minScaleLimit);var N=Math.round(b.ResizePCT.widthPCT*b.ResizeBasis.basisWidth/100),I=Math.round(b.ResizePCT.heightPCT*b.ResizeBasis.basisHeight/100);switch(l){case rn.LEFT_TOP:y=w-N,x=_-I;break;case rn.RIGHT_TOP:y=N-w,x=_-I;break;case rn.RIGHT_BOTTOM:y=N-w,x=I-_;break;case rn.LEFT_BOTTOM:y=w-N,x=I-_;break}return v}switch(l){case rn.LEFT_TOP:v.width=f?w:w-y*d,v.height=h?_:_-x*d;break;case rn.RIGHT_TOP:v.width=f?w:w+y*d,v.height=h?_:_-x*d;break;case rn.RIGHT_BOTTOM:v.width=f?w:w+y*d,v.height=h?_:_+x*d;break;case rn.LEFT_BOTTOM:v.width=f?w:w-y*d,v.height=h?_:_+x*d;break}return v},r.resizeNode=function(l){var u=l.deltaX,d=l.deltaY,f=r.index,h=r.props,v=h.model,y=h.graphModel,x=h.x,w=h.y;yw({x,y:w,deltaX:u,deltaY:d,index:f,nodeModel:v,graphModel:y,forceProportional:r.isShiftPressed,cancelCallback:function(){r.dragHandler.cancelDrag()}})},r.onDragStart=function(){r.graphModel.selectNodeById(r.nodeModel.id)},r.onDragging=function(l){var u=l.deltaX,d=l.deltaY,f=r.graphModel.transformModel,h=rj(f.fixDeltaXY(u,d),2),v=h[0],y=h[1];r.resizeNode({deltaX:v,deltaY:y})},r.onDragEnd=function(){var l=r.nodeModel.x,u=r.nodeModel.y;r.nodeModel.moveTo(l,u),r.updateEdgePointByAnchors()};var i=t.index,o=t.model,a=t.graphModel;return r.index=i,r.nodeModel=o,r.graphModel=a,r.dragHandler=new fi({onDragStart:r.onDragStart,onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:a.gridSize}),r.bindKeyboardEvents(),r}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,r=t.x,i=t.y,o=t.direction,a=t.model,l=a.getResizeControlStyle(),u=l.width,d=l.height,f=nj(l,["width","height"]);return He("g",{className:"lf-resize-control lf-resize-control-".concat(o),children:[He(si,zl({className:"lf-resize-control-content",x:r,y:i,width:u??7,height:d??7},f)),He(si,{className:"lf-resize-control-content",x:r,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},e}(Zt),oj=function(n){mw(e,n);function e(){return n.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,r=t.model,i=t.graphModel,o=Xr(r),a=o.minX,l=o.minY,u=o.maxX,d=o.maxY,f=[{index:rn.LEFT_TOP,direction:"nw",x:a,y:l},{index:rn.RIGHT_TOP,direction:"ne",x:u,y:l},{index:rn.RIGHT_BOTTOM,direction:"se",x:u,y:d},{index:rn.LEFT_BOTTOM,direction:"sw",x:a,y:d}];return Di(f,function(h){return He(ij,zl({},h,{model:r,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.getResizeOutlineStyle();return He(si,zl({},l,{x:r,y:i,width:o,height:a}))},e.prototype.render=function(){return He("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e}(Zt);function aj(n,e){var t=n.x,r=n.y,i=e.x,o=e.y,a={x:t+(i-t)/2,y:r+(o-r)/2};return a}function vl(n,e,t){var r=sj(t),i=n.x-e.x,o=n.y-e.y,a=i*Math.cos(r)-o*Math.sin(r)+e.x,l=i*Math.sin(r)+o*Math.cos(r)+e.y;return{x:a,y:l}}function sj(n){return n*Math.PI/180}function lj(n){return n/Math.PI*180}function uj(n,e,t,r,i,o,a,l){i===void 0&&(i=!1),o===void 0&&(o=!1);var u={x:t.x-(n.x-t.x),y:t.y-(n.y-t.y)},d=aj(u,e),f=vl(e,d,-r),h=vl(u,d,-r);if(i){var v=Math.abs(f.x-h.x),y=v-a;d.x>f.x?d.x=d.x+y/2:d.x=d.x-y/2}if(o){var x=Math.abs(f.y-h.y),w=x-l;d.y>f.y?d.y=d.y+w/2:d.y=d.y-w/2}if(i||o){var _=vl(h,d,r),b=_.x-u.x,E=_.y-u.y;d.x=d.x-b,d.y=d.y-E,h=vl(u,d,-r),f={x:d.x-(h.x-d.x),y:d.y-(h.y-d.y)}}var k=Math.abs(f.x-h.x),O=Math.abs(f.y-h.y);return i&&(k=a),o&&(O=l),{width:k,height:O,center:d}}function dj(n,e,t,r,i,o,a,l,u){l===void 0&&(l=!1),u===void 0&&(u=!1);var d=e.deltaX,f=e.deltaY,h=e.width,v=e.height,y=lj(t),x={x:r,y:i},w={x:o,y:a},_=vl(x,w,y),b={x:_.x+d,y:_.y+f},E=uj(_,b,w,y,l,u,h,v),k=E.width,O=E.height,N=E.center;return e.width=k*n,e.height=O*n,e.deltaX=(N.x-w.x)*2,e.deltaY=(N.y-w.y)*2,e}var cj=function(n,e,t,r,i,o,a,l,u,d,f){t===void 0&&(t=1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=0),f===void 0&&(f=!1);var h=It(e),v=h.deltaX,y=h.deltaY,x=h.width,w=h.height,_=h.PCTResizeInfo;if(_){var b=4,E=0,k=0;switch(n){case rn.LEFT_TOP:k=(v*-1-y)/b;break;case rn.RIGHT_TOP:k=(v-y)/b;break;case rn.RIGHT_BOTTOM:k=(v+y)/b;break;case rn.LEFT_BOTTOM:k=(v*-1+y)/b;break}k!==0&&(E=Math.round(k/_.ResizeBasis.basisHeight*1e5)/1e3),_.ResizePCT.widthPCT=Math.max(Math.min(_.ResizePCT.widthPCT+E,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit),_.ResizePCT.heightPCT=Math.max(Math.min(_.ResizePCT.heightPCT+E,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit);var O=Math.round(_.ResizePCT.widthPCT*_.ResizeBasis.basisWidth/100),N=Math.round(_.ResizePCT.heightPCT*_.ResizeBasis.basisHeight/100);switch(n){case rn.LEFT_TOP:v=x-O,y=w-N;break;case rn.RIGHT_TOP:v=O-x,y=w-N;break;case rn.RIGHT_BOTTOM:v=O-x,y=N-w;break;case rn.LEFT_BOTTOM:v=x-O,y=N-w;break}return h}if(o%(2*Math.PI)!==0&&a!==void 0&&l!==void 0)return dj(t,h,o,a,l,u,d,r,i);if(f){var I=x/w,T=0,L=x,H=w;switch(n){case rn.LEFT_TOP:T=Math.abs(v)>Math.abs(y)?-v:-y,I>=1?(L=x+T,H=L/I):(H=w+T,L=H*I),h.width=L,h.height=H,h.deltaX=x-L,h.deltaY=w-H;break;case rn.RIGHT_TOP:T=Math.abs(v)>Math.abs(y)?v:-y,I>=1?(L=x+T,H=L/I):(H=w-T,L=H*I),h.width=L,h.height=H,h.deltaX=L-x,h.deltaY=w-H;break;case rn.RIGHT_BOTTOM:T=Math.abs(v)>Math.abs(y)?v:y,I>=1?(L=x+T,H=L/I):(H=w+T,L=H*I),h.width=L,h.height=H,h.deltaX=L-x,h.deltaY=H-w;break;case rn.LEFT_BOTTOM:T=Math.abs(v)>Math.abs(y)?-v:y,I>=1?(L=x-T,H=L/I):(H=w+T,L=H*I),h.width=L,h.height=H,h.deltaX=x-L,h.deltaY=H-w;break}return h}switch(n){case rn.LEFT_TOP:h.width=r?x:x-v*t,h.height=i?w:w-y*t;break;case rn.RIGHT_TOP:h.width=r?x:x+v*t,h.height=i?w:w-y*t;break;case rn.RIGHT_BOTTOM:h.width=r?x:x+v*t,h.height=i?w:w+y*t;break;case rn.LEFT_BOTTOM:h.width=r?x:x-v*t,h.height=i?w:w+y*t;break}return h},fj=function(n,e){var t=n.id,r=n.anchors,i=e.getNodeEdges(t);zt(i,function(o){if(o.sourceNodeId===t){var a=da(r,function(l){return l.id===o.sourceAnchorId});a&&o.updateStartPoint({x:a.x,y:a.y})}else if(o.targetNodeId===t){var a=da(r,function(u){return u.id===o.targetAnchorId});a&&o.updateEndPoint({x:a.x,y:a.y})}})},hj=function(n,e,t,r,i,o,a){a.eventCenter.emit(kt.NODE_RESIZE,{preData:n,data:e,deltaX:t,deltaY:r,index:i,model:o})},yw=function(n){var e=n.x,t=n.y,r=n.deltaX,i=n.deltaY,o=n.index,a=n.nodeModel,l=n.graphModel,u=n.cancelCallback,d=n.forceProportional,f=d===void 0?!1:d,h=a.r,v=a.rx,y=a.ry,x=a.width,w=a.height,_=a.PCTResizeInfo,b=a.minWidth,E=a.minHeight,k=a.maxWidth,O=a.maxHeight,N=a.rotate,I=a.x,T=a.y,L=b===k,H=E===O,X={width:h||v||x,height:h||y||w,deltaX:r,deltaY:i,PCTResizeInfo:_},V=h||v&&y?1/2:1,q=e,D=t,W=cj(o,X,V,L,H,N,q,D,I,T,f);if(W.width<b||W.width>k||W.height<E||W.height>O){u==null||u();return}(N%(2*Math.PI)==0||_||q===void 0||D===void 0)&&(W.deltaX=L?0:W.deltaX,W.deltaY=H?0:W.deltaY);var $=a.getData(),pe=a.resize(W);$.x===pe.x&&$.y===pe.y||(fj(a,l),hj($,pe,r,i,o,a,l))},pj=100,vj={x:1,y:0};function gj(n,e,t,r,i){for(var o=function(y){if(y<0||y>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:n.x*Math.pow(1-y,3)+3*e.x*y*Math.pow(1-y,2)+3*t.x*Math.pow(y,2)*(1-y)+r.x*Math.pow(y,3),y:n.y*Math.pow(1-y,3)+3*e.y*y*Math.pow(1-y,2)+3*t.y*Math.pow(y,2)*(1-y)+r.y*Math.pow(y,3)}},a=0,l=2,u=r.x,d=r.y,f=r;a<i&&l<50;){f=o(1-l/pj);var h=f.x,v=f.y;a=ki(u,d,h,v),l++}return f}function mj(n,e){return n.x*e.y-n.y*e.x}function yj(n,e){var t=[n.x,n.y,n.z],r=[e.x,e.y,e.z];return r.reduce(function(i,o,a){return i+o*t[a]})}function _j(n,e){var t=mj(n,e),r=Math.acos(yj(V_(n),V_(e)));return t>=0?r:-r}function V_(n){var e=Math.hypot(n.x,n.y);return{x:n.x/e,y:n.y/e,z:0}}function bj(n){return _j(vj,n)}function xj(n){return n*(180/Math.PI)}var _w={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},wj={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Sj={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Ej={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Ul={colorful:Ej,dark:Sj,radius:wj,default:_w},Cj={background:"#23272e"},kj={background:"#fefeff"},av={background:"#ffffff"},Vl={colorful:kj,dark:Cj,radius:av,default:av},Oj={color:"#66676a",thickness:1},Mj={color:"#dadada",thickness:1},sv={color:"#acacac",thickness:1},Wl={colorful:Mj,dark:Oj,radius:sv,default:sv},bw=function(n,e){var t=It(_w);return e&&(t=ss(t,Ul[e])),n&&(t=ss(t,n)),t},Nj=function(n,e){if(Ul[n]){console.warn("theme mode ".concat(n," already exists"));return}Ul[n]=e,Vl[n]=e.background||av,Wl[n]=e.grid||sv},Aj=function(n){delete Ul[n],delete Vl[n],delete Wl[n]},W_=function(){var n={colorful:{},dark:{},radius:{},default:{}};on(Ul,n),on(Vl,n),on(Wl,n)},Tj=bw,Dj=1e3,Lj=999,pg=function(){return++Dj},Pj=function(){return--Lj},$n=function(){return $n=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$n.apply(this,arguments)},Dt=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Bc=function(){function n(e,t){var r;this.BaseType=kn.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=ui.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=tn.DEFAULT,this.modelType=Wt.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(r=e.properties)!==null&&r!==void 0?r:{},this.initEdgeData(e),this.setAttributes()}return n.prototype.initEdgeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,r=t&&t(e.type),i=this.createId();e.id=i||r||Ao()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var o=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=o,on(this,O5(e));var a=this.graphModel.overlapMode;a===Ci.INCREASE&&(this.zIndex=e.zIndex||pg()),this.setAnchors(),this.initPoints(),this.formatText(e)},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.getEdgeStyle=function(){return $n($n({},this.graphModel.theme.baseEdge),this.style)},n.prototype.getAdjustPointStyle=function(){return $n({},this.graphModel.theme.edgeAdjust)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return It(e)},n.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return It(e)},n.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),r=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return $n($n($n({},e),{fill:i,stroke:i}),r)},n.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return It(t)},n.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(n.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),n.prototype.getBeginAnchor=function(e,t,r){var i,o,a=Zp(e);if(r){if(i=da(a,function(l){return l.id===r}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(r,"，已使用默认锚点作为起点"))}return a.forEach(function(l){var u=I_(l,t);(o===void 0||u<o)&&(o=u,i=l)}),i},n.prototype.getEndAnchor=function(e,t){var r=this,i,o,a=Zp(e);if(t){if(i=da(a,function(l){return l.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return a.forEach(function(l){if(r.startPoint){var u=I_(l,r.startPoint);(o===void 0||u<o)&&(o=u,i=l)}}),i},n.prototype.getProperties=function(){return wi(this.properties)},n.prototype.getData=function(){var e=this.properties;gs(e)&&(e=wi(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:on({},this.startPoint),endPoint:on({},this.endPoint)};this.graphModel.overlapMode===Ci.INCREASE&&(t.zIndex=this.zIndex);var r=this.text,i=r.x,o=r.y,a=r.value;return a&&(t.text={x:i,y:o,value:a}),t},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.setProperty=function(e,t){sg(this.properties,e,mr(t)),this.setAttributes()},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setProperties=function(e){this.properties=$n($n({},wi(this.properties)),mr(e)),this.setAttributes()},n.prototype.changeEdgeId=function(e){var t=this.arrowConfig,r=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),r&&r==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},n.prototype.setStyle=function(e,t){var r;this.style=$n($n({},this.style),(r={},r[e]=mr(t),r))},n.prototype.setStyles=function(e){this.style=$n($n({},this.style),mr(e))},n.prototype.updateStyles=function(e){this.style=$n({},mr(e))},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,r,i,o=this.graphModel.editConfigModel,a=o.edgeTextDraggable,l=o.edgeTextEdit,u=this.textPosition,d=u.x,f=u.y,h=e.text,v={value:"",x:d,y:f,draggable:a,editable:l};h&&(typeof h=="string"?v=$n($n({},v),{value:h}):(v=$n($n({},v),{x:(t=h.x)!==null&&t!==void 0?t:d,y:(r=h.y)!==null&&r!==void 0?r:f,value:(i=h.value)!==null&&i!==void 0?i:""}),ls(h.draggable)||(v.draggable=h.draggable),ls(h.editable)||(v.editable=h.editable))),this.text=v},n.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,r=e.y;this.text.x=t,this.text.y=r},n.prototype.moveText=function(e,t){var r=this.text,i=r.x,o=r.y,a=r.value,l=r.draggable,u=r.editable;this.text={value:a,editable:u,draggable:l,x:i+e,y:o+t}},n.prototype.setText=function(e){e&&on(this.text,e)},n.prototype.updateText=function(e){this.text=$n($n({},wi(this.text)),{value:e})},n.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.openEdgeAnimation=function(){this.isAnimation=!0},n.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateStartPoint=function(e){this.startPoint=e},n.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},n.prototype.updateEndPoint=function(e){this.endPoint=e},n.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},n.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},n.prototype.initPoints=function(){},n.prototype.updateAttributes=function(e){on(this,e)},n.prototype.getAdjustStart=function(){return this.startPoint},n.prototype.getAdjustEnd=function(){return this.endPoint},n.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,r=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:r.x,y:r.y})},n.BaseType=kn.EDGE,Dt([$e],n.prototype,"type",void 0),Dt([$e],n.prototype,"sourceNodeId",void 0),Dt([$e],n.prototype,"targetNodeId",void 0),Dt([$e],n.prototype,"startPoint",void 0),Dt([$e],n.prototype,"endPoint",void 0),Dt([$e],n.prototype,"textMode",void 0),Dt([$e],n.prototype,"text",void 0),Dt([$e],n.prototype,"properties",void 0),Dt([$e],n.prototype,"points",void 0),Dt([$e],n.prototype,"pointsList",void 0),Dt([$e],n.prototype,"isSelected",void 0),Dt([$e],n.prototype,"isHovered",void 0),Dt([$e],n.prototype,"isHitable",void 0),Dt([$e],n.prototype,"isHittable",void 0),Dt([$e],n.prototype,"draggable",void 0),Dt([$e],n.prototype,"visible",void 0),Dt([$e],n.prototype,"isAnimation",void 0),Dt([$e],n.prototype,"isShowAdjustPoint",void 0),Dt([$e],n.prototype,"zIndex",void 0),Dt([$e],n.prototype,"state",void 0),Dt([$e],n.prototype,"style",void 0),Dt([$e],n.prototype,"arrowConfig",void 0),Dt([hn],n.prototype,"sourceNode",null),Dt([hn],n.prototype,"targetNode",null),Dt([hn],n.prototype,"textPosition",null),Dt([je],n.prototype,"setProperty",null),Dt([je],n.prototype,"deleteProperty",null),Dt([je],n.prototype,"setProperties",null),Dt([je],n.prototype,"changeEdgeId",null),Dt([je],n.prototype,"setStyle",null),Dt([je],n.prototype,"setStyles",null),Dt([je],n.prototype,"updateStyles",null),Dt([je],n.prototype,"setTextMode",null),Dt([je],n.prototype,"formatText",null),Dt([je],n.prototype,"resetTextPosition",null),Dt([je],n.prototype,"moveText",null),Dt([je],n.prototype,"setText",null),Dt([je],n.prototype,"updateText",null),Dt([je],n.prototype,"setAnchors",null),Dt([je],n.prototype,"setSelected",null),Dt([je],n.prototype,"setHovered",null),Dt([je],n.prototype,"setHitable",null),Dt([je],n.prototype,"setHittable",null),Dt([je],n.prototype,"openEdgeAnimation",null),Dt([je],n.prototype,"closeEdgeAnimation",null),Dt([je],n.prototype,"setElementState",null),Dt([je],n.prototype,"updateStartPoint",null),Dt([je],n.prototype,"moveStartPoint",null),Dt([je],n.prototype,"updateEndPoint",null),Dt([je],n.prototype,"moveEndPoint",null),Dt([je],n.prototype,"setZIndex",null),Dt([je],n.prototype,"initPoints",null),Dt([je],n.prototype,"updateAttributes",null),Dt([je],n.prototype,"getAdjustStart",null),Dt([je],n.prototype,"getAdjustEnd",null),Dt([je],n.prototype,"updateAfterAdjustStartAndEnd",null),n}(),Rj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),na=function(){return na=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},na.apply(this,arguments)},ni=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},qf=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},lv=function(n){Rj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=Zl(t,"properties.offset",100),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,r=n.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return na(na(na({},r),It(t)),It(o))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,r=0;return this.pointsList.forEach(function(i){var o=i.x,a=i.y;t+=o,r+=a}),{x:t/this.pointsList.length,y:r/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=n.prototype.getData.call(this),r=this.pointsList.map(function(i){var o=i.x,a=i.y;return{x:o,y:a}});return na(na({},t),{pointsList:r})},e.prototype.getControls=function(){var t=this.startPoint,r=this.endPoint,i=P_({start:t,end:r,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var r=qf(t,4),i=r[0],o=r[1],a=r[2],l=r[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(o.x," ").concat(o.y,`,
    `).concat(a.x," ").concat(a.y,`,
    `).concat(l.x," ").concat(l.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),r=t.sNext,i=t.ePre;this.updatePath(r,i)},e.prototype.updatePath=function(t,r){t=It(t),r=It(r);var i={x:this.startPoint.x,y:this.startPoint.y},o={x:this.endPoint.x,y:this.endPoint.y};if(!t||!r){var a=this.getControls();t=a.sNext,r=a.ePre}this.pointsList=[i,t,r,o],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,r){this.startPoint.x+=t,this.startPoint.y+=r;var i=qf(this.pointsList,3),o=i[1],a=i[2];o.x+=t,o.y+=r,this.updatePath(o,a)},e.prototype.moveEndPoint=function(t,r){this.endPoint.x+=t,this.endPoint.y+=r;var i=qf(this.pointsList,3),o=i[1],a=i[2];a.x+=t,a.y+=r,this.updatePath(o,a)},e.prototype.updateAdjustAnchor=function(t,r){var i;r==="sNext"?this.pointsList[1]=t:r==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var r=t.startPoint,i=t.endPoint,o=t.sourceNode,a=t.targetNode,l=P_({start:r,end:i,sourceNode:o,targetNode:a,offset:this.offset}),u=l.sNext,d=l.ePre;this.pointsList=[r,u,d,i],this.initPoints()},ni([$e],e.prototype,"offset",void 0),ni([$e],e.prototype,"path",void 0),ni([je],e.prototype,"initPoints",null),ni([je],e.prototype,"updatePoints",null),ni([je],e.prototype,"updateStartPoint",null),ni([je],e.prototype,"updateEndPoint",null),ni([je],e.prototype,"moveStartPoint",null),ni([je],e.prototype,"moveEndPoint",null),ni([je],e.prototype,"updateAdjustAnchor",null),ni([je],e.prototype,"getAdjustStart",null),ni([je],e.prototype,"getAdjustEnd",null),ni([je],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(Bc),Ij=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_l=function(){return _l=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_l.apply(this,arguments)},G_=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Bj=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},q_=function(n){Ij(e,n);function e(){var t=n.apply(this,Bj([],G_(arguments),!1))||this;return t.modelType=Wt.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,r=n.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return _l(_l(_l({},r),It(t)),It(o))},e.prototype.initEdgeData=function(t){n.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var r=G_(t,2),i=r[0],o=r[1];return"".concat(i.x,",").concat(i.y," ").concat(o.x,",").concat(o.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(Bc),jj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bl=function(){return bl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},bl.apply(this,arguments)},ar=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},X_=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Hj=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},xs=function(n){jj(e,n);function e(){var t=n.apply(this,Hj([],X_(arguments),!1))||this;return t.modelType=Wt.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=Zl(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,r=n.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return bl(bl(bl({},r),It(t)),It(o))},e.prototype.getTextPosition=function(){var t,r=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!r){var i=this.dbClickPosition,o=i.x,a=i.y;return{x:o,y:a}}var l=fa(this.points),u=X_(E5(l),2),d=u[0],f=u[1];return{x:(d.x+f.x)/2,y:(d.y+f.y)/2}},e.prototype.getAfterAnchor=function(t,r,i){var o,a;return i.forEach(function(l){var u;t===_n.HORIZONTAL?u=Math.abs(r.y-l.y):t===_n.VERTICAL&&(u=Math.abs(r.x-l.x)),(!a||a>u)&&(a=u,o=l)}),o},e.prototype.getCrossPoint=function(t,r,i){var o;return t===_n.HORIZONTAL?o={x:i.x,y:r.y}:t===_n.VERTICAL&&(o={x:r.x,y:i.y}),o},e.prototype.removeCrossPoints=function(t,r,i){var o=i.map(function(b){return b});if(t===1){var a=o[t],l=o[r],u=o[t-1],d=A_(u,a,this.sourceNode);if(d){var f=T_(a,l,this.sourceNode);if(f){var h=D_(a,l,this.sourceNode);h&&(o[t]=h,o.splice(t-1,1),t--,r--)}}else{var v=this.sourceNode.anchors;v.forEach(function(b){if(b.x===u.x&&b.x===a.x||b.y===u.y&&b.y===a.y){var E=ki(b.x,b.y,a.x,a.y),k=ki(u.x,u.y,a.x,a.y);E<k&&(o[t-1]=b)}})}}if(r===i.length-2){var y=o[t],x=o[r],w=o[r+1],_=A_(x,w,this.targetNode);if(_){var f=T_(y,x,this.targetNode);if(f){var h=D_(y,x,this.targetNode);h&&(o[r]=h,o.splice(r+1,1))}}else{var v=this.targetNode.anchors;v.forEach(function(E){if(E.x===w.x&&E.x===x.x||E.y===w.y&&E.y===x.y){var k=ki(E.x,E.y,x.x,x.y),O=ki(w.x,w.y,x.x,x.y);k<O&&(o[r+1]=E)}})}}return o},e.prototype.getDraggingPoints=function(t,r,i,o,a){var l=a.map(function(f){return f}),u=this.getAfterAnchor(t,i,o),d=this.getCrossPoint(t,i,u);return r==="start"?(l.unshift(d),l.unshift(u)):(l.push(d),l.push(u)),l},e.prototype.updateCrossPoints=function(t){var r=t.map(function(E){return E}),i=t[0],o=t[1],a=t[r.length-2],l=t[r.length-1],u=this,d=u.sourceNode,f=u.targetNode,h=d.modelType,v=f.modelType,y=Pd(i,o),x=r[0];switch(h){case Wt.RECT_NODE:if(d.radius!==0){var w=H_(i,d);w||(x=j_(i,y,d))}break;case Wt.CIRCLE_NODE:x=Qp(i,y,d);break;case Wt.ELLIPSE_NODE:x=$_(i,y,d);break;case Wt.DIAMOND_NODE:x=Ju(i,y,d);break;case Wt.POLYGON_NODE:x=Ju(i,y,d);break}x&&(r[0]=x);var _=Pd(a,l),b=r[r.length-1];switch(v){case Wt.RECT_NODE:if(f.radius!==0){var w=H_(l,f);w||(b=j_(l,_,f))}break;case Wt.CIRCLE_NODE:b=Qp(l,_,f);break;case Wt.ELLIPSE_NODE:b=$_(l,_,f);break;case Wt.DIAMOND_NODE:b=Ju(l,_,f);break;case Wt.POLYGON_NODE:b=Ju(l,_,f);break}return b&&(r[r.length-1]=b),r},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=n.prototype.getData.call(this),r=this.pointsList.map(function(i){var o=i.x,a=i.y;return{x:o,y:a}});return Object.assign({},t,{pointsList:r})},e.prototype.getPath=function(t){return t.map(function(r){return"".concat(r.x,",").concat(r.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=N_({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(r){return"".concat(r.x,",").concat(r.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,r){this.startPoint.x+=t,this.startPoint.y+=r,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,r){this.endPoint.x+=t,this.endPoint.y+=r,this.updatePoints()},e.prototype.updatePointsList=function(t,r){this.pointsList.forEach(function(a){a.x+=t,a.y+=r});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var o=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},o),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,r){var i;this.isDragging=!0;var o=t.start,a=t.end,l=t.startIndex,u=t.endIndex,d=t.direction,f=this.pointsList,h=f;return d===_n.HORIZONTAL?(f[l]={x:o.x,y:o.y+r.y},f[u]={x:a.x,y:a.y+r.y},h=this.pointsList.map(function(v){return v})):d===_n.VERTICAL&&(f[l]={x:o.x+r.x,y:o.y},f[u]={x:a.x+r.x,y:a.y},h=this.pointsList.map(function(v){return v})),this.updatePointsAfterDrag(h),this.draggingPointList=h,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition)),{start:on({},f[l]),end:on({},f[u]),startIndex:l,endIndex:u,direction:d}},e.prototype.dragAppend=function(t,r){var i;this.isDragging=!0;var o=t.start,a=t.end,l=t.startIndex,u=t.endIndex,d=t.direction,f=this.pointsList;if(d===_n.HORIZONTAL){f[l]={x:o.x,y:o.y+r.y},f[u]={x:a.x,y:a.y+r.y};var h=this.pointsList.map(function(_){return _});if(l!==0&&u!==this.pointsList.length-1&&(h=this.removeCrossPoints(l,u,h)),l===0){var v={x:o.x,y:o.y+r.y},y=so(v,this.sourceNode);if(!y){var x=this.sourceNode.anchors;h=this.getDraggingPoints(d,"start",v,x,h)}}if(u===this.pointsList.length-1){var w={x:a.x,y:a.y+r.y},y=so(w,this.targetNode);if(!y){var x=this.targetNode.anchors;h=this.getDraggingPoints(d,"end",w,x,h)}}this.updatePointsAfterDrag(h),this.draggingPointList=h}else if(d===_n.VERTICAL){f[l]={x:o.x+r.x,y:o.y},f[u]={x:a.x+r.x,y:a.y};var h=this.pointsList.map(function(b){return b});if(l!==0&&u!==this.pointsList.length-1&&(h=this.removeCrossPoints(l,u,h)),l===0){var v={x:o.x+r.x,y:o.y},y=so(v,this.sourceNode);if(!y){var x=this.sourceNode.anchors;h=this.getDraggingPoints(d,"start",v,x,h)}}if(u===this.pointsList.length-1){var w={x:a.x+r.x,y:a.y},y=so(w,this.targetNode);if(!y){var x=this.targetNode.anchors;h=this.getDraggingPoints(d,"end",w,x,h)}}this.updatePointsAfterDrag(h),this.draggingPointList=h}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition)),{start:on({},f[l]),end:on({},f[u]),startIndex:l,endIndex:u,direction:d}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=uw(fa(this.points));this.pointsList=t.map(function(o){return o}),this.draggingPointList=[];var r=t[0];this.startPoint=on({},r);var i=t[t.length-1];this.endPoint=on({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var r=this.updateCrossPoints(t);this.points=r.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var r=t.startPoint,i=t.endPoint,o=t.sourceNode,a=t.targetNode;this.pointsList=N_({x:r.x,y:r.y},{x:i.x,y:i.y},o,a,this.offset||0),this.initPoints()},ar([$e],e.prototype,"offset",void 0),ar([$e],e.prototype,"dbClickPosition",void 0),ar([je],e.prototype,"initPoints",null),ar([je],e.prototype,"updatePoints",null),ar([je],e.prototype,"updateStartPoint",null),ar([je],e.prototype,"moveStartPoint",null),ar([je],e.prototype,"updateEndPoint",null),ar([je],e.prototype,"moveEndPoint",null),ar([je],e.prototype,"updatePointsList",null),ar([je],e.prototype,"dragAppendStart",null),ar([je],e.prototype,"dragAppendSimple",null),ar([je],e.prototype,"dragAppend",null),ar([je],e.prototype,"dragAppendEnd",null),ar([je],e.prototype,"updatePointsAfterDrag",null),ar([je],e.prototype,"getAdjustStart",null),ar([je],e.prototype,"getAdjustEnd",null),ar([je],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(Bc),Kn=function(){return Kn=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Kn.apply(this,arguments)},jt=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Y_=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},$j=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Bo=function(){function n(e,t){var r;this.BaseType=kn.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=ui.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=tn.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=Wt.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(r=e.properties)!==null&&r!==void 0?r:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,r=t.x,i=r===void 0?0:r,o=t.y,a=o===void 0?0:o;this.transform=new Rd(-i,-a).rotate(e).translate(i,a).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),n.prototype.initNodeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,r=t&&t(e.type),i=this.createId();e.id=i||r||Ao()}this.formatText(e),on(this,j5(e));var o=this.graphModel.overlapMode;o===Ci.INCREASE&&(this.zIndex=e.zIndex||pg())},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,r,i,o=this.graphModel.editConfigModel,a=o.nodeTextDraggable,l=o.nodeTextEdit,u=e.x,d=e.y,f=e.text,h={value:"",x:u,y:d,draggable:a,editable:l};f&&(typeof f=="string"?h.value=f:(h=Kn(Kn({},h),{x:(t=f.x)!==null&&t!==void 0?t:u,y:(r=f.y)!==null&&r!==void 0?r:d,value:(i=f.value)!==null&&i!==void 0?i:""}),ls(f.draggable)||(h.draggable=f.draggable),ls(f.editable)||(h.editable=f.editable))),e.text=h},n.prototype.resize=function(e){var t=e.width,r=e.height,i=e.deltaX,o=e.deltaY,a=this.isAllowResizeNode(i,o,t,r);return a?(this.move(i/2,o/2),this.width=t,this.height=r,this.setProperties({width:t,height:r}),this.getData()):this.getData()},n.prototype.proportionalResize=function(){},n.prototype.getData=function(){var e=this.text,t=e.x,r=e.y,i=e.value,o=this.properties;gs(o)&&(o=wi(o)),Er(o.width)&&(o.width=this.width),Er(o.height)&&(o.height=this.height);var a={id:this.id,type:this.type,x:this.x,y:this.y,properties:o};return this.rotate&&(a.rotate=this.rotate),this.graphModel.overlapMode===Ci.INCREASE&&(a.zIndex=this.zIndex),i&&(a.text={x:t,y:r,value:i}),a},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.getProperties=function(){return wi(this.properties)},n.prototype.getOuterGAttributes=function(){return{className:""}},n.prototype.getNodeStyle=function(){return Kn(Kn({},this.graphModel.theme.baseNode),this.style)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,r=t===void 0?{}:t;return Kn(Kn({},It(e)),It(r))},n.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return It(e)},n.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return It(e)},n.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return It(e)},n.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return It(t)},n.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return It(t)},n.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return It(e)},n.prototype.isAllowConnectedAsSource=function(e,t,r,i){var o=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var a=!0,l="",u=0;u<o.length;u++){var d=o[u];if(!d.validate.call(this,this,e,t,r,i)){a=!1,l=d.message;break}}return{isAllPass:a,msg:l}},n.prototype.getConnectedSourceRules=function(){return this.sourceRules},n.prototype.isAllowConnectedAsTarget=function(e,t,r,i){var o=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var a=!0,l="",u=0;u<o.length;u++){var d=o[u];if(!d.validate.call(this,e,this,t,r,i)){a=!1,l=d.message;break}}return{isAllPass:a,msg:l}},n.prototype.isAllowMoveNode=function(e,t){var r,i,o=!0,a=!0,l=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var u=Y_(l),d=u.next();!d.done;d=u.next()){var f=d.value,h=f(this,e,t);if(!h)return!1;if(typeof h=="object"){var v=h;if(!v.x&&!v.y)return!1;o=o&&v.x,a=a&&v.y}}}catch(y){r={error:y}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return{x:o,y:a}},n.prototype.getConnectedTargetRules=function(){return this.targetRules},n.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,r=e.id,i=e.x,o=e.y;return t&&t.length>0?t.map(function(a,l){return a.length?(a=a,{id:"".concat(r,"_").concat(l),x:i+a[0],y:o+a[1]}):(a=a,Kn(Kn({},a),{x:i+a.x,y:o+a.y,id:a.id||"".concat(r,"_").concat(l)}))}):this.getDefaultAnchor()},n.prototype.getDefaultAnchor=function(){return[]},n.prototype.getTargetAnchor=function(e){return R5(e,this)},n.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(n.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,r=t.x,i=t.y,o=t.rotate;return e.forEach(function(a){var l=a.x,u=a.y,d=$j(new su([l,u,1]).translate(-r,-i).rotate(o).translate(r,i)[0],2),f=d[0],h=d[1];a.x=f,a.y=h}),e},enumerable:!1,configurable:!0}),n.prototype.getAnchorInfo=function(e){if(!Er(e))for(var t=0;t<this.anchors.length;t++){var r=this.anchors[t];if(r.id===e)return r}},n.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},n.prototype.isAllowMoveByXORY=function(e,t,r){var i,o;if(r)i=!0,o=!0;else{var a=this.isAllowMoveNode(e,t);typeof a=="boolean"?(i=a,o=a):(i=a.x,o=a.y)}return{isAllowMoveX:i,isAllowMoveY:o}},n.prototype.move=function(e,t,r){r===void 0&&(r=!1);var i=this.isAllowMoveByXORY(e,t,r),o=i.isAllowMoveX,a=i.isAllowMoveY;return o&&(this.x=this.x+e,this.text&&this.moveText(e,0)),a&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(o||a)&&(this.rotate=this._rotate),o||a},n.prototype.getMoveDistance=function(e,t,r){r===void 0&&(r=!1);var i=this.isAllowMoveByXORY(e,t,r),o=i.isAllowMoveX,a=i.isAllowMoveY,l=0,u=0;return o&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),l=e),a&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),u=t),this.transform=new Rd(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[l,u]},n.prototype.moveTo=function(e,t,r){r===void 0&&(r=!1);var i=e-this.x,o=t-this.y;return!r&&!this.isAllowMoveNode(i,o)?!1:(this.text&&this.moveText(i,o),this.x=e,this.y=t,!0)},n.prototype.moveText=function(e,t){var r=this.text,i=r.x,o=r.y,a=r.value,l=r.draggable,u=r.editable;this.text={value:a,editable:u,draggable:l,x:i+e,y:o+t}},n.prototype.updateText=function(e){this.text=Kn(Kn({},wi(this.text)),{value:e})},n.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},n.prototype.isAllowResizeNode=function(e,t,r,i){var o,a,l=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var u=Y_(l),d=u.next();!d.done;d=u.next()){var f=d.value,h=f(this,e,t,r,i);if(!h)return!1}}catch(v){o={error:v}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}return!0},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},n.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},n.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},n.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateProperties=function(e,t){var r=wi(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(kt.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:r,properties:e})},n.prototype.setProperty=function(e,t){var r=wi(this.properties),i=It(r);F2(i,e,mr(t)),this.updateProperties(i,[e])},n.prototype.setProperties=function(e){var t=wi(this.properties),r=Kn(Kn({},t),mr(e)),i=[];z2(e,function(o,a){(Ll(t,a)&&t[a]!==o||!Ll(t,a))&&i.push(a)}),this.updateProperties(r,i)},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setStyle=function(e,t){var r;this.style=Kn(Kn({},this.style),(r={},r[e]=mr(t),r))},n.prototype.setStyles=function(e){this.style=Kn(Kn({},this.style),mr(e))},n.prototype.updateStyles=function(e){this.style=Kn({},mr(e))},n.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},n.prototype.updateAttributes=function(e){on(this,e)},n.BaseType=kn.NODE,jt([$e],n.prototype,"type",void 0),jt([$e],n.prototype,"x",void 0),jt([$e],n.prototype,"y",void 0),jt([$e],n.prototype,"textMode",void 0),jt([$e],n.prototype,"text",void 0),jt([$e],n.prototype,"properties",void 0),jt([$e],n.prototype,"_width",void 0),jt([$e],n.prototype,"_height",void 0),jt([$e],n.prototype,"anchorsOffset",void 0),jt([$e],n.prototype,"isSelected",void 0),jt([$e],n.prototype,"isHovered",void 0),jt([$e],n.prototype,"isShowAnchor",void 0),jt([$e],n.prototype,"isDragging",void 0),jt([$e],n.prototype,"isHitable",void 0),jt([$e],n.prototype,"isHittable",void 0),jt([$e],n.prototype,"draggable",void 0),jt([$e],n.prototype,"visible",void 0),jt([$e],n.prototype,"rotatable",void 0),jt([$e],n.prototype,"resizable",void 0),jt([$e],n.prototype,"zIndex",void 0),jt([$e],n.prototype,"state",void 0),jt([$e],n.prototype,"autoToFront",void 0),jt([$e],n.prototype,"style",void 0),jt([$e],n.prototype,"transform",void 0),jt([$e],n.prototype,"_rotate",void 0),jt([hn],n.prototype,"incoming",null),jt([hn],n.prototype,"outgoing",null),jt([je],n.prototype,"setTextMode",null),jt([je],n.prototype,"addNodeMoveRules",null),jt([je],n.prototype,"move",null),jt([je],n.prototype,"getMoveDistance",null),jt([je],n.prototype,"moveTo",null),jt([je],n.prototype,"moveText",null),jt([je],n.prototype,"updateText",null),jt([je],n.prototype,"addNodeResizeRules",null),jt([je],n.prototype,"setSelected",null),jt([je],n.prototype,"setHovered",null),jt([je],n.prototype,"setIsShowAnchor",null),jt([je],n.prototype,"setRotatable",null),jt([je],n.prototype,"setResizable",null),jt([je],n.prototype,"setHitable",null),jt([je],n.prototype,"setHittable",null),jt([je],n.prototype,"setElementState",null),jt([je],n.prototype,"setProperty",null),jt([je],n.prototype,"setProperties",null),jt([je],n.prototype,"deleteProperty",null),jt([je],n.prototype,"setStyle",null),jt([je],n.prototype,"setStyles",null),jt([je],n.prototype,"updateStyles",null),jt([je],n.prototype,"setZIndex",null),jt([je],n.prototype,"updateAttributes",null),n}(),Fj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xl=function(){return xl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xl.apply(this,arguments)},Xf=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Fd=function(n){Fj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.circle,i=this.properties.style,o=i===void 0?{}:i;return xl(xl(xl({},t),It(r)),It(o))},e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,i=t.y,o=t.r;return[{x:r,y:i-o,id:"".concat(this.id,"_0")},{x:r+o,y:i,id:"".concat(this.id,"_1")},{x:r,y:i+o,id:"".concat(this.id,"_2")},{x:r-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var r=t.width,i=t.deltaX,o=t.deltaY;return this.move(i/2,o/2),this.r=r,this.setProperties({r}),this.getData()},Xf([$e],e.prototype,"r",void 0),Xf([hn],e.prototype,"width",null),Xf([hn],e.prototype,"height",null),e}(Bo),zj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),wl=function(){return wl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},wl.apply(this,arguments)},Wa=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Qu=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},uv=function(n){zj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.rx,i=t.ry;r&&(this.rx=r),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.diamond,i=this.properties.style,o=i===void 0?{}:i;return wl(wl(wl({},t),It(r)),It(o))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,r=t.x,i=t.y,o=t.rx,a=t.ry;return[[r,i-a],[r+o,i],[r,i+a],[r-o,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return Di(this.points,function(t){var r=Qu(t,2),i=r[0],o=r[1];return{x:i,y:o}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return zt(this.points,function(i){var o=Qu(i,1),a=o[0];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return zt(this.points,function(i){var o=Qu(i,2),a=o[1];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return Di(this.points,function(r,i){var o=Qu(r,2),a=o[0],l=o[1];return{x:a,y:l,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var r=t.width,i=t.height,o=t.deltaX,a=t.deltaY;return this.move(o/2,a/2),this.rx=r,this.ry=i,this.setProperties({rx:r,ry:i}),this.getData()},Wa([$e],e.prototype,"rx",void 0),Wa([$e],e.prototype,"ry",void 0),Wa([hn],e.prototype,"points",null),Wa([hn],e.prototype,"pointsPosition",null),Wa([hn],e.prototype,"width",null),Wa([hn],e.prototype,"height",null),e}(Bo),Uj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sl=function(){return Sl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Sl.apply(this,arguments)},ed=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},dv=function(n){Uj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.rx,i=t.ry;r&&(this.rx=r),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.ellipse,i=this.properties.style,o=i===void 0?{}:i;return Sl(Sl(Sl({},t),It(r)),It(o))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,i=t.y,o=t.rx,a=t.ry;return[{x:r,y:i-a,id:"".concat(this.id,"_0")},{x:r+o,y:i,id:"".concat(this.id,"_1")},{x:r,y:i+a,id:"".concat(this.id,"_2")},{x:r-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var r=t.width,i=t.height,o=t.deltaX,a=t.deltaY;return this.move(o/2,a/2),this.rx=r,this.ry=i,this.setProperties({rx:r,ry:i}),this.getData()},ed([$e],e.prototype,"rx",void 0),ed([$e],e.prototype,"ry",void 0),ed([hn],e.prototype,"width",null),ed([hn],e.prototype,"height",null),e}(Bo),Vj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),El=function(){return El=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},El.apply(this,arguments)},td=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},nd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},zd=function(n){Vj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.points,i=t.width,o=t.height,a=r||this.points;this.points=A5(a,i,o)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.polygon,i=this.properties.style,o=i===void 0?{}:i;return El(El(El({},t),It(r)),It(o))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,r=t.x,i=t.y,o=t.width,a=t.height;return this.points.map(function(l){return{x:l[0]+r-o/2,y:l[1]+i-a/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=nd(i,1),a=o[0];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=nd(i,2),a=o[1];a<t&&(t=a),a>r&&(r=a)}),r-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,r=this,i=r.x,o=r.y,a=r.width,l=r.height,u=r.points;return u.map(function(d,f){var h=nd(d,2),v=h[0],y=h[1];return{x:i+v-a/2,y:o+y-l/2,id:"".concat(t.id,"_").concat(f)}})},e.prototype.resize=function(t){var r=this,i=t.width,o=t.height,a=t.deltaX,l=t.deltaY;this.move(a/2,l/2);var u=Di(this.points,function(d){var f=nd(d,2),h=f[0],v=f[1];return[h*i/r.width,v*o/r.height]});return this.points=u,this.properties.points=u,this.getData()},td([$e],e.prototype,"points",void 0),td([hn],e.prototype,"pointsPosition",null),td([hn],e.prototype,"width",null),td([hn],e.prototype,"height",null),e}(Bo),Wj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Cl=function(){return Cl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Cl.apply(this,arguments)},Gj=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},ws=function(n){Wj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.width,i=t.height,o=t.radius,a=this.getNodeStyle().radius;Er(r)||(this.width=r),Er(i)||(this.height=i),Er(o)||(this.radius=o),Er(a)||(this.radius=a)},e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,i=t.y,o=t.width,a=t.height;return[{x:r,y:i-a/2,id:"".concat(this.id,"_0")},{x:r+o/2,y:i,id:"".concat(this.id,"_1")},{x:r,y:i+a/2,id:"".concat(this.id,"_2")},{x:r-o/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.graphModel.theme.rect,i=this.properties.style,o=i===void 0?{}:i;return Cl(Cl(Cl({},t),It(r)),It(o))},Gj([$e],e.prototype,"radius",void 0),e}(Bo),qj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),kl=function(){return kl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},kl.apply(this,arguments)},K_=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Xj=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Yj=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},J_=function(n){qj(e,n);function e(){var t=n.apply(this,Yj([],Xj(arguments),!1))||this;return t.modelType=Wt.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=n.prototype.getTextStyle.call(this),r=this.graphModel.theme.text,i=this.properties.textStyle;return kl(kl(kl({},t),It(r)),It(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),r=this.getTextStyle().fontSize,i=z_({rows:t,fontSize:r,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),r=this.getTextStyle().fontSize,i=z_({rows:t,fontSize:r,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),K_([hn],e.prototype,"width",null),K_([hn],e.prototype,"height",null),e}(Bo),Kj=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gl=function(n){Kj(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.modelType=Wt.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,r=t.width,i=t.height;r&&(this.width=r),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,r=t.x,i=t.y,o=t.width,a=t.height;return[{x:r,y:i-a/2,id:"".concat(this.id,"_0")},{x:r+o/2,y:i,id:"".concat(this.id,"_1")},{x:r,y:i+a/2,id:"".concat(this.id,"_2")},{x:r-o/2,y:i,id:"".concat(this.id,"_3")}]},e}(Bo),an=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Jj={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},rd=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],Zj=function(){function n(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.textMode=ui.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=ui.TEXT,this.edgeTextMode=ui.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",on(this,this.computeConfig(e))}return n.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);on(this,t)},n.prototype.computeConfig=function(e){var t=e.isSilentMode,r=e.textDraggable,i=e.textMode,o=e.textEdit,a=e.adjustEdgeStartAndEnd,l={};if(t===!1&&on(l,this.stagedConfig),t===!0&&t!==this.isSilentMode){var u=Za(Jj,rd);this.stagedConfig=Za(this,rd),on(l,u)}ls(o)||on(l,{nodeTextEdit:o,edgeTextEdit:o}),ls(r)||on(l,{nodeTextDraggable:r,edgeTextDraggable:r}),i&&on(l,{nodeTextMode:i,edgeTextMode:i}),Rp(a)&&on(l,{adjustEdgeStart:a,adjustEdgeEnd:a});var d=Za(e,rd);return on(l,d)},n.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},n.prototype.getConfig=function(){return Za(this,rd)},an([$e],n.prototype,"isSilentMode",void 0),an([$e],n.prototype,"stopZoomGraph",void 0),an([$e],n.prototype,"stopMoveGraph",void 0),an([$e],n.prototype,"stopScrollGraph",void 0),an([$e],n.prototype,"snapGrid",void 0),an([$e],n.prototype,"textMode",void 0),an([$e],n.prototype,"textEdit",void 0),an([$e],n.prototype,"textDraggable",void 0),an([$e],n.prototype,"nodeTextEdit",void 0),an([$e],n.prototype,"nodeTextDraggable",void 0),an([$e],n.prototype,"nodeTextMultiple",void 0),an([$e],n.prototype,"nodeTextVertical",void 0),an([$e],n.prototype,"nodeTextMode",void 0),an([$e],n.prototype,"edgeTextMode",void 0),an([$e],n.prototype,"edgeTextEdit",void 0),an([$e],n.prototype,"edgeTextDraggable",void 0),an([$e],n.prototype,"edgeTextMultiple",void 0),an([$e],n.prototype,"edgeTextVertical",void 0),an([$e],n.prototype,"hideAnchors",void 0),an([$e],n.prototype,"allowRotate",void 0),an([$e],n.prototype,"allowResize",void 0),an([$e],n.prototype,"hoverOutline",void 0),an([$e],n.prototype,"nodeSelectedOutline",void 0),an([$e],n.prototype,"adjustNodePosition",void 0),an([$e],n.prototype,"autoExpand",void 0),an([$e],n.prototype,"adjustEdge",void 0),an([$e],n.prototype,"adjustEdgeMiddle",void 0),an([$e],n.prototype,"adjustEdgeStartAndEnd",void 0),an([$e],n.prototype,"adjustEdgeStart",void 0),an([$e],n.prototype,"adjustEdgeEnd",void 0),an([$e],n.prototype,"edgeSelectedOutline",void 0),an([je],n.prototype,"updateEditConfig",null),an([je],n.prototype,"updateTextMode",null),n}(),Qj="*",eH=function(){function n(){this._events={}}return n.prototype.on=function(e,t,r){var i=this;e==null||e.split(",").forEach(function(o){o=o.trim(),i._events[o]||(i._events[o]=[]),i._events[o].push({callback:t,once:!!r})})},n.prototype.once=function(e,t){var r=this;e==null||e.split(",").forEach(function(i){i=i.trim(),r.on(i,t,!0)})},n.prototype.emit=function(e,t){var r=this;e==null||e.split(",").forEach(function(i){var o=r._events[i]||[],a=r._events[Qj]||[],l=function(u){for(var d=u.length,f=0;f<d;f++)if(u[f]){var h=u[f],v=h.callback,y=h.once;y&&(u.splice(f,1),u.length===0&&delete r._events[i],d--,f--),v.apply(r,[t])}};l(o),l(a)})},n.prototype.off=function(e,t){var r=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete r._events[i];else{for(var o=r._events[i]||[],a=o.length,l=0;l<a;l++)o[l].callback===t&&(o.splice(l,1),a--,l--);o.length===0&&delete r._events[i]}})},n.prototype.getEvents=function(){return this._events},n.prototype.destroy=function(){this._events={}},n}(),tH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),cv=function(){return cv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},cv.apply(this,arguments)},nH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},rH=function(n){tH(e,n);function e(t){var r=n.call(this)||this;r.stepScrollX=0,r.stepScrollY=0,r.onDragging=function(l){var u=l.deltaX,d=l.deltaY;r.setState({isDragging:!0});var f=r.props.graphModel,h=f.transformModel,v=f.editConfigModel;v.stopMoveGraph!==!0&&h.translate(u,d)},r.onDragEnd=function(){r.setState({isDragging:!1})},r.zoomHandler=function(l){var u=r.props,d=u.graphModel,f=d.editConfigModel,h=d.transformModel,v=d.gridSize,y=u.graphModel,x=l.deltaX,w=l.deltaY,_=f.stopScrollGraph,b=f.stopZoomGraph;if(!_&&!l.ctrlKey&&!l.metaKey){if(l.preventDefault(),r.stepScrollX+=x,r.stepScrollY+=w,Math.abs(r.stepScrollX)>=v){var E=r.stepScrollX%v,k=r.stepScrollX-E;h.translate(-k*h.SCALE_X,0),r.stepScrollX=E}if(Math.abs(r.stepScrollY)>=v){var O=r.stepScrollY%v,N=r.stepScrollY-O;h.translate(0,-N*h.SCALE_Y),r.stepScrollY=O}return}if(!b){l.preventDefault();var I=y.getPointByClient({x:l.clientX,y:l.clientY}),T=I.canvasOverlayPosition,L=T.x,H=T.y;h.zoom(l.deltaY<0,[L,H])}},r.clickHandler=function(l){var u=l.target;if(u.getAttribute("name")==="canvas-overlay"){var d=r.props.graphModel,f=d.selectElements;f.size>0&&d.clearSelectElements(),d.eventCenter.emit(kt.BLANK_CLICK,{e:l})}},r.handleContextMenu=function(l){var u=l.target;if(u.getAttribute("name")==="canvas-overlay"){l.preventDefault();var d=r.props.graphModel,f=d.getPointByClient({x:l.clientX,y:l.clientY});d.eventCenter.emit(kt.BLANK_CONTEXTMENU,{e:l,position:f})}},r.mouseDownHandler=function(l){var u=r.props.graphModel,d=u.eventCenter,f=u.editConfigModel,h=u.transformModel.SCALE_X,v=u.gridSize,y=f.adjustEdge,x=f.adjustNodePosition,w=f.stopMoveGraph,_=l.target,b=!y&&!x;(_.getAttribute("name")==="canvas-overlay"||b)&&(w!==!0?(r.stepDrag.setStep(v*h),r.stepDrag.handleMouseDown(l)):d.emit(kt.BLANK_MOUSEDOWN,{e:l}),r.clickHandler(l))};var i=t.graphModel,o=i.gridSize,a=i.eventCenter;return r.stepDrag=new fi({onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:o,eventType:"BLANK",isStopPropagation:!1,eventCenter:a,model:void 0}),r.state={isDragging:!1},r}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,r=t.getTransformStyle().transform,i=this.props,o=i.children,a=i.dnd,l=this.state.isDragging;return He("svg",cv({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:l?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},a.eventMap(),{children:He("g",{transform:r,children:o})}))},e=nH([Cr],e),e}(Zt),xw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ql=function(){return ql=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ql.apply(this,arguments)},iH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},oH=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Z_=function(n){xw(e,n);function e(){var t=n.call(this)||this;return t.onDragging=function(r){var i=r.event,o=t.props,a=o.graphModel,l=o.bezierModel,u=o.type,d=a.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,f=d.x,h=d.y;l.updateAdjustAnchor({x:f,y:h},u),a.eventCenter.emit(kt.EDGE_ADJUST,{data:l.getData()})},t.onDragEnd=function(){var r=t.props.bezierModel;r.isDragging=!1},t.dragHandler=new fi({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,r=this.props.position,i=r.x,o=r.y,a=this.props.bezierModel,l=a.getEdgeStyle().adjustAnchor;return He(bs,ql({className:"lf-bezier-adjust-anchor",x:i,y:o},l,{onMouseDown:function(u){t.dragHandler.handleMouseDown(u)}}))},e}(Zt),aH=function(n){xw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,r){var i=t.path,o=t.id,a=cg(i),l=oH(a,4),u=l[0],d=l[1],f=l[2],h=l[3],v=t.getEdgeStyle().adjustLine,y=[];return y.push(He(_s,ql({x1:u.x,y1:u.y,x2:d.x,y2:d.y},v))),y.push(He(Z_,{position:d,bezierModel:t,graphModel:r,type:"sNext"},"".concat(o,"_ePre"))),y.push(He(_s,ql({x1:h.x,y1:h.y,x2:f.x,y2:f.y},v))),y.push(He(Z_,{position:f,bezierModel:t,graphModel:r,type:"ePre"},"".concat(o,"_sNext"))),y},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,r=t.edges,i=[],o=0;o<r.length;o++){var a=r[o];a.isSelected&&a.modelType===Wt.BEZIER_EDGE&&a.draggable&&i.push(this.getBezierAdjust(a,t))}return i},e.prototype.render=function(){return He("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=iH([Cr],e),e}(Zt),sH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),lH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},uH=function(n){sH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return He("div",{className:"lf-background",children:He("div",{style:U2(t)?t:{},className:"lf-background-area"})})},e=lH([Cr],e),e}(Zt),dH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),cH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},is=function(n){dH(e,n);function e(t){var r=n.call(this,t)||this;return r.id=Ao(),r.gridOptions=r.props.graphModel.grid,r}return e.prototype.renderDot=function(){var t=this.gridOptions,r=t.config,i=t.size,o=i===void 0?1:i,a=t.visible,l=r??{},u=l.color,d=l.thickness,f=d===void 0?2:d,h=Math.min(Math.max(2,f),o/4),v=a?1:0;return He("g",{fill:u,opacity:v,children:[He("circle",{cx:0,cy:0,r:h/2}),He("circle",{cx:0,cy:o,r:h/2}),He("circle",{cx:o,cy:0,r:h/2}),He("circle",{cx:o,cy:o,r:h/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,r=t.config,i=t.size,o=i===void 0?1:i,a=t.visible,l=r??{},u=l.color,d=l.thickness,f=d===void 0?1:d,h=Math.min(Math.max(1,f),o/2),v="M 0 0 H ".concat(o," V ").concat(o," H 0 Z"),y=a?1:0;return He("path",{d:v,stroke:u,strokeWidth:h/2,opacity:y,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,r=t.transformModel,i=t.grid;this.gridOptions=i;var o=this.gridOptions,a=o.type,l=o.size,u=l===void 0?1:l,d=r.SCALE_X,f=r.SKEW_Y,h=r.SKEW_X,v=r.SCALE_Y,y=r.TRANSLATE_X,x=r.TRANSLATE_Y,w=[d,f,h,v,y,x].join(","),_="matrix(".concat(w,")");return He("div",{className:"lf-grid",children:He("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[He("defs",{children:He("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:_,x:"0",y:"0",width:u,height:u,children:[a==="dot"&&this.renderDot(),a==="mesh"&&this.renderMesh()]})}),He("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=cH([Cr],e),e}(Zt);(function(n){n.defaultProps={size:s5,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var r=It(n.defaultProps);return typeof t=="number"?on(r,{size:t}):typeof t=="boolean"?on(r,{visible:t}):on(r,t)}n.getGridOptions=e})(is||(is={}));var fH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),hH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},pH=function(n){fH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,r=t.getTransformStyle().transform,i=this.props.children;return He("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:He("g",{transform:r,children:i})})},e=hH([Cr],e),e}(Zt),vH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),So=function(){return So=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},So.apply(this,arguments)},gH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},mH=function(n){vH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,r=t.nodes,i=t.editConfigModel,o=i.hoverOutline,a=i.nodeSelectedOutline,l=[];return r.forEach(function(u){if(u.isHovered||u.isSelected){var d=u.isHovered,f=u.isSelected,h=u.x,v=u.y,y=u.width,x=u.height;if(a&&f||o&&d){var w=u.getOutlineStyle(),_={};if(Object.keys(w).forEach(function(E){E!=="hover"&&(_[E]=w[E])}),d){var b=w.hover;_=So(So({},_),b)}l.push(He(si,So({transform:u.transform,className:"lf-outline-node",x:h,y:v,width:y+10,height:x+10},_)))}}}),l},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,r=t.edges,i=t.editConfigModel,o=i.edgeSelectedOutline,a=i.hoverOutline,l=[],u=0;u<r.length;u++){var d=r[u];(o&&d.isSelected||a&&d.isHovered)&&(d.modelType===Wt.LINE_EDGE?l.push(this.getLineOutline(d)):d.modelType===Wt.POLYLINE_EDGE?l.push(this.getPolylineOutline(d)):d.modelType===Wt.BEZIER_EDGE&&l.push(this.getBezierOutline(d)))}return l},e.prototype.getLineOutline=function(t){var r=t.startPoint,i=t.endPoint,o=(r.x+i.x)/2,a=(r.y+i.y)/2,l=Math.abs(r.x-i.x)+10,u=Math.abs(r.y-i.y)+10,d=t.getOutlineStyle();return He(si,So({className:"lf-outline-edge",x:o,y:a,width:l,height:u},d))},e.prototype.getPolylineOutline=function(t){var r=t.points,i=fa(r),o=Hl(i,8),a=o.x,l=o.y,u=o.width,d=o.height,f=t.getOutlineStyle();return He(si,So({className:"lf-outline",x:a,y:l,width:u,height:d},f))},e.prototype.getBezierOutline=function(t){var r=t.path,i=cg(r),o=Hl(i,8),a=o.x,l=o.y,u=o.width,d=o.height,f=t.getOutlineStyle();return He(si,So({className:"lf-outline",x:a,y:l,width:u,height:d},f))},e.prototype.render=function(){return He("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=gH([Cr],e),e}(Zt),yH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Eo=function(){return Eo=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Eo.apply(this,arguments)},_H=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},bH=function(n){yH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,r=t??{},i=r.position,o=r.isShowHorizontal,a=r.isShowVertical,l=t==null?void 0:t.getStyle(),u=i??{},d=u.x,f=d===void 0?0:d,h=u.y,v=h===void 0?0:h,y=Eo(Eo({x1:-1e5,y1:v,x2:1e5,y2:v},l),{stroke:o?l==null?void 0:l.stroke:"none"}),x=Eo(Eo({x1:f,y1:-1e5,x2:f,y2:1e5},l),{stroke:a?l==null?void 0:l.stroke:"none"});return He("g",{className:"lf-snapline",children:[He(_s,Eo({},y)),He(_s,Eo({},x))]})},e=_H([Cr],e),e}(Zt),xH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),wH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},SH=function(n){xH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,r=t.tool,i=t.graphModel,o=i.textEditElement,a=r.getTools(),l=a.map(function(u){return mt(u,{textEditElement:o,graphModel:i,lf:r.instance})});return r.components=l,l},e.prototype.triggerToolRender=function(){var t=this.props,r=t.tool,i=t.graphModel,o=document.querySelector("#ToolOverlay_".concat(i.flowId)),a=r.getInstance();a.components.forEach(function(l){return l(a,o)}),a.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return He("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=wH([Cr],e),e}(Zt),yi=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ga=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},EH={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},CH=function(){function n(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var r=t.stopMoveGraph,i=r===void 0?!1:r;this.updateTranslateLimits(i)}return n.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},n.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},n.prototype.HtmlPointToCanvasPoint=function(e){var t=Ga(e,2),r=t[0],i=t[1];return[(r-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},n.prototype.CanvasPointToHtmlPoint=function(e){var t=Ga(e,2),r=t[0],i=t[1];return[r*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},n.prototype.moveCanvasPointByHtml=function(e,t,r){var i=Ga(e,2),o=i[0],a=i[1];return[o+t/this.SCALE_X,a+r/this.SCALE_Y]},n.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},n.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},n.prototype.zoom=function(e,t){e===void 0&&(e=!1);var r=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(r=e,i=e):e?(r+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(r-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),r<this.MINI_SCALE_SIZE||r>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(r-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=r,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},n.prototype.emitGraphTransform=function(e){this.eventCenter.emit(kt.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},n.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},n.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},n.prototype.focusOn=function(e,t,r,i){var o=Ga(this.CanvasPointToHtmlPoint([e,t]),2),a=o[0],l=o[1],u=Ga([r/2-a,i/2-l],2),d=u[0],f=u[1];this.TRANSLATE_X+=d,this.TRANSLATE_Y+=f,this.emitGraphTransform("focusOn")},n.prototype.updateTranslateLimits=function(e){var t;t=Ga(Array.isArray(e)&&e.length===4?e:EH[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},yi([$e],n.prototype,"SCALE_X",void 0),yi([$e],n.prototype,"SKEW_Y",void 0),yi([$e],n.prototype,"SKEW_X",void 0),yi([$e],n.prototype,"SCALE_Y",void 0),yi([$e],n.prototype,"TRANSLATE_X",void 0),yi([$e],n.prototype,"TRANSLATE_Y",void 0),yi([$e],n.prototype,"ZOOM_SIZE",void 0),yi([je],n.prototype,"zoom",null),yi([je],n.prototype,"resetZoom",null),yi([je],n.prototype,"translate",null),yi([je],n.prototype,"focusOn",null),n}(),kH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yf=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},OH=function(n){kH(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.parentTransform=r.parentTransform,i}return e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,r=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale();t*=i.scaleX,r*=i.scaleY}else t*=this.parentTransform.SCALE_X,r*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:r}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,r=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale(),o=i.scaleX,a=i.scaleY;t=o*t,r=a*r}return{translateX:t,translateY:r}},e.prototype.HtmlPointToCanvasPoint=function(t){var r=Yf(t,2),i=r[0],o=r[1],a=this.getCumulativeScale(),l=a.scaleX,u=a.scaleY,d=this.getCumulativeTranslate(),f=d.translateX,h=d.translateY;return[(i-f)/l,(o-h)/u]},e.prototype.CanvasPointToHtmlPoint=function(t){var r=Yf(t,2),i=r[0],o=r[1],a=this.getCumulativeScale(),l=a.scaleX,u=a.scaleY,d=this.getCumulativeTranslate(),f=d.translateX,h=d.translateY;return[i*l+f,o*u+h]},e.prototype.moveCanvasPointByHtml=function(t,r,i){var o=Yf(t,2),a=o[0],l=o[1],u=this.getCumulativeScale(),d=u.scaleX,f=u.scaleY;return[a+r/d,l+i/f]},e.prototype.fixDeltaXY=function(t,r){var i=this.getCumulativeScale(),o=i.scaleX,a=i.scaleY;return[t/o,r/a]},e}(CH),vr=function(){return vr=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vr.apply(this,arguments)},Ot=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},MH=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Qn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},ri=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},NH=function(){function n(e){var t=this,r,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=Ci.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var o=e.container,a=e.partial,l=e.background,u=l===void 0?{}:l,d=e.grid,f=e.idGenerator,h=e.edgeGenerator,v=e.animation,y=e.customTrajectory;this.rootEl=o,this.partial=!!a,this.background=u,typeof d=="object"&&e.snapGrid&&(this.gridSize=d.size||1),this.customStyles=e.style||{},this.grid=is.getGridOptions(d??!1),this.theme=bw(e.style,e.themeMode),this.theme.grid=It(this.grid),this.theme.background=It(this.background),this.edgeType=e.edgeType||"polyline",this.animation=i5(v),this.overlapMode=e.overlapMode||Ci.DEFAULT,this.width=(r=e.width)!==null&&r!==void 0?r:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=Er(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=Er(e.height);var x=new ResizeObserver(R1(function(w){var _,b;try{for(var E=MH(w),k=E.next();!k.done;k=E.next()){var O=k.value;O.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:O.contentRect}))}}catch(N){_={error:N}}finally{try{k&&!k.done&&(b=E.return)&&b.call(E)}finally{if(_)throw _.error}}},16));x.observe(this.rootEl),this.waitCleanEffects.push(function(){x.disconnect()}),this.eventCenter=new eH,this.editConfigModel=new Zj(e),this.transformModel=new OH(this.eventCenter,e),this.flowId=Ao(),this.idGenerator=f,this.edgeGenerator=M5(this,h),this.customTrajectory=y}return Object.defineProperty(n.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,r){return e[t.id]={index:r,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,r){return e[t.id]={index:r,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelsMap",{get:function(){return ri(ri([],Qn(this.nodes),!1),Qn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortElements",{get:function(){for(var e=ri(ri([],Qn(this.nodes),!1),Qn(this.edges),!1).sort(function(l,u){return l.zIndex-u.zIndex}),t=[],r=[-qu,-qu],i=[this.width+qu,this.height+qu],o=0;o<e.length;o++){var a=e[o];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,r,i,!1,!1))&&t.push(a)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(r){return r.state===tn.TEXT_EDIT}),t=this.edges.find(function(r){return r.state===tn.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),n.prototype.getAreaElement=function(e,t,r,i,o){var a=this;r===void 0&&(r=!0),i===void 0&&(i=!0),o===void 0&&(o=!1);var l=[];return zt(ri(ri([],Qn(this.nodes),!1),Qn(this.edges),!1),function(u){var d=a.isElementInArea(u,e,t,r,i);(!o||u.visible)&&d&&l.push(u)}),l},n.prototype.getModel=function(e){return this.modelMap.get(e)},n.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getPointByClient=function(e){var t=e.x,r=e.y,i=this.rootEl.getBoundingClientRect(),o={x:t-i.left,y:r-i.top},a=Qn(this.transformModel.HtmlPointToCanvasPoint([o.x,o.y]),2),l=a[0],u=a[1],d={x:l,y:u};return{domOverlayPosition:o,canvasOverlayPosition:d}},n.prototype.isElementInArea=function(e,t,r,i,o){var a;if(i===void 0&&(i=!0),o===void 0&&(o=!0),e.BaseType===kn.NODE){e=e;for(var l=Xr(e),u=l.minX,d=l.minY,f=l.maxX,h=l.maxY,v=[{x:u,y:d},{x:f,y:d},{x:f,y:h},{x:u,y:h}],y=o,x=0;x<v.length;x++){var w=v[x],_=w.x,b=w.y;if(a=Qn(this.transformModel.CanvasPointToHtmlPoint([_,b]),2),_=a[0],b=a[1],Wf([_,b],t,r)!==o){y=!o;break}}return y}if(e.BaseType===kn.EDGE){e=e;var E=e.startPoint,k=e.endPoint,O=this.transformModel.CanvasPointToHtmlPoint([E.x,E.y]),N=this.transformModel.CanvasPointToHtmlPoint([k.x,k.y]),I=Wf(O,t,r),T=Wf(N,t,r);return i?I&&T:I||T}return!1},n.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=Di(e.nodes,function(i){var o=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(o.id,o),t.nodeModelMap.set(o.id,o),o}):this.nodes=[],e.edges){var r=this.edgeType;this.edges=Di(e.edges,function(i){var o,a=t.getModel((o=i.type)!==null&&o!==void 0?o:r);if(!a)throw new Error("找不到".concat(i.type,"对应的边。"));var l=new a(i,t);return t.edgeModelMap.set(l.id,l),t.elementsModelMap.set(l.id,l),l})}else this.edges=[]},n.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(r){var i=r.getData();i&&!r.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(r){var i=r.getData();i&&!r.virtual&&t.push(i)}),{nodes:t,edges:e}},n.prototype.modelToHistoryData=function(){for(var e=!1,t=[],r=0;r<this.nodes.length;r++){var i=this.nodes[r];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var o=!1,a=[],l=0;l<this.edges.length;l++){var u=this.edges[l];if(u.isDragging){o=!0;break}else a.push(u.getHistoryData())}return o?!1:{nodes:t,edges:a}},n.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getElement=function(e){return this.modelsMap[e]},n.prototype.getNodeEdges=function(e){for(var t=[],r=0;r<this.edges.length;r++){var i=this.edges[r],o=i.sourceNodeId===e,a=i.targetNodeId===e;(o||a)&&t.push(i)}return t},n.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,r={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===kn.NODE&&r.nodes.push(i.getData()),i.BaseType===kn.EDGE){var o=i.getData(),a=t.get(o.sourceNodeId)&&t.get(o.targetNodeId);(e||a)&&r.edges.push(o)}}),r},n.prototype.updateAttributes=function(e,t){var r=this.getElement(e);r==null||r.updateAttributes(t)},n.prototype.changeNodeId=function(e,t){return t||(t=Ao()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(r){r.sourceNodeId===e&&(r.sourceNodeId=t),r.targetNodeId===e&&(r.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},n.prototype.changeEdgeId=function(e,t){return t||(t=Ao()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(r){r.id===e&&r.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},n.prototype.getTextModel=function(e){var t=this.editConfigModel,r=t.textMode,i=t.nodeTextMode,o=t.edgeTextMode;if(e.BaseType===kn.NODE)return e.textMode||i||r||ui.TEXT;if(e.BaseType===kn.EDGE)return e.textMode||o||r||ui.TEXT},n.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},n.prototype.setFakeNode=function(e){this.fakeNode=e},n.prototype.removeFakeNode=function(){this.fakeNode=null},n.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},n.prototype.toFront=function(e){var t,r,i,o=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((r=this.edgesMap[e])===null||r===void 0?void 0:r.model);o&&(this.overlapMode===Ci.DEFAULT&&((i=this.topElement)===null||i===void 0||i.setZIndex(),o.setZIndex(a5),this.topElement=o),this.overlapMode===Ci.INCREASE&&this.setElementZIndex(e,"top"))},n.prototype.setElementZIndex=function(e,t){var r,i,o=((r=this.nodesMap[e])===null||r===void 0?void 0:r.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(o){var a=void 0;typeof t=="number"?a=t:(t==="top"&&(a=pg()),t==="bottom"&&(a=Pj())),o.setZIndex(a)}},n.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,r=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(kt.NODE_DELETE,{data:r,model:t})},n.prototype.addNode=function(e,t,r){t===void 0&&(t=kt.NODE_ADD);var i=mr(e),o=i.id;o&&this.nodesMap[o]&&delete i.id;var a=this.getModelAfterSnapToGrid(i);this.nodes.push(a);var l=a.getData(),u={data:l};return r&&(u.e=r),this.eventCenter.emit(t,u),a},n.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),r=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,o=e.y;i&&o&&(e.x=ys(i,this.gridSize,r),e.y=ys(o,this.gridSize,r),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-o));var a=new t(e,this);return this.nodeModelMap.set(a.id,a),this.elementsModelMap.set(a.id,a),a},n.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),r=t==null?void 0:t.getData();if(r){r.x+=30,r.y+=30,r.id="",typeof r.text=="object"&&r.text!==null&&(r.text.x+=30,r.text.y+=30);var i=this.addNode(r);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},n.prototype.moveNode=function(e,t,r,i){var o;i===void 0&&(i=!1);var a=this.nodesMap[e];if(!a){console.warn("不存在id为".concat(e,"的节点"));return}var l=a.model;o=Qn(l.getMoveDistance(t,r,i),2),t=o[0],r=o[1],this.moveEdge(e,t,r)},n.prototype.moveNode2Coordinate=function(e,t,r,i){i===void 0&&(i=!1);var o=this.nodesMap[e];if(!o){console.warn("不存在id为".concat(e,"的节点"));return}var a=o.model,l=a.x,u=a.y,d=t-l,f=r-u;this.moveNode(e,d,f,i)},n.prototype.editText=function(e){this.setElementStateById(e,tn.TEXT_EDIT)},n.prototype.addEdge=function(e){var t=mr(e),r=t.type;r||(r=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var i=this.getModel(r);if(!i)throw new Error("找不到".concat(r,"对应的边，请确认是否已注册此类型边。"));var o=new i(vr(vr({},t),{type:r}),this);this.edgeModelMap.set(o.id,o),this.elementsModelMap.set(o.id,o);var a=o.getData();return this.edges.push(o),this.eventCenter.emit(kt.EDGE_ADD,{data:a}),o},n.prototype.moveEdge=function(e,t,r){for(var i=0;i<this.edges.length;i++){var o=this.edges[i],a=o.textPosition,l=a.x,u=a.y,d=this.edges[i].sourceNodeId===e,f=this.edges[i].targetNodeId===e;d&&o.moveStartPoint(t,r),f&&o.moveEndPoint(t,r),(d||f)&&this.handleEdgeTextMove(o,l,u)}},n.prototype.handleEdgeTextMove=function(e,t,r){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===Wt.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var o=e.text,a=cw(o,e.points);e.moveText(a.x-o.x,a.y-o.y)}var l=e.textPosition,u=l.x,d=l.y;e.moveText(u-t,d-r)},n.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var r=0;r<this.edges.length;r++)if(this.edges[r].sourceNodeId===e&&this.edges[r].targetNodeId===t){var i=this.edges[r].getData();this.edges.splice(r,1),r--,this.eventCenter.emit(kt.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var r=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(r,1),this.eventCenter.emit(kt.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var r=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(kt.EDGE_DELETE,{data:r})}},n.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var r=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(kt.EDGE_DELETE,{data:r})}},n.prototype.setElementStateById=function(e,t,r){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,r):i.setElementState(tn.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,r):i.setElementState(tn.DEFAULT)})},n.prototype.updateText=function(e,t){var r=da(ri(ri([],Qn(this.nodes),!1),Qn(this.edges),!1),function(i){return i.id===e});r==null||r.updateText(t)},n.prototype.selectNodeById=function(e,t){var r;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(r=this.nodesMap[e])===null||r===void 0?void 0:r.model;i==null||i.setSelected(!0)},n.prototype.selectEdgeById=function(e,t){var r;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(r=this.edgesMap[e])===null||r===void 0?void 0:r.model;i==null||i.setSelected(!0)},n.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var r=this.getElement(e);r==null||r.setSelected(!0)},n.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},n.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===Ci.DEFAULT&&((e=this.topElement)===null||e===void 0||e.setZIndex())},n.prototype.moveNodes=function(e,t,r,i){var o,a,l,u=this;i===void 0&&(i=!1);for(var d=e.reduce(function(k,O){var N,I=(N=u.nodesMap[O])===null||N===void 0?void 0:N.model;return I&&(k[O]=I.getMoveDistance(t,r,i)),k},{}),f=0;f<this.edges.length;f++){var h=this.edges[f],v=h.textPosition,y=v.x,x=v.y,w=d[h.sourceNodeId],_=d[h.targetNodeId],b=void 0,E=void 0;w&&_&&h.modelType===Wt.POLYLINE_EDGE?(o=Qn(w,2),b=o[0],E=o[1],h.updatePointsList(b,E)):(w&&(a=Qn(w,2),b=a[0],E=a[1],h.moveStartPoint(b,E)),_&&(l=Qn(_,2),b=l[0],E=l[1],h.moveEndPoint(b,E))),(w||_)&&this.handleEdgeTextMove(h,y,x)}},n.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},n.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},n.prototype.setDefaultEdgeType=function(e){this.edgeType=e},n.prototype.changeNodeType=function(e,t){var r=this.getNodeModelById(e);if(!r){console.warn("找不到id为".concat(e,"的节点"));return}var i=r.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var a=new o(i,this);this.nodes.splice(this.nodesMap[e].index,1,a);var l=this.getNodeEdges(e);l.forEach(function(u){if(u.sourceNodeId===e){var d=F_(a,u.startPoint,a.width,a.height);u.updateStartPoint(d)}if(u.targetNodeId===e){var d=F_(a,u.endPoint,a.width,a.height);u.updateEndPoint(d)}})},n.prototype.changeEdgeType=function(e,t){var r=this.getEdgeModelById(e);if(!r){console.warn("找不到id为".concat(e,"的边"));return}if(r.type!==t){var i=r.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var a=new o(i,this);this.edges.splice(this.edgesMap[e].index,1,a)}},n.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.targetNodeId===e&&t.push(r)}),t},n.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.sourceNodeId===e&&t.push(r)}),t},n.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.targetAnchorId===e&&t.push(r)}),t},n.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(r){r.sourceAnchorId===e&&t.push(r)}),t},n.prototype.getNodeIncomingNode=function(e){var t=this,r=[];return this.edges.forEach(function(i){var o;i.targetNodeId===e&&r.push((o=t.nodesMap[i.sourceNodeId])===null||o===void 0?void 0:o.model)}),r},n.prototype.getNodeOutgoingNode=function(e){var t=this,r=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&r.push(t.nodesMap[i.targetNodeId].model)}),r},n.prototype.setTheme=function(e,t){var r;if(t&&(Vl[t]&&this.updateBackgroundOptions(vr(vr({},typeof this.background=="object"?this.background:{}),Vl[t])),Wl[t]&&this.updateGridOptions(is.getGridOptions(vr(vr({},this.grid),Wl[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=is.getGridOptions((r=e.grid)!==null&&r!==void 0?r:!1);this.updateGridOptions(i)}this.theme=Tj(vr(vr({},this.customStyles),e),t),this.customStyles=vr(vr({},this.customStyles),e)},n.prototype.getTheme=function(){var e=this,t=e.background,r=e.grid,i=vr(vr({},It(this.theme)),{background:t,grid:r});return i},n.prototype.updateGridOptions=function(e){ss(this.grid,e)},n.prototype.updateGridSize=function(e){this.gridSize=e},n.prototype.updateBackgroundOptions=function(e){Rp(e)||Rp(this.background)?this.background=e:this.background=vr(vr({},this.background),e)},n.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=Er(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=Er(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},n.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},n.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],r=[];e.forEach(function(v){var y=v.x,x=v.y,w=v.width,_=v.height,b=v.getNodeStyle().strokeWidth,E=b===void 0?0:b,k=y+w/2+E,O=y-w/2-E,N=x+_/2+E,I=x-_/2-E;t=t.concat([k,O].filter(function(T){return!Number.isNaN(T)})),r=r.concat([N,I].filter(function(T){return!Number.isNaN(T)}))});var i=Math.min.apply(Math,ri([],Qn(t),!1)),o=Math.max.apply(Math,ri([],Qn(t),!1)),a=Math.min.apply(Math,ri([],Qn(r),!1)),l=Math.max.apply(Math,ri([],Qn(r),!1)),u=o-i||0,d=l-a||0,f=i+u/2,h=a+d/2;return{width:u,height:d,x:f,y:h}},n.prototype.translateCenter=function(){var e=this,t=e.nodes,r=e.width,i=e.height,o=e.rootEl,a=e.transformModel;if(t.length){var l=r||o.clientWidth,u=i||o.clientHeight,d=this.getVirtualRectSize(),f=d.x,h=d.y;a.focusOn(f,h,l,u)}},n.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var r=this,i=r.nodes,o=r.width,a=r.height,l=r.rootEl,u=r.transformModel;if(i.length){var d=o||l.clientWidth,f=a||l.clientHeight,h=this.getVirtualRectSize(),v=h.width,y=h.height,x=h.x,w=h.y,_=(v+t)/d,b=(y+e)/f,E=1/Math.max(_,b),k=[d/2,f/2];u.zoom(E,k),u.focusOn(x,w,d,f)}},n.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},n.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},n.prototype.getPartial=function(){return this.partial},n.prototype.setPartial=function(e){this.partial=e},n.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},Ot([$e],n.prototype,"width",void 0),Ot([$e],n.prototype,"height",void 0),Ot([$e],n.prototype,"theme",void 0),Ot([$e],n.prototype,"grid",void 0),Ot([$e],n.prototype,"edgeType",void 0),Ot([$e],n.prototype,"nodes",void 0),Ot([$e],n.prototype,"edges",void 0),Ot([$e],n.prototype,"fakeNode",void 0),Ot([$e],n.prototype,"overlapMode",void 0),Ot([$e],n.prototype,"background",void 0),Ot([$e],n.prototype,"gridSize",void 0),Ot([$e],n.prototype,"transformModel",void 0),Ot([$e],n.prototype,"editConfigModel",void 0),Ot([$e],n.prototype,"partial",void 0),Ot([hn],n.prototype,"nodesMap",null),Ot([hn],n.prototype,"edgesMap",null),Ot([hn],n.prototype,"modelsMap",null),Ot([hn],n.prototype,"sortElements",null),Ot([hn],n.prototype,"textEditElement",null),Ot([hn],n.prototype,"selectElements",null),Ot([hn],n.prototype,"selectNodes",null),Ot([je],n.prototype,"setTextMode",null),Ot([je],n.prototype,"setFakeNode",null),Ot([je],n.prototype,"removeFakeNode",null),Ot([je],n.prototype,"setModel",null),Ot([je],n.prototype,"toFront",null),Ot([je],n.prototype,"setElementZIndex",null),Ot([je],n.prototype,"deleteNode",null),Ot([je],n.prototype,"addNode",null),Ot([je],n.prototype,"cloneNode",null),Ot([je],n.prototype,"moveNode",null),Ot([je],n.prototype,"moveNode2Coordinate",null),Ot([je],n.prototype,"editText",null),Ot([je],n.prototype,"addEdge",null),Ot([je],n.prototype,"moveEdge",null),Ot([je],n.prototype,"deleteEdgeBySourceAndTarget",null),Ot([je],n.prototype,"deleteEdgeById",null),Ot([je],n.prototype,"deleteEdgeBySource",null),Ot([je],n.prototype,"deleteEdgeByTarget",null),Ot([je],n.prototype,"setElementStateById",null),Ot([je],n.prototype,"updateText",null),Ot([je],n.prototype,"selectNodeById",null),Ot([je],n.prototype,"selectEdgeById",null),Ot([je],n.prototype,"selectElementById",null),Ot([je],n.prototype,"deselectElementById",null),Ot([je],n.prototype,"clearSelectElements",null),Ot([je],n.prototype,"moveNodes",null),Ot([je],n.prototype,"setDefaultEdgeType",null),Ot([je],n.prototype,"changeNodeType",null),Ot([je],n.prototype,"changeEdgeType",null),Ot([je],n.prototype,"getNodeIncomingEdge",null),Ot([je],n.prototype,"getNodeOutgoingEdge",null),Ot([je],n.prototype,"getAnchorIncomingEdge",null),Ot([je],n.prototype,"getAnchorOutgoingEdge",null),Ot([je],n.prototype,"getNodeIncomingNode",null),Ot([je],n.prototype,"getNodeOutgoingNode",null),Ot([je],n.prototype,"setTheme",null),Ot([je],n.prototype,"getTheme",null),Ot([je],n.prototype,"resize",null),Ot([je],n.prototype,"clearData",null),Ot([je],n.prototype,"translateCenter",null),Ot([je],n.prototype,"fitView",null),Ot([je],n.prototype,"openEdgeAnimation",null),Ot([je],n.prototype,"closeEdgeAnimation",null),Ot([je],n.prototype,"setPartial",null),n}(),ra=function(){return ra=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ra.apply(this,arguments)},ul=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},AH=function(){function n(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return n.prototype.getStyle=function(){return ra({},this.graphModel.theme.snapline)},n.prototype.getCenterSnapLine=function(e,t){for(var r=e.x,i=e.y,o=!1,a=!1,l=0;l<t.length;l++){var u=t[l];if(u.id!==e.id&&(_i(r,u.x,this.epsilon)&&(o=!0),_i(i,u.y,this.epsilon)&&(a=!0),o&&a))break}return{isShowVertical:o,isShowHorizontal:a,position:{x:r,y:i}}},n.prototype.getHorizontalSnapline=function(e,t){var r=!1,i=0,o=e.id,a;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)a=Xr(l);else{var u=this.graphModel.getNodeModelById(o);u&&(a=Xr(u))}}for(var d=0;d<t.length;d++){var f=t[d];if(f.id!==e.id){var h=Xr(f);if(_i(h.minY,a==null?void 0:a.minY,this.epsilon)||_i(h.maxY,a==null?void 0:a.minY,this.epsilon)){r=!0,i=a.minY;break}if(_i(h.minY,a==null?void 0:a.maxY,this.epsilon)||_i(h.maxY,a==null?void 0:a.maxY,this.epsilon)){r=!0,i=a.maxY;break}}}return{isShowHorizontal:r,isShowVertical:this.isShowVertical,position:ra(ra({},this.position),{y:i})}},n.prototype.getVerticalSnapline=function(e,t){var r=!1,i=0,o=e.id,a;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)a=Xr(l);else{var u=this.graphModel.getNodeModelById(o);u&&(a=Xr(u))}}for(var d=0;d<t.length;d++){var f=t[d];if(f.id!==e.id){var h=Xr(f);if(_i(h.minX,a==null?void 0:a.minX,this.epsilon)){r=!0,i=a.minX;break}if(_i(h.minX,a==null?void 0:a.minX,this.epsilon)||_i(h.maxX,a==null?void 0:a.minX,this.epsilon)){r=!0,i=a.minX;break}if(_i(h.minX,a==null?void 0:a.maxX,this.epsilon)||_i(h.maxX,a==null?void 0:a.maxX,this.epsilon)){r=!0,i=a.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:r,position:ra(ra({},this.position),{x:i})}},n.prototype.getSnapLinePosition=function(e,t){var r=this.getCenterSnapLine(e,t),i=r.isShowHorizontal,o=r.isShowVertical;if(!i){var a=this.getHorizontalSnapline(e,t);a.isShowHorizontal&&(r.isShowHorizontal=a.isShowHorizontal,r.position.y=a.position.y)}if(!o){var l=this.getVerticalSnapline(e,t);l.isShowVertical&&(r.isShowVertical=l.isShowVertical,r.position.x=l.position.x)}return r},n.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,r=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=r},n.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},n.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,r=this.getSnapLinePosition(e,t);this.setSnaplineInfo(r)},ul([$e],n.prototype,"isShowHorizontal",void 0),ul([$e],n.prototype,"isShowVertical",void 0),ul([$e],n.prototype,"position",void 0),ul([je],n.prototype,"clearSnapline",null),ul([je],n.prototype,"setNodeSnapLine",null),n}();function _i(n,e,t){return Math.abs(n-e)<=t}var TH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),DH=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},LH=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},PH=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},RH=function(n){TH(e,n);function e(){var t=n.apply(this,PH([],LH(arguments),!1))||this;return t.handleResize=function(){var r=t.props,i=r.graphModel,o=r.options,a=i.width,l=i.height,u=i.isContainerWidth,d=i.isContainerHeight,f=a,h=l,v=!1;u&&(f=void 0,v=!0),d&&(h=void 0,v=!0),v&&i.resize(f,h),o.width=a,o.height=l},t.throttleResize=V2(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(kt.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,r,i){i===void 0&&(i="canvas-overlay");var o=this.props.getView,a=o(t.type);return a?He(a,{model:t,graphModel:r,overlay:i},t.id):null},e.prototype.render=function(){var t=this,r=this.props,i=r.graphModel,o=r.tool,a=r.options,l=r.dnd,u=r.snaplineModel,d={};a.width&&(d.width="".concat(i.width,"px")),a.height&&(d.height="".concat(i.height,"px"));var f=i.fakeNode,h=i.editConfigModel,v=i.background,y=h.adjustEdge;return He("div",{className:"lf-graph","flow-id":i.flowId,style:d,children:[He(rH,{graphModel:i,dnd:l,children:[He("g",{className:"lf-base",children:Di(i.sortElements,function(x){return t.getComponent(x,i)})}),f?this.getComponent(f,i):""]}),He(pH,{graphModel:i,children:[He(mH,{graphModel:i}),y?He(aH,{graphModel:i}):"",a.snapline!==!1?He(bH,{snaplineModel:u}):""]}),He(SH,{graphModel:i,tool:o}),v&&He(uH,{background:v}),He(is,{graphModel:i})]})},e=DH([Cr],e),e}(Zt),IH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),zi=function(){return zi=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},zi.apply(this,arguments)},BH=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},jH=function(n){IH(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(r){var i=r.event,o=t.props,a=o.anchorData,l=o.nodeModel,u=o.graphModel;u.selectNodeById(l.id),l.autoToFront&&u.toFront(l.id),u.eventCenter.emit(kt.ANCHOR_DRAGSTART,{data:a,e:i,nodeModel:l}),t.setState({startX:a.x,startY:a.y,endX:a.x,endY:a.y})},t.onDragging=function(r){var i=r.event,o=t.props,a=o.graphModel,l=o.nodeModel,u=o.anchorData,d=a.transformModel,f=a.eventCenter,h=a.width,v=a.height,y=a.editConfigModel,x=y.autoExpand,w=y.stopMoveGraph;if(i){var _=i.clientX,b=i.clientY,E=a.getPointByClient({x:_,y:b}),k=E.domOverlayPosition,O=k.x,N=k.y,I=E.canvasOverlayPosition,T=I.x,L=I.y;t.t&&Hd(t.t);var H=[],X=10;O<10?H=[X,0]:O+10>h?H=[-X,0]:N<10?H=[0,X]:N+10>v&&(H=[0,-X]),t.setState({endX:T,endY:L,dragging:!0}),t.moveAnchorEnd(T,L),H.length>0&&!w&&x&&(t.t=vw(function(){var V=BH(H,2),q=V[0],D=V[1];d.translate(q,D);var W=t.state,$=W.endX,pe=W.endY;t.setState({endX:$-q,endY:pe-D}),t.moveAnchorEnd($-q,pe-D)})),f.emit(kt.ANCHOR_DRAG,{data:u,e:i,nodeModel:l})}},t.onDragEnd=function(r){var i=r.event;t.t&&Hd(t.t);var o=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var a=t.props,l=a.graphModel,u=a.nodeModel,d=a.anchorData;l.eventCenter.emit(kt.ANCHOR_DRAGEND,{data:d,e:i,nodeModel:u,edgeModel:o??void 0})},t.checkEnd=function(r){var i,o=t.props,a=o.graphModel,l=o.nodeModel,u=o.anchorData,d=u.x,f=u.y,h=u.id,v=t.state,y=v.endX,x=v.endY,w=v.dragging,_=Bd({x:y,y:x},a);if(t.preTargetNode&&t.preTargetNode.state!==tn.DEFAULT&&t.preTargetNode.setElementState(tn.DEFAULT),!!w&&_&&_.node){var b=_.node,E=_.anchor.id,k="".concat(l.id,"_").concat(b.id,"_").concat(E,"_").concat(h),O=t.sourceRuleResults.get(k)||{},N=O.isAllPass,I=O.msg,T=t.targetRuleResults.get(k)||{},L=T.isAllPass,H=T.msg;if(N&&L){b.setElementState(tn.DEFAULT);var X=a.getNodeModelById(_.node.id),V=(i=a.edgeGenerator)===null||i===void 0?void 0:i.call(a,l.getData(),X==null?void 0:X.getData()),q=a.addEdge(zi(zi({},V),{sourceNodeId:l.id,sourceAnchorId:h,startPoint:{x:d,y:f},targetNodeId:_.node.id,targetAnchorId:_.anchor.id,endPoint:{x:_.anchor.x,y:_.anchor.y}})),D=t.props.anchorData;return a.eventCenter.emit(kt.ANCHOR_DROP,{data:D,e:r,nodeModel:l,edgeModel:q}),q}var W=b.getData();return a.eventCenter.emit(kt.CONNECTION_NOT_ALLOWED,{data:W,msg:H||I||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new fi({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,r=t.anchorData,i=t.style,o=t.node,a=o.getAnchorShape(r);if(a)return a;var l=r.x,u=r.y,d=zi(zi({},i),i==null?void 0:i.hover);return He("g",{children:[He(bs,zi({className:"lf-node-anchor-hover"},d,{x:l,y:u})),He(bs,zi({className:"lf-node-anchor"},i,{x:l,y:u}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,r=t.graphModel,i=r.getAnchorIncomingEdge,o=r.getAnchorOutgoingEdge,a=t.anchorData.id;return{incomingEdgeList:i(a),outgoingEdgeList:o(a)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,r){var i,o,a=this.props,l=a.graphModel,u=a.nodeModel,d=a.anchorData,f=Bd({x:t,y:r},l);if(f){var h=f.node,v=f.anchor.id;if(this.preTargetNode&&this.preTargetNode!==f.node&&this.preTargetNode.setElementState(tn.DEFAULT),d.id===v)return;this.preTargetNode=h;var y="".concat(u.id,"_").concat(h.id,"_").concat(v,"_").concat(d.id);if(!this.targetRuleResults.has(y)){var x=f.anchor,w=u.isAllowConnectedAsSource(h,d,x),_=h.isAllowConnectedAsTarget(u,d,x);this.sourceRuleResults.set(y,jd(w)),this.targetRuleResults.set(y,jd(_))}var b=((i=this.sourceRuleResults.get(y))!==null&&i!==void 0?i:{}).isAllPass,E=((o=this.targetRuleResults.get(y))!==null&&o!==void 0?o:{}).isAllPass;b&&E?h.setElementState(tn.ALLOW_CONNECT):h.setElementState(tn.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==tn.DEFAULT&&this.preTargetNode.setElementState(tn.DEFAULT)},e.prototype.isShowLine=function(){var t=this.state,r=t.startX,i=t.startY,o=t.endX,a=t.endY,l=ki(r,i,o,a);return l>10},e.prototype.render=function(){var t=this,r=this.state,i=r.startX,o=r.startY,a=r.endX,l=r.endY,u=this.props,d=u.anchorData,f=u.edgeStyle,h=u.nodeModel,v=u.graphModel,y=d.edgeAddable;return He("g",{className:"lf-anchor",children:[He("g",{onClick:function(x){x.stopPropagation(),v.eventCenter.emit(kt.ANCHOR_CLICK,{data:d,e:x,nodeModel:h})},onMouseDown:function(x){v.eventCenter.emit(kt.ANCHOR_MOUSEDOWN,{data:d,e:x,nodeModel:h}),y!==!1&&t.dragHandler.handleMouseDown(x)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(zi({sourcePoint:{x:i,y:o},targetPoint:{x:a,y:l}},f)):He(_s,zi({x1:i,y1:o,x2:a,y2:l},f,{"pointer-events":"none"})))]})},e}(Zt),HH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),fv=function(){return fv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},fv.apply(this,arguments)},$H=function(n){HH(e,n);function e(t){var r=n.call(this,t)||this;return r.style={},r.onDragging=function(i){var o,a=i.event,l=r.props,u=l.graphModel,d=l.nodeModel,f=l.eventCenter,h=u.selectNodes,v=d.x,y=d.y,x=a.clientX,w=a.clientY,_=u.getPointByClient({x,y:w}).canvasOverlayPosition,b=_.x,E=_.y,k=new ur(b-v,E-y),O=((o=r.normal)===null||o===void 0?void 0:o.angle(k))-r.defaultAngle,N=new Rd(-v,-y).rotate(O).translate(v,y).toString();d.transform=N,d.rotate=O;var I=Di(h,function(L){return L.id});I.indexOf(d.id)===-1&&(I=[d.id]);var T=W2(I,function(L,H){var X=u.getNodeModelById(H);return L[H]=X==null?void 0:X.getMoveDistance(0,0,!1),L},{});I.forEach(function(L){var H=u.getNodeEdges(L);H.forEach(function(X){if(T[X.sourceNodeId]){var V=u.getNodeModelById(X.sourceNodeId),q=V.anchors.find(function(D){return D.id===X.sourceAnchorId});X.updateStartPoint(q)}if(T[X.targetNodeId]){var V=u.getNodeModelById(X.targetNodeId),q=V.anchors.find(function($){return $.id===X.targetAnchorId});X.updateEndPoint(q)}})}),f.emit(kt.NODE_ROTATE,{e:a,model:d,data:d.getData()})},r.style=t.style,r.stepperDrag=new fi({onDragging:r.onDragging}),r}return e.prototype.render=function(){var t=this,r=this.props.nodeModel,i=r.x,o=r.y,a=r.width,l=r.height,u=i+a/2+20,d=o-l/2-20;return this.normal=new ur(1,0),this.defaultAngle=this.normal.angle(new ur(u-i,d-o)),r.defaultAngle=this.defaultAngle,He("g",{className:"lf-rotate-control",children:He("g",{onMouseDown:function(f){t.stepperDrag.handleMouseDown(f)},children:He(bs,fv({},this.style,{cx:u,cy:d}))})})},e}(Zt),Kf={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Q_;function FH(){return Q_||(Q_=1,function(n){(function(){var e={}.hasOwnProperty;function t(){for(var o="",a=0;a<arguments.length;a++){var l=arguments[a];l&&(o=i(o,r(l)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var l in o)e.call(o,l)&&o[l]&&(a=i(a,l));return a}function i(o,a){return a?o?o+" "+a:o+a:o}n.exports?(t.default=t,n.exports=t):window.classNames=t})()}(Kf)),Kf.exports}var zH=FH();const hv=va(zH);var UH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pv=function(){return pv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pv.apply(this,arguments)},VH=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},ww=function(n){UH(e,n);function e(t){var r=n.call(this)||this;r.mouseDownHandler=function(o){var a=r.props,l=a.draggable,u=a.model,d=a.graphModel,f=d.editConfigModel.nodeTextDraggable;(l??f)&&(o.stopPropagation(),r.stepperDrag.model=u,r.stepperDrag.handleMouseDown(o))},r.onDragging=function(o){var a=o.deltaX,l=o.deltaY,u=r.props,d=u.model,f=u.graphModel.transformModel;if(a||l){var h=VH(f.fixDeltaXY(a,l),2),v=h[0],y=h[1];d.moveText(v,y)}},r.dbClickHandler=function(){var o=r.props,a=o.editable,l=o.graphModel.eventCenter,u=o.model;a&&u.setElementState(tn.TEXT_EDIT),l.emit(kt.TEXT_DBCLICK,{data:u.text,model:u})};var i=t.draggable;return r.stepperDrag=new fi({onDragging:r.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),r}return e.prototype.getShape=function(){var t=this.props,r=t.model,i=t.graphModel,o=i.editConfigModel,a=r.text,l=a.value,u=a.x,d=a.y,f=a.editable,h=a.draggable,v={x:u,y:d,className:"",value:l},y=r.getTextStyle(),x=o.nodeTextDraggable||h;return He(gw,pv({},v,y,{className:hv({"lf-element-text":f,"lf-text-draggable":!f&&x,"lf-text-disabled":!f&&!x}),model:r}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return He("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e}(Zt),WH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bi=function(){return bi=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},bi.apply(this,arguments)},id=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},GH=function(n){WH(e,n);function e(t){var r=n.call(this,t)||this;return r.setHoverOn=function(){r.setState({isHovered:!0})},r.setHoverOff=function(){r.setState({isHovered:!1})},r.state={isHovered:!1},r}return e.prototype.getBackground=function(){var t=this.state.isHovered,r=this.props.model,i=r.text,o=r.getTextStyle(),a=o.background||{};if(t&&o.hover&&o.hover.background&&(a=bi(bi({},a),o.hover.background)),i!=null&&i.value&&(a==null?void 0:a.fill)!=="transparent"){var l=o.fontSize,u=o.textWidth,d=o.lineHeight,f=o.overflowMode,h=a.wrapPadding,v=i==null?void 0:i.value.split(/[\r\n]/g),y=v.length,x=i.x,w=i.y,_={};if(f==="autoWrap"&&u){var b=pw({rows:v,style:{fontSize:"".concat(l,"px"),width:"".concat(u,"px"),lineHeight:d,padding:h},rowsLength:y,className:"lf-get-text-height"});_=bi(bi({},a),{x,y:w,width:u,height:b})}else{var E=N5({rows:v,rowsLength:y,fontSize:l}),k=E.width,O=E.height;if(f==="ellipsis"&&(k=u,O=l+2),typeof a.wrapPadding=="string"){var N=a.wrapPadding.split(",").filter(function(Se){return Se.trim()}).map(function(Se){return parseFloat(Se.trim())});if(N.length>0&&N.length<=4){if(N.length===1){var I=id(N,1),T=I[0];N=[T,T,T,T]}else if(N.length===2){var L=id(N,2),H=L[0],X=L[1];N=[H,X,H,X]}else if(N.length===3){var V=id(N,3),q=V[0],X=V[1],D=V[2];N=[q,X,D,X]}var W=id(N,4),$=W[0],pe=W[1],De=W[2],de=W[3];k+=pe+de,O+=$+De,x=x+(pe-de)/2,w=w+(De-$)/2}}_=bi(bi({},a),{x:x-1,y:w-1,width:k,height:O})}return He(si,bi({},_))}return null},e.prototype.getShape=function(){var t=this.props.model,r=t.text,i=r.x,o=r.y,a=r.value;if(!a)return null;var l=t.getTextStyle(),u=bi({x:i,y:o,value:a,model:t,className:"lf-element-text"},l);return He("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),He(gw,bi({},u))]})},e}(ww),qH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ud=function(){return Ud=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ud.apply(this,arguments)},XH=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t},od=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},jo=function(n){qH(e,n);function e(t){var r=n.call(this)||this;r.onDragStart=function(u){var d=u.event,f=r.props,h=f.model,v=f.graphModel;if(d){var y=v.getPointByClient({x:d.clientX,y:d.clientY}).canvasOverlayPosition,x=y.x,w=y.y;r.moveOffset={dx:h.x-x,dy:h.y-w}}},r.onDragging=function(u){var d,f,h,v,y=u.event,x=r.props,w=x.model,_=x.graphModel,b=_.editConfigModel,E=b.stopMoveGraph,k=b.autoExpand,O=b.snapGrid,N=_.transformModel,I=_.selectNodes,T=_.width,L=_.height,H=_.gridSize;w.isDragging=!0;var X=y,V=X.clientX,q=X.clientY,D=_.getPointByClient({x:V,y:q}).canvasOverlayPosition,W=D.x,$=D.y,pe=od(N.CanvasPointToHtmlPoint([W,$]),2),De=pe[0],de=pe[1];if(W=W+((f=(d=r.moveOffset)===null||d===void 0?void 0:d.dx)!==null&&f!==void 0?f:0),$=$+((v=(h=r.moveOffset)===null||h===void 0?void 0:h.dy)!==null&&v!==void 0?v:0),W=ys(W,H,O),$=ys($,H,O),!T||!L){_.moveNode2Coordinate(w.id,W,$);return}var Se=De<0||de<0||De>T||de>L;if(!(k&&!E&&Se)){var me=od(N.CanvasPointToHtmlPoint([W-w.width/2,$-w.height/2]),2),ve=me[0],Re=me[1],Ie=od(N.CanvasPointToHtmlPoint([W+w.width/2,$+w.height/2]),2),ce=Ie[0],ue=Ie[1],K=Math.max(H,20),ie=[];ve<0?ie=[K,0]:ce>_.width?ie=[-K,0]:Re<0?ie=[0,K]:ue>_.height&&(ie=[0,-K]),r.t&&Hd(r.t);var ne=I.map(function(fe){return fe.id});ne.indexOf(w.id)===-1&&(ne=[w.id]),ie.length>0&&!E&&k?r.t=vw(function(){var fe=od(ie,2),he=fe[0],be=fe[1];N.translate(he??0,be??0);var xe=-(he??0)/N.SCALE_X,Ze=-(be??0)/N.SCALE_X;_.moveNodes(ne,xe,Ze)}):_.moveNodes(ne,W-w.x,$-w.y)}},r.onDragEnd=function(){r.t&&Hd(r.t);var u=r.props.model;u.isDragging=!1},r.onMouseOut=function(u){o5()&&r.setHoverOff(u)},r.handleMouseUp=function(){var u=r.props.model;r.mouseUpDrag=u.isDragging},r.handleClick=function(u){var d=r.mouseUpDrag===!1;if(r.startTime){var f=r.props,h=f.model,v=f.graphModel;if(d){var y=h.getData(),x=v.getPointByClient({x:u.clientX,y:u.clientY}),w={data:y,e:u,position:x,isSelected:!1,isMultiple:!1},_=u.button===2,b=u.detail===2;if(!_){var E=v.editConfigModel,k=fw(u,E);w.isMultiple=k,h.isSelected&&!b&&k?(w.isSelected=!1,h.setSelected(!1)):(v.selectNodeById(h.id,k),w.isSelected=!0,E.isSilentMode||r.toFront()),b?(E.nodeTextEdit&&h.text.editable&&E.textMode===ui.TEXT&&(h.setSelected(!1),v.setElementStateById(h.id,tn.TEXT_EDIT)),v.eventCenter.emit(kt.NODE_DBCLICK,w)):(v.eventCenter.emit(kt.ELEMENT_CLICK,w),v.eventCenter.emit(kt.NODE_CLICK,w))}}}},r.handleContextMenu=function(u){u.preventDefault();var d=r.props,f=d.model,h=d.graphModel,v=h.editConfigModel,y=f.getData(),x=h.getPointByClient({x:u.clientX,y:u.clientY});h.setElementStateById(f.id,tn.SHOW_MENU,x.domOverlayPosition),f.isSelected||h.selectNodeById(f.id),h.eventCenter.emit(kt.NODE_CONTEXTMENU,{data:y,e:u,position:x}),v.isSilentMode||r.toFront()},r.handleMouseDown=function(u){var d=r.props,f=d.model,h=d.graphModel;r.startTime=new Date().getTime();var v=h.editConfigModel;v.adjustNodePosition&&f.draggable&&r.stepDrag&&r.stepDrag.handleMouseDown(u)},r.handleFocus=function(){var u=r.props,d=u.model,f=u.graphModel;f.eventCenter.emit(kt.NODE_FOCUS,{data:d.getData()})},r.handleBlur=function(){var u=r.props,d=u.model,f=u.graphModel;f.eventCenter.emit(kt.NODE_BLUR,{data:d.getData()})},r.setHoverOn=function(u){var d=r.props,f=d.model,h=d.graphModel;if(!f.isHovered){var v=f.getData();f.setHovered(!0),h.eventCenter.emit(kt.NODE_MOUSEENTER,{data:v,e:u})}},r.setHoverOff=function(u){var d=r.props,f=d.model,h=d.graphModel,v=f.getData();f.isHovered&&(f.setHovered(!1),h.eventCenter.emit(kt.NODE_MOUSELEAVE,{data:v,e:u}))};var i=t.graphModel,o=i.gridSize,a=i.eventCenter,l=t.model;return r.stepDrag=new fi({onDragStart:r.onDragStart,onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:o,eventType:"NODE",isStopPropagation:!1,eventCenter:a,model:l}),r.modelDisposer=$x(function(){return r.props},function(u){u&&u.model&&r.stepDrag.setModel(u.model)}),r}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,r=this.props,i=r.model,o=r.graphModel,a=i.isSelected,l=i.isHitable,u=i.isDragging,d=i.isShowAnchor;return l&&(a||d)&&!u?Di(i.anchors,function(f,h){var v=i.getAnchorLineStyle(f),y=i.getAnchorStyle(f);return He(jH,{anchorData:f,node:t,style:y,edgeStyle:v,anchorIndex:h,nodeModel:i,graphModel:o,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,r=t.model,i=t.graphModel,o=i.editConfigModel,a=o.isSilentMode,l=o.allowRotate,u=r.isSelected,d=r.isHitable,f=r.rotatable,h=r.isHovered,v=l&&f,y=r.getRotateControlStyle();if(!a&&d&&(u||h)&&v)return He($H,{graphModel:i,nodeModel:r,eventCenter:i.eventCenter,style:y})},e.prototype.getResizeControl=function(){var t=this.props,r=t.model,i=t.graphModel,o=i.editConfigModel,a=o.isSilentMode,l=o.allowResize,u=r.isSelected,d=r.isHitable,f=r.resizable,h=r.isHovered,v=l&&f,y=r.getResizeControlStyle();return!a&&d&&(u||h)&&v?He(oj,{style:y,model:r,graphModel:i}):null},e.prototype.getText=function(){var t,r=this.props,i=r.model,o=r.graphModel,a=o.editConfigModel;if(a.nodeTextMode!==ui.TEXT||i.state===tn.TEXT_EDIT)return null;if(i.text){var l=!1;return a.nodeTextDraggable&&i.text.draggable&&(l=!0),He(ww,{editable:a.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,r=t.state,i=t.isDragging,o=t.isSelected,a="lf-node";switch(r){case tn.ALLOW_CONNECT:a+=" lf-node-allow";break;case tn.NOT_ALLOW_CONNECT:a+=" lf-node-not-allow";break;default:a+=" lf-node-default";break}return i&&(a+=" lf-dragging"),o&&(a+=" lf-node-selected"),a},e.prototype.toFront=function(){var t=this.props,r=t.model,i=t.graphModel;r.autoToFront&&i.toFront(r.id)},e.prototype.render=function(){var t=this.props,r=t.model,i=t.graphModel,o=i.editConfigModel,a=o.hideAnchors,l=o.adjustNodePosition,u=o.allowRotate,d=o.allowResize,f=i.gridSize,h=i.transformModel.SCALE_X,v=r.isHitable,y=r.draggable,x=r.transform,w=r.getOuterGAttributes(),_=w.className,b=_===void 0?"":_,E=XH(w,["className"]),k=He("g",{className:"lf-node-content",children:[He("g",{transform:x,children:[this.getShape(),this.getText(),u&&this.getRotateControl(),d&&this.getResizeControl()]}),!a&&this.getAnchors()]}),O;return v?(l&&y&&this.stepDrag.setStep(f*h),O=He("g",Ud({className:"".concat(this.getStateClassName()," ").concat(b),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},E,{children:k}))):O=He("g",Ud({className:"".concat(this.getStateClassName()," ").concat(b)},E,{children:k})),O},e.isObserved=!1,e}(Zt),YH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),vv=function(){return vv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vv.apply(this,arguments)},ha=function(n){YH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle();return He(si,vv({},r,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e}(jo),KH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),gv=function(){return gv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gv.apply(this,arguments)},Vd=function(n){KH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.r,a=t.getNodeStyle();return He(bs,gv({},a,{x:r,y:i,r:o}))},e}(jo),JH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wd=function(){return Wd=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Wd.apply(this,arguments)},Gd=function(n){JH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t,i=r.x,o=r.y,a=r.width,l=r.height,u=r.points,d=t.getNodeStyle(),f={transform:"matrix(1 0 0 1 ".concat(i-a/2," ").concat(o-l/2,")")};return He("g",Wd({},f,{children:He(hg,Wd({},d,{points:u,x:i,y:o}))}))},e}(jo),ZH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),mv=function(){return mv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},mv.apply(this,arguments)},yv=function(n){ZH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle();return He("g",{children:He(hg,mv({},r,{points:t.points,x:t.x,y:t.y}))})},e}(jo),QH=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_v=function(){return _v=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_v.apply(this,arguments)},bv=function(n){QH(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle();return He(J5,_v({},r,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e}(jo),e$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ol=function(){return Ol=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ol.apply(this,arguments)},e0=function(n){e$(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,r=t.getTextStyle(),i=t.width,o=t.height,a=t.x,l=t.y,u=Ol(Ol({},r.background),{x:a,y:l,width:i,height:o});return He(si,Ol({},u))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return He("g",{children:this.getBackground()})},e}(jo),t$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xv=function(){return xv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xv.apply(this,arguments)},n$=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},r$=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},Xl=function(n){t$(e,n);function e(){var t=n.apply(this,r$([],n$(arguments),!1))||this;return t.ref=Ac(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.height,a=t.width,l=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),He("foreignObject",xv({},l,{x:r-a/2,y:i-o/2,width:a,height:o,ref:this.ref}))},e}(jo),i$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xi=function(){return xi=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xi.apply(this,arguments)},o$=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t},a$=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Vi;(function(n){n.SOURCE="SOURCE",n.TARGET="TARGET"})(Vi||(Vi={}));var t0=function(n){i$(e,n);function e(t){var r=n.call(this)||this;r.handleMouseDown=function(u){r.stepDrag&&r.stepDrag.handleMouseDown(u)},r.onDragStart=function(){var u=r.props,d=u.x,f=u.y,h=u.edgeModel,v=h.startPoint,y=h.endPoint,x=h.pointsList;r.oldEdge={startPoint:v,endPoint:y,pointsList:x},r.setState({endX:d,endY:f,dragging:!0})},r.onDragging=function(u){var d=u.deltaX,f=u.deltaY,h=r.state,v=h.endX,y=h.endY,x=r.props,w=x.graphModel,_=x.type,b=w.transformModel,E=w.editConfigModel,k=a$(b.moveCanvasPointByHtml([v,y],d,f),2),O=k[0],N=k[1];r.setState({endX:O,endY:N,dragging:!0});var I=r.props.edgeModel,T=Bd({x:v,y},w);if(T&&T.node&&r.isAllowAdjust(T).pass){var L=I.startPoint,H=I.endPoint,X=I.sourceNode,V=I.targetNode,q=_===Vi.SOURCE?{startPoint:{x:T.anchor.x,y:T.anchor.y},endPoint:{x:H.x,y:H.y},sourceNode:T.node,targetNode:V}:{startPoint:{x:L.x,y:L.y},endPoint:{x:T.anchor.x,y:T.anchor.y},sourceNode:X,targetNode:T.node};I.updateAfterAdjustStartAndEnd(q)}else _===Vi.SOURCE?I.updateStartPoint({x:O,y:N}):I.updateEndPoint({x:O,y:N});I.text.value&&E.adjustEdge&&I.setText(Object.assign({},I.text,I.textPosition))},r.onDragEnd=function(u){var d,f,h,v=u.event;try{r.setState({dragging:!1});var y=r.props,x=y.graphModel,w=y.edgeModel,_=y.type,b=r.state,E=b.endX,k=b.endY,O=b.dragging,N=Bd({x:E,y:k},x);if(!O)return;var I=!1,T=void 0;if(N&&N.node){var L=r.isAllowAdjust(N),H=L.pass,X=L.msg,V=L.newTargetNode;if(H){var q=w.getData(),D=q.text,W=q.sourceAnchorId,$=W===void 0?"":W,pe=q.targetAnchorId,De=pe===void 0?"":pe,de=o$(q,["text","sourceAnchorId","targetAnchorId"]);if(T=xi(xi({sourceAnchorId:$,targetAnchorId:De},de),{text:(D==null?void 0:D.value)||""}),_===Vi.SOURCE){var Se=x.getNodeModelById(N.node.id),me=x.getNodeModelById(w.targetNodeId),ve=(d=x.edgeGenerator)===null||d===void 0?void 0:d.call(x,Se==null?void 0:Se.getData(),me==null?void 0:me.getData(),T);T=xi(xi({},ve),{sourceNodeId:N.node.id,sourceAnchorId:N.anchor.id,startPoint:{x:N.anchor.x,y:N.anchor.y},targetNodeId:w.targetNodeId,endPoint:xi({},w.endPoint)}),w.sourceNodeId===N.node.id&&w.sourceAnchorId===N.anchor.id&&(I=!0)}else if(_===Vi.TARGET){var Se=x.getNodeModelById(w.sourceNodeId),me=x.getNodeModelById(N.node.id),ve=(f=x.edgeGenerator)===null||f===void 0?void 0:f.call(x,Se==null?void 0:Se.getData(),me==null?void 0:me.getData(),T);T=xi(xi({},ve),{sourceNodeId:w.sourceNodeId,startPoint:xi({},w.startPoint),targetNodeId:N.node.id,targetAnchorId:N.anchor.id,endPoint:{x:N.anchor.x,y:N.anchor.y}}),w.targetNodeId===N.node.id&&w.targetAnchorId===N.anchor.id&&(I=!0)}}else{I=!0;var Re=V.getData();x.eventCenter.emit(kt.CONNECTION_NOT_ALLOWED,{data:Re,msg:X})}}else I=!0;if(I)r.recoveryEdge();else{var Ie=w.getData();x.deleteEdgeById(w.id);var ce=x.addEdge(xi({},T));x.eventCenter.emit(kt.EDGE_EXCHANGE_NODE,{data:{newEdge:ce.getData(),oldEdge:Ie}})}(h=r.preTargetNode)===null||h===void 0||h.setElementState(tn.DEFAULT)}finally{var x=r.props.graphModel;x.eventCenter.emit(kt.ADJUST_POINT_DRAGEND,{e:v,data:r.stepDragData})}},r.recoveryEdge=function(){var u=r.props.edgeModel,d=r.oldEdge,f=d.startPoint,h=d.endPoint,v=d.pointsList;u.updateStartPoint(f),u.updateEndPoint(h),u.modelType!==Wt.LINE_EDGE&&(u.pointsList=v??[],u.initPoints())},r.getAdjustPointStyle=function(){var u=r.props.graphModel.theme,d=u.edgeAdjust;return d},r.state={dragging:!1,endX:0,endY:0},r.targetRuleResults=new Map,r.sourceRuleResults=new Map;var i=t.type,o=t.edgeModel,a=t.graphModel,l=a.eventCenter;return r.stepDragData={type:i,edgeData:o.getData()},r.stepDrag=new fi({onDragStart:r.onDragStart,onDragging:r.onDragging,onDragEnd:r.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:l,data:r.stepDragData}),r}return e.prototype.isAllowAdjust=function(t){var r=this.props,i=r.edgeModel,o=i.id,a=i.sourceNode,l=i.targetNode,u=i.sourceAnchorId,d=i.targetAnchorId,f=r.type,h,v,y,x;if(f===Vi.SOURCE?(h=t.node,v=l,y=t.anchor,x=l.getAnchorInfo(d)):(h=a,v=t.node,x=t.anchor,y=a.getAnchorInfo(u)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(tn.DEFAULT),this.preTargetNode=t.node,x.id===y.id)return{pass:!1,msg:"",newTargetNode:v};var w="".concat(h.id,"_").concat(v.id,"_").concat(y.id,"_").concat(x.id);if(!this.targetRuleResults.has(w)){var _=h.isAllowConnectedAsSource(v,y,x,o),b=v.isAllowConnectedAsTarget(h,y,x,o);this.sourceRuleResults.set(w,jd(_)),this.targetRuleResults.set(w,jd(b))}var E=this.sourceRuleResults.get(w),k=E.isAllPass,O=E.msg,N=this.targetRuleResults.get(w),I=N.isAllPass,T=N.msg,L=k&&I?tn.ALLOW_CONNECT:tn.NOT_ALLOW_CONNECT;return f===Vi.SOURCE?h.setElementState(L):v.setElementState(L),{pass:k&&I,msg:T||O,newTargetNode:v}},e.prototype.render=function(){var t=this.props,r=t.x,i=t.y,o=t.getAdjustPointShape,a=t.edgeModel,l=this.state.dragging;return He("g",{pointerEvents:l?"none":"",onMouseDown:this.handleMouseDown,children:l?"":o(r,i,a)})},e}(Zt),s$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),wv=function(){return wv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},wv.apply(this,arguments)};(function(n){s$(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,r=t.arrowInfo,i=t.style,o=r.start,a=r.end,l={start:o,end:a,offset:i.offset,verticalLength:i.verticalLength,type:"end"},u=jl(l),d=u.leftX,f=u.leftY,h=u.rightX,v=u.rightY;return wv({d:"M".concat(d," ").concat(f," L").concat(a.x," ").concat(a.y," L").concat(h," ").concat(v," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),r=t.d,i=t.strokeWidth,o=t.stroke,a=t.fill;return He(Fl,{d:r,fill:a,strokeWidth:i,stroke:o})},e.prototype.render=function(){return He("g",{className:"lf-arrow",children:this.getShape()})},e})(Zt);var l$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ml=function(){return Ml=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ml.apply(this,arguments)},u$=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},jc=function(n){l$(e,n);function e(){var t=n.call(this)||this;return t.textRef=Ac(),t.handleHover=function(r,i){var o=t.props,a=o.model,l=o.graphModel.eventCenter;a.setHovered(r);var u=r?kt.EDGE_MOUSEENTER:kt.EDGE_MOUSELEAVE,d=a.getData();l.emit(u,{data:d,e:i})},t.setHoverOn=function(r){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,r))},t.setHoverOff=function(r){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,r))},t.handleContextMenu=function(r){r.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,o=i.model,a=i.graphModel,l=a.editConfigModel,u=a.getPointByClient({x:r.clientX,y:r.clientY});a.setElementStateById(o.id,tn.SHOW_MENU,u.domOverlayPosition),l.isSilentMode||t.toFront(),o.isSelected||a.selectEdgeById(o.id);var d=o==null?void 0:o.getData();a.eventCenter.emit(kt.EDGE_CONTEXTMENU,{data:d,e:r,position:u})},t.handleMouseDown=function(r){r.stopPropagation(),t.startTime=new Date().getTime()},t.handleMouseUp=function(){var r=t.props.model;t.mouseUpDrag=r.isDragging},t.handleClick=function(r){if(t.startTime&&!t.mouseUpDrag){var i=r.button===2;if(!i){var o=r.detail===2,a=t.props,l=a.model,u=a.graphModel,d=l==null?void 0:l.getData(),f=u.getPointByClient({x:r.clientX,y:r.clientY});if(o){var h=u.editConfigModel,v=u.textEditElement,y=l.id,x=l.text,w=l.modelType;if(v&&v.id===y&&u.setElementStateById(y,tn.DEFAULT),h.edgeTextEdit&&x.editable&&(l.setSelected(!1),u.setElementStateById(y,tn.TEXT_EDIT)),w===Wt.POLYLINE_EDGE){var _=l,b=u.getPointByClient({x:r.x,y:r.y}).canvasOverlayPosition,E=b.x,k=b.y;_.dbClickPosition=cw({x:E,y:k},_.points)}u.eventCenter.emit(kt.EDGE_DBCLICK,{data:d,e:r,position:f})}else u.eventCenter.emit(kt.ELEMENT_CLICK,{data:d,e:r,position:f}),u.eventCenter.emit(kt.EDGE_CLICK,{data:d,e:r,position:f});var O=u.editConfigModel;u.selectEdgeById(l.id,fw(r,O)),O.isSilentMode||t.toFront()}}},t.handleFocus=function(){var r=t.props,i=r.model,o=r.graphModel;o.eventCenter.emit(kt.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var r=t.props,i=r.model,o=r.graphModel;o.eventCenter.emit(kt.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return He("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,r=this.props,i=r.model,o=r.graphModel,a=o.editConfigModel;if(a.edgeTextMode!==ui.TEXT||i.state===tn.TEXT_EDIT)return null;if(i.text){var l=!1;return a.edgeTextDraggable&&i.text.draggable&&(l=!0),He(GH,{ref:this.textRef,editable:a.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,r=t.startPoint,i=t.endPoint,o=t.isSelected,a=this.state.hover;return{start:r,end:i,hover:a,isSelected:o}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,r=t.startPoint,i=t.endPoint;return[r,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,r=t.id,i=t.getArrowStyle(),o=i.refY,a=o===void 0?0:o,l=i.refX,u=l===void 0?2:l,d=u$(this.getLastTwoPoints(),2),f=d[0],h=d[1],v="auto";if(f&&h){var y=h.x-f.x,x=h.y-f.y;if(y!==0||x!==0){var w=xj(bj({x:y,y:x}));Number.isFinite(w)&&!Number.isNaN(w)&&(v=w)}}return He("g",{children:He("defs",{children:[He("marker",{id:"marker-start-".concat(r),refX:-u,refY:a,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),He("marker",{id:"marker-end-".concat(r),refX:u,refY:a,overflow:"visible",orient:v,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,r){var i=r.stroke,o=r.fill,a=o===void 0?i:o,l=r.strokeWidth,u=r.offset,d=u===void 0?10:u,f=r.verticalLength,h=r.strokeLinecap,v=r.strokeLinejoin,y=r.transform,x="";switch(t){case"solid":x="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(f," L").concat(3*d/4,",-").concat(f," Z");break;case"hollow":x="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(f," L").concat(-d/4,",0 L").concat(3*d/4,",-").concat(f," L").concat(-d/4,",0 Z");break;case"diamond":x="M".concat(-d/2,",0 L0,").concat(f," L").concat(d/2,",0 L0,-").concat(f," L").concat(-d/2,",0 Z");break;case"circle":x="M".concat(-d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(-d/2,",0 Z");break;default:x="";break}return He("path",{d:x,stroke:i,fill:a,strokeWidth:l,strokeLinecap:h,strokeLinejoin:v,transform:y})},e.prototype.getStartArrow=function(){var t=this.props.model,r=t.getArrowStyle(),i=r.stroke,o=r.strokeWidth,a=r.offset,l=r.verticalLength,u=r.startArrowType,d=u===void 0?"none":u,f=r.strokeLinecap,h=r.strokeLinejoin;return this.getArrowPath(d,{stroke:i,strokeWidth:o,offset:a,verticalLength:l,strokeLinecap:f,strokeLinejoin:h})},e.prototype.getEndArrow=function(){var t=this.props.model,r=t.getArrowStyle(),i=r.stroke,o=r.strokeWidth,a=r.offset,l=r.verticalLength,u=r.endArrowType,d=u===void 0?"solid":u,f=r.strokeLinecap,h=r.strokeLinejoin;return this.getArrowPath(d,{stroke:i,strokeWidth:o,offset:a,verticalLength:l,strokeLinecap:f,strokeLinejoin:h,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,r,i){var o=i.getAdjustPointStyle();return He(bs,Ml({className:"lf-edge-adjust-point"},o,{x:t,y:r}))},e.prototype.getAdjustPoints=function(){var t=this.props,r=t.model,i=t.graphModel,o=i.editConfigModel,a=o.adjustEdgeStartAndEnd,l=o.adjustEdgeStart,u=o.adjustEdgeEnd,d=r.getAdjustStart(),f=r.getAdjustEnd();return He("g",{children:[a&&l&&He(t0,Ml({type:Vi.SOURCE},d,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:r,graphModel:i})),a&&u&&He(t0,Ml({type:Vi.TARGET},f,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:r,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return He("g",{})},e.prototype.getAppend=function(){return He("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,r=t.graphModel,i=t.model;r.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,r=t.isSelected,i=t.isHitable,o=t.isShowAdjustPoint;return He("g",{children:[He("g",{className:["lf-edge",!i&&"pointer-none",r&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),o&&r?this.getAdjustPoints():""]})},e.isObserved=!1,e}(Zt),d$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sv=function(){return Sv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Sv.apply(this,arguments)},c$=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Ev=function(n){d$(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,r=t.getEdgeStyle(),i=t,o=i.path,a=i.isAnimation,l=i.arrowConfig,u=t.getEdgeAnimationStyle(),d=u.strokeDasharray,f=u.stroke,h=u.strokeDashoffset,v=u.animationName,y=u.animationDuration,x=u.animationIterationCount,w=u.animationTimingFunction,_=u.animationDirection;return He(Fl,Sv({d:o},r,l,a?{strokeDasharray:d,stroke:f,style:{strokeDashoffset:h,animationName:v,animationDuration:y,animationIterationCount:x,animationTimingFunction:w,animationDirection:_}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return He(Fl,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,r=this.state.hover,i=t.isSelected,o=t.getArrowStyle().offset,a=t.pointsList.map(function(h){return{x:h.x,y:h.y}}),l=c$(R_(a,o),2),u=l[0],d=l[1],f={start:u,end:d,hover:r,isSelected:i};return f},e.prototype.getLastTwoPoints=function(){var t=this.props.model,r=t.getArrowStyle().offset,i=t.pointsList.map(function(o){return{x:o.x,y:o.y}});return R_(i,r)},e}(jc),f$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Cv=function(){return Cv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Cv.apply(this,arguments)},n0=function(n){f$(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,r=t.startPoint,i=t.endPoint,o=t.isAnimation,a=t.arrowConfig,l=t.getEdgeStyle(),u=t.getEdgeAnimationStyle(),d=u.strokeDasharray,f=u.stroke,h=u.strokeDashoffset,v=u.animationName,y=u.animationDuration,x=u.animationIterationCount,w=u.animationTimingFunction,_=u.animationDirection;return He(_s,Cv({},l,{x1:r.x,y1:r.y,x2:i.x,y2:i.y},a,o?{strokeDasharray:d,stroke:f,style:{strokeDashoffset:h,animationName:v,animationDuration:y,animationIterationCount:x,animationTimingFunction:w,animationDirection:_}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,r=t.startPoint,i=t.endPoint,o={start:r,end:i},a=k5(o),l=a.d,u=a.strokeWidth,d=a.fill,f=a.strokeDasharray,h=a.stroke;return He(Fl,{d:l,fill:d,strokeWidth:u,stroke:h,strokeDasharray:f})},e}(jc),h$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ia=function(){return ia=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ia.apply(this,arguments)},p$=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Ss=function(n){h$(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(){var r=t.props.model;r.dragAppendStart(),t.isShowAdjustPointTemp=r.isShowAdjustPoint,r.isShowAdjustPoint=!1},t.onDragging=function(r){var i=r.deltaX,o=r.deltaY,a=t.props,l=a.model,u=a.graphModel;t.isDragging=!0;var d=u.transformModel,f=u.editConfigModel,h=p$(d.fixDeltaXY(i,o),2),v=h[0],y=h[1],x=l,w=f.adjustEdgeMiddle;w?t.appendInfo=x.dragAppendSimple(t.appendInfo,{x:v,y}):t.appendInfo=x.dragAppend(t.appendInfo,{x:v,y})},t.onDragEnd=function(){var r,i=t.props,o=i.model,a=i.graphModel.eventCenter,l=o;l.dragAppendEnd(),t.isDragging=!1,l.isShowAdjustPoint=(r=t.isShowAdjustPointTemp)!==null&&r!==void 0?r:!1,t.appendInfo=void 0,a.emit(kt.EDGE_ADJUST,{data:l.getData()})},t.beforeDragStart=function(r,i){i.draggable&&t.drag.handleMouseDown(r),t.appendInfo=i},t.drag=new fi({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,r=t.points,i=t.isAnimation,o=t.arrowConfig,a=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),u=l.strokeDasharray,d=l.stroke,f=l.strokeDashoffset,h=l.animationName,v=l.animationDuration,y=l.animationIterationCount,x=l.animationTimingFunction,w=l.animationDirection;return He(tj,ia({points:r},a,o,i?{strokeDasharray:u,stroke:d,style:{strokeDashoffset:f,animationName:h,animationDuration:v,animationIterationCount:y,animationTimingFunction:x,animationDirection:w}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,r=t.points,i=t.isSelected,o=this.state.hover,a=fa(r),l=a[0],u=a[0];return a.length>=2&&(l=a[a.length-2],u=a[a.length-1]),{start:l,end:u,hover:o,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,r=t.points,i=fa(r),o=i[0],a=i[0];return i.length>=2&&(o=i[i.length-2],a=i[i.length-1]),[o,a]},e.prototype.getAppendAttributes=function(t){var r=t.start,i=t.end,o;if(r.x===i.x&&r.y===i.y)o="";else{var a={start:r,end:i,offset:10,verticalLength:5},l=jl(ia(ia({},a),{type:"start"})),u=jl(ia(ia({},a),{type:"end"}));o="M".concat(l.leftX," ").concat(l.leftY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(u.rightX," ").concat(u.rightY,`
      L`).concat(u.leftX," ").concat(u.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var r=this.getAppendAttributes(t),i=r.d,o=r.strokeWidth,a=r.fill,l=r.strokeDasharray,u=r.stroke;return He(Fl,{d:i,fill:a,strokeWidth:o,stroke:u,strokeDasharray:l})},e.prototype.getAppendWidth=function(){for(var t=this,r=this.props,i=r.model,o=r.graphModel,a=i.pointsList,l=i.draggable,u=[],d=a.length,f=function(y){var x="lf-polyline-append",w={start:{x:a[y].x,y:a[y].y},end:{x:a[y+1].x,y:a[y+1].y},startIndex:y,endIndex:y+1,direction:_n.HORIZONTAL,draggable:!0},_=He("g",{className:x,children:h.getAppendShape(w)}),b=o.editConfigModel,E=b.adjustEdge,k=b.adjustEdgeMiddle;if(E&&l){var O=w.startIndex,N=w.endIndex,I=k&&(O===0||N===d-1);w.draggable=!I,w.start.x===w.end.x?(w.draggable&&(x+="-ew-resize"),w.direction=_n.VERTICAL):w.start.y===w.end.y&&(w.draggable&&(x+="-ns-resize"),w.direction=_n.HORIZONTAL),_=He("g",{className:h.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(T){return t.beforeDragStart(T,w)},children:He("g",{className:x,children:h.getAppendShape(w)})})}u.push(_)},h=this,v=0;v<d-1;v++)f(v);return He("g",{children:u})},e}(jc),ns=function(){return ns=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ns.apply(this,arguments)},v$=function(){function n(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,window.document.removeEventListener("mouseup",t.stopDrag)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(ns(ns({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(t.lf.graphModel.eventCenter.emit(kt.BLANK_CANVAS_MOUSEMOVE,{e:i}),i.preventDefault(),t.fakeNode){var o=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),a=o.x,l=o.y;t.fakeNode.moveTo(a,l);var u=t.fakeNode.getData();t.lf.setNodeSnapLine(u),t.lf.graphModel.eventCenter.emit(kt.NODE_DND_DRAG,{data:u,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(ns(ns({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),kt.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var r=e.lf;this.lf=r}return n.prototype.clientToLocalPoint=function(e){var t=e.x,r=e.y,i=Zl(this.lf.options,["grid","size"]),o=this.lf.graphModel.getPointByClient({x:t,y:r}),a=o.canvasOverlayPosition,l=a.x,u=a.y,d=this.lf.graphModel.editConfigModel.snapGrid;return{x:ys(l,i,d),y:ys(u,i,d)}},n.prototype.startDrag=function(e){var t=this.lf.graphModel.editConfigModel;t!=null&&t.isSilentMode||(this.nodeConfig=e,window.document.addEventListener("mouseup",this.stopDrag))},n.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},n}();function g$(n,e){n.on("node:mousemove",function(t){var r=t.data;e.setNodeSnapLine(r)}),n.on("node:mouseup",function(){e.clearSnapline()})}var m$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),io=function(){return io=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},io.apply(this,arguments)},y$=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},_$=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},b$=function(n){m$(e,n);function e(t){var r=n.call(this,t)||this;return r.ref=Ac(),r.__prevText={type:"",text:"",id:""},r.keyupHandler=function(i){var o=r.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(o==null||o.setElementState(tn.DEFAULT))},r.inputHandler=function(i){var o=i.target.innerText,a=r.props.graphModel.textEditElement;a&&(r.__prevText={type:a.type,text:o.replace(/(\r\n)+$|(\n)+$/,""),id:a.id})},r.keydownHandler=function(i){i.stopPropagation()},r.state={style:{left:0,top:0}},r}return e.getDerivedStateFromProps=function(t){var r,i=t.textEditElement,o=t.graphModel,a=o.transformModel,l=o.theme,u=l.inputText,d;if(i){if(!(!((r=i.text)===null||r===void 0)&&r.value)&&i.BaseType===kn.EDGE){var f=i.text,h=i.textPosition,v=h.x,y=h.y;f.x=v,f.y=y,i.setText(f)}var x={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===kn.EDGE){var w=l.edgeText,_=w.overflowMode,b=w.lineHeight,E=w.wrapPadding,k=w.textWidth;k&&_==="autoWrap"&&(d=io(io({},x),{width:k,minWidth:k,lineHeight:b,padding:E}))}else if(i.BaseType===kn.NODE){var O=l.nodeText,_=O.overflowMode,b=O.lineHeight,E=O.wrapPadding,k=O.textWidth,N=i.width,I=i.modelType,T=i.textWidth,L=T||k||N;(I!==Wt.TEXT_NODE&&_==="autoWrap"||I===Wt.TEXT_NODE&&k)&&(d=io(io({},x),{width:L,minWidth:L,lineHeight:b,padding:E}))}var H=i.text,X=H.x,V=H.y,q=_$(a.CanvasPointToHtmlPoint([X,V]),2),D=q[0],W=q[1];return{style:io(io({left:D,top:W},d),u)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var r=this.__prevText,i=r.text,o=r.id;t.updateText(o,i),t.eventCenter.emit(kt.TEXT_UPDATE,{data:io({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var r=document.createRange();r.selectNodeContents(t),r.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(r)}},e.prototype.render=function(){var t,r=this.props.graphModel.textEditElement,i=this.state.style;return r?He("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=r.text)===null||t===void 0?void 0:t.value},r.id):null},e.toolName="text-edit-tool",e=y$([Cr],e),e}(Zt),x$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),w$=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Jf=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},S$=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},E$=function(n){x$(e,n);function e(t){var r=n.call(this,t)||this;r.handleMouseDown=function(l){r.stepDrag.handleMouseDown(l)},r.handleWheelEvent=function(l){var u,d;l.preventDefault();var f=l.deltaX,h=l.deltaY,v=l.clientX,y=l.clientY,x=l.ctrlKey,w=new WheelEvent("wheel",{deltaX:f,deltaY:h,clientX:v,clientY:y,ctrlKey:x});(d=(u=r.props.lf.container)===null||u===void 0?void 0:u.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||d===void 0||d.dispatchEvent(w)},r.onDragging=function(l){var u=l.deltaX,d=l.deltaY,f=r.props,h=f.graphModel,v=f.lf,y=v.getTransform(),x=y.SCALE_X,w=y.SCALE_Y,_=h.getSelectElements(!0);h.moveNodes(_.nodes.map(function(b){return b.id}),u/x,d/w)},r.handleContextMenu=function(l){l.preventDefault();var u=r.props,d=u.graphModel,f=u.graphModel,h=f.eventCenter,v=f.selectElements,y=d.getPointByClient({x:l.clientX,y:l.clientY}),x={nodes:[],edges:[]},w=S$([],Jf(v.values()),!1);w.forEach(function(_){_.BaseType===kn.NODE&&x.nodes.push(_.getData()),_.BaseType===kn.EDGE&&x.edges.push(_.getData())}),h.emit(kt.SELECTION_CONTEXTMENU,{data:x,e:l,position:y})};var i=t.graphModel,o=i.gridSize,a=i.eventCenter;return r.stepDrag=new fi({onDragging:r.onDragging,step:o,eventType:"SELECTION",eventCenter:a}),r}return e.prototype.render=function(){var t,r,i=this.props.graphModel,o=i.selectElements,a=i.transformModel,l=this.props.lf.getTransform(),u=l.SCALE_X,d=l.SCALE_Y;if(!(o.size<=1)){var f=Number.MAX_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER;o.forEach(function(w){var _;w.BaseType===kn.NODE&&(_=u5(w)),w.BaseType===kn.EDGE&&(_=h5(w)),_!==void 0&&(f=Math.min(f,_.x),h=Math.min(h,_.y),v=Math.max(v,_.x1),y=Math.max(y,_.y1))}),t=Jf(a.CanvasPointToHtmlPoint([f,h]),2),f=t[0],h=t[1],r=Jf(a.CanvasPointToHtmlPoint([v,y]),2),v=r[0],y=r[1];var x={left:"".concat(f-20*u/2,"px"),top:"".concat(h-20*d/2,"px"),width:"".concat(v-f+20*u,"px"),height:"".concat(y-h+20*d,"px"),"border-width":"".concat(2*u,"px")};return He("div",{className:"lf-multiple-select",style:x,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=w$([Cr],e),e}(Zt),Zf=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},C$=[b$,E$],k$=function(){function n(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,zt(C$,function(o){t.isDisabled(o.toolName)||t.registerTool(o.toolName,o)});var r=e.graphModel,i=r.eventCenter;i.on("".concat(kt.GRAPH_TRANSFORM,",").concat(kt.NODE_CLICK,",").concat(kt.BLANK_CLICK," "),function(){var o,a=r.textEditElement,l=r.editConfigModel,u=l.edgeTextEdit,d=l.nodeTextEdit;(u||d)&&a&&((o=r.textEditElement)===null||o===void 0||o.setElementState(tn.DEFAULT))})}return n.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},n.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},n.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},n.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},n.prototype.getTools=function(){return Array.from(this.toolMap.values())},n.prototype.getInstance=function(){return this.instance},n.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},Zf([$e],n.prototype,"toolMap",void 0),Zf([je],n.prototype,"disableTool",null),Zf([je],n.prototype,"enableTool",null),n}();function O$(n){throw new Error("[mobx-utils] "+n)}function qd(n,e){e===void 0&&(e="Illegal state"),n||O$(e)}var Sw=function(n){return n&&n!==Object.prototype&&Object.getOwnPropertyNames(n).concat(Sw(Object.getPrototypeOf(n))||[])},M$=function(n){var e=Sw(n),t=e.filter(function(r,i){return e.indexOf(r)===i});return t},N$=function(n){return M$(n).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},Ew="pending",Xd="fulfilled",vg="rejected";function A$(n){switch(this.state){case Ew:return n.pending&&n.pending(this.value);case vg:return n.rejected&&n.rejected(this.value);case Xd:return n.fulfilled?n.fulfilled(this.value):this.value}}function r0(n,e){if(qd(arguments.length<=2,"fromPromise expects up to two arguments"),qd(typeof n=="function"||typeof n=="object"&&n&&typeof n.then=="function","Please pass a promise or function to fromPromise"),n.isPromiseBasedObservable===!0)return n;typeof n=="function"&&(n=new Promise(n));var t=n;n.then(je("observableFromPromise-resolve",function(i){t.value=i,t.state=Xd}),je("observableFromPromise-reject",function(i){t.value=i,t.state=vg})),t.isPromiseBasedObservable=!0,t.case=A$;var r=e&&e.state===Xd?e.value:void 0;return Gp(t,{value:r,state:Ew},{},{deep:!1}),t}(function(n){n.reject=je("fromPromise.reject",function(t){var r=n(Promise.reject(t));return r.state=vg,r.value=t,r});function e(t){t===void 0&&(t=void 0);var r=n(Promise.resolve(t));return r.state=Xd,r.value=t,r}n.resolve=je("fromPromise.resolve",e)})(r0||(r0={}));var ad=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o};(function(){function n(e,t){var r=this;i6(function(){r.current=t,r.subscription=e.subscribe(r)})}return n.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},n.prototype.next=function(e){this.current=e},n.prototype.complete=function(){this.dispose()},n.prototype.error=function(e){this.current=e,this.dispose()},ad([$e.ref],n.prototype,"current",void 0),ad([je.bound],n.prototype,"next",null),ad([je.bound],n.prototype,"complete",null),ad([je.bound],n.prototype,"error",null),n})();var Yd=function(){return Yd=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Yd.apply(this,arguments)},dl=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},T$=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function n(e){var t=this;this.model=e,this.localValues=$e.map({}),this.localComputedValues=$e.map({}),this.isPropertyDirty=function(r){return t.localValues.has(r)},qd(Ri(e),"createViewModel expects an observable object"),N$(e).forEach(function(r){if(!(r===$t||r==="__mobxDidRunLazyInitializers")){if(qd(T$.indexOf(r)===-1,"The propertyname "+r+" is reserved and cannot be used with viewModels"),Gy(e,r)){var i=Rc(e,r).derivation;t.localComputedValues.set(r,hn(i.bind(t)))}var o=Object.getOwnPropertyDescriptor(e,r),a=o?{enumerable:o.enumerable}:{};Object.defineProperty(t,r,Yd(Yd({},a),{configurable:!0,get:function(){return Gy(e,r)?t.localComputedValues.get(r).get():t.isPropertyDirty(r)?t.localValues.get(r):t.model[r]},set:je(function(l){l!==t.model[r]?t.localValues.set(r,l):t.localValues.delete(r)})}))}})}return Object.defineProperty(n.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),n.prototype.submit=function(){var e=this;ms(this.localValues).forEach(function(t){var r=e.localValues.get(t),i=e.model[t];Ji(i)?i.replace(r):zr(i)?(i.clear(),i.merge(r)):c6(r)||(e.model[t]=r)}),this.localValues.clear()},n.prototype.reset=function(){this.localValues.clear()},n.prototype.resetProperty=function(e){this.localValues.delete(e)},dl([hn],n.prototype,"isDirty",null),dl([hn],n.prototype,"changedValues",null),dl([je.bound],n.prototype,"submit",null),dl([je.bound],n.prototype,"reset",null),dl([je.bound],n.prototype,"resetProperty",null),n})();function Qf(n){if(!n)return"ROOT";for(var e=[];n.parent;)e.push(n.path),n=n.parent;return e.reverse().join("/")}function eh(n){return Ri(n)||Ji(n)||zr(n)}function D$(n,e){var t=new WeakMap;function r(l){var u=t.get(l.object);i(l,u),e(l,Qf(u),n)}function i(l,u){switch(l.type){case"add":o(l.newValue,u,l.name);break;case"update":a(l.oldValue),o(l.newValue,u,l.name||""+l.index);break;case"remove":case"delete":a(l.oldValue);break;case"splice":l.removed.map(a),l.added.forEach(function(h,v){return o(h,u,""+(l.index+v))});for(var d=l.index+l.addedCount;d<l.object.length;d++)if(eh(l.object[d])){var f=t.get(l.object[d]);f&&(f.path=""+d)}break}}function o(l,u,d){if(eh(l)){var f=t.get(l);if(f){if(f.parent!==u||f.path!==d)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Qf(u)+"/"+d+"',")+(" but it already exists at '"+Qf(f.parent)+"/"+f.path+"'"))}else{var h={parent:u,path:d,dispose:qx(l,r)};t.set(l,h),p6(l).forEach(function(v){var y=v[0],x=v[1];return o(x,h,y)})}}}function a(l){if(eh(l)){var u=t.get(l);if(!u)return;t.delete(l),u.dispose(),h6(l).forEach(a)}}return o(n,void 0,""),function(){a(n)}}var L$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();(function(n){L$(e,n);function e(t,r,i){var o=i===void 0?{}:i,a=o.name,l=a===void 0?"ogm"+(Math.random()*1e3|0):a,u=o.keyToName,d=u===void 0?function(v){return""+v}:u,f=n.call(this)||this;f._keyToName=d,f._groupBy=r,f._ogmInfoKey=Symbol("ogmInfo"+l),f._base=t;for(var h=0;h<t.length;h++)f._addItem(t[h]);return f._disposeBaseObserver=qx(f._base,function(v){if(v.type==="splice")Ei(function(){for(var y=0,x=v.removed;y<x.length;y++){var w=x[y];f._removeItem(w)}for(var _=0,b=v.added;_<b.length;_++){var E=b[_];f._addItem(E)}});else if(v.type==="update")Ei(function(){f._removeItem(v.oldValue),f._addItem(v.newValue)});else throw new Error("illegal state")}),f}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,r){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var r=this._base[t],i=r[this._ogmInfoKey];i.reaction(),delete r[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var r=n.prototype.get.call(this,t);return r===void 0&&(r=$e([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),n.prototype.set.call(this,t,r)),r},e.prototype._removeFromGroupArr=function(t,r){var i=n.prototype.get.call(this,t);i.length===1?n.prototype.delete.call(this,t):(r===i.length-1||(i[r]=i[i.length-1],i[r][this._ogmInfoKey].groupArrIndex=r),i.length--)},e.prototype._addItem=function(t){var r=this,i=this._groupBy(t),o=this._getGroupArr(i),a={groupByValue:i,groupArrIndex:o.length,reaction:$x(function(){return r._groupBy(t)},function(l,u){var d=t[r._ogmInfoKey];r._removeFromGroupArr(d.groupByValue,d.groupArrIndex);var f=r._getGroupArr(l),h=f.length;f.push(t),d.groupByValue=l,d.groupArrIndex=h})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:a}),o.push(t)},e.prototype._removeItem=function(t){var r=t[this._ogmInfoKey];this._removeFromGroupArr(r.groupByValue,r.groupArrIndex),r.reaction(),delete t[this._ogmInfoKey]},e})(lg);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var kv=function(){return kv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},kv.apply(this,arguments)},P$=function(){function n(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return n.prototype.add=function(e){my(G2(this.undos),e)||(this.undos.push(e),my(this.curData,e)||(this.redos=[]),this.eventCenter.emit(kt.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},n.prototype.undoAble=function(){return this.undos.length>1},n.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=It(t),t}},n.prototype.redoAble=function(){return this.redos.length>0},n.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=It(e),e}},n.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=D$(e,R1(function(){var r=e.modelToHistoryData();r&&t.add(kv({},r))},this.waitTime))},n.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},n}(),th={exports:{}},i0;function R$(){return i0||(i0=1,function(n){(function(e,t,r){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},l={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u,d=1;d<20;++d)i[111+d]="f"+d;for(d=0;d<=9;++d)i[d+96]=d.toString();function f(T,L,H){if(T.addEventListener){T.addEventListener(L,H,!1);return}T.attachEvent("on"+L,H)}function h(T){if(T.type=="keypress"){var L=String.fromCharCode(T.which);return T.shiftKey||(L=L.toLowerCase()),L}return i[T.which]?i[T.which]:o[T.which]?o[T.which]:String.fromCharCode(T.which).toLowerCase()}function v(T,L){return T.sort().join(",")===L.sort().join(",")}function y(T){var L=[];return T.shiftKey&&L.push("shift"),T.altKey&&L.push("alt"),T.ctrlKey&&L.push("ctrl"),T.metaKey&&L.push("meta"),L}function x(T){if(T.preventDefault){T.preventDefault();return}T.returnValue=!1}function w(T){if(T.stopPropagation){T.stopPropagation();return}T.cancelBubble=!0}function _(T){return T=="shift"||T=="ctrl"||T=="alt"||T=="meta"}function b(){if(!u){u={};for(var T in i)T>95&&T<112||i.hasOwnProperty(T)&&(u[i[T]]=T)}return u}function E(T,L,H){return H||(H=b()[T]?"keydown":"keypress"),H=="keypress"&&L.length&&(H="keydown"),H}function k(T){return T==="+"?["+"]:(T=T.replace(/\+{2}/g,"+plus"),T.split("+"))}function O(T,L){var H,X,V,q=[];for(H=k(T),V=0;V<H.length;++V)X=H[V],l[X]&&(X=l[X]),L&&L!="keypress"&&a[X]&&(X=a[X],q.push("shift")),_(X)&&q.push(X);return L=E(X,q,L),{key:X,modifiers:q,action:L}}function N(T,L){return T===null||T===t?!1:T===L?!0:N(T.parentNode,L)}function I(T){var L=this;if(T=T||t,!(L instanceof I))return new I(T);L.target=T,L._callbacks={},L._directMap={};var H={},X,V=!1,q=!1,D=!1;function W(ve){ve=ve||{};var Re=!1,Ie;for(Ie in H){if(ve[Ie]){Re=!0;continue}H[Ie]=0}Re||(D=!1)}function $(ve,Re,Ie,ce,ue,K){var ie,ne,fe=[],he=Ie.type;if(!L._callbacks[ve])return[];for(he=="keyup"&&_(ve)&&(Re=[ve]),ie=0;ie<L._callbacks[ve].length;++ie)if(ne=L._callbacks[ve][ie],!(!ce&&ne.seq&&H[ne.seq]!=ne.level)&&he==ne.action&&(he=="keypress"&&!Ie.metaKey&&!Ie.ctrlKey||v(Re,ne.modifiers))){var be=!ce&&ne.combo==ue,xe=ce&&ne.seq==ce&&ne.level==K;(be||xe)&&L._callbacks[ve].splice(ie,1),fe.push(ne)}return fe}function pe(ve,Re,Ie,ce){L.stopCallback(Re,Re.target||Re.srcElement,Ie,ce)||ve(Re,Ie)===!1&&(x(Re),w(Re))}L._handleKey=function(ve,Re,Ie){var ce=$(ve,Re,Ie),ue,K={},ie=0,ne=!1;for(ue=0;ue<ce.length;++ue)ce[ue].seq&&(ie=Math.max(ie,ce[ue].level));for(ue=0;ue<ce.length;++ue){if(ce[ue].seq){if(ce[ue].level!=ie)continue;ne=!0,K[ce[ue].seq]=1,pe(ce[ue].callback,Ie,ce[ue].combo,ce[ue].seq);continue}ne||pe(ce[ue].callback,Ie,ce[ue].combo)}var fe=Ie.type=="keypress"&&q;Ie.type==D&&!_(ve)&&!fe&&W(K),q=ne&&Ie.type=="keydown"};function De(ve){typeof ve.which!="number"&&(ve.which=ve.keyCode);var Re=h(ve);if(Re){if(ve.type=="keyup"&&V===Re){V=!1;return}L.handleKey(Re,y(ve),ve)}}function de(){clearTimeout(X),X=setTimeout(W,1e3)}function Se(ve,Re,Ie,ce){H[ve]=0;function ue(he){return function(){D=he,++H[ve],de()}}function K(he){pe(Ie,he,ve),ce!=="keyup"&&(V=h(he)),setTimeout(W,10)}for(var ie=0;ie<Re.length;++ie){var ne=ie+1===Re.length,fe=ne?K:ue(ce||O(Re[ie+1]).action);me(Re[ie],fe,ce,ve,ie)}}function me(ve,Re,Ie,ce,ue){L._directMap[ve+":"+Ie]=Re,ve=ve.replace(/\s+/g," ");var K=ve.split(" "),ie;if(K.length>1){Se(ve,K,Re,Ie);return}ie=O(ve,Ie),L._callbacks[ie.key]=L._callbacks[ie.key]||[],$(ie.key,ie.modifiers,{type:ie.action},ce,ve,ue),L._callbacks[ie.key][ce?"unshift":"push"]({callback:Re,modifiers:ie.modifiers,action:ie.action,seq:ce,level:ue,combo:ve})}L._bindMultiple=function(ve,Re,Ie){for(var ce=0;ce<ve.length;++ce)me(ve[ce],Re,Ie)},f(T,"keypress",De),f(T,"keydown",De),f(T,"keyup",De)}I.prototype.bind=function(T,L,H){var X=this;return T=T instanceof Array?T:[T],X._bindMultiple.call(X,T,L,H),X},I.prototype.unbind=function(T,L){var H=this;return H.bind.call(H,T,function(){},L)},I.prototype.trigger=function(T,L){var H=this;return H._directMap[T+":"+L]&&H._directMap[T+":"+L]({},T),H},I.prototype.reset=function(){var T=this;return T._callbacks={},T._directMap={},T},I.prototype.stopCallback=function(T,L){var H=this;if((" "+L.className+" ").indexOf(" mousetrap ")>-1||N(L,H.target))return!1;if("composedPath"in T&&typeof T.composedPath=="function"){var X=T.composedPath()[0];X!==T.target&&(L=X)}return L.tagName=="INPUT"||L.tagName=="SELECT"||L.tagName=="TEXTAREA"||L.isContentEditable},I.prototype.handleKey=function(){var T=this;return T._handleKey.apply(T,arguments)},I.addKeycodes=function(T){for(var L in T)T.hasOwnProperty(L)&&(i[L]=T[L]);u=null},I.init=function(){var T=I(t);for(var L in T)L.charAt(0)!=="_"&&(I[L]=function(H){return function(){return T[H].apply(T,arguments)}}(L))},I.init(),e.Mousetrap=I,n.exports&&(n.exports=I)})(typeof window<"u"?window:null,typeof window<"u"?document:null)}(th)),th.exports}var I$=R$();const B$=va(I$);var Mo=function(){return Mo=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Mo.apply(this,arguments)},j$=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t},$i=null;function o0(n,e){var t,r;return n.x+=e,n.y+=e,Ip(n.text)||(n.text.x+=e,n.text.y+=e),Ip((t=n.properties)===null||t===void 0?void 0:t._label)||(r=n.properties)===null||r===void 0||r._label.forEach(function(i){i.x+=e,i.y+=e}),n}function a0(n,e){return n.startPoint&&(n.startPoint.x+=e,n.startPoint.y+=e),n.endPoint&&(n.endPoint.x+=e,n.endPoint.y+=e),n.pointsList&&n.pointsList.length>0&&n.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Ip(n.text)||(n.text.x+=e,n.text.y+=e),n}function H$(n,e){var t=n.x,r=n.y,i=n.text,o=i?{x:i.x+e,y:i.y+e,value:i.value}:void 0;return Mo(Mo({},n),{id:"",x:t+e,y:r+e,text:o})}function $$(n,e){var t=n.startPoint,r=n.endPoint,i=n.pointsList,o=n.text,a=j$(n,["startPoint","endPoint","pointsList","text"]);a.id="";var l={x:t.x+e,y:t.y+e},u={x:r.x+e,y:r.y+e},d=Di(i,function(h){return{x:h.x+e,y:h.y+e}}),f=o?Mo(Mo({},o),{x:o.x+e,y:o.y+e}):void 0;return Mo(Mo({},a),{startPoint:l,endPoint:u,pointsList:d,text:f})}var qa=40,sd=40;function F$(n,e){var t=n.keyboard,r=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(sd=qa,!(r!=null&&r.enabled)||e.textEditElement)return!0;var i=n.options.guards,o=e.getSelectElements(!1),a=i&&i.beforeClone?i.beforeClone(o):!0;return!a||o.nodes.length===0&&o.edges.length===0?($i=null,!0):($i=o,$i.nodes.forEach(function(l){return o0(l,qa)}),$i.edges.forEach(function(l){return a0(l,qa)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(r!=null&&r.enabled)||e.textEditElement)return!0;if($i&&($i.nodes||$i.edges)){n.clearSelectElements();var i=n.addElements($i,sd);if(!i)return!0;i.nodes.forEach(function(o){return n.selectElementById(o.id,!0)}),i.edges.forEach(function(o){return n.selectElementById(o.id,!0)}),$i.nodes.forEach(function(o){return o0(o,qa)}),$i.edges.forEach(function(o){return a0(o,qa)}),sd=sd+qa}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(r!=null&&r.enabled)||e.textEditElement?!0:(n.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(r!=null&&r.enabled)||e.textEditElement?!0:(n.redo(),!1)}),t.on(["backspace"],function(){if(!(r!=null&&r.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return n.clearSelectElements(),i.edges.forEach(function(o){return o.id&&n.deleteEdge(o.id)}),i.nodes.forEach(function(o){return o.id&&n.deleteNode(o.id)}),!1})}var z$=function(){function n(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new B$(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return n.prototype.initShortcuts=function(){var e=this,t,r=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(r)if(I1(r))r.forEach(function(l){var u=l.keys,d=l.callback,f=l.action;return e.on(u,d,f)});else{var i=r.keys,o=r.callback,a=r.action;this.on(i,o,a)}},n.prototype.on=function(e,t,r){this.mousetrap.bind(this.getKeys(e),t,r)},Object.defineProperty(n.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),n.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},n.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},n.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},n.prototype.destroy=function(){this.mousetrap.reset()},n.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(r){return t.formatKey(r)})},n.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},n}(),Co=function(){return Co=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Co.apply(this,arguments)},ld=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},nh=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},rh=Symbol("plugin registered by Logicflow.use"),Ov=function(){function n(e){var t=this,r;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(d,f){return t.viewMap.set(d,f)},this.getView=function(d){return t.viewMap.get(d)};var i=Il.get(e),o=i.container,a=i.width,l=i.height;this.options=i,this.container=this.initContainer(o,a,l),this.graphModel=new NH(Co(Co({},i),{container:this.container})),this.plugins=(r=i.plugins)!==null&&r!==void 0?r:[];var u=this.graphModel.eventCenter;this.tool=new k$(this),this.dnd=new v$({lf:this}),this.history=new P$(u),this.keyboard=new z$({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new AH(this.graphModel,i.snaplineEpsilon),g$(u,this.snaplineModel)),i.isSilentMode||(F$(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return n.prototype.initContainer=function(e,t,r){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=r?"".concat(r,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return n.toStringTag},enumerable:!1,configurable:!0}),n.prototype.register=function(e,t,r){if(r===void 0&&(r=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:jc,BaseEdgeModel:Bc,BaseNode:jo,BaseNodeModel:Bo,RectNode:ha,RectNodeModel:ws,CircleNode:Vd,CircleNodeModel:Fd,PolygonNode:Gd,PolygonNodeModel:zd,TextNode:e0,TextNodeModel:J_,LineEdge:n0,LineEdgeModel:q_,DiamondNode:yv,DiamondNodeModel:uv,PolylineEdge:Ss,PolylineEdgeModel:xs,BezierEdge:Ev,BezierEdgeModel:lv,EllipseNode:bv,EllipseNodeModel:dv,HtmlNode:Xl,HtmlNodeModel:Gl,h:mt,type:e};if(this.viewMap.forEach(function(d){var f=d.extendKey;f&&(i[f]=d)}),this.graphModel.modelMap.forEach(function(d){var f=d.extendKey;f&&(i[f]=d)}),t){var o=t(i),a=o.view,l=o.model,u=a;r&&!u.isObserved&&(u.isObserved=!0,u=Cr(u)),this.setView(e,u),this.graphModel.setModel(e,l)}},n.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=Cr(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},n.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),zt(e,function(r){t.registerElement(r)})},n.prototype.defaultRegister=function(){var e=[{type:"rect",view:ha,model:ws},{type:"circle",view:Vd,model:Fd},{type:"polygon",view:Gd,model:zd},{type:"text",view:e0,model:J_},{type:"ellipse",view:bv,model:dv},{type:"diamond",view:yv,model:uv},{type:"html",view:Xl,model:Gl},{type:"line",view:n0,model:q_},{type:"polyline",view:Ss,model:xs},{type:"bezier",view:Ev,model:lv}];this.batchRegister(e)},n.prototype.addNode=function(e,t,r){return t===void 0&&(t=kt.NODE_ADD),this.graphModel.addNode(e,t,r)},n.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var r=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(r):!0;return o&&this.graphModel.deleteNode(e),o},n.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),r=t==null?void 0:t.getData();if(r){var i=this.options.guards,o=i!=null&&i.beforeClone?i.beforeClone(r):!0;if(o)return this.graphModel.cloneNode(e)}},n.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},n.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},n.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},n.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},n.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},n.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},n.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},n.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},n.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var r=new t(Co(Co({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(r),r},n.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},n.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},n.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},n.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},n.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},n.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},n.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},n.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,r=e.targetNodeId,i=[],o=this.graphModel.edges;return t&&r?zt(o,function(a){a.sourceNodeId===t&&a.targetNodeId===r&&i.push(a)}):t?zt(o,function(a){a.sourceNodeId===t&&i.push(a)}):r&&zt(o,function(a){a.targetNodeId===r&&i.push(a)}),i},n.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},n.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},n.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var r=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(r):!0;return o&&this.graphModel.deleteEdgeById(e),o},n.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,r=e.targetNodeId;t&&r?this.graphModel.deleteEdgeBySourceAndTarget(t,r):t?this.graphModel.deleteEdgeBySource(t):r&&this.graphModel.deleteEdgeByTarget(r)},n.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},n.prototype.addElements=function(e,t){var r=this,i=e.nodes,o=e.edges;t===void 0&&(t=40);var a={},l={nodes:[],edges:[]};return zt(i,function(u){var d=u.id,f=r.addNode(u);d&&(a[d]=f.id),l.nodes.push(f)}),zt(o,function(u){var d=u.sourceNodeId,f=u.targetNodeId;a[d]&&(d=a[d]),a[f]&&(f=a[f]);var h=r.graphModel.addEdge(Co(Co({},u),{sourceNodeId:d,targetNodeId:f}));l.edges.push(h)}),l},n.prototype.selectElementById=function(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),this.graphModel.selectElementById(e,t),!t&&r&&this.graphModel.toFront(e)},n.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},n.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},n.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},n.prototype.getModelById=function(e){return this.graphModel.getElement(e)},n.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},n.prototype.deleteElement=function(e){var t,r,i,o=this.getModelById(e);if(!o)return!1;var a=(t={},t[kn.NODE]=this.deleteNode,t[kn.EDGE]=this.deleteEdge,t);return(i=(r=a[o.BaseType])===null||r===void 0?void 0:r.call(this,e))!==null&&i!==void 0?i:!1},n.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},n.prototype.getAreaElement=function(e,t,r,i,o){return r===void 0&&(r=!0),i===void 0&&(i=!0),o===void 0&&(o=!1),this.graphModel.getAreaElement(e,t,r,i,o).map(function(a){return a.getData()})},n.prototype.setProperties=function(e,t){var r;(r=this.graphModel.getElement(e))===null||r===void 0||r.setProperties(mr(t))},n.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},n.prototype.deleteProperty=function(e,t){var r;(r=this.graphModel.getElement(e))===null||r===void 0||r.deleteProperty(t)},n.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},n.prototype.editText=function(e){this.graphModel.editText(e)},n.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},n.prototype.updateEditConfig=function(e){var t=this.graphModel,r=t.editConfigModel,i=t.transformModel,o=r.snapGrid;if(r.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!Er(e==null?void 0:e.snapGrid)&&e.snapGrid!==o){var a=this.graphModel.grid.size,l=a===void 0?1:a;this.graphModel.updateGridSize(e.snapGrid?l:1)}this.emit(kt.EDIT_CONFIG_CHANGED,{data:r.getConfig()})},n.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},n.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},n.prototype.getTheme=function(){return this.graphModel.getTheme()},n.prototype.focusByElement=function(e){var t=void 0,r=this.getNodeModelById(e);if(r){var i=r.getData(),o=i.x,a=i.y;t={x:o,y:a}}var l=this.getEdgeModelById(e);if(l){var u=l.textPosition,o=u.x,a=u.y;t={x:o,y:a}}t&&this.focusByCoordinate(t)},n.prototype.focusByCoordinate=function(e){var t=this.graphModel,r=t.transformModel,i=t.width,o=t.height,a=e.x,l=e.y;r.focusOn(a,l,i,o)},n.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,r=e.coordinate;t&&this.focusByElement(t),r&&this.focusByCoordinate(r)}},n.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},n.prototype.toFront=function(e){this.graphModel.toFront(e)},n.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},n.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,nh([r],ld(e),!1)):r},n.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},n.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},n.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(mr(e)),this.options.history!==!1&&this.history.watch(this.graphModel),__(He(RH,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(kt.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},n.prototype.render=function(e){var t=It(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},n.prototype.undo=function(){if(this.history.undoAble()){var e=mr(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.redo=function(){if(this.history.redoAble()){var e=mr(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.zoom=function(e,t){var r=this.graphModel.transformModel;return r.zoom(e,t)},n.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},n.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},n.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},n.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,r=e.SCALE_Y,i=e.TRANSLATE_X,o=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:r,TRANSLATE_X:i,TRANSLATE_Y:o}},n.prototype.translate=function(e,t){var r=this.graphModel.transformModel;r.translate(e,t)},n.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,r=e.TRANSLATE_Y;this.translate(-t,-r)},n.prototype.translateCenter=function(){this.graphModel.translateCenter()},n.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},n.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},n.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},n.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},n.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},n.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},n.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},n.use=function(e,t){var r,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(r={},r[rh]=rh,r.extension=e,r.props=t,r))},n.addThemeMode=function(e,t){Nj(e,t)},n.removeThemeMode=function(e){Aj(e)},n.clearThemeMode=function(){W_()},n.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var r=Array.from(n.extensions,function(o){var a=ld(o,2),l=a[1];return l}),i=nh(nh([],ld(this.plugins),!1),ld(r),!1);zt(i,function(o){var a,l;rh in o?(a=o.extension,l=o.props):a=o;var u=a==null?void 0:a.pluginName;q2(e,u)===-1&&t.installPlugin(a,l)})},n.prototype.installPlugin=function(e,t){var r,i;if("pluginName"in e&&"install"in e){var o=e.pluginName,a=e.install,l=e.render;o&&(a&&a.call(e,this,n),l&&this.components.push(l.bind(e)),this.extension[o]=e);return}var u=e,d=u.pluginName,f=new u({lf:this,LogicFlow:n,props:t,options:(i=(r=this.options.pluginsOptions)===null||r===void 0?void 0:r[d])!==null&&i!==void 0?i:{}});f.render&&this.components.push(f.render.bind(f)),this.extension[d]=f},n.prototype.destroy=function(){var e;this.clearData(),__(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),W_();for(var t in this.extension){var r=this.extension[t];"destroy"in r&&((e=r.destroy)===null||e===void 0||e.call(r))}},n.extensions=new Map,n}();(function(n){n.toStringTag="LF.".concat(n.name)})(Ov||(Ov={}));const U$=Ov;function Cr(n){return dg(n)}var s0={width:40,height:40},l0={width:40,height:40},u0={width:40,height:40},d0={width:100,height:80},c0={width:100,height:80},V$=function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n}(),W$=(globalThis==null?void 0:globalThis._ids)||new V$;function Ls(){return W$.next()}var Cw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();(function(n){Cw(e,n);function e(t,r){return t.id||(t.id="Event_".concat(Ls())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,r)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=n.prototype.getConnectedTargetRules.call(this),r={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(r),t},e.extendKey="StartEventModel",e})(Fd);(function(n){Cw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(Vd);var kw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Kd=function(){return Kd=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Kd.apply(this,arguments)};(function(n){kw(e,n);function e(t,r){return t.id||(t.id="Event_".concat(Ls())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,r)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=n.prototype.getConnectedSourceRules.call(this),r={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(r),t},e.extendKey="EndEventModel",e})(Fd);(function(n){kw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,r=t.getNodeStyle(),i=t,o=i.x,a=i.y,l=i.r,u=n.prototype.getShape.call(this);return mt("g",{},u,mt("circle",Kd(Kd({},r),{cx:o,cy:a,r:l-5})))},e.extendKey="EndEventView",e})(Vd);var Ow=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();(function(n){Ow(e,n);function e(t,r){return t.id||(t.id="Flow_".concat(Ls())),n.call(this,t,r)||this}return e.extendKey="SequenceFlowModel",e})(xs);(function(n){Ow(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(Ss);var Mw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Nl=function(){return Nl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nl.apply(this,arguments)};(function(n){Mw(e,n);function e(t,r){var i=this;return t.id||(t.id="Gateway_".concat(Ls())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=n.call(this,t,r)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(zd);(function(n){Mw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,r=t,i=r.x,o=r.y,a=r.width,l=r.height,u=r.points,d=t.getNodeStyle();return mt("g",{transform:"matrix(1 0 0 1 ".concat(i-a/2," ").concat(o-l/2,")")},mt("polygon",Nl(Nl({},d),{x:i,y:o,points:u})),mt("path",Nl({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},d)))},e.extendKey="ExclusiveGatewayNode",e})(Gd);var Nw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Mv=function(){return Mv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Mv.apply(this,arguments)};(function(n){Nw(e,n);function e(t,r){return t.id||(t.id="Activity_".concat(Ls())),n.call(this,t,r)||this}return e.extendKey="ServiceTaskModel",e})(ws);(function(n){Nw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.getNodeStyle();return mt("svg",{x:r-o/2+5,y:i-a/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},mt("path",{fill:l.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.radius,u=t.getNodeStyle();return mt("g",{},[mt("rect",Mv({x:r-o/2,y:i-a/2,rx:l,ry:l,width:o,height:a},u)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(ha);var Aw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Jd=function(){return Jd=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Jd.apply(this,arguments)};(function(n){Aw(e,n);function e(t,r){return t.id||(t.id="Activity_".concat(Ls())),n.call(this,t,r)||this}return e.extendKey="UserTaskModel",e})(ws);(function(n){Aw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.getNodeStyle();return mt("svg",{x:r-o/2+5,y:i-a/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},mt("path",{fill:l.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.radius,u=t.getNodeStyle();return mt("g",{},[mt("rect",Jd(Jd({},u),{x:r-o/2,y:i-a/2,rx:l,ry:l,width:o,height:a})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(ha);var G$=function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n}(),q$=(globalThis==null?void 0:globalThis._ids)||new G$;function f0(){return q$.next()}function Tw(n){return Object.prototype.toString.call(n)}function X$(n){return"  ".repeat(n)}function Zd(n){var e=n;return Tw(n)==="[object Object]"?(e={},Object.keys(n).forEach(function(t){var r=t;t.charAt(0)==="-"&&(r=t.substring(1)),e[r]=Zd(n[t])})):Array.isArray(n)&&(e=[],n.forEach(function(t,r){e[r]=Zd(t)})),e}function Qd(n){return n==null?"":n.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Y$(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(Zd(n)).replace(/"/g,"'")}return Qd(String(e))}var Zo=`	
`;function md(n,e,t){var r=X$(t);if(n!==0&&n!==!1&&!n)return Zo+r+"<".concat(e," />");var i="";if(e==="#text")return Zo+r+Qd(String(n));if(e==="#cdata-section")return Zo+r+"<![CDATA["+n+"]]>";if(e==="#comment")return Zo+r+"<!--"+n+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+Y$(n)+'"';if(Array.isArray(n))n.forEach(function(u){i+=md(u,e,t+1)});else if(Tw(n)==="[object Object]"){var o=Object.keys(n),a="",l="";i+=(t===0?"":Zo+r)+"<"+e,o.forEach(function(u){u.charAt(0)==="-"?a+=md(n[u],u,t+1):l+=md(n[u],u,t+1)}),i+=a+(l!==""?">".concat(l).concat(Zo+r,"</").concat(e,">"):" />")}else i+=Zo+r+"<".concat(e,">").concat(Qd(String(n)),"</").concat(e,">");return i}function K$(n){var e="";for(var t in n)e+=md(n[t],t,0);return e}var Nr=function(){};Nr.ObjTree=function(){return this};Nr.ObjTree.VERSION="0.23";Nr.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Nr.ObjTree.prototype.attr_prefix="-";Nr.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,r=t.parseFromString(n,"application/xml");if(!r)return;e=r.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e)return this.parseDOM(e)};Nr.ObjTree.prototype.parseHTTP=function(n,e,t){var r={};for(var i in e)r[i]=e[i];if(r.method||(typeof r.postBody>"u"&&typeof r.postbody>"u"&&typeof r.parameters>"u"?r.method="get":r.method="post"),t){r.asynchronous=!0;var o=this,a=t,l=r.onComplete;r.onComplete=function(f){var h;f&&f.responseXML&&f.responseXML.documentElement&&(h=o.parseDOM(f.responseXML.documentElement)),a(h,f),l&&l(f)}}else r.asynchronous=!1;var u;if(typeof HTTP<"u"&&HTTP.Request){r.uri=n;var d=new HTTP.Request(r);d&&(u=d.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var d=new Ajax.Request(n,r);d&&(u=d.transport)}if(t)return u;if(u&&u.responseXML&&u.responseXML.documentElement)return this.parseDOM(u.responseXML.documentElement)};Nr.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!=11){var r={};r[n.nodeName]=t,t=r}return t}};Nr.ObjTree.prototype.parseElement=function(n){if(n.nodeType!=7){if(n.nodeType==3||n.nodeType==4||n.nodeType==8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,r={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var o=n.attributes[i].nodeName;if(typeof o=="string"){var a=n.attributes[i].nodeValue;try{a=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{a=n.attributes[i].nodeValue}a&&(o=this.attr_prefix+o,typeof r[o]>"u"&&(r[o]=0),r[o]++,this.addNode(t,o,r[o],a))}}}if(n.childNodes&&n.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<n.childNodes.length&&l;i++){var u=n.childNodes[i].nodeType;u==3||u==4||u==8||(l=!1)}if(l){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i].nodeName;if(typeof o=="string"){var a=this.parseElement(n.childNodes[i]);a&&(typeof r[o]>"u"&&(r[o]=0),r[o]++,this.addNode(t,o,r[o],a))}}}}else t===null&&(t={});return t}};Nr.ObjTree.prototype.addNode=function(n,e,t,r){this.__force_array[e]?(t==1&&(n[e]=[]),n[e][n[e].length]=r):t==1?n[e]=r:t==2?n[e]=[n[e],r]:n[e][n[e].length]=r};Nr.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};Nr.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],r=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];i.charAt(0)!=this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<"+i+" />":typeof o=="object"&&o.constructor==Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):r[r.length]=" "+i.substring(1)+'="'+this.xml_escape(o)+'"'}var a=r.join(""),l=t.join("");return typeof n>"u"||n==null||(t.length>0?l.match(/\n/)?l="<"+n+a+`>
`+l+"</"+n+`>
`:l="<"+n+a+">"+l+"</"+n+`>
`:l="<"+n+a+` />
`),l};Nr.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],r=0;r<e.length;r++){var i=e[r];typeof i>"u"||i==null?t[t.length]="<"+n+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};Nr.ObjTree.prototype.scalar_to_xml=function(n,e){return n=="#text"?this.xml_escape(e):"<"+n+">"+this.xml_escape(e)+"</"+n+`>
`};Nr.ObjTree.prototype.xml_escape=Qd;var J$=function(n){return new Nr.ObjTree().parseXML(n)},Z$=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Nv=function(){return Nv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nv.apply(this,arguments)},Hc=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Yi;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow"})(Yi||(Yi={}));var Dw=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],h0=["properties","startPoint","endPoint","pointsList"],Lw=function(n){return String(n||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};function p0(n){var e=n?h0.concat(n):h0;return function(t){function r(i){var o={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(a){return r(a)}):(Object.entries(i).forEach(function(a){var l=Hc(a,2),u=l[0],d=l[1];typeof d!="object"?u.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(u)?o[u]=d:o["-".concat(u)]=d:e.includes(u)?o["-".concat(u)]=r(d):o[u]=r(d)}),o)}return r(t)}}function ec(n){var e={};return Object.entries(n).forEach(function(t){var r=Hc(t,2),i=r[0],o=r[1];i.indexOf("-")===0?e[i.substring(1)]=Zd(o):typeof o=="string"?e[i]=o:Object.prototype.toString.call(o)==="[object Object]"?e[i]=ec(o):Array.isArray(o)?e[i]=o.map(function(a){return ec(a)}):e[i]=o}),e}function Q$(n,e,t){var r=new Map;e.nodes.forEach(function(o){var a,l={"-id":o.id};if(!((a=o.text)===null||a===void 0)&&a.value&&(l["-name"]=o.text.value),o.properties){var u=p0(t)(o.properties);Object.assign(l,u)}r.set(o.id,l),n[o.type]?Array.isArray(n[o.type])?n[o.type].push(l):n[o.type]=[n[o.type],l]:n[o.type]=l});var i=e.edges.map(function(o){var a,l,u=r.get(o.targetNodeId);u["bpmn:incoming"]?Array.isArray(u["bpmn:incoming"])?u["bpmn:incoming"].push(o.id):u["bpmn:incoming"]=[u["bpmn:incoming"],o.id]:u["bpmn:incoming"]=o.id;var d={"-id":o.id,"-sourceRef":o.sourceNodeId,"-targetRef":o.targetNodeId};if(!((a=o.text)===null||a===void 0)&&a.value&&(d["-name"]=(l=o.text)===null||l===void 0?void 0:l.value),o.properties){var f=p0(t)(o.properties);Object.assign(d,f)}return d});e.edges.forEach(function(o){var a=r.get(o.sourceNodeId);a["bpmn:outgoing"]?Array.isArray(a["bpmn:outgoing"])?a["bpmn:outgoing"].push(o.id):a["bpmn:outgoing"]=[a["bpmn:outgoing"],o.id]:a["bpmn:outgoing"]=o.id}),n[Yi.FLOW]=i}function eF(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var r,i=t.id,o=t.pointsList.map(function(l){var u=l.x,d=l.y;return{"-x":u,"-y":d}}),a={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((r=t.text)===null||r===void 0)&&r.value&&(a["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),a}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var r,i=t.id,o=100,a=80,l=t.x,u=t.y,d=Ho.shapeConfigMap.get(t.type);d&&(o=d.width,a=d.height),l-=o/2,u-=a/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":u,"-width":o,"-height":a}};return!((r=t.text)===null||r===void 0)&&r.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}function tF(n){var e=[],t=[],r=n["bpmn:definitions"];if(r){var i=r["bpmn:process"],o=r["bpmndi:BPMNDiagram"],a=o==null?void 0:o["bpmndi:BPMNPlane"];if(!i||!a)return{nodes:e,edges:t};Object.keys(i).forEach(function(l){if(l.indexOf("bpmn:")===0){var u=i[l];if(l===Yi.FLOW){var d=a["bpmndi:BPMNEdge"],f=(Array.isArray(d),d);t=rF(u,f)}else{var h=a["bpmndi:BPMNShape"],v=(Array.isArray(h),h);e=e.concat(nF(u,v,l))}}})}return{nodes:e,edges:t}}function nF(n,e,t){var r=[];if(Array.isArray(n))n.forEach(function(a){var l;Array.isArray(e)?l=e.find(function(d){return d["-bpmnElement"]===a["-id"]}):l=e;var u=v0(l,t,a);r.push(u)});else{var i=void 0;Array.isArray(e)?i=e.find(function(a){return a["-bpmnElement"]===n["-id"]}):i=e;var o=v0(i,t,n);r.push(o)}return r}function v0(n,e,t){var r=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),o=Lw(t["-name"]),a=Ho.shapeConfigMap.get(e);a&&(r+=a.width/2,i+=a.height/2);var l;Object.entries(t).forEach(function(h){var v=Hc(h,2),y=v[0],x=v[1];Dw.indexOf(y)===-1&&(l||(l={}),l[y]=x)}),l&&(l=ec(l));var u;if(o&&(u={x:r,y:i,value:o},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var d=n["bpmndi:BPMNLabel"]["dc:Bounds"];u.x=Number(d["-x"])+Number(d["-width"])/2,u.y=Number(d["-y"])+Number(d["-height"])/2}var f={id:n["-bpmnElement"],type:e,x:r,y:i,properties:l};return u&&(f.text=u),f}function rF(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(a){return a["-bpmnElement"]===i["-id"]}):o=e,t.push(g0(o,i))});else{var r=void 0;Array.isArray(e)?r=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):r=e,t.push(g0(r,n))}return t}function g0(n,e){var t,r=e["-name"]?Lw("".concat(e["-name"])):"";if(r){var i=void 0;n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"]&&(i=n["bpmndi:BPMNLabel"]["dc:Bounds"]);var o=0;if(r.split(`
`).forEach(function(y){o<y.length&&(o=y.length)}),i)t={value:r,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7};else{var a=n["di:waypoint"]||[],l=a[0],u=a[a.length-1]||l,d=(Number((l==null?void 0:l["-x"])||0)+Number((u==null?void 0:u["-x"])||0))/2,f=(Number((l==null?void 0:l["-y"])||0)+Number((u==null?void 0:u["-y"])||0))/2;t={value:r,x:d,y:f}}}var h;Object.entries(e).forEach(function(y){var x=Hc(y,2),w=x[0],_=x[1];Dw.indexOf(w)===-1&&(h||(h={}),h[w]=_)}),h&&(h=ec(h));var v={id:e["-id"],type:Yi.FLOW,pointsList:n["di:waypoint"].map(function(y){return{x:Number(y["-x"]),y:Number(y["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:h};return t&&(v.text=t),v}var Ho=function(){function n(e){var t=e.lf,r=this;this.adapterOut=function(i,o){var a=Nv({},r.processAttributes);Q$(a,i,o);var l={"-id":"BPMNPlane_1","-bpmnElement":a["-id"]};eF(l,i);var u=r.definitionAttributes;u["bpmn:process"]=a,u["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":l};var d={"bpmn:definitions":u};return d},this.adapterIn=function(i){if(i)return tF(i)},t.adapterIn=function(i){return r.adapterIn(i)},t.adapterOut=function(i,o){return r.adapterOut(i,o)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(f0())},this.definitionAttributes={"-id":"Definitions_".concat(f0()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n}();Ho.shapeConfigMap.set(Yi.START,{width:s0.width,height:s0.height});Ho.shapeConfigMap.set(Yi.END,{width:l0.width,height:l0.height});Ho.shapeConfigMap.set(Yi.GATEWAY,{width:u0.width,height:u0.height});Ho.shapeConfigMap.set(Yi.SYSTEM,{width:d0.width,height:d0.height});Ho.shapeConfigMap.set(Yi.USER,{width:c0.width,height:c0.height});(function(n){Z$(e,n);function e(t){var r=n.call(this,t)||this;r.adapterXmlIn=function(o){var a=typeof o=="string"?r.sanitizeNameAttributes(o):o,l=J$(a);return r.adapterIn(l)},r.adapterXmlOut=function(o,a){var l=r.adapterOut(o,a);return K$(l)};var i=t.lf;return i.adapterIn=r.adapterXmlIn,i.adapterOut=r.adapterXmlOut,r}return e.prototype.sanitizeNameAttributes=function(t){return t.replace(/name="([^"]*)"/g,function(r,i){var o=i.replace(/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'name="'.concat(o,'"')})},e.pluginName="bpmnXmlAdapter",e})(Ho);var iF=function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var r=Math.random()*16|0,i=t==="x"?r:r&3|8;return i.toString(16)});return e},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n}(),oF=(globalThis==null?void 0:globalThis._ids)||new iF;function aF(){return oF.next()}mt("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),mt("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),mt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});mt("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});mt("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var sF=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),oa=function(){return oa=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},oa.apply(this,arguments)},lF=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},uF=fi,dF=function(n){sF(e,n);function e(t){var r=n.call(this)||this;return r.updatePosition=function(i){var o=i.deltaX,a=i.deltaY,l=r.nodeModel,u=l.x,d=l.y;r.nodeModel.x=u+o/2,r.nodeModel.y=d+a/2,r.nodeModel.moveText(o/2,a/2)},r.getResize=function(i){var o=i.index,a=i.deltaX,l=i.deltaY,u=i.width,d=i.height,f=i.PCTResizeInfo,h=i.pct,v=h===void 0?1:h,y=i.freezeWidth,x=y===void 0?!1:y,w=i.freezeHeight,_=w===void 0?!1:w,b={width:u,height:d,deltaX:a,deltaY:l};if(f){var E=4,k=0,O=0;switch(o){case 0:O=(a*-1-l)/E;break;case 1:O=(a-l)/E;break;case 2:O=(a+l)/E;break;case 3:O=(a*-1+l)/E;break}O!==0&&(k=Math.round(O/f.ResizeBasis.basisHeight*1e5)/1e3),f.ResizePCT.widthPCT=Math.max(Math.min(f.ResizePCT.widthPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit),f.ResizePCT.heightPCT=Math.max(Math.min(f.ResizePCT.heightPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit);var N=Math.round(f.ResizePCT.widthPCT*f.ResizeBasis.basisWidth/100),I=Math.round(f.ResizePCT.heightPCT*f.ResizeBasis.basisHeight/100);switch(o){case 0:a=u-N,l=d-I;break;case 1:a=N-u,l=d-I;break;case 2:a=N-u,l=I-d;break;case 3:a=u-N,l=I-d;break}return b.width=N,b.height=I,b.deltaX=a/v,b.deltaY=l/v,b}switch(o){case 0:b.width=x?u:u-a*v,b.height=_?d:d-l*v;break;case 1:b.width=x?u:u+a*v,b.height=_?d:d-l*v;break;case 2:b.width=x?u:u+a*v,b.height=_?d:d+l*v;break;case 3:b.width=x?u:u-a*v,b.height=_?d:d+l*v;break}return b},r.updateEdgePointByAnchors=function(){var i=r.nodeModel,o=i.id,a=i.anchors,l=r.getNodeEdges(o);l.sourceEdges.forEach(function(u){var d=a.find(function(f){return f.id===u.sourceAnchorId});d&&u.updateStartPoint({x:d.x,y:d.y})}),l.targetEdges.forEach(function(u){var d=a.find(function(f){return f.id===u.targetAnchorId});d&&u.updateEndPoint({x:d.x,y:d.y})})},r.updateRect=function(i){var o=i.deltaX,a=i.deltaY,l=r.nodeModel,u=l.x,d=l.y,f=l.width,h=l.height,v=l.radius,y=l.PCTResizeInfo,x=r.nodeModel,w=x.minWidth,_=x.minHeight,b=x.maxWidth,E=x.maxHeight,k=r.index,O=w===b,N=_===E,I=r.getResize({index:k,deltaX:o,deltaY:a,width:f,height:h,PCTResizeInfo:y,pct:1,freezeWidth:O,freezeHeight:N});if(I.width<w||I.width>b||I.height<_||I.height>E){r.dragHandler.cancelDrag();return}r.updatePosition({deltaX:O?0:I.deltaX,deltaY:N?0:I.deltaY}),r.nodeModel.width=I.width,r.nodeModel.height=I.height,r.nodeModel.setProperties({nodeSize:{width:I.width,height:I.height}});var T={x:u,y:d,width:f,height:h,radius:v},L={x:r.nodeModel.x,y:r.nodeModel.y,width:r.nodeModel.width,height:r.nodeModel.height,radius:v};r.updateEdgePointByAnchors(),r.eventEmit({deltaX:o,deltaY:a,beforeNode:T,afterNode:L})},r.updateEllipse=function(i){var o=i.deltaX,a=i.deltaY,l=r.nodeModel,u=l.rx,d=l.ry,f=l.x,h=l.y,v=l.PCTResizeInfo,y=r.index,x=r.nodeModel,w=x.minWidth,_=x.minHeight,b=x.maxWidth,E=x.maxHeight,k=w===b,O=_===E,N=u,I=d,T=r.getResize({index:y,deltaX:o,deltaY:a,width:N,height:I,PCTResizeInfo:v,pct:1/2,freezeWidth:k,freezeHeight:O});if(T.width<w/2||T.width>b/2||T.height<_/2||T.height>E/2){r.dragHandler.cancelDrag();return}r.updatePosition({deltaX:k?0:T.deltaX,deltaY:O?0:T.deltaY}),r.nodeModel.rx=T.width,r.nodeModel.ry=T.height,r.nodeModel.setProperties({nodeSize:{rx:T.width,ry:T.height}});var L={x:f,y:h},H={rx:T.width,ry:T.height,x:r.nodeModel.x,y:r.nodeModel.y};r.updateEdgePointByAnchors(),r.eventEmit({deltaX:o,deltaY:a,beforeNode:oa(oa({},L),{rx:u,ry:d}),afterNode:H})},r.updateDiamond=function(i){var o=i.deltaX,a=i.deltaY,l=r.nodeModel,u=l.rx,d=l.ry,f=l.x,h=l.y,v=l.PCTResizeInfo,y=r.index,x=r.nodeModel,w=x.minWidth,_=x.minHeight,b=x.maxWidth,E=x.maxHeight,k=w===b,O=_===E,N=u,I=d,T=r.getResize({index:y,deltaX:o,deltaY:a,width:N,height:I,PCTResizeInfo:v,pct:1/2,freezeWidth:k,freezeHeight:O});if(T.width<w/2||T.width>b/2||T.height<_/2||T.height>E/2){r.dragHandler.cancelDrag();return}r.updatePosition({deltaX:k?0:T.deltaX,deltaY:O?0:T.deltaY}),r.nodeModel.rx=T.width,r.nodeModel.ry=T.height,r.nodeModel.setProperties({nodeSize:{rx:T.width,ry:T.height}});var L={x:f,y:h,rx:u,ry:d},H={rx:T.width,ry:T.height,x:r.nodeModel.x,y:r.nodeModel.y};r.updateEdgePointByAnchors(),r.eventEmit({deltaX:o,deltaY:a,beforeNode:L,afterNode:H})},r.eventEmit=function(i){var o=i.deltaX,a=i.deltaY,l=i.beforeNode,u=i.afterNode,d=r.nodeModel,f=d.id,h=d.modelType,v=d.type,y=oa({id:f,modelType:h,type:v},l),x=oa({id:f,modelType:h,type:v},u);r.graphModel.eventCenter.emit("node:resize",{preData:y,data:x,deltaX:o,deltaY:a,index:r.index,model:r.nodeModel})},r.onDragging=function(i){var o,a=i.deltaX,l=i.deltaY,u=r.graphModel.transformModel,d=r.nodeModel.modelType;o=lF(u.fixDeltaXY(a,l),2),a=o[0],l=o[1],d===Wt.RECT_NODE||d===Wt.HTML_NODE?r.updateRect({deltaX:a,deltaY:l}):d===Wt.ELLIPSE_NODE?r.updateEllipse({deltaX:a,deltaY:l}):d===Wt.DIAMOND_NODE&&r.updateDiamond({deltaX:a,deltaY:l})},r.onDragEnd=function(){var i=r.graphModel.gridSize,o=i===void 0?1:i,a=o*Math.round(r.nodeModel.x/o),l=o*Math.round(r.nodeModel.y/o);r.nodeModel.moveTo(a,l),r.updateEdgePointByAnchors()},r.index=t.index,r.nodeModel=t.model,r.graphModel=t.graphModel,r.dragHandler=new uF({onDragging:r.onDragging,onDragEnd:r.onDragEnd,step:1}),r}return e.prototype.getNodeEdges=function(t){for(var r=this.graphModel,i=r.edges,o=[],a=[],l=0;l<i.length;l++){var u=i[l];u.sourceNodeId===t?o.push(u):i[l].targetNodeId===t&&a.push(u)}return{sourceEdges:o,targetEdges:a}},e.prototype.render=function(){var t=this.props,r=t.x,i=t.y,o=t.index,a=t.model,l=a.getControlPointStyle();return He("g",{className:"lf-resize-control-".concat(o),children:He(si,oa({className:"lf-node-control",x:r,y:i},l,{onMouseDown:this.dragHandler.handleMouseDown}))})},e}(Zt),cF=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),tc=function(){return tc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},tc.apply(this,arguments)},$c=function(n){cF(e,n);function e(){var t=n.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,r=t.model,i=t.graphModel,o=r.x,a=r.y,l=r.width,u=r.height,d={minX:o-l/2,minY:a-u/2,maxX:o+l/2,maxY:a+u/2},f=d.minX,h=d.minY,v=d.maxX,y=d.maxY,x=[{x:f,y:h},{x:v,y:h},{x:v,y},{x:f,y}];return x.map(function(w,_){return He(dF,tc({index:_},w,{model:r,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.getResizeOutlineStyle();return He(si,tc({},l,{x:r,y:i,width:o,height:a}))},e.prototype.render=function(){return He("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e}(Zt),Pw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();(function(n){Pw(e,n);function e(t,r){var i=n.call(this,t,r)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),r=this.graphModel.editConfigModel.isSilentMode;return r||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var r={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:r,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(dv);(function(n){Pw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,r=t.model,i=t.graphModel;return He($c,{model:r,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,r=t.model,i=t.graphModel.editConfigModel.isSilentMode;return He("g",{children:[this.getResizeShape(),r.isSelected&&!i?this.getControlGroup():""]})},e})(bv);var Rw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Av=function(){return Av=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Av.apply(this,arguments)};(function(n){Rw(e,n);function e(t,r){var i=n.call(this,t,r)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),r=this.graphModel.editConfigModel.isSilentMode;return r||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var r={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:r,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(uv);(function(n){Rw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,r=t.model,i=t.graphModel;return He($c,{model:r,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,r=t.points,i=t.getNodeStyle();return He("g",{children:He(hg,Av({},i,{points:r}))})},e.prototype.getShape=function(){var t=this.props,r=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return He("g",{children:[this.getResizeShape(),r&&!i?this.getControlGroup():""]})},e})(yv);var Iw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();(function(n){Iw(e,n);function e(t,r){var i=n.call(this,t,r)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),r=this.graphModel.editConfigModel.isSilentMode;return r||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var r={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:r,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(Gl);(function(n){Iw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,r=t.model,i=t.graphModel;return He($c,{model:r,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,r=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return He("g",{children:[this.getResizeShape(),r&&!i?this.getControlGroup():""]})},e})(Xl);var Bw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),fF=function(n){Bw(e,n);function e(t,r){var i=n.call(this,t,r)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),r=this.graphModel.editConfigModel.isSilentMode;return r||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var r={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:r,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e}(ws),hF=function(n){Bw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,r=t.model,i=t.graphModel;return He($c,{model:r,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,r=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return He("g",{children:[this.getResizeShape(),r&&!i?this.getControlGroup():""]})},e}(ha),jw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),nc=function(){return nc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},nc.apply(this,arguments)},Qo=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},ea=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},m0=500,y0=300,pF=-1e4;(function(n){jw(e,n);function e(){var t=n.apply(this,ea([],Qo(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=m0,t.unfoldedHeight=y0,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var r=this;n.prototype.initNodeData.call(this,t);var i=[];I1(t.children)&&(i=t.children),this.children=new Set(i),this.width=m0,this.height=y0,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=pF,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){r.isFolded&&r.foldGroup(r.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var r=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=ea(ea([],Qo(this.incoming.edges),!1),Qo(this.outgoing.edges),!1);this.children.forEach(function(o){var a=r.graphModel.getElement(o);if(a){var l=a.isFolded;if(a.isGroup&&!a.isFolded&&a.foldGroup(t),a.isGroup&&!t){var u=r.childrenLastFoldStatus[o];u!==void 0&&u!==a.isFolded&&a.foldGroup(u)}r.childrenLastFoldStatus[o]=!!l,a.visible=!t;var d=a.incoming.edges,f=a.outgoing.edges;i=ea(ea(ea([],Qo(i),!1),Qo(d),!1),Qo(f),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var r=n.prototype.getAnchorStyle.call(this,t);return r.stroke="transparent",r.fill="transparent",r.hover.fill="transparent",r.hover.stroke="transparent",r},e.prototype.foldEdge=function(t,r){var i=this;r.forEach(function(o,a){var l=o.id,u=o.sourceNodeId,d=o.targetNodeId,f=o.startPoint,h=o.endPoint,v=o.type,y=o.text,x=o.getProperties(),w={id:"".concat(l,"__").concat(a),sourceNodeId:u,targetNodeId:d,startPoint:f,endPoint:h,type:v,properties:x,text:y==null?void 0:y.value};o.virtual&&i.graphModel.deleteEdgeById(o.id);var _=i.graphModel.group.getNodeGroup(d);_||(_=i.graphModel.getNodeModelById(d));var b=i.graphModel.group.getNodeGroup(u);b||(b=i.graphModel.getNodeModelById(u)),t&&o.visible!==!1&&(i.children.has(u)||i.id===u?(w.startPoint=void 0,w.sourceNodeId=i.id):(w.endPoint=void 0,w.targetNodeId=i.id),(_.id!==i.id||b.id!==i.id)&&i.createVirtualEdge(w),o.visible=!1),!t&&o.visible===!1&&(_&&_.isGroup&&_.isFolded?(w.targetNodeId=_.id,w.endPoint=void 0,i.createVirtualEdge(w)):b&&b.isGroup&&b.isFolded?(w.sourceNodeId=b.id,w.startPoint=void 0,i.createVirtualEdge(w)):o.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var r=this.graphModel.addEdge(t);r.virtual=!0,r.text.editable=!1,r.isFoldedEdge=!0},e.prototype.isInRange=function(t){var r=t.minX,i=t.minY,o=t.maxX,a=t.maxY;return r>=this.x-this.width/2&&o<=this.x+this.width/2&&i>=this.y-this.height/2&&a<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var r=t.minX,i=t.minY,o=t.maxX,a=t.maxY;return{x:r>=this.x-this.width/2&&o<=this.x+this.width/2,y:i>=this.y-this.height/2&&a<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,r=n.prototype.getData.call(this);r.children=[],this.children.forEach(function(o){var a=t.graphModel.getNodeModelById(o);a&&!a.virtual&&r.children.push(o)});var i=r.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,r},e.prototype.getHistoryData=function(){var t=n.prototype.getData.call(this);t.children=ea([],Qo(this.children),!1),t.isGroup=!0;var r=t.properties;return r==null||delete r.groupAddable,r!=null&&r.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(fF);(function(n){jw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,r=t.resizable,i=t.properties;return r&&!i.isFolded?n.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,r=t.width,i=t.height,o=t.x,a=t.y,l=t.radius,u=t.properties,d=t.getAddableOutlineStyle;if(!u.groupAddable)return null;var f=this.props.model.getNodeStyle().strokeWidth,h=f===void 0?0:f,v=d(),y=r+h+8,x=i+h+8;return mt("rect",nc(nc({},v),{width:y,height:x,x:o-y/2,y:a-x/2,rx:l,ry:l}))},e.prototype.getFoldIcon=function(){var t=this.props.model,r=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var o=mt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(r+3,",").concat(i+6," ").concat(r+11,",").concat(i+6," M").concat(r+7,",").concat(i+2," ").concat(r+7,",").concat(i+10):"M ".concat(r+3,",").concat(i+6," ").concat(r+11,",").concat(i+6," ")});return mt("g",{},[mt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),o])},e.prototype.getResizeShape=function(){return mt("g",{},[this.getAddableShape(),n.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(hF);var _0=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Al=function(){return Al=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Al.apply(this,arguments)};function vF(n){var e=function(r){_0(i,r);function i(o,a){o.id||(o.id="Flow_".concat(aF()));var l=Al(Al(Al({},{}),o.properties),{isDefaultFlow:!1});return o.properties=l,r.call(this,o,a)||this}return i.extendKey="SequenceFlowModel",i}(xs),t=function(r){_0(i,r);function i(){return r!==null&&r.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var o=this.props.model,a=o.properties.isDefaultFlow;return a?mt("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):mt("path",{d:""})},i.extendKey="SequenceFlowEdge",i}(Ss);return{type:"bpmn:sequenceFlow",view:t,model:e}}vF();var b0={width:40,height:40},x0={width:40,height:40},w0={width:100,height:80},rc={width:100,height:80},S0={width:100,height:80},E0={width:100,height:80},C0={width:100,height:80},k0={width:100,height:80},O0={width:100,height:80},M0={width:100,height:80},Ar=function(){};Ar.ObjTree=function(){return this};Ar.ObjTree.VERSION="0.23";Ar.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Ar.ObjTree.prototype.attr_prefix="-";Ar.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,r=t.parseFromString(n,"application/xml");if(!r)return;e=r.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};Ar.ObjTree.prototype.parseHTTP=function(n,e,t){var r={};for(var i in e)r[i]=e[i];if(r.method||(typeof r.postBody>"u"&&typeof r.postbody>"u"&&typeof r.parameters>"u"?r.method="get":r.method="post"),t){r.asynchronous=!0;var o=this,a=t,l=r.onComplete;r.onComplete=function(f){var h;f&&f.responseXML&&f.responseXML.documentElement&&(h=o.parseDOM(f.responseXML.documentElement)),a(h,f),l&&l(f)}}else r.asynchronous=!1;var u;if(typeof HTTP<"u"&&HTTP.Request){r.uri=n;var d=new HTTP.Request(r);d&&(u=d.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var d=new Ajax.Request(n,r);d&&(u=d.transport)}if(t)return u;if(u&&u.responseXML&&u.responseXML.documentElement)return this.parseDOM(u.responseXML.documentElement)};Ar.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!==11){var r={};r[n.nodeName]=t,t=r}return t}};Ar.ObjTree.prototype.parseElement=function(n){if(n.nodeType!==7){if(n.nodeType===3||n.nodeType===4||n.nodeType===8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,r={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var o=n.attributes[i].nodeName;if(typeof o=="string"){var a=n.attributes[i].nodeValue;try{a=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{a=n.attributes[i].nodeValue}a!=null&&(o=this.attr_prefix+o,typeof r[o]>"u"&&(r[o]=0),r[o]++,this.addNode(t,o,r[o],a))}}}if(n.childNodes&&n.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<n.childNodes.length&&l;i++){var u=n.childNodes[i].nodeType;u===3||u===4||u===8||(l=!1)}if(l){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i].nodeName;if(typeof o=="string"){var a=this.parseElement(n.childNodes[i]);a&&(typeof r[o]>"u"&&(r[o]=0),r[o]++,this.addNode(t,o,r[o],a))}}}}else t===null&&(t={});return t}};Ar.ObjTree.prototype.addNode=function(n,e,t,r){this.__force_array[e]?(t===1&&(n[e]=[]),n[e][n[e].length]=r):t===1?n[e]=r:t===2?n[e]=[n[e],r]:n[e][n[e].length]=r};Ar.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};Ar.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],r=[];for(var i in e)if(Ll(e,i)){var o=e[i];i.charAt(0)!==this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<".concat(i," />"):typeof o=="object"&&o.constructor===Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):r[r.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(o),'"')}var a=r.join(""),l=t.join("");return typeof n>"u"||n==null||(t.length>0?l.match(/\n/)?l="<".concat(n).concat(a,`>
`).concat(l,"</").concat(n,`>
`):l="<".concat(n).concat(a,">").concat(l,"</").concat(n,`>
`):l="<".concat(n).concat(a,` />
`)),l};Ar.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],r=0;r<e.length;r++){var i=e[r];typeof i>"u"||i==null?t[t.length]="<".concat(n," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};Ar.ObjTree.prototype.scalar_to_xml=function(n,e){return n==="#text"?this.xml_escape(e):"<".concat(n,">").concat(this.xml_escape(e),"</").concat(n,`>
`)};Ar.ObjTree.prototype.xml_escape=function(n){return n.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var gF=function(n){return new Ar.ObjTree().parseXML(n)};function Hw(n){return Object.prototype.toString.call(n)}function N0(n){return"  ".repeat(n)}function ic(n){return Hw(n)==="[object Object]"?Object.keys(n).reduce(function(e,t){var r=t;return t.charAt(0)==="-"&&(r=t.substring(1)),e[r]=ic(n[t]),e},{}):Array.isArray(n)?n.map(function(e){return ic(e)}):n}function mF(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(ic(n)).replace(/"/g,"'")}return e}var A0=`	
`;function yd(n,e,t){var r=N0(t),i="",o=A0+r;if(e==="-json")return"";if(e==="#text")return o+n;if(e==="#cdata-section")return"".concat(o,"<![CDATA[").concat(n,"]]>");if(e==="#comment")return"".concat(o,"<!--").concat(n,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(mF(n),'"');if(Array.isArray(n))i+=n.map(function(d){return yd(d,e,t+1)}).join("");else if(Hw(n)==="[object Object]"){var a=Object.keys(n),l="",u=n["-json"]?A0+N0(t+1)+n["-json"]:"";i+="".concat(t===0?"":o,"<").concat(e),a.forEach(function(d){d.charAt(0)==="-"?l+=yd(n[d],d,t+1):u+=yd(n[d],d,t+1)}),i+=l+(u!==""?">".concat(u).concat(o,"</").concat(e,">"):" />")}else i+="".concat(o,"<").concat(e,">").concat(n.toString(),"</").concat(e,">");return i}function yF(n){var e="";for(var t in n)e+=yd(n[t],t,0);return e}var _F=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Tv=function(){return Tv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Tv.apply(this,arguments)},T0=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t},gg=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},gr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Si=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},kr;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",n.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",n.BOUNDARY="bpmn:boundaryEvent",n.PARALLEL_GATEWAY="bpmn:parallelGateway",n.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",n.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow",n.SUBPROCESS="bpmn:subProcess"})(kr||(kr={}));var $w=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],bF=["properties","startPoint","endPoint","pointsList"],oc={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},Fw=function(n,e){var t=Object.keys(e||{});return t.forEach(function(r){if(n[r]){var i=e[r],o=i.in,a=i.out;o&&(n[r].in=o),a&&(n[r].out=a)}else n[r]=e[r]}),n},oi={"bpmn:startEvent":{out:function(n){var e,t,r=n.properties;return((t=(e=oi[r.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateCatchEvent":{out:function(n){var e,t,r=n.properties;return((t=(e=oi[r.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateThrowEvent":{out:function(n){var e,t,r=n.properties;return((t=(e=oi[r.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:boundaryEvent":{out:function(n){var e,t,r=n.properties;return((t=(e=oi[r.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:sequenceFlow":{out:function(n){var e=n.properties,t=e.expressionType,r=e.condition;return r?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(r,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(r,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(n){var e=n.properties,t=e.timerType,r=e.timerValue,i=e.definitionId,o=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(r,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&r?">".concat(o(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(n,e){var t,r,i,o,a=n,l=e["-id"],u="",d="";try{for(var f=gg(Object.keys(e)),h=f.next();!h.done;h=f.next()){var v=h.value;v.includes("bpmn:")&&(i=gr(v.split(":"),2),u=i[1],d=(o=e[v])===null||o===void 0?void 0:o["#text"])}}catch(y){t={error:y}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}return{"-definitionId":l,"-definitionType":a,"-timerType":u,"-timerValue":d}}},"bpmn:conditionExpression":{in:function(n,e){var t,r="",i="";return e["#cdata-section"]?(i="cdata",r=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",r=e["#text"]),{"-condition":r,"-expressionType":i}}}};function xF(n){var e=n??{},t=e.retainedAttrsFields,r=e.excludeFields,i=e.transformer,o=new Set(Si(Si([],gr(bF),!1),gr(t||[]),!1)),a={in:new Set(Si(Si([],gr(oc.in),!1),gr((r==null?void 0:r.in)||[]),!1)),out:new Set(Si(Si([],gr(oc.out),!1),gr((r==null?void 0:r.out)||[]),!1))};return oi=Fw(oi,i),function(l){var u=l.nodes,d=l.edges;function f(h,v){var y,x;if((h==null?void 0:h.flag)!==1){var w;if((w=oi[h.type])&&w.out){var _=w.out(h),b=Object.keys(_);b.length>0&&b.forEach(function(H){h[H]=_[H]})}h!=null&&h.children&&(h.children=h.children.map(function(H){var X=u.find(function(V){return V.id===H})||d.find(function(V){return V.id===H});return X||{}}));var E={};if(typeof h=="string")return h;if(Array.isArray(h))return h.map(function(H){return f(H,"")}).filter(function(H){return H!=null});try{for(var k=gg(Object.entries(h)),O=k.next();!O.done;O=k.next()){var N=gr(O.value,2),I=N[0],T=N[1];if((T==null?void 0:T.flag)===1)return;var L=[v,I].filter(function(H){return H}).join(".");a.out.has(L)||(typeof T!="object"?I.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(I)?E[I]=T:E["-".concat(I)]=T:o.has(L)?E["-".concat(I)]=f(T,L):E[I]=f(T,L))}}catch(H){y={error:H}}finally{try{O&&!O.done&&(x=k.return)&&x.call(k)}finally{if(y)throw y.error}}return E}}return f(l,"")}}function ac(n){var e,t,r={};try{for(var i=gg(Object.entries(n)),o=i.next();!o.done;o=i.next()){var a=gr(o.value,2),l=a[0],u=a[1];l.indexOf("-")===0?r[l.substring(1)]=ic(u):typeof u=="string"?r[l]=u:Object.prototype.toString.call(u)==="[object Object]"?r[l]=ac(u):Array.isArray(u)?r[l]=u.map(function(d){return ac(d)}):r[l]=u}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r}function wF(n,e,t){var r,i=new Map,o=xF(t)(e);o.nodes.forEach(function(l){var u=l["-id"],d=l["-type"],f=l.text,h=l.children,v=T0(l,["-id","-type","text","children"]),y={"-id":u};f!=null&&f["-value"]&&(y["-name"]=f["-value"]),v["-json"]&&(y["-json"]=v["-json"]),v["-properties"]&&Object.assign(y,v["-properties"]),h&&(y.children=h),n[d]||(n[d]=[]),n[d].push(y),i.set(u,y)});var a=o.edges.map(function(l){var u=l["-id"],d=l["-sourceNodeId"],f=l["-targetNodeId"],h=l.text,v=T0(l,["-id","-sourceNodeId","-targetNodeId","text"]),y=i.get(f);y["bpmn:incoming"]||(y["bpmn:incoming"]=[]),y["bpmn:incoming"].push(u);var x={"-id":u,"-sourceRef":d,"-targetRef":f};return h!=null&&h["-value"]&&(x["-name"]=h["-value"]),v["-json"]&&(x["-json"]=v["-json"]),v["-properties"]&&Object.assign(x,v["-properties"]),x});return e.edges.forEach(function(l){var u=l.sourceNodeId,d=l.id,f=i.get(u);f["bpmn:outgoing"]||(f["bpmn:outgoing"]=[]),f["bpmn:outgoing"].push(d)}),(r=n["bpmn:subProcess"])===null||r===void 0||r.forEach(function(l){var u={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},d=[];l.children.forEach(function(w){var _,b=i.get(w["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(k){b[k]&&b[k].forEach(function(O){u[k].add(O)})});var E=(_=n[w["-type"]])===null||_===void 0?void 0:_.findIndex(function(k){return k["-id"]===w["-id"]});E>=0&&n[w["-type"]].splice(E,1),i.delete(w["-id"]),l[w["-type"]]||(l[w["-type"]]=[]),l[w["-type"]].push(b)});var f=u["bpmn:incoming"],h=u["bpmn:outgoing"];h.forEach(function(w){f.has(w)&&d.push(w)});for(var v=function(w){var _=a.findIndex(function(b){return b["-id"]===d[w]});_>=0?(l["bpmn:sequenceFlow"]||(l["bpmn:sequenceFlow"]=[]),l["bpmn:sequenceFlow"].push(a[_]),a.splice(_,1)):w++,y=w},y,x=0;x<d.length;)v(x),x=y;delete l.children}),n[kr.FLOW]=a,n}function SF(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var r,i=t.id,o=t.pointsList.map(function(l){var u=l.x,d=l.y;return{"-x":u,"-y":d}}),a={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((r=t.text)===null||r===void 0)&&r.value&&(a["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),a}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var r,i=t.id,o=100,a=80,l=t.x,u=t.y,d=Ur.shapeConfigMap.get(t.type);d&&(o=d.width,a=d.height),l-=o/2,u-=a/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":u,"-width":o,"-height":a}};return!((r=t.text)===null||r===void 0)&&r.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}var EF=["bpmn:incoming","bpmn:outgoing"];function CF(n,e){var t=[],r=[],i=new Map,o=e??{},a=o.transformer,l=o.excludeFields,u={in:new Set(Si(Si([],gr(oc.in),!1),gr((l==null?void 0:l.in)||[]),!1)),out:new Set(Si(Si([],gr(oc.out),!1),gr((l==null?void 0:l.out)||[]),!1))};oi=Fw(oi,a);var d=n["bpmn:definitions"];if(d){var f=d["bpmn:process"];(function(v,y){y.forEach(function(x){try{Object.keys(v).forEach(function(w){try{x(w)}catch(_){console.error(_)}})}catch(w){console.error(w)}})})(f,[function(v){function y(w){w["-children"]||(w["-children"]=[]),Object.keys(w).forEach(function(_){var b;_.indexOf("bpmn:")===0&&!EF.includes(_)&&(f[_]||(f[_]=[]),!Array.isArray(f[_])&&(f[_]=[f[_]]),Array.isArray(w[_])?(b=f[_]).push.apply(b,Si([],gr(w[_]),!1)):f[_].push(w[_]),Array.isArray(w[_])?w[_].forEach(function(E){!_.includes("Flow")&&w["-children"].push(E["-id"])}):!_.includes("Flow")&&w["-children"].push(w[_]["-id"]),delete w[_])})}if(v==="bpmn:subProcess"){var x=f[v];Array.isArray(x)?x.forEach(function(w){v==="bpmn:subProcess"&&y(w)}):y(x)}},function(v){var y=function(w){Object.keys(w).forEach(function(_){var b,E;if(_.includes("bpmn:")){var k={};oi[_]&&oi[_].in?(k=(E=(b=oi[_]).in)===null||E===void 0?void 0:E.call(b,_,B1.cloneDeep(w[_])),delete w[_]):x(w[_]);var O=void 0;(O=Reflect.ownKeys(k)).length>0&&O.forEach(function(N){Reflect.set(w,N,k[N])})}})};function x(w){i.set(w["-id"],w),Array.isArray(w)?w.forEach(function(_){x(_)}):typeof w=="object"&&y(w)}x(f[v])},function(v){if(v.indexOf("bpmn:")===0){var y=f[v];if(v==="bpmn:sequenceFlow"){var x=d["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];r=OF(y,x)}else{var w=d["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(v==="bpmn:boundaryEvent"){var _=f[v],b=function(E){var k=E["-attachedToRef"],O=i.get(k);O["-boundaryEvents"]||(O["-boundaryEvents"]=[]),O["-boundaryEvents"].push(E["-id"])};Array.isArray(_)?_.forEach(function(E){b(E)}):b(_)}t=t.concat(kF(y,w,v))}}}])}var h=function(v,y,x){Object.keys(v).forEach(function(w){var _=x?"".concat(x,".").concat(w):w;y.has(_)?delete v[w]:typeof v[w]=="object"&&h(v[w],y,_)})};return t.forEach(function(v){var y,x;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var w=(x=e==null?void 0:e.mapping)===null||x===void 0?void 0:x.in,_=v.type;w[_]&&(v.type=w[_])}h(v,u.in,"")}),r.forEach(function(v){var y,x;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var w=(x=e==null?void 0:e.mapping)===null||x===void 0?void 0:x.in,_=v.type;w[_]&&(v.type=w[_])}h(v,u.in,"")}),{nodes:t,edges:r}}function kF(n,e,t){var r=[];if(Array.isArray(n))n.forEach(function(a){var l;Array.isArray(e)?l=e.find(function(d){return d["-bpmnElement"]===a["-id"]}):l=e;var u=D0(l,t,a);r.push(u)});else{var i=void 0;Array.isArray(e)?i=e.find(function(a){return a["-bpmnElement"]===n["-id"]}):i=e;var o=D0(i,t,n);r.push(o)}return r}function D0(n,e,t){var r=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),o=t["-children"],a=t["-name"],l=Ur.shapeConfigMap.get(e);l&&(r+=l.width/2,i+=l.height/2);var u={};Object.entries(t).forEach(function(v){var y=gr(v,2),x=y[0],w=y[1];$w.includes(x)||(u[x]=w)}),u=ac(u);var d;if(a&&(d={x:r,y:i,value:a},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var f=n["bpmndi:BPMNLabel"]["dc:Bounds"];d.x=Number(f["-x"])+Number(f["-width"])/2,d.y=Number(f["-y"])+Number(f["-height"])/2}var h={id:n["-bpmnElement"],type:e,x:r,y:i,properties:u};return o&&(h.children=o),d&&(h.text=d),h}function OF(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(a){return a["-bpmnElement"]===i["-id"]}):o=e,t.push(L0(o,i))});else{var r=void 0;Array.isArray(e)?r=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):r=e,t.push(L0(r,n))}return t}function L0(n,e){var t,r=e["-name"]?"".concat(e["-name"]):"";if(r){var i=n["bpmndi:BPMNLabel"]["dc:Bounds"],o=0;r.split(`
`).forEach(function(d){o<d.length&&(o=d.length)}),t={value:r,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7}}var a={};Object.entries(e).forEach(function(d){var f=gr(d,2),h=f[0],v=f[1];$w.includes(h)||(a[h]=v)}),a=ac(a);var l=n["di:waypoint"].map(function(d){return{x:Number(d["-x"]),y:Number(d["-y"])}}),u={id:e["-id"],type:kr.FLOW,pointsList:l,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:a};return t&&(u.text=t),u}var Ur=function(){function n(e){var t=e.lf,r=this;this.adapterOut=function(i,o){var a,l,u=Tv({},r.processAttributes);wF(u,i,o);var d={"-id":"BPMNPlane_1","-bpmnElement":u["-id"]};SF(d,i);var f=r.definitionAttributes;f["bpmn:process"]=u,f["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":d};var h={"bpmn:definitions":f};if(!((a=o==null?void 0:o.mapping)===null||a===void 0)&&a.out){var v=(l=o==null?void 0:o.mapping)===null||l===void 0?void 0:l.out,y=function(x){Array.isArray(x)&&x.forEach(function(w){return y(w)}),typeof x=="object"&&Object.keys(x).forEach(function(w){var _;(_=v[w])?(x[_]=B1.cloneDeep(x[w]),delete x[w],y(x[_])):y(x[w])})};y(h)}return h},this.adapterIn=function(i,o){if(i)return CF(i,o)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n}();Ur.shapeConfigMap.set(kr.START,{width:b0.width,height:b0.height});Ur.shapeConfigMap.set(kr.END,{width:x0.width,height:x0.height});Ur.shapeConfigMap.set(kr.INTERMEDIATE_CATCH,{width:rc.width,height:rc.height});Ur.shapeConfigMap.set(kr.INTERMEDIATE_THROW,{width:rc.width,height:rc.height});Ur.shapeConfigMap.set(kr.BOUNDARY,{width:w0.width,height:w0.height});Ur.shapeConfigMap.set(kr.PARALLEL_GATEWAY,{width:S0.width,height:S0.height});Ur.shapeConfigMap.set(kr.INCLUSIVE_GATEWAY,{width:E0.width,height:E0.height});Ur.shapeConfigMap.set(kr.EXCLUSIVE_GATEWAY,{width:C0.width,height:C0.height});Ur.shapeConfigMap.set(kr.SYSTEM,{width:k0.width,height:k0.height});Ur.shapeConfigMap.set(kr.USER,{width:O0.width,height:O0.height});Ur.shapeConfigMap.set(kr.SUBPROCESS,{width:M0.width,height:M0.height});(function(n){_F(e,n);function e(t){var r=n.call(this,t)||this;r.adapterXmlIn=function(a){var l=gF(a);return r.adapterIn(l,r.props)},r.adapterXmlOut=function(a){var l=r.adapterOut(a,r.props);return yF(l)};var i=t.lf,o=t.props;return i.adapterIn=r.adapterXmlIn,i.adapterOut=r.adapterXmlOut,r.props=o,r}return e.pluginName="BPMNAdapter",e})(Ur);function MF(n,e,t){var r=e.x,i=e.y,o=n.x,a=n.y,l=o-r,u=a-i,d=l*Math.cos(t)-u*Math.sin(t),f=l*Math.sin(t)+u*Math.cos(t),h=d+r,v=f+i;return{x:h,y:v}}var NF=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),sc=function(){return sc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},sc.apply(this,arguments)},AF=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},TF=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},DF=function(n){NF(e,n);function e(){var t=n.apply(this,TF([],AF(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(r){var i=r.model,o=t.props,a=o.model,l=o.graphModel,u=a.transformWithContainer,d=a.isRestrict,f=t.childrenPositionMap;if(!(!u||d)&&i.id===a.id){var h={x:a.x,y:a.y};zt(Array.from(a.children),function(v){var y=l.getNodeModelById(v);if(y){var x={x:y.x,y:y.y};f.has(y.id)?x=f.get(y.id):f.set(y.id,x);var w=i.rotate*(180/Math.PI);w<0&&(w+=360);var _=w*(Math.PI/180),b=MF(x,h,_);y.moveTo(b.x,b.y),y.rotate=i.rotate}})}},t.onNodeResize=function(r){var i=r.deltaX,o=r.deltaY,a=r.index,l=r.model,u=r.preData,d=t.props,f=d.model,h=d.graphModel,v=f.transformWithContainer,y=f.isRestrict;if(!(!v||y)&&l.id===f.id){var x=u.properties,w=x||{},_=w.width,b=w.height;zt(Array.from(f.children),function(E){var k=h.getNodeModelById(E);if(k){var O=k.width/_*i,N=k.height/b*o;yw({deltaX:O,deltaY:N,index:a,nodeModel:k,graphModel:h,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var r=t.props.model;r.isCollapsed&&r.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){n.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,r){var i=this,o=[];return t.isGroup&&zt(Array.from(t.children),function(a){o.push(a);var l=r.getNodeModelById(a);l!=null&&l.isGroup&&(o=o.concat(i.getNodesInGroup(l,r)))}),o},e.prototype.getResizeControl=function(){var t=this.props.model,r=t.resizable,i=t.isCollapsed,o=r&&!i;return o?n.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,r=t.width,i=t.height,o=t.x,a=t.y,l=t.radius,u=t.groupAddable;if(!u)return null;var d=t.getNodeStyle().strokeWidth,f=d===void 0?0:d,h=t.getAddableOutlineStyle(),v=r+f+8,y=i+f+8;return mt("rect",sc(sc({},h),{width:v,height:y,x:o-v/2,y:a-y/2,rx:l,ry:l}))},e.prototype.getCollapseIcon=function(t,r){return"M ".concat(t+3,",").concat(r+6," ").concat(t+11,",").concat(r+6," M").concat(t+7,",").concat(r+2," ").concat(t+7,",").concat(r+10)},e.prototype.getExpandIcon=function(t,r){return"M ".concat(t+3,",").concat(r+6," ").concat(t+11,",").concat(r+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=r-o/2+10,u=i-a/2+10;if(!t.collapsible)return null;var d=t!=null&&t.isCollapsed?this.getCollapseIcon(l,u):this.getExpandIcon(l,u),f=mt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d});return mt("g",{},[mt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:l,y:u,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),f])},e.prototype.getShape=function(){return mt("g",{},[this.getAppendAreaShape(),n.prototype.getShape.call(this),this.getOperateIcon()])},e}(ha),LF=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),lc=function(){return lc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},lc.apply(this,arguments)},ih=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Xa=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},cl=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},PF=400,RF=230,IF=80,BF=60,jF=-1e4,HF=function(n){LF(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var r;n.prototype.initNodeData.call(this,t);var i=(r=t.properties)!==null&&r!==void 0?r:{},o=i.children,a=i.width,l=i.height,u=i.collapsedWidth,d=i.collapsedHeight,f=i.collapsible,h=i.isCollapsed,v=i.zIndex,y=i.isRestrict,x=i.autoResize,w=i.autoToFront,_=i.transformWithContainer;this.children=o?new Set(o):new Set,this.zIndex=v??jF,this.isCollapsed=h??!1,this.setProperties({isCollapsed:h??!1});var b=a??PF,E=l??RF;this.width=b,this.height=E,this.expandWidth=b,this.expandHeight=E,this.collapsedWidth=u??IF,this.collapsedHeight=d??BF,this.isRestrict=y??!1,this.transformWithContainer=_??!1,this.autoResize=x??!1,this.collapsible=f??!0,this.autoToFront=w??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,r=n.prototype.getData.call(this),i=[];return zt(Array.from(this.children),function(o){var a=t.graphModel.getNodeModelById(o);a&&!a.virtual&&i.push(o)}),r.children=i,r.properties&&(r.properties.children=i,r.properties.isCollapsed=this.isCollapsed),r},e.prototype.getNodesInGroup=function(t){var r=[];return t.isGroup&&zt(Array.from(t.children),function(i){r.push(i)}),r},e.prototype.getMoveDistance=function(t,r,i){i===void 0&&(i=!1);var o=Xa(n.prototype.getMoveDistance.call(this,t,r,i),2),a=o[0],l=o[1],u=this.getNodesInGroup(this);return this.graphModel.moveNodes(u,t,r,i),[a,l]},e.prototype.getHistoryData=function(){var t=n.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var r=this,i=r.x,o=r.y,a=r.collapsedWidth,l=r.collapsedHeight,u=r.expandWidth,d=r.expandHeight,f=r.isCollapsed;return f&&(t.x=i+u/2-a/2,t.y=o+d/2-l/2,t.text&&(t.text.x=t.text.x+u/2-a/2,t.text.y=t.text.y+d/2-l/2)),t},e.prototype.toggleCollapse=function(t){var r=this,i=this.graphModel,o=!!t;this.isCollapsed=o,this.setProperties({isCollapsed:o}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:o,nodeModel:this}),o?this.collapse():this.expand();var a=cl(cl([],Xa(this.incoming.edges),!1),Xa(this.outgoing.edges),!1),l=Array.from(this.children);zt(l,function(u){var d,f,h=r.graphModel.elementsModelMap.get(u);if(h){var v=h.isCollapsed;if(h.isGroup){var y=h;if(y.isCollapsed||y.toggleCollapse(t),!t){var x=(d=r.childrenLastCollapseStateDict)===null||d===void 0?void 0:d.get(u);x!==void 0&&x!==h.isCollapsed&&y.toggleCollapse(x)}}if((f=r.childrenLastCollapseStateDict)===null||f===void 0||f.set(u,!!v),h.visible=!t,h.BaseType===kn.NODE){var w=h.incoming.edges,_=h.outgoing.edges;a=cl(cl(cl([],Xa(a),!1),Xa(w),!1),Xa(_),!1)}}}),this.collapseEdge(o,a)},e.prototype.collapse=function(){var t=this,r=t.x,i=t.y,o=t.text,a=t.width,l=t.height,u=t.collapsedWidth,d=t.collapsedHeight;this.x=r-a/2+u/2,this.y=i-l/2+d/2,this.text.x=o.x-a/2+u/2,this.text.y=o.y-l/2+d/2,this.expandWidth=a,this.expandHeight=l,this.width=u,this.height=d},e.prototype.expand=function(){var t=this,r=t.x,i=t.y,o=t.text,a=t.expandWidth,l=t.expandHeight,u=t.collapsedWidth,d=t.collapsedHeight;this.width=a,this.height=l,this.x=r+this.width/2-u/2,this.y=i+this.height/2-d/2,this.text.x=o.x+this.width/2-u/2,this.text.y=o.y+this.height/2-d/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var r=this.graphModel.addEdge(t);r.virtual=!0,r.text.editable=!1,r.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,r){var i=this,o=this.graphModel;zt(r,function(a,l){var u,d=a.getData(),f=d.targetNodeId,h=d.sourceNodeId,v=lc(lc({},d),{id:"".concat(d.id,"__").concat(l),text:(u=d.text)===null||u===void 0?void 0:u.value});a.virtual&&o.deleteEdgeById(a.id);var y=o.dynamicGroup.getGroupByNodeId(f);y||(y=o.getNodeModelById(f));var x=o.dynamicGroup.getGroupByNodeId(h);x||(x=o.getNodeModelById(h)),t&&a.visible&&(i.children.has(h)||i.id===h?(v.startPoint=void 0,v.sourceNodeId=i.id):(v.endPoint=void 0,v.targetNodeId=i.id),(y.id!==i.id||x.id!==i.id)&&i.createVirtualEdge(v),a.visible=!1),!t&&!a.visible&&(y&&y.isGroup&&y.isCollapsed?(v.targetNodeId=y.id,v.endPoint=void 0,i.createVirtualEdge(v)):x&&x.isGroup&&x.isCollapsed?(v.sourceNodeId=x.id,v.startPoint=void 0,i.createVirtualEdge(v)):a.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var r=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:r,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var r=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:r})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=n.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},ih([$e],e.prototype,"isCollapsed",void 0),ih([$e],e.prototype,"groupAddable",void 0),ih([$e],e.prototype,"transformWithContainer",void 0),e}(ws);function $F(n,e){var t=n.minX,r=n.minY,i=n.maxX,o=n.maxY,a=e.x,l=e.y,u=e.width,d=e.height;return t>=a-u/2&&i<=a+u/2&&r>=l-d/2&&o<=l+d/2}function FF(n,e,t,r){var i=n.minX,o=n.minY,a=n.maxX,l=n.maxY,u=e.x,d=e.y,f=e.width,h=e.height,v=i+f/2,y=o+h/2,x=a-f/2,w=l-h/2;return{x:u+t>=v&&u+t<=x,y:d+r>=y&&d+r<=w}}var uc=function(){return uc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},uc.apply(this,arguments)},Ya=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Ka=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},mg={type:"dynamic-group",view:DF,model:HF},zF=-1e3,ud=-1e4,UF=function(){function n(e){var t=e.lf,r=e.options,i=this;this.topGroupZIndex=ud,this.nodeGroupMap=new Map,this.onSelectionDrop=function(){var o=i.lf.graphModel.getSelectElements().nodes;o.forEach(function(a){i.addNodeToGroup(a)})},this.onNodeAddOrDrop=function(o){var a=o.data;i.addNodeToGroup(a)},this.addNodeToGroup=function(o){var a=i.nodeGroupMap.get(o.id);if(a){var l=i.lf.getNodeModelById(a);l.removeChild(o.id),i.nodeGroupMap.delete(o.id),l.setAllowAppendChild(!1)}var u=i.lf.getNodeModelById(o.id),d=u==null?void 0:u.getBounds();if(u&&d){if(u.isGroup){var f=u;zt(Array.from(f.children),function(y){i.nodeGroupMap.set(y,o.id)}),i.calibrateTopGroupZIndex([o]),i.onNodeSelect({data:o,isSelected:!1,isMultiple:!1})}var l=i.getGroupByBounds(d,o);if(l){var h=l.isAllowAppendIn(o);h?(l.addChild(o.id),l.setAllowAppendChild(!1)):i.lf.emit("group:not-allowed",{group:l.getData(),node:o})}}},this.onGroupAddNode=function(o){var a=o.data,l=o.childId;i.nodeGroupMap.set(l,a.id)},this.removeNodeFromGroup=function(o){var a=o.data,l=o.model;l.isGroup&&a.children&&zt(Array.from(a.children),function(f){i.nodeGroupMap.delete(f),i.lf.deleteNode(f)});var u=i.nodeGroupMap.get(a.id);if(u){var d=i.lf.getNodeModelById(u);d&&d.removeChild(a.id),i.nodeGroupMap.delete(a.id)}},this.onSelectionDrag=function(){var o=i.lf.graphModel.getSelectElements().nodes;o.forEach(function(a){i.setActiveGroup(a)})},this.onNodeDrag=function(o){var a=o.data;i.setActiveGroup(a)},this.setActiveGroup=function(o){var a=i.lf.getNodeModelById(o.id),l=a==null?void 0:a.getBounds();if(a&&l){var u=i.getGroupByBounds(l,o);if(i.activeGroup&&i.activeGroup.setAllowAppendChild(!1),!u||a.isGroup&&u.id===o.id)return;var d=u.isAllowAppendIn(o);if(!d)return;i.activeGroup=u,i.activeGroup.setAllowAppendChild(!0)}},this.onNodeSelect=function(o){var a=o.data,l=o.isMultiple,u=o.isSelected,d=i.lf.getNodeModelById(a.id);if(i.sendNodeToFront(d),i.topGroupZIndex>zF){var f=i.lf.graphModel.nodes;i.topGroupZIndex=ud;var h=X2(Hu(f,function(_){return!!_.isGroup}),"zIndex"),v=0;zt(h,function(_){_.zIndex!==v&&(i.topGroupZIndex++,v=_.zIndex),_.setZIndex(i.topGroupZIndex)})}if(l&&u)if(d!=null&&d.isGroup){var y=d.children;zt(Array.from(y),function(_){var b=i.lf.getNodeModelById(_);b==null||b.setSelected(!1)})}else{var x=i.nodeGroupMap.get(a.id);if(x){var w=i.lf.getNodeModelById(x);w!=null&&w.isSelected&&(d==null||d.setSelected(!1))}}},this.onNodeMove=function(o){var a=o.deltaX,l=o.deltaY,u=o.data,d=u.id,f=u.x,h=u.y,v=u.properties;if(v){var y=v.width,x=v.height,w=i.nodeGroupMap.get(d);if(w){var _=i.lf.getNodeModelById(w);if(!(!_||!_.isRestrict||!_.autoResize)){var b=f+a/2,E=h+l/2,k=b-y/2,O=E-x/2,N=b+y/2,I=E+x/2,T=!1,L=_.getBounds(),H=Object.assign({},L);if(k<H.minX&&(H.minX=k,T=!0),O<H.minY&&(H.minY=O,T=!0),N>H.maxX&&(H.maxX=N,T=!0),I>H.maxY&&(H.maxY=I,T=!0),!!T){var X=H.minX+(H.maxX-H.minX)/2,V=H.minY+(H.maxY-H.minY)/2,q=H.maxX-H.minX,D=H.maxY-H.minY;_.moveTo(X,V),_.width=q,_.height=D}}}}},this.onGraphRendered=function(o){var a=o.data;zt(a.nodes,function(l){l.children&&zt(l.children,function(u){i.nodeGroupMap.set(u,l.id)})}),i.calibrateTopGroupZIndex(a.nodes)},t.register(mg),this.lf=t,on(this,r),this.init()}return n.prototype.getGroupByNodeId=function(e){var t=this.nodeGroupMap.get(e);if(t)return this.lf.getNodeModelById(t)},n.prototype.getGroupByBounds=function(e,t){var r=this.lf.graphModel.nodes,i=Hu(r,function(u){return!!u.isGroup&&$F(e,u)&&u.id!==t.id}),o=i.length;if(o<=1)return i[0];for(var a=i[o-1],l=o-2;l>=0;l--)i[l].zIndex>a.zIndex&&(a=i[l]);return a},n.prototype.sendNodeToFront=function(e){var t=this;if(!(!e||!e.isGroup)&&(this.topGroupZIndex++,e.setZIndex(this.topGroupZIndex),e.children)){var r=e.children;zt(Array.from(r),function(i){var o=t.lf.getNodeModelById(i);t.sendNodeToFront(o)})}},n.prototype.getMaxZIndex=function(e){var t=this,r=ud;if(e.isGroup&&(r=Math.max(r,e.zIndex)),e.children){var i=e.children;zt(Array.from(i),function(o){var a=t.lf.getNodeModelById(o);if(a!=null&&a.isGroup){var l=t.getMaxZIndex(a);r=Math.max(r,l)}})}return r},n.prototype.calibrateTopGroupZIndex=function(e){var t=this,r=ud;if(zt(e,function(l){var u=t.lf.getNodeModelById(l.id);if(u){var d=t.getMaxZIndex(u);d>r&&(r=d)}}),!(this.topGroupZIndex>=r)){var i=this.lf.graphModel.nodes,o=Hu(i,function(l){return!!l.isGroup}),a=this.topGroupZIndex;zt(o,function(l){l.zIndex>a&&(a=l.zIndex)}),this.topGroupZIndex=a}},n.prototype.removeChildrenInGroupNodeData=function(e){var t,r=It(e);return delete r.children,!((t=r.properties)===null||t===void 0)&&t.children&&delete r.properties.children,r},n.prototype.initGroupChildNodes=function(e,t,r,i){var o=this,a=[],l=[],u=[];zt(Array.from(t),function(h){var v=o.lf.getNodeModelById(h);if(v){var y=v.children,x=v.getData(),w=kt.NODE_GROUP_COPY||"node:group-copy-add",_=H$(o.removeChildrenInGroupNodeData(x),i),b=o.lf.addNode(_,w);if(r.addChild(b.id),e[h]=b.id,a.push(b),u.push.apply(u,Ka([],Ya(Ka(Ka([],Ya(b.incoming.edges),!1),Ya(b.outgoing.edges),!1)),!1)),y instanceof Set){var E=o.initGroupChildNodes(e,y,b,i),k=E.childNodes,O=E.edgesData;a.push.apply(a,Ka([],Ya(k),!1)),l.push.apply(l,Ka([],Ya(O),!1))}}});var d=Hu(u,function(h){return Ll(e,h.sourceNodeId)&&Ll(e,h.targetNodeId)}),f=Di(d,function(h){return h.getData()});return{childNodes:a,edgesData:l.concat(f)}},n.prototype.createEdge=function(e,t,r){var i,o,a=e.sourceNodeId,l=e.targetNodeId,u=(i=t[a])!==null&&i!==void 0?i:a,d=(o=t[l])!==null&&o!==void 0?o:l,f=It(e);return e.id&&typeof e.text=="object"&&e.text!==null&&(f=$$(e,r)),this.lf.graphModel.addEdge(uc(uc({},f),{sourceNodeId:u,targetNodeId:d}))},n.prototype.checkGroupBoundsWithChildren=function(e,t,r,i,o){if(e.children)for(var a=e.children,l=e.x,u=e.y,d=l+t/2,f=u+r/2,h=d-i/2,v=f-o/2,y=d+i/2,x=f+o/2,w=Array.from(a),_=0;_<w.length;_++){var b=w[_],E=this.lf.getNodeModelById(b);if(E){var k=E.getBounds(),O=k.minX,N=k.minY,I=k.maxX,T=k.maxY,L=h<=O&&v<=N&&y>=I&&x>=T;if(!L)return!1}}return!0},n.prototype.init=function(){var e=this,t=this.lf,r=t.graphModel;r.addNodeMoveRules(function(i,o,a){if(i.isGroup)return!0;var l=e.nodeGroupMap.get(i.id),u=e.lf.getNodeModelById(l);if(u&&u.isRestrict){if(u.autoResize)return!0;var d=u.getBounds();return FF(d,i,o,a)}return!0}),r.addNodeResizeRules(function(i,o,a,l,u){return i.isGroup&&i.isRestrict?e.checkGroupBoundsWithChildren(i,o,a,l,u):!0}),r.dynamicGroup=this,t.on("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),t.on("selection:drop",this.onSelectionDrop),t.on("node:delete",this.removeNodeFromGroup),t.on("node:drag,node:dnd-drag",this.onNodeDrag),t.on("selection:drag",this.onSelectionDrag),t.on("node:click",this.onNodeSelect),t.on("node:mousemove",this.onNodeMove),t.on("graph:rendered",this.onGraphRendered),t.on("group:add-node",this.onGroupAddNode),t.addElements=function(i,o){var a=i.nodes,l=i.edges;o===void 0&&(o=40);var u={},d={nodes:[],edges:[]},f=[];return zt(a,function(h){var v,y,x=h.id,w=(y=(v=h.properties)===null||v===void 0?void 0:v.children)!==null&&y!==void 0?y:h.children,_=t.addNode(e.removeChildrenInGroupNodeData(h));if(x&&(u[x]=_.id),d.nodes.push(_),_.isGroup){var b=e.initGroupChildNodes(u,w,_,o).edgesData;f.push.apply(f,Ka([],Ya(b),!1))}}),zt(f,function(h){e.createEdge(h,u,o)}),zt(l,function(h){d.edges.push(e.createEdge(h,u,o))}),d},this.render()},n.prototype.render=function(){},n.prototype.destroy=function(){this.lf.off("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),this.lf.off("selection:drop",this.onSelectionDrop),this.lf.off("node:delete",this.removeNodeFromGroup),this.lf.off("node:drag,node:dnd-drag",this.onNodeDrag),this.lf.off("selection:drag",this.onSelectionDrag),this.lf.off("node:click",this.onNodeSelect),this.lf.off("node:mousemove",this.onNodeMove),this.lf.off("graph:rendered",this.onGraphRendered),this.lf.off("group:add-node",this.onGroupAddNode)},n.pluginName="dynamicGroup",n}(),P0;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(P0||(P0={}));var VF=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Tl=function(){return Tl=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Tl.apply(this,arguments)},WF=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},GF=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},qF=function(n){VF(e,n);function e(t){var r=n.call(this,t)||this;r.textRef=Ac(),r.setHoverOn=function(){var u=r.props.element;u.isDragging||r.state.isHovered||(r.setState({isHovered:!0}),u.setHovered(!0))},r.setHoverOff=function(){var u=r.props.element;r.state.isHovered&&(r.setState({isHovered:!1}),u.setHovered(!1))},r.handleMouseDown=function(u){var d,f=r.props,h=f.label,v=f.graphModel,y=v.editConfigModel.nodeTextDraggable;((d=h.draggable)!==null&&d!==void 0?d:y)&&!r.state.isDragging&&!r.state.isEditing&&r.stepDrag.handleMouseDown(u)},r.handleMouseUp=function(u){r.state.isDragging&&r.stepDrag.handleMouseUp(u)},r.handleDragging=function(u){var d=u.deltaX,f=u.deltaY;r.state.isDragging||r.setState({isDragging:!0});var h=r.props,v=h.label,y=h.graphModel,x=y.transformModel,w=GF(x.fixDeltaXY(d,f),2),_=w[0],b=w[1];r.setElementModelLabelInfo({x:v.x+_,y:v.y+b}),y.eventCenter.emit("label:drag",{data:v.getData(),model:v})},r.handleDragEnd=function(){r.setState({isDragging:!1})},r.handleClick=function(u){var d=r.props,f=d.label,h=d.element,v=d.graphModel;h.setSelected(!r.state.isSelected),r.setState({isSelected:!r.state.isSelected}),r.setElementModelLabelInfo({isSelected:!0}),v.eventCenter.emit("label:click",{data:f.getData(),e:u,model:h})},r.handleDbClick=function(u){var d=r.props,f=d.label,h=d.element,v=d.graphModel;if(v.eventCenter.emit("label:dblclick",{data:f.getData(),e:u,model:h}),!f.editable){h.setSelected(!0);return}if(h.setSelected(),h.setElementState(tn.TEXT_EDIT),r.setState({isEditing:!0}),r.textRef.current){r.textRef.current.contentEditable="true",r.textRef.current.focus();var y=document.createRange(),x=window.getSelection();y.selectNodeContents(r.textRef.current),y.collapse(!1),x==null||x.removeAllRanges(),x==null||x.addRange(y)}},r.handleBlur=function(u){var d=r.props,f=d.label,h=d.element,v=d.graphModel.eventCenter;v.emit("label:blur",{e:u,model:h,data:f.getData(),element:r.textRef.current}),r.setState({isDragging:!1,isHovered:!1,isSelected:!1})},r.handleInput=function(u){var d=r.props,f=d.label,h=d.graphModel;h.eventCenter.emit("label:input",{e:u,data:f.getData()})},r.reCalcLabelSize=function(){};var i=t.label,o=t.graphModel,a=o.gridSize,l=o.eventCenter;return r.stepDrag=new fi({onDragging:r.handleDragging,onDragEnd:r.handleDragEnd,step:a,eventType:"LABEL",model:i,eventCenter:l}),r.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},r}return e.prototype.setElementModelLabelInfo=function(t){var r=this.props,i=r.label,o=r.element,a=r.graphModel,l=o.properties._label,u=l,d=Y2(u,function(v){return v.id===i.id}),f=u[d];u[d]=Tl(Tl({},f),t);var h=a.getElement(o.id);h==null||h.setProperty("_label",u)},e.prototype.componentDidMount=function(){var t=this,r=this.props,i=r.label,o=r.element,a=r.graphModel;a.eventCenter.on("blank:click,node:click,edge:click,label:click",function(l){var u,d,f,h,v=l.data;if(((v==null?void 0:v.type)!=="label"||v.type==="label"&&v.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((v==null?void 0:v.type)!=="label"||v.type=="label"&&v.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var y=(d=(u=t.textRef.current)===null||u===void 0?void 0:u.innerText)!==null&&d!==void 0?d:"",x=(h=(f=t.textRef.current)===null||f===void 0?void 0:f.innerHTML)!==null&&h!==void 0?h:"";t.setElementModelLabelInfo({value:y,content:x,isSelected:!1}),o.setElementState(tn.DEFAULT)}((v==null?void 0:v.type)!=="label"||v.type=="label"&&v.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,r=this.props,i=r.label,o=r.element,a=r.graphModel,l=this.state,u=l.isDragging,d=l.isHovered,f=l.isSelected,h=l.isEditing,v=a.transformModel,y=v.getTransformStyle().transform,x=i.id,w=i.x,_=i.y,b=i.zIndex,E=i.vertical,k=i.style,O=i.rotate,N=i.content,I=i.labelWidth,T=i.textOverflowMode,L=I??(o.BaseType==="node"?o.width-20:80),H={left:"".concat(w-L/2,"px"),top:"".concat(_-10,"px"),width:"".concat(L,"px"),height:"20px",zIndex:b??1,transform:O?"".concat(y," rotate(").concat(O,"deg)"):"".concat(y," rotate(").concat(E?-.25:0,"turn)")};return He("div",{id:"element-container-".concat(x),className:hv("lf-label-editor-container"),style:H,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:He("div",{ref:this.textRef,id:"editor-container-".concat(x),className:hv("lf-label-editor",(t={"lf-label-editor-dragging":u,"lf-label-editor-editing":h,"lf-label-editor-hover":!h&&(d||f)},t["lf-label-editor-".concat(T)]=!h,t)),onInput:this.handleInput,style:Tl({maxWidth:"".concat(L,"px"),boxSizing:"border-box",display:"inline-block",background:h||o.BaseType==="edge"?"#fff":"transparent"},k),dangerouslySetInnerHTML:{__html:N}})})},e=WF([Cr],e),e}(Zt),ii=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},XF=Ao,YF=function(){function n(e,t,r){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=r,this.id=(i=e.id)!==null&&i!==void 0?i:XF(),this.initLabelData(e)}return n.prototype.initLabelData=function(e){on(this,e)},n.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:wi(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},ii([$e],n.prototype,"x",void 0),ii([$e],n.prototype,"y",void 0),ii([$e],n.prototype,"content",void 0),ii([$e],n.prototype,"value",void 0),ii([$e],n.prototype,"rotate",void 0),ii([$e],n.prototype,"style",void 0),ii([$e],n.prototype,"zIndex",void 0),ii([$e],n.prototype,"vertical",void 0),ii([$e],n.prototype,"editable",void 0),ii([$e],n.prototype,"draggable",void 0),ii([$e],n.prototype,"labelWidth",void 0),ii([$e],n.prototype,"textOverflowMode",void 0),n}(),_d={exports:{}},oh=_d.exports,R0;function KF(){return R0||(R0=1,function(n){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||function(e){if("Element"in e){var t="classList",r="prototype",i=e.Element[r],o=Object,a=String[r].trim||function(){return this.replace(/^\s+|\s+$/g,"")},l=Array[r].indexOf||function(x){for(var w=0,_=this.length;w<_;w++)if(w in this&&this[w]===x)return w;return-1},u=function(x,w){this.name=x,this.code=DOMException[x],this.message=w},d=function(x,w){if(w==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(w))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return l.call(x,w)},f=function(x){for(var w=a.call(x.getAttribute("class")||""),_=w?w.split(/\s+/):[],b=0,E=_.length;b<E;b++)this.push(_[b]);this._updateClassName=function(){x.setAttribute("class",this.toString())}},h=f[r]=[],v=function(){return new f(this)};if(u[r]=Error[r],h.item=function(x){return this[x]||null},h.contains=function(x){return x+="",d(this,x)!==-1},h.add=function(){var x=arguments,w=0,_=x.length,b,E=!1;do b=x[w]+"",d(this,b)===-1&&(this.push(b),E=!0);while(++w<_);E&&this._updateClassName()},h.remove=function(){var x=arguments,w=0,_=x.length,b,E=!1,k;do for(b=x[w]+"",k=d(this,b);k!==-1;)this.splice(k,1),E=!0,k=d(this,b);while(++w<_);E&&this._updateClassName()},h.toggle=function(x,w){x+="";var _=this.contains(x),b=_?w!==!0&&"remove":w!==!1&&"add";return b&&this[b](x),w===!0||w===!1?w:!_},h.toString=function(){return this.join(" ")},o.defineProperty){var y={get:v,enumerable:!0,configurable:!0};try{o.defineProperty(i,t,y)}catch(x){x.number===-2146823252&&(y.enumerable=!1,o.defineProperty(i,t,y))}}else o[r].__defineGetter__&&i.__defineGetter__(t,v)}}(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(i){var o=function(T){return Object.prototype.toString.call(T).match(/^\[object\s(.*)\]$/)[1]},a=function(){this.data=[]},l=function(L,H,X){this.data=L,this.size=L.length,this.type=H,this.encoding=X},u=a.prototype,d=l.prototype,f=i.FileReaderSync,h=function(T){this.code=this[this.name=T]},v="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),y=v.length,x=i.URL||i.webkitURL||i,w=x.createObjectURL,_=x.revokeObjectURL,b=x,E=i.btoa,k=i.atob,O=i.ArrayBuffer,N=i.Uint8Array,I=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(l.fake=d.fake=!0;y--;)h.prototype[v[y]]=y+1;return x.createObjectURL||(b=i.URL=function(T){var L=document.createElementNS("http://www.w3.org/1999/xhtml","a"),H;return L.href=T,"origin"in L||(L.protocol.toLowerCase()==="data:"?L.origin=null:(H=T.match(I),L.origin=H&&H[1])),L}),b.createObjectURL=function(T){var L=T.type,H;if(L===null&&(L="application/octet-stream"),T instanceof l)return H="data:"+L,T.encoding==="base64"?H+";base64,"+T.data:T.encoding==="URI"?H+","+decodeURIComponent(T.data):E?H+";base64,"+E(T.data):H+","+encodeURIComponent(T.data);if(w)return w.call(x,T)},b.revokeObjectURL=function(T){T.substring(0,5)!=="data:"&&_&&_.call(x,T)},u.append=function(T){var L=this.data;if(N&&(T instanceof O||T instanceof N)){for(var H="",X=new N(T),V=0,q=X.length;V<q;V++)H+=String.fromCharCode(X[V]);L.push(H)}else if(o(T)==="Blob"||o(T)==="File")if(f){var D=new f;L.push(D.readAsBinaryString(T))}else throw new h("NOT_READABLE_ERR");else T instanceof l?T.encoding==="base64"&&k?L.push(k(T.data)):T.encoding==="URI"?L.push(decodeURIComponent(T.data)):T.encoding==="raw"&&L.push(T.data):(typeof T!="string"&&(T+=""),L.push(unescape(encodeURIComponent(T))))},u.getBlob=function(T){return arguments.length||(T=null),new l(this.data.join(""),T,"raw")},u.toString=function(){return"[object BlobBuilder]"},d.slice=function(T,L,H){var X=arguments.length;return X<3&&(H=null),new l(this.data.slice(T,X>1?L:this.data.length),H,this.encoding)},d.toString=function(){return"[object Blob]"},d.close=function(){this.size=0,delete this.data},a}(e);e.Blob=function(i,o){var a=o&&o.type||"",l=new t;if(i)for(var u=0,d=i.length;u<d;u++)Uint8Array&&i[u]instanceof Uint8Array?l.append(i[u].buffer):l.append(i[u]);var f=l.getBlob(a);return!f.slice&&f.webkitSlice&&(f.slice=f.webkitSlice),f};var r=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=r(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||oh.content||oh),function(e,t){var r=typeof process<"u"&&process&&process.versions&&process.versions.electron;r?e.MediumEditor=t:n.exports=t}(oh,function(){function e(t,r){return this.init(t,r)}return e.extensions={},function(t){function r(u,d){var f,h=Array.prototype.slice.call(arguments,2);d=d||{};for(var v=0;v<h.length;v++){var y=h[v];if(y)for(f in y)y.hasOwnProperty(f)&&typeof y[f]<"u"&&(u||d.hasOwnProperty(f)===!1)&&(d[f]=y[f])}return d}var i=!1;try{var o=document.createElement("div"),a=document.createTextNode(" ");o.appendChild(a),i=o.contains(a)}catch{}var l={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(u){return!!(l.isMac&&u.metaKey||!l.isMac&&u.ctrlKey)},isKey:function(u,d){var f=l.getKeyCode(u);return Array.isArray(d)===!1?f===d:d.indexOf(f)!==-1},getKeyCode:function(u){var d=u.which;return d===null&&(d=u.charCode!==null?u.charCode:u.keyCode),d},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var d=[!0].concat(Array.prototype.slice.call(arguments));return r.apply(this,d)},defaults:function(){var d=[!1].concat(Array.prototype.slice.call(arguments));return r.apply(this,d)},createLink:function(u,d,f,h){var v=u.createElement("a");return l.moveTextRangeIntoElement(d[0],d[d.length-1],v),v.setAttribute("href",f),h&&(h==="_blank"&&v.setAttribute("rel","noopener noreferrer"),v.setAttribute("target",h)),v},findOrCreateMatchingTextNodes:function(u,d,f){for(var h=u.createTreeWalker(d,NodeFilter.SHOW_ALL,null,!1),v=[],y=0,x=!1,w=null,_=null;(w=h.nextNode())!==null;)if(!(w.nodeType>3))if(w.nodeType===3){if(!x&&f.start<y+w.nodeValue.length&&(x=!0,_=l.splitStartNodeIfNeeded(w,f.start,y)),x&&l.splitEndNodeIfNeeded(w,_,f.end,y),x&&y===f.end)break;if(x&&y>f.end+1)throw new Error("PerformLinking overshot the target!");x&&v.push(_||w),y+=w.nodeValue.length,_!==null&&(y+=_.nodeValue.length,h.nextNode()),_=null}else w.tagName.toLowerCase()==="img"&&(!x&&f.start<=y&&(x=!0),x&&v.push(w));return v},splitStartNodeIfNeeded:function(u,d,f){return d!==f?u.splitText(d-f):null},splitEndNodeIfNeeded:function(u,d,f,h){var v,y;v=h+u.nodeValue.length+(d?d.nodeValue.length:0)-1,y=f-h-(d?u.nodeValue.length:0),v>=f&&h!==v&&y!==0&&(d||u).splitText(y)},splitByBlockElements:function(u){if(u.nodeType!==3&&u.nodeType!==1)return[];var d=[],f=e.util.blockContainerElementNames.join(",");if(u.nodeType===3||u.querySelectorAll(f).length===0)return[u];for(var h=0;h<u.childNodes.length;h++){var v=u.childNodes[h];if(v.nodeType===3)d.push(v);else if(v.nodeType===1){var y=v.querySelectorAll(f);y.length===0?d.push(v):d=d.concat(e.util.splitByBlockElements(v))}}return d},findAdjacentTextNodeWithContent:function(d,f,h){var v=!1,y,x=h.createNodeIterator(d,NodeFilter.SHOW_TEXT,null,!1);for(y=x.nextNode();y;){if(y===f)v=!0;else if(v&&y.nodeType===3&&y.nodeValue&&y.nodeValue.trim().length>0)break;y=x.nextNode()}return y},findPreviousSibling:function(u){if(!u||l.isMediumEditorElement(u))return!1;for(var d=u.previousSibling;!d&&!l.isMediumEditorElement(u.parentNode);)u=u.parentNode,d=u.previousSibling;return d},isDescendant:function(d,f,h){if(!d||!f)return!1;if(d===f)return!!h;if(d.nodeType!==1)return!1;if(i||f.nodeType!==3)return d.contains(f);for(var v=f.parentNode;v!==null;){if(v===d)return!0;v=v.parentNode}return!1},isElement:function(d){return!!(d&&d.nodeType===1)},throttle:function(u,d){var f=50,h,v,y,x=null,w=0,_=function(){w=Date.now(),x=null,y=u.apply(h,v),x||(h=v=null)};return!d&&d!==0&&(d=f),function(){var b=Date.now(),E=d-(b-w);return h=this,v=arguments,E<=0||E>d?(x&&(clearTimeout(x),x=null),w=b,y=u.apply(h,v),x||(h=v=null)):x||(x=setTimeout(_,E)),y}},traverseUp:function(u,d){if(!u)return!1;do{if(u.nodeType===1){if(d(u))return u;if(l.isMediumEditorElement(u))return!1}u=u.parentNode}while(u);return!1},htmlEntities:function(u){return String(u).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(u,d){var f,h,v,y,x,w,_,b=!1,E=["insertHTML",!1,d];if(!e.util.isEdge&&u.queryCommandSupported("insertHTML"))try{return u.execCommand.apply(u,E)}catch{}if(f=u.getSelection(),f.rangeCount){if(h=f.getRangeAt(0),_=h.commonAncestorContainer,l.isMediumEditorElement(_)&&!_.firstChild)h.selectNode(_.appendChild(u.createTextNode("")));else if(_.nodeType===3&&h.startOffset===0&&h.endOffset===_.nodeValue.length||_.nodeType!==3&&_.innerHTML===h.toString()){for(;!l.isMediumEditorElement(_)&&_.parentNode&&_.parentNode.childNodes.length===1&&!l.isMediumEditorElement(_.parentNode);)_=_.parentNode;h.selectNode(_)}for(h.deleteContents(),v=u.createElement("div"),v.innerHTML=d,y=u.createDocumentFragment();v.firstChild;)x=v.firstChild,w=y.appendChild(x);h.insertNode(y),w&&(h=h.cloneRange(),h.setStartAfter(w),h.collapse(!0),e.selection.selectRange(u,h)),b=!0}return u.execCommand.callListeners&&u.execCommand.callListeners(E,b),b},execFormatBlock:function(u,d){var f=l.getTopBlockContainer(e.selection.getSelectionStart(u)),h;if(d==="blockquote"){if(f&&(h=Array.prototype.slice.call(f.childNodes),h.some(function(v){return l.isBlockContainer(v)})))return u.execCommand("outdent",!1,null);if(l.isIE)return u.execCommand("indent",!1,d)}if(f&&d===f.nodeName.toLowerCase()&&(d="p"),l.isIE&&(d="<"+d+">"),f&&f.nodeName.toLowerCase()==="blockquote"){if(l.isIE&&d==="<p>")return u.execCommand("outdent",!1,d);if((l.isFF||l.isEdge)&&d==="p")return h=Array.prototype.slice.call(f.childNodes),h.some(function(v){return!l.isBlockContainer(v)})&&u.execCommand("formatBlock",!1,d),u.execCommand("outdent",!1,d)}return u.execCommand("formatBlock",!1,d)},setTargetBlank:function(u,d){var f,h=d||!1;if(u.nodeName.toLowerCase()==="a")u.target="_blank",u.rel="noopener noreferrer";else for(u=u.getElementsByTagName("a"),f=0;f<u.length;f+=1)(h===!1||h===u[f].attributes.href.value)&&(u[f].target="_blank",u[f].rel="noopener noreferrer")},removeTargetBlank:function(u,d){var f;if(u.nodeName.toLowerCase()==="a")u.removeAttribute("target"),u.removeAttribute("rel");else for(u=u.getElementsByTagName("a"),f=0;f<u.length;f+=1)d===u[f].attributes.href.value&&(u[f].removeAttribute("target"),u[f].removeAttribute("rel"))},addClassToAnchors:function(u,d){var f=d.split(" "),h,v;if(u.nodeName.toLowerCase()==="a")for(v=0;v<f.length;v+=1)u.classList.add(f[v]);else{var y=u.getElementsByTagName("a");if(y.length===0){var x=l.getClosestTag(u,"a");u=x?[x]:[]}else u=y;for(h=0;h<u.length;h+=1)for(v=0;v<f.length;v+=1)u[h].classList.add(f[v])}},isListItem:function(u){if(!u)return!1;if(u.nodeName.toLowerCase()==="li")return!0;for(var d=u.parentNode,f=d.nodeName.toLowerCase();f==="li"||!l.isBlockContainer(d)&&f!=="div";){if(f==="li")return!0;if(d=d.parentNode,d)f=d.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(u,d){if(d.nodeName.toLowerCase()==="li"){var f=d.parentElement;f.parentElement.nodeName.toLowerCase()==="p"&&(l.unwrap(f.parentElement,u),e.selection.moveCursor(u,d.firstChild,d.firstChild.textContent.length))}},splitOffDOMTree:function(u,d,f){for(var h=d,v=null,y=!f;h!==u;){var x=h.parentNode,w=x.cloneNode(!1),_=y?h:x.firstChild,b;for(v&&(y?w.appendChild(v):b=v),v=w;_;){var E=_.nextSibling;_===h?(_.hasChildNodes()?_=_.cloneNode(!1):_.parentNode.removeChild(_),_.textContent&&v.appendChild(_),_=y?E:null):(_.parentNode.removeChild(_),(_.hasChildNodes()||_.textContent)&&v.appendChild(_),_=E)}b&&v.appendChild(b),h=x}return v},moveTextRangeIntoElement:function(u,d,f){if(!u||!d)return!1;var h=l.findCommonRoot(u,d);if(!h)return!1;if(d===u){var v=u.parentNode,y=u.nextSibling;return v.removeChild(u),f.appendChild(u),y?v.insertBefore(f,y):v.appendChild(f),f.hasChildNodes()}for(var x=[],w,_,b,E=0;E<h.childNodes.length;E++)if(b=h.childNodes[E],!w)l.isDescendant(b,u,!0)&&(w=b);else if(l.isDescendant(b,d,!0)){_=b;break}else x.push(b);var k=_.nextSibling,O=h.ownerDocument.createDocumentFragment();return w===u?(w.parentNode.removeChild(w),O.appendChild(w)):O.appendChild(l.splitOffDOMTree(w,u)),x.forEach(function(N){N.parentNode.removeChild(N),O.appendChild(N)}),_===d?(_.parentNode.removeChild(_),O.appendChild(_)):O.appendChild(l.splitOffDOMTree(_,d,!0)),f.appendChild(O),_.parentNode===h?h.insertBefore(f,_):k?h.insertBefore(f,k):h.appendChild(f),f.hasChildNodes()},depthOfNode:function(u){for(var d=0,f=u;f.parentNode!==null;)f=f.parentNode,d++;return d},findCommonRoot:function(u,d){for(var f=l.depthOfNode(u),h=l.depthOfNode(d),v=u,y=d;f!==h;)f>h?(v=v.parentNode,f-=1):(y=y.parentNode,h-=1);for(;v!==y;)v=v.parentNode,y=y.parentNode;return v},isElementAtBeginningOfBlock:function(u){for(var d,f;!l.isBlockContainer(u)&&!l.isMediumEditorElement(u);){for(f=u;f=f.previousSibling;)if(d=f.nodeType===3?f.nodeValue:f.textContent,d.length>0)return!1;u=u.parentNode}return!0},isMediumEditorElement:function(u){return u&&u.getAttribute&&!!u.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(u){return l.traverseUp(u,function(d){return l.isMediumEditorElement(d)})},isBlockContainer:function(u){return u&&u.nodeType!==3&&l.blockContainerElementNames.indexOf(u.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(u){return l.traverseUp(u,function(d){return l.isBlockContainer(d)||l.isMediumEditorElement(d)})},getTopBlockContainer:function(u){var d=l.isBlockContainer(u)?u:!1;return l.traverseUp(u,function(f){return l.isBlockContainer(f)&&(d=f),!d&&l.isMediumEditorElement(f)?(d=f,!0):!1}),d},getFirstSelectableLeafNode:function(u){for(;u&&u.firstChild;)u=u.firstChild;if(u=l.traverseUp(u,function(f){return l.emptyElementNames.indexOf(f.nodeName.toLowerCase())===-1}),u.nodeName.toLowerCase()==="table"){var d=u.querySelector("th, td");d&&(u=d)}return u},getFirstTextNode:function(u){return l.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),l._getFirstTextNode(u)},_getFirstTextNode:function(u){if(u.nodeType===3)return u;for(var d=0;d<u.childNodes.length;d++){var f=l._getFirstTextNode(u.childNodes[d]);if(f!==null)return f}return null},ensureUrlHasProtocol:function(u){return u.indexOf("://")===-1?"http://"+u:u},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(u,d,f){var h=u+" is deprecated, please use "+d+" instead.";f&&(h+=" Will be removed in "+f),l.warn(h)},deprecatedMethod:function(u,d,f,h){l.deprecated(u,d,h),typeof this[d]=="function"&&this[d].apply(this,f)},cleanupAttrs:function(u,d){d.forEach(function(f){u.removeAttribute(f)})},cleanupTags:function(u,d){d.indexOf(u.nodeName.toLowerCase())!==-1&&u.parentNode.removeChild(u)},unwrapTags:function(u,d){d.indexOf(u.nodeName.toLowerCase())!==-1&&e.util.unwrap(u,document)},getClosestTag:function(u,d){return l.traverseUp(u,function(f){return f.nodeName.toLowerCase()===d.toLowerCase()})},unwrap:function(u,d){for(var f=d.createDocumentFragment(),h=Array.prototype.slice.call(u.childNodes),v=0;v<h.length;v++)f.appendChild(h[v]);f.childNodes.length?u.parentNode.replaceChild(f,u):u.parentNode.removeChild(u)},guid:function(){function u(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return u()+u()+"-"+u()+"-"+u()+"-"+u()+"-"+u()+u()+u()}};e.util=l}(window),function(){var t=function(r){e.util.extend(this,r)};t.extend=function(r){var i=this,o;r&&r.hasOwnProperty("constructor")?o=r.constructor:o=function(){return i.apply(this,arguments)},e.util.extend(o,i);var a=function(){this.constructor=o};return a.prototype=i.prototype,o.prototype=new a,r&&e.util.extend(o.prototype,r),o},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(r){return this.base.options[r]}},["execAction","on","off","subscribe","trigger"].forEach(function(r){t.prototype[r]=function(){return this.base[r].apply(this.base,arguments)}}),e.Extension=t}(),function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var r={findMatchingSelectionParent:function(i,o){var a=o.getSelection(),l,u;return a.rangeCount===0?!1:(l=a.getRangeAt(0),u=l.commonAncestorContainer,e.util.traverseUp(u,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(o){return e.util.isMediumEditorElement(o)},i)},exportSelection:function(i,o){if(!i)return null;var a=null,l=o.getSelection();if(l.rangeCount>0){var u=l.getRangeAt(0),d=u.cloneRange(),f;d.selectNodeContents(i),d.setEnd(u.startContainer,u.startOffset),f=d.toString().length,a={start:f,end:f+u.toString().length},this.doesRangeStartWithImages(u,o)&&(a.startsWithImage=!0);var h=this.getTrailingImageCount(i,a,u.endContainer,u.endOffset);if(h&&(a.trailingImageCount=h),f!==0){var v=this.getIndexRelativeToAdjacentEmptyBlocks(o,i,u.startContainer,u.startOffset);v!==-1&&(a.emptyBlocksIndex=v)}}return a},importSelection:function(i,o,a,l){if(!(!i||!o)){var u=a.createRange();u.setStart(o,0),u.collapse(!0);var d=o,f=[],h=0,v=!1,y=!1,x=0,w=!1,_,b=!1,E=null;for((l||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(b=!0);!w&&d;){if(d.nodeType>3){d=f.pop();continue}if(d.nodeType===3&&!y)_=h+d.length,!v&&i.start>=h&&i.start<=_&&(b||i.start<_?(u.setStart(d,i.start-h),v=!0):E=d),v&&i.end>=h&&i.end<=_&&(i.trailingImageCount?y=!0:(u.setEnd(d,i.end-h),w=!0)),h=_;else{if(i.trailingImageCount&&y&&(d.nodeName.toLowerCase()==="img"&&x++,x===i.trailingImageCount)){for(var k=0;d.parentNode.childNodes[k]!==d;)k++;u.setEnd(d.parentNode,k+1),w=!0}if(!w&&d.nodeType===1)for(var O=d.childNodes.length-1;O>=0;)f.push(d.childNodes[O]),O-=1}w||(d=f.pop())}!v&&E&&(u.setStart(E,E.length),u.setEnd(E,E.length)),typeof i.emptyBlocksIndex<"u"&&(u=this.importSelectionMoveCursorPastBlocks(a,o,i.emptyBlocksIndex,u)),l&&(u=this.importSelectionMoveCursorPastAnchor(i,u)),this.selectRange(a,u)}},importSelectionMoveCursorPastAnchor:function(i,o){var a=function(h){return h.nodeName.toLowerCase()==="a"};if(i.start===i.end&&o.startContainer.nodeType===3&&o.startOffset===o.startContainer.nodeValue.length&&e.util.traverseUp(o.startContainer,a)){for(var l=o.startContainer,u=o.startContainer.parentNode;u!==null&&u.nodeName.toLowerCase()!=="a";)u.childNodes[u.childNodes.length-1]!==l?u=null:(l=u,u=u.parentNode);if(u!==null&&u.nodeName.toLowerCase()==="a"){for(var d=null,f=0;d===null&&f<u.parentNode.childNodes.length;f++)u.parentNode.childNodes[f]===u&&(d=f);o.setStart(u.parentNode,d+1),o.collapse(!0)}}return o},importSelectionMoveCursorPastBlocks:function(i,o,a,l){var u=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),d=l.startContainer,f,h,v=0;for(a=a||1,d.nodeType===3&&e.util.isBlockContainer(d.previousSibling)?f=d.previousSibling:f=e.util.getClosestBlockContainer(d);u.nextNode();)if(!h)f===u.currentNode&&(h=u.currentNode);else if(h=u.currentNode,v++,v===a||h.textContent.length>0)break;return h||(h=f),l.setStart(e.util.getFirstSelectableLeafNode(h),0),l},getIndexRelativeToAdjacentEmptyBlocks:function(i,o,a,l){if(a.textContent.length>0&&l>0)return-1;var u=a;if(u.nodeType!==3&&(u=a.childNodes[l]),u){if(!e.util.isElementAtBeginningOfBlock(u))return-1;var d=e.util.findPreviousSibling(u);if(d){if(d.nodeValue)return-1}else return-1}for(var f=e.util.getClosestBlockContainer(a),h=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),v=0;h.nextNode();){var y=h.currentNode.textContent==="";if((y||v>0)&&(v+=1),h.currentNode===f)return v;y||(v=0)}return v},doesRangeStartWithImages:function(i,o){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var a=i.startContainer.querySelector("img");if(!a)return!1;for(var l=o.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);l.nextNode();){var u=l.currentNode;if(u===a)break;if(u.nodeValue)return!1}return!0},getTrailingImageCount:function(i,o,a,l){if(l===0||a.nodeType!==1||a.nodeName.toLowerCase()!=="img"&&!a.querySelector("img"))return 0;for(var u=a.childNodes[l-1];u.hasChildNodes();)u=u.lastChild;for(var d=i,f=[],h=0,v=!1,y=!1,x=!1,w,_=0;!x&&d;){if(d.nodeType>3){d=f.pop();continue}if(d.nodeType===3&&!y)_=0,w=h+d.length,!v&&o.start>=h&&o.start<=w&&(v=!0),v&&o.end>=h&&o.end<=w&&(y=!0),h=w;else if(d.nodeName.toLowerCase()==="img"&&_++,d===u)x=!0;else if(d.nodeType===1)for(var b=d.childNodes.length-1;b>=0;)f.push(d.childNodes[b]),b-=1;x||(d=f.pop())}return _},selectionContainsContent:function(i){var o=i.getSelection();if(!o||o.isCollapsed||!o.rangeCount)return!1;if(o.toString().trim()!=="")return!0;var a=this.getSelectedParentElement(o.getRangeAt(0));return!!(a&&(a.nodeName.toLowerCase()==="img"||a.nodeType===1&&a.querySelector("img")))},selectionInContentEditableFalse:function(i){var o,a=this.findMatchingSelectionParent(function(l){var u=l&&l.getAttribute("contenteditable");return u==="true"&&(o=!0),l.nodeName!=="#text"&&u==="false"},i);return!o&&a},getSelectionHtml:function(o){var a,l="",u=o.getSelection(),d,f;if(u.rangeCount){for(f=o.createElement("div"),a=0,d=u.rangeCount;a<d;a+=1)f.appendChild(u.getRangeAt(a).cloneContents());l=f.innerHTML}return l},getCaretOffsets:function(o,a){var l,u;return a||(a=window.getSelection().getRangeAt(0)),l=a.cloneRange(),u=a.cloneRange(),l.selectNodeContents(o),l.setEnd(a.endContainer,a.endOffset),u.selectNodeContents(o),u.setStart(a.endContainer,a.endOffset),{left:l.toString().length,right:u.toString().length}},rangeSelectsSingleNode:function(i){var o=i.startContainer;return o===i.endContainer&&o.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var o=i.getSelection(),a,l,u;if(!o.rangeCount||o.isCollapsed||!o.getRangeAt(0).commonAncestorContainer)return[];if(a=o.getRangeAt(0),a.commonAncestorContainer.nodeType===3){for(l=[],u=a.commonAncestorContainer;u.parentNode&&u.parentNode.childNodes.length===1;)l.push(u.parentNode),u=u.parentNode;return l}return[].filter.call(a.commonAncestorContainer.getElementsByTagName("*"),function(d){return typeof o.containsNode=="function"?o.containsNode(d,!0):!0})},selectNode:function(i,o){var a=o.createRange();a.selectNodeContents(i),this.selectRange(o,a)},select:function(i,o,a,l,u){var d=i.createRange();return d.setStart(o,a),l?d.setEnd(l,u):d.collapse(!0),this.selectRange(i,d),d},clearSelection:function(i,o){o?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,o,a){this.select(i,o,a)},getSelectionRange:function(i){var o=i.getSelection();return o.rangeCount===0?null:o.getRangeAt(0)},selectRange:function(i,o){var a=i.getSelection();a.removeAllRanges(),a.addRange(o)},getSelectionStart:function(i){var o=i.getSelection().anchorNode,a=o&&o.nodeType===3?o.parentNode:o;return a}};e.selection=r}(),function(){function t(i,o){return i?i.some(function(a){if(typeof a.getInteractionElements!="function")return!1;var l=a.getInteractionElements();return l?(Array.isArray(l)||(l=[l]),l.some(function(u){return e.util.isDescendant(u,o,!0)})):!1}):!1}var r=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};r.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,o,a,l){var u=this.base.options.contentWindow,d=this.base.options.ownerDocument;i=e.util.isElement(i)||[u,d].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(f){f.addEventListener(o,a,l),this.events.push([f,o,a,l])}).bind(this))},detachDOMEvent:function(i,o,a,l){var u,d,f=this.base.options.contentWindow,h=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[f,h].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(v){u=this.indexOfListener(v,o,a,l),u!==-1&&(d=this.events.splice(u,1)[0],d[0].removeEventListener(d[1],d[2],d[3]))}).bind(this)))},indexOfListener:function(i,o,a,l){var u,d,f;for(u=0,d=this.events.length;u<d;u=u+1)if(f=this.events[u],f[0]===i&&f[1]===o&&f[2]===a&&f[3]===l)return u;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var o=this.events.filter(function(d){return d&&d[0].getAttribute&&d[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),a=0,l=o.length;a<l;a++){var u=o[a];this.detachDOMEvent(u[0],u[1],u[2],u[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(o){this.attachDOMEvent(i,o.name,o.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,o){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(o)},detachCustomEvent:function(i,o){var a=this.indexOfCustomListener(i,o);a!==-1&&this.customEvents[i].splice(a,1)},indexOfCustomListener:function(i,o){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(o)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,o,a){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(l){l(o,a)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var o=i.execCommand.listeners.indexOf(this.execCommandListener);o!==-1&&i.execCommand.listeners.splice(o,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var o=function(l,u){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(d){d({command:l[0],value:l[2],args:l,result:u})})},a=function(){var l=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return l;var u=Array.prototype.slice.call(arguments);return o(u,l),l};a.orig=i.execCommand,a.listeners=[],a.callListeners=o,i.execCommand=a}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(o){this.contentCache[o.getAttribute("medium-editor-index")]=o.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,o){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(a){this.attachDOMEvent(a,i,o.bind(this))},this),this.eventsCache.push({name:i,handler:o})},cleanupElement:function(i){var o=i.getAttribute("medium-editor-index");o&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[o])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,o){var a=this.base.getFocusedElement(),l;a&&o.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(a,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(l=a),l||this.base.elements.some(function(d){return!l&&e.util.isDescendant(d,i,!0)&&(l=d),!!l},this);var u=!e.util.isDescendant(a,i,!0)&&!t(this.base.extensions,i);l!==a&&(a&&u&&(a.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",o,a)),l&&(l.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",o,l))),u&&this.triggerCustomEvent("externalInteraction",o)},updateInput:function(i,o){if(this.contentCache){var a=i.getAttribute("medium-editor-index"),l=i.innerHTML;l!==this.contentCache[a]&&this.triggerCustomEvent("editableInput",o,i),this.contentCache[a]=l}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var o=i.currentTarget.activeElement,a;this.base.elements.some(function(l){return e.util.isDescendant(l,o,!0)?(a=l,!0):!1},this),a&&this.updateInput(a,{target:o,currentTarget:a})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var o={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(o.currentTarget,o)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=r}(),function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(r){t.isBuiltInButton(r)?e.Extension.call(this,this.defaults[r]):e.Extension.call(this,r)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var r=this.document.createElement("button"),i=this.contentDefault,o=this.getAria(),a=this.getEditorOption("buttonLabels");return r.classList.add("medium-editor-action"),r.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(l){r.classList.add(l)}),r.setAttribute("data-action",this.getAction()),o&&(r.setAttribute("title",o),r.setAttribute("aria-label",o)),this.attrs&&Object.keys(this.attrs).forEach(function(l){r.setAttribute(l,this.attrs[l])},this),a==="fontawesome"&&this.contentFA&&(i=this.contentFA),r.innerHTML=i,r},handleClick:function(r){r.preventDefault(),r.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var r=null;return this.useQueryState&&(r=this.base.queryCommandState(this.getAction())),r},isAlreadyApplied:function(r){var i=!1,o=this.getTagNames(),a,l;return this.knownState===!1||this.knownState===!0?this.knownState:(o&&o.length>0&&(i=o.indexOf(r.nodeName.toLowerCase())!==-1),!i&&this.style&&(a=this.style.value.split("|"),l=this.window.getComputedStyle(r,null).getPropertyValue(this.style.prop),a.forEach(function(u){this.knownState||(i=l.indexOf(u)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(r){return typeof r=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(r)},e.extensions.button=t}(),function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}}(),function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var r=this.base.getExtensionByName("toolbar");r&&r.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var r=this.base.getExtensionByName("toolbar");r&&r.hideToolbarDefaultActions()},setToolbarPosition:function(){var r=this.base.getExtensionByName("toolbar");r&&r.setToolbarPosition()}});e.extensions.form=t}(),function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(r){r.preventDefault(),r.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(r){e.util.isKey(r,e.util.keyCode.K)&&e.util.isMetaCtrlKey(r)&&!r.shiftKey&&this.handleClick(r)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var r=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return r.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),r.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&r.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&r.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),r.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(r){var i=this.getInput(),o=this.getAnchorTargetCheckbox(),a=this.getAnchorButtonCheckbox();if(r=r||{value:""},typeof r=="string"&&(r={value:r}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=r.value,i.focus(),o&&(o.checked=r.target==="_blank"),a){var l=r.buttonClass?r.buttonClass.split(" "):[];a.checked=l.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var r=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),o={value:this.getInput().value.trim()};return this.linkValidation&&(o.value=this.checkLinkFormat(o.value)),o.target="_self",r&&r.checked&&(o.target="_blank"),i&&i.checked&&(o.buttonClass=this.customClassOption),o},doFormSave:function(){var r=this.getFormOpts();this.completeFormSave(r)},completeFormSave:function(r){this.base.restoreSelection(),this.execAction(this.action,r),this.base.checkSelection()},ensureEncodedUri:function(r){return r===decodeURI(r)?encodeURI(r):r},ensureEncodedUriComponent:function(r){return r===decodeURIComponent(r)?encodeURIComponent(r):r},ensureEncodedParam:function(r){var i=r.split("="),o=i[0],a=i[1];return o+(a===void 0?"":"="+this.ensureEncodedUriComponent(a))},ensureEncodedQuery:function(r){return r.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(r){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,o=i.test(r),a="",l=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,u=r.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),d=u[1],f=u[2],h=u[3];if(l.test(r))return"tel:"+r;if(!o){var v=d.split("/")[0];(v.match(/.+(\.|:).+/)||v==="localhost")&&(a="http://")}return a+this.ensureEncodedUri(d)+(f===void 0?"":"?"+this.ensureEncodedQuery(f))+(h===void 0?"":"#"+h)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(r){var i=r.querySelector(".medium-editor-toolbar-close"),o=r.querySelector(".medium-editor-toolbar-save"),a=r.querySelector(".medium-editor-toolbar-input");this.on(r,"click",this.handleFormClick.bind(this)),this.on(a,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(o,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var r=this.document,i=r.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(r){if(r.keyCode===e.util.keyCode.ENTER){r.preventDefault(),this.doFormSave();return}r.keyCode===e.util.keyCode.ESCAPE&&(r.preventDefault(),this.doFormCancel())},handleFormClick:function(r){r.stopPropagation()},handleSaveClick:function(r){r.preventDefault(),this.doFormSave()},handleCloseClick:function(r){r.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t}(),function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var r=this.document.createElement("div");return r.id="medium-editor-anchor-preview-"+this.getEditorId(),r.className="medium-editor-anchor-preview",r.innerHTML=this.getTemplate(),this.on(r,"click",this.handleClick.bind(this)),r},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(r){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||r.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=r.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=r.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=r,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(r){r=r||this.activeAnchor;var i=this.window.innerWidth,o=this.anchorPreview.offsetHeight,a=r.getBoundingClientRect(),l=this.diffLeft,u=this.diffTop,d=this.getEditorOption("elementsContainer"),f=["absolute","fixed"].indexOf(window.getComputedStyle(d).getPropertyValue("position"))>-1,h={},v,y,x,w,_;v=this.anchorPreview.offsetWidth/2;var b=this.base.getExtensionByName("toolbar");b&&(l=b.diffLeft,u=b.diffTop),y=l-v,f?(w=d.getBoundingClientRect(),["top","left"].forEach(function(E){h[E]=a[E]-w[E]}),h.width=a.width,h.height=a.height,a=h,i=w.width,_=d.scrollTop):_=this.window.pageYOffset,x=a.left+a.width/2,_+=o+a.top+a.height-u-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(_)+"px",this.anchorPreview.style.right="initial",x<v?(this.anchorPreview.style.left=y+v+"px",this.anchorPreview.style.right="initial"):i-x<v?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=y+x+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(r){var i=this.base.getExtensionByName("anchor"),o=this.activeAnchor;i&&o&&(r.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(o){var a={value:o.attributes.href.value,target:o.getAttribute("target"),buttonClass:o.getAttribute("class")};i.showForm(a),o=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(r){var i=e.util.getClosestTag(r.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var o=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&o&&o.isDisplayed&&o.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(r){(!r.relatedTarget||!/anchor-preview/.test(r.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var r=new Date().getTime()-this.lastOver;r>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t}(),function(){var t,r,i,o,a;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],r="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+r+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+r+"))",o=new RegExp("^("+r+")$","i"),a=new RegExp(i,"gi");function l(d){return!e.util.getClosestTag(d,"a")}var u=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var d=0,f=0;f<this.window._mediumEditors.length;f++){var h=this.window._mediumEditors[f];h!==null&&h.getExtensionByName("autoLink")!==void 0&&d++}return d===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(d,f){this.performLinking(f)},onKeypress:function(d){this.disableEventHandling||e.util.isKey(d,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var f=this.base.exportSelection();this.performLinking(d.target)&&this.base.importSelection(f,!0)}catch(h){window.console&&window.console.error("Failed to perform linking",h),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(d){var f=e.util.splitByBlockElements(d),h=!1;f.length===0&&(f=[d]);for(var v=0;v<f.length;v++)h=this.removeObsoleteAutoLinkSpans(f[v])||h,h=this.performLinkingWithinElement(f[v])||h;return this.base.events.updateInput(d,{target:d,currentTarget:d}),h},removeObsoleteAutoLinkSpans:function(d){if(!d||d.nodeType===3)return!1;for(var f=d.querySelectorAll('span[data-auto-link="true"]'),h=!1,v=0;v<f.length;v++){var y=f[v].textContent;if(y.indexOf("://")===-1&&(y=e.util.ensureUrlHasProtocol(y)),f[v].getAttribute("data-href")!==y&&l(f[v])){h=!0;var x=y.replace(/\s+$/,"");if(f[v].getAttribute("data-href")===x){var w=y.length-x.length,_=e.util.splitOffDOMTree(f[v],this.splitTextBeforeEnd(f[v],w));f[v].parentNode.insertBefore(_,f[v].nextSibling)}else e.util.unwrap(f[v],this.document)}}return h},splitTextBeforeEnd:function(d,f){for(var h=this.document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null,!1),v=!0;v;)v=h.lastChild()!==null;for(var y,x,w;f>0&&w!==null;)y=h.currentNode,x=y.nodeValue,x.length>f?(w=y.splitText(x.length-f),f=0):(w=h.previousNode(),f-=x.length);return w},performLinkingWithinElement:function(d){for(var f=this.findLinkableText(d),h=!1,v=0;v<f.length;v++){var y=e.util.findOrCreateMatchingTextNodes(this.document,d,f[v]);this.shouldNotLink(y)||this.createAutoLink(y,f[v].href)}return h},shouldNotLink:function(d){for(var f=!1,h=0;h<d.length&&f===!1;h++)f=!!e.util.traverseUp(d[h],function(v){return v.nodeName.toLowerCase()==="a"||v.getAttribute&&v.getAttribute("data-auto-link")==="true"});return f},findLinkableText:function(d){for(var f=d.textContent,h=null,v=[];(h=a.exec(f))!==null;){var y=!0,x=h.index+h[0].length;y=(h.index===0||t.indexOf(f[h.index-1])!==-1)&&(x===f.length||t.indexOf(f[x])!==-1),y=y&&(h[0].indexOf("/")!==-1||o.test(h[0].split(".").pop().split("?").shift())),y&&v.push({href:h[0],start:h.index,end:x})}return v},createAutoLink:function(d,f){f=e.util.ensureUrlHasProtocol(f);var h=e.util.createLink(this.document,d,f,this.getEditorOption("targetBlank")?"_blank":null),v=this.document.createElement("span");for(v.setAttribute("data-auto-link","true"),v.setAttribute("data-href",f),h.insertBefore(v,h.firstChild);h.childNodes.length>1;)v.appendChild(h.childNodes[1])}});e.extensions.autoLink=u}(),function(){var t="medium-editor-dragover";function r(o){var a=e.util.getContainerEditorElement(o),l=Array.prototype.slice.call(a.parentElement.querySelectorAll("."+t));l.forEach(function(u){u.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){o.preventDefault(),o.dataTransfer.dropEffect="copy";var a=o.target.classList?o.target:o.target.parentElement;r(a),o.type==="dragover"&&a.classList.add(t)},handleDrop:function(o){o.preventDefault(),o.stopPropagation(),this.base.selectElement(o.target);var a=this.base.exportSelection();a.start=a.end,this.base.importSelection(a),o.dataTransfer.files&&Array.prototype.slice.call(o.dataTransfer.files).forEach(function(l){this.isAllowedFile(l)&&l.type.match("image")&&this.insertImageFile(l)},this),r(o.target)},isAllowedFile:function(o){return this.allowedTypes.some(function(a){return!!o.type.match(a)})},insertImageFile:function(o){if(typeof FileReader=="function"){var a=new FileReader;a.readAsDataURL(o),a.addEventListener("load",(function(l){var u=this.document.createElement("img");u.src=l.target.result,e.util.insertHTMLCommand(this.document,u.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i}(),function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(r){var i=r.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(r)},this)},handleKeydown:function(r){var i=e.util.getKeyCode(r);if(this.keys[i]){var o=e.util.isMetaCtrlKey(r),a=!!r.shiftKey,l=!!r.altKey;this.keys[i].forEach(function(u){u.meta===o&&u.shift===a&&(u.alt===l||u.alt===void 0)&&(r.preventDefault(),r.stopPropagation(),typeof u.command=="function"?u.command.apply(this):u.command!==!1&&this.execAction(u.command))},this)}}});e.extensions.keyboardCommands=t}(),function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(r){if(r.preventDefault(),r.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(r){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=r||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var r=this.document,i=r.createElement("div"),o=r.createElement("select"),a=r.createElement("a"),l=r.createElement("a"),u;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var d=0;d<this.fonts.length;d++)u=r.createElement("option"),u.innerHTML=this.fonts[d],u.value=this.fonts[d],o.appendChild(u);return o.className="medium-editor-toolbar-select",i.appendChild(o),this.on(o,"change",this.handleFontChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),a.setAttribute("href","#"),a.className="medium-editor-toobar-close",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(a),this.on(a,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(r){r.nodeName.toLowerCase()==="font"&&r.hasAttribute("face")&&r.removeAttribute("face")})},handleFontChange:function(){var r=this.getSelect().value;r===""?this.clearFontName():this.execAction("fontName",{value:r})},handleFormClick:function(r){r.stopPropagation()},handleSaveClick:function(r){r.preventDefault(),this.doFormSave()},handleCloseClick:function(r){r.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t}(),function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(r){if(r.preventDefault(),r.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(r){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=r||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var r=this.document,i=r.createElement("div"),o=r.createElement("input"),a=r.createElement("a"),l=r.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),o.setAttribute("type","range"),o.setAttribute("min","1"),o.setAttribute("max","7"),o.className="medium-editor-toolbar-input",i.appendChild(o),this.on(o,"change",this.handleSliderChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),a.setAttribute("href","#"),a.className="medium-editor-toobar-close",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(a),this.on(a,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(r){r.nodeName.toLowerCase()==="font"&&r.hasAttribute("size")&&r.removeAttribute("size")})},handleSliderChange:function(){var r=this.getInput().value;r==="4"?this.clearFontSize():this.execAction("fontSize",{value:r})},handleFormClick:function(r){r.stopPropagation()},handleSaveClick:function(r){r.preventDefault(),this.doFormSave()},handleCloseClick:function(r){r.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t}(),function(){var t="%ME_PASTEBIN%",r=null,i=null,o=function(d){d.stopPropagation()};function a(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function l(d,f,h){var v=d.clipboardData||f.clipboardData||h.dataTransfer,y={};if(!v)return y;if(v.getData){var x=v.getData("Text");x&&x.length>0&&(y["text/plain"]=x)}if(v.types)for(var w=0;w<v.types.length;w++){var _=v.types[w];y[_]=v.getData(_)}return y}var u=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(d){this.on(d,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(d,f){this.on(f,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(d,f){if(!d.defaultPrevented){var h=l(d,this.window,this.document),v=h["text/html"],y=h["text/plain"];this.window.clipboardData&&d.clipboardData===void 0&&!v&&(v=y),(v||y)&&(d.preventDefault(),this.doPaste(v,y,f))}},doPaste:function(d,f,h){var v,y="",x;if(this.cleanPastedHTML&&d)return this.cleanPaste(d);if(f){if(this.getEditorOption("disableReturn")||h&&h.getAttribute("data-disable-return"))y=e.util.htmlEntities(f);else if(v=f.split(/[\r\n]+/g),v.length>1)for(x=0;x<v.length;x+=1)v[x]!==""&&(y+="<p>"+e.util.htmlEntities(v[x])+"</p>");else y=e.util.htmlEntities(v[0]);e.util.insertHTMLCommand(this.document,y)}},handlePasteBinPaste:function(d){if(d.defaultPrevented){this.removePasteBin();return}var f=l(d,this.window,this.document),h=f["text/html"],v=f["text/plain"],y=i;if(!this.cleanPastedHTML||h){d.preventDefault(),this.removePasteBin(),this.doPaste(h,v,y),this.trigger("editablePaste",{currentTarget:y,target:y},y);return}setTimeout((function(){this.cleanPastedHTML&&(h=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(h,v,y),this.trigger("editablePaste",{currentTarget:y,target:y},y)}).bind(this),0)},handleKeydown:function(d,f){e.util.isKey(d,e.util.keyCode.V)&&e.util.isMetaCtrlKey(d)&&(d.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(f))},createPasteBin:function(d){var f,h=e.selection.getSelectionRange(this.document),v=this.window.pageYOffset;i=d,h&&(f=h.getClientRects(),f.length?v+=f[0].top:h.startContainer.getBoundingClientRect!==void 0?v+=h.startContainer.getBoundingClientRect().top:v+=h.getBoundingClientRect().top),r=h;var y=this.document.createElement("div");y.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),y.setAttribute("style","border: 1px red solid; position: absolute; top: "+v+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),y.setAttribute("contentEditable",!0),y.innerHTML=t,this.document.body.appendChild(y),this.on(y,"focus",o),this.on(y,"focusin",o),this.on(y,"focusout",o),y.focus(),e.selection.selectNode(y,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(y,"paste",this.boundHandlePaste)},removePasteBin:function(){r!==null&&(e.selection.selectRange(this.document,r),r=null),i!==null&&(i=null);var d=this.getPasteBin();d&&d&&(this.off(d,"focus",o),this.off(d,"focusin",o),this.off(d,"focusout",o),this.off(d,"paste",this.boundHandlePaste),d.parentElement.removeChild(d))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var d=this.getPasteBin();if(!d||d.firstChild&&d.firstChild.id==="mcepastebin")return!1;var f=d.innerHTML;return!f||f===t?!1:f},cleanPaste:function(d){var f,h,v,y,x=/<p|<br|<div/.test(d),w=[].concat(this.preCleanReplacements||[],a(),this.cleanReplacements||[]);for(f=0;f<w.length;f+=1)d=d.replace(w[f][0],w[f][1]);if(!x)return this.pasteHTML(d);for(v=this.document.createElement("div"),v.innerHTML="<p>"+d.split("<br><br>").join("</p><p>")+"</p>",h=v.querySelectorAll("a,p,div,br"),f=0;f<h.length;f+=1)switch(y=h[f],y.innerHTML=y.innerHTML.replace(/\n/gi," "),y.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(y);break;case"br":this.filterLineBreak(y);break}this.pasteHTML(v.innerHTML)},pasteHTML:function(d,f){f=e.util.defaults({},f,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var h,v,y,x,w=this.document.createDocumentFragment();for(w.appendChild(this.document.createElement("body")),x=w.querySelector("body"),x.innerHTML=d,this.cleanupSpans(x),h=x.querySelectorAll("*"),y=0;y<h.length;y+=1)v=h[y],v.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(v),e.util.cleanupAttrs(v,f.cleanAttrs),e.util.cleanupTags(v,f.cleanTags),e.util.unwrapTags(v,f.unwrapTags);e.util.insertHTMLCommand(this.document,x.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(d){return d&&(d.nodeName.toLowerCase()==="p"||d.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(d){/^\s*$/.test(d.textContent)&&d.parentNode&&d.parentNode.removeChild(d)},filterLineBreak:function(d){this.isCommonBlock(d.previousElementSibling)?this.removeWithParent(d):this.isCommonBlock(d.parentNode)&&(d.parentNode.firstChild===d||d.parentNode.lastChild===d)?this.removeWithParent(d):d.parentNode&&d.parentNode.childElementCount===1&&d.parentNode.textContent===""&&this.removeWithParent(d)},removeWithParent:function(d){d&&d.parentNode&&(d.parentNode.parentNode&&d.parentNode.childElementCount===1?d.parentNode.parentNode.removeChild(d.parentNode):d.parentNode.removeChild(d))},cleanupSpans:function(d){var f,h,v,y=d.querySelectorAll(".replace-with"),x=function(w){return w&&w.nodeName!=="#text"&&w.getAttribute("contenteditable")==="false"};for(f=0;f<y.length;f+=1)h=y[f],v=this.document.createElement(h.classList.contains("bold")?"b":"i"),h.classList.contains("bold")&&h.classList.contains("italic")?v.innerHTML="<i>"+h.innerHTML+"</i>":v.innerHTML=h.innerHTML,h.parentNode.replaceChild(v,h);for(y=d.querySelectorAll("span"),f=0;f<y.length;f+=1){if(h=y[f],e.util.traverseUp(h,x))return!1;e.util.unwrap(h,this.document)}}});e.extensions.paste=u}(),function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(r,i){this.initElement(i)},initElement:function(r){r.getAttribute("data-placeholder")||r.setAttribute("data-placeholder",this.text),this.updatePlaceholder(r)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(r,i){this.cleanupElement(i)},cleanupElement:function(r){r.getAttribute("data-placeholder")===this.text&&r.removeAttribute("data-placeholder")},showPlaceholder:function(r){r&&(e.util.isFF&&r.childNodes.length===0?(r.classList.add("medium-editor-placeholder-relative"),r.classList.remove("medium-editor-placeholder")):(r.classList.add("medium-editor-placeholder"),r.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(r){r&&(r.classList.remove("medium-editor-placeholder"),r.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(r,i){if(r.querySelector("img, blockquote, ul, ol, table")||r.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(r);i||this.showPlaceholder(r)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(r,i){var o=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,o)},handleFocus:function(r,i){this.hidePlaceholder(i)},handleBlur:function(r,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t}(),function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(r,i){return this.base.extensions.forEach(function(o){if(o!==this)return r.apply(i||this,arguments)},this)},createToolbar:function(){var r=this.document.createElement("div");return r.id="medium-editor-toolbar-"+this.getEditorId(),r.className="medium-editor-toolbar",this.static?r.className+=" static-toolbar":this.relativeContainer?r.className+=" medium-editor-relative-toolbar":r.className+=" medium-editor-stalker-toolbar",r.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&r.appendChild(i.getForm())}),this.attachEventHandlers(),r},createToolbarButtons:function(){var r=this.document.createElement("ul"),i,o,a,l,u,d;return r.id="medium-editor-toolbar-actions"+this.getEditorId(),r.className="medium-editor-toolbar-actions",r.style.display="block",this.buttons.forEach(function(f){typeof f=="string"?(u=f,d=null):(u=f.name,d=f),l=this.base.addBuiltInExtension(u,d),l&&typeof l.getButton=="function"&&(o=l.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(o)?i.appendChild(o):i.innerHTML=o,r.appendChild(i))},this),a=r.querySelectorAll("button"),a.length>0&&(a[0].classList.add(this.firstButtonClass),a[a.length-1].classList.add(this.lastButtonClass)),r},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(r){if(r&&r.target&&e.util.isDescendant(this.getToolbarElement(),r.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(r){r.hasForm&&r.isDisplayed()&&r.hideForm()})},multipleBlockElementsSelected:function(){var r=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),o=e.selection.getSelectionHtml(this.document).replace(r,""),a=o.match(i);return!!a&&a.length>1},modifySelection:function(){var r=this.window.getSelection(),i=r.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var o=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(o){for(var a=0;o.nodeValue.substr(a,1).trim().length===0;)a=a+1;i=e.selection.select(this.document,o,a,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var r=e.selection.getSelectionElement(this.window);if(!r||this.getEditorElements().indexOf(r)===-1||r.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(r){typeof r.isActive=="function"&&typeof r.setInactive=="function"&&r.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var r=[],i=null,o=e.selection.getSelectionRange(this.document),a,l=function(u){typeof u.checkState=="function"?u.checkState(a):typeof u.isActive=="function"&&typeof u.isAlreadyApplied=="function"&&typeof u.setActive=="function"&&!u.isActive()&&u.isAlreadyApplied(a)&&u.setActive()};if(o&&(this.forEachExtension(function(u){if(typeof u.queryCommandState=="function"&&(i=u.queryCommandState(),i!==null)){i&&typeof u.setActive=="function"&&u.setActive();return}r.push(u)}),a=e.selection.getSelectedParentElement(o),!!this.getEditorElements().some(function(u){return e.util.isDescendant(u,a,!0)})))for(;a&&(r.forEach(l),!e.util.isMediumEditorElement(a));)a=a.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var r=this.base.getFocusedElement(),i=this.window.getSelection();if(!r)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(r):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(r){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,o=this.window.innerWidth,a=this.getToolbarElement(),l=r.getBoundingClientRect(),u=l.top+i,d=l.left+l.width/2,f=a.offsetHeight,h=a.offsetWidth,v=h/2,y;switch(this.sticky?i>u+r.offsetHeight-f-this.stickyTopOffset?(a.style.top=u+r.offsetHeight-f+"px",a.classList.remove("medium-editor-sticky-toolbar")):i>u-f-this.stickyTopOffset?(a.classList.add("medium-editor-sticky-toolbar"),a.style.top=this.stickyTopOffset+"px"):(a.classList.remove("medium-editor-sticky-toolbar"),a.style.top=u-f+"px"):a.style.top=u-f+"px",this.align){case"left":y=l.left;break;case"right":y=l.right-h;break;case"center":y=d-v;break}y<0?y=0:y+h>o&&(y=o-Math.ceil(h)-1),a.style.left=y+"px"},positionToolbar:function(r){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=r.getRangeAt(0),o=i.getBoundingClientRect();(!o||o.height===0&&o.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?o=i.startContainer.querySelector("img").getBoundingClientRect():o=i.startContainer.getBoundingClientRect());var a=this.window.innerWidth,l=this.getToolbarElement(),u=l.offsetHeight,d=l.offsetWidth,f=d/2,h=50,v=this.diffLeft-f,y=this.getEditorOption("elementsContainer"),x=["absolute","fixed"].indexOf(window.getComputedStyle(y).getPropertyValue("position"))>-1,w={},_={},b,E;x?(E=y.getBoundingClientRect(),["top","left"].forEach(function(k){_[k]=o[k]-E[k]}),_.width=o.width,_.height=o.height,o=_,a=E.width,w.top=y.scrollTop):w.top=this.window.pageYOffset,b=o.left+o.width/2,w.top+=o.top-u,o.top<h?(l.classList.add("medium-toolbar-arrow-over"),l.classList.remove("medium-toolbar-arrow-under"),w.top+=h+o.height-this.diffTop):(l.classList.add("medium-toolbar-arrow-under"),l.classList.remove("medium-toolbar-arrow-over"),w.top+=this.diffTop),b<f?(w.left=v+f,w.right="initial"):a-b<f?(w.left="auto",w.right=0):(w.left=v+b,w.right="initial"),["top","left","right"].forEach(function(k){l.style[k]=w[k]+(isNaN(w[k])?"":"px")})}});e.extensions.toolbar=t}(),function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(r){var i="medium-editor-dragover";r.preventDefault(),r.dataTransfer.dropEffect="copy",r.type==="dragover"?r.target.classList.add(i):r.type==="dragleave"&&r.target.classList.remove(i)},handleDrop:function(r){var i="medium-editor-dragover",o;r.preventDefault(),r.stopPropagation(),r.dataTransfer.files&&(o=Array.prototype.slice.call(r.dataTransfer.files,0),o.some((function(a){if(a.type.match("image")){var l,u;l=new FileReader,l.readAsDataURL(a),u="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+u+'" />'),l.onload=(function(){var d=this.document.getElementById(u);d&&(d.removeAttribute("id"),d.removeAttribute("class"),d.src=l.result)}).bind(this)}}).bind(this))),r.target.classList.remove(i)}});e.extensions.imageDragging=t}(),function(){function t(D){var W=e.selection.getSelectionStart(this.options.ownerDocument),$=W.textContent,pe=e.selection.getCaretOffsets(W);($[pe.left-1]===void 0||$[pe.left-1].trim()===""||$[pe.left]!==void 0&&$[pe.left].trim()==="")&&D.preventDefault()}function r(D,W){if(this.options.disableReturn||W.getAttribute("data-disable-return"))D.preventDefault();else if(this.options.disableDoubleReturn||W.getAttribute("data-disable-double-return")){var $=e.selection.getSelectionStart(this.options.ownerDocument);($&&$.textContent.trim()===""&&$.nodeName.toLowerCase()!=="li"||$.previousElementSibling&&$.previousElementSibling.nodeName.toLowerCase()!=="br"&&$.previousElementSibling.textContent.trim()==="")&&D.preventDefault()}}function i(D){var W=e.selection.getSelectionStart(this.options.ownerDocument),$=W&&W.nodeName.toLowerCase();$==="pre"&&(D.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(W)&&(D.preventDefault(),D.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function o(D){var W,$=e.selection.getSelectionStart(this.options.ownerDocument),pe=$.nodeName.toLowerCase(),De=/^(\s+|<br\/?>)?$/i,de=/h\d/i;e.util.isKey(D,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&$.previousElementSibling&&de.test(pe)&&e.selection.getCaretOffsets($).left===0?e.util.isKey(D,e.util.keyCode.BACKSPACE)&&De.test($.previousElementSibling.innerHTML)?($.previousElementSibling.parentNode.removeChild($.previousElementSibling),D.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(D,e.util.keyCode.ENTER)&&(W=this.options.ownerDocument.createElement("p"),W.innerHTML="<br>",$.previousElementSibling.parentNode.insertBefore(W,$),D.preventDefault()):e.util.isKey(D,e.util.keyCode.DELETE)&&$.nextElementSibling&&$.previousElementSibling&&!de.test(pe)&&De.test($.innerHTML)&&de.test($.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,$.nextElementSibling),$.previousElementSibling.parentNode.removeChild($),D.preventDefault()):e.util.isKey(D,e.util.keyCode.BACKSPACE)&&pe==="li"&&De.test($.innerHTML)&&!$.previousElementSibling&&!$.parentElement.previousElementSibling&&$.nextElementSibling&&$.nextElementSibling.nodeName.toLowerCase()==="li"?(W=this.options.ownerDocument.createElement("p"),W.innerHTML="<br>",$.parentElement.parentElement.insertBefore(W,$.parentElement),e.selection.moveCursor(this.options.ownerDocument,W),$.parentElement.removeChild($),D.preventDefault()):e.util.isKey(D,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag($,"blockquote")!==!1&&e.selection.getCaretOffsets($).left===0?(D.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(D,e.util.keyCode.ENTER)&&e.util.getClosestTag($,"blockquote")!==!1&&e.selection.getCaretOffsets($).right===0?(W=this.options.ownerDocument.createElement("p"),W.innerHTML="<br>",$.parentElement.insertBefore(W,$.nextSibling),e.selection.moveCursor(this.options.ownerDocument,W),D.preventDefault()):e.util.isKey(D,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement($.parentElement)&&!$.previousElementSibling&&$.nextElementSibling&&De.test($.innerHTML)&&(D.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,$.nextSibling),$.parentElement.removeChild($))}function a(D){var W=e.selection.getSelectionStart(this.options.ownerDocument),$;W&&(e.util.isMediumEditorElement(W)&&W.children.length===0&&!e.util.isBlockContainer(W)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(D,e.util.keyCode.ENTER)&&!e.util.isListItem(W)&&!e.util.isBlockContainer(W)&&($=W.nodeName.toLowerCase(),$==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!D.shiftKey&&!D.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function l(D,W){var $=W.parentNode.querySelector('textarea[medium-editor-textarea-id="'+W.getAttribute("medium-editor-textarea-id")+'"]');$&&($.value=W.innerHTML.trim())}function u(D){D._mediumEditors||(D._mediumEditors=[null]),this.id||(this.id=D._mediumEditors.length),D._mediumEditors[this.id]=this}function d(D){!D._mediumEditors||!D._mediumEditors[this.id]||(D._mediumEditors[this.id]=null)}function f(D,W,$){var pe=[];if(D||(D=[]),typeof D=="string"&&(D=W.querySelectorAll(D)),e.util.isElement(D)&&(D=[D]),$)for(var De=0;De<D.length;De++){var de=D[De];e.util.isElement(de)&&!de.getAttribute("data-medium-editor-element")&&!de.getAttribute("medium-editor-textarea-id")&&pe.push(de)}else pe=Array.prototype.slice.apply(D);return pe}function h(D){var W=D.parentNode.querySelector('textarea[medium-editor-textarea-id="'+D.getAttribute("medium-editor-textarea-id")+'"]');W&&(W.classList.remove("medium-editor-hidden"),W.removeAttribute("medium-editor-textarea-id")),D.parentNode&&D.parentNode.removeChild(D)}function v(D,W){return Object.keys(W).forEach(function($){D[$]===void 0&&(D[$]=W[$])}),D}function y(D,W,$){var pe={window:$.options.contentWindow,document:$.options.ownerDocument,base:$};return D=v(D,pe),typeof D.init=="function"&&D.init(),D.name||(D.name=W),D}function x(){return this.elements.every(function(D){return!!D.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function w(){return x.call(this)?this.options.anchorPreview!==!1:!1}function _(){return this.options.placeholder!==!1}function b(){return this.options.autoLink!==!1}function E(){return this.options.imageDragging!==!1}function k(){return this.options.keyboardCommands!==!1}function O(){return!this.options.extensions.imageDragging}function N(D){for(var W=this.options.ownerDocument.createElement("div"),$=Date.now(),pe="medium-editor-"+$,De=D.attributes;this.options.ownerDocument.getElementById(pe);)$++,pe="medium-editor-"+$;W.className=D.className,W.id=pe,W.innerHTML=D.value,D.setAttribute("medium-editor-textarea-id",pe);for(var de=0,Se=De.length;de<Se;de++)W.hasAttribute(De[de].nodeName)||W.setAttribute(De[de].nodeName,De[de].value);return D.form&&this.on(D.form,"reset",(function(me){me.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(pe))}).bind(this)),D.classList.add("medium-editor-hidden"),D.parentNode.insertBefore(W,D),W}function I(D,W){if(!D.getAttribute("data-medium-editor-element")){D.nodeName.toLowerCase()==="textarea"&&(D=N.call(this,D),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=l.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!D.getAttribute("data-disable-editing")&&(D.setAttribute("contentEditable",!0),D.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(D.getAttribute("data-disable-return")||D.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=r.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!D.getAttribute("data-disable-return")&&this.on(D,"keyup",a.bind(this));var $=e.util.guid();D.setAttribute("data-medium-editor-element",!0),D.classList.add("medium-editor-element"),D.setAttribute("role","textbox"),D.setAttribute("aria-multiline",!0),D.setAttribute("data-medium-editor-editor-index",W),D.setAttribute("medium-editor-index",$),q[$]=D.innerHTML,this.events.attachAllEventsToElement(D)}return D}function T(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",o.bind(this)),this.subscribe("editableKeydownEnter",o.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=r.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function L(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(De){De!=="toolbar"&&this.options.extensions[De]&&this.extensions.push(y(this.options.extensions[De],De,this))},this),O.call(this)){var D=this.options.fileDragging;D||(D={},E.call(this)||(D.allowedTypes=[])),this.addBuiltInExtension("fileDragging",D)}var W={paste:!0,"anchor-preview":w.call(this),autoLink:b.call(this),keyboardCommands:k.call(this),placeholder:_.call(this)};Object.keys(W).forEach(function(De){W[De]&&this.addBuiltInExtension(De)},this);var $=this.options.extensions.toolbar;if(!$&&x.call(this)){var pe=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});$=new e.extensions.toolbar(pe)}$&&this.extensions.push(y($,"toolbar",this))}function H(D,W){var $=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return W&&$.forEach(function(pe){W.hasOwnProperty(pe[0])&&W[pe[0]]!==void 0&&e.util.deprecated(pe[0],pe[1],"v6.0.0")}),e.util.defaults({},W,D)}function X(D,W){var $=/^append-(.+)$/gi,pe=/justify([A-Za-z]*)$/g,De,de;if(De=$.exec(D),De)return e.util.execFormatBlock(this.options.ownerDocument,De[1]);if(D==="fontSize")return W.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),de=W.value||W.size,this.options.ownerDocument.execCommand("fontSize",!1,de);if(D==="fontName")return W.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),de=W.value||W.name,this.options.ownerDocument.execCommand("fontName",!1,de);if(D==="createLink")return this.createLink(W);if(D==="image"){var Se=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,Se)}if(D==="html"){var me=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,me)}if(pe.exec(D)){var ve=this.options.ownerDocument.execCommand(D,!1,null),Re=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return Re&&V.call(this,e.util.getTopBlockContainer(Re)),ve}return de=W&&W.value,this.options.ownerDocument.execCommand(D,!1,de)}function V(D){if(D){var W,$=Array.prototype.slice.call(D.childNodes).filter(function(pe){var De=pe.nodeName.toLowerCase()==="div";return De&&!W&&(W=pe.style.textAlign),De});$.length&&(this.saveSelection(),$.forEach(function(pe){if(pe.style.textAlign===W){var De=pe.lastChild;if(De){e.util.unwrap(pe,this.options.ownerDocument);var de=this.options.ownerDocument.createElement("BR");De.parentNode.insertBefore(de,De.nextSibling)}}},this),D.style.textAlign=W,this.restoreSelection())}}var q={};e.prototype={init:function(D,W){return this.options=H.call(this,this.defaults,W),this.origElements=D,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(u.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,L.call(this),T.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(D){typeof D.destroy=="function"&&D.destroy()},this),this.events.destroy(),this.elements.forEach(function(D){this.options.spellcheck&&(D.innerHTML=D.innerHTML),D.removeAttribute("contentEditable"),D.removeAttribute("spellcheck"),D.removeAttribute("data-medium-editor-element"),D.classList.remove("medium-editor-element"),D.removeAttribute("role"),D.removeAttribute("aria-multiline"),D.removeAttribute("medium-editor-index"),D.removeAttribute("data-medium-editor-editor-index"),D.getAttribute("medium-editor-textarea-id")&&h(D)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,d.call(this,this.options.contentWindow))},on:function(D,W,$,pe){return this.events.attachDOMEvent(D,W,$,pe),this},off:function(D,W,$,pe){return this.events.detachDOMEvent(D,W,$,pe),this},subscribe:function(D,W){return this.events.attachCustomEvent(D,W),this},unsubscribe:function(D,W){return this.events.detachCustomEvent(D,W),this},trigger:function(D,W,$){return this.events.triggerCustomEvent(D,W,$),this},delay:function(D){var W=this;return setTimeout(function(){W.isActive&&D()},this.options.delay)},serialize:function(){var D,W,$={},pe=this.elements.length;for(D=0;D<pe;D+=1)W=this.elements[D].id!==""?this.elements[D].id:"element-"+D,$[W]={value:this.elements[D].innerHTML.trim()};return $},getExtensionByName:function(D){var W;return this.extensions&&this.extensions.length&&this.extensions.some(function($){return $.name===D?(W=$,!0):!1}),W},addBuiltInExtension:function(D,W){var $=this.getExtensionByName(D),pe;if($)return $;switch(D){case"anchor":pe=e.util.extend({},this.options.anchor,W),$=new e.extensions.anchor(pe);break;case"anchor-preview":$=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":$=new e.extensions.autoLink;break;case"fileDragging":$=new e.extensions.fileDragging(W);break;case"fontname":$=new e.extensions.fontName(this.options.fontName);break;case"fontsize":$=new e.extensions.fontSize(W);break;case"keyboardCommands":$=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":$=new e.extensions.paste(this.options.paste);break;case"placeholder":$=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(D)&&(W?(pe=e.util.defaults({},W,e.extensions.button.prototype.defaults[D]),$=new e.extensions.button(pe)):$=new e.extensions.button(D))}return $&&this.extensions.push(y($,D,this)),$},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var D=this.getExtensionByName("toolbar");return D&&D.checkState(),this},queryCommandState:function(D){var W=/^full-(.+)$/gi,$,pe=null;$=W.exec(D),$&&(D=$[1]);try{pe=this.options.ownerDocument.queryCommandState(D)}catch{pe=null}return pe},execAction:function(D,W){var $=/^full-(.+)$/gi,pe,De;return pe=$.exec(D),pe?(this.saveSelection(),this.selectAllContents(),De=X.call(this,pe[1],W),this.restoreSelection()):De=X.call(this,D,W),(D==="insertunorderedlist"||D==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),De},getSelectedParentElement:function(D){return D===void 0&&(D=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(D)},selectAllContents:function(){var D=e.selection.getSelectionElement(this.options.contentWindow);if(D){for(;D.children.length===1;)D=D.children[0];this.selectElement(D)}},selectElement:function(D){e.selection.selectNode(D,this.options.ownerDocument);var W=e.selection.getSelectionElement(this.options.contentWindow);W&&this.events.focusElement(W)},getFocusedElement:function(){var D;return this.elements.some(function(W){return!D&&W.getAttribute("data-medium-focused")&&(D=W),!!D},this),D},exportSelection:function(){var D=e.selection.getSelectionElement(this.options.contentWindow),W=this.elements.indexOf(D),$=null;return W>=0&&($=e.selection.exportSelection(D,this.options.ownerDocument)),$!==null&&W!==0&&($.editableElementIndex=W),$},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(D,W){if(D){var $=this.elements[D.editableElementIndex||0];e.selection.importSelection(D,$,this.options.ownerDocument,W)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(D){var W=e.selection.getSelectionElement(this.options.contentWindow),$={},pe;if(this.elements.indexOf(W)!==-1){try{if(this.events.disableCustomEvent("editableInput"),D.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),pe=D.url||D.value,pe&&pe.trim().length>0){var De=this.options.contentWindow.getSelection();if(De){var de=De.getRangeAt(0),Se=de.commonAncestorContainer,me,ve,Re,Ie;if(de.endContainer.nodeType===3&&de.startContainer.nodeType!==3&&de.startOffset===0&&de.startContainer.firstChild===de.endContainer&&(Se=de.endContainer),ve=e.util.getClosestBlockContainer(de.startContainer),Re=e.util.getClosestBlockContainer(de.endContainer),Se.nodeType!==3&&Se.textContent.length!==0&&ve===Re){var ce=ve||W,ue=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),me=this.exportSelection(),ue.appendChild(ce.cloneNode(!0)),W===ce?e.selection.select(this.options.ownerDocument,ce.firstChild,0,ce.lastChild,ce.lastChild.nodeType===3?ce.lastChild.nodeValue.length:ce.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,ce,0,ce,ce.childNodes.length);var K=this.exportSelection();Ie=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,ue,{start:me.start-K.start,end:me.end-K.start,editableElementIndex:me.editableElementIndex}),Ie.length===0&&(ue=this.options.ownerDocument.createDocumentFragment(),ue.appendChild(Se.cloneNode(!0)),Ie=[ue.firstChild.firstChild,ue.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,Ie,pe.trim());var ie=(ue.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,ue.firstChild.innerHTML.replace(/^\s+/,"")),me.start-=ie,me.end-=ie,this.importSelection(me)}else this.options.ownerDocument.execCommand("createLink",!1,pe);this.options.targetBlank||D.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),pe):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),pe),D.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),D.buttonClass)}}if(this.options.targetBlank||D.target==="_blank"||D.buttonClass){$=this.options.ownerDocument.createEvent("HTMLEvents"),$.initEvent("input",!0,!0,this.options.contentWindow);for(var ne=0,fe=this.elements.length;ne<fe;ne+=1)this.elements[ne].dispatchEvent($)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",$,W)}},cleanPaste:function(D){this.getExtensionByName("paste").cleanPaste(D)},pasteHTML:function(D,W){this.getExtensionByName("paste").pasteHTML(D,W)},setContent:function(D,W){if(W=W||0,this.elements[W]){var $=this.elements[W];$.innerHTML=D,this.checkContentChanged($)}},getContent:function(D){return D=D||0,this.elements[D]?this.elements[D].innerHTML.trim():null},checkContentChanged:function(D){D=D||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(D,{target:D,currentTarget:D})},resetContent:function(D){if(D){var W=this.elements.indexOf(D);W!==-1&&this.setContent(q[D.getAttribute("medium-editor-index")],W);return}this.elements.forEach(function($,pe){this.setContent(q[$.getAttribute("medium-editor-index")],pe)},this)},addElements:function(D){var W=f(D,this.options.ownerDocument,!0);if(W.length===0)return!1;W.forEach(function($){$=I.call(this,$,this.id),this.elements.push($),this.trigger("addElement",{target:$,currentTarget:$},$)},this)},removeElements:function(D){var W=f(D,this.options.ownerDocument),$=W.map(function(pe){return pe.getAttribute("medium-editor-textarea-id")&&pe.parentNode?pe.parentNode.querySelector('div[medium-editor-textarea-id="'+pe.getAttribute("medium-editor-textarea-id")+'"]'):pe});this.elements=this.elements.filter(function(pe){return $.indexOf(pe)!==-1?(this.events.cleanupElement(pe),pe.getAttribute("medium-editor-textarea-id")&&h(pe),this.trigger("removeElement",{target:pe,currentTarget:pe},pe),!1):!0},this)}},e.getEditorFromElement=function(D){var W=D.getAttribute("data-medium-editor-editor-index"),$=D&&D.ownerDocument&&(D.ownerDocument.defaultView||D.ownerDocument.parentWindow);return $&&$._mediumEditors&&$._mediumEditors[W]?$._mediumEditors[W]:null}}(),function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}}(),e.parseVersionString=function(t){var r=t.split("-"),i=r[0].split("."),o=r.length>1?r[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:o,toString:function(){return[i[0],i[1],i[2]].join(".")+(o?"-"+o:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e}())}(_d)),_d.exports}var JF=KF();const dc=va(JF);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var yg=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},_g=function(){function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),dd=function(){function n(e,t){var r=[],i=!0,o=!1,a=void 0;try{for(var l=e[Symbol.iterator](),u;!(i=(u=l.next()).done)&&(r.push(u.value),!(t&&r.length===t));i=!0);}catch(d){o=!0,a=d}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}return r}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(n){return this.indexOf(n)===0};String.prototype.padStart=String.prototype.padStart||function(n,e){for(var t=this;t.length<n;)t=e+t;return t};var ZF={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function I0(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?n.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):n.toString();return t||"0"}var QF=function(){function n(e,t,r,i){yg(this,n);var o=this;function a(u){if(u.startsWith("hsl")){var d=u.match(/([\-\d\.e]+)/g).map(Number),f=dd(d,4),h=f[0],v=f[1],y=f[2],x=f[3];x===void 0&&(x=1),h/=360,v/=100,y/=100,o.hsla=[h,v,y,x]}else if(u.startsWith("rgb")){var w=u.match(/([\-\d\.e]+)/g).map(Number),_=dd(w,4),b=_[0],E=_[1],k=_[2],O=_[3];O===void 0&&(O=1),o.rgba=[b,E,k,O]}else u.startsWith("#")?o.rgba=n.hexToRgb(u):o.rgba=n.nameToRgb(u)||n.hexToRgb(u)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(r===void 0){var l=e&&""+e;l&&a(l.toLowerCase())}else this.rgba=[e,t,r,i===void 0?1:i]}return _g(n,[{key:"printRGB",value:function(t){var r=t?this.rgba:this.rgba.slice(0,3),i=r.map(function(o,a){return I0(o,a===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var r=[360,100,100,1],i=["","%","%",""],o=t?this.hsla:this.hsla.slice(0,3),a=o.map(function(l,u){return I0(l*r[u],u===3?3:1)+i[u]});return t?"hsla("+a+")":"hsl("+a+")"}},{key:"printHex",value:function(t){var r=this.hex;return t?r:r.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=n.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=n.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,r=t.map(function(i,o){return o<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+r.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=n.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var r=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!r.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=r.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(o){return parseInt(o,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var r=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=ZF[r];return i===void 0?i:n.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var r=dd(t,4),i=r[0],o=r[1],a=r[2],l=r[3];i/=255,o/=255,a/=255;var u=Math.max(i,o,a),d=Math.min(i,o,a),f=void 0,h=void 0,v=(u+d)/2;if(u===d)f=h=0;else{var y=u-d;switch(h=v>.5?y/(2-u-d):y/(u+d),u){case i:f=(o-a)/y+(o<a?6:0);break;case o:f=(a-i)/y+2;break;case a:f=(i-o)/y+4;break}f/=6}return[f,h,v,l]}},{key:"hslToRgb",value:function(t){var r=dd(t,4),i=r[0],o=r[1],a=r[2],l=r[3],u=void 0,d=void 0,f=void 0;if(o===0)u=d=f=a;else{var h=function(_,b,E){return E<0&&(E+=1),E>1&&(E-=1),E<.16666666666666666?_+(b-_)*6*E:E<.5?b:E<.6666666666666666?_+(b-_)*(.6666666666666666-E)*6:_},v=a<.5?a*(1+o):a+o-a*o,y=2*a-v;u=h(y,v,i+1/3),d=h(y,v,i),f=h(y,v,i-1/3)}var x=[u*255,d*255,f*255].map(Math.round);return x[3]=l,x}}]),n}(),e9=function(){function n(){yg(this,n),this._events=[]}return _g(n,[{key:"add",value:function(t,r,i){t.addEventListener(r,i,!1),this._events.push({target:t,type:r,handler:i})}},{key:"remove",value:function(t,r,i){this._events=this._events.filter(function(o){var a=!0;return t&&t!==o.target&&(a=!1),r&&r!==o.type&&(a=!1),i&&i!==o.handler&&(a=!1),a&&n._doRemove(o.target,o.type,o.handler),!a})}},{key:"destroy",value:function(){this._events.forEach(function(t){return n._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,r,i){t.removeEventListener(r,i,!1)}}]),n}();function t9(n){var e=document.createElement("div");return e.innerHTML=n,e.firstElementChild}function ah(n,e,t){var r=!1;function i(u,d,f){return Math.max(d,Math.min(u,f))}function o(u,d,f){if(f&&(r=!0),!!r){u.preventDefault();var h=e.getBoundingClientRect(),v=h.width,y=h.height,x=d.clientX,w=d.clientY,_=i(x-h.left,0,v),b=i(w-h.top,0,y);t(_/v,b/y)}}function a(u,d){var f=u.buttons===void 0?u.which:u.buttons;f===1?o(u,u,d):r=!1}function l(u,d){u.touches.length===1?o(u,u.touches[0],d):r=!1}n.add(e,"mousedown",function(u){a(u,!0)}),n.add(e,"touchstart",function(u){l(u,!0)}),n.add(window,"mousemove",a),n.add(e,"touchmove",l),n.add(window,"mouseup",function(u){r=!1}),n.add(e,"touchend",function(u){r=!1}),n.add(e,"touchcancel",function(u){r=!1})}var n9=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,r9=360,zw="keydown",cd="mousedown",sh="focusin";function Fi(n,e){return(e||document).querySelector(n)}function i9(n){n.preventDefault(),n.stopPropagation()}function lh(n,e,t,r,i){n.add(e,zw,function(o){t.indexOf(o.key)>=0&&r(o)})}var Uw=function(){function n(e){yg(this,n),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new e9,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return _g(n,[{key:"setOptions",value:function(t){var r=this;if(!t)return;var i=this.settings;function o(d,f,h){for(var v in d)f[v]=d[v]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),o(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var a=t.color||t.colour;a&&this._setColor(a)}var l=i.parent;if(l&&i.popup&&!this._popupInited){var u=function(f){return r.openHandler(f)};this._events.add(l,"click",u),lh(this._events,l,[" ","Spacebar","Enter"],u),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var r=t&&t.type===zw?this._domEdit:this.domElement;setTimeout(function(){return r.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var r=t&&t.type,i=!1;if(!t)i=!0;else if(r===cd||r===sh){var o=(this.__containedEvent||0)+100;t.timeStamp>o&&(i=!0)}else i9(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",r!==cd&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,r){this.closeHandler(),this.setOptions(t),r&&this.openHandler()}},{key:"setColor",value:function(t,r){this._setColor(t,{silent:r})}},{key:"_setColor",value:function(t,r){if(typeof t=="string"&&(t=t.trim()),!!t){r=r||{};var i=void 0;try{i=new QF(t)}catch(a){if(r.failSilently)return;throw a}if(!this.settings.alpha){var o=i.hsla;o[3]=1,i.hsla=o}this.colour=this.color=i,this._setHSLA(null,null,null,null,r)}}},{key:"setColour",value:function(t,r){this.setColor(t,r)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var r=this._toggleDOM(!0);return this._setPosition(),r}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',o=t9(i);return this.domElement=o,this._domH=Fi(".picker_hue",o),this._domSL=Fi(".picker_sl",o),this._domA=Fi(".picker_alpha",o),this._domEdit=Fi(".picker_editor input",o),this._domSample=Fi(".picker_sample",o),this._domOkay=Fi(".picker_done button",o),this._domCancel=Fi(".picker_cancel button",o),o.classList.add("layout_"+this.settings.layout),this.settings.alpha||o.classList.add("no_alpha"),this.settings.editor||o.classList.add("no_editor"),this.settings.cancelButton||o.classList.add("no_cancel"),this._ifPopup(function(){return o.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,r=this,i=this.domElement,o=this._events;function a(d,f,h){o.add(d,f,h)}a(i,"click",function(d){return d.preventDefault()}),ah(o,this._domH,function(d,f){return r._setHSLA(d)}),ah(o,this._domSL,function(d,f){return r._setHSLA(null,d,1-f)}),this.settings.alpha&&ah(o,this._domA,function(d,f){return r._setHSLA(null,null,null,1-f)});var l=this._domEdit;a(l,"input",function(d){r._setColor(this.value,{fromEditor:!0,failSilently:!0})}),a(l,"focus",function(d){var f=this;f.selectionStart===f.selectionEnd&&f.select()}),this._ifPopup(function(){var d=function(v){return t.closeHandler(v)};a(window,cd,d),a(window,sh,d),lh(o,i,["Esc","Escape"],d);var f=function(v){t.__containedEvent=v.timeStamp};a(i,cd,f),a(i,sh,f),a(t._domCancel,"click",d)});var u=function(f){t._ifPopup(function(){return t.closeHandler(f)}),t.onDone&&t.onDone(t.colour)};a(this._domOkay,"click",u),lh(o,i,["Enter"],u)}},{key:"_setPosition",value:function(){var t=this.settings.parent,r=this.domElement;t!==r.parentNode&&t.appendChild(r),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var o=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(a){a===o?r.classList.add(a):r.classList.remove(a)}),r.classList.add(o)})}},{key:"_setHSLA",value:function(t,r,i,o,a){a=a||{};var l=this.colour,u=l.hsla;[t,r,i,o].forEach(function(d,f){(d||d===0)&&(u[f]=d)}),l.hsla=u,this._updateUI(a),this.onChange&&!a.silent&&this.onChange(l)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var r=this.colour,i=r.hsla,o="hsl("+i[0]*r9+", 100%, 50%)",a=r.hslString,l=r.hslaString,u=this._domH,d=this._domSL,f=this._domA,h=Fi(".picker_selector",u),v=Fi(".picker_selector",d),y=Fi(".picker_selector",f);function x(I,T,L){T.style.left=L*100+"%"}function w(I,T,L){T.style.top=L*100+"%"}x(u,h,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=o,x(d,v,i[1]),w(d,v,1-i[2]),d.style.color=a,w(f,y,1-i[3]);var _=a,b=_.replace("hsl","hsla").replace(")",", 0)"),E="linear-gradient("+[_,b]+")";if(this._domA.style.background=E+", "+n9,!t.fromEditor){var k=this.settings.editorFormat,O=this.settings.alpha,N=void 0;switch(k){case"rgb":N=r.printRGB(O);break;case"hsl":N=r.printHSL(O);break;default:N=r.printHex(O)}this._domEdit.value=N}this._domSample.style.color=l}},{key:"_ifPopup",value:function(t,r){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):r&&r()}},{key:"_toggleDOM",value:function(t){var r=this.domElement;if(!r)return!1;var i=t?"":"none",o=r.style.display!==i;return o&&(r.style.display=i),o}}]),n}();{var uh=document.createElement("style");uh.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(uh),Uw.StyleElement=uh}var dh={exports:{}},B0;function Vw(){return B0||(B0=1,function(n,e){(function(t,r){n.exports=t()})(function(){var t="object",r="function",i="undefined",o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],a=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],u=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(K,ie){var ne=typeof K[ie];return ne==r||!!(ne==t&&K[ie])||ne=="unknown"}function f(K,ie){return!!(typeof K[ie]==t&&K[ie])}function h(K,ie){return typeof K[ie]!=i}function v(K){return function(ie,ne){for(var fe=ne.length;fe--;)if(!K(ie,ne[fe]))return!1;return!0}}var y=v(d),x=v(f),w=v(h);function _(K){return K&&y(K,u)&&w(K,l)}function b(K){return f(K,"body")?K.body:K.getElementsByTagName("body")[0]}var E=[].forEach?function(K,ie){K.forEach(ie)}:function(K,ie){for(var ne=0,fe=K.length;ne<fe;++ne)ie(K[ne],ne)},k={},O=typeof window!=i&&typeof document!=i,N={isHostMethod:d,isHostObject:f,isHostProperty:h,areHostMethods:y,areHostObjects:x,areHostProperties:w,isTextRange:_,getBody:b,forEach:E},I={version:"1.3.2",initialized:!1,isBrowser:O,supported:!0,util:N,features:{},modules:k,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function T(K){typeof console!=i&&d(console,"log")}function L(K,ie){O&&ie?alert(K):T(K)}function H(K){I.initialized=!0,I.supported=!1,L("Rangy is not supported in this environment. Reason: "+K,I.config.alertOnFail)}I.fail=H;function X(K){L("Rangy warning: "+K,I.config.alertOnWarn)}I.warn=X;var V;({}).hasOwnProperty?(N.extend=V=function(K,ie,ne){var fe,he;for(var be in ie)be==="__proto__"||be==="constructor"||be==="prototype"||ie.hasOwnProperty(be)&&(fe=K[be],he=ie[be],ne&&fe!==null&&typeof fe=="object"&&he!==null&&typeof he=="object"&&V(fe,he,!0),K[be]=he);return ie.hasOwnProperty("toString")&&(K.toString=ie.toString),K},N.createOptions=function(K,ie){var ne={};return V(ne,ie),K&&V(ne,K),ne}):H("hasOwnProperty not supported"),O||H("Rangy can only run in a browser"),function(){var K;if(O){var ie=document.createElement("div");ie.appendChild(document.createElement("span"));var ne=[].slice;try{ne.call(ie.childNodes,0)[0].nodeType==1&&(K=function(fe){return ne.call(fe,0)})}catch{}}K||(K=function(fe){for(var he=[],be=0,xe=fe.length;be<xe;++be)he[be]=fe[be];return he}),N.toArray=K}();var q;O&&(d(document,"addEventListener")?q=function(K,ie,ne){K.addEventListener(ie,ne,!1)}:d(document,"attachEvent")?q=function(K,ie,ne){K.attachEvent("on"+ie,ne)}:H("Document does not have required addEventListener or attachEvent method"),N.addListener=q);var D=[];function W(K){return K.message||K.description||String(K)}function $(){if(!(!O||I.initialized)){var K,ie=!1,ne=!1;d(document,"createRange")&&(K=document.createRange(),y(K,a)&&w(K,o)&&(ie=!0));var fe=b(document);if(!fe||fe.nodeName.toLowerCase()!="body"){H("No body element found");return}if(fe&&d(fe,"createTextRange")&&(K=fe.createTextRange(),_(K)&&(ne=!0)),!ie&&!ne){H("Neither Range nor TextRange are available");return}I.initialized=!0,I.features={implementsDomRange:ie,implementsTextRange:ne};var he,be;for(var xe in k)(he=k[xe])instanceof me&&he.init(he,I);for(var Ze=0,We=D.length;Ze<We;++Ze)try{D[Ze](I)}catch(St){be="Rangy init listener threw an exception. Continuing. Detail: "+W(St),T(be)}}}function pe(K,ie,ne){ne&&(K+=" in module "+ne.name),I.warn("DEPRECATED: "+K+" is deprecated. Please use "+ie+" instead.")}function De(K,ie,ne,fe){K[ie]=function(){return pe(ie,ne,fe),K[ne].apply(K,N.toArray(arguments))}}N.deprecationNotice=pe,N.createAliasForDeprecatedMethod=De,I.init=$,I.addInitListener=function(K){I.initialized?K(I):D.push(K)};var de=[];I.addShimListener=function(K){de.push(K)};function Se(K){K=K||window,$();for(var ie=0,ne=de.length;ie<ne;++ie)de[ie](K)}O&&(I.shim=I.createMissingNativeApi=Se,De(I,"createMissingNativeApi","shim"));function me(K,ie,ne){this.name=K,this.dependencies=ie,this.initialized=!1,this.supported=!1,this.initializer=ne}me.prototype={init:function(){for(var K=this.dependencies||[],ie=0,ne=K.length,fe,he;ie<ne;++ie){if(he=K[ie],fe=k[he],!fe||!(fe instanceof me))throw new Error("required module '"+he+"' not found");if(fe.init(),!fe.supported)throw new Error("required module '"+he+"' not supported")}this.initializer(this)},fail:function(K){throw this.initialized=!0,this.supported=!1,new Error(K)},warn:function(K){I.warn("Module "+this.name+": "+K)},deprecationNotice:function(K,ie){I.warn("DEPRECATED: "+K+" in module "+this.name+" is deprecated. Please use "+ie+" instead")},createError:function(K){return new Error("Error in Rangy "+this.name+" module: "+K)}};function ve(K,ie,ne){var fe=new me(K,ie,function(he){if(!he.initialized){he.initialized=!0;try{ne(I,he),he.supported=!0}catch(xe){var be="Module '"+K+"' failed to load: "+W(xe);T(be),xe.stack&&T(xe.stack)}}});return k[K]=fe,fe}I.createModule=function(K){var ie,ne;arguments.length==2?(ie=arguments[1],ne=[]):(ie=arguments[2],ne=arguments[1]);var fe=ve(K,ne,ie);I.initialized&&I.supported&&fe.init()},I.createCoreModule=function(K,ie,ne){ve(K,ie,ne)};function Re(){}I.RangePrototype=Re,I.rangePrototype=new Re;function Ie(){}I.selectionPrototype=new Ie,I.createCoreModule("DomUtil",[],function(K,ie){var ne="undefined",fe=K.util,he=fe.getBody;fe.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||ie.fail("document missing a Node creation method"),fe.isHostMethod(document,"getElementsByTagName")||ie.fail("document missing getElementsByTagName method");var be=document.createElement("div");fe.areHostMethods(be,["insertBefore","appendChild","cloneNode"])||ie.fail("Incomplete Element implementation"),fe.isHostProperty(be,"innerHTML")||ie.fail("Element is missing innerHTML property");var xe=document.createTextNode("test");fe.areHostMethods(xe,["splitText","deleteData","insertData","appendData","cloneNode"])||ie.fail("Incomplete Text Node implementation");var Ze=function(we,Je){for(var ft=we.length;ft--;)if(we[ft]===Je)return!0;return!1};function We(we){var Je;return typeof we.namespaceURI==ne||(Je=we.namespaceURI)===null||Je=="http://www.w3.org/1999/xhtml"}function St(we){var Je=we.parentNode;return Je.nodeType==1?Je:null}function pt(we){for(var Je=0;we=we.previousSibling;)++Je;return Je}function Ht(we){switch(we.nodeType){case 7:case 10:return 0;case 3:case 8:return we.length;default:return we.childNodes.length}}function Qt(we,Je){var ft=[],Ct;for(Ct=we;Ct;Ct=Ct.parentNode)ft.push(Ct);for(Ct=Je;Ct;Ct=Ct.parentNode)if(Ze(ft,Ct))return Ct;return null}function te(we,Je,ft){for(var Ct=ft?Je:Je.parentNode;Ct;){if(Ct===we)return!0;Ct=Ct.parentNode}return!1}function A(we,Je){return te(we,Je,!0)}function F(we,Je,ft){for(var Ct,Ft=ft?we:we.parentNode;Ft;){if(Ct=Ft.parentNode,Ct===Je)return Ft;Ft=Ct}return null}function Z(we){var Je=we.nodeType;return Je==3||Je==4||Je==8}function J(we){if(!we)return!1;var Je=we.nodeType;return Je==3||Je==8}function se(we,Je){var ft=Je.nextSibling,Ct=Je.parentNode;return ft?Ct.insertBefore(we,ft):Ct.appendChild(we),we}function oe(we,Je,ft){var Ct=we.cloneNode(!1);if(Ct.deleteData(0,Je),we.deleteData(Je,we.length-Je),se(Ct,we),ft)for(var Ft=0,Kt;Kt=ft[Ft++];)Kt.node==we&&Kt.offset>Je?(Kt.node=Ct,Kt.offset-=Je):Kt.node==we.parentNode&&Kt.offset>pt(we)&&++Kt.offset;return Ct}function ge(we){if(we.nodeType==9)return we;if(typeof we.ownerDocument!=ne)return we.ownerDocument;if(typeof we.document!=ne)return we.document;if(we.parentNode)return ge(we.parentNode);throw ie.createError("getDocument: no document found for node")}function Te(we){var Je=ge(we);if(typeof Je.defaultView!=ne)return Je.defaultView;if(typeof Je.parentWindow!=ne)return Je.parentWindow;throw ie.createError("Cannot get a window object for node")}function Le(we){if(typeof we.contentDocument!=ne)return we.contentDocument;if(typeof we.contentWindow!=ne)return we.contentWindow.document;throw ie.createError("getIframeDocument: No Document object found for iframe element")}function Ue(we){if(typeof we.contentWindow!=ne)return we.contentWindow;if(typeof we.contentDocument!=ne)return we.contentDocument.defaultView;throw ie.createError("getIframeWindow: No Window object found for iframe element")}function tt(we){return we&&fe.isHostMethod(we,"setTimeout")&&fe.isHostObject(we,"document")}function vt(we,Je,ft){var Ct;if(we?fe.isHostProperty(we,"nodeType")?Ct=we.nodeType==1&&we.tagName.toLowerCase()=="iframe"?Le(we):ge(we):tt(we)&&(Ct=we.document):Ct=document,!Ct)throw Je.createError(ft+"(): Parameter must be a Window object or DOM node");return Ct}function bt(we){for(var Je;Je=we.parentNode;)we=Je;return we}function Lt(we,Je,ft,Ct){var Ft,Kt,rr,bn,Un;if(we==ft)return Je===Ct?0:Je<Ct?-1:1;if(Ft=F(ft,we,!0))return Je<=pt(Ft)?-1:1;if(Ft=F(we,ft,!0))return pt(Ft)<Ct?-1:1;if(Kt=Qt(we,ft),!Kt)throw new Error("comparePoints error: nodes have no common ancestor");if(rr=we===Kt?Kt:F(we,Kt,!0),bn=ft===Kt?Kt:F(ft,Kt,!0),rr===bn)throw ie.createError("comparePoints got to case 4 and childA and childB are the same!");for(Un=Kt.firstChild;Un;){if(Un===rr)return-1;if(Un===bn)return 1;Un=Un.nextSibling}}var Qe=!1;function ht(we){var Je;try{return Je=we.parentNode,!1}catch{return!0}}(function(){var we=document.createElement("b");we.innerHTML="1";var Je=we.firstChild;we.innerHTML="<br />",Qe=ht(Je),K.features.crashyTextNodes=Qe})();function Rt(we){if(!we)return"[No node]";if(Qe&&ht(we))return"[Broken node]";if(Z(we))return'"'+we.data+'"';if(we.nodeType==1){var Je=we.id?' id="'+we.id+'"':"";return"<"+we.nodeName+Je+">[index:"+pt(we)+",length:"+we.childNodes.length+"]["+(we.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return we.nodeName}function st(we){for(var Je=ge(we).createDocumentFragment(),ft;ft=we.firstChild;)Je.appendChild(ft);return Je}var cn;typeof window.getComputedStyle!=ne?cn=function(we,Je){return Te(we).getComputedStyle(we,null)[Je]}:typeof document.documentElement.currentStyle!=ne?cn=function(we,Je){return we.currentStyle?we.currentStyle[Je]:""}:ie.fail("No means of obtaining computed style properties found");function Ne(we,Je,ft){var Ct=he(we),Ft=we.createElement("div");Ft.contentEditable=""+!!ft,Je&&(Ft.innerHTML=Je);var Kt=Ct.firstChild;return Kt?Ct.insertBefore(Ft,Kt):Ct.appendChild(Ft),Ft}function it(we){return we.parentNode.removeChild(we)}function ct(we){this.root=we,this._next=we}ct.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var we=this._current=this._next,Je,ft;if(this._current)if(Je=we.firstChild,Je)this._next=Je;else{for(ft=null;we!==this.root&&!(ft=we.nextSibling);)we=we.parentNode;this._next=ft}return this._current},detach:function(){this._current=this._next=this.root=null}};function Xe(we){return new ct(we)}function et(we,Je){this.node=we,this.offset=Je}et.prototype={equals:function(we){return!!we&&this.node===we.node&&this.offset==we.offset},inspect:function(){return"[DomPosition("+Rt(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function lt(we){this.code=this[we],this.codeName=we,this.message="DOMException: "+this.codeName}lt.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},lt.prototype.toString=function(){return this.message},K.dom={arrayContains:Ze,isHtmlNamespace:We,parentElement:St,getNodeIndex:pt,getNodeLength:Ht,getCommonAncestor:Qt,isAncestorOf:te,isOrIsAncestorOf:A,getClosestAncestorIn:F,isCharacterDataNode:Z,isTextOrCommentNode:J,insertAfter:se,splitDataNode:oe,getDocument:ge,getWindow:Te,getIframeWindow:Ue,getIframeDocument:Le,getBody:he,isWindow:tt,getContentDocument:vt,getRootContainer:bt,comparePoints:Lt,isBrokenNode:ht,inspectNode:Rt,getComputedStyleProperty:cn,createTestElement:Ne,removeNode:it,fragmentFromNodeChildren:st,createIterator:Xe,DomPosition:et},K.DOMException=lt}),I.createCoreModule("DomRange",["DomUtil"],function(K,ie){var ne=K.dom,fe=K.util,he=ne.DomPosition,be=K.DOMException,xe=ne.isCharacterDataNode,Ze=ne.getNodeIndex,We=ne.isOrIsAncestorOf,St=ne.getDocument,pt=ne.comparePoints,Ht=ne.splitDataNode,Qt=ne.getClosestAncestorIn,te=ne.getNodeLength,A=ne.arrayContains,F=ne.getRootContainer,Z=K.features.crashyTextNodes,J=ne.removeNode;function se(ee,P){return ee.nodeType!=3&&(We(ee,P.startContainer)||We(ee,P.endContainer))}function oe(ee){return ee.document||St(ee.startContainer)}function ge(ee){return F(ee.startContainer)}function Te(ee){return new he(ee.parentNode,Ze(ee))}function Le(ee){return new he(ee.parentNode,Ze(ee)+1)}function Ue(ee,P,Y){var ye=ee.nodeType==11?ee.firstChild:ee;return xe(P)?Y==P.length?ne.insertAfter(ee,P):P.parentNode.insertBefore(ee,Y==0?P:Ht(P,Y)):Y>=P.childNodes.length?P.appendChild(ee):P.insertBefore(ee,P.childNodes[Y]),ye}function tt(ee,P,Y){if(en(ee),en(P),oe(P)!=oe(ee))throw new be("WRONG_DOCUMENT_ERR");var ye=pt(ee.startContainer,ee.startOffset,P.endContainer,P.endOffset),Pe=pt(ee.endContainer,ee.endOffset,P.startContainer,P.startOffset);return Y?ye<=0&&Pe>=0:ye<0&&Pe>0}function vt(ee){for(var P,Y,ye=oe(ee.range).createDocumentFragment(),Pe;Y=ee.next();){if(P=ee.isPartiallySelectedSubtree(),Y=Y.cloneNode(!P),P&&(Pe=ee.getSubtreeIterator(),Y.appendChild(vt(Pe)),Pe.detach()),Y.nodeType==10)throw new be("HIERARCHY_REQUEST_ERR");ye.appendChild(Y)}return ye}function bt(ee,P,Y){var ye,Pe;Y=Y||{stop:!1};for(var Ee,Me;Ee=ee.next();)if(ee.isPartiallySelectedSubtree()){if(P(Ee)===!1){Y.stop=!0;return}else if(Me=ee.getSubtreeIterator(),bt(Me,P,Y),Me.detach(),Y.stop)return}else for(ye=ne.createIterator(Ee);Pe=ye.next();)if(P(Pe)===!1){Y.stop=!0;return}}function Lt(ee){for(var P;ee.next();)ee.isPartiallySelectedSubtree()?(P=ee.getSubtreeIterator(),Lt(P),P.detach()):ee.remove()}function Qe(ee){for(var P,Y=oe(ee.range).createDocumentFragment(),ye;P=ee.next();){if(ee.isPartiallySelectedSubtree()?(P=P.cloneNode(!1),ye=ee.getSubtreeIterator(),P.appendChild(Qe(ye)),ye.detach()):ee.remove(),P.nodeType==10)throw new be("HIERARCHY_REQUEST_ERR");Y.appendChild(P)}return Y}function ht(ee,P,Y){var ye=!!(P&&P.length),Pe,Ee=!!Y;ye&&(Pe=new RegExp("^("+P.join("|")+")$"));var Me=[];return bt(new st(ee,!1),function(ot){if(!(ye&&!Pe.test(ot.nodeType))&&!(Ee&&!Y(ot))){var wt=ee.startContainer;if(!(ot==wt&&xe(wt)&&ee.startOffset==wt.length)){var Pt=ee.endContainer;ot==Pt&&xe(Pt)&&ee.endOffset==0||Me.push(ot)}}}),Me}function Rt(ee){var P=typeof ee.getName>"u"?"Range":ee.getName();return"["+P+"("+ne.inspectNode(ee.startContainer)+":"+ee.startOffset+", "+ne.inspectNode(ee.endContainer)+":"+ee.endOffset+")]"}function st(ee,P){if(this.range=ee,this.clonePartiallySelectedTextNodes=P,!ee.collapsed){this.sc=ee.startContainer,this.so=ee.startOffset,this.ec=ee.endContainer,this.eo=ee.endOffset;var Y=ee.commonAncestorContainer;this.sc===this.ec&&xe(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===Y&&!xe(this.sc)?this.sc.childNodes[this.so]:Qt(this.sc,Y,!0),this._last=this.ec===Y&&!xe(this.ec)?this.ec.childNodes[this.eo-1]:Qt(this.ec,Y,!0))}}st.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var ee=this._current=this._next;return ee&&(this._next=ee!==this._last?ee.nextSibling:null,xe(ee)&&this.clonePartiallySelectedTextNodes&&(ee===this.ec&&(ee=ee.cloneNode(!0)).deleteData(this.eo,ee.length-this.eo),this._current===this.sc&&(ee=ee.cloneNode(!0)).deleteData(0,this.so))),ee},remove:function(){var ee=this._current,P,Y;xe(ee)&&(ee===this.sc||ee===this.ec)?(P=ee===this.sc?this.so:0,Y=ee===this.ec?this.eo:ee.length,P!=Y&&ee.deleteData(P,Y-P)):ee.parentNode&&J(ee)},isPartiallySelectedSubtree:function(){var ee=this._current;return se(ee,this.range)},getSubtreeIterator:function(){var ee;if(this.isSingleCharacterDataNode)ee=this.range.cloneRange(),ee.collapse(!1);else{ee=new yn(oe(this.range));var P=this._current,Y=P,ye=0,Pe=P,Ee=te(P);We(P,this.sc)&&(Y=this.sc,ye=this.so),We(P,this.ec)&&(Pe=this.ec,Ee=this.eo),Ut(ee,Y,ye,Pe,Ee)}return new st(ee,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var cn=[1,3,4,5,7,8,10],Ne=[2,9,11],it=[5,6,10,12],ct=[1,3,4,5,7,8,10,11],Xe=[1,3,4,5,7,8];function et(ee){return function(P,Y){for(var ye,Pe=Y?P:P.parentNode;Pe;){if(ye=Pe.nodeType,A(ee,ye))return Pe;Pe=Pe.parentNode}return null}}var lt=et([9,11]),we=et(it),Je=et([6,10,12]),ft=et([1]);function Ct(ee,P){if(Je(ee,P))throw new be("INVALID_NODE_TYPE_ERR")}function Ft(ee,P){if(!A(P,ee.nodeType))throw new be("INVALID_NODE_TYPE_ERR")}function Kt(ee,P){if(P<0||P>(xe(ee)?ee.length:ee.childNodes.length))throw new be("INDEX_SIZE_ERR")}function rr(ee,P){if(lt(ee,!0)!==lt(P,!0))throw new be("WRONG_DOCUMENT_ERR")}function bn(ee){if(we(ee,!0))throw new be("NO_MODIFICATION_ALLOWED_ERR")}function Un(ee,P){if(!ee)throw new be(P)}function Qr(ee,P){return P<=(xe(ee)?ee.length:ee.childNodes.length)}function ei(ee){return!!ee.startContainer&&!!ee.endContainer&&!(Z&&(ne.isBrokenNode(ee.startContainer)||ne.isBrokenNode(ee.endContainer)))&&F(ee.startContainer)==F(ee.endContainer)&&Qr(ee.startContainer,ee.startOffset)&&Qr(ee.endContainer,ee.endOffset)}function en(ee){if(!ei(ee))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+ee.inspect()+")")}var Tr=document.createElement("style"),Pn=!1;try{Tr.innerHTML="<b>x</b>",Pn=Tr.firstChild.nodeType==3}catch{}K.features.htmlParsingConforms=Pn;var Dr=Pn?function(ee){var P=this.startContainer,Y=St(P);if(!P)throw new be("INVALID_STATE_ERR");var ye=null;return P.nodeType==1?ye=P:xe(P)&&(ye=ne.parentElement(P)),ye===null||ye.nodeName=="HTML"&&ne.isHtmlNamespace(St(ye).documentElement)&&ne.isHtmlNamespace(ye)?ye=Y.createElement("body"):ye=ye.cloneNode(!1),ye.innerHTML=ee,ne.fragmentFromNodeChildren(ye)}:function(ee){var P=oe(this),Y=P.createElement("body");return Y.innerHTML=ee,ne.fragmentFromNodeChildren(Y)};function hi(ee,P){en(ee);var Y=ee.startContainer,ye=ee.startOffset,Pe=ee.endContainer,Ee=ee.endOffset,Me=Y===Pe;xe(Pe)&&Ee>0&&Ee<Pe.length&&Ht(Pe,Ee,P),xe(Y)&&ye>0&&ye<Y.length&&(Y=Ht(Y,ye,P),Me?(Ee-=ye,Pe=Y):Pe==Y.parentNode&&Ee>=Ze(Y)&&Ee++,ye=0),ee.setStartAndEnd(Y,ye,Pe,Ee)}function Tt(ee){en(ee);var P=ee.commonAncestorContainer.parentNode.cloneNode(!1);return P.appendChild(ee.cloneContents()),P.innerHTML}var Ii=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Vr=0,Vn=1,cr=2,fr=3,Lr=0,ti=1,Pr=2,Wr=3;fe.extend(K.rangePrototype,{compareBoundaryPoints:function(ee,P){en(this),rr(this.startContainer,P.startContainer);var Y,ye,Pe,Ee,Me=ee==fr||ee==Vr?"start":"end",ot=ee==Vn||ee==Vr?"start":"end";return Y=this[Me+"Container"],ye=this[Me+"Offset"],Pe=P[ot+"Container"],Ee=P[ot+"Offset"],pt(Y,ye,Pe,Ee)},insertNode:function(ee){if(en(this),Ft(ee,ct),bn(this.startContainer),We(ee,this.startContainer))throw new be("HIERARCHY_REQUEST_ERR");var P=Ue(ee,this.startContainer,this.startOffset);this.setStartBefore(P)},cloneContents:function(){en(this);var ee,P;if(this.collapsed)return oe(this).createDocumentFragment();if(this.startContainer===this.endContainer&&xe(this.startContainer))return ee=this.startContainer.cloneNode(!0),ee.data=ee.data.slice(this.startOffset,this.endOffset),P=oe(this).createDocumentFragment(),P.appendChild(ee),P;var Y=new st(this,!0);return ee=vt(Y),Y.detach(),ee},canSurroundContents:function(){en(this),bn(this.startContainer),bn(this.endContainer);var ee=new st(this,!0),P=ee._first&&se(ee._first,this)||ee._last&&se(ee._last,this);return ee.detach(),!P},surroundContents:function(ee){if(Ft(ee,Xe),!this.canSurroundContents())throw new be("INVALID_STATE_ERR");var P=this.extractContents();if(ee.hasChildNodes())for(;ee.lastChild;)ee.removeChild(ee.lastChild);Ue(ee,this.startContainer,this.startOffset),ee.appendChild(P),this.selectNode(ee)},cloneRange:function(){en(this);for(var ee=new yn(oe(this)),P=Ii.length,Y;P--;)Y=Ii[P],ee[Y]=this[Y];return ee},toString:function(){en(this);var ee=this.startContainer;if(ee===this.endContainer&&xe(ee))return ee.nodeType==3||ee.nodeType==4?ee.data.slice(this.startOffset,this.endOffset):"";var P=[],Y=new st(this,!0);return bt(Y,function(ye){(ye.nodeType==3||ye.nodeType==4)&&P.push(ye.data)}),Y.detach(),P.join("")},compareNode:function(ee){en(this);var P=ee.parentNode,Y=Ze(ee);if(!P)throw new be("NOT_FOUND_ERR");var ye=this.comparePoint(P,Y),Pe=this.comparePoint(P,Y+1);return ye<0?Pe>0?Pr:Lr:Pe>0?ti:Wr},comparePoint:function(ee,P){return en(this),Un(ee,"HIERARCHY_REQUEST_ERR"),rr(ee,this.startContainer),pt(ee,P,this.startContainer,this.startOffset)<0?-1:pt(ee,P,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Dr,toHtml:function(){return Tt(this)},intersectsNode:function(ee,P){if(en(this),F(ee)!=ge(this))return!1;var Y=ee.parentNode,ye=Ze(ee);if(!Y)return!0;var Pe=pt(Y,ye,this.endContainer,this.endOffset),Ee=pt(Y,ye+1,this.startContainer,this.startOffset);return P?Pe<=0&&Ee>=0:Pe<0&&Ee>0},isPointInRange:function(ee,P){return en(this),Un(ee,"HIERARCHY_REQUEST_ERR"),rr(ee,this.startContainer),pt(ee,P,this.startContainer,this.startOffset)>=0&&pt(ee,P,this.endContainer,this.endOffset)<=0},intersectsRange:function(ee){return tt(this,ee,!1)},intersectsOrTouchesRange:function(ee){return tt(this,ee,!0)},intersection:function(ee){if(this.intersectsRange(ee)){var P=pt(this.startContainer,this.startOffset,ee.startContainer,ee.startOffset),Y=pt(this.endContainer,this.endOffset,ee.endContainer,ee.endOffset),ye=this.cloneRange();return P==-1&&ye.setStart(ee.startContainer,ee.startOffset),Y==1&&ye.setEnd(ee.endContainer,ee.endOffset),ye}return null},union:function(ee){if(this.intersectsOrTouchesRange(ee)){var P=this.cloneRange();return pt(ee.startContainer,ee.startOffset,this.startContainer,this.startOffset)==-1&&P.setStart(ee.startContainer,ee.startOffset),pt(ee.endContainer,ee.endOffset,this.endContainer,this.endOffset)==1&&P.setEnd(ee.endContainer,ee.endOffset),P}else throw new be("Ranges do not intersect")},containsNode:function(ee,P){return P?this.intersectsNode(ee,!1):this.compareNode(ee)==Wr},containsNodeContents:function(ee){return this.comparePoint(ee,0)>=0&&this.comparePoint(ee,te(ee))<=0},containsRange:function(ee){var P=this.intersection(ee);return P!==null&&ee.equals(P)},containsNodeText:function(ee){var P=this.cloneRange();P.selectNode(ee);var Y=P.getNodes([3]);if(Y.length>0){P.setStart(Y[0],0);var ye=Y.pop();return P.setEnd(ye,ye.length),this.containsRange(P)}else return this.containsNodeContents(ee)},getNodes:function(ee,P){return en(this),ht(this,ee,P)},getDocument:function(){return oe(this)},collapseBefore:function(ee){this.setEndBefore(ee),this.collapse(!1)},collapseAfter:function(ee){this.setStartAfter(ee),this.collapse(!0)},getBookmark:function(ee){var P=oe(this),Y=K.createRange(P);ee=ee||ne.getBody(P),Y.selectNodeContents(ee);var ye=this.intersection(Y),Pe=0,Ee=0;return ye&&(Y.setEnd(ye.startContainer,ye.startOffset),Pe=Y.toString().length,Ee=Pe+ye.toString().length),{start:Pe,end:Ee,containerNode:ee}},moveToBookmark:function(ee){var P=ee.containerNode,Y=0;this.setStart(P,0),this.collapse(!0);for(var ye=[P],Pe,Ee=!1,Me=!1,ot,wt,Pt;!Me&&(Pe=ye.pop());)if(Pe.nodeType==3)ot=Y+Pe.length,!Ee&&ee.start>=Y&&ee.start<=ot&&(this.setStart(Pe,ee.start-Y),Ee=!0),Ee&&ee.end>=Y&&ee.end<=ot&&(this.setEnd(Pe,ee.end-Y),Me=!0),Y=ot;else for(Pt=Pe.childNodes,wt=Pt.length;wt--;)ye.push(Pt[wt])},getName:function(){return"DomRange"},equals:function(ee){return yn.rangesEqual(this,ee)},isValid:function(){return ei(this)},inspect:function(){return Rt(this)},detach:function(){}});function Q(ee){ee.START_TO_START=Vr,ee.START_TO_END=Vn,ee.END_TO_END=cr,ee.END_TO_START=fr,ee.NODE_BEFORE=Lr,ee.NODE_AFTER=ti,ee.NODE_BEFORE_AND_AFTER=Pr,ee.NODE_INSIDE=Wr}function Oe(ee){Q(ee),Q(ee.prototype)}function Ye(ee,P){return function(){en(this);var Y=this.startContainer,ye=this.startOffset,Pe=this.commonAncestorContainer,Ee=new st(this,!0),Me,ot;Y!==Pe&&(Me=Qt(Y,Pe,!0),ot=Le(Me),Y=ot.node,ye=ot.offset),bt(Ee,bn),Ee.reset();var wt=ee(Ee);return Ee.detach(),P(this,Y,ye,Y,ye),wt}}function at(ee,P){function Y(Me,ot){return function(wt){Ft(wt,cn),Ft(F(wt),Ne);var Pt=(Me?Te:Le)(wt);(ot?ye:Pe)(this,Pt.node,Pt.offset)}}function ye(Me,ot,wt){var Pt=Me.endContainer,Rn=Me.endOffset;(ot!==Me.startContainer||wt!==Me.startOffset)&&((F(ot)!=F(Pt)||pt(ot,wt,Pt,Rn)==1)&&(Pt=ot,Rn=wt),P(Me,ot,wt,Pt,Rn))}function Pe(Me,ot,wt){var Pt=Me.startContainer,Rn=Me.startOffset;(ot!==Me.endContainer||wt!==Me.endOffset)&&((F(ot)!=F(Pt)||pt(ot,wt,Pt,Rn)==-1)&&(Pt=ot,Rn=wt),P(Me,Pt,Rn,ot,wt))}var Ee=function(){};Ee.prototype=K.rangePrototype,ee.prototype=new Ee,fe.extend(ee.prototype,{setStart:function(Me,ot){Ct(Me,!0),Kt(Me,ot),ye(this,Me,ot)},setEnd:function(Me,ot){Ct(Me,!0),Kt(Me,ot),Pe(this,Me,ot)},setStartAndEnd:function(){var Me=arguments,ot=Me[0],wt=Me[1],Pt=ot,Rn=wt;switch(Me.length){case 3:Rn=Me[2];break;case 4:Pt=Me[2],Rn=Me[3];break}Ct(ot,!0),Kt(ot,wt),Ct(Pt,!0),Kt(Pt,Rn),P(this,ot,wt,Pt,Rn)},setBoundary:function(Me,ot,wt){this["set"+(wt?"Start":"End")](Me,ot)},setStartBefore:Y(!0,!0),setStartAfter:Y(!1,!0),setEndBefore:Y(!0,!1),setEndAfter:Y(!1,!1),collapse:function(Me){en(this),Me?P(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):P(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(Me){Ct(Me,!0),P(this,Me,0,Me,te(Me))},selectNode:function(Me){Ct(Me,!1),Ft(Me,cn);var ot=Te(Me),wt=Le(Me);P(this,ot.node,ot.offset,wt.node,wt.offset)},extractContents:Ye(Qe,P),deleteContents:Ye(Lt,P),canSurroundContents:function(){en(this),bn(this.startContainer),bn(this.endContainer);var Me=new st(this,!0),ot=Me._first&&se(Me._first,this)||Me._last&&se(Me._last,this);return Me.detach(),!ot},splitBoundaries:function(){hi(this)},splitBoundariesPreservingPositions:function(Me){hi(this,Me)},normalizeBoundaries:function(){en(this);var Me=this.startContainer,ot=this.startOffset,wt=this.endContainer,Pt=this.endOffset,Rn=function(xn){var Gr=xn.nextSibling;Gr&&Gr.nodeType==xn.nodeType&&(wt=xn,Pt=xn.length,xn.appendData(Gr.data),J(Gr))},Rs=function(xn){var Gr=xn.previousSibling;if(Gr&&Gr.nodeType==xn.nodeType){Me=xn;var lu=xn.length;if(ot=Gr.length,xn.insertData(0,Gr.data),J(Gr),Me==wt)Pt+=ot,wt=Me;else if(wt==xn.parentNode){var co=Ze(xn);Pt==co?(wt=xn,Pt=lu):Pt>co&&Pt--}}},Bt=!0,Rr;if(xe(wt))Pt==wt.length?Rn(wt):Pt==0&&(Rr=wt.previousSibling,Rr&&Rr.nodeType==wt.nodeType&&(Pt=Rr.length,Me==wt&&(Bt=!1),Rr.appendData(wt.data),J(wt),wt=Rr));else{if(Pt>0){var wa=wt.childNodes[Pt-1];wa&&xe(wa)&&Rn(wa)}Bt=!this.collapsed}if(Bt){if(xe(Me))ot==0?Rs(Me):ot==Me.length&&(Rr=Me.nextSibling,Rr&&Rr.nodeType==Me.nodeType&&(wt==Rr&&(wt=Me,Pt+=Me.length),Me.appendData(Rr.data),J(Rr)));else if(ot<Me.childNodes.length){var uo=Me.childNodes[ot];uo&&xe(uo)&&Rs(uo)}}else Me=wt,ot=Pt;P(this,Me,ot,wt,Pt)},collapseToPoint:function(Me,ot){Ct(Me,!0),Kt(Me,ot),this.setStartAndEnd(Me,ot)},parentElement:function(){en(this);var Me=this.commonAncestorContainer;return Me?ft(this.commonAncestorContainer,!0):null}}),Oe(ee)}function Ke(ee){ee.collapsed=ee.startContainer===ee.endContainer&&ee.startOffset===ee.endOffset,ee.commonAncestorContainer=ee.collapsed?ee.startContainer:ne.getCommonAncestor(ee.startContainer,ee.endContainer)}function Ut(ee,P,Y,ye,Pe){ee.startContainer=P,ee.startOffset=Y,ee.endContainer=ye,ee.endOffset=Pe,ee.document=ne.getDocument(P),Ke(ee)}function yn(ee){Ut(this,ee,0,ee,0)}at(yn,Ut),fe.extend(yn,{rangeProperties:Ii,RangeIterator:st,copyComparisonConstants:Oe,createPrototypeRange:at,inspect:Rt,toHtml:Tt,getRangeDocument:oe,rangesEqual:function(ee,P){return ee.startContainer===P.startContainer&&ee.startOffset===P.startOffset&&ee.endContainer===P.endContainer&&ee.endOffset===P.endOffset}}),K.DomRange=yn}),I.createCoreModule("WrappedRange",["DomRange"],function(K,ie){var ne,fe,he=K.dom,be=K.util,xe=he.DomPosition,Ze=K.DomRange,We=he.getBody,St=he.getContentDocument,pt=he.isCharacterDataNode;if(K.features.implementsDomRange&&function(){var J,se=Ze.rangeProperties;function oe(Qe){for(var ht=se.length,Rt;ht--;)Rt=se[ht],Qe[Rt]=Qe.nativeRange[Rt];Qe.collapsed=Qe.startContainer===Qe.endContainer&&Qe.startOffset===Qe.endOffset}function ge(Qe,ht,Rt,st,cn){var Ne=Qe.startContainer!==ht||Qe.startOffset!=Rt,it=Qe.endContainer!==st||Qe.endOffset!=cn,ct=!Qe.equals(Qe.nativeRange);(Ne||it||ct)&&(Qe.setEnd(st,cn),Qe.setStart(ht,Rt))}var Te;ne=function(Qe){if(!Qe)throw ie.createError("WrappedRange: Range must be specified");this.nativeRange=Qe,oe(this)},Ze.createPrototypeRange(ne,ge),J=ne.prototype,J.selectNode=function(Qe){this.nativeRange.selectNode(Qe),oe(this)},J.cloneContents=function(){return this.nativeRange.cloneContents()},J.surroundContents=function(Qe){this.nativeRange.surroundContents(Qe),oe(this)},J.collapse=function(Qe){this.nativeRange.collapse(Qe),oe(this)},J.cloneRange=function(){return new ne(this.nativeRange.cloneRange())},J.refresh=function(){oe(this)},J.toString=function(){return this.nativeRange.toString()};var Le=document.createTextNode("test");We(document).appendChild(Le);var Ue=document.createRange();Ue.setStart(Le,0),Ue.setEnd(Le,0);try{Ue.setStart(Le,1),J.setStart=function(Qe,ht){this.nativeRange.setStart(Qe,ht),oe(this)},J.setEnd=function(Qe,ht){this.nativeRange.setEnd(Qe,ht),oe(this)},Te=function(Qe){return function(ht){this.nativeRange[Qe](ht),oe(this)}}}catch{J.setStart=function(ht,Rt){try{this.nativeRange.setStart(ht,Rt)}catch{this.nativeRange.setEnd(ht,Rt),this.nativeRange.setStart(ht,Rt)}oe(this)},J.setEnd=function(ht,Rt){try{this.nativeRange.setEnd(ht,Rt)}catch{this.nativeRange.setStart(ht,Rt),this.nativeRange.setEnd(ht,Rt)}oe(this)},Te=function(ht,Rt){return function(st){try{this.nativeRange[ht](st)}catch{this.nativeRange[Rt](st),this.nativeRange[ht](st)}oe(this)}}}J.setStartBefore=Te("setStartBefore","setEndBefore"),J.setStartAfter=Te("setStartAfter","setEndAfter"),J.setEndBefore=Te("setEndBefore","setStartBefore"),J.setEndAfter=Te("setEndAfter","setStartAfter"),J.selectNodeContents=function(Qe){this.setStartAndEnd(Qe,0,he.getNodeLength(Qe))},Ue.selectNodeContents(Le),Ue.setEnd(Le,3);var tt=document.createRange();tt.selectNodeContents(Le),tt.setEnd(Le,4),tt.setStart(Le,2),Ue.compareBoundaryPoints(Ue.START_TO_END,tt)==-1&&Ue.compareBoundaryPoints(Ue.END_TO_START,tt)==1?J.compareBoundaryPoints=function(Qe,ht){return ht=ht.nativeRange||ht,Qe==ht.START_TO_END?Qe=ht.END_TO_START:Qe==ht.END_TO_START&&(Qe=ht.START_TO_END),this.nativeRange.compareBoundaryPoints(Qe,ht)}:J.compareBoundaryPoints=function(Qe,ht){return this.nativeRange.compareBoundaryPoints(Qe,ht.nativeRange||ht)};var vt=document.createElement("div");vt.innerHTML="123";var bt=vt.firstChild,Lt=We(document);Lt.appendChild(vt),Ue.setStart(bt,1),Ue.setEnd(bt,2),Ue.deleteContents(),bt.data=="13"&&(J.deleteContents=function(){this.nativeRange.deleteContents(),oe(this)},J.extractContents=function(){var Qe=this.nativeRange.extractContents();return oe(this),Qe}),Lt.removeChild(vt),Lt=null,be.isHostMethod(Ue,"createContextualFragment")&&(J.createContextualFragment=function(Qe){return this.nativeRange.createContextualFragment(Qe)}),We(document).removeChild(Le),J.getName=function(){return"WrappedRange"},K.WrappedRange=ne,K.createNativeRange=function(Qe){return Qe=St(Qe,ie,"createNativeRange"),Qe.createRange()}}(),K.features.implementsTextRange){var Ht=function(J){var se=J.parentElement(),oe=J.duplicate();oe.collapse(!0);var ge=oe.parentElement();oe=J.duplicate(),oe.collapse(!1);var Te=oe.parentElement(),Le=ge==Te?ge:he.getCommonAncestor(ge,Te);return Le==se?Le:he.getCommonAncestor(se,Le)},Qt=function(J){return J.compareEndPoints("StartToEnd",J)==0},te=function(J,se,oe,ge,Te){var Le=J.duplicate();Le.collapse(oe);var Ue=Le.parentElement();if(he.isOrIsAncestorOf(se,Ue)||(Ue=se),!Ue.canHaveHTML){var tt=new xe(Ue.parentNode,he.getNodeIndex(Ue));return{boundaryPosition:tt,nodeInfo:{nodeIndex:tt.offset,containerElement:tt.node}}}var vt=he.getDocument(Ue).createElement("span");vt.parentNode&&he.removeNode(vt);for(var bt,Lt=oe?"StartToStart":"StartToEnd",Qe,ht,Rt,st,cn=Te&&Te.containerElement==Ue?Te.nodeIndex:0,Ne=Ue.childNodes.length,it=Ne,ct=it;ct==Ne?Ue.appendChild(vt):Ue.insertBefore(vt,Ue.childNodes[ct]),Le.moveToElementText(vt),bt=Le.compareEndPoints(Lt,J),!(bt==0||cn==it);){if(bt==-1){if(it==cn+1)break;cn=ct}else it=it==cn+1?cn:ct;ct=Math.floor((cn+it)/2),Ue.removeChild(vt)}if(st=vt.nextSibling,bt==-1&&st&&pt(st)){Le.setEndPoint(oe?"EndToStart":"EndToEnd",J);var Xe;if(/[\r\n]/.test(st.data)){var et=Le.duplicate(),lt=et.text.replace(/\r\n/g,"\r").length;for(Xe=et.moveStart("character",lt);(bt=et.compareEndPoints("StartToEnd",et))==-1;)Xe++,et.moveStart("character",1)}else Xe=Le.text.length;Rt=new xe(st,Xe)}else Qe=(ge||!oe)&&vt.previousSibling,ht=(ge||oe)&&vt.nextSibling,ht&&pt(ht)?Rt=new xe(ht,0):Qe&&pt(Qe)?Rt=new xe(Qe,Qe.data.length):Rt=new xe(Ue,he.getNodeIndex(vt));return he.removeNode(vt),{boundaryPosition:Rt,nodeInfo:{nodeIndex:ct,containerElement:Ue}}},A=function(J,se){var oe,ge,Te=J.offset,Le=he.getDocument(J.node),Ue,tt,vt=We(Le).createTextRange(),bt=pt(J.node);return bt?(oe=J.node,ge=oe.parentNode):(tt=J.node.childNodes,oe=Te<tt.length?tt[Te]:null,ge=J.node),Ue=Le.createElement("span"),Ue.innerHTML="&#feff;",oe?ge.insertBefore(Ue,oe):ge.appendChild(Ue),vt.moveToElementText(Ue),vt.collapse(!se),ge.removeChild(Ue),bt&&vt[se?"moveStart":"moveEnd"]("character",Te),vt};fe=function(J){this.textRange=J,this.refresh()},fe.prototype=new Ze(document),fe.prototype.refresh=function(){var J,se,oe,ge=Ht(this.textRange);Qt(this.textRange)?se=J=te(this.textRange,ge,!0,!0).boundaryPosition:(oe=te(this.textRange,ge,!0,!1),J=oe.boundaryPosition,se=te(this.textRange,ge,!1,!1,oe.nodeInfo).boundaryPosition),this.setStart(J.node,J.offset),this.setEnd(se.node,se.offset)},fe.prototype.getName=function(){return"WrappedTextRange"},Ze.copyComparisonConstants(fe);var F=function(J){if(J.collapsed)return A(new xe(J.startContainer,J.startOffset),!0);var se=A(new xe(J.startContainer,J.startOffset),!0),oe=A(new xe(J.endContainer,J.endOffset),!1),ge=We(Ze.getRangeDocument(J)).createTextRange();return ge.setEndPoint("StartToStart",se),ge.setEndPoint("EndToEnd",oe),ge};if(fe.rangeToTextRange=F,fe.prototype.toTextRange=function(){return F(this)},K.WrappedTextRange=fe,!K.features.implementsDomRange||K.config.preferTextRange){var Z=function(J){return J("return this;")()}(Function);typeof Z.Range>"u"&&(Z.Range=fe),K.createNativeRange=function(J){return J=St(J,ie,"createNativeRange"),We(J).createTextRange()},K.WrappedRange=fe}}K.createRange=function(J){return J=St(J,ie,"createRange"),new K.WrappedRange(K.createNativeRange(J))},K.createRangyRange=function(J){return J=St(J,ie,"createRangyRange"),new Ze(J)},be.createAliasForDeprecatedMethod(K,"createIframeRange","createRange"),be.createAliasForDeprecatedMethod(K,"createIframeRangyRange","createRangyRange"),K.addShimListener(function(J){var se=J.document;typeof se.createRange>"u"&&(se.createRange=function(){return K.createRange(se)}),se=J=null})}),I.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(K,ie){K.config.checkSelectionRanges=!0;var ne="boolean",fe="number",he=K.dom,be=K.util,xe=be.isHostMethod,Ze=K.DomRange,We=K.WrappedRange,St=K.DOMException,pt=he.DomPosition,Ht,Qt,te=K.features,A="Control",F=he.getDocument,Z=he.getBody,J=Ze.rangesEqual;function se(Q){return typeof Q=="string"?/^backward(s)?$/i.test(Q):!!Q}function oe(Q,Oe){if(Q){if(he.isWindow(Q))return Q;if(Q instanceof en)return Q.win;var Ye=he.getContentDocument(Q,ie,Oe);return he.getWindow(Ye)}else return window}function ge(Q){return oe(Q,"getWinSelection").getSelection()}function Te(Q){return oe(Q,"getDocSelection").document.selection}function Le(Q){var Oe=!1;return Q.anchorNode&&(Oe=he.comparePoints(Q.anchorNode,Q.anchorOffset,Q.focusNode,Q.focusOffset)==1),Oe}var Ue=xe(window,"getSelection"),tt=be.isHostObject(document,"selection");te.implementsWinGetSelection=Ue,te.implementsDocSelection=tt;var vt=tt&&(!Ue||K.config.preferTextRange);if(vt)Ht=Te,K.isSelectionValid=function(Q){var Oe=oe(Q,"isSelectionValid").document,Ye=Oe.selection;return Ye.type!="None"||F(Ye.createRange().parentElement())==Oe};else if(Ue)Ht=ge,K.isSelectionValid=function(){return!0};else return ie.fail("Neither document.selection or window.getSelection() detected."),!1;K.getNativeSelection=Ht;var bt=Ht();if(!bt)return ie.fail("Native selection was null (possibly issue 138?)"),!1;var Lt=K.createNativeRange(document),Qe=Z(document),ht=be.areHostProperties(bt,["anchorNode","focusNode","anchorOffset","focusOffset"]);te.selectionHasAnchorAndFocus=ht;var Rt=xe(bt,"extend");te.selectionHasExtend=Rt;var st=xe(bt,"setBaseAndExtent");te.selectionHasSetBaseAndExtent=st;var cn=typeof bt.rangeCount==fe;te.selectionHasRangeCount=cn;var Ne=!1,it=!0,ct=Rt?function(Q,Oe){var Ye=Ze.getRangeDocument(Oe),at=K.createRange(Ye);at.collapseToPoint(Oe.endContainer,Oe.endOffset),Q.addRange(Ct(at)),Q.extend(Oe.startContainer,Oe.startOffset)}:null;be.areHostMethods(bt,["addRange","getRangeAt","removeAllRanges"])&&typeof bt.rangeCount==fe&&te.implementsDomRange&&function(){var Q=window.getSelection();if(Q){for(var Oe=Q.rangeCount,Ye=Oe>1,at=[],Ke=Le(Q),Ut=0;Ut<Oe;++Ut)at[Ut]=Q.getRangeAt(Ut);var yn=he.createTestElement(document,"",!1),ee=yn.appendChild(document.createTextNode("   ")),P=document.createRange();if(P.setStart(ee,1),P.collapse(!0),Q.removeAllRanges(),Q.addRange(P),it=Q.rangeCount==1,Q.removeAllRanges(),!Ye){var Y=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(Y&&parseInt(Y[1])>=36)Ne=!1;else{var ye=P.cloneRange();P.setStart(ee,0),ye.setEnd(ee,3),ye.setStart(ee,2),Q.addRange(P),Q.addRange(ye),Ne=Q.rangeCount==2}}for(he.removeNode(yn),Q.removeAllRanges(),Ut=0;Ut<Oe;++Ut)Ut==0&&Ke?ct?ct(Q,at[Ut]):(K.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),Q.addRange(at[Ut])):Q.addRange(at[Ut])}}(),te.selectionSupportsMultipleRanges=Ne,te.collapsedNonEditableSelectionsSupported=it;var Xe=!1,et;Qe&&xe(Qe,"createControlRange")&&(et=Qe.createControlRange(),be.areHostProperties(et,["item","add"])&&(Xe=!0)),te.implementsControlRange=Xe,ht?Qt=function(Q){return Q.anchorNode===Q.focusNode&&Q.anchorOffset===Q.focusOffset}:Qt=function(Q){return Q.rangeCount?Q.getRangeAt(Q.rangeCount-1).collapsed:!1};function lt(Q,Oe,Ye){var at=Ye?"end":"start",Ke=Ye?"start":"end";Q.anchorNode=Oe[at+"Container"],Q.anchorOffset=Oe[at+"Offset"],Q.focusNode=Oe[Ke+"Container"],Q.focusOffset=Oe[Ke+"Offset"]}function we(Q){var Oe=Q.nativeSelection;Q.anchorNode=Oe.anchorNode,Q.anchorOffset=Oe.anchorOffset,Q.focusNode=Oe.focusNode,Q.focusOffset=Oe.focusOffset}function Je(Q){Q.anchorNode=Q.focusNode=null,Q.anchorOffset=Q.focusOffset=0,Q.rangeCount=0,Q.isCollapsed=!0,Q._ranges.length=0,ft(Q)}function ft(Q){Q.type=Q.rangeCount==0?"None":Qt(Q)?"Caret":"Range"}function Ct(Q){var Oe;return Q instanceof Ze?(Oe=K.createNativeRange(Q.getDocument()),Oe.setEnd(Q.endContainer,Q.endOffset),Oe.setStart(Q.startContainer,Q.startOffset)):Q instanceof We?Oe=Q.nativeRange:te.implementsDomRange&&Q instanceof he.getWindow(Q.startContainer).Range&&(Oe=Q),Oe}function Ft(Q){if(!Q.length||Q[0].nodeType!=1)return!1;for(var Oe=1,Ye=Q.length;Oe<Ye;++Oe)if(!he.isAncestorOf(Q[0],Q[Oe]))return!1;return!0}function Kt(Q){var Oe=Q.getNodes();if(!Ft(Oe))throw ie.createError("getSingleElementFromRange: range "+Q.inspect()+" did not consist of a single element");return Oe[0]}function rr(Q){return!!Q&&typeof Q.text<"u"}function bn(Q,Oe){var Ye=new We(Oe);Q._ranges=[Ye],lt(Q,Ye,!1),Q.rangeCount=1,Q.isCollapsed=Ye.collapsed,ft(Q)}function Un(Q){if(Q._ranges.length=0,Q.docSelection.type=="None")Je(Q);else{var Oe=Q.docSelection.createRange();if(rr(Oe))bn(Q,Oe);else{Q.rangeCount=Oe.length;for(var Ye,at=F(Oe.item(0)),Ke=0;Ke<Q.rangeCount;++Ke)Ye=K.createRange(at),Ye.selectNode(Oe.item(Ke)),Q._ranges.push(Ye);Q.isCollapsed=Q.rangeCount==1&&Q._ranges[0].collapsed,lt(Q,Q._ranges[Q.rangeCount-1],!1),ft(Q)}}}function Qr(Q,Oe){for(var Ye=Q.docSelection.createRange(),at=Kt(Oe),Ke=F(Ye.item(0)),Ut=Z(Ke).createControlRange(),yn=0,ee=Ye.length;yn<ee;++yn)Ut.add(Ye.item(yn));try{Ut.add(at)}catch{throw ie.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}Ut.select(),Un(Q)}var ei;xe(bt,"getRangeAt")?ei=function(Q,Oe){try{return Q.getRangeAt(Oe)}catch{return null}}:ht&&(ei=function(Q){var Oe=F(Q.anchorNode),Ye=K.createRange(Oe);return Ye.setStartAndEnd(Q.anchorNode,Q.anchorOffset,Q.focusNode,Q.focusOffset),Ye.collapsed!==this.isCollapsed&&Ye.setStartAndEnd(Q.focusNode,Q.focusOffset,Q.anchorNode,Q.anchorOffset),Ye});function en(Q,Oe,Ye){this.nativeSelection=Q,this.docSelection=Oe,this._ranges=[],this.win=Ye,this.refresh()}en.prototype=K.selectionPrototype;function Tr(Q){Q.win=Q.anchorNode=Q.focusNode=Q._ranges=null,Q.rangeCount=Q.anchorOffset=Q.focusOffset=0,Q.detached=!0,ft(Q)}var Pn=[];function Dr(Q,Oe){for(var Ye=Pn.length,at,Ke;Ye--;)if(at=Pn[Ye],Ke=at.selection,Oe=="deleteAll")Tr(Ke);else if(at.win==Q)return Oe=="delete"?(Pn.splice(Ye,1),!0):Ke;return Oe=="deleteAll"&&(Pn.length=0),null}var hi=function(Q){if(Q&&Q instanceof en)return Q.refresh(),Q;Q=oe(Q,"getNativeSelection");var Oe=Dr(Q),Ye=Ht(Q),at=tt?Te(Q):null;return Oe?(Oe.nativeSelection=Ye,Oe.docSelection=at,Oe.refresh()):(Oe=new en(Ye,at,Q),Pn.push({win:Q,selection:Oe})),Oe};K.getSelection=hi,be.createAliasForDeprecatedMethod(K,"getIframeSelection","getSelection");var Tt=en.prototype;function Ii(Q,Oe){for(var Ye=F(Oe[0].startContainer),at=Z(Ye).createControlRange(),Ke=0,Ut,yn=Oe.length;Ke<yn;++Ke){Ut=Kt(Oe[Ke]);try{at.add(Ut)}catch{throw ie.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}at.select(),Un(Q)}if(!vt&&ht&&be.areHostMethods(bt,["removeAllRanges","addRange"])){Tt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),Je(this)};var Vr=function(Q,Oe){ct(Q.nativeSelection,Oe),Q.refresh()};cn?Tt.addRange=function(Q,Oe){if(Xe&&tt&&this.docSelection.type==A)Qr(this,Q);else if(se(Oe)&&Rt)Vr(this,Q);else{var Ye;Ne?Ye=this.rangeCount:(this.removeAllRanges(),Ye=0);var at=Ct(Q).cloneRange();try{this.nativeSelection.addRange(at)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==Ye+1){if(K.config.checkSelectionRanges){var Ke=ei(this.nativeSelection,this.rangeCount-1);Ke&&!J(Ke,Q)&&(Q=new We(Ke))}this._ranges[this.rangeCount-1]=Q,lt(this,Q,fr(this.nativeSelection)),this.isCollapsed=Qt(this),ft(this)}else this.refresh()}}:Tt.addRange=function(Q,Oe){se(Oe)&&Rt?Vr(this,Q):(this.nativeSelection.addRange(Ct(Q)),this.refresh())},Tt.setRanges=function(Q){if(Xe&&tt&&Q.length>1)Ii(this,Q);else{this.removeAllRanges();for(var Oe=0,Ye=Q.length;Oe<Ye;++Oe)this.addRange(Q[Oe])}}}else if(xe(bt,"empty")&&xe(Lt,"select")&&Xe&&vt)Tt.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var Q;if(this.anchorNode)Q=F(this.anchorNode);else if(this.docSelection.type==A){var Oe=this.docSelection.createRange();Oe.length&&(Q=F(Oe.item(0)))}if(Q){var Ye=Z(Q).createTextRange();Ye.select(),this.docSelection.empty()}}}catch{}Je(this)},Tt.addRange=function(Q){this.docSelection.type==A?Qr(this,Q):(K.WrappedTextRange.rangeToTextRange(Q).select(),this._ranges[0]=Q,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,lt(this,Q,!1),ft(this))},Tt.setRanges=function(Q){this.removeAllRanges();var Oe=Q.length;Oe>1?Ii(this,Q):Oe&&this.addRange(Q[0])};else return ie.fail("No means of selecting a Range or TextRange was found"),!1;Tt.getRangeAt=function(Q){if(Q<0||Q>=this.rangeCount)throw new St("INDEX_SIZE_ERR");return this._ranges[Q].cloneRange()};var Vn;if(vt)Vn=function(Q){var Oe;K.isSelectionValid(Q.win)?Oe=Q.docSelection.createRange():(Oe=Z(Q.win.document).createTextRange(),Oe.collapse(!0)),Q.docSelection.type==A?Un(Q):rr(Oe)?bn(Q,Oe):Je(Q)};else if(xe(bt,"getRangeAt")&&typeof bt.rangeCount==fe)Vn=function(Q){if(Xe&&tt&&Q.docSelection.type==A)Un(Q);else if(Q._ranges.length=Q.rangeCount=Q.nativeSelection.rangeCount,Q.rangeCount){for(var Oe=0,Ye=Q.rangeCount;Oe<Ye;++Oe)Q._ranges[Oe]=new K.WrappedRange(Q.nativeSelection.getRangeAt(Oe));lt(Q,Q._ranges[Q.rangeCount-1],fr(Q.nativeSelection)),Q.isCollapsed=Qt(Q),ft(Q)}else Je(Q)};else if(ht&&typeof bt.isCollapsed==ne&&typeof Lt.collapsed==ne&&te.implementsDomRange)Vn=function(Q){var Oe,Ye=Q.nativeSelection;Ye.anchorNode?(Oe=ei(Ye,0),Q._ranges=[Oe],Q.rangeCount=1,we(Q),Q.isCollapsed=Qt(Q),ft(Q)):Je(Q)};else return ie.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Tt.refresh=function(Q){var Oe=Q?this._ranges.slice(0):null,Ye=this.anchorNode,at=this.anchorOffset;if(Vn(this),Q){var Ke=Oe.length;if(Ke!=this._ranges.length||this.anchorNode!=Ye||this.anchorOffset!=at)return!0;for(;Ke--;)if(!J(Oe[Ke],this._ranges[Ke]))return!0;return!1}};var cr=function(Q,Oe){var Ye=Q.getAllRanges();Q.removeAllRanges();for(var at=0,Ke=Ye.length;at<Ke;++at)J(Oe,Ye[at])||Q.addRange(Ye[at]);Q.rangeCount||Je(Q)};Xe&&tt?Tt.removeRange=function(Q){if(this.docSelection.type==A){for(var Oe=this.docSelection.createRange(),Ye=Kt(Q),at=F(Oe.item(0)),Ke=Z(at).createControlRange(),Ut,yn=!1,ee=0,P=Oe.length;ee<P;++ee)Ut=Oe.item(ee),Ut!==Ye||yn?Ke.add(Oe.item(ee)):yn=!0;Ke.select(),Un(this)}else cr(this,Q)}:Tt.removeRange=function(Q){cr(this,Q)};var fr;!vt&&ht&&te.implementsDomRange?(fr=Le,Tt.isBackward=function(){return fr(this)}):fr=Tt.isBackward=function(){return!1},Tt.isBackwards=Tt.isBackward,Tt.toString=function(){for(var Q=[],Oe=0,Ye=this.rangeCount;Oe<Ye;++Oe)Q[Oe]=""+this._ranges[Oe];return Q.join("")};function Lr(Q,Oe){if(Q.win.document!=F(Oe))throw new St("WRONG_DOCUMENT_ERR")}function ti(Q,Oe){if(Oe<0||Oe>(he.isCharacterDataNode(Q)?Q.length:Q.childNodes.length))throw new St("INDEX_SIZE_ERR")}Tt.collapse=function(Q,Oe){Lr(this,Q);var Ye=K.createRange(Q);Ye.collapseToPoint(Q,Oe),this.setSingleRange(Ye),this.isCollapsed=!0},Tt.collapseToStart=function(){if(this.rangeCount){var Q=this._ranges[0];this.collapse(Q.startContainer,Q.startOffset)}else throw new St("INVALID_STATE_ERR")},Tt.collapseToEnd=function(){if(this.rangeCount){var Q=this._ranges[this.rangeCount-1];this.collapse(Q.endContainer,Q.endOffset)}else throw new St("INVALID_STATE_ERR")},Tt.selectAllChildren=function(Q){Lr(this,Q);var Oe=K.createRange(Q);Oe.selectNodeContents(Q),this.setSingleRange(Oe)},st?Tt.setBaseAndExtent=function(Q,Oe,Ye,at){this.nativeSelection.setBaseAndExtent(Q,Oe,Ye,at),this.refresh()}:Rt&&(Tt.setBaseAndExtent=function(Q,Oe,Ye,at){ti(Q,Oe),ti(Ye,at),Lr(this,Q),Lr(this,Ye);var Ke=K.createRange(node),Ut=he.comparePoints(Q,Oe,Ye,at)==-1;Ut?Ke.setStartAndEnd(Ye,at,Q,Oe):Ke.setStartAndEnd(Q,Oe,Ye,at),this.setSingleRange(Ke,Ut)}),Tt.deleteFromDocument=function(){if(Xe&&tt&&this.docSelection.type==A){for(var Q=this.docSelection.createRange(),Oe;Q.length;)Oe=Q.item(0),Q.remove(Oe),he.removeNode(Oe);this.refresh()}else if(this.rangeCount){var Ye=this.getAllRanges();if(Ye.length){this.removeAllRanges();for(var at=0,Ke=Ye.length;at<Ke;++at)Ye[at].deleteContents();this.addRange(Ye[Ke-1])}}},Tt.eachRange=function(Q,Oe){for(var Ye=0,at=this._ranges.length;Ye<at;++Ye)if(Q(this.getRangeAt(Ye)))return Oe},Tt.getAllRanges=function(){var Q=[];return this.eachRange(function(Oe){Q.push(Oe)}),Q},Tt.setSingleRange=function(Q,Oe){this.removeAllRanges(),this.addRange(Q,Oe)},Tt.callMethodOnEachRange=function(Q,Oe){var Ye=[];return this.eachRange(function(at){Ye.push(at[Q].apply(at,Oe||[]))}),Ye};function Pr(Q){return function(Oe,Ye){var at;this.rangeCount?(at=this.getRangeAt(0),at["set"+(Q?"Start":"End")](Oe,Ye)):(at=K.createRange(this.win.document),at.setStartAndEnd(Oe,Ye)),this.setSingleRange(at,this.isBackward())}}Tt.setStart=Pr(!0),Tt.setEnd=Pr(!1),K.rangePrototype.select=function(Q){hi(this.getDocument()).setSingleRange(this,Q)},Tt.changeEachRange=function(Q){var Oe=[],Ye=this.isBackward();this.eachRange(function(at){Q(at),Oe.push(at)}),this.removeAllRanges(),Ye&&Oe.length==1?this.addRange(Oe[0],"backward"):this.setRanges(Oe)},Tt.containsNode=function(Q,Oe){return this.eachRange(function(Ye){return Ye.containsNode(Q,Oe)},!0)||!1},Tt.getBookmark=function(Q){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[Q])}},Tt.moveToBookmark=function(Q){for(var Oe=[],Ye=0,at,Ke;at=Q.rangeBookmarks[Ye++];)Ke=K.createRange(this.win),Ke.moveToBookmark(at),Oe.push(Ke);Q.backward?this.setSingleRange(Oe[0],"backward"):this.setRanges(Oe)},Tt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Tt.restoreRanges=function(Q){this.removeAllRanges();for(var Oe=0,Ye;Ye=Q.ranges[Oe];++Oe)this.addRange(Ye,Q.backward&&Oe==0)},Tt.toHtml=function(){var Q=[];return this.eachRange(function(Oe){Q.push(Ze.toHtml(Oe))}),Q.join("")},te.implementsTextRange&&(Tt.getNativeTextRange=function(){var Q;if(Q=this.docSelection){var Oe=Q.createRange();if(rr(Oe))return Oe;throw ie.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return K.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw ie.createError("getNativeTextRange: selection contains no range")}});function Wr(Q){var Oe=[],Ye=new pt(Q.anchorNode,Q.anchorOffset),at=new pt(Q.focusNode,Q.focusOffset),Ke=typeof Q.getName=="function"?Q.getName():"Selection";if(typeof Q.rangeCount<"u")for(var Ut=0,yn=Q.rangeCount;Ut<yn;++Ut)Oe[Ut]=Ze.inspect(Q.getRangeAt(Ut));return"["+Ke+"(Ranges: "+Oe.join(", ")+")(anchor: "+Ye.inspect()+", focus: "+at.inspect()+"]"}Tt.getName=function(){return"WrappedSelection"},Tt.inspect=function(){return Wr(this)},Tt.detach=function(){Dr(this.win,"delete"),Tr(this)},en.detachAll=function(){Dr(null,"deleteAll")},en.inspect=Wr,en.isDirectionBackward=se,K.Selection=en,K.selectionPrototype=Tt,K.addShimListener(function(Q){typeof Q.getSelection>"u"&&(Q.getSelection=function(){return hi(Q)}),Q=null})});var ce=!1,ue=function(K){ce||(ce=!0,!I.initialized&&I.config.autoInitialize&&$())};return O&&(document.readyState=="complete"?ue():(d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",ue,!1),q(window,"load",ue))),I})}(dh)),dh.exports}var o9=Vw();const j0=va(o9);var ch={exports:{}},H0;function a9(){return H0||(H0=1,function(n,e){(function(t,r){n.exports=t(Vw())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(r,i){var o=r.dom,a=o.DomPosition,l=o.arrayContains,u=r.util,d=u.forEach,f="span",h=u.isHostMethod(document,"createElementNS");function v(te,A){for(var F in te)if(te.hasOwnProperty(F)&&A(F,te[F])===!1)return!1;return!0}function y(te){return te.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function x(te,A){return!!te&&new RegExp("(?:^|\\s)"+A+"(?:\\s|$)").test(te)}function w(te,A){if(typeof te.classList=="object")return te.classList.contains(A);var F=typeof te.className=="string",Z=F?te.className:te.getAttribute("class");return x(Z,A)}function _(te,A){if(typeof te.classList=="object")te.classList.add(A);else{var F=typeof te.className=="string",Z=F?te.className:te.getAttribute("class");Z?x(Z,A)||(Z+=" "+A):Z=A,F?te.className=Z:te.setAttribute("class",Z)}}var b=function(){function te(A,F,Z){return F&&Z?" ":""}return function(A,F){if(typeof A.classList=="object")A.classList.remove(F);else{var Z=typeof A.className=="string",J=Z?A.className:A.getAttribute("class");J=J.replace(new RegExp("(^|\\s)"+F+"(\\s|$)"),te),Z?A.className=J:A.setAttribute("class",J)}}}();function E(te){var A=typeof te.className=="string";return A?te.className:te.getAttribute("class")}function k(te){return te&&te.split(/\s+/).sort().join(" ")}function O(te){return k(E(te))}function N(te,A){return O(te)==O(A)}function I(te,A){for(var F=A.split(/\s+/),Z=0,J=F.length;Z<J;++Z)if(!w(te,y(F[Z])))return!1;return!0}function T(te){var A=te.parentNode;return A&&A.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(A.nodeName)}function L(te,A,F,Z,J){var se=te.node,oe=te.offset,ge=se,Te=oe;se==Z&&oe>J&&++Te,se==A&&(oe==F||oe==F+1)&&(ge=Z,Te+=J-F),se==A&&oe>F+1&&--Te,te.node=ge,te.offset=Te}function H(te,A,F){te.node==A&&te.offset>F&&--te.offset}function X(te,A,F,Z){F==-1&&(F=A.childNodes.length);var J=te.parentNode,se=o.getNodeIndex(te);d(Z,function(oe){L(oe,J,se,A,F)}),A.childNodes.length==F?A.appendChild(te):A.insertBefore(te,A.childNodes[F])}function V(te,A){var F=te.parentNode,Z=o.getNodeIndex(te);d(A,function(J){H(J,F,Z)}),o.removeNode(te)}function q(te,A,F,Z,J){for(var se,oe=[];se=te.firstChild;)X(se,A,F++,J),oe.push(se);return V(te,J),oe}function D(te,A){return q(te,te.parentNode,o.getNodeIndex(te),!0,A)}function W(te,A){var F=te.cloneRange();F.selectNodeContents(A);var Z=F.intersection(te),J=Z?Z.toString():"";return J!=""}function $(te){for(var A=te.getNodes([3]),F=0,Z;(Z=A[F])&&!W(te,Z);)++F;for(var J=A.length-1;(Z=A[J])&&!W(te,Z);)--J;return A.slice(F,J+1)}function pe(te,A){if(te.attributes.length!=A.attributes.length)return!1;for(var F=0,Z=te.attributes.length,J,se,oe;F<Z;++F)if(J=te.attributes[F],oe=J.name,oe!="class"&&(se=A.attributes.getNamedItem(oe),J===null!=(se===null)||J.specified!=se.specified||J.specified&&J.nodeValue!==se.nodeValue))return!1;return!0}function De(te,A){for(var F=0,Z=te.attributes.length,J;F<Z;++F)if(J=te.attributes[F].name,!(A&&l(A,J))&&te.attributes[F].specified&&J!="class")return!0;return!1}var de=o.getComputedStyleProperty,Se=function(){var te=document.createElement("div");return typeof te.isContentEditable=="boolean"?function(A){return A&&A.nodeType==1&&A.isContentEditable}:function(A){return!A||A.nodeType!=1||A.contentEditable=="false"?!1:A.contentEditable=="true"||Se(A.parentNode)}}();function me(te){var A;return te&&te.nodeType==1&&((A=te.parentNode)&&A.nodeType==9&&A.designMode=="on"||Se(te)&&!Se(te.parentNode))}function ve(te){return(Se(te)||te.nodeType!=1&&Se(te.parentNode))&&!me(te)}var Re=/^inline(-block|-table)?$/i;function Ie(te){return te&&te.nodeType==1&&!Re.test(de(te,"display"))}var ce=/[^\r\n\t\f \u200B]/;function ue(te){if(te.data.length==0)return!0;if(ce.test(te.data))return!1;var A=de(te.parentNode,"whiteSpace");switch(A){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(te.data))return!1}return Ie(te.previousSibling)||Ie(te.nextSibling)}function K(te){var A=[],F,Z;for(F=0;Z=te[F++];)A.push(new a(Z.startContainer,Z.startOffset),new a(Z.endContainer,Z.endOffset));return A}function ie(te,A){for(var F=0,Z,J,se,oe=te.length;F<oe;++F)Z=te[F],J=A[F*2],se=A[F*2+1],Z.setStartAndEnd(J.node,J.offset,se.node,se.offset)}function ne(te,A){return o.isCharacterDataNode(te)?A==0?!!te.previousSibling:A==te.length?!!te.nextSibling:!0:A>0&&A<te.childNodes.length}function fe(te,A,F,Z){var J,se,oe=F==0;if(o.isAncestorOf(A,te))return te;if(o.isCharacterDataNode(A)){var ge=o.getNodeIndex(A);if(F==0)F=ge;else if(F==A.length)F=ge+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+F+" in "+A.data);A=A.parentNode}if(ne(A,F)){J=A.cloneNode(!1),se=A.parentNode,J.id&&J.removeAttribute("id");for(var Te,Le=0;Te=A.childNodes[F];)X(Te,J,Le++,Z);return X(J,se,o.getNodeIndex(A)+1,Z),A==te?J:fe(te,se,o.getNodeIndex(J),Z)}else if(te!=A){J=A.parentNode;var Ue=o.getNodeIndex(A);return oe||Ue++,fe(te,J,Ue,Z)}return te}function he(te,A){return te.namespaceURI==A.namespaceURI&&te.tagName.toLowerCase()==A.tagName.toLowerCase()&&N(te,A)&&pe(te,A)&&de(te,"display")=="inline"&&de(A,"display")=="inline"}function be(te){var A=te?"nextSibling":"previousSibling";return function(F,Z){var J=F.parentNode,se=F[A];if(se){if(se&&se.nodeType==3)return se}else if(Z&&(se=J[A],se&&se.nodeType==1&&he(J,se))){var oe=se[te?"firstChild":"lastChild"];if(oe&&oe.nodeType==3)return oe}return null}}var xe=be(!1),Ze=be(!0);function We(te){this.isElementMerge=te.nodeType==1,this.textNodes=[];var A=this.isElementMerge?te.lastChild:te;A&&(this.textNodes[0]=A)}We.prototype={doMerge:function(te){var A=this.textNodes,F=A[0];if(A.length>1){var Z=o.getNodeIndex(F),J=[],se=0,oe;d(A,function(ge,Te){oe=ge.parentNode,Te>0&&(oe.removeChild(ge),oe.hasChildNodes()||o.removeNode(oe),te&&d(te,function(Le){Le.node==ge&&(Le.node=F,Le.offset+=se),Le.node==oe&&Le.offset>Z&&(--Le.offset,Le.offset==Z+1&&Te<A.length-1&&(Le.node=F,Le.offset=se))})),J[Te]=ge.data,se+=ge.data.length}),F.data=J.join("")}return F.data},getLength:function(){for(var te=this.textNodes.length,A=0;te--;)A+=this.textNodes[te].length;return A},toString:function(){var te=[];return d(this.textNodes,function(A,F){te[F]="'"+A.data+"'"}),"[Merge("+te.join(",")+")]"}};var St=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],pt={};function Ht(te,A,F){var Z,J,se,oe,ge=this;ge.cssClass=ge.className=te;var Te=null,Le={};if(typeof A=="object"&&A!==null){for(typeof A.elementTagName<"u"&&(A.elementTagName=A.elementTagName.toLowerCase()),F=A.tagNames,Te=A.elementProperties,Le=A.elementAttributes,J=0;oe=St[J++];)A.hasOwnProperty(oe)&&(ge[oe]=A[oe]);Z=A.normalize}else Z=A;ge.normalize=typeof Z>"u"?!0:Z,ge.attrExceptions=[];var Ue=document.createElement(ge.elementTagName);ge.elementProperties=ge.copyPropertiesToElement(Te,Ue,!0),v(Le,function(vt,bt){ge.attrExceptions.push(vt),Le[vt]=""+bt}),ge.elementAttributes=Le,ge.elementSortedClassName=ge.elementProperties.hasOwnProperty("className")?k(ge.elementProperties.className+" "+te):te,ge.applyToAnyTagName=!1;var tt=typeof F;if(tt=="string")F=="*"?ge.applyToAnyTagName=!0:ge.tagNames=y(F.toLowerCase()).split(/\s*,\s*/);else if(tt=="object"&&typeof F.length=="number")for(ge.tagNames=[],J=0,se=F.length;J<se;++J)F[J]=="*"?ge.applyToAnyTagName=!0:ge.tagNames.push(F[J].toLowerCase());else ge.tagNames=[ge.elementTagName]}Ht.prototype={elementTagName:f,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(te,A,F){var Z,J,se={},oe,ge,Te,Le;for(var Ue in te)if(te.hasOwnProperty(Ue))if(ge=te[Ue],Te=A[Ue],Ue=="className")_(A,ge),_(A,this.className),A[Ue]=k(A[Ue]),F&&(se[Ue]=ge);else if(Ue=="style"){J=Te,F&&(se[Ue]=oe={});for(Z in te[Ue])te[Ue].hasOwnProperty(Z)&&(J[Z]=ge[Z],F&&(oe[Z]=J[Z]));this.attrExceptions.push(Ue)}else A[Ue]=ge,F&&(se[Ue]=A[Ue],Le=pt.hasOwnProperty(Ue)?pt[Ue]:Ue,this.attrExceptions.push(Le));return F?se:""},copyAttributesToElement:function(te,A){for(var F in te)te.hasOwnProperty(F)&&!/^class(?:Name)?$/i.test(F)&&A.setAttribute(F,te[F])},appliesToElement:function(te){return l(this.tagNames,te.tagName.toLowerCase())},getEmptyElements:function(te){var A=this;return te.getNodes([1],function(F){return A.appliesToElement(F)&&!F.hasChildNodes()})},hasClass:function(te){return te.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(te))&&w(te,this.className)},getSelfOrAncestorWithClass:function(te){for(;te;){if(this.hasClass(te))return te;te=te.parentNode}return null},isModifiable:function(te){return!this.applyToEditableOnly||ve(te)},isIgnorableWhiteSpaceNode:function(te){return this.ignoreWhiteSpace&&te&&te.nodeType==3&&ue(te)},postApply:function(te,A,F,Z){var J=te[0],se=te[te.length-1],oe=[],ge,Te=J,Le=se,Ue=0,tt=se.length,vt;d(te,function(ht){vt=xe(ht,!Z),vt?(ge||(ge=new We(vt),oe.push(ge)),ge.textNodes.push(ht),ht===J&&(Te=ge.textNodes[0],Ue=Te.length),ht===se&&(Le=ge.textNodes[0],tt=ge.getLength())):ge=null});var bt=Ze(se,!Z);if(bt&&(ge||(ge=new We(se),oe.push(ge)),ge.textNodes.push(bt)),oe.length){for(var Lt=0,Qe=oe.length;Lt<Qe;++Lt)oe[Lt].doMerge(F);A.setStartAndEnd(Te,Ue,Le,tt)}},createContainer:function(te){var A=o.getDocument(te),F=h&&!o.isHtmlNamespace(te)&&te.namespaceURI?A.createElementNS(te.namespaceURI,this.elementTagName):A.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,F,!1),this.copyAttributesToElement(this.elementAttributes,F),_(F,this.className),this.onElementCreate&&this.onElementCreate(F,this),F},elementHasProperties:function(te,A){var F=this;return v(A,function(Z,J){if(Z=="className")return I(te,J);if(typeof J=="object"){if(!F.elementHasProperties(te[Z],J))return!1}else if(te[Z]!==J)return!1})},elementHasAttributes:function(te,A){return v(A,function(F,Z){if(te.getAttribute(F)!==Z)return!1})},applyToTextNode:function(te,A){if(T(te)){var F=te.parentNode;if(F.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(F)&&this.elementHasProperties(F,this.elementProperties)&&this.elementHasAttributes(F,this.elementAttributes))_(F,this.className);else{var Z=te.parentNode,J=this.createContainer(Z);Z.insertBefore(J,te),J.appendChild(te)}}},isRemovable:function(te){return te.tagName.toLowerCase()==this.elementTagName&&O(te)==this.elementSortedClassName&&this.elementHasProperties(te,this.elementProperties)&&!De(te,this.attrExceptions)&&this.elementHasAttributes(te,this.elementAttributes)&&this.isModifiable(te)},isEmptyContainer:function(te){var A=te.childNodes.length;return te.nodeType==1&&this.isRemovable(te)&&(A==0||A==1&&this.isEmptyContainer(te.firstChild))},removeEmptyContainers:function(te){var A=this,F=te.getNodes([1],function(se){return A.isEmptyContainer(se)}),Z=[te],J=K(Z);d(F,function(se){V(se,J)}),ie(Z,J)},undoToTextNode:function(te,A,F,Z){if(!A.containsNode(F)){var J=A.cloneRange();J.selectNode(F),J.isPointInRange(A.endContainer,A.endOffset)&&(fe(F,A.endContainer,A.endOffset,Z),A.setEndAfter(F)),J.isPointInRange(A.startContainer,A.startOffset)&&(F=fe(F,A.startContainer,A.startOffset,Z))}this.isRemovable(F)?D(F,Z):b(F,this.className)},splitAncestorWithClass:function(te,A,F){var Z=this.getSelfOrAncestorWithClass(te);Z&&fe(Z,te,A,F)},undoToAncestor:function(te,A){this.isRemovable(te)?D(te,A):b(te,this.className)},applyToRange:function(te,A){var F=this;A=A||[];var Z=K(A||[]);te.splitBoundariesPreservingPositions(Z),F.removeEmptyElements&&F.removeEmptyContainers(te);var J=$(te);if(J.length){d(J,function(ge){!F.isIgnorableWhiteSpaceNode(ge)&&!F.getSelfOrAncestorWithClass(ge)&&F.isModifiable(ge)&&F.applyToTextNode(ge,Z)});var se=J[J.length-1];te.setStartAndEnd(J[0],0,se,se.length),F.normalize&&F.postApply(J,te,Z,!1),ie(A,Z)}var oe=F.getEmptyElements(te);d(oe,function(ge){_(ge,F.className)})},applyToRanges:function(te){for(var A=te.length;A--;)this.applyToRange(te[A],te);return te},applyToSelection:function(te){var A=r.getSelection(te);A.setRanges(this.applyToRanges(A.getAllRanges()))},undoToRange:function(te,A){var F=this;A=A||[];var Z=K(A);te.splitBoundariesPreservingPositions(Z),F.removeEmptyElements&&F.removeEmptyContainers(te,Z);var J=$(te),se,oe,ge=J[J.length-1];if(J.length){F.splitAncestorWithClass(te.endContainer,te.endOffset,Z),F.splitAncestorWithClass(te.startContainer,te.startOffset,Z);for(var Te=0,Le=J.length;Te<Le;++Te)se=J[Te],oe=F.getSelfOrAncestorWithClass(se),oe&&F.isModifiable(se)&&F.undoToAncestor(oe,Z);te.setStartAndEnd(J[0],0,ge,ge.length),F.normalize&&F.postApply(J,te,Z,!0),ie(A,Z)}var Ue=F.getEmptyElements(te);d(Ue,function(tt){b(tt,F.className)})},undoToRanges:function(te){for(var A=te.length;A--;)this.undoToRange(te[A],te);return te},undoToSelection:function(te){var A=r.getSelection(te),F=r.getSelection(te).getAllRanges();this.undoToRanges(F),A.setRanges(F)},isAppliedToRange:function(te){if(te.collapsed||te.toString()=="")return!!this.getSelfOrAncestorWithClass(te.commonAncestorContainer);var A=te.getNodes([3]);if(A.length){for(var F=0,Z;Z=A[F++];)if(!this.isIgnorableWhiteSpaceNode(Z)&&W(te,Z)&&this.isModifiable(Z)&&!this.getSelfOrAncestorWithClass(Z))return!1}return!0},isAppliedToRanges:function(te){var A=te.length;if(A==0)return!1;for(;A--;)if(!this.isAppliedToRange(te[A]))return!1;return!0},isAppliedToSelection:function(te){var A=r.getSelection(te);return this.isAppliedToRanges(A.getAllRanges())},toggleRange:function(te){this.isAppliedToRange(te)?this.undoToRange(te):this.applyToRange(te)},toggleSelection:function(te){this.isAppliedToSelection(te)?this.undoToSelection(te):this.applyToSelection(te)},getElementsWithClassIntersectingRange:function(te){var A=[],F=this;return te.getNodes([3],function(Z){var J=F.getSelfOrAncestorWithClass(Z);J&&!l(A,J)&&A.push(J)}),A},detach:function(){}};function Qt(te,A,F){return new Ht(te,A,F)}Ht.util={hasClass:w,addClass:_,removeClass:b,getClass:E,hasSameClasses:N,hasAllClasses:I,replaceWithOwnChildren:D,elementsHaveSameNonClassAttributes:pe,elementHasNonClassAttributes:De,splitNodeAt:fe,isEditableElement:Se,isEditingHost:me,isEditable:ve},r.CssClassApplier=r.ClassApplier=Ht,r.createClassApplier=Qt,u.createAliasForDeprecatedMethod(r,"createCssClassApplier","createClassApplier",i)}),t})}(ch)),ch.exports}a9();var $0={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},F0=dc.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var n=this;j0.init(),dc.extensions.button.prototype.init.call(this),this.colorPicker=new Uw({parent:this.button,color:"#000",onDone:function(e){n.coloredText&&n.coloredText.isAppliedToSelection()&&n.coloredText.undoToSelection(),n.coloredText=j0.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),n.coloredText.toggleSelection(),n.base.checkContentChanged(),n.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(n){return n.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),s9=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),l9=function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},z0=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},U0=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};(function(n){s9(e,n);function e(t){var r=n.call(this,t)||this;r.labelMap=new Map;var i=t.lf,o=t.graphModel;return r.lf=i,r.graphModel=o,r.state={tick:0},r}return e.prototype.componentDidMount=function(){var t=this,r=this.props.graphModel;this.editor=new dc(".lf-label-editor",ss($0,{autoLink:!0,extensions:{colorPicker:new F0}})),r.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),r.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new dc(".lf-label-editor",ss($0,{autoLink:!0,extensions:{colorPicker:new F0}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,r=this.props,i=r.lf.extension,o=r.graphModel,a=U0(U0([],z0(o.nodes),!1),z0(o.edges),!1),l=i.label;if(l){var u=[];return zt(a,function(d){var f,h,v=d.getData(),y=(h=(f=v.properties)===null||f===void 0?void 0:f._label)!==null&&h!==void 0?h:[];zt(y,function(x){var w=t.labelMap,_=new YF(x,d,o);w.set(_.id,_),u.push(He(qF,{label:_,element:d,graphModel:o},_.id))})}),u}return null},e.prototype.render=function(){return He("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=l9([Cr],e),e})(Zt);var u9=function(){function n(e){var t=e.lf,r=this;this.lf=t,this.lf.setPatternItems=function(i){r.setPatternItems(i)}}return n.prototype.render=function(e,t){var r=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.shapeList.forEach(function(i){var o;(o=r.panelEl)===null||o===void 0||o.appendChild(r.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},n.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},n.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},n.prototype.createDndItem=function(e){var t=this,r=document.createElement("div");r.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),r.appendChild(i),e.label){var o=document.createElement("div");o.innerText=e.label,o.className="lf-dnd-text",r.appendChild(o)}return e.disabled?(r.classList.add("disabled"),r.onmousedown=function(){e.callback&&e.callback(t.lf,t.domContainer)},r):(r.onmousedown=function(){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer)},r.ondblclick=function(a){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:a,data:e})},r.onclick=function(a){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:a,data:e})},r.oncontextmenu=function(a){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:a,data:e})},r)},n.pluginName="dndPanel",n}(),d9=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),aa=function(){return aa=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},aa.apply(this,arguments)},c9=function(n){d9(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,r=t.width,i=t.height,o=t.radius;Er(r)||(this.width=r),Er(i)||(this.height=i),Er(o)||(this.radius=o)},e.prototype.getTextStyle=function(){var t=this.properties,r=t.refX,i=r===void 0?0:r,o=t.refY,a=o===void 0?0:o,l=t.textStyle,u=n.prototype.getTextStyle.call(this);return aa(aa(aa({},u),It(l)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(a,")")})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),r=this.properties.style;return aa(aa({},t),It(r)||{})},e}(Gl),Ww={};function mn(n,e){var t=n.type,r=n.component,i=n.effect,o=n.view,a=n.model;if(!t)throw new Error("You should specify type in config");Ww[t]={component:r,effect:i},e.register({type:t,view:o||g9,model:a||c9})}var Ps=!1,cc=new Map,fc=qt({});function f9(n,e,t,r,i){Ps&&(fc[n]=gc(Es({render:function(){return pn(O1,{to:t},[pn(e,{node:r,graph:i})])},provide:function(){return{getNode:function(){return r},getGraph:function(){return i}}}})))}function h9(n){Ps&&delete fc[n]}function V0(){return Ps}function Gw(){return Ps=!0,Es({props:{flowId:{type:String,required:!0}},setup:function(n){return function(){var e=[];return Object.keys(fc).forEach(function(t){t.startsWith(n.flowId)&&e.push(fc[t])}),pn(rt,{},e.map(function(t){return pn(t)}))}}})}function p9(n,e){if(!(!e||!n||!Ps)){var t=Gw();if(!cc.has(e)){var r=document.createElement("div");n.appendChild(r);var i=ga(t,{flowId:e});i.mount(r),cc.set(e,i)}}}function W0(n){if(!(!n||!Ps)){var e=cc.get(n);e&&(e.unmount(),cc.delete(n))}}var v9=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),g9=function(n){v9(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var r=document.createElement("div");r.className="custom-vue-node-content",this.root=r,t.appendChild(r),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var r=this.getComponentContainer(),i=this.props,o=i.model,a=i.graphModel;if(r){var l=Ww[o.type].component;l&&(V0()?f9(this.targetId(),l,r,o,a):(this.vm=ga({render:function(){return pn(l,{node:o,graph:a})},provide:function(){return{getNode:function(){return o},getGraph:function(){return a}}}}),(t=this.vm)===null||t===void 0||t.mount(r)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){V0()&&h9(this.targetId()),this.unmountVueComponent()},e}(Xl),m9=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},y9=function(){function n(e){var t=e.lf,r=e.LogicFlow,i=e.options,o=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){o.updateViewPortBounds(),o.isShow&&o.updateViewPort()},this.render=function(l,u){o.container=u,o.lf.on("history:change",function(){o.isShow&&o.setView()}),o.lf.on("graph:transform",function(){o.isShow&&o.setView(!1)})},this.show=function(l,u){o.isShow||(o.initMiniMap(),o.lf.on("graph:resize",o.onGraphResize),o.createMiniMap(l,u),o.setView(!0)),o.isShow=!0},this.hide=function(){o.isShow&&(W0(o.lfMap.graphModel.flowId),o.lf.off("graph:resize",o.onGraphResize),o.lfMap.destroy(),o.translateX=0,o.translateY=0,o.removeMiniMap(),o.lf.emit("miniMap:close",{})),o.isShow=!1},this.updatePosition=function(l){if(typeof l=="object")(l.left!==void 0||l.right!==void 0)&&(o.leftPosition=l.left,o.rightPosition=l.right),(l.top!==void 0||l.bottom!==void 0)&&(o.topPosition=l.top,o.bottomPosition=l.bottom);else switch(l){case"left-top":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=0,o.bottomPosition=void 0;break;case"right-top":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=0,o.bottomPosition=void 0;break;case"left-bottom":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=void 0,o.bottomPosition=0;break;case"right-bottom":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=void 0,o.bottomPosition=0;break}o.updateMiniMapPosition()},this.reset=function(){o.lf.resetTranslate(),o.lf.resetZoom()},this.setShowEdge=function(l){o.showEdge!==l&&(o.showEdge=l,o.setView())},this.startDrag=function(l){document.addEventListener("mousemove",o.drag),document.addEventListener("mouseup",o.drop);var u=l.x,d=l.y;o.startPosition={x:u,y:d}},this.drag=function(l){var u=l.x,d=l.y,f=(u-o.startPosition.x)/o.scale,h=(d-o.startPosition.y)/o.scale,v=o.viewPortLeft+f+o.viewPortWidth/o.scale/2,y=o.viewPortTop+h+o.viewPortHeight/o.scale/2;o.startPosition={x:u,y:d},o.lf.focusOn({coordinate:{x:v,y}})},this.drop=function(){document.removeEventListener("mousemove",o.drag),document.removeEventListener("mouseup",o.drop)},this.mapClick=function(l){var u=l.offsetX,d=l.offsetY,f=o.translateX+u/o.scale,h=o.translateY+d/o.scale;o.lf.focusOn({coordinate:{x:f,y:h}})},this.lf=t,this.LFCtor=r,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var a={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=a,this.elementAreaBounds=a,this.viewPortBounds=a}return n.prototype.setOption=function(e){var t=e.width,r=t===void 0?150:t,i=e.height,o=i===void 0?220:i,a=e.showEdge,l=a===void 0?!1:a,u=e.isShowHeader,d=u===void 0?!1:u,f=e.isShowCloseIcon,h=f===void 0?!1:f,v=e.leftPosition,y=e.topPosition,x=e.rightPosition,w=x===void 0?0:x,_=e.bottomPosition,b=_===void 0?0:_,E=e.headerTitle,k=E===void 0?"导航":E;this.width=r,this.height=o,this.showEdge=l,this.isShowHeader=d,this.isShowCloseIcon=h,this.leftPosition=v,this.rightPosition=v!==void 0?void 0:w,this.topPosition=y,this.bottomPosition=y!==void 0?void 0:b,this.headerTitle=k},n.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins}),p9(e,this.lfMap.graphModel.flowId),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},n.prototype.createMiniMap=function(e,t){var r,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(r=this.container)===null||r===void 0||r.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var o=document.createElement("div");o.className="lf-mini-map-header",o.innerText=this.headerTitle,i.appendChild(o);var a=document.createElement("span");a.className="lf-mini-map-close",a.addEventListener("click",this.hide),i.appendChild(a)},n.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},n.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},n.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},n.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},r=e.nodes;r&&r.length>0&&r.forEach(function(i){var o,a,l=i.x,u=i.y,d=(o=i.width)!==null&&o!==void 0?o:200,f=(a=i.height)!==null&&a!==void 0?a:200,h=l-d/2,v=l+d/2,y=u-f/2,x=u+f/2;t.left=Math.min(h,t.left),t.right=Math.max(v,t.right),t.top=Math.min(y,t.top),t.bottom=Math.max(x,t.bottom)}),this.elementAreaBounds=t},n.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,r=e.TRANSLATE_Y,i=e.SCALE_X,o=e.SCALE_Y,a=this.lf.graphModel,l=a.width,u=a.height;this.viewPortBounds={left:-t/i,right:(-t+l)/i,top:-r/o,bottom:(-r+u)/o}},n.prototype.resetData=function(e){var t=e.nodes,r=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&r.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?r:[]}},n.prototype.setView=function(e){var t,r;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),o=this.resetData(i),a=this.lf.viewMap,l=this.lf.graphModel.modelMap,u=this.lfMap.viewMap;try{for(var d=m9(a.keys()),f=d.next();!f.done;f=d.next()){var h=f.value;u.has(h)||this.lfMap.register({type:h,view:a.get(h),model:l.get(h)})}}catch(H){t={error:H}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}this.lfMap.render(o),this.updateBounds(o)}else this.updateBounds();var v=this.bounds,y=v.left,x=v.top,w=v.right,_=v.bottom,b=w-y,E=_-x,k=this.width/b,O=this.height/E,N=Math.min(k,O);this.scale=N;var I=y-(this.width/N-b)/2,T=x-(this.height/N-E)/2;if(this.lfMap.graphModel.transformModel.translate(-I+this.translateX,-T+this.translateY),this.translateX=I,this.translateY=T,this.miniMapWrap.firstChild){var L=this.miniMapWrap.firstChild.style;L.pointerEvents="none",L.transform="matrix(".concat(N,", 0, 0, ").concat(N,", 0, 0)"),L.transformOrigin="left top",L.height="".concat(this.height/N,"px"),L.width="".concat(this.width/N,"px"),this.updateViewPort()}},n.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),r=t.TRANSLATE_X,i=t.TRANSLATE_Y,o=t.SCALE_X,a=t.SCALE_Y,l=this.lf.graphModel,u=l.width,d=l.height;this.viewPortLeft=-r/o,this.viewPortTop=-i/a,this.viewPortWidth=u/o*this.scale,this.viewPortHeight=d/a*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},n.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.addEventListener("mousedown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},n.prototype.destroy=function(){W0(this.lfMap.graphModel.flowId),this.lf.off("graph:resize",this.onGraphResize)},n.pluginName="miniMap",n}(),G0=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},q0=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},_9=function(){function n(e){var t=e.lf,r=e.options,i=this,o;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(a){var l=a.e;i.handleMouseDown(l)},this.draw=function(a){var l=i.lf.getPointByClient(a.clientX,a.clientY).domOverlayPosition,u=l.x,d=l.y;if(i.endPoint={x:u,y:d},i.startPoint){var f=i.startPoint,h=f.x,v=f.y,y=h,x=v,w=u-h,_=d-v;u<h&&(y=u,w=h-u),d<v&&(x=d,_=v-d),i.wrapper&&(i.wrapper.style.left="".concat(y,"px"),i.wrapper.style.top="".concat(x,"px"),i.wrapper.style.width="".concat(w,"px"),i.wrapper.style.height="".concat(_,"px"))}},this.drawOff=function(a){if(i.mouseDownInfo){var l=i.mouseDownInfo,u=l.x,d=l.y,f=l.time,h=Math.abs(a.clientX-u)<5&&Math.abs(a.clientY-d)<5&&Date.now()-f<200;if(h){i.lf.clearSelectElements(),i.cleanupSelectionState();return}}var v=It(i.startPoint),y=It(i.endPoint);if(document.removeEventListener("mousemove",i.draw),i.exclusiveMode||document.removeEventListener("mouseup",i.drawOff),i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),v&&y){var u=v.x,d=v.y,x=y.x,w=y.y,_=[Math.min(u,x),Math.min(d,w)],b=[Math.max(u,x),Math.max(d,w)];if(i.lf.emit("selection:selected-area",{topLeft:_,bottomRight:b}),Math.abs(x-u)<10&&Math.abs(w-d)<10){i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0);return}var E=i.lf.graphModel.getAreaElement(_,b,i.isWholeEdge,i.isWholeNode,!0),k=i.lf.graphModel,O=k.dynamicGroup,N=k.group,I=[],T=i.lf.getSelectElements(),L=new Set(q0(q0([],G0(T.nodes.map(function(V){return V.id})),!1),G0(T.edges.map(function(V){return V.id})),!1));E.forEach(function(V){if(N){var q=N.getNodeGroup(V.id);if(E.includes(q))return}if(O){var q=O.getGroupByNodeId(V.id);if(E.includes(q))return}if(i.exclusiveMode&&L.has(V.id)){i.lf.deselectElementById(V.id);return}i.lf.selectElementById(V.id,!0),I.push(V)}),i.startPoint=void 0,i.endPoint=void 0,I.length>0&&i.lf.emit("selection:drop",{e:a}),i.lf.emit("selection:selected",{elements:I,leftTopPoint:_,rightBottomPoint:b})}i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0)},this.lf=t,this.exclusiveMode=(o=r==null?void 0:r.exclusiveMode)!==null&&o!==void 0?o:!1,t.openSelectionSelect=function(){i.openSelectionSelect()},t.closeSelectionSelect=function(){i.closeSelectionSelect()},t.setSelectionSelectMode=function(a){i.setExclusiveMode(a)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return n.prototype.render=function(e,t){this.container=t},n.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("mousemove",this.draw),document.removeEventListener("mouseup",this.drawOff)},n.prototype.setExclusiveMode=function(e){e===void 0&&(e=!1),this.exclusiveMode!==e&&(this.cleanupSelectionState(),this.exclusiveMode=e,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},n.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.addEventListener("mousedown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},n.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("mousedown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},n.prototype.handleMouseDown=function(e){var t;if(!(!this.container||this.disabled)){var r=e.button===2;if(!r){this.cleanupSelectionState(),this.mouseDownInfo={x:e.clientX,y:e.clientY,time:Date.now()},this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.lf.updateEditConfig({stopMoveGraph:!0});var i=this.lf.getPointByClient(e.clientX,e.clientY).domOverlayPosition,o=i.x,a=i.y;this.startPoint={x:o,y:a},this.endPoint={x:o,y:a};var l=document.createElement("div");l.className="lf-selection-select",l.oncontextmenu=function(d){d.preventDefault()},l.style.top="".concat(this.startPoint.y,"px"),l.style.left="".concat(this.startPoint.x,"px"),(t=this.container)===null||t===void 0||t.appendChild(l),this.wrapper=l,document.addEventListener("mousemove",this.draw),document.addEventListener("mouseup",this.drawOff)}}},n.prototype.setSelectionSense=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),this.isWholeEdge=e,this.isWholeNode=t},n.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},n.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var e=It(this.endPoint),t=new MouseEvent("mouseup",{clientX:e.x,clientY:e.y});this.drawOff(t)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},n.prototype.open=function(){this.disabled=!1},n.prototype.close=function(){this.disabled=!0},n.pluginName="selectionSelect",n}();var qw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),rs=function(){return rs=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},rs.apply(this,arguments)},Dl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},b9={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function x9(n){for(var e=n,t=1;t<e.length-1;){var r=Dl(e[t-1],2),i=r[0],o=r[1],a=Dl(e[t],2),l=a[0],u=a[1],d=Dl(e[t+1],2),f=d[0],h=d[1];i===l&&l===f||o===u&&u===h?e.splice(t,1):t++}return e}function w9(n,e,t,r){var i=[n[0],n[1]],o=[n[0],n[1]];switch(t){case"tl":return e==="tr"?(i[1]+=r,o[0]+=r):e==="lb"&&(i[0]+=r,o[1]+=r),[i,o];case"tr":return e==="tl"?(i[1]+=r,o[0]-=r):e==="rb"&&(i[0]-=r,o[1]+=r),[i,o];case"bl":return e==="br"?(i[1]-=r,o[0]+=r):e==="lt"&&(i[0]+=r,o[1]-=r),[i,o];case"br":return e==="bl"?(i[1]-=r,o[0]-=r):e==="rt"&&(i[0]-=r,o[1]-=r),[i,o];default:return[]}}function S9(n,e,t,r){var i,o="",a="";n[0]===e[0]?o=n[1]>e[1]?"t":"b":n[1]===e[1]&&(o=n[0]>e[0]?"l":"r"),e[0]===t[0]?a=e[1]>t[1]?"t":"b":e[1]===t[1]&&(a=e[0]>t[0]?"l":"r");var l=Math.min(Math.hypot(e[0]-n[0],e[1]-n[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,r)||1/5*r,u="".concat(o).concat(a),d=b9[u]||"-",f="L ".concat(n[0]," ").concat(n[1]);if(d==="-")f+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var h=Dl(w9(e,u,d,l),2),v=h[0],y=h[1];v&&y&&(f+="L ".concat(v[0]," ").concat(v[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(y[0]," ").concat(y[1]),i=Dl(y,2),e[0]=i[0],e[1]=i[1])}return f}function E9(n,e){var t=0,r="";if(n.length===2)r+="M".concat(n[t][0]," ").concat(n[t++][1]," L ").concat(n[t][0]," ").concat(n[t][1]);else{for(r+="M".concat(n[t][0]," ").concat(n[t++][1]);t+1<n.length;){var i=n[t-1],o=n[t],a=n[t+++1];r+=S9(i,o,a,e)}r+="L ".concat(n[t][0]," ").concat(n[t][1])}return r}(function(n){qw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,r=t.points,i=t.isAnimation,o=t.arrowConfig,a=t.radius,l=a===void 0?5:a,u=t.getEdgeStyle(),d=t.getEdgeAnimationStyle(),f=x9(r.split(" ").map(function(y){return y.split(",").map(function(x){return+x})})),h=E9(f,l),v=rs(rs(rs({style:i?d:{}},u),o),{fill:"none"});return mt("path",rs({d:h},v))},e})(Ss);(function(n){qw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(xs);var Xw=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),hc=function(){return hc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},hc.apply(this,arguments)},X0=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o},Y0=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},C9=function(n){Xw(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,r=t.id,i=t.x,o=t.y,a=t.width,l=t.height,u=t.properties,d=this.props.model.getNodeStyle();return mt("svg",{x:i-a/2,y:o-l/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[u.labelText?mt("text",{x:0,y:-5,fontSize:"16px",fill:d.stroke},u.labelText):"",u.disabledDelete?"":mt("text",{x:u.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:d.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,r)},"x")])},e.prototype.getShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.id,u=this.props.model.getNodeStyle();return mt("g",{},[mt("rect",hc(hc({},u),{x:r-o/2,y:i-a/2,width:o,height:a,id:l})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var r=this.props.graphModel;r.deleteNode(t)},e}(Gd),k9=function(n){Xw(e,n);function e(){var t=n.apply(this,Y0([],X0(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},n.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,r;this.points=[],((r=this.properties)===null||r===void 0?void 0:r.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var r=t.x,i=t.y;this.x=r,this.y=i},e.prototype.updatePointsByNodes=function(t){var r=this,i=[],o=1/0,a=1/0,l=-1/0,u=-1/0;t.forEach(function(d){var f=r.graphModel.getNodeModelById(d);if(f){var h=f.width,v=f.height,y=f.x,x=f.y;o=Math.min(o,y-h/2-r.d),a=Math.min(a,x-v/2-r.d),l=Math.max(l,y+h/2+r.d),u=Math.max(u,x+v/2+r.d)}}),i.push([o,a],[l,a],[l,u],[o,u]),![o,a,l,u].some(function(d){return Math.abs(d)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(l+o)/2,y:(u+a)/2}))},e.prototype.resize=function(t){var r;this.isResize=!0;for(var i=t.width,o=t.height,a={x:i/this.width,y:o/this.height},l=(this.properties.node_selection_ids||[]).slice(),u=[],d=new Set;l.length;){var f=l.shift(),h=(r=this.graphModel.nodesMap[f])===null||r===void 0?void 0:r.model;if(h){if(!bd(h)){u.push(h);continue}d.has(h.id)||(d.add(h.id),l.push.apply(l,Y0([],X0(h.properties.node_selection_ids||[]),!1)))}}var v={x:this.x-this.width/2,y:this.y-this.height/2},y=n.prototype.resize.call(this,t),x={x:this.x-this.width/2,y:this.y-this.height/2};return u.forEach(function(w){w.width=w.width*a.x,w.height=w.height*a.y;var _=(w.x-v.x)*a.x+x.x-w.x,b=(w.y-v.y)*a.y+x.y-w.y;w.move(_,b,!0)}),this.isResize=!1,y},e}(zd),Dv="node-selection";(function(){function n(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:Dv,view:C9,model:k9})}return Object.defineProperty(n.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),n.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},n.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},n.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,r=this.lf.getGraphRawData(),i=t.filter(function(o){return o!==e.currentClickNode.id});return r.nodes.find(function(o){if(o.type==="node-selection"){var a=Zl(o,"properties.node_selection_ids",[]);return i.every(function(l){return a.includes(l)})}return!1})},n.prototype.onNodeChange=function(e,t){var r=e.graphModel.nodes.filter(function(i){if(!bd(i))return!1;var o=i.properties.node_selection_ids||[];return o.includes(t.id)});Promise.resolve().then(function(){r.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},n.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(r){var i;if(!(!r.e.shiftKey||r.data.type===Dv)){t.currentClickNode=r.data;var o=!1;t.selectNodesIds.includes(r.data.id)&&((i=t.lf.getNodeModelById(r.data.id))===null||i===void 0||i.setSelected(!1),o=!0);var a=e.getSelectElements(!0).nodes;t.selectNodes=a,t.selectNodes.length===1?o?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(r,i,o){if(t.onNodeChange(e,r),bd(r)&&!r.isResize){var a=r.properties.node_selection_ids||[];return e.graphModel.moveNodes(a,i,o,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(r){return bd(r)||t.onNodeChange(e,r),!0})},n.pluginName="node-selection",n})();var bd=function(n){return!!(n&&n.type===Dv)},O9=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pc=function(){return pc=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pc.apply(this,arguments)};(function(n){O9(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=t.properties;return mt("text",{x:r-o/2+5,y:i-a/2+16,fontSize:12,fill:"blue"},l.moreText)},e.prototype.getShape=function(){var t=this.props.model,r=t.x,i=t.y,o=t.width,a=t.height,l=this.props.model.getNodeStyle();return mt("g",{},[mt("rect",pc(pc({},l),{fill:"#FFFFFF",x:r-o/2,y:i-a/2})),this.getLabelShape()])},e})(ha);var fh,K0;function Li(){if(K0)return fh;K0=1;var n;if(typeof q1=="function")try{n=gN()}catch{}return n||(n=window.graphlib),fh=n,fh}var hh,J0;function M9(){if(J0)return hh;J0=1;var n=mN(),e=1,t=4;function r(i){return n(i,e|t)}return hh=r,hh}var ph,Z0;function Fc(){if(Z0)return ph;Z0=1;var n=$v(),e=X1(),t=Y1(),r=Ql();function i(o,a,l){if(!r(l))return!1;var u=typeof a;return(u=="number"?e(l)&&t(a,l.length):u=="string"&&a in l)?n(l[a],o):!1}return ph=i,ph}var vh,Q0;function N9(){if(Q0)return vh;Q0=1;var n=Fv(),e=$v(),t=Fc(),r=Oc(),i=Object.prototype,o=i.hasOwnProperty,a=n(function(l,u){l=Object(l);var d=-1,f=u.length,h=f>2?u[2]:void 0;for(h&&t(u[0],u[1],h)&&(f=1);++d<f;)for(var v=u[d],y=r(v),x=-1,w=y.length;++x<w;){var _=y[x],b=l[_];(b===void 0||e(b,i[_])&&!o.call(l,_))&&(l[_]=v[_])}return l});return vh=a,vh}var gh,eb;function A9(){if(eb)return gh;eb=1;var n=eu(),e=X1(),t=yN();function r(i){return function(o,a,l){var u=Object(o);if(!e(o)){var d=n(a,3);o=t(o),a=function(h){return d(u[h],h,u)}}var f=i(o,a,l);return f>-1?u[d?o[f]:f]:void 0}}return gh=r,gh}var mh,tb;function T9(){if(tb)return mh;tb=1;var n=/\s/;function e(t){for(var r=t.length;r--&&n.test(t.charAt(r)););return r}return mh=e,mh}var yh,nb;function D9(){if(nb)return yh;nb=1;var n=T9(),e=/^\s+/;function t(r){return r&&r.slice(0,n(r)+1).replace(e,"")}return yh=t,yh}var _h,rb;function L9(){if(rb)return _h;rb=1;var n=D9(),e=Ql(),t=zv(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(t(d))return r;if(e(d)){var f=typeof d.valueOf=="function"?d.valueOf():d;d=e(f)?f+"":f}if(typeof d!="string")return d===0?d:+d;d=n(d);var h=o.test(d);return h||a.test(d)?l(d.slice(2),h?2:8):i.test(d)?r:+d}return _h=u,_h}var bh,ib;function Yw(){if(ib)return bh;ib=1;var n=L9(),e=1/0,t=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=n(i),i===e||i===-e){var o=i<0?-1:1;return o*t}return i===i?i:0}return bh=r,bh}var xh,ob;function P9(){if(ob)return xh;ob=1;var n=Yw();function e(t){var r=n(t),i=r%1;return r===r?i?r-i:r:0}return xh=e,xh}var wh,ab;function R9(){if(ab)return wh;ab=1;var n=_N(),e=eu(),t=P9(),r=Math.max;function i(o,a,l){var u=o==null?0:o.length;if(!u)return-1;var d=l==null?0:t(l);return d<0&&(d=r(u+d,0)),n(o,e(a,3),d)}return wh=i,wh}var Sh,sb;function I9(){if(sb)return Sh;sb=1;var n=A9(),e=R9(),t=n(e);return Sh=t,Sh}var Eh,lb;function Kw(){if(lb)return Eh;lb=1;var n=K1();function e(t){var r=t==null?0:t.length;return r?n(t,1):[]}return Eh=e,Eh}var Ch,ub;function B9(){if(ub)return Ch;ub=1;var n=J1(),e=bN(),t=Oc();function r(i,o){return i==null?i:n(i,e(o),t)}return Ch=r,Ch}var kh,db;function j9(){if(db)return kh;db=1;function n(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}return kh=n,kh}var Oh,cb;function H9(){if(cb)return Oh;cb=1;var n=Z1(),e=xN(),t=eu();function r(i,o){var a={};return o=t(o,3),e(i,function(l,u,d){n(a,u,o(l,u,d))}),a}return Oh=r,Oh}var Mh,fb;function bg(){if(fb)return Mh;fb=1;var n=zv();function e(t,r,i){for(var o=-1,a=t.length;++o<a;){var l=t[o],u=r(l);if(u!=null&&(d===void 0?u===u&&!n(u):i(u,d)))var d=u,f=l}return f}return Mh=e,Mh}var Nh,hb;function $9(){if(hb)return Nh;hb=1;function n(e,t){return e>t}return Nh=n,Nh}var Ah,pb;function F9(){if(pb)return Ah;pb=1;var n=bg(),e=$9(),t=Uv();function r(i){return i&&i.length?n(i,t,e):void 0}return Ah=r,Ah}var Th,vb;function Jw(){if(vb)return Th;vb=1;var n=Z1(),e=$v();function t(r,i,o){(o!==void 0&&!e(r[i],o)||o===void 0&&!(i in r))&&n(r,i,o)}return Th=t,Th}var Dh,gb;function z9(){if(gb)return Dh;gb=1;var n=wN(),e=SN(),t=EN(),r="[object Object]",i=Function.prototype,o=Object.prototype,a=i.toString,l=o.hasOwnProperty,u=a.call(Object);function d(f){if(!t(f)||n(f)!=r)return!1;var h=e(f);if(h===null)return!0;var v=l.call(h,"constructor")&&h.constructor;return typeof v=="function"&&v instanceof v&&a.call(v)==u}return Dh=d,Dh}var Lh,mb;function Zw(){if(mb)return Lh;mb=1;function n(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}return Lh=n,Lh}var Ph,yb;function U9(){if(yb)return Ph;yb=1;var n=CN(),e=Oc();function t(r){return n(r,e(r))}return Ph=t,Ph}var Rh,_b;function V9(){if(_b)return Rh;_b=1;var n=Jw(),e=kN(),t=ON(),r=PN(),i=MN(),o=NN(),a=Q1(),l=AN(),u=TN(),d=DN(),f=Ql(),h=z9(),v=LN(),y=Zw(),x=U9();function w(_,b,E,k,O,N,I){var T=y(_,E),L=y(b,E),H=I.get(L);if(H){n(_,E,H);return}var X=N?N(T,L,E+"",_,b,I):void 0,V=X===void 0;if(V){var q=a(L),D=!q&&u(L),W=!q&&!D&&v(L);X=L,q||D||W?a(T)?X=T:l(T)?X=r(T):D?(V=!1,X=e(L,!0)):W?(V=!1,X=t(L,!0)):X=[]:h(L)||o(L)?(X=T,o(T)?X=x(T):(!f(T)||d(T))&&(X=i(L))):V=!1}V&&(I.set(L,X),O(X,L,k,N,I),I.delete(L)),n(_,E,X)}return Rh=w,Rh}var Ih,bb;function W9(){if(bb)return Ih;bb=1;var n=RN(),e=Jw(),t=J1(),r=V9(),i=Ql(),o=Oc(),a=Zw();function l(u,d,f,h,v){u!==d&&t(d,function(y,x){if(v||(v=new n),i(y))r(u,d,x,f,l,h,v);else{var w=h?h(a(u,x),y,x+"",u,d,v):void 0;w===void 0&&(w=y),e(u,x,w)}},o)}return Ih=l,Ih}var Bh,xb;function G9(){if(xb)return Bh;xb=1;var n=Fv(),e=Fc();function t(r){return n(function(i,o){var a=-1,l=o.length,u=l>1?o[l-1]:void 0,d=l>2?o[2]:void 0;for(u=r.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(o[0],o[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++a<l;){var f=o[a];f&&r(i,f,a,u)}return i})}return Bh=t,Bh}var jh,wb;function q9(){if(wb)return jh;wb=1;var n=W9(),e=G9(),t=e(function(r,i,o){n(r,i,o)});return jh=t,jh}var Hh,Sb;function Qw(){if(Sb)return Hh;Sb=1;function n(e,t){return e<t}return Hh=n,Hh}var $h,Eb;function X9(){if(Eb)return $h;Eb=1;var n=bg(),e=Qw(),t=Uv();function r(i){return i&&i.length?n(i,t,e):void 0}return $h=r,$h}var Fh,Cb;function Y9(){if(Cb)return Fh;Cb=1;var n=bg(),e=eu(),t=Qw();function r(i,o){return i&&i.length?n(i,e(o,2),t):void 0}return Fh=r,Fh}var zh,kb;function K9(){if(kb)return zh;kb=1;var n=IN(),e=function(){return n.Date.now()};return zh=e,zh}var Uh,Ob;function J9(){if(Ob)return Uh;Ob=1;var n=ex(),e=tx(),t=Y1(),r=Ql(),i=BN();function o(a,l,u,d){if(!r(a))return a;l=e(l,a);for(var f=-1,h=l.length,v=h-1,y=a;y!=null&&++f<h;){var x=i(l[f]),w=u;if(x==="__proto__"||x==="constructor"||x==="prototype")return a;if(f!=v){var _=y[x];w=d?d(_,x,y):void 0,w===void 0&&(w=r(_)?_:t(l[f+1])?[]:{})}n(y,x,w),y=y[x]}return a}return Uh=o,Uh}var Vh,Mb;function Z9(){if(Mb)return Vh;Mb=1;var n=nx(),e=J9(),t=tx();function r(i,o,a){for(var l=-1,u=o.length,d={};++l<u;){var f=o[l],h=n(i,f);a(h,f)&&e(d,t(f,i),h)}return d}return Vh=r,Vh}var Wh,Nb;function Q9(){if(Nb)return Wh;Nb=1;var n=Z9(),e=jN();function t(r,i){return n(r,i,function(o,a){return e(r,a)})}return Wh=t,Wh}var Gh,Ab;function e7(){if(Ab)return Gh;Ab=1;var n=Kw(),e=$N(),t=HN();function r(i){return t(e(i,void 0,n),i+"")}return Gh=r,Gh}var qh,Tb;function t7(){if(Tb)return qh;Tb=1;var n=Q9(),e=e7(),t=e(function(r,i){return r==null?{}:n(r,i)});return qh=t,qh}var Xh,Db;function n7(){if(Db)return Xh;Db=1;var n=Math.ceil,e=Math.max;function t(r,i,o,a){for(var l=-1,u=e(n((i-r)/(o||1)),0),d=Array(u);u--;)d[a?u:++l]=r,r+=o;return d}return Xh=t,Xh}var Yh,Lb;function r7(){if(Lb)return Yh;Lb=1;var n=n7(),e=Fc(),t=Yw();function r(i){return function(o,a,l){return l&&typeof l!="number"&&e(o,a,l)&&(a=l=void 0),o=t(o),a===void 0?(a=o,o=0):a=t(a),l=l===void 0?o<a?1:-1:t(l),n(o,a,l,i)}}return Yh=r,Yh}var Kh,Pb;function i7(){if(Pb)return Kh;Pb=1;var n=r7(),e=n();return Kh=e,Kh}var Jh,Rb;function o7(){if(Rb)return Jh;Rb=1;function n(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}return Jh=n,Jh}var Zh,Ib;function a7(){if(Ib)return Zh;Ib=1;var n=zv();function e(t,r){if(t!==r){var i=t!==void 0,o=t===null,a=t===t,l=n(t),u=r!==void 0,d=r===null,f=r===r,h=n(r);if(!d&&!h&&!l&&t>r||l&&u&&f&&!d&&!h||o&&u&&f||!i&&f||!a)return 1;if(!o&&!l&&!h&&t<r||h&&i&&a&&!o&&!l||d&&i&&a||!u&&a||!f)return-1}return 0}return Zh=e,Zh}var Qh,Bb;function s7(){if(Bb)return Qh;Bb=1;var n=a7();function e(t,r,i){for(var o=-1,a=t.criteria,l=r.criteria,u=a.length,d=i.length;++o<u;){var f=n(a[o],l[o]);if(f){if(o>=d)return f;var h=i[o];return f*(h=="desc"?-1:1)}}return t.index-r.index}return Qh=e,Qh}var ep,jb;function l7(){if(jb)return ep;jb=1;var n=zN(),e=nx(),t=eu(),r=FN(),i=o7(),o=UN(),a=s7(),l=Uv(),u=Q1();function d(f,h,v){h.length?h=n(h,function(w){return u(w)?function(_){return e(_,w.length===1?w[0]:w)}:w}):h=[l];var y=-1;h=n(h,o(t));var x=r(f,function(w,_,b){var E=n(h,function(k){return k(w)});return{criteria:E,index:++y,value:w}});return i(x,function(w,_){return a(w,_,v)})}return ep=d,ep}var tp,Hb;function u7(){if(Hb)return tp;Hb=1;var n=K1(),e=l7(),t=Fv(),r=Fc(),i=t(function(o,a){if(o==null)return[];var l=a.length;return l>1&&r(o,a[0],a[1])?a=[]:l>2&&r(a[0],a[1],a[2])&&(a=[a[0]]),e(o,n(a,1),[])});return tp=i,tp}var np,$b;function d7(){if($b)return np;$b=1;var n=VN(),e=0;function t(r){var i=++e;return n(r)+i}return np=t,np}var rp,Fb;function c7(){if(Fb)return rp;Fb=1;function n(e,t,r){for(var i=-1,o=e.length,a=t.length,l={};++i<o;){var u=i<a?t[i]:void 0;r(l,e[i],u)}return l}return rp=n,rp}var ip,zb;function f7(){if(zb)return ip;zb=1;var n=ex(),e=c7();function t(r,i){return e(r||[],i||[],n)}return ip=t,ip}var op,Ub;function On(){if(Ub)return op;Ub=1;var n;if(typeof q1=="function")try{n={cloneDeep:M9(),constant:QN(),defaults:N9(),each:ZN(),filter:JN(),find:I9(),flatten:Kw(),forEach:KN(),forIn:B9(),has:YN(),isUndefined:XN(),last:j9(),map:qN(),mapValues:H9(),max:F9(),merge:q9(),min:X9(),minBy:Y9(),now:K9(),pick:t7(),range:i7(),reduce:GN(),sortBy:u7(),uniqueId:d7(),values:WN(),zipObject:f7()}}catch{}return n||(n=window._),op=n,op}var ap,Vb;function h7(){if(Vb)return ap;Vb=1,ap=n;function n(){var r={};r._next=r._prev=r,this._sentinel=r}n.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},n.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},n.prototype.toString=function(){for(var r=[],i=this._sentinel,o=i._prev;o!==i;)r.push(JSON.stringify(o,t)),o=o._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function t(r,i){if(r!=="_next"&&r!=="_prev")return i}return ap}var sp,Wb;function p7(){if(Wb)return sp;Wb=1;var n=On(),e=Li().Graph,t=h7();sp=i;var r=n.constant(1);function i(d,f){if(d.nodeCount()<=1)return[];var h=l(d,f||r),v=o(h.graph,h.buckets,h.zeroIdx);return n.flatten(n.map(v,function(y){return d.outEdges(y.v,y.w)}),!0)}function o(d,f,h){for(var v=[],y=f[f.length-1],x=f[0],w;d.nodeCount();){for(;w=x.dequeue();)a(d,f,h,w);for(;w=y.dequeue();)a(d,f,h,w);if(d.nodeCount()){for(var _=f.length-2;_>0;--_)if(w=f[_].dequeue(),w){v=v.concat(a(d,f,h,w,!0));break}}}return v}function a(d,f,h,v,y){var x=y?[]:void 0;return n.forEach(d.inEdges(v.v),function(w){var _=d.edge(w),b=d.node(w.v);y&&x.push({v:w.v,w:w.w}),b.out-=_,u(f,h,b)}),n.forEach(d.outEdges(v.v),function(w){var _=d.edge(w),b=w.w,E=d.node(b);E.in-=_,u(f,h,E)}),d.removeNode(v.v),x}function l(d,f){var h=new e,v=0,y=0;n.forEach(d.nodes(),function(_){h.setNode(_,{v:_,in:0,out:0})}),n.forEach(d.edges(),function(_){var b=h.edge(_.v,_.w)||0,E=f(_),k=b+E;h.setEdge(_.v,_.w,k),y=Math.max(y,h.node(_.v).out+=E),v=Math.max(v,h.node(_.w).in+=E)});var x=n.range(y+v+3).map(function(){return new t}),w=v+1;return n.forEach(h.nodes(),function(_){u(x,w,h.node(_))}),{graph:h,buckets:x,zeroIdx:w}}function u(d,f,h){h.out?h.in?d[h.out-h.in+f].enqueue(h):d[d.length-1].enqueue(h):d[0].enqueue(h)}return sp}var lp,Gb;function v7(){if(Gb)return lp;Gb=1;var n=On(),e=p7();lp={run:t,undo:i};function t(o){var a=o.graph().acyclicer==="greedy"?e(o,l(o)):r(o);n.forEach(a,function(u){var d=o.edge(u);o.removeEdge(u),d.forwardName=u.name,d.reversed=!0,o.setEdge(u.w,u.v,d,n.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function r(o){var a=[],l={},u={};function d(f){n.has(u,f)||(u[f]=!0,l[f]=!0,n.forEach(o.outEdges(f),function(h){n.has(l,h.w)?a.push(h):d(h.w)}),delete l[f])}return n.forEach(o.nodes(),d),a}function i(o){n.forEach(o.edges(),function(a){var l=o.edge(a);if(l.reversed){o.removeEdge(a);var u=l.forwardName;delete l.reversed,delete l.forwardName,o.setEdge(a.w,a.v,l,u)}})}return lp}var up,qb;function jr(){if(qb)return up;qb=1;var n=On(),e=Li().Graph;up={addDummyNode:t,simplify:r,asNonCompoundGraph:i,successorWeights:o,predecessorWeights:a,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:f,addBorderNode:h,maxRank:v,partition:y,time:x,notime:w};function t(_,b,E,k){var O;do O=n.uniqueId(k);while(_.hasNode(O));return E.dummy=b,_.setNode(O,E),O}function r(_){var b=new e().setGraph(_.graph());return n.forEach(_.nodes(),function(E){b.setNode(E,_.node(E))}),n.forEach(_.edges(),function(E){var k=b.edge(E.v,E.w)||{weight:0,minlen:1},O=_.edge(E);b.setEdge(E.v,E.w,{weight:k.weight+O.weight,minlen:Math.max(k.minlen,O.minlen)})}),b}function i(_){var b=new e({multigraph:_.isMultigraph()}).setGraph(_.graph());return n.forEach(_.nodes(),function(E){_.children(E).length||b.setNode(E,_.node(E))}),n.forEach(_.edges(),function(E){b.setEdge(E,_.edge(E))}),b}function o(_){var b=n.map(_.nodes(),function(E){var k={};return n.forEach(_.outEdges(E),function(O){k[O.w]=(k[O.w]||0)+_.edge(O).weight}),k});return n.zipObject(_.nodes(),b)}function a(_){var b=n.map(_.nodes(),function(E){var k={};return n.forEach(_.inEdges(E),function(O){k[O.v]=(k[O.v]||0)+_.edge(O).weight}),k});return n.zipObject(_.nodes(),b)}function l(_,b){var E=_.x,k=_.y,O=b.x-E,N=b.y-k,I=_.width/2,T=_.height/2;if(!O&&!N)throw new Error("Not possible to find intersection inside of the rectangle");var L,H;return Math.abs(N)*I>Math.abs(O)*T?(N<0&&(T=-T),L=T*O/N,H=T):(O<0&&(I=-I),L=I,H=I*N/O),{x:E+L,y:k+H}}function u(_){var b=n.map(n.range(v(_)+1),function(){return[]});return n.forEach(_.nodes(),function(E){var k=_.node(E),O=k.rank;n.isUndefined(O)||(b[O][k.order]=E)}),b}function d(_){var b=n.min(n.map(_.nodes(),function(E){return _.node(E).rank}));n.forEach(_.nodes(),function(E){var k=_.node(E);n.has(k,"rank")&&(k.rank-=b)})}function f(_){var b=n.min(n.map(_.nodes(),function(N){return _.node(N).rank})),E=[];n.forEach(_.nodes(),function(N){var I=_.node(N).rank-b;E[I]||(E[I]=[]),E[I].push(N)});var k=0,O=_.graph().nodeRankFactor;n.forEach(E,function(N,I){n.isUndefined(N)&&I%O!==0?--k:k&&n.forEach(N,function(T){_.node(T).rank+=k})})}function h(_,b,E,k){var O={width:0,height:0};return arguments.length>=4&&(O.rank=E,O.order=k),t(_,"border",O,b)}function v(_){return n.max(n.map(_.nodes(),function(b){var E=_.node(b).rank;if(!n.isUndefined(E))return E}))}function y(_,b){var E={lhs:[],rhs:[]};return n.forEach(_,function(k){b(k)?E.lhs.push(k):E.rhs.push(k)}),E}function x(_,b){var E=n.now();try{return b()}finally{_+""+(n.now()-E)}}function w(_,b){return b()}return up}var dp,Xb;function g7(){if(Xb)return dp;Xb=1;var n=On(),e=jr();dp={run:t,undo:i};function t(o){o.graph().dummyChains=[],n.forEach(o.edges(),function(a){r(o,a)})}function r(o,a){var l=a.v,u=o.node(l).rank,d=a.w,f=o.node(d).rank,h=a.name,v=o.edge(a),y=v.labelRank;if(f!==u+1){o.removeEdge(a);var x,w,_;for(_=0,++u;u<f;++_,++u)v.points=[],w={width:0,height:0,edgeLabel:v,edgeObj:a,rank:u},x=e.addDummyNode(o,"edge",w,"_d"),u===y&&(w.width=v.width,w.height=v.height,w.dummy="edge-label",w.labelpos=v.labelpos),o.setEdge(l,x,{weight:v.weight},h),_===0&&o.graph().dummyChains.push(x),l=x;o.setEdge(l,d,{weight:v.weight},h)}}function i(o){n.forEach(o.graph().dummyChains,function(a){var l=o.node(a),u=l.edgeLabel,d;for(o.setEdge(l.edgeObj,u);l.dummy;)d=o.successors(a)[0],o.removeNode(a),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),a=d,l=o.node(a)})}return dp}var cp,Yb;function vc(){if(Yb)return cp;Yb=1;var n=On();cp={longestPath:e,slack:t};function e(r){var i={};function o(a){var l=r.node(a);if(n.has(i,a))return l.rank;i[a]=!0;var u=n.min(n.map(r.outEdges(a),function(d){return o(d.w)-r.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}n.forEach(r.sources(),o)}function t(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return cp}var fp,Kb;function eS(){if(Kb)return fp;Kb=1;var n=On(),e=Li().Graph,t=vc().slack;fp=r;function r(l){var u=new e({directed:!1}),d=l.nodes()[0],f=l.nodeCount();u.setNode(d,{});for(var h,v;i(u,l)<f;)h=o(u,l),v=u.hasNode(h.v)?t(l,h):-t(l,h),a(u,l,v);return u}function i(l,u){function d(f){n.forEach(u.nodeEdges(f),function(h){var v=h.v,y=f===v?h.w:v;!l.hasNode(y)&&!t(u,h)&&(l.setNode(y,{}),l.setEdge(f,y,{}),d(y))})}return n.forEach(l.nodes(),d),l.nodeCount()}function o(l,u){return n.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return t(u,d)})}function a(l,u,d){n.forEach(l.nodes(),function(f){u.node(f).rank+=d})}return fp}var hp,Jb;function m7(){if(Jb)return hp;Jb=1;var n=On(),e=eS(),t=vc().slack,r=vc().longestPath,i=Li().alg.preorder,o=Li().alg.postorder,a=jr().simplify;hp=l,l.initLowLimValues=h,l.initCutValues=u,l.calcCutValue=f,l.leaveEdge=y,l.enterEdge=x,l.exchangeEdges=w;function l(k){k=a(k),r(k);var O=e(k);h(O),u(O,k);for(var N,I;N=y(O);)I=x(O,k,N),w(O,k,N,I)}function u(k,O){var N=o(k,k.nodes());N=N.slice(0,N.length-1),n.forEach(N,function(I){d(k,O,I)})}function d(k,O,N){var I=k.node(N),T=I.parent;k.edge(N,T).cutvalue=f(k,O,N)}function f(k,O,N){var I=k.node(N),T=I.parent,L=!0,H=O.edge(N,T),X=0;return H||(L=!1,H=O.edge(T,N)),X=H.weight,n.forEach(O.nodeEdges(N),function(V){var q=V.v===N,D=q?V.w:V.v;if(D!==T){var W=q===L,$=O.edge(V).weight;if(X+=W?$:-$,b(k,N,D)){var pe=k.edge(N,D).cutvalue;X+=W?-pe:pe}}}),X}function h(k,O){arguments.length<2&&(O=k.nodes()[0]),v(k,{},1,O)}function v(k,O,N,I,T){var L=N,H=k.node(I);return O[I]=!0,n.forEach(k.neighbors(I),function(X){n.has(O,X)||(N=v(k,O,N,X,I))}),H.low=L,H.lim=N++,T?H.parent=T:delete H.parent,N}function y(k){return n.find(k.edges(),function(O){return k.edge(O).cutvalue<0})}function x(k,O,N){var I=N.v,T=N.w;O.hasEdge(I,T)||(I=N.w,T=N.v);var L=k.node(I),H=k.node(T),X=L,V=!1;L.lim>H.lim&&(X=H,V=!0);var q=n.filter(O.edges(),function(D){return V===E(k,k.node(D.v),X)&&V!==E(k,k.node(D.w),X)});return n.minBy(q,function(D){return t(O,D)})}function w(k,O,N,I){var T=N.v,L=N.w;k.removeEdge(T,L),k.setEdge(I.v,I.w,{}),h(k),u(k,O),_(k,O)}function _(k,O){var N=n.find(k.nodes(),function(T){return!O.node(T).parent}),I=i(k,N);I=I.slice(1),n.forEach(I,function(T){var L=k.node(T).parent,H=O.edge(T,L),X=!1;H||(H=O.edge(L,T),X=!0),O.node(T).rank=O.node(L).rank+(X?H.minlen:-H.minlen)})}function b(k,O,N){return k.hasEdge(O,N)}function E(k,O,N){return N.low<=O.lim&&O.lim<=N.lim}return hp}var pp,Zb;function y7(){if(Zb)return pp;Zb=1;var n=vc(),e=n.longestPath,t=eS(),r=m7();pp=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":a(u);break;case"longest-path":o(u);break;default:l(u)}}var o=e;function a(u){e(u),t(u)}function l(u){r(u)}return pp}var vp,Qb;function _7(){if(Qb)return vp;Qb=1;var n=On();vp=e;function e(i){var o=r(i);n.forEach(i.graph().dummyChains,function(a){for(var l=i.node(a),u=l.edgeObj,d=t(i,o,u.v,u.w),f=d.path,h=d.lca,v=0,y=f[v],x=!0;a!==u.w;){if(l=i.node(a),x){for(;(y=f[v])!==h&&i.node(y).maxRank<l.rank;)v++;y===h&&(x=!1)}if(!x){for(;v<f.length-1&&i.node(y=f[v+1]).minRank<=l.rank;)v++;y=f[v]}i.setParent(a,y),a=i.successors(a)[0]}})}function t(i,o,a,l){var u=[],d=[],f=Math.min(o[a].low,o[l].low),h=Math.max(o[a].lim,o[l].lim),v,y;v=a;do v=i.parent(v),u.push(v);while(v&&(o[v].low>f||h>o[v].lim));for(y=v,v=l;(v=i.parent(v))!==y;)d.push(v);return{path:u.concat(d.reverse()),lca:y}}function r(i){var o={},a=0;function l(u){var d=a;n.forEach(i.children(u),l),o[u]={low:d,lim:a++}}return n.forEach(i.children(),l),o}return vp}var gp,e1;function b7(){if(e1)return gp;e1=1;var n=On(),e=jr();gp={run:t,cleanup:a};function t(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),f=n.max(n.values(d))-1,h=2*f+1;l.graph().nestingRoot=u,n.forEach(l.edges(),function(y){l.edge(y).minlen*=h});var v=o(l)+1;n.forEach(l.children(),function(y){r(l,u,h,v,f,d,y)}),l.graph().nodeRankFactor=h}function r(l,u,d,f,h,v,y){var x=l.children(y);if(!x.length){y!==u&&l.setEdge(u,y,{weight:0,minlen:d});return}var w=e.addBorderNode(l,"_bt"),_=e.addBorderNode(l,"_bb"),b=l.node(y);l.setParent(w,y),b.borderTop=w,l.setParent(_,y),b.borderBottom=_,n.forEach(x,function(E){r(l,u,d,f,h,v,E);var k=l.node(E),O=k.borderTop?k.borderTop:E,N=k.borderBottom?k.borderBottom:E,I=k.borderTop?f:2*f,T=O!==N?1:h-v[y]+1;l.setEdge(w,O,{weight:I,minlen:T,nestingEdge:!0}),l.setEdge(N,_,{weight:I,minlen:T,nestingEdge:!0})}),l.parent(y)||l.setEdge(u,w,{weight:0,minlen:h+v[y]})}function i(l){var u={};function d(f,h){var v=l.children(f);v&&v.length&&n.forEach(v,function(y){d(y,h+1)}),u[f]=h}return n.forEach(l.children(),function(f){d(f,1)}),u}function o(l){return n.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function a(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,n.forEach(l.edges(),function(d){var f=l.edge(d);f.nestingEdge&&l.removeEdge(d)})}return gp}var mp,t1;function x7(){if(t1)return mp;t1=1;var n=On(),e=jr();mp=t;function t(i){function o(a){var l=i.children(a),u=i.node(a);if(l.length&&n.forEach(l,o),n.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,f=u.maxRank+1;d<f;++d)r(i,"borderLeft","_bl",a,u,d),r(i,"borderRight","_br",a,u,d)}}n.forEach(i.children(),o)}function r(i,o,a,l,u,d){var f={width:0,height:0,rank:d,borderType:o},h=u[o][d-1],v=e.addDummyNode(i,"border",f,a);u[o][d]=v,i.setParent(v,l),h&&i.setEdge(h,v,{weight:1})}return mp}var yp,n1;function w7(){if(n1)return yp;n1=1;var n=On();yp={adjust:e,undo:t};function e(d){var f=d.graph().rankdir.toLowerCase();(f==="lr"||f==="rl")&&r(d)}function t(d){var f=d.graph().rankdir.toLowerCase();(f==="bt"||f==="rl")&&o(d),(f==="lr"||f==="rl")&&(l(d),r(d))}function r(d){n.forEach(d.nodes(),function(f){i(d.node(f))}),n.forEach(d.edges(),function(f){i(d.edge(f))})}function i(d){var f=d.width;d.width=d.height,d.height=f}function o(d){n.forEach(d.nodes(),function(f){a(d.node(f))}),n.forEach(d.edges(),function(f){var h=d.edge(f);n.forEach(h.points,a),n.has(h,"y")&&a(h)})}function a(d){d.y=-d.y}function l(d){n.forEach(d.nodes(),function(f){u(d.node(f))}),n.forEach(d.edges(),function(f){var h=d.edge(f);n.forEach(h.points,u),n.has(h,"x")&&u(h)})}function u(d){var f=d.x;d.x=d.y,d.y=f}return yp}var _p,r1;function S7(){if(r1)return _p;r1=1;var n=On();_p=e;function e(t){var r={},i=n.filter(t.nodes(),function(d){return!t.children(d).length}),o=n.max(n.map(i,function(d){return t.node(d).rank})),a=n.map(n.range(o+1),function(){return[]});function l(d){if(!n.has(r,d)){r[d]=!0;var f=t.node(d);a[f.rank].push(d),n.forEach(t.successors(d),l)}}var u=n.sortBy(i,function(d){return t.node(d).rank});return n.forEach(u,l),a}return _p}var bp,i1;function E7(){if(i1)return bp;i1=1;var n=On();bp=e;function e(r,i){for(var o=0,a=1;a<i.length;++a)o+=t(r,i[a-1],i[a]);return o}function t(r,i,o){for(var a=n.zipObject(o,n.map(o,function(v,y){return y})),l=n.flatten(n.map(i,function(v){return n.sortBy(n.map(r.outEdges(v),function(y){return{pos:a[y.w],weight:r.edge(y).weight}}),"pos")}),!0),u=1;u<o.length;)u<<=1;var d=2*u-1;u-=1;var f=n.map(new Array(d),function(){return 0}),h=0;return n.forEach(l.forEach(function(v){var y=v.pos+u;f[y]+=v.weight;for(var x=0;y>0;)y%2&&(x+=f[y+1]),y=y-1>>1,f[y]+=v.weight;h+=v.weight*x})),h}return bp}var xp,o1;function C7(){if(o1)return xp;o1=1;var n=On();xp=e;function e(t,r){return n.map(r,function(i){var o=t.inEdges(i);if(o.length){var a=n.reduce(o,function(l,u){var d=t.edge(u),f=t.node(u.v);return{sum:l.sum+d.weight*f.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:a.sum/a.weight,weight:a.weight}}else return{v:i}})}return xp}var wp,a1;function k7(){if(a1)return wp;a1=1;var n=On();wp=e;function e(i,o){var a={};n.forEach(i,function(u,d){var f=a[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};n.isUndefined(u.barycenter)||(f.barycenter=u.barycenter,f.weight=u.weight)}),n.forEach(o.edges(),function(u){var d=a[u.v],f=a[u.w];!n.isUndefined(d)&&!n.isUndefined(f)&&(f.indegree++,d.out.push(a[u.w]))});var l=n.filter(a,function(u){return!u.indegree});return t(l)}function t(i){var o=[];function a(d){return function(f){f.merged||(n.isUndefined(f.barycenter)||n.isUndefined(d.barycenter)||f.barycenter>=d.barycenter)&&r(d,f)}}function l(d){return function(f){f.in.push(d),--f.indegree===0&&i.push(f)}}for(;i.length;){var u=i.pop();o.push(u),n.forEach(u.in.reverse(),a(u)),n.forEach(u.out,l(u))}return n.map(n.filter(o,function(d){return!d.merged}),function(d){return n.pick(d,["vs","i","barycenter","weight"])})}function r(i,o){var a=0,l=0;i.weight&&(a+=i.barycenter*i.weight,l+=i.weight),o.weight&&(a+=o.barycenter*o.weight,l+=o.weight),i.vs=o.vs.concat(i.vs),i.barycenter=a/l,i.weight=l,i.i=Math.min(o.i,i.i),o.merged=!0}return wp}var Sp,s1;function O7(){if(s1)return Sp;s1=1;var n=On(),e=jr();Sp=t;function t(o,a){var l=e.partition(o,function(w){return n.has(w,"barycenter")}),u=l.lhs,d=n.sortBy(l.rhs,function(w){return-w.i}),f=[],h=0,v=0,y=0;u.sort(i(!!a)),y=r(f,d,y),n.forEach(u,function(w){y+=w.vs.length,f.push(w.vs),h+=w.barycenter*w.weight,v+=w.weight,y=r(f,d,y)});var x={vs:n.flatten(f,!0)};return v&&(x.barycenter=h/v,x.weight=v),x}function r(o,a,l){for(var u;a.length&&(u=n.last(a)).i<=l;)a.pop(),o.push(u.vs),l++;return l}function i(o){return function(a,l){return a.barycenter<l.barycenter?-1:a.barycenter>l.barycenter?1:o?l.i-a.i:a.i-l.i}}return Sp}var Ep,l1;function M7(){if(l1)return Ep;l1=1;var n=On(),e=C7(),t=k7(),r=O7();Ep=i;function i(l,u,d,f){var h=l.children(u),v=l.node(u),y=v?v.borderLeft:void 0,x=v?v.borderRight:void 0,w={};y&&(h=n.filter(h,function(N){return N!==y&&N!==x}));var _=e(l,h);n.forEach(_,function(N){if(l.children(N.v).length){var I=i(l,N.v,d,f);w[N.v]=I,n.has(I,"barycenter")&&a(N,I)}});var b=t(_,d);o(b,w);var E=r(b,f);if(y&&(E.vs=n.flatten([y,E.vs,x],!0),l.predecessors(y).length)){var k=l.node(l.predecessors(y)[0]),O=l.node(l.predecessors(x)[0]);n.has(E,"barycenter")||(E.barycenter=0,E.weight=0),E.barycenter=(E.barycenter*E.weight+k.order+O.order)/(E.weight+2),E.weight+=2}return E}function o(l,u){n.forEach(l,function(d){d.vs=n.flatten(d.vs.map(function(f){return u[f]?u[f].vs:f}),!0)})}function a(l,u){n.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return Ep}var Cp,u1;function N7(){if(u1)return Cp;u1=1;var n=On(),e=Li().Graph;Cp=t;function t(i,o,a){var l=r(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return n.forEach(i.nodes(),function(d){var f=i.node(d),h=i.parent(d);(f.rank===o||f.minRank<=o&&o<=f.maxRank)&&(u.setNode(d),u.setParent(d,h||l),n.forEach(i[a](d),function(v){var y=v.v===d?v.w:v.v,x=u.edge(y,d),w=n.isUndefined(x)?0:x.weight;u.setEdge(y,d,{weight:i.edge(v).weight+w})}),n.has(f,"minRank")&&u.setNode(d,{borderLeft:f.borderLeft[o],borderRight:f.borderRight[o]}))}),u}function r(i){for(var o;i.hasNode(o=n.uniqueId("_root")););return o}return Cp}var kp,d1;function A7(){if(d1)return kp;d1=1;var n=On();kp=e;function e(t,r,i){var o={},a;n.forEach(i,function(l){for(var u=t.parent(l),d,f;u;){if(d=t.parent(u),d?(f=o[d],o[d]=u):(f=a,a=u),f&&f!==u){r.setEdge(f,u);return}u=d}})}return kp}var Op,c1;function T7(){if(c1)return Op;c1=1;var n=On(),e=S7(),t=E7(),r=M7(),i=N7(),o=A7(),a=Li().Graph,l=jr();Op=u;function u(v){var y=l.maxRank(v),x=d(v,n.range(1,y+1),"inEdges"),w=d(v,n.range(y-1,-1,-1),"outEdges"),_=e(v);h(v,_);for(var b=Number.POSITIVE_INFINITY,E,k=0,O=0;O<4;++k,++O){f(k%2?x:w,k%4>=2),_=l.buildLayerMatrix(v);var N=t(v,_);N<b&&(O=0,E=n.cloneDeep(_),b=N)}h(v,E)}function d(v,y,x){return n.map(y,function(w){return i(v,w,x)})}function f(v,y){var x=new a;n.forEach(v,function(w){var _=w.graph().root,b=r(w,_,x,y);n.forEach(b.vs,function(E,k){w.node(E).order=k}),o(w,x,b.vs)})}function h(v,y){n.forEach(y,function(x){n.forEach(x,function(w,_){v.node(w).order=_})})}return Op}var Mp,f1;function D7(){if(f1)return Mp;f1=1;var n=On(),e=Li().Graph,t=jr();Mp={positionX:x,findType1Conflicts:r,findType2Conflicts:i,addConflict:a,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:v,findSmallestWidthAlignment:h,balance:y};function r(b,E){var k={};function O(N,I){var T=0,L=0,H=N.length,X=n.last(I);return n.forEach(I,function(V,q){var D=o(b,V),W=D?b.node(D).order:H;(D||V===X)&&(n.forEach(I.slice(L,q+1),function($){n.forEach(b.predecessors($),function(pe){var De=b.node(pe),de=De.order;(de<T||W<de)&&!(De.dummy&&b.node($).dummy)&&a(k,pe,$)})}),L=q+1,T=W)}),I}return n.reduce(E,O),k}function i(b,E){var k={};function O(I,T,L,H,X){var V;n.forEach(n.range(T,L),function(q){V=I[q],b.node(V).dummy&&n.forEach(b.predecessors(V),function(D){var W=b.node(D);W.dummy&&(W.order<H||W.order>X)&&a(k,D,V)})})}function N(I,T){var L=-1,H,X=0;return n.forEach(T,function(V,q){if(b.node(V).dummy==="border"){var D=b.predecessors(V);D.length&&(H=b.node(D[0]).order,O(T,X,q,L,H),X=q,L=H)}O(T,X,T.length,H,I.length)}),T}return n.reduce(E,N),k}function o(b,E){if(b.node(E).dummy)return n.find(b.predecessors(E),function(k){return b.node(k).dummy})}function a(b,E,k){if(E>k){var O=E;E=k,k=O}var N=b[E];N||(b[E]=N={}),N[k]=!0}function l(b,E,k){if(E>k){var O=E;E=k,k=O}return n.has(b[E],k)}function u(b,E,k,O){var N={},I={},T={};return n.forEach(E,function(L){n.forEach(L,function(H,X){N[H]=H,I[H]=H,T[H]=X})}),n.forEach(E,function(L){var H=-1;n.forEach(L,function(X){var V=O(X);if(V.length){V=n.sortBy(V,function(pe){return T[pe]});for(var q=(V.length-1)/2,D=Math.floor(q),W=Math.ceil(q);D<=W;++D){var $=V[D];I[X]===X&&H<T[$]&&!l(k,X,$)&&(I[$]=X,I[X]=N[X]=N[$],H=T[$])}}})}),{root:N,align:I}}function d(b,E,k,O,N){var I={},T=f(b,E,k,N),L=N?"borderLeft":"borderRight";function H(q,D){for(var W=T.nodes(),$=W.pop(),pe={};$;)pe[$]?q($):(pe[$]=!0,W.push($),W=W.concat(D($))),$=W.pop()}function X(q){I[q]=T.inEdges(q).reduce(function(D,W){return Math.max(D,I[W.v]+T.edge(W))},0)}function V(q){var D=T.outEdges(q).reduce(function($,pe){return Math.min($,I[pe.w]-T.edge(pe))},Number.POSITIVE_INFINITY),W=b.node(q);D!==Number.POSITIVE_INFINITY&&W.borderType!==L&&(I[q]=Math.max(I[q],D))}return H(X,T.predecessors.bind(T)),H(V,T.successors.bind(T)),n.forEach(O,function(q){I[q]=I[k[q]]}),I}function f(b,E,k,O){var N=new e,I=b.graph(),T=w(I.nodesep,I.edgesep,O);return n.forEach(E,function(L){var H;n.forEach(L,function(X){var V=k[X];if(N.setNode(V),H){var q=k[H],D=N.edge(q,V);N.setEdge(q,V,Math.max(T(b,X,H),D||0))}H=X})}),N}function h(b,E){return n.minBy(n.values(E),function(k){var O=Number.NEGATIVE_INFINITY,N=Number.POSITIVE_INFINITY;return n.forIn(k,function(I,T){var L=_(b,T)/2;O=Math.max(I+L,O),N=Math.min(I-L,N)}),O-N})}function v(b,E){var k=n.values(E),O=n.min(k),N=n.max(k);n.forEach(["u","d"],function(I){n.forEach(["l","r"],function(T){var L=I+T,H=b[L],X;if(H!==E){var V=n.values(H);X=T==="l"?O-n.min(V):N-n.max(V),X&&(b[L]=n.mapValues(H,function(q){return q+X}))}})})}function y(b,E){return n.mapValues(b.ul,function(k,O){if(E)return b[E.toLowerCase()][O];var N=n.sortBy(n.map(b,O));return(N[1]+N[2])/2})}function x(b){var E=t.buildLayerMatrix(b),k=n.merge(r(b,E),i(b,E)),O={},N;n.forEach(["u","d"],function(T){N=T==="u"?E:n.values(E).reverse(),n.forEach(["l","r"],function(L){L==="r"&&(N=n.map(N,function(q){return n.values(q).reverse()}));var H=(T==="u"?b.predecessors:b.successors).bind(b),X=u(b,N,k,H),V=d(b,N,X.root,X.align,L==="r");L==="r"&&(V=n.mapValues(V,function(q){return-q})),O[T+L]=V})});var I=h(b,O);return v(O,I),y(O,b.graph().align)}function w(b,E,k){return function(O,N,I){var T=O.node(N),L=O.node(I),H=0,X;if(H+=T.width/2,n.has(T,"labelpos"))switch(T.labelpos.toLowerCase()){case"l":X=-T.width/2;break;case"r":X=T.width/2;break}if(X&&(H+=k?X:-X),X=0,H+=(T.dummy?E:b)/2,H+=(L.dummy?E:b)/2,H+=L.width/2,n.has(L,"labelpos"))switch(L.labelpos.toLowerCase()){case"l":X=L.width/2;break;case"r":X=-L.width/2;break}return X&&(H+=k?X:-X),X=0,H}}function _(b,E){return b.node(E).width}return Mp}var Np,h1;function L7(){if(h1)return Np;h1=1;var n=On(),e=jr(),t=D7().positionX;Np=r;function r(o){o=e.asNonCompoundGraph(o),i(o),n.forEach(t(o),function(a,l){o.node(l).x=a})}function i(o){var a=e.buildLayerMatrix(o),l=o.graph().ranksep,u=0;n.forEach(a,function(d){var f=n.max(n.map(d,function(h){return o.node(h).height}));n.forEach(d,function(h){o.node(h).y=u+f/2}),u+=f+l})}return Np}var Ap,p1;function P7(){if(p1)return Ap;p1=1;var n=On(),e=v7(),t=g7(),r=y7(),i=jr().normalizeRanks,o=_7(),a=jr().removeEmptyRanks,l=b7(),u=x7(),d=w7(),f=T7(),h=L7(),v=jr(),y=Li().Graph;Ap=x;function x(ce,ue){var K=ue&&ue.debugTiming?v.time:v.notime;K("layout",function(){var ie=K("  buildLayoutGraph",function(){return H(ce)});K("  runLayout",function(){w(ie,K)}),K("  updateInputGraph",function(){_(ce,ie)})})}function w(ce,ue){ue("    makeSpaceForEdgeLabels",function(){X(ce)}),ue("    removeSelfEdges",function(){Se(ce)}),ue("    acyclic",function(){e.run(ce)}),ue("    nestingGraph.run",function(){l.run(ce)}),ue("    rank",function(){r(v.asNonCompoundGraph(ce))}),ue("    injectEdgeLabelProxies",function(){V(ce)}),ue("    removeEmptyRanks",function(){a(ce)}),ue("    nestingGraph.cleanup",function(){l.cleanup(ce)}),ue("    normalizeRanks",function(){i(ce)}),ue("    assignRankMinMax",function(){q(ce)}),ue("    removeEdgeLabelProxies",function(){D(ce)}),ue("    normalize.run",function(){t.run(ce)}),ue("    parentDummyChains",function(){o(ce)}),ue("    addBorderSegments",function(){u(ce)}),ue("    order",function(){f(ce)}),ue("    insertSelfEdges",function(){me(ce)}),ue("    adjustCoordinateSystem",function(){d.adjust(ce)}),ue("    position",function(){h(ce)}),ue("    positionSelfEdges",function(){ve(ce)}),ue("    removeBorderNodes",function(){de(ce)}),ue("    normalize.undo",function(){t.undo(ce)}),ue("    fixupEdgeLabelCoords",function(){pe(ce)}),ue("    undoCoordinateSystem",function(){d.undo(ce)}),ue("    translateGraph",function(){W(ce)}),ue("    assignNodeIntersects",function(){$(ce)}),ue("    reversePoints",function(){De(ce)}),ue("    acyclic.undo",function(){e.undo(ce)})}function _(ce,ue){n.forEach(ce.nodes(),function(K){var ie=ce.node(K),ne=ue.node(K);ie&&(ie.x=ne.x,ie.y=ne.y,ue.children(K).length&&(ie.width=ne.width,ie.height=ne.height))}),n.forEach(ce.edges(),function(K){var ie=ce.edge(K),ne=ue.edge(K);ie.points=ne.points,n.has(ne,"x")&&(ie.x=ne.x,ie.y=ne.y)}),ce.graph().width=ue.graph().width,ce.graph().height=ue.graph().height}var b=["nodesep","edgesep","ranksep","marginx","marginy"],E={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},k=["acyclicer","ranker","rankdir","align"],O=["width","height"],N={width:0,height:0},I=["minlen","weight","width","height","labeloffset"],T={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},L=["labelpos"];function H(ce){var ue=new y({multigraph:!0,compound:!0}),K=Ie(ce.graph());return ue.setGraph(n.merge({},E,Re(K,b),n.pick(K,k))),n.forEach(ce.nodes(),function(ie){var ne=Ie(ce.node(ie));ue.setNode(ie,n.defaults(Re(ne,O),N)),ue.setParent(ie,ce.parent(ie))}),n.forEach(ce.edges(),function(ie){var ne=Ie(ce.edge(ie));ue.setEdge(ie,n.merge({},T,Re(ne,I),n.pick(ne,L)))}),ue}function X(ce){var ue=ce.graph();ue.ranksep/=2,n.forEach(ce.edges(),function(K){var ie=ce.edge(K);ie.minlen*=2,ie.labelpos.toLowerCase()!=="c"&&(ue.rankdir==="TB"||ue.rankdir==="BT"?ie.width+=ie.labeloffset:ie.height+=ie.labeloffset)})}function V(ce){n.forEach(ce.edges(),function(ue){var K=ce.edge(ue);if(K.width&&K.height){var ie=ce.node(ue.v),ne=ce.node(ue.w),fe={rank:(ne.rank-ie.rank)/2+ie.rank,e:ue};v.addDummyNode(ce,"edge-proxy",fe,"_ep")}})}function q(ce){var ue=0;n.forEach(ce.nodes(),function(K){var ie=ce.node(K);ie.borderTop&&(ie.minRank=ce.node(ie.borderTop).rank,ie.maxRank=ce.node(ie.borderBottom).rank,ue=n.max(ue,ie.maxRank))}),ce.graph().maxRank=ue}function D(ce){n.forEach(ce.nodes(),function(ue){var K=ce.node(ue);K.dummy==="edge-proxy"&&(ce.edge(K.e).labelRank=K.rank,ce.removeNode(ue))})}function W(ce){var ue=Number.POSITIVE_INFINITY,K=0,ie=Number.POSITIVE_INFINITY,ne=0,fe=ce.graph(),he=fe.marginx||0,be=fe.marginy||0;function xe(Ze){var We=Ze.x,St=Ze.y,pt=Ze.width,Ht=Ze.height;ue=Math.min(ue,We-pt/2),K=Math.max(K,We+pt/2),ie=Math.min(ie,St-Ht/2),ne=Math.max(ne,St+Ht/2)}n.forEach(ce.nodes(),function(Ze){xe(ce.node(Ze))}),n.forEach(ce.edges(),function(Ze){var We=ce.edge(Ze);n.has(We,"x")&&xe(We)}),ue-=he,ie-=be,n.forEach(ce.nodes(),function(Ze){var We=ce.node(Ze);We.x-=ue,We.y-=ie}),n.forEach(ce.edges(),function(Ze){var We=ce.edge(Ze);n.forEach(We.points,function(St){St.x-=ue,St.y-=ie}),n.has(We,"x")&&(We.x-=ue),n.has(We,"y")&&(We.y-=ie)}),fe.width=K-ue+he,fe.height=ne-ie+be}function $(ce){n.forEach(ce.edges(),function(ue){var K=ce.edge(ue),ie=ce.node(ue.v),ne=ce.node(ue.w),fe,he;K.points?(fe=K.points[0],he=K.points[K.points.length-1]):(K.points=[],fe=ne,he=ie),K.points.unshift(v.intersectRect(ie,fe)),K.points.push(v.intersectRect(ne,he))})}function pe(ce){n.forEach(ce.edges(),function(ue){var K=ce.edge(ue);if(n.has(K,"x"))switch((K.labelpos==="l"||K.labelpos==="r")&&(K.width-=K.labeloffset),K.labelpos){case"l":K.x-=K.width/2+K.labeloffset;break;case"r":K.x+=K.width/2+K.labeloffset;break}})}function De(ce){n.forEach(ce.edges(),function(ue){var K=ce.edge(ue);K.reversed&&K.points.reverse()})}function de(ce){n.forEach(ce.nodes(),function(ue){if(ce.children(ue).length){var K=ce.node(ue),ie=ce.node(K.borderTop),ne=ce.node(K.borderBottom),fe=ce.node(n.last(K.borderLeft)),he=ce.node(n.last(K.borderRight));K.width=Math.abs(he.x-fe.x),K.height=Math.abs(ne.y-ie.y),K.x=fe.x+K.width/2,K.y=ie.y+K.height/2}}),n.forEach(ce.nodes(),function(ue){ce.node(ue).dummy==="border"&&ce.removeNode(ue)})}function Se(ce){n.forEach(ce.edges(),function(ue){if(ue.v===ue.w){var K=ce.node(ue.v);K.selfEdges||(K.selfEdges=[]),K.selfEdges.push({e:ue,label:ce.edge(ue)}),ce.removeEdge(ue)}})}function me(ce){var ue=v.buildLayerMatrix(ce);n.forEach(ue,function(K){var ie=0;n.forEach(K,function(ne,fe){var he=ce.node(ne);he.order=fe+ie,n.forEach(he.selfEdges,function(be){v.addDummyNode(ce,"selfedge",{width:be.label.width,height:be.label.height,rank:he.rank,order:fe+ ++ie,e:be.e,label:be.label},"_se")}),delete he.selfEdges})})}function ve(ce){n.forEach(ce.nodes(),function(ue){var K=ce.node(ue);if(K.dummy==="selfedge"){var ie=ce.node(K.e.v),ne=ie.x+ie.width/2,fe=ie.y,he=K.x-ne,be=ie.height/2;ce.setEdge(K.e,K.label),ce.removeNode(ue),K.label.points=[{x:ne+2*he/3,y:fe-be},{x:ne+5*he/6,y:fe-be},{x:ne+he,y:fe},{x:ne+5*he/6,y:fe+be},{x:ne+2*he/3,y:fe+be}],K.label.x=K.x,K.label.y=K.y}})}function Re(ce,ue){return n.mapValues(n.pick(ce,ue),Number)}function Ie(ce){var ue={};return n.forEach(ce,function(K,ie){ue[ie.toLowerCase()]=K}),ue}return Ap}var Tp,v1;function R7(){if(v1)return Tp;v1=1;var n=On(),e=jr(),t=Li().Graph;Tp={debugOrdering:r};function r(i){var o=e.buildLayerMatrix(i),a=new t({compound:!0,multigraph:!0}).setGraph({});return n.forEach(i.nodes(),function(l){a.setNode(l,{label:l}),a.setParent(l,"layer"+i.node(l).rank)}),n.forEach(i.edges(),function(l){a.setEdge(l.v,l.w,{},l.name)}),n.forEach(o,function(l,u){var d="layer"+u;a.setNode(d,{rank:"same"}),n.reduce(l,function(f,h){return a.setEdge(f,h,{style:"invis"}),h})}),a}return Tp}var Dp,g1;function I7(){return g1||(g1=1,Dp="0.8.5"),Dp}var Lp,m1;function B7(){return m1||(m1=1,Lp={graphlib:Li(),layout:P7(),debug:R7(),util:{time:jr().time,notime:jr().notime},version:I7()}),Lp}var tS=B7();const j7=va(tS);var Lv=function(){return Lv=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Lv.apply(this,arguments)},H7=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},$7=function(){function n(){}return n.prototype.render=function(e){this.lf=e},n.prototype.layout=function(e){var t=this;e===void 0&&(e={});var r=this.lf.graphModel,i=r.nodes,o=r.edges,a=r.gridSize,l=100,u=150;a>20&&(l=a*2,u=a*2),this.option=Lv({rankdir:"LR",align:"UL",ranker:"tight-tree",ranksep:u,nodesep:l,marginx:120,marginy:120},e);var d=new tS.graphlib.Graph;d.setGraph(this.option),d.setDefaultEdgeLabel(function(){return{}}),i.forEach(function(v){d.setNode(v.id,{width:v.width||150,height:v.height||50,id:v.id})}),o.forEach(function(v){d.setEdge(v.sourceNodeId,v.targetNodeId,{id:v.id})}),j7.layout(d);var f=[],h=[];i.forEach(function(v){var y,x=d.node(v.id),w=x.x,_=x.y,b=v.getData();if(!b)throw new Error("布局错误：找不到ID为 ".concat(v.id," 的节点"));b.x=w,b.y=_,!((y=b==null?void 0:b.text)===null||y===void 0)&&y.x&&(b.text.x=w,b.text.y=_),f.push(b)}),o.forEach(function(v){var y=v.getData();if(y){if(!e.isDefaultAnchor)delete y.pointsList,delete y.startPoint,delete y.endPoint,y.text&&y.text.value&&(y.text=y.text.value);else{delete y.pointsList,delete y.startPoint,delete y.endPoint,delete y.sourceAnchorId,delete y.targetAnchorId;var x=t.lf.getEdgeModelById(v.id);if(x&&(y.pointsList=t.calcPointsList(x,f)),y.pointsList){var w=y.pointsList[0],_=y.pointsList[y.pointsList.length-1];y.startPoint={x:w.x,y:w.y},y.endPoint={x:_.x,y:_.y}}y.text&&y.text.value&&(y.text=y.text.value)}h.push(y)}}),this.lf.renderRawData({nodes:f,edges:h})},n.prototype.getBytesLength=function(e){if(!e)return 0;for(var t=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);e.match(/[A-Z]/)?t+=1.5:i>=1&&i<=126||i>=65376&&i<=65439?t+=1:t+=2}return t},n.prototype.pointFilter=function(e){for(var t=H7([],e,!0),r=1;r<t.length-1;){var i=t[r-1],o=t[r],a=t[r+1];i.x===o.x&&o.x===a.x||i.y===o.y&&o.y===a.y?t.splice(r,1):r++}return t},n.prototype.calcPointsList=function(e,t){var r=[],i=this.lf.getNodeModelById(e.sourceNodeId),o=this.lf.getNodeModelById(e.targetNodeId),a=t.find(function(d){return d.id===e.sourceNodeId}),l=t.find(function(d){return d.id===e.targetNodeId});if(!(!i||!o||!a||!l)){var u=Number(e.offset)||50;if(this.option.rankdir==="LR"&&e.modelType==="polyline-edge"){if(a.x<l.x)return r.push({x:a.x+i.width/2,y:a.y}),r.push({x:a.x+i.width/2+u,y:a.y}),r.push({x:a.x+i.width/2+u,y:l.y}),r.push({x:l.x-o.width/2,y:l.y}),this.pointFilter(r);if(a.x>l.x)return a.y>=l.y?(r.push({x:a.x,y:a.y+i.height/2}),r.push({x:a.x,y:a.y+i.height/2+u}),r.push({x:l.x,y:a.y+i.height/2+u}),r.push({x:l.x,y:l.y+o.height/2})):(r.push({x:a.x,y:a.y-i.height/2}),r.push({x:a.x,y:a.y-i.height/2-u}),r.push({x:l.x,y:a.y-i.height/2-u}),r.push({x:l.x,y:l.y-o.height/2})),this.pointFilter(r)}if(this.option.rankdir==="TB"&&e.modelType==="polyline-edge"){if(a.y<l.y)return r.push({x:a.x,y:a.y+i.height/2}),r.push({x:a.x,y:a.y+i.height/2+u}),r.push({x:l.x,y:a.y+i.height/2+u}),r.push({x:l.x,y:l.y-o.height/2}),this.pointFilter(r);if(a.y>l.y)return a.x>=l.x?(r.push({x:a.x+i.width/2,y:a.y}),r.push({x:a.x+i.width/2+u,y:a.y}),r.push({x:a.x+i.width/2+u,y:l.y}),r.push({x:l.x+o.width/2,y:l.y})):(r.push({x:a.x-i.width/2,y:a.y}),r.push({x:a.x-i.width/2-u,y:a.y}),r.push({x:a.x-i.width/2-u,y:l.y}),r.push({x:l.x-o.width/2,y:l.y})),this.pointFilter(r)}}},n.pluginName="dagre",n}();const F7={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},z7={class:"custom-line-popup"};function U7(n,e,t,r,i,o){return To((G(),ae("div",z7,[S("button",{class:"delete-btn",onClick:e[0]||(e[0]=nn((...a)=>o.handleDelete&&o.handleDelete(...a),["stop"]))},"删 除")],512)),[[pa,i.isDeleteConfirmShow]])}const V7=_t(F7,[["render",U7],["__scopeId","data-v-4b6cc0a8"]]),W7=70,G7=36;let q7=class extends Ss{constructor(e){super(e),this.isMounted=!1,this.r=pn(V7,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=ga({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=W7,customHeight:r=G7}=e.getProperties(),i=e.id,{startPoint:o,endPoint:a,arrowConfig:l,pointsList:u}=e;let d={x:(o.x+a.x-t)/2,y:(o.y+a.y-r)/2,width:t,height:r};if(u.length>2){let h=Math.round(u.length/2);d.x=u[h-1].x+5,d.y=u[h-1].y}const f={width:t,height:r};return setTimeout(()=>{const h=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(h))},0),mt("foreignObject",{...d,id:"line_"+i},[mt("div",{id:i,style:f,className:"vue-app-wrapper"})])}},X7=class extends xs{initEdgeData(e){super.initEdgeData(e)}createId(){return os("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(o=>o.id===this.sourceAnchorId),r=this.graphModel.getNodeModelById(this.targetNodeId),i=r==null?void 0:r.getDefaultAnchor().find(o=>o.id===this.targetAnchorId);if(t){const o={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(o)}if(i){const o={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(o)}this.pointsList=[],this.initPoints()}};const Y7={type:"custom-edge",view:q7,model:X7},K7={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},J7={class:"custom-line-popup"};function Z7(n,e,t,r,i,o){return To((G(),ae("div",J7,[S("div",{class:"minus-circle-outlined",onClick:e[0]||(e[0]=nn((...a)=>o.handleDelete&&o.handleDelete(...a),["stop"]))})],512)),[[pa,i.isDeleteConfirmShow]])}const Q7=_t(K7,[["render",Z7],["__scopeId","data-v-74ab8938"]]);class ez extends Ev{constructor(e){super(e),this.isMounted=!1,this.r=pn(Q7,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=ga({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getEndArrow(){const{model:e}=this.props,{stroke:t,strokeWidth:r}=e.getArrowStyle();return mt("path",{stroke:t,strokeWidth:r,d:"M -9 -7 0 0 -9 7",fill:"none"})}getText(){const{model:e}=this.props,{startPoint:t,endPoint:r,pointsList:i}=e,o=e.id,a=24,l=24,u=a/2,d=l/2,f=b=>{const{x:E,y:k}=t,{x:O,y:N}=i[1],{x:I,y:T}=i[2],{x:L,y:H}=r,X=b*b,V=X*b,q=1-b,D=q*q,W=D*q;return{x:E*W+3*O*D*b+3*I*q*X+L*V,y:k*W+3*N*D*b+3*T*q*X+H*V}},h=(b=5)=>{let E=0,k=f(0);for(let O=1;O<=b;O++){const N=O/b,I=f(N),T=I.x-k.x,L=I.y-k.y;E+=Math.sqrt(T*T+L*L),k=I}return E},v=b=>{const E=b/2;let k=0,O=1,N=.5,I=1e-4;for(;O-k>I;)N=(k+O)/2,T(N)<E?k=N:O=N;function T(L){let H=0,X=f(0);const V=5;for(let q=1;q<=V;q++){const D=q/V*L,W=f(D),$=W.x-X.x,pe=W.y-X.y;H+=Math.sqrt($*$+pe*pe),X=W}return H}return f(N)},y=h(),x=v(y),w={x:x.x-u,y:x.y-d,width:a,height:l},_={width:a,height:l};return setTimeout(()=>{var E,k;const b=(E=document.querySelector(`#line_${o}`))==null?void 0:E.querySelector(".vue-app-wrapper");!this.isMounted&&b?(this.isMounted=!0,this.app.mount(b)):(k=this.r)!=null&&k.component&&(this.r.component.props.isSelected=e.isSelected,this.r.component.props.isHovered=e.isHovered,this.r.component.props.properties=e.getProperties())},0),mt("foreignObject",{...w,id:`line_${o}`},[mt("div",{id:o,style:_,className:"vue-app-wrapper"})])}}class tz extends lv{initEdgeData(e){super.initEdgeData(e)}setAttributes(e){super.setAttributes(e);let t=this.getProperties().offset;t&&(this.offset=t,this.pointsList=[],this.initPoints())}createId(){return os("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#37e1ffff":e.stroke="#2475FC",e.strokeWidth=2,e}getArrowStyle(){return{...super.getArrowStyle(),...this.arrowStyle,refX:0,refY:0}}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(o=>o.id===this.sourceAnchorId),r=this.graphModel.getNodeModelById(this.targetNodeId),i=r==null?void 0:r.getDefaultAnchor().find(o=>o.id===this.targetAnchorId);if(t){const o={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(o)}if(i){const o={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(o)}this.pointsList=[],this.initPoints()}}const nz={type:"custom-bezier-edge",view:ez,model:tz};function nS(n,e){return n.map(t=>{let r=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,o=e?e.node_type:t.node_type,a=t.name||t.key,l=e?`${e.text}.${a}`:a,u=t.children||t.subs||[],d="",f="";o==1?f=`global.${l}`:e?f=`${e.original_value}.${t.key}`:f=`${r}.${t.key}`,d=`【${f}】`;let h={label:a,value:d,original_value:f,node_id:r,node_name:i,node_type:o,text:l,key:t.key,id:r,typ:t.typ,children:u||[]};return h.children&&h.children.length>0&&(h.children=nS(h.children,h)),h})}class Tn extends Xl{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=pn(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=ga({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let r=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:r},t.model.width=i,t.model.height=r,t.model._width=i,t.model._height=r,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:r=>{t.model.properties.anchorList=r},setData:r=>{r.dataRaw=r.node_params,vn(()=>{t.model.properties={...t.model.properties,...r};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model.height=i||r.height||t.model.properties.height,t.model._height=i||r.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:r=>{t.model.properties.node_name=r,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:r,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),r=t.map(x=>x.sourceAnchorId),i=t.map(x=>x.targetAnchorId),o=!1;const{x:a,y:l,type:u}=e,d=10;u==="left"?o=i.includes(e.id):o=r.includes(e.id);const f=mt("circle",{className:"custom-anchor-circle",cx:a,cy:l,r:d,fill:"#fff",stroke:"#2475FC","stroke-width":2}),h=mt("g",{className:"custom-anchor-arrow",transform:`translate(${a-d-2}, ${l-d-2})`},[mt("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),mt("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),v=mt("g",{className:`custom-anchor-plus ${o?"anchor-hide":""}`,transform:`translate(${a-d-2}, ${l-d-2})`},[mt("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),mt("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),mt("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return mt("g",{id:e.id,className:`custom-anchor custom-anchor-${u} ${o?"anchor-selected":"anchor-not-selected"}`,onClick:x=>{x.stopPropagation();const{graphModel:w,model:_}=this.props;u==="right"&&!o&&w.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:_})}},f,h,v)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class Dn extends Gl{createId(){return os(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(o=>o.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let r=JSON.parse(t.properties.node_params);return{sys_global:r.start.sys_global,diy_global:r.start.diy_global,all_global:[...r.start.sys_global,...r.start.diy_global]}}getAllParentVariable(){var d,f;const e=[],t=new Set,r=this.incoming.edges,{nodes:i}=this.graphModel,o=["start-node","http-node","parameter-extraction-node","knowledge-base-node","ai-dialogue-node","specify-reply-node","problem-optimization-node","select-data-node","code-run-node","mcp-node","custom-group"];let a=i.find(h=>h.type==="start-node");a&&(t.add(a.id),e.push(a));const l=h=>{for(let v=0;v<h.length;v++){let x=h[v].sourceNode;t.has(x.id)||(t.add(x.id),o.includes(x.type)&&e.push(x),l(x.incoming.edges))}};l(r);let u=[];if(this.properties.loop_parent_key){let h=i.find(v=>v.id==this.properties.loop_parent_key);h&&(e.filter(y=>y.id==this.properties.loop_parent_key).length>0||e.push(h))}for(const h of e){if(!o.includes(h.type))continue;let v=JSON.parse(h.properties.node_params),y={label:h.properties.node_name,value:h.id,node_id:h.id,node_type:h.properties.node_type,typ:"node",children:[],loop_parent_key:h.properties.loop_parent_key};h.type==="http-node"&&(y.children=v.curl.output),h.type==="code-run-node"&&(y.children=v.code_run.output),h.type==="parameter-extraction-node"&&(y.children=v.params_extractor.output),h.type==="start-node"&&(y.children=[...v.start.diy_global,...v.start.sys_global]),h.type==="custom-group"&&(this.properties.loop_parent_key==h.id?y.children=[...((d=v.loop)==null?void 0:d.intermediate_params)||[],...((f=v.loop)==null?void 0:f.loop_arrays)||[]]:y.children=v.loop.output),h.type==="select-data-node"&&(y.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),h.type==="knowledge-base-node"&&(y.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),h.type==="ai-dialogue-node"&&(y.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),h.type==="specify-reply-node"&&(y.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),h.type==="problem-optimization-node"&&(y.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),h.type==="mcp-node"&&(y.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),y.children.forEach(x=>{x.node_id=h.id,x.node_name=h.properties.node_name,x.node_type=h.properties.node_type}),y.children=nS(y.children,null),u.push(y)}return u}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const rS="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",rz={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[]}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.$emit("handleMenu",n)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){let n=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",n)},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(n.target)&&n.target!==this.$el.querySelector(".node-menu-btn")&&n.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImgUrl(){return jv(this.node_type)},updateTitle(n){this.setTitle(n)}}},iz=["data-node-name","data-node-type"],oz={class:"node-header"},az={class:"node-header-left"},sz={key:0,class:"node-icon"},lz=["src"],uz={class:"node-title"},dz={key:0,class:"node-menu-wrapper"},cz={class:"node-menus"},fz=["onClick"],hz={class:"node-body"};function pz(n,e,t,r,i,o){return G(),ae("div",{class:dn(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[S("div",{class:dn(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[S("div",oz,[S("div",az,[t.iconUrl||t.iconName?(G(),ae("span",sz,[S("img",{src:t.iconUrl||o.getImgUrl(t.iconName),alt:""},null,8,lz)])):qe("",!0),S("span",uz,Ae(t.title),1)]),S("div",null,[t.hideMenus?qe("",!0):(G(),ae("div",dz,[S("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=nn((...a)=>o.showMenu&&o.showMenu(...a),["stop"]))},e[2]||(e[2]=[S("img",{class:"btn-icon",src:rS,alt:""},null,-1)])),To(S("div",cz,[(G(!0),ae(rt,null,gt(o.allMenus,a=>(G(),ae("div",{class:"node-menu",key:a.key,onClick:nn(l=>o.handleMenu(a),["stop"])},Ae(a.name),9,fz))),128)),S("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=nn(a=>o.handleDelete(n.item),["stop"]))},"删除")],512),[[pa,i.isShowMenu]])]))])]),S("div",hz,[as(n.$slots,"default",{},void 0,!0)])],2)],10,iz)}const Ln=_t(rz,[["render",pz],["__scopeId","data-v-ba04310c"]]),vz={name:"StartNode",components:{NodeCommon:Ln},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(){this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.$nextTick(()=>{this.resetSize()})}}},gz={class:"start-node"},mz={class:"start-node-options"},yz={class:"options-list"},_z={class:"option-label"},bz={class:"option-type"};function xz(n,e,t,r,i,o){const a=Sn("node-common");return G(),Ve(a,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:U(()=>[S("div",gz,[S("div",mz,[e[0]||(e[0]=S("div",{class:"options-title"},"输入",-1)),S("div",yz,[(G(!0),ae(rt,null,gt(o.options,l=>(G(),ae("div",{class:dn(["options-item",{"is-required":l.required}]),key:l.key},[S("div",_z,Ae(l.key),1),S("div",bz,Ae(l.typ),1)],2))),128))])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const wz=_t(vz,[["render",xz],["__scopeId","data-v-2734ae49"]]);let Sz=class extends Tn{constructor(e){super(e),this.renderVue(wz,e)}},Ez=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",isHovered:a,isSelected:l,nodeId:e}]}};const Cz={type:"start-node",model:Ez,view:Sz},zc={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(n){const e=n,t=$r(),{modelList:r}=Kl(t),i=ke(""),o=()=>{if(!e.useModel){i.value="";return}for(const a of r.value)if(a.children){for(const l of a.children)if(e.useModel==l.name&&e.modelConfigId==l.id){i.value=l.show_model_name||l.deployment_name||l.name;return}}};return Jt(()=>[e.useModel,e.modelConfigId],()=>{o()},{immediate:!0}),(a,l)=>(G(),ae("span",null,Ae(i.value),1))}},xa={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(n,{expose:e}){const t=n,r=Et("getNode"),i=ke([]),o=ke("");function a(){let h=r().getAllParentVariable();i.value=l(h)}function l(h){return h.forEach(v=>{v.typ=="node"?v.node_type==1?v.value="global":v.value=v.node_id:v.value=v.key,v.children&&v.children.length>0&&(v.children=l(v.children))}),h}const u=(h,v)=>{for(const y of h){if(y.value===v)return y.label;if(y.children&&y.children.length>0){const x=u(y.children,v);if(x)return x}}return null},d=()=>{if(!t.value||t.value.length===0)return"";a();let h=[];t.value.forEach(v=>{const y=u(i.value,v);y&&h.push(y)}),o.value=h.join("/")},f=()=>{d()};return Jt(()=>t.value,()=>{d()},{immediate:!0}),e({refresh:f}),(h,v)=>(G(),ae("span",null,Ae(o.value),1))}},kz={class:"ai-dialogue-node"},Oz={class:"field-list"},Mz={class:"field-item"},Nz={class:"field-item-content"},Az={class:"field-value"},Tz={class:"field-key"},Dz={class:"field-item"},Lz={class:"field-item-content"},Pz={class:"field-value"},Rz={class:"field-key"},Iz={class:"field-item"},Bz={class:"field-item-content"},jz={class:"category-list"},Hz={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("resetSize"),i=$r(),{modelList:o}=Kl(i),a=ke([]),l=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]});function u(h){if(h&&typeof h=="string"){let v=h.split("."),y=v[0],x=v.filter((w,_)=>_>0).join(".");return[y,x]}else if(h&&typeof h=="object"&&h.length===2)return h;return["global","question"]}const d=()=>{const h=e.properties.dataRaw||e.properties.node_params||"{}";let v={};try{v=JSON.parse(h).cate||{}}catch{v={}}v=JSON.parse(JSON.stringify(v));for(let y in v)if(y==="question_value")l.question_value=u(v.question_value);else if(y=="categorys")if(v.categorys&&v.categorys.length>0){let x=v.categorys.map(w=>({...w,key:Math.random()*1e4}));l[y]=x}else l[y]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else l[y]=v[y];!l.model_config_id&&o.value.length>0&&(l.model_config_id=o.value[0].id,l.use_model=o.value[0].children[0].name),vn(()=>{r()})},f=()=>{const h=JSON.stringify({cate:{...l,model_config_id:l.model_config_id?+l.model_config_id:l.model_config_id}});t({...e.node,...l,node_params:h})};return Jt(()=>e.properties,d,{deep:!0}),Yt(()=>{d(),r(),f()}),Pi(()=>{}),(h,v)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",kz,[S("div",Oz,[S("div",Mz,[v[0]||(v[0]=S("div",{class:"field-item-label"},"用户问题",-1)),S("div",Nz,[S("div",Az,[S("span",Tz,[B(xa,{ref:"questionTextRef",value:l.question_value},null,8,["value"])])])])]),S("div",Dz,[v[1]||(v[1]=S("div",{class:"field-item-label"},"LLM模型",-1)),S("div",Lz,[S("div",Pz,[S("span",Rz,[B(zc,{useModel:l.use_model,modelConfigId:l.model_config_id},null,8,["useModel","modelConfigId"])])])])]),S("div",Iz,[v[3]||(v[3]=S("div",{class:"field-item-label"},"问题分类",-1)),S("div",Bz,[S("div",jz,[(G(!0),ae(rt,null,gt(l.categorys,y=>(G(),ae("div",{class:"field-value category-value",key:y.key},[S("span",null,Ae(y.category),1)]))),128)),v[2]||(v[2]=S("div",{class:"field-value category-value"},[S("span",null,"默认分类")],-1))])])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},$z=_t(Hz,[["__scopeId","data-v-b64488fe"]]);let Fz=class extends Tn{constructor(e){super(e),this.renderVue($z,e)}},zz=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getAnchorPos(){return dN(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;let d=[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}],f=this.getAnchorPos(),h=r-o/2;for(let v=0;v<f.length;v++)d.push({id:f[v].id,x:t+i/2,y:h+132+v*32,type:"right",nodeId:e});return d.push({id:u+"-anchor_right",x:t+i/2,y:o/2+r-28,type:"right",nodeId:e}),d}};const Uz={type:"question-node",model:zz,view:Fz},Vz={name:"QuestionNode",components:{NodeCommon:Ln},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},Wz={class:"question-node"},Gz={class:"node-desc"};function qz(n,e,t,r,i,o){const a=Sn("node-common");return G(),Ve(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:U(()=>[S("div",Wz,[S("div",Gz,Ae(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const Xz=_t(Vz,[["render",qz],["__scopeId","data-v-8633f28f"]]);let Yz=class extends Tn{constructor(e){super(e),this.renderVue(Xz,e)}},Kz=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;let d=[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&d.push({x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}),d}};const Jz={type:"action-node",model:Kz,view:Yz},Zz={name:"QuestionNode",components:{NodeCommon:Ln},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},secondsToMinutes(n){return m2(n)}}},Qz={class:"qa-node"},eU={key:0,class:"no-data"};function tU(n,e,t,r,i,o){const a=Sn("node-common");return G(),Ve(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:U(()=>[S("div",Qz,[t.properties.no_resp_jump_time?qe("",!0):(G(),ae("div",eU,"点击设置消息内容"))])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const nU=_t(Zz,[["render",tU],["__scopeId","data-v-a598f971"]]);let rU=class extends Tn{constructor(e){super(e),this.renderVue(nU,e)}},iU=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const oU={type:"qa-node",model:iU,view:rU},aU={class:"ai-dialogue-node"},sU={class:"field-list"},lU={class:"field-item"},uU={class:"field-item-content"},dU={class:"field-value"},cU={class:"field-item"},fU={class:"field-item-content"},hU={class:"field-value"},pU={class:"field-key"},vU={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("getGraph"),i=Et("getNode"),o=Et("resetSize"),a=$r(),{modelList:l}=Kl(a),u=ke(null),d=ke([]),f=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),h=ke([]);function v(b){if(b){let E=b.split("."),k=E[0],O=E.filter((N,I)=>I>0).join(".");return[k,O]}return["global","question"]}const y=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let E={};try{E=JSON.parse(b).llm||{}}catch{E={}}w();const{model_config_id:k,use_model:O,context_pair:N,temperature:I,max_token:T,prompt:L,prompt_tags:H,question_value:X,enable_thinking:V,libs_node_key:q}=JSON.parse(JSON.stringify(E));f.model_config_id=k,f.use_model=O,f.context_pair=N||0,f.temperature=I,f.max_token=T,f.prompt=L,f.enable_thinking=V,f.prompt_tags=H||[],f.libs_node_key=q,f.question_value=v(X),!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),vn(()=>{o()})},x=()=>{const b=JSON.stringify({llm:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:b})},w=()=>{let b=i().getAllParentVariable();h.value=b},_=b=>{w(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(E=>{if(E.node_id==b.node_id){let k=E.label.split("/");k[0]=b.node_name,E.label=k.join("/"),E.node_name=b.node_name}}),x(),u.value.refresh()};return Jt(()=>e.properties,y,{deep:!0}),Yt(()=>{y(),o(),r().eventCenter.on("custom:setNodeName",_)}),Pi(()=>{r().eventCenter.off("custom:setNodeName",_)}),(b,E)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",aU,[S("div",sU,[S("div",lU,[E[0]||(E[0]=S("div",{class:"field-item-label"},"用户问题",-1)),S("div",uU,[S("div",dU,[B(xa,{ref_key:"questionTextRef",ref:u,value:f.question_value},null,8,["value"])])])]),S("div",cU,[E[1]||(E[1]=S("div",{class:"field-item-label"},"LLM模型",-1)),S("div",fU,[S("div",hU,[S("span",pU,[B(zc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E[2]||(E[2]=S("div",{class:"field-item"},[S("div",{class:"field-item-label"},"输出"),S("div",{class:"field-item-content"},[S("div",{class:"field-value is-required"},[S("span",{class:"field-key"},"AI回复内容"),S("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},gU=_t(vU,[["__scopeId","data-v-0e7130b7"]]);let mU=class extends Tn{constructor(e){super(e),this.renderVue(gU,e)}},yU=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const _U={type:"ai-dialogue-node",model:yU,view:mU},iS=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...iS(t.children)):e.push(t)}),e},bU={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(r=>{let i="";this.type==="textarea"?r.nodeName==="BR"?i=`
`:r.classList&&r.classList.contains("j-mention-at")?i=r.dataset.value:i=r.textContent:r.classList&&r.classList.contains("j-mention-at")?i=r.dataset.value:r.nodeName==="BR"?i="":i=r.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let r={};this.selectedList.forEach(o=>{!r[o.value]&&t.indexOf(o.value)!==-1&&(r[o.value]=o)});let i=Object.values(r);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],r=iS(this.options),i=[...t,...r].filter(a=>a&&a.value&&a.value!=""&&a.typ!=="node");const o=new Set;i.forEach(a=>{const l=new RegExp(`(${a.value})`,"g");if(l.test(this.defaultValue)&&!o.has(a.value)){let u=a.node_name+"."+a.text;u=u.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${a.node_id}" contentEditable="false" data-value="${a.value}">${u}</span> `),o.add(a.value),this.selectOption(a,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},dropDownKeydown(n){const{keyCode:e}=n;if(!this.showDropdown){if(e===13&&this.type==="input"){n.preventDefault(),n.stopPropagation();return}return}if(![13,38,40].includes(e)||(n.preventDefault(),n.stopPropagation(),e===13))return;const r={38:-1,40:1};this.chooseIndex+=r[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),r=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,r);else if(i.nodeType===Node.ELEMENT_NODE){const a=i.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?o+=u.textContent.slice(0,r):o+=u.textContent)}}return o.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,r=e.startContainer;let i="";if(r.nodeType===Node.TEXT_NODE)i=r.textContent.slice(0,t);else if(r.nodeType===Node.ELEMENT_NODE){const a=r.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?i+=u.textContent.slice(0,t):i+=u.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),r=await this.getDropdownListSize();let i=t.bottom,o=t.left;const a=window.innerWidth,l=window.innerHeight;return o+r.width>a&&(o=a-r.width),i+r.height>l&&(i=t.top-r.height),{top:i,left:o,x:o,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let r=t.dataset.value;const i=this.options.find(o=>o.value==r);this.selectedList.push(i),this.selectedIdSet.add(r)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(n){this.updateValue();const e=this.getLastChar();if(n.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{x:t,y:r}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle="",this.positionStyle+=`left:${t}px;`,this.positionStyle+=`top:${r}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),a=o.startOffset,l=o.startContainer;let u=a-t,d=l;if(u<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){u=f.textContent.length-t,d=f;break}f=f.previousSibling}}if(d.nodeType===Node.TEXT_NODE){d.replaceData(u,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${n}`;const h=document.createElement("span");h.contentEditable=!0,h.innerHTML+="&nbsp;",h.classList.add("at-space");for(const x in e)f.dataset[x]=e[x];const v=document.createRange();v.setStart(d,u),v.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),h.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(n,e,t){let r=t[t.length-1];delete r.children,this.selectOption(r)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1,this.showAtList=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const r={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,r),this.initShowOptionList(),this.updateValue())}}};function xU(n,e,t,r,i,o){return G(),ae("span",{ref:"JMention",class:dn(["j-mention",["type-"+t.type]])},null,2)}const Yr=_t(bU,[["render",xU]]),wU={class:"ai-dialogue-node"},SU={class:"field-list"},EU={class:"field-item"},CU={class:"field-item-content"},kU={class:"field-value"},OU={class:"field-key"},MU={class:"field-type"},NU={class:"field-item"},AU={class:"field-item-content"},TU={class:"field-text"},DU={class:"right-arrow"},LU={class:"field-text2"},PU={class:"field-item"},RU={class:"field-item-content"},IU={class:"field-text"},BU={class:"right-arrow"},jU={class:"field-text2"},HU={key:0,class:"field-item"},$U={class:"field-item-content"},FU={class:"field-text"},zU={class:"right-arrow"},UU={class:"field-text2"},VU={key:1,class:"field-item"},WU={class:"field-item-content"},GU={class:"field-list-item"},qU={class:"field-item"},XU={class:"field-item-content"},YU={class:"field-key"},KU={class:"field-type"},JU={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("getGraph"),i=Et("getNode"),o=Et("resetSize"),a=ke([]),l=qt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function u(w){return w.forEach(_=>{_.cu_key=Math.random()*1e4,_.subs&&_.subs.length?u(_.subs):_.subs=[]}),w}const d=ke([]),f=()=>{const w=e.properties.dataRaw||e.properties.node_params||"{}";let _={};try{_=JSON.parse(w).curl||{}}catch{_={}}v(),_=JSON.parse(JSON.stringify(_));for(let b in _){if(b=="headers"||b=="params"||b=="body"){_[b]&&_[b].length>0?l[b]=_[b].map(E=>({...E,cu_key:Math.random()*1e4})):l[b]=[];continue}if(b=="output"){l.output=u(_[b]);continue}l[b]=_[b]}vn(()=>{o()})},h=()=>{const w=JSON.stringify({curl:{...l}});t({...e.node,...l,node_params:w})},v=()=>{let w=i().getAllParentVariable();w.forEach(_=>{_.tags=_.tags||[]}),d.value=w},y=w=>{ks.includes(w.node_type)&&(v(),vn(()=>{l.body_raw_tags&&l.body_raw_tags.length>0&&l.body_raw_tags.forEach(b=>{if(b.node_id==w.node_id){let E=b.label.split("/");E[0]=w.node_name,b.label=E.join("/"),b.node_name=w.node_name}}),["headers","params","body"].forEach(b=>{l[b].forEach(k=>{k.tags&&k.tags.length>0&&k.tags.forEach(O=>{if(O.node_id==w.node_id){let N=O.label.split("/");N[0]=w.node_name,O.label=N.join("/"),O.node_name=w.node_name}})})}),h()}))},x=()=>{};return Jt(()=>e.properties,f,{deep:!0}),Yt(()=>{f(),o(),r().eventCenter.on("custom:setNodeName",y)}),Pi(()=>{r().eventCenter.off("custom:setNodeName",y)}),(w,_)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:x},{default:U(()=>[S("div",wU,[S("div",SU,[S("div",EU,[_[0]||(_[0]=S("div",{class:"field-item-label"},"请求地址",-1)),S("div",CU,[S("div",kU,[S("span",OU,Ae(l.method),1),S("span",MU,Ae(l.rawurl),1)])])]),S("div",NU,[_[1]||(_[1]=S("div",{class:"field-item-label"},"HEADERS",-1)),S("div",AU,[(G(!0),ae(rt,null,gt(l.headers,b=>(G(),ae("div",{class:"field-list-item",key:b.cu_key},[S("div",TU,Ae(b.key),1),S("div",DU,[B(ze(gl))]),S("div",LU,[B(Yr,{options:d.value,"default-value":b.value,defaultSelectedList:b.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),S("div",PU,[_[2]||(_[2]=S("div",{class:"field-item-label"},"PARAMS",-1)),S("div",RU,[(G(!0),ae(rt,null,gt(l.params,b=>(G(),ae("div",{class:"field-list-item",key:b.cu_key},[S("div",IU,Ae(b.key),1),S("div",BU,[B(ze(gl))]),S("div",jU,[B(Yr,{options:d.value,"default-value":b.value,defaultSelectedList:b.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),l.type==1?(G(),ae("div",HU,[_[3]||(_[3]=S("div",{class:"field-item-label"},"BODY",-1)),S("div",$U,[(G(!0),ae(rt,null,gt(l.body,b=>(G(),ae("div",{class:"field-list-item",key:b.cu_key},[S("div",FU,Ae(b.key),1),S("div",zU,[B(ze(gl))]),S("div",UU,[B(Yr,{options:d.value,"default-value":b.value,defaultSelectedList:b.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):qe("",!0),l.type==2?(G(),ae("div",VU,[_[4]||(_[4]=S("div",{class:"field-item-label"},"BODY",-1)),S("div",WU,[S("div",GU,Ae(l.body_raw),1)])])):qe("",!0),S("div",qU,[_[5]||(_[5]=S("div",{class:"field-item-label"},"输出字段",-1)),S("div",XU,[(G(!0),ae(rt,null,gt(l.output,b=>(G(),ae("div",{class:"field-value",key:b.cu_key},[S("span",YU,Ae(b.key),1),S("span",KU,Ae(b.typ),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},ZU=_t(JU,[["__scopeId","data-v-336690e1"]]);let QU=class extends Tn{constructor(e){super(e),this.renderVue(ZU,e)}},eV=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+26,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+26,id:u+"-anchor_right",type:"right",nodeId:e}]}};const tV={type:"http-node",model:eV,view:QU},nV={class:"ai-dialogue-node"},rV={class:"field-list"},iV={class:"field-item"},oV={class:"field-item-content"},aV={class:"field-value"},sV={class:"field-item"},lV={class:"field-item-content"},uV={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("getGraph"),i=Et("getNode"),o=Et("resetSize"),a=ke(null),l=ke([]),u=qt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[]}),d=ke([]);function f(E){if(E){let k=E.split("."),O=k[0],N=k.filter((I,T)=>T>0).join(".");return[O,N]}return["global","question"]}const h=()=>{const E=e.properties.dataRaw||e.properties.node_params||"{}";let k={};try{k=JSON.parse(E).libs||{}}catch{k={}}_(),k=JSON.parse(JSON.stringify(k));for(let O in k)O=="library_ids"?u[O]=k[O]?k[O].split(","):[]:O=="question_value"?u.question_value=f(k.question_value):u[O]=k[O];vn(()=>{o()})},v=()=>{const E=JSON.stringify({libs:{...u,rerank_model_config_id:u.rerank_model_config_id?+u.rerank_model_config_id:void 0,question_value:u.question_value.join("."),library_ids:u.library_ids.join(",")}});t({...e.node,...u,node_params:E})},y=ke([]),x=Gt(()=>y.value.filter(E=>u.library_ids.includes(E.id))),w=async()=>{const E=await Pv({type:""});E&&(y.value=E.data||[],vn(()=>{o()}))},_=()=>{let E=i().getAllParentVariable();d.value=E},b=()=>{_(),v(),a.value.refresh()};return Jt(()=>e.properties,h,{deep:!0}),Yt(()=>{w(),h(),r().eventCenter.on("custom:setNodeName",b)}),Pi(()=>{r().eventCenter.off("custom:setNodeName",b)}),(E,k)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:l.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",nV,[S("div",rV,[S("div",iV,[k[0]||(k[0]=S("div",{class:"field-item-label"},"用户问题",-1)),S("div",oV,[S("div",aV,[B(xa,{ref_key:"questionTextRef",ref:a,value:u.question_value},null,8,["value"])])])]),k[2]||(k[2]=S("div",{class:"field-item"},[S("div",{class:"field-item-label"},"输出字段"),S("div",{class:"field-item-content"},[S("div",{class:"field-value is-required"},[S("span",{class:"field-key"},"知识库引用"),S("span",{class:"field-type"},"string")])])],-1)),S("div",sV,[k[1]||(k[1]=S("div",{class:"field-item-label"},"知识库",-1)),S("div",lV,[(G(!0),ae(rt,null,gt(x.value,O=>(G(),ae("div",{class:"library-item",key:O.id},Ae(O.library_name),1))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},dV=_t(uV,[["__scopeId","data-v-95c1e3dd"]]);let cV=class extends Tn{constructor(e){super(e),this.renderVue(dV,e)}},fV=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const hV={type:"knowledge-base-node",model:fV,view:cV},pV={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:Ln},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function vV(n,e,t,r,i,o){const a=Sn("node-common");return G(),Ve(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu,style:{width:"420px",height:"94px"}},{default:U(()=>e[0]||(e[0]=[S("div",{class:"end-node"},[S("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])),_:1,__:[0]},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const gV=_t(pV,[["render",vV],["__scopeId","data-v-81c60081"]]);let mV=class extends Tn{constructor(e){super(e),this.renderVue(gV,e)}},yV=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}]}};const _V={type:"end-node",model:yV,view:mV},bV={name:"EndNode",inject:["getNode","getGraph","setData"],components:{NodeCommon:Ln},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{observer:null,menus:[],formState:{content:"",height:88}}},computed:{},mounted(){var t;let n=JSON.parse(this.properties.node_params);this.formState={...this.formState,...n};const e=(t=this.$refs.textareaRef)==null?void 0:t.querySelector("textarea");e&&(this.observer=new ResizeObserver(r=>{for(const i of r){const{height:o}=i.contentRect;this.formState.height=o+8,this.updateContent()}}),this.observer.observe(e))},beforeUnmount(){this.observer&&this.observer.disconnect()},methods:{getHeight(){return 68+this.formState.height},updateContent(){this.setData({node_params:JSON.stringify(this.formState),height:this.getHeight()})},handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}};function xV(n,e,t,r,i,o){const a=wc,l=Sn("node-common");return G(),Ve(l,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu},{default:U(()=>[S("div",{class:"explain-node",onMousedown:e[3]||(e[3]=nn(()=>{},["stop"])),ref:"textareaRef"},[B(a,{style:Ti({height:`${i.formState.height}px`}),onWheel:e[0]||(e[0]=nn(()=>{},["stop"])),bordered:!1,class:"explain-textarea",value:i.formState.content,"onUpdate:value":e[1]||(e[1]=u=>i.formState.content=u),placeholder:"请输入注释",onInput:e[2]||(e[2]=u=>o.updateContent(u.target.value))},null,8,["style","value"])],544)]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const wV=_t(bV,[["render",xV],["__scopeId","data-v-b1301a55"]]);let SV=class extends Tn{constructor(e){super(e),this.renderVue(wV,e)}},EV=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[]}};const CV={type:"explain-node",model:EV,view:SV},kV={class:"ai-dialogue-node"},OV={class:"field-list"},MV={class:"field-item"},NV={class:"field-item-content"},AV={class:"field-text"},TV={class:"right-arrow"},DV={class:"field-text"},LV={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("getGraph"),i=Et("getNode"),o=Et("resetSize"),a=ke([]),l=qt({list:[]}),u=ke([]),d=()=>{const x=e.properties.dataRaw||e.properties.node_params||"{}";let w=[];try{w=JSON.parse(x).assign||[]}catch(_){}v(),w.forEach(_=>{_.tags=_.tags||[]}),l.list=w,vn(()=>{f()})},f=()=>{let x=JSON.parse(e.properties.node_params);x.assign=[...l.list],t({...e.node,node_params:JSON.stringify(x)})};function h(x){return x?x.split(".")[1]:""}const v=()=>{let x=i().getAllParentVariable();x.forEach(w=>{w.tags=w.tags||[]}),u.value=x},y=x=>{ks.includes(x.node_type)&&(v(),vn(()=>{l.list.forEach(w=>{w.tags&&w.tags.length>0&&w.tags.forEach(_=>{if(_.node_id==x.node_id){let b=_.label.split("/");b[0]=x.node_name,_.label=b.join("/"),_.node_name=x.node_name}})}),f()}))};return Jt(()=>e.properties,d,{deep:!0}),Yt(()=>{d(),o(),r().eventCenter.on("custom:setNodeName",y)}),Pi(()=>{r().eventCenter.off("custom:setNodeName",y)}),(x,w)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",kV,[S("div",OV,[S("div",MV,[w[0]||(w[0]=S("div",{class:"field-item-label"},"变量",-1)),S("div",NV,[(G(!0),ae(rt,null,gt(l.list,(_,b)=>(G(),ae("div",{class:"field-list-item",key:b},[S("div",AV,[B(Yr,{options:u.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])]),S("div",TV,[B(ze(gl))]),S("div",DV,Ae(h(_.variable)),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},PV=_t(LV,[["__scopeId","data-v-1fd4a385"]]);let RV=class extends Tn{constructor(e){super(e),this.renderVue(PV,e)}},IV=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const BV={type:"variable-assignment-node",model:IV,view:RV},jV={class:"judge-node"},HV={class:"if-box-label"},$V={class:"if-box-content"},FV={class:"condition-box"},zV={key:0,class:"condition-left-box"},UV={class:"connection-text"},VV={key:1,class:"condition-line"},WV={class:"condition-body"},GV={class:"field-items"},qV={class:"field-name"},XV={class:"field-rule"},YV={class:"field-value"},KV={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("resetSize"),r=Et("getNode"),i=Et("updateAnchorList");let o=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const a=qt({term:[]}),l=ke([]),u=ke([]);function d(){let E=r().getAllParentVariable();l.value=f(E)}function f(E){return E.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=f(k.children))}),E}let h=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],v=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function y(E){let k="";if(E.variable&&E.variable.length>0){let O=l.value.filter(N=>N.key==E.variable[0]);O&&O.length&&(k=O[0].typ),k=="object"&&(O[0]&&O[0].children&&(O=O[0].subs.filter(N=>N.key==E.variable[1])),O&&O.length&&(k=O[0].typ),k=="object"&&(O[0]&&O[0].children&&(O=O[0].subs.filter(N=>N.key==E.variable[2])),O&&O.length&&(k=O[0].typ)))}return k}function x(E){if(!E.variable)return[];let k=y(E);return k==""?E.is_mult?v:h:k=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:k.includes("array")?v:h}const w=E=>{let k=x(E),O=k.findIndex(N=>N.value==E.type);return k[O].label},_=()=>{try{let E=JSON.parse(e.properties.node_params).term||[];E=E.map(k=>{let O=k.terms.map(N=>{let I="";for(let T=0;T<o.length;T++)if(N.variable.indexOf(o[T])>-1){I=o[T];break}if(I!=""){let T=N.variable.split(".");N.variable=[T[0],I]}else N.variable=N.variable.split(".");return{...N,type:N.type>0?N.type:1,key:Math.random()*1e4}});return{...k,is_or:k.is_or?1:0,terms:O,key:Math.random()*1e4}}),a.term=E,vn(()=>{t(),b()})}catch(E){}},b=()=>{const E=e.properties.nodeSortKey;let k=[],O=56;for(let N=0;N<a.term.length;N++){let I=a.term[N];if(I){let T=0,L=O,H=8,X=2,V=24,q=I.terms.length;T=q*V+H*2+X*(q-1),N>0&&N<a.term.length&&(L+=8),O=L+T,k.push({id:E+"-anchor_"+N,offsetHeight:T,offsetTop:L})}}k.length>0&&k.push({id:E+"-anchor_right",offsetHeight:24,offsetTop:O+8}),i(k)};return Jt(()=>e.properties.node_params,(E,k)=>{E!=k&&_()},{deep:!0}),Yt(()=>{d(),_()}),(E,k)=>(G(),Ve(Ln,{title:n.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",jV,[(G(!0),ae(rt,null,gt(a.term,(O,N)=>(G(),ae("div",{class:"if-box",ref_for:!0,ref:I=>u.value[N]=I,key:N},[S("div",HV,Ae(N==0?"if":"else if"),1),S("div",$V,[S("div",FV,[O.terms.length>1?(G(),ae("div",zV,[S("span",UV,Ae(O.is_or==1?"or":"and"),1)])):qe("",!0),O.terms.length>1?(G(),ae("div",VV)):qe("",!0),S("div",WV,[S("div",GV,[(G(!0),ae(rt,null,gt(O.terms,(I,T)=>(G(),ae("div",{class:"field-item",key:T},[S("span",qV,[B(xa,{value:I.variable},null,8,["value"])]),S("span",XV,Ae(w(I)),1),S("span",YV,Ae(I.value),1)]))),128))])])])])]))),128)),k[0]||(k[0]=S("div",{class:"else-box"},[S("div",{class:"else-box-label"},"else"),S("div",{class:"else-box-content"},[S("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},JV=_t(KV,[["__scopeId","data-v-2ebf8ae4"]]);let ZV=class extends Tn{constructor(e){super(e),this.renderVue(JV,e)}},QV=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a)=>{if(i.id==o.id)return!1;const l=i.graphModel.edges.map(d=>d.sourceAnchorId),u=a.id;return a.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o}=this,{nodeSortKey:a,anchorList:l}=this.properties;let u=[{x:t-i/2,y:r-o/2+24,id:a+"-anchor_left",type:"left",nodeId:e}];if(l)for(let d=0;d<l.length;d++){let{offsetTop:f,offsetHeight:h}=l[d],v=r-o/2;u.push({id:l[d].id,nodeId:e,x:t+i/2,y:v+f+h/2,type:"right"})}return u}};const eW={type:"judge-node",model:QV,view:ZV},tW={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:Ln,AtText:Yr},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){ks.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh(),this.update()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.reply={...this.formState},this.setData({node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()}}},nW={class:"specify-reply-node"},rW={class:"static-field-list"},iW={class:"static-field-item"},oW={class:"static-field-item-content"},aW={class:"static-field-value"},sW={key:1};function lW(n,e,t,r,i,o){const a=Sn("at-text"),l=Sn("node-common");return G(),Ve(l,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:U(()=>[S("div",nW,[S("div",rW,[S("div",iW,[e[0]||(e[0]=S("div",{class:"static-field-item-label"},"消息内容",-1)),S("div",oW,[S("div",aW,[i.formState.content.length>0?(G(),Ve(a,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(G(),ae("span",sW,"--"))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const uW=_t(tW,[["render",lW],["__scopeId","data-v-d8d9a604"]]);let dW=class extends Tn{constructor(e){super(e),this.renderVue(uW,e)}},cW=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a)=>{if(i.id==o.id)return!1;const l=i.graphModel.edges.map(d=>d.sourceAnchorId),u=a.id;return a.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o}=this,{nodeSortKey:a}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:a+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+25,id:a+"-anchor_right",type:"right",nodeId:e}]}};const fW={type:"specify-reply-node",model:cW,view:dW},hW={class:"ai-dialogue-node"},pW={class:"field-list"},vW={class:"field-item"},gW={class:"field-item-content"},mW={class:"field-value"},yW={class:"field-item"},_W={class:"field-item-content"},bW={class:"field-value"},xW={class:"field-key"},wW={class:"field-item"},SW={class:"field-item-content"},EW={class:"field-key"},CW={class:"field-type"},kW={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("getGraph"),i=Et("getNode"),o=Et("resetSize"),a=$r(),{modelList:l}=Kl(a),u=ke(null),d=ke([]),f=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),h=ke([]),v=ke([]);function y(N){if(N){let I=N.split("."),T=I[0],L=I.filter((H,X)=>X>0).join(".");return[T,L]}return["global","question"]}function x(N){return N.forEach(I=>{I.cu_key=Math.random()*1e4,I.subs&&I.subs.length?x(I.subs):I.subs=[]}),N}const w=()=>{const N=e.properties.dataRaw||e.properties.node_params||"{}";let I={};try{I=JSON.parse(N).params_extractor||{}}catch{I={}}I=JSON.parse(JSON.stringify(I)),b(),E();for(let T in I){if(T=="output"){f.output=x(I[T]);continue}if(T=="question_value"){f.question_value=y(I[T]);continue}f[T]=I[T]}!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),vn(()=>{o()})},_=()=>{const N=JSON.stringify({params_extractor:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:N})},b=()=>{let N=i().getAllParentVariable();N.forEach(I=>{I.tags=I.tags||[]}),h.value=N};function E(){let N=i().getAllParentVariable();v.value=k(N)}function k(N){return N.forEach(I=>{I.typ=="node"?I.node_type==1?I.value="global":I.value=I.node_id:I.value=I.key,I.children&&I.children.length>0&&(I.children=k(I.children))}),N}const O=N=>{ks.includes(N.node_type)&&(b(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(I=>{if(I.node_id==N.node_id){let T=I.label.split("/");T[0]=N.node_name,I.label=T.join("/"),I.node_name=N.node_name}}),_(),u.value.refresh())};return Jt(()=>e.properties.dataRaw,(N,I)=>{N!=I&&w()},{deep:!0}),Yt(()=>{w(),o(),r().eventCenter.on("custom:setNodeName",O)}),Pi(()=>{r().eventCenter.off("custom:setNodeName",O)}),(N,I)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",hW,[S("div",pW,[S("div",vW,[I[0]||(I[0]=S("div",{class:"field-item-label"},"用户问题",-1)),S("div",gW,[S("div",mW,[B(xa,{ref_key:"questionTextRef",ref:u,value:f.question_value},null,8,["value"])])])]),S("div",yW,[I[1]||(I[1]=S("div",{class:"field-item-label"},"LLM模型",-1)),S("div",_W,[S("div",bW,[S("span",xW,[B(zc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),S("div",wW,[I[2]||(I[2]=S("div",{class:"field-item-label"},"输出字段",-1)),S("div",SW,[(G(!0),ae(rt,null,gt(f.output,T=>(G(),ae("div",{class:dn(["field-value",{"is-required":T.required}]),key:T.cu_key},[S("span",EW,Ae(T.key),1),S("span",CW,Ae(T.typ),1)],2))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},OW=_t(kW,[["__scopeId","data-v-8e3eba93"]]);let MW=class extends Tn{constructor(e){super(e),this.renderVue(OW,e)}},NW=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const AW={type:"parameter-extraction-node",model:NW,view:MW},TW={class:"ai-dialogue-node"},DW={class:"static-field-list"},LW={class:"static-field-item"},PW={class:"static-field-item-content"},RW={class:"static-field-value"},IW={class:"static-field-item"},BW={class:"static-field-item-content"},jW={class:"static-field-value"},HW={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=ke(null),r=Et("setData"),i=Et("getGraph"),o=Et("getNode"),a=Et("resetSize"),l=$r(),{modelList:u}=Kl(l),d=ke([]),f=qt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),h=ke([]);function v(b){if(b){let E=b.split("."),k=E[0],O=E.filter((N,I)=>I>0).join(".");return[k,O]}return["global","question"]}const y=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let E={};try{E=JSON.parse(b).question_optimize||{}}catch{E={}}w();const{model_config_id:k,use_model:O,context_pair:N,temperature:I,max_token:T,prompt:L,prompt_tags:H,question_value:X,enable_thinking:V}=JSON.parse(JSON.stringify(E));f.model_config_id=k,f.use_model=O,f.context_pair=N||0,f.temperature=I,f.max_token=T,f.prompt=L,f.enable_thinking=V,f.prompt_tags=H||[],f.question_value=v(X),!f.model_config_id&&u.value.length>0&&(f.model_config_id=u.value[0].id,f.use_model=u.value[0].children[0].name),vn(()=>{a()})},x=()=>{const b={...f,node_params:JSON.stringify({question_optimize:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}})};r(b)},w=()=>{let b=o().getAllParentVariable();h.value=b},_=b=>{w(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(E=>{if(E.node_id==b.node_id){let k=E.label.split("/");k[0]=b.node_name,E.label=k.join("/"),E.node_name=b.node_name}}),x(),t.value.refresh()};return Jt(()=>e.properties,y,{deep:!0}),Yt(()=>{y(),vn(()=>{a()}),i().eventCenter.on("custom:setNodeName",_)}),Pi(()=>{i().eventCenter.off("custom:setNodeName",_)}),(b,E)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",TW,[S("div",DW,[S("div",LW,[E[0]||(E[0]=S("div",{class:"static-field-item-label"},"用户问题",-1)),S("div",PW,[S("div",RW,[B(xa,{ref_key:"questionTextRef",ref:t,value:f.question_value},null,8,["value"])])])]),S("div",IW,[E[1]||(E[1]=S("div",{class:"static-field-item-label"},"LLM模型",-1)),S("div",BW,[S("div",jW,[B(zc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])]),E[2]||(E[2]=S("div",{class:"static-field-item"},[S("div",{class:"static-field-item-label"},"输出"),S("div",{class:"static-field-item-content"},[S("div",{class:"static-field-value"},[S("span",{class:"static-field-key"},"问题优化结果"),S("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},$W=_t(HW,[["__scopeId","data-v-9d510192"]]);let FW=class extends Tn{constructor(e){super(e),this.renderVue($W,e)}},zW=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const UW={type:"problem-optimization-node",model:zW,view:FW},oS="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",VW={class:"add-data-node"},WW={class:"static-field-list"},GW={class:"static-field-item"},qW={class:"static-field-item-content"},XW={class:"static-field-value"},YW={class:"static-field-item"},KW={class:"static-field-item-content"},JW={key:0,class:"static-field-value"},ZW={class:"field-name"},QW={class:"field-name"},eG={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("resetSize"),i=Et("getNode");let o={};const a=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=ke([]),u=()=>{let h=i().getAllParentVariable();l.value=h||[]},d=()=>{let h=e.properties.dataRaw||e.properties.node_params||"{}";o=JSON.parse(h),u(),a.formData=o.form_insert,f(),vn(()=>{r()})},f=()=>{o.form_insert=Ki(a.formData),t({...e.node,node_params:JSON.stringify(o)})};return Jt(()=>e.properties.dataRaw,(h,v)=>{h!==v&&d()}),Yt(()=>{d()}),(h,v)=>(G(),Ve(Ln,{title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",VW,[S("div",WW,[S("div",GW,[v[0]||(v[0]=S("div",{class:"static-field-item-label"},"数据表",-1)),S("div",qW,[S("div",XW,Ae(a.formData.form_name||"--"),1)])]),S("div",YW,[v[2]||(v[2]=S("div",{class:"static-field-item-label"},"插入数据",-1)),S("div",KW,[a.formData.datas.length==0?(G(),ae("div",JW,"--")):qe("",!0),(G(!0),ae(rt,null,gt(a.formData.datas,y=>(G(),ae("div",{class:"static-field-value",key:y.id},[S("span",ZW,[B(Yr,{options:l.value,"default-value":y.value,defaultSelectedList:y.atTags},null,8,["options","default-value","defaultSelectedList"])]),v[1]||(v[1]=S("span",{class:"field-arrow"},[S("img",{src:oS,alt:""})],-1)),S("span",QW,Ae(y.name),1)]))),128))])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},tG=_t(eG,[["__scopeId","data-v-c21dd32b"]]);let nG=class extends Tn{constructor(e){super(e),this.renderVue(tG,e)}},rG=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const iG={type:"add-data-node",model:rG,view:nG},oG={class:"node-box"},aG={class:"static-field-list"},sG={class:"static-field-item"},lG={class:"static-field-item-content"},uG={class:"static-field-value"},dG={class:"static-field-item",style:{"align-items":"center"}},cG={class:"static-field-item-content"},fG={key:0,class:"static-field-value"},hG={class:"condition-box"},pG={key:0,class:"condition-left-box"},vG={class:"connection-text"},gG={key:1,class:"condition-line"},mG={class:"condition-body"},yG={class:"field-items"},_G={class:"field-name"},bG={class:"field-rule"},xG={class:"field-value"},wG={class:"static-field-item"},SG={class:"static-field-item-content"},EG={class:"options-list"},CG={class:"option-label"},kG={class:"option-label"},OG={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("resetSize"),i=Et("getNode"),o=Po();let a={};const l=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),u=ke([]),d=()=>{let _=i().getAllParentVariable();u.value=_||[]},f=()=>{let _=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(_),d();let b=v(a.form_update.where||[]);a.form_update.where=b,l.formData=a.form_update,l.formData.form_id&&x(l.formData.form_id),h(),vn(()=>{r()})},h=()=>{let _={...Ki(l.formData)};_.where=y(_.where),a.form_update=_,t({...e.node,node_params:JSON.stringify(a)})},v=_=>{let b=[];return _.forEach(E=>{let k=JSON.parse(JSON.stringify(E)),O=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=O[0],O.shift(),k.rule=O.join("_"),b.push(k)}),b},y=_=>{let b=[];return _.forEach(E=>{let k=JSON.parse(JSON.stringify(E));k.form_field_id=k.form_field_id*1,k.rule=E.field_type+"_"+E.rule,b.push(k)}),b},x=async _=>{o.getFormFieldList({form_id:_}).then(b=>{b.forEach(E=>{E.id=E.id*1}),l.fieldList=b}).catch(()=>{})},w=(_,b)=>Xv(b,_);return Jt(()=>e.properties.dataRaw,(_,b)=>{_!==b&&f()}),Yt(()=>{f()}),(_,b)=>(G(),Ve(Ln,{title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:U(()=>[S("div",oG,[S("div",aG,[S("div",sG,[b[0]||(b[0]=S("div",{class:"static-field-item-label"},"数据表",-1)),S("div",lG,[S("div",uG,Ae(l.formData.form_name||"--"),1)])]),S("div",dG,[b[2]||(b[2]=S("div",{class:"static-field-item-label"},"更新条件",-1)),S("div",cG,[l.formData.where.length==0?(G(),ae("span",fG,"--")):qe("",!0),S("div",hG,[l.formData.where.length>1?(G(),ae("div",pG,[S("span",vG,Ae(l.formData.typ==1?"且":"或"),1)])):qe("",!0),l.formData.where.length>1?(G(),ae("div",gG)):qe("",!0),S("div",mG,[S("div",yG,[(G(!0),ae(rt,null,gt(l.formData.where,E=>(G(),ae("div",{class:"field-item",key:E.id},[S("span",_G,Ae(E.field_name),1),S("span",bG,Ae(w(E.field_type,E.rule)),1),S("span",xG,[B(Yr,{options:u.value,"default-value":E.rule_value1,defaultSelectedList:E.atTags},null,8,["options","default-value","defaultSelectedList"]),E.rule_value2?(G(),ae(rt,{key:0},[b[1]||(b[1]=S("span",null,"-",-1)),B(Yr,{options:u.value,"default-value":E.rule_value2,defaultSelectedList:E.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):qe("",!0)])]))),128))])])])])]),S("div",wG,[b[4]||(b[4]=S("div",{class:"static-field-item-label"},"更新数据",-1)),S("div",SG,[S("div",EG,[(G(!0),ae(rt,null,gt(l.formData.datas,E=>(G(),ae("div",{class:"options-item",key:E.key},[S("div",CG,[B(Yr,{options:u.value,"default-value":E.value,defaultSelectedList:E.atTags},null,8,["options","default-value","defaultSelectedList"])]),b[3]||(b[3]=S("span",{class:"field-arrow"},[S("img",{src:oS,alt:""})],-1)),S("div",kG,Ae(E.name),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},MG=_t(OG,[["__scopeId","data-v-456935d2"]]);let NG=class extends Tn{constructor(e){super(e),this.renderVue(MG,e)}},AG=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const TG={type:"update-data-node",model:AG,view:NG},DG={class:"node-box"},LG={class:"static-field-list"},PG={class:"static-field-item"},RG={class:"static-field-item-content"},IG={class:"static-field-value"},BG={class:"static-field-item",style:{"align-items":"center"}},jG={class:"static-field-item-content"},HG={key:0,class:"static-field-value"},$G={class:"condition-box"},FG={key:0,class:"condition-left-box"},zG={class:"connection-text"},UG={key:1,class:"condition-line"},VG={class:"condition-body"},WG={class:"field-items"},GG={class:"field-name"},qG={class:"field-rule"},XG={class:"field-value"},YG={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("resetSize"),r=Et("setData"),i=Et("getNode"),o=Po();let a={};const l=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),u=ke([]),d=()=>{let _=i().getAllParentVariable();u.value=_||[]},f=()=>{let _=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(_),d();let b=y(a.form_delete.where||[]);a.form_delete.where=b,l.formData=a.form_delete,l.formData.form_id&&x(l.formData.form_id),h(),vn(()=>{t()})},h=()=>{let _={...Ki(l.formData)};_.where=v(_.where),a.form_delete=_,r({...e.node,node_params:JSON.stringify(a)})},v=_=>{let b=[];return _.forEach(E=>{let k=JSON.parse(JSON.stringify(E));k.form_field_id=k.form_field_id*1,k.rule=E.field_type+"_"+E.rule,b.push(k)}),b},y=_=>{let b=[];return _.forEach(E=>{let k=JSON.parse(JSON.stringify(E)),O=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=O[0],O.shift(),k.rule=O.join("_"),b.push(k)}),b},x=async _=>{o.getFormFieldList({form_id:_}).then(b=>{b.forEach(E=>{E.id=E.id*1}),l.fieldList=b,vn(()=>{t()})}).catch(()=>{})},w=(_,b)=>Xv(b,_);return Jt(()=>e.properties.dataRaw,(_,b)=>{_!==b&&f()}),Yt(()=>{f()}),(_,b)=>(G(),Ve(Ln,{title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:U(()=>[S("div",DG,[S("div",LG,[S("div",PG,[b[0]||(b[0]=S("div",{class:"static-field-item-label"},"数据表",-1)),S("div",RG,[S("div",IG,Ae(l.formData.form_name||"--"),1)])]),S("div",BG,[b[2]||(b[2]=S("div",{class:"static-field-item-label"},"删除条件",-1)),S("div",jG,[l.formData.where.length==0?(G(),ae("span",HG,"--")):qe("",!0),S("div",$G,[l.formData.where.length>1?(G(),ae("div",FG,[S("span",zG,Ae(l.formData.typ==1?"且":"或"),1)])):qe("",!0),l.formData.where.length>1?(G(),ae("div",UG)):qe("",!0),S("div",VG,[S("div",WG,[(G(!0),ae(rt,null,gt(l.formData.where,E=>(G(),ae("div",{class:"field-item",key:E.id},[S("span",GG,Ae(E.field_name),1),S("span",qG,Ae(w(E.field_type,E.rule)),1),S("span",XG,[B(Yr,{options:u.value,"default-value":E.rule_value1,defaultSelectedList:E.atTags},null,8,["options","default-value","defaultSelectedList"]),E.rule_value2?(G(),ae(rt,{key:0},[b[1]||(b[1]=S("span",null,"-",-1)),B(Yr,{options:u.value,"default-value":E.rule_value2,defaultSelectedList:E.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):qe("",!0)])]))),128))])])])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},KG=_t(YG,[["__scopeId","data-v-30f0bc82"]]);let JG=class extends Tn{constructor(e){super(e),this.renderVue(KG,e)}},ZG=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const QG={type:"delete-data-node",model:ZG,view:JG},eq={class:"node-box"},tq={class:"static-field-list"},nq={class:"static-field-item"},rq={class:"static-field-item-content"},iq={class:"static-field-value"},oq={class:"static-field-item",style:{"align-items":"center"}},aq={class:"static-field-item-content"},sq={key:0,class:"static-field-value"},lq={class:"condition-box"},uq={key:0,class:"condition-left-box"},dq={class:"connection-text"},cq={key:1,class:"condition-line"},fq={class:"condition-body"},hq={class:"field-items"},pq={class:"field-name"},vq={class:"field-rule"},gq={class:"field-value"},mq={class:"static-field-item"},yq={class:"static-field-item-content"},_q={class:"options-list"},bq={class:"option-label"},xq={class:"option-type"},wq={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("resetSize"),i=Et("getNode"),o=Et("getGraph"),a=Po();let l={};const u=qt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),d=ke([]),f=()=>{let k=i().getAllParentVariable();d.value=k||[]},h=()=>{let k=e.properties.dataRaw||e.properties.node_params||"{}";l=JSON.parse(k),f();let O=y(l.form_select.where||[]);l.form_select.where=O,u.formData=l.form_select,u.formData.form_id&&_(u.formData.form_id),v(),vn(()=>{r()})},v=()=>{let k={...Ki(u.formData)};k.where=x(k.where),l.form_select=k,t({...e.node,node_params:JSON.stringify(l)})},y=k=>{let O=[];return k.forEach(N=>{let I=JSON.parse(JSON.stringify(N)),T=I.rule.split("_");I.form_field_id=I.form_field_id*1,I.field_type=T[0],T.shift(),I.rule=T.join("_"),O.push(I)}),O},x=k=>{let O=[];return k.forEach(N=>{let I=JSON.parse(JSON.stringify(N));I.form_field_id=I.form_field_id*1,I.rule=N.field_type+"_"+N.rule,O.push(I)}),O},w=async()=>{const k=await a.getFormList();k&&(u.tableList=k)},_=async k=>{a.getFormFieldList({form_id:k}).then(O=>{O.forEach(N=>{N.id=N.id*1}),u.fieldList=O}).catch(()=>{})},b=(k,O)=>Xv(O,k),E=()=>{h()};return Jt(()=>e.properties.dataRaw,(k,O)=>{k!==O&&h()}),Yt(()=>{w(),h(),o().eventCenter.on("custom:setNodeName",E)}),Pi(()=>{o().eventCenter.off("custom:setNodeName",E)}),(k,O)=>(G(),Ve(Ln,{title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:U(()=>[S("div",eq,[S("div",tq,[S("div",nq,[O[0]||(O[0]=S("div",{class:"static-field-item-label"},"数据表",-1)),S("div",rq,[S("div",iq,Ae(u.formData.form_name||"--"),1)])]),S("div",oq,[O[2]||(O[2]=S("div",{class:"static-field-item-label"},"查询条件",-1)),S("div",aq,[u.formData.where.length==0?(G(),ae("span",sq,"--")):qe("",!0),S("div",lq,[u.formData.where.length>1?(G(),ae("div",uq,[S("span",dq,Ae(u.formData.typ==1?"且":"或"),1)])):qe("",!0),u.formData.where.length>1?(G(),ae("div",cq)):qe("",!0),S("div",fq,[S("div",hq,[(G(!0),ae(rt,null,gt(u.formData.where,N=>(G(),ae("div",{class:"field-item",key:N.id},[S("span",pq,Ae(N.field_name),1),S("span",vq,Ae(b(N.field_type,N.rule)),1),S("span",gq,[B(Yr,{options:d.value,"default-value":N.rule_value1,defaultSelectedList:N.atTags},null,8,["options","default-value","defaultSelectedList"]),N.rule_value2?(G(),ae(rt,{key:0},[O[1]||(O[1]=S("span",null,"-",-1)),B(Yr,{options:d.value,"default-value":N.rule_value2,defaultSelectedList:N.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):qe("",!0)])]))),128))])])])])]),S("div",mq,[O[3]||(O[3]=S("div",{class:"static-field-item-label"},"查询字段",-1)),S("div",yq,[S("div",_q,[(G(!0),ae(rt,null,gt(u.formData.fields,N=>(G(),ae("div",{class:"options-item",key:N.key},[S("div",bq,Ae(N.name),1),S("div",xq,Ae(N.type),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Sq=_t(wq,[["__scopeId","data-v-730526a7"]]);let Eq=class extends Tn{constructor(e){super(e),this.renderVue(Sq,e)}},Cq=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const kq={type:"select-data-node",model:Cq,view:Eq},Oq={class:"ai-dialogue-node"},Mq={class:"field-list"},Nq={class:"field-item"},Aq={class:"field-item-content"},Tq={class:"field-text"},Dq={class:"right-arrow"},Lq={class:"field-text"},Pq={class:"field-item"},Rq={class:"field-item-content"},Iq={class:"field-key"},Bq={class:"field-type"},jq=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,Hq={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("setData"),r=Et("getGraph"),i=Et("getNode"),o=Et("resetSize"),a=ke([]),l=qt({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),u=ke([]);let d=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function f(_){return _.forEach(b=>{b.cu_key=Math.random()*1e4,b.subs&&b.subs.length?f(b.subs):b.subs=[]}),_}const h=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(_).code_run||{}}catch{b={}}x(),b=JSON.parse(JSON.stringify(b));for(let E in b){if(E=="params"){b[E]&&b[E].length>0?l[E]=b[E].map(k=>({...k,cu_key:Math.random()*1e4})):l[E]=[];continue}if(E=="output"){l.output=f(b[E]);continue}l[E]=b[E]}l.main_func=l.main_func||jq,l.params=l.params.map(E=>{let k="";for(let O=0;O<d.length;O++)if(E.variable.indexOf(d[O])>-1){k=d[O];break}if(k!=""){let O=E.variable.split(".");E.variable=[O[0],k]}else E.variable=E.variable.split(".");return{...E,key:Math.random()*1e4}}),vn(()=>{o()})},v=()=>{const _=JSON.stringify({code_run:{...l,params:y()}});t({...e.node,...l,node_params:_})};function y(){let _=[];return l.params.forEach(b=>{_.push({field:b.field,variable:b.variable&&b.variable.length>0?b.variable.join("."):""})}),_}const x=()=>{let _=i().getAllParentVariable();u.value=_},w=_=>{ks.includes(_.node_type)&&(x(),vn(()=>{v()}))};return Jt(()=>e.properties,h,{deep:!0}),Yt(()=>{h(),o(),r().eventCenter.on("custom:setNodeName",w)}),Pi(()=>{r().eventCenter.off("custom:setNodeName",w)}),(_,b)=>(G(),Ve(Ln,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[S("div",Oq,[S("div",Mq,[S("div",Nq,[b[0]||(b[0]=S("div",{class:"field-item-label"},"输入参数",-1)),S("div",Aq,[(G(!0),ae(rt,null,gt(l.params,E=>(G(),ae("div",{class:"field-list-item",key:E.cu_key},[S("div",Tq,[B(xa,{value:E.variable},null,8,["value"])]),S("div",Dq,[B(ze(gl))]),S("div",Lq,Ae(E.field),1)]))),128))])]),S("div",Pq,[b[1]||(b[1]=S("div",{class:"field-item-label"},"输出字段",-1)),S("div",Rq,[(G(!0),ae(rt,null,gt(l.output,E=>(G(),ae("div",{class:"field-value",key:E.cu_key},[S("span",Iq,Ae(E.key),1),S("span",Bq,Ae(E.typ),1)]))),128))])]),b[2]||(b[2]=S("div",{class:"field-item"},[S("div",{class:"field-item-label"},"异常处理"),S("div",{class:"field-item-content"},[S("div",{class:"field-value"},[S("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},$q=_t(Hq,[["__scopeId","data-v-10b0e2d5"]]);let Fq=class extends Tn{constructor(e){super(e),this.renderVue($q,e)}},zq=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(r,i,o,a)=>{if(r.id==i.id)return!1;const l=r.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(r,i,o,a)=>r.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+28,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+28,id:u+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:r+o/2-28,id:u+"-anchor_right_exception",type:"right",nodeId:e}]}};const Uq={type:"code-run-node",model:zq,view:Fq},Vq={name:"QuestionNode",components:{NodeCommon:Ln},inject:["getNode","getGraph","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}}}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.loadProvider()},methods:{loadProvider(){var n;V1({provider_id:((n=this.nodeParams)==null?void 0:n.mcp.provider_id)||""}).then(e=>{var r;this.mcpInfo=(e==null?void 0:e.data)||{};let t=C1((r=this.mcpInfo)==null?void 0:r.tools,[]);this.toolInfo=t.find(i=>{var o;return i.name==((o=this.nodeParams)==null?void 0:o.mcp.tool_name)})})},update(n){let e=this.nodeParams;e.mcp.arguments=n.arguments,e.mcp.tag_map=n.tag_map,this.setData({node_params:JSON.stringify(e)})}}},Wq={class:"mcp-node"};function Gq(n,e,t,r,i,o){var u;const a=Cc,l=Sn("node-common");return G(),Ve(l,{title:(u=i.toolInfo)==null?void 0:u.name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key},{default:U(()=>[S("div",Wq,[e[1]||(e[1]=Be(" MCP插件： ")),i.toolInfo===null?(G(),Ve(a,{key:0,color:"red"},{default:U(()=>e[0]||(e[0]=[Be("工具不存在或工具异常")])),_:1,__:[0]})):(G(),Ve(a,{key:1},{default:U(()=>[Be(Ae(t.properties.node_name),1)]),_:1}))])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key"])}const qq=_t(Vq,[["render",Gq]]);let Xq=class extends Tn{constructor(e){super(e),this.renderVue(qq,e)}},Yq=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const Kq={type:"mcp-node",model:Yq,view:Xq},Jq={name:"QuestionNode",components:{NodeCommon:Ln},inject:["getNode","getGraph","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[{name:"删除",key:"delete",color:"#fb363f"}],formState:{},nodeParams:{},info:{}}},mounted(){this.init()},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParamsFormat(),this.formStateFormat())},deep:!0}},methods:{init(){this.nodeParamsFormat(),this.loadPluginParams(),this.loadPluginInfo()},loadPluginInfo(){var n,e;G1({name:(e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.name}).then(t=>{let r=(t==null?void 0:t.data)||{};this.info=r.remote})},loadPluginParams(){var n,e;W1({name:((e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.name)||"",action:"default/get-schema",params:{}}).then(t=>{this.formState=(t==null?void 0:t.data)||{},this.formStateFormat()})},nodeParamsFormat(){this.nodeParams=JSON.parse(this.properties.node_params)},formStateFormat(){var n,e,t,r;for(let i in this.formState)this.formState[i].value=String(((e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.params[i])||""),this.formState[i].tags=((r=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:r.tag_map)||[]}}},Zq={class:"ding-group-node"},Qq={class:"label"};function eX(n,e,t,r,i,o){const a=Cc,l=Sn("node-common");return G(),Ve(l,{title:t.properties.node_name,iconUrl:i.info.icon,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key},{default:U(()=>[S("div",Zq,[(G(!0),ae(rt,null,gt(i.formState,(u,d)=>(G(),ae("div",{key:d},[S("span",Qq,Ae(d)+"：",1),B(a,null,{default:U(()=>[Be(Ae(u.value||"--"),1)]),_:2},1024)]))),128))])]),_:1},8,["title","iconUrl","isSelected","isHovered","node-key"])}const tX=_t(Jq,[["render",eX],["__scopeId","data-v-1c95810c"]]);let nX=class extends Tn{constructor(e){super(e),this.renderVue(tX,e)}},rX=class extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const iX={type:"zm-plugins-node",model:rX,view:nX},oX={name:"QuestionNode",components:{PopupMenu:Vv},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{type:"node"}},mounted(){this.getGraph().eventCenter.on("custom:showPopupMenu",this.onShowPopupMenu)},methods:{onShowPopupMenu(n){n.model.properties.loop_parent_key?this.type="loop-node":this.type="node"},handleAddNode(n){this.$emit("click-item",n)}}};function aX(n,e,t,r,i,o){const a=Sn("PopupMenu");return G(),Ve(a,{onAddNode:o.handleAddNode,type:i.type},null,8,["onAddNode","type"])}const sX=_t(oX,[["render",aX]]),lX=130,uX=440;class dX{constructor({lf:e}){xo(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${lX}px`,this.__menuDOM.style.height=`${uX}px`,this.isMounted=!1,this.r=pn(sX,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:t,event:r})=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{node:t,event:r,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=ga({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:r,model:i})=>{this._activeData=i,this._activeAnchorData=r,this.createMenu()}),e.on("node:click",({data:r})=>{this.hideMenu()}),e.on("edge:click",({data:r})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,r=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,r])}showMenu(){const[e,t]=this.getContextMenuPosition();this.__menuDOM.style.display="flex",this.__menuDOM.style.top=`${t}px`,this.__menuDOM.style.left=`${e+10}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class aS{constructor({lf:e}){xo(this,"handleHistoryKeyDown",e=>{if(this.isInputElement(e.target))return;const{ctrlKey:t,key:r,metaKey:i}=e,o=t||i;if(o&&r.toLowerCase()==="z"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.undo();return}if(o&&(r.toLowerCase()==="y"||r.toLowerCase()==="z"&&e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.redo();return}});this.lf=e,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const e=this.lf.getGraphData(),t=this.lf.getSelectElements(!0);let r=[...t.nodes,...t.edges].map(i=>i.id);return{nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),selectedElementIds:r||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(e="change"){if(this.isProcessing)return;const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const e=this.historyStack.pop();this.redoStack.push(e);const t=this.historyStack[this.historyStack.length-1];this.restoreState(t),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const e=this.redoStack.pop();this.historyStack.push(e),this.restoreState(e),this.notifyHistoryChange()}restoreState(e){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),e.nodes.forEach(t=>{t.width=t.properties.width,t.height=t.properties.height}),this.lf.graphModel.graphDataToModel({nodes:e.nodes||[],edges:e.edges||[]}),e.selectedElementIds&&e.selectedElementIds.length>0&&e.selectedElementIds.forEach(t=>{this.lf.selectElementById(t,!0)})}finally{this.isProcessing=!1}}isInputElement(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return!0;let r=e;for(;r&&r!==document.body;){if(r.hasAttribute&&r.hasAttribute("contenteditable"))return!0;r=r.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(t=>{this.lf.on(t,()=>{this.saveCurrentState(t)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(e,t,r){this.maxHistorySize=r&&r.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(e){this.historyStack=[],this.redoStack=[];const t={nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(t),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(e){typeof e=="function"&&this.historyChangeCallbacks.push(e)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(e=>{try{const t=this.historyStack.map((o,a)=>({index:a,timestamp:o.timestamp,operation:o.operation,nodeCount:o.nodes?o.nodes.length:0,edgeCount:o.edges?o.edges.length:0,nodes:o.nodes||[],edges:o.edges||[],selectedElementIds:o.selectedElementIds||[]})),r=this.redoStack.map((o,a)=>({index:a,timestamp:o.timestamp,operation:o.operation,nodeCount:o.nodes?o.nodes.length:0,edgeCount:o.edges?o.edges.length:0,nodes:o.nodes||[],edges:o.edges||[],selectedElementIds:o.selectedElementIds||[]})),i=this.historyStack.length-1;e({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:t[i],historyDetails:t,redoDetails:r,currentHistoryIndex:i})}catch(t){console.error("History change callback error:",t)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(e="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(e="commit"){this.isProcessing=!1,this.saveCurrentState(e)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}xo(aS,"pluginName","canvasHistory");class sS{constructor({lf:e}){xo(this,"wheelEventListener",e=>{if(e.shiftKey){e.preventDefault();const t=this.lf.getTransform();let r=t.SCALE_X,i=t.SCALE_Y;e.deltaY>0?this.lf.translate(-100*r,100*i):this.lf.translate(100*r,-100*i)}else if(e.ctrlKey){e.preventDefault();const{transformModel:t}=this.lf.graphModel,[r,i]=t.HtmlPointToCanvasPoint([e.clientX,e.clientY]),o=this.lf.getTransform();this.zoom=o.SCALE_X,e.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[r,i])}});xo(this,"keydownListener",e=>{const t=e.key.toLowerCase(),{graphModel:{eventCenter:r}}=this.lf,i=e.target,o=i===document.body||this.lf.container.contains(i);if(e.ctrlKey){if(t==="c"){if(!o)return;e.preventDefault();let a=this.lf.getSelectElements(!0);a=JSON.parse(JSON.stringify(a)),a.edges=[];const l=a.nodes.filter(u=>u.type!=="start-node"&&u.type!=="custom-group");if(l.length>0){this.basePointX=20,this.basePointY=20;let u={x:1/0,y:1/0};l.forEach(d=>{d.id="",d.nodeSortKey="",d.properties.id="",d.properties.next_node_key="",d.properties.nodeSortKey="",d.properties.node_key="",!d.width&&d.properties.width&&(d.width=d.properties.width),!d.height&&d.properties.height&&(d.height=d.properties.height),d.x<u.x&&(u.x=d.x),d.y<u.y&&(u.y=d.y)}),this.clipboard={nodes:l,basePoint:u}}else this.clipboard=null;return}if(t==="v"){if(!o)return;if(e.preventDefault(),this.clipboard&&this.clipboard.nodes.length>0){const a={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};r.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:a}),this.basePointX+=20,this.basePointY+=20}return}}if(t==="delete"&&o){r.emit("custom:keyoard:delete");return}e.ctrlKey&&!this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});xo(this,"keyupListener",e=>{!e.ctrlKey&&this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=e,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}xo(sS,"pluginName","custom-keyboard");const cX="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cg%20clip-path='url(%23cmdkkm1o9__clip0_12048_97931)'%20stroke='%23fff'%20stroke-width='1.16667'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M6.79163%2013.2109H5.04163V14.9609'/%3e%3cpath%20d='M14.9584%2014.9609H13.2084V13.2109'/%3e%3cpath%20d='M13.2084%206.78906H14.9584V5.03906'/%3e%3cpath%20d='M5.04163%205.03906H6.79163V6.78906'/%3e%3cpath%20d='M6.79163%205.125C5.21015%206.16842%204.16663%207.96112%204.16663%209.99757C4.16663%2010.295%204.18888%2010.5871%204.23181%2010.8726'/%3e%3cpath%20d='M10.875%2015.7708C10.5896%2015.8137%2010.2974%2015.8359%2010%2015.8359C7.96357%2015.8359%206.17086%2014.7924%205.12744%2013.2109'/%3e%3cpath%20d='M15.7682%209.125C15.8111%209.41043%2015.8334%209.70262%2015.8334%2010C15.8334%2012.0364%2014.7898%2013.8291%2013.2084%2014.8726'/%3e%3cpath%20d='M9.125%204.22925C9.41043%204.18632%209.70262%204.16406%2010%204.16406C12.0364%204.16406%2013.8291%205.20758%2014.8726%206.78906'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='cmdkkm1o9__clip0_12048_97931'%3e%3cpath%20fill='%23fff'%20transform='translate(3%203)'%20d='M0%200H14V14H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",fX={class:"flex-content-box"},hX={class:"test-model-box"},pX={key:2,class:"input-list-box"},vX={class:"add-btn-box"},gX={key:0,class:"result-list-box loading-box"},mX={key:1,class:"result-list-box"},yX=["onClick"],_X={class:"status-block"},bX={class:"icon-name-box"},xX=["src"],wX={class:"node-name"},SX={key:0,class:"time-tag"},EX={class:"right-active-icon"},CX={class:"save-btn-box"},kX={class:"preview-box"},OX={class:"preview-title"},MX={class:"icon-name-box"},NX=["src"],AX={class:"node-name"},TX={key:0,class:"time-tag"},DX={class:"preview-content-block"},LX={class:"title-block"},PX={class:"preview-code-box"},RX={__name:"run-test",props:{loop_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const r=$r(),i=Gt(()=>r.robotInfo.isLockedByOther),o=n;Gt(()=>[]);const a=ke(!1),l=ke(""),u=ke([]),d=Gt(()=>l.value?u.value.filter(X=>X.node_key==l.value)[0]:null),f=ke(!1),h=qt({is_draft:!0,robot_key:r.robotInfo.robot_key,question:"",openid:""}),v=async()=>{if(i.value){Cn.warning("当前已有其他用户在编辑中，无法运行测试");return}r.robotInfo.loop_save_canvas_status++,await vn();let X=localStorage.getItem("workflow_loop_run_test_data")||"{}";X=JSON.parse(X),h.question=X.question||"",h.openid=X.openid||"",h.global=X.global||"",u.value=[],l.value="",setTimeout(()=>{w()},400),a.value=!0},y=ke([]),x=ke(!1),w=()=>{d2({robot_key:h.robot_key,loop_node_key:o.loop_node_key,openid:1}).then(X=>{x.value=X.data.is_need_question,x.value||(h.question=""),y.value=X.data.loop_test_params.map(V=>({...V,field:{...V.field,Vals:_(V.field)}}))})};function _(X){return X.typ=="string"||X.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const b=(X,V)=>{X.splice(V,1)},E=X=>{X.push({value:"",key:Math.random()*1e4})},k=ke(null),O=()=>{k.value.validate().then(()=>{let X={...h,loop_node_key:o.loop_node_key},V=JSON.parse(JSON.stringify(y.value));V.forEach(q=>{q.field.typ.includes("array")&&(q.field.Vals=q.field.Vals.map(D=>D.value))}),X.loop_test_params=JSON.stringify(V),f.value=!0,u.value=[],localStorage.setItem("workflow_loop_run_test_data",JSON.stringify({...X})),u2({...X}).then(q=>{Cn.success("测试结果生成完成"),N(q.data||[])}).catch(q=>{u.value=[],q.data&&q.data.length&&N(q.data)}).finally(()=>{f.value=!1})})},N=X=>{var V;u.value=X.map(q=>({...q,is_success:q.error_msg==="<nil>",node_icon:jv(q.node_type)})),l.value=(V=u.value[0])==null?void 0:V.node_key},I=X=>{l.value=X.node_key},T=()=>{k1(JSON.stringify(d.value.output)),Cn.success("复制成功")};function L(X){return X.field.key.replace(X.node_key+".","")}return e({open:()=>{v()}}),(X,V)=>{const q=Cc,D=_a,W=dr,$=ci,pe=Zr,De=lo,de=Bn,Se=Jr,me=Ec,ve=yr;return G(),ae("div",null,[B(ve,{open:a.value,"onUpdate:open":V[2]||(V[2]=Re=>a.value=Re),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:U(()=>[S("div",fX,[S("div",hX,[V[9]||(V[9]=S("div",{class:"top-title"},"开始节点参数",-1)),B(Se,{model:h,ref_key:"formRef",ref:k,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:U(()=>[x.value?(G(),Ve($,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:U(()=>[B(D,{gap:4},{default:U(()=>[V[4]||(V[4]=Be("question ")),B(q,{style:{margin:"0"}},{default:U(()=>V[3]||(V[3]=[Be("string")])),_:1,__:[3]})]),_:1,__:[4]})]),default:U(()=>[B(W,{placeholder:"请输入",value:h.question,"onUpdate:value":V[0]||(V[0]=Re=>h.question=Re)},null,8,["value"])]),_:1})):qe("",!0),B($,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:U(()=>[B(D,{gap:4},{default:U(()=>[V[6]||(V[6]=Be("openid ")),B(q,{style:{margin:"0"}},{default:U(()=>V[5]||(V[5]=[Be("string")])),_:1,__:[5]})]),_:1,__:[6]})]),default:U(()=>[B(W,{placeholder:"请输入",value:h.openid,"onUpdate:value":V[1]||(V[1]=Re=>h.openid=Re)},null,8,["value"])]),_:1}),(G(!0),ae(rt,null,gt(y.value,Re=>(G(),Ve($,{key:Re.node_key,rules:[{required:Re.field.required,message:`请输入${Re.node_name}`}]},{label:U(()=>[B(D,{gap:4},{default:U(()=>[Be(Ae(Re.node_name)+" "+Ae(L(Re)),1),B(q,{style:{margin:"0"}},{default:U(()=>[Be(Ae(Re.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:U(()=>[Re.field.typ=="string"?(G(),Ve(W,{key:0,placeholder:"请输入",value:Re.field.Vals,"onUpdate:value":Ie=>Re.field.Vals=Ie},null,8,["value","onUpdate:value"])):qe("",!0),Re.field.typ=="number"?(G(),Ve(pe,{key:1,style:{width:"100%"},placeholder:"请输入",value:Re.field.Vals,"onUpdate:value":Ie=>Re.field.Vals=Ie},null,8,["value","onUpdate:value"])):qe("",!0),Re.field.typ.includes("array")?(G(),ae("div",pX,[(G(!0),ae(rt,null,gt(Re.field.Vals,(Ie,ce)=>(G(),ae("div",{class:"input-list-item",key:ce},[B(De,null,{default:U(()=>[B(W,{placeholder:"请输入",value:Ie.value,"onUpdate:value":ue=>Ie.value=ue},null,8,["value","onUpdate:value"])]),_:2},1024),Re.field.Vals.length>1?(G(),Ve(ze(Jn),{key:0,onClick:ue=>b(Re.field.Vals,ce)},null,8,["onClick"])):qe("",!0)]))),128)),S("div",vX,[B(de,{onClick:Ie=>E(Re.field.Vals),block:"",type:"dashed"},{default:U(()=>V[7]||(V[7]=[Be("添加")])),_:2,__:[7]},1032,["onClick"])])])):qe("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),f.value?(G(),ae("div",gX,[f.value?(G(),Ve(me,{key:0,tip:"测试结果生成中..."})):qe("",!0)])):qe("",!0),u.value.length>0?(G(),ae("div",mX,[(G(!0),ae(rt,null,gt(u.value,(Re,Ie)=>(G(),ae("div",{class:dn(["list-item-block",{active:l.value==Re.node_key}]),onClick:ce=>I(Re),key:Ie},[S("div",_X,[Re.is_success?(G(),Ve(ze(Bv),{key:0,style:{color:"#138b1b"}})):(G(),Ve(ze(j1),{key:1,style:{color:"#d81e06"}}))]),S("div",bX,[S("img",{src:Re.node_icon,alt:""},null,8,xX),S("div",wX,Ae(Re.node_name),1)]),Re.is_success?(G(),ae("div",SX,Ae(Re.use_time)+"ms",1)):qe("",!0),S("div",EX,[B(ze(H1))])],10,yX))),128))])):qe("",!0),S("div",CX,[B(de,{loading:f.value,onClick:O,style:{"background-color":"#00ad3a"},type:"primary"},{default:U(()=>[B(ze(yc)),V[8]||(V[8]=Be("运行测试"))]),_:1,__:[8]},8,["loading"])])]),S("div",kX,[d.value?(G(),ae(rt,{key:0},[S("div",OX,[V[10]||(V[10]=S("div",{class:"title-text"},"日志详情",-1)),S("div",MX,[S("img",{src:d.value.node_icon,alt:""},null,8,NX),S("div",AX,Ae(d.value.node_name),1)]),d.value.is_success?(G(),ae("div",TX,Ae(d.value.use_time)+"ms",1)):qe("",!0)]),S("div",DX,[S("div",LX,[V[11]||(V[11]=Be("运行日志")),B(ze($1),{onClick:T})]),S("div",PX,[B(ze(F1),{data:d.value.output},null,8,["data"])])])],64)):qe("",!0)])])]),_:1},8,["open"])])}}},IX=_t(RX,[["__scopeId","data-v-5def1d00"]]),BX={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(G(),ae(rt,null,[S("div",{class:dn(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),S("div",{class:dn(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),S("div",{class:dn(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),S("div",{class:dn(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},jX=_t(BX,[["__scopeId","data-v-82fe400e"]]),HX={class:"custom-group-content"},$X={class:"header-box"},FX={class:"top-block"},zX={class:"title-block"},UX={class:"title-text"},VX={class:"btn-block"},WX={class:"info-block"},GX={class:"info-item"},qX={class:"info-content"},XX={key:0,class:"label-text"},YX={key:1,class:"label-text"},KX={key:2,class:"label-value"},JX={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Et("getGraph"),r=Et("getNode"),i=Et("addNode"),o=Et("setData"),a=Et("resetSize"),l=ke(!1),u=Gt(()=>r().id),d=b=>{i(b),l.value=!1},f=()=>{l.value=!0},h=ke(null),v=()=>{h.value.open()},y=qt({loop_type:"array",loop_number:"",loop_arrays:[{key:"",typ:"array",value:"",cu_key:Math.random()*1e4}],intermediate_params:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}],output:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}]}),x=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let E={};try{E=JSON.parse(b).loop||{}}catch{E={}}E=JSON.parse(JSON.stringify(E)),y.loop_type=E.loop_type,y.loop_number=E.loop_number,y.loop_arrays=E.loop_arrays,y.intermediate_params=E.intermediate_params,y.output=E.output,vn(()=>{a()})},w=()=>{const b=JSON.stringify({loop:{...y}});o({...e.node,...y,node_params:b})};Jt(()=>e.properties,()=>{x()},{deep:!0});const _=()=>{let b=r();t().deleteNode(b.id)};return Yt(()=>{x(),a(),w()}),(b,E)=>{const k=Kr,O=mc,N=bc,I=_c,T=xc;return G(),ae("div",HX,[B(jX,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),S("div",$X,[S("div",FX,[S("div",zX,[E[2]||(E[2]=S("img",{src:cX,alt:""},null,-1)),S("div",UX,Ae(e.properties.node_name),1)]),S("div",VX,[B(O,{title:null,trigger:"click",open:l.value,"onUpdate:open":E[0]||(E[0]=L=>l.value=L),placement:"right"},{content:U(()=>[B(Vv,{onAddNode:d,type:"loop-node"})]),default:U(()=>[B(k,{title:"新建内部节点"},{default:U(()=>[S("div",{class:"btn-item",onClick:nn(f,["stop"])},[B(ze(ba))])]),_:1})]),_:1},8,["open"]),B(k,{title:"运行测试"},{default:U(()=>[S("div",{class:"btn-item",onClick:nn(v,["stop"])},[B(ze(yc))])]),_:1}),B(T,{trigger:"click"},{overlay:U(()=>[B(I,null,{default:U(()=>[B(N,{onClick:_},{default:U(()=>E[4]||(E[4]=[S("div",{style:{color:"#fb363f"}},"删除",-1)])),_:1,__:[4]})]),_:1})]),default:U(()=>[S("div",{class:"btn-item",onClick:E[1]||(E[1]=nn(()=>{},["stop"]))},E[3]||(E[3]=[S("img",{class:"btn-icon",src:rS,alt:""},null,-1)]))]),_:1})])]),S("div",WX,[S("div",GX,[E[5]||(E[5]=S("div",{class:"info-label"},"循环类型",-1)),S("div",qX,[y.loop_type=="array"?(G(),ae("div",XX,"使用数组循环")):qe("",!0),y.loop_type=="number"?(G(),ae("div",YX,"指定循环次数")):qe("",!0),y.loop_type=="number"?(G(),ae("div",KX,Ae(y.loop_number),1)):qe("",!0)])])])]),E[6]||(E[6]=S("div",{class:"node-content"},null,-1)),B(IX,{ref_key:"runTestRef",ref:h,loop_node_key:u.value},null,8,["loop_node_key"])])}}},ZX=_t(JX,[["__scopeId","data-v-7d6b41be"]]);function lS(n,e){return n.map(t=>{let r=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,o=e?e.node_type:t.node_type,a=t.name||t.key,l=e?`${e.text}.${a}`:a,u=t.children||t.subs||[],d="",f="";o==1?f=`global.${l}`:e?f=`${e.original_value}.${t.key}`:f=`${r}.${t.key}`,d=`【${f}】`;let h={label:a,value:d,original_value:f,node_id:r,node_name:i,node_type:o,text:l,key:t.key,id:r,typ:t.typ,children:u||[]};return h.children&&h.children.length>0&&(h.children=lS(h.children,h)),h})}class QX extends mg.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:r,height:i,x:o,y:a}=t;return this.div=mt("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(mt("foreignObject",{x:o-r/2,y:a-i/2,width:r,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=pn(ZX,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=ga({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,r=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:r,height:t},this.props.model._width=r,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,vn(()=>{this.props.model.properties={...this.props.model.properties,...t};let r=null;this.r&&this.r.el&&(r=this.r.el.clientHeight),this.props.model._height=r||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),r=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(r)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),r=t.map(x=>x.sourceAnchorId),i=t.map(x=>x.targetAnchorId),o=!1;const{x:a,y:l,type:u}=e,d=10;u==="left"?o=i.includes(e.id):o=r.includes(e.id);const f=mt("circle",{className:"custom-anchor-circle",cx:a,cy:l,r:d,fill:"#fff",stroke:"#2475FC","stroke-width":2}),h=mt("g",{className:"custom-anchor-arrow",transform:`translate(${a-d-2}, ${l-d-2})`},[mt("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),mt("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),v=mt("g",{className:`custom-anchor-plus ${o?"anchor-hide":""}`,transform:`translate(${a-d-2}, ${l-d-2})`},[mt("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),mt("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),mt("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return mt("g",{id:e.id,className:`custom-anchor custom-anchor-${u} ${o?"anchor-selected":"anchor-not-selected"}`,onClick:x=>{x.stopPropagation();const{graphModel:w,model:_}=this.props;u==="right"&&!o&&w.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:_})}},f,h,v)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}}class eY extends mg.model{initNodeData(e){super.initNodeData(e),this.width=e.width||800,this.height=e.height||500,this.collapsible=!1,this.isRestrict=!0,this.autoResize=!0,this.radius=8,this.allowResize=!0,this.autoExpand=!0,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!0,this.properties={...this.properties,transformWithContainer:!0}}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+28,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:r-o/2+28,id:u+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,r=this.incoming.edges,{nodes:i}=this.graphModel,o=["start-node","http-node","parameter-extraction-node","knowledge-base-node","ai-dialogue-node","specify-reply-node","problem-optimization-node","select-data-node","code-run-node","mcp-node","custom-group"];let a=i.find(f=>f.type==="start-node");a&&(t.add(a.id),e.push(a));const l=f=>{for(let h=0;h<f.length;h++){let y=f[h].sourceNode;t.has(y.id)||(t.add(y.id),o.includes(y.type)&&e.push(y),l(y.incoming.edges))}};l(r),i.filter(f=>f.properties.loop_parent_key==this.id).forEach(f=>{e.push(f)});let d=[];for(const f of e){if(!o.includes(f.type))continue;let h=JSON.parse(f.properties.node_params),v={label:f.properties.node_name,value:f.id,node_id:f.id,node_type:f.properties.node_type,typ:"node",children:[],loop_parent_key:f.properties.loop_parent_key,group_node_key:this.id};f.type==="http-node"&&(v.children=h.curl.output),f.type==="code-run-node"&&(v.children=h.code_run.output),f.type==="parameter-extraction-node"&&(v.children=h.params_extractor.output),f.type==="start-node"&&(v.children=[...h.start.diy_global,...h.start.sys_global]),f.type==="custom-group"&&(v.children=h.loop.output),f.type==="select-data-node"&&(v.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),f.type==="knowledge-base-node"&&(v.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),f.type==="ai-dialogue-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),f.type==="specify-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),f.type==="problem-optimization-node"&&(v.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),f.type==="mcp-node"&&(v.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),v.children.forEach(y=>{y.node_id=f.id,y.node_name=f.properties.node_name,y.node_type=f.properties.node_type}),v.children=lS(v.children,null),d.push(v)}return d}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const tY={type:"custom-group",view:QX,model:eY},nY={name:"groupStartNode",components:{NodeCommon:Ln},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{}},computed:{},watch:{properties:{handler(){},deep:!0}},mounted(){},methods:{}};function rY(n,e,t,r,i,o){const a=Sn("node-common");return G(),Ve(a,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"200px"}},null,8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const iY=_t(nY,[["render",rY],["__scopeId","data-v-a4bb3b9e"]]);let oY=class extends Tn{constructor(e){super(e),this.renderVue(iY,e)}},aY=class extends Dn{setAttributes(){this.width=200,this.height=72;const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t+i/2,y:r-o/2+25,id:u+"-anchor_right",type:"right",isHovered:a,isSelected:l,nodeId:e}]}};const sY={type:"group-start-node",model:aY,view:oY},lY={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:Ln},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function uY(n,e,t,r,i,o){const a=Sn("node-common");return G(),Ve(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu,style:{width:"420px",height:"94px"}},{default:U(()=>e[0]||(e[0]=[S("div",{class:"end-node"},[S("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])),_:1,__:[0]},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const dY=_t(lY,[["render",uY],["__scopeId","data-v-e5bf7cc3"]]);class cY extends Tn{constructor(e){super(e),this.renderVue(dY,e)}}class fY extends Dn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,o,a,l)=>{if(i.id==o.id)return!1;const u=i.graphModel.edges.map(f=>f.sourceAnchorId),d=a.id;return a.type==="right"&&!u.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,o,a,l)=>i.properties.loop_parent_key?i.properties.loop_parent_key===o.properties.loop_parent_key:!o.properties.loop_parent_key};this.sourceRules=[e,t];const r={message:"只允许连接左边的锚点",validate:(i,o,a,l)=>i.id==o.id?!1:l.type==="left"};this.targetRules=[r]}getDefaultAnchor(){const{id:e,x:t,y:r,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:r-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}]}}const y1={type:"terminate-node",model:fY,view:cY},hY={class:"logic-flow-wrapper"},_1="dont_show_delete_node_confirm",pY={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(n,{expose:e,emit:t}){const r=t;let i=null;const{setStorage:o,getStorage:a}=y2(),l=ke(a(_1)||!1),u=ke(null),d=ke(!1),f=ke(null),h=ke(null),v=Gw(),y=ke(""),x=ke([]),w={nodes:[]},_={width:160,height:140,bottomPosition:24,rightPosition:16},b={exclusiveMode:!1},E=ne=>{i&&i.zoom(ne)};function k(){if(h.value){i=new U$({container:h.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[u9,y9,dX,_9,aS,sS,UF,$7],pluginsOptions:{miniMap:_,selectionSelect:b,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),mn(Y7,i),mn(nz,i),mn(Cz,i),mn(Uz,i),mn(Jz,i),mn(tV,i),mn(oU,i),mn(_U,i),mn(hV,i),mn(_V,i),mn(y1,i),mn(CV,i),mn(eW,i),mn(BV,i),mn(fW,i),mn(AW,i),mn(UW,i),mn(iG,i),mn(TG,i),mn(QG,i),mn(kq,i),mn(Uq,i),mn(Kq,i),mn(iX,i),mn(tY,i),mn(sY,i),mn(y1,i),i.setDefaultEdgeType("custom-bezier-edge"),i.on("graph:rendered",({graphModel:he})=>{y.value=he.flowId});let ne=1,fe=[];i.on("node:dragstart",({data:he})=>{let be=i.graphModel.getElement(he.id);ne=be.zIndex,fe=[];let xe=i.graphModel.dynamicGroup.getGroupByNodeId(he.id);xe?(xe.properties.width=xe._width,xe.properties.height=xe._height):be.properties.loop_parent_key||(be.properties.disabled_add_group=!0),he.type=="custom-group"?(fe=be.children||[],fe.forEach(Ze=>{i.getNodeModelById(Ze).setZIndex(99)})):be.setZIndex(999999),be.refreshBranch()}),i.on("node:drop",({data:he})=>{let be=i.graphModel.getElement(he.id),xe=i.graphModel.dynamicGroup.getGroupByNodeId(he.id);xe&&xe.refreshBranch(),be.setZIndex(ne),fe.length&&fe.forEach(Ze=>{i.getNodeModelById(Ze).setZIndex(1)})}),i.on("node:drag",({data:he})=>{const be=he.id;i.graphModel.getNodeEdges(be).forEach(Ze=>{if(Ze.type==="custom-bezier-edge"){const{startPoint:We,endPoint:St}=Ze,pt=St.x-We.x,Ht=St.y-We.y;let F=10+Math.sqrt(pt*pt+Ht*Ht)*.3;const Z=10,J=1e3;F=Math.round(F),F=Math.max(Z,Math.min(F,J)),Ze.setProperties({offset:F})}})}),i.on("node:add",()=>{}),i.on("custom:addNode",he=>{H(he)}),i.on("custom:addGroupNode",({data:he,group_id:be})=>{X(he,be)}),i.on("group:add-node",({data:he,childId:be})=>{const xe=i.getNodeModelById(be);i.getNodeModelById(he.id),xe.properties.loop_parent_key}),i.on("element:click",he=>{x.value=[he.data]}),i.on("node:click",({data:he})=>{ve(he)}),i.on("blank:click",()=>{ie()}),i.on("selection:selected",he=>{let be=[];he.elements.forEach(xe=>{let Ze=i.getDataById(xe.id);(xe.BaseType==="node"||xe.BaseType==="edge")&&be.push(Ze)}),x.value=be}),i.on("node:delete",({data:he})=>{let be=JSON.parse(JSON.stringify(he));ce(be)}),i.on("edge:delete",({data:he})=>{let be=JSON.parse(JSON.stringify(he));ue(be)}),i.on("custom:node:delete",he=>{pe(he)}),i.on("custom:edge:delete",he=>{De(he)}),i.on("custom:keyoard:delete",()=>{de()}),i.on("custom:paste",q),i.render(w),i.setZoomMiniSize(.01),i.setZoomMaxSize(8),i.container.setAttribute("tabindex","0"),i.container.style.outline="none",i.container.focus()}}const O=()=>i.getGraphRawData(),N=ne=>{let fe=cN();ne.nodes.forEach(be=>{let xe=fe[be.type];be.properties.node_icon_name=xe.properties.node_icon_name,be.properties.width||(be.properties.width=xe.width),be.properties.height||(be.properties.height=xe.height)}),i.clearData(),i.graphModel.graphDataToModel(ne),i.graphModel.translateCenter(),i.extension.miniMap.show();const he=i.extension.canvasHistory;he&&he.setInitialState(ne),I(ne.nodes)},I=ne=>{vn(()=>{ne.forEach(fe=>{if(fe.loop_parent_key){const he=i.getNodeModelById(fe.loop_parent_key);he&&(he.addChild(fe.id),i.graphModel.dynamicGroup.sendNodeToFront(he))}})})};let T={};const L=ne=>{const fe=ne.node||ne,he=ne.anchorData,be=ne.event;if(fe.id=fe.id||os(fe.type),fe.nodeSortKey=fe.id.substring(0,8)+fe.id.substring(fe.id.length-8),ne.isCopy||(T[fe.type]?(T[fe.type]=T[fe.type]+1,fe.properties.node_name=fe.properties.node_name+T[fe.type]):T[fe.type]=1),fe.properties.width=fe.width,fe.properties.height=fe.height,fe.properties.nodeSortKey=fe.nodeSortKey,be){const{transformModel:xe}=i.graphModel,{left:Ze,top:We}=h.value.getBoundingClientRect(),[St,pt]=xe.HtmlPointToCanvasPoint([be.clientX-Ze,be.clientY-We]);fe.x=St+fe.width/2,fe.y=pt+fe.height/2}else if(!fe.x&&!fe.y)if(he){fe.x=he.x+fe.width+100,fe.y=he.y+fe.height/2-24;let xe=i.graphModel.dynamicGroup.getGroupByNodeId(he.nodeId);xe?fe.properties.loop_parent_key=xe.id:fe.properties.disabled_add_group=!0}else{const{transformModel:xe}=i.graphModel,Ze=xe.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);fe.x=Ze[0],fe.y=Ze[1],fe.properties.disabled_add_group=!0}return fe},H=ne=>{const fe=L(ne),he=ne.model,be=ne.anchorData;let xe=0;i.graphModel.nodes.forEach(We=>{We.zIndex>xe&&(xe=We.zIndex)}),xe=xe+1;let Ze=i.addNode(fe);if(Ze.type=="custom-group"&&setTimeout(()=>{X({node:{type:"group-start-node",with:200,properties:{node_type:27,node_name:"循环开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},Ze.id)},100),be){i.graphModel.addEdge({type:"custom-bezier-edge",sourceNodeId:he.id,targetNodeId:Ze.id,sourceAnchorId:be.id,startPoint:{x:be.x,y:be.y}});let We=i.graphModel.dynamicGroup.getGroupByNodeId(be.nodeId);if(We&&We.id){const St=i.getNodeModelById(We.id);if(St.addChild(Ze.id),i.graphModel.dynamicGroup.sendNodeToFront(St),Ze.x-Ze.width/3>St.x+St._width/2){let pt=St._width+310+Ze.width;St.properties.width=pt,St._width=pt,St.width=pt,St.x=St.x+(310+Ze.width)/2}}}Ze.setZIndex(xe),i.graphModel.clearSelectElements(),Ze.setSelected(!0)},X=(ne,fe)=>{const he=ne.node||ne;he.id=os(he.type),he.nodeSortKey=he.id.substring(0,8)+he.id.substring(he.id.length-8),he.properties.width=he.width,he.properties.height=he.height,he.properties.nodeSortKey=he.nodeSortKey,he.properties.loop_parent_key=fe;const be=i.getNodeModelById(fe);he.x=be.x,he.y=be.y;let xe=0;i.graphModel.nodes.forEach(We=>{We.zIndex>xe&&(xe=We.zIndex)}),xe=xe+99;let Ze=i.addNode(he);be.addChild(Ze.id),Ze.setZIndex(xe),i.graphModel.clearSelectElements(),i.graphModel.dynamicGroup.sendNodeToFront(be)},V=()=>{let fe=O().nodes.filter(be=>be.type=="custom-group");if(fe&&fe.length)return Cn.warn("存在循环节点，暂不支持整理");i.extension.dagre.layout({rankdir:"LR",align:"UL",ranker:"tight-tree"}),i.fitView();const he=i.getGraphRawData();i.clearSelectElements(),i.clearData(),i.graphModel.graphDataToModel(he)},q=({originalNodes:ne,basePoint:fe,pasteBasePoint:he})=>{const be=i.extension.canvasHistory;be&&be.beginTransaction();try{const xe=ne.map(We=>{const St=We.x-fe.x,pt=We.y-fe.y,Ht=JSON.parse(JSON.stringify(We));return Ht.x=he.x+St,Ht.y=he.y+pt,L({node:Ht,isCopy:!0})}),{nodes:Ze}=i.addElements({nodes:xe});i.clearSelectElements(),Ze.forEach(We=>{We.setSelected(!0)})}finally{be&&be.commitTransaction("paste")}},D=ne=>{ne.height&&(ne.properties.height=ne.height);let fe=i.getNodeModelById(ne.id);fe.height=ne.properties.height||ne.height||fe.height,fe.properties=ne.properties,ne.properties.node_type==2&&ne.properties.node_sub_type==21&&fe.graphModel.getNodeEdges(ne.id).forEach(be=>{be.sourceNodeId==fe.id&&(fe.getAnchorInfo(be.sourceAnchorId)||fe.graphModel.deleteEdgeById(be.id))}),fe.refreshBranch()};function W(ne){return i.getNodeModelById(ne.id)}function $(ne){return i.getEdgeModelById(ne.id)}const pe=ne=>{ne&&ne.id&&(x.value=[ne]),Se()},De=ne=>{ne&&ne.id&&(x.value=[ne]),Se()},de=()=>{let ne=i.getSelectElements(!0);x.value=[...ne.nodes,...ne.edges],Se()},Se=()=>{if(x.value.length===0)return;const ne=x.value.filter(he=>W(he)?!["start-node","group-start-node"].includes(he.type):!0);if(ne.length===0){x.value=[];return}const fe=()=>{const he=i.extension.canvasHistory;he&&he.replaceLastState("replace-before-delete"),ne.forEach(be=>{W(be)?i.deleteNode(be.id):$(be)&&i.deleteEdge(be.id)}),he&&he.saveCurrentState("delete"),x.value=[],i.clearSelectElements()};if(l.value){fe();return}if(ne.length>1||ne.length===1&&W(ne[0])){const he=ne.length>1?"批量删除":"删除节点",be=`确定要删除选中的 ${ne.length} 个元素吗？`;let xe=!1;yr.confirm({title:he,content:pn("div",{},[pn("p",be),pn(L1,{class:"dont-show-again-checkbox",onChange:Ze=>{xe=Ze.target.checked}},()=>"不再提示")]),onOk:()=>{xe&&(l.value=!0,o(_1,!0)),fe()},onCancel:()=>{}})}else fe()},me=["explain-node","end-node","group-start-node","terminate-node"],ve=ne=>{const fe=JSON.parse(JSON.stringify(ne));fe.properties.dataRaw=fe.properties.dataRaw||fe.properties.node_params,r("selectNode",fe),!me.includes(ne.type)&&(f.value=fe,d.value=!0)},Re=ne=>{f.value.properties=ne,D(JSON.parse(JSON.stringify(f.value)))},Ie=ne=>{f.value.properties.node_name=ne,D(JSON.parse(JSON.stringify(f.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:ne,node_id:f.value.id,node_type:f.value.type})},ce=ne=>{r("onDeleteNode",ne),f.value&&ne.id===f.value.id&&(d.value=!1,setTimeout(()=>{f.value=null},350))},ue=ne=>{r("onDeleteEdge",ne)},K=()=>{r("runTest")},ie=()=>{r("blankClick"),d.value&&(d.value=!1),x.value.length>0&&(x.value=[],i.clearSelectElements())};return Yt(()=>{k()}),N1(()=>{i&&i.destroy()}),e({setData:N,getData:O,updateNode:D}),(ne,fe)=>(G(),ae("div",hY,[S("div",{ref_key:"containerRef",ref:h,class:"logic-flow-container"},null,512),B(ze(v),{"flow-id":y.value},null,8,["flow-id"]),ze(i)?(G(),Ve(vT,{key:0,lf:ze(i),onRunTest:K,onAddNode:H,onZoomChange:E,onAutoLayout:V},null,8,["lf"])):qe("",!0),f.value?(G(),Ve(vB,{key:1,ref_key:"nodeFormDrawerRef",ref:u,open:d.value,"onUpdate:open":fe[0]||(fe[0]=he=>d.value=he),destroyOnClose:!0,"node-id":f.value.id,node:f.value.properties,"node-type":f.value.type,lf:ze(i),onUpdateNode:Re,onChangeTitle:Ie},null,8,["open","node-id","node","node-type","lf"])):qe("",!0)]))}},vY={class:"flex-content-box"},gY={class:"test-model-box"},mY={key:2,class:"input-list-box"},yY={class:"add-btn-box"},_Y={key:0,class:"result-list-box loading-box"},bY={key:1,class:"result-list-box"},xY=["onClick"],wY={class:"status-block"},SY={class:"icon-name-box"},EY=["src"],CY={class:"node-name"},kY={key:0,class:"time-tag"},OY={class:"right-active-icon"},MY={class:"save-btn-box"},NY={class:"preview-box"},AY={class:"preview-title"},TY={class:"icon-name-box"},DY=["src"],LY={class:"node-name"},PY={key:0,class:"time-tag"},RY={class:"preview-content-block"},IY={class:"title-block"},BY={class:"preview-code-box"},jY={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(n,{expose:e,emit:t}){const r=n,i=Gt(()=>r.start_node_params.diy_global||[]),o=t,a=Yl().query,l=ke(!1),u=ke(""),d=ke([]),f=Gt(()=>u.value?d.value.filter(L=>L.node_key==u.value)[0]:null),h=ke(!1),v=qt({is_draft:!0,robot_key:a.robot_key,question:"",openid:"",global:"",globalState:{}}),y=()=>{if(r.isLockedByOther){Cn.warning("当前已有其他用户在编辑中，无法运行测试");return}o("save","automatic");let L=localStorage.getItem("workflow_run_test_data")||"{}";L=JSON.parse(L),v.question=L.question||"",v.openid=L.openid||"",v.global=L.global||"",d.value=[],u.value="",o("getGlobal"),vn(()=>{i.value.forEach(H=>{v.globalState[H.key]=x(H)});try{let H=L.global?JSON.parse(L.global):{};for(let X in v.globalState)H[X]&&(Array.isArray(H[X])?v.globalState[X]=H[X].map(V=>({value:V,key:Math.random()*1e3})):v.globalState[X]=H[X])}catch(H){}}),l.value=!0};function x(L){return L.typ=="string"||L.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function w(){let L={};return i.value.forEach(H=>{if(H.typ=="string"&&(L[H.key]=v.globalState[H.key]),H.typ=="number"&&(L[H.key]=v.globalState[H.key]?+v.globalState[H.key]:""),H.typ=="array<string>"){let X=v.globalState[H.key].map(V=>V.value).filter(V=>V);L[H.key]=X}}),JSON.stringify(L)}const _=(L,H)=>{v.globalState[L].splice(H,1)},b=L=>{v.globalState[L].push({value:"",key:Math.random()*1e4})},E=ke(null),k=()=>{E.value.validate().then(()=>{let L={...v};L.global=w(),delete L.globalState,h.value=!0,d.value=[],localStorage.setItem("workflow_run_test_data",JSON.stringify({...L})),c2({...L}).then(H=>{Cn.success("测试结果生成完成"),O(H.data||[])}).catch(H=>{d.value=[],H.data&&H.data.length&&O(H.data)}).finally(()=>{h.value=!1})})},O=L=>{var H;d.value=L.map(X=>({...X,is_success:X.error_msg==="<nil>",node_icon:jv(X.node_type)})),u.value=(H=d.value[0])==null?void 0:H.node_key},N=L=>{u.value=L.node_key},I=()=>{k1(JSON.stringify(f.value.output)),Cn.success("复制成功")};return e({open:()=>{y()}}),(L,H)=>{const X=Cc,V=_a,q=dr,D=ci,W=Zr,$=lo,pe=Bn,De=Jr,de=Ec,Se=yr;return G(),ae("div",null,[B(Se,{open:l.value,"onUpdate:open":H[2]||(H[2]=me=>l.value=me),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:U(()=>[S("div",vY,[S("div",gY,[H[9]||(H[9]=S("div",{class:"top-title"},"开始节点参数",-1)),B(De,{model:v,ref_key:"formRef",ref:E,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:U(()=>[B(D,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:U(()=>[B(V,{gap:4},{default:U(()=>[H[4]||(H[4]=Be("question ")),B(X,{style:{margin:"0"}},{default:U(()=>H[3]||(H[3]=[Be("string")])),_:1,__:[3]})]),_:1,__:[4]})]),default:U(()=>[B(q,{placeholder:"请输入",value:v.question,"onUpdate:value":H[0]||(H[0]=me=>v.question=me)},null,8,["value"])]),_:1}),B(D,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:U(()=>[B(V,{gap:4},{default:U(()=>[H[6]||(H[6]=Be("openid ")),B(X,{style:{margin:"0"}},{default:U(()=>H[5]||(H[5]=[Be("string")])),_:1,__:[5]})]),_:1,__:[6]})]),default:U(()=>[B(q,{placeholder:"请输入",value:v.openid,"onUpdate:value":H[1]||(H[1]=me=>v.openid=me)},null,8,["value"])]),_:1}),(G(!0),ae(rt,null,gt(i.value,me=>(G(),Ve(D,{name:["globalState",me.key],key:me.key,rules:[{required:me.required,message:`请输入${me.key}`}]},{label:U(()=>[B(V,{gap:4},{default:U(()=>[Be(Ae(me.key)+" ",1),B(X,{style:{margin:"0"}},{default:U(()=>[Be(Ae(me.typ),1)]),_:2},1024)]),_:2},1024)]),default:U(()=>[me.typ=="string"?(G(),Ve(q,{key:0,placeholder:"请输入",value:v.globalState[me.key],"onUpdate:value":ve=>v.globalState[me.key]=ve},null,8,["value","onUpdate:value"])):qe("",!0),me.typ=="number"?(G(),Ve(W,{key:1,style:{width:"100%"},placeholder:"请输入",value:v.globalState[me.key],"onUpdate:value":ve=>v.globalState[me.key]=ve},null,8,["value","onUpdate:value"])):qe("",!0),me.typ=="array<string>"?(G(),ae("div",mY,[(G(!0),ae(rt,null,gt(v.globalState[me.key],(ve,Re)=>(G(),ae("div",{class:"input-list-item",key:Re},[B($,null,{default:U(()=>[B(q,{placeholder:"请输入",value:ve.value,"onUpdate:value":Ie=>ve.value=Ie},null,8,["value","onUpdate:value"])]),_:2},1024),v.globalState[me.key].length>1?(G(),Ve(ze(Jn),{key:0,onClick:Ie=>_(me.key,Re)},null,8,["onClick"])):qe("",!0)]))),128)),S("div",yY,[B(pe,{onClick:ve=>b(me.key),block:"",type:"dashed"},{default:U(()=>H[7]||(H[7]=[Be("添加")])),_:2,__:[7]},1032,["onClick"])])])):qe("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),h.value?(G(),ae("div",_Y,[h.value?(G(),Ve(de,{key:0,tip:"测试结果生成中..."})):qe("",!0)])):qe("",!0),d.value.length>0?(G(),ae("div",bY,[(G(!0),ae(rt,null,gt(d.value,(me,ve)=>(G(),ae("div",{class:dn(["list-item-block",{active:u.value==me.node_key}]),onClick:Re=>N(me),key:ve},[S("div",wY,[me.is_success?(G(),Ve(ze(Bv),{key:0,style:{color:"#138b1b"}})):(G(),Ve(ze(j1),{key:1,style:{color:"#d81e06"}}))]),S("div",SY,[S("img",{src:me.node_icon,alt:""},null,8,EY),S("div",CY,Ae(me.node_name),1)]),me.is_success?(G(),ae("div",kY,Ae(me.use_time)+"ms",1)):qe("",!0),S("div",OY,[B(ze(H1))])],10,xY))),128))])):qe("",!0),S("div",MY,[B(pe,{loading:h.value,onClick:k,style:{"background-color":"#00ad3a"},type:"primary"},{default:U(()=>[B(ze(yc)),H[8]||(H[8]=Be("运行测试"))]),_:1,__:[8]},8,["loading"])])]),S("div",NY,[f.value?(G(),ae(rt,{key:0},[S("div",AY,[H[10]||(H[10]=S("div",{class:"title-text"},"日志详情",-1)),S("div",TY,[S("img",{src:f.value.node_icon,alt:""},null,8,DY),S("div",LY,Ae(f.value.node_name),1)]),f.value.is_success?(G(),ae("div",PY,Ae(f.value.use_time)+"ms",1)):qe("",!0)]),S("div",RY,[S("div",IY,[H[11]||(H[11]=Be("运行日志")),B(ze($1),{onClick:I})]),S("div",BY,[B(ze(F1),{data:f.value.output},null,8,["data"])])])],64)):qe("",!0)])])]),_:1},8,["open"])])}}},HY=_t(jY,[["__scopeId","data-v-3a499064"]]),$Y={class:"page-header"},FY={class:"header-content"},zY={key:1,class:"robot-status-box status-0"},UY={key:0,class:"header-right"},VY={key:0,class:"last-save-time"},WY={key:0,class:"auto-save-hint"},GY={style:{display:"flex","align-items":"center",gap:"8px"}},qY={class:"lock-config"},XY={style:{"margin-top":"24px","text-align":"right"}},YY={key:1,class:"lock-tip"},KY={class:"lock-info"},JY={__name:"page-header",props:{saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(n,{expose:e,emit:t}){const r=$r(),i=Gt(()=>r.robotInfo),o=t,a=n,l=ke(null),u=_2(),d=Gt(()=>{var L;const T=(L=u.userInfo)==null?void 0:L.role_type;return T==1||T==2}),f=ke(!1),h=ke(10),v=ke(!1),y=async()=>{v.value=!0;try{await h2({draft_exptime:h.value}),Cn.success("编辑锁设置已保存"),f.value=!1}catch{Cn.error("保存失败，请稍后重试")}finally{v.value=!1}};Yt(async()=>{var T;try{const L=await f2(),H=+((T=L==null?void 0:L.data)==null?void 0:T.draft_exptime);typeof H=="number"&&(h.value=Math.max(10,Math.min(60,Math.round(H))))}catch{}});const x=()=>{},w=()=>{o("edit")},_=(T="handle")=>{o("save",T)},b=()=>{o("release")},E=()=>{o("getGlobal")},k=()=>{o("getVersionRecord")},O=()=>{o("edit")},N=()=>{l.value.open()};function I(T,L="YY-MM-DD HH:mm:ss"){return!T||T<=0?"--":Qa(T*1e3).format(L)}return e({openRunTest:N}),(T,L)=>{const H=Bn,X=Kr,V=Fr,q=Zr,D=mc;return G(),ae("div",$Y,[S("div",FY,[B(eA),i.value.start_node_key!=""?(G(),ae("div",{key:0,class:"robot-status-box status-1",onClick:w},[B(ze(Bv),{class:"robot-status-icon"}),L[6]||(L[6]=S("div",{class:"robot-status-text"},"已发布",-1))])):(G(),ae("div",zY,[B(ze(K2),{class:"robot-status-icon"}),L[7]||(L[7]=S("div",{class:"robot-status-text"},"未发布",-1))]))]),a.showRight?(G(),ae("div",UY,[n.currentVersion==""&&n.isEditing?(G(),ae(rt,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(G(),ae("div",VY,[Be(Ae(I(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+Ae(i.value.draft_save_type=="handle"?"手动":"自动")+"保存草稿 ",1),n.isEditing&&!n.isLockedByOther&&(!n.autoSaveEnabled||!n.isLeader)?(G(),ae("span",WY,"你可能已在其他页面编辑，已停止自动保存")):qe("",!0)])):qe("",!0),n.isLockedByOther?qe("",!0):(G(),ae(rt,{key:1},[B(H,{class:"save-draft",onClick:L[0]||(L[0]=W=>_("handle"))},{default:U(()=>L[8]||(L[8]=[Be("保存草稿")])),_:1,__:[8]}),B(H,{type:"primary",loading:a.saveLoading,class:"publish-robot",onClick:b},{default:U(()=>L[9]||(L[9]=[Be("发布机器人")])),_:1,__:[9]},8,["loading"])],64))],64)):qe("",!0),!n.isEditing&&!n.currentVersion||n.isLockedByOther?(G(),Ve(H,{key:1,disabled:n.isLockedByOther,type:"primary",class:"ml8",onClick:O},{icon:U(()=>[B(ze(Iv))]),default:U(()=>[L[10]||(L[10]=Be(" 编辑 "))]),_:1,__:[10]},8,["disabled"])):qe("",!0),B(X,{title:"历史发布详情"},{default:U(()=>[B(H,{onClick:L[1]||(L[1]=W=>k())},{default:U(()=>[B(ze(J2))]),_:1})]),_:1}),d.value?(G(),Ve(D,{key:2,trigger:"click",placement:"bottomRight",open:f.value,"onUpdate:open":L[5]||(L[5]=W=>f.value=W),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onOnOpenChange:x},{title:U(()=>[S("div",GY,[B(V,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),L[11]||(L[11]=S("span",{style:{color:"#262626"}},"编辑锁设置",-1)),L[12]||(L[12]=S("span",{style:{color:"#8c8c8c","font-weight":"normal"}},"不同的IP和UserAgent都会限制",-1))])]),content:U(()=>[S("div",qY,[L[13]||(L[13]=S("span",{style:{color:"#595959"}},"编辑结束后锁",-1)),B(q,{value:h.value,"onUpdate:value":L[2]||(L[2]=W=>h.value=W),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),L[14]||(L[14]=S("span",{style:{color:"#595959"}},"分钟后才能编辑",-1))]),S("div",XY,[B(H,{class:"ml8",onClick:L[3]||(L[3]=W=>f.value=!1)},{default:U(()=>L[15]||(L[15]=[Be("取 消")])),_:1,__:[15]}),B(H,{type:"primary",class:"ml8",loading:v.value,onClick:y},{default:U(()=>L[16]||(L[16]=[Be("保 存")])),_:1,__:[16]},8,["loading"])])]),default:U(()=>[B(H,{class:"",onClick:L[4]||(L[4]=W=>f.value=!0),style:{padding:"5px 9px"}},{default:U(()=>[B(V,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):qe("",!0)])):qe("",!0),n.isLockedByOther?(G(),ae("div",YY,[L[17]||(L[17]=S("div",null,"当前已有用户正在编辑中，无法编辑保存草稿或发布工作流",-1)),S("div",KY,"（"+Ae("用户："+n.loginUserName||"--")+" "+Ae("IP："+n.lockRemoteAddr||"--")+" "+Ae("User Agent："+n.lockUserAgent||"--")+"）",1)])):qe("",!0),B(HY,{ref_key:"runTestRef",ref:l,start_node_params:n.start_node_params,onGetGlobal:E,onSave:_,isLockedByOther:n.isLockedByOther},null,8,["start_node_params","isLockedByOther"])])}}},ZY=_t(JY,[["__scopeId","data-v-1a3fb712"]]),QY={class:"form-box"},eK={class:"form-item"},tK={class:"form-content"},nK={class:"version-input-box"},rK={class:"form-item"},iK={class:"form-content"},oK={__name:"version-model",emits:["ok"],setup(n,{expose:e,emit:t}){const r=Yl().query,i=ke(!1);let o="";const a=$r(),l=ke(""),u=ke(""),d=ke(""),f=ke(""),h=ke(!1),v=t,y=_=>{w(),f.value="",o=_,i.value=!0},x=()=>{h.value=!0,v2({robot_key:r.robot_key,node_list:o,version:`${l.value}.${u.value}.${d.value}`,version_desc:f.value,draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0}).then(async _=>{await a.getRobot(r.id);const b=+a.robotInfo.draft_save_time||0;a.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:b}),i.value=!1,_&&_.res==0&&(Cn.success("发布成功"),v("ok"))}).finally(()=>{h.value=!1})},w=()=>{p2({robot_key:r.robot_key}).then(_=>{let b=_.data.version_params||[];l.value=b[0],u.value=b[1],d.value=b[2]})};return e({show:y}),(_,b)=>{const E=Zr,k=wc,O=yr;return G(),ae("div",null,[B(O,{open:i.value,"onUpdate:open":b[4]||(b[4]=N=>i.value=N),title:"发布","ok-text":"立即发布",onOk:x,confirmLoading:h.value,width:600},{default:U(()=>[S("div",QY,[S("div",eK,[b[8]||(b[8]=S("div",{class:"form-label"},"版本号：",-1)),S("div",tK,[S("div",nK,[b[5]||(b[5]=Be(" v ")),B(E,{value:l.value,"onUpdate:value":b[0]||(b[0]=N=>l.value=N),precision:0,min:0,max:1e3},null,8,["value"]),b[6]||(b[6]=S("span",null,".",-1)),B(E,{value:u.value,"onUpdate:value":b[1]||(b[1]=N=>u.value=N),precision:0,min:0,max:1e3},null,8,["value"]),b[7]||(b[7]=S("span",null,".",-1)),B(E,{value:d.value,"onUpdate:value":b[2]||(b[2]=N=>d.value=N),precision:0,min:0,max:1e3},null,8,["value"])])])]),S("div",rK,[b[9]||(b[9]=S("div",{class:"form-label"},"版本描述：",-1)),S("div",iK,[B(k,{value:f.value,"onUpdate:value":b[3]||(b[3]=N=>f.value=N),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},aK=_t(oK,[["__scopeId","data-v-45be7e85"]]),sK={class:"version-detail"},lK={class:"version-desc flex-center"},uK={class:"version-file-box"},dK={class:"version-text"},cK={class:"version-text"},fK=["onClick"],hK={class:"version-header"},pK={class:"version-title"},vK={class:"time-text flex-center"},gK={class:"version-file-box"},mK={class:"version-text"},yK={class:"version-text"},_K={class:"version-desc"},bK={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(n,{expose:e,emit:t}){const r=Yl().query,i=ke(!1),o=ke(""),a=ke(""),l=t,u=n,d=$r(),f=Gt(()=>d.robotInfo),h=ke([]),v=()=>{i.value=!0,y(),Pp({robot_key:r.robot_key}).then(b=>{const E=(b==null?void 0:b.data)||{};o.value=E.remote_addr||"",a.value=E.user_agent||""})},y=()=>{g2({robot_key:r.robot_key}).then(b=>{h.value=b.data.versions||[]})},x=b=>{yr.confirm({title:`确定要恢复到v${b.version}版吗`,icon:null,content:pn("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){gy({robot_key:r.robot_key,version_id:b.version_id}).then(E=>{l("setVersion",E.data),i.value=!1,E.res==0&&Cn.success("设置成功")})},onCancel(){}})},w=b=>{b==""?E1({robot_key:r.robot_key,data_type:1}).then(E=>{l("preview",E.data,b),i.value=!1}):gy({robot_key:r.robot_key,version_id:b}).then(E=>{l("preview",E.data,b),i.value=!1})};function _(b,E="YYYY-MM-DD HH:mm:ss"){return b<=0?"--":Qa(b*1e3).format(E)}return e({showDrawer:v}),(b,E)=>{const k=Fr,O=mc,N=bc,I=_c,T=xc,L=Q2;return G(),ae("div",null,[B(L,{open:i.value,"onUpdate:open":E[2]||(E[2]=H=>i.value=H),title:"发布详情",placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:U(()=>[S("div",sK,[f.value.draft_save_time&&f.value.draft_save_time!=0?(G(),ae("div",{key:0,class:"version-list",onClick:E[0]||(E[0]=H=>w(""))},[E[3]||(E[3]=S("div",{class:"version-header"},[S("div",{class:"version-title"},"当前最新草稿")],-1)),S("div",lK,[Be(" 最近保存于"+Ae(_(f.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),S("div",uK,[B(O,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:U(()=>[S("div",dK," IP："+Ae(o.value||"--"),1),S("div",cK," User Agent："+Ae(a.value||"--"),1)]),default:U(()=>[B(k,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):qe("",!0),(G(!0),ae(rt,null,gt(h.value,(H,X)=>(G(),ae("div",{class:"version-list",onClick:V=>w(H.version_id),key:H.version},[S("div",hK,[S("div",pK,[Be(" v"+Ae(H.version)+" ",1),S("span",vK,[Be(Ae(_(H.create_time))+" ",1),S("div",gK,[B(O,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:U(()=>[S("div",mK," IP："+Ae(H.last_edit_ip||"--"),1),S("div",yK," User Agent："+Ae(H.last_edit_user_agent||"--"),1)]),default:U(()=>[B(k,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),B(T,null,{overlay:U(()=>[B(I,null,{default:U(()=>[B(N,{disabled:u.isLockedByOther,onClick:V=>x(H)},{default:U(()=>E[4]||(E[4]=[Be(" 恢复到此版本 ")])),_:2,__:[4]},1032,["disabled","onClick"])]),_:2},1024)]),default:U(()=>[S("div",{class:"hover-btn-box",onClick:E[1]||(E[1]=nn(()=>{},["stop"]))},[B(ze(Z2))])]),_:2},1024)]),S("div",_K,Ae(H.version_desc),1)],8,fK))),128))])]),_:1},8,["open"])])}}},xK=_t(bK,[["__scopeId","data-v-8bc6bcdb"]]),wK={class:"workflow-page"},SK={class:"page-body"},EK={class:"page-left"},CK={class:"page-container"},kK=5*60*1e3,b1=60*1e3,OK=20*1e3,x1="wf_autosave_leader_",w1=2*60*1e3,S1="当前草稿已经不是最新的草稿版本，保存后会覆盖，确认保存么？",MK={__name:"index",setup(n){const e=Yl(),t=e.query,r=ke(e.query.robot_key),i=ke(null),o=ke(null),a=$r(),l=ke(""),u=ke(""),d=ke(null),f=Gt(()=>a.robotInfo.loop_save_canvas_status);Jt(f,Ne=>{Ne>0&&St("automatic")});const h=fN(),v=ke(!0),y=ke(!1),x=ke(!0);let w=null,_=null,b=Date.now(),E="";const k=ke(""),O=ke(""),N=ke(""),I=ke(!1),T=`${Date.now()}_${Math.random()}`;let L=null;const H=()=>`${x1}${r.value}`,X=()=>`wf_open_tabs_${r.value}`;function V(){try{const Ne=parseInt(localStorage.getItem(X())||"0",10)||0;localStorage.setItem(X(),String(Ne+1))}catch(Ne){console.warn("incrementOpenTabs error",Ne)}}function q(){try{const Ne=parseInt(localStorage.getItem(X())||"0",10)||0,it=Math.max(0,Ne-1);it<=0?setTimeout(()=>{localStorage.removeItem(X()),localStorage.removeItem(H())},0):localStorage.setItem(X(),String(it))}catch(Ne){console.warn("decrementOpenTabs error",Ne)}}function D(){try{const Ne=Date.now();for(let it=0;it<localStorage.length;it++){const ct=localStorage.key(it);if(ct&&ct.startsWith(x1)){const Xe=localStorage.getItem(ct);let et=null;try{et=Xe?JSON.parse(Xe):null}catch{et=null}(!et||typeof et.ts!="number"||Ne-et.ts>b1)&&localStorage.removeItem(ct)}}}catch(Ne){console.warn("cleanupExpiredLeaderKeys error",Ne)}}function W(){try{const Ne=localStorage.getItem(H());return Ne?JSON.parse(Ne):null}catch{return null}}function $(){localStorage.setItem(H(),JSON.stringify({tabId:T,ts:Date.now()}))}function pe(){const Ne=W();return!Ne||Date.now()-Ne.ts>b1?($(),!0):Ne.tabId===T}function De(){const Ne=W();Ne&&Ne.tabId===T&&localStorage.removeItem(H())}function de(Ne){try{const it=localStorage.getItem(Ne),ct=it?JSON.parse(it):null;ct&&ct.tabId===T&&localStorage.removeItem(Ne)}catch{}}function Se(Ne){Ne.key===H()&&(Z(),D(),I.value=pe())}function me(){document.visibilityState==="visible"&&(I.value=pe()),D(),Z()}function ve(){Re(),D(),I.value=pe(),L=setInterval(()=>{const Ne=pe();I.value=Ne,Ne&&localStorage.setItem(H(),JSON.stringify({tabId:T,ts:Date.now()}))},OK),window.addEventListener("storage",Se),document.addEventListener("visibilitychange",me),window.addEventListener("beforeunload",()=>{De(),q()}),window.addEventListener("pagehide",()=>{De(),q()})}function Re(){L&&clearInterval(L),L=null,window.removeEventListener("storage",Se),document.removeEventListener("visibilitychange",me),window.removeEventListener("beforeunload",De)}function Ie(){try{const Ne=We();return JSON.stringify(Ne)}catch{return""}}function ce(){ue(),E=Ie(),b=Date.now(),_=setInterval(()=>{if(!v.value)return;const Ne=Ie();Ne&&Ne!==E&&(E=Ne,b=Date.now(),K())},2*1e3)}function ue(){_&&clearInterval(_),_=null}function K(){try{if(!v.value||y.value)return;(!x.value||!pe())&&($(),x.value=!0),Z()}catch{}}function ie(){ne(),w=setInterval(()=>{v.value&&x.value&&Date.now()-b>=kK&&(x.value=!1,Cn.warning("已超过5分钟无改动，自动保存已暂停"),Z())},30*1e3)}function ne(){w&&clearInterval(w),w=null}async function fe(){try{const Ne=await Pp({robot_key:r.value}),it=(Ne==null?void 0:Ne.data)||{};y.value=!it.lock_res,k.value=it.remote_addr||"",O.value=it.user_agent||"",N.value=it.login_user_name||"",a.setIsLockedByOther(y.value),Z()}catch{y.value=!1,a.setIsLockedByOther(y.value)}}async function he(){try{const Ne=await Pp({robot_key:r.value}),it=(Ne==null?void 0:Ne.data)||{};return it.lock_res?(y.value=!1,k.value="",O.value="",N.value="",a.setIsLockedByOther(y.value),!0):(y.value=!it.lock_res,k.value=it.remote_addr||"",O.value=it.user_agent||"",N.value=it.login_user_name||"",a.setIsLockedByOther(y.value),!1)}catch{return y.value=!1,a.setIsLockedByOther(y.value),!0}}function be(Ne){Ne=Ne||[];let it=[],ct=[];Ne.forEach(Xe=>{if(Xe.node_type==0){let et=JSON.parse(Xe.node_info_json);et.type=="custom-edge"&&(et.pointsList=[],et.type="custom-bezier-edge"),ct.push(et)}else{const et=h[Xe.node_type];if(Xe.type=et,Xe.node_type==1){let we=JSON.parse(Xe.node_params);we.start||(we.start=[]),Xe.node_params=JSON.stringify(we)}let lt=JSON.parse(Xe.node_info_json);Xe.node_type!=0&&(lt.type=h[Xe.node_type],lt.id=Xe.node_key||os(lt.type),lt.x=lt.x||0,lt.y=lt.y||0),Xe.node_type==-1&&(Xe.node_params=lt.dataRaw),lt.nodeSortKey?Xe.nodeSortKey=lt.nodeSortKey:Xe.nodeSortKey=lt.id.substring(0,8)+lt.id.substring(lt.id.length-8),Xe.dataRaw=lt.dataRaw||Xe.node_params,delete Xe.node_info_json,lt.loop_parent_key=Xe.loop_parent_key,lt.properties=Xe,lt.properties.width=lt.width,lt.properties.height=lt.height,it.push(lt)}}),Ze({nodes:it,edges:ct})}const xe=Ne=>{i.value.open(Ne,!0)},Ze=Ne=>{o.value.setData(Ne)},We=()=>{let Ne=o.value.getData(),it=[],ct={};return Ne.edges.forEach(Xe=>{let et={node_key:Xe.id,node_name:"edge",node_type:0},lt={...Xe};et.node_info_json=lt,it.push(et),Xe.sourceAnchorId&&(ct[Xe.sourceAnchorId]=Xe.targetNodeId),Xe.targetAnchorId&&(ct[Xe.targetAnchorId]=Xe.sourceNodeId)}),Ne.nodes.forEach(Xe=>{let et={...Xe.properties,node_type:+Xe.properties.node_type,node_key:Xe.id};et.node_info_json={type:Xe.type,x:Xe.x,y:Xe.y,width:Xe.properties.width,height:Xe.properties.height,id:Xe.id,nodeSortKey:et.nodeSortKey,dataRaw:Xe.properties.node_params},et.next_node_key=ct[et.nodeSortKey+"-anchor_right"]||"",et.prev_node_key=ct[et.nodeSortKey+"-anchor_left"]||"";let lt=JSON.parse(et.node_params);if(et.node_type==2&&lt.term&&lt.term.length>0&&lt.term.forEach((we,Je)=>{let ft=et.nodeSortKey+"-anchor_"+Je;we.next_node_key=ct[ft]||""}),et.node_type==3&&lt.cate&&lt.cate.categorys&&lt.cate.categorys.length>0&&lt.cate.categorys.forEach((we,Je)=>{let ft=et.nodeSortKey+"-anchor_"+Je;we.next_node_key=ct[ft]||""}),et.node_type==17){let we=ct[et.nodeSortKey+"-anchor_right_exception"];we&&(lt.code_run.exception=we)}et.node_params=lt,delete et.dataRaw,it.push(et)}),it},St=async Ne=>{if(y.value){Ne==="handle"&&Cn.warning("当前已有其他用户在编辑中，无法保存");return}if(!v.value||!x.value&&Ne==="automatic")return;let it=We();if(Ne==="handle"){const ct=+a.robotInfo.draft_save_time||0,Xe={robot_key:r.value,data_type:1,node_list:JSON.stringify(it),draft_save_type:"handle",draft_save_time:ct,re_cover_save:0},et=await A(Xe,!1);et.saved?Cn.success("保存成功"):et.behind;return}try{await Ko({robot_key:r.value,data_type:1,node_list:JSON.stringify(it),draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0}),await a.getRobot(t.id);const ct=+a.robotInfo.draft_save_time||Qa().unix();a.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:ct})}catch{}};let pt=null,Ht=!1,Qt=!1,te=0;async function A(Ne,it){var ct,Xe;try{const et=await Ko(Ne);if(!(((ct=et==null?void 0:et.data)==null?void 0:ct.behind_draft)==1||(et==null?void 0:et.behind_draft)==1)){await a.getRobot(t.id);const we=+a.robotInfo.draft_save_time||Qa().unix();return a.setDrafSaveTime({draft_save_type:it?"automatic":"handle",draft_save_time:we}),{saved:!0,behind:!1}}if(it){const we=Date.now();if(Ht||Qt&&we-te<w1)return x.value=!1,Z(),{saved:!1,behind:!0};Ht=!0,Qt=!0,te=we}return await new Promise(we=>{yr.confirm({title:"提示",icon:null,content:S1,okText:"确 定",cancelText:"取 消",async onOk(){var Ct;const Je={...Ne,re_cover_save:1},ft=await Ko(Je);if(ft&&ft.res==0||!((Ct=ft==null?void 0:ft.data)!=null&&Ct.behind_draft)){await a.getRobot(t.id);const Ft=+a.robotInfo.draft_save_time||Qa().unix();a.setDrafSaveTime({draft_save_type:it?"automatic":"handle",draft_save_time:Ft})}it&&(x.value=!0,Z(),Ht=!1,Qt=!1,te=Date.now()),we({saved:!0,behind:!0})},onCancel(){it&&(x.value=!1,Z(),Ht=!1,te=Date.now()),we({saved:!1,behind:!0})}})})}catch(et){if(!(((Xe=et==null?void 0:et.data)==null?void 0:Xe.behind_draft)==1||(et==null?void 0:et.behind_draft)==1))return{saved:!1,behind:!1};if(it){const we=Date.now();if(Ht||Qt&&we-te<w1)return x.value=!1,Z(),{saved:!1,behind:!0};Ht=!0,Qt=!0,te=we}return await new Promise(we=>{yr.confirm({title:"提示",icon:null,content:S1,okText:"确 定",cancelText:"取 消",async onOk(){var Ct;const Je={...Ne,re_cover_save:1},ft=await Ko(Je);if(ft&&ft.res==0||!((Ct=ft==null?void 0:ft.data)!=null&&Ct.behind_draft)){await a.getRobot(t.id);const Ft=+a.robotInfo.draft_save_time||Qa().unix();a.setDrafSaveTime({draft_save_type:it?"automatic":"handle",draft_save_time:Ft})}it&&(x.value=!0,Z(),Ht=!1,Qt=!1,te=Date.now()),we({saved:!0,behind:!0})},onCancel(){it&&(x.value=!1,Z(),Ht=!1,te=Date.now()),we({saved:!1,behind:!0})}})})}}async function F(){if(y.value||!v.value||!x.value)return;const Ne=We(),it=+a.robotInfo.draft_save_time||0,ct={robot_key:r.value,data_type:1,node_list:JSON.stringify(Ne),draft_save_type:"automatic",draft_save_time:it,re_cover_save:0};await A(ct,!0)}function Z(){pt&&clearInterval(pt),pt=null,I.value=pe(),v.value&&x.value&&!y.value&&pe()&&(pt=setInterval(()=>{F()},1*60*1e3))}N1(()=>{pt&&clearInterval(pt),ne(),ue(),Re(),De(),q()});const J=ke(null),se=ke(!1),oe=Ne=>{J.value.show(Ne)},ge=async()=>{if(y.value){Cn.warning("当前已有其他用户在编辑中，无法发布");return}let Ne=We(),it=[];for(let ct=0;ct<Ne.length;ct++){let Xe=Ne[ct];Xe.node_type==0||Xe.node_type==-1||Xe.loop_parent_key||(Xe.node_type==1?Xe.next_node_key==""&&it.push(Xe):Xe.node_type==7||Xe.node_type==3?Xe.prev_node_key==""&&it.push(Xe):(Xe.next_node_key==""||Xe.prev_node_key=="")&&it.push(Xe))}if(it.length>0){Cn.error("存在未关联的节点，请先关联");return}try{await Ko({robot_key:r.value,data_type:1,node_list:JSON.stringify(Ne),draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0}),await a.getRobot(t.id),a.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0}),oe(JSON.stringify(Ne))}catch{se.value=!1}};let Te=ke(null);const Le=Ne=>{Te.value=Ne,Ne.properties.node_sub_type!=51&&K()},Ue=()=>{K()},tt=async()=>{let Ne=(it,ct,Xe)=>{const et=new Set(it.map(lt=>lt.model_define));return ct.filter(lt=>{let we=lt[Xe];et.has(we)&&it.filter(Je=>{if(Je.model_define==we)return Je.children=x2(Je.children,lt.children),!1})}),it};return U1({model_type:"LLM"}).then(it=>{let ct=it.data||[],Xe=[],et=[];et=ct.map(lt=>{Xe=[];for(let we=0;we<lt.model_info.llm_model_list.length;we++){const Je=lt.model_info.llm_model_list[we];Xe.push({name:Je,deployment_name:lt.model_config.deployment_name,id:lt.model_config.id,model_define:lt.model_info.model_define})}return{id:lt.model_config.id,name:lt.model_info.model_name,model_define:lt.model_info.model_define,icon:lt.model_info.model_icon_url,children:Xe,deployment_name:lt.model_config.deployment_name}}),et=Ne(b2(et,"model_define"),et,"model_define"),a.setModelList(et)})},vt=ke({diy_global:[],sys_global:[]}),bt=()=>{let it=We().filter(ct=>ct.node_type==1);it.length>0&&(vt.value=it[0].node_params.start)},Lt=ke(null),Qe=()=>{x.value=!1,Z(),Lt.value.showDrawer()},ht=Ne=>{if(y.value){Cn.warning("当前已有其他用户在编辑中，无法恢复");return}const it=We();Ko({robot_key:r.value,data_type:1,node_list:JSON.stringify(it),draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0}).then(()=>{a.getRobot(t.id).then(()=>{a.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0})}),l.value="",u.value=null,be(Ne),Cn.success("已保存当前草稿并恢复版本"),v.value=!0,x.value=!0,Z()})},Rt=async(Ne,it)=>{if(!y.value){const ct=We();try{await Ko({robot_key:r.value,data_type:1,node_list:JSON.stringify(ct),draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0}),await a.getRobot(t.id),a.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0})}catch{}}u.value=it,clearInterval(pt),be(Ne)},st=()=>{d.value.openRunTest()};Yt(async()=>{V(),await tt();const Ne=await E1({robot_key:r.value,data_type:1});be(Ne.data),await fe(),y.value?(v.value=!1,x.value=!1,Cn.warning("其他人在编辑，已切换为查看模式")):await he()?(v.value=!0,x.value=!0):(v.value=!1,x.value=!1),ve(),Z();let it=H();Jt(()=>e.query.robot_key,ct=>{!ct||ct===r.value||(de(it),q(),r.value=ct,it=H(),V(),ve(),Z())}),ie(),ce(),e.query.show_tips&&Cn.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)});const cn=async()=>{if(y.value){Cn.warning("当前已有其他用户在编辑中，无法编辑");return}await he()&&(v.value=!0,x.value=!0,E=Ie(),b=Date.now(),ce(),Z(),Cn.success("已进入编辑模式"),xe(1))};return(Ne,it)=>(G(),ae("div",wK,[B(ZY,{ref_key:"pageHeaderRef",ref:d,onEdit:cn,onSave:St,onRelease:ge,onGetGlobal:bt,onGetVersionRecord:Qe,currentVersion:u.value,start_node_params:vt.value,saveLoading:se.value,isEditing:v.value,isLockedByOther:y.value,lockRemoteAddr:k.value,lockUserAgent:O.value,loginUserName:N.value,autoSaveEnabled:x.value,isLeader:I.value},null,8,["currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),S("div",SK,[S("div",EK,[B(lA)]),S("div",CK,[B(pY,{ref_key:"workflowCanvasRef",ref:o,onSelectedNode:Le,onOnDeleteNode:Ue,onRunTest:st},null,512)])]),B(tA,{ref_key:"addRobotAlertRef",ref:i},null,512),B(aK,{ref_key:"versionModelRef",ref:J},null,512),B(xK,{ref_key:"publishDetailRef",ref:Lt,onPreview:Rt,onSetVersion:ht,isLockedByOther:y.value},null,8,["isLockedByOther"])]))}},WJ=_t(MK,[["__scopeId","data-v-1303194b"]]);export{WJ as default};
