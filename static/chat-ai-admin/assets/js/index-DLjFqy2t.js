import{b as te,f as We,A as Re,B as be,C as et,r as tt,E as at,F as Ue,d as st,G as nt,H as lt,I as ot,J as it,K as dt,L as rt,M as _t}from"../../index-0SFcfYGN.js";import{f as p,Y as w,_ as r,F as Z,a9 as re,ad as Te,a7 as S,u as E,w as $e,k as e,a2 as t,a1 as J,a5 as l,r as W,a4 as se,G as $,ae as A,J as Ve,B as me,y as _e,o as ct}from"./vue-chunks-BSjLwu6d.js";import{_ as ut}from"./cu-scroll-BiKEilFP.js";import{g as Pe}from"./index-B4oOBcCh.js";import{g as Me}from"./index-O362J1Hf.js";import{v as je}from"./validate-8MtiUsxW.js";import{F as oe,$ as pt,z as ve,o as mt,M as ee,a as q,e as fe,I as Ce,u as Ie,v as Ne,a0 as Oe,f as Ee,q as De,R as Ae,a1 as vt,d as ie,y as he,w as Le,a2 as Fe,a3 as Ke,B as ge,H as ce,a4 as Be,p as ze,D as Je,a5 as ft,b as Ye,c as qe,a6 as ht,a7 as gt,N as yt,a8 as kt,g as xt,U as wt,h as xe,a9 as bt,aa as $t,E as Se,ac as Ct,X as Ot,Q as Dt,ad as Lt,ae as Bt,af as St,ag as Rt}from"./ui-antd-BIopZvX3.js";import{d as we}from"./role_avatar-DL0r08JY.js";import{g as ye,a as He,b as Ut,s as Tt,d as Vt,c as Pt,e as Mt,f as jt,h as It}from"./index-ZbEy8F41.js";import"./utils-BMKRjDTh.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const Nt={class:"page-tabs"},Et=["onClick"],At={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(H,{emit:C}){const{t:N}=We(),g=C,L=H,u=p([{value:1,title:N("views.user.model.teamMembers"),langKey:"views.user.model.teamMembers"}]),_=a=>{g("update:value",a),g("change",a)};return(a,M)=>(r(),w("div",Nt,[(r(!0),w(Z,null,re(u.value,O=>(r(),w("div",{class:Te(["tab-item",{active:L.value==O.value}]),onClick:D=>_(O.value),key:O.value},S(E(N)(O.langKey)),11,Et))),128))]))}},Ft=te(At,[["__scopeId","data-v-85a6ddaa"]]),Kt={class:"avatar-uploader"},zt=["src"],Jt={key:1},Yt=["src"],qt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(H,{emit:C}){function N(i){return new Promise((n,v)=>{const P=new FileReader;P.readAsDataURL(i),P.onload=()=>n(P.result),P.onerror=F=>v(F)})}const g=C,L=H,u=p([]),_=p(!1),a=p("");$e(()=>L.value,i=>{a.value=i},{immediate:!0});const M=oe.useInjectFormItemContext(),O=()=>{let i={imageUrl:a.value,file:u.value[0].originFileObj};g("change",i),g("update:value",i.imageUrl),M.onFieldChange()},D=i=>i.type==="image/jpeg"||i.type==="image/png"?i.size/1024<1024?(u.value=[i],N(i).then(P=>{a.value=P,_.value=!1,O()}),!1):(q.error("成员头像图片大小不能超过1M"),!1):(q.error("机器人头像只支持JPG、PNG格式的图片"),!1),R=p(!1),b=p(""),U=p(""),I=()=>{R.value=!1,U.value=""},m=async i=>{!i.url&&!i.preview&&(i.preview=await N(i.originFileObj)),b.value=i.url||i.preview,R.value=!0,U.value=i.name||i.url.substring(i.url.lastIndexOf("/")+1)};return(i,n)=>{const v=mt,P=ee;return r(),w("div",Kt,[e(v,{"file-list":u.value,"onUpdate:fileList":n[0]||(n[0]=F=>u.value=F),"list-type":"picture-card","show-upload-list":!1,"before-upload":D,accept:".jpg,.png,.jpeg",onPreview:m},{default:t(()=>[a.value?(r(),w("img",{key:0,class:"avatar",src:a.value,alt:"avatar"},null,8,zt)):(r(),w("div",Jt,[_.value?(r(),J(E(pt),{key:0})):(r(),J(E(ve),{key:1})),n[1]||(n[1]=l("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list"]),e(P,{open:R.value,title:U.value,footer:null,onCancel:I},{default:t(()=>[l("img",{alt:"example",style:{width:"100%"},src:b.value},null,8,Yt)]),_:1},8,["open","title"])])}}},Ht=te(qt,[["__scopeId","data-v-1945844c"]]),Qt={class:"form-box"},Gt={class:"avatar-box"},Xt={class:"flex-item-box"},Zt={class:"flex-item-box"},Wt={class:"flex-item-box"},ea={class:"flex-item-box"},ta={key:0,style:{"margin-top":"4px"}},aa={__name:"add-team-members",emits:["ok"],setup(H,{expose:C,emit:N}){const g=N,L=oe.useForm,u=p(!1),_=p("添加团队成员"),a=W({user_name:"",nick_name:"",avatar:"",avatar_url:"",user_roles:"3",password:"",check_password:"",department_ids:[],expire_time_type:0,expire_time:"",id:""}),M=p([]),O=()=>{ye({}).then(f=>{let h=f.data||[];M.value=be(h)})},D=f=>{a.avatar=f.file},R=p([]);Re({page:1,size:200,search:""}).then(f=>{let h=f.data.list||[];R.value=h.filter(Y=>Y.id!="1"&&Y.role_type!=1)});const b=W({user_name:[{message:"请输入登录账号",required:!0},{validator:async(f,h)=>!/^[a-zA-Z0-9_.-]+$/.test(h)&&h?Promise.reject("账号只能为字母、数字、“-”、“_”,“.”的组合"):Promise.resolve()}],nick_name:[{message:"请输入昵称",required:!0}],avatar_url:[{message:"请上传头像",required:!0}],user_roles:[{message:"请选择成员角色",required:!0}],password:[{message:"请输入登录密码",required:!0},{validator:async(f,h)=>!je(h)&&h?Promise.reject("密码必须包含字母、数字或者字符中的两种，6-32位"):Promise.resolve()}],check_password:[{message:"请输入确认密码",required:!0},{validator:async(f,h)=>h!=a.password&&h?Promise.reject("两次输入的密码不一致"):Promise.resolve()}],expire_time:[{validator:async(f,h)=>a.expire_time_type==1&&!h?Promise.reject("请选择指定日期"):Promise.resolve()}],department_ids:[{message:"请选择部门",required:!0}]}),{resetFields:U,validate:I,validateInfos:m}=L(a,b),i=f=>{_.value="添加团队成员",u.value=!0,U(),a.user_name="",a.nick_name="",a.avatar="",a.avatar_url=we,a.user_roles="3",a.password="",a.check_password="",a.expire_time_type=0,a.expire_time="",a.department_ids=f?[f]:[],a.id="",O()},n=f=>{_.value="编辑团队成员",a.user_name=f.user_name,a.nick_name=f.nick_name,a.avatar_url=f.avatar||we,a.avatar="",a.user_roles=f.user_roles,a.password="",a.check_password="",a.id=f.id,f.expire_time>0?(a.expire_time_type=1,a.expire_time=ie(f.expire_time*1e3)):(a.expire_time_type=0,a.expire_time=""),a.department_ids=f.departments.map(h=>+h.id),delete b.password,delete b.check_password,u.value=!0,O()},v=p(!1),P=()=>{I().then(()=>{let f={...Ve(a)};f.expire_time_type==1?f.expire_time=ie(f.expire_time).unix():f.expire_time=0,f.department_ids=a.department_ids.join(","),delete f.avatar_url,v.value=!0,et(f).then(h=>{q.success(`${_.value}成功`),u.value=!1,g("ok")}).finally(()=>{v.value=!1})})},F=f=>f&&f<ie().startOf("day");return C({add:i,edit:n}),(f,h)=>{const Y=Ce,V=fe,y=Ne,o=Ie,s=Oe,c=Ee,k=Ae,B=De,K=vt,Q=oe,ne=ee;return r(),w("div",null,[e(ne,{open:u.value,"onUpdate:open":h[9]||(h[9]=d=>u.value=d),title:_.value,onOk:P,width:"746px"},{default:t(()=>[l("div",Qt,[l("div",Gt,[e(Ht,{value:a.avatar_url,"onUpdate:value":h[0]||(h[0]=d=>a.avatar_url=d),onChange:D},null,8,["value"]),h[10]||(h[10]=l("div",{class:"tip"},"点击替换，建议尺寸为100*100px，大小不超过100kb",-1))]),e(Q,{layout:"vertical",autocomplete:"off"},{default:t(()=>[l("div",Xt,[e(V,se({label:"成员昵称"},E(m).nick_name),{default:t(()=>[e(Y,{maxlength:100,type:"text",placeholder:"请输入昵称",value:a.nick_name,"onUpdate:value":h[1]||(h[1]=d=>a.nick_name=d)},null,8,["value"])]),_:1},16),e(V,se({label:"登录账号"},E(m).user_name),{default:t(()=>[e(Y,{disabled:a.id!="",type:"text",placeholder:"账号只能为字母、数字、“-”、“_”,“.”的组合",value:a.user_name,"onUpdate:value":h[2]||(h[2]=d=>a.user_name=d)},null,8,["disabled","value"])]),_:1},16)]),l("div",Zt,[e(V,se({label:"成员角色"},E(m).user_roles),{default:t(()=>[e(o,{value:a.user_roles,"onUpdate:value":h[3]||(h[3]=d=>a.user_roles=d),style:{width:"100%"},placeholder:"请选择成员角色"},{default:t(()=>[(r(!0),w(Z,null,re(R.value,d=>(r(),J(y,{key:d.id,value:d.id},{default:t(()=>[$(S(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16),e(V,se({label:"选择部门"},E(m).department_ids,{name:"department_ids"}),{default:t(()=>[e(s,{value:a.department_ids,"onUpdate:value":h[4]||(h[4]=d=>a.department_ids=d),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择","allow-clear":"",multiple:"","tree-default-expand-all":"","tree-data":M.value,"tree-node-filter-prop":"label"},{title:t(({value:d,label:X})=>[l("div",null,S(X),1)]),_:1},8,["value","tree-data"])]),_:1},16)]),l("div",Wt,[a.id?A("",!0):(r(),J(V,se({key:0,label:"登录密码"},E(m).password),{default:t(()=>[e(c,{value:a.password,"onUpdate:value":h[5]||(h[5]=d=>a.password=d),placeholder:"密码必须包含字母、数字或者字符中的两种，6-32位"},null,8,["value"])]),_:1},16)),a.id?A("",!0):(r(),J(V,se({key:1,label:"确认密码"},E(m).check_password),{default:t(()=>[e(c,{value:a.check_password,"onUpdate:value":h[6]||(h[6]=d=>a.check_password=d),placeholder:"请重新输入密码"},null,8,["value"])]),_:1},16))]),l("div",ea,[e(V,se({label:"过期时间"},E(m).expire_time,{required:""}),{default:t(()=>[e(B,{value:a.expire_time_type,"onUpdate:value":h[7]||(h[7]=d=>a.expire_time_type=d)},{default:t(()=>[e(k,{value:0},{default:t(()=>h[11]||(h[11]=[$("永久有效")])),_:1,__:[11]}),e(k,{value:1},{default:t(()=>h[12]||(h[12]=[$("指定时间")])),_:1,__:[12]})]),_:1},8,["value"]),a.expire_time_type==1?(r(),w("div",ta,[e(K,{showNow:!1,format:"YYYY-MM-DD HH:mm","disabled-date":F,value:a.expire_time,"onUpdate:value":h[8]||(h[8]=d=>a.expire_time=d),"show-time":{defaultValue:E(ie)("00:00","HH:mm")}},null,8,["value","show-time"])])):A("",!0)]),_:1},16)])]),_:1})])]),_:1},8,["open","title"])])}}},sa=te(aa,[["__scopeId","data-v-04881526"]]),na={class:"form-box"},la={__name:"reset-password",emits:["ok"],setup(H,{expose:C,emit:N}){const g=N,L=oe.useForm,u=p(!1),_=p("重置登录密码"),a=W({password:"",check_password:"",id:""}),M=W({password:[{message:"请输入登录密码",required:!0},{validator:async(I,m)=>!je(m)&&m?Promise.reject("密码必须包含字母、数字或者字符中的两种，6-32位"):Promise.resolve()}],check_password:[{message:"请输入确认密码",required:!0},{validator:async(I,m)=>m!=a.password&&m?Promise.reject("两次输入的密码不一致"):Promise.resolve()}]}),{resetFields:O,validate:D,validateInfos:R}=L(a,M),b=I=>{I.id,u.value=!0,O(),a.password="",a.check_password="",a.id=I.id},U=()=>{D().then(()=>{tt({...Ve(a)}).then(I=>{q.success("修改成功"),u.value=!1,g("ok")})})};return C({open:b}),(I,m)=>{const i=Ee,n=fe,v=oe,P=ee;return r(),w("div",null,[e(P,{open:u.value,"onUpdate:open":m[2]||(m[2]=F=>u.value=F),title:_.value,onOk:U,width:"476px"},{default:t(()=>[l("div",na,[e(v,{layout:"vertical"},{default:t(()=>[e(n,se({label:"登录密码"},E(R).password),{default:t(()=>[e(i,{value:a.password,"onUpdate:value":m[0]||(m[0]=F=>a.password=F),placeholder:"密码必须包含字母、数字或者字符中的两种，6-32位"},null,8,["value"])]),_:1},16),e(n,se({label:"确认密码"},E(R).check_password),{default:t(()=>[e(i,{value:a.check_password,"onUpdate:value":m[1]||(m[1]=F=>a.check_password=F),placeholder:"请重新输入密码"},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open","title"])])}}},oa=te(la,[["__scopeId","data-v-8c704fed"]]),ia={key:0,class:"form-wrapper"},da={class:"select"},ra={class:"tools-wrapper"},_a=["src"],ca={class:"item-name"},ua={key:1,class:"form-wrapper"},pa={class:"main-tabs-box"},ma={class:"select"},va={class:"tools-wrapper"},fa={class:"item-name"},ha={class:"tools-wrapper"},ga={class:"item-name"},ya={key:2,class:"form-wrapper"},ka={class:"select"},xa={class:"tools-wrapper"},wa={class:"item-name"},ba={__name:"see-model-alert",props:{robotList:{type:Array,default:()=>[]},libraryList:{type:Array,default:()=>[]},formList:{type:Array,default:()=>[]}},emits:["save","ok"],setup(H,{expose:C,emit:N}){const g=N,L=H,u=p([]),_=p(""),a=p(!1),M=p([]),O=p([]),D=o=>{const s=[];return o.map(c=>{s.push(c.id)}),s},R=o=>{u.value=o},b=p(1),U=[{value:2,payload:{title:"部门知识库"}},{value:1,payload:{title:"成员知识库"}}],I=p(U);let m=null;const i=p(1),n=p(1),v=p(),P=async(o,s,c)=>{u.value=[],i.value=o,n.value=1,b.value=1,m=JSON.parse(JSON.stringify(c)),v.value=m.id,c=JSON.parse(JSON.stringify(c)),I.value=U,c.managed_robot_list=c.managed_robot_list||[],c.managed_library_list=c.managed_library_list||[],c.managed_form_list=c.managed_form_list||[];let k=[];o==1?(_.value="添加成员管理的机器人",k=L.robotList,k.forEach(B=>{let K=c.managed_robot_list.filter(Q=>Q.id==B.id);K.length?B.operate_rights=K[0].operate_rights:B.operate_rights="4"}),s&&s=="edit"&&(_.value="编辑成员管理的机器人",u.value=D(c.managed_robot_list))):o==2?(_.value="添加成员管理的知识库",k=L.libraryList,k.forEach(B=>{let K=c.managed_library_list.filter(Q=>Q.id==B.id);K.length?B.operate_rights=K[0].operate_rights:B.operate_rights="4"}),s&&s=="edit"&&(_.value="编辑成员管理的知识库",u.value=D(c.managed_library_list))):o==3&&(_.value="添加成员管理的数据库",k=L.formList,k.forEach(B=>{let K=c.managed_form_list.filter(Q=>Q.id==B.id);K.length?B.operate_rights=K[0].operate_rights:B.operate_rights="4"}),s&&s=="edit"&&(_.value="编辑成员管理的数据库",u.value=D(c.managed_form_list))),M.value=k,a.value=!0},F=()=>{He({object_type:i.value,identity_type:n.value,identity_id:v.value,tab:n.value}).then(o=>{O.value=o.data||[]})},f=()=>{b.value==2&&F()},h=(o,s)=>{u.value=[],n.value=1,b.value=1,i.value=o,v.value=s;let c=[];o==1?(_.value="批量修改成员管理的机器人",c=L.robotList):o==2?(_.value="批量修改成员管理的知识库",c=L.libraryList):o==3&&(_.value="批量修改成员管理的数据库",c=L.formList),c.forEach(k=>{k.operate_rights="4"}),M.value=c,a.value=!0},Y=(o,s,c)=>{u.value=[],s.is_user?n.value=1:n.value=2,v.value=s.id,I.value=[{value:2,payload:{title:n.value==1?"部门知识库":"上级知识库"}},{value:1,payload:{title:n.value==1?"成员知识库":"部门知识库"}}],b.value=1,i.value=o;let k=[];o==1?(_.value=`添加${n==1?"成员":"部门"}管理的机器人`,k=L.robotList):o==2?(_.value=`添加${n==1?"成员":"部门"}管理的知识库`,k=L.libraryList):o==3&&(_.value=`添加${n==1?"成员":"部门"}管理的数据库`,k=L.formList),k.forEach(B=>{let K=c.filter(Q=>Q.object_id==B.id);K.length?B.operate_rights=K[0].operate_rights:B.operate_rights="4"}),u.value=c.map(B=>B.object_id),M.value=k,a.value=!0},V=()=>{let o={identity_ids:v.value,identity_type:n.value,object_type:i.value},s=[];M.value.forEach(c=>{u.value.includes(c.id)&&s.push({object_id:+c.id,object_type:+i.value,operate_rights:+c.operate_rights})}),o.object_array=JSON.stringify(s),Ut(o).then(c=>{a.value=!1,q.success("保存成功"),g("ok")})},y=()=>{};return C({open:P,handleBatchOpen:h,handleDepartmentOpen:Y}),(o,s)=>{const c=Le,k=Ae,B=De,K=he,Q=Fe,ne=ee;return r(),J(ne,{class:"add-model-alert",width:"800px",open:a.value,"onUpdate:open":s[1]||(s[1]=d=>a.value=d),title:_.value,onOk:V,onCancel:y},{default:t(()=>[i.value==1?(r(),w("div",ia,[l("div",da,"已选择("+S(u.value.length)+")",1),e(K,{"data-source":M.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:u.value,onChange:R}},{default:t(()=>[e(c,{title:"机器人","data-index":"robot_name",width:350},{default:t(({record:d})=>[l("div",ra,[l("img",{class:"model-logo",src:d.robot_avatar,alt:""},null,8,_a),l("div",ca,S(d.robot_name),1)])]),_:1}),e(c,{title:"权限","data-index":"operate_rights",width:350},{default:t(({record:d})=>[e(B,{value:d.operate_rights,"onUpdate:value":X=>d.operate_rights=X},{default:t(()=>[e(k,{value:"4"},{default:t(()=>s[2]||(s[2]=[$("管理")])),_:1,__:[2]}),e(k,{value:"2"},{default:t(()=>s[3]||(s[3]=[$("编辑")])),_:1,__:[3]}),e(k,{value:"1"},{default:t(()=>s[4]||(s[4]=[$("查看")])),_:1,__:[4]})]),_:2},1032,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source","row-selection"])])):i.value==2?(r(),w("div",ua,[l("div",pa,[e(Q,{value:b.value,"onUpdate:value":s[0]||(s[0]=d=>b.value=d),options:I.value,onChange:f},{label:t(({payload:d})=>[$(S(d.title),1)]),_:1},8,["value","options"])]),b.value==1?(r(),w(Z,{key:0},[l("div",ma,"已选择("+S(u.value.length)+")",1),e(K,{"data-source":M.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:u.value,onChange:R}},{default:t(()=>[e(c,{title:"知识库","data-index":"library_name",width:350},{default:t(({record:d})=>[l("div",va,[l("div",fa,S(d.library_name),1)])]),_:1}),e(c,{title:"权限","data-index":"operate_rights",width:350},{default:t(({record:d})=>[e(B,{value:d.operate_rights,"onUpdate:value":X=>d.operate_rights=X},{default:t(()=>[e(k,{value:"4"},{default:t(()=>s[5]||(s[5]=[$("管理")])),_:1,__:[5]}),e(k,{value:"2"},{default:t(()=>s[6]||(s[6]=[$("编辑")])),_:1,__:[6]}),e(k,{value:"1"},{default:t(()=>s[7]||(s[7]=[$("查看")])),_:1,__:[7]})]),_:2},1032,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source","row-selection"])],64)):(r(),J(K,{key:1,"data-source":O.value,pagination:!1,scroll:{y:500},"row-key":"id"},{default:t(()=>[e(c,{title:"知识库","data-index":"name",width:350},{default:t(({record:d})=>[l("div",ha,[l("div",ga,S(d.name),1)])]),_:1}),e(c,{title:"权限","data-index":"operate_rights",width:350},{default:t(({record:d})=>[e(B,{value:d.operate_rights,"onUpdate:value":X=>d.operate_rights=X,disabled:""},{default:t(()=>[e(k,{value:"4"},{default:t(()=>s[8]||(s[8]=[$("管理")])),_:1,__:[8]}),e(k,{value:"2"},{default:t(()=>s[9]||(s[9]=[$("编辑")])),_:1,__:[9]}),e(k,{value:"1"},{default:t(()=>s[10]||(s[10]=[$("查看")])),_:1,__:[10]})]),_:2},1032,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source"]))])):i.value==3?(r(),w("div",ya,[l("div",ka,"已选择("+S(u.value.length)+")",1),e(K,{"data-source":M.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:u.value,onChange:R}},{default:t(()=>[e(c,{title:"数据库","data-index":"name",width:350},{default:t(({record:d})=>[l("div",xa,[l("div",wa,S(d.name),1)])]),_:1}),e(c,{title:"权限","data-index":"operate_rights",width:350},{default:t(({record:d})=>[e(B,{value:d.operate_rights,"onUpdate:value":X=>d.operate_rights=X},{default:t(()=>[e(k,{value:"4"},{default:t(()=>s[11]||(s[11]=[$("管理")])),_:1,__:[11]}),e(k,{value:"2"},{default:t(()=>s[12]||(s[12]=[$("编辑")])),_:1,__:[12]}),e(k,{value:"1"},{default:t(()=>s[13]||(s[13]=[$("查看")])),_:1,__:[13]})]),_:2},1032,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source","row-selection"])])):A("",!0)]),_:1},8,["open","title"])}}},Qe=te(ba,[["__scopeId","data-v-e46dd298"]]),$a={class:"form-box"},Ca={class:"form-item"},Oa={class:"form-content"},Da={key:0,class:"form-item"},La={class:"form-content"},Ba={__name:"add-department",emits:["ok"],setup(H,{expose:C,emit:N}){const g=p(!1),L=N,u=W({department_name:"",id:"",pid:""}),_=p(""),a=b=>{u.id="",u.pid=b.id>0?b.id||"":void 0,u.department_name="",_.value="添加部门",g.value=!0,D()},M=b=>{u.id=b.id||"",u.pid=b.pid||"",u.department_name=b.title||"",_.value="重命名",g.value=!0},O=p([]),D=()=>{ye({}).then(b=>{let U=b.data||[];O.value=be(U)})},R=()=>{if(!u.department_name)return q.error("请输入部门名称");if(!u.id&&!u.pid)return q.error("请选择所属部门");Tt({...u}).then(b=>{q.success("修改成功"),g.value=!1,L("ok")})};return C({show:a,rename:M}),(b,U)=>{const I=Ce,m=Oe,i=ee;return r(),w("div",null,[e(i,{open:g.value,"onUpdate:open":U[2]||(U[2]=n=>g.value=n),title:_.value,onOk:R,width:472},{default:t(()=>[l("div",$a,[l("div",Ca,[U[3]||(U[3]=l("div",{class:"form-label"},"部门名称",-1)),l("div",Oa,[e(I,{maxLength:10,value:u.department_name,"onUpdate:value":U[0]||(U[0]=n=>u.department_name=n),placeholder:"请输入部门名称"},null,8,["value"])])]),u.id?A("",!0):(r(),w("div",Da,[U[4]||(U[4]=l("div",{class:"form-label"},"所属部门",-1)),l("div",La,[e(m,{value:u.pid,"onUpdate:value":U[1]||(U[1]=n=>u.pid=n),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择","allow-clear":"","tree-default-expand-all":"","tree-data":O.value,"tree-node-filter-prop":"label"},{title:t(({value:n,label:v})=>[l("div",null,S(v),1)]),_:1},8,["value","tree-data"])])]))])]),_:1},8,["open","title"])])}}},Sa=te(Ba,[["__scopeId","data-v-29565254"]]),Ra={class:"del-box"},Ua={class:"icon-box"},Ta={class:"footer-btn"},Va={class:"set-box"},Pa={class:"set-item"},Ma={__name:"del-department",emits:["ok"],setup(H,{expose:C,emit:N}){const g=p(!1),L=p(!1),u=N,_=W({id:"",new_department_id:void 0});let a=[];const M=m=>{if(a=[],a=O(m),_.new_department_id=void 0,_.id=m.id,m.children.length==0){ee.confirm({title:"提示",icon:e(ce),content:"确定删除该部门",onOk(){b()}});return}g.value=!0,I()};function O(m){let i=[m.id];if(m.children&&m.children.length>0)for(const n of m.children)i=i.concat(O(n));return i}const D=()=>{L.value=!0},R=()=>{_.new_department_id="",b()},b=()=>{Vt({..._}).then(m=>{L.value=!1,g.value=!1,q.success("删除成功"),u("ok",_.id)})},U=p([]),I=()=>{Pt().then(m=>{let i=m.data||[];U.value=i.filter(n=>!a.includes(+n.id))})};return C({show:M}),(m,i)=>{const n=ge,v=ee,P=Ne,F=Ie;return r(),w("div",null,[e(v,{open:g.value,"onUpdate:open":i[1]||(i[1]=f=>g.value=f),title:null,footer:null,width:480,closable:!1},{default:t(()=>[l("div",Ra,[l("div",Ua,[e(E(Ke))]),i[7]||(i[7]=l("div",{class:"top-title"},"删除部门",-1)),i[8]||(i[8]=l("div",{class:"content"}," 确认删除部门么？直接删除后，该部门成员归属到默认部门或设置新的部门 ",-1)),l("div",Ta,[e(n,{onClick:i[0]||(i[0]=f=>g.value=!1)},{default:t(()=>i[4]||(i[4]=[$("关闭")])),_:1,__:[4]}),e(n,{danger:"",onClick:R},{default:t(()=>i[5]||(i[5]=[$("直接删除")])),_:1,__:[5]}),e(n,{type:"primary",onClick:D},{default:t(()=>i[6]||(i[6]=[$("删除并设置")])),_:1,__:[6]})])])]),_:1},8,["open"]),e(v,{open:L.value,"onUpdate:open":i[3]||(i[3]=f=>L.value=f),title:"设置部门",width:472,onOk:b},{default:t(()=>[l("div",Va,[i[10]||(i[10]=l("div",{class:"set-desc"},"删除之前请先将之前部门的成员换到其他团队",-1)),l("div",Pa,[i[9]||(i[9]=l("div",{class:"set-label"},"所属部门",-1)),l("div",null,[e(F,{value:_.new_department_id,"onUpdate:value":i[2]||(i[2]=f=>_.new_department_id=f),style:{width:"100%"},placeholder:"请选择"},{default:t(()=>[(r(!0),w(Z,null,re(U.value,f=>(r(),J(P,{key:f.id,value:f.id},{default:t(()=>[$(S(f.department_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),_:1},8,["open"])])}}},ja=te(Ma,[["__scopeId","data-v-5221bb6a"]]),Ia={class:"department-tree-search"},Na={class:"flex-block"},Ea={class:"tree-list-box"},Aa={style:{"margin-right":"4px"}},Fa={class:"action-btn toggle-btn"},Ka={class:"doc-item"},za={key:0,class:"tree-title"},Ja={style:{color:"#f50"}},Ya={style:{color:"#f50"}},qa={key:1,class:"tree-title"},Ha={class:"use-num"},Qa={key:2,class:"doc-action-box"},Ga={__name:"department-tree",emits:["select","save","refresh"],setup(H,{expose:C,emit:N}){const g=N;let L=[];const u=[],_=(o,s)=>{let c;for(let k=0;k<s.length;k++){const B=s[k];B.children&&(B.children.some(K=>K.key===o)?c=B.key:_(o,B.children)&&(c=_(o,B.children)))}return c},a=p([]),M=p([]),O=p(""),D=p(!0),R=p([]);let b="",U={};const I=o=>{a.value=o,D.value=!1};$e(O,o=>{const s=u.map(c=>c.title.indexOf(o)>-1?_(c.key,R.value):null).filter((c,k,B)=>c&&B.indexOf(c)===k);a.value=s,O.value=o,D.value=!0});const m=o=>{for(let s=0;s<o.length;s++){const c=o[s],k=c.key;u.push({key:k,title:c.title}),c.children&&m(c.children)}},i=o=>{ye({}).then(s=>{let c=s.data||[];L=[],L=at(c),m(L),R.value=L,o&&(c.forEach(k=>{k.is_default==1&&(b=k.id,U=k)}),_e(()=>{b&&(M.value=[b],g("select",U))}))})};i(!0);let n={};const v=o=>{M.value[0]==o?_e(()=>{b&&(M.value=[b],g("select",U))}):g("refresh"),i()},P=p(),F=o=>{P.value.show(o)},f=o=>{P.value.rename(o)},h=(o,s)=>{s.node.is_user,s.node.id,s.selected||_e(()=>{M.value=[s.node.id]}),n={...s.node},g("select",n)},Y=p(null),V=o=>{Y.value.show(o)},y=()=>{i(),g("refresh")};return C({getLists:i}),(o,s)=>{const c=Be,k=ze,B=qe,K=Ye,Q=Je,ne=gt;return r(),w(Z,null,[l("div",Ia,[l("div",Na,[e(c,{value:O.value,"onUpdate:value":s[0]||(s[0]=d=>O.value=d),placeholder:"搜索部门",style:{flex:"1"}},null,8,["value"]),l("div",{class:"add-btn-box",onClick:s[1]||(s[1]=d=>F({}))},[e(E(ve))])]),l("div",Ea,[e(ne,{"expanded-keys":a.value,selectedKeys:M.value,"onUpdate:selectedKeys":s[3]||(s[3]=d=>M.value=d),"auto-expand-parent":D.value,onSelect:h,"tree-data":R.value,blockNode:"",onExpand:I},{switcherIcon:t(({switcherCls:d})=>[l("div",Aa,[l("span",Fa,[e(E(ht),{style:{"font-size":"12px"},class:Te(d)},null,8,["class"])])])]),title:t(d=>[l("div",Ka,[d.title.indexOf(O.value)>-1&&O.value?(r(),w("span",za,[d.title.length>3&&d.level>3?(r(),J(k,{key:0},{title:t(()=>[$(S(d.title),1)]),default:t(()=>[$(" "+S(d.title.substring(0,d.title.indexOf(O.value)))+" ",1),l("span",Ja,S(O.value),1),$(" "+S(d.title.substring(d.title.indexOf(O.value)+O.value.length)),1)]),_:2},1024)):(r(),w(Z,{key:1},[$(S(d.title.substring(0,d.title.indexOf(O.value)))+" ",1),l("span",Ya,S(O.value),1),$(" "+S(d.title.substring(d.title.indexOf(O.value)+O.value.length)),1)],64))])):(r(),w("span",qa,[d.title.length>3&&d.level>3?(r(),J(k,{key:0},{title:t(()=>[$(S(d.title),1)]),default:t(()=>[$(" "+S(d.title),1)]),_:2},1024)):(r(),w(Z,{key:1},[$(S(d.title),1)],64))])),l("div",Ha,S(d.children_nums),1),d.is_user?A("",!0):(r(),w("div",Qa,[e(Q,null,{overlay:t(()=>[e(K,null,{default:t(()=>[e(B,{key:"addDoc",onClick:me(X=>F(d),["stop","prevent"])},{default:t(()=>s[4]||(s[4]=[l("span",{class:"menu-name"},"添加子部门",-1)])),_:2,__:[4]},1032,["onClick"]),e(B,{key:"importDoc",onClick:me(X=>f(d),["stop","prevent"])},{default:t(()=>s[5]||(s[5]=[l("span",{class:"menu-name"},"重命名",-1)])),_:2,__:[5]},1032,["onClick"]),d.is_default!=1?(r(),J(B,{key:"del",onClick:me(X=>V(d),["stop","prevent"])},{default:t(()=>s[6]||(s[6]=[l("span",{class:"menu-name",style:{color:"#fb363f"}},"删 除",-1)])),_:2,__:[6]},1032,["onClick"])):A("",!0)]),_:2},1024)]),default:t(()=>[l("span",{class:"action-btn",onClick:s[2]||(s[2]=me(()=>{},["stop"]))},[e(E(ft))])]),_:2},1024)]))])]),_:1},8,["expanded-keys","selectedKeys","auto-expand-parent","tree-data"])])]),e(Sa,{ref_key:"addDepartmentRef",ref:P,onOk:y},null,512),e(ja,{ref_key:"delDepartmentRef",ref:Y,onOk:v},null,512)],64)}}},Xa=te(Ga,[["__scopeId","data-v-3bf8a600"]]),Za={class:"main-content-box"},Wa={style:{"margin-top":"12px"}},es={key:0},ts={key:1},as={key:2},ss={class:"list-content"},ns={key:0},ls={key:1},os={key:2},is={key:0,class:"user-block"},ds={class:"role-menu-box"},rs=["onClick"],_s={class:"menu-header"},cs={key:0,class:"check-box"},us=["onClick"],ps={class:"menu-header"},ms={key:0,class:"check-box"},vs=["onClick"],fs={class:"menu-header"},hs={key:0,class:"check-box"},gs={class:"hover-btn-box"},ys={key:0},ks={key:1},xs={key:2},ws=["onClick"],bs={__name:"knowledge-permissions",props:{treeParmas:{type:Object,default:()=>({})}},setup(H){const C=p("2"),N=p([]),g=H;$e(()=>g.treeParmas,n=>{L()},{deep:!0});const L=()=>{He({object_type:C.value,identity_type:g.treeParmas.is_user?1:2,identity_id:g.treeParmas.id}).then(n=>{let v=n.data||[];N.value=v})};L();const u=()=>{L()},_=(n,v)=>{let P=v==4?"管理":v==2?"编辑":"查看";ee.confirm({title:"提示?",icon:e(ce),content:"确认修改该数据权限为【"+P+"】",okText:"确认",cancelText:"取消",onOk:()=>{let F=[{object_id:+n.object_id,object_type:+n.object_type,operate_rights:+v}];Mt({identity_ids:n.identity_id,identity_type:2,object_array:JSON.stringify(F)}).then(f=>{q.success("修改成功"),L()})},onCancel(){}})},a=n=>{ee.confirm({title:"提示?",icon:e(ce),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{jt({identity_id:n.identity_id,identity_type:2,object_id:n.object_id,object_type:n.object_type}).then(v=>{q.success("删除成功"),L()})},onCancel(){}})},M=p([]),O=p([]),D=p([]),R=async()=>{await Pe().then(n=>{M.value=n.data}).catch(()=>{})},b=async()=>{await Ue({type:""}).then(n=>{O.value=n.data}).catch(()=>{})},U=async()=>{await Me().then(n=>{D.value=n.data}).catch(()=>{})},I=p(null),m=async()=>{if(!g.treeParmas.id)return q.error("请先选择部门");let n=C.value;n==1?await R():n==2?await b():n==3&&await U(),I.value.handleDepartmentOpen(n,g.treeParmas,N.value)},i=p([{dataIndex:"name",key:"name"},{title:"权限",dataIndex:"role",key:"role"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(n,v)=>{const P=yt,F=De,f=ge,h=kt,Y=he;return r(),w(Z,null,[l("div",Za,[e(F,{value:C.value,"onUpdate:value":v[0]||(v[0]=V=>C.value=V),onChange:u},{default:t(()=>[e(P,{value:"2"},{default:t(()=>v[1]||(v[1]=[$("知识库")])),_:1,__:[1]}),e(P,{value:"1"},{default:t(()=>v[2]||(v[2]=[$("机器人")])),_:1,__:[2]}),e(P,{value:"3"},{default:t(()=>v[3]||(v[3]=[$("数据库")])),_:1,__:[3]})]),_:1},8,["value"]),l("div",Wa,[e(f,{type:"primary",onClick:m},{default:t(()=>[C.value==2?(r(),w("span",es,"添加知识库权限")):A("",!0),C.value==1?(r(),w("span",ts,"添加机器人权限")):A("",!0),C.value==3?(r(),w("span",as,"添加数据库权限")):A("",!0)]),_:1})]),l("div",ss,[e(Y,{columns:i.value,"data-source":N.value,pagination:!1},{headerCell:t(({column:V})=>[V.key==="name"?(r(),w(Z,{key:0},[C.value==2?(r(),w("span",ns,"知识库")):A("",!0),C.value==1?(r(),w("span",ls,"机器人")):A("",!0),C.value==3?(r(),w("span",os,"数据库")):A("",!0)],64)):A("",!0)]),bodyCell:t(({column:V,record:y})=>[V.key==="name"?(r(),w("div",is,S(y.name),1)):A("",!0),V.key==="role"?(r(),J(h,{key:1,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:t(()=>[l("div",ds,[l("div",{class:"role-menu",onClick:o=>_(y,4)},[l("div",_s,[e(E(wt)),v[4]||(v[4]=l("span",{class:"title"},"管理",-1))]),v[5]||(v[5]=l("div",{class:"desc"},"可编辑，可删除，可查看",-1)),y.operate_rights==4?(r(),w("div",cs,[e(E(xe))])):A("",!0)],8,rs),l("div",{class:"role-menu",onClick:o=>_(y,2)},[l("div",ps,[e(E(bt)),v[6]||(v[6]=l("span",{class:"title"},"编辑",-1))]),v[7]||(v[7]=l("div",{class:"desc"},"可编辑，可查看",-1)),y.operate_rights==2?(r(),w("div",ms,[e(E(xe))])):A("",!0)],8,us),l("div",{class:"role-menu",onClick:o=>_(y,1)},[l("div",fs,[e(E($t)),v[8]||(v[8]=l("span",{class:"title"},"查看",-1))]),v[9]||(v[9]=l("div",{class:"desc"},"仅查看",-1)),y.operate_rights==1?(r(),w("div",hs,[e(E(xe))])):A("",!0)],8,vs)])]),default:t(()=>[l("div",gs,[y.operate_rights==4?(r(),w("span",ys,"管理")):A("",!0),y.operate_rights==2?(r(),w("span",ks,"编辑")):A("",!0),y.operate_rights==1?(r(),w("span",xs,"查看")):A("",!0),e(E(xt))])]),_:2},1024)):A("",!0),V.key==="action"?(r(),w("a",{key:2,onClick:o=>a(y)},"删除",8,ws)):A("",!0)]),_:1},8,["columns","data-source"])])]),e(Qe,{ref_key:"seeModelAlertRef",ref:I,robotList:M.value,libraryList:O.value,formList:D.value,onOk:L},null,8,["robotList","libraryList","formList"])],64)}}},$s=te(bs,[["__scopeId","data-v-0ea0ca0d"]]),Cs={__name:"batch-edit-department",emits:["ok"],setup(H,{expose:C,emit:N}){const g=p(!1),L=N,u=oe.useForm,_=W({user_ids:"",department_ids:[]}),a=W({department_ids:[{message:"请选择部门",required:!0}]}),{resetFields:M,validate:O,validateInfos:D}=u(_,a),R=i=>{_.user_ids=i,_.department_ids=[],g.value=!0,U()},b=p([]),U=()=>{ye({}).then(i=>{let n=i.data||[];b.value=be(n)})},I=p(!1),m=()=>{O().then(()=>{let i={..._};i.department_ids=_.department_ids.join(","),I.value=!0,It(i).then(n=>{q.success("批量修改部门成功"),g.value=!1,L("ok")}).finally(()=>{I.value=!1})})};return C({show:R}),(i,n)=>{const v=Oe,P=fe,F=oe,f=ee;return r(),w("div",null,[e(f,{open:g.value,"onUpdate:open":n[1]||(n[1]=h=>g.value=h),title:"批量修改部门",onOk:m,confirmLoading:I.value},{default:t(()=>[e(F,{layout:"vertical",style:{"margin-top":"24px"}},{default:t(()=>[e(P,se({label:"选择部门"},E(D).department_ids),{default:t(()=>[e(v,{value:_.department_ids,"onUpdate:value":n[0]||(n[0]=h=>_.department_ids=h),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择","allow-clear":"",multiple:"","tree-default-expand-all":"","tree-data":b.value,"tree-node-filter-prop":"label"},{title:t(({value:h,label:Y})=>[l("div",null,S(Y),1)]),_:1},8,["value","tree-data"])]),_:1},16)]),_:1})]),_:1},8,["open","confirmLoading"])])}}},Os={class:"flex-content-box"},Ds={class:"left-department-box"},Ls={class:"team-members-pages"},Bs={class:"main-tabs-block"},Ss={class:"list-box"},Rs={class:"user-box"},Us=["src"],Ts={class:"name-info"},Vs={class:"user-name"},Ps={class:"nick-name"},Ms={key:0,class:"list-content"},js={key:1,class:"list-preview list-content"},Is={style:{display:"inline"}},Ns={class:"list-item-box"},Es={class:"list-item"};const As={key:0,class:"status-block green"},Fs={key:1,class:"status-block yellow"},Ks=["onClick"],zs=["onClick"],Js=["onClick"],Ys={__name:"team-members",setup(H){const C=p(1),N=[{value:1,payload:{title:"团队成员"}}],g=W({page:1,size:10,total:0,search:""}),L=p([]),u=p([]),_=p([]),a=p(null),M=x=>{g.page=x.current,g.size=x.pageSize,m()},O=W({id:""}),D=x=>{Object.assign(O,{...x}),C.value==1&&R()},R=()=>{g.page=1,m()},b=p([]),U=x=>{let j=[];return x.map(ae=>{j.push(ae.name||ae.department_name)}),j.join(", ")},I=p(!1),m=()=>{let x={page:g.page,size:g.size,search:g.search};O.id&&O.is_default!=1&&(x.department_id=O.id),I.value=!0,nt(x).then(j=>{let ae=j.data.list;ae.forEach(z=>{z.create_time=ie(z.create_time*1e3).format("YYYY-MM-DD HH:mm"),z.expire_time_desc=z.expire_time=="0"?"永久有效":ie(z.expire_time*1e3).format("YYYY-MM-DD HH:mm"),z.expire_status=0,(z.expire_time=="0"||ie().unix()<z.expire_time)&&(z.expire_status=1),z.managed_robot_list=z.managed_robot_list?JSON.parse(z.managed_robot_list):[],z.managed_library_list=z.managed_library_list?JSON.parse(z.managed_library_list):[],z.managed_form_list=z.managed_form_list?JSON.parse(z.managed_form_list):[],z.departments=z.departments?JSON.parse(z.departments):[]}),b.value=ae,P.selectedRowKeys=[],g.total=+j.data.total}).finally(()=>{I.value=!1})},i=()=>{C.value==1&&R()},n=p(null),v=()=>{m(),n.value.getLists()},P=W({selectedRowKeys:[]}),F=x=>{P.selectedRowKeys=x},f=x=>({disabled:x.role_type==1}),h=x=>{lt({user_id:x.id}).then(j=>{q.success(x.login_switch==1?"关闭成功":"开启成功"),m()})},Y=p(null),V=()=>{Y.value.add(O.id)},y=x=>{Y.value.edit(x)},o=p(null),s=x=>{o.value.open(x)},c=x=>{ee.confirm({title:"提示?",icon:e(ce),content:"确认删除该用户",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{ot({id:x.id}).then(j=>{q.success("删除成功"),m()})},onCancel(){}})},k=async()=>{await Pe().then(x=>{L.value=x.data}).catch(()=>{})},B=async()=>{await Ue({type:""}).then(x=>{u.value=x.data}).catch(()=>{})},K=async()=>{await Me().then(x=>{_.value=x.data}).catch(()=>{})},Q=async x=>{let j=[];if(P.selectedRowKeys.forEach(ae=>{b.value.filter(ue=>ue.id==ae)[0].role_type==1||j.push(ae)}),P.selectedRowKeys=j,P.selectedRowKeys.length==0)return q.error("请选择要修改的成员");x==1?await k():x==2?await B():x==3&&await K(),a.value.handleBatchOpen(x,P.selectedRowKeys.join(","))},ne=p(null),d=()=>{if(P.selectedRowKeys.length==0)return q.error("请选择要修改的成员");ne.value.show(P.selectedRowKeys.join(","))},X=async(x,j)=>{x==1?await k():x==2?await B():x==3&&await K(),a.value.open(x,"add",j)},G=async(x,j)=>{x==1?await k():x==2?await B():x==3&&await K(),a.value.open(x,"edit",j)};return(x,j)=>{const ae=ut,z=Fe,ue=ge,dn=qe,rn=Ye,_n=Je,pe=Se,Ge=Be,ke=ze,de=Le,cn=st,Xe=Ot,Ze=he;return r(),w("div",Os,[l("div",Ds,[e(ae,{style:{"padding-right":"24px"}},{default:t(()=>[e(Xa,{ref_key:"departmentTreeRef",ref:n,onSelect:D,onRefresh:m},null,512)]),_:1})]),l("div",Ls,[e(ae,{style:{"padding-right":"24px"}},{default:t(()=>[l("div",Bs,[e(z,{value:C.value,"onUpdate:value":j[0]||(j[0]=T=>C.value=T),options:N,onChange:i},{label:t(({payload:T})=>[$(S(T.title),1)]),_:1},8,["value"])]),C.value==1?(r(),w(Z,{key:0},[e(pe,{justify:"space-between"},{default:t(()=>[e(pe,{gap:8},{default:t(()=>[e(ue,{type:"primary",onClick:V},{icon:t(()=>[e(E(ve))]),default:t(()=>[j[5]||(j[5]=$(" 添加团队成员 "))]),_:1,__:[5]}),A("",!0),e(ue,{onClick:d},{default:t(()=>j[10]||(j[10]=[$("批量修改部门")])),_:1,__:[10]})]),_:1}),e(Ge,{value:g.search,"onUpdate:value":j[4]||(j[4]=T=>g.search=T),placeholder:"输入成员账号或昵称搜索",style:{width:"288px"},onSearch:R},null,8,["value"])]),_:1}),l("div",Ss,[e(Ze,{"data-source":b.value,scroll:{x:1100},loading:I.value,"row-key":"id","row-selection":{selectedRowKeys:P.selectedRowKeys,onChange:F,getCheckboxProps:f},pagination:{current:g.page,total:g.total,pageSize:g.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:M},{default:t(()=>[e(de,{title:"成员名称","data-index":"user_name",width:"190px"},{default:t(({record:T})=>[l("div",Rs,[l("img",{src:T.avatar||E(we),alt:""},null,8,Us),l("div",Ts,[l("div",Vs,[T.user_name&&T.user_name.length>7?(r(),J(ke,{key:0,title:T.user_name},{default:t(()=>[$(S(T.user_name),1)]),_:2},1032,["title"])):(r(),w(Z,{key:1},[$(S(T.user_name),1)],64))]),l("div",Ps,[T.nick_name&&T.nick_name.length>7?(r(),J(ke,{key:0,title:T.nick_name},{default:t(()=>[$(S(T.nick_name),1)]),_:2},1032,["title"])):(r(),w(Z,{key:1},[$(S(T.nick_name),1)],64))])])])]),_:1}),e(de,{title:"角色","data-index":"role_name",width:"100px"},{default:t(({record:T})=>[$(S(T.role_name),1)]),_:1}),e(de,{"data-index":"departments",width:"200px"},{title:t(()=>j[11]||(j[11]=[$(" 部门 ")])),default:t(({record:T})=>[T.departments&&T.departments.length==0?(r(),w("div",Ms," -- ")):(r(),w("div",js,[e(ke,null,{title:t(()=>[l("div",Is,S(U(T.departments)),1)]),default:t(()=>[l("div",Ns,[l("div",Es,S(U(T.departments)),1)])]),_:2},1024)]))]),_:1}),A("",!0),A("",!0),A("",!0),e(de,{title:"状态","data-index":"expire_status",width:"120px"},{default:t(({record:T})=>[T.expire_status==1?(r(),w("div",As,[e(E(Ct)),j[21]||(j[21]=$("生效中 "))])):A("",!0),T.expire_status==0?(r(),w("div",Fs,[e(E(Ke)),j[22]||(j[22]=$("已过期 "))])):A("",!0)]),_:1}),e(de,{title:"过期时间","data-index":"expire_time_desc",width:"130px"},{default:t(({record:T})=>[$(S(T.expire_time_desc),1)]),_:1}),e(de,{title:"登录","data-index":"login_switch",width:"90px",fixed:"right"},{default:t(({record:T})=>[e(Xe,{onChange:le=>h(T),checked:T.login_switch=="1",disabled:T.role_type=="1","checked-children":"开","un-checked-children":"关"},null,8,["onChange","checked","disabled"])]),_:1}),e(de,{title:"操作","data-index":"action",width:"176px",fixed:"right"},{default:t(({record:T})=>[T.role_type=="1"?(r(),J(pe,{key:0,gap:16},{default:t(()=>j[23]||(j[23]=[l("span",{class:"disabled"},"编辑",-1),l("span",{class:"disabled"},"重置密码",-1),l("span",{class:"disabled"},"删除",-1)])),_:1,__:[23]})):(r(),J(pe,{key:1,gap:16},{default:t(()=>[l("a",{onClick:le=>y(T)},"编辑",8,Ks),l("a",{onClick:le=>s(T)},"重置密码",8,zs),l("a",{onClick:le=>c(T)},"删除",8,Js)]),_:2},1024))]),_:1})]),_:1},8,["data-source","loading","row-selection","pagination"])])],64)):(r(),J($s,{key:1,treeParmas:O},null,8,["treeParmas"]))]),_:1}),e(sa,{ref_key:"addTeamMembersRef",ref:Y,onOk:v},null,512),e(oa,{ref_key:"resetPasswordRef",ref:o,onOk:m},null,512),e(Qe,{ref_key:"seeModelAlertRef",ref:a,robotList:L.value,libraryList:u.value,formList:_.value,onOk:m},null,8,["robotList","libraryList","formList"]),e(Cs,{ref_key:"batchEditDepartmentRef",ref:ne,onOk:v},null,512)])])}}},qs=te(Ys,[["__scopeId","data-v-9e1fe6ee"]]),Hs={class:"form-box"},Qs={class:"title-row"},Gs={class:"check-num"},Xs={key:0},Zs={__name:"add-role",emits:["ok"],setup(H,{expose:C,emit:N}){const g=N,L=oe.useForm,u=p([]),_=p({}),a=p(!1),M=p("添加角色"),O=p(""),D=W({name:"",mark:"",role_type:""}),R=W({name:[{message:"请输入角色名称",required:!0}]}),{resetFields:b,validate:U,validateInfos:I}=L(D,R),m=async()=>{await it().then(V=>{let y=V.data||[];y.forEach(o=>{o.uni_key=="System"&&(o.children=o.children.filter(s=>s.uni_key!="AccountManage"))}),u.value=y;for(let o=0;o<y.length;o++){const s=y[o];_.value[s.uni_key]=[]}})},i=async()=>{await m(),M.value="添加角色",O.value="",a.value=!0,D.name="",D.mark="",b()},n=V=>{M.value="编辑角色",O.value=V.id,dt({id:V.id}).then(y=>{let o=y.data,s=o.role_permission||[];D.name=o.name,D.mark=o.mark,D.role_type=o.role_type,_.value=v(u.value,s),a.value=!0})},v=(V,y)=>{let o={};return V.forEach(s=>{o[s.uni_key]=[];for(let c=0;c<s.children.length;c++){const k=s.children[c];y.includes(k.uni_key)&&o[s.uni_key].push(k.uni_key),k.children&&k.children.length>0&&k.children.forEach(B=>{y.includes(B.uni_key)&&o[s.uni_key].push(B.uni_key)})}}),o},P=V=>{let y=[];for(let o in V)V[o].map(c=>{y.push(c)});return y},F=()=>{U().then(()=>{let V=P(_.value),y={id:O.value,mark:D.mark};D.role_type==0&&(y.name=D.name,y.role_type=D.role_type,y.uni_keys=V.join(",")),rt(y).then(o=>{a.value=!1,q.success("保存成功"),g("ok")})})},f=(V,y)=>{V.children&&_e(()=>{if(!_.value[y].includes(V.uni_key)){let o=V.children.map(s=>s.uni_key);_.value[y]=_.value[y].filter(s=>!o.includes(s))}})},h=(V,y,o)=>{_e(()=>{_.value[o].includes(V.uni_key)&&(_.value[o].push(y.uni_key),_.value[o]=[...new Set(_.value[o])])})},Y=V=>{let y=V.length;return V.forEach(o=>{o.children&&o.children.length&&(y=y+o.children.length)}),y};return ct(()=>{m()}),C({add:i,edit:n}),(V,y)=>{const o=Ce,s=fe,c=Dt,k=Se,B=Rt,K=St,Q=Bt,ne=Lt,d=oe,X=ee;return r(),w("div",null,[e(X,{open:a.value,"onUpdate:open":y[2]||(y[2]=G=>a.value=G),title:M.value,onOk:F,width:"746px"},{default:t(()=>[l("div",Hs,[e(d,{layout:"vertical"},{default:t(()=>[e(s,se({label:"角色名称"},E(I).name),{default:t(()=>[e(o,{type:"text",maxlength:100,disabled:D.role_type>0,placeholder:"请输入角色名称",value:D.name,"onUpdate:value":y[0]||(y[0]=G=>D.name=G)},null,8,["disabled","value"])]),_:1},16),e(s,{label:"角色备注"},{default:t(()=>[e(c,{value:D.mark,"onUpdate:value":y[1]||(y[1]=G=>D.mark=G),placeholder:"请输入角色备注"},null,8,["value"])]),_:1}),e(s,{label:"角色权限"},{default:t(()=>[(r(!0),w(Z,null,re(u.value,G=>(r(),w("div",{class:"role-check-box",key:G.uni_key},[e(k,{class:"title-boock",justify:"space-between"},{default:t(()=>[l("div",Qs,S(G.name),1),l("div",Gs,S(_.value[G.uni_key].length)+"/"+S(Y(G.children)),1)]),_:2},1024),e(ne,{value:_.value[G.uni_key],"onUpdate:value":x=>_.value[G.uni_key]=x,style:{width:"100%"}},{default:t(()=>[e(Q,{gutter:[0,12]},{default:t(()=>[(r(!0),w(Z,null,re(G.children,x=>(r(),J(K,{span:x.children&&x.children.length?12:6,key:x.uni_key},{default:t(()=>[e(B,{onChange:j=>f(x,G.uni_key),disabled:D.role_type>0,value:x.uni_key},{default:t(()=>[$(S(x.name),1)]),_:2},1032,["onChange","disabled","value"]),x.children&&x.children.length>0?(r(),w("span",Xs,[y[3]||(y[3]=$("( ")),(r(!0),w(Z,null,re(x.children,j=>(r(),J(B,{onChange:ae=>h(j,x,G.uni_key),key:j.uni_key,disabled:D.role_type>0,value:j.uni_key},{default:t(()=>[$(S(j.name),1)]),_:2},1032,["onChange","disabled","value"]))),128)),y[4]||(y[4]=$(" )"))])):A("",!0)]),_:2},1032,["span"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])]))),128))]),_:1})]),_:1})])]),_:1},8,["open","title"])])}}},Ws=te(Zs,[["__scopeId","data-v-3821fcf1"]]),en={class:"team-members-pages"},tn={class:"list-box"},an={__name:"role-permissions",setup(H){p("");const C=W({page:1,size:10,total:0,search:""}),N=p([{}]),g=D=>{C.page=D.current,C.size=D.pageSize,u()},L=()=>{C.page=1,u()},u=()=>{let D={page:C.page,size:C.size,search:C.search};Re(D).then(R=>{let b=R.data.list;b.forEach(U=>{U.update_time=ie(U.update_time*1e3).format("YYYY-MM-DD HH:mm")}),N.value=b,C.total=+R.data.total})};L();const _=p(null),a=()=>{_.value.add()},M=D=>{_.value.edit(D)},O=D=>{ee.confirm({title:"提示?",icon:e(ce),content:"确认删除该角色",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{_t({id:D.id}).then(R=>{q.success("删除成功"),u()})},onCancel(){}})};return(D,R)=>{const b=ge,U=Be,I=Se,m=Le,i=he;return r(),w("div",en,[e(I,{justify:"space-between"},{default:t(()=>[e(b,{type:"primary",onClick:a},{icon:t(()=>[e(E(ve))]),default:t(()=>[R[1]||(R[1]=$(" 添加角色 "))]),_:1,__:[1]}),e(U,{value:C.search,"onUpdate:value":R[0]||(R[0]=n=>C.search=n),placeholder:"输入角色名称",style:{width:"288px"},onSearch:L},null,8,["value"])]),_:1}),l("div",tn,[e(i,{"data-source":N.value,pagination:{current:C.page,total:C.total,pageSize:C.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:g},{default:t(()=>[e(m,{title:"角色","data-index":"name",width:"157px"},{default:t(({record:n})=>[$(S(n.name),1)]),_:1}),e(m,{title:"备注","data-index":"mark",width:"480px"},{default:t(({record:n})=>[$(S(n.mark),1)]),_:1}),e(m,{title:"最近修改时间","data-index":"update_time",width:"150px"},{default:t(({record:n})=>[$(S(n.update_time),1)]),_:1}),e(m,{title:"最近修改人","data-index":"operate_name",width:"130px"},{default:t(({record:n})=>[$(S(n.operate_name),1)]),_:1}),e(m,{title:"创建人","data-index":"create_name",width:"130px"},{default:t(({record:n})=>[$(S(n.create_name),1)]),_:1}),e(m,{title:"操作","data-index":"action",width:"178px"},{default:t(({record:n})=>[e(I,{gap:16,class:"action-box"},{default:t(()=>[e(b,{type:"link",onClick:v=>M(n)},{default:t(()=>R[2]||(R[2]=[$("编辑")])),_:2,__:[2]},1032,["onClick"]),e(b,{type:"link",onClick:v=>O(n),disabled:n.role_type<=3&&n.role_type>0},{default:t(()=>R[3]||(R[3]=[$("删除")])),_:2,__:[3]},1032,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","pagination"])]),e(Ws,{ref_key:"addRoleRef",ref:_,onOk:u},null,512)])}}},sn=te(an,[["__scopeId","data-v-5beb8d86"]]),nn={class:"user-model-page"},ln={class:"list-wrapper"},on={__name:"index",setup(H){const C=p(1),N=()=>{C.value};return(g,L)=>(r(),w("div",nn,[e(Ft,{value:C.value,"onUpdate:value":L[0]||(L[0]=u=>C.value=u),onChange:N},null,8,["value"]),l("div",ln,[C.value==1?(r(),J(qs,{key:0})):(r(),J(sn,{key:1}))])]))}},Cn=te(on,[["__scopeId","data-v-df6b3107"]]);export{Cn as default};
