import{_ as Ee}from"./cu-scroll-D9utH_KS.js";import{u as xe}from"./robot-BQqgDPGj.js";import{d as K,Z as Fe,w as Ge,X as je,B as ce,M as ie,bu as Be,aT as Je,a9 as Pe,o as $e,v as pe,G as qe,y as Qe,z as Ve,$ as Ce,a3 as ve,a4 as fe,O as Ie,aE as He,b as V,F as le,e as Se,ah as Me,Q as Xe,D as Ze,h as We,i as et,k as tt,E as nt,ae as ot,T as st}from"./ui-antd-BHaxN-GS.js";import{av as De,aw as ne,f as d,r as G,o as Oe,w as Ue,ac as v,ad as u,as as e,k as n,ar as o,F as E,ax as te,u as F,ae as R,G as $,at as T,e as W,j as at,az as P,n as me,A as ke,ai as lt,aE as we,aF as be,af as _e,q as it}from"./vue-chunks-CGLjTDrY.js";import{_ as H,d as ye,A as ut,aX as rt,aZ as dt,al as _t,c as mt}from"../../index-CB2DywzJ.js";import{M as ge}from"./model-select-h2ELC74y.js";import{u as ct}from"./index-D4Gl6KHo.js";import{a8 as pt,a9 as ze,aa as vt,ab as ft}from"./index-CoChppVN.js";import{U as Le}from"./index-qBl5MWrh.js";import{u as Ye}from"./util-BwuffJOK.js";import{M as yt}from"./editor-code-BsT961tw.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";import"./index-BcMVDew1.js";import"./index-DxgALpad.js";const gt={class:"zm-date"},kt={class:"date-btn"},wt={class:"date-content"},Te={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(j,{emit:N}){const U=De(),s=ne().query,b=j,l=d(1),c=N;let r=G([{label:"今日",value:!0,key:2,start_date:K().startOf("day"),end_date:K().endOf("day")},{label:"昨日",value:!1,key:3,start_date:K().subtract(1,"day").startOf("day"),end_date:K().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_date:K().subtract(6,"day").startOf("day"),end_date:K().endOf("day").subtract(1,"millisecond")},{label:"自定义",value:!1,key:5,start_date:K().startOf("month").startOf("day"),end_date:K().endOf("day")}]);const C=d(null),D=d(null),h=d([]),O=i=>i>=K().subtract(0,"day"),M=()=>{let i=l.value,a=null;r.forEach(f=>{f.key==i&&(a=f)}),h.value=[a.start_date,a.end_date],C.value=a.start_date.startOf("day").format("YYYYMMDD"),D.value=a.end_date.endOf("day").format("YYYYMMDD"),w()},z=(i,a)=>{C.value=i[0].startOf("day").format("YYYYMMDD"),D.value=i[1].endOf("day").format("YYYYMMDD"),l.value=5,w()},w=()=>{c("dateChange",{start_time:C.value,end_time:D.value})};return Oe(()=>{s.start_date&&s.end_date?(l.value=5,h.value=[K(s.start_date),K(s.end_date)],C.value=K(s.start_date).format("YYYYMMDD"),D.value=K(s.end_date).format("YYYYMMDD"),w(),setTimeout(()=>{U.push({path:U.path,query:{id:s.id,robot_key:s.robot_key}})},400)):(l.value=parseInt(b.datekey),M())}),Ue(()=>b.datekey,(i,a)=>{l.value=parseInt(b.datekey.split("-")[0]),M()}),(i,a)=>{const f=Fe,k=Ge,L=je;return u(),v("div",gt,[e("div",kt,[n(k,{value:l.value,"onUpdate:value":a[0]||(a[0]=I=>l.value=I),onChange:M},{default:o(()=>[(u(!0),v(E,null,te(F(r),I=>(u(),R(f,{class:"date-btn-button",value:I.key,key:I.key},{default:o(()=>[$(T(I.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",wt,[n(L,{value:h.value,"onUpdate:value":a[1]||(a[1]=I=>h.value=I),onChange:z,format:"YYYY-MM-DD",disabledDate:O,allowClear:!1},null,8,["value"])])])}}},bt={class:"ai-generate-wrapper"},ht={class:"form-box-wrapper ai-generate-wrapper-box"},xt={class:"ai-generate-wrapper-left"},$t={class:"form-box-wrapper-options"},qt={class:"form-item flex1"},Ct={class:"form-content"},It={class:"form-item generate-btn-box"},St={key:0,class:"progress-box"},Mt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(j,{expose:N,emit:U}){const S=d(10),s=d(!1),b=d(!1),l=G({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),c=j,r=U,C=d(!1),D=()=>{C.value=!0},h=()=>{s.value=!1},O=async()=>{var I;b.value=!0;try{let _={library_id:(I=c.detailsInfo)==null?void 0:I.library_id,model_config_id:l.model_config_id,use_model:l.use_model,num:l.count};C.value=!1,s.value=!0,f()}finally{b.value=!1}},M=d(!1),z=d(!1);let w=null;const i=W(()=>S.value>=100?"success":"active"),a=W(()=>({"0%":"#108ee9","100%":"#87d068"})),f=()=>{M.value=!0,z.value=!1,S.value=0,w=setInterval(()=>{S.value<100?(S.value+=Math.floor(Math.random()*10)+1,S.value>100&&(S.value=100)):(clearInterval(w),M.value=!1,z.value=!0)},800)},k=()=>{r("handleDownload")},L=I=>{if(M.value)return I.preventDefault(),I.returnValue="数据正在生成中，确定要离开吗？","数据正在生成中，确定要离开吗？"};return at(()=>{clearInterval(w),window.removeEventListener("beforeunload",L)}),N({showModal:D,hideModal:h}),(I,_)=>{const B=ye,p=ce,m=ie,q=Be,Q=Je;return u(),v("div",null,[n(m,{open:C.value,"onUpdate:open":_[2]||(_[2]=A=>C.value=A),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:o(()=>[..._[4]||(_[4]=[e("div",{class:"custom-modal-header"},[e("span",null,"AI智能总结")],-1)])]),footer:o(()=>[..._[7]||(_[7]=[])]),default:o(()=>[e("div",bt,[e("div",ht,[e("div",xt,[e("div",$t,[e("div",qt,[_[5]||(_[5]=e("div",{class:"form-label required"},"请选择生成未知问题总结的大模型",-1)),e("div",Ct,[n(ge,{modelType:"LLM",modeName:l.use_model,"onUpdate:modeName":_[0]||(_[0]=A=>l.use_model=A),modeId:l.model_config_id,"onUpdate:modeId":_[1]||(_[1]=A=>l.model_config_id=A)},null,8,["modeName","modeId"])])])]),e("div",It,[n(p,{onClick:O,loading:b.value,class:"generate-btn"},{default:o(()=>[n(B,{name:"ai-generate-white",style:{"font-size":"16px"}}),_[6]||(_[6]=$(" 开始总结 ",-1))]),_:1},8,["loading"])])])])])]),_:1},8,["open"]),n(m,{open:s.value,"onUpdate:open":_[3]||(_[3]=A=>s.value=A),title:"生成数据",footer:null,width:746},{default:o(()=>[S.value<100?(u(),v("div",St,[n(q,{type:"circle",percent:S.value,status:i.value,"stroke-color":a.value},null,8,["percent","status","stroke-color"]),_[8]||(_[8]=e("div",{class:"tip"},"数据生成中，请勿关闭页面",-1))])):(u(),R(Q,{key:1,status:"success",title:"生成完成"},{subTitle:o(()=>[..._[9]||(_[9]=[$(" 您可以去未知问题总结中下载生成的数据 ",-1)])]),extra:o(()=>[n(p,{onClick:k,type:"primary"},{default:o(()=>[..._[10]||(_[10]=[$("去下载",-1)])]),_:1})]),_:1}))]),_:1},8,["open"])])}}},Dt=H(Mt,[["__scopeId","data-v-a09ccd43"]]),Ot={class:"list-wrapper"},Ut={class:"content-wrapper"},zt={class:"tip-icon"},Lt={class:"search-block"},Yt={key:0},Tt={key:1},Nt={__name:"index",setup(j){const N=ne().query,U=d(1),S=d([]),s=G({robot_id:N.id,start_day:"",end_day:"",page:1,size:10,total:0}),b=d(null),l=O=>{s.page=O.current,s.size=O.pageSize,D()},c=()=>{s.page=1,D()},r=()=>{U.value=2,b.value&&b.value.hideModal()},C=O=>{s.start_day=O.start_time,s.end_day=O.end_time,c()},D=()=>{ct({...s}).then(O=>{let M=O.data.list;S.value=M,s.total=+O.data.total})},h=[{title:"未知问题",dataIndex:"question",key:"question",width:"60%"},{title:"触发日期",dataIndex:"show_date",key:"show_date",width:"20%"},{title:"当日出现次数",key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return Oe(()=>{}),(O,M)=>{const z=$e,w=pe,i=qe;return u(),v(E,null,[e("div",Ot,[e("div",Ut,[n(z,{"show-icon":"",class:"alert-box"},{icon:o(()=>[e("div",zt,[n(F(Pe))])]),message:o(()=>[...M[0]||(M[0]=[e("div",{class:"tip-title"},"统计用户在与机器人对话中，没有从知识库中检索出知识的用户问题",-1),e("div",{class:"tip-content"},[e("p",null," 1. 如果您认为知识库里面有对应的知识，只是没有检索出来，可能是您设置的召回阈值过高或者top K较少。您调整机器人的召回设置来提升召回率。 ")],-1)])]),_:1}),e("div",Lt,[n(Te,{datekey:"4",onDateChange:C})]),n(i,{class:"table-list",columns:h,"data-source":S.value,pagination:{current:s.page,total:s.total,pageSize:s.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:l},{bodyCell:o(({column:a,record:f})=>[a.key==="question"?(u(),v(E,{key:0},[f.question.length>100?(u(),v("div",Yt,[n(w,{overlayClassName:"search-content-tip",placement:"top"},{title:o(()=>[$(T(f.question),1)]),default:o(()=>[e("div",null,T(f.question.slice(0,100)+"..."),1)]),_:2},1024)])):(u(),v("div",Tt,T(f.question),1))],64)):P("",!0)]),_:1},8,["data-source","pagination"])])]),n(Dt,{ref_key:"aiGenerateRef",ref:b,onHandleDownload:r},null,512)],64)}}},At=H(Nt,[["__scopeId","data-v-672c7640"]]),Kt={class:"custom-modal-header"},Rt={key:1},Et={key:2},Ft={class:"form-box-wrapper"},Gt={class:"form-item"},jt={class:"form-content"},Bt={class:"form-item"},Jt={class:"form-content"},Pt={class:"form-item"},Qt={class:"form-content"},Vt={class:"form-item"},Ht={class:"form-label-box"},Xt={class:"form-content"},Zt={class:"form-item"},Wt={class:"form-content"},en={key:0,class:"error-tip"},tn={class:"form-item"},nn={class:"form-content"},on={class:"upload-box-wrapper"},sn={key:0},an={class:"ai-generate-wrapper"},ln={class:"form-box-wrapper ai-generate-wrapper-box"},un={class:"ai-generate-wrapper-left"},rn={class:"form-box-wrapper-options"},dn={class:"form-item flex1"},_n={class:"form-content"},mn={class:"form-item flex1"},cn={class:"form-content dual-inputs"},pn={class:"input-group"},vn={class:"form-label-input-box"},fn={class:"form-box-wrapper-content"},yn={class:"problem-box"},gn={class:"problem-content"},kn={class:"problem-box"},wn={class:"problem-content"},bn={class:"form-item generate-btn-box"},hn={class:"result-nav"},xn={key:0,class:"tip"},$n={key:1,class:"result-nav-text"},qn={key:0,class:"container"},Cn={class:"result-container"},In=["innerHTML"],Sn={class:"result-footer"},Mn={__name:"import-library-modal",emits:["ok"],setup(j,{expose:N,emit:U}){const S=d(!1),s=d(!1),b=d(!1),l=d(!1),c=d(!1),r=G({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),C=new yt({html:!0,linkify:!0,typographer:!0}),D=d(""),h=G({finish:"",content:""});Ue(()=>h.content,()=>{D.value=C.render(h.content)});const O=U,M=d("1"),z=d(!1),w=d(""),i=d(""),a=d(""),f=d(""),k=d(""),L=d([]),I=d(""),_=d("0"),B=d([]),p=()=>{ut({type:2}).then(x=>{_.value="0",B.value=x.data||[]})};p();const m=()=>{A()},q=x=>{var t;p(),s.value=!1,b.value=!1,c.value=!1,w.value="",i.value="",I.value=x.id||"",a.value=x.answer||"",L.value=x.images||[],f.value=x.question||"",k.value=x.similar_questions?x.similar_questions.join(`
`):"",_.value=x.group_id||"0",r.library_id=x.library_id||"",r.library_id||(r.library_id=(t=B.value[0])==null?void 0:t.id),A(),z.value=!0},Q=d([]),A=()=>{_t({library_id:r.library_id}).then(x=>{Q.value=x.data||[]})},ee=()=>{if(se(),!f.value)return V.error("请输入分段问题");if(!a.value)return V.error("请输入分段答案");if(a.value.length>1e4)return;let x={title:w.value,content:i.value,question:f.value,answer:a.value,images:L.value,library_id:r.library_id};x.group_id=_.value||0;let t=k.value.trim();t?(t=t.split(`
`),x.similar_questions=JSON.stringify(t)):x.similar_questions="[]";let y=new FormData;for(let Y in x)Ye.isArray(x[Y])?x[Y].forEach(J=>{y.append(Y,J)}):y.append(Y,x[Y]);dt(y).then(Y=>{pt({id:I.value,to_library_id:r.library_id}).then(J=>{V.success("导入成功"),z.value=!1,O("ok")})})},oe=()=>{if(!r.library_id)return V.error("请选择知识库");s.value=!0},X=d(""),ue=async()=>{h.content="",X.value="",l.value=!0,c.value=!0;try{let x={library_id:r.library_id,model_config_id:r.model_config_id,use_model:r.use_model,num:r.count,question:f.value,answer:a.value};const t=await rt(x);X.value=t.data.map(y=>y).join(`
`),h.content=t.data.map((y,Y)=>`<div class="dialog-message">${Y+1}. ${y}</div>`).join(""),b.value=!0}finally{l.value=!1}},re=()=>{k.value?k.value+=`
${X.value}`:k.value+=X.value,V.success("保存成功"),b.value=!1,s.value=!1,c.value=!1};function Z(x){return x.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const se=()=>{k.value=Z(k.value)};return N({showModal:q}),(x,t)=>{const y=ce,Y=Ve,J=Qe,de=Ce,ae=ye,Ne=fe,Ae=ve,Ke=Ie,Re=ie;return u(),v("div",null,[n(Re,{open:z.value,"onUpdate:open":t[12]||(t[12]=g=>z.value=g),onOk:ee,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:s.value?c.value?"944px":"472px":"746px","ok-button-props":{style:{display:s.value?"none":"block"}}},{title:o(()=>[e("div",Kt,[s.value?(u(),R(y,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=g=>s.value=!1)},{icon:o(()=>[n(F(He),{style:{"font-size":"12px"}})]),_:1})):P("",!0),s.value?(u(),v("span",Rt,"AI生成相似问法")):(u(),v("span",Et,"导入知识库"))])]),footer:o(()=>[s.value?P("",!0):(u(),v(E,{key:0},[n(y,{onClick:t[11]||(t[11]=g=>z.value=!1)},{default:o(()=>[...t[30]||(t[30]=[$("取消",-1)])]),_:1}),n(y,{type:"primary",onClick:ee},{default:o(()=>[...t[31]||(t[31]=[$("确定",-1)])]),_:1})],64))]),default:o(()=>[me(e("div",Ft,[e("div",Gt,[t[13]||(t[13]=e("div",{class:"form-label required"},"问题请选择要导入的问答知识库：",-1)),e("div",jt,[n(J,{onChange:m,value:r.library_id,"onUpdate:value":t[1]||(t[1]=g=>r.library_id=g),style:{width:"100%"},placeholder:"请选择"},{default:o(()=>[(u(!0),v(E,null,te(B.value,g=>(u(),R(Y,{value:g.id,key:g.id},{default:o(()=>[$(T(g.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Bt,[t[14]||(t[14]=e("div",{class:"form-label required"},"所属分类：",-1)),e("div",Jt,[n(J,{value:_.value,"onUpdate:value":t[2]||(t[2]=g=>_.value=g),style:{width:"100%"}},{default:o(()=>[(u(!0),v(E,null,te(Q.value,g=>(u(),R(Y,{value:g.id},{default:o(()=>[$(T(g.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",Pt,[t[15]||(t[15]=e("div",{class:"form-label required"},"分段问题：",-1)),e("div",Qt,[n(de,{placeholder:"请输入分段问题",value:f.value,"onUpdate:value":t[3]||(t[3]=g=>f.value=g),style:{height:"100px"}},null,8,["value"])])]),e("div",Vt,[e("div",Ht,[t[17]||(t[17]=e("div",{class:"form-label required"},"相似问法",-1)),e("div",{class:"ai-generate",onClick:oe},[n(ae,{name:"ai-generate",style:{"font-size":"14px"}}),t[16]||(t[16]=e("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),e("div",Xt,[n(de,{placeholder:"请输入相似问法",value:k.value,"onUpdate:value":t[4]||(t[4]=g=>k.value=g),style:{height:"100px"},onBlur:se},null,8,["value"]),t[18]||(t[18]=e("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),e("div",Zt,[t[19]||(t[19]=e("div",{class:"form-label required"},"分段答案：",-1)),e("div",Wt,[n(de,{placeholder:"请输入分段答案",value:a.value,"onUpdate:value":t[5]||(t[5]=g=>a.value=g),maxlength:1e4,style:{height:"100px"}},null,8,["value"]),a.value.length>1e4?(u(),v("div",en,"分段答案最多支持10000个字符")):P("",!0)])]),e("div",tn,[t[21]||(t[21]=e("div",{class:"form-label"},"附件",-1)),e("div",nn,[e("div",on,[n(Ae,{activeKey:M.value,"onUpdate:activeKey":t[6]||(t[6]=g=>M.value=g),size:"small"},{default:o(()=>[n(Ne,{key:"1"},{tab:o(()=>[e("span",null,[n(ae,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),t[20]||(t[20]=$(" 图片 ",-1)),L.value.length?(u(),v("span",sn,"("+T(L.value.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Le,{value:L.value,"onUpdate:value":t[7]||(t[7]=g=>L.value=g)},null,8,["value"])])])])],512),[[ke,!s.value]]),me(e("div",an,[e("div",ln,[e("div",un,[e("div",rn,[e("div",dn,[t[22]||(t[22]=e("div",{class:"form-label required"},"相似问法模型：",-1)),e("div",_n,[n(ge,{modelType:"LLM",modeName:r.use_model,"onUpdate:modeName":t[8]||(t[8]=g=>r.use_model=g),modeId:r.model_config_id,"onUpdate:modeId":t[9]||(t[9]=g=>r.model_config_id=g)},null,8,["modeName","modeId"])])]),e("div",mn,[e("div",cn,[e("div",pn,[t[24]||(t[24]=e("div",{class:"form-label required"},"问题个数：",-1)),e("div",vn,[n(Ke,{value:r.count,"onUpdate:value":t[10]||(t[10]=g=>r.count=g),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),t[23]||(t[23]=$("个 ",-1))])])])])]),e("div",fn,[e("div",yn,[t[25]||(t[25]=e("div",{class:"problem"},"问题",-1)),e("div",gn,T(f.value),1)]),e("div",kn,[t[26]||(t[26]=e("div",{class:"problem"},"答案",-1)),e("div",wn,T(a.value),1)])]),e("div",bn,[n(y,{onClick:ue,loading:l.value,class:"generate-btn"},{default:o(()=>[n(ae,{name:"ai-generate-white",style:{"font-size":"16px"}}),t[27]||(t[27]=$(" 开始生成 ",-1))]),_:1},8,["loading"])])]),e("div",{class:lt(["ai-generate-wrapper-right",{"show-result":c.value}])},[e("div",hn,[n(ae,{name:"generate-icon",style:{"font-size":"14px"}}),l.value?(u(),v("span",xn,"相似问法生成中...")):(u(),v("div",$n,"相似问法生成完毕"))]),!h.content&&l.value&&!S.value?(u(),v("div",qn,[...t[28]||(t[28]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)])])):P("",!0),e("div",Cn,[e("div",{class:"dialog-content",innerHTML:D.value},null,8,In)]),e("div",Sn,[n(y,{class:"result-footer-btn",type:"primary",onClick:re},{default:o(()=>[...t[29]||(t[29]=[$("保存相似问法",-1)])]),_:1})])],2)])],512),[[ke,s.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Dn=H(Mn,[["__scopeId","data-v-efbb0fd6"]]),On={class:"form-box"},Un={__name:"auto-cluster-modal",emits:["ok"],setup(j,{expose:N,emit:U}){const S=U,s=ne().query,b=d(!1),l=G({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:s.id}),c=le.useForm;d(!1);const r=w=>{l.unknown_summary_model_config_id=w.unknown_summary_model_config_id||"",l.unknown_summary_use_model=w.unknown_summary_use_model||"",l.unknown_summary_similarity=w.unknown_summary_similarity||"",l.unknown_summary_status=w.unknown_summary_status||"",b.value=!0},C=G({unknown_summary_similarity:[{required:!0,message:"请输入相似度阈值",trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:"请选择使用的向量模型",trigger:"change"}]}),{validate:D,validateInfos:h}=c(l,C),O=w=>{w.length},M=()=>{D().then(()=>{z()}).catch(w=>{})},z=()=>{ze({...l}).then(w=>{V.success("保存成功"),b.value=!1,S("ok")})};return N({show:r}),(w,i)=>{const a=Se,f=pe,k=Ie,L=le,I=ie;return u(),v("div",null,[n(I,{open:b.value,"onUpdate:open":i[3]||(i[3]=_=>b.value=_),title:"自动聚类设置",onOk:M},{default:o(()=>[e("div",On,[n(L,{layout:"vertical"},{default:o(()=>[n(a,we(be(F(h).unknown_summary_model_config_id)),{label:o(()=>[...i[4]||(i[4]=[$("请设置使用的向量模型 ",-1)])]),default:o(()=>[n(ge,{modelType:"TEXT EMBEDDING",modeName:l.unknown_summary_use_model,"onUpdate:modeName":i[0]||(i[0]=_=>l.unknown_summary_use_model=_),modeId:l.unknown_summary_model_config_id,"onUpdate:modeId":i[1]||(i[1]=_=>l.unknown_summary_model_config_id=_),onLoaded:O,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),n(a,we(be(F(h).unknown_summary_similarity)),{label:o(()=>[i[6]||(i[6]=$("相似度阈值 ",-1)),n(f,null,{title:o(()=>[...i[5]||(i[5]=[$("语意相似度大于指定阈值的问题会自动聚类",-1)])]),default:o(()=>[n(F(Me),{class:"ml4"})]),_:1})]),default:o(()=>[n(k,{placeholder:"请输入相似度阈值",style:{width:"100%"},value:l.unknown_summary_similarity,"onUpdate:value":i[2]||(i[2]=_=>l.unknown_summary_similarity=_),min:0,max:1,precision:2,step:.1},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open"])])}}},zn=H(Un,[["__scopeId","data-v-3a707038"]]),Ln={class:"form-box"},Yn={class:"upload-box-wrapper"},Tn={key:0},Nn={__name:"set-answer-modal",emits:["ok"],setup(j,{expose:N,emit:U}){const S=U,s=ne().query,b=d("1"),l=d(!1),c=G({id:s.id,question:"",unknown_list:"",answer:"",images:[]}),r=le.useForm,C=d(!1),D=i=>{Object.assign(c,JSON.parse(JSON.stringify(i))),l.value=!0},h=G({question:[{required:!0,message:"请输入问题",trigger:"change"}],unknown_list:[{required:!0,message:"请输入相似问法",trigger:"change"}],answer:[{required:!0,message:"请输入答案",trigger:"change"}]}),{validate:O,validateInfos:M}=r(c,h),z=()=>{O().then(()=>{w()}).catch(i=>{})},w=()=>{let i={...c},a=i.unknown_list.trim();a?(a=a.split(`
`),i.unknown_list=JSON.stringify(a)):i.unknown_list="[]";let f=new FormData;for(let k in i)Ye.isArray(i[k])?i[k].forEach(L=>{f.append(k,L)}):f.append(k,i[k]);C.value=!0,vt(f).then(k=>{V.success("保存成功"),l.value=!1,S("ok")}).finally(()=>{C.value=!1})};return N({show:D}),(i,a)=>{const f=Ce,k=Se,L=ye,I=fe,_=ve,B=Le,p=le,m=ie;return u(),v("div",null,[n(m,{open:l.value,"onUpdate:open":a[5]||(a[5]=q=>l.value=q),title:"设置答案",onOk:z,width:746,confirmLoading:C.value},{default:o(()=>[e("div",Ln,[n(p,{layout:"vertical"},{default:o(()=>[n(k,_e({label:"问题"},F(M).question),{default:o(()=>[n(f,{placeholder:"请输入问题",value:c.question,"onUpdate:value":a[0]||(a[0]=q=>c.question=q),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(k,_e({label:"相似问法(一行一个，最多可添加100个相似问法)"},F(M).unknown_list),{default:o(()=>[n(f,{placeholder:"请输入相似问法",value:c.unknown_list,"onUpdate:value":a[1]||(a[1]=q=>c.unknown_list=q),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(k,_e({label:"答案"},F(M).answer),{default:o(()=>[n(f,{placeholder:"请输入分段答案",value:c.answer,"onUpdate:value":a[2]||(a[2]=q=>c.answer=q),maxlength:1e4,style:{height:"100px"}},null,8,["value"])]),_:1},16),n(k,{label:"附件"},{default:o(()=>[e("div",Yn,[n(_,{activeKey:b.value,"onUpdate:activeKey":a[3]||(a[3]=q=>b.value=q),size:"small"},{default:o(()=>[n(I,{key:"1"},{tab:o(()=>[e("span",null,[n(L,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),a[6]||(a[6]=$(" 图片 ",-1)),c.images.length?(u(),v("span",Tn,"("+T(c.images.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(B,{value:c.images,"onUpdate:value":a[4]||(a[4]=q=>c.images=q)},null,8,["value"])])]),_:1})]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},An=H(Nn,[["__scopeId","data-v-a5711fe0"]]),Kn={class:"user-model-page"},Rn={class:"search-block"},En={class:"left-block"},Fn={class:"right-block"},Gn={class:"list-box"},jn={class:"qa-list-box"},Bn={class:"list-item"},Jn={class:"list-content"},Pn={class:"classify-scroll-box"},Qn={key:0,class:"list-item"},Vn={class:"list-content"},Hn={class:"fragment-img"},Xn=["src"],Zn={class:"import-td-box"},Wn={key:0,class:"status-block success"},eo={key:1,class:"status-block none"},to=["href"],no=["onClick"],oo=["onClick"],so={__name:"index",setup(j){const N=mt(),U=xe(),{getRobot:S}=U,s=W(()=>U.robotInfo),b=W(()=>s.value.unknown_summary_status==1),l=ne().query;De(),d(2);const c=G({start_day:"",end_day:""}),r=G({page:1,size:10,total:0}),C=d([]),D=d(!1),h=()=>{let p={robot_id:l.id,...c,...r};D.value=!0,ft({...p}).then(m=>{C.value=m.data.list.map(q=>({...q,images:q.images?JSON.parse(q.images):[],unknown_list:q.unknown_list?JSON.parse(q.unknown_list):[]})),r.total=+m.data.total||0}).finally(()=>{D.value=!1})};h();const O=p=>{let m=N.getToken,q=c.start_day,Q=c.end_day,A=`/manage/getUnknownIssueSummary?robot_id=${l.id}&token=${m}&start_day=${q}&end_day=${Q}&export=${p}`;window.location.href=A},M=p=>{r.page=p.current,r.size=p.pageSize,h()},z=()=>{r.page=1,h()},w=p=>{c.start_day=p.start_time,c.end_day=p.end_time,z()},i=d(null),a=p=>{i.value.showModal({id:p.id,library_id:p.to_library_id>0?p.to_library_id:"",answer:p.answer,question:p.question,similar_questions:p.unknown_list,images:p.images})},f=d(null),k=()=>{f.value.show({unknown_summary_model_config_id:s.value.unknown_summary_model_config_id,unknown_summary_use_model:s.value.unknown_summary_use_model,unknown_summary_similarity:s.value.unknown_summary_similarity,unknown_summary_status:s.value.unknown_summary_status})},L=p=>{p?f.value.show({unknown_summary_model_config_id:s.value.unknown_summary_model_config_id,unknown_summary_use_model:s.value.unknown_summary_use_model,unknown_summary_similarity:s.value.unknown_summary_similarity,unknown_summary_status:1}):ze({id:l.id,unknown_summary_model_config_id:s.value.unknown_summary_model_config_id,unknown_summary_use_model:s.value.unknown_summary_use_model,unknown_summary_similarity:s.value.unknown_summary_similarity,unknown_summary_status:0}).then(m=>{V.success("保存成功"),S(l.id)})},I=d(null),_=p=>{I.value.show({id:p.id,question:p.question,answer:p.answer,unknown_list:p.unknown_list.join(`
`),images:p.images})},B=()=>{S(l.id)};return(p,m)=>{const q=$e,Q=pe,A=Xe,ee=ce,oe=et,X=We,ue=tt,re=ot,Z=nt,se=st,x=qe,t=it("viewer");return u(),v("div",Kn,[n(q,{"show-icon":"",style:{"padding-top":"16px"}},{message:o(()=>[...m[2]||(m[2]=[e("p",null,"1、开启后，系统将自动将语意相近的未知问题聚类，生成聚类问题",-1),e("p",null,"2、您可以将聚类问题导出，添加回复后更新到知识库单面。",-1)])]),_:1}),e("div",Rn,[e("div",En,[m[5]||(m[5]=e("span",null,"自动聚类",-1)),n(Q,null,{title:o(()=>[...m[3]||(m[3]=[$("开启后，系统将自动将语意相近的未知问题累类，生成聚类问题",-1)])]),default:o(()=>[n(F(Me)),m[4]||(m[4]=$("： ",-1))]),_:1}),n(A,{onChange:L,checked:b.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("a",{onClick:k},"设置")]),e("div",Fn,[n(Te,{datekey:"4",onDateChange:w}),n(ee,{type:"primary",onClick:z},{default:o(()=>[...m[6]||(m[6]=[$("查询",-1)])]),_:1}),n(ue,null,{overlay:o(()=>[n(X,null,{default:o(()=>[n(oe,{onClick:m[0]||(m[0]=y=>O("docx")),key:"1"},{default:o(()=>[...m[7]||(m[7]=[$("下载为docx",-1)])]),_:1}),n(oe,{onClick:m[1]||(m[1]=y=>O("xlsx")),key:"2"},{default:o(()=>[...m[8]||(m[8]=[$("下载为xlsx",-1)])]),_:1})]),_:1})]),default:o(()=>[n(ee,{type:"primary"},{default:o(()=>[m[9]||(m[9]=$(" 下载 ",-1)),n(F(Ze))]),_:1})]),_:1})])]),e("div",Gn,[n(x,{"data-source":C.value,loading:D.value,pagination:{current:r.page,total:r.total,pageSize:r.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:M},{default:o(()=>[n(Z,{key:"question",title:"聚类问题",width:480},{default:o(({record:y})=>[e("div",jn,[e("div",Bn,[m[10]||(m[10]=e("div",{class:"list-label"},"问题",-1)),e("div",Jn,[$(T(y.question)+" ",1),y.unknown_total>0?(u(),R(re,{key:0,placement:"topLeft"},{content:o(()=>[e("div",Pn,[(u(!0),v(E,null,te(y.unknown_list,(Y,J)=>(u(),v("div",{class:"list-item",key:J},T(Y),1))),128))])]),title:o(()=>[e("span",null,"共聚类了"+T(y.unknown_total)+"个未知问题",1)]),default:o(()=>[e("a",null,"（"+T(y.unknown_total)+"） ",1)]),_:2},1024)):P("",!0)])]),y.answer?(u(),v("div",Qn,[m[11]||(m[11]=e("div",{class:"list-label"},"答案",-1)),e("div",Vn,T(y.answer),1)])):P("",!0),me((u(),v("div",Hn,[(u(!0),v(E,null,te(y.images,(Y,J)=>(u(),v("img",{key:J,src:Y,alt:""},null,8,Xn))),128))])),[[t]])])]),_:1}),n(Z,{key:"show_date",title:"触发日期",width:120},{default:o(({record:y})=>[$(T(y.show_date),1)]),_:1}),n(Z,{key:"to_library_id",title:"是否导入知识库",width:160},{default:o(({record:y})=>[e("div",Zn,[y.to_library_id>0?(u(),v("div",Wn,[...m[12]||(m[12]=[e("span",null,null,-1),$(" 已导入 ",-1)])])):(u(),v("div",eo,[...m[13]||(m[13]=[e("span",null,null,-1),$(" 未导入 ",-1)])])),e("a",{href:`/#/library/details/knowledge-document?id=${y.to_library_id}`,target:"_blank"},T(y.to_library_name),9,to)])]),_:1}),n(Z,{key:"action",title:"操作",width:135},{default:o(({record:y})=>[n(se,{gap:8},{default:o(()=>[e("a",{onClick:Y=>_(y)},"设置答案",8,no),e("a",{onClick:Y=>a(y)},"导入知识库",8,oo)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])]),n(Dn,{onOk:h,ref_key:"importLibraryModalRef",ref:i},null,512),n(zn,{onOk:B,ref_key:"autoClusterModalRef",ref:f},null,512),n(An,{onOk:h,ref_key:"setAnswerModalRef",ref:I},null,512)])}}},ao=H(so,[["__scopeId","data-v-993551f2"]]),lo={class:"user-model-page"},he="/robot/config/unknown_issue/activeKey",io={__name:"unknow-index",setup(j){const N=xe(),U=d(+localStorage.getItem(he)||1),S=W(()=>N.robotInfo),s=W(()=>S.value.unknown_summary_status==1),b=()=>{localStorage.setItem(he,U.value)};return(l,c)=>{const r=fe,C=ve,D=Ee;return u(),v(E,null,[n(C,{class:"tab-wrapper",activeKey:U.value,"onUpdate:activeKey":c[0]||(c[0]=h=>U.value=h),onChange:b},{default:o(()=>[s.value?(u(),v(E,{key:0},[(u(),R(r,{key:2,tab:"未知问题总结"})),(u(),R(r,{key:1,tab:"未知问题统计"}))],64)):(u(),v(E,{key:1},[(u(),R(r,{key:1,tab:"未知问题统计"})),(u(),R(r,{key:2,tab:"未知问题总结"}))],64))]),_:1},8,["activeKey"]),e("div",lo,[n(D,null,{default:o(()=>[U.value==1?(u(),R(At,{key:0})):(u(),R(ao,{key:1}))]),_:1})])],64)}}},Io=H(io,[["__scopeId","data-v-70d9105a"]]);export{Io as default};
