import{u as oe,bj as ie,bk as ce,bb as fe,b9 as W,o as ve,_ as xe}from"../../index-DSFcP5NQ.js";import{_ as le}from"./default-cover-Bm8pZ2KF.js";import{r as w,E as _e,w as de,j as ue,J as me,e as v,b as s,t as f,p as o,a as _,v as a,u as n,F as we,l as Ce,y as l,q as T,_ as R,i as be,ag as Se,h as $e}from"./vue-chunks-BdaA73Wf.js";import{a as Te}from"./index-C67uUbSa.js";import{ad as Z,ae as ze,af as Re,ag as ee,ah as te,ai as se,aj as ae,ak as Ae,al as Me}from"./index-Cg7-0swo.js";import{_ as re}from"./emoji-mart-BBMRoEa3.js";import{X as Oe,an as pe,b2 as ne,ai as De,ag as Ie,_ as Be,M as A,b as $,O as M,B as Ee,x as Fe,q as Le,H as Ne,b9 as Ue,i as Ve,f as He,g as Ke}from"./ui-antd-Dl1wwwCD.js";import{C as je,a as qe}from"./create-send-modal-Dj8lPHTY.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";const Je={class:"article-card"},Pe=["src"],Xe={key:1,class:"thumb",src:le},Ye={class:"info"},Ge={class:"title"},Qe={class:"meta"},We={class:"digest"},Ze={class:"comment-header"},et={class:"comment-content"},tt={class:"top-line"},st={class:"name"},at={class:"time"},nt={key:1,class:"delete-status"},ot={key:2,class:"actions"},it={class:"text"},ct={key:0,class:"ai-reply"},lt={class:"top-line ai-reply-content"},_t={class:"ai-replay-content-right"},dt={class:"ai-replay-content-right-top"},ut={class:"name ai"},mt={class:"time"},rt={key:0,class:"delete-status"},pt={key:1,class:"actions"},ht={class:"text"},gt={key:0,class:"empty"},kt={key:1,class:"load-more-tips"},yt={key:0},ft={key:1},vt={key:1,class:"loading-box"},xt={__name:"comment-drawer",setup(V,{expose:q}){const{t:e}=oe("views.explore.article-group-send.components.comment-drawer"),O=ve,H=fe,z=w(!1),r=w({}),N=w(!1),p=_e({page:1,size:20,total:0}),b=w([]),D=w(!0),I=w(!1),k=w(null);let x=null;const J=u=>{r.value={...u},z.value=!0,p.page=1,U()},U=()=>{N.value=!0,Z({task_id:r.value.id,page:p.page,size:p.size}).then(u=>{const g=(u==null?void 0:u.data)||{};b.value=Array.isArray(g.list)?g.list:[],p.page=+g.page||p.page,p.size=+g.size||p.size,p.total=+g.total||b.value.length||0,D.value=b.value.length<p.total}).finally(()=>{N.value=!1})},P=u=>{A.confirm({title:e("modal_delete_comment_title"),icon:l(M),okText:e("btn_delete"),cancelText:e("btn_cancel"),onOk:async()=>{await ze({msg_id:u.msg_data_id,comment_id:u.user_comment_id,access_key:r.value.access_key}),$.success(e("message_delete_success")),U()}})},X=u=>{A.confirm({title:e("modal_delete_reply_title"),icon:l(M),okText:e("btn_delete"),cancelText:e("btn_cancel"),onOk:async()=>{await Re({msg_id:u.msg_data_id,comment_id:u.user_comment_id,access_key:r.value.access_key}),$.success(e("message_delete_success")),U()}})};q({show:J});const B=u=>{if(!u)return e("default_user_name");const g=String(u).slice(-4);return e("user_name_with_suffix",{suf:g})},Y=u=>String(u.comment_type)==="1"?!0:String(u.ai_comment_result_text||"").includes(e("auto_feature_keyword")),G=()=>{k.value&&(x=k.value.closest(".ant-drawer-body"),x&&x.addEventListener("scroll",K,{passive:!0}))},E=()=>{x&&(x.removeEventListener("scroll",K),x=null)},K=()=>{if(!D.value||I.value||!x)return;if(x.scrollTop+x.clientHeight>=x.scrollHeight-80){I.value=!0;const F=p.page+1;Z({task_id:r.value.id,page:F,size:p.size}).then(t=>{const c=(t==null?void 0:t.data)||{},d=Array.isArray(c.list)?c.list:[];p.page=+c.page||F,p.size=+c.size||p.size,p.total=+c.total||p.total,b.value=b.value.concat(d),D.value=b.value.length<p.total}).finally(()=>{I.value=!1})}};return de(z,u=>{u?(D.value=!0,I.value=!1,be(G)):E()}),ue(()=>{ie()}),me(()=>{ce()}),(u,g)=>{const F=Oe,t=pe,c=De,d=Ie,y=Be;return s(),v(y,{open:z.value,"onUpdate:open":g[0]||(g[0]=m=>z.value=m),title:n(e)("drawer_title"),width:420,destroyOnClose:!0},{default:f(()=>[o("div",Je,[r.value.thumb_url?(s(),_("img",{key:0,class:"thumb",src:r.value.thumb_url},null,8,Pe)):(s(),_("img",Xe)),o("div",Ye,[o("div",Ge,a(r.value.title),1),o("div",Qe,a(n(e)("article_group_label"))+a(r.value.group_name),1),o("div",We,a(r.value.digest),1)])]),o("div",Ze,a(n(e)("comment_header",{total:p.total})),1),N.value?(s(),_("div",vt,[l(d)])):(s(),_("div",{key:0,class:"list-box",ref_key:"bodyAnchorRef",ref:k},[(s(!0),_(we,null,Ce(b.value,m=>(s(),_("div",{class:"comment-item",key:m.id},[l(F,{size:40,src:n(H)},null,8,["src"]),o("div",et,[o("div",tt,[o("span",st,a(B(m.open_id)),1),Y(m)?(s(),v(t,{key:0,color:"#FF4D4F",style:{"margin-right":"0"}},{default:f(()=>[R(a(n(e)("tag_selected")),1)]),_:1})):T("",!0),o("span",at,a(n(W)(m.comment_create_time)),1),m.delete_status=="1"?(s(),_("div",nt,a(n(e)("deleted_status")),1)):(s(),_("span",ot,[l(n(ne),{class:"delete-icon",onClick:C=>P(m)},null,8,["onClick"])]))]),o("div",it,a(m.content_text),1),m.reply_comment_text?(s(),_("div",ct,[o("div",lt,[l(F,{size:32,src:n(O),style:{"flex-basis":"32px"}},null,8,["src"]),o("div",_t,[o("div",dt,[o("span",ut,a(n(e)("ai_bot_name")),1),o("span",mt,a(n(W)(m.reply_create_time)),1),m.delete_status=="1"?(s(),_("div",rt,a(n(e)("deleted_status")),1)):(s(),_("span",pt,[l(n(ne),{class:"delete-icon",onClick:C=>X(m)},null,8,["onClick"])]))]),o("div",ht,a(m.reply_comment_text),1)])])])):T("",!0)])]))),128)),b.value.length===0?(s(),_("div",gt,[l(c,{description:n(e)("empty_no_comment")},null,8,["description"])])):(s(),_("div",kt,[I.value?(s(),_("span",yt,a(n(e)("load_more_loading")),1)):D.value?T("",!0):(s(),_("span",ft,a(n(e)("load_more_no_more")),1))]))],512))]),_:1},8,["open","title"])}}},wt=re(xt,[["__scopeId","data-v-8a801bbf"]]),Ct={class:"group-send-wrapper"},bt={class:"toolbar"},St={class:"table-box"},$t={key:0},Tt=["onClick"],zt={class:"expanded-draft"},Rt=["src"],At={key:1,class:"thumb",src:le},Mt={class:"info"},Ot={class:"title"},Dt={class:"meta"},It={class:"digest"},Bt=["onClick"],Et={key:0,class:"task-cell"},Ft={class:"name"},Lt={key:1,class:"send-time-cell"},Nt={key:0,class:"time"},Ut={key:1,class:"time"},Vt={key:2,style:{color:"#595959"}},Ht={key:5,class:"ai-comment-cell"},Kt={class:"comment-rule-cell"},jt={class:"rule"},qt={key:0,class:"default-tag"},Jt=["onClick"],Pt=["onClick"],Xt={__name:"group-send",props:{appId:{type:String,default:""},accessKey:{type:String,default:""}},setup(V){const q=Se(),{t:e}=oe("views.explore.article-group-send.group-send"),O=V,H=w([]),z=w(!1),r=_e({page:1,size:10,total:0}),N={"-1":e("status_deleted"),0:e("status_not_sent"),1:e("status_sending"),2:e("status_sent"),3:e("status_failed")},p={0:e("receiver_all_fans")},b=[{title:e("column_task_name"),dataIndex:"task_name",key:"task_name"},{title:e("column_send_time"),dataIndex:"send_time",key:"send_time"},{title:e("column_receiver"),dataIndex:"receiver",key:"receiver"},{title:e("column_open_status"),dataIndex:"open_status",key:"open_status"},{title:e("column_comment_status"),dataIndex:"comment_status",key:"comment_status"},{title:e("column_ai_comment_status"),dataIndex:"ai_comment_status",key:"ai_comment_status"},{title:e("column_actions"),dataIndex:"actions",key:"actions"}],D=t=>{r.page=t.current,r.size=t.pageSize,k()},I=t=>t.is_top=="1"?"row-top":"",k=()=>{z.value=!0,Me({page:r.page,size:r.size,app_id:O.appId}).then(t=>{const c=(t==null?void 0:t.data)||{list:[],total:0};c.list.forEach(d=>{d.send_res=JSON.parse(d.send_res||"{}")}),H.value=c.list||[],r.total=+c.total||0}).finally(()=>{z.value=!1})},x=async t=>{if(t.is_top=="1"){A.confirm({title:e("modal_unpin_title"),icon:l(M),onOk:async()=>{await ae({task_id:t.id,is_top:t.is_top=="1"?0:1}),$.success(e("message_unpinned")),k()}});return}await ae({task_id:t.id,is_top:t.is_top=="1"?0:1}),$.success(t.is_top=="1"?e("message_unpinned"):e("message_pinned")),k()},J=t=>{A.confirm({title:e("modal_delete_task_title",{name:t.task_name}),icon:l(M),onOk:async()=>{await Ae({task_id:t.id}),$.success(e("message_delete_success")),k()}})},U=async(t,c)=>{const d=c?1:0;if(!c){A.confirm({title:e("modal_close_send_title"),icon:l(M),onOk:async()=>{await ee({task_id:t.id,open_status:d}),t.open_status=String(d),$.success(e("message_send_closed")),k()}});return}await ee({task_id:t.id,open_status:d}),t.open_status=String(d),$.success(e("message_operation_success"))},P=async(t,c)=>{var y,m;if(c)try{const C=await Te({ability_type:"official_account_ai_comment"}),L=(m=(y=C==null?void 0:C.data)==null?void 0:y.user_config)==null?void 0:m.switch_status;if(String(L||"0")!=="1"){A.confirm({title:e("modal_ai_comment_title"),content:l("div",null,[l("span",{style:"color: #ff4d4f;"},e("modal_ai_comment_not_enabled")),l("span",null,e("modal_ai_comment_not_enabled_tip"))]),okText:e("modal_ai_comment_ok"),cancelText:e("btn_cancel"),onOk:()=>{q.push("/explore/index/ai-comment-management")}});return}}catch(C){console.error(C)}const d=c?1:0;if(!c){A.confirm({title:e("modal_close_ai_rule_title"),icon:l(M),onOk:async()=>{await se({task_id:t.id,ai_comment_status:d}),t.ai_comment_status=String(d),$.success(e("message_ai_rule_closed")),k()}});return}await se({task_id:t.id,ai_comment_status:d}),t.ai_comment_status=String(d),E.value&&E.value.show({...t})},X=async(t,c)=>{const d=c?1:0;if(!c){A.confirm({title:e("modal_close_comment_title"),icon:l(M),onOk:async()=>{await te({task_id:t.id,msg_id:t.msg_data_id,access_key:O.accessKey,comment_status:d}),t.comment_status=String(d),$.success(e("message_comment_closed")),k()}});return}await te({task_id:t.id,msg_id:t.msg_data_id,access_key:O.accessKey,comment_status:d}),t.comment_status=String(d),$.success(e("message_operation_success"))},B=w(null),Y=t=>{B.value&&B.value.show({task:t})},G=()=>{B.value&&B.value.show({})},E=w(null),K=t=>{E.value&&E.value.show({...t})},u=t=>{if(!t)return"";const c=new Date(Number(t)*1e3),d=String(c.getFullYear()).slice(2),y=String(c.getMonth()+1).padStart(2,"0"),m=String(c.getDate()).padStart(2,"0"),C=String(c.getHours()).padStart(2,"0"),L=String(c.getMinutes()).padStart(2,"0");return`${d}-${y}-${m} ${C}:${L}`};de(()=>O.appId,()=>{r.page=1,O.appId&&k()},{immediate:!0}),ue(()=>{ie()}),me(()=>{ce()});const g=w(null),F=t=>{g.value&&g.value.show({...t})};return(t,c)=>{const d=Ee,y=xe,m=pe,C=Le,L=Ne,Q=Ke,he=He,ge=Ve,ke=Ue,ye=Fe;return s(),_("div",Ct,[o("div",bt,[l(d,{type:"primary",onClick:G},{default:f(()=>[R(a(n(e)("btn_create_send")),1)]),_:1})]),o("div",St,[l(ye,{columns:b,"data-source":H.value,loading:z.value,"row-key":"id",pagination:{current:r.page,pageSize:r.size,total:r.total,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:D,"row-class-name":I},{headerCell:f(({column:h})=>[typeof h.title=="string"?(s(),_("span",$t,a(h.title),1)):T("",!0)]),expandIcon:f(({expanded:h,onExpand:i,record:j})=>[o("span",{class:"expand-icon",onClick:S=>i(j)},[h?(s(),v(y,{key:0,name:"table-hide",size:"16px"})):(s(),v(y,{key:1,name:"table-expand",size:"16px"}))],8,Tt)]),expandedRowRender:f(({record:h})=>[o("div",zt,[h.thumb_url?(s(),_("img",{key:0,class:"thumb",src:h.thumb_url},null,8,Rt)):(s(),_("img",At)),o("div",Mt,[o("div",Ot,a(h.title),1),o("div",Dt,a(n(e)("expanded_group_label"))+a(h.group_name),1),o("div",It,a(h.digest||n(e)("expanded_no_digest")),1)]),o("div",{class:"expanded-meta",onClick:i=>F(h)},[l(y,{name:"comment",size:"32px",style:{color:"transparent"}}),R(" "+a(h.max_comment_id),1)],8,Bt)])]),bodyCell:f(({column:h,record:i})=>{var j;return[h.key==="task_name"?(s(),_("div",Et,[i.is_top=="1"?(s(),v(m,{key:0,color:"blue"},{default:f(()=>[R(a(n(e)("tag_pinned")),1)]),_:1})):T("",!0),o("span",Ft,a(i.task_name),1)])):h.key==="send_time"?(s(),_("div",Lt,[o("div",{class:$e(["status-tag",{"status-sending":i.send_status=="1","status-success":i.send_status=="2"}])},[i.send_status=="-1"?(s(),v(y,{key:0,style:{color:"white"},name:"status-fail"})):i.send_status=="0"?(s(),v(y,{key:1,style:{color:"white"},name:"status-fail"})):i.send_status=="1"?(s(),v(y,{key:2,style:{color:"white"},name:"status-sending"})):i.send_status=="2"?(s(),v(y,{key:3,style:{color:"white"},name:"status-success"})):i.send_status=="3"?(s(),v(y,{key:4,style:{color:"white"},name:"status-fail"})):T("",!0),R(" "+a(N[i.send_status])+" ",1),i.send_status==="3"?(s(),v(C,{key:5,title:(j=i.send_res)==null?void 0:j.errmsg},{default:f(()=>[l(n(M),{style:{"font-size":"16px",color:"#FF4D4F"}})]),_:1},8,["title"])):T("",!0)],2),i.send_time!="0"?(s(),_("div",Nt,a(n(e)("scheduled_send_prefix"))+a(u(i.send_time)),1)):(s(),_("div",Ut,a(n(e)("immediate_send_prefix"))+a(u(i.create_time)),1))])):h.key==="receiver"?(s(),_("span",Vt,a(p[i.to_user_type]||n(e)("receiver_all_fans")),1)):h.key==="open_status"?(s(),v(L,{key:3,checked:i.open_status=="1","checked-children":n(e)("switch_on"),"un-checked-children":n(e)("switch_off"),onChange:S=>U(i,S)},null,8,["checked","checked-children","un-checked-children","onChange"])):h.key==="comment_status"?(s(),v(L,{key:4,checked:i.comment_status=="1","checked-children":n(e)("switch_on"),"un-checked-children":n(e)("switch_off"),onChange:S=>X(i,S)},null,8,["checked","checked-children","un-checked-children","onChange"])):h.key==="ai_comment_status"?(s(),_("div",Ht,[l(L,{checked:i.ai_comment_status=="1","checked-children":n(e)("switch_on"),"un-checked-children":n(e)("switch_off"),onChange:S=>P(i,S)},null,8,["checked","checked-children","un-checked-children","onChange"]),o("div",Kt,[o("span",jt,[i.is_default=="1"?(s(),_("span",qt,a(n(e)("tag_default")),1)):T("",!0),R(" "+a(i.comment_rule_name||n(e)("default_rule_name")),1)]),o("a",{class:"edit-link",onClick:S=>K(i)},a(n(e)("link_edit_rule")),9,Jt)])])):h.key==="actions"?(s(),v(ke,{key:6,style:{gap:"16px"}},{default:f(()=>[o("a",{onClick:S=>Y(i)},a(n(e)("action_edit_task")),9,Pt),l(ge,null,{overlay:f(()=>[l(he,null,{default:f(()=>[l(Q,{onClick:S=>x(i)},{default:f(()=>[R(a(i.is_top=="1"?n(e)("menu_unpin"):n(e)("menu_pin")),1)]),_:2},1032,["onClick"]),l(Q,{onClick:S=>J(i)},{default:f(()=>[R(a(n(e)("menu_delete_task")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:f(()=>[o("a",null,a(n(e)("action_more")),1)]),_:2},1024)]),_:2},1024)):T("",!0)]}),_:1},8,["data-source","loading","pagination"])]),l(wt,{ref_key:"commentDrawerRef",ref:g},null,512),l(je,{ref_key:"commentRuleModalRef",ref:E,onUpdated:k},null,512),l(qe,{ref_key:"editSendModalRef",ref:B,"app-id":V.appId,"access-key":V.accessKey,onUpdated:k,onCreated:k},null,8,["app-id","access-key"])])}}},_s=re(Xt,[["__scopeId","data-v-15ec03a8"]]);export{_s as default};
//# sourceMappingURL=group-send-os-pA1ut.js.map
