import{_ as j,a as H,cm as J,cn as Q,ab as X,ac as Y,d as Z}from"../../index-C5-B0r5-.js";import{f as r,r as D,e as tt,o as et,aw as ot,ac as p,as as t,k as v,ai as E,az as M,at as u,F as R,ax as V,ar as x,u as f,ae as C,av as at,aA as st,ad as l,G as A,B as nt,l as L}from"./vue-chunks-CGLjTDrY.js";import{_ as lt}from"./main-tab-l3aTCLmE.js";import{E as it}from"./empty-box-C5iAwHZS.js";import{L as ct}from"./loading-box-CAF9T3Ud.js";/* empty css                                                                     */import{g as rt,a as ut,u as dt}from"./template-DleTldTB.js";import{a0 as _t,I as pt,v as vt,bK as mt,M as $,W as O,b as ft}from"./ui-antd-B11sc9DP.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./list-tabs-QMUGd4nq.js";import"./index-y6Ut8zwU.js";import"./empty-BFmzY9bl.js";const gt={class:"_container"},ht={class:"header"},kt={class:"main-tab-box"},yt={class:"content"},bt={class:"left-box hide-scrollbar"},xt={class:"cate-box"},Ct={key:0,class:"count"},Tt=["onClick"],wt={class:"count"},zt={class:"filter-box"},St={class:"_plugin-box"},Nt={key:0,class:"plugin-list"},Bt={class:"base-info"},Dt=["src"],Et={class:"info"},Mt={class:"head"},Rt={class:"name zm-line1"},Vt={class:"source"},At=["src"],Lt={class:"zm-line1"},$t={class:"action-box"},Ot={class:"left"},qt={class:"right"},Ft=["onClick"],It={__name:"index",setup(Pt){const T=ot(),q=at(),w=r(null);r(localStorage.getItem("zm:explore:active")||"4");const g=r(!0),z=r(!1),h=r([]),S=r([]),k=r(0),n=D({keyword:"",category:null}),i=D({current:1,pageSize:50,total:0}),F=H(),{companyInfo:b}=F,I=tt(()=>b==null?void 0:b.version);et(()=>{T.query.active>1&&w.value.change(T.query.active),P()});function P(){U(),y()}function U(){rt().then(o=>{let e=(o==null?void 0:o.data)||[];k.value=0,e.map(s=>k.value+=Number((s==null?void 0:s.template_count)||0)),S.value=e})}async function y(){var e;g.value=!0;let o={page:i.current,size:i.pageSize};n.keyword&&(o.keyword=n.keyword),n.category&&(o.category_id=(e=n.category)==null?void 0:e.id),ut(o).then(s=>{var d,_;let c=((d=s==null?void 0:s.data)==null?void 0:d.data)||[];(!c.length||c.length<i.pageSize)&&(z.value=!0),h.value.push(...c),i.current+=1,i.total=Number(((_=s==null?void 0:s.data)==null?void 0:_.total)||0)}).finally(()=>{g.value=!1})}function G(o){g.value||z.value||J(o,y)}function N(){i.current=1,i.total=0,h.value=[],y()}function B(o){n.category=o,N()}function K(o,e){return o=Number(o.replace(/\D/g,"")),e=Number(e.replace(/\D/g,"")),o>=e}function W(o){const e=()=>{dt({template_id:o.id,csl_url:o.csl_url}).then(s=>{ft.success("使用成功"),y();const{id:c,robot_key:d}=s.data,_=q.resolve({path:"/robot/config/workflow",query:{id:c,robot_key:d}});window.open(_.href,"_blank")})};K(I.value,o.version)?$.confirm({title:"提示",content:`确定使用模板【${o.name}】创建应用吗?`,icon:L(O),okText:"确 认",cancelText:"取 消",onOk:e}):$.confirm({title:"提示",content:"当前系统版本过低，可能无法使用此模板；请您升级到最新版本后使用！",icon:L(O),okText:"继续使用",cancelText:"取 消",onOk:e})}return(o,e)=>{const s=pt,c=vt,d=Z,_=st("router-link");return l(),p("div",gt,[t("div",ht,[t("div",kt,[v(lt,{ref_key:"tabRef",ref:w},null,512)])]),t("div",yt,[t("div",bt,[e[3]||(e[3]=t("div",{class:"title"},"模板分类",-1)),t("div",xt,[t("div",{class:E(["cate-item",{active:!n.category}]),onClick:e[0]||(e[0]=a=>B(null))},[e[2]||(e[2]=t("div",null,"全部",-1)),k.value>0?(l(),p("span",Ct,u(k.value),1)):M("",!0)],2),(l(!0),p(R,null,V(S.value,a=>{var m;return l(),p("div",{key:a.id,class:E(["cate-item",{active:a.id==((m=n.category)==null?void 0:m.id)}]),onClick:Ut=>B(a)},[t("div",null,u(a.name),1),t("span",wt,u(a.template_count||0),1)],10,Tt)}),128))])]),t("div",{class:"right-box",onScroll:G},[t("div",zt,[v(s,{value:n.keyword,"onUpdate:value":e[1]||(e[1]=a=>n.keyword=a),valueModifiers:{trim:!0},onChange:N,style:{width:"360px"},allowClear:"",placeholder:"输入名称、描述搜索"},{suffix:x(()=>[v(f(_t))]),_:1},8,["value"]),e[4]||(e[4]=t("div",null,null,-1))]),t("div",St,[h.value.length?(l(),p("div",Nt,[(l(!0),p(R,null,V(h.value,a=>(l(),C(_,{class:"plugin-item",key:a.id,to:`/templates/detail?key=${a.robot_id}`,target:"_blank"},{default:x(()=>[t("div",Bt,[t("img",{class:"avatar",src:a.avatar||f(Q)},null,8,Dt),t("div",Et,[t("div",Mt,[t("span",Rt,u(a.name),1)]),t("div",Vt,[t("img",{class:"author-avatar",src:a.account_avatar},null,8,At),t("span",Lt,u(a.author),1)])])]),v(c,{title:f(X)(a.description,a,14,2.5,60),placement:"top"},{default:x(()=>[t("div",{class:"desc zm-line",ref_for:!0,ref:m=>f(Y)(m,a)},u(a.description),513)]),_:2},1032,["title"]),t("div",$t,[t("div",Ot,[v(f(mt)),A(" "+u(a.use_count||0),1)]),t("div",qt,[t("a",{onClick:nt(m=>W(a),["stop","prevent"])},[v(d,{name:"icon-rocket"}),e[5]||(e[5]=A(" 使用模板",-1))],8,Ft)])])]),_:2},1032,["to"]))),128))])):(l(),C(it,{key:1,title:"暂无可用插件"})),g.value?(l(),C(ct,{key:2})):M("",!0)])],32)])])}}},se=j(It,[["__scopeId","data-v-915318da"]]);export{se as default};
