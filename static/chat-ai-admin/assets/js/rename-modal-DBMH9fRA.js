import{V as ee,ag as B,bG as E,v as ae,a8 as te,O as se,I as H,a6 as ne,B as le,y as oe,af as ie,at as ue,M as V,d as ce,b as h}from"./ui-antd-BHaxN-GS.js";import{_ as P,a$ as de,b0 as _e,b1 as pe,b2 as ve,b3 as re,aM as fe}from"../../index-CB2DywzJ.js";import{f as w,ae as p,ad as n,ar as _,as as l,ac as u,F as x,ax as J,k as o,u as f,at as C,az as G,G as M}from"./vue-chunks-CGLjTDrY.js";const he={class:"_main"},me={key:0,class:"meta-card edit-box"},ye={class:"left"},ke=["onClick"],be={class:"meta-name"},ge={class:"meta-type"},Ce={class:"mt16"},we={key:0,class:"meta-card"},xe={key:0,class:"meta-edit-item"},Me={class:"action-box"},Ue={key:1,class:"meta-item"},Oe={class:"left"},Ie=["onClick"],Se={class:"meta-name"},$e={class:"meta-type"},Ne={class:"right"},De={class:"meta-card"},Le={class:"left"},Be=["onClick"],Ee={class:"meta-name"},Je={class:"meta-type"},Ve={__name:"metadata-manage-modal",props:{libraryId:{type:[String,Number]},fileId:{type:[String,Number]},qaIds:{type:Array,default:()=>[]}},emits:["change"],setup(q,{expose:N,emit:D}){const S=D,c=q,m=[{value:1,label:"列表显示"},{value:0,label:"列表隐藏"}],$=[{value:0,label:"string"},{value:1,label:"time"},{value:2,label:"number"}],U={0:"string",1:"time",2:"number"},k=w(!1),y=w(!1),v=w(!1),d=w([]),O=w([]);function I(t=!1,e=null){Array.isArray(e)?F(e):R(),v.value=t,k.value=!0}function R(){de({library_id:c.libraryId}).then(t=>{F((t==null?void 0:t.data)||[])})}function F(t){d.value=[],O.value=[];for(let e of t)e.is_builtin==1?O.value.push(e):(e.backup=JSON.parse(JSON.stringify(e)),e.type==1&&e.value>0&&(e.value=ce(e.value*1e3)),e.is_edit=!1,e.checked=!1,d.value.push(e))}function j(){d.value.unshift({id:"",is_edit:!0,is_builtin:0,is_show:0,name:"",type:0,library_id:c.libraryId,backup:{}})}function z(t,e){V.confirm({title:"提示",content:"确认删除该元数据？",okText:"删除",cancelText:"取消",onOk:()=>{pe({id:t.id}).then(()=>{d.value.splice(e,1),h.success("已删除")})}})}function Q(t,e){if(!t.id)d.value.splice(e,1);else{const{name:i,type:r,is_show:b}=t.backup;t.name=i,t.type=r,t.is_show=b,t.is_edit=!1}}function L(t){t.is_show=t.is_show==1?0:1,Y(t)}function Y(t){if(!t.name)return h.warning("请输入元数据名称");_e({...t,is_show:Number(t.is_show),library_id:c.libraryId}).then(e=>{const{name:i,type:r,is_show:b}=t;t.id=e==null?void 0:e.data,t.is_edit=!1,t.backup={name:i,type:r,is_show:b},h.success("已保存"),S("change")})}function K(){if(!d.value.length)return h.error("暂无可用元数据");let t=[];for(let i of d.value){if(!i.checked)continue;let r=i.value;i.type==1&&(i.value?r=i.value.startOf("minute").unix():r=""),t.push({key:i.key,value:r})}if(!t.length)return h.error("请选择修改数据");let e;if(c.qaIds.length)e=ve({ids:c.qaIds.toString(),list:JSON.stringify(t)});else if(c.fileId)e=re({file_id:c.fileId,list:JSON.stringify(t)});else return h.error("缺少知识库信息");e.then(()=>{h.success("已保存"),S("change"),k.value=!1})}return N({show:I}),(t,e)=>{const i=le,r=ee,b=ae,W=te,X=se,A=H,T=oe,Z=V;return n(),p(Z,{open:k.value,"onUpdate:open":e[1]||(e[1]=a=>k.value=a),width:"746px","confirm-loading":y.value},{title:_(()=>[l("div",null,[M(C(v.value?"修改元数据":"元数据管理")+" ",1),e[2]||(e[2]=l("span",{class:"desc"},"元数据用于描述文档的属性。应用召回知识时可根据元数据进行筛选",-1))])]),footer:_(()=>[v.value?(n(),u(x,{key:0},[o(i,{onClick:e[0]||(e[0]=a=>k.value=!1)},{default:_(()=>[...e[3]||(e[3]=[M("取 消",-1)])]),_:1}),o(i,{type:"primary",onClick:K},{default:_(()=>[...e[4]||(e[4]=[M("保 存",-1)])]),_:1})],64)):G("",!0)]),default:_(()=>[l("div",he,[v.value?(n(),u("div",me,[(n(!0),u(x,null,J(d.value,(a,g)=>(n(),u("div",{key:g,class:"meta-item"},[l("div",ye,[o(r,{checked:a.checked,"onUpdate:checked":s=>a.checked=s},null,8,["checked","onUpdate:checked"]),o(b,{title:a.is_show==1?"列表显示":"列表隐藏"},{default:_(()=>[l("span",{onClick:s=>L(a)},[a.is_show==1?(n(),p(f(B),{key:0,class:"icon"})):(n(),p(f(E),{key:1,class:"icon"}))],8,ke)]),_:2},1032,["title"]),l("span",be,C(a.name),1),l("span",ge,C(U[a.type]),1)]),a.type==1?(n(),p(W,{key:0,value:a.value,"onUpdate:value":s=>a.value=s,format:"YYYY-MM-DD HH:mm",class:"input-box",onChange:s=>a.checked=!0},null,8,["value","onUpdate:value","onChange"])):a.type===2?(n(),p(X,{key:1,value:a.value,"onUpdate:value":s=>a.value=s,placeholder:"请输入",maxlength:20,class:"input-box",onChange:s=>a.checked=!0},null,8,["value","onUpdate:value","onChange"])):(n(),p(A,{key:2,value:a.value,"onUpdate:value":s=>a.value=s,valueModifiers:{trim:!0},placeholder:"请输入",maxlength:20,class:"input-box",onChange:s=>a.checked=!0},null,8,["value","onUpdate:value","onChange"]))]))),128))])):(n(),u(x,{key:1},[l("div",Ce,[o(i,{type:"primary",ghost:"",onClick:j},{default:_(()=>[o(f(ne)),e[5]||(e[5]=M(" 新增元数据 ",-1))]),_:1})]),d.value.length?(n(),u("div",we,[(n(!0),u(x,null,J(d.value,(a,g)=>(n(),u(x,{key:g},[a.is_edit?(n(),u("div",xe,[o(A,{value:a.name,"onUpdate:value":s=>a.name=s,valueModifiers:{trim:!0},placeholder:"请输入",maxlength:20},null,8,["value","onUpdate:value"]),o(T,{value:a.type,"onUpdate:value":s=>a.type=s,options:$,class:"min",disabled:a.id>0},null,8,["value","onUpdate:value","disabled"]),o(T,{value:a.is_show,"onUpdate:value":s=>a.is_show=s,options:m,class:"min"},null,8,["value","onUpdate:value"]),l("div",Me,[o(i,{onClick:s=>Q(a,g)},{default:_(()=>[...e[6]||(e[6]=[M("取 消",-1)])]),_:1},8,["onClick"]),o(i,{type:"primary",onClick:s=>Y(a)},{default:_(()=>[...e[7]||(e[7]=[M("保 存",-1)])]),_:1},8,["onClick"])])])):(n(),u("div",Ue,[l("div",Oe,[o(b,{title:a.is_show==1?"列表显示":"列表隐藏"},{default:_(()=>[l("span",{onClick:s=>L(a)},[a.is_show==1?(n(),p(f(B),{key:0,class:"icon"})):(n(),p(f(E),{key:1,class:"icon"}))],8,Ie)]),_:2},1032,["title"]),l("span",Se,C(a.name),1),l("span",$e,C(U[a.type]),1)]),l("div",Ne,[o(f(ie),{class:"icon",onClick:s=>a.is_edit=!0},null,8,["onClick"]),o(f(ue),{class:"icon",onClick:s=>z(a,g)},null,8,["onClick"])])]))],64))),128))])):G("",!0),l("div",De,[e[8]||(e[8]=l("div",{class:"meta-tit"},"内置",-1)),(n(!0),u(x,null,J(O.value,(a,g)=>(n(),u("div",{key:g,class:"meta-item"},[l("div",Le,[o(b,{title:a.is_show==1?"列表显示":"列表隐藏"},{default:_(()=>[l("span",{onClick:s=>L(a)},[a.is_show==1?(n(),p(f(B),{key:0,class:"icon"})):(n(),p(f(E),{key:1,class:"icon"}))],8,Be)]),_:2},1032,["title"]),l("span",Ee,C(a.name),1),l("span",Je,C(U[a.type]),1)])]))),128))])],64))])]),_:1},8,["open","confirm-loading"])}}},Ge=P(Ve,[["__scopeId","data-v-1f1f76a8"]]),qe={class:"rename-input"},Fe={__name:"rename-modal",emits:["ok"],setup(q,{expose:N,emit:D}){const S=D,c=w(!1),m=w("");let $="";const U=(y={})=>{y=JSON.parse(JSON.stringify(y)),m.value=y.file_name,$=y.id,c.value=!0},k=()=>{m.value||h.error("请输入文档名称"),fe({id:$,file_name:m.value}).then(y=>{h.success("重命名成功"),S("ok",m.value),c.value=!1})};return N({show:U}),(y,v)=>{const d=H,O=V;return n(),u("div",null,[o(O,{open:c.value,"onUpdate:open":v[1]||(v[1]=I=>c.value=I),title:"重命名",onOk:k},{default:_(()=>[l("div",qe,[o(d,{value:m.value,"onUpdate:value":v[0]||(v[0]=I=>m.value=I),placeholder:"请输入文档名称"},null,8,["value"])])]),_:1},8,["open"])])}}},He=P(Fe,[["__scopeId","data-v-28464ce6"]]);export{Ge as M,He as R};
