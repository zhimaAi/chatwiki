import{I as Z,b as D,B as J,d as E,k as q,dh as K}from"../../index-DDbybdOX.js";import{_ as W}from"./cu-scroll-DYkc5Wqz.js";import{_ as Y}from"./empty-DkpCLaix.js";import{j as i,a3 as F,d as k,z as ee,b as te,N as a,O as n,X as e,a6 as g,U as c,Z as f,S as x,u as w,F as R,a1 as z,a5 as se,_,a2 as oe}from"./vue-chunks-BRsu9_To.js";import{_ as ne}from"./recommendation-AQ4_FPQ9.js";import{h as ie}from"./index-Cwb5QxND.js";import{D as le}from"./DownOutlined-CZgAT6ZI.js";import{U as ae}from"./UpOutlined-DP4GhiZr.js";import{Q as V}from"./QuestionCircleOutlined-Cc7dIocD.js";import{i as re,a as de,S as ce}from"./index-D1-T_LNn.js";import{_ as _e}from"./TextArea-BjyYZVKw.js";import{_ as ue}from"./index-QtALLQFU.js";import{_ as me}from"./index-BA_C8htm.js";import{_ as pe}from"./index-CWtBZ4FM.js";import{_ as ve}from"./index-C28wIIco.js";import{_ as fe}from"./index-BZF2MlwY.js";import{S as ye}from"./index-DQhfEGeI.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./Trigger-D5Y4uzl5.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-jhzcGD5Z.js";import"./slide-B4hiqfwi.js";import"./index-BN8NtH5x.js";import"./CheckOutlined-CRMX4qhF.js";import"./SearchOutlined-BC_LJr47.js";import"./FormItemContext-TDgu36NB.js";import"./move-Cw4o9UBf.js";import"./inputProps-CvodEnI-.js";import"./colors-BxVN-WHk.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function j(m){for(var d=1;d<arguments.length;d++){var r=arguments[d]!=null?Object(arguments[d]):{},u=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(r).filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable}))),u.forEach(function(p){ke(m,p,r[p])})}return m}function ke(m,d,r){return d in m?Object.defineProperty(m,d,{value:r,enumerable:!0,configurable:!0,writable:!0}):m[d]=r,m}var M=function(d,r){var u=j({},d,r.attrs);return i(Z,j({},u,{icon:ge}),null)};M.displayName="LinkOutlined";M.inheritAttrs=!1;const be={class:"recall-settings-box"},he={class:"form-box"},xe={class:"form-item"},$e={class:"form-item-body"},we={class:"form-item"},Le={class:"form-item"},Oe={class:"form-item-label"},Re={class:"form-item-body"},ze={class:"retrieval-mode-items"},Ce=["onClick"],Se={class:"retrieval-mode-title"},Ne={class:"title-text"},qe={key:0,style:{width:"32px"},src:ne,alt:""},Me={class:"retrieval-mode-desc"},Ue={class:"form-item"},Te={class:"form-item-label"},Be={class:"form-item-body"},Pe={class:"number-box"},Ve={class:"number-slider-box"},je={class:"number-input-box"},De={key:0,class:"form-item"},Ee={class:"form-item-label"},Fe={class:"form-item-body"},Ie={class:"number-box"},Ae={class:"number-slider-box"},He={class:"number-input-box"},Qe={class:"form-item"},Ge={class:"form-item-label"},Xe={class:"form-item-body"},Ze=["src"],Je={__name:"recall-testing-form",emits:["save","load"],setup(m,{expose:d,emit:r}){const u=F(),p=k(!1),$=r,b=k(!0),y=k([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=ee({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:u.query.id}),L=te(()=>b.value?y.value.filter(v=>v.value==s.search_type):y.value),C=(v,t)=>{s.rerank_model_config_id=t.rerank_model_config_id},S=v=>{s.search_type=v},l=()=>{if(!s.similarity)return q.error("请输入相似度");if(!s.size)return q.error("请输入分段数");if(!s.question)return q.error("请输入测试问题");let v={id:s.id,question:s.question,size:s.size,similarity:s.similarity,search_type:s.search_type};s.rerank_status==1&&(v.rerank_model_config_id=s.rerank_model_config_id),p.value=!0,$("load"),K(v).then(t=>{$("save",t.data)}).catch(()=>{$("save",[])}).finally(()=>{p.value=!1})},N=k([]);return(()=>{ie({model_type:"RERANK"}).then(v=>{let t=v.data||[];N.value=t.map(h=>({id:h.model_config.id,name:h.model_info.model_name,icon:h.model_info.model_icon_url,children:h.model_info.rerank_model_list}))})})(),d({open}),(v,t)=>{const h=_e,I=J,U=E,T=ue,B=me,P=pe,A=ve,H=fe,Q=de,G=re,X=ce;return n(),a("div",be,[t[16]||(t[16]=e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),e("div",he,[e("div",xe,[e("div",$e,[i(h,{style:{height:"76px"},value:s.question,"onUpdate:value":t[0]||(t[0]=o=>s.question=o),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",we,[i(I,{loading:p.value,onClick:l,type:"primary",block:""},{default:c(()=>t[8]||(t[8]=[f("测试")])),_:1,__:[8]},8,["loading"])]),e("div",Le,[e("div",Oe,[e("div",{class:"hover-label",onClick:t[1]||(t[1]=o=>b.value=!b.value)},[t[9]||(t[9]=f(" 检索模式 ")),b.value?(n(),x(w(le),{key:0})):(n(),x(w(ae),{key:1}))])]),e("div",Re,[e("div",ze,[(n(!0),a(R,null,z(L.value,o=>(n(),a("div",{class:se(["retrieval-mode-item",{active:s.search_type==o.value}]),key:o.value,onClick:O=>S(o.value)},[s.search_type==o.value?(n(),x(U,{key:0,class:"check-arrow",name:"check-arrow-filled"})):g("",!0),e("div",Se,[i(U,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",Ne,_(o.title),1),o.isRecommendation?(n(),a("img",qe)):g("",!0)]),e("div",Me,_(o.desc),1)],10,Ce))),128))])])]),e("div",Ue,[e("div",Te,[t[11]||(t[11]=e("span",null,"Top K ",-1)),i(T,null,{title:c(()=>t[10]||(t[10]=[f("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:c(()=>[i(w(V),{class:"question-icon"})]),_:1})]),e("div",Be,[e("div",Pe,[e("div",Ve,[i(B,{class:"custom-slider",value:s.size,"onUpdate:value":t[2]||(t[2]=o=>s.size=o),min:1,max:10},null,8,["value"])]),e("div",je,[i(P,{value:s.size,"onUpdate:value":t[3]||(t[3]=o=>s.size=o),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(n(),a("div",De,[e("div",Ee,[t[13]||(t[13]=e("span",null,"相似度阈值 ",-1)),i(T,null,{title:c(()=>t[12]||(t[12]=[f("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:c(()=>[i(w(V),{class:"question-icon"})]),_:1})]),e("div",Fe,[e("div",Ie,[e("div",Ae,[i(B,{class:"custom-slider",value:s.similarity,"onUpdate:value":t[4]||(t[4]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",He,[i(P,{value:s.similarity,"onUpdate:value":t[5]||(t[5]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):g("",!0),e("div",Qe,[e("div",Ge,[t[14]||(t[14]=e("span",null,"Rerank模型",-1)),t[15]||(t[15]=f("   ")),i(A,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":t[6]||(t[6]=o=>s.rerank_status=o)},null,8,["checked"])]),e("div",Xe,[i(X,{value:s.rerank_use_model,"onUpdate:value":t[7]||(t[7]=o=>s.rerank_use_model=o),placeholder:"请选择Rerank模型",onChange:C,style:{width:"320px"}},{default:c(()=>[(n(!0),a(R,null,z(N.value,o=>(n(),x(G,{key:o.id},{label:c(()=>[i(H,{align:"center",gap:8},{default:c(()=>[e("img",{class:"model-icon",src:o.icon,alt:""},null,8,Ze),f(_(o.name),1)]),_:2},1024)]),default:c(()=>[(n(!0),a(R,null,z(o.children,O=>(n(),x(Q,{value:O,rerank_model_config_id:o.id,key:O},{default:c(()=>[e("span",null,_(O),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},Ke=D(Je,[["__scopeId","data-v-c1c7aefe"]]),We={class:"recall-testing-box"},Ye={class:"recall-from-box"},et={class:"content-list-box"},tt={key:0,class:"empty-box"},st={class:"top-block"},ot={class:"title"},nt={key:0,class:"ml4"},it={class:"info-block"},lt=["onClick"],at={key:0},rt={class:"gray-text"},dt={key:0,class:"content-box"},ct={key:1,class:"content-box"},_t=["innerHTML"],ut={key:2,class:"loading-box"},mt={__name:"recall-testing",setup(m){F(),oe();const d=k(!1),r=k(!1),u=k([]),p=y=>{r.value=!1,u.value=y||[]},$=()=>{r.value=!0},b=y=>{if(!y.file_name){window.open(`/#/library/details/categary-manage?id=${y.library_id}`);return}window.open(`/#/library/preview?id=${y.file_id}`)};return(y,s)=>{const L=W,C=E,S=ye;return n(),a("div",We,[e("div",Ye,[i(L,null,{default:c(()=>[i(Ke,{onLoad:$,onSave:p})]),_:1})]),e("div",et,[d.value||u.value.length===0?(n(),a("div",tt,s[0]||(s[0]=[e("img",{src:Y,alt:""},null,-1),e("div",{class:"title"},"暂无结果，请重试",-1)]))):(n(),x(L,{key:1},{default:c(()=>[(n(!0),a(R,null,z(u.value,l=>(n(),a("div",{class:"list-item",key:l.id},[e("div",st,[e("div",ot,[f(" id："+_(l.id)+" ",1),l.title?(n(),a("div",nt,_(l.title),1)):g("",!0),e("span",null,"共"+_(l.word_total)+"个字符",1)])]),e("div",it,[s[2]||(s[2]=e("span",{class:"gray-text"},"来自：",-1)),e("div",{class:"link-text",onClick:N=>b(l)},[i(w(M)),f(" "+_(l.file_name)+" ",1),l.file_name?g("",!0):(n(),a("span",at,_(l.library_name)+"-精选",1))],8,lt),s[3]||(s[3]=e("span",{class:"v-line"},null,-1)),e("span",rt,[s[1]||(s[1]=f("相似度： ")),i(C,{name:"similarity",style:{"font-size":"16px"}}),f(" "+_(l.similarity),1)])]),l.question?(n(),a("div",dt,"Q："+_(l.question),1)):g("",!0),l.answer?(n(),a("div",ct,"A："+_(l.answer),1)):g("",!0),e("div",{class:"content-box",innerHTML:l.content},null,8,_t)]))),128))]),_:1})),r.value?(n(),a("div",ut,[i(S)])):g("",!0)])])}}},Zt=D(mt,[["__scopeId","data-v-d45df884"]]);export{Zt as default};
