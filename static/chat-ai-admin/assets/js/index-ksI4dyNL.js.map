{"version":3,"file":"index-ksI4dyNL.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/public-library/config/components/library-form.vue","../../../../front-end/chat-ai-admin-vue/src/views/public-library/config/index.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.form-box {\r\n  padding: 16px;\r\n  overflow: hidden;\r\n  border-radius: 6px;\r\n  background: #f2f4f7;\r\n}\r\n\r\n.model-icon {\r\n  height: 18px;\r\n}\r\n\r\n.form-item-tip {\r\n  color: #999;\r\n}\r\n\r\n.card-box {\r\n  display: flex;\r\n  gap: 8px;\r\n}\r\n\r\n.use-model-item {\r\n  position: relative;\r\n  width: 226px;\r\n  height: 124px;\r\n  border-radius: 2px;\r\n  border: 2px solid #d9d9d9;\r\n  cursor: pointer;\r\n  padding: 15px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.use-model-item-top {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  font-size: 14px;\r\n  color: #595959;\r\n}\r\n\r\n.use-model-item-top-icon {\r\n  margin-right: 5px;\r\n}\r\n\r\n.use-model-item-top.active {\r\n  color: #2475fc;\r\n  font-weight: bolder;\r\n}\r\n\r\n.use-model-item.active {\r\n  border: 2px solid #2475fc;\r\n\r\n  .check-arrow {\r\n    position: absolute;\r\n    display: block;\r\n    right: -1px;\r\n    bottom: -1px;\r\n    width: 24px;\r\n    height: 24px;\r\n    font-size: 24px;\r\n    color: #fff;\r\n  }\r\n\r\n  .retrieval-mode-title {\r\n    color: #2475fc;\r\n  }\r\n}\r\n\r\n.form-box-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  height: 56px;\r\n\r\n  .form-box-label {\r\n    display: flex;\r\n    align-items: center;\r\n\r\n    .form-box-label-icon {\r\n      width: 16px;\r\n      height: 16px;\r\n      font-size: 16px;\r\n      margin-right: 8px;\r\n    }\r\n    .form-box-label-text {\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      color: #262626;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"form-box\">\r\n    <div class=\"form-box-header\">\r\n      <div class=\"form-box-label\">\r\n        <svg-icon\r\n          class=\"form-box-label-icon\"\r\n          name=\"book\"\r\n          style=\"font-size: 16px; color: #333\"\r\n        ></svg-icon>\r\n        <span class=\"form-box-label-text\">{{ t('knowledge_base_info') }}</span>\r\n      </div>\r\n      <div></div>\r\n    </div>\r\n    <a-form :label-col=\"{ span: labelColSpan }\" style=\"width: 600px\">\r\n      <a-form-item ref=\"name\" :label=\"t('knowledge_base_name_label')\" v-bind=\"validateInfos.library_name\">\r\n        <a-input\r\n          v-model:value=\"formState.library_name\"\r\n          :placeholder=\"t('knowledge_base_name_placeholder')\"\r\n          show-count\r\n          :maxlength=\"20\"\r\n        />\r\n      </a-form-item>\r\n\r\n      <a-form-item :label=\"t('knowledge_base_intro_label')\">\r\n        <a-textarea v-model:value=\"formState.library_intro\" :placeholder=\"t('knowledge_base_intro_placeholder')\" />\r\n      </a-form-item>\r\n\r\n      <a-form-item ref=\"name\" :label=\"t('knowledge_base_cover_label')\" v-bind=\"validateInfos.avatar\">\r\n        <AvatarInput v-model:value=\"formState.avatar\" @change=\"onAvatarChange\" />\r\n        <div class=\"form-item-tip\">{{ t('knowledge_base_cover_tip') }}</div>\r\n      </a-form-item>\r\n      <a-form-item :wrapper-col=\"{ offset: wrapperColOffset, span: 8 }\">\r\n        <a-button\r\n          type=\"primary\"\r\n          style=\"margin-left: 8px\"\r\n          :loading=\"saveLoading\"\r\n          @click.prevent=\"onSubmit\"\r\n          >{{ t('save_btn') }}</a-button\r\n        >\r\n      </a-form-item>\r\n    </a-form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref, onMounted, toRaw, watch, computed } from 'vue'\r\nimport { Form, message } from 'ant-design-vue'\r\nimport AvatarInput from '@/views/library/add-library/components/avatar-input.vue'\r\nimport { LIBRARY_OPEN_AVATAR } from '@/constants/index'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport { useLocaleStoreWithOut } from '@/stores/modules/locale'\r\n\r\nconst { t } = useI18n('views.public-library.config.components.library-form')\r\nconst localeStore = useLocaleStoreWithOut()\r\n\r\n// 根据当前语言设置 label-col 的 span 值\r\nconst labelColSpan = computed(() => {\r\n  const lang = localeStore.getCurrentLocale.lang\r\n  // 如果是中文返回 6，否则返回 24\r\n  return lang === 'zh-CN' ? 6 : 24\r\n})\r\n\r\n// 根据当前语言设置 wrapper-col 的 offset 值\r\nconst wrapperColOffset = computed(() => {\r\n  const lang = localeStore.getCurrentLocale.lang\r\n  // 如果是中文返回 6，否则返回 0\r\n  return lang === 'zh-CN' ? 6 : 0\r\n})\r\n\r\n// 设置全局默认的duration为（2秒）\r\nmessage.config({\r\n  duration: 2\r\n})\r\n\r\nconst emit = defineEmits(['submit', 'update:value'])\r\n\r\nconst props = defineProps({\r\n  value: {\r\n    type: Object,\r\n    default: () => {\r\n      return {}\r\n    }\r\n  },\r\n  saveLoading: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\nconst type = ref(1)\r\nconst useForm = Form.useForm\r\n\r\nconst isActive = ref(false)\r\nconst defaultAvatar = LIBRARY_OPEN_AVATAR\r\n\r\nconst formState = reactive({\r\n  type: type.value,\r\n  library_name: '',\r\n  library_intro: '',\r\n  use_model: '',\r\n  avatar: defaultAvatar,\r\n  avatar_file: '',\r\n  is_offline: false,\r\n  model_config_id: ''\r\n})\r\n\r\nconst rules = reactive({\r\n  library_name: [{ required: true, message: t('library_name_required'), trigger: 'change' }],\r\n  library_intro: [{ required: true, message: t('library_intro_required'), trigger: 'change' }]\r\n  // use_model: [{ required: true, message: '请选择嵌入模型', trigger: 'change' }]\r\n})\r\n\r\nconst onAvatarChange = (data) => {\r\n  formState.avatar = data.imageUrl\r\n  formState.avatar_file = data.file\r\n}\r\n\r\nconst { validate, validateInfos } = useForm(formState, rules)\r\n// const resetForm = () => {}\r\n\r\nconst onSubmit = () => {\r\n  validate()\r\n    .then(() => {\r\n      saveForm()\r\n    })\r\n    .catch((err) => {\r\n      console.log(err, 'err')\r\n    })\r\n}\r\n\r\nconst saveForm = () => {\r\n  let data = toRaw(formState)\r\n\r\n  emit('submit', data)\r\n}\r\n\r\nconst setFormState = (val) => {\r\n  isActive.value = +val.type\r\n  formState.library_name = val.library_name\r\n  formState.library_intro = val.library_intro\r\n  formState.use_model = val.use_model\r\n  formState.model_config_id = val.model_config_id\r\n  formState.avatar = val.avatar ? val.avatar : defaultAvatar\r\n  formState.avatar_file = val.avatar_file ? val.avatar_file : ''\r\n  formState.is_offline = val.is_offline\r\n}\r\n\r\nwatch(props.value, (val) => {\r\n  setFormState({ ...val })\r\n})\r\n\r\nonMounted(() => {})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.add-library-page {\r\n  .page-container {\r\n    padding: 0 24px 24px;\r\n  }\r\n  .page-title {\r\n    line-height: 24px;\r\n    padding-bottom: 15px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #000000;\r\n  }\r\n\r\n  .form-box-wrapper {\r\n    margin-bottom: 16px;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"add-library-page\">\r\n    <ConfigPageMenu />\r\n    <div class=\"page-container\">\r\n      <div class=\"form-box-wrapper\">\r\n        <LibraryForm\r\n          v-model:value=\"state\"\r\n          :saveLoading=\"saveLoading1\"\r\n          @submit=\"handleSaveLibraryInfo\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref, toRaw, onMounted } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport ConfigPageMenu from '../components/config-page-menu.vue'\r\nimport LibraryForm from './components/library-form.vue'\r\nimport { usePublicLibraryStore } from '@/stores/modules/public-library'\r\n\r\nconst { t } = useI18n('views.public-library.config.index')\r\n\r\nconst libraryStore = usePublicLibraryStore()\r\n\r\nconst state = reactive({\r\n  type: 1,\r\n  library_intro: '',\r\n  library_name: '',\r\n  model_config_id: '',\r\n  model_define: '',\r\n  use_model: '',\r\n  is_offline: false,\r\n  access_rights: '0',\r\n  share_url: '',\r\n  library_key: '',\r\n  avatar: '',\r\n  avatar_file: ''\r\n})\r\n\r\nconst saveLoading1 = ref(false)\r\n\r\nconst handleSaveLibraryInfo = (data) => {\r\n  Object.assign(state, data)\r\n\r\n  saveLoading1.value = true\r\n\r\n  submit()\r\n    .then(() => {\r\n      saveLoading1.value = false\r\n    })\r\n    .catch(() => {\r\n      saveLoading1.value = false\r\n    })\r\n}\r\n\r\nconst submit = async () => {\r\n  let data = { ...toRaw(state) }\r\n\r\n  delete data.library_key\r\n\r\n  if (data.avatar_file) {\r\n    data.avatar = data.avatar_file\r\n    delete data.avatar_file\r\n  } else {\r\n    delete data.avatar\r\n    delete data.avatar_file\r\n  }\r\n\r\n  await libraryStore.saveEditLibrary(data)\r\n\r\n  message.success(t('modify_success'))\r\n}\r\n\r\nconst getData = () => {\r\n  Object.assign(state, {...libraryStore.libraryInfo})\r\n}\r\n\r\nonMounted(() => {\r\n  getData()\r\n})\r\n</script>\r\n"],"names":["useI18n","localeStore","useLocaleStoreWithOut","labelColSpan","computed","wrapperColOffset","message","emit","__emit","props","__props","type","ref","useForm","Form","isActive","defaultAvatar","LIBRARY_OPEN_AVATAR","formState","reactive","rules","onAvatarChange","data","validate","validateInfos","onSubmit","saveForm","err","toRaw","setFormState","val","watch","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_svg_icon","_hoisted_4","_toDisplayString","_unref","_component_a_form","_component_a_form_item","_mergeProps","_component_a_input","_cache","$event","_component_a_textarea","AvatarInput","_hoisted_5","_component_a_button","t","libraryStore","usePublicLibraryStore","state","saveLoading1","handleSaveLibraryInfo","submit","getData","ConfigPageMenu","LibraryForm"],"mappings":"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"}