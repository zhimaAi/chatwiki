import{_ as S,d as j,b6 as E,b7 as U,b8 as J}from"../../index-WMhSApoa.js";import{f as g,r as I,o as L,w as G,ac as v,ad as c,as as e,k as i,ar as y,F as M,ax as F,u as R,ae as T,G as h,at as r,av as H,az as O,aw as Q}from"./vue-chunks-CGLjTDrY.js";import{d as k,Z as P,w as X,X as Z,b as K,ay as W,aA as ee,y as te,z as se,B as ae,T as oe,E as ne,G as le}from"./ui-antd-BDReVt-O.js";import"./neo4j-CK9lNpyi.js";import"./utils-DXEytJvC.js";import"./other-BrZCAsTs.js";const ie={class:"zm-date"},de={class:"date-btn"},ce={class:"date-content"},_e={__name:"date",props:{datekey:{type:String,default:"1"}},emits:["dateChange"],setup(z,{emit:D}){const x=z,m=g(1),o=D;let C=I([{label:"今日",value:!0,key:2,start_time:k().startOf("day"),end_time:k().endOf("day")},{label:"昨日",value:!1,key:3,start_time:k().subtract(1,"day").startOf("day"),end_time:k().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_time:k().subtract(6,"day").startOf("day"),end_time:k().endOf("day").subtract(1,"millisecond")}]);const t=g(null),a=g(null),u=g([]),d=n=>n>=k().subtract(0,"day"),s=()=>{let n=m.value,p=null;C.forEach(_=>{_.key==n&&(p=_)}),p?(u.value=[p.start_time,p.end_time],t.value=p.start_time.format("YYYY-MM-DD"),a.value=p.end_time.format("YYYY-MM-DD")):(u.value=[],t.value=null,a.value=null),w()},$=n=>{const p=k(n[0]).startOf("day");if(k(n[1]).endOf("day").diff(p,"days")>29)u.value[0]=n[0].startOf("day"),u.value[1]=p.add(29,"days").endOf("day"),t.value=u.value[0].format("YYYY-MM-DD"),a.value=u.value[1].format("YYYY-MM-DD"),K.error("最多只能选择30天");else{const l=k(n[0]).startOf("day").format("YYYY-MM-DD"),Y=k(n[1]).endOf("day").format("YYYY-MM-DD");u.value=n,t.value=l,a.value=Y}m.value=1,w()},w=()=>{o("dateChange",{start_date:t.value,end_date:a.value})};return L(()=>{m.value=parseInt(x.datekey),s()}),G(()=>x.datekey,(n,p)=>{m.value=parseInt(x.datekey.split("-")[0]),s()}),(n,p)=>{const _=P,l=X,Y=Z;return c(),v("div",ie,[e("div",de,[i(l,{value:m.value,"onUpdate:value":p[0]||(p[0]=b=>m.value=b),onChange:s},{default:y(()=>[(c(!0),v(M,null,F(R(C),b=>(c(),T(_,{class:"date-btn-button",value:b.key,key:b.key},{default:y(()=>[h(r(b.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",ce,[i(Y,{value:u.value,"onUpdate:value":p[1]||(p[1]=b=>u.value=b),onChange:$,format:"YYYY-MM-DD",disabledDate:d,allowClear:!1},null,8,["value"])])])}}},re={class:"feedbacks-log-content"},ue={class:"feedbacks-log-items"},pe={class:"feedbacks-log-item"},ve={class:"feedbacks-log-items"},me={class:"feedbacks-log-item"},fe={class:"feedbacks-log-items"},be={class:"feedbacks-log-item"},ye={key:0,class:"item-type"},ke={key:1,class:"item-type"},ge={class:"feedbacks-log-label"},he={class:"feedbacks-log-item"},xe={class:"quotes-box"},Ce={key:0,class:"document-content"},$e={key:1},Ye={class:"document-content"},De={class:"document-content"},we=["onClick"],Oe={class:"feedbacks-log-items"},qe={class:"feedbacks-log-item"},ze={key:0},Me={key:1},Fe={key:2},Se={class:"feedbacks-log-items"},je={class:"feedbacks-log-item"},Ie={__name:"feedbacks-log-alert",setup(z,{expose:D}){const x=H(),m=g(!1),o=I({question:"",library:[],context_qa:[],cur_question:"",cur_answer:"",error:""}),C=()=>{m.value=!1},t=()=>{o.question="",o.library=[],o.context_qa=[],o.cur_question="",o.cur_answer="",o.error=""},a=d=>{t();for(const s in d)o[s]=d[s],s=="robot"&&(o[s]=JSON.parse(d[s])),s=="quotes"&&(o[s]=JSON.parse(d[s]));m.value=!0},u=d=>{x.push("/library/preview?id="+d.FileId)};return D({open:a}),(d,s)=>{const $=j,w=ee;return c(),T(w,{class:"feedbacks-log-alert",open:m.value,"onUpdate:open":s[0]||(s[0]=n=>m.value=n),title:"反馈详情",placement:"right",width:"746px",closable:!1},{extra:y(()=>[e("span",{class:"close-btn",onClick:C},[i(R(W))])]),default:y(()=>[e("div",re,[e("div",ue,[s[1]||(s[1]=e("div",{class:"feedbacks-log-label"},[e("span",null,"问题 ")],-1)),e("div",pe,[e("p",null,r(o.question),1)])]),e("div",ve,[s[2]||(s[2]=e("div",{class:"feedbacks-log-label"},[e("span",null,"回答 ")],-1)),e("div",me,[e("p",null,r(o.answer),1)])]),e("div",fe,[s[5]||(s[5]=e("div",{class:"feedbacks-log-label"},[e("span",null,"反馈 ")],-1)),e("div",be,[o.type=="1"?(c(),v("div",ye,[i($,{style:{"font-size":"16px",color:"#2475FC","margin-right":"4px"},name:"like-active"}),s[3]||(s[3]=h("点赞",-1))])):O("",!0),o.type=="2"?(c(),v("div",ke,[i($,{style:{"font-size":"16px",color:"#2475FC","margin-right":"4px"},name:"dislike-active"}),s[4]||(s[4]=h("点踩",-1))])):O("",!0),e("p",null,r(o.content),1)])]),(c(!0),v(M,null,F(o.quotes,(n,p)=>(c(),v("div",{class:"feedbacks-log-items",key:n.FileId},[e("div",ge,[e("span",null,"参考内容"+r(p+1),1)]),e("div",he,[e("div",xe,[n.Type==1?(c(),v("div",Ce,r(n.Content),1)):n.Type==2?(c(),v("div",$e,[e("div",Ye,"Q："+r(n.Question),1),e("div",De,"A："+r(n.Answer),1)])):O("",!0),e("div",{class:"quotes-title",onClick:_=>u(n)},[i($,{style:{"font-size":"16px",color:"#2475FC","margin-right":"4px"},name:"quotes"}),h(r(n.FileName),1)],8,we)])])]))),128)),e("div",Oe,[s[6]||(s[6]=e("div",{class:"feedbacks-log-label"},[e("span",null,"聊天模式 ")],-1)),e("div",qe,[o.robot.chat_type=="1"?(c(),v("p",ze,"仅知识库")):o.robot.chat_type=="2"?(c(),v("p",Me,"直连")):o.robot.chat_type=="3"?(c(),v("p",Fe,"混合")):O("",!0)])]),e("div",Se,[s[7]||(s[7]=e("div",{class:"feedbacks-log-label"},[e("span",null,"使用模型 ")],-1)),e("div",je,[e("p",null,r(o.robot.use_model)+"("+r(o.robot.corp_name)+")",1)])])])]),_:1},8,["open"])}}},Le=S(Ie,[["__scopeId","data-v-39a2df20"]]),Te={class:"team-members-pages"},Ae={class:"total"},Ne={class:"total-num"},Be={class:"set-model"},Re={class:"set-model-body"},Qe={class:"set-date"},Ve={class:"set-date-body"},Ee={class:"set-reset"},Ue={class:"list-box"},Je={class:"user-box"},Ge={class:"name-info"},He={class:"user-name"},Pe={class:"user-info"},Xe={key:0,class:"item-type"},Ze={key:1,class:"item-type"},Ke={class:"item-content"},We={class:"item-date"},et={__name:"qa-feedback",setup(z){const D=g(null),x=Q(),m=g("1"),o=x.query,C=g([{key:"all",id:"all",label:"全部类型",title:"全部类型"},{key:"1",id:"1",label:"点赞",title:"点赞"},{key:"2",id:"2",label:"点踩",title:"点踩"}]),t=I({robot_id:o.id,page:1,size:20,total:0,type:"all",start_date:"",end_date:""}),a=_=>{t.start_date=_.start_date,t.end_date=_.end_date,$()},u=async _=>{const l=await E({id:_.id});D.value.open(l.data)},d=()=>{t.type="all",t.start_date="",t.end_date="",m.value="1-"+Math.random()},s=_=>{t.page=_.current,t.size=_.pageSize,n()},$=()=>{t.page=1,n()},w=g([]),n=()=>{let _={robot_id:t.robot_id,page:t.page,size:t.size,start_date:t.start_date,end_date:t.end_date};t.type!="all"&&(_.type=t.type),U(_).then(l=>{let Y=l.data.list;Y.forEach(b=>{b.create_time=b.create_time>0?k(b.create_time*1e3).format("YYYY-MM-DD HH:mm"):"--",b.content=b.content?b.content:"--"}),w.value=Y,t.total=+l.data.total})},p=_=>{t.type=_,$()};return L(()=>{}),(_,l)=>{const Y=se,b=te,A=ae,N=oe,q=ne,B=j,V=le;return c(),v("div",Te,[i(N,{justify:"flex-end"},{default:y(()=>[e("div",Ae,[l[1]||(l[1]=e("div",{class:"label total-label"},"共计：",-1)),e("div",Ne,r(t.total)+"条",1)]),e("div",Be,[l[2]||(l[2]=e("div",{class:"label set-model-label"},"类型：",-1)),e("div",Re,[i(b,{value:t.type,"onUpdate:value":l[0]||(l[0]=f=>t.type=f),placeholder:"全部类型",onChange:p,style:{width:"130px"}},{default:y(()=>[(c(!0),v(M,null,F(C.value,f=>(c(),T(Y,{key:f.key,value:f.id},{default:y(()=>[e("span",null,r(f.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Qe,[l[3]||(l[3]=e("div",{class:"label set-date-label"},[e("span",null,"日期：")],-1)),e("div",Ve,[i(_e,{onDateChange:a,datekey:m.value},null,8,["datekey"])])]),e("div",Ee,[i(A,{onClick:d},{default:y(()=>[...l[4]||(l[4]=[h("重置",-1)])]),_:1})])]),_:1}),e("div",Ue,[i(V,{"data-source":w.value,pagination:t.total>t.size?{current:t.page,total:t.total,pageSize:t.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}:!1,onChange:s},{default:y(()=>[i(q,{title:"问答","data-index":"question",width:"411px"},{default:y(({record:f})=>[e("div",Je,[e("div",Ge,[e("div",He,r(f.question),1),e("div",Pe,r(f.answer),1)])])]),_:1}),i(q,{title:"回答反馈","data-index":"type",width:"160px"},{default:y(({record:f})=>[f.type=="1"?(c(),v("div",Xe,[i(B,{style:{"font-size":"24px",color:"#8C8C8C"},name:"like"}),l[5]||(l[5]=h("点赞",-1))])):O("",!0),f.type=="2"?(c(),v("div",Ze,[i(B,{style:{"font-size":"24px",color:"#8C8C8C"},name:"dislike"}),l[6]||(l[6]=h("点踩",-1))])):O("",!0)]),_:1}),i(q,{title:"反馈内容","data-index":"content",width:"264px"},{default:y(({record:f})=>[e("div",Ke,r(f.content),1)]),_:1}),i(q,{title:"时间","data-index":"create_time",width:"200px"},{default:y(({record:f})=>[e("div",We,r(f.create_time),1)]),_:1}),i(q,{title:"操作","data-index":"action",width:"88px"},{default:y(({record:f})=>[i(N,{gap:16,class:"action-box"},{default:y(()=>[i(A,{type:"link",onClick:ct=>u(f)},{default:y(()=>[...l[7]||(l[7]=[h("查看详情",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","pagination"])]),i(Le,{ref_key:"feedbacksLogAlertRef",ref:D},null,512)])}}},tt=S(et,[["__scopeId","data-v-0618887c"]]),st={class:"user-model-page"},at={class:"overview-box"},ot={class:"item-info"},nt={class:"item-icon-content item-like"},lt={class:"item-icon-content item-dislike"},it={class:"list-wrapper"},dt={__name:"index",setup(z){const x=Q().query,m=g([]),o=t=>{let a={title:"",id:0};switch(t){case"today_stats":a.title="今日",a.id=1;break;case"yesterday_stats":a.title="昨日",a.id=2;break;case"week_stats":a.title="近7日",a.id=3;break;case"total_stats":a.title="总计",a.id=4;break}return a},C=()=>{let t={robot_id:x.id};J(t).then(a=>{const u=[];for(const d in a.data){const s=a.data[d];u.push({key:d,dislike:s.dislike,like_count:s.like_count,titleObj:o(d)})}m.value=u.sort((d,s)=>d.titleObj.id-s.titleObj.id)})};return L(()=>{C()}),(t,a)=>{const u=j;return c(),v("div",st,[a[0]||(a[0]=e("div",{class:"page-title"},"数据概览",-1)),e("div",at,[(c(!0),v(M,null,F(m.value,d=>(c(),v("div",{class:"item-box",key:d.titleObj.id},[e("div",ot,r(d.titleObj.title),1),e("div",nt,[i(u,{style:{"font-size":"24px",color:"#8C8C8C"},name:"like"}),h(r(d.like_count),1)]),e("div",lt,[i(u,{style:{"font-size":"24px",color:"#8C8C8C"},name:"dislike"}),h(r(d.dislike),1)])]))),128))]),a[1]||(a[1]=e("div",{class:"page-title"},"反馈记录",-1)),e("div",it,[i(tt)])])}}},ft=S(dt,[["__scopeId","data-v-646107c5"]]);export{ft as default};
