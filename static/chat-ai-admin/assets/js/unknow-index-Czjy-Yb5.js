import{_ as Be}from"./cu-scroll-ufyFyI_5.js";import{u as Me}from"./robot-CF9aQwVH.js";import{n as H,b as oe,B as ge,d as ke,M as _e,$ as Je,a1 as Pe,k as Z,bF as Qe,bG as He,bH as Xe,h as We}from"../../index-CzPebXix.js";import{d as l,z as J,q as Ze,w as Se,N as f,O as r,X as e,j as o,U as n,F as j,a1 as re,u as B,S as G,Z as $,_ as Y,b as ae,o as et,x as Ie,a3 as me,a6 as X,H as ye,I as $e,a5 as tt,ae as Ce,af as De,W as fe,a2 as ot,ag as nt}from"./vue-chunks-BRsu9_To.js";import{a as at,_ as st}from"./RadioButton-h1wW1k6O.js";import{R as lt}from"./dayjs-DSnEW89Q.js";import{C as Oe}from"./index-DGkdJwWs.js";import{R as it}from"./index-xXMO8r4G.js";import{_ as rt}from"./index-hvcgcTJ4.js";import{u as ut}from"./index-2tr6NsEM.js";import{_ as Ue}from"./index-CBmR-lHY.js";import{_ as we}from"./index-BwqnaIPU.js";import{a as Le,_ as dt}from"./index-Bh3NMpRp.js";import{L as _t,M as ze,N as mt,O as ct}from"./index-jmRHMddk.js";import{U as Te}from"./index-CO6rvZOl.js";import{u as Ne}from"./util-BwuffJOK.js";import{M as pt}from"./index-BMSQkwth.js";import{S as vt,a as ft}from"./index-6HDf6TPN.js";import{T as be,_ as he}from"./index-YQhVm4Ni.js";import{L as yt}from"./LeftOutlined-BKUTcRtP.js";import{_ as Ye}from"./TextArea-DrgXbuSS.js";import{_ as Re}from"./index-B_XKw_Lk.js";import{M as gt}from"./model-select-BRz1sNBY.js";import{F as de,_ as Ae}from"./index-BgVvqN-n.js";import{Q as Ke}from"./QuestionCircleOutlined-DTfTQPH4.js";import{D as kt}from"./DownOutlined-DXKkgIsm.js";import{M as wt,_ as bt}from"./index-DlQVT6K6.js";import"./index-BSz5XTfh.js";import{D as ht}from"./dropdown-DTOAy9tU.js";import{_ as xt}from"./index-Bpi-EtQQ.js";import{_ as $t}from"./index-Dhmpqx9n.js";import{_ as Ct}from"./index-BhUXTHsq.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-B2RmG14m.js";import"./Checkbox-oqMTsvET.js";import"./index-D17QejXF.js";import"./index-BukWVUqX.js";import"./colors-DfoziJR7.js";import"./ClockCircleOutlined-bBTx_Knl.js";import"./useMergedState-C0iIHNGF.js";import"./Trigger-Bvakuge0.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./shallowequal-C0xnIuy8.js";import"./index-Bxqtz4sn.js";import"./move-CkiYyFmr.js";import"./slide-CsbPJG8I.js";import"./index-Bhf8G0AA.js";import"./index-BfxXXGE8.js";import"./CheckOutlined-Mk6nTpyE.js";import"./useRefs-CRRjy_qY.js";import"./index-BYVEo4R0.js";import"./List-D7uk7Chm.js";import"./collapseMotion-Brd6xpAT.js";import"./CaretDownFilled-DSht_iiA.js";import"./index-BhHQj-ne.js";import"./responsiveObserve-DqAe0rZk.js";import"./index-0UwCX3b0.js";import"./RightOutlined-DH_YROnp.js";import"./index-DLRiQ5Ho.js";import"./index-Di5l0R3t.js";import"./CaretDownOutlined-Byn8iz8T.js";import"./SearchOutlined-a_gTycfl.js";import"./index-BFhVTGQQ.js";import"./Input-DFtZp9vk.js";import"./inputProps-jdR54afw.js";import"./Search-Cf7bcOZJ.js";import"./isPlainObject-OEy0Jz8l.js";import"./Password-fnCqxsm2.js";import"./index-CYUphznb.js";import"./index-7Ecr060x.js";import"./DownloadOutlined-CeWsYko2.js";import"./pick-Sm8BXOZJ.js";import"./PlusOutlined-BlmIiILr.js";import"./UpOutlined-B_3G2J2r.js";import"./Col-CFxRRwN8.js";const Dt={class:"zm-date"},qt={class:"date-btn"},Mt={class:"date-content"},Fe={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(Q,{emit:A}){const I=Q,k=l(1),i=A;let C=J([{label:"今日",value:!0,key:2,start_date:H().startOf("day"),end_date:H().endOf("day")},{label:"昨日",value:!1,key:3,start_date:H().subtract(1,"day").startOf("day"),end_date:H().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_date:H().subtract(6,"day").startOf("day"),end_date:H().endOf("day").subtract(1,"millisecond")},{label:"自定义",value:!1,key:5,start_date:H().startOf("month").startOf("day"),end_date:H().endOf("day")}]);const a=l(null),m=l(null),s=l([]),z=q=>q>=H().subtract(0,"day"),O=()=>{let q=k.value,M=null;C.forEach(w=>{w.key==q&&(M=w)}),s.value=[M.start_date,M.end_date],a.value=M.start_date.startOf("day").format("YYYYMMDD"),m.value=M.end_date.endOf("day").format("YYYYMMDD"),S()},h=(q,M)=>{a.value=q[0].startOf("day").format("YYYYMMDD"),m.value=q[1].endOf("day").format("YYYYMMDD"),k.value=5,S()},S=()=>{i("dateChange",{start_time:a.value,end_time:m.value})};return Ze(()=>{k.value=parseInt(I.datekey),O()}),Se(()=>I.datekey,(q,M)=>{k.value=parseInt(I.datekey.split("-")[0]),O()}),(q,M)=>{const w=at,u=st,p=lt;return r(),f("div",Dt,[e("div",qt,[o(u,{value:k.value,"onUpdate:value":M[0]||(M[0]=y=>k.value=y),onChange:O},{default:n(()=>[(r(!0),f(j,null,re(B(C),y=>(r(),G(w,{class:"date-btn-button",value:y.key,key:y.key},{default:n(()=>[$(Y(y.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",Mt,[o(p,{value:s.value,"onUpdate:value":M[1]||(M[1]=y=>s.value=y),onChange:h,format:"YYYY-MM-DD",disabledDate:z,allowClear:!1},null,8,["value"])])])}}},St={class:"ai-generate-wrapper"},It={class:"form-box-wrapper ai-generate-wrapper-box"},Ot={class:"ai-generate-wrapper-left"},Ut={class:"form-box-wrapper-options"},Lt={class:"form-item flex1"},zt={class:"form-content"},Tt={class:"form-item generate-btn-box"},Nt={key:0,class:"progress-box"},Yt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(Q,{expose:A,emit:I}){const k=l(10),i=l(!1),C=l(!1),a=J({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),m=Q,s=I,z=l(""),O=["azure","ollama","xinference","openaiAgent"],h=l(!1),S=()=>{h.value=!0},q=()=>{i.value=!1},M=async()=>{var g;C.value=!0;try{let v={library_id:(g=m.detailsInfo)==null?void 0:g.library_id,model_config_id:a.model_config_id,use_model:a.use_model,num:a.count};h.value=!1,i.value=!0,N()}finally{C.value=!1}},w=l(!1),u=l(!1);let p=null;const y=ae(()=>k.value>=100?"success":"active"),x=ae(()=>({"0%":"#108ee9","100%":"#87d068"})),N=()=>{w.value=!0,u.value=!1,k.value=0,p=setInterval(()=>{k.value<100?(k.value+=Math.floor(Math.random()*10)+1,k.value>100&&(k.value=100)):(clearInterval(p),w.value=!1,u.value=!0)},800)},T=()=>{s("handleDownload")},L=g=>{a.use_model=O.includes(g.rawData.model_define)&&g.rawData.deployment_name?g.rawData.deployment_name:g.rawData.name,a.use_model_icon=g.icon,a.use_model_name=g.use_model_name,a.model_config_id=g.rawData.id,z.value=g.rawData.model_define},V=l([]),c=g=>{V.value=g,Ie(()=>{(!a.ai_chunk_model||!Number(a.ai_chunk_model_config_id))&&_()})},_=()=>{if(V.value.length>0){let g=null,v=null;for(let P of V.value)if(P.model_define==="tongyi"){g=P;for(let E of g.children)if(E.name==="qwen-max"){v=E;break}break}g||(g=V.value[0],v=g.children[0]),g&&v&&(a.use_model=v.name,a.model_config_id=v.model_config_id,a.ai_chunk_model=v.name,a.ai_chunk_model_config_id=v.model_config_id)}},D=g=>{if(w.value)return g.preventDefault(),g.returnValue="数据正在生成中，确定要离开吗？","数据正在生成中，确定要离开吗？"};return et(()=>{clearInterval(p),window.removeEventListener("beforeunload",D)}),A({showModal:S,hideModal:q}),(g,v)=>{const P=ke,E=ge,ee=_e,se=rt,W=it;return r(),f("div",null,[o(ee,{open:h.value,"onUpdate:open":v[1]||(v[1]=F=>h.value=F),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:n(()=>v[3]||(v[3]=[e("div",{class:"custom-modal-header"},[e("span",null,"AI智能总结")],-1)])),footer:n(()=>v[6]||(v[6]=[])),default:n(()=>[e("div",St,[e("div",It,[e("div",Ot,[e("div",Ut,[e("div",Lt,[v[4]||(v[4]=e("div",{class:"form-label required"},"请选择生成未知问题总结的大模型",-1)),e("div",zt,[o(Oe,{modelValue:a.use_model,"onUpdate:modelValue":v[0]||(v[0]=F=>a.use_model=F),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":a.model_config_id,onChange:L,onLoaded:c},null,8,["modelValue","model-config-id"])])])]),e("div",Tt,[o(E,{onClick:M,loading:C.value,class:"generate-btn"},{default:n(()=>[o(P,{name:"ai-generate-white",style:{"font-size":"16px"}}),v[5]||(v[5]=$(" 开始总结 "))]),_:1,__:[5]},8,["loading"])])])])])]),_:1},8,["open"]),o(ee,{open:i.value,"onUpdate:open":v[2]||(v[2]=F=>i.value=F),title:"生成数据",footer:null,width:746},{default:n(()=>[k.value<100?(r(),f("div",Nt,[o(se,{type:"circle",percent:k.value,status:y.value,"stroke-color":x.value},null,8,["percent","status","stroke-color"]),v[7]||(v[7]=e("div",{class:"tip"},"数据生成中，请勿关闭页面",-1))])):(r(),G(W,{key:1,status:"success",title:"生成完成"},{subTitle:n(()=>v[8]||(v[8]=[$(" 您可以去未知问题总结中下载生成的数据 ")])),extra:n(()=>[o(E,{onClick:T,type:"primary"},{default:n(()=>v[9]||(v[9]=[$("去下载")])),_:1,__:[9]})]),_:1}))]),_:1},8,["open"])])}}},Rt=oe(Yt,[["__scopeId","data-v-47969bcc"]]),At={class:"list-wrapper"},Kt={class:"content-wrapper"},Ft={class:"tip-icon"},Gt={class:"search-block"},Vt={key:0},Et={key:1},jt={__name:"index",setup(Q){const A=me().query,I=l(1),k=l([]),i=J({robot_id:A.id,start_day:"",end_day:"",page:1,size:10,total:0}),C=l(null),a=S=>{i.page=S.current,i.size=S.pageSize,O()},m=()=>{i.page=1,O()},s=()=>{I.value=2,C.value&&C.value.hideModal()},z=S=>{i.start_day=S.start_time,i.end_day=S.end_time,m()},O=()=>{ut({...i}).then(S=>{let q=S.data.list;k.value=q,i.total=+S.data.total})},h=[{title:"未知问题",dataIndex:"question",key:"question",width:"60%"},{title:"触发日期",dataIndex:"show_date",key:"show_date",width:"20%"},{title:"当日出现次数",key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return(S,q)=>{const M=Ue,w=we,u=Le;return r(),f(j,null,[e("div",At,[e("div",Kt,[o(M,{"show-icon":"",class:"alert-box"},{icon:n(()=>[e("div",Ft,[o(B(Je))])]),message:n(()=>q[0]||(q[0]=[e("div",{class:"tip-title"},"统计用户在与机器人对话中，没有从知识库中检索出知识的用户问题",-1),e("div",{class:"tip-content"},[e("p",null," 1. 如果您认为知识库里面有对应的知识，只是没有检索出来，可能是您设置的召回阈值过高或者top K较少。您调整机器人的召回设置来提升召回率。 ")],-1)])),_:1}),e("div",Gt,[o(Fe,{datekey:"4",onDateChange:z})]),o(u,{class:"table-list",columns:h,"data-source":k.value,pagination:{current:i.page,total:i.total,pageSize:i.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:a},{bodyCell:n(({column:p,record:y})=>[p.key==="question"?(r(),f(j,{key:0},[y.question.length>100?(r(),f("div",Vt,[o(w,{overlayClassName:"search-content-tip",placement:"top"},{title:n(()=>[$(Y(y.question),1)]),default:n(()=>[e("div",null,Y(y.question.slice(0,100)+"..."),1)]),_:2},1024)])):(r(),f("div",Et,Y(y.question),1))],64)):X("",!0)]),_:1},8,["data-source","pagination"])])]),o(Rt,{ref_key:"aiGenerateRef",ref:C,onHandleDownload:s},null,512)],64)}}},Bt=oe(jt,[["__scopeId","data-v-15df8dc9"]]),Jt={class:"custom-modal-header"},Pt={key:1},Qt={key:2},Ht={class:"form-box-wrapper"},Xt={class:"form-item"},Wt={class:"form-content"},Zt={class:"form-item"},eo={class:"form-content"},to={class:"form-item"},oo={class:"form-content"},no={class:"form-item"},ao={class:"form-label-box"},so={class:"form-content"},lo={class:"form-item"},io={class:"form-content"},ro={key:0,class:"error-tip"},uo={class:"form-item"},_o={class:"form-content"},mo={class:"upload-box-wrapper"},co={key:0},po={class:"ai-generate-wrapper"},vo={class:"form-box-wrapper ai-generate-wrapper-box"},fo={class:"ai-generate-wrapper-left"},yo={class:"form-box-wrapper-options"},go={class:"form-item flex1"},ko={class:"form-content"},wo={class:"form-item flex1"},bo={class:"form-content dual-inputs"},ho={class:"input-group"},xo={class:"form-label-input-box"},$o={class:"form-box-wrapper-content"},Co={class:"problem-box"},Do={class:"problem-content"},qo={class:"problem-box"},Mo={class:"problem-content"},So={class:"form-item generate-btn-box"},Io={class:"result-nav"},Oo={key:0,class:"tip"},Uo={key:1,class:"result-nav-text"},Lo={key:0,class:"container"},zo={class:"result-container"},To=["innerHTML"],No={class:"result-footer"},Yo={__name:"import-library-modal",emits:["ok"],setup(Q,{expose:A,emit:I}){const k=l(!1),i=l(!1),C=l(!1),a=l(!1),m=l(!1),s=J({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),z=new pt({html:!0,linkify:!0,typographer:!0}),O=l(""),h=J({finish:"",content:""});Se(()=>h.content,()=>{O.value=z.render(h.content)});const S=I,q=l(""),M=["azure","ollama","xinference","openaiAgent"],w=l("1"),u=l(!1),p=l(""),y=l(""),x=l(""),N=l(""),T=l(""),L=l([]),V=l(""),c=l("0"),_=l([]),D=()=>{Pe({type:2}).then(d=>{c.value="0",_.value=d.data||[]})};D();const g=()=>{E()},v=d=>{var t;D(),i.value=!1,C.value=!1,m.value=!1,p.value="",y.value="",V.value=d.id||"",x.value=d.answer||"",L.value=d.images||[],N.value=d.question||"",T.value=d.similar_questions?d.similar_questions.join(`
`):"",c.value=d.group_id||"0",s.library_id=d.library_id||"",s.library_id||(s.library_id=(t=_.value[0])==null?void 0:t.id),E(),u.value=!0},P=l([]),E=()=>{Xe({library_id:s.library_id}).then(d=>{P.value=d.data||[]})},ee=()=>{if(xe(),!N.value)return Z.error("请输入分段问题");if(!x.value)return Z.error("请输入分段答案");if(x.value.length>1e4)return;let d={title:p.value,content:y.value,question:N.value,answer:x.value,images:L.value,library_id:s.library_id};d.group_id=c.value||0;let t=T.value.trim();t?(t=t.split(`
`),d.similar_questions=JSON.stringify(t)):d.similar_questions="[]";let R=new FormData;for(let K in d)Ne.isArray(d[K])?d[K].forEach(ie=>{R.append(K,ie)}):R.append(K,d[K]);He(R).then(K=>{_t({id:V.value,to_library_id:s.library_id}).then(ie=>{Z.success("导入成功"),u.value=!1,S("ok")})})},se=()=>{if(!s.library_id)return Z.error("请选择知识库");i.value=!0},W=l(""),F=async()=>{h.content="",W.value="",a.value=!0,m.value=!0;try{let d={library_id:s.library_id,model_config_id:s.model_config_id,use_model:s.use_model,num:s.count,question:N.value,answer:x.value};const t=await Qe(d);W.value=t.data.map(R=>R).join(`
`),h.content=t.data.map((R,K)=>`<div class="dialog-message">${K+1}. ${R}</div>`).join(""),C.value=!0}finally{a.value=!1}},ce=()=>{T.value?T.value+=`
${W.value}`:T.value+=W.value,Z.success("保存成功"),C.value=!1,i.value=!1,m.value=!1},pe=d=>{s.use_model=M.includes(d.rawData.model_define)&&d.rawData.deployment_name?d.rawData.deployment_name:d.rawData.name,s.use_model_icon=d.icon,s.use_model_name=d.use_model_name,s.model_config_id=d.rawData.id,q.value=d.rawData.model_define},ne=l([]),U=d=>{ne.value=d,Ie(()=>{(!s.ai_chunk_model||!Number(s.ai_chunk_model_config_id))&&te()})},te=()=>{if(ne.value.length>0){let d=null,t=null;for(let R of ne.value)if(R.model_define==="tongyi"){d=R;for(let K of d.children)if(K.name==="qwen-max"){t=K;break}break}d||(d=ne.value[0],t=d.children[0]),d&&t&&(s.use_model=t.name,s.model_config_id=t.model_config_id,s.ai_chunk_model=t.name,s.ai_chunk_model_config_id=t.model_config_id)}};function le(d){return d.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const xe=()=>{T.value=le(T.value)};return A({showModal:v}),(d,t)=>{const R=ge,K=ft,ie=vt,ve=Ye,ue=ke,Ge=he,Ve=be,Ee=Re,je=_e;return r(),f("div",null,[o(je,{open:u.value,"onUpdate:open":t[11]||(t[11]=b=>u.value=b),onOk:ee,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:i.value?m.value?"944px":"472px":"746px","ok-button-props":{style:{display:i.value?"none":"block"}}},{title:n(()=>[e("div",Jt,[i.value?(r(),G(R,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=b=>i.value=!1)},{icon:n(()=>[o(B(yt),{style:{"font-size":"12px"}})]),_:1})):X("",!0),i.value?(r(),f("span",Pt,"AI生成相似问法")):(r(),f("span",Qt,"导入知识库"))])]),footer:n(()=>[i.value?X("",!0):(r(),f(j,{key:0},[o(R,{onClick:t[10]||(t[10]=b=>u.value=!1)},{default:n(()=>t[29]||(t[29]=[$("取消")])),_:1,__:[29]}),o(R,{type:"primary",onClick:ee},{default:n(()=>t[30]||(t[30]=[$("确定")])),_:1,__:[30]})],64))]),default:n(()=>[ye(e("div",Ht,[e("div",Xt,[t[12]||(t[12]=e("div",{class:"form-label required"},"问题请选择要导入的问答知识库：",-1)),e("div",Wt,[o(ie,{onChange:g,value:s.library_id,"onUpdate:value":t[1]||(t[1]=b=>s.library_id=b),style:{width:"100%"},placeholder:"请选择"},{default:n(()=>[(r(!0),f(j,null,re(_.value,b=>(r(),G(K,{value:b.id,key:b.id},{default:n(()=>[$(Y(b.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Zt,[t[13]||(t[13]=e("div",{class:"form-label required"},"所属分类：",-1)),e("div",eo,[o(ie,{value:c.value,"onUpdate:value":t[2]||(t[2]=b=>c.value=b),style:{width:"100%"}},{default:n(()=>[(r(!0),f(j,null,re(P.value,b=>(r(),G(K,{value:b.id},{default:n(()=>[$(Y(b.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",to,[t[14]||(t[14]=e("div",{class:"form-label required"},"分段问题：",-1)),e("div",oo,[o(ve,{placeholder:"请输入分段问题",value:N.value,"onUpdate:value":t[3]||(t[3]=b=>N.value=b),style:{height:"100px"}},null,8,["value"])])]),e("div",no,[e("div",ao,[t[16]||(t[16]=e("div",{class:"form-label required"},"相似问法",-1)),e("div",{class:"ai-generate",onClick:se},[o(ue,{name:"ai-generate",style:{"font-size":"14px"}}),t[15]||(t[15]=e("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),e("div",so,[o(ve,{placeholder:"请输入相似问法",value:T.value,"onUpdate:value":t[4]||(t[4]=b=>T.value=b),style:{height:"100px"},onBlur:xe},null,8,["value"]),t[17]||(t[17]=e("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),e("div",lo,[t[18]||(t[18]=e("div",{class:"form-label required"},"分段答案：",-1)),e("div",io,[o(ve,{placeholder:"请输入分段答案",value:x.value,"onUpdate:value":t[5]||(t[5]=b=>x.value=b),maxlength:1e4,style:{height:"100px"}},null,8,["value"]),x.value.length>1e4?(r(),f("div",ro,"分段答案最多支持10000个字符")):X("",!0)])]),e("div",uo,[t[20]||(t[20]=e("div",{class:"form-label"},"附件",-1)),e("div",_o,[e("div",mo,[o(Ve,{activeKey:w.value,"onUpdate:activeKey":t[6]||(t[6]=b=>w.value=b),size:"small"},{default:n(()=>[o(Ge,{key:"1"},{tab:n(()=>[e("span",null,[o(ue,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),t[19]||(t[19]=$(" 图片 ")),L.value.length?(r(),f("span",co,"("+Y(L.value.length)+")",1)):X("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(Te,{value:L.value,"onUpdate:value":t[7]||(t[7]=b=>L.value=b)},null,8,["value"])])])])],512),[[$e,!i.value]]),ye(e("div",po,[e("div",vo,[e("div",fo,[e("div",yo,[e("div",go,[t[21]||(t[21]=e("div",{class:"form-label required"},"相似问法模型：",-1)),e("div",ko,[o(Oe,{modelValue:s.use_model,"onUpdate:modelValue":t[8]||(t[8]=b=>s.use_model=b),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":s.model_config_id,onChange:pe,onLoaded:U},null,8,["modelValue","model-config-id"])])]),e("div",wo,[e("div",bo,[e("div",ho,[t[23]||(t[23]=e("div",{class:"form-label required"},"问题个数：",-1)),e("div",xo,[o(Ee,{value:s.count,"onUpdate:value":t[9]||(t[9]=b=>s.count=b),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),t[22]||(t[22]=$("个 "))])])])])]),e("div",$o,[e("div",Co,[t[24]||(t[24]=e("div",{class:"problem"},"问题",-1)),e("div",Do,Y(N.value),1)]),e("div",qo,[t[25]||(t[25]=e("div",{class:"problem"},"答案",-1)),e("div",Mo,Y(x.value),1)])]),e("div",So,[o(R,{onClick:F,loading:a.value,class:"generate-btn"},{default:n(()=>[o(ue,{name:"ai-generate-white",style:{"font-size":"16px"}}),t[26]||(t[26]=$(" 开始生成 "))]),_:1,__:[26]},8,["loading"])])]),e("div",{class:tt(["ai-generate-wrapper-right",{"show-result":m.value}])},[e("div",Io,[o(ue,{name:"generate-icon",style:{"font-size":"14px"}}),a.value?(r(),f("span",Oo,"相似问法生成中...")):(r(),f("div",Uo,"相似问法生成完毕"))]),!h.content&&a.value&&!k.value?(r(),f("div",Lo,t[27]||(t[27]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)]))):X("",!0),e("div",zo,[e("div",{class:"dialog-content",innerHTML:O.value},null,8,To)]),e("div",No,[o(R,{class:"result-footer-btn",type:"primary",onClick:ce},{default:n(()=>t[28]||(t[28]=[$("保存相似问法")])),_:1,__:[28]})])],2)])],512),[[$e,i.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Ro=oe(Yo,[["__scopeId","data-v-6efb96f0"]]),Ao={class:"form-box"},Ko={__name:"auto-cluster-modal",emits:["ok"],setup(Q,{expose:A,emit:I}){const k=I,i=me().query,C=l(!1),a=J({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:i.id}),m=de.useForm;l(!1);const s=w=>{a.unknown_summary_model_config_id=w.unknown_summary_model_config_id||"",a.unknown_summary_use_model=w.unknown_summary_use_model||"",a.unknown_summary_similarity=w.unknown_summary_similarity||"",a.unknown_summary_status=w.unknown_summary_status||"",C.value=!0},z=J({unknown_summary_similarity:[{required:!0,message:"请输入相似度阈值",trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:"请选择使用的向量模型",trigger:"change"}]}),{validate:O,validateInfos:h}=m(a,z),S=w=>{w.length},q=()=>{O().then(()=>{M()}).catch(w=>{})},M=()=>{ze({...a}).then(w=>{Z.success("保存成功"),C.value=!1,k("ok")})};return A({show:s}),(w,u)=>{const p=Ae,y=we,x=Re,N=de,T=_e;return r(),f("div",null,[o(T,{open:C.value,"onUpdate:open":u[3]||(u[3]=L=>C.value=L),title:"自动聚类设置",onOk:q},{default:n(()=>[e("div",Ao,[o(N,{layout:"vertical"},{default:n(()=>[o(p,Ce(De(B(h).unknown_summary_model_config_id)),{label:n(()=>u[4]||(u[4]=[$("请设置使用的向量模型 ")])),default:n(()=>[o(gt,{modelType:"TEXT EMBEDDING",modeName:a.unknown_summary_use_model,"onUpdate:modeName":u[0]||(u[0]=L=>a.unknown_summary_use_model=L),modeId:a.unknown_summary_model_config_id,"onUpdate:modeId":u[1]||(u[1]=L=>a.unknown_summary_model_config_id=L),onLoaded:S,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),o(p,Ce(De(B(h).unknown_summary_similarity)),{label:n(()=>[u[6]||(u[6]=$("相似度阈值 ")),o(y,null,{title:n(()=>u[5]||(u[5]=[$("语意相似度大于指定阈值的问题会自动聚类")])),default:n(()=>[o(B(Ke),{class:"ml4"})]),_:1})]),default:n(()=>[o(x,{placeholder:"请输入相似度阈值",style:{width:"100%"},value:a.unknown_summary_similarity,"onUpdate:value":u[2]||(u[2]=L=>a.unknown_summary_similarity=L),min:0,max:1,precision:2,step:.1},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open"])])}}},Fo=oe(Ko,[["__scopeId","data-v-81c864fc"]]),Go={class:"form-box"},Vo={class:"upload-box-wrapper"},Eo={key:0},jo={__name:"set-answer-modal",emits:["ok"],setup(Q,{expose:A,emit:I}){const k=I,i=me().query,C=l("1"),a=l(!1),m=J({id:i.id,question:"",unknown_list:"",answer:"",images:[]}),s=de.useForm,z=l(!1),O=u=>{Object.assign(m,JSON.parse(JSON.stringify(u))),a.value=!0},h=J({question:[{required:!0,message:"请输入问题",trigger:"change"}],unknown_list:[{required:!0,message:"请输入相似问法",trigger:"change"}],answer:[{required:!0,message:"请输入答案",trigger:"change"}]}),{validate:S,validateInfos:q}=s(m,h),M=()=>{S().then(()=>{w()}).catch(u=>{})},w=()=>{let u={...m},p=u.unknown_list.trim();p?(p=p.split(`
`),u.unknown_list=JSON.stringify(p)):u.unknown_list="[]";let y=new FormData;for(let x in u)Ne.isArray(u[x])?u[x].forEach(N=>{y.append(x,N)}):y.append(x,u[x]);z.value=!0,mt(y).then(x=>{Z.success("保存成功"),a.value=!1,k("ok")}).finally(()=>{z.value=!1})};return A({show:O}),(u,p)=>{const y=Ye,x=Ae,N=ke,T=he,L=be,V=Te,c=de,_=_e;return r(),f("div",null,[o(_,{open:a.value,"onUpdate:open":p[5]||(p[5]=D=>a.value=D),title:"设置答案",onOk:M,width:746,confirmLoading:z.value},{default:n(()=>[e("div",Go,[o(c,{layout:"vertical"},{default:n(()=>[o(x,fe({label:"问题"},B(q).question),{default:n(()=>[o(y,{placeholder:"请输入问题",value:m.question,"onUpdate:value":p[0]||(p[0]=D=>m.question=D),style:{height:"100px"}},null,8,["value"])]),_:1},16),o(x,fe({label:"相似问法(一行一个，最多可添加100个相似问法)"},B(q).unknown_list),{default:n(()=>[o(y,{placeholder:"请输入相似问法",value:m.unknown_list,"onUpdate:value":p[1]||(p[1]=D=>m.unknown_list=D),style:{height:"100px"}},null,8,["value"])]),_:1},16),o(x,fe({label:"答案"},B(q).answer),{default:n(()=>[o(y,{placeholder:"请输入分段答案",value:m.answer,"onUpdate:value":p[2]||(p[2]=D=>m.answer=D),maxlength:1e4,style:{height:"100px"}},null,8,["value"])]),_:1},16),o(x,{label:"附件"},{default:n(()=>[e("div",Vo,[o(L,{activeKey:C.value,"onUpdate:activeKey":p[3]||(p[3]=D=>C.value=D),size:"small"},{default:n(()=>[o(T,{key:"1"},{tab:n(()=>[e("span",null,[o(N,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),p[6]||(p[6]=$(" 图片 ")),m.images.length?(r(),f("span",Eo,"("+Y(m.images.length)+")",1)):X("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(V,{value:m.images,"onUpdate:value":p[4]||(p[4]=D=>m.images=D)},null,8,["value"])])]),_:1})]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Bo=oe(jo,[["__scopeId","data-v-af7afebd"]]),Jo={class:"user-model-page"},Po={class:"search-block"},Qo={class:"left-block"},Ho={class:"right-block"},Xo={class:"list-box"},Wo={class:"qa-list-box"},Zo={class:"list-item"},en={class:"list-content"},tn={class:"classify-scroll-box"},on={key:0,class:"list-item"},nn={class:"list-content"},an={class:"fragment-img"},sn=["src"],ln={class:"import-td-box"},rn={key:0,class:"status-block success"},un={key:1,class:"status-block none"},dn=["href"],_n=["onClick"],mn=["onClick"],cn={__name:"index",setup(Q){const A=We(),I=Me(),{getRobot:k}=I,i=ae(()=>I.robotInfo),C=ae(()=>i.value.unknown_summary_status==1),a=me().query;ot(),l(2);const m=J({start_day:"",end_day:""}),s=J({page:1,size:10,total:0}),z=l([]),O=l(!1),h=()=>{let c={robot_id:a.id,...m,...s};O.value=!0,ct({...c}).then(_=>{z.value=_.data.list.map(D=>({...D,images:D.images?JSON.parse(D.images):[],unknown_list:D.unknown_list?JSON.parse(D.unknown_list):[]})),s.total=+_.data.total||0}).finally(()=>{O.value=!1})};h();const S=c=>{let _=A.getToken,D=m.start_day,g=m.end_day,v=`/manage/getUnknownIssueSummary?robot_id=${a.id}&token=${_}&start_day=${D}&end_day=${g}&export=${c}`;window.location.href=v},q=c=>{s.page=c.current,s.size=c.pageSize,h()},M=()=>{s.page=1,h()},w=c=>{m.start_day=c.start_time,m.end_day=c.end_time,M()},u=l(null),p=c=>{u.value.showModal({id:c.id,library_id:c.to_library_id>0?c.to_library_id:"",answer:c.answer,question:c.question,similar_questions:c.unknown_list,images:c.images})},y=l(null),x=()=>{y.value.show({unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:i.value.unknown_summary_status})},N=c=>{c?y.value.show({unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:1}):ze({id:a.id,unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:0}).then(_=>{Z.success("保存成功"),k(a.id)})},T=l(null),L=c=>{T.value.show({id:c.id,question:c.question,answer:c.answer,unknown_list:c.unknown_list.join(`
`),images:c.images})},V=()=>{k(a.id)};return(c,_)=>{const D=Ue,g=we,v=xt,P=ge,E=bt,ee=wt,se=ht,W=$t,F=dt,ce=Ct,pe=Le,ne=nt("viewer");return r(),f("div",Jo,[o(D,{"show-icon":"",style:{"padding-top":"16px"}},{message:n(()=>_[2]||(_[2]=[e("p",null,"1、开启后，系统将自动将语意相近的未知问题聚类，生成聚类问题",-1),e("p",null,"2、您可以将聚类问题导出，添加回复后更新到知识库单面。",-1)])),_:1}),e("div",Po,[e("div",Qo,[_[5]||(_[5]=e("span",null,"自动聚类",-1)),o(g,null,{title:n(()=>_[3]||(_[3]=[$("开启后，系统将自动将语意相近的未知问题累类，生成聚类问题")])),default:n(()=>[o(B(Ke)),_[4]||(_[4]=$("： "))]),_:1,__:[4]}),o(v,{onChange:N,checked:C.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("a",{onClick:x},"设置")]),e("div",Ho,[o(Fe,{datekey:"4",onDateChange:w}),o(P,{type:"primary",onClick:M},{default:n(()=>_[6]||(_[6]=[$("查询")])),_:1,__:[6]}),o(se,null,{overlay:n(()=>[o(ee,null,{default:n(()=>[o(E,{onClick:_[0]||(_[0]=U=>S("docx")),key:"1"},{default:n(()=>_[7]||(_[7]=[$("下载为docx")])),_:1,__:[7]}),o(E,{onClick:_[1]||(_[1]=U=>S("xlsx")),key:"2"},{default:n(()=>_[8]||(_[8]=[$("下载为xlsx")])),_:1,__:[8]})]),_:1})]),default:n(()=>[o(P,{type:"primary"},{default:n(()=>[_[9]||(_[9]=$(" 下载 ")),o(B(kt))]),_:1,__:[9]})]),_:1})])]),e("div",Xo,[o(pe,{"data-source":z.value,loading:O.value,pagination:{current:s.page,total:s.total,pageSize:s.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:q},{default:n(()=>[o(F,{key:"question",title:"聚类问题",width:480},{default:n(({record:U})=>[e("div",Wo,[e("div",Zo,[_[10]||(_[10]=e("div",{class:"list-label"},"问题",-1)),e("div",en,[$(Y(U.question)+" ",1),U.unknown_total>0?(r(),G(W,{key:0,placement:"topLeft"},{content:n(()=>[e("div",tn,[(r(!0),f(j,null,re(U.unknown_list,(te,le)=>(r(),f("div",{class:"list-item",key:le},Y(te),1))),128))])]),title:n(()=>[e("span",null,"共聚类了"+Y(U.unknown_total)+"个未知问题",1)]),default:n(()=>[e("a",null,"（"+Y(U.unknown_total)+"） ",1)]),_:2},1024)):X("",!0)])]),U.answer?(r(),f("div",on,[_[11]||(_[11]=e("div",{class:"list-label"},"答案",-1)),e("div",nn,Y(U.answer),1)])):X("",!0),ye((r(),f("div",an,[(r(!0),f(j,null,re(U.images,(te,le)=>(r(),f("img",{key:le,src:te,alt:""},null,8,sn))),128))])),[[ne]])])]),_:1}),o(F,{key:"show_date",title:"触发日期",width:120},{default:n(({record:U})=>[$(Y(U.show_date),1)]),_:1}),o(F,{key:"to_library_id",title:"是否导入知识库",width:160},{default:n(({record:U})=>[e("div",ln,[U.to_library_id>0?(r(),f("div",rn,_[12]||(_[12]=[e("span",null,null,-1),$(" 已导入 ")]))):(r(),f("div",un,_[13]||(_[13]=[e("span",null,null,-1),$(" 未导入 ")]))),e("a",{href:`/#/library/details/knowledge-document?id=${U.to_library_id}`,target:"_blank"},Y(U.to_library_name),9,dn)])]),_:1}),o(F,{key:"action",title:"操作",width:135},{default:n(({record:U})=>[o(ce,{gap:8},{default:n(()=>[e("a",{onClick:te=>L(U)},"设置答案",8,_n),e("a",{onClick:te=>p(U)},"导入知识库",8,mn)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])]),o(Ro,{onOk:h,ref_key:"importLibraryModalRef",ref:u},null,512),o(Fo,{onOk:V,ref_key:"autoClusterModalRef",ref:y},null,512),o(Bo,{onOk:h,ref_key:"setAnswerModalRef",ref:T},null,512)])}}},pn=oe(cn,[["__scopeId","data-v-29668232"]]),vn={class:"user-model-page"},qe="/robot/config/unknown_issue/activeKey",fn={__name:"unknow-index",setup(Q){const A=Me(),I=l(+localStorage.getItem(qe)||1),k=ae(()=>A.robotInfo),i=ae(()=>k.value.unknown_summary_status==1),C=()=>{localStorage.setItem(qe,I.value)};return(a,m)=>{const s=he,z=be,O=Be;return r(),f(j,null,[o(z,{class:"tab-wrapper",activeKey:I.value,"onUpdate:activeKey":m[0]||(m[0]=h=>I.value=h),onChange:C},{default:n(()=>[i.value?(r(),f(j,{key:0},[(r(),G(s,{key:2,tab:"未知问题总结"})),(r(),G(s,{key:1,tab:"未知问题统计"}))],64)):(r(),f(j,{key:1},[(r(),G(s,{key:1,tab:"未知问题统计"})),(r(),G(s,{key:2,tab:"未知问题总结"}))],64))]),_:1},8,["activeKey"]),e("div",vn,[o(O,null,{default:n(()=>[I.value==1?(r(),G(Bt,{key:0})):(r(),G(pn,{key:1}))]),_:1})])],64)}}},Va=oe(fn,[["__scopeId","data-v-5395bc93"]]);export{Va as default};
