import{d as $,J as j,N as X,B as q,w as N,x as B,O as Z,q as tt,u as et,v as at,E as H,F as P,e as ot,Q as nt,T as st,M as lt,a as J,V as _t,I as it,W as dt,X as ct,Y as rt,Z as pt,$ as ut}from"./ui-antd-D3ZAJ1Vq.js";import{g as mt}from"./index-DvPlhmYy.js";import{b as E,n as ht,t as kt,o as V,p as vt,q as ft,v as gt,w as yt,x as bt,y as xt,z as wt,j as Dt}from"../../index-0TFHdij1.js";import{i as Ct}from"./charts-BfDgZ-27.js";import{w as St,f as D,o as I,y as Yt,j as zt,Y as O,_ as f,a5 as u,r as U,k as o,u as L,G as x,a2 as s,a7 as w,F as K,a9 as W,a1 as z,a4 as Q,ae as F,e as Mt}from"./vue-chunks-CXJTX1FC.js";import{i as $t}from"./index-B551IHpY.js";import"./utils-yZpnICoG.js";const At={class:"container-echart"},Tt={__name:"line-chart",props:{options:{type:Object,default:()=>({xAxis:[],series:[]})}},setup(R){const g=R;let m;const e=()=>{const _={title:{textStyle:{color:"#262626",textAlign:"center",fontFamily:"PingFang SC",fontSize:"14px",fontStyle:"normal",fontWeight:"600"}},legend:{show:!0,bottom:"0%",textStyle:{color:"#262626",fontSize:"14px"},data:["输入","输出","合计"],itemHeight:6,itemWidth:6,type:"scroll",orient:"horizontal",align:"auto",icon:"circle"},grid:{right:"1.5%",left:"4%",top:"5%",bottom:"20%"},tooltip:{trigger:"axis"},xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#D9D9D9"}},boundaryGap:!1,nameLocation:"end",data:g.options.xAxis,axisLabel:{show:!0,fontSize:10,interval:"auto",rotate:0,lineHeight:26},axisLine:{show:!1}},yAxis:{type:"value",nameLocation:"end",min:0},series:[{name:"输入",type:"line",showSymbol:!1,data:g.options.series.map(i=>i.prompt_token),smooth:!0,color:"#2475fc"},{name:"输出",type:"line",showSymbol:!1,data:g.options.series.map(i=>i.completion_token),smooth:!0,color:"#646161"},{name:"合计",type:"line",showSymbol:!1,data:g.options.series.map(i=>i.total_token),smooth:!0,color:"#4B7900"}]};m.setOption(_,{notMerge:!0})};St(()=>g.options,()=>{setTimeout(()=>{e()},200)},{deep:!0});const r=()=>{m.resize()},h=D(null);return I(()=>{Yt(()=>{m=Ct(h.value),e()}),window.addEventListener("resize",r)}),zt(()=>{window.removeEventListener("resize",r)}),(_,i)=>(f(),O("div",At,[u("div",{ref_key:"chartRef",ref:h,class:"interface-echart"},null,512)]))}},Lt=E(Tt,[["__scopeId","data-v-c44a801e"]]),Ot={class:"statics-content"},Rt={class:"search-box"},Ft={class:"list-box"},Ut={class:"main-title"},Et={style:{"margin-left":"auto"}},It={__name:"statics-by-app",setup(R){const g=ht(),m=D([$().subtract(7,"day"),$()]),e=D([]),r=U({start_date:m.value[0].format("YYYY-MM-DD"),end_date:m.value[1].format("YYYY-MM-DD"),token_app_type:"",robot_id:""}),h=U({page:1,size:20,total:0}),_=D([]),i=D([]),y=()=>{h.page=1,a(),S()},T=d=>{h.page=d.current,h.size=d.pageSize,S()};let M={chatwiki_robot:"机器人",workflow:"工作流",other:"其他"};const S=()=>{V({...r,page:h.page,size:h.size}).then(d=>{let n=d.data.list||[];_.value=n.map(b=>({...b,token_app_type_desc:M[b.token_app_type],completion_token_desc:p(b.completion_token),prompt_token_desc:p(b.prompt_token),total_token_desc:p(b.total_token)})),h.total=+d.data.total})},A=()=>{V({...r,page:h.page,size:1e4}).then(d=>{let n=d.data.list||[];n=n.map(t=>({...t,robot_name:t.robot_name||"",token_app_type_desc:M[t.token_app_type],completion_token_desc:p(t.completion_token),prompt_token_desc:p(t.prompt_token),total_token_desc:p(t.total_token)})),vt(`类型,应用名称,合计消耗(k),输入(k),输出(k),日期
`,n,["token_app_type_desc","robot_name","total_token_desc","prompt_token_desc","completion_token_desc","date"],"明细数据-"+$().format("YYYY-MM-DD HH:mm:ss"))})},l=U({xAxis:[],series:[]}),a=()=>{kt({...r}).then(d=>{let n=d.data.list,b=[],k=[];n.forEach(t=>{b.push($(t.date).format("YY/MM/DD")),k.push({completion_token:p(t.completion_token),prompt_token:p(t.prompt_token),total_token:p(t.total_token)})}),Object.assign(l,{xAxis:b,series:k})})};function p(d){return d<=0?0:(d/1e3).toFixed(2)}const c=()=>{r.start_date="",r.end_date="",m.value&&m.value.length>0&&(r.start_date=m.value[0].format("YYYY-MM-DD"),r.end_date=m.value[1].format("YYYY-MM-DD")),y()},v=()=>{if(r.token_app_type="",r.robot_id="",!e.value){y();return}r.token_app_type=e.value[0],e.value.length>=2&&(r.robot_id=e.value[1]),y()};return I(()=>{mt().then(d=>{let n=d.data||[],b=n.filter(t=>t.application_type==0),k=n.filter(t=>t.application_type==1);i.value=[{label:"机器人",value:"chatwiki_robot",children:b.map(t=>({label:t.robot_name,value:t.id}))},{label:"工作流",value:"workflow",children:k.map(t=>({label:t.robot_name,value:t.id}))},{label:"其他",value:"other"}]}),y()}),(d,n)=>{const b=j,k=X,t=q,C=N,G=B;return f(),O("div",Ot,[u("div",Rt,[o(b,{value:m.value,"onUpdate:value":n[0]||(n[0]=Y=>m.value=Y),allowClear:!1,onChange:c,style:{width:"256px"},presets:L(g)},null,8,["value","presets"]),o(k,{style:{width:"256px"},changeOnSelect:"",onChange:v,value:e.value,"onUpdate:value":n[1]||(n[1]=Y=>e.value=Y),options:i.value,placeholder:"全部应用"},null,8,["value","options"])]),u("div",Ft,[n[4]||(n[4]=u("div",{class:"main-title"},"使用趋势（单位：千）",-1)),o(Lt,{options:l},null,8,["options"]),u("div",Ut,[n[3]||(n[3]=x(" 明细数据（单位：千） ")),u("div",Et,[o(t,{onClick:A},{default:s(()=>n[2]||(n[2]=[x("导出")])),_:1,__:[2]})])]),o(G,{style:{"margin-top":"16px"},"data-source":_.value,pagination:{current:h.page,total:h.total,pageSize:h.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:T},{default:s(()=>[o(C,{title:"类型","data-index":"token_app_type_desc",width:100},{default:s(({record:Y})=>[x(w(Y.token_app_type_desc),1)]),_:1}),o(C,{title:"应用名称","data-index":"robot_name",width:140}),o(C,{title:"合计消耗(k)","data-index":"total_token_desc",width:140},{default:s(({record:Y})=>[x(w(Y.total_token_desc),1)]),_:1}),o(C,{title:"输入(k)","data-index":"prompt_token_desc",width:140},{default:s(({record:Y})=>[x(w(Y.prompt_token_desc),1)]),_:1}),o(C,{title:"输出(k)","data-index":"completion_token_desc",width:140},{default:s(({record:Y})=>[x(w(Y.completion_token_desc),1)]),_:1}),o(C,{title:"日期","data-index":"date",width:140},{default:s(({record:Y})=>[x(w(Y.date),1)]),_:1})]),_:1},8,["data-source","pagination"])])])}}},Nt=E(It,[["__scopeId","data-v-bf298e60"]]),Bt={class:"zm-date"},Pt={class:"date-btn"},Vt={class:"date-content"},Qt={__name:"date",props:{dateType:{type:Number,default:1},rangeData:{type:Array,default:null}},emits:["dateChange"],setup(R,{emit:g}){const m=R,e=D(1),r=g;let h=U([{label:"今日",value:!1,key:2,start_date:$(),end_date:$()},{label:"昨日",value:!1,key:3,start_date:$().subtract(1,"day"),end_date:$().subtract(1,"day")},{label:"近七日",value:!0,key:4,start_date:$().subtract(6,"day"),end_date:$().subtract(0,"day")}]);const _=D(null),i=D(null),y=D([]),T=l=>l>=$().subtract(0,"day"),M=()=>{let l=e.value,a=null;h.forEach(p=>{p.key==l&&(a=p)}),y.value=[a.start_date,a.end_date],_.value=a.start_date.format("YYYY-MM-DD"),i.value=a.end_date.format("YYYY-MM-DD"),A()},S=(l,a)=>{e.value=1,y.value=l,_.value=a[0],i.value=a[1],A()},A=()=>{r("dateChange",{start_date:_.value,end_date:i.value})};return I(()=>{e.value=m.dateType,y.value=m.rangeData}),(l,a)=>{const p=Z,c=tt,v=j;return f(),O("div",Bt,[u("div",Pt,[o(c,{value:e.value,"onUpdate:value":a[0]||(a[0]=d=>e.value=d),onChange:M},{default:s(()=>[(f(!0),O(K,null,W(L(h),d=>(f(),z(p,{class:"date-btn-button",value:d.key,key:d.key},{default:s(()=>[x(w(d.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),u("div",Vt,[o(v,{value:y.value,"onUpdate:value":a[1]||(a[1]=d=>y.value=d),onChange:S,format:"YYYY-MM-DD",disabledDate:T},null,8,["value"])])])}}},jt={class:"team-members-pages"},qt={class:"total"},Ht={class:"total-num"},Jt={class:"set-model"},Kt={class:"set-model-body"},Wt={class:"set-date"},Gt={class:"set-date-body"},Xt={class:"set-reset"},Zt={class:"list-box"},te={class:"user-box"},ee={class:"name-info"},ae={class:"user-name"},oe={__name:"use-token",setup(R){const g=D(Date.now()),m=D(["全部模型"]),e=U({page:1,size:10,total:0,use_model:"全部模型",start_date:"",end_date:""}),r=l=>{e.start_date=l.start_date,e.end_date=l.end_date,i()},h=()=>{e.use_model="全部模型",e.start_date="",e.end_date="",g.value=Date.now(),i()},_=l=>{e.page=l.current,e.size=l.pageSize,M()},i=()=>{e.page=1,M()},y=D([]),T=(l,a)=>{const p=(l.split(".")[1]?l.split(".")[1]:l.split(".")[0]).length,c=(a.split(".")[1]?a.split(".")[1]:a.split(".")[0]).length,v=Math.pow(10,Math.max(p,c));return(l*v+a*v)/v/1e3},M=()=>{let l={page:e.page,size:e.size,start_date:e.start_date,end_date:e.end_date};e.use_model!="全部模型"&&(l.model=e.use_model),ft(l).then(a=>{let p=a.data.list;p.forEach(c=>{c.create_time=c.create_time>0?$(c.create_time*1e3).format("YYYY-MM-DD HH:mm"):"--",c.amount=T(c.prompt_token,c.completion_token)}),y.value=p,e.total=+a.data.total})},S=l=>{e.use_model=l,i()},A=()=>{$t({}).then(l=>{m.value=["全部模型",...l.data]})};return I(()=>{A(),i()}),(l,a)=>{const p=at,c=et,v=q,d=H,n=N,b=B;return f(),O("div",jt,[o(d,{justify:"flex-end"},{default:s(()=>[u("div",qt,[a[1]||(a[1]=u("div",{class:"label total-label"},"共计：",-1)),u("div",Ht,w(e.total)+"条",1)]),u("div",Jt,[a[2]||(a[2]=u("div",{class:"label set-model-label"},"选择模型：",-1)),u("div",Kt,[o(c,{value:e.use_model,"onUpdate:value":a[0]||(a[0]=k=>e.use_model=k),placeholder:"全部模型",onChange:S,style:{width:"200px"}},{default:s(()=>[(f(!0),O(K,null,W(m.value,k=>(f(),z(p,{key:k,value:k},{default:s(()=>[u("span",null,w(k),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),u("div",Wt,[a[3]||(a[3]=u("div",{class:"label set-date-label"},[u("span",null,"统计日期：")],-1)),u("div",Gt,[(f(),z(Qt,{onDateChange:r,key:g.value}))])]),u("div",Xt,[o(v,{onClick:h},{default:s(()=>a[4]||(a[4]=[x("重置")])),_:1,__:[4]})])]),_:1}),u("div",Zt,[o(b,{"data-source":y.value,pagination:e.total>e.size?{current:e.page,total:e.total,pageSize:e.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}:!1,onChange:_},{default:s(()=>[o(n,{title:"模型名称","data-index":"model",width:"300px"},{default:s(({record:k})=>[u("div",te,[u("div",ee,[u("div",ae,w(k.corp)+"（"+w(k.model)+"）",1)])])]),_:1}),o(n,{title:"类型","data-index":"IP",width:"190px"},{default:s(({record:k})=>[x(w(k.type),1)]),_:1}),o(n,{title:"Token消耗(k)","data-index":"amount",width:"190px"},{default:s(({record:k})=>[x(w(k.amount),1)]),_:1}),o(n,{title:"日期","data-index":"date",width:"190px"},{default:s(({record:k})=>[x(w(k.date),1)]),_:1})]),_:1},8,["data-source","pagination"])])])}}},ne=E(oe,[["__scopeId","data-v-be2fc97c"]]),se={__name:"token-quota-modal",emits:["ok"],setup(R,{expose:g,emit:m}){const e=m,r=D(!1),h=D("token限额"),_=U({max_token:"",description:"",robot_id:"",token_app_type:""});function i(c){return c<=0||!c?"":(c/1e3).toFixed(3)}let y=D(0);const T=(c={})=>{r.value=!0,A(),_.max_token=i(c.max_token),_.description=c.description||"",_.robot_id=c.robot_id||"",_.token_app_type=c.token_app_type||"",y.value=i(c.max_token-c.use_token)},M=U({max_token:[{required:!0,message:"请输入token限额",trigger:"blur"}]}),S=P.useForm,{resetFields:A,validate:l,validateInfos:a}=S(_,M),p=()=>{l().then(c=>{gt({..._,max_token:(_.max_token*1e3).toFixed(3)}).then(v=>{J.success("修改成功"),r.value=!1,e("ok")})})};return g({show:T}),(c,v)=>{const d=nt,n=ot,b=st,k=P,t=lt;return f(),z(t,{open:r.value,"onUpdate:open":v[2]||(v[2]=C=>r.value=C),title:h.value,onOk:p,width:540},{default:s(()=>[o(k,{layout:"vertical",style:{"margin-top":"16px"}},{default:s(()=>[o(n,Q({label:"token限额"},L(a).max_token),{default:s(()=>[o(d,{value:_.max_token,"onUpdate:value":v[0]||(v[0]=C=>_.max_token=C),style:{width:"60%"},min:.001,precision:3,placeholder:"请输入"},{addonAfter:s(()=>v[3]||(v[3]=[x(" k ")])),_:1},8,["value"])]),_:1},16),o(n,Q({label:"备注"},L(a).description),{default:s(()=>[o(b,{maxLength:500,style:{height:"80px"},value:_.description,"onUpdate:value":v[1]||(v[1]=C=>_.description=C),placeholder:"请输入"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])}}},le=E(se,[["__scopeId","data-v-73712946"]]),_e={class:"content-box"},ie={class:"search-block"},de={class:"list-box"},ce=["onClick"],re={__name:"quota-token",setup(R){const g=U({search:""}),m=D([]);let e={chatwiki_robot:"机器人",workflow:"工作流",other:"其他"};const r=D(!1),h=()=>{_()},_=()=>{r.value=!0,xt({...g}).then(a=>{m.value=a.data.list||[]}).finally(()=>{r.value=!1})};let i=null;const y=a=>{if(i=a,i.switch_status==1){M();return}l(a)},T=()=>{i==null?_():M()},M=()=>{wt({robot_id:i.robot_id,token_app_type:i.token_app_type,switch_status:i.switch_status==1?0:1}).then(a=>{J.success(`${i.switch_status==1?"关闭":"开启"}成功`),_()})};function S(a){return a<=0||!a?0:(a/1e3).toFixed(3)}const A=D(null),l=(a,p)=>{p&&(i=null),A.value.show(JSON.parse(JSON.stringify(a)))};return I(()=>{_()}),(a,p)=>{const c=it,v=dt,d=H,n=N,b=rt,k=B;return f(),O("div",_e,[u("div",ie,[o(c,{value:g.search,"onUpdate:value":p[0]||(p[0]=t=>g.search=t),placeholder:"搜索名称",style:{width:"220px"},onChange:h},{suffix:s(()=>[o(L(_t),{onClick:h})]),_:1},8,["value"])]),u("div",de,[o(k,{"data-source":m.value,loading:r.value,pagination:!1,sticky:""},{default:s(()=>[o(n,{title:"类型","data-index":"token_app_type",width:120},{default:s(({record:t})=>[o(d,{gap:4,align:"center"},{default:s(()=>[t.token_app_type=="chatwiki_robot"?(f(),z(v,{key:0,size:24,src:L(yt)},null,8,["src"])):F("",!0),t.token_app_type=="workflow"?(f(),z(v,{key:1,size:24,src:L(bt)},null,8,["src"])):F("",!0),t.token_app_type=="other"?(f(),z(v,{key:2,size:24},{icon:s(()=>[o(L(ct),{style:{"font-size":"16px"}})]),_:1})):F("",!0),x(" "+w(L(e)[t.token_app_type]),1)]),_:2},1024)]),_:1}),o(n,{title:"应用名称","data-index":"robot_name",width:160}),o(n,{title:"今日消耗(k)","data-index":"today_use_token",width:130},{default:s(({record:t})=>[x(w(S(t.today_use_token)),1)]),_:1}),o(n,{title:"Token限额(k)","data-index":"amount",width:120},{default:s(({record:t})=>[x(w(t.is_config==1&&t.switch_status==1?S(t.max_token):"-"),1)]),_:1}),o(n,{title:"已消耗(k)","data-index":"amount2",width:120},{default:s(({record:t})=>[x(w(t.switch_status==1?S(t.use_token):"-"),1)]),_:1}),o(n,{title:"剩余(k)","data-index":"amount3",width:120},{default:s(({record:t})=>[x(w(t.switch_status==1?S(t.max_token-t.use_token):"-"),1)]),_:1}),o(n,{title:"备注","data-index":"description",width:200,ellipsis:!0},{default:s(({record:t})=>[x(w(t.description||"--"),1)]),_:1}),o(n,{title:"操作","data-index":"action",width:120},{default:s(({record:t})=>[o(d,{align:"center",gap:8},{default:s(()=>[o(b,{onChange:C=>y(t),checked:t.switch_status==1,"checked-children":"开","un-checked-children":"关"},null,8,["onChange","checked"]),t.switch_status==1?(f(),O("a",{key:0,onClick:C=>l(t,!0)},"设置",8,ce)):F("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading"])]),o(le,{ref_key:"tokenQuotaModalRef",ref:A,onOk:T},null,512)])}}},pe=E(re,[["__scopeId","data-v-97ffeb69"]]),ue={class:"user-model-page"},me={class:"tabs-box"},he={class:"list-wrapper"},ke={__name:"index",setup(R){const g=Dt(),m=Mt(()=>g.role_type),e=D(1);return(r,h)=>{const _=ut,i=pt;return f(),O("div",ue,[u("div",me,[o(i,{activeKey:e.value,"onUpdate:activeKey":h[0]||(h[0]=y=>e.value=y)},{default:s(()=>[(f(),z(_,{key:1,tab:"按应用统计"})),(f(),z(_,{key:2,tab:"按模型统计"})),m.value==1||m.value==2?(f(),z(_,{key:3,tab:"Token限额"})):F("",!0)]),_:1},8,["activeKey"])]),u("div",he,[e.value==1?(f(),z(Nt,{key:0})):F("",!0),e.value==2?(f(),z(ne,{key:1})):F("",!0),e.value==3?(f(),z(pe,{key:2})):F("",!0)])])}}},De=E(ke,[["__scopeId","data-v-6ff601e7"]]);export{De as default};
