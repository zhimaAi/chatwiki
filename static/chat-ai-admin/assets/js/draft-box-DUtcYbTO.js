import{_ as tt}from"./cu-scroll-CpIj948h.js";import{u as ot,bj as st,bk as at,_ as nt}from"../../index-DSFcP5NQ.js";import{r,w as Z,c as ee,E as N,j as lt,J as it,i as te,a as u,p as s,y as a,n as ct,h as L,q as U,t as i,u as l,v as d,b as c,Y as I,F as E,l as K,e as Ce,_ as oe}from"./vue-chunks-BdaA73Wf.js";import{_ as rt}from"./empty-BFmzY9bl.js";import{_ as dt}from"./default-cover-Bm8pZ2KF.js";import{aq as ut,ao as Se,ar as _t,as as pt,at as vt,au as mt}from"./index-Cg7-0swo.js";import{a as ft}from"./create-send-modal-Dj8lPHTY.js";import{_ as gt}from"./emoji-mart-BBMRoEa3.js";import{q as ht,I as yt,M as Oe,a1 as Me,W as ze,i as kt,am as Ie,f as bt,g as xt,a9 as wt,B as Ct,au as St,N as Ot,ag as Mt,b3 as zt,J as It,u as Gt,v as Dt,aB as Lt,b as y,O as Ut}from"./ui-antd-Dl1wwwCD.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";const Et={class:"official-draft-wrapper"},Rt={class:"qa-list-wrapper"},Bt={class:"group-head-box"},Ht={class:"head-title"},$t={class:"flex-between-box"},Tt={class:"search-box"},Wt={class:"classify-box"},Nt=["onClick"],Kt={class:"classify-title"},jt={class:"right-content"},qt={key:0,class:"btn-box"},Pt={class:"hover-btn-wrap"},Vt=["onClick"],Xt=["onClick"],Yt={class:"head-content"},Ft={class:"toolbar"},Jt={key:0,class:"title"},At={class:"pover-group-content-box"},Qt={class:"group-head-box"},Zt={class:"head-title"},eo={class:"flex-between-box"},to={class:"search-box"},oo={class:"classify-box classify-scroll-box"},so=["onClick"],ao={class:"classify-title"},no={class:"right-content"},lo={key:0,class:"btn-box"},io={class:"hover-btn-wrap"},co=["onClick"],ro=["onClick"],uo={class:"header-row"},_o={class:"header-text"},po={class:"content-block"},vo={key:0,class:"loading-box"},mo={key:0,class:"empty-box"},fo={class:"title"},go={key:1,class:"draft-list"},ho=["src"],yo={key:1,class:"thumb",src:dt},ko={class:"info"},bo={class:"title"},xo={class:"meta"},wo={class:"digest"},Co={class:"extra"},So={class:"pagination-box"},Oo={style:{margin:"32px 0 4px"}},Mo={class:"sync-modal"},zo={class:"sync-desc-box"},Io={class:"sync-select-title"},Go={class:"sync-select-box"},Ge="official_draft_group_box_width",De="official_draft_group_hide_key",j=200,se=256,Do={__name:"draft-box",props:{appId:{type:String,default:""},accessKey:{type:String,default:""}},setup(q){const{t:n}=ot("views.explore.article-group-send.draft-box"),k=q,ae=r(null),ne=r(null),P=r(0),R=r(!1);Z(()=>k.appId,()=>{p.value.page=1,k.appId&&ge()});const O=r([]),G=r(""),M=r(-1),le=ee(()=>O.value.filter(t=>(t.group_name||"").includes(G.value))),V=async()=>{let o=(await ut()).data||[];O.value=o.map(_=>({..._,total:0})),await X(),v()},X=async()=>{const t=k.appId,o=O.value.map(async _=>{var S;const m=await Se({page:1,size:1,app_id:t,group_id:_.id}),C=((S=m==null?void 0:m.data)==null?void 0:S.total)||0;_.total=C});await Promise.all(o)},B=(t={})=>{b.id=t.id||0,b.group_name=t.group_name||"",H.value=!0},H=r(!1),b=N({id:0,group_name:""}),Le=async()=>{if(!b.group_name)return y.error(n("error_enter_group_name"));await pt({id:b.id,group_name:b.group_name}),H.value=!1,y.success(n("message_operation_success")),await V()},ie=t=>{Oe.confirm({title:n("modal_delete_group_title",{name:t.group_name}),icon:a(Ut),content:"",okText:n("btn_confirm"),cancelText:n("btn_cancel"),onOk:async()=>{await _t({id:t.id}),await V(),y.success(n("message_operation_success")),M.value==t.id&&(M.value=-1,await z())}})},ce=t=>{M.value=t.id,Be()},x=r([]),Y=r(!1),re=r(0),p=r({page:1,size:20}),Ue=N({title:""}),de=()=>Object.keys(f).filter(t=>f[t]),f=N({}),Ee=ee(()=>de().length),ue=ee({get(){return x.value.length>0&&x.value.every(t=>!!f[t.id])},set(t){x.value.forEach(o=>{f[o.id]=t})}}),Re=()=>{Object.keys(f).forEach(t=>delete f[t])};Z(x,()=>{te(v)},{deep:!0}),Z(O,()=>{te(v)},{deep:!0});const z=async()=>{Y.value=!0;const t=await Se({page:p.value.page,size:p.value.size,title:Ue.title,app_id:k.appId,group_id:M.value}),o=(t==null?void 0:t.data)||{};x.value=o.list||[],re.value=o.total||0,Y.value=!1,Re(),v()},Be=()=>{p.value.page=1,z()},He=(t,o)=>{p.value.page=t,p.value.size=o,z()},$e=()=>{const t=de();if(t.length===0)return y.error(n("error_select_draft_to_move"));w.ids=t.join(","),w.group_id=void 0,$.value=!0},Te=()=>{$e()},F=r(null),We=t=>{F.value&&F.value.show({draft:t})},$=r(!1),w=N({group_id:void 0,ids:""}),Ne=async()=>{if(!w.group_id)return y.error(n("error_select_group"));await vt({draft_id:w.ids,group_id:w.group_id,app_id:k.appId}),$.value=!1,y.success(n("message_move_success")),await z(),await X()},D=r(j),g=r(localStorage.getItem(De)==1),J=r(!1);lt(()=>{st();const t=parseInt(localStorage.getItem(Ge));t&&t>=j&&t<=se&&(D.value=t),k.appId&&ge(),window.addEventListener("resize",v)}),it(()=>{window.removeEventListener("resize",v),at()});const _e=()=>{g.value=!g.value,localStorage.setItem(De,g.value?1:2),v()};let T=!1,pe=0,ve=0;const Ke=t=>{g.value||(T=!0,J.value=!0,pe=t.clientX,ve=D.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",me),document.addEventListener("mouseup",fe))},me=t=>{if(!T)return;let o=ve+(t.clientX-pe);o=Math.max(j,Math.min(se,o)),D.value=o},fe=()=>{T&&(T=!1,J.value=!1,localStorage.setItem(Ge,D.value),document.body.style.cursor="",document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",fe),v())},ge=async()=>{await V(),await z(),v()},v=()=>{te(()=>{const t=ae.value,o=ne.value;if(!t||!o)return;const _=t.style.height;t.style.height="auto";const m=t.scrollHeight||t.offsetHeight||0;t.style.height=_;const C=o.scrollHeight||o.offsetHeight||0;P.value=Math.max(m,C)})},he=t=>{const o=O.value.find(_=>_.id==t);return o?o.group_name:t==0?n("group_unassigned"):""},je=()=>{y.success(n("message_create_send_success"))},W=r(!1),A=r(0),qe={0:n("sync_mark_100"),1:n("sync_mark_200"),2:n("sync_mark_1000"),3:n("sync_mark_all")},Pe=[100,200,1e3,0],Ve=()=>{W.value=!0},Xe=async()=>{const t=Pe[A.value]||0;R.value=!0,await mt({access_key:k.accessKey,limit:t}),R.value=!1,y.success(n("message_sync_submitted")),W.value=!1,setTimeout(()=>{z(),X()},800),setTimeout(()=>{v()},1e3)};return(t,o)=>{const _=nt,m=ht,C=yt,S=xt,ye=bt,ke=kt,be=tt,Ye=wt,xe=Ct,we=Ot,Fe=Mt,Je=zt,Q=Oe,Ae=Dt,Qe=Gt,Ze=It,et=Lt;return c(),u("div",Et,[s("div",Rt,[s("div",{class:L(["group-content-box",[{collapsed:g.value},{"no-transition":J.value}]]),ref_key:"groupContentRef",ref:ae,style:ct(g.value?{}:{width:D.value+"px",minWidth:j+"px",maxWidth:se+"px",height:P.value?P.value+"px":void 0})},[s("div",Bt,[s("div",Ht,[a(m,{title:l(n)("tooltip_collapse_group")},{default:i(()=>[s("div",{class:"hover-btn-wrap",onClick:_e},[a(_,{name:"put-away"})])]),_:1},8,["title"]),s("div",$t,[s("div",null,d(l(n)("draft_group_title")),1),a(m,{title:l(n)("tooltip_new_group")},{default:i(()=>[s("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=e=>B({}))},[a(l(Me))])]),_:1},8,["title"])])]),s("div",Tt,[a(C,{value:G.value,"onUpdate:value":o[2]||(o[2]=e=>G.value=e),allowClear:"",placeholder:l(n)("search_group_placeholder"),style:{width:"100%"}},{suffix:i(()=>[a(l(ze),{onClick:o[1]||(o[1]=I(()=>{},["stop"]))})]),_:1},8,["value","placeholder"])])]),s("div",Wt,[a(be,{style:{"padding-right":"24px"}},{default:i(()=>[(c(!0),u(E,null,K(le.value,e=>(c(),u("div",{class:L(["classify-item",{active:e.id==M.value}]),onClick:h=>ce(e),key:e.id},[s("div",Kt,d(e.group_name),1),s("div",jt,[s("div",{class:L(["num",{"num-block":e.id<=0}])},d(e.total),3),e.id>0?(c(),u("div",qt,[a(ke,{placement:"bottomRight"},{overlay:i(()=>[a(ye,null,{default:i(()=>[a(S,null,{default:i(()=>[s("div",{onClick:I(h=>B(e),["stop"])},"重命名",8,Vt)]),_:2},1024),a(S,null,{default:i(()=>[s("div",{onClick:I(h=>ie(e),["stop"])},"删 除",8,Xt)]),_:2},1024)]),_:2},1024)]),default:i(()=>[s("div",Pt,[a(l(Ie))])]),_:2},1024)])):U("",!0)])],10,Nt))),128))]),_:1})]),g.value?U("",!0):(c(),u("div",{key:0,class:"resize-bar",onMousedown:Ke},null,32))],6),s("div",{class:"main-content-box",ref_key:"mainContentRef",ref:ne},[a(be,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:i(()=>[s("div",Yt,[s("div",Ft,[g.value?(c(),u("div",Jt,[a(Ye,{title:null,placement:"bottom"},{content:i(()=>[s("div",At,[s("div",Qt,[s("div",Zt,[s("div",eo,[s("div",null,d(l(n)("draft_group_title")),1),a(m,{title:l(n)("tooltip_new_group")},{default:i(()=>[s("div",{class:"hover-btn-wrap",onClick:o[3]||(o[3]=e=>B({}))},[a(l(Me))])]),_:1},8,["title"])])]),s("div",to,[a(C,{allowClear:"",value:G.value,"onUpdate:value":o[5]||(o[5]=e=>G.value=e),placeholder:l(n)("search_group_placeholder"),style:{width:"100%"}},{suffix:i(()=>[a(l(ze),{onClick:o[4]||(o[4]=I(()=>{},["stop"]))})]),_:1},8,["value","placeholder"])])]),s("div",oo,[(c(!0),u(E,null,K(le.value,e=>(c(),u("div",{class:L(["classify-item",{active:e.id==M.value}]),onClick:h=>ce(e),key:e.id},[s("div",ao,d(e.group_name),1),s("div",no,[s("div",{class:L(["num",{"num-block":e.id<=0}])},d(e.total),3),e.id>0?(c(),u("div",lo,[a(ke,{placement:"bottomRight"},{overlay:i(()=>[a(ye,null,{default:i(()=>[a(S,null,{default:i(()=>[s("div",{onClick:I(h=>B(e),["stop"])},"重命名",8,co)]),_:2},1024),a(S,null,{default:i(()=>[s("div",{onClick:I(h=>ie(e),["stop"])},"删 除",8,ro)]),_:2},1024)]),_:2},1024)]),default:i(()=>[s("div",io,[a(l(Ie))])]),_:2},1024)])):U("",!0)])],10,so))),128))])])]),default:i(()=>[s("div",{class:"hover-btn-wrap",onClick:_e},[a(_,{name:"expand"})])]),_:1})])):U("",!0),a(xe,{type:"primary",onClick:Ve,loading:R.value},{default:i(()=>[R.value?U("",!0):(c(),Ce(l(St),{key:0})),oe(d(l(n)("btn_sync_draft")),1)]),_:1},8,["loading"]),a(xe,{disabled:Ee.value===0,onClick:Te},{default:i(()=>[oe(d(l(n)("btn_batch_group")),1)]),_:1},8,["disabled"])]),s("div",uo,[a(we,{checked:ue.value,"onUpdate:checked":o[6]||(o[6]=e=>ue.value=e)},null,8,["checked"]),s("span",_o,d(l(n)("header_content")),1)])]),s("div",po,[Y.value?(c(),u("div",vo,[a(Fe)])):(c(),u(E,{key:1},[x.value.length===0?(c(),u("div",mo,[o[15]||(o[15]=s("img",{src:rt},null,-1)),s("div",fo,d(l(n)("empty_no_draft")),1)])):(c(),u("div",go,[(c(!0),u(E,null,K(x.value,e=>(c(),u("div",{class:"draft-item",key:e.id},[a(we,{checked:f[e.id],"onUpdate:checked":h=>f[e.id]=h},null,8,["checked","onUpdate:checked"]),e.thumb_url?(c(),u("img",{key:0,class:"thumb",src:e.thumb_url},null,8,ho)):(c(),u("img",yo)),s("div",ko,[s("div",bo,d(e.title),1),s("div",xo,d(l(n)("draft_group_label"))+d(he(e.group_id)),1),s("div",wo,d(e.digest),1)]),s("div",Co,[a(_,{name:"group-send",class:"icon",onClick:h=>We(e),style:{"font-size":"32px",cursor:"pointer",color:"transparent"}},null,8,["onClick"])])]))),128))])),s("div",So,[a(Je,{current:p.value.page,"onUpdate:current":o[7]||(o[7]=e=>p.value.page=e),"page-size":p.value.size,"onUpdate:pageSize":o[8]||(o[8]=e=>p.value.size=e),total:re.value,pageSizeOptions:["10","20","50","100"],"show-size-changer":"",onChange:He},null,8,["current","page-size","total"])])],64))])]),_:1})],512)]),a(Q,{open:H.value,"onUpdate:open":o[10]||(o[10]=e=>H.value=e),title:l(n)("modal_add_group_title"),onOk:Le},{default:i(()=>[s("div",Oo,d(l(n)("modal_group_name_label")),1),a(C,{value:b.group_name,"onUpdate:value":o[9]||(o[9]=e=>b.group_name=e),placeholder:l(n)("modal_group_name_placeholder"),style:{"margin-bottom":"20px"}},null,8,["value","placeholder"])]),_:1},8,["open","title"]),a(Q,{open:$.value,"onUpdate:open":o[12]||(o[12]=e=>$.value=e),title:l(n)("modal_batch_move_group_title"),onOk:Ne},{default:i(()=>[a(Ze,{align:"center",style:{margin:"24px 0"}},{default:i(()=>[s("div",null,d(l(n)("modal_move_to_group_label")),1),a(Qe,{value:w.group_id,"onUpdate:value":o[11]||(o[11]=e=>w.group_id=e),style:{flex:"1"},placeholder:l(n)("modal_select_group_placeholder")},{default:i(()=>[(c(!0),u(E,null,K(O.value.filter(e=>e.id>0),e=>(c(),Ce(Ae,{key:e.id,value:e.id},{default:i(()=>[oe(d(e.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1})]),_:1},8,["open","title"]),a(ft,{ref_key:"createSendModalRef",ref:F,"app-id":q.appId,"access-key":q.accessKey,"get-group-name":he,onCreated:je},null,8,["app-id","access-key"]),a(Q,{open:W.value,"onUpdate:open":o[14]||(o[14]=e=>W.value=e),title:l(n)("modal_sync_draft_title"),width:478,onOk:Xe},{default:i(()=>[s("div",Mo,[s("div",zo,d(l(n)("sync_desc")),1),s("div",Io,d(l(n)("sync_select_title")),1),s("div",Go,[a(et,{min:0,max:3,step:null,value:A.value,"onUpdate:value":o[13]||(o[13]=e=>A.value=e),marks:qe,tooltipOpen:!1},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Fo=gt(Do,[["__scopeId","data-v-fe18b75a"]]);export{Fo as default};
//# sourceMappingURL=draft-box-DUtcYbTO.js.map
