import{b as O,d as j,ar as N,bc as R,b7 as G,bF as H,k as Q,F as K,aq as W,bb as X}from"../../index-OnalErht.js";import{Y as L,F as Z,a9 as ee,_ as g,a5 as t,a7 as x,B as w,k as n,a2 as i,f as C,e as M,r as q,o as ae,a1 as te,a4 as F,u as D,aa as oe,ae as ne,G as se}from"./vue-chunks-Ci-XTWEs.js";import{b as le,c as re,D as ie,a as B,F as I,e as de,I as _e,Q as ce,M as S,B as pe,z as ue,H as fe}from"./ui-antd-BgeWxFcI.js";import{t as me}from"./validate-8MtiUsxW.js";import{A as ye}from"./avatar-input-CEtimh2_.js";import{_ as ve}from"./page-alert-D1Mg_1Ia.js";import"./utils-ChQO-_r6.js";const be={class:"list-box"},ge=["onClick"],he={class:"library-info"},ke=["src"],xe={class:"library-info-content"},Le={class:"library-title"},we={class:"item-body"},Ce={class:"library-desc"},$e={class:"item-footer"},Ae={class:"library-size"},De={class:"text-item"},Be={class:"text-item"},Oe=["onClick"],qe=["onClick"],Fe={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup($,{emit:h}){const y=h,u=$,_=d=>{y("edit",d)},c=d=>{y("delete",d)};return(d,p)=>{const f=j,v=re,e=le,r=ie;return g(),L("div",be,[(g(!0),L(Z,null,ee(u.list,a=>(g(),L("div",{class:"list-item-wrapper",key:a.id},[t("div",{class:"list-item",onClick:w(s=>_(a),["stop"])},[t("div",he,[t("img",{class:"library-icon",src:a.avatar,alt:""},null,8,ke),t("div",xe,[t("div",Le,x(a.library_name),1)])]),t("div",we,[t("div",Ce,x(a.library_intro),1)]),t("div",$e,[t("div",Ae,[t("span",De,"文档："+x(a.file_total),1),t("span",Be,"大小："+x(a.file_size_str),1)]),t("div",{class:"action-box",onClick:p[1]||(p[1]=w(()=>{},["stop"]))},[n(r,null,{overlay:i(()=>[n(e,null,{default:i(()=>[n(v,null,{default:i(()=>[t("a",{href:"javascript:;",onClick:w(s=>_(a),["stop"])},"管 理",8,Oe)]),_:2},1024),n(v,null,{default:i(()=>[t("a",{class:"delete-text-color",href:"javascript:;",onClick:s=>c(a)},"删 除",8,qe)]),_:2},1024)]),_:2},1024)]),default:i(()=>[t("div",{class:"action-item",onClick:p[0]||(p[0]=w(()=>{},["stop"]))},[n(f,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,ge)]))),128))])}}},Ie=O(Fe,[["__scopeId","data-v-8d366fcc"]]),Ne={class:"form-box"},Re={__name:"add-library-model",setup($,{expose:h}){B.config({duration:2});const y=oe(),u=C(!1),_=M(()=>1);let c="",d="";const p=I.useForm,f=C(!1),v=_.value==0?N:R,e=q({type:_.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:v,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:_.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),r=q({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:a,validateInfos:s}=p(e,r),k=o=>{e.avatar=o.imageUrl,e.avatar_file=o.file},T=()=>{u.value=!1},E=()=>{a().then(()=>{P()}).catch(o=>{})},P=()=>{let o=new FormData,l=JSON.parse(JSON.stringify(e));o.append("type",e.type),o.append("access_rights",e.access_rights),o.append("library_name",e.library_name),o.append("library_intro",e.library_intro),o.append("use_model",l.use_model),o.append("model_config_id",e.model_config_id),o.append("avatar",e.avatar_file?e.avatar_file:""),o.append("is_offline",e.is_offline),o.append("urls",JSON.stringify(me(e.urls))),o.append("doc_type",e.doc_type),o.append("file_name",e.file_name),o.append("is_qa_doc",e.is_qa_doc),o.append("qa_index_type",e.qa_index_type),o.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),f.value=!0,G(o).then(b=>{B.success("创建成功"),d=b.data.id,c=b.data.library_key,U(b.data.id)}).catch(()=>{f.value=!1})},z=async()=>await H({library_key:c,doc_id:"",doc_type:"4",pid:0,title:"无标题文档",content:"# 无标题文档",sort:0}),U=()=>{z().then(o=>{let l=o.data.doc_id;y.replace({path:"/public-library/editor",query:{library_id:d,library_key:c,doc_id:l}})})};return h({show:()=>{u.value=!0}}),ae(()=>{}),(o,l)=>{const b=_e,A=de,V=ce,J=I,Y=S;return g(),te(Y,{open:u.value,"onUpdate:open":l[3]||(l[3]=m=>u.value=m),title:"添加知识库",onOk:E,confirmLoading:f.value,onCancel:T,width:"640px"},{default:i(()=>[t("div",Ne,[n(J,{"label-col":{span:5}},{default:i(()=>[n(A,F({ref:"name",label:"知识库名称"},D(s).library_name),{default:i(()=>[n(b,{value:e.library_name,"onUpdate:value":l[0]||(l[0]=m=>e.library_name=m),type:"text",placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),n(A,{label:"知识库简介"},{default:i(()=>[n(V,{maxlength:1e3,value:e.library_intro,"onUpdate:value":l[1]||(l[1]=m=>e.library_intro=m),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(A,F({ref:"name",label:"知识库封面"},D(s).avatar),{default:i(()=>[n(ye,{value:e.avatar,"onUpdate:value":l[2]||(l[2]=m=>e.avatar=m),onChange:k},null,8,["value"]),l[4]||(l[4]=t("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1,__:[4]},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Me=O(Re,[["__scopeId","data-v-17846dfc"]]),Se={"bg-color":"#f5f9ff",class:"library-page"},Te={class:"library-page-body"},Ee={class:"list-toolbar"},Pe={class:"toolbar-box"},ze={class:"list-total"},Ue={key:0,class:"toolbar-box"},Ve={__name:"index",setup($){let{role_permission:h,role_type:y}=Q();const u=M(()=>y==1||h.includes("CreateOpenLibDoc")),_=C(null),c=C([]),d=()=>{K({type:1}).then(r=>{let a=r.data||[];a.forEach(s=>{s.file_size_str=W(s.file_size),s.avatar||(s.avatar=s.type==0?N:R)}),c.value=a})};d();const p=()=>{_.value.show()},f=r=>{window.open(`/#/public-library/home?library_id=${r.id}&library_key=${r.library_key}`,"_blank","noopener")},v=r=>{let a=3,s=S.confirm({title:`删除${r.library_name}`,icon:n(fe),content:"您确定要删除此知识库吗？",okText:a+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){e(r)},onCancel(){}}),k=setInterval(()=>{a==1?(s.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(k),k=void 0):(a-=1,s.update({okText:a+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},e=({id:r})=>{X({id:r}).then(()=>{B.success("删除成功"),d()})};return(r,a)=>{const s=pe;return g(),L("div",Se,[a[3]||(a[3]=t("div",{class:"page-title"},"对外文档",-1)),n(ve,{style:{"margin-bottom":"16px"},title:"使用说明"},{default:i(()=>a[1]||(a[1]=[t("div",null,[t("p",null," 1、对外文档作为在线文档创作管理工具，创作的文档既可作为知识库关联到机器人使用，也可分享给好友查看。 "),t("p",null,"2、支持设置每篇文档的title、description、keyword，提高SEO搜索权重。")],-1)])),_:1,__:[1]}),t("div",Te,[t("div",Ee,[t("div",Pe,[t("h3",ze,"全部 ("+x(c.value.length)+")",1)]),u.value?(g(),L("div",Ue,[n(s,{type:"primary",onClick:a[0]||(a[0]=k=>p())},{icon:i(()=>[n(D(ue))]),default:i(()=>[a[2]||(a[2]=se(" 新建对外文档 "))]),_:1,__:[2]})])):ne("",!0)]),t("div",null,[n(Ie,{list:c.value,onAdd:p,onEdit:f,onDelete:v},null,8,["list"])])]),n(Me,{ref_key:"addLibraryModelRef",ref:_},null,512)])}}},Xe=O(Ve,[["__scopeId","data-v-962b1c5e"]]);export{Xe as default};
