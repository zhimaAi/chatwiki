{"version":3,"file":"select-wechat-app-CPFxsGeL.js","sources":["../../../../front-end/chat-ai-admin-vue/src/components/common/select-wechat-app.vue"],"sourcesContent":["<template>\r\n  <a-modal\r\n    v-model:open=\"visible\"\r\n    :title=\"title\"\r\n    :confirm-loading=\"saving\"\r\n    width=\"626px\"\r\n  >\r\n    <slot name=\"alert\">\r\n      <a-alert type=\"info\" class=\"zm-alert-info mt12\">\r\n        <template #message>\r\n          {{ t('official_account_list_source') }}<a @click=\"linkOfficial\">{{ t('link_edit_add_official_account') }}</a>\r\n        </template>\r\n      </a-alert>\r\n    </slot>\r\n    <LoadingBox v-if=\"loading\" style=\"margin: 10vh 0;\"/>\r\n    <template v-else-if=\"list.length\">\r\n      <div style=\"margin-bottom: 12px;\">\r\n        <a-checkbox\r\n          v-model:checked=\"allChcked\"\r\n          :disabled=\"!selectRows.length\"\r\n          @change=\"allChckedChange\">{{ t('select_all') }}\r\n        </a-checkbox>\r\n      </div>\r\n      <a-checkbox-group v-model:value=\"selectedKeys\">\r\n        <div class=\"wechat-app-list\">\r\n          <div v-for=\"item in list\"\r\n               :key=\"item.id\"\r\n               :class=\"['wechat-app-item', {disabled: disabledAppIds.includes(item.app_id)}]\"\r\n               @click=\"select(item)\"\r\n          >\r\n            <div class=\"item-body\">\r\n              <img class=\"app-avatar\" :src=\"item.app_avatar\" alt=\"\"/>\r\n              <div class=\"app-info\">\r\n                <div class=\"app-name\">{{ item.app_name }}</div>\r\n                <div class=\"app-desc\">{{ t('appid_label') }}{{ item.app_id }}</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"ext-info-list\">\r\n              <div class=\"status-block status-success\" v-if=\"item.account_is_verify == 'true'\">\r\n                <CheckCircleFilled/>\r\n                {{ t('verified') }}\r\n              </div>\r\n              <div v-else class=\"status-block status-warning\">\r\n                <ExclamationCircleFilled/>\r\n                {{ t('unverified') }}\r\n              </div>\r\n              <span @click.stop>\r\n                <a-checkbox :value=\"item.app_id\" :disabled=\"disabledAppIds.includes(item.app_id)\" @change=\"checkedChange\"/>\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </a-checkbox-group>\r\n    </template>\r\n    <EmptyBox v-else :title=\"t('no_official_account_bound')\">\r\n      <template #desc>\r\n        <a-button type=\"primary\" @click=\"linkOfficial\">{{ t('bind_official_account') }}</a-button>\r\n      </template>\r\n    </EmptyBox>\r\n\r\n    <template #footer>\r\n      <a-button type=\"primary\" :disabled=\"!selectedKeys.length\" @click=\"save\">{{ okText }}</a-button>\r\n    </template>\r\n  </a-modal>\r\n</template>\r\n<script setup>\r\nimport {ref, computed, toRaw, nextTick} from 'vue';\r\nimport {useRouter} from 'vue-router';\r\nimport {ExclamationCircleFilled, CheckCircleFilled} from '@ant-design/icons-vue';\r\nimport LoadingBox from \"@/components/common/loading-box.vue\";\r\nimport EmptyBox from \"@/components/common/empty-box.vue\";\r\nimport {getWechatAppList} from \"@/api/robot/index.js\";\r\nimport {usePermissionStore} from \"@/stores/modules/permission.js\";\r\nimport { useI18n } from '@/hooks/web/useI18n';\r\n\r\nconst { t } = useI18n('components.common.select-wechat-app');\r\n\r\nconst emit = defineEmits(['ok'])\r\nconst props = defineProps({\r\n  title: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  okText: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  disabledAppIds: {\r\n    type: Array,\r\n    default: () => ([])\r\n  }\r\n})\r\n\r\nconst title = computed(() => props.title || t('select_official_account'))\r\nconst okText = computed(() => props.okText || t('confirm_button'))\r\nconst router = useRouter()\r\nconst permissionStore = usePermissionStore()\r\n\r\nconst visible = ref(false)\r\nconst loading = ref(false)\r\nconst saving = ref(false)\r\nconst allChcked = ref(false)\r\nconst robotInfo = ref({})\r\nconst list = ref([])\r\nconst selectedKeys = ref([])\r\n\r\n// const officialPerm = computed(() => {\r\n//   let {role_permission, role_type} = permissionStore\r\n//   return role_type == 1 || role_permission.includes('OfficialAccountManage')\r\n// })\r\n\r\nconst selectRows = computed(() => {\r\n  return list.value.filter(item => !props.disabledAppIds.includes(item.app_id))\r\n})\r\n\r\nfunction open(r, ids) {\r\n  robotInfo.value = r\r\n  selectedKeys.value = Array.isArray(ids) ? ids : []\r\n  loadData()\r\n  visible.value = true\r\n}\r\n\r\nfunction close() {\r\n  visible.value = false\r\n}\r\n\r\nfunction loadData() {\r\n  loading.value = true\r\n  getWechatAppList({\r\n    app_type: 'official_account',\r\n    app_name: ''\r\n  }).then((res) => {\r\n    list.value = res.data || []\r\n  }).finally(() => {\r\n    loading.value = false\r\n  })\r\n}\r\n\r\nfunction save() {\r\n  let rows = list.value.filter(item => selectedKeys.value.includes(item.app_id))\r\n  emit('ok', toRaw(selectedKeys.value), toRaw(rows))\r\n}\r\n\r\nfunction linkOfficial() {\r\n  const url = router.resolve({path: '/user/official-account'})\r\n  window.open(url.href, '_blank')\r\n}\r\n\r\nfunction select(item) {\r\n  if (props.disabledAppIds.includes(item.app_id)) return\r\n  let _idx = selectedKeys.value.indexOf(item.app_id)\r\n  if (_idx > -1) {\r\n    selectedKeys.value.splice(_idx, 1)\r\n  } else {\r\n    selectedKeys.value.push(item.app_id)\r\n  }\r\n  checkedChange()\r\n}\r\n\r\nfunction checkedChange() {\r\n  nextTick(() => {\r\n    allChcked.value = (selectedKeys.value.length === selectRows.value.length)\r\n  })\r\n}\r\n\r\nfunction allChckedChange() {\r\n  if (allChcked.value) {\r\n    selectedKeys.value = []\r\n    list.value.map(i => {\r\n      if (!props.disabledAppIds.includes(i.app_id)) {\r\n        selectedKeys.value.push(i.app_id)\r\n      }\r\n    })\r\n  } else {\r\n    selectedKeys.value = []\r\n  }\r\n}\r\n\r\ndefineExpose({\r\n  open,\r\n  close\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.action-box {\r\n  text-align: right;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.wechat-app-list {\r\n  display: flex;\r\n  gap: 16px;\r\n  flex-flow: row wrap;\r\n\r\n  .wechat-app-item {\r\n    width: 280px;\r\n    height: fit-content;\r\n    padding: 8px;\r\n    border-radius: 8px;\r\n    border: 1px solid #e4e6eb;\r\n    overflow: hidden;\r\n    cursor: pointer;\r\n    position: relative;\r\n\r\n    &.disabled {\r\n      color: rgba(0, 0, 0, .25);\r\n      background-color: #f5f5f5;\r\n      border-color: #d9d9d9;\r\n      text-shadow: none;\r\n      box-shadow: none;\r\n      cursor: not-allowed;\r\n    }\r\n\r\n    &:not(.disabled):hover {\r\n      box-shadow: 0 3px 14px 2px #0000000d,\r\n      0 8px 10px 1px #0000000f,\r\n      0 5px 5px -3px #0000001a;\r\n    }\r\n\r\n    .app-info-block {\r\n      display: flex;\r\n      align-items: center;\r\n    }\r\n\r\n\r\n    .item-body {\r\n      display: flex;\r\n      align-items: center;\r\n      overflow: hidden;\r\n    }\r\n\r\n    .app-info {\r\n      flex: 1;\r\n      overflow: hidden;\r\n    }\r\n\r\n    .app-avatar {\r\n      display: block;\r\n      width: 32px;\r\n      height: 32px;\r\n      border-radius: 16px;\r\n      margin-right: 12px;\r\n      border: 1px solid #f0f0f0;\r\n    }\r\n\r\n    .app-name,\r\n    .app-desc {\r\n      width: 100%;\r\n      overflow: hidden;\r\n      white-space: nowrap;\r\n      text-overflow: ellipsis;\r\n    }\r\n\r\n    .app-name {\r\n      line-height: 24px;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      color: #262626;\r\n    }\r\n\r\n    .app-desc {\r\n      line-height: 20px;\r\n      font-size: 12px;\r\n      font-weight: 400;\r\n      color: #8c8c8c;\r\n      margin-top: 4px;\r\n    }\r\n\r\n    .ext-info-list {\r\n      margin-top: 12px;\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      color: #595959;\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n\r\n      .status-block {\r\n        display: flex;\r\n        align-items: center;\r\n        border-radius: 6px;\r\n        padding: 0 6px;\r\n        font-size: 14px;\r\n        line-height: 22px;\r\n        gap: 2px;\r\n\r\n        &.status-success {\r\n          background: #cafce4;\r\n          color: #21a665;\r\n        }\r\n\r\n        &.status-warning {\r\n          background: #fae4dc;\r\n          color: #ed744a;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.mt12 {\r\n  margin-bottom: 12px;\r\n}\r\n</style>\r\n"],"names":["t","useI18n","emit","__emit","props","__props","title","computed","okText","router","useRouter","usePermissionStore","visible","ref","loading","saving","allChcked","robotInfo","list","selectedKeys","selectRows","item","open","r","ids","loadData","close","getWechatAppList","res","save","rows","toRaw","linkOfficial","url","select","_idx","checkedChange","nextTick","allChckedChange","i","__expose","_createBlock","_component_a_modal","$event","_createVNode","_component_a_button","_renderSlot","_ctx","_component_a_alert","_unref","_createElementVNode","LoadingBox","_createElementBlock","_Fragment","_hoisted_1","_component_a_checkbox","_component_a_checkbox_group","_hoisted_2","_renderList","_hoisted_4","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_openBlock","_hoisted_10","CheckCircleFilled","_createTextVNode","_hoisted_11","ExclamationCircleFilled","EmptyBox"],"mappings":"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"}