import{I as re,b as Ce,d as Me,B as De,M as Ie,bF as je,k,dk as Ue,bG as ze,dl as Pe,bH as Ee}from"../../index-CzPebXix.js";import{j as s,d as i,z as oe,w as Fe,a3 as Ae,N as m,O as d,U as f,H as le,I as se,X as t,a6 as y,S as T,Y as Ne,u as J,_ as S,F as X,a1 as Be,Z as O,a5 as $e,x as Te}from"./vue-chunks-BRsu9_To.js";import{U as Ve}from"./index-CO6rvZOl.js";import{u as Ge}from"./util-BwuffJOK.js";import{C as He}from"./index-DGkdJwWs.js";import{M as Qe}from"./index-BMSQkwth.js";import"./index-BFhVTGQQ.js";import{I as Re}from"./Input-DFtZp9vk.js";import{S as Je,a as Xe}from"./index-6HDf6TPN.js";import{T as Ye,_ as Ze}from"./index-YQhVm4Ni.js";import{L as Ke}from"./LeftOutlined-BKUTcRtP.js";import{_ as We}from"./index-w2fyHr10.js";import{_ as et}from"./TextArea-DrgXbuSS.js";import{_ as tt}from"./index-B_XKw_Lk.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};function ne(c){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?Object(arguments[n]):{},p=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),p.forEach(function(u){ot(c,u,r[u])})}return c}function ot(c,n,r){return n in c?Object.defineProperty(c,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[n]=r,c}var Y=function(n,r){var p=ne({},n,r.attrs);return s(re,ne({},p,{icon:at}),null)};Y.displayName="StarFilled";Y.inheritAttrs=!1;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function ie(c){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?Object(arguments[n]):{},p=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),p.forEach(function(u){st(c,u,r[u])})}return c}function st(c,n,r){return n in c?Object.defineProperty(c,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[n]=r,c}var Z=function(n,r){var p=ie({},n,r.attrs);return s(re,ie({},p,{icon:lt}),null)};Z.displayName="StarOutlined";Z.inheritAttrs=!1;const nt={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},it={class:"custom-modal-header"},rt={key:1},ut={key:2},dt={class:"form-box-wrapper"},ct={key:0,class:"form-item"},vt={class:"form-content"},mt={key:1,class:"form-item"},_t={class:"form-content"},pt={class:"star-item-box"},ft={key:2},gt={class:"form-item"},yt={class:"form-content"},bt={class:"form-item"},ht={class:"form-content"},xt={class:"form-item"},wt={class:"form-content"},kt={key:0,class:"error-tip"},St={key:3,class:"form-item"},Ot={class:"form-content"},Lt={key:0,class:"error-tip"},qt={class:"form-item"},Ct={class:"form-content"},Mt={class:"upload-box-wrapper"},Dt={key:0},It={key:4,class:"form-item"},jt={class:"form-label-box"},Ut={class:"form-content"},zt={class:"ai-generate-wrapper"},Pt={class:"form-box-wrapper ai-generate-wrapper-box"},Et={class:"ai-generate-wrapper-left"},Ft={class:"form-box-wrapper-options"},At={class:"form-item flex1"},Nt={class:"form-content"},Bt={class:"form-item flex1"},$t={class:"form-content dual-inputs"},Tt={class:"input-group"},Vt={class:"form-label-input-box"},Gt={class:"form-box-wrapper-content"},Ht={class:"problem-box"},Qt={class:"problem-content"},Rt={class:"problem-box"},Jt={class:"problem-content"},Xt={class:"form-item generate-btn-box"},Yt={class:"result-nav"},Zt={key:0,class:"tip"},Kt={key:1,class:"result-nav-text"},Wt={key:0,class:"container"},ea={class:"result-container"},ta=["innerHTML"],aa={class:"result-footer"},oa={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(c,{expose:n,emit:r}){const p=i(!1),u=i(!1),V=i(!1),C=i(!1),M=i(!1),v=oe({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5}),ue=new Qe({html:!0,linkify:!0,typographer:!0}),K=i(""),D=oe({finish:"",content:""});Fe(()=>D.content,()=>{K.value=ue.render(D.content)});const I=Ae(),de=I.query,j=I.name,z=c,G=r,ce=i(""),ve=["azure","ollama","xinference","openaiAgent"],W=i("1"),L=i(!1),P=i(""),x=i(""),b=i(""),w=i(""),h=i(""),q=i([]),U=i(0),E=i(""),F=i("0"),g=i(!1),me=a=>{u.value=!1,V.value=!1,M.value=!1,P.value=a.title||"",x.value=a.content||"",E.value=a.id||"",b.value=a.answer||"",q.value=a.images||[],w.value=a.question||"",h.value=a.similar_questions?a.similar_questions.join(`
`):"",g.value=z.detailsInfo.is_qa_doc=="1",U.value=a.category_id||0,F.value=a.group_id||"0",Q(),g&&_e(),L.value=!0},ee=i([]),_e=()=>{Ee({library_id:z.detailsInfo.library_id}).then(a=>{ee.value=a.data||[]})},H=i([]),Q=()=>{Pe({file_id:de.id}).then(a=>{let e=a.data||[];e=e.map(l=>({value:l.id,payload:{...l,color:nt[l.type]}})),j=="categaryManages"?H.value=[...e]:H.value=[{value:0,payload:{id:0,name:"未标记"}},...e],G("handleStatrList",a.data||[])})},te=()=>{if(ae(),!x.value&&!g.value)return k.error("请输入分段内容");if(!w.value&&g.value)return k.error("请输入分段问题");if(!b.value&&g.value)return k.error("请输入分段答案");if(g.value&&b.value.length>1e4||!g.value&&x.value.length>1e4)return;if(j=="categaryManages"&&U.value<=0)return k.error("请选择分类标记");let a={title:P.value,content:x.value,question:w.value,answer:b.value,images:q.value,category_id:U.value};g.value&&(a.group_id=F.value||0);let e=h.value.trim();e?(e=e.split(`
`),a.similar_questions=JSON.stringify(e)):a.similar_questions="[]",E.value?a.id=E.value:a.file_id=I.query.id;let l=new FormData;for(let _ in a)Ge.isArray(a[_])?a[_].forEach(R=>{l.append(_,R)}):l.append(_,a[_]);j=="knowledgeDocument"&&(l.delete("file_id"),l.append("library_id",I.query.id)),j=="libraryConfig"&&(l.delete("file_id"),l.append("library_id",z.detailsInfo.library_id)),j=="categaryManages"?(l.delete("file_id"),l.append("library_id",I.query.id),Ue(l).then(_=>{k.success(a.id?"修改成功":"添加成功"),L.value=!1,G("handleEdit",{...a}),Q()})):ze(l).then(_=>{k.success(a.id?"修改成功":"添加成功"),L.value=!1,G("handleEdit",{...a}),Q()})},pe=()=>{u.value=!0},A=i(""),fe=async()=>{D.content="",A.value="",C.value=!0,M.value=!0;try{let a={library_id:z.detailsInfo.library_id,model_config_id:v.model_config_id,use_model:v.use_model,num:v.count,question:w.value,answer:b.value};const e=await je(a);A.value=e.data.map(l=>l).join(`
`),D.content=e.data.map((l,_)=>`<div class="dialog-message">${_+1}. ${l}</div>`).join(""),V.value=!0}finally{C.value=!1}},ge=()=>{h.value?h.value+=`
${A.value}`:h.value+=A.value,k.success("保存成功"),V.value=!1,u.value=!1,M.value=!1},ye=a=>{v.use_model=ve.includes(a.rawData.model_define)&&a.rawData.deployment_name?a.rawData.deployment_name:a.rawData.name,v.use_model_icon=a.icon,v.use_model_name=a.use_model_name,v.model_config_id=a.rawData.id,ce.value=a.rawData.model_define},N=i([]),be=a=>{N.value=a,Te(()=>{(!v.ai_chunk_model||!Number(v.ai_chunk_model_config_id))&&he()})},he=()=>{if(N.value.length>0){let a=null,e=null;for(let l of N.value)if(l.model_define==="tongyi"){a=l;for(let _ of a.children)if(_.name==="qwen-max"){e=_;break}break}a||(a=N.value[0],e=a.children[0]),a&&e&&(v.use_model=e.name,v.model_config_id=e.model_config_id,v.ai_chunk_model=e.name,v.ai_chunk_model_config_id=e.model_config_id)}};function xe(a){return a.split(`
`).map(e=>e.trim()).filter(e=>e).join(`
`)}const ae=()=>{h.value=xe(h.value)};return n({showModal:me}),(a,e)=>{const l=De,_=Re,R=We,we=Xe,ke=Je,B=et,$=Me,Se=Ze,Oe=Ye,Le=tt,qe=Ie;return d(),m("div",null,[s(qe,{open:L.value,"onUpdate:open":e[13]||(e[13]=o=>L.value=o),onOk:te,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:u.value?M.value?"944px":"472px":"746px","ok-button-props":{style:{display:u.value?"none":"block"}}},{title:f(()=>[t("div",it,[u.value?(d(),T(l,{key:0,type:"text",class:"back-button",onClick:e[0]||(e[0]=o=>u.value=!1)},{icon:f(()=>[s(J(Ke),{style:{"font-size":"12px"}})]),_:1})):y("",!0),u.value?(d(),m("span",rt,"AI生成相似问法")):(d(),m("span",ut,S(E.value?"编辑分段":"新增分段"),1))])]),footer:f(()=>[u.value?y("",!0):(d(),m(X,{key:0},[s(l,{onClick:e[12]||(e[12]=o=>L.value=!1)},{default:f(()=>e[32]||(e[32]=[O("取消")])),_:1,__:[32]}),s(l,{type:"primary",onClick:te},{default:f(()=>e[33]||(e[33]=[O("确定")])),_:1,__:[33]})],64))]),default:f(()=>[le(t("div",dt,[g.value?y("",!0):(d(),m("div",ct,[e[14]||(e[14]=t("div",{class:"form-label"},"分段标题：",-1)),t("div",vt,[s(_,{maxLength:25,value:P.value,"onUpdate:value":e[1]||(e[1]=o=>P.value=o),placeholder:"请输入分段标题"},null,8,["value"])])])),g.value?y("",!0):(d(),m("div",mt,[e[15]||(e[15]=t("div",{class:"form-label"},"分段分类标记",-1)),t("div",_t,[s(R,{value:U.value,"onUpdate:value":e[2]||(e[2]=o=>U.value=o),options:H.value},{label:f(({payload:o})=>[t("div",pt,[o.id>0?(d(),T(J(Y),{key:0,style:Ne({color:o.color})},null,8,["style"])):(d(),T(J(Z),{key:1})),t("div",null,S(o.name||"-"),1),o.data_count>0?(d(),m("span",ft,"("+S(o.data_count)+")",1)):y("",!0)])]),_:1},8,["value","options"])])])),g.value?(d(),m(X,{key:2},[t("div",gt,[e[16]||(e[16]=t("div",{class:"form-label required"},"所属分组：",-1)),t("div",yt,[s(ke,{value:F.value,"onUpdate:value":e[3]||(e[3]=o=>F.value=o),style:{width:"100%"}},{default:f(()=>[(d(!0),m(X,null,Be(ee.value,o=>(d(),T(we,{value:o.id},{default:f(()=>[O(S(o.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),t("div",bt,[e[17]||(e[17]=t("div",{class:"form-label required"},"分段问题：",-1)),t("div",ht,[s(B,{placeholder:"请输入分段问题",value:w.value,"onUpdate:value":e[4]||(e[4]=o=>w.value=o),style:{height:"100px"}},null,8,["value"])])]),t("div",xt,[e[18]||(e[18]=t("div",{class:"form-label required"},"分段答案：",-1)),t("div",wt,[s(B,{placeholder:"请输入分段答案",value:b.value,"onUpdate:value":e[5]||(e[5]=o=>b.value=o),style:{height:"100px"}},null,8,["value"]),b.value.length>1e4?(d(),m("div",kt,"分段答案最多支持10000个字符")):y("",!0)])])],64)):(d(),m("div",St,[e[19]||(e[19]=t("div",{class:"form-label required"},"分段内容：",-1)),t("div",Ot,[s(B,{style:{height:"150px"},value:x.value,"onUpdate:value":e[6]||(e[6]=o=>x.value=o),placeholder:"请输入分段内容"},null,8,["value"]),x.value.length>1e4?(d(),m("div",Lt,"分段内容最多支持10000个字符")):y("",!0)])])),t("div",qt,[t("div",Ct,[t("div",Mt,[s(Oe,{activeKey:W.value,"onUpdate:activeKey":e[7]||(e[7]=o=>W.value=o),size:"small"},{default:f(()=>[s(Se,{key:"1"},{tab:f(()=>[t("span",null,[s($,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),e[20]||(e[20]=O(" 答案附图 ")),q.value.length?(d(),m("span",Dt,"("+S(q.value.length)+")",1)):y("",!0)])]),_:1})]),_:1},8,["activeKey"]),s(Ve,{value:q.value,"onUpdate:value":e[8]||(e[8]=o=>q.value=o)},null,8,["value"])])])]),g.value?(d(),m("div",It,[t("div",jt,[e[22]||(e[22]=t("div",{class:"form-label"},"相似问法",-1)),t("div",{class:"ai-generate",onClick:pe},[s($,{name:"ai-generate",style:{"font-size":"14px"}}),e[21]||(e[21]=t("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),t("div",Ut,[s(B,{placeholder:"请输入相似问法",value:h.value,"onUpdate:value":e[9]||(e[9]=o=>h.value=o),style:{height:"100px"},onBlur:ae},null,8,["value"]),e[23]||(e[23]=t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])])):y("",!0)],512),[[se,!u.value]]),le(t("div",zt,[t("div",Pt,[t("div",Et,[t("div",Ft,[t("div",At,[e[24]||(e[24]=t("div",{class:"form-label required"},"相似问法模型：",-1)),t("div",Nt,[s(He,{modelValue:v.use_model,"onUpdate:modelValue":e[10]||(e[10]=o=>v.use_model=o),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":v.model_config_id,onChange:ye,onLoaded:be},null,8,["modelValue","model-config-id"])])]),t("div",Bt,[t("div",$t,[t("div",Tt,[e[26]||(e[26]=t("div",{class:"form-label required"},"问题个数：",-1)),t("div",Vt,[s(Le,{value:v.count,"onUpdate:value":e[11]||(e[11]=o=>v.count=o),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),e[25]||(e[25]=O("个 "))])])])])]),t("div",Gt,[t("div",Ht,[e[27]||(e[27]=t("div",{class:"problem"},"问题",-1)),t("div",Qt,S(w.value),1)]),t("div",Rt,[e[28]||(e[28]=t("div",{class:"problem"},"答案",-1)),t("div",Jt,S(b.value),1)])]),t("div",Xt,[s(l,{onClick:fe,loading:C.value,class:"generate-btn"},{default:f(()=>[s($,{name:"ai-generate-white",style:{"font-size":"16px"}}),e[29]||(e[29]=O(" 开始生成 "))]),_:1,__:[29]},8,["loading"])])]),t("div",{class:$e(["ai-generate-wrapper-right",{"show-result":M.value}])},[t("div",Yt,[s($,{name:"generate-icon",style:{"font-size":"14px"}}),C.value?(d(),m("span",Zt,"相似问法生成中...")):(d(),m("div",Kt,"相似问法生成完毕"))]),!D.content&&C.value&&!p.value?(d(),m("div",Wt,e[30]||(e[30]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)]))):y("",!0),t("div",ea,[t("div",{class:"dialog-content",innerHTML:K.value},null,8,ta)]),t("div",aa,[s(l,{class:"result-footer-btn",type:"primary",onClick:ge},{default:f(()=>e[31]||(e[31]=[O("保存相似问法")])),_:1,__:[31]})])],2)])],512),[[se,u.value]])]),_:1},8,["open","width","ok-button-props"])])}}},ya=Ce(oa,[["__scopeId","data-v-aaaff20f"]]);export{ya as E,Y as S,Z as a,nt as c};
