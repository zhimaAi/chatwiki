import{_ as H,b as j,B as se,e as ee,M as oe,E as ce}from"../../index-BokOG9ZU.js";import{a as _e,e as ue,g as pe,d as fe}from"./index-DsZKODME.js";import{r as S,L as e,M as c,F as $,a1 as q,a2 as de,Y as h,u as A,V as d,j as x,ab as ye,Q as _,X as B,a8 as M,E as ve,G as ge,P as T,a9 as P,a3 as ie,a4 as re,A as me,ac as he,U as ke,ad as we,b as te}from"./vue-chunks-XoCroLmQ.js";import{_ as be}from"./index-BOYSy9Pq.js";import{F as le,_ as xe}from"./index-fISAHuLd.js";import"./index-BgMvvztK.js";import{R as Ie,_ as Ce}from"./RadioButton-DYdQQdGT.js";import{S as Ae,_ as Me}from"./index-DgLLvjt3.js";import"./index-BitUTYbL.js";import{I as Te}from"./Input-CUxLS_nc.js";import{_ as $e}from"./index-BPT5gdLF.js";import{_ as Ke,a as Se}from"./index-xOgFOS5S.js";import{_ as Ee}from"./index-D8UclsBd.js";import"./dayjs-D8VPPBbu.js";import"./axios-Cm0UX6qg.js";import"./qs-D73tJGQG.js";import"./crypto-js-D323TfIu.js";import"./colors-Cfqlh7qR.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./responsiveObserve-Cyut9UHK.js";import"./collapseMotion-DWwsCVG2.js";import"./QuestionCircleOutlined-DEWzrvxy.js";import"./FormItemContext-Ch_K4tn1.js";import"./index-Co375E0k.js";import"./slide-BpJSAeCl.js";import"./index-CnyiohbP.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-Byfa85ke.js";import"./DownOutlined-I-3QmTPt.js";import"./SearchOutlined-BfUHdq7e.js";import"./move-ChusaJh2.js";import"./Search-CbUpX_hw.js";import"./inputProps-CWzf5mAp.js";import"./TextArea-TiJWDxF4.js";import"./Password-D_H-hnpK.js";import"./css-MNT4q5hR.js";import"./index-Bf_Ayn3y.js";import"./LeftOutlined-DN6j0fW4.js";import"./RightOutlined-CViLB99g.js";import"./index-BJ6pqfZz.js";import"./index-mOJL8w2K.js";import"./dropdown-_4lkCpvo.js";import"./Dropdown-aJrAR27s.js";import"./index-CvsTLiPQ.js";import"./shallowequal-BeorLzKa.js";const Be={class:"page-tabs"},De=["onClick"],Le={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(n,{emit:u}){const{t:a}=j(),i=u,I=n,p=S([{value:1,title:a("views.user.model.modelsHaveBeenAdded"),langKey:"views.user.model.modelsHaveBeenAdded"},{value:0,title:a("views.user.model.canAddAModel"),langKey:"views.user.model.canAddAModel"}]),K=m=>{i("update:value",m),i("change",m)};return(m,w)=>(e(),c("div",Be,[(e(!0),c($,null,q(p.value,b=>(e(),c("div",{class:de(["tab-item",{active:I.value==b.value}]),onClick:f=>K(b.value),key:b.value},h(A(a)(b.langKey)),11,De))),128))]))}},Oe=H(Le,[["__scopeId","data-v-5999ba44"]]),Ne=n=>(ie("data-v-72110a96"),n=n(),re(),n),Pe={class:"model-list"},Re={class:"model-item-left"},Ue={class:"model-item-left-top"},qe=["src"],Ve={class:"model-name"},ze=Ne(()=>d("div",{class:"line"},null,-1)),Fe={class:"model-tags"},Xe={key:0,class:"tag"},Ge={class:"model-item-left-bottom"},Je={class:"model-desc"},He={class:"model-item-right"},je={__name:"model-list",props:{type:{type:Number,default:()=>1},list:{type:Array,default:()=>[]}},emits:["edit","new","see","remove","add"],setup(n,{emit:u}){const{t:a}=j(),i=u,I=["azure","ollama","xinference","openaiAgent"],p=n,K=v=>{i("see",P(v))},m=v=>{let g=P(v);i("edit",g,g.config_list[0])},w=v=>{i("new",P(v))},b=v=>{i("add",P(v))},f=v=>{let g=P(v);i("remove",g.config_list[0])};return(v,g)=>{const R=be,y=se;return e(),c("div",Pe,[(e(!0),c($,null,q(p.list,s=>(e(),c("div",{class:"model-item",key:s.model_define},[d("div",Re,[d("div",Ue,[d("img",{class:"model-logo",src:s.model_icon_url,alt:""},null,8,qe),d("div",Ve,h(s.model_name),1),ze,d("div",Fe,[(e(!0),c($,null,q(s.support_list,(t,C)=>(e(),c("div",{key:C},[x(R,null,ye({default:_(()=>[t!="SPEECH2TEXT"&&t!="TTS"?(e(),c("span",Xe,h(t),1)):M("",!0)]),_:2},[t=="LLM"?{name:"title",fn:_(()=>[B("大语言模型，添加机器人时需要选择一个大语言模型。用户的提问将交由大语言模型，结合知识库给出答案。")]),key:"0"}:t=="TEXT EMBEDDING"?{name:"title",fn:_(()=>[B("嵌入模型，添加知识库时需要选择嵌入模型，用于将知识库分段向量化。用户提问时也会将问题生成向量，通过比对向量相似度的方式四配跟提问语义相近的知识库分段。向量检索具备很好的语义分析能力。")]),key:"1"}:t=="RERANK"?{name:"title",fn:_(()=>[B("重排序模型,通过重排序模型,将从知识库中检索出来的分段进行重新排序。再将重排序的结果前top-K传递个大语言模型生成答案。重排序有助于优化检索结果，提高大语言模型回答的准确性。")]),key:"2"}:void 0]),1024)]))),128))])]),d("div",Ge,[d("div",Je,h(s.introduce),1)])]),d("div",He,[ve(x(y,{class:de({"btn-red":s.listType==1&&p.type==1}),onClick:t=>f(s)},{default:_(()=>[B(h(s.listType==1&&p.type==1?"移除配置":"删除"),1)]),_:2},1032,["class","onClick"]),[[ge,p.type==1]]),p.type==2&&s.model_define!="azure"?(e(),T(y,{key:0,class:"add-btn",onClick:t=>K(s)},{default:_(()=>[B("查看模型")]),_:2},1032,["onClick"])):M("",!0),p.type==2?(e(),T(y,{key:1,disabled:s.listType==1,class:"add-btn",onClick:t=>b(s)},{default:_(()=>[B("添加配置")]),_:2},1032,["disabled","onClick"])):M("",!0),s.listType==1&&p.type==1?(e(),c($,{key:2},[I.indexOf(s.model_define)>-1?(e(),c($,{key:0},[x(y,{class:"add-btn",onClick:t=>K(s)},{default:_(()=>[B(h(A(a)("views.user.model.modelConfigButton"))+"（"+h(s.config_list.length)+"）",1)]),_:2},1032,["onClick"]),x(y,{class:"add-btn",onClick:t=>w(s)},{default:_(()=>[B(h(A(a)("views.user.model.addModelButton")),1)]),_:2},1032,["onClick"])],64)):(e(),c($,{key:1},[x(y,{class:"add-btn",onClick:t=>m(s)},{default:_(()=>[B(h(A(a)("views.user.model.editModelButton")),1)]),_:2},1032,["onClick"]),x(y,{class:"add-btn",onClick:t=>K(s)},{default:_(()=>[B(h(A(a)("views.user.model.viewModelButton")),1)]),_:2},1032,["onClick"])],64))],64)):M("",!0)])]))),128))])}}},ne=H(je,[["__scopeId","data-v-72110a96"]]),D={componentType:"input",placeholder:"",defaultValue:""},Qe={componentType:"radio",defaultValue:void 0},Ye={componentType:"select",defaultValue:void 0},ae={id:{hidden:!0},model_types:{...Qe,key:"model_types",label:"模型类型",optionsKey:"supported_type",options:[],disabled:!1,rules:[{required:!0,message:"请选择模型类型",trigger:"change"}]},deployment_name:{...D,label:"部署名称",placeholder:"请与Azure 部署名称保持一致",rules:[{required:!0,message:"请输入部署名称",trigger:"change"}]},model_name:{...D,label:"模型名称",placeholder:"模型名称请保持一致",rules:[{required:!0,message:"请输入模型名称",trigger:"change"}]},api_endpoint:{...D,label:"API 域名",placeholder:"请输入您的API 域名",rules:[{required:!0,message:"请输入API 域名",trigger:"change"}]},model_context_length:{...D,label:"模型上下文长度",placeholder:"请输入您的模型上下文长度",rules:[{required:!0,message:"请输入模型上下文长度",trigger:"change"}]},model_uid:{...D,label:"模型UID",placeholder:"请输入您的模型UID",rules:[{required:!0,message:"请输入模型UID",trigger:"change"}]},api_key:{...D,label:"API Key",placeholder:"请输入您的API Key",rules:[{required:!0,message:"请输入API Key",trigger:"change"}]},secret_key:{...D,label:"Secret Key",placeholder:"请输入您的Secret Key",rules:[{required:!0,message:"请输入Secret Key",trigger:"change"}]},api_version:{...Ye,label:"API 版本",placeholder:"请输入您的API 版本",optionsKey:"api_versions",options:[],rules:[{required:!0,message:"请选择API 版本",trigger:"change"}]},app_id:{...D,label:"appid",placeholder:"请输入appid",rules:[{required:!0,message:"请输入appid",trigger:"change"}]},region:{...D,label:"region",placeholder:"请输入地区",rules:[{required:!0,message:"请输入地区",trigger:"change"}]}};function We(n,u){if((u=="yiyan"||u=="doubao")&&n=="secret_key")return{...D,label:"Secret Key",placeholder:"请输入您的Secret Key"};if(ae[n])return ae[n];let a={...D};return a.placeholder="请输入您的"+n,a}const Ze={columns:[{title:"模型名称",dataIndex:"model_name",key:"model_name",langKey:"views.user.model.model_name"},{title:"模型类型",dataIndex:"model_type",key:"model_type",langKey:"views.user.model.model_type"}],rows:[],showAddBtn:!1},eo={azure:{columns:[{title:"部署名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"API版本",dataIndex:"api_version",key:"api_version",langKey:"views.user.model.api_version"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},ollama:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"BaseURL",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},openaiAgent:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"BaseURL",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"API Key",dataIndex:"api_key",key:"api_key",langKey:"views.user.model.api_key"},{title:"API版本",dataIndex:"api_version",key:"api_version",langKey:"views.user.model.api_version"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},xinference:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"服务器地址",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0}},oo=["azure","ollama","xinference","openaiAgent"];function to(n){if(oo.indexOf(n.model_define)>-1)return n.config_list;{let u=[];return n.llm_model_list||(n.llm_model_list=[]),n.llm_model_list.forEach(a=>{u.push({model_name:a,model_type:"LLM"})}),n.vector_model_list||(n.vector_model_list=[]),n.vector_model_list.forEach(a=>{u.push({model_name:a,model_type:"TEXT EMBEDDING"})}),u}}function lo(n){let u=["model_define","model_icon_url"],a=eo[n.model_define];return a||(a=Ze),u.forEach(i=>{a[i]=n[i]}),a.rows=to(n),a}const no={class:"form-wrapper"},ao={class:"model-logo-box"},so=["src"],io={key:0,href:"https://www.yuque.com/zhimaxiaoshiwangluo/pggco1/hmwl4gveq4xwa4uw?singleDoc# ",target:"_blank"},ro={class:"form-box"},mo={class:"form-item-label"},co={key:0},_o={key:1},uo=["href"],po={__name:"set-model-alert",emits:["ok"],setup(n,{expose:u,emit:a}){const{t:i}=j(),I=a,p=le.useForm,K=S(""),m=me({model_icon_url:"",model_define:"",model_name:""}),w=S(!1),b=S({}),f=S({}),v=S([]),g=["ollama","xinference","openaiAgent"],R=(k,l)=>{b.value={},f.value={},v.value=[];const{model_icon_url:Z,model_define:Y,model_name:X,history_config_params:G}=k;let V=k.config_params;K.value=l?i("common.edit")+" "+X:i("common.add")+" "+X,m.model_icon_url=Z,m.model_define=Y,m.model_name=X;let O={},z={},J=[];V.unshift("id"),l&&G&&G.length>0&&(V=[...V,...G]),V.forEach(o=>{o=="model_type"&&(o="model_types"),g.indexOf(k.model_define)>-1&&o=="deployment_name"&&(o="model_name");let r=We(o,Y);r.key=o,r.help_links=k.help_links,r.disabled=!1,r.key=="model_types"&&l&&(r.disabled=!0);let F=r.options;l?(g.indexOf(l.model_define)>-1&&l.deployment_name&&(l.model_name=l.deployment_name),z[o]=l[o]||void 0):z[o]=r.defaultValue,r.optionsKey&&k[r.optionsKey]&&(F=k[r.optionsKey]),r.hidden||J.push({...r,options:F,key:o}),r.rules&&(O[o]=r.rules)}),k.model_define=="doubao"?(l||(z.region="cn-beijing"),J.forEach(o=>{o.key=="deployment_name"&&(o.placeholder="请输入接入点ID")}),O.deployment_name&&O.deployment_name.length&&(O.deployment_name[0].message="请输入接入点ID")):O.deployment_name&&O.deployment_name.length&&(O.deployment_name[0].message="请输入部署名称"),b.value=O,f.value=z,v.value=J,w.value=!0,setTimeout(()=>{s()},100)},{resetFields:y,clearValidate:s,validate:t,validateInfos:C}=p(f,b),E=()=>{t().then(()=>{f.value.id?Q():L()}).catch(k=>{})},U=()=>{y(),s()},N=S(!1),L=()=>{let k=P(f.value),l=JSON.parse(JSON.stringify(k));l.model_type=l.model_types,l.model_define=m.model_define,g.indexOf(l.model_define)>-1&&l.model_name&&(l.deployment_name=l.model_name,delete l.model_name),N.value=!0,_e(l).then(()=>{N.value=!1,w.value=!1,ee.success(i("common.saveSuccess")),I("ok")}).catch(()=>{N.value=!1})},Q=()=>{let k=P(f.value),l=JSON.parse(JSON.stringify(k));l.model_type=l.model_types,l.model_define=m.model_define,g.indexOf(l.model_define)>-1&&l.model_name&&(l.deployment_name=l.model_name,delete l.model_name),N.value=!0,ue(l).then(()=>{N.value=!1,w.value=!1,ee.success(i("common.saveSuccess")),I("ok")}).catch(()=>{N.value=!1})};return u({open:R}),(k,l)=>{const Z=Ie,Y=Ce,X=Ae,G=Me,V=Te,O=xe,z=le,J=oe;return e(),T(J,{class:"add-model-alert",width:"650px",open:w.value,"onUpdate:open":l[0]||(l[0]=o=>w.value=o),title:K.value,confirmLoading:N.value,onOk:E,onCancel:U,maskClosable:!1},{default:_(()=>[d("div",no,[d("div",ao,[d("img",{class:"model-logo",src:m.model_icon_url,alt:""},null,8,so),m.model_define=="doubao"?(e(),c("a",io,"查看使用说明>")):M("",!0)]),d("div",ro,[x(z,{layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18}},{default:_(()=>[(e(!0),c($,null,q(v.value,o=>(e(),c($,{key:o.key},[o.hidden?M("",!0):(e(),T(O,he(ke({key:0},A(C)[o.key])),{label:_(()=>[d("div",mo,[m.model_define=="doubao"&&o.key=="deployment_name"?(e(),c("span",co,"接入点ID")):(e(),c("span",_o,h(A(i)("views.user.model."+o.key)),1))])]),default:_(()=>[o.componentType=="radio"?(e(),T(Y,{key:0,value:f.value[o.key],"onUpdate:value":r=>f.value[o.key]=r,disabled:o.disabled},{default:_(()=>[(e(!0),c($,null,q(o.options,(r,F)=>(e(),T(Z,{value:r,key:F},{default:_(()=>[d("span",null,h(r),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled"])):M("",!0),o.componentType=="select"?(e(),T(G,{key:1,value:f.value[o.key],"onUpdate:value":r=>f.value[o.key]=r,placeholder:o.placeholder},{default:_(()=>[(e(!0),c($,null,q(o.options,(r,F)=>(e(),T(X,{value:r,key:F},{default:_(()=>[d("span",null,h(r),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):M("",!0),o.componentType=="input"?(e(),c($,{key:2},[x(V,{value:f.value[o.key],"onUpdate:value":r=>f.value[o.key]=r,placeholder:o.placeholder},null,8,["value","onUpdate:value","placeholder"]),o.key=="api_key"?(e(),c("a",{key:0,href:o.help_links,target:"_blank"},h(A(i)("views.user.model.getApikeyText")),9,uo)):M("",!0)],64)):M("",!0)]),_:2},1040))],64))),128))]),_:1})])])]),_:1},8,["open","title","confirmLoading"])}}},fo=H(po,[["__scopeId","data-v-f60bd420"]]),yo={class:"form-wrapper"},vo={class:"tools-wrapper"},go=["src"],ho={class:"tools-box"},ko={class:"list-box"},wo=["onClick"],bo=["onClick"],xo={__name:"see-model-alert",emits:["new","edit","remove"],setup(n,{expose:u,emit:a}){const{t:i}=j(),I=a,p=S(!1),K=["ollama","xinference","openaiAgent"],m=me({model_icon_url:"",model_define:"",columns:[],rows:[],showAddBtn:!1});let w=we({});const b=y=>{w=y;let s=lo(y);for(let t in s)m[t]=s[t];p.value=!0},f=()=>{p.value=!1,I("new",{...w})},v=y=>{p.value=!1,I("edit",{...w},P(y))},g=y=>{p.value=!1,I("remove",P(y))},R=()=>{};return u({open:b}),(y,s)=>{const t=se,C=$e,E=Ke,U=Se,N=oe;return e(),T(N,{class:"add-model-alert",width:"800px",open:p.value,"onUpdate:open":s[0]||(s[0]=L=>p.value=L),title:A(i)("views.user.model.modelConfigButton"),footer:null,onOk:R},{default:_(()=>[d("div",yo,[d("div",vo,[d("img",{class:"model-logo",src:m.model_icon_url,alt:""},null,8,go),d("div",ho,[m.showAddBtn?(e(),T(t,{key:0,type:"primary",onClick:f},{default:_(()=>[B(h(A(i)("views.user.model.addModel")),1)]),_:1})):M("",!0)])]),d("div",ko,[x(U,{"data-source":m.rows,scroll:{y:400},pagination:!1},{default:_(()=>[(e(!0),c($,null,q(m.columns,L=>(e(),c($,{key:L.key},[L.key=="action"?(e(),T(E,{key:0,title:A(i)("common.action"),"data-index":L.key,width:"140px"},{default:_(({record:Q})=>[d("span",null,[d("a",{onClick:k=>v(Q)},h(A(i)("common.edit")),9,wo),x(C,{type:"vertical"}),d("a",{onClick:k=>g(Q)},h(A(i)("common.remove")),9,bo)])]),_:2},1032,["title","data-index"])):(e(),T(E,{key:1,title:A(i)("views.user.model."+(K.indexOf(m.model_define)>-1&&L.key=="deployment_name"?"model_name":L.key)),"data-index":L.key},null,8,["title","data-index"]))],64))),128))]),_:1},8,["data-source"])])])]),_:1},8,["open","title"])}}},Io=H(xo,[["__scopeId","data-v-905dacec"]]),W=n=>(ie("data-v-1f3aa710"),n=n(),re(),n),Co={class:"user-model-page"},Ao={class:"list-wrapper"},Mo={key:0,class:"alert-content-box"},To=W(()=>d("div",{class:"title"},"使用说明",-1)),$o=W(()=>d("div",null,"1、模型主要分为嵌入模型（TEXT EMBEDDING）和大模型（LLM），嵌入模型用于将上传知识库的文本内容进行向量化便于后续检索，大模型用于将检索到的相关知识进行理解后返回答案。",-1)),Ko=W(()=>d("div",null,"2、配置模型时尽量选择同时支持LLM和TEXT EMBEDDING的模型，否则要配置多个模型。",-1)),So=W(()=>d("div",null,"3、国内模型厂商一般都需要认证后才可使用，所以在配置模型前，确保在模型服务厂商那里已认证，否则配置模型时会提示配置参数错误。",-1)),Eo={__name:"index",setup(n){const{t:u}=j(),a=S(1),i=()=>{},I=S([]),p=te(()=>I.value.filter(t=>t.listType==1)),K=te(()=>I.value),m=()=>{pe().then(t=>{let C=t.data||[];C.forEach(E=>{E.listType=E.config_list.length>0?1:0}),C.sort((E,U)=>E.listType-U.listType),I.value=C})};m();const w=S(null),b=t=>{w.value.open(t)},f=t=>{g.value.open(t)},v=t=>{g.value.open(t)},g=S(null),R=(t,C)=>{g.value.open(t,C)},y=()=>{m()},s=t=>{oe.confirm({title:u("views.user.model.deleteModel"),icon:x(ce),content:u("views.user.model.deleteModelContent"),onOk(){fe({id:t.id}).then(()=>{ee.success(u("common.deleteSuccessful")),m()})}})};return(t,C)=>{const E=Ee;return e(),c($,null,[d("div",Co,[x(Oe,{value:a.value,"onUpdate:value":C[0]||(C[0]=U=>a.value=U),onChange:i},null,8,["value"]),d("div",Ao,[a.value==0?(e(),c("div",Mo,[x(E,{"show-icon":""},{message:_(()=>[To,$o,Ko,So]),_:1})])):M("",!0),a.value==1?(e(),T(ne,{list:p.value,type:1,key:"addedModelList",onEdit:R,onNew:f,onSee:b,onRemove:s},null,8,["list"])):M("",!0),a.value==0?(e(),T(ne,{list:K.value,type:2,key:"canAddModelList",onAdd:v,onSee:b},null,8,["list"])):M("",!0)])]),x(Io,{ref_key:"seeModelAlertRef",ref:w,onNew:f,onEdit:R,onRemove:s},null,512),x(fo,{ref_key:"setModelAlertRef",ref:g,onOk:y},null,512)],64)}}},It=H(Eo,[["__scopeId","data-v-1f3aa710"]]);export{It as default};
