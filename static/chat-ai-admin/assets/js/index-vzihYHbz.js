import{_ as De}from"./empty-CzGZrENG.js";import{j as e,d as f,a3 as te,w as Ue,z as ee,N as x,O as c,U as t,F as W,a1 as X,S as j,X as l,_ as D,u as Y,Z as y,H as ue,W as qe,I as de,a6 as Z,b as Te}from"./vue-chunks-BRsu9_To.js";import{i as Ee,j as Re,k as Ne,l as Pe,m as Ae,n as Ve,o as Le,p as ze,q as be,r as Ye,a as je,s as Be,t as Je,v as He}from"./index-B9BKV930.js";import{I as Ke,b as oe,M as Q,k as J,B as _e,d as Qe,E as ce,h as We,dS as ve,dT as Ge,n as Xe}from"../../index-CzPebXix.js";import{F as le,_ as pe}from"./index-BgVvqN-n.js";import"./index-BFhVTGQQ.js";import{I as ke}from"./Input-DFtZp9vk.js";import{Q as xe}from"./QuestionCircleOutlined-DTfTQPH4.js";import{_ as we}from"./index-Bpi-EtQQ.js";import{_ as Ze}from"./index-B_XKw_Lk.js";import{_ as Oe}from"./index-BhUXTHsq.js";import{_ as me}from"./index-BwqnaIPU.js";import"./index-Di5l0R3t.js";import{_ as Ce,R as $e}from"./RadioButton-h1wW1k6O.js";import{R as et}from"./dayjs-DSnEW89Q.js";import{a as ge}from"./validate-8MtiUsxW.js";import{S as tt}from"./index-B9uf9Fzj.js";import{S as ot,a as nt}from"./index-6HDf6TPN.js";import{d as at}from"./vuedraggable.umd-CIIT_a56.js";import{_ as Fe}from"./index-Bd3BpNCC.js";import{u as lt}from"./database-Dl4jc9fX.js";import{I as st}from"./InboxOutlined-BcJOXEMG.js";import{R as rt}from"./index-xXMO8r4G.js";import{_ as it}from"./index-CBmR-lHY.js";import{U as ut}from"./index-7Ecr060x.js";import{_ as dt}from"./index-hvcgcTJ4.js";import{S as ct}from"./index-0UwCX3b0.js";import{P as ye}from"./PlusOutlined-BlmIiILr.js";import{D as _t}from"./DownloadOutlined-CeWsYko2.js";import"./index-BSz5XTfh.js";import{D as pt}from"./dropdown-DTOAy9tU.js";import{D as mt}from"./DownOutlined-DXKkgIsm.js";import{M as ft,_ as vt}from"./index-DlQVT6K6.js";import{S as gt}from"./SettingOutlined-BAFh-2qK.js";import{_ as yt,T as ht}from"./index-YQhVm4Ni.js";import{_ as bt,a as kt}from"./index-Bh3NMpRp.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./Trigger-Bvakuge0.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./isPlainObject-OEy0Jz8l.js";import"./Col-CFxRRwN8.js";import"./responsiveObserve-DqAe0rZk.js";import"./collapseMotion-Brd6xpAT.js";import"./FormItemContext-B2RmG14m.js";import"./index-Bxqtz4sn.js";import"./Search-Cf7bcOZJ.js";import"./SearchOutlined-a_gTycfl.js";import"./inputProps-jdR54afw.js";import"./TextArea-DrgXbuSS.js";import"./index-Bhf8G0AA.js";import"./Password-fnCqxsm2.js";import"./UpOutlined-B_3G2J2r.js";import"./colors-DfoziJR7.js";import"./Checkbox-oqMTsvET.js";import"./index-D17QejXF.js";import"./index-BukWVUqX.js";import"./ClockCircleOutlined-bBTx_Knl.js";import"./useMergedState-C0iIHNGF.js";import"./shallowequal-C0xnIuy8.js";import"./move-CkiYyFmr.js";import"./slide-CsbPJG8I.js";import"./List-D7uk7Chm.js";import"./CheckOutlined-Mk6nTpyE.js";import"./useRefs-CRRjy_qY.js";import"./RightOutlined-DH_YROnp.js";import"./pick-Sm8BXOZJ.js";import"./index-BYVEo4R0.js";import"./CaretDownFilled-DSht_iiA.js";import"./index-BhHQj-ne.js";import"./LeftOutlined-BKUTcRtP.js";import"./index-DLRiQ5Ho.js";import"./CaretDownOutlined-Byn8iz8T.js";var xt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};function he(P){for(var $=1;$<arguments.length;$++){var T=arguments[$]!=null?Object(arguments[$]):{},N=Object.keys(T);typeof Object.getOwnPropertySymbols=="function"&&(N=N.concat(Object.getOwnPropertySymbols(T).filter(function(U){return Object.getOwnPropertyDescriptor(T,U).enumerable}))),N.forEach(function(U){wt(P,U,T[U])})}return P}function wt(P,$,T){return $ in P?Object.defineProperty(P,$,{value:T,enumerable:!0,configurable:!0,writable:!0}):P[$]=T,P}var fe=function($,T){var N=he({},$,T.attrs);return e(Ke,he({},N,{icon:xt}),null)};fe.displayName="MinusCircleOutlined";fe.inheritAttrs=!1;const Ot={class:"add-data-sheet"},Ct={class:"field-name"},$t={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(P,{expose:$,emit:T}){const N=f("添加数据"),E=te().query,v=T,k=P;Ue(()=>k.column,M=>{a()});const C=f([]),a=()=>{let M=[];k.column.forEach(_=>{g[_.name]="",_.rules=[],_.required=="true"&&_.rules.push({required:!0,message:`请输入${_.name}`}),_.type=="number"&&_.rules.push({type:"number",message:`${_.name}必须为数字`}),_.type=="integer"&&_.rules.push({asyncValidator:L}),_.type=="boolean"&&(g[_.name]="false"),M.push({..._}),C.value=M})},L=(M,_)=>new Promise((p,s)=>_==""||Number.isInteger(+_)?p():s("请输入整数")),z=f(!1),g=ee({form_id:E.form_id}),R=M=>{z.value=!0,F.value&&F.value.resetFields(),a(),g.id="",Object.assign(g,A(M)),g.id?N.value="修改数据":N.value="添加数据"},F=f(null),w=()=>{F.value.validate().then(M=>{Ee({...g}).then(_=>{let p=g.id?"修改成功":"添加成功";J.success(p),z.value=!1,v("ok")})})};function A(M){const _={};for(let p in M)if(M.hasOwnProperty(p)){const s=M[p];!isNaN(Number(s))&&typeof s=="string"&&s!=""?_[p]=Number(s):_[p]=s}return _}return $({show:R}),(M,_)=>{const p=me,s=Oe,V=we,d=Ze,u=ke,S=pe,r=le,o=Q;return c(),x("div",Ot,[e(o,{open:z.value,"onUpdate:open":_[0]||(_[0]=n=>z.value=n),title:N.value,onOk:w,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(r,{style:{"margin-top":"16px"},model:g,ref_key:"formRef",ref:F,layout:"vertical"},{default:t(()=>[(c(!0),x(W,null,X(C.value,n=>(c(),j(S,{name:n.name,key:n.id,rules:n.rules},{label:t(()=>[e(s,{gap:4,style:{width:"100%"}},{default:t(()=>[l("div",Ct,D(n.name),1),e(p,null,{title:t(()=>[y(D(n.description),1)]),default:t(()=>[e(Y(xe))]),_:2},1024)]),_:2},1024)]),default:t(()=>[n.type=="boolean"?(c(),j(V,{key:0,checked:g[n.name],"onUpdate:checked":i=>g[n.name]=i,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):n.type=="number"||n.type=="integer"?(c(),j(d,{key:1,style:{width:"100%"},value:g[n.name],"onUpdate:value":i=>g[n.name]=i,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(c(),j(u,{key:2,value:g[n.name],"onUpdate:value":i=>g[n.name]=i,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Ft=oe($t,[["__scopeId","data-v-878d9bf5"]]),Mt={__name:"export-modal",setup(P,{expose:$}){const N=te().query,U=f("导出数据"),E=f(!1),v=ee({dates:[],type:1}),k=()=>{E.value=!0,v.type=1,v.dates=[]},C=ee({dates:[{validator:async(F,w)=>v.type==2&&!w.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),a=le.useForm,{resetFields:L,validate:z,validateInfos:g}=a(v,C),R=()=>{z().then(()=>{let F={form_id:N.form_id};v.type==2&&(F.start_date=v.dates[0],F.end_date=v.dates[1]),Re(F),E.value=!1})};return $({show:k}),(F,w)=>{const A=$e,M=Ce,_=pe,p=et,s=le,V=Q;return c(),x("div",null,[e(V,{open:E.value,"onUpdate:open":w[2]||(w[2]=d=>E.value=d),title:U.value,onOk:R,width:450},{default:t(()=>[e(s,{class:"mt16",layout:"vertical"},{default:t(()=>[e(_,{label:""},{default:t(()=>[e(M,{value:v.type,"onUpdate:value":w[0]||(w[0]=d=>v.type=d),name:"radioGroup"},{default:t(()=>[e(A,{value:1},{default:t(()=>w[3]||(w[3]=[y("全部数据")])),_:1,__:[3]}),e(A,{value:2},{default:t(()=>w[4]||(w[4]=[y("自定义日期")])),_:1,__:[4]})]),_:1},8,["value"])]),_:1}),ue(e(_,qe({required:"",label:"选择导出日期"},Y(g).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":w[1]||(w[1]=d=>v.dates=d),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[de,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},It=oe(Mt,[["__scopeId","data-v-80b64322"]]),St={class:"add-data-sheet"},Dt={class:"filter-list-box"},Ut={style:{"margin-left":"48px"}},qt={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(P,{expose:$,emit:T}){const N=f("添加分类"),E=te().query,v=T,k=P;f([]);const C=f(!1),a=ee({form_id:E.form_id,name:"",condition:[],type:"1",id:""}),L=()=>{let r=[{form_field_id:k.column[0].id,form_filed_type:k.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];a.condition=r},z=r=>{a.condition.splice(r,1)},g=(r,o)=>{r.rule=void 0,r.rule_value1="",r.rule_value2="",r.form_filed_type=k.column.filter(n=>n.id==r.form_field_id)[0].type},R=(r,o)=>o.form_field_id==r.id?!1:a.condition.map(i=>i.form_field_id).includes(r.id),F=()=>{let r=a.condition.map(n=>n.form_field_id),o=k.column.filter(n=>!r.includes(n.id));if(!o.length){J.error("字段已全部添加");return}a.condition.push({form_field_id:o[0].id,form_filed_type:o[0].type,rule:void 0,rule_value1:"",rule_value2:""})},w=r=>!r.rule||r.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(r.rule),A=r=>!r.rule||r.form_filed_type=="boolean"?!1:["between"].includes(r.rule),M=(r,o,n)=>new Promise((i,q)=>w(n)?o?n.form_filed_type=="integer"?Number.isInteger(+o)?i():q("请输入整数"):n.form_filed_type=="number"?ge(o)?i():q("请输入数字"):i():q("请输入"):i()),_=(r,o,n)=>new Promise((i,q)=>A(n)?o?n.form_filed_type=="integer"?Number.isInteger(+o)?+o<+n.rule_value1?q("右边的值需要大于左边的值"):i():q("请输入整数"):n.form_filed_type=="number"?ge(o)?+o<+n.rule_value1?q("右边的值需要大于左边的值"):i():q("请输入数字"):i():q("请输入"):i()),p=()=>{C.value=!0,N.value="添加分类",L(),a.name="",a.type="1",a.id=""},s=r=>{C.value=!0,N.value="编辑分类",Ne({form_id:E.form_id,id:r.id}).then(o=>{let n=o.data.conditions||"[]";n=JSON.parse(n),n=n.map(i=>({form_field_id:i.form_field_id+"",form_filed_type:k.column.filter(q=>q.id==i.form_field_id)[0].type,rule:V(i.rule),rule_value1:i.rule_value1,rule_value2:i.rule_value2})),a.condition=n,a.name=o.data.name,a.type=o.data.type,a.id=o.data.id})};function V(r){const o=["string_","integer_","number_","boolean_"];for(const n of o)if(r.startsWith(n))return r.slice(n.length);return r}const d=f(null),u=()=>{d.value.validate().then(r=>{let o=a.condition.map(m=>({form_field_id:+m.form_field_id,rule:m.form_filed_type+"_"+m.rule,rule_value1:m.rule_value1,rule_value2:m.rule_value2})),n={...a,condition:JSON.stringify(o)},i=Pe,q="添加成功";a.id&&(i=Ae,q="编辑成功"),i(n).then(m=>{J.success(q),C.value=!1,v("ok")})}).catch(r=>{})},S=f({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return $({show:p,edit:s}),(r,o)=>{const n=ke,i=pe,q=nt,m=ot,h=tt,H=_e,K=$e,ae=Ce,se=le,re=Q;return c(),x("div",St,[e(re,{open:C.value,"onUpdate:open":o[2]||(o[2]=I=>C.value=I),title:N.value,onOk:u,width:790},{default:t(()=>[e(se,{class:"form-box",style:{"margin-top":"16px"},model:a,ref_key:"filterFormRef",ref:d,layout:"vertical"},{default:t(()=>[e(i,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(n,{maxLength:64,value:a.name,"onUpdate:value":o[0]||(o[0]=I=>a.name=I),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),o[6]||(o[6]=l("div",{class:"form-required-item"},"筛选条件",-1)),l("div",Dt,[(c(!0),x(W,null,X(a.condition,(I,B)=>(c(),j(h,{key:B,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[l("div",null,"条件"+D(B+1)+":",1),e(i,null,{default:t(()=>[e(m,{value:I.form_field_id,"onUpdate:value":b=>I.form_field_id=b,style:{width:"150px"},placeholder:"请选择",onChange:b=>g(I,B)},{default:t(()=>[(c(!0),x(W,null,X(k.column,b=>(c(),j(q,{disabled:R(b,I),key:b.id,value:b.id},{default:t(()=>[y(D(b.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(i,{name:["condition",B,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(m,{value:I.rule,"onUpdate:value":b=>I.rule=b,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(c(!0),x(W,null,X(S.value[I.form_filed_type],b=>(c(),j(q,{key:b.value,value:b.value},{default:t(()=>[y(D(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),ue(e(i,{name:["condition",B,"rule_value1"],rules:{asyncValidator:(b,ne)=>M(b,ne,I)}},{default:t(()=>[e(n,{value:I.rule_value1,"onUpdate:value":b=>I.rule_value1=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[de,w(I)]]),ue(e(i,{name:["condition",B,"rule_value2"],rules:{asyncValidator:(b,ne)=>_(b,ne,I),trigger:"blur"}},{default:t(()=>[e(n,{value:I.rule_value2,"onUpdate:value":b=>I.rule_value2=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[de,A(I)]]),a.condition.length>1?(c(),j(Y(fe),{key:0,onClick:b=>z(B)},null,8,["onClick"])):Z("",!0)]),_:2},1024))),128)),l("div",Ut,[e(H,{onClick:F},{default:t(()=>o[3]||(o[3]=[y("添加条件")])),_:1,__:[3]})])]),e(i,{label:"条件之间关系",required:""},{default:t(()=>[e(ae,{value:a.type,"onUpdate:value":o[1]||(o[1]=I=>a.type=I)},{default:t(()=>[e(K,{value:"1"},{default:t(()=>o[4]||(o[4]=[y("与（And）")])),_:1,__:[4]}),e(K,{value:"2"},{default:t(()=>o[5]||(o[5]=[y("或（Or）")])),_:1,__:[5]})]),_:1},8,["value"])]),_:1})]),_:1,__:[6]},8,["model"])]),_:1},8,["open","title"])])}}},Me=oe(qt,[["__scopeId","data-v-96f3dd24"]]),Tt={class:"custom-table"},Et={class:"t-body"},Rt={class:"t-row"},Nt={class:"t-item"},Pt={class:"t-item"},At={class:"drag-btn"},Vt={key:0},Lt={key:1},zt={class:"t-item"},Yt={class:"t-item flex-none",style:{width:"120px"}},jt=["onClick"],Bt=["onClick"],Jt={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(P,{expose:$,emit:T}){const U=te().query,E=T,v=f("管理分类"),k=f(!1),C=P,a=()=>{be({form_id:U.form_id}).then(p=>{R.value=p.data.map(s=>({...s}))})},L=()=>{a(),E("ok"),E("change")},z=()=>{a(),k.value=!0},g=()=>{k.value=!1},R=f(),F=()=>{let p=[];R.value.reverse().forEach((s,V)=>{p.push({id:+s.id,sort:+V+1})}),Ve({form_id:U.form_id,filter_sort:JSON.stringify(p)}).then(s=>{J.success("排序成功"),a(),E("change")})},w=p=>{Le({form_id:U.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(s=>{J.success("设置成功"),a(),E("change")})},A=(p,s)=>{Q.confirm({title:"删除确认",icon:e(ce),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){ze({id:p.id,form_id:U.form_id}).then(V=>{J.success("删除成功"),R.value.splice(s,1),E("change")})},onCancel(){}})},M=f(null),_=p=>{M.value.edit(p)};return $({show:z}),(p,s)=>{const V=we,d=Qe,u=me,S=Fe,r=Q;return c(),x("div",null,[e(r,{open:k.value,"onUpdate:open":s[1]||(s[1]=o=>k.value=o),title:v.value,onCancel:g,footer:null,width:760},{default:t(()=>[l("div",Tt,[s[6]||(s[6]=l("div",{class:"t-head"},[l("div",{class:"td"},[l("div",{style:{width:"24px"}}),y(" 分类名称 ")]),l("div",{class:"td"},"类型"),l("div",{class:"td"},"启用分类"),l("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),l("div",Et,[l("div",Rt,[s[2]||(s[2]=l("div",{class:"t-item"},[l("div",{style:{width:"24px"}}),y(" 全部 ")],-1)),s[3]||(s[3]=l("div",{class:"t-item"},"系统分类",-1)),l("div",Nt,[e(V,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),s[4]||(s[4]=l("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1))]),e(Y(at),{modelValue:R.value,"onUpdate:modelValue":s[0]||(s[0]=o=>R.value=o),"item-key":"id",onEnd:F,group:"table-rows",handle:".drag-btn"},{item:t(({element:o,index:n})=>[(c(),x("div",{key:o.id,class:"t-row"},[l("div",Pt,[l("span",At,[e(d,{name:"drag"})]),o.name.length>10?(c(),x("span",Vt,[e(u,null,{title:t(()=>[y(D(o.name),1)]),default:t(()=>[y(" "+D(o.name.slice(0,10)+"..."),1)]),_:2},1024)])):(c(),x("span",Lt,D(o.name),1))]),s[5]||(s[5]=l("div",{class:"t-item"},"自定义分类",-1)),l("div",zt,[e(V,{onChange:i=>w(o),checked:o.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),l("div",Yt,[l("a",{onClick:i=>_(o)},"编辑",8,jt),e(S,{type:"vertical"}),l("a",{onClick:i=>A(o,n)},"删除",8,Bt)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e(Me,{onOk:L,column:C.column,ref_key:"addFilrerModalRef",ref:M},null,8,["column"])])}}},Ht=oe(Jt,[["__scopeId","data-v-2d0e4f7e"]]),Kt={class:"upload-box"},Qt={class:"ant-upload-drag-icon"},Wt={key:0,class:"progress-box"},Gt={key:0},Xt={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(P,{expose:$,emit:T}){const N=We(),U=T,E=te().query,v=P,k=f(!1),C=f(!1),a=ee({total:0,success:0,err_data:[]}),L=f([]),z=d=>{const u=d.file.status;if(u==="done")if(d.file.response.res==0){let S=d.file.response.data.task_id;F(S)}else return L.value=[],J.error(d.file.response.msg);else u==="error"&&(L.value=[],J.error(`${d.file.name} file upload failed.`))};function g(d){}let R=null;const F=d=>{R&&clearInterval(R),k.value=!1,p.value=!0,s.value=10,a.total=0,a.success=0,a.err_data=[],R=setInterval(()=>{Ye({task_id:d}).then(u=>{let S=u.data;s.value=(S.processed/S.total).toFixed(),S.finish&&(U("ok"),clearInterval(R),s.value=100),S.total>0&&(a.total=S.total,a.success=S.success,a.err_data=S.err_data)}).catch(()=>{clearInterval(R)})},2e3)},w=()=>{let d;d=v.column.map(u=>u.name),d="id,"+d.join(",")+`
`,ve(d,[],[],"导入数据模板.csv")},A=()=>{let d={id:""};v.column.forEach(u=>{d[u.name]=""}),Ge([d],"导入数据模板.json")},M=()=>{L.value=[],k.value=!0},_=()=>{},p=f(!1),s=f(10),V=()=>{let d="id,",u=["id"];for(let o in a.err_data[0])o!="id"&&o!="err_msg"&&(d+=o+",",u.push(o));d=d+`err_msg
`,u.push("err_msg");let S=a.err_data,r="失败数据_"+Xe().format("YYYY/MM/DD HH:mm")+".xlsx";ve(d,S,u,r)};return $({show:M}),(d,u)=>{const S=it,r=ut,o=Q,n=dt,i=_e,q=rt;return c(),x("div",null,[e(o,{open:k.value,"onUpdate:open":u[1]||(u[1]=m=>k.value=m),title:"导入数据","confirm-loading":C.value,onOk:_,footer:null,width:746},{default:t(()=>[e(S,{"show-icon":"",class:"alert-box"},{message:t(()=>[l("div",null,[u[3]||(u[3]=y(" 支持通过Excel或者json文件导入数据。 ")),l("a",{onClick:w,class:"mr8"},"excel模板"),l("a",{onClick:A},"json模板")]),u[4]||(u[4]=l("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1))]),_:1}),l("div",Kt,[e(r,{fileList:L.value,"onUpdate:fileList":u[0]||(u[0]=m=>L.value=m),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:Y(N).getToken},data:{form_id:Y(E).form_id},action:"/manage/uploadFormFile",onChange:z,onDrop:g},{default:t(()=>[l("p",Qt,[e(Y(st))]),u[5]||(u[5]=l("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),u[6]||(u[6]=l("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1))]),_:1,__:[5,6]},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(o,{open:p.value,"onUpdate:open":u[2]||(u[2]=m=>p.value=m),title:"导入数据",footer:null,width:746},{default:t(()=>[s.value<100?(c(),x("div",Wt,[e(n,{type:"circle",percent:s.value},null,8,["percent"]),u[7]||(u[7]=l("div",{class:"tip"},"数据导入中，请勿关闭页面",-1))])):(c(),j(q,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[y("导入成功"+D(a.success)+"，导入失败"+D(a.total-a.success)+" ",1),a.total-a.success>0?(c(),x("span",Gt," 您可以下载失败数据，修改后重新导入 ")):Z("",!0)]),extra:t(()=>[a.total-a.success>0?(c(),j(i,{key:0,onClick:V,type:"primary"},{default:t(()=>u[8]||(u[8]=[y("下载失败数据")])),_:1,__:[8]})):Z("",!0)]),_:1}))]),_:1},8,["open"])])}}},Zt=oe(Xt,[["__scopeId","data-v-6beddc88"]]),eo={key:0,class:"loading-box"},to={key:1,class:"empty-box"},oo={key:2,class:"field-manage-page"},no={class:"page-title"},ao={key:0},lo={key:1},so={class:"table-wrapper customize-scroll-style"},ro={key:0},io={key:1},uo={key:0},co={key:1},_o=["onClick"],po=["onClick"],mo={__name:"index",setup(P){const $=lt(),T=Te(()=>$.databaseInfo.entry_count),U=te().query,E=f([]),v=f([]),k=f(!0),C=ee({form_id:U.form_id,page:1,size:10,total:0}),a=f(!1),L=m=>{C.page=m.current,C.size=m.pageSize,g()},z=()=>{C.page=1,g()},g=()=>{a.value=!0,Be({...C,filter_id:F.value}).then(m=>{E.value=m.data.list||[],C.total=+m.data.total||0,$.getDatabaseInfo({id:U.form_id})}).finally(()=>{a.value=!1})};je({form_id:U.form_id}).then(m=>{v.value=m.data,k.value=!1,g()});const R=f([]),F=f(""),w=()=>{be({form_id:U.form_id}).then(m=>{let h=m.data||[];if(R.value=h.filter(H=>H.enabled=="true"),F.value){let H=h.filter(K=>K.id==F.value);(H.length&&H[0].enabled=="false"||!H.length)&&(F.value="",g())}})};w();const A=()=>{w(),g()},M=()=>{C.page=1,g()},_=f(null),p=(m,h)=>{h==="add"&&_.value.show()},s=m=>{Q.confirm({title:"删除确认",icon:e(ce),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){He({id:m.id}).then(h=>{J.success("删除成功"),A()})},onCancel(){}})},V=()=>{Q.confirm({title:"清空数据提示",icon:e(ce),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){Je({form_id:U.form_id}).then(m=>{J.success("清空成功"),A()})},onCancel(){}})},d=f(null),u=(m={})=>{d.value.show(JSON.parse(JSON.stringify(m)))},S=f(null),r=(m={})=>{S.value.show()},o=f(null),n=()=>{o.value.show()},i=f(null),q=()=>{i.value.show()};return(m,h)=>{const H=ct,K=_e,ae=vt,se=ft,re=pt,I=Oe,B=yt,b=me,ne=ht,ie=bt,Ie=Fe,Se=kt;return c(),x(W,null,[k.value?(c(),x("div",eo,[e(H)])):Z("",!0),!k.value&&!v.value.length?(c(),x("div",to,h[3]||(h[3]=[l("img",{src:De,alt:""},null,-1),l("div",null,"暂无字段, 请先去添加字段",-1)]))):Z("",!0),!k.value&&v.value.length?(c(),x("div",oo,[l("div",no,[h[7]||(h[7]=y(" 数据管理 ")),e(I,{gap:16},{default:t(()=>[e(K,{type:"primary",onClick:h[0]||(h[0]=O=>u())},{icon:t(()=>[e(Y(ye))]),default:t(()=>[h[4]||(h[4]=y(" 添加数据 "))]),_:1,__:[4]}),e(K,{onClick:h[1]||(h[1]=O=>r())},{icon:t(()=>[e(Y(_t))]),default:t(()=>[h[5]||(h[5]=y(" 导入数据 "))]),_:1,__:[5]}),e(re,null,{overlay:t(()=>[e(se,null,{default:t(()=>[e(ae,{key:"1"},{default:t(()=>[l("div",{onClick:n},"导出数据")]),_:1}),e(ae,{key:"2"},{default:t(()=>[l("div",{onClick:V},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(K,null,{default:t(()=>[h[6]||(h[6]=y(" 更多操作 ")),e(Y(mt))]),_:1,__:[6]})]),_:1})]),_:1})]),e(ne,{class:"tabs-wrapper",activeKey:F.value,"onUpdate:activeKey":h[2]||(h[2]=O=>F.value=O),type:"editable-card",onEdit:p,onChange:M},{addIcon:t(()=>[e(Y(ye)),h[8]||(h[8]=y(" 添加分类 "))]),rightExtra:t(()=>[l("span",{class:"setting-btn",onClick:q},[e(Y(gt)),h[9]||(h[9]=y(" 管理分类 "))])]),default:t(()=>[e(B,{key:"",closable:!1},{tab:t(()=>[y("全部 ("+D(T.value)+")",1)]),_:1}),(c(!0),x(W,null,X(R.value,O=>(c(),j(B,{key:O.id,closable:!1},{tab:t(()=>[O.name.length>8?(c(),x("span",ao,[e(b,null,{title:t(()=>[y(D(O.name),1)]),default:t(()=>[y(" "+D(O.name.slice(0,8)+"..."),1)]),_:2},1024)])):(c(),x("span",lo,D(O.name),1)),y(" ("+D(O.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),l("div",so,[e(Se,{sticky:"","data-source":E.value,loading:a.value,scroll:{x:1e3},pagination:{current:C.page,total:C.total,pageSize:C.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:L},{default:t(()=>[e(ie,{key:"id","data-index":"id",title:"id",width:60}),(c(!0),x(W,null,X(v.value,O=>(c(),j(ie,{key:O.name,"data-index":O.name,width:165},{title:t(()=>[O.name.length>12?(c(),x("span",ro,[e(b,null,{title:t(()=>[y(D(O.name),1)]),default:t(()=>[y(" "+D(O.name.slice(0,12)+"..."),1)]),_:2},1024)])):(c(),x("span",io,D(O.name),1)),e(b,null,{title:t(()=>[y(D(O.description),1)]),default:t(()=>[e(Y(xe),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:G})=>[G[O.name].length>10?(c(),x("span",uo,[e(b,null,{title:t(()=>[y(D(G[O.name]),1)]),default:t(()=>[y(" "+D(G[O.name].slice(0,9)+"..."),1)]),_:2},1024)])):(c(),x("span",co,D(G[O.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(ie,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:O})=>[l("span",null,[l("a",{onClick:G=>u(O)},"编辑",8,_o),e(Ie,{type:"vertical"}),l("a",{onClick:G=>s(O)},"删除",8,po)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(Ft,{onOk:A,column:v.value,ref_key:"addDataModalRef",ref:d},null,8,["column"]),e(Me,{onOk:A,column:v.value,ref_key:"addFilrerModalRef",ref:_},null,8,["column"]),e(It,{ref_key:"exportModalRef",ref:o},null,512),e(Ht,{onOk:g,onChange:w,column:v.value,ref_key:"filterManageModalRef",ref:i},null,8,["column"]),e(Zt,{onOk:z,column:v.value,ref_key:"importDataModalRef",ref:S},null,8,["column"])])):Z("",!0)],64)}}},Nn=oe(mo,[["__scopeId","data-v-782a68fb"]]);export{Nn as default};
