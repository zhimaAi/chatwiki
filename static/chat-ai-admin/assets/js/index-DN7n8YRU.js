var Rl=Object.defineProperty;var Ll=(e,n,o)=>n in e?Rl(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o;var Ds=(e,n,o)=>Ll(e,typeof n!="symbol"?n+"":n,o);import{ab as Ta,r as U,c as ye,ah as go,j as Ne,a as D,b as h,q as Z,p as s,y as c,t as f,_ as T,v as _,u as d,F as ee,l as se,e as G,h as qe,ag as Vl,z as $s,A as Ml,Y as He,D as Es,w as Ie,o as Ut,C as Ns,O as be,x as tt,n as jt,T as Tl,E as we,i as Ze,a1 as Ht,G as Qe,ap as hs,am as ja,f as Go,al as gn,s as Un,ak as Pa,P as Us,B as jl,U as Pl,H as yo,aj as Lo,J as yn}from"./vue-chunks-BdaA73Wf.js";import{a6 as bn,A as Vo,u as fe,_ as It,a8 as rs,ai as ql,a5 as bo,ab as nt,aj as fo,ak as kn,a4 as Hl,al as Ul,d as qa,am as Jl,an as Js,ao as zl,ap as on}from"../../index-DSFcP5NQ.js";import{g as Kl,A as Gl,l as Ho,m as Ha,B as Wl,C as Zl,D as Yl,e as oo,E as Ql,F as Xl,G as Ua,H as ei,I as ti,J as si,K as Ja,L as oi,M as un,N as za,O as Jn,P as ni,Q as Hs}from"./index-Cg7-0swo.js";import{u as Pt}from"./robot-CIzNpArp.js";import{d as is}from"./utils-CvB22N-W.js";import{u as ai}from"./global-Dp85OI1C.js";import{a as li,_ as Ka,M as ii}from"./meta-filter-box-CVXR7ud2.js";import{_ as _e}from"./emoji-mart-BBMRoEa3.js";import{q as ct,a5 as wn,D as ds,R as fs,a9 as no,a1 as Xe,B as rt,aD as bs,aE as ri,I as pt,f as ao,g as lo,i as io,at as Ga,ac as Re,M as wt,F as St,c as Dt,u as Ye,v as et,H as Ms,V as Ts,b as Me,aq as Mo,r as Yt,s as Qt,aC as Tt,aB as ko,G as Vt,Q as xs,J as _s,aA as di,aF as Wt,x as ro,W as Wa,m as Ks,au as ui,ag as os,N as Za,ao as at,ah as Cn,ax as Mt,an as Is,aG as ci,aH as ms,av as Ya,aw as Qa,aa as eo,aI as $n,a8 as xn,aJ as Wo,aK as _i,aL as pi,aM as fi,aN as vi,ad as wo,aO as Zo,a4 as Sn,P as hi,aP as mi,y as Dn,ae as gi,af as yi,aj as bi,aQ as ki,aR as zs,aS as wi,am as Ci,_ as $i}from"./ui-antd-Dl1wwwCD.js";import{P as xi,_ as _t,a as Si,B as Di,b as Ai,H as Oi,c as Ni,d as Yo,r as ut,g as Bi,L as Ei,D as Ii,M as Fi,S as Ri,e as Li}from"./logicflow-DKG0_Fp4.js";import{_ as No}from"./empty-BFmzY9bl.js";import{c as cn,a as Vi,b as Mi,d as Ti,e as ji,f as Pi,h as xo,i as qi,p as Bo,j as Hi,_ as Ui,k as Ji,l as zi,m as Ki,n as Gi,o as Wi,q as Zi,r as Yi,s as Qi,t as Xi,u as er,v as tr,w as sr,x as or,y as nr,z as ar,A as lr,B as ir,C as rr,D as dr,E as ur,F as cr,G as _r,H as pr,I as fr,J as vr,K as hr,L as mr,M as gr,N as yr,O as br,P as kr,Q as wr,R as Cr,S as $r,T as xr,U as Sr,V as Dr,W as Ar,X as Or,Y as Nr,Z as Br,$ as Er,a0 as Ir,a1 as Fr,a2 as Rr,a3 as Lr,a4 as Vr,a5 as Mr,a6 as Tr,a7 as jr,a8 as Pr,a9 as qr,aa as Hr,ab as Ur,ac as Jr,ad as zr,ae as Kr,af as Gr,ag as Wr,ah as Zr,ai as Yr,aj as Qr,ak as Xr,al as ed,am as td,an as sd,ao as od,ap as nd,aq as ad,ar as ld,as as id,at as rd,au as dd,av as ud,aw as cd,ax as _d,ay as pd,az as fd,aA as vd,aB as hd,aC as md,aD as gd,aE as yd,aF as bd,aG as kd,aH as wd,aI as Cd,aJ as $d,aK as xd,aL as Sd,aM as Dd,aN as Ad,aO as Od,aP as Nd,aQ as Bd,aR as Ed,aS as Id,aT as Fd,aU as Rd,aV as Ld,aW as Vd,aX as Md,aY as Td,aZ as jd,a_ as Pd,a$ as qd,b0 as Hd,b1 as Ud,b2 as Jd,b3 as zd,b4 as Kd,b5 as Gd,b6 as Wd,b7 as Zd,b8 as Yd,b9 as Qd,ba as Xd,bb as eu,bc as tu,bd as su,be as ou,bf as nu,bg as au,bh as lu,bi as iu,bj as ru,bk as du,bl as uu,bm as cu,bn as _u,bo as pu,bp as fu,bq as vu,br as hu,bs as mu,bt as gu,bu as yu,bv as bu,bw as ku,bx as wu,by as Cu,bz as $u,bA as xu,bB as Su,bC as Du,bD as Au,bE as Ou,bF as Nu,bG as Bu,bH as Eu,bI as Iu,bJ as Fu,bK as Ru,bL as Lu,bM as Vu,bN as Mu,bO as Tu,bP as ju,bQ as Pu,bR as qu,bS as Hu,bT as Uu,bU as Ju,bV as zu,bW as Ku,bX as Gu,bY as Wu,bZ as Zu,b_ as Yu,b$ as Qu,c0 as Xu,c1 as ec,c2 as tc,c3 as sc,c4 as oc,c5 as nc,c6 as ac,c7 as lc,c8 as ic,c9 as rc,ca as dc,cb as uc,cc,cd as _c,ce as pc,cf as fc,cg as vc,ch as hc,ci as mc,cj as gc,ck as yc,cl as bc,cm as kc,cn as wc,co as Cc,cp as $c,cq as xc,cr as Sc,cs as Dc,ct as Ac,cu as Oc,cv as Nc,cw as Bc,cx as Ec,cy as Ic,cz as Fc,cA as Rc,cB as Lc,cC as Vc,cD as Mc,cE as Tc,cF as jc,cG as Pc,cH as qc,cI as Hc,cJ as Uc,cK as Jc,cL as zc,cM as Kc,cN as Gc,cO as Wc,cP as Zc,cQ as Yc,cR as Qc,cS as Xc,cT as e_,cU as t_,cV as s_,cW as o_,cX as n_,cY as a_,cZ as l_,c_ as i_,c$ as r_,d0 as d_,d1 as u_,d2 as c_,d3 as __,d4 as p_,d5 as f_,d6 as v_,d7 as h_,d8 as m_,d9 as g_,da as y_,db as b_,dc as k_,dd as w_,de as C_,df as $_,dg as x_,dh as S_,di as D_,dj as A_,dk as O_,dl as N_,dm as B_,dn as E_,dp as I_,dq as F_,dr as R_,ds as L_,dt as V_,du as M_,dv as T_,dw as j_,dx as P_,dy as q_,dz as H_,dA as U_,dB as J_,dC as z_,dD as K_,dE as G_,dF as W_,dG as Z_,dH as Y_,dI as Q_,dJ as X_,dK as ep,dL as tp,dM as sp,dN as op,dO as np,dP as ap,dQ as lp,dR as ip,dS as rp,dT as dp,dU as up,dV as cp,dW as _p,dX as pp,dY as fp,dZ as vp,d_ as hp,d$ as mp,e0 as gp,e1 as yp,e2 as bp,e3 as kp,e4 as wp,e5 as Cp,e6 as $p,e7 as xp,e8 as Sp,e9 as Dp,ea as Ap,eb as Op,ec as Np,ed as Bp,ee as Ep,ef as Ip,eg as Fp,eh as Rp,ei as Lp,ej as Vp,ek as Mp,el as Tp,em as jp,en as Pp,eo as qp,ep as Hp,eq as Up,er as Jp,es as zp,et as Kp,eu as Gp,ev as Wp,ew as Zp,ex as Yp,ey as Qp,ez as gs,eA as ns,eB as An,eC as Eo,eD as Xa,eE as Fs,eF as el,g as Xp,eG as tl,eH as ho,eI as ef,eJ as tf,eK as zn,eL as sf}from"./util-DTYBDRN2.js";import{g as of,_ as ys,S as nf,P as af,p as lf}from"./subs-key-dcCZfb9g.js";import{u as rf}from"./usePublicNetworkCheck-B51wgX5Y.js";import{P as df}from"./public-network-check-BgOXIe2j.js";import{M as Gs,a as uf,u as sl,b as ol}from"./model-select-CMPvMrAQ.js";import{_ as To}from"./empty-CzGZrENG.js";import{a as cf,g as _f}from"./index-p9HhDhmV.js";import{_ as pf}from"./cu-scroll-CpIj948h.js";import{W as ff}from"./index-Bm4uv5SC.js";import{a as nl}from"./index-C67uUbSa.js";import{R as vf}from"./editor-code-DlsHKXTn.js";import{g as al}from"./thirdMcp-CLnTK-fz.js";import{r as ss,g as ll,o as hf,d as mf}from"./index-BuURB1pl.js";import{F as gf,P as yf,u as bf}from"./useOfficialArticleLogin-CmM2SX9T.js";import{i as Uo}from"./validate-8MtiUsxW.js";import{u as mo}from"./useEventBus--I0IFnMo.js";import{Z as vs}from"./zm-radio-group-B3tVhfsZ.js";import{T as kf,E as wf}from"./wange-ditor-DTRXDIq1.js";import{S as Cf}from"./select-wechat-app-CPFxsGeL.js";import{E as $f}from"./elkjs-BN8GIjVH.js";import{T as xf}from"./top-header-BV_CBGi9.js";import{a as Sf}from"./add-group-BYEOdPBe.js";import{j as Df}from"./index-MT9fcN3v.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./other-LrIFyvU9.js";import"./medium-editor-DkrXt2qq.js";import"./empty-box-DAN5iPDv.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./loading-box-CQ9Pukre.js";function Af(e={}){return bn.get({url:"/manage/getTriggerConfigList",params:e})}function Of(e={}){return bn.get({url:"/manage/getTriggerOfficialMessage",params:e})}const Co=Ta("workflow",()=>{const e=U([]),n=U([]),o=U([]),a=U([]);return{triggerList:e,getTriggerList:async(u,y)=>{try{if(e.value.length===0||y){const p=await Af({robot_key:u});e.value=p.data.map(m=>(m.subMenus=[],m.expend=!1,m.trigger_type==4&&(m.subMenus=[{title:"私信消息",value:"message"},{title:"关注/取消关注事件",value:"subscribe_unsubscribe"},{title:"扫描带参数二维码事件",value:"qrcode_scan"},{title:"自定义菜单事件",value:"menu_click"}]),m))}return e.value}catch(p){}},officialList:n,getTriggerOfficialMsg:u=>{Of({robot_key:u}).then(y=>{o.value=y.data.messages||[],n.value=y.data.apps||[]})},triggerOfficialList:o,getAllLibraryList:()=>{Vo().then(u=>{a.value=u.data})},libraryLists:a}}),Nf={key:0,class:"sidebar-handle-wrapper"},Bf={class:"sidebar-container"},Ef={class:"sidebar-menus"},If=["onClick"],Ff={class:"menu-name"},Rf={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(e){const{t:n}=fe("views.workflow.page-sidebar"),o=ai(),a=Vl(),l=go(),i=ye(()=>l.path.split("/")[3]),r=U(!0),u=U(!0);function y(){r.value=!r.value,u.value=!1,o.setHideLayoutTopAndBottom(r.value)}const p=ye(()=>[{label:n("menu_workflow"),value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:n("menu_external_services"),value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:n("menu_chat_test"),value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:n("menu_qa_feedback"),value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:n("menu_session_record"),value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:n("menu_api_key_manage"),value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:n("menu_statistical_analysis"),value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:n("menu_export_record"),value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:n("menu_invoke_logs"),value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}]),m=v=>{if(v.isNewWindowOpen){window.open(`/#${v.path}?robot_key=${l.query.robot_key}&id=${l.query.id}`);return}a.push({path:v.path,query:l.query})};return Ne(()=>{setTimeout(()=>{u.value=!1},3e3)}),(v,C)=>{const g=ct,$=It;return h(),D("div",{class:qe(["sidebar-wrapper",{"is-hide":r.value}])},[e.showSidebarBtn?(h(),D("div",Nf,[c(g,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:u.value,"onUpdate:open":C[0]||(C[0]=w=>u.value=w),arrow:!1},{title:f(()=>[T(_(r.value?d(n)("tooltip_expand"):d(n)("tooltip_collapse")),1)]),default:f(()=>[s("span",{class:"sidebar-handle",onClick:y},[...C[1]||(C[1]=[s("span",{class:"handle-line handle-line01"},null,-1),s("span",{class:"handle-line handle-line02"},null,-1)])])]),_:1},8,["open"])])):Z("",!0),s("div",Bf,[s("div",Ef,[(h(!0),D(ee,null,se(p.value,w=>(h(),G(li,{key:w.value,disabled:!r.value,title:w.label,placement:"bottom"},{default:f(()=>[s("div",{class:qe(["sidebar-menu",{active:i.value==w.value}]),onClick:S=>m(w)},[c($,{name:w.iconName,class:"menu-icon",size:"16"},null,8,["name"]),s("span",Ff,_(w.label),1)],10,If)]),_:2},1032,["disabled","title"]))),128))])])],2)}}},Lf=_e(Rf,[["__scopeId","data-v-7f1eda0e"]]),Vf={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},setup(){const{t:e}=fe("views.workflow.components.custom-control.zoom-select");return{t:e}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(e){e!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${e}%`,this.previousValue=e)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(e){this.$emit("update:modelValue",e.value),this.$emit("zoom-change",e.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleFitView(){this.isShowMenu=!1,this.$emit("fitView")},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const e=this.currentValue.replace("%","").trim(),n=parseInt(e.replace(/[^\d]/g,""),10);if(!e){this.currentValue=`${this.previousValue}%`;return}if(isNaN(n)){this.currentValue=`${this.previousValue}%`;return}let o=n;o>800&&(o=800),o<1&&(o=1),this.currentValue=`${o}%`,this.previousValue=o,this.$emit("update:modelValue",o),this.$emit("zoom-change",o)},300)},handleBlur(){clearTimeout(this.debounceTimer);const e=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(e)&&e>=1&&e<=800?(this.$emit("update:modelValue",e),this.$emit("zoom-change",e),this.currentValue=`${e}%`,this.previousValue=e):this.currentValue=`${this.previousValue}%`},documentClick(e){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(e.target)&&e.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},Mf={class:"zoom-select"},Tf={class:"zoom-select-options"},jf=["onClick"];function Pf(e,n,o,a,l,i){return h(),D("div",Mf,[s("div",{class:"zoom-select-label",onClick:n[4]||(n[4]=He(()=>{},["stop"]))},[$s(s("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":n[0]||(n[0]=r=>l.currentValue=r),onInput:n[1]||(n[1]=(...r)=>i.handleInput&&i.handleInput(...r)),onFocus:n[2]||(n[2]=(...r)=>i.showMenu&&i.showMenu(...r)),onBlur:n[3]||(n[3]=(...r)=>i.handleBlur&&i.handleBlur(...r))},null,544),[[Ml,l.currentValue]])]),$s(s("div",Tf,[(h(!0),D(ee,null,se(l.menus,r=>(h(),D("div",{class:"zoom-select-option",key:r.value,onClick:u=>i.handleMenu(r)},_(r.label),9,jf))),128)),n[6]||(n[6]=s("div",{class:"option-line"},null,-1)),s("div",{class:"zoom-select-option",onClick:n[5]||(n[5]=r=>i.handleFitView())},_(a.t("btn_fit_view")),1)],512),[[Es,l.isShowMenu]])])}const qf=_e(Vf,[["render",Pf],["__scopeId","data-v-a49f9e85"]]),Hf={class:"trigger-list-box"},Uf={key:0,class:"trigger-list"},Jf=["onClick"],zf={class:"trigger-info"},Kf=["src"],Gf={class:"info"},Wf={class:"name"},Zf={key:0,class:"right-icon"},Yf={key:0,class:"sub-menu-list"},Qf=["onClick"],Xf={key:1,class:"empty-box"},ev={href:"/#/plugins/index?active=2",target:"_blank"},tv={__name:"trigger-list",emits:["add"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-list-popup.index"),a=n,l=Co(),i=ye(()=>l.triggerOfficialList),r=U(""),u=ye(()=>{let m=l.triggerList;return r.value?m.filter(v=>v.trigger_name.includes(r.value)):m}),y=m=>{if(m.subMenus&&m.subMenus.length){m.expend=!m.expend;return}let v=cn(m);a("add",v)},p=(m,v)=>{m.trigger_type==4&&(m.trigger_official_config.msg_type=v.value,m.outputs=i.value.find(g=>g.msg_type==v.value).fields);let C=cn(m);a("add",C)};return(m,v)=>{const C=wn;return h(),D("div",Hf,[s("div",{class:"search-box",onClick:v[1]||(v[1]=He(()=>{},["stop"]))},[c(C,{value:r.value,"onUpdate:value":v[0]||(v[0]=g=>r.value=g),valueModifiers:{trim:!0},allowClear:"",placeholder:d(o)("ph_search_by_name")},null,8,["value","placeholder"])]),u.value.length?(h(),D("div",Uf,[(h(!0),D(ee,null,se(u.value,g=>(h(),D("div",{class:"trigger-item",onClick:$=>y(g),key:g.type},[s("div",zf,[s("img",{class:"avatar",src:g.trigger_icon},null,8,Kf),s("div",Gf,[s("span",Wf,_(g.trigger_name),1)]),g.subMenus&&g.subMenus.length?(h(),D("div",Zf,[g.expend?(h(),G(d(ds),{key:0})):(h(),G(d(fs),{key:1}))])):Z("",!0)]),g.expend&&g.subMenus&&g.subMenus.length?(h(),D("div",Yf,[(h(!0),D(ee,null,se(g.subMenus,$=>(h(),D("div",{class:"sub-item",onClick:He(w=>p(g,$),["stop"]),key:$.value},_($.title),9,Qf))),128))])):Z("",!0)],8,Jf))),128))])):(h(),D("div",Xf,[v[2]||(v[2]=s("img",{style:{height:"200px"},src:No},null,-1)),s("div",null,_(d(o)("msg_no_plugins")),1),s("a",ev,[T(_(d(o)("btn_add_now"))+" ",1),c(d(fs))])]))])}}},sv=_e(tv,[["__scopeId","data-v-b2c3e827"]]),ov={class:"trigger-list-box"},nv={key:0,class:"trigger-list"},av=["onClick"],lv={class:"trigger-info"},iv=["src"],rv={class:"info"},dv={class:"name"},uv={key:1,class:"empty-box"},cv={href:"/#/robot/list?active=1",target:"_blank"},_v={__name:"workflow-list",emits:["add"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-list-popup.workflow-list"),a=n,l=U([]),i=U("");Ne(()=>{r()});function r(){Kl({application_type:1}).then(p=>{let m=p.data||[];l.value=m.filter(v=>v.has_published==1)})}const u=ye(()=>i.value?l.value.filter(p=>p.robot_name.includes(i.value)):l.value),y=p=>{let m=Vi(p);a("add",m)};return(p,m)=>{const v=wn;return h(),D("div",ov,[s("div",{class:"search-box",onClick:m[1]||(m[1]=He(()=>{},["stop"]))},[c(v,{value:i.value,"onUpdate:value":m[0]||(m[0]=C=>i.value=C),valueModifiers:{trim:!0},allowClear:"",placeholder:d(o)("ph_search_by_name")},null,8,["value","placeholder"])]),u.value.length?(h(),D("div",nv,[(h(!0),D(ee,null,se(u.value,C=>(h(),D("div",{class:"trigger-item",onClick:g=>y(C),key:C.id},[s("div",lv,[s("img",{class:"avatar",src:C.robot_avatar},null,8,iv),s("div",rv,[s("span",dv,_(C.robot_name),1)])])],8,av))),128))])):(h(),D("div",uv,[m[2]||(m[2]=s("img",{style:{height:"200px"},src:No},null,-1)),s("div",null,_(d(o)("msg_no_workflows_available")),1),s("a",cv,[T(_(d(o)("btn_add_now"))+" ",1),c(d(fs))])]))])}}},pv=_e(_v,[["__scopeId","data-v-92cf5041"]]),fv={class:"http-tool-list-box"},vv={key:0,class:"node-list"},hv={class:"node-info-pop"},mv={class:"info"},gv=["src"],yv={class:"name"},bv={class:"extra"},kv=["onClick"],wv=["src"],Cv={class:"info"},$v={class:"name"},xv={class:"total"},Sv={class:"node-tools"},Dv={class:"params-box"},Av={class:"param-item"},Ov={class:"field"},Nv={class:"name"},Bv={class:"desc"},Ev={class:"param-item"},Iv={class:"field"},Fv={class:"name"},Rv={class:"type"},Lv={key:0,class:"param-item"},Vv={class:"field"},Mv={class:"name"},Tv={class:"desc"},jv={key:1,class:"param-item"},Pv={class:"field"},qv={class:"name"},Hv={class:"desc"},Uv={key:2,class:"param-item"},Jv={class:"field"},zv={class:"name"},Kv={class:"desc"},Gv=["onClick"],Wv={key:1,class:"empty-box"},Zv={__name:"http-tool-list",props:{keyword:{type:String,default:""}},emits:["add"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-list-popup.http-tool-list"),a=n,l=e,i=U([]);Ne(()=>{r()});function r(){of({page:1,size:9999,with_nodes:1}).then(C=>{var $;const g=(($=C==null?void 0:C.data)==null?void 0:$.list)||[];g.forEach(w=>w.expand=!1),i.value=g})}const u=ye(()=>{if(l.keyword){const C=l.keyword;return i.value.filter(g=>{let $=(g.description||"")+(g.name||"");return Array.isArray(g.nodes)&&g.nodes.forEach(w=>{var k,b;$+=(w.node_name||"")+(w.node_description||"");const S=((b=(k=w==null?void 0:w.node_params)==null?void 0:k.curl)==null?void 0:b.rawurl)||"";$+=S}),$.indexOf(C)>-1})}return i.value}),y=(C,g)=>{var S;const $=((S=g==null?void 0:g.node_params)==null?void 0:S.curl)||{},w=Mi({name:(g==null?void 0:g.node_name)||(C==null?void 0:C.name),avatar:(g==null?void 0:g.http_tool_avatar)||(C==null?void 0:C.avatar),method:$==null?void 0:$.method,url:$==null?void 0:$.rawurl,headers:Array.isArray($==null?void 0:$.headers)?$.headers:[],params:Array.isArray($==null?void 0:$.params)?$.params:[],body:Array.isArray($==null?void 0:$.body)?$.body:[],timeout:($==null?void 0:$.timeout)||60,output:Array.isArray($==null?void 0:$.output)?$.output:[],http_auth:Array.isArray($==null?void 0:$.http_auth)?$.http_auth:[],http_tool_info:(g==null?void 0:g.http_tool_info)||{http_tool_name:(C==null?void 0:C.name)||"",http_tool_key:(C==null?void 0:C.tool_key)||"",http_tool_avatar:(C==null?void 0:C.avatar)||"",http_tool_description:(C==null?void 0:C.description)||"",http_tool_node_key:(g==null?void 0:g.node_key)||"",http_tool_node_name:(g==null?void 0:g.node_name)||"",http_tool_node_description:(g==null?void 0:g.node_description)||""}});a("add",w)};function p(){window.open("/#/robot/list?active=6","_blank")}function m(C){return String(C||"").toUpperCase()||"GET"}function v(C){return String(C||"").replace(/[`"]/g,"").trim()}return(C,g)=>{const $=no;return h(),D("div",fv,[u.value.length?(h(),D("div",vv,[(h(!0),D(ee,null,se(u.value,(w,S)=>(h(),D("div",{key:S,class:"node-item"},[c($,{placement:"right"},{content:f(()=>[s("div",hv,[s("div",mv,[s("img",{class:"avatar",src:w.avatar||"/src/assets/img/workflow/node-service.svg"},null,8,gv),s("div",yv,_(w.name),1)]),s("div",bv,_(d(o)("label_node_count"))+_((w.nodes||[]).length),1),s("div",null,_(w.description),1)])]),default:f(()=>[s("div",{class:"node-info",onClick:k=>w.expand=!w.expand},[s("img",{class:"avatar",src:w.avatar||"/src/assets/img/workflow/node-service.svg"},null,8,wv),s("div",Cv,[s("span",$v,_(w.name),1),s("span",xv,[T(_((w.nodes||[]).length)+" ",1),w.expand?(h(),G(d(ds),{key:0})):(h(),G(d(fs),{key:1}))])])],8,kv)]),_:2},1024),$s(s("div",Sv,[(h(!0),D(ee,null,se(w.nodes||[],(k,b)=>(h(),G($,{key:b,placement:"right"},{content:f(()=>{var x,A,R,E,B,N,I,L,q,O;return[s("div",Dv,[s("div",Av,[s("div",Ov,[s("span",Nv,_(k.node_name),1)]),s("div",Bv,_(k.node_description),1)]),s("div",Ev,[s("div",Iv,[s("span",Fv,_(m((A=(x=k==null?void 0:k.node_params)==null?void 0:x.curl)==null?void 0:A.method)),1),s("span",Rv,_(v((E=(R=k==null?void 0:k.node_params)==null?void 0:R.curl)==null?void 0:E.rawurl)),1)])]),Array.isArray((N=(B=k==null?void 0:k.node_params)==null?void 0:B.curl)==null?void 0:N.params)&&k.node_params.curl.params.length?(h(),D("div",Lv,[s("div",Vv,[s("span",Mv,_(d(o)("label_query_params")),1)]),s("div",Tv,_(k.node_params.curl.params.map(M=>M.key).filter(Boolean).join(", ")),1)])):Z("",!0),Array.isArray((L=(I=k==null?void 0:k.node_params)==null?void 0:I.curl)==null?void 0:L.headers)&&k.node_params.curl.headers.length?(h(),D("div",jv,[s("div",Pv,[s("span",qv,_(d(o)("label_request_headers")),1)]),s("div",Hv,_(k.node_params.curl.headers.map(M=>M.key).filter(Boolean).join(", ")),1)])):Z("",!0),Array.isArray((O=(q=k==null?void 0:k.node_params)==null?void 0:q.curl)==null?void 0:O.output)&&k.node_params.curl.output.length?(h(),D("div",Uv,[s("div",Jv,[s("span",zv,_(d(o)("label_output_fields")),1)]),s("div",Kv,_(k.node_params.curl.output.map(M=>M.key).filter(Boolean).join(", ")),1)])):Z("",!0)])]}),default:f(()=>[s("div",{class:"node-tool-item",onClick:x=>y(w,k)},_(k.node_name),9,Gv)]),_:2},1024))),128))],512),[[Es,w.expand]])]))),128))])):(h(),D("div",Wv,[g[0]||(g[0]=s("img",{style:{height:"200px"},src:No},null,-1)),s("div",null,_(d(o)("msg_no_http_tools")),1),s("a",{onClick:p},[T(_(d(o)("btn_go_add")),1),c(d(fs))])]))])}}},Yv=_e(Zv,[["__scopeId","data-v-772becd8"]]),Qv={class:"node-list-popup"},Xv={class:"tabs-box"},eh={class:"node-list-popup-content"},th={key:0,class:"node-list"},sh={class:"node-type"},oh={class:"node-flex-box"},nh=["onMousedown"],ah=["src","alt"],lh={class:"node-name"},ih={key:1,class:"node-box"},rh={class:"sub-tabs"},dh={class:"search-box"},uh={class:"node-list"},ch={class:"node-info-pop"},_h={class:"info"},ph=["src"],fh={class:"name"},vh={class:"extra"},hh=["onClick"],mh=["src"],gh={class:"info"},yh={class:"name"},bh={class:"total"},kh={class:"node-tools"},wh={class:"params-box"},Ch={class:"param-item"},$h={class:"field"},xh={class:"name"},Sh={class:"desc"},Dh={class:"field"},Ah={class:"name"},Oh={class:"type"},Nh={key:0,class:"required"},Bh={class:"desc"},Eh=["onMousedown"],Ih={key:1,class:"empty-box"},Fh={class:"node-list",style:{flex:"1","overflow-y":"auto"}},Rh={class:"more-link",href:"/#/robot/list?active=6",target:"_blank"},Lh={key:1,class:"node-box"},Vh={class:"node-list"},Mh=["onClick"],Th={class:"node-info"},jh=["src"],Ph={class:"info"},qh={class:"name"},Hh={key:0,class:"node-item"},Uh={class:"node-info-pop"},Jh={class:"info"},zh=["src"],Kh={class:"name"},Gh={class:"extra"},Wh=["onClick"],Zh=["src"],Yh={class:"info"},Qh={class:"name"},Xh={class:"total"},em={class:"node-tools"},tm={class:"params-box"},sm={class:"param-item"},om={class:"field"},nm={class:"name"},am={class:"desc"},lm={class:"field"},im={class:"name"},rm={class:"type"},dm={key:0,class:"required"},um={class:"desc"},cm=["onMousedown"],_m=["onClick"],pm={class:"node-info"},fm=["src"],vm={class:"info"},hm={class:"name"},mm={class:"more-link",href:"/#/plugins/index?active=2",target:"_blank"},gm={key:1,class:"empty-box"},ym={href:"/#/plugins/index?active=2",target:"_blank"},bm={key:3,class:"node-box"},km={key:4,class:"node-box"},wm={__name:"index",props:{type:{type:String,default:""},active:{type:Number,default:1},excludedNodeTypes:{type:Array,default:()=>[]}},emits:["addNode","addTrigger","mouseMove","update:active"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-list-popup.index"),a=n,l=e,{isPublicNetwork:i}=rf(),r=U(l.active),u=U("MCP");Ie(()=>l.active,B=>{r.value=B});const y=U([]),p=U([]),m=U([]),v=U("");Ie(()=>l.excludedNodeTypes,()=>{y.value=Ti({excludedNodeTypes:l.excludedNodeTypes})},{immediate:!0}),Ne(()=>{ji().then(B=>{m.value=B}),Pi().then(B=>{p.value=B})});const C=ye(()=>v.value?m.value.filter(B=>(B.description+B.name).indexOf(v.value)>-1):m.value),g=(B,N)=>{B.preventDefault();let I=!1;const L=B.clientX,q=B.clientY,O=JSON.parse(JSON.stringify(N)),M=document.createElement("div");M.classList.add("node-item-ghost"),M.innerHTML=B.currentTarget.innerHTML,document.body.appendChild(M);const j=H=>{M.style.left=`${H.clientX+5}px`,M.style.top=`${H.clientY+5}px`};j(B);const V=H=>{!I&&(Math.abs(H.clientX-L)>5||Math.abs(H.clientY-q)>5)&&(I=!0),j(H),a("mouseMove")},z=H=>{document.body.removeChild(M),window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",z),I?a("addNode",{node:O,event:H}):$(O)};window.addEventListener("mousemove",V),window.addEventListener("mouseup",z,{once:!0})},$=B=>{B=JSON.parse(JSON.stringify(B)),a("addNode",{node:B})},w=(B,N,I)=>{let L=qi(N,I);g(B,L)},S=B=>{a("addNode",{node:B,isTriggerNode:!0})},k=B=>{a("addNode",{node:B})},b=(B,N,I,L)=>{N=Hi(N,I,L),B?g(B,N):a("addNode",{node:N})};function x(B){r.value=B,a("update:active",B)}function A(){window.open("/#/robot/list?active=3&mcp=2","_blank")}function R(B){var I,L,q;let N=rs((I=B==null?void 0:B.properties)==null?void 0:I.node_params,{});return Bo((L=N==null?void 0:N.plugin)==null?void 0:L.name)||((q=N==null?void 0:N.plugin)==null?void 0:q.multiNode)}function E(B){a("addNode",{node:B})}return(B,N)=>{const I=It,L=wn,q=no;return h(),D("div",Qv,[s("div",Xv,[s("div",{class:qe(["tab-item",{active:r.value==1}]),onClick:N[0]||(N[0]=O=>x(1))},[c(I,{name:"base-node-type"}),N[8]||(N[8]=T()),s("span",null,_(d(o)("tab_basic_functions")),1)],2),s("div",{class:qe(["tab-item",{active:r.value==3}]),onClick:N[1]||(N[1]=O=>x(3))},[c(I,{name:"plugin-node-type"}),N[9]||(N[9]=T()),s("span",null,_(d(o)("tab_plugins")),1)],2),s("div",{class:qe(["tab-item",{active:r.value==2}]),onClick:N[2]||(N[2]=O=>x(2))},[c(I,{name:"mcp-node-type"}),N[10]||(N[10]=T()),s("span",null,_(d(o)("tab_mcp")),1)],2),l.type=="float-btn"?(h(),D("div",{key:0,class:qe(["tab-item",{active:l.active==4}]),onClick:N[3]||(N[3]=O=>x(4))},[c(I,{name:"mcp-node-type"}),N[11]||(N[11]=T()),s("span",null,_(d(o)("tab_triggers")),1)],2)):Z("",!0),s("div",{class:qe(["tab-item",{active:r.value==5}]),onClick:N[4]||(N[4]=O=>x(5))},[c(I,{name:"workflow"}),N[12]||(N[12]=T()),s("span",null,_(d(o)("tab_workflows")),1)],2)]),s("div",eh,[r.value==1?(h(!0),D(ee,{key:0},se(y.value,O=>(h(),D(ee,{key:O.key},[O.hidden?Z("",!0):(h(),D("div",th,[s("div",sh,_(O.name),1),s("div",oh,[(h(!0),D(ee,null,se(O.nodes,M=>(h(),D(ee,{key:M.type},[M.hidden?Z("",!0):(h(),D("div",{key:0,class:"node-item",onMousedown:j=>g(j,M)},[s("img",{src:M.properties.node_icon,alt:M.properties.node_name},null,8,ah),s("div",lh,_(M.properties.node_name),1)],40,nh))],64))),128))])]))],64))),128)):r.value==2?(h(),D("div",ih,[s("div",rh,[s("div",{class:qe(["sub-tab-item",{active:u.value=="MCP"}]),onClick:N[5]||(N[5]=O=>u.value="MCP")},"MCP",2),s("div",{class:qe(["sub-tab-item",{active:u.value=="HTTP"}]),onClick:N[6]||(N[6]=O=>u.value="HTTP")},"HTTP",2)]),s("div",dh,[c(L,{value:v.value,"onUpdate:value":N[7]||(N[7]=O=>v.value=O),valueModifiers:{trim:!0},allowClear:"",placeholder:d(o)("ph_search_by_name")},null,8,["value","placeholder"])]),u.value=="MCP"&&C.value.length?(h(),D(ee,{key:0},[s("div",uh,[(h(!0),D(ee,null,se(C.value,(O,M)=>(h(),D("div",{key:M,class:"node-item"},[c(q,{placement:"right"},{content:f(()=>[s("div",ch,[s("div",_h,[s("img",{class:"avatar",src:O.avatar},null,8,ph),s("div",fh,_(O.name),1)]),s("div",null,_(O.url),1),s("div",vh,_(d(o)("label_available_tools"))+_(O.tools.length),1)])]),default:f(()=>[s("div",{class:"node-info",onClick:j=>O.expand=!O.expand},[s("img",{class:"avatar",src:O.avatar},null,8,mh),s("div",gh,[s("span",yh,_(O.name),1),s("span",bh,[T(_(O.tools.length)+" ",1),O.expand?(h(),G(d(ds),{key:0})):(h(),G(d(fs),{key:1}))])])],8,hh)]),_:2},1024),$s(s("div",kh,[(h(!0),D(ee,null,se(O.tools,(j,V)=>(h(),G(q,{key:V,placement:"right"},{content:f(()=>[s("div",wh,[s("div",Ch,[s("div",$h,[s("span",xh,_(j.name),1)]),s("div",Sh,_(j.description),1)]),(h(!0),D(ee,null,se(j.inputSchema.properties,(z,H)=>(h(),D("div",{key:H,class:"param-item"},[s("div",Dh,[s("span",Ah,_(H),1),s("span",Oh,_(z.type),1),j.inputSchema.required&&j.inputSchema.required.includes(H)?(h(),D("span",Nh,_(d(o)("label_required")),1)):Z("",!0)]),s("div",Bh,_(z.description),1)]))),128))])]),default:f(()=>[s("div",{class:"node-tool-item",onMousedown:z=>w(z,O,j)},_(j.name),41,Eh)]),_:2},1024))),128))],512),[[Es,O.expand]])]))),128))]),s("a",{class:"more-link",onClick:A},[T(_(d(o)("label_more_mcp_plugins"))+" ",1),c(d(fs))])],64)):u.value=="MCP"?(h(),D("div",Ih,[N[13]||(N[13]=s("img",{style:{height:"200px"},src:No},null,-1)),s("div",null,_(d(o)("msg_no_mcp_plugins")),1),s("a",{onClick:A},[T(_(d(o)("btn_add_now")),1),c(d(fs))])])):u.value=="HTTP"?(h(),D(ee,{key:2},[s("div",Fh,[c(Yv,{keyword:v.value,onAdd:E},null,8,["keyword"])]),s("a",Rh,[T(_(d(o)("label_more_http_tools"))+" ",1),c(d(fs))])],64)):Z("",!0)])):r.value==3?(h(),D(ee,{key:2},[d(i)?(h(),D("div",Lh,[p.value.length?(h(),D(ee,{key:0},[s("div",Vh,[(h(!0),D(ee,null,se(p.value,O=>(h(),D(ee,{key:O.type},[R(O)?(h(),D(ee,{key:1},[d(xo)(O.plugin_name).length>1?(h(),D("div",Hh,[c(q,{placement:"right"},{content:f(()=>[s("div",Uh,[s("div",Jh,[s("img",{class:"avatar",src:O.properties.node_icon},null,8,zh),s("div",Kh,_(O.properties.node_name),1)]),s("div",null,_(O.properties.node_desc),1),s("div",Gh,_(d(o)("label_available_tools"))+_(d(xo)(O.plugin_name).length),1)])]),default:f(()=>[s("div",{class:"node-info",onClick:M=>O.expand=!O.expand},[s("img",{class:"avatar",src:O.properties.node_icon},null,8,Zh),s("div",Yh,[s("span",Qh,_(O.properties.node_name),1),s("span",Xh,[T(_(d(xo)(O.plugin_name).length)+" ",1),O.expand?(h(),G(d(ds),{key:0})):(h(),G(d(fs),{key:1}))])])],8,Wh)]),_:2},1024),$s(s("div",em,[(h(!0),D(ee,null,se(d(xo)(O.plugin_name),M=>(h(),G(q,{key:M.name,placement:"right"},{content:f(()=>[s("div",tm,[s("div",sm,[s("div",om,[s("span",nm,_(M.title),1)]),s("div",am,_(M.desc),1)]),(h(!0),D(ee,null,se(M.params,(j,V)=>(h(),D("div",{key:V,class:"param-item"},[s("div",lm,[s("span",im,_(V),1),s("span",rm,_(j.type),1),j.required?(h(),D("span",dm,_(d(o)("label_required")),1)):Z("",!0)]),s("div",um,_(j.desc),1)]))),128))])]),default:f(()=>[s("div",{class:"node-tool-item",onMousedown:j=>b(j,O,M,M.name)},_(M.title),41,cm)]),_:2},1024))),128))],512),[[Es,O.expand]])])):(h(!0),D(ee,{key:1},se(d(xo)(O.plugin_name),M=>(h(),D("div",{onClick:j=>b(null,O,M,M.name),class:"node-item"},[s("div",pm,[s("img",{class:"avatar",src:O.properties.node_icon},null,8,fm),s("div",vm,[s("span",hm,_(O.properties.node_name),1)])])],8,_m))),256))],64)):(h(),D("div",{key:0,onClick:M=>$(O),class:"node-item"},[s("div",Th,[s("img",{class:"avatar",src:O.properties.node_icon},null,8,jh),s("div",Ph,[s("span",qh,_(O.properties.node_name),1)])])],8,Mh))],64))),128))]),s("a",mm,[T(_(d(o)("btn_more_plugins"))+" ",1),c(d(fs))])],64)):(h(),D("div",gm,[N[14]||(N[14]=s("img",{style:{height:"200px"},src:No},null,-1)),s("div",null,_(d(o)("msg_no_plugins")),1),s("a",ym,[T(_(d(o)("btn_add_now")),1),c(d(fs))])]))])):(h(),G(df,{key:0,style:{margin:"0"}}))],64)):r.value==4?(h(),D("div",bm,[c(sv,{onAdd:S})])):r.value==5?(h(),D("div",km,[c(pv,{onAdd:k})])):Z("",!0)])])}}},Qo=_e(wm,[["__scopeId","data-v-095751f7"]]),Cm={class:"custom-control-warpper"},$m={class:"custom-control-body"},xm={class:"custom-control"},Sm={class:"control-item zoom-control"},Dm={class:"control-item"},Am={class:"control-item"},Om={class:"control-item"},Nm={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoomChange","autoLayout"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.custom-control.index"),a=n,l=e,i=U(["terminate-node"]),{eventCenter:r}=l.lf.graphModel,u=U(100),y=()=>{l.lf.fitView()},p=()=>{let N=u.value/100;l.lf.zoom(N),a("zoomChange",N)},m=N=>{u.value=N,p()},v=()=>{let N=u.value-10;N<1&&(N=1),u.value=N,p()},C=()=>{let N=u.value+10;N>800&&(N=800),u.value=N,p()},g=N=>{let I=Math.floor(N.transform.SCALE_X*100);u.value=I},$=U(!1),w=U(null),S=U(1),k=()=>{S.value=1,$.value=!0},b=()=>{a("runTest")},x=()=>{a("autoLayout")},A=N=>{$.value&&(w.value.contains(N.target)||($.value=!1))},R=()=>{$.value&&($.value=!1)},E=N=>{a("addNode",N),$.value=!1},B=()=>{S.value=4,$.value=!0};return Ne(()=>{document.addEventListener("click",A),r.on("graph:transform",g),r.on("custom:showTriggerLit",B)}),Ut(()=>{document.removeEventListener("click",A),r.off("graph:transform",g),r.off("custom:showTriggerLit",B)}),(N,I)=>{const L=It,q=rt;return h(),D("div",Cm,[s("div",$m,[s("div",xm,[s("div",Sm,[s("div",{class:"action-btn zoom-btn",onClick:v},[c(L,{name:"minus",size:"16"})]),c(qf,{modelValue:u.value,"onUpdate:modelValue":I[0]||(I[0]=O=>u.value=O),onZoomChange:m,onFitView:y},null,8,["modelValue"]),s("div",{class:"action-btn zoom-btn",onClick:C},[c(L,{name:"plus",size:"16"})])]),I[2]||(I[2]=s("i",{class:"control-line"},null,-1)),s("div",Dm,[c(q,{type:"primary",onClick:He(k,["stop"])},{icon:f(()=>[c(d(Xe))]),default:f(()=>[s("span",null,_(d(o)("btn_create_node")),1)]),_:1})]),s("div",Am,[c(q,{onClick:b,style:{"background-color":"#00ad3a"},type:"primary"},{default:f(()=>[c(d(bs)),s("span",null,_(d(o)("btn_run_test")),1)]),_:1})]),s("div",Om,[c(q,{onClick:x,type:"default"},{default:f(()=>[c(d(ri)),s("span",null,_(d(o)("btn_organize_canvas")),1)]),_:1})])]),$s(s("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:w},[c(Qo,{excludedNodeTypes:i.value,onAddNode:E,type:"float-btn",onMouseMove:R,active:S.value,"onUpdate:active":I[1]||(I[1]=O=>S.value=O)},null,8,["excludedNodeTypes","active"])],512),[[Es,$.value]])])])}}},Bm=_e(Nm,[["__scopeId","data-v-a87dbae0"]]),Em={},Im={class:"node-form-layout"},Fm={class:"layout-header"},Rm={class:"layout-body"};function Lm(e,n){return h(),D("div",Im,[s("div",Fm,[Ns(e.$slots,"header",{},void 0,!0)]),s("div",Rm,[Ns(e.$slots,"default",{},void 0,!0)])])}const ft=_e(Em,[["render",Lm],["__scopeId","data-v-1df44d93"]]),Vm={class:"node-form-header"},Mm={class:"node-title"},Tm={class:"title-left"},jm=["src"],Pm=["src"],qm={class:"title-conttent"},Hm={class:"title-right"},Um={href:"javascript:;"},Jm={class:"node-desc"},zm={__name:"node-form-header",props:{iconName:{type:String,default:""},iconUrl:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},emits:["changeTitle","deleteNode","close"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.node-form-header"),a=be("changeTitle"),l=be("deleteNode"),i=be("close"),r=n,u=e;let y=null;const p=w=>new URL(Object.assign({"../../../../assets/svg/accomplish-icon.svg":Qp,"../../../../assets/svg/accounts-icon.svg":Yp,"../../../../assets/svg/ai-dialogue-node.svg":Zp,"../../../../assets/svg/ai-generate-white.svg":Wp,"../../../../assets/svg/ai-generate.svg":Gp,"../../../../assets/svg/ai-mark.svg":Kp,"../../../../assets/svg/ai.svg":zp,"../../../../assets/svg/alarm-clock.svg":Jp,"../../../../assets/svg/alert-icon.svg":Up,"../../../../assets/svg/ali-ocr.svg":Hp,"../../../../assets/svg/analysis.svg":qp,"../../../../assets/svg/anthrop.svg":Pp,"../../../../assets/svg/applet.svg":jp,"../../../../assets/svg/arrow-down.svg":Tp,"../../../../assets/svg/arrow-left.svg":Mp,"../../../../assets/svg/arrow-right.svg":Vp,"../../../../assets/svg/attachment.svg":Lp,"../../../../assets/svg/auth.svg":Rp,"../../../../assets/svg/auto-reply.svg":Fp,"../../../../assets/svg/azure.svg":Ip,"../../../../assets/svg/back.svg":Ep,"../../../../assets/svg/baichuan.svg":Bp,"../../../../assets/svg/base-data-icon.svg":Np,"../../../../assets/svg/base-node-type.svg":Op,"../../../../assets/svg/batch-group-node.svg":Ap,"../../../../assets/svg/book.svg":Dp,"../../../../assets/svg/categary-manage-active-icon.svg":Sp,"../../../../assets/svg/categary-manage-icon.svg":xp,"../../../../assets/svg/chat-cache.svg":$p,"../../../../assets/svg/chat-mode.svg":Cp,"../../../../assets/svg/chat-robot-icon.svg":wp,"../../../../assets/svg/chat.svg":kp,"../../../../assets/svg/check-arrow-filled.svg":bp,"../../../../assets/svg/circular-needle2.svg":yp,"../../../../assets/svg/circularNeedle.svg":gp,"../../../../assets/svg/client.svg":mp,"../../../../assets/svg/close-circle.svg":hp,"../../../../assets/svg/cmd.svg":vp,"../../../../assets/svg/code-run-node.svg":fp,"../../../../assets/svg/cohere.svg":pp,"../../../../assets/svg/collaborator.svg":_p,"../../../../assets/svg/collapse-close.svg":cp,"../../../../assets/svg/collapse-open.svg":up,"../../../../assets/svg/colour-edit.svg":dp,"../../../../assets/svg/comment-delete.svg":rp,"../../../../assets/svg/comment-reply.svg":ip,"../../../../assets/svg/comment-search.svg":lp,"../../../../assets/svg/comment-selected.svg":ap,"../../../../assets/svg/comment.svg":np,"../../../../assets/svg/common-quession.svg":op,"../../../../assets/svg/create_library.svg":sp,"../../../../assets/svg/create_robot.svg":tp,"../../../../assets/svg/csv.svg":ep,"../../../../assets/svg/cu-doc-active.svg":X_,"../../../../assets/svg/cu-doc-icon.svg":Q_,"../../../../assets/svg/custom-group-node.svg":Y_,"../../../../assets/svg/data-node.svg":Z_,"../../../../assets/svg/data-security.svg":W_,"../../../../assets/svg/database-menu-icon.svg":G_,"../../../../assets/svg/deepseek.svg":K_,"../../../../assets/svg/delete-line.svg":z_,"../../../../assets/svg/delete.svg":J_,"../../../../assets/svg/ding-group-node.svg":U_,"../../../../assets/svg/direct-connection.svg":H_,"../../../../assets/svg/dislike-active.svg":q_,"../../../../assets/svg/dislike.svg":P_,"../../../../assets/svg/doc-active-menu-icon.svg":j_,"../../../../assets/svg/doc-directory.svg":T_,"../../../../assets/svg/doc-draft.svg":M_,"../../../../assets/svg/doc-file.svg":V_,"../../../../assets/svg/doc-file2.svg":L_,"../../../../assets/svg/doc-icon-active.svg":R_,"../../../../assets/svg/doc-icon.svg":F_,"../../../../assets/svg/doc-menu-icon.svg":I_,"../../../../assets/svg/document-icon.svg":E_,"../../../../assets/svg/document.svg":B_,"../../../../assets/svg/docx.svg":N_,"../../../../assets/svg/down-file.svg":O_,"../../../../assets/svg/download.svg":A_,"../../../../assets/svg/drag.svg":D_,"../../../../assets/svg/dragv2.svg":S_,"../../../../assets/svg/duiwaifuwu.svg":x_,"../../../../assets/svg/economic-active.svg":$_,"../../../../assets/svg/economic.svg":C_,"../../../../assets/svg/edit-02.svg":w_,"../../../../assets/svg/edit.svg":k_,"../../../../assets/svg/empty-document.svg":b_,"../../../../assets/svg/empty.svg":y_,"../../../../assets/svg/end-node.svg":g_,"../../../../assets/svg/enterprise-active.svg":m_,"../../../../assets/svg/enterprise.svg":h_,"../../../../assets/svg/enterprise2.svg":v_,"../../../../assets/svg/excel.svg":f_,"../../../../assets/svg/execute.svg":p_,"../../../../assets/svg/execute_array.svg":__,"../../../../assets/svg/expand.svg":c_,"../../../../assets/svg/explain-node.svg":u_,"../../../../assets/svg/export-record-active-icon.svg":d_,"../../../../assets/svg/export-record-icon.svg":r_,"../../../../assets/svg/export-record.svg":i_,"../../../../assets/svg/eye-open.svg":l_,"../../../../assets/svg/fail-icon.svg":a_,"../../../../assets/svg/faq-icon.svg":n_,"../../../../assets/svg/feishu-doc.svg":o_,"../../../../assets/svg/field-menu-icon.svg":s_,"../../../../assets/svg/file-icon.svg":t_,"../../../../assets/svg/file-search.svg":e_,"../../../../assets/svg/file_ext.svg":Xc,"../../../../assets/svg/finance.svg":Qc,"../../../../assets/svg/folder-icon-active.svg":Yc,"../../../../assets/svg/folder-icon.svg":Zc,"../../../../assets/svg/forbid-update-icon.svg":Wc,"../../../../assets/svg/function-center.svg":Gc,"../../../../assets/svg/gemini.svg":Kc,"../../../../assets/svg/generate-icon.svg":zc,"../../../../assets/svg/gou.svg":Jc,"../../../../assets/svg/government.svg":Uc,"../../../../assets/svg/graph-icon.svg":Hc,"../../../../assets/svg/group-default-icon.svg":qc,"../../../../assets/svg/group-icon.svg":Pc,"../../../../assets/svg/group-send.svg":jc,"../../../../assets/svg/guanlianzhishiku.svg":Tc,"../../../../assets/svg/guide.svg":Mc,"../../../../assets/svg/high-active.svg":Vc,"../../../../assets/svg/high.svg":Lc,"../../../../assets/svg/html.svg":Rc,"../../../../assets/svg/http-node.svg":Fc,"../../../../assets/svg/huanyingyu.svg":Ic,"../../../../assets/svg/huoshanyinqin.svg":Ec,"../../../../assets/svg/icon-all.svg":Bc,"../../../../assets/svg/icon-rocket.svg":Nc,"../../../../assets/svg/image-generation-node.svg":Oc,"../../../../assets/svg/img-icon.svg":Ac,"../../../../assets/svg/import-record-active-icon.svg":Dc,"../../../../assets/svg/import-record-icon.svg":Sc,"../../../../assets/svg/input.svg":xc,"../../../../assets/svg/jibenpeizhi.svg":$c,"../../../../assets/svg/jichupeizhi.svg":Cc,"../../../../assets/svg/jina.svg":wc,"../../../../assets/svg/json-node.svg":kc,"../../../../assets/svg/json-reverse-node.svg":bc,"../../../../assets/svg/judge-node.svg":yc,"../../../../assets/svg/knowledge-base-node.svg":gc,"../../../../assets/svg/knowledge-config-active-icon.svg":mc,"../../../../assets/svg/knowledge-config-icon.svg":hc,"../../../../assets/svg/knowledge-document-active-icon.svg":vc,"../../../../assets/svg/knowledge-document-icon.svg":fc,"../../../../assets/svg/knowledge-graph-active-icon.svg":pc,"../../../../assets/svg/knowledge-graph-icon.svg":_c,"../../../../assets/svg/lang.svg":cc,"../../../../assets/svg/law.svg":uc,"../../../../assets/svg/liaotianceshi.svg":dc,"../../../../assets/svg/library_ability_official_account.svg":rc,"../../../../assets/svg/like-active.svg":ic,"../../../../assets/svg/like-icon.svg":lc,"../../../../assets/svg/like.svg":ac,"../../../../assets/svg/lingyiwanwu.svg":nc,"../../../../assets/svg/link-icon-active.svg":oc,"../../../../assets/svg/link-icon.svg":sc,"../../../../assets/svg/link-left.svg":tc,"../../../../assets/svg/lock-icon.svg":ec,"../../../../assets/svg/login-success.svg":Xu,"../../../../assets/svg/logout.svg":Qu,"../../../../assets/svg/loop-2.svg":Yu,"../../../../assets/svg/loop-3.svg":Zu,"../../../../assets/svg/loop-icon.svg":Wu,"../../../../assets/svg/manufacture.svg":Gu,"../../../../assets/svg/mcp-node-type.svg":Ku,"../../../../assets/svg/mcp-node.svg":zu,"../../../../assets/svg/md.svg":Ju,"../../../../assets/svg/medical-treatment.svg":Uu,"../../../../assets/svg/menu-expand.svg":Hu,"../../../../assets/svg/message.svg":qu,"../../../../assets/svg/minus.svg":Pu,"../../../../assets/svg/mix-icon.svg":ju,"../../../../assets/svg/more-compatible.svg":Tu,"../../../../assets/svg/more-cycle.svg":Mu,"../../../../assets/svg/moxingshezhi.svg":Vu,"../../../../assets/svg/multimode-box.svg":Lu,"../../../../assets/svg/nav-chat.svg":Ru,"../../../../assets/svg/nav-doc.svg":Fu,"../../../../assets/svg/nav-explore.svg":Iu,"../../../../assets/svg/nav-find.svg":Eu,"../../../../assets/svg/nav-library.svg":Bu,"../../../../assets/svg/nav-robot.svg":Nu,"../../../../assets/svg/nav-search.svg":Ou,"../../../../assets/svg/network.svg":Au,"../../../../assets/svg/ofd.svg":Du,"../../../../assets/svg/official-trigger-node.svg":Su,"../../../../assets/svg/official_account_ai_comment.svg":xu,"../../../../assets/svg/official_account_batch_send.svg":$u,"../../../../assets/svg/official_custom_menu.svg":Cu,"../../../../assets/svg/open-ai.svg":wu,"../../../../assets/svg/ordinary-icon.svg":ku,"../../../../assets/svg/ordinary-segmentation.svg":bu,"../../../../assets/svg/out-the-box.svg":yu,"../../../../assets/svg/output.svg":gu,"../../../../assets/svg/paper-airplane-new.svg":mu,"../../../../assets/svg/paper-airplane.svg":hu,"../../../../assets/svg/parameter-extraction-node.svg":vu,"../../../../assets/svg/payment.svg":fu,"../../../../assets/svg/pc.svg":pu,"../../../../assets/svg/pdf-img.svg":_u,"../../../../assets/svg/pdf-ocr.svg":cu,"../../../../assets/svg/pdf-text.svg":uu,"../../../../assets/svg/pdf.svg":du,"../../../../assets/svg/phone.svg":ru,"../../../../assets/svg/plugin-node-type.svg":iu,"../../../../assets/svg/plus.svg":lu,"../../../../assets/svg/point-h.svg":au,"../../../../assets/svg/ppt.svg":nu,"../../../../assets/svg/preview-icon.svg":ou,"../../../../assets/svg/problem-optimization-node.svg":su,"../../../../assets/svg/problem-optimization.svg":tu,"../../../../assets/svg/prompt-icon.svg":eu,"../../../../assets/svg/put-away.svg":Xd,"../../../../assets/svg/qa-feedback.svg":Qd,"../../../../assets/svg/question-node.svg":Yd,"../../../../assets/svg/quick-Instruction.svg":Zd,"../../../../assets/svg/quote-file.svg":Wd,"../../../../assets/svg/quotes.svg":Gd,"../../../../assets/svg/recall-testing-active-icon.svg":Kd,"../../../../assets/svg/recall-testing-icon.svg":zd,"../../../../assets/svg/recommendation.svg":Jd,"../../../../assets/svg/recycle-bin-record-active-icon.svg":Ud,"../../../../assets/svg/recycle-bin-record-icon.svg":Hd,"../../../../assets/svg/related-robots-active-icon.svg":qd,"../../../../assets/svg/related-robots-icon.svg":Pd,"../../../../assets/svg/relevance-icon.svg":jd,"../../../../assets/svg/reply-content-image-text.svg":Td,"../../../../assets/svg/reply-content-image.svg":Md,"../../../../assets/svg/reply-content-link.svg":Vd,"../../../../assets/svg/reply-content-smart.svg":Ld,"../../../../assets/svg/reply-content-text.svg":Rd,"../../../../assets/svg/reply-content.svg":Fd,"../../../../assets/svg/reply-settings.svg":Id,"../../../../assets/svg/retail.svg":Ed,"../../../../assets/svg/reward-points.svg":Bd,"../../../../assets/svg/right-fork-icon.svg":Nd,"../../../../assets/svg/robot_auto_reply.svg":Od,"../../../../assets/svg/robot_payment.svg":Ad,"../../../../assets/svg/robot_smart_menu.svg":Dd,"../../../../assets/svg/robot_subscribe_reply.svg":Sd,"../../../../assets/svg/save-draft.svg":xd,"../../../../assets/svg/sdk.svg":$d,"../../../../assets/svg/search-check-icon.svg":Cd,"../../../../assets/svg/search-right.svg":wd,"../../../../assets/svg/search-tip.svg":kd,"../../../../assets/svg/search.svg":bd,"../../../../assets/svg/segmentation-down.svg":yd,"../../../../assets/svg/segmentation-icon.svg":gd,"../../../../assets/svg/segmentation-up.svg":md,"../../../../assets/svg/segmentation.svg":hd,"../../../../assets/svg/select-disabled.svg":vd,"../../../../assets/svg/semantic-segmentation.svg":fd,"../../../../assets/svg/sensitive-icon.svg":pd,"../../../../assets/svg/seo-gray.svg":_d,"../../../../assets/svg/seo-highlight.svg":cd,"../../../../assets/svg/seo-light.svg":ud,"../../../../assets/svg/session-record.svg":dd,"../../../../assets/svg/session-trigger-node.svg":rd,"../../../../assets/svg/session.svg":id,"../../../../assets/svg/set-keywords.svg":ld,"../../../../assets/svg/set_model.svg":ad,"../../../../assets/svg/setting.svg":nd,"../../../../assets/svg/share.svg":od,"../../../../assets/svg/similarity.svg":sd,"../../../../assets/svg/skii.svg":td,"../../../../assets/svg/smart-add.svg":ed,"../../../../assets/svg/smart-delete.svg":Xr,"../../../../assets/svg/smart-menu.svg":Qr,"../../../../assets/svg/sort-down-icon.svg":Yr,"../../../../assets/svg/sort-icon.svg":Zr,"../../../../assets/svg/sort-top-icon.svg":Wr,"../../../../assets/svg/source-energy.svg":Gr,"../../../../assets/svg/specify-reply-node.svg":Kr,"../../../../assets/svg/start-node.svg":zr,"../../../../assets/svg/statistical-analysis.svg":Jr,"../../../../assets/svg/status-fail.svg":Ur,"../../../../assets/svg/status-sending.svg":Hr,"../../../../assets/svg/status-success.svg":qr,"../../../../assets/svg/steps-success-icon.svg":Pr,"../../../../assets/svg/storage-icon.svg":jr,"../../../../assets/svg/subscribe-reply.svg":Tr,"../../../../assets/svg/success.svg":Mr,"../../../../assets/svg/suggested-issues.svg":Vr,"../../../../assets/svg/support.svg":Lr,"../../../../assets/svg/switch-mobile.svg":Rr,"../../../../assets/svg/system-setting.svg":Fr,"../../../../assets/svg/table-expand.svg":Ir,"../../../../assets/svg/table-hide.svg":Er,"../../../../assets/svg/team-manage-active.svg":Br,"../../../../assets/svg/team-manage.svg":Nr,"../../../../assets/svg/team-manage2.svg":Or,"../../../../assets/svg/tengxunhunyuan.svg":Ar,"../../../../assets/svg/test-active-menu-icon.svg":Dr,"../../../../assets/svg/test-menu-icon.svg":Sr,"../../../../assets/svg/test_robot.svg":xr,"../../../../assets/svg/think.svg":$r,"../../../../assets/svg/thumbnail-icon-active.svg":Cr,"../../../../assets/svg/thumbnail-icon.svg":wr,"../../../../assets/svg/time-default-icon.svg":kr,"../../../../assets/svg/time-icon.svg":br,"../../../../assets/svg/time-line-icon.svg":yr,"../../../../assets/svg/timing-trigger-node.svg":gr,"../../../../assets/svg/tip-icon-two.svg":mr,"../../../../assets/svg/tip-icon.svg":hr,"../../../../assets/svg/tongyiqianwen.svg":vr,"../../../../assets/svg/txt.svg":fr,"../../../../assets/svg/unit.svg":pr,"../../../../assets/svg/unknown-issue.svg":_r,"../../../../assets/svg/unknown-prompt.svg":cr,"../../../../assets/svg/update-icon.svg":ur,"../../../../assets/svg/use-token-active.svg":dr,"../../../../assets/svg/use-token.svg":rr,"../../../../assets/svg/user-icon.svg":ir,"../../../../assets/svg/variable-assignment-node.svg":lr,"../../../../assets/svg/variable-icon.svg":ar,"../../../../assets/svg/vector-icon.svg":nr,"../../../../assets/svg/voice-clone-node.svg":or,"../../../../assets/svg/voice-synthesis-node.svg":sr,"../../../../assets/svg/webhook-trigger-node.svg":tr,"../../../../assets/svg/wenxinyiyan.svg":er,"../../../../assets/svg/workflow-robot-icon.svg":Xi,"../../../../assets/svg/workflow.svg":Qi,"../../../../assets/svg/wx-app-icon.svg":Yi,"../../../../assets/svg/xitongtishici.svg":Zi,"../../../../assets/svg/xlsx.svg":Wi,"../../../../assets/svg/xunfeixinghuo.svg":Gi,"../../../../assets/svg/yuezhianmian.svg":Ki,"../../../../assets/svg/zhipuai.svg":zi,"../../../../assets/svg/zm-plugins-node.svg":Ji,"../../../../assets/svg/zm-workflow-node.svg":Ui})[`../../../../assets/svg/${w}.svg`],import.meta.url).href,m=ye(()=>p(u.iconName)),v=U(u.title),C=()=>{y&&clearTimeout(y),y=setTimeout(()=>{a(v.value),r("changeTitle")},250)},g=()=>{l(),r("deleteNode")},$=()=>{i()};return(w,S)=>{const k=pt,b=It,x=lo,A=ao,R=io;return h(),D("div",Vm,[s("div",Mm,[s("div",Tm,[Ns(w.$slots,"node-icon",{},()=>[e.iconUrl?(h(),D("img",{key:0,class:"node-icon",src:e.iconUrl},null,8,jm)):m.value?(h(),D("img",{key:1,class:"node-icon",src:m.value},null,8,Pm)):Z("",!0)],!0)]),s("div",qm,[c(k,{class:"node-name-input",value:v.value,"onUpdate:value":S[0]||(S[0]=E=>v.value=E),placeholder:d(o)("ph_input_node_name"),onChange:He(C,["stop"])},null,8,["value","placeholder"])]),s("div",Hm,[Ns(w.$slots,"runBtn",{},void 0,!0),e.hideMenus?Z("",!0):(h(),G(R,{key:0},{overlay:f(()=>[c(A,{style:{width:"100px"}},{default:f(()=>[c(x,{onClick:S[2]||(S[2]=E=>g())},{default:f(()=>[s("a",Um,_(d(o)("btn_delete")),1)]),_:1})]),_:1})]),default:f(()=>[s("div",{class:"action-btn delete-btn",onClick:S[1]||(S[1]=He(()=>{},["prevent"]))},[c(b,{name:"point-h",class:"btn-icon"})])]),_:1})),s("div",{class:"action-btn close-btn",onClick:$},[c(d(Ga),{class:"btn-icon",style:{"font-size":"12px"}})])])]),s("div",Jm,[Ns(w.$slots,"desc",{},()=>[T(_(u.desc),1)],!0)])])}}},vt=_e(zm,[["__scopeId","data-v-1f41d1e7"]]),Km="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",Gm=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}],Wm={emits:["close","update-node"],inject:["getGraph"],components:{NodeFormLayout:ft,NodeFormHeader:vt,QuestionCircleOutlined:Re,PlusOutlined:Xe},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},setup(){const{t:e}=fe("views.workflow.components.node-form-drawer.start-node-form.index"),n=Co(),o=ye(()=>({key:[{required:!0,message:e("msg_input_variable_name"),trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:e("msg_variable_name_format"),trigger:"blur"},{min:1,max:20,message:e("msg_variable_name_length"),trigger:"blur"}],typ:[{required:!0,message:e("msg_select_type"),trigger:"change"}],required:[{required:!0,message:e("msg_select_required"),trigger:"change"}],desc:[{min:1,max:50,message:e("msg_description_length"),trigger:"blur"}]}));return{t:e,workflowStore:n,formRules:o}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1,typOptions:[...Gm],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1}},mounted(){let e=JSON.parse(this.node.node_params);this.sys_global=e.start.sys_global,this.diy_global=e.start.diy_global,this.trigger_list=e.start.trigger_list},methods:{update(){let e=JSON.parse(this.node.node_params);e.start.diy_global=[...this.diy_global];let n={...this.node,node_params:JSON.stringify(e)};this.$emit("update-node",n)},handleAddTrigger(){this.workflowStore.getTriggerList(this.$route.query.robot_key,!0),this.getGraph().eventCenter.emit("custom:showTriggerLit")},getTriggerVariables(){let e={};return this.trigger_list.forEach(n=>{(n.outputs||[]).forEach(a=>{e[a.variable]={...a}})}),e},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(e,n){this.formState={...e},this.editIndex=n,this.show=!0},handleDel(e){this.getTriggerVariables();let n=this.getTriggerVariables(),o=this.diy_global[e];if(n["global."+o.key])return Me.error(t("msg_variable_linked_to_trigger"));this.diy_global.splice(e,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{t("msg_validation_failed")}}}},Zm={class:"start-node-form"},Ym={class:"add-trigger-box"},Qm={class:"add-trigger-desc"},Xm={class:"node-form-content"},eg={class:"start-node"},tg={class:"start-node-options"},sg={class:"options-title"},og=["innerHTML"],ng={class:"options-item-body"},ag={class:"option-label"},lg={class:"option-type"},ig={class:"option-desc"},rg={class:"item-actions-box"},dg={class:"action-items-box"};function ug(e,n,o,a,l,i){const r=tt("NodeFormHeader"),u=tt("PlusOutlined"),y=rt,p=tt("QuestionCircleOutlined"),m=ct,v=It,C=pt,g=Dt,$=et,w=Ye,S=Ms,k=Ts,b=St,x=wt,A=tt("NodeFormLayout");return h(),G(A,null,{header:f(()=>[c(r,{title:o.node.node_name,iconName:o.node.node_icon_name,hideMenus:!0},{desc:f(()=>[s("span",null,_(a.t("desc_start_node")),1)]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",Zm,[s("div",Ym,[c(y,{type:"primary",ghost:"",onClick:He(i.handleAddTrigger,["stop"])},{icon:f(()=>[c(u)]),default:f(()=>[s("span",null,_(a.t("btn_add_trigger")),1)]),_:1},8,["onClick"]),s("div",Qm,_(a.t("desc_add_trigger")),1)]),s("div",Xm,[s("div",eg,[s("div",tg,[s("div",sg,[s("div",null,[n[5]||(n[5]=s("img",{src:Km,alt:"",class:"title-icon"},null,-1)),s("span",null,_(a.t("title_custom_global_variable")),1)]),s("div",null,[c(m,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:f(()=>[s("div",{innerHTML:a.t("tip_global_variable_definition")},null,8,og)]),default:f(()=>[c(p,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(h(!0),D(ee,null,se(l.diy_global,(R,E)=>(h(),D("div",{class:qe(["options-item diy-options-item",{"is-required":R.required}]),key:R.key},[s("div",ng,[s("div",ag,_(R.key),1),s("div",lg,_(R.typ),1),c(m,{title:R.desc},{default:f(()=>[s("div",ig,_(R.desc),1)]),_:2},1032,["title"])]),s("div",rg,[c(v,{class:"action-btn",name:"edit-02",onClick:B=>i.handleEdit(R,E)},null,8,["onClick"]),c(v,{class:"action-btn",name:"close-circle",onClick:B=>i.handleDel(E)},null,8,["onClick"])])],2))),128)),s("div",dg,[c(y,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:i.handleAdd},{icon:f(()=>[c(u)]),default:f(()=>[T(" "+_(a.t("btn_add_global_variable")),1)]),_:1},8,["onClick"])])]),c(x,{open:l.show,"onUpdate:open":n[4]||(n[4]=R=>l.show=R),title:a.t("title_add_variable"),okText:a.t("btn_save"),cancelText:a.t("btn_cancel"),onOk:i.handleOk},{default:f(()=>[c(b,{ref:"formRef",model:l.formState,rules:a.formRules,"label-align":"right","label-col":{span:6},"wrapper-col":{span:18}},{default:f(()=>[c(g,{label:a.t("label_variable_name"),name:"key"},{default:f(()=>[c(C,{value:l.formState.key,"onUpdate:value":n[0]||(n[0]=R=>l.formState.key=R),placeholder:a.t("ph_input_variable_name")},null,8,["value","placeholder"])]),_:1},8,["label"]),c(g,{label:a.t("label_type"),name:"typ"},{default:f(()=>[c(w,{value:l.formState.typ,"onUpdate:value":n[1]||(n[1]=R=>l.formState.typ=R)},{default:f(()=>[(h(!0),D(ee,null,se(l.typOptions,R=>(h(),G($,{value:R.value,key:R.value},{default:f(()=>[s("span",null,_(R.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),c(g,{label:a.t("label_required"),name:"required"},{default:f(()=>[c(S,{checked:l.formState.required,"onUpdate:checked":n[2]||(n[2]=R=>l.formState.required=R)},null,8,["checked"])]),_:1},8,["label"]),c(g,{label:a.t("label_description"),name:"desc"},{default:f(()=>[c(k,{value:l.formState.desc,"onUpdate:value":n[3]||(n[3]=R=>l.formState.desc=R),placeholder:a.t("ph_input_description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","okText","cancelText","onOk"])])])])]),_:1})}const cg=_e(Wm,[["render",ug],["__scopeId","data-v-8a5042cd"]]),_g={name:"CascadePanel",setup(){const{t:e}=fe("views.workflow.components.at-input.cascade-panel");return{t:e}},props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(e){e&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(e){const n=[],o=[],a=(l,i)=>{if(!l||l.length===0)return!1;for(let r=0;r<l.length;r++){const u=l[r],y=u[this.valueKey];if(y===e)return n[i]=u,o[i]=y,!0;if(u[this.childrenKey]&&u[this.childrenKey].length>0){if(n[i]=u,o[i]=y,a(u[this.childrenKey],i+1))return!0;n[i]=null,o[i]=null}}return!1};a(this.options,0),this.selectedPath=n.filter(l=>l),this.selectedValuePath=o.filter(l=>l!=null),this.updateActivePath()},findPathByValues(e){if(!e||e.length===0)return;const n=[];let o=this.options;for(let a=0;a<e.length;a++){const l=e[a],i=o.find(r=>r[this.valueKey]===l);if(i)n.push(i),o=i[this.childrenKey]||[];else break}this.selectedPath=n,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let e=0;e<this.selectedPath.length;e++){const n=this.selectedPath[e];n[this.childrenKey]&&n[this.childrenKey].length>0&&this.activePath.push({title:n[this.labelKey],options:n[this.childrenKey],level:e+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(e,n,o){this.hasChildren(e)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,n),this.selectedPath.push(e),this.selectedValuePath=this.selectedValuePath.slice(0,n),this.selectedValuePath.push(e[this.valueKey]),this.activePath=this.activePath.slice(0,n+1),this.hasChildren(e)&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:n+1}),this.$emit("select",e,this.selectedPath,n),(this.checkAnyLevel&&!this.isClickRight&&n>0||!this.hasChildren(e))&&(this.$emit("change",e[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:e[this.valueKey])),this.isClickRight=!1},isActive(e,n){return!this.selectedPath||this.selectedPath.length<=n?!1:e[this.valueKey]===this.selectedPath[n][this.valueKey]},hasChildren(e){return e[this.childrenKey]&&e[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const e=this.$el;if(!e)return;const n=e.getBoundingClientRect(),o=window.innerWidth,a=180;n.right+a>o&&n.left>a?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",a)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",a))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},pg={class:"cascade-panel"},fg={class:"cascade-panel-body"},vg=["onClick"],hg={class:"item-content"},mg={class:"item-label"},gg={key:0,class:"cascade-panel-empty"};function yg(e,n,o,a,l,i){return h(),D("div",pg,[s("div",{class:qe(["cascade-panel-container",[`expand-direction-${l.expandDirection}`]])},[(h(!0),D(ee,null,se(l.activePath,(r,u)=>(h(),D("div",{class:"cascade-panel-list",key:u},[s("div",fg,[(h(!0),D(ee,null,se(r.options,y=>(h(),D("div",{class:qe(["cascade-panel-item",{active:i.isActive(y,u)}]),key:y.value,onClick:p=>i.handleSelect(y,u,p)},[s("div",hg,[s("span",mg,_(y.label),1),i.hasChildren(y)?(h(),D("span",{key:0,class:"item-icon",onClick:n[0]||(n[0]=(...p)=>i.handleRightClick&&i.handleRightClick(...p))},[...n[1]||(n[1]=[s("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[s("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):Z("",!0)])],10,vg))),128)),r.options&&r.options.length===0?(h(),D("div",gg,_(a.t("msg_no_data")),1)):Z("",!0)])]))),128))],2)])}const il=_e(_g,[["render",yg],["__scopeId","data-v-3282a1f1"]]),rl=e=>{let n=[];return e.forEach(o=>{o.children&&o.children.length>0?n.push(...rl(o.children)):n.push(o)}),n},bg={name:"JMention",components:{CascadePanel:il},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(e){return["input","textarea"].includes(e)}},placeholder:{type:String,default:"ph_input"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1},bordered:{type:Boolean,default:!0}},setup(){const{t:e}=fe("views.workflow.components.at-input.at-input");return{t:e}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},computed:{computedPlaceholder(){return this.placeholder==="ph_input"?this.t("ph_input"):this.placeholder}},watch:{defaultValue(e){e.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(e){this.onOpen(e)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(e){e.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(e){e.target.closest(".dropdown-list")&&e.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(e){this.$emit("open",e)},getText(e){const n=document.createElement("div");n.innerHTML=e;let o="";return Array.from(n.childNodes).forEach(a=>{let l="";this.type==="textarea"?a.nodeName==="BR"?l=`
`:a.classList&&a.classList.contains("j-mention-at")?l=a.dataset.value:l=a.textContent:a.classList&&a.classList.contains("j-mention-at")?l=a.dataset.value:a.nodeName==="BR"?l="":l=a.textContent.replace(/\n/g,""),(l==="&nbsp;"||l===" ")&&(l=""),o+=l}),o},onChange(){const e=this.$refs.JMention;if(!e)return;let n=e.innerHTML,o=this.getText(n);this.localValue=o;let a={};this.selectedList.forEach(i=>{!a[i.value]&&o.indexOf(i.value)!==-1&&(a[i.value]=i)});let l=Object.values(a);this.$emit("change",o.trim(),l)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const e=this.$refs.JMention;let n=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=this.defaultSelectedList||[],a=rl(this.options),l=[...o,...a].filter(r=>r&&r.value&&r.value!=""&&r.typ!=="node");const i=new Set;l.forEach(r=>{const u=new RegExp(`(${r.value})`,"g");if(u.test(this.defaultValue)&&!i.has(r.value)){let y=r.node_name+"."+r.text;y=y.replace(/\./g,"/"),n=n.replace(u,`<span class="j-mention-at" data-id="${r.node_id}" contentEditable="false" data-value="${r.value}">${y}</span>`),i.add(r.value),this.selectOption(r,!0)}}),e.innerHTML=n,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(e=>this.atText?e.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(e.id+""))},getLastChar(e=1){const n=window.getSelection();if(n.rangeCount<=0)return;const o=n.getRangeAt(0),a=o.startOffset,l=o.startContainer;let i="";if(l.nodeType===Node.TEXT_NODE)i=l.textContent.slice(0,a);else if(l.nodeType===Node.ELEMENT_NODE){const r=l.childNodes;for(let u=0;u<r.length;u++){const y=r[u];y.nodeType===Node.TEXT_NODE&&(u===r.length-1?i+=y.textContent.slice(0,a):i+=y.textContent)}}return i.slice(-e)},getLastAtText(){const e=window.getSelection();if(e.rangeCount<=0)return;const n=e.getRangeAt(0),o=n.startOffset,a=n.startContainer;let l="";if(a.nodeType===Node.TEXT_NODE)l=a.textContent.slice(0,o);else if(a.nodeType===Node.ELEMENT_NODE){const r=a.childNodes;for(let u=0;u<r.length;u++){const y=r[u];y.nodeType===Node.TEXT_NODE&&(u===r.length-1?l+=y.textContent.slice(0,o):l+=y.textContent)}}const i=l.lastIndexOf("/");return i===-1?"":l.slice(i+1)},async getCaretPosition(){const e=window.getSelection();if(e.rangeCount<=0)return{top:0,left:0};const o=e.getRangeAt(0).getBoundingClientRect(),a=await this.getDropdownListSize(),l=window.innerWidth,i=window.innerHeight;let r=o.bottom,u=o.left;return r+a.height>i&&(r=o.top-a.height),u+a.width>l&&(u=o.right-a.width),r<0&&(r=0),u<0&&(u=0),{top:r,left:u}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const e=this.$refs.dropdownList.offsetWidth,n=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:e,height:n}},updateSelectedList(){const n=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const o of n){let a=o.dataset.value;const l=this.options.find(i=>i.value==a);this.selectedList.push(l),this.selectedIdSet.add(a)}this.$emit("update:selectedList",this.selectedList),!(n.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(e){return this.options.filter(o=>o.label.startsWith(e)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(e){this.handleDropdownLogic(e),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(e){const n=this.getLastChar();if(e.inputType==="deleteContentBackward"&&!this.atText)n!="/"&&(this.showDropdown=!1);else if(n==="/")this.showDropdown=!0,this.atText="";else{const l=this.getLastAtText();this.atText=l;const i=this.checkStartWith(l);l&&(this.showDropdown=i)}if(!this.showDropdown)return;const{top:o,left:a}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${a}px; top:${o}px;`},insertAtCaret(e,n){let o=this.atText.length+1;this.getLastChar(o)!=="/"+this.atText&&(o=0);const l=window.getSelection();if(l.rangeCount<=0)return;const i=l.getRangeAt(0),r=i.startOffset,u=i.startContainer;let y=r-o,p=u;if(y<0){let m=u.previousSibling;for(;m;){if(m.nodeType===Node.TEXT_NODE){y=m.textContent.length-o,p=m;break}m=m.previousSibling}}if(p.nodeType===Node.TEXT_NODE){p.replaceData(y,o,"");const m=document.createElement("span");m.contentEditable="false",m.classList.add("j-mention-at"),m.style=this.atTextStyle,m.textContent=`${e}`;for(const C in n)m.dataset[C]=n[C];const v=document.createRange();v.setStart(p,y),v.insertNode(m),i.setStartAfter(m),i.setEndAfter(m),l.removeAllRanges(),l.addRange(i)}},onSelectOption(e,n,o){let a=o[o.length-1];delete a.children,this.selectOption(a)},selectOption(e,n=!1){if(!e)return;this.showDropdown=!1;let o=e.node_name+"."+e.text;o=o.replace(/\./g,"/");const a={id:e.id,label:e.label,value:e.value,text:e.text,index:this.selectedList.length};this.selectedList.push(e),this.selectedIdSet.add(e.value),n||(this.insertAtCaret(o,a),this.initShowOptionList(),this.updateValue())},handleDirectionChange(e,n){const o=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),a=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!o||!a)return;const l=parseFloat(o[1]),i=parseFloat(a[1]);let r;e==="left"?r=l-n:r=l+n,this.positionStyle=`left:${r}px; top:${i}px;`}}},kg={style:{width:"100%",position:"relative"}},wg=["placeholder"],Cg={key:0,class:"placeholder"};function $g(e,n,o,a,l,i){const r=tt("CascadePanel");return h(),D("div",kg,[n[4]||(n[4]=s("div",null,null,-1)),(h(),G(Tl,{to:"body"},[l.showDropdown?(h(),D("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:jt(l.positionStyle)},[c(r,{options:l.showOptions,checkAnyLevel:o.checkAnyLevel,onChange:i.onSelectOption,onDirectionChange:i.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):Z("",!0)])),s("div",{class:qe(["mention-input-warpper",{"no-border":!o.bordered}]),ref:"JMentionContainer"},[s("div",{ref:"JMention",style:jt([o.inputStyle]),class:qe(["j-mention",[{"show-placeholder":l.localValue.length==0},"type-"+o.type]]),contenteditable:"plaintext-only",placeholder:i.computedPlaceholder,onFocus:n[0]||(n[0]=(...u)=>i.onFocus&&i.onFocus(...u)),onInput:n[1]||(n[1]=(...u)=>i.debouncedUpdate&&i.debouncedUpdate(...u)),onClick:n[2]||(n[2]=(...u)=>i.clickJMention&&i.clickJMention(...u)),onBlur:n[3]||(n[3]=(...u)=>i.handleBlur&&i.handleBlur(...u))},null,46,wg),l.localValue.length==0?(h(),D("span",Cg,_(i.computedPlaceholder),1)):Z("",!0)],2)])}const xe=_e(bg,[["render",$g],["__scopeId","data-v-249d57dd"]]),xg={class:"problem-optimization-form"},Sg={class:"gray-block"},Dg={class:"gray-block-title"},Ag={class:"flex-block-item"},Og={class:"number-box"},Ng={class:"number-slider-box"},Bg={class:"number-input-box"},Eg={class:"number-box"},Ig={class:"number-slider-box"},Fg={class:"number-input-box"},Rg={class:"number-box"},Lg={class:"number-box"},Vg={class:"number-slider-box"},Mg={class:"number-input-box"},Tg={class:"space-between-box"},jg={class:"field-list-item"},Pg={class:"field-label"},qg={class:"field-type"},Hg={class:"form-tip"},Ug={class:"diy-form-item"},Jg={class:"form-label"},zg={class:"form-content"},Kg={class:"gray-block mt16"},Gg={class:"gray-block-title"},Wg={class:"options-item"},Zg={class:"option-label"},Yg={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.problem-optimization-form"),a=n,l=e,i=Pt(),r=U(null),u=ye(()=>i.modelList),y=U([]),p=U([]),m=U(!1),v=()=>{m.value=!m.value},C=(M,j)=>{b.prompt=M,b.prompt_tags=j};function g(){const M=l.lf.getNodeModelById(l.nodeId);if(M){let j=M.getAllParentVariable();p.value=$(j)}}function $(M){return M.forEach(j=>{j.typ=="node"?j.node_type==1?j.value="global":j.value=j.node_id:j.value=j.key,j.children&&j.children.length>0&&(j.children=$(j.children))}),M}const w=()=>{const M=l.lf.getNodeModelById(l.nodeId);if(M){let j=M.getAllParentVariable();y.value=j}};function S(M){if(M){let j=M.split("."),V=j[0],z=j.filter((H,K)=>K>0).join(".");return[V,z]}return["global","question"]}const k=U(),b=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,role:1}),x=()=>{b.use_model&&b.use_model.toLowerCase().includes("deepseek-r1")?b.role=2:b.role=1},A=()=>{const M=l.node.dataRaw||l.node.node_params||"{}",j=JSON.stringify({question_optimize:JSON.parse(M).question_optimize||{}}),V=JSON.stringify({question_optimize:{...b,question_value:b.question_value.join("."),model_config_id:b.model_config_id?+b.model_config_id:b.model_config_id}});j!=V&&a("update-node",{...l.node,...b,node_params:V})},R=()=>{try{let M=l.node.dataRaw||l.node.node_params||"{}",j=JSON.parse(M).question_optimize||{};j=JSON.parse(JSON.stringify(j));let{model_config_id:V,use_model:z,context_pair:H,temperature:K,max_token:F,prompt:Y,prompt_tags:le,question_value:J,enable_thinking:P,role:W}=j;w(),g(),b.model_config_id=V,b.use_model=z,b.context_pair=H||0,b.temperature=K,b.max_token=F,b.prompt=Y,b.enable_thinking=P,b.prompt_tags=le||[],b.question_value=S(J),!b.model_config_id&&u.value.length>0&&(b.model_config_id=u.value[0].id,b.use_model=u.value[0].children[0].name),b.role=+W||1}catch(M){}};Ie(()=>b,()=>{A()},{deep:!0});const E=U(null),B=M=>{b.prompt="",M.prompt_type==1?b.prompt=M.markdown:b.prompt=M.prompt,Ze(()=>{r.value.initData()})},N=M=>{M||g()},I=U({}),L=(M,j)=>{I.value=j},q=ye(()=>{if(!b.model_config_id)return!1;let M=b.model_config_id+"#"+b.use_model;return I.value[M]}),O=()=>{a("close")};return Ne(()=>{R()}),(M,j)=>{const V=rt,z=Dt,H=ct,K=Qt,F=Yt,Y=ko,le=Tt,J=Vt,P=Ms,W=xs,Q=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_problem_optimization"),onClose:O},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",xg,[s("div",{class:"node-form-content",onMousedown:j[12]||(j[12]=He(()=>{},["stop"]))},[c(Q,{ref_key:"formRef",ref:k,layout:"vertical",model:b},{default:f(()=>[s("div",Sg,[s("div",Dg,_(d(o)("label_input")),1),c(z,{label:d(o)("label_llm_model"),name:"use_model"},{default:f(()=>[s("div",Ag,[c(Gs,{modelType:"LLM",modeName:b.use_model,"onUpdate:modeName":j[0]||(j[0]=X=>b.use_model=X),modeId:b.model_config_id,"onUpdate:modeId":j[1]||(j[1]=X=>b.model_config_id=X),onLoaded:L,onChange:x,style:{width:"348px"}},null,8,["modeName","modeId"]),c(V,{onClick:v},{default:f(()=>[T(_(d(o)("btn_advanced_settings"))+" ",1),m.value?(h(),G(d(ds),{key:0})):(h(),G(d(Mo),{key:1}))]),_:1})])]),_:1},8,["label"]),m.value?(h(),G(z,{key:0,name:"role"},{label:f(()=>[s("span",null,_(d(o)("label_prompt_role"))+" ",1),c(H,null,{title:f(()=>[s("div",null,[T(_(d(o)("tip_prompt_role_desc"))+" ",1),s("div",null,_(d(o)("label_system_role_example")),1),s("div",null,'{"role": "system", "content": "'+_(d(o)("sample_custom_prompt"))+'"}',1)])]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[c(F,{value:b.role,"onUpdate:value":j[2]||(j[2]=X=>b.role=X)},{default:f(()=>[c(K,{value:1},{default:f(()=>[T(_(d(o)("label_system_role")),1)]),_:1}),c(K,{value:2},{default:f(()=>[T(_(d(o)("label_user_role")),1)]),_:1})]),_:1},8,["value"])]),_:1})):Z("",!0),m.value?(h(),G(z,{key:1,name:"temperature"},{label:f(()=>[s("span",null,_(d(o)("label_temperature"))+" ",1),c(H,null,{title:f(()=>[T(_(d(o)("tip_temperature_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Og,[s("div",Ng,[c(le,null,{default:f(()=>[c(Y,{class:"custom-slider",value:b.temperature,"onUpdate:value":j[3]||(j[3]=X=>b.temperature=X),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),s("div",Bg,[c(J,{value:b.temperature,"onUpdate:value":j[4]||(j[4]=X=>b.temperature=X),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Z("",!0),m.value?(h(),G(z,{key:2,name:"max_token"},{label:f(()=>[s("span",null,_(d(o)("label_max_token"))+" ",1),c(H,null,{title:f(()=>[T(_(d(o)("tip_max_token_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Eg,[s("div",Ig,[c(le,null,{default:f(()=>[c(Y,{class:"custom-slider",value:b.max_token,"onUpdate:value":j[5]||(j[5]=X=>b.max_token=X),min:0,max:100*1024},null,8,["value"])]),_:1})]),s("div",Fg,[c(J,{value:b.max_token,"onUpdate:value":j[6]||(j[6]=X=>b.max_token=X),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Z("",!0),m.value&&q.value?(h(),G(z,{key:3,name:"enable_thinking"},{label:f(()=>[s("span",null,_(d(o)("label_deep_thinking"))+" ",1),c(H,null,{title:f(()=>[T(_(d(o)("tip_deep_thinking_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Rg,[c(P,{checked:b.enable_thinking,"onUpdate:checked":j[7]||(j[7]=X=>b.enable_thinking=X)},null,8,["checked"])])]),_:1})):Z("",!0),c(z,{name:"context_pair"},{label:f(()=>[s("span",null,_(d(o)("label_context_pair"))+" ",1),c(H,null,{title:f(()=>[T(_(d(o)("tip_context_pair_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Lg,[s("div",Vg,[c(le,null,{default:f(()=>[c(Y,{class:"custom-slider",value:b.context_pair,"onUpdate:value":j[8]||(j[8]=X=>b.context_pair=X),min:0,max:50},null,8,["value"])]),_:1})]),s("div",Mg,[c(J,{value:b.context_pair,"onUpdate:value":j[9]||(j[9]=X=>b.context_pair=X),min:0,max:50},null,8,["value"])])])]),_:1}),c(z,{name:"prompt",class:"width-100"},{label:f(()=>[s("div",Tg,[s("div",null,_(d(o)("label_dialogue_background")),1)])]),default:f(()=>[c(xe,{type:"textarea",inputStyle:"height: 100px;",options:y.value,defaultSelectedList:b.prompt_tags,defaultValue:b.prompt,ref_key:"atInputRef",ref:r,onOpen:w,onChange:j[10]||(j[10]=(X,de)=>C(X,de)),placeholder:d(o)("ph_input_dialogue_background")},{option:f(({label:X,payload:de})=>[s("div",jg,[s("div",Pg,_(X),1),s("div",qg,_(de.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",Hg,_(d(o)("msg_input_insert_variable")),1)]),_:1}),s("div",Ug,[s("div",Jg,_(d(o)("label_user_question")),1),s("div",zg,[c(W,{value:b.question_value,"onUpdate:value":j[11]||(j[11]=X=>b.question_value=X),onDropdownVisibleChange:N,style:{width:"220px"},options:p.value,allowClear:!1,displayRender:({labels:X})=>X.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","options","displayRender","placeholder"])])])]),s("div",Kg,[s("div",Gg,_(d(o)("label_output")),1),s("div",Wg,[s("div",Zg,_(d(o)("label_question_optimization_result")),1),j[13]||(j[13]=s("div",{class:"option-type"},"string",-1))])])]),_:1},8,["model"]),c(Ka,{onOk:B,ref_key:"importPromptRef",ref:E},null,512)],32)])]),_:1})}}},Qg=_e(Yg,[["__scopeId","data-v-9303bf50"]]),Xg={class:"input-box"},e1={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"ph_input_message_with_variable"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.at-input.full-at-input"),l=U(!1),i=o;Ie(()=>l.value,g=>{g||i("ok")});const r=e,u=ye(()=>r.placeholder==="ph_input_message_with_variable"?a("ph_input_message_with_variable"):r.placeholder),y=U(null),p=()=>{l.value=!0,Ze(()=>{y.value.refresh()})},m=g=>{i("open",g)},v=(g,$)=>{i("change",g,$)},C=()=>{l.value=!1};return n({show:p}),(g,$)=>{const w=rt,S=wt;return h(),D("div",null,[c(S,{open:l.value,"onUpdate:open":$[1]||($[1]=k=>l.value=k),title:d(a)("title_field_detail"),width:746},{footer:f(()=>[c(w,{type:"primary",onClick:C},{default:f(()=>[T(_(d(a)("btn_confirm")),1)]),_:1})]),default:f(()=>[s("div",Xg,[c(xe,{inputStyle:"height: 550px;",options:r.options,defaultSelectedList:r.defaultSelectedList,defaultValue:r.defaultValue,placeholder:u.value,type:r.type,ref_key:"atInputRef",ref:y,onOpen:m,onChange:$[0]||($[0]=(k,b)=>v(k,b))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open","title"])])}}},js=_e(e1,[["__scopeId","data-v-cea0cf71"]]),t1={class:"problem-optimization-form"},s1={class:"gray-block"},o1={class:"gray-block-title"},n1={class:"flex-block-item"},a1={class:"number-box"},l1={class:"number-slider-box"},i1={class:"number-input-box"},r1={class:"number-box"},d1={class:"number-slider-box"},u1={class:"number-input-box"},c1={class:"number-box"},_1={class:"number-box"},p1={class:"number-slider-box"},f1={class:"number-input-box"},v1={class:"space-between-box"},h1={class:"field-list-item"},m1={class:"field-label"},g1={class:"field-type"},y1={class:"form-tip"},b1={class:"diy-form-item mt12"},k1={class:"form-label"},w1={class:"form-content"},C1={class:"gray-block mt16"},$1={class:"gray-block-title"},x1={class:"diy-form-item question-value-item"},S1={class:"form-label"},D1={class:"form-content"},A1={class:"gray-block mt16"},O1={class:"gray-block-title"},N1={class:"options-item"},B1={class:"option-label"},E1={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.ai-dialogue-node-from"),a=n,l=e,i=be("getNode"),r=Pt(),u=U(null),y=ye(()=>r.modelList),p=U([]),m=U([]),v=U(!1),C=U(),g=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0,role:1}),$=()=>{g.use_model&&g.use_model.toLowerCase().includes("deepseek-r1")?g.role=2:g.role=1},w=()=>{v.value=!v.value},S=(F,Y)=>{g.prompt=F,g.prompt_tags=Y};function k(){let F=i().getAllParentVariable();m.value=x(F)}const b=ye(()=>m.value.filter(Y=>Y.node_type==5));function x(F){return F.forEach(Y=>{Y.typ=="node"?Y.node_type==1?Y.value="global":Y.value=Y.node_id:Y.value=Y.key,Y.children&&Y.children.length>0&&(Y.children=x(Y.children))}),F}const A=()=>{let F=i().getAllParentVariable();p.value=F};function R(F){if(F){let Y=F.split("."),le=Y[0],J=Y.filter((P,W)=>W>0).join(".");return[le,J]}return["global","question"]}const E=U(null),B=()=>{E.value.show()},N=F=>{g.prompt="",F.prompt_type==1?g.prompt=F.markdown:g.prompt=F.prompt,Ze(()=>{u.value.initData()})},I=U(null),L=()=>{I.value.show()},q=()=>{u.value.refresh()},O=()=>{const F=JSON.stringify({llm:{...g,question_value:g.question_value.join("."),model_config_id:g.model_config_id?+g.model_config_id:g.model_config_id}});a("update-node",{...l.node,...g,node_params:F})},M=()=>{try{let F=l.node.dataRaw||l.node.node_params||"{}",Y=JSON.parse(F).llm||{};Y=JSON.parse(JSON.stringify(Y));let{model_config_id:le,use_model:J,context_pair:P,temperature:W,max_token:Q,prompt:X,prompt_tags:de,question_value:Fe,enable_thinking:De,libs_node_key:$e,role:Ue}=Y;A(),k(),g.model_config_id=le,g.use_model=J,g.context_pair=P||0,g.temperature=W,g.max_token=Q,g.prompt=X,g.enable_thinking=De,g.prompt_tags=de||[],g.libs_node_key=$e,g.question_value=R(Fe),!g.model_config_id&&y.value.length>0&&(g.model_config_id=y.value[0].id,g.use_model=y.value[0].children[0].name),g.role=+Ue||1}catch(F){}};Ie(()=>g,()=>{O()},{deep:!0});const j=F=>{F||k()},V=U({}),z=(F,Y)=>{V.value=Y},H=ye(()=>{if(!g.model_config_id)return!1;let F=g.model_config_id+"#"+g.use_model;return V.value[F]}),K=()=>{a("close")};return Ne(()=>{M()}),(F,Y)=>{const le=rt,J=Dt,P=ct,W=Qt,Q=Yt,X=ko,de=Tt,Fe=Vt,De=Ms,$e=_s,Ue=et,ie=Ye,ge=xs,ve=St,he=Ka;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_call_llm_generate_reply"),onClose:K},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",t1,[s("div",{class:"node-form-content",onMousedown:Y[13]||(Y[13]=He(()=>{},["stop"]))},[c(ve,{ref_key:"formRef",ref:C,layout:"vertical",model:g},{default:f(()=>[s("div",s1,[s("div",o1,_(d(o)("title_llm_settings")),1),c(J,{label:d(o)("label_llm_model"),name:"use_model"},{default:f(()=>[s("div",n1,[c(Gs,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":Y[0]||(Y[0]=Ae=>g.use_model=Ae),modeId:g.model_config_id,"onUpdate:modeId":Y[1]||(Y[1]=Ae=>g.model_config_id=Ae),onLoaded:z,onChange:$,style:{width:"348px"}},null,8,["modeName","modeId"]),c(le,{onClick:w},{default:f(()=>[T(_(d(o)("btn_advanced_settings"))+" ",1),v.value?(h(),G(d(ds),{key:0})):(h(),G(d(Mo),{key:1}))]),_:1})])]),_:1},8,["label"]),v.value?(h(),G(J,{key:0,name:"role"},{label:f(()=>[s("span",null,_(d(o)("label_prompt_role"))+" ",1),c(P,null,{title:f(()=>[s("div",null,[T(_(d(o)("tip_prompt_role_desc"))+" ",1),s("div",null,_(d(o)("label_system_role_example")),1),s("div",null,'{"role": "system", "content": "'+_(d(o)("sample_custom_prompt"))+'"}',1)])]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[c(Q,{value:g.role,"onUpdate:value":Y[2]||(Y[2]=Ae=>g.role=Ae)},{default:f(()=>[c(W,{value:1},{default:f(()=>[T(_(d(o)("label_system_role")),1)]),_:1}),c(W,{value:2},{default:f(()=>[T(_(d(o)("label_user_role")),1)]),_:1})]),_:1},8,["value"])]),_:1})):Z("",!0),v.value?(h(),G(J,{key:1,name:"temperature"},{label:f(()=>[s("span",null,_(d(o)("label_temperature"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_temperature_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",a1,[s("div",l1,[c(de,null,{default:f(()=>[c(X,{class:"custom-slider",value:g.temperature,"onUpdate:value":Y[3]||(Y[3]=Ae=>g.temperature=Ae),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),s("div",i1,[c(Fe,{value:g.temperature,"onUpdate:value":Y[4]||(Y[4]=Ae=>g.temperature=Ae),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Z("",!0),v.value?(h(),G(J,{key:2,name:"max_token"},{label:f(()=>[s("span",null,_(d(o)("label_max_token"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_max_token_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",r1,[s("div",d1,[c(de,null,{default:f(()=>[c(X,{class:"custom-slider",value:g.max_token,"onUpdate:value":Y[5]||(Y[5]=Ae=>g.max_token=Ae),min:0,max:100*1024},null,8,["value"])]),_:1})]),s("div",u1,[c(Fe,{value:g.max_token,"onUpdate:value":Y[6]||(Y[6]=Ae=>g.max_token=Ae),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Z("",!0),v.value&&H.value?(h(),G(J,{key:3,name:"enable_thinking"},{label:f(()=>[s("span",null,_(d(o)("label_deep_thinking"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_deep_thinking_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",c1,[c(De,{checked:g.enable_thinking,"onUpdate:checked":Y[7]||(Y[7]=Ae=>g.enable_thinking=Ae)},null,8,["checked"])])]),_:1})):Z("",!0),c(J,{name:"context_pair"},{label:f(()=>[s("span",null,_(d(o)("label_context_pair"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_context_pair_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",_1,[s("div",p1,[c(de,null,{default:f(()=>[c(X,{class:"custom-slider",value:g.context_pair,"onUpdate:value":Y[8]||(Y[8]=Ae=>g.context_pair=Ae),min:0,max:50},null,8,["value"])]),_:1})]),s("div",f1,[c(Fe,{value:g.context_pair,"onUpdate:value":Y[9]||(Y[9]=Ae=>g.context_pair=Ae),min:0,max:50},null,8,["value"])])])]),_:1}),c(J,{name:"prompt",class:"width-100"},{label:f(()=>[s("div",v1,[s("div",null,_(d(o)("label_prompt")),1),c($e,{gap:8},{default:f(()=>[s("div",{class:"btn-hover-wrap",onClick:B},[c(d(di)),T(_(d(o)("btn_import_from_prompt_library")),1)]),s("div",{class:"btn-hover-wrap",onClick:L},[c(d(Wt))])]),_:1})])]),default:f(()=>[c(xe,{type:"textarea",inputStyle:"height: 100px;",options:p.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,ref_key:"atInputRef",ref:u,onOpen:A,onChange:Y[10]||(Y[10]=(Ae,oe)=>S(Ae,oe)),placeholder:d(o)("ph_input_message_content")},{option:f(({label:Ae,payload:oe})=>[s("div",h1,[s("div",m1,_(Ae),1),s("div",g1,_(oe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",y1,_(d(o)("msg_input_insert_variable")),1)]),_:1}),s("div",b1,[s("div",k1,_(d(o)("label_knowledge_base_reference")),1),s("div",w1,[c(ie,{placeholder:d(o)("ph_select"),allowClear:"",onDropdownVisibleChange:j,value:g.libs_node_key,"onUpdate:value":Y[11]||(Y[11]=Ae=>g.libs_node_key=Ae),style:{width:"220px"}},{default:f(()=>[(h(!0),D(ee,null,se(b.value,Ae=>(h(),G(Ue,{value:Ae.node_id,key:Ae.node_id},{default:f(()=>[T(_(Ae.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value"])])])]),s("div",C1,[s("div",$1,_(d(o)("label_input")),1),s("div",x1,[s("div",S1,_(d(o)("label_input")),1),s("div",D1,[c(ge,{value:g.question_value,"onUpdate:value":Y[12]||(Y[12]=Ae=>g.question_value=Ae),onDropdownVisibleChange:j,style:{width:"220px"},options:m.value,allowClear:!1,displayRender:({labels:Ae})=>Ae.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","options","displayRender","placeholder"])])])]),s("div",A1,[s("div",O1,_(d(o)("label_output")),1),s("div",N1,[s("div",B1,_(d(o)("label_ai_reply_content")),1),Y[15]||(Y[15]=s("div",{class:"option-type"},"string",-1))])])]),_:1},8,["model"])],32),c(he,{onOk:N,ref_key:"importPromptRef",ref:E},null,512),c(js,{options:p.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,placeholder:d(o)("ph_input_message_content"),type:"textarea",onOpen:A,onChange:Y[14]||(Y[14]=(Ae,oe)=>S(Ae,oe)),onOk:q,ref_key:"fullAtInputRef",ref:I},null,8,["options","defaultSelectedList","defaultValue","placeholder"])])]),_:1})}}},I1=_e(E1,[["__scopeId","data-v-e0e92701"]]),Jt="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Ws=Ta("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(e=>{this.formListQueue.push(e)});this.formListLoading=!0;try{const e=await _f();this.formList=e.data||[];const n=[...this.formList];return this.formListQueue.forEach(o=>o(n)),this.formListQueue=[],n}catch(e){this.formList=[];const n=[...this.formList];return this.formListQueue.forEach(o=>o(n)),this.formListQueue=[],n}finally{this.formListLoading=!1}},async getFormFieldList({form_id:e}){if(this.formFieldListMap[e]&&this.formFieldListMap[e].length>0)return[...this.formFieldListMap[e]];if(this.formFieldListLoadingMap[e])return new Promise(n=>{this.formFieldListQueueMap[e]||(this.formFieldListQueueMap[e]=[]),this.formFieldListQueueMap[e].push(n)});this.formFieldListLoadingMap[e]=!0;try{const n=await cf({form_id:e});this.formFieldListMap[e]=n.data||[];const o=[...this.formFieldListMap[e]];return this.formFieldListQueueMap[e]&&(this.formFieldListQueueMap[e].forEach(a=>a(o)),this.formFieldListQueueMap[e]=[]),o}catch(n){this.formFieldListMap[e]=[];const o=[...this.formFieldListMap[e]];return this.formFieldListQueueMap[e]&&(this.formFieldListQueueMap[e].forEach(a=>a(o)),this.formFieldListQueueMap[e]=[]),o}finally{this.formFieldListLoadingMap[e]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:e}){return this.formFieldListMap[e]=[],this.formFieldListLoadingMap[e]=!1,this.formFieldListQueueMap[e]=[],await this.getFormFieldList({form_id:e})}}}),F1={class:"field-select-box"},R1={key:0,class:"field-list-box"},L1={key:1,class:"empty-box"},V1={__name:"field-select-alert",emits:["ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.data-table.field-selector.field-select-alert"),l=o,i=Ws(),r=we({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),u=U([{title:a("label_field_name"),dataIndex:"name",key:"name"},{title:a("label_data_type"),dataIndex:"type",key:"type"},{title:a("label_field_desc"),dataIndex:"description",key:"description"}]),y=U([]),p=(w,S)=>{r.selectedRowKeys=w,r.selectedRows=S},m=({formId:w,selectedRowKeys:S,selectedRows:k})=>{r.formId=w,r.selectedRowKeys=S,r.selectedRows=k,$(),r.show=!0},v=()=>{window.open("/#/database/details/field-manage?form_id="+r.formId)},C=()=>{l("ok",r.selectedRowKeys,r.selectedRows),r.show=!1},g=U(!1),$=()=>{g.value=!0,i.getFormFieldList({form_id:r.formId}).then(w=>{g.value=!1,w.forEach(S=>{S.value="",S.id=S.id*1}),y.value=w}).catch(()=>{g.value=!1})};return n({open:m}),(w,S)=>{const k=ro,b=wt;return h(),G(b,{width:"746px",open:r.show,"onUpdate:open":S[0]||(S[0]=x=>r.show=x),title:d(a)("title_relate_data_table"),onOk:C,"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel")},{default:f(()=>[s("div",F1,[y.value.length?(h(),D("div",R1,[c(k,{rowKey:"name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:p},dataSource:y.value,columns:u.value,loading:g.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):Z("",!0),y.value.length?Z("",!0):(h(),D("div",L1,[S[1]||(S[1]=s("img",{src:To,alt:""},null,-1)),s("div",null,[T(_(d(a)("msg_no_fields_add"))+" ",1),s("a",{onClick:v},_(d(a)("btn_go_add")),1)])]))])]),_:1},8,["open","title","ok-text","cancel-text"])}}},M1=_e(V1,[["__scopeId","data-v-555f3710"]]),T1={class:"field-list"},j1={class:"field-list-row"},P1={class:"field-list-col field-list-col-head field-name-head"},q1={class:"field-list-col field-list-col-head field-type-head"},H1={key:0,class:"field-list-col field-list-col-head field-value-head"},U1={key:1,class:"field-list-col field-list-col-head field-del-head"},J1={key:0,class:"field-list-row"},z1={class:"field-list-col field-value-col"},K1={class:"field-list-col field-name-col"},G1={class:"field-list-col field-type-col"},W1={key:0,class:"field-list-col field-value-col"},Z1={key:1,class:"field-list-col field-del-col"},Y1=["onClick"],Q1={key:0,class:"add-btn-box"},X1={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.data-table.field-selector.index"),a=n,l=e,i=be("getNode"),r=we({list:l.list});Ie(()=>l.list,S=>{r.list=S});const u=U([]),y=()=>{let S=i().getAllParentVariable();u.value=S||[]},p=()=>{y()},m=(S,k,b,x)=>{r.list[x].value=S,r.list[x].atTags=k,g()},v=(S,k)=>{r.list=[...k],g()},C=S=>{r.list.splice(S,1),g()},g=()=>{a("change",[...r.list])},$=U(),w=()=>{$.value.open({formId:l.formId,selectedRows:l.list,selectedRowKeys:l.list.map(S=>S.name)})};return Ne(()=>{y()}),(S,k)=>{const b=pt,x=ct,A=It,R=rt;return h(),D("div",null,[s("div",T1,[s("div",j1,[s("div",P1,_(d(o)("label_field_name")),1),s("div",q1,_(d(o)("label_type")),1),e.showInput?(h(),D("div",H1,_(d(o)("label_field_value")),1)):Z("",!0),l.showDelete?(h(),D("div",U1)):Z("",!0)]),e.showEmptyFieldRow?(h(),D("div",J1,[k[0]||(k[0]=s("div",{class:"field-list-col field-name-col"},"--",-1)),k[1]||(k[1]=s("div",{class:"field-list-col field-type-col"},"--",-1)),s("div",z1,[c(x,{title:d(o)("ph_select_database_first")},{default:f(()=>[c(b,{disabled:!0,placeholder:d(o)("ph_input_value_variable")},null,8,["placeholder"])]),_:1},8,["title"])])])):Z("",!0),(h(!0),D(ee,null,se(r.list,(E,B)=>(h(),D("div",{class:"field-list-row",key:E.name},[s("div",K1,_(E.name),1),s("div",G1,_(E.type),1),e.showInput?(h(),D("div",W1,[c(xe,{options:u.value,defaultValue:E.value,defaultSelectedList:E.atTags,onOpen:p,onChange:(N,I)=>m(N,I,E,B),placeholder:d(o)("ph_input_value_variable")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])])):Z("",!0),l.showDelete?(h(),D("div",Z1,[s("span",{class:"del-btn",onClick:N=>C(B)},[c(A,{class:"del-icon",name:"close-circle"})],8,Y1)])):Z("",!0)]))),128))]),l.showAdd?(h(),D("div",Q1,[c(R,{class:"add-btn",type:"dashed",block:"",onClick:w},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_update_field")),1)]),_:1})])):Z("",!0),c(M1,{formId:e.formId,ref_key:"fieldSelectAlertRef",ref:$,onOk:v},null,8,["formId"])])}}},On=_e(X1,[["__scopeId","data-v-461384bf"]]),ey={class:"library-checkbox-box"},ty={class:"list-box",ref:"scrollContainer"},sy={class:"library-name"},oy={class:"library-desc"},ny={key:1,class:"empty-box"},ay={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.data-table.database-selector.table-select-alert"),l=o,i=e,r=U(),u=U(!1),y=C=>{r.value=C,u.value=!0},p=()=>{u.value=!1,m()},m=()=>{let C=i.options.filter(g=>g.id===r.value);l("ok",r.value,JSON.parse(JSON.stringify(C[0])))},v=()=>{window.open("/#/database/list")};return n({open:y}),(C,g)=>{const $=Qt,w=Yt,S=wt;return h(),G(S,{width:"746px",open:u.value,"onUpdate:open":g[1]||(g[1]=k=>u.value=k),title:d(a)("title_relate_data_table"),"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel"),onOk:p},{default:f(()=>[s("div",ey,[e.options.length?(h(),G(w,{key:0,value:r.value,"onUpdate:value":g[0]||(g[0]=k=>r.value=k),style:{width:"100%"}},{default:f(()=>[s("div",ty,[(h(!0),D(ee,null,se(i.options,k=>(h(),D("div",{class:"list-item-wraapper",key:k.id},[c($,{class:"list-item",value:k.id},{default:f(()=>[s("div",sy,_(k.name),1),s("div",oy,_(k.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):Z("",!0),e.options.length?Z("",!0):(h(),D("div",ny,[g[2]||(g[2]=s("img",{src:To,alt:""},null,-1)),s("div",null,[T(_(d(a)("msg_no_data_table"))+" ",1),s("a",{onClick:v},_(d(a)("btn_go_add")),1)])]))])]),_:1},8,["open","title","ok-text","cancel-text"])}}},ly=_e(ay,[["__scopeId","data-v-67c153ad"]]),iy={class:""},ry={key:0,class:"data-table-info"},dy={class:"data-table-name"},uy={class:"data-table-desc"},cy={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.data-table.database-selector.index"),a=n,l=e,i=U(null),r=ye(()=>{let m=l.options.filter(v=>v.id===l.value);return m.length?m[0]:null}),u=()=>{i.value.open()},y=(m,v)=>{a("update:value",m),a("change",m,v)},p=()=>{a("update:value",""),a("change","")};return(m,v)=>{const C=It,g=rt;return h(),D("div",iy,[l.value?(h(),D("div",ry,[s("div",dy,_(r.value?r.value.name:l.title),1),s("div",uy,_(r.value?r.value.description:l.description),1),c(C,{class:"del-btn",name:"close-circle",onClick:p})])):(h(),G(g,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:u},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_select_data_table")),1)]),_:1})),c(ly,{ref_key:"tableSelectAlertRef",ref:i,onOk:y,options:e.options},null,8,["options"])])}}},Xo=_e(cy,[["__scopeId","data-v-dd823160"]]),_y={target:"_blank",href:"/#/database/list"},py={class:"add-data-form"},fy={class:"node-box-content"},vy={class:"node-box-title"},hy={class:"text"},my={class:"setting-label"},gy={class:"setting-box"},yy={class:"setting-label"},by={class:"tip"},ky={class:"setting-box"},wy={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.add-data-form"),a=n,l=e,i=Ws();let r={};const u=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),y=($,w)=>{w?(u.formData.form_name=w.name,u.formData.form_description=w.description,g(w.id)):(u.formData.form_name="",u.formData.form_description="",u.formData.datas=[]),v()},p=$=>{u.formData.datas=$,v()},m=()=>{let $=l.node.dataRaw||l.node.node_params||"{}";r=JSON.parse($),u.formData=r.form_insert,v()},v=()=>{r.form_insert=Ht(u.formData),a("update-node",{...l.node,node_params:JSON.stringify(r)})},C=async()=>{const $=await i.getFormList();u.tableList=$},g=async $=>{i.getFormFieldList({form_id:$}).then(w=>{w.forEach(S=>{S.id=S.id*1}),u.formData.datas=w,v()}).catch(()=>{})};return Ne(()=>{C(),m()}),($,w)=>(h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name},{desc:f(()=>[s("span",null,[T(_(d(o)("title_desc_insert_data"))+" ",1),s("a",_y,_(d(o)("btn_go_manage")),1)])]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",py,[s("div",fy,[s("div",vy,[w[1]||(w[1]=s("img",{class:"input-icon",src:Jt,alt:""},null,-1)),s("span",hy,_(d(o)("label_input")),1)]),s("div",my,[s("span",null,_(d(o)("label_data_table")),1)]),s("div",gy,[c(Xo,{options:u.tableList,title:u.formData.form_name,description:u.formData.form_description,value:u.formData.form_id,"onUpdate:value":w[0]||(w[0]=S=>u.formData.form_id=S),onChange:y},null,8,["options","title","description","value"])]),s("div",yy,[s("span",null,_(d(o)("label_insert_data")),1),s("span",by,_(d(o)("tip_empty_field")),1)]),s("div",ky,[c(On,{"form-id":u.formData.form_id,showEmptyFieldRow:u.formData.form_id=="",list:u.formData.datas,showAdd:!1,showDelete:!1,onChange:p},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},Cy=_e(wy,[["__scopeId","data-v-be7affa5"]]),$y={class:"library-checkbox-box"},xy={class:"list-group-box"},Sy={class:"group-list-box"},Dy={class:"main-title-block"},Ay={style:{"margin-bottom":"16px"}},Oy={class:"classify-box"},Ny=["onClick"],By={class:"classify-title"},Ey={class:"right-content"},Iy={class:"list-item-box"},Fy={class:"alert-box"},Ry={class:"btn-box"},Ly=["onClick"],Vy={class:"avatar-box"},My=["src"],Ty={class:"info-content-box"},jy={class:"title-info-block"},Py={key:0,class:"type-tag"},qy={key:1,class:"type-tag"},Hy={key:2,class:"type-tag"},Uy={key:3,class:"type-tag"},Jy={class:"desc-info-block"},zy={class:"check-block"},Ky={class:"footer-box"},Gy={__name:"library-select-alert",props:{showWxType:{type:Boolean,default:!1},select_type:{type:String,default:"checkbox"}},emits:["change"],setup(e,{expose:n,emit:o}){const a=Pt(),{robotInfo:l}=a,{t:i}=fe("views.workflow.components.node-form-drawer.components.library-select-alert"),r=o,u=e,y=we({indeterminate:!1,checkAll:!1,checkedList:[]}),p=U(""),m=U([]),v=()=>{ql().then(L=>{let q=L.data||[],O=0;q.forEach(M=>{O+=+M.total}),m.value=[{group_name:i("label_all"),total:O,id:""},...q]})},C=L=>{p.value=L.id,R()},g=U(!1),$=L=>{p.value="",R(),v(),y.checkedList=L,g.value=!0},w=()=>{g.value=!1,A()},S=U(""),k=()=>{R()},b=U([]),x=ye(()=>u.showWxType?b.value:b.value.filter(L=>L.type!=3)),A=()=>{r("change",[...y.checkedList])},R=async()=>{B.value=!0;const L=await Vo({library_name:S.value,type:"",show_open_docs:1});if(B.value=!1,L){let q=L.data||[];p.value!=""&&(q=q.filter(O=>O.group_id==p.value)),b.value=q}},E=L=>{let q=L.id;y.checkedList.includes(q)?y.checkedList=y.checkedList.filter(O=>O!=q):u.select_type=="radio"&&y.checkedList.length>0?y.checkedList=[q]:y.checkedList.push(q)},B=U(!1),N=async()=>{B.value=!0,await R(),B.value=!1,Me.success(i("msg_refresh_success"))},I=()=>{window.open("/#/library/list")};return n({open:$}),(L,q)=>{const O=pt,M=pf,j=Ks,V=rt,z=Za,H=os,K=wt;return h(),G(K,{width:916,open:g.value,"onUpdate:open":q[2]||(q[2]=F=>g.value=F),wrapClassName:"correlation-library-modal",title:null,footer:null},{default:f(()=>[s("div",$y,[s("div",xy,[s("div",Sy,[s("div",Dy,_(d(i)("title_linked_library")),1),s("div",Ay,[c(O,{style:{width:"216px"},value:S.value,"onUpdate:value":q[0]||(q[0]=F=>S.value=F),placeholder:d(i)("ph_search_library"),onChange:k},{suffix:f(()=>[c(d(Wa),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value","placeholder"])]),c(M,{style:{"padding-right":"16px",height:"480px"}},{default:f(()=>[s("div",Oy,[(h(!0),D(ee,null,se(m.value,F=>(h(),D("div",{class:qe(["classify-item",{active:F.id==p.value}]),onClick:Y=>C(F),key:F.id},[s("div",By,_(F.group_name),1),s("div",Ey,[s("div",{class:qe(["num",{"num-block":F.id<=0}])},_(F.total),3)])],10,Ny))),128))])]),_:1})]),s("div",Iy,[s("div",Fy,[c(j,{class:"zm-alert-info",message:d(i)("msg_linked_library_tip"),type:"info"},null,8,["message"])]),s("div",Ry,[c(V,{onClick:N},{default:f(()=>[c(d(ui)),T(" "+_(d(i)("btn_refresh")),1)]),_:1}),c(V,{type:"primary",ghost:"",onClick:I},{default:f(()=>[T(_(d(i)("btn_create_library")),1)]),_:1})]),c(H,{spinning:B.value,delay:100},{default:f(()=>[c(M,{style:{padding:"0 16px",height:"414px"}},{default:f(()=>[(h(!0),D(ee,null,se(x.value,F=>(h(),D("div",{class:"library-list-item",onClick:Y=>E(F),key:F.id},[s("div",Vy,[s("img",{src:F.avatar,alt:""},null,8,My)]),s("div",Ty,[s("div",jy,[T(_(F.library_name)+" ",1),s("span",{class:qe(["type-tag",{"gray-tag":F.graph_switch==0}])},"Graph",2),F.type==0?(h(),D("span",Py,_(d(i)("label_normal_library")),1)):Z("",!0),F.type==1?(h(),D("span",qy,_(d(i)("label_external_library")),1)):Z("",!0),F.type==2?(h(),D("span",Hy,_(d(i)("label_qa_library")),1)):Z("",!0),F.type==3?(h(),D("span",Uy,_(d(i)("label_mp_library")),1)):Z("",!0)]),s("div",Jy,_(F.library_intro),1)]),s("div",zy,[c(z,{checked:y.checkedList.includes(F.id)},null,8,["checked"])])],8,Ly))),128))]),_:1})]),_:1},8,["spinning"]),s("div",Ky,[c(V,{onClick:q[1]||(q[1]=F=>g.value=!1)},{default:f(()=>[T(_(d(i)("btn_cancel")),1)]),_:1}),c(V,{type:"primary",onClick:w},{default:f(()=>[T(" ("+_(y.checkedList.length)+") "+_(d(i)("btn_confirm")),1)]),_:1})])])])])]),_:1},8,["open"])}}},dl=_e(Gy,[["__scopeId","data-v-4f11be78"]]),Wy={class:"recall-settings-box"},Zy={class:"form-box"},Yy={class:"form-item is-required"},Qy={class:"form-item-label"},Xy={class:"form-item-body"},e0={class:"retrieval-mode-items"},t0=["onClick"],s0={class:"retrieval-mode-title"},o0={class:"title-text"},n0={class:"retrieval-mode-desc"},a0={key:0,class:"form-item"},l0={class:"form-item"},i0={class:"form-item-label"},r0={class:"form-item-body"},d0={class:"number-box"},u0={class:"number-slider-box"},c0={class:"number-input-box"},_0={class:"form-item"},p0={class:"form-item-label"},f0={class:"form-item-body"},v0={class:"number-box"},h0={class:"number-slider-box"},m0={class:"number-input-box"},g0={class:"form-item"},y0={class:"form-item-label"},b0={class:"setting-title"},k0={style:{"font-size":"13px"}},w0={class:"form-item-body"},C0={class:"segment-controls"},$0={class:"segment-input"},x0={class:"segment-input"},S0={class:"segment-text"},D0={class:"form-item"},A0={class:"form-item-label"},O0={class:"form-item-body"},N0={class:"form-item"},B0={class:"form-item-label"},E0={key:0,class:"form-item-body"},I0={__name:"recall-settings-alert",emits:["change"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.nodes.knowledge-base-node.recall-settings-alert"),l=o,i=ye(()=>[{iconName:"search",title:a("title_hybrid_search"),value:1,isRecommendation:!0,desc:a("msg_hybrid_search_desc")},{iconName:"file-search",title:a("title_vector_search"),value:2,desc:a("msg_vector_search_desc")},{iconName:"comment-search",title:a("title_full_text_search"),value:3,desc:a("msg_full_text_search_desc")}]),r=we({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),u=U(!1),y=U([]);U([]),U({});const p=$=>{r.rerank_status=$.rerank_status||0,r.rerank_use_model=$.rerank_use_model||void 0,r.rerank_model_config_id=$.rerank_model_config_id||"",r.top_k=$.top_k,r.similarity=$.similarity,r.search_type=$.search_type,r.meta_search_switch=Number($.meta_search_switch),r.meta_search_type=Number($.meta_search_type),r.meta_search_condition_list=$.meta_search_condition_list,r.rrf_weight=$.rrf_weight,r.recall_neighbor_switch=$.recall_neighbor_switch,r.recall_neighbor_before_num=$.recall_neighbor_before_num,r.recall_neighbor_after_num=$.recall_neighbor_after_num,u.value=!0},m=$=>{r.search_type=$},v=()=>r.rerank_status==1&&!r.rerank_model_config_id,C=()=>{if(v())return Me.error(a("msg_select_rerank_model"));u.value=!1,g()},g=()=>{l("change",Ht(r))};return n({open:p}),($,w)=>{const S=It,k=ct,b=ko,x=Vt,A=Ms,R=et,E=Ye,B=wt;return h(),G(B,{width:"600px",open:u.value,"onUpdate:open":w[14]||(w[14]=N=>u.value=N),title:d(a)("title_recall_settings"),onOk:C,okText:d(a)("btn_confirm"),cancelText:d(a)("btn_cancel")},{default:f(()=>[s("div",Wy,[s("div",Zy,[s("div",Yy,[s("div",Qy,[s("span",null,_(d(a)("label_retrieval_mode")),1)]),s("div",Xy,[s("div",e0,[(h(!0),D(ee,null,se(i.value,N=>(h(),D("div",{class:qe(["retrieval-mode-item",{active:r.search_type==N.value}]),key:N.value,onClick:I=>m(N.value)},[r.search_type==N.value?(h(),G(S,{key:0,class:"check-arrow",name:"check-arrow-filled"})):Z("",!0),s("div",s0,[c(S,{name:N.iconName,class:"title-icon"},null,8,["name"]),s("span",o0,_(N.title),1),N.isRecommendation?(h(),G(S,{key:0,class:"recommendation-icon",name:"recommendation"})):Z("",!0)]),s("div",n0,_(N.desc),1)],10,t0))),128))])])]),r.search_type==1?(h(),D("div",a0,[c(ff,{rrf_weight:r.rrf_weight,"onUpdate:rrf_weight":w[0]||(w[0]=N=>r.rrf_weight=N)},null,8,["rrf_weight"])])):Z("",!0),s("div",l0,[s("div",i0,[s("span",null,_(d(a)("label_top_k"))+" ",1),c(k,null,{title:f(()=>[T(_(d(a)("msg_top_k_tooltip")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),s("div",r0,[s("div",d0,[s("div",u0,[c(b,{class:"custom-slider",value:r.top_k,"onUpdate:value":w[1]||(w[1]=N=>r.top_k=N),min:1,max:500},null,8,["value"])]),s("div",c0,[c(x,{value:r.top_k,"onUpdate:value":w[2]||(w[2]=N=>r.top_k=N),min:1,max:500},null,8,["value"])])])])]),s("div",_0,[s("div",p0,[s("span",null,_(d(a)("label_similarity_threshold"))+" ",1),c(k,null,{title:f(()=>[T(_(d(a)("msg_similarity_tooltip")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),s("div",f0,[s("div",v0,[s("div",h0,[c(b,{class:"custom-slider",value:r.similarity,"onUpdate:value":w[3]||(w[3]=N=>r.similarity=N),min:0,max:1,step:.01},null,8,["value"])]),s("div",m0,[c(x,{value:r.similarity,"onUpdate:value":w[4]||(w[4]=N=>r.similarity=N),min:0,max:1,step:.01},null,8,["value"])])])])]),s("div",g0,[s("div",y0,[s("span",b0,_(d(a)("label_recall_neighbor_segments"))+" ",1),c(k,{overlayStyle:{maxWidth:"350px"}},{title:f(()=>[s("div",k0,[s("p",null,_(d(a)("msg_recall_neighbor_tooltip")),1)])]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1}),w[15]||(w[15]=T("   ",-1)),c(A,{checked:r.recall_neighbor_switch,"onUpdate:checked":w[5]||(w[5]=N=>r.recall_neighbor_switch=N)},null,8,["checked"])]),s("div",w0,[s("div",C0,[s("div",$0,[s("span",null,_(d(a)("label_concat_before")),1),w[16]||(w[16]=T("  ",-1)),c(E,{value:r.recall_neighbor_before_num,"onUpdate:value":w[6]||(w[6]=N=>r.recall_neighbor_before_num=N),style:{width:"80px"}},{default:f(()=>[(h(),D(ee,null,se(6,N=>c(R,{value:N-1,key:N},{default:f(()=>[T(_(N-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),s("div",x0,[s("span",null,_(d(a)("label_concat_after")),1),w[17]||(w[17]=T("  ",-1)),c(E,{value:r.recall_neighbor_after_num,"onUpdate:value":w[7]||(w[7]=N=>r.recall_neighbor_after_num=N),style:{width:"80px"}},{default:f(()=>[(h(),D(ee,null,se(6,N=>c(R,{value:N-1,key:N},{default:f(()=>[T(_(N-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),s("div",S0,_(d(a)("label_segments_count")),1)])])]),s("div",D0,[s("div",A0,[s("span",null,_(d(a)("label_rerank_model")),1),w[18]||(w[18]=T("   ",-1)),c(A,{checkedValue:1,unCheckedValue:0,checked:r.rerank_status,"onUpdate:checked":w[8]||(w[8]=N=>r.rerank_status=N)},null,8,["checked"])]),s("div",O0,[c(Gs,{modelType:"RERANK",modeName:r.rerank_use_model,"onUpdate:modeName":w[9]||(w[9]=N=>r.rerank_use_model=N),modeId:r.rerank_model_config_id,"onUpdate:modeId":w[10]||(w[10]=N=>r.rerank_model_config_id=N),style:{width:"320px"}},null,8,["modeName","modeId"])])]),s("div",N0,[s("div",B0,[c(k,{title:d(a)("msg_metadata_tooltip")},{default:f(()=>[s("span",null,[T(_(d(a)("label_metadata_filtering"))+" ",1),c(d(Re))])]),_:1},8,["title"]),w[19]||(w[19]=T("   ",-1)),c(A,{checkedValue:1,unCheckedValue:0,checked:r.meta_search_switch,"onUpdate:checked":w[11]||(w[11]=N=>r.meta_search_switch=N)},null,8,["checked"])]),r.meta_search_switch==1?(h(),D("div",E0,[c(ii,{rule:r.meta_search_condition_list,"onUpdate:rule":w[12]||(w[12]=N=>r.meta_search_condition_list=N),type:r.meta_search_type,"onUpdate:type":w[13]||(w[13]=N=>r.meta_search_type=N),ref:"metaFilterRef",class:"meta-box","meta-data":y.value},null,8,["rule","type","meta-data"])])):Z("",!0)])])])]),_:1},8,["open","title","okText","cancelText"])}}},F0=_e(I0,[["__scopeId","data-v-e0b7f70b"]]),R0={class:"problem-optimization-form"},L0={class:"node-form-content"},V0={class:"gray-block"},M0={class:"gray-block-title"},T0={class:"avatar-box"},j0=["src"],P0={class:"content-box"},q0={class:"list-name"},H0={class:"list-intro"},U0=["onClick"],J0={class:"btn-block"},z0={class:"diy-form-item"},K0={class:"form-label"},G0={class:"form-content"},W0={class:"form-content"},Z0={class:"gray-block mt16"},Y0={class:"gray-block-title"},Q0={class:"options-item"},X0={class:"option-label"},eb={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.knowledge-base-node-form"),a=Pt(),l=ye(()=>a.robotInfo.rrf_weight?JSON.parse(a.robotInfo.rrf_weight):{vector:0,search:0,graph:0}),i=n,r=e,u=U([]);function y(){const O=r.lf.getNodeModelById(r.nodeId);if(O){let M=O.getAllParentVariable();u.value=p(M)}}function p(O){return O.forEach(M=>{M.typ=="node"?M.node_type==1?M.value="global":M.value=M.node_id:M.value=M.key,M.children&&M.children.length>0&&(M.children=p(M.children))}),O}function m(O){if(O){let M=O.split("."),j=M[0],V=M.filter((z,H)=>H>0).join(".");return[j,V]}return["global","question"]}const v=U(),C=U(null),g=we({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",question_value:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),$=()=>{const O=JSON.stringify({libs:{...g,rerank_model_config_id:g.rerank_model_config_id?+g.rerank_model_config_id:void 0,question_value:g.question_value.join("."),library_ids:g.library_ids.join(","),rrf_weight:JSON.stringify(g.rrf_weight),recall_neighbor_switch:g.recall_neighbor_switch,recall_neighbor_before_num:g.recall_neighbor_before_num,recall_neighbor_after_num:g.recall_neighbor_before_num}});i("update-node",{...r.node,node_params:O})},w=()=>{try{let O=r.node.dataRaw||r.node.node_params||"{}",M=JSON.parse(O).libs||{};y(),M=JSON.parse(JSON.stringify(M));for(let j in M)j=="library_ids"?g[j]=M[j]?M[j].split(","):[]:j=="question_value"?g.question_value=m(M.question_value):j=="rrf_weight"?g.rrf_weight=M[j]?JSON.parse(M[j]):M[j]:g[j]=M[j];(!g.rrf_weight||Object.keys(g.rrf_weight).length==0)&&(g.rrf_weight=l.value),nl({ability_type:"library_ability_official_account"}).then(j=>{var z;let V=(j==null?void 0:j.data)||{};((z=V==null?void 0:V.user_config)==null?void 0:z.switch_status)==1&&(C.value=V)})}catch(O){}},S=U([]),k=U(null),b=ye(()=>S.value.filter(O=>C.value?g.library_ids.includes(O.id):g.library_ids.includes(O.id)&&O.type!=3)),x=O=>{let M=g.library_ids.indexOf(O.id);g.library_ids.splice(M,1)},A=O=>{I(),g.library_ids=[...O]},R=()=>{k.value.open([...g.library_ids])},E=U(null),B=()=>{E.value.open(Ht(g),null,g.library_ids)},N=O=>{g.rerank_status=O.rerank_status,g.rerank_use_model=O.rerank_use_model,g.rerank_model_config_id=O.rerank_model_config_id,g.top_k=O.top_k,g.similarity=O.similarity,g.search_type=O.search_type,g.meta_search_switch=Number(O.meta_search_switch),g.meta_search_type=Number(O.meta_search_type),g.meta_search_condition_list=O.meta_search_condition_list,g.rrf_weight=O.rrf_weight,g.recall_neighbor_switch=O.recall_neighbor_switch,g.recall_neighbor_before_num=O.recall_neighbor_before_num,g.recall_neighbor_after_num=O.recall_neighbor_after_num},I=async()=>{const O=await Vo({type:""});O&&(S.value=O.data||[])};Ie(()=>g,()=>{$()},{deep:!0});const L=O=>{O||y()},q=()=>{i("close")};return Ne(()=>{w(),I()}),(O,M)=>{const j=rt,V=Dt,z=xs,H=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_knowledge_base"),onClose:q},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",R0,[s("div",L0,[c(H,{ref_key:"formRef",ref:v,layout:"vertical",model:g},{default:f(()=>[s("div",V0,[s("div",M0,_(d(o)("label_input")),1),c(V,{label:d(o)("label_knowledge_base")},{default:f(()=>[(h(!0),D(ee,null,se(b.value,K=>(h(),D("div",{class:"konwledge-list-item",key:K.id},[s("div",T0,[s("img",{src:K.avatar,alt:""},null,8,j0)]),s("div",P0,[s("div",q0,_(K.library_name),1),s("div",H0,_(K.library_intro),1)]),s("div",{class:"btn-hover-wrap",onClick:F=>x(K)},[c(d(at))],8,U0)]))),128)),s("div",J0,[s("div",null,[c(j,{onClick:R,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_knowledge_base")),1)]),_:1},8,["icon"])]),s("div",null,[c(j,{onClick:B,icon:Qe(d(Cn)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_recall_settings")),1)]),_:1},8,["icon"])])])]),_:1},8,["label"]),s("div",z0,[s("div",K0,_(d(o)("label_user_question")),1),s("div",G0,[s("div",W0,[c(z,{value:g.question_value,"onUpdate:value":M[0]||(M[0]=K=>g.question_value=K),onDropdownVisibleChange:L,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:K})=>K.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","options","displayRender","placeholder"])])])])]),s("div",Z0,[s("div",Y0,_(d(o)("label_output")),1),s("div",Q0,[s("div",X0,_(d(o)("label_knowledge_quote")),1),M[1]||(M[1]=s("div",{class:"option-type"},"string",-1))])])]),_:1},8,["model"]),c(dl,{ref_key:"librarySelectAlertRef",ref:k,showWxType:!!C.value,onClose:I,onChange:A},null,8,["showWxType"]),c(F0,{ref_key:"recallSettingsAlertRef",ref:E,onChange:N},null,512)])])]),_:1})}}},tb=_e(eb,[["__scopeId","data-v-82657a04"]]),sb={class:"sub-field-item"},ob=["onClick"],nb=["onClick"],ab={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.code-run-node.subs-key"),o=e,a=ye(()=>o.level>2?o.typOptions.filter(p=>p.value!="object"):o.typOptions),l=ye(()=>o.level==2?"180px":"146px"),i=(p,m)=>{m[p].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(p,m)=>{m.splice(p,1)},u=p=>{p.subs=[]},y=p=>p.typ=="object"&&o.level<=2;return(p,m)=>{const v=pt,C=et,g=Ye,$=tt("SubsKey",!0);return h(!0),D(ee,null,se(o.data,(w,S)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${o.level}`]),key:w.cu_key},[s("div",sb,[m[0]||(m[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(v,{class:"mr12",style:jt({width:l.value}),value:w.key,"onUpdate:value":k=>w.key=k,placeholder:d(n)("ph_input")},null,8,["style","value","onUpdate:value","placeholder"]),m[1]||(m[1]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(g,{class:"mr12",onChange:k=>u(w),value:w.typ,"onUpdate:value":k=>w.typ=k,placeholder:d(n)("ph_select"),style:jt({width:l.value})},{default:f(()=>[(h(!0),D(ee,null,se(a.value,k=>(h(),G(C,{value:k.value},{default:f(()=>[T(_(k.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","placeholder","style"]),y(w)?(h(),D("div",{key:0,class:"btn-hover-wrap mr12",onClick:k=>i(S,o.data)},[c(d(Mt))],8,ob)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:k=>r(S,o.data)},[c(d(at))],8,nb)]),w.subs&&w.subs.length>0?(h(),G($,{key:0,level:o.level+1,typOptions:o.typOptions,data:w.subs},null,8,["level","typOptions","data"])):Z("",!0)],2))),128)}}},lb=_e(ab,[["__scopeId","data-v-7d78ddc4"]]),Kn={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(e,{expose:n,emit:o}){const a=o,l=U(""),i=e;Ie(()=>i.value,C=>{l.value=C},{immediate:!0});const r={mode:"text/javascript",theme:"dracula"},u=U(null),y=C=>{a("update:value",C)},p=()=>{u.value.refresh()},m=()=>{},v=()=>{};return n({handleRefresh:p}),(C,g)=>(h(),D("div",null,[c(d(vf),{onWheel:g[0]||(g[0]=He(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:l.value,"onUpdate:value":g[1]||(g[1]=$=>l.value=$),options:r,ref_key:"cmRef",ref:u,height:i.height,width:i.width,onChange:y,onInput:v,onReady:m},null,8,["value","height","width"])]))}},ib={class:"flex-content-box"},rb={class:"test-model-box"},db=["onClick"],ub={key:2,class:"input-list-box"},cb={class:"add-btn-box"},_b={class:"save-btn-box"},pb={class:"preview-box"},fb={class:"preview-title"},vb={class:"title-text"},hb={class:"preview-content-block"},mb={class:"title-block"},gb={class:"preview-code-box"},yb={class:"preview-title"},bb={class:"title-text"},kb={class:"preview-content-block"},wb={class:"title-block"},Cb={class:"error-box",style:{"margin-top":"12px"}},$b={key:0,style:{color:"#f50"}},xb={__name:"run-test",props:{variableOptions:{type:Array,default:()=>[]}},emits:["save"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.code-run-node.run-test"),l=e,i=U(!1),r=U(!1);let u=!1;const y=we({language:"javaScript",main_func:"",test_params:[]});function p(j){if(typeof j!="string")return null;const V=/<([^<>]+)>/,z=j.match(V);return z?z[1]:null}function m(j){var V;if(j&&j.length==2){let z=l.variableOptions.filter(H=>H.value==j[0]);if(z.length>0){let H=((V=z[0].children.filter(K=>K.value==j[1])[0])==null?void 0:V.typ)||"string";return H.includes("array")&&u?p(H):H}}return"string"}let v=[];const C=async j=>{k.value="",y.main_func=j.main_func,y.language=j.language||"javaScript";let V=localStorage.getItem("code_run_node_test_modal_data")||"{}";v=JSON.parse(V).test_params||[];let z=j.params.filter(H=>H.field&&H.variable&&H.variable.length>0);y.test_params=z.map(H=>{let K=m(H.variable);return{key:Math.random()*1e3,field:H.field,typ:K,value:g(K,H)}}),i.value=!0};function g(j,V){let z=v.filter(H=>H.field==V.field);return j.includes("array")?z.length&&typeof z[0].value=="object"?z[0].value:[{value:"",key:Math.random()*1e4}]:z.length&&typeof z[0].value=="string"?z[0].value:""}const $=(j,V)=>{j.splice(V,1)},w=j=>{j.push({value:"",key:Math.random()*1e4})},S=U(null),k=U(""),b=U(!1),x=U(""),A=()=>{S.value.validate().then(()=>{let j={...y},V=JSON.parse(JSON.stringify(y.test_params)),z={};V.forEach(H=>{z[H.field]=H.value,H.typ.includes("array")&&(z[H.field]=H.value.map(K=>(K.value=K.value.trim(),R(K.value)?JSON.parse(K.value):K.value)),z[H.field]=z[H.field].filter(K=>K)),H.typ==="object"&&R(H.value)&&(z[H.field]=JSON.parse(H.value))}),j.params=JSON.stringify(z),delete j.test_params,localStorage.setItem("code_run_node_test_modal_data",JSON.stringify(y)),r.value=!0,b.value=!1,Gl({...j}).then(H=>{Me.success(a("msg_test_success")),k.value=JSON.parse(H.data)}).catch(H=>{b.value=!0,x.value=H.msg}).finally(()=>{r.value=!1})})};function R(j){if(typeof j!="string")return!1;const V=j.trim();if(!(V.startsWith("{")&&V.endsWith("}")||V.startsWith("[")&&V.endsWith("]")))return!1;try{const H=JSON.parse(V);return typeof H=="object"&&H!==null}catch{return!1}}const E=()=>{bo(JSON.stringify(k.value)),Me.success(a("msg_copy_success"))},B=(j,V)=>{b.value=!1,u=V,C(j)},N=U(!1),I=U(!1),L=U(null),q=U(""),O=j=>{L.value=j,I.value=!1,N.value=!0},M=()=>{if(R(q.value)){let j=JSON.parse(q.value).map(H=>({value:typeof H=="string"?H:JSON.stringify(H)})),V=y.test_params[L.value],z={...V,value:[...V.value.filter(H=>H.value!=""),...j]};y.test_params.splice(L.value,1,z),N.value=!1}else I.value=!0};return n({open:B}),(j,V)=>{const z=Is,H=_s,K=pt,F=Vt,Y=Tt,le=rt,J=Dt,P=St,W=Ks,Q=wt,X=Ts;return h(),D("div",null,[c(Q,{open:i.value,"onUpdate:open":V[0]||(V[0]=de=>i.value=de),title:d(a)("title_run_test"),footer:null,width:820,wrapClassName:"no-padding-modal"},{default:f(()=>[s("div",ib,[s("div",rb,[s("div",{class:"top-title",onClick:O},_(d(a)("label_run_params")),1),c(P,{model:y,ref_key:"formRef",ref:S,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:f(()=>[(h(!0),D(ee,null,se(y.test_params,(de,Fe)=>(h(),G(J,{key:de.key,name:["test_params",Fe,"value"],rules:[{required:!0,message:`${d(a)("ph_input")}${de.field}`}]},{label:f(()=>[c(H,{gap:8},{default:f(()=>[T(_(de.field),1),c(z,{style:{margin:"0"}},{default:f(()=>[T(_(de.typ),1)]),_:2},1024),de.typ.includes("array")?(h(),D("a",{key:0,onClick:De=>O(Fe)},[c(d(ci)),T(" "+_(d(a)("btn_one_click_import")),1)],8,db)):Z("",!0)]),_:2},1024)]),default:f(()=>[de.typ!="number"&&!de.typ.includes("array")?(h(),G(K,{key:0,placeholder:d(a)("ph_input"),value:de.value,"onUpdate:value":De=>de.value=De},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),de.typ=="number"?(h(),G(F,{key:1,style:{width:"100%"},placeholder:d(a)("ph_input"),value:de.value,"onUpdate:value":De=>de.value=De},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),de.typ.includes("array")?(h(),D("div",ub,[(h(!0),D(ee,null,se(de.value,(De,$e)=>(h(),D("div",{class:"input-list-item",key:$e},[c(Y,null,{default:f(()=>[c(K,{placeholder:d(a)("ph_input"),value:De.value,"onUpdate:value":Ue=>De.value=Ue},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),de.value.length>1?(h(),G(d(at),{key:0,onClick:Ue=>$(de.value,$e)},null,8,["onClick"])):Z("",!0)]))),128)),s("div",cb,[c(le,{onClick:De=>w(de.value),block:"",type:"dashed"},{default:f(()=>[T(_(d(a)("btn_add")),1)]),_:1},8,["onClick"])])])):Z("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),s("div",_b,[c(le,{loading:r.value,onClick:A,style:{"background-color":"#00ad3a"},type:"primary"},{default:f(()=>[c(d(bs)),T(_(d(a)("btn_run_test")),1)]),_:1},8,["loading"])])]),s("div",pb,[k.value?(h(),D(ee,{key:0},[s("div",fb,[s("div",vb,_(d(a)("label_log_details")),1)]),s("div",hb,[s("div",mb,[T(_(d(a)("label_run_log")),1),c(d(ms),{onClick:E})]),s("div",gb,[c(d(hs),{data:k.value},null,8,["data"])])])],64)):Z("",!0),b.value?(h(),D(ee,{key:1},[s("div",yb,[s("div",bb,_(d(a)("label_log_details")),1)]),s("div",kb,[s("div",wb,_(d(a)("label_run_log")),1),s("div",Cb,[c(W,{message:x.value,type:"error"},null,8,["message"])])])],64)):Z("",!0)])])]),_:1},8,["open","title"]),c(Q,{open:N.value,"onUpdate:open":V[2]||(V[2]=de=>N.value=de),width:820,title:d(a)("title_batch_import"),onOk:M},{default:f(()=>[c(X,{value:q.value,"onUpdate:value":V[1]||(V[1]=de=>q.value=de),valueModifiers:{trim:!0},placeholder:d(a)("ph_input_json"),style:{"min-height":"200px"}},null,8,["value","placeholder"]),I.value?(h(),D("div",$b,_(d(a)("msg_json_error")),1)):Z("",!0)]),_:1},8,["open","title"])])}}},Sb=_e(xb,[["__scopeId","data-v-0699ada4"]]),Db={class:"problem-optimization-form"},Ab={class:"node-form-content"},Ob={class:"gray-block"},Nb={class:"gray-block-title"},Bb={class:"array-form-box"},Eb={class:"form-item-label"},Ib={class:"flex-block-item"},Fb=["onClick"],Rb={class:"code-edit-box"},Lb={class:"title-block"},Vb={class:"code-box"},Mb={class:"flex-block-item"},Tb={class:"gray-block mt16"},jb={class:"gray-block-title"},Pb={class:"output-box"},qb={class:"output-block"},Hb={class:"output-item"},Ub={class:"output-item"},Jb={class:"flex-block-item",style:{gap:"12px"}},zb=["onClick"],Kb=["onClick"],Gb={key:0,class:"sub-field-box"},Wb={class:"gray-block mt16"},Zb={class:"gray-block-title"},Yb={style:{margin:"40px 0 24px 0"}},Qb=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,Xb=`def main(data1, data2):
	return {
        'data1': data1,
        'data2': data2
	}`,e2={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.code-run-node.code-run-node-form"),a=n,l=e,i=U([]),r=()=>v.language=="python"?Xb:Qb,u=()=>{v.main_func=r()};function y(){const z=l.lf.getNodeModelById(l.nodeId);if(z){let H=z.getAllParentVariable();i.value=p(H)}}function p(z){return z.forEach(H=>{H.typ=="node"?H.node_type==1?H.value="global":H.value=H.node_id:H.value=H.key,H.children&&H.children.length>0&&(H.children=p(H.children))}),z}const m=U(),v=we({language:"javaScript",main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),C=()=>{wt.confirm({title:o("msg_confirm_restore"),content:o("msg_restore_desc"),okText:o("btn_confirm"),cancelText:o("btn_cancel"),onOk(){v.main_func=r()}})};function g(z){return z.forEach(H=>{H.cu_key=Math.random()*1e4,H.subs&&H.subs.length?g(H.subs):H.subs=[]}),z}const $=()=>{const z=JSON.stringify({code_run:{...v,params:w()}});a("update-node",{...l.node,...v,node_params:z})};function w(){let z=[];return v.params.forEach(H=>{z.push({field:H.field,variable:H.variable&&H.variable.length>0?H.variable.join("."):""})}),z}const S=()=>{try{let z=l.node.dataRaw||l.node.node_params||"{}",H=JSON.parse(z).code_run||{};H=JSON.parse(JSON.stringify(H)),y();for(let K in H){if(K=="params"){H[K]&&H[K].length>0?v[K]=H[K].map(F=>({...F,cu_key:Math.random()*1e4})):v[K]=[];continue}if(K=="output"){v.output=g(H[K]);continue}v[K]=H[K]}v.language=v.language||"javaScript",v.main_func=v.main_func||r(),v.params=v.params.map(K=>{let F="";for(let Y=0;Y<gs.length;Y++)if(K.variable.indexOf(gs[Y])>-1){F=gs[Y];break}if(F!=""){let Y=K.variable.split(".");K.variable=[Y[0],F]}else K.variable=K.variable.split(".");return{...K,key:Math.random()*1e4}})}catch(z){}};Ie(()=>v,()=>{$()},{deep:!0});const k=()=>{v.params.push({key:"",value:"",cu_key:Math.random()*1e4})},b=z=>{v.params.splice(z,1)},x=()=>{v.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},A=z=>{v.output.splice(z,1)},R=z=>{z.subs=[]},E=z=>{v.output[z].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},B=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],N=z=>{z||y()},I=U(!1),L=U(null),q=()=>{I.value=!0,L.value&&L.value.handleRefresh()},O=()=>{I.value=!1},M=()=>{a("close")},j=U(null),V=()=>{j.value.open(JSON.parse(JSON.stringify(v)),l.node.loop_parent_key!="")};return Ne(()=>{S()}),(z,H)=>{const K=ct,F=pt,Y=Tt,le=xs,J=Dt,P=rt,W=et,Q=Ye,X=_s,de=Vt,Fe=wt,De=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_code_run"),onClose:M},{runBtn:f(()=>[c(K,null,{title:f(()=>[T(_(d(o)("tip_run_test")),1)]),default:f(()=>[s("div",{class:"action-btn",onClick:V},[c(d(bs),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName","desc"])]),default:f(()=>[s("div",Db,[s("div",Ab,[c(De,{ref_key:"formRef",ref:m,layout:"vertical",model:v},{default:f(()=>[s("div",Ob,[s("div",Nb,_(d(o)("label_input")),1),s("div",Bb,[s("div",Eb,_(d(o)("label_custom_input_params")),1),(h(!0),D(ee,null,se(v.params,($e,Ue)=>(h(),D("div",{class:"form-item-list",key:Ue},[c(J,{label:null,name:["params",Ue,"variable"]},{default:f(()=>[s("div",Ib,[c(Y,null,{default:f(()=>[c(F,{style:{width:"190px"},value:$e.field,"onUpdate:value":ie=>$e.field=ie,placeholder:d(o)("ph_input_key")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024),c(le,{value:$e.variable,"onUpdate:value":ie=>$e.variable=ie,onDropdownVisibleChange:N,style:{width:"400px","max-width":"calc(100% - 190px)"},options:i.value,allowClear:!1,displayRender:({labels:ie})=>ie.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","onUpdate:value","options","displayRender","placeholder"]),s("div",{class:"btn-hover-wrap",onClick:ie=>b(Ue)},[c(d(at))],8,Fb)])]),_:2},1032,["name"])]))),128)),c(P,{onClick:k,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])]),s("div",Rb,[s("div",Lb,[s("div",null,[c(Q,{onChange:u,value:v.language,"onUpdate:value":H[0]||(H[0]=$e=>v.language=$e),style:{width:"160px"}},{default:f(()=>[c(W,{value:"javaScript"},{default:f(()=>[...H[6]||(H[6]=[T("javaScript",-1)])]),_:1}),c(W,{value:"python"},{default:f(()=>[...H[7]||(H[7]=[T("python",-1)])]),_:1})]),_:1},8,["value"])]),c(X,{gap:16,align:"center"},{default:f(()=>[s("a",{onClick:C},_(d(o)("btn_restore_template")),1),s("div",{class:"btn-hover-wrap",onClick:q},[c(d(Wt))])]),_:1})]),s("div",Vb,[c(Kn,{value:v.main_func,"onUpdate:value":H[1]||(H[1]=$e=>v.main_func=$e),width:410,height:170},null,8,["value"])])]),c(J,{name:"timeout",class:"mt16"},{label:f(()=>[c(X,{gap:2},{default:f(()=>[T(_(d(o)("label_timeout")),1)]),_:1})]),default:f(()=>[s("div",Mb,[c(de,{placeholder:d(o)("ph_input_url"),style:{width:"138px"},precision:0,value:v.timeout,"onUpdate:value":H[2]||(H[2]=$e=>v.timeout=$e),min:0,max:3e3},null,8,["placeholder","value"]),T(" "+_(d(o)("label_second")),1)])]),_:1})]),s("div",Tb,[s("div",jb,_(d(o)("label_output_custom")),1),s("div",Pb,[s("div",qb,[s("div",Hb,_(d(o)("label_param_key")),1),s("div",Ub,_(d(o)("label_type")),1)]),s("div",{class:"array-form-box",onMousedown:H[3]||(H[3]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(v.output,($e,Ue)=>(h(),D("div",{class:"form-item-list",key:Ue},[c(J,{label:null,name:["output",Ue,"key"]},{default:f(()=>[s("div",Jb,[c(F,{style:{width:"214px"},value:$e.key,"onUpdate:value":ie=>$e.key=ie,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c(Y,null,{default:f(()=>[c(Q,{onChange:ie=>R($e),value:$e.typ,"onUpdate:value":ie=>$e.typ=ie,placeholder:d(o)("ph_select"),style:{width:"214px"}},{default:f(()=>[(h(),D(ee,null,se(B,ie=>c(W,{value:ie.value,key:ie.value},{default:f(()=>[T(_(ie.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value","placeholder"])]),_:2},1024),$e.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:ie=>E(Ue)},[c(d(Mt))],8,zb)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:ie=>A(Ue)},[c(d(at))],8,Kb)]),$e.subs&&$e.subs.length>0?(h(),D("div",Gb,[c(Y,null,{default:f(()=>[c(lb,{data:$e.subs,level:2,typOptions:B},null,8,["data"])]),_:2},1024)])):Z("",!0)]),_:2},1032,["name"])]))),128)),c(P,{onClick:x,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])],32)])]),s("div",Wb,[s("div",Zb,_(d(o)("label_exception_handling")),1),s("div",null,_(d(o)("msg_exception_handling_desc")),1)]),c(Fe,{open:I.value,"onUpdate:open":H[5]||(H[5]=$e=>I.value=$e),title:d(o)("title_edit_code"),width:746},{footer:f(()=>[c(P,{type:"primary",onClick:O},{default:f(()=>[T(_(d(o)("btn_confirm")),1)]),_:1})]),default:f(()=>[s("div",Yb,[c(Kn,{ref_key:"codeEditBoxRef",ref:L,value:v.main_func,"onUpdate:value":H[4]||(H[4]=$e=>v.main_func=$e),width:698,height:472},null,8,["value"])])]),_:1},8,["open","title"])]),_:1},8,["model"])])]),c(Sb,{variableOptions:i.value,ref_key:"runTestRef",ref:j},null,8,["variableOptions"])]),_:1})}}},t2=_e(e2,[["__scopeId","data-v-0d7c898b"]]),s2={class:"mt24"},o2={class:"add-btn-block"},n2={class:"list-box"},a2={__name:"add-authentication-modal",emits:["ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.http-node.add-authentication-modal"),l=U(!1),i=U([]),r=o,u=[{title:a("label_key"),dataIndex:"auth_key"},{title:a("label_value"),dataIndex:"auth_value"},{title:a("label_add_to"),dataIndex:"auth_value_addto"},{title:a("label_remark"),dataIndex:"auth_remark"},{title:a("label_operation"),dataIndex:"action",width:80}],y=we({selectedRowKeys:[]}),p=k=>{y.selectedRowKeys=k},m=()=>{l.value=!0,y.selectedRowKeys=[],g()},v=()=>{if(i.value.length>=100)return Me.error(a("msg_max_100"));i.value.push({auth_key:"",auth_value:"",auth_value_addto:"HEADERS",auth_remark:"",uni_key:nt(16)})},C=k=>{i.value=i.value.filter(b=>b.uni_key!==k.uni_key)},g=()=>{Ha().then(k=>{let b=k.data||[];i.value=b.map(x=>({...x,uni_key:nt(16)}))})};function $(){let k=[],b=[];return i.value.forEach((x,A)=>{b.push({auth_key:x.auth_key,auth_value:x.auth_value,auth_value_addto:x.auth_value_addto,auth_remark:x.auth_remark}),(x.auth_key==""||x.auth_value=="")&&k.push(A+1)}),k.length>0?(Me.error(a("msg_fill_params",{index:k.join(",")})),!1):b.length==0?(Me.error(a("msg_add_param")),!1):b}const w=()=>{let k=$();if(k==!1)return;let b=[];y.selectedRowKeys.forEach(x=>{b.push(i.value.find(A=>A.uni_key==x))}),r("ok",b),Ho({http_auth_config_list:JSON.stringify(k)}).then(x=>{Me.success(a("msg_save_success"))}).finally(()=>{y.selectedRowKeys=[],l.value=!1})},S=()=>{let k=$();k!=!1&&Ho({http_auth_config_list:JSON.stringify(k)}).then(b=>{Me.success(a("msg_save_success"))})};return n({show:m}),(k,b)=>{const x=Ks,A=rt,R=pt,E=et,B=Ye,N=Ya,I=ro,L=wt;return h(),D("div",null,[c(L,{open:l.value,"onUpdate:open":b[1]||(b[1]=q=>l.value=q),title:d(a)("title_auth_param"),width:700},{footer:f(()=>[c(A,{onClick:b[0]||(b[0]=q=>l.value=!1)},{default:f(()=>[T(_(d(a)("btn_cancel")),1)]),_:1}),c(A,{onClick:S},{default:f(()=>[T(_(d(a)("btn_only_save")),1)]),_:1}),c(A,{type:"primary",onClick:w},{default:f(()=>[T(_(d(a)("btn_save_and_add")),1)]),_:1})]),default:f(()=>[s("div",s2,[c(x,{class:"zm-alert-info",message:d(a)("msg_auth_param_tip"),type:"info"},null,8,["message"])]),s("div",o2,[c(A,{type:"primary",icon:Qe(d(Xe)),ghost:"",onClick:v},{default:f(()=>[T(_(d(a)("btn_add_param")),1)]),_:1},8,["icon"])]),s("div",n2,[c(I,{"row-selection":{selectedRowKeys:y.selectedRowKeys,onChange:p},columns:u,pagination:!1,"data-source":i.value,"row-key":"uni_key",scroll:{y:550}},{bodyCell:f(({column:q,record:O})=>[q.dataIndex==="auth_key"?(h(),G(R,{key:0,value:O.auth_key,"onUpdate:value":M=>O.auth_key=M,placeholder:d(a)("ph_input")},null,8,["value","onUpdate:value","placeholder"])):Z("",!0),q.dataIndex==="auth_value"?(h(),G(R,{key:1,value:O.auth_value,"onUpdate:value":M=>O.auth_value=M,placeholder:d(a)("ph_input")},null,8,["value","onUpdate:value","placeholder"])):Z("",!0),q.dataIndex==="auth_value_addto"?(h(),G(B,{key:2,value:O.auth_value_addto,"onUpdate:value":M=>O.auth_value_addto=M,style:{width:"100%"}},{default:f(()=>[c(E,{value:"HEADERS"},{default:f(()=>[...b[2]||(b[2]=[T("HEADERS",-1)])]),_:1}),c(E,{value:"PARAMS"},{default:f(()=>[...b[3]||(b[3]=[T("PARAMS",-1)])]),_:1}),c(E,{value:"BODY"},{default:f(()=>[...b[4]||(b[4]=[T("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):Z("",!0),q.dataIndex==="auth_remark"?(h(),G(R,{key:3,maxLength:10,value:O.auth_remark,"onUpdate:value":M=>O.auth_remark=M,placeholder:d(a)("ph_input")},null,8,["value","onUpdate:value","placeholder"])):Z("",!0),q.dataIndex==="action"?(h(),G(N,{key:4,title:d(a)("msg_confirm_delete"),"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel"),onConfirm:M=>C(O)},{default:f(()=>[s("a",null,_(d(a)("label_delete")),1)]),_:1},8,["title","ok-text","cancel-text","onConfirm"])):Z("",!0)]),_:1},8,["row-selection","data-source"])])]),_:1},8,["open","title"])])}}},l2=_e(a2,[["__scopeId","data-v-0e8ae45c"]]),i2={class:"modal-title-block"},r2={class:"flex-content-box"},d2={class:"test-model-box"},u2={class:"auto-extract-tip"},c2={key:2,class:"input-list-box"},_2={class:"add-btn-box"},p2={class:"save-btn-box"},f2={key:0},v2={key:1},h2={class:"preview-box"},m2={class:"preview-title"},g2={class:"title-text"},y2={class:"preview-content-block"},b2={class:"title-block"},k2={class:"preview-code-box"},w2={class:"preview-content-block"},C2={class:"title-block"},$2={class:"preview-code-box"},x2={__name:"run-test",props:{node_key:{type:String,default:""}},emits:["save","autoExtract"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.http-node.run-test"),l=e,i=o,r=Pt(),u=ye(()=>r.robotInfo.isLockedByOther),y=U(!1),p=U([]),m=U({fields:[],output:{},result:{}}),v=U(!1),C=U(""),g=we({is_draft:!0,robot_key:r.robotInfo.robot_key}),$=async E=>{if(u.value){Me.warning(a("msg_locked_by_other"));return}m.value={fields:[],output:{},result:{}},C.value="",p.value=E,y.value=!0,p.value.forEach(B=>{B.field.typ.includes("array")&&S(B.field.Vals)})},w=(E,B)=>{E.splice(B,1)},S=E=>{E.push({value:"",key:fo(16)})},k=U(null),b=()=>{k.value.validate().then(()=>{const E={...g,curl_node_key:l.node_key},B=JSON.parse(JSON.stringify(p.value));B.forEach(N=>{N.field.typ.includes("array")&&(N.field.Vals=N.field.Vals.map(I=>I.value))}),E.test_params=JSON.stringify(B),v.value=!0,C.value="loading",Wl({...E}).then(N=>{Me.success(a("msg_test_success")),m.value=N.data,C.value="success"}).catch(N=>{Me.error(a("msg_test_failed")),C.value="error"}).finally(()=>{v.value=!1})})},x=E=>{bo(JSON.stringify(m.value[E])),Me.success(a("msg_copy_success"))},A=()=>{i("autoExtract",JSON.parse(JSON.stringify(m.value.fields)))};return n({open:E=>{$(E)}}),(E,B)=>{const N=Ks,I=Is,L=_s,q=pt,O=Vt,M=Tt,j=rt,V=Dt,z=St,H=wt;return h(),D("div",null,[c(H,{open:y.value,"onUpdate:open":B[2]||(B[2]=K=>y.value=K),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:f(()=>[s("div",i2,[s("span",null,_(d(a)("title_run_test")),1)])]),default:f(()=>[s("div",r2,[s("div",d2,[s("div",u2,[c(N,{message:d(a)("msg_auto_extract_tip"),type:"info","show-icon":""},null,8,["message"])]),c(z,{model:g,ref_key:"formRef",ref:k,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:f(()=>[(h(!0),D(ee,null,se(p.value,K=>(h(),G(V,{key:K.node_key,rules:[{required:K.field.required,message:d(a)("msg_required_field",{label:K.field.label})}]},{label:f(()=>[c(L,{gap:4},{default:f(()=>[s("span",null,_(K.field.label),1),c(I,{style:{margin:"0"}},{default:f(()=>[T(_(K.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:f(()=>[K.field.typ=="string"?(h(),G(q,{key:0,placeholder:d(a)("ph_input"),value:K.field.Vals,"onUpdate:value":F=>K.field.Vals=F},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),K.field.typ=="number"?(h(),G(O,{key:1,style:{width:"100%"},placeholder:d(a)("ph_input"),value:K.field.Vals,"onUpdate:value":F=>K.field.Vals=F},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),K.field.typ.includes("array")?(h(),D("div",c2,[(h(!0),D(ee,null,se(K.field.Vals,(F,Y)=>(h(),D("div",{class:"input-list-item",key:Y},[c(M,null,{default:f(()=>[c(q,{placeholder:d(a)("ph_input"),value:F.value,"onUpdate:value":le=>F.value=le},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),K.field.Vals.length>1?(h(),G(d(at),{key:0,onClick:le=>w(K.field.Vals,Y)},null,8,["onClick"])):Z("",!0)]))),128)),s("div",_2,[c(j,{onClick:F=>S(K.field.Vals),block:"",type:"dashed"},{default:f(()=>[T(_(d(a)("btn_add")),1)]),_:1},8,["onClick"])])])):Z("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),s("div",p2,[c(j,{loading:v.value,onClick:b,style:{"background-color":"#00ad3a"},type:"primary"},{default:f(()=>[v.value?Z("",!0):(h(),D("span",f2,[c(d(bs)),T(_(d(a)("btn_run_test")),1)])),v.value?(h(),D("span",v2,_(d(a)("msg_generating")),1)):Z("",!0)]),_:1},8,["loading"]),C.value==="success"?(h(),G(j,{key:0,style:{"margin-left":"16px"},type:"primary",onClick:A},{default:f(()=>[T(_(d(a)("btn_auto_extract")),1)]),_:1})):Z("",!0)])]),s("div",h2,[C.value==="success"?(h(),D(ee,{key:0},[s("div",m2,[s("div",g2,_(d(a)("label_log_details")),1)]),s("div",y2,[s("div",b2,[T(_(d(a)("label_raw_output")),1),c(d(ms),{onClick:B[0]||(B[0]=K=>x("result"))})]),s("div",k2,[c(d(hs),{data:m.value.result},null,8,["data"])])]),s("div",w2,[s("div",C2,[T(_(d(a)("label_run_log")),1),c(d(ms),{onClick:B[1]||(B[1]=K=>x("output"))})]),s("div",$2,[c(d(hs),{data:m.value.output},null,8,["data"])])])],64)):Z("",!0)])])]),_:1},8,["open"])])}}},S2=_e(x2,[["__scopeId","data-v-d05431c5"]]),D2={class:"problem-optimization-form"},A2={class:"node-form-content"},O2={class:"gray-block"},N2={class:"gray-block-title export-curl-title"},B2={class:"flex-block-item"},E2={class:"array-form-box"},I2={class:"form-item-label"},F2={class:"flex-block-item"},R2={class:"at-input-flex1"},L2={class:"field-list-item"},V2={class:"field-label"},M2={class:"field-type"},T2=["onClick"],j2={class:"array-form-box"},P2={class:"form-item-label"},q2={class:"flex-block-item"},H2={class:"at-input-flex1"},U2={class:"field-list-item"},J2={class:"field-label"},z2={class:"field-type"},K2=["onClick"],G2={key:0},W2={key:0,class:"array-form-box"},Z2={class:"flex-block-item"},Y2={class:"at-input-flex1"},Q2={class:"field-list-item"},X2={class:"field-label"},ek={class:"field-type"},tk=["onClick"],sk={class:"field-list-item"},ok={class:"field-label"},nk={class:"field-type"},ak={class:"flex-block-item"},lk={class:"gray-block mt16"},ik={class:"gray-block-title"},rk={class:"output-box"},dk={class:"flex-block-item",style:{gap:"12px"}},uk=["onClick"],ck={class:"gray-block mt16"},_k={class:"output-box"},pk={class:"output-block"},fk={class:"output-item"},vk={class:"output-item"},hk={class:"flex-block-item",style:{gap:"12px"}},mk=["onClick"],gk=["onClick"],yk={key:0,class:"sub-field-box"},bk={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.http-node.http-node-form"),a=n,l=e,i=be("handleAutoSaveDraft"),r=U([]),u=we({}),y=U(null),p=U(),m=we({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[],http_auth:[]}),v=U(),C=()=>{v.value.show()},g=P=>{let W=[{key:"",value:""}],Q=[{key:"",value:""}],X=[],de="",Fe=!1;m.method=P.method,m.rawurl=P.url;function De($e){return typeof $e=="string"?$e:JSON.stringify($e)}P.header&&typeof P.header=="object"&&(W=Object.keys(P.header).map($e=>($e.toLowerCase()=="content-type"&&P.header[$e].indexOf("application/json")!==-1&&(Fe=!0),{key:$e,value:De(P.header[$e]),cu_key:nt(16)})),W=W.filter($e=>$e.key.toLowerCase()!=="content-type")),P.data&&typeof P.data=="object"&&(X=Object.keys(P.data).map($e=>({key:$e,value:De(P.data[$e]),cu_key:nt(16)})),de=JSON.stringify(P.data)),P.params&&typeof P.params=="object"&&(Q=Object.keys(P.params).map($e=>({key:$e,value:De(P.params[$e]),cu_key:nt(16)}))),Fe?(m.type=2,m.body_raw=de):(m.type=1,m.body=X),m.headers=W,m.params=Q};function $(P){return P.forEach(W=>{W.cu_key=nt(16),W.subs&&W.subs.length?$(W.subs):W.subs=[]}),P}function w(P){return P.typ.includes("array")?[]:null}const S=async()=>{var Q;let P=JSON.parse(JSON.stringify(m));await i();let W=[];P.headers.forEach(X=>{X.tags&&X.tags.length&&(W=W.concat(X.tags))}),P.params.forEach(X=>{X.tags&&X.tags.length&&(W=W.concat(X.tags))}),m.type==1?P.body.forEach(X=>{X.tags&&X.tags.length&&(W=W.concat(X.tags))}):m.type==2&&P.body_raw_tags.length&&(W=W.concat(P.body_raw_tags)),W=W.map(X=>({node_key:X.node_id,field:{key:X.original_value,label:X.label,typ:X.typ,Vals:w(X),required:!1,sys:!1}})),(Q=y.value)==null||Q.open(W)},k=P=>{m.output=P,Me.success(o("msg_auto_extract_success"))},b=(P,W,Q)=>{if(P){let X=`at_input_${W}_${Q}`;u[X]=P}},x=(P,W,Q,X)=>{P=="body_raw"?(m.body_raw=W,m.body_raw_tags=Q):(X.tags=Q,X.value=W)},A=()=>{const P=l.lf.getNodeModelById(l.nodeId);if(P){let W=P.getAllParentVariable();W.forEach(Q=>{Q.tags=Q.tags||[]}),r.value=W}},R=()=>{const P=JSON.stringify({curl:{...m}});a("update-node",{...l.node,...m,node_params:P})},E=()=>{try{let P=l.node.dataRaw||l.node.node_params||"{}",W=JSON.parse(P).curl||{};W=JSON.parse(JSON.stringify(W)),A();for(let Q in W){if(Q=="headers"||Q=="params"||Q=="body"){W[Q]&&W[Q].length>0?m[Q]=W[Q].map(X=>({...X,cu_key:nt(16)})):m[Q]=[];continue}if(Q=="output"){m.output=$(W[Q]);continue}m[Q]=W[Q]}m.http_auth=W.http_auth||[]}catch(P){}};Ie(()=>m,()=>{R()},{deep:!0});const B=()=>{m.headers.push({key:"",value:"",cu_key:nt(16)})},N=P=>{m.headers.splice(P,1)},I=()=>{m.params.push({key:"",value:"",cu_key:nt(16)})},L=P=>{m.params.splice(P,1)},q=()=>{m.body.push({key:"",value:"",cu_key:nt(16)})},O=P=>{m.body.splice(P,1)},M=()=>{m.output.push({key:"",typ:"string",subs:[],cu_key:nt(16)})},j=P=>{m.output.splice(P,1)},V=P=>{P.subs=[]},z=P=>{(!m.output[P].subs||!Array.isArray(m.output[P].subs))&&(m.output[P].subs=[]),m.output[P].subs.push({key:"",value:"",subs:[],cu_key:nt(16)})},H=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],K=U(null),F=()=>{K.value.show()},Y=P=>{let W=P.map(Q=>({key:Q.auth_key,value:Q.auth_value,add_to:Q.auth_value_addto}));m.http_auth=[...m.http_auth,...W]},le=P=>{m.http_auth.splice(P,1)},J=()=>{a("close")};return Ne(()=>{E()}),(P,W)=>{const Q=ct,X=rt,de=et,Fe=Ye,De=Tt,$e=pt,Ue=Dt,ie=Qt,ge=Yt,ve=_s,he=Vt,Ae=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_http_node"),onClose:J},{runBtn:f(()=>[c(Q,null,{title:f(()=>[T(_(d(o)("btn_run_test")),1)]),default:f(()=>[s("div",{class:"run-test-btn",onClick:S},[c(d(bs),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName","desc"])]),default:f(()=>[s("div",D2,[s("div",A2,[c(Ae,{ref_key:"formRef",ref:p,layout:"vertical",model:m},{default:f(()=>[s("div",O2,[s("div",N2,[s("span",null,_(d(o)("title_input")),1),c(X,{ghost:"",type:"primary",size:"small",onClick:C},{default:f(()=>[c(d(Qa)),T(" "+_(d(o)("btn_import_curl")),1)]),_:1})]),c(Ue,{label:d(o)("label_request_url"),name:"rawurl",rules:[{required:!0,message:d(o)("msg_input_request_url")}]},{default:f(()=>[s("div",B2,[c(De,null,{default:f(()=>[c(Fe,{value:m.method,"onUpdate:value":W[0]||(W[0]=oe=>m.method=oe),style:{width:"120px"}},{default:f(()=>[c(de,{value:"POST"},{default:f(()=>[...W[8]||(W[8]=[T("POST",-1)])]),_:1}),c(de,{value:"GET"},{default:f(()=>[...W[9]||(W[9]=[T("GET",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),c($e,{class:"flex1",value:m.rawurl,"onUpdate:value":W[1]||(W[1]=oe=>m.rawurl=oe),placeholder:d(o)("msg_input_request_url")},null,8,["value","placeholder"])])]),_:1},8,["label","rules"]),s("div",E2,[s("div",I2,_(d(o)("title_headers")),1),(h(!0),D(ee,null,se(m.headers,(oe,ne)=>(h(),D("div",{class:"form-item-list",key:ne},[c(Ue,{label:null,name:["headers",ne,"value"]},{default:f(()=>[s("div",F2,[c(De,null,{default:f(()=>[c($e,{style:{width:"120px"},value:oe.key,"onUpdate:value":ue=>oe.key=ue,placeholder:d(o)("ph_input_param_key")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024),s("div",R2,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ue=>b(ue,"headers",ne),options:r.value,defaultSelectedList:oe.tags,defaultValue:oe.value,onOpen:A,onChange:(ue,ke)=>x("headers",ue,ke,oe,ne),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:ue,payload:ke})=>[s("div",L2,[s("div",V2,_(ue),1),s("div",M2,_(ke.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",{class:"btn-hover-wrap",onClick:ue=>N(ne)},[c(d(at))],8,T2)])]),_:2},1032,["name"])]))),128)),c(X,{onClick:B,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])]),s("div",j2,[s("div",P2,_(d(o)("title_params")),1),(h(!0),D(ee,null,se(m.params,(oe,ne)=>(h(),D("div",{class:"form-item-list",key:ne},[c(Ue,{label:null,name:["params",ne,"value"]},{default:f(()=>[s("div",q2,[c(De,null,{default:f(()=>[c($e,{style:{width:"120px"},value:oe.key,"onUpdate:value":ue=>oe.key=ue,placeholder:d(o)("ph_input_param_key")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024),s("div",H2,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ue=>b(ue,"params",ne),options:r.value,defaultSelectedList:oe.tags,defaultValue:oe.value,onOpen:A,onChange:(ue,ke)=>x("params",ue,ke,oe,ne),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:ue,payload:ke})=>[s("div",U2,[s("div",J2,_(ue),1),s("div",z2,_(ke.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",{class:"btn-hover-wrap",onClick:ue=>L(ne)},[c(d(at))],8,K2)])]),_:2},1032,["name"])]))),128)),c(X,{onClick:I,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])]),m.method=="POST"?(h(),D("div",G2,[c(Ue,{label:d(o)("title_body"),name:"type",class:"line-height-22"},{default:f(()=>[c(ge,{value:m.type,"onUpdate:value":W[2]||(W[2]=oe=>m.type=oe)},{default:f(()=>[c(ie,{value:0},{default:f(()=>[T(_(d(o)("label_body_none")),1)]),_:1}),c(ie,{value:1},{default:f(()=>[T(_(d(o)("label_body_form_urlencoded")),1)]),_:1}),c(ie,{value:2},{default:f(()=>[T(_(d(o)("label_body_json")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),m.type==1?(h(),D("div",W2,[(h(!0),D(ee,null,se(m.body,(oe,ne)=>(h(),D("div",{class:"form-item-list",key:ne},[c(Ue,{label:null,name:["body",ne,"value"],rules:{required:!0}},{default:f(()=>[s("div",Z2,[c(De,null,{default:f(()=>[c($e,{style:{width:"120px"},value:oe.key,"onUpdate:value":ue=>oe.key=ue,placeholder:d(o)("ph_input_param_key")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024),s("div",Y2,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ue=>b(ue,"body",ne),options:r.value,defaultSelectedList:oe.tags,defaultValue:oe.value,onOpen:A,onChange:(ue,ke)=>x("body",ue,ke,oe,ne),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:ue,payload:ke})=>[s("div",Q2,[s("div",X2,_(ue),1),s("div",ek,_(ke.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",{class:"btn-hover-wrap",onClick:ue=>O(ne)},[c(d(at))],8,tk)])]),_:2},1032,["name"])]))),128)),c(X,{onClick:q,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])])):Z("",!0),m.type==2?(h(),G(Ue,{key:1,label:null,name:"body_raw"},{default:f(()=>[c(xe,{type:"textarea",options:r.value,defaultSelectedList:m.body_raw_tags,defaultValue:m.body_raw,ref:oe=>b(oe,"body","body_raw"),onOpen:A,onChange:W[3]||(W[3]=(oe,ne)=>x("body_raw",oe,ne)),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:oe,payload:ne})=>[s("div",sk,[s("div",ok,_(oe),1),s("div",nk,_(ne.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),_:1})):Z("",!0)])):Z("",!0),c(Ue,{name:"timeout"},{label:f(()=>[c(ve,{gap:2},{default:f(()=>[T(_(d(o)("label_timeout")),1)]),_:1})]),default:f(()=>[s("div",ak,[c(he,{placeholder:d(o)("msg_input_request_url"),style:{width:"120px"},precision:0,value:m.timeout,"onUpdate:value":W[4]||(W[4]=oe=>m.timeout=oe),min:0,max:3e3},null,8,["placeholder","value"]),T(" "+_(d(o)("label_second")),1)])]),_:1})]),s("div",lk,[s("div",ik,[T(_(d(o)("title_authentication"))+" ",1),c(Q,null,{title:f(()=>[T(_(d(o)("tip_authentication_params")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",rk,[W[13]||(W[13]=s("div",{class:"output-block"},[s("div",{class:"output-item",style:{width:"124px"}},"Key"),s("div",{class:"output-item",style:{width:"124px"}},"Value"),s("div",{class:"output-item",style:{width:"124px"}},"Add To")],-1)),s("div",{class:"array-form-box",onMousedown:W[5]||(W[5]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(m.http_auth,(oe,ne)=>(h(),D("div",{class:"form-item-list",key:ne},[c(Ue,{label:null},{default:f(()=>[s("div",dk,[c($e,{style:{width:"124px"},value:oe.key,"onUpdate:value":ue=>oe.key=ue,placeholder:d(o)("ph_input_value")},null,8,["value","onUpdate:value","placeholder"]),c(De,null,{default:f(()=>[c($e,{style:{width:"124px"},value:oe.value,"onUpdate:value":ue=>oe.value=ue,placeholder:d(o)("ph_input_value")},null,8,["value","onUpdate:value","placeholder"]),c(Fe,{value:oe.add_to,"onUpdate:value":ue=>oe.add_to=ue,style:{width:"124px"}},{default:f(()=>[c(de,{value:"HEADERS"},{default:f(()=>[...W[10]||(W[10]=[T("HEADERS",-1)])]),_:1}),c(de,{value:"PARAMS"},{default:f(()=>[...W[11]||(W[11]=[T("PARAMS",-1)])]),_:1}),c(de,{value:"BODY"},{default:f(()=>[...W[12]||(W[12]=[T("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),s("div",{class:"btn-hover-wrap",onClick:ue=>le(ne)},[c(d(at))],8,uk)])]),_:2},1024)]))),128)),c(X,{onClick:F,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])],32)])]),s("div",ck,[s("div",{class:"gray-block-title output-title",onClick:W[6]||(W[6]=(...oe)=>P.test&&P.test(...oe))},[s("span",null,_(d(o)("title_output_extraction")),1),c(X,{type:"primary",size:"small",onClick:S},{default:f(()=>[T(_(d(o)("btn_auto_extract_output")),1)]),_:1})]),s("div",_k,[s("div",pk,[s("div",fk,_(d(o)("label_param_key")),1),s("div",vk,_(d(o)("label_type")),1)]),s("div",{class:"array-form-box",onMousedown:W[7]||(W[7]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(m.output,(oe,ne)=>(h(),D("div",{class:"form-item-list",key:ne},[c(Ue,{label:null,name:["output",ne,"key"]},{default:f(()=>[s("div",hk,[c($e,{style:{width:"214px"},value:oe.key,"onUpdate:value":ue=>oe.key=ue,placeholder:d(o)("ph_input_value")},null,8,["value","onUpdate:value","placeholder"]),c(De,null,{default:f(()=>[c(Fe,{onChange:ue=>V(oe),value:oe.typ,"onUpdate:value":ue=>oe.typ=ue,placeholder:d(o)("ph_select_value"),style:{width:"214px"}},{default:f(()=>[(h(),D(ee,null,se(H,ue=>c(de,{value:ue.value,key:ue.value},{default:f(()=>[T(_(ue.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value","placeholder"])]),_:2},1024),oe.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:ue=>z(ne)},[c(d(Mt))],8,mk)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:ue=>j(ne)},[c(d(at))],8,gk)]),oe.subs&&oe.subs.length>0?(h(),D("div",yk,[c(De,null,{default:f(()=>[c(nf,{data:oe.subs,level:2,typOptions:H},null,8,["data"])]),_:2},1024)])):Z("",!0)]),_:2},1032,["name"])]))),128)),c(X,{onClick:M,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])],32)])])]),_:1},8,["model"])])]),c(af,{ref_key:"parseCurlModalRef",ref:v,onParse:g},null,512),c(l2,{onOk:Y,ref_key:"addAuthenticationModalRef",ref:K},null,512),c(S2,{ref_key:"runTestRef",ref:y,node_key:e.nodeId,onAutoExtract:k},null,8,["node_key"])]),_:1})}}},kk=_e(bk,[["__scopeId","data-v-43cd5e28"]]),wk={class:"sub-field-item"},Ck=["onClick"],$k=["onClick"],xk={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(e){const n=e,o=ye(()=>n.level>2?n.typOptions.filter(y=>y.value!="object"):n.typOptions),a=ye(()=>n.level==2?"180px":"146px"),l=(y,p)=>{p[y].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},i=(y,p)=>{p.splice(y,1)},r=y=>{y.subs=[]},u=y=>y.typ=="object"&&n.level<=2;return(y,p)=>{const m=pt,v=et,C=Ye,g=tt("SubsKey",!0);return h(!0),D(ee,null,se(n.data,($,w)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${n.level}`]),key:$.cu_key},[s("div",wk,[p[0]||(p[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(m,{class:"mr12",style:jt({width:a.value}),value:$.key,"onUpdate:value":S=>$.key=S,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),p[1]||(p[1]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(C,{class:"mr12",onChange:S=>r($),value:$.typ,"onUpdate:value":S=>$.typ=S,placeholder:"请选择",style:jt({width:a.value})},{default:f(()=>[(h(!0),D(ee,null,se(o.value,S=>(h(),G(v,{value:S.value},{default:f(()=>[T(_(S.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),u($)?(h(),D("div",{key:0,class:"btn-hover-wrap mr12",onClick:S=>l(w,n.data)},[c(d(Mt))],8,Ck)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:S=>i(w,n.data)},[c(d(at))],8,$k)]),$.subs&&$.subs.length>0?(h(),G(g,{key:0,level:n.level+1,typOptions:n.typOptions,data:$.subs},null,8,["level","typOptions","data"])):Z("",!0)],2))),128)}}},Sk=_e(xk,[["__scopeId","data-v-f5e62554"]]),Dk={class:"parse-curl-modal"},Ak={key:0,class:"parse-error"},Ok={__name:"parse-curl-modal",emits:["parse","close"],setup(e,{expose:n,emit:o}){const a=o,l=U(!1),i=U(!1),r=U(""),u=U(""),y=U(`请粘贴 cURL 命令，例如：curl -X POST https://api.example.com/data -H 'Content-Type: application/json' -d '{"key":"value"}'`),p=()=>{l.value=!0,r.value="",u.value="",i.value=!1},m=()=>{l.value=!1,r.value="",u.value="",a("close")},v=()=>{l.value=!1},C=async()=>{if(!r.value.trim()){u.value="请输入 cURL 命令";return}u.value="";try{let g=r.value.trim();const $="__SINGLE_QUOTE_PLACEHOLDER__";let w=g.replace(/'\\''/g,$);w=w.replace(/\\\n/g," ").replace(/\\/g,"");let S=lf(decodeURIComponent(w));if(S.params){const k={};for(const[b,x]of Object.entries(S.params)){const A=decodeURIComponent(b),R=typeof x=="string"?decodeURIComponent(x):x;k[A]=R}S.params=k}if(S.data&&(S.header&&S.header["Content-Type"]?S.header["Content-Type"].toLowerCase():"").includes("application/x-www-form-urlencoded")&&typeof S.data=="object"){const x={};for(const[A,R]of Object.entries(S.data)){const E=decodeURIComponent(A),B=typeof R=="string"?decodeURIComponent(R):R;x[E]=B}S.data=x}if(S=JSON.stringify(S).split($).join("'"),S=JSON.parse(S),S.method!=="GET"&&S.method!=="POST"){u.value="只支持 GET、POST 请求";return}a("parse",S)}catch(g){u.value=g.message}};return n({show:p,hide:v,handleClose:m}),(g,$)=>{const w=Ks,S=Ts,k=Dt,b=wt;return h(),G(b,{open:l.value,"onUpdate:open":$[2]||($[2]=x=>l.value=x),title:"解析 cURL",width:680,"confirm-loading":i.value,onOk:C,onCancel:m,okText:"解析",cancelText:"取消"},{default:f(()=>[s("div",Dk,[c(w,{message:"请粘贴 cURL 命令，系统将自动解析并填充到 HTTP 请求配置中。只支持 GET、POST 请求。",type:"info","show-icon":"",class:"mb16"}),c(k,{label:""},{default:f(()=>[c(S,{class:"curl-textarea",value:r.value,"onUpdate:value":$[0]||($[0]=x=>r.value=x),placeholder:y.value,"auto-size":{minRows:8,maxRows:8},maxlength:5e4,"show-count":""},null,8,["value","placeholder"])]),_:1}),u.value?(h(),D("div",Ak,[c(w,{message:u.value,type:"error","show-icon":"",closable:"",onClose:$[1]||($[1]=x=>u.value="")},null,8,["message"])])):Z("",!0)])]),_:1},8,["open","confirm-loading"])}}},Nk=_e(Ok,[["__scopeId","data-v-21e221fd"]]),Bk={class:"mt24"},Ek={class:"add-btn-block"},Ik={class:"list-box"},Fk={__name:"add-authentication-modal",emits:["ok"],setup(e,{expose:n,emit:o}){const a=U(!1),l=U([]),i=o,r=[{title:"Key",dataIndex:"auth_key"},{title:"Value",dataIndex:"auth_value"},{title:"Add To",dataIndex:"auth_value_addto"},{title:"备注",dataIndex:"auth_remark"},{title:"操作",dataIndex:"action",width:80}],u=we({selectedRowKeys:[]}),y=S=>{u.selectedRowKeys=S},p=()=>{a.value=!0,u.selectedRowKeys=[],C()},m=()=>{if(l.value.length>=100)return Me.error("最多添加100条");l.value.push({auth_key:"",auth_value:"",auth_value_addto:"HEADERS",auth_remark:"",uni_key:nt(16)})},v=S=>{l.value=l.value.filter(k=>k.uni_key!==S.uni_key)},C=()=>{Ha().then(S=>{let k=S.data||[];l.value=k.map(b=>({...b,uni_key:nt(16)}))})};function g(){let S=[],k=[];return l.value.forEach((b,x)=>{k.push({auth_key:b.auth_key,auth_value:b.auth_value,auth_value_addto:b.auth_value_addto,auth_remark:b.auth_remark}),(b.auth_key==""||b.auth_value=="")&&S.push(x+1)}),S.length>0?(Me.error(`请填写第${S.join(",")}行参数`),!1):k.length==0?(Me.error("请添加参数"),!1):k}const $=()=>{let S=g();if(S==!1)return;let k=[];u.selectedRowKeys.forEach(b=>{k.push(l.value.find(x=>x.uni_key==b))}),i("ok",k),Ho({http_auth_config_list:JSON.stringify(S)}).then(b=>{Me.success("保存成功")}).finally(()=>{u.selectedRowKeys=[],a.value=!1})},w=()=>{let S=g();S!=!1&&Ho({http_auth_config_list:JSON.stringify(S)}).then(k=>{Me.success("保存成功")})};return n({show:p}),(S,k)=>{const b=Ks,x=rt,A=pt,R=et,E=Ye,B=Ya,N=ro,I=wt;return h(),D("div",null,[c(I,{open:a.value,"onUpdate:open":k[1]||(k[1]=L=>a.value=L),title:"鉴权参数",width:700},{footer:f(()=>[c(x,{onClick:k[0]||(k[0]=L=>a.value=!1)},{default:f(()=>[...k[7]||(k[7]=[T("取消",-1)])]),_:1}),c(x,{onClick:w},{default:f(()=>[...k[8]||(k[8]=[T("仅保存参数",-1)])]),_:1}),c(x,{type:"primary",onClick:$},{default:f(()=>[...k[9]||(k[9]=[T("保存并添加",-1)])]),_:1})]),default:f(()=>[s("div",Bk,[c(b,{class:"zm-alert-info",message:"选择的参数会自动填充到http节点，鉴权参数在导出CSL或上架模板时会自动清空",type:"info"})]),s("div",Ek,[c(x,{type:"primary",icon:Qe(d(Xe)),ghost:"",onClick:m},{default:f(()=>[...k[2]||(k[2]=[T("添加参数",-1)])]),_:1},8,["icon"])]),s("div",Ik,[c(N,{"row-selection":{selectedRowKeys:u.selectedRowKeys,onChange:y},columns:r,pagination:!1,"data-source":l.value,"row-key":"uni_key",scroll:{y:550}},{bodyCell:f(({column:L,record:q})=>[L.dataIndex==="auth_key"?(h(),G(A,{key:0,value:q.auth_key,"onUpdate:value":O=>q.auth_key=O,placeholder:"请输入"},null,8,["value","onUpdate:value"])):Z("",!0),L.dataIndex==="auth_value"?(h(),G(A,{key:1,value:q.auth_value,"onUpdate:value":O=>q.auth_value=O,placeholder:"请输入"},null,8,["value","onUpdate:value"])):Z("",!0),L.dataIndex==="auth_value_addto"?(h(),G(E,{key:2,value:q.auth_value_addto,"onUpdate:value":O=>q.auth_value_addto=O,style:{width:"100%"}},{default:f(()=>[c(R,{value:"HEADERS"},{default:f(()=>[...k[3]||(k[3]=[T("HEADERS",-1)])]),_:1}),c(R,{value:"PARAMS"},{default:f(()=>[...k[4]||(k[4]=[T("PARAMS",-1)])]),_:1}),c(R,{value:"BODY"},{default:f(()=>[...k[5]||(k[5]=[T("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):Z("",!0),L.dataIndex==="auth_remark"?(h(),G(A,{key:3,maxLength:10,value:q.auth_remark,"onUpdate:value":O=>q.auth_remark=O,placeholder:"请输入"},null,8,["value","onUpdate:value"])):Z("",!0),L.dataIndex==="action"?(h(),G(B,{key:4,title:"确认删除该字段?","ok-text":"确定","cancel-text":"取消",onConfirm:O=>v(q)},{default:f(()=>[...k[6]||(k[6]=[s("a",null,"删除",-1)])]),_:1},8,["onConfirm"])):Z("",!0)]),_:1},8,["row-selection","data-source"])])]),_:1},8,["open"])])}}},Rk=_e(Fk,[["__scopeId","data-v-3f9b79d6"]]),Lk={class:"problem-optimization-form"},Vk={class:"node-form-content"},Mk={class:"gray-block"},Tk={class:"gray-block-title export-curl-title"},jk={class:"flex-block-item"},Pk={class:"array-form-box"},qk={class:"flex-block-item"},Hk={class:"at-input-flex1"},Uk={class:"field-list-item"},Jk={class:"field-label"},zk={class:"field-type"},Kk=["onClick"],Gk={class:"array-form-box"},Wk={class:"flex-block-item"},Zk={class:"at-input-flex1"},Yk={class:"field-list-item"},Qk={class:"field-label"},Xk={class:"field-type"},e3=["onClick"],t3={key:0},s3={key:0,class:"array-form-box"},o3={class:"flex-block-item"},n3={class:"at-input-flex1"},a3={class:"field-list-item"},l3={class:"field-label"},i3={class:"field-type"},r3=["onClick"],d3={class:"field-list-item"},u3={class:"field-label"},c3={class:"field-type"},_3={class:"flex-block-item"},p3={class:"gray-block mt16"},f3={class:"gray-block-title"},v3={class:"output-box"},h3={class:"flex-block-item",style:{gap:"12px"}},m3=["onClick"],g3={class:"gray-block mt16"},y3={class:"output-box"},b3={class:"flex-block-item",style:{gap:"12px"}},k3=["onClick"],w3=["onClick"],C3={key:0,class:"sub-field-box"},$3={__name:"http-tool-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const o=n,a=e,l=U([]),i=we({}),r=(K,F,Y)=>{if(K){let le=`at_input_${F}_${Y}`;i[le]=K}},u=(K,F,Y,le)=>{K=="body_raw"?(m.body_raw=F,m.body_raw_tags=Y):(le.tags=Y,le.value=F)},y=()=>{const K=a.lf.getNodeModelById(a.nodeId);if(K){let F=K.getAllParentVariable();F.forEach(Y=>{Y.tags=Y.tags||[]}),l.value=F}},p=U(),m=we({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}],http_auth:[]}),v=U(),C=U({}),g=()=>{v.value.show()},$=K=>{let F=[{key:"",value:""}],Y=[{key:"",value:""}],le=[],J="",P=!1;m.method=K.method,m.rawurl=K.url;function W(Q){return typeof Q=="string"?Q:JSON.stringify(Q)}K.header&&typeof K.header=="object"&&(F=Object.keys(K.header).map(Q=>(Q.toLowerCase()=="content-type"&&K.header[Q].indexOf("application/json")!==-1&&(P=!0),{key:Q,value:W(K.header[Q]),cu_key:nt(16)})),F=F.filter(Q=>Q.key.toLowerCase()!=="content-type")),K.data&&typeof K.data=="object"&&(le=Object.keys(K.data).map(Q=>({key:Q,value:W(K.data[Q]),cu_key:nt(16)})),J=JSON.stringify(K.data)),K.params&&typeof K.params=="object"&&(Y=Object.keys(K.params).map(Q=>({key:Q,value:W(K.params[Q]),cu_key:nt(16)}))),P?(m.type=2,m.body_raw=J):(m.type=1,m.body=le),m.headers=F,m.params=Y,v.value&&v.value.hide()};function w(K){return K.forEach(F=>{F.cu_key=nt(16),F.subs&&F.subs.length?w(F.subs):F.subs=[]}),K}const S=()=>{const K={...m};(!Array.isArray(K.http_auth)||K.http_auth.length===0)&&delete K.http_auth;const F=C.value||{};F&&Object.keys(F).length>0&&(K.http_tool_info=F);const Y=JSON.stringify({curl:K});o("update-node",{...a.node,...m,node_params:Y})},k=()=>{try{let K=a.node.dataRaw||a.node.node_params||"{}",F=JSON.parse(K).curl||{};F=JSON.parse(JSON.stringify(F)),C.value=F.http_tool_info||{},y();for(let Y in F){if(Y=="headers"||Y=="params"||Y=="body"){F[Y]&&F[Y].length>0?m[Y]=F[Y].map(le=>({...le,cu_key:nt(16)})):m[Y]=[];continue}if(Y=="output"){m.output=w(F[Y]);continue}m[Y]=F[Y]}m.http_auth=F.http_auth||[]}catch(K){}};Ie(()=>m,()=>{S()},{deep:!0});const b=()=>{m.headers.push({key:"",value:"",cu_key:nt(16)})},x=K=>{m.headers.splice(K,1)},A=()=>{m.params.push({key:"",value:"",cu_key:nt(16)})},R=K=>{m.params.splice(K,1)},E=()=>{m.body.push({key:"",value:"",cu_key:nt(16)})},B=K=>{m.body.splice(K,1)},N=()=>{m.output.push({key:"",typ:"string",subs:[],cu_key:nt(16)})},I=K=>{m.output.splice(K,1)},L=K=>{K.subs=[]},q=K=>{m.output[K].subs.push({key:"",value:"",subs:[],cu_key:nt(16)})},O=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],M=U(null),j=()=>{M.value.show()},V=K=>{let F=K.map(Y=>({key:Y.auth_key,value:Y.auth_value,add_to:Y.auth_value_addto}));m.http_auth=[...m.http_auth,...F]},z=K=>{m.http_auth.splice(K,1)},H=()=>{o("close")};return Ne(()=>{k()}),(K,F)=>{const Y=rt,le=et,J=Ye,P=Tt,W=pt,Q=Dt,X=Qt,de=Yt,Fe=_s,De=Vt,$e=ct,Ue=St;return h(),G(ft,null,{header:f(()=>{var ie,ge;return[c(vt,{title:e.node.node_name,iconUrl:e.node.node_icon,desc:((ge=(ie=JSON.parse(e.node.node_params).curl)==null?void 0:ie.http_tool_info)==null?void 0:ge.http_tool_node_description)||"",onClose:H},null,8,["title","iconUrl","desc"])]}),default:f(()=>[s("div",Lk,[s("div",Vk,[c(Ue,{ref_key:"formRef",ref:p,layout:"vertical",model:m},{default:f(()=>[s("div",Mk,[s("div",Tk,[F[9]||(F[9]=s("span",null," 输入",-1)),c(Y,{ghost:"",type:"primary",size:"small",onClick:g},{default:f(()=>[c(d(Qa)),F[8]||(F[8]=T(" 导入cURL ",-1))]),_:1})]),c(Q,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:f(()=>[s("div",jk,[c(P,null,{default:f(()=>[c(J,{value:m.method,"onUpdate:value":F[0]||(F[0]=ie=>m.method=ie),style:{width:"120px"}},{default:f(()=>[c(le,{value:"POST"},{default:f(()=>[...F[10]||(F[10]=[T("POST",-1)])]),_:1}),c(le,{value:"GET"},{default:f(()=>[...F[11]||(F[11]=[T("GET",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),c(W,{class:"flex1",value:m.rawurl,"onUpdate:value":F[1]||(F[1]=ie=>m.rawurl=ie),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),s("div",Pk,[F[13]||(F[13]=s("div",{class:"form-item-label"},"HEADERS",-1)),(h(!0),D(ee,null,se(m.headers,(ie,ge)=>(h(),D("div",{class:"form-item-list",key:ge},[c(Q,{label:null,name:["headers",ge,"value"]},{default:f(()=>[s("div",qk,[c(P,null,{default:f(()=>[c(W,{style:{width:"120px"},value:ie.key,"onUpdate:value":ve=>ie.key=ve,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),s("div",Hk,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ve=>r(ve,"headers",ge),options:l.value,defaultSelectedList:ie.tags,defaultValue:ie.value,onOpen:y,onChange:(ve,he)=>u("headers",ve,he,ie,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:f(({label:ve,payload:he})=>[s("div",Uk,[s("div",Jk,_(ve),1),s("div",zk,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),s("div",{class:"btn-hover-wrap",onClick:ve=>x(ge)},[c(d(at))],8,Kk)])]),_:2},1032,["name"])]))),128)),c(Y,{onClick:b,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[...F[12]||(F[12]=[T("添加参数",-1)])]),_:1},8,["icon"])]),s("div",Gk,[F[15]||(F[15]=s("div",{class:"form-item-label"},"PARAMS",-1)),(h(!0),D(ee,null,se(m.params,(ie,ge)=>(h(),D("div",{class:"form-item-list",key:ge},[c(Q,{label:null,name:["params",ge,"value"]},{default:f(()=>[s("div",Wk,[c(P,null,{default:f(()=>[c(W,{style:{width:"120px"},value:ie.key,"onUpdate:value":ve=>ie.key=ve,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),s("div",Zk,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ve=>r(ve,"params",ge),options:l.value,defaultSelectedList:ie.tags,defaultValue:ie.value,onOpen:y,onChange:(ve,he)=>u("params",ve,he,ie,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:f(({label:ve,payload:he})=>[s("div",Yk,[s("div",Qk,_(ve),1),s("div",Xk,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),s("div",{class:"btn-hover-wrap",onClick:ve=>R(ge)},[c(d(at))],8,e3)])]),_:2},1032,["name"])]))),128)),c(Y,{onClick:A,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[...F[14]||(F[14]=[T("添加参数",-1)])]),_:1},8,["icon"])]),m.method=="POST"?(h(),D("div",t3,[c(Q,{label:"BODY",name:"type",class:"line-height-22"},{default:f(()=>[c(de,{value:m.type,"onUpdate:value":F[2]||(F[2]=ie=>m.type=ie)},{default:f(()=>[c(X,{value:0},{default:f(()=>[...F[16]||(F[16]=[T("none",-1)])]),_:1}),c(X,{value:1},{default:f(()=>[...F[17]||(F[17]=[T("x-www-form-urlencoded",-1)])]),_:1}),c(X,{value:2},{default:f(()=>[...F[18]||(F[18]=[T("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),m.type==1?(h(),D("div",s3,[(h(!0),D(ee,null,se(m.body,(ie,ge)=>(h(),D("div",{class:"form-item-list",key:ge},[c(Q,{label:null,name:["body",ge,"value"],rules:{required:!0}},{default:f(()=>[s("div",o3,[c(P,null,{default:f(()=>[c(W,{style:{width:"120px"},value:ie.key,"onUpdate:value":ve=>ie.key=ve,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),s("div",n3,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ve=>r(ve,"body",ge),options:l.value,defaultSelectedList:ie.tags,defaultValue:ie.value,onOpen:y,onChange:(ve,he)=>u("body",ve,he,ie,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:f(({label:ve,payload:he})=>[s("div",a3,[s("div",l3,_(ve),1),s("div",i3,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),s("div",{class:"btn-hover-wrap",onClick:ve=>B(ge)},[c(d(at))],8,r3)])]),_:2},1032,["name"])]))),128)),c(Y,{onClick:E,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[...F[19]||(F[19]=[T("添加参数",-1)])]),_:1},8,["icon"])])):Z("",!0),m.type==2?(h(),G(Q,{key:1,label:null,name:"body_raw"},{default:f(()=>[c(xe,{type:"textarea",options:l.value,defaultSelectedList:m.body_raw_tags,defaultValue:m.body_raw,ref:ie=>r(ie,"body","body_raw"),onOpen:y,onChange:F[3]||(F[3]=(ie,ge)=>u("body_raw",ie,ge)),placeholder:"请输入变量值，键入“/”插入变量"},{option:f(({label:ie,payload:ge})=>[s("div",d3,[s("div",u3,_(ie),1),s("div",c3,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):Z("",!0)])):Z("",!0),c(Q,{name:"timeout"},{label:f(()=>[c(Fe,{gap:2},{default:f(()=>[...F[20]||(F[20]=[T("超时时长",-1)])]),_:1})]),default:f(()=>[s("div",_3,[c(De,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:m.timeout,"onUpdate:value":F[4]||(F[4]=ie=>m.timeout=ie),min:0,max:3e3},null,8,["value"]),F[21]||(F[21]=T(" 秒 ",-1))])]),_:1})]),s("div",p3,[s("div",f3,[F[23]||(F[23]=T("鉴权 ",-1)),c($e,null,{title:f(()=>[...F[22]||(F[22]=[T("鉴权参数：导出模板CSL文件，或者上架模板时，自动清空参数值",-1)])]),default:f(()=>[c(d(Re))]),_:1})]),s("div",v3,[F[28]||(F[28]=s("div",{class:"output-block"},[s("div",{class:"output-item",style:{width:"124px"}},"Key"),s("div",{class:"output-item",style:{width:"124px"}},"Value"),s("div",{class:"output-item",style:{width:"124px"}},"Add To")],-1)),s("div",{class:"array-form-box",onMousedown:F[5]||(F[5]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(m.http_auth,(ie,ge)=>(h(),D("div",{class:"form-item-list",key:ge},[c(Q,{label:null},{default:f(()=>[s("div",h3,[c(W,{style:{width:"124px"},value:ie.key,"onUpdate:value":ve=>ie.key=ve,placeholder:"请输入"},null,8,["value","onUpdate:value"]),c(P,null,{default:f(()=>[c(W,{style:{width:"124px"},value:ie.value,"onUpdate:value":ve=>ie.value=ve,placeholder:"请输入"},null,8,["value","onUpdate:value"]),c(J,{value:ie.add_to,"onUpdate:value":ve=>ie.add_to=ve,style:{width:"124px"}},{default:f(()=>[c(le,{value:"HEADERS"},{default:f(()=>[...F[24]||(F[24]=[T("HEADERS",-1)])]),_:1}),c(le,{value:"PARAMS"},{default:f(()=>[...F[25]||(F[25]=[T("PARAMS",-1)])]),_:1}),c(le,{value:"BODY"},{default:f(()=>[...F[26]||(F[26]=[T("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),s("div",{class:"btn-hover-wrap",onClick:ve=>z(ge)},[c(d(at))],8,m3)])]),_:2},1024)]))),128)),c(Y,{onClick:j,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[...F[27]||(F[27]=[T("添加参数",-1)])]),_:1},8,["icon"])],32)])]),s("div",g3,[s("div",{class:"gray-block-title",onClick:F[6]||(F[6]=(...ie)=>K.test&&K.test(...ie))},"输出 (输出字段提取)"),s("div",y3,[F[30]||(F[30]=s("div",{class:"output-block"},[s("div",{class:"output-item"},"参数Key"),s("div",{class:"output-item"},"类型")],-1)),s("div",{class:"array-form-box",onMousedown:F[7]||(F[7]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(m.output,(ie,ge)=>(h(),D("div",{class:"form-item-list",key:ge},[c(Q,{label:null,name:["output",ge,"key"]},{default:f(()=>[s("div",b3,[c(W,{style:{width:"214px"},value:ie.key,"onUpdate:value":ve=>ie.key=ve,placeholder:"请输入"},null,8,["value","onUpdate:value"]),c(P,null,{default:f(()=>[c(J,{onChange:ve=>L(ie),value:ie.typ,"onUpdate:value":ve=>ie.typ=ve,placeholder:"请选择",style:{width:"214px"}},{default:f(()=>[(h(),D(ee,null,se(O,ve=>c(le,{value:ve.value,key:ve.value},{default:f(()=>[T(_(ve.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),ie.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:ve=>q(ge)},[c(d(Mt))],8,k3)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:ve=>I(ge)},[c(d(at))],8,w3)]),ie.subs&&ie.subs.length>0?(h(),D("div",C3,[c(P,null,{default:f(()=>[c(Sk,{data:ie.subs,level:2,typOptions:O},null,8,["data"])]),_:2},1024)])):Z("",!0)]),_:2},1032,["name"])]))),128)),c(Y,{onClick:N,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[...F[29]||(F[29]=[T("添加参数",-1)])]),_:1},8,["icon"])],32)])])]),_:1},8,["model"])])]),c(Nk,{ref_key:"parseCurlModalRef",ref:v,onParse:$},null,512),c(Rk,{onOk:V,ref_key:"addAuthenticationModalRef",ref:M},null,512)]),_:1})}}},x3=_e($3,[["__scopeId","data-v-c1653a46"]]),ul=()=>{const{t:e}=fe("constants.database");return{EQUALITY:{EQ:{label:e("label_equal"),value:"eq"},NEQ:{label:e("label_not_equal"),value:"neq"},IS:{label:e("label_is"),value:"eq"},IS_NOT:{label:e("label_is_not"),value:"neq"}},COMPARISON:{GT:{label:e("label_greater_than"),value:"gt"},LT:{label:e("label_less_than"),value:"lt"},GTE:{label:e("label_greater_than_or_equal"),value:"gte"},LTE:{label:e("label_less_than_or_equal"),value:"lte"},BETWEEN:{label:e("label_between"),value:"between"}},TEXT:{CONTAIN:{label:e("label_contain"),value:"contain"},NOT_CONTAIN:{label:e("label_not_contain"),value:"not_contain"}},NULLABILITY:{EMPTY:{label:e("label_empty"),value:"empty"},NOT_EMPTY:{label:e("label_not_empty"),value:"not_empty"}},BOOLEAN:{TRUE:{label:e("label_is"),value:"true"},FALSE:{label:e("label_is_not"),value:"false"}}}};ul();const Nn=()=>{const e=ul();return{string:[e.EQUALITY.IS,e.EQUALITY.IS_NOT,e.TEXT.CONTAIN,e.TEXT.NOT_CONTAIN,e.NULLABILITY.EMPTY,e.NULLABILITY.NOT_EMPTY],integer:[e.COMPARISON.GT,e.COMPARISON.LT,e.COMPARISON.GTE,e.COMPARISON.LTE,e.EQUALITY.EQ,e.COMPARISON.BETWEEN],number:[e.COMPARISON.GT,e.COMPARISON.LT,e.COMPARISON.GTE,e.COMPARISON.LTE,e.EQUALITY.EQ,e.COMPARISON.BETWEEN],boolean:[e.BOOLEAN.TRUE,e.BOOLEAN.FALSE]}};Nn();const cl=e=>Nn()[e]||[],Bn=(e,n)=>{const a=cl(n).find(l=>l.value===e);return(a==null?void 0:a.label)||e},S3={class:"query-condition-filter"},D3={class:"condition-select-box"},A3={class:"select-wrapper"},O3={href:"javascript:;"},N3={href:"javascript:;"},B3={class:"field-items"},E3={class:"field-select-box"},I3={class:"operator-select-box"},F3={class:"field-value-box"},R3={key:0,class:"site-input-group-wrapper"},L3=["title"],V3=["title"],M3=["onClick"],T3={class:"add-btn-box"},j3={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.data-table.query-condition-filter"),a=n,l=e,i=be("getNode"),r=we({list:l.where,type:l.type});Ie(()=>l.where,A=>{r.list=A}),Ie(()=>l.type,A=>{r.type=A});const u=ye(()=>l.where.length>1),y=ye(()=>Nn()),p=U([]),m=()=>{let A=i().getAllParentVariable();p.value=A||[]},v=()=>{m()},C=()=>{let A={type:r.type,list:r.list};a("change",A)},g=(A,R,E,B)=>{r.list[B].rule_value1=A,r.list[B].atTags=R,C()},$=(A,R,E,B)=>{r.list[B].rule_value2=A,r.list[B].atTags2=R,C()},w=()=>{let A={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list.push(A),C()},S=A=>{r.list.splice(A,1),C()},k=(A,R)=>{let E=cl(R.type),B={form_field_id:R.value,field_name:R.name,field_type:R.type,rule:E[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list[A]=B,C()},b=(A,R)=>{let E=r.list[A];E.rule=R.value,E.rule_value1="",E.rule_value2="",E.atTags=[],E.atTags2=[],C()},x=({key:A})=>{r.type=A,a("changeType",A),C()};return Ne(()=>{m()}),(A,R)=>{const E=lo,B=ao,N=io,I=et,L=Ye,q=pt,O=It,M=rt,j=ct;return h(),D("div",{class:qe(["query-condition-filter-warpper",{"is-multiple":u.value}])},[s("div",S3,[R[3]||(R[3]=s("div",{class:"auxiliary-line"},null,-1)),s("div",D3,[s("div",A3,[c(N,null,{overlay:f(()=>[c(B,{style:{width:"100px"},onClick:x},{default:f(()=>[(h(),G(E,{key:1},{default:f(()=>[s("a",O3,_(d(o)("label_and")),1)]),_:1})),(h(),G(E,{key:2},{default:f(()=>[s("a",N3,_(d(o)("label_or")),1)]),_:1}))]),_:1})]),default:f(()=>[s("a",{class:"ant-dropdown-link",onClick:R[0]||(R[0]=He(()=>{},["prevent"]))},[T(_(r.type==1?d(o)("label_and"):d(o)("label_or"))+" ",1),c(d(ds))])]),_:1})])]),s("div",B3,[(h(!0),D(ee,null,se(r.list,(V,z)=>(h(),D("div",{class:"field-item",key:V.field},[s("div",E3,[c(L,{style:{width:"100px"},value:V.form_field_id,"onUpdate:value":H=>V.form_field_id=H,onChange:(H,K)=>k(z,K)},{default:f(()=>[c(I,{value:0,type:"integer",name:"ID",key:"id"},{default:f(()=>[...R[1]||(R[1]=[T("ID",-1)])]),_:1}),(h(!0),D(ee,null,se(l.fieldOptions,H=>(h(),G(I,{value:H.id,type:H.type,name:H.name,key:H.id},{default:f(()=>[T(_(H.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),s("div",I3,[c(L,{value:V.rule,"onUpdate:value":H=>V.rule=H,style:{width:"150px"},onChange:(H,K)=>b(z,K)},{default:f(()=>[(h(!0),D(ee,null,se(y.value[V.field_type],H=>(h(),G(I,{value:H.value,style:{width:"220px"},key:H.value},{default:f(()=>[T(_(H.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),s("div",F3,[V.rule==="between"?(h(),D("div",R3,[s("div",{class:"site-input-left",title:d(o)("ph_input_number_variable")},[c(xe,{options:p.value,defaultValue:V.rule_value1,defaultSelectedList:V.atTags,onOpen:v,onChange:(H,K)=>g(H,K,V,z),placeholder:d(o)("ph_input_number")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])],8,L3),R[2]||(R[2]=s("span",{class:"site-input-split"},"~",-1)),s("div",{class:"site-input-right",title:d(o)("ph_input_number_variable")},[c(xe,{options:p.value,defaultValue:V.rule_value2,defaultSelectedList:V.atTags2,onOpen:v,onChange:(H,K)=>$(H,K,V,z),placeholder:d(o)("ph_input_number")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])],8,V3)])):["empty","not_empty","boolean"].includes(V.field_type)?(h(),G(q,{key:1,placeholder:d(o)("ph_no_value_required"),disabled:""},null,8,["placeholder"])):["integer","number"].includes(V.field_type)?(h(),G(xe,{key:2,options:p.value,defaultValue:V.rule_value1,defaultSelectedList:V.atTags,onOpen:v,onChange:(H,K)=>g(H,K,V,z),placeholder:d(o)("ph_input_number_variable")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])):(h(),G(xe,{key:3,options:p.value,defaultValue:V.rule_value1,defaultSelectedList:V.atTags,onOpen:v,onChange:(H,K)=>g(H,K,V,z),placeholder:d(o)("ph_input_value_variable")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"]))]),s("span",{class:"field-del-btn",onClick:H=>S(z)},[c(O,{class:"del-icon",name:"close-circle"})],8,M3)]))),128))])]),s("div",T3,[e.disabled?(h(),G(j,{key:0,title:d(o)("ph_select_database_first"),style:{width:"100%"}},{default:f(()=>[s("span",null,[c(M,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_condition")),1)]),_:1})])]),_:1},8,["title"])):(h(),G(M,{key:1,class:"add-btn",type:"dashed",block:"",onClick:w},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_condition")),1)]),_:1}))])],2)}}},En=_e(j3,[["__scopeId","data-v-dbbf5e71"]]),P3={target:"_blank",href:"/#/database/list"},q3={class:"delete-data-form"},H3={class:"node-box-content"},U3={class:"node-box-title"},J3={class:"text"},z3={class:"setting-label"},K3={class:"setting-box"},G3={class:"setting-label"},W3={class:"setting-box"},Z3={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.delete-data-form"),o=e,a=be("setData"),l=Ws();let i={};const r=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),u=({type:w,list:S})=>{r.formData.typ=w,r.formData.where=S,m()},y=(w,S)=>{S?(r.formData.form_name=S.name,r.formData.form_description=S.description,$(S.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.where=[]),m()},p=()=>{let w=o.node.dataRaw||"{}";i=JSON.parse(w);let S=v(i.form_delete.where||[]);i.form_delete.where=S,r.formData=i.form_delete,r.formData.form_id&&$(r.formData.form_id),m()},m=()=>{let w={...Ht(r.formData)};w.where=C(w.where),i.form_delete=w,a({...o.node,node_params:JSON.stringify(i)})},v=w=>{let S=[];return w.forEach(k=>{let b=JSON.parse(JSON.stringify(k)),x=b.rule.split("_");b.form_field_id=b.form_field_id*1,b.field_type=x[0],x.shift(),b.rule=x.join("_"),S.push(b)}),S},C=w=>{let S=[];return w.forEach(k=>{let b=JSON.parse(JSON.stringify(k));b.form_field_id=b.form_field_id*1,b.rule=k.field_type+"_"+k.rule,S.push(b)}),S},g=async()=>{const w=await l.getFormList();w&&(r.tableList=w)},$=async w=>{l.getFormFieldList({form_id:w}).then(S=>{S.forEach(k=>{k.id=k.id*1}),r.fieldList=S}).catch(()=>{})};return Ne(()=>{g(),p()}),(w,S)=>(h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name},{desc:f(()=>[s("span",null,[T(_(d(n)("title_desc_delete_data"))+" ",1),s("a",P3,_(d(n)("btn_go_manage")),1)])]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",q3,[s("div",H3,[s("div",U3,[S[1]||(S[1]=s("img",{class:"input-icon",src:Jt,alt:""},null,-1)),s("span",J3,_(d(n)("label_input")),1)]),s("div",z3,[s("span",null,_(d(n)("label_data_table")),1)]),s("div",K3,[c(Xo,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":S[0]||(S[0]=k=>r.formData.form_id=k),onChange:y},null,8,["options","title","description","value"])]),s("div",G3,[s("span",null,_(d(n)("label_delete_condition")),1)]),s("div",W3,[c(En,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:u},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},Y3=_e(Z3,[["__scopeId","data-v-e62d7cdc"]]),Q3={class:"variable-node"},X3={class:"node-form-content"},ew={class:"gray-block"},tw={class:"field-items"},sw={class:"field-name-box"},ow={class:"field-value-box"},nw={class:"field-value-option"},aw={class:"option-label"},lw={class:"option-type"},iw={class:"field-actions"},rw={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.variable-assignment-node-form"),a=n,l=e,i=U([]),r=U([]);function u(){const b=l.lf.getNodeModelById(l.nodeId);if(b){let x=b.properties.loop_parent_key;if(x){const E=l.lf.getNodeModelById(x);if(E){let B=E.properties.dataRaw||E.properties.node_params||"{}",N=JSON.parse(B).loop||{};r.value=N.intermediate_params.map(I=>({label:I.key,value:x+"."+I.key}));return}}let R=b.getGlobalVariable().diy_global||[];R.forEach(E=>{E.label=E.key,E.value="global."+E.key}),r.value=R||[]}}function y(){const b=l.lf.getNodeModelById(l.nodeId);if(b){let x=b.getAllParentVariable();i.value=x}}const p=U([]),m=()=>{let b=JSON.parse(l.node.node_params);b.assign=[...p.value],a("update-node",{...l.node,node_params:JSON.stringify(b)})},v=()=>{try{let b=l.node.dataRaw||l.node.node_params||"{}",x=JSON.parse(b).assign||[];x=JSON.parse(JSON.stringify(x)),x.forEach(A=>{A.tags=A.tags||[]}),p.value=x,u()}catch(b){}},C=b=>{b&&y()},g=(b,x,A)=>{A.tags=x,A.value=b,m()},$=()=>{p.value.push({variable:void 0,value:""}),m()},w=b=>{p.value.splice(b,1),m()},S=b=>{b&&u()},k=()=>{a("close")};return Ne(()=>{v()}),(b,x)=>{const A=et,R=Ye,E=rt;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_variable_assignment"),onClose:k},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",Q3,[s("div",X3,[s("div",ew,[s("div",tw,[(h(!0),D(ee,null,se(p.value,(B,N)=>(h(),D("div",{class:"field-item",key:N},[s("div",sw,[c(R,{style:{width:"100%"},placeholder:d(o)("ph_select_variable"),value:B.variable,"onUpdate:value":I=>B.variable=I,onDropdownVisibleChange:S,onChange:m},{default:f(()=>[(h(!0),D(ee,null,se(r.value,I=>(h(),G(A,{value:I.value,key:I.key},{default:f(()=>[s("span",null,_(I.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onUpdate:value"])]),s("div",ow,[c(xe,{ref_for:!0,ref:"atInput"+N,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:B.tags,defaultValue:B.value,onOpen:C,onChange:(I,L)=>g(I,L,B,N),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:I,payload:L})=>[s("div",nw,[s("div",aw,_(I),1),s("div",lw,_(L.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",iw,[c(d(at),{class:"action-btn",onClick:I=>w(N)},null,8,["onClick"])])]))),128))]),s("div",null,[c(E,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:$},{icon:f(()=>[c(d(Xe))]),default:f(()=>[T(" "+_(d(o)("btn_add_assign_variable")),1)]),_:1})])])])])]),_:1})}}},dw=_e(rw,[["__scopeId","data-v-24715950"]]),uw={target:"_blank",href:"/#/database/list"},cw={class:"update-data-form"},_w={class:"node-box-content"},pw={class:"node-box-title"},fw={class:"text"},vw={class:"setting-label"},hw={class:"setting-box"},mw={class:"setting-label"},gw={class:"setting-box"},yw={class:"setting-label"},bw={class:"setting-box"},kw={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.update-data-form"),o=e,a=be("setData"),l=Ws();let i={};const r=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),u=({type:S,list:k})=>{r.formData.typ=S,r.formData.where=k,v()},y=(S,k)=>{k?(r.formData.form_name=k.name,r.formData.form_description=k.description,w(k.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.datas=[],r.formData.where=[],r.formData.typ=1),v()},p=S=>{r.formData.datas=S,v()},m=()=>{let S=o.node.dataRaw||o.node.node_params||"{}";i=JSON.parse(S);let k=C(i.form_update.where||[]);i.form_update.where=k,r.formData=i.form_update,r.formData.form_id&&w(r.formData.form_id),v()},v=()=>{let S={...Ht(r.formData)};S.where=g(S.where),i.form_update=S,a({...o.node,node_params:JSON.stringify(i)})},C=S=>{let k=[];return S.forEach(b=>{let x=JSON.parse(JSON.stringify(b)),A=x.rule.split("_");x.form_field_id=x.form_field_id*1,x.field_type=A[0],A.shift(),x.rule=A.join("_"),k.push(x)}),k},g=S=>{let k=[];return S.forEach(b=>{let x=JSON.parse(JSON.stringify(b));x.form_field_id=x.form_field_id*1,x.rule=b.field_type+"_"+b.rule,k.push(x)}),k},$=async()=>{const S=await l.getFormList();S&&(r.tableList=S)},w=async S=>{l.getFormFieldList({form_id:S}).then(k=>{k.forEach(b=>{b.id=b.id*1}),r.fieldList=k}).catch(()=>{})};return Ne(()=>{$(),m()}),(S,k)=>(h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name},{desc:f(()=>[s("span",null,[T(_(d(n)("title_desc_update_data"))+" ",1),s("a",uw,_(d(n)("btn_go_manage")),1)])]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",cw,[s("div",_w,[s("div",pw,[k[1]||(k[1]=s("img",{class:"input-icon",src:Jt,alt:""},null,-1)),s("span",fw,_(d(n)("label_input")),1)]),s("div",vw,[s("span",null,_(d(n)("label_data_table")),1)]),s("div",hw,[c(Xo,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":k[0]||(k[0]=b=>r.formData.form_id=b),onChange:y},null,8,["options","title","description","value"])]),s("div",mw,[s("span",null,_(d(n)("label_update_condition")),1)]),s("div",gw,[c(En,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:u},null,8,["disabled","where","field-options","type"])]),s("div",yw,[s("span",null,_(d(n)("label_update_data")),1)]),s("div",bw,[c(On,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showEmptyFieldRow:r.formData.form_id=="",list:r.formData.datas,onChange:p},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},ww=_e(kw,[["__scopeId","data-v-9680c767"]]),_l={__name:"add-params-modal",emits:["add","edit","addSub"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.parameter-extraction-form.add-params-modal"),l=o,i=U(!1),r=U(a("title_add_param"));let u="add";const y=(b,x)=>x?/^[a-zA-Z_]+$/.test(x)?Promise.resolve():Promise.reject(a("msg_only_letters_underscore")):Promise.reject(a("msg_enter_key"));let p=0;const m=we({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),v=()=>{i.value=!0},C=()=>{Object.assign(m,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),u="add",r.value=a("title_add_param"),i.value=!0},g=b=>{p=b,Object.assign(m,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),u="addSub",r.value=a("title_add_param"),i.value=!0},$=(b,x)=>{p=x,Object.assign(m,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(m,{...b}),u="edit",r.value=a("title_edit_param"),i.value=!0},w=U(null),S=()=>{w.value.validate().then(()=>{u=="add"&&l("add",{...m}),u=="addSub"&&l("addSub",{...m},p),u=="edit"&&l("edit",{...m},p),i.value=!1})},k=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return n({show:v,add:C,edit:$,addSub:g}),(b,x)=>{const A=pt,R=Dt,E=et,B=Ye,N=Ms,I=Ts,L=St,q=wt;return h(),D("div",null,[c(q,{open:i.value,"onUpdate:open":x[5]||(x[5]=O=>i.value=O),title:r.value,onOk:S,width:472,"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel")},{default:f(()=>[c(L,{ref_key:"formRef",ref:w,layout:"vertical",model:m,style:{margin:"24px 0"}},{default:f(()=>[c(R,{label:d(a)("label_param_key"),name:"key",rules:[{required:!0,validator:(O,M)=>y(O,M)}]},{default:f(()=>[c(A,{value:m.key,"onUpdate:value":x[0]||(x[0]=O=>m.key=O),maxlength:20,placeholder:d(a)("ph_param_key_tip")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),c(R,{label:d(a)("label_param_type"),name:"typ",rules:[{required:!0,message:d(a)("msg_select_type")}]},{default:f(()=>[c(B,{value:m.typ,"onUpdate:value":x[1]||(x[1]=O=>m.typ=O),placeholder:d(a)("ph_select"),style:{width:"100%"}},{default:f(()=>[(h(),D(ee,null,se(k,O=>c(E,{value:O.value},{default:f(()=>[T(_(O.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"])]),_:1},8,["label","rules"]),c(R,{label:d(a)("label_required"),name:"required",rules:[{required:!0,message:d(a)("msg_select_required")}]},{default:f(()=>[c(N,{checked:m.required,"onUpdate:checked":x[2]||(x[2]=O=>m.required=O)},null,8,["checked"])]),_:1},8,["label","rules"]),c(R,{label:d(a)("label_default_value"),name:"default",rules:[{required:m.required,message:d(a)("msg_enter_default")}]},{default:f(()=>[c(A,{value:m.default,"onUpdate:value":x[3]||(x[3]=O=>m.default=O),placeholder:d(a)("msg_enter_default")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),c(R,{label:d(a)("label_enum_values"),name:"enum"},{default:f(()=>[c(I,{style:{height:"80px"},value:m.enum,"onUpdate:value":x[4]||(x[4]=O=>m.enum=O),placeholder:d(a)("ph_enum_tip")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","ok-text","cancel-text"])])}}},Cw={class:"sub-field-item"},$w=["onClick"],xw=["onClick"],Sw=["onClick"],Dw={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.parameter-extraction-form.subs-key"),o=e,a=ye(()=>o.level>2?o.typOptions.filter($=>$.value!="object"):o.typOptions),l=ye(()=>o.level==2?"180px":"146px");let i=0;const r=($,w)=>{w.splice($,1)},u=$=>{$.subs=[]},y=U(null),p=$=>{i=$,y.value.add()},m=($,w)=>{y.value.edit($,w)},v=$=>{o.data[i].subs.push($)},C=($,w)=>{o.data.splice(w,1,$)},g=$=>$.typ=="object"&&o.level<=2;return($,w)=>{const S=pt,k=et,b=Ye,x=tt("SubsKey",!0);return h(),D(ee,null,[(h(!0),D(ee,null,se(o.data,(A,R)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${o.level}`]),key:A.cu_key},[s("div",Cw,[w[0]||(w[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(S,{class:"mr12",style:jt({width:l.value}),value:A.key,"onUpdate:value":E=>A.key=E,placeholder:d(n)("ph_input")},null,8,["style","value","onUpdate:value","placeholder"]),w[1]||(w[1]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(b,{class:"mr12",onChange:E=>u(A),value:A.typ,"onUpdate:value":E=>A.typ=E,placeholder:d(n)("ph_select"),style:jt({width:l.value})},{default:f(()=>[(h(!0),D(ee,null,se(a.value,E=>(h(),G(k,{value:E.value},{default:f(()=>[T(_(E.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","placeholder","style"]),g(A)?(h(),D("div",{key:0,class:"btn-hover-wrap mr12",onClick:E=>p(R,o.data)},[c(d(Mt))],8,$w)):Z("",!0),s("div",{class:"btn-hover-wrap mr12",onClick:E=>m(A,R)},[c(d(eo))],8,xw),s("div",{class:"btn-hover-wrap",onClick:E=>r(R,o.data)},[c(d(at))],8,Sw)]),A.subs&&A.subs.length>0?(h(),G(x,{key:0,level:o.level+1,typOptions:o.typOptions,data:A.subs},null,8,["level","typOptions","data"])):Z("",!0)],2))),128)),c(_l,{onAdd:v,onEdit:C,ref_key:"addParamsModalRef",ref:y},null,512)],64)}}},Aw=_e(Dw,[["__scopeId","data-v-68beaaf3"]]),Ow={class:"problem-optimization-form"},Nw={class:"node-form-content"},Bw={class:"gray-block"},Ew={class:"gray-block-title"},Iw={class:"flex-block-item"},Fw={class:"number-box"},Rw={class:"number-slider-box"},Lw={class:"number-input-box"},Vw={class:"number-box"},Mw={class:"number-slider-box"},Tw={class:"number-input-box"},jw={class:"number-box"},Pw={class:"number-box"},qw={class:"number-slider-box"},Hw={class:"number-input-box"},Uw={class:"space-between-box"},Jw={class:"field-list-item"},zw={class:"field-label"},Kw={class:"field-type"},Gw={class:"form-tip"},Ww={class:"diy-form-item"},Zw={class:"form-label"},Yw={class:"form-content"},Qw={class:"gray-block mt16"},Xw={class:"output-box"},eC={class:"output-block"},tC={class:"output-item"},sC={class:"output-item"},oC={class:"array-form-box"},nC={class:"flex-block-item",style:{gap:"12px"}},aC=["onClick"],lC=["onClick"],iC=["onClick"],rC={key:0,class:"sub-field-box"},dC={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.parameter-extraction-form.index"),a=n,l=e,i=Pt(),r=U(null),u=ye(()=>i.modelList),y=U([]),p=U([]),m=U(!1),v=()=>{m.value=!m.value},C=(J,P)=>{b.prompt=J,b.prompt_tags=P};function g(){const J=l.lf.getNodeModelById(l.nodeId);if(J){let P=J.getAllParentVariable();p.value=$(P)}}function $(J){return J.forEach(P=>{P.typ=="node"?P.node_type==1?P.value="global":P.value=P.node_id:P.value=P.key,P.children&&P.children.length>0&&(P.children=$(P.children))}),J}const w=()=>{const J=l.lf.getNodeModelById(l.nodeId);if(J){let P=J.getAllParentVariable();y.value=P}};function S(J){if(J){let P=J.split("."),W=P[0],Q=P.filter((X,de)=>de>0).join(".");return[W,Q]}return["global","question"]}const k=U(),b=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[],role:1}),x=()=>{b.use_model&&b.use_model.toLowerCase().includes("deepseek-r1")?b.role=2:b.role=1},A=()=>{const J=JSON.stringify({params_extractor:{...b,question_value:b.question_value.join("."),model_config_id:b.model_config_id?+b.model_config_id:b.model_config_id}});a("update-node",{...l.node,...b,node_params:J})},R=()=>{try{let J=l.node.dataRaw||l.node.node_params||"{}",P=JSON.parse(J).params_extractor||{};P=JSON.parse(JSON.stringify(P)),w(),g();for(let W in P){if(W=="output"){b.output=E(P[W]);continue}if(W=="question_value"){b.question_value=S(P[W]);continue}b[W]=P[W]}b.role=+P.role||1,!b.model_config_id&&u.value.length>0&&(b.model_config_id=u.value[0].id,b.use_model=u.value[0].children[0].name)}catch(J){}};Ie(()=>b,()=>{A()},{deep:!0});function E(J){return J.forEach(P=>{P.cu_key=Math.random()*1e4,P.subs&&P.subs.length?E(P.subs):P.subs=[]}),J}const B=U(null),N=()=>{B.value.add()},I=(J,P)=>{B.value.edit(J,P)},L=J=>{b.output.push(J)},q=(J,P)=>{b.output.splice(P,1,J)},O=J=>{b.output.splice(J,1)},M=J=>{J.subs=[]},j=J=>{B.value.addSub(J)},V=(J,P)=>{b.output[P].subs.push(J)},z=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],H=J=>{J||g()},K=U({}),F=(J,P)=>{K.value=P},Y=ye(()=>{if(!b.model_config_id)return!1;let J=b.model_config_id+"#"+b.use_model;return K.value[J]}),le=()=>{a("close")};return Ne(()=>{R()}),(J,P)=>{const W=rt,Q=Dt,X=ct,de=Qt,Fe=Yt,De=ko,$e=Tt,Ue=Vt,ie=Ms,ge=xs,ve=pt,he=et,Ae=Ye,oe=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_param_extraction"),onClose:le},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",Ow,[s("div",Nw,[c(oe,{ref_key:"formRef",ref:k,layout:"vertical",model:b},{default:f(()=>[s("div",Bw,[s("div",Ew,_(d(o)("label_input")),1),c(Q,{label:d(o)("label_llm_model"),name:"use_model"},{default:f(()=>[s("div",Iw,[c(Gs,{modelType:"LLM",modeName:b.use_model,"onUpdate:modeName":P[0]||(P[0]=ne=>b.use_model=ne),modeId:b.model_config_id,"onUpdate:modeId":P[1]||(P[1]=ne=>b.model_config_id=ne),onLoaded:F,onChange:x,style:{width:"348px"}},null,8,["modeName","modeId"]),c(W,{onClick:v},{default:f(()=>[T(_(d(o)("btn_advanced_settings"))+" ",1),m.value?(h(),G(d(ds),{key:0})):(h(),G(d(Mo),{key:1}))]),_:1})])]),_:1},8,["label"]),m.value?(h(),G(Q,{key:0,name:"role"},{label:f(()=>[s("span",null,_(d(o)("label_prompt_role"))+" ",1),c(X,null,{title:f(()=>[s("div",null,[T(_(d(o)("tip_prompt_role_desc"))+" ",1),s("div",null,_(d(o)("label_system_role_example")),1),s("div",null,'{"role": "system", "content": "'+_(d(o)("sample_custom_prompt"))+'"}',1)])]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[c(Fe,{value:b.role,"onUpdate:value":P[2]||(P[2]=ne=>b.role=ne)},{default:f(()=>[c(de,{value:1},{default:f(()=>[T(_(d(o)("label_system_role")),1)]),_:1}),c(de,{value:2},{default:f(()=>[T(_(d(o)("label_user_role")),1)]),_:1})]),_:1},8,["value"])]),_:1})):Z("",!0),m.value?(h(),G(Q,{key:1,name:"temperature"},{label:f(()=>[s("span",null,_(d(o)("label_temperature"))+" ",1),c(X,null,{title:f(()=>[T(_(d(o)("tip_temperature")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Fw,[s("div",Rw,[c($e,null,{default:f(()=>[c(De,{class:"custom-slider",value:b.temperature,"onUpdate:value":P[3]||(P[3]=ne=>b.temperature=ne),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),s("div",Lw,[c(Ue,{value:b.temperature,"onUpdate:value":P[4]||(P[4]=ne=>b.temperature=ne),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Z("",!0),m.value?(h(),G(Q,{key:2,name:"max_token"},{label:f(()=>[s("span",null,_(d(o)("label_max_token"))+" ",1),c(X,null,{title:f(()=>[T(_(d(o)("tip_max_token")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Vw,[s("div",Mw,[c($e,null,{default:f(()=>[c(De,{class:"custom-slider",value:b.max_token,"onUpdate:value":P[5]||(P[5]=ne=>b.max_token=ne),min:0,max:100*1024},null,8,["value"])]),_:1})]),s("div",Tw,[c(Ue,{value:b.max_token,"onUpdate:value":P[6]||(P[6]=ne=>b.max_token=ne),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Z("",!0),m.value&&Y.value?(h(),G(Q,{key:3,name:"enable_thinking"},{label:f(()=>[s("span",null,_(d(o)("label_deep_thinking"))+" ",1),c(X,null,{title:f(()=>[T(_(d(o)("tip_deep_thinking")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",jw,[c(ie,{checked:b.enable_thinking,"onUpdate:checked":P[7]||(P[7]=ne=>b.enable_thinking=ne)},null,8,["checked"])])]),_:1})):Z("",!0),c(Q,{name:"context_pair"},{label:f(()=>[s("span",null,_(d(o)("label_context_count"))+" ",1),c(X,null,{title:f(()=>[T(_(d(o)("tip_context_count")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",Pw,[s("div",qw,[c($e,null,{default:f(()=>[c(De,{class:"custom-slider",value:b.context_pair,"onUpdate:value":P[8]||(P[8]=ne=>b.context_pair=ne),min:0,max:50},null,8,["value"])]),_:1})]),s("div",Hw,[c(Ue,{value:b.context_pair,"onUpdate:value":P[9]||(P[9]=ne=>b.context_pair=ne),min:0,max:50},null,8,["value"])])])]),_:1}),c(Q,{name:"prompt",class:"width-100"},{label:f(()=>[s("div",Uw,[s("div",null,_(d(o)("label_prompt")),1)])]),default:f(()=>[c(xe,{type:"textarea",inputStyle:"height: 100px;",options:y.value,defaultSelectedList:b.prompt_tags,defaultValue:b.prompt,ref_key:"atInputRef",ref:r,onOpen:w,onChange:P[10]||(P[10]=(ne,ue)=>C(ne,ue)),placeholder:d(o)("ph_input_message")},{option:f(({label:ne,payload:ue})=>[s("div",Jw,[s("div",zw,_(ne),1),s("div",Kw,_(ue.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",Gw,_(d(o)("tip_input_variable")),1)]),_:1}),s("div",Ww,[s("div",Zw,_(d(o)("label_user_question")),1),s("div",Yw,[c(ge,{value:b.question_value,"onUpdate:value":P[11]||(P[11]=ne=>b.question_value=ne),onDropdownVisibleChange:H,style:{width:"220px"},options:p.value,allowClear:!1,displayRender:({labels:ne})=>ne.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","options","displayRender","placeholder"])])])]),s("div",Qw,[s("div",{class:"gray-block-title",onClick:P[12]||(P[12]=(...ne)=>J.test&&J.test(...ne))},_(d(o)("label_output_extract")),1),s("div",Xw,[s("div",eC,[s("div",tC,_(d(o)("label_param_key")),1),s("div",sC,_(d(o)("label_type")),1)]),s("div",oC,[(h(!0),D(ee,null,se(b.output,(ne,ue)=>(h(),D("div",{class:"form-item-list",key:ue},[c(Q,{label:null,name:["output",ue,"key"]},{default:f(()=>[s("div",nC,[c(ve,{style:{width:"214px"},value:ne.key,"onUpdate:value":ke=>ne.key=ke,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c($e,null,{default:f(()=>[c(Ae,{onChange:ke=>M(ne),value:ne.typ,"onUpdate:value":ke=>ne.typ=ke,placeholder:d(o)("ph_select"),style:{width:"214px"}},{default:f(()=>[(h(),D(ee,null,se(z,ke=>c(he,{value:ke.value,key:ke.value},{default:f(()=>[T(_(ke.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value","placeholder"])]),_:2},1024),ne.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:ke=>j(ue)},[c(d(Mt))],8,aC)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:ke=>I(ne,ue)},[c(d(eo))],8,lC),s("div",{class:"btn-hover-wrap",onClick:ke=>O(ue)},[c(d(at))],8,iC)]),ne.subs&&ne.subs.length>0?(h(),D("div",rC,[c($e,null,{default:f(()=>[c(Aw,{data:ne.subs,level:2,typOptions:z},null,8,["data"])]),_:2},1024)])):Z("",!0)]),_:2},1032,["name"])]))),128)),c(W,{onClick:N,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])])])])]),_:1},8,["model"])]),c(_l,{onAdd:L,onEdit:q,onAddSub:V,ref_key:"addParamsModalRef",ref:B},null,512)])]),_:1})}}},uC=_e(dC,[["__scopeId","data-v-2c901bb8"]]),Zt="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",cC={class:"collapse-panel-warpper"},_C={class:"collapse-panel-header"},pC={class:"title-text"},fC={class:"collapse-panel-body"},vC={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(e){const o=U(e.defaultCollapsed),a=()=>{o.value=!o.value};return(l,i)=>{const r=It;return h(),D("div",cC,[s("div",_C,[s("div",{class:"collapse-panel-title",onClick:He(a,["stop"])},[s("span",pC,[T(_(e.title)+" ",1),e.count?(h(),D(ee,{key:0},[T("（"+_(e.count)+"）",1)],64)):Z("",!0)]),c(r,{name:"arrow-down",class:qe(["arrow-icon",{collapsed:o.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])]),s("div",null,[Ns(l.$slots,"extra",{},void 0,!0)])]),$s(s("div",fC,[Ns(l.$slots,"default",{},void 0,!0)],512),[[Es,!o.value]])])}}},vo=_e(vC,[["__scopeId","data-v-bc81dac5"]]),hC={class:"field-select-box"},mC={key:0,class:"field-list-box"},gC={key:1,class:"empty-box"},yC={__name:"field-select-alert",emits:["ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.data-table.sort-selector.field-select-alert"),l=o,i=we({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),r=U([{title:a("label_field_name"),dataIndex:"name",key:"name"},{title:a("label_data_type"),dataIndex:"type",key:"type"},{title:a("label_field_desc"),dataIndex:"description",key:"description"}]),u=U([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),y=(v,C)=>{i.selectedRowKeys=v,i.selectedRows=C},p=({formId:v,selectedRowKeys:C,selectedRows:g})=>{i.formId=v,i.selectedRowKeys=C,i.selectedRows=g,i.show=!0},m=()=>{l("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return n({open:p}),(v,C)=>{const g=ro,$=wt;return h(),G($,{width:"746px",open:i.show,"onUpdate:open":C[0]||(C[0]=w=>i.show=w),title:d(a)("title_relate_data_table"),onOk:m,"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel")},{default:f(()=>[s("div",hC,[u.value.length?(h(),D("div",mC,[c(g,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:y},dataSource:u.value,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):Z("",!0),u.value.length?Z("",!0):(h(),D("div",gC,[C[1]||(C[1]=s("img",{src:To,alt:""},null,-1)),s("div",null,_(d(a)("msg_no_fields_add")),1)]))])]),_:1},8,["open","title","ok-text","cancel-text"])}}},bC=_e(yC,[["__scopeId","data-v-8cf7a460"]]),kC={class:"field-list"},wC={class:"field-list-col field-drag-col"},CC={class:"drag-btn"},$C={class:"field-list-col field-name-col"},xC={class:"field-name-box"},SC={class:"field-name"},DC={class:"field-type-tag"},AC={class:"field-list-col field-value-col"},OC={key:0,class:"field-list-col field-del-col"},NC={class:"add-btn-box"},BC={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.data-table.sort-selector.index"),a=n,l=e,i=[{label:"label_asc",value:1,key:"asc"},{label:"label_desc",value:0,key:"desc"}],r=U([]);Ie(()=>l.list,g=>{r.value=g.map($=>({...$,is_asc:$.is_asc?1:0}))});const u=g=>{r.value.splice(g,1),m()},y=(g,$)=>{r.value=$.map(w=>({...w})),m()},p=()=>{m()},m=()=>{let g=r.value.map($=>({...$,is_asc:$.is_asc==1}));a("change",g)},v=U(),C=()=>{v.value.open({formId:l.formId,selectedRows:l.list,selectedRowKeys:l.list.map(g=>g.name)})};return(g,$)=>{const w=et,S=Ye,k=It,b=rt,x=ct;return h(),D("div",null,[s("div",kC,[(h(!0),D(ee,null,se(r.value,A=>(h(),D("div",{class:"field-list-row",key:A.name},[s("div",wC,[s("span",CC,[c(d($n))])]),s("div",$C,[s("div",xC,[s("span",SC,_(A.name),1),s("span",DC,_(A.type),1)])]),s("div",AC,[c(S,{value:A.is_asc,"onUpdate:value":R=>A.is_asc=R,style:{width:"100%"},onChange:p},{default:f(()=>[(h(),D(ee,null,se(i,R=>c(w,{value:R.value,key:R.key},{default:f(()=>[T(_(d(o)(R.label)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),l.showDelete?(h(),D("div",OC,[s("span",{class:"del-btn",onClick:$[0]||($[0]=R=>u(g.index))},[c(k,{class:"del-icon",name:"close-circle"})])])):Z("",!0)]))),128))]),s("div",NC,[e.disabled?(h(),G(x,{key:0,title:d(o)("ph_select_database_first"),style:{width:"100%"}},{default:f(()=>[s("span",null,[c(b,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_sort_field")),1)]),_:1})])]),_:1},8,["title"])):(h(),G(b,{key:1,class:"add-btn",type:"dashed",block:"",onClick:C},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_sort_field")),1)]),_:1}))]),c(bC,{formId:e.formId,ref_key:"fieldSelectAlertRef",ref:v,onOk:y},null,8,["formId"])])}}},EC=_e(BC,[["__scopeId","data-v-41638961"]]),IC={class:"field-item"},FC={class:"field-name"},RC={class:"field-type"},LC={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(e){const n=e,o=U([]);return(a,l)=>{const i=It,r=xn;return h(),D("div",{class:"field-tree-wrapper",onWheel:l[1]||(l[1]=He(()=>{},["stop"])),onTouchmove:l[2]||(l[2]=He(()=>{},["stop"]))},[c(r,{selectedKeys:o.value,"onUpdate:selectedKeys":l[0]||(l[0]=u=>o.value=u),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":n.treeData},{switcherIcon:f(({switcherCls:u})=>[s("span",{class:qe(u)},[c(i,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:f(({dataRef:u})=>[s("div",IC,[s("span",FC,_(u.title),1),s("span",RC,_(u.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},VC=_e(LC,[["__scopeId","data-v-29131f6c"]]),MC={target:"_blank",href:"/#/database/list"},TC={class:"select-data-form"},jC={class:"node-box-content"},PC={class:"node-box-title"},qC={class:"text"},HC={class:"setting-label"},UC={class:"setting-box"},JC={class:"setting-box"},zC={class:"setting-label"},KC={class:"node-box-content"},GC={class:"node-box-title"},WC={class:"text"},ZC={class:"setting-box"},YC={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.select-data-form"),o=e,a=be("setData"),l=Ws();let i={};const r=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),u=ye(()=>[{title:"output_list",key:"output_list",type:"array<object>",children:r.formData.fields.map(A=>({title:A.name,key:A.name,type:A.type}))},{title:"row_num",key:"row_num",type:"integer"}]),y=({type:x,list:A})=>{r.formData.typ=x,r.formData.where=A,$()},p=x=>{r.formData.order=[...x],$()},m=(x,A)=>{A?(r.formData.form_name=A.name,r.formData.form_description=A.description,b(A.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.typ=1,r.formData.fields=[],r.formData.where=[],r.formData.order=[],r.formData.limit=100),$()},v=x=>{r.formData.fields=x,$()},C=()=>{$()},g=()=>{let x=o.node.dataRaw||o.node.node_params||"{}";i=JSON.parse(x);let A=w(i.form_select.where||[]);i.form_select.where=A,r.formData=i.form_select,r.formData.form_id&&b(r.formData.form_id),$()},$=()=>{let x={...Ht(r.formData)};x.where=S(x.where),i.form_select=x,a({...o.node,node_params:JSON.stringify(i)})},w=x=>{let A=[];return x.forEach(R=>{let E=JSON.parse(JSON.stringify(R)),B=E.rule.split("_");E.form_field_id=E.form_field_id*1,E.field_type=B[0],B.shift(),E.rule=B.join("_"),A.push(E)}),A},S=x=>{let A=[];return x.forEach(R=>{let E=JSON.parse(JSON.stringify(R));E.form_field_id=E.form_field_id*1,E.rule=R.field_type+"_"+R.rule,A.push(E)}),A},k=async()=>{const x=await l.getFormList();x&&(r.tableList=x)},b=async x=>{l.getFormFieldList({form_id:x}).then(A=>{A.forEach(R=>{R.id=R.id*1}),r.fieldList=A}).catch(()=>{})};return Ne(()=>{k(),g()}),(x,A)=>{const R=Vt;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name},{desc:f(()=>[s("span",null,[T(_(d(n)("title_desc_select_data"))+" ",1),s("a",MC,_(d(n)("btn_go_manage")),1)])]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",TC,[s("div",jC,[s("div",PC,[A[8]||(A[8]=s("img",{class:"input-icon",src:Jt,alt:""},null,-1)),s("span",qC,_(d(n)("label_input")),1)]),s("div",HC,[s("span",null,_(d(n)("label_data_table")),1)]),s("div",UC,[c(Xo,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":A[0]||(A[0]=E=>r.formData.form_id=E),onChange:m},null,8,["options","title","description","value"])]),s("div",JC,[c(vo,{title:d(n)("label_query_condition"),count:r.formData.where.length},{default:f(()=>[c(En,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:y},null,8,["disabled","where","field-options","type"])]),_:1},8,["title","count"])]),s("div",{class:"setting-box",onWheel:A[1]||(A[1]=He(()=>{},["stop"])),onTouchmove:A[2]||(A[2]=He(()=>{},["stop"]))},[c(vo,{title:d(n)("label_query_fields"),count:r.formData.fields.length},{default:f(()=>[c(On,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showInput:!1,showEmptyFieldRow:r.formData.form_id=="",list:r.formData.fields,onChange:v},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["title","count"])],32),s("div",{class:"setting-box",onWheel:A[3]||(A[3]=He(()=>{},["stop"])),onTouchmove:A[4]||(A[4]=He(()=>{},["stop"]))},[c(vo,{title:d(n)("label_sort"),count:r.formData.order.length},{default:f(()=>[c(EC,{"form-id":r.formData.form_id,disabled:!r.formData.form_id,list:r.formData.order,onChange:p},null,8,["form-id","disabled","list"])]),_:1},8,["title","count"])],32),s("div",zC,[s("span",null,_(d(n)("label_query_count")),1)]),s("div",{class:"setting-box",onWheel:A[6]||(A[6]=He(()=>{},["stop"])),onTouchmove:A[7]||(A[7]=He(()=>{},["stop"]))},[c(R,{min:1,max:1e3,value:r.formData.limit,"onUpdate:value":A[5]||(A[5]=E=>r.formData.limit=E),disabled:!r.formData.form_id,style:{width:"205px"},onChange:C},null,8,["value","disabled"])],32)]),s("div",KC,[s("div",GC,[A[9]||(A[9]=s("img",{class:"input-icon",src:Zt,alt:""},null,-1)),s("span",WC,_(d(n)("label_output")),1)]),s("div",ZC,[c(VC,{treeData:u.value},null,8,["treeData"])])])])]),_:1})}}},QC=_e(YC,[["__scopeId","data-v-03aa3b87"]]),XC={class:"problem-optimization-form"},e$={class:"gray-block"},t$={class:"gray-block-title"},s$={class:"flex-block-item"},o$={class:"number-box"},n$={class:"number-slider-box"},a$={class:"number-input-box"},l$={class:"number-box"},i$={class:"number-slider-box"},r$={class:"number-input-box"},d$={class:"number-box"},u$={class:"number-box"},c$={class:"number-slider-box"},_$={class:"number-input-box"},p$={class:"diy-form-item"},f$={class:"form-label"},v$={class:"form-content"},h$={class:"gray-block mt16"},m$={class:"gray-block-title"},g$={class:"array-form-box"},y$={class:"flex-block-item"},b$=["onClick"],k$={class:"form-item-list"},w$={class:"flex-block-item"},C$={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.question-node-form"),a=n,l=e,i=be("getNode"),r=Pt(),u=ye(()=>r.modelList),y=U(!1),p=()=>{y.value=!y.value},m=U(),v=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,categorys:[],role:1}),C=()=>{v.use_model&&v.use_model.toLowerCase().includes("deepseek-r1")?v.role=2:v.role=1},g=U([]);function $(){let q=i().getAllParentVariable();g.value=w(q)}function w(q){return q.forEach(O=>{O.typ=="node"?O.node_type==1?O.value="global":O.value=O.node_id:O.value=O.key,O.children&&O.children.length>0&&(O.children=w(O.children))}),q}const S=q=>{q||$()};function k(q){if(q){let O=q.split("."),M=O[0],j=O.filter((V,z)=>z>0).join(".");return[M,j]}return["global","question"]}const b=()=>{const q=v.model_config_id?+v.model_config_id:v.model_config_id,O=JSON.stringify({cate:{...v,question_value:v.question_value.join("."),model_config_id:q}});a("update-node",{...l.node,...v,node_params:O})},x=()=>{$();try{let q=l.node.dataRaw||l.node.node_params||"{}",O=JSON.parse(q).cate||{};O=JSON.parse(JSON.stringify(O));for(let M in O)if(M==="question_value")v.question_value=k(O.question_value);else if(M=="categorys")if(O.categorys&&O.categorys.length>0){let j=O.categorys.map(V=>({...V}));v[M]=j}else v[M]=[{category:"",next_node_key:"",key:nt(16)}];else v[M]=O[M];v.role=+O.role||1,!v.model_config_id&&u.value.length>0&&(v.model_config_id=u.value[0].id,v.use_model=u.value[0].children[0].name)}catch(q){}};Ie(()=>v,()=>{b()},{deep:!0});const A=()=>{v.categorys.push({category:"",next_node_key:"",key:nt(16)})},R=q=>{v.categorys.splice(q,1)},E=()=>Promise.resolve(),B=U({}),N=(q,O)=>{B.value=O},I=ye(()=>{if(!v.model_config_id)return!1;let q=v.model_config_id+"#"+v.use_model;return B.value[q]}),L=()=>{a("close")};return Ne(()=>{x()}),(q,O)=>{const M=rt,j=Dt,V=ct,z=Qt,H=Yt,K=ko,F=Tt,Y=Vt,le=Ms,J=xs,P=pt,W=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_question_classification"),onClose:L},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",XC,[s("div",{class:"node-form-content",onMousedown:O[11]||(O[11]=He(()=>{},["stop"]))},[c(W,{ref_key:"formRef",ref:m,layout:"vertical",model:v},{default:f(()=>[s("div",e$,[s("div",t$,_(d(o)("label_input")),1),c(j,{label:d(o)("label_llm_model"),name:"use_model"},{default:f(()=>[s("div",s$,[c(Gs,{modelType:"LLM",modeName:v.use_model,"onUpdate:modeName":O[0]||(O[0]=Q=>v.use_model=Q),modeId:v.model_config_id,"onUpdate:modeId":O[1]||(O[1]=Q=>v.model_config_id=Q),onLoaded:N,onChange:C,style:{width:"348px"}},null,8,["modeName","modeId"]),c(M,{onClick:p},{default:f(()=>[T(_(d(o)("btn_advanced_settings"))+" ",1),y.value?(h(),G(d(ds),{key:0})):(h(),G(d(Mo),{key:1}))]),_:1})])]),_:1},8,["label"]),y.value?(h(),G(j,{key:0,name:"role"},{label:f(()=>[s("span",null,_(d(o)("label_prompt_role"))+" ",1),c(V,null,{title:f(()=>[s("div",null,[T(_(d(o)("tip_prompt_role_desc"))+" ",1),s("div",null,_(d(o)("label_system_role_example")),1),s("div",null,'{"role": "system", "content": "'+_(d(o)("sample_custom_prompt"))+'"}',1)])]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[c(H,{value:v.role,"onUpdate:value":O[2]||(O[2]=Q=>v.role=Q)},{default:f(()=>[c(z,{value:1},{default:f(()=>[T(_(d(o)("label_system_role")),1)]),_:1}),c(z,{value:2},{default:f(()=>[T(_(d(o)("label_user_role")),1)]),_:1})]),_:1},8,["value"])]),_:1})):Z("",!0),y.value?(h(),G(j,{key:1,name:"temperature"},{label:f(()=>[s("span",null,_(d(o)("label_temperature"))+" ",1),c(V,null,{title:f(()=>[T(_(d(o)("tip_temperature_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",o$,[s("div",n$,[c(F,null,{default:f(()=>[c(K,{class:"custom-slider",value:v.temperature,"onUpdate:value":O[3]||(O[3]=Q=>v.temperature=Q),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),s("div",a$,[c(Y,{value:v.temperature,"onUpdate:value":O[4]||(O[4]=Q=>v.temperature=Q),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Z("",!0),y.value?(h(),G(j,{key:2,name:"max_token"},{label:f(()=>[s("span",null,_(d(o)("label_max_token"))+" ",1),c(V,null,{title:f(()=>[T(_(d(o)("tip_max_token_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",l$,[s("div",i$,[c(F,null,{default:f(()=>[c(K,{class:"custom-slider",value:v.max_token,"onUpdate:value":O[5]||(O[5]=Q=>v.max_token=Q),min:0,max:100*1024},null,8,["value"])]),_:1})]),s("div",r$,[c(Y,{value:v.max_token,"onUpdate:value":O[6]||(O[6]=Q=>v.max_token=Q),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Z("",!0),y.value&&I.value?(h(),G(j,{key:3,name:"enable_thinking"},{label:f(()=>[s("span",null,_(d(o)("label_deep_thinking"))+" ",1),c(V,null,{title:f(()=>[T(_(d(o)("tip_deep_thinking_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",d$,[c(le,{checked:v.enable_thinking,"onUpdate:checked":O[7]||(O[7]=Q=>v.enable_thinking=Q)},null,8,["checked"])])]),_:1})):Z("",!0),c(j,{name:"context_pair"},{label:f(()=>[s("span",null,_(d(o)("label_context_pair"))+" ",1),c(V,null,{title:f(()=>[T(_(d(o)("tip_context_pair_desc")),1)]),default:f(()=>[c(d(Re),{class:"question-icon"})]),_:1})]),default:f(()=>[s("div",u$,[s("div",c$,[c(F,null,{default:f(()=>[c(K,{class:"custom-slider",value:v.context_pair,"onUpdate:value":O[8]||(O[8]=Q=>v.context_pair=Q),min:0,max:50},null,8,["value"])]),_:1})]),s("div",_$,[c(Y,{value:v.context_pair,"onUpdate:value":O[9]||(O[9]=Q=>v.context_pair=Q),min:0,max:50},null,8,["value"])])])]),_:1}),s("div",p$,[s("div",f$,_(d(o)("label_user_question")),1),s("div",v$,[c(J,{value:v.question_value,"onUpdate:value":O[10]||(O[10]=Q=>v.question_value=Q),onDropdownVisibleChange:S,style:{width:"220px"},options:g.value,allowClear:!1,displayRender:({labels:Q})=>Q.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","options","displayRender","placeholder"])])])]),s("div",h$,[s("div",m$,_(d(o)("label_question_classification_settings")),1),s("div",g$,[(h(!0),D(ee,null,se(v.categorys,(Q,X)=>(h(),D("div",{class:"form-item-list",key:Q.key},[c(j,{label:null,name:["categorys",X,"category"],rules:{required:!0,validator:(de,Fe)=>E(de,Fe)}},{default:f(()=>[s("div",y$,[c(P,{class:"flex1",value:Q.category,"onUpdate:value":de=>Q.category=de,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),s("div",{class:"btn-hover-wrap",onClick:de=>R(X)},[c(d(at))],8,b$)])]),_:2},1032,["name","rules"])]))),128)),s("div",k$,[c(j,{label:null},{default:f(()=>[s("div",w$,[c(P,{class:"flex1",value:d(o)("label_default_category"),readonly:""},null,8,["value"])])]),_:1})]),c(M,{onClick:A,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_question_category")),1)]),_:1},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},$$=_e(C$,[["__scopeId","data-v-d0a0d8ca"]]),x$={class:"judge-node-form"},S$={class:"gray-block-title"},D$=["onClick"],A$={class:"condition-list-box"},O$={class:"left-select-box"},N$={class:"condition-body"},B$=["onClick"],E$={class:"btn-wrap"},I$={class:"add-btn-block"},F$={class:"gray-block mt8"},R$={class:"gray-block-title"},L$={class:"main-text"},V$={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})},nodeId:{type:String,default:""},lf:{type:Object,default:null}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.judge-node-form"),o=e,a=be("getNode"),l=be("setData"),i=U(),r=we({term:[]}),u=U([]);function y(){let B=a().getAllParentVariable(),I=o.lf.getNodeModelById(o.nodeId).properties.loop_parent_key,L=p(B);if(I){B=B.filter(O=>O.node_type!="25"),L=p(B);const q=o.lf.getNodeModelById(I);if(q){let O=q.properties.dataRaw||q.properties.node_params||"{}",M=JSON.parse(O).loop||{};const j=m(M.intermediate_params,q),V=L.find(z=>(z.node_id||z.value)==q.id);if(V){const z=[],H=new Set;[...V.children||[],...j].forEach(K=>{const F=K.original_value||K.value||K.key;H.has(F)||(H.add(F),z.push(K))}),V.children=z}else L.push({label:q.properties.node_name,node_id:q.id,node_type:q.properties.node_type,typ:"node",value:q.id,children:j})}}u.value=L}function p(B){return B.forEach(N=>{N.typ=="node"?N.node_type==1?N.value="global":N.value=N.node_id:N.value=N.key,N.children&&N.children.length>0&&(N.children=p(N.children))}),B}function m(B,N){let I=[];return B&&B.length&&B.forEach(L=>{L.key&&I.push({id:N.id,key:L.key,value:L.key,label:L.key,node_id:N.id,node_name:N.properties.node_name,node_type:N.properties.node_type,original_value:N.id+"."+L.key,text:L.key,typ:L.typ})}),I}const v=B=>{B||y()},C=()=>{try{let B=JSON.parse(o.node.node_params).term||[];B=B.map(N=>{let I=N.terms.map(L=>{let q="";for(let O=0;O<gs.length;O++)if(L.variable.indexOf(gs[O])>-1){q=gs[O];break}if(q!=""){let O=L.variable.split(".");L.variable=[O[0],q]}else L.variable=L.variable.split(".");return{...L,type:L.type>0?L.type:1,key:Math.random()*1e4}});return{...N,is_or:N.is_or?1:0,terms:I,key:Math.random()*1e4}}),r.term=B,g()}catch(B){}},g=()=>{let B=JSON.parse(JSON.stringify(r.term));B=B.map(N=>({is_or:N.is_or==1,next_node_key:N.next_node_key,terms:N.terms.map(I=>({variable:I.variable.join("."),is_mult:I.is_mult,type:I.type,value:I.value}))})),l({...o.node,term:B,node_params:JSON.stringify({term:B})})},$=B=>{r.term[B].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},w=(B,N)=>{r.term[B].terms.splice(N,1)},S=()=>{r.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},k=B=>{r.term.splice(B,1)},b=B=>{let N=R(B);B.is_mult=N.includes("array"),B.type=void 0};let x=[{label:n("opt_equal"),value:1},{label:n("opt_not_equal"),value:2},{label:n("opt_contain"),value:3},{label:n("opt_not_contain"),value:4},{label:n("opt_is_empty"),value:5},{label:n("opt_not_empty"),value:6}],A=[{label:n("opt_contain_one"),value:3},{label:n("opt_not_contain_one"),value:4},{label:n("opt_is_empty"),value:5},{label:n("opt_not_empty"),value:6}];function R(B){let N="";if(B.variable&&B.variable.length>0){let I=u.value.filter(L=>L.key==B.variable[0]);I&&I.length&&(N=I[0].typ),N=="object"&&(I[0]&&I[0].children&&(I=I[0].subs.filter(L=>L.key==B.variable[1])),I&&I.length&&(N=I[0].typ),N=="object"&&(I[0]&&I[0].children&&(I=I[0].subs.filter(L=>L.key==B.variable[2])),I&&I.length&&(N=I[0].typ)))}return N}function E(B){if(!B.variable)return[];let N=R(B);return N==""?B.is_mult?A:x:N=="boole"?[{label:n("opt_equal"),value:1},{label:n("opt_not_equal"),value:2}]:N.includes("array")?A:x}return Ie(()=>r,()=>{g()},{deep:!0}),Ne(()=>{y(),C()}),(B,N)=>{const I=_s,L=et,q=Ye,O=xs,M=pt,j=rt,V=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name},{desc:f(()=>[s("span",null,_(d(n)("desc_judge_condition")),1)]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",x$,[s("div",{class:"form-block",onMousedown:N[1]||(N[1]=He(()=>{},["stop"]))},[c(V,{ref_key:"formRef",ref:i,layout:"vertical",model:r},{default:f(()=>[c(d(ja),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:r.term,"onUpdate:modelValue":N[0]||(N[0]=z=>r.term=z),"item-key":"key"},{item:f(({element:z,index:H})=>[(h(),D("div",{class:"gray-block",key:z.key},[s("div",S$,[c(I,{gap:8},{default:f(()=>[c(d($n),{class:"icon drag-btn"}),T(_(H==0?d(n)("label_if"):d(n)("label_else_if")),1)]),_:2},1024),r.term.length>1?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:K=>k(H)},[c(d(at))],8,D$)):Z("",!0)]),s("div",A$,[s("div",O$,[c(q,{size:"small",value:z.is_or,"onUpdate:value":K=>z.is_or=K,bordered:!1,style:{width:"64px"}},{default:f(()=>[c(L,{value:0},{default:f(()=>[T(_(d(n)("label_and")),1)]),_:1}),c(L,{value:1},{default:f(()=>[T(_(d(n)("label_or")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),s("div",N$,[(h(!0),D(ee,null,se(z.terms,(K,F)=>(h(),D("div",{class:"condition-item",key:K.key},[c(O,{value:K.variable,"onUpdate:value":Y=>K.variable=Y,onChange:Y=>b(K),onDropdownVisibleChange:v,style:{width:"160px"},options:u.value,allowClear:!1,displayRender:({labels:Y})=>Y.join("/"),"field-names":{children:"children"},placeholder:d(n)("ph_select")},null,8,["value","onUpdate:value","onChange","options","displayRender","placeholder"]),c(q,{value:K.type,"onUpdate:value":Y=>K.type=Y,style:{width:"120px"},placeholder:d(n)("ph_select")},{default:f(()=>[(h(!0),D(ee,null,se(E(K),Y=>(h(),G(L,{value:Y.value,key:Y.value},{default:f(()=>[T(_(Y.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"]),K.type!=5&&K.type!=6?(h(),G(M,{key:0,placeholder:d(n)("ph_input"),value:K.value,"onUpdate:value":Y=>K.value=Y,style:{width:"150px"}},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:Y=>w(H,F)},[c(d(at))],8,B$)]))),128))])]),s("div",E$,[c(j,{onClick:K=>$(H),icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(n)("label_add_condition")),1)]),_:1},8,["onClick","icon"])])]))]),_:1},8,["modelValue"]),s("div",I$,[c(j,{onClick:S,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(n)("label_add_branch")),1)]),_:1},8,["icon"])]),s("div",F$,[s("div",R$,_(d(n)("label_else")),1),s("div",L$,_(d(n)("msg_else_default_branch")),1)])]),_:1},8,["model"])],32)])]),_:1})}}},M$=_e(V$,[["__scopeId","data-v-36e33bf2"]]),T$={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:vt,AtInput:xe,FullscreenOutlined:Wt,FullAtInput:js,NodeFormLayout:ft},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(){const{t:e}=fe("views.workflow.components.node-form-drawer.specify-reply-form");return{t:e}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const e=this.getGraph();let n=this.node.dataRaw||this.node.node_params||"{}";const a=JSON.parse(n).reply||{content:"",content_tags:[]};this.formState.content=a.content,this.formState.content_tags=a.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),e.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(e){this.$refs.atInputRef&&ns.includes(e.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(n=>{if(n.node_id==e.node_id){let o=n.label.split("/");o[0]=e.node_name,n.label=o.join("/"),n.node_name=e.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let e=this.getNode().getAllParentVariable();this.valueOptions=e||[]},update(){let e=JSON.parse(this.node.node_params);e.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(e)})},showAtList(e){e&&this.getValueOptions()},changeValue(e,n){this.formState.content_tags=n,this.formState.content=e,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},j$={class:"specify-reply-form"},P$={class:"node-content"},q$={class:"form-label"},H$={class:"form-item-label"},U$={class:"flex-between-box"},J$={class:"form-item-body"};function z$(e,n,o,a,l,i){const r=tt("NodeFormHeader"),u=tt("FullscreenOutlined"),y=tt("AtInput"),p=tt("FullAtInput"),m=tt("NodeFormLayout");return h(),G(m,null,{header:f(()=>[c(r,{title:o.node.node_name,iconName:o.node.node_icon_name,desc:a.t("desc_specify_reply")},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",j$,[s("div",P$,[s("div",q$,_(a.t("label_output")),1),s("div",{class:"form-item",onMousedown:n[2]||(n[2]=He(()=>{},["stop"]))},[s("div",H$,[s("div",U$,[s("div",null,_(a.t("label_message_content")),1),s("div",{class:"btn-hover-wrap",onClick:n[0]||(n[0]=(...v)=>i.handleOpenFullAtModal&&i.handleOpenFullAtModal(...v))},[c(u)])])]),s("div",J$,[c(y,{inputStyle:"height: 100px;",options:l.valueOptions,defaultSelectedList:l.formState.content_tags,defaultValue:l.formState.content,ref:"atInputRef",placeholder:a.t("ph_input_message_content"),"input-style":"height: 130px",type:"textarea",onOpen:i.showAtList,onChange:n[1]||(n[1]=(v,C)=>i.changeValue(v,C))},null,8,["options","defaultSelectedList","defaultValue","placeholder","onOpen"])])],32)]),c(p,{options:l.valueOptions,defaultSelectedList:l.formState.content_tags,defaultValue:l.formState.content,placeholder:a.t("ph_input_message_content"),type:"textarea",onOpen:i.showAtList,onChange:n[3]||(n[3]=(v,C)=>i.changeValue(v,C)),onOk:i.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","placeholder","onOpen","onOk"])])]),_:1})}const K$=_e(T$,[["render",z$],["__scopeId","data-v-93feb971"]]),G$={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:vt,AtInput:xe,FullscreenOutlined:Wt,FullAtInput:js,NodeFormLayout:ft},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(){const{t:e}=fe("views.workflow.components.node-form-drawer.immediately-reply-form");return{t:e}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const e=this.getGraph();let n=this.node.dataRaw||this.node.node_params||"{}";const a=JSON.parse(n).immediately_reply||{content:"",content_tags:[]};this.formState.content=a.content,this.formState.content_tags=a.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),e.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(e){this.$refs.atInputRef&&ns.includes(e.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(n=>{if(n.node_id==e.node_id){let o=n.label.split("/");o[0]=e.node_name,n.label=o.join("/"),n.node_name=e.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let e=this.getNode().getAllParentVariable();this.valueOptions=e||[]},update(){let e=JSON.parse(this.node.node_params);e.immediately_reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(e)})},showAtList(e){e&&this.getValueOptions()},changeValue(e,n){this.formState.content_tags=n,this.formState.content=e,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},W$={class:"specify-reply-form"},Z$={class:"node-content"},Y$={class:"form-label"},Q$={class:"form-item-label"},X$={class:"flex-between-box"},e8={class:"form-item-body"};function t8(e,n,o,a,l,i){const r=tt("NodeFormHeader"),u=tt("FullscreenOutlined"),y=tt("AtInput"),p=tt("FullAtInput"),m=tt("NodeFormLayout");return h(),G(m,null,{header:f(()=>[c(r,{title:o.node.node_name,iconName:o.node.node_icon_name,desc:a.t("desc_immediately_reply")},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",W$,[s("div",Z$,[s("div",Y$,_(a.t("label_output")),1),s("div",{class:"form-item",onMousedown:n[2]||(n[2]=He(()=>{},["stop"]))},[s("div",Q$,[s("div",X$,[s("div",null,_(a.t("label_message_content")),1),s("div",{class:"btn-hover-wrap",onClick:n[0]||(n[0]=(...v)=>i.handleOpenFullAtModal&&i.handleOpenFullAtModal(...v))},[c(u)])])]),s("div",e8,[c(y,{inputStyle:"height: 100px;",options:l.valueOptions,defaultSelectedList:l.formState.content_tags,defaultValue:l.formState.content,ref:"atInputRef",placeholder:a.t("ph_input_message_content"),"input-style":"height: 130px",type:"textarea",onOpen:i.showAtList,onChange:n[1]||(n[1]=(v,C)=>i.changeValue(v,C))},null,8,["options","defaultSelectedList","defaultValue","placeholder","onOpen"])])],32)]),c(p,{options:l.valueOptions,defaultSelectedList:l.formState.content_tags,defaultValue:l.formState.content,placeholder:a.t("ph_input_message_content"),type:"textarea",onOpen:i.showAtList,onChange:n[3]||(n[3]=(v,C)=>i.changeValue(v,C)),onOk:i.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","placeholder","onOpen","onOk"])])]),_:1})}const s8=_e(G$,[["render",t8],["__scopeId","data-v-4543a097"]]),o8=["src"],n8={class:"mcp-form"},a8={class:"node-options"},l8={class:"options-title"},i8={class:"options-item-tit"},r8={class:"option-label"},d8={class:"option-type"},u8={class:"field-list-item"},c8={class:"field-label"},_8={class:"field-type"},p8={class:"desc"},f8={class:"node-options"},v8={class:"options-title"},h8={class:"options-item"},m8={class:"options-item-tit"},g8={class:"option-label"},y8={class:"desc"},b8={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.mcp-form"),o=be("getNode"),a=be("setData"),l=e,i=we({mcpInfo:{},toolInfo:{}}),r=we({params:{}}),u=U([]),y=we({mcp:{}});function p(){m();const $=JSON.parse(l.node.node_params);Object.assign(y,$),g()}function m(){u.value=o().getAllParentVariable()}function v($,w,S){$.value=w,$.tags=S,C()}function C(){let $={arguments:{},tag_map:{}};for(let w in r.params){let S=r.params[w].value,k=i.toolInfo.inputSchema.properties[w]||{};k.type=="string"?S=String(S):["number","integer"].includes(k.type)&&(S=Number(S)),$.arguments[w]=S,$.tag_map[w]=r.params[w].tags}y.mcp.arguments=$.arguments,y.mcp.tag_map=$.tag_map||[],a({...l.node,node_params:JSON.stringify(y)})}const g=()=>{al({provider_id:y.mcp.provider_id}).then($=>{var x;i.mcpInfo=($==null?void 0:$.data)||{};let w=rs((x=i.mcpInfo)==null?void 0:x.tools,[]);i.toolInfo=w.find(A=>A.name==y.mcp.tool_name);let S=i.toolInfo.inputSchema||{},k=(S==null?void 0:S.properties)||{},b=(S==null?void 0:S.required)||[];k=JSON.parse(JSON.stringify(k));for(let A in k)k[A].value=String(y.mcp.arguments[A]||""),k[A].tags=y.mcp.tag_map?y.mcp.tag_map[A]:[],k[A].required=b.includes(A);r.params=k})};return Ne(()=>{p()}),($,w)=>(h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name},{"node-icon":f(()=>[s("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,o8)]),desc:f(()=>[s("span",null,_(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:f(()=>[s("div",n8,[s("div",a8,[s("div",l8,[s("div",null,[w[0]||(w[0]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(n)("label_input")),1)])]),(h(!0),D(ee,null,se(r.params,(S,k)=>(h(),D("div",{key:k,class:qe(["options-item",{"is-required":S.required}])},[s("div",i8,[s("div",r8,_(k),1),s("div",d8,_(S.type),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"min-height: 32px;",options:u.value,defaultSelectedList:S.tags,defaultValue:S.value,ref_for:!0,ref:"atInputRef",onOpen:m,onChange:(b,x)=>v(S,b,x),placeholder:d(n)("ph_input_content")},{option:f(({label:b,payload:x})=>[s("div",u8,[s("div",c8,_(b),1),s("div",_8,_(x.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",p8,_(S.description),1)],2))),128))]),s("div",f8,[s("div",v8,[s("div",null,[w[1]||(w[1]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(n)("label_output")),1)])]),s("div",h8,[s("div",m8,[s("div",g8,_(d(n)("label_output_text")),1)]),w[2]||(w[2]=s("div",{class:"options-item-tit"},[s("div",{class:"option-label"},"text"),s("div",{class:"option-type"},"string")],-1)),s("div",y8,_(d(n)("msg_tool_generated_content")),1)])])])]),_:1}))}},k8=_e(b8,[["__scopeId","data-v-14a8a557"]]),w8="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%2331gmof37u__clip0_10933_119689)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M4.33325%2011.6719H2.33325V13.6719'/%3e%3cpath%20d='M13.6667%2013.6719H11.6667V11.6719'/%3e%3cpath%20d='M11.6667%204.32813H13.6667V2.32812'/%3e%3cpath%20d='M2.33325%202.32812H4.33325V4.32813'/%3e%3cpath%20d='M4.33325%202.42969C2.52585%203.62217%201.33325%205.67097%201.33325%207.99834C1.33325%208.3382%201.35869%208.67214%201.40775%208.99834'/%3e%3cpath%20d='M9.00005%2014.5974C8.67385%2014.6464%208.33991%2014.6719%208.00005%2014.6719C5.67268%2014.6719%203.62388%2013.4793%202.4314%2011.6719'/%3e%3cpath%20d='M14.5922%207C14.6413%207.3262%2014.6667%207.66013%2014.6667%208C14.6667%2010.3274%2013.4741%2012.3762%2011.6667%2013.5687'/%3e%3cpath%20d='M7%201.40262C7.3262%201.35356%207.66013%201.32812%208%201.32812C10.3274%201.32812%2012.3762%202.52072%2013.5687%204.32813'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='31gmof37u__clip0_10933_119689'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",C8="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_12353_121923)'%3e%3cpath%20d='M3.99992%201.33594H1.33325V4.0026H3.99992V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%2012H12V14.6667H14.6667V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M3.99992%2012H1.33325V14.6667H3.99992V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%201.33594H12V4.0026H14.6667V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M2.66675%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M13.3333%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%202.66406H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%2013.3359H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.33325%205.33594H8.53325V7.46927H10.6666V10.6693H7.46659V8.53594H5.33325V5.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_12353_121923'%3e%3crect%20width='16'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",$8="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2010.3307H12.6667V1.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.99992%207H3.33325V14.3333'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%203.66406L12.6667%201.66406L10.6667%203.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.33325%2012.3359L3.33325%2014.3359L1.33325%2012.3359'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",en="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",x8={class:"preview-img-box"},S8={class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},D8={class:"custom-slick-arrow",style:{right:"10px"}},A8=["onClick","src"],O8={style:{display:"none"}},N8={__name:"index",props:{currentImageList:{type:Array,default:()=>[]}},setup(e){const n=e,o=U(!1),a=U(0),l=i=>{a.value=i,o.value=!0};return(i,r)=>{const u=pi,y=fi,p=vi;return h(),D("div",x8,[c(u,{arrows:"",dots:!1},{prevArrow:f(()=>[s("div",S8,[c(d(_i))])]),nextArrow:f(()=>[s("div",D8,[c(d(Wo))])]),default:f(()=>[(h(!0),D(ee,null,se(n.currentImageList,(m,v)=>(h(),D("div",{class:"img-list-item",key:m},[s("img",{onClick:C=>l(v),src:m,alt:""},null,8,A8)]))),128))]),_:1}),s("div",O8,[c(p,{preview:{visible:o.value,current:a.value,onVisibleChange:m=>o.value=m}},{default:f(()=>[(h(!0),D(ee,null,se(n.currentImageList,m=>(h(),G(y,{key:m,src:m},null,8,["src"]))),128))]),_:1},8,["preview"])])])}}},pl=_e(N8,[["__scopeId","data-v-69cc841a"]]),B8={class:"modal-title-block"},E8={key:0,class:"run-detail"},I8={class:"flex-content-box"},F8={class:"test-model-box"},R8={class:"top-title"},L8={key:2,class:"input-list-box"},V8={class:"add-btn-box"},M8={key:0,class:"result-list-box loading-box"},T8={key:1,class:"result-list-box"},j8=["onClick"],P8={class:"status-block"},q8={class:"icon-name-box"},H8=["src"],U8={class:"node-name"},J8={key:0,class:"time-tag"},z8={class:"right-active-icon"},K8={class:"save-btn-box"},G8={class:"preview-box"},W8={class:"preview-title"},Z8={class:"title-text"},Y8={class:"icon-name-box"},Q8=["src"],X8={class:"node-name"},ex={key:0,class:"time-tag"},tx={key:0,class:"preview-content-block"},sx={class:"title-block"},ox={class:"preview-img-box"},nx={class:"preview-content-block"},ax={class:"title-block"},lx={class:"preview-code-box"},ix={class:"preview-content-block"},rx={class:"title-block"},dx={class:"preview-code-box"},ux={class:"preview-content-block"},cx={class:"title-block"},_x={class:"preview-code-box"},px={__name:"run-test",props:{loop_node_key:{type:String,default:""}},emits:["save"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.nodes.custom-group-node.components.run-test"),l=Pt(),i=ye(()=>l.robotInfo.isLockedByOther),r=e;ye(()=>[]);const u=U(!1),y=U(""),p=U([]),m=ye(()=>y.value?p.value.filter(V=>V.node_key==y.value)[0]:null),v=ye(()=>{let V=[];if(m.value&&m.value.node_type==33){let z=m.value.output;for(let H in z)H.includes("picture_url_")&&V.push(z[H])}return V}),C=U(!1),g=we({is_draft:!0,robot_key:l.robotInfo.robot_key,question:"",openid:""}),$=async()=>{if(i.value){Me.warning(a("msg_locked_by_other"));return}l.robotInfo.loop_save_canvas_status++,await Ze();let V=localStorage.getItem("workflow_loop_run_test_data")||"{}";V=JSON.parse(V),g.question=V.question||"",g.openid=V.openid||"",g.global=V.global||"",p.value=[],y.value="",setTimeout(()=>{b()},1e3),u.value=!0},w=U([]),S=U(!1),k=U(!1),b=()=>{Yl({robot_key:g.robot_key,loop_node_key:r.loop_node_key}).then(V=>{S.value=V.data.is_need_question,k.value=V.data.is_need_openid,S.value||(g.question=""),w.value=V.data.loop_test_params.map(z=>({...z,field:{...z.field,Vals:x(z.field)}}))})};function x(V){return V.typ=="string"||V.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const A=(V,z)=>{V.splice(z,1)},R=V=>{V.push({value:"",key:Math.random()*1e4})},E=U(null),B=U(0),N=U(0),I=()=>{E.value.validate().then(()=>{let V={...g,loop_node_key:r.loop_node_key},z=JSON.parse(JSON.stringify(w.value));z.forEach(H=>{H.field.typ.includes("array")&&(H.field.Vals=H.field.Vals.map(K=>K.value))}),V.loop_test_params=JSON.stringify(z),C.value=!0,p.value=[],localStorage.setItem("workflow_loop_run_test_data",JSON.stringify({...V})),Zl({...V}).then(H=>{Me.success(a("msg_test_completed"));let K=H.data.node_logs||[];B.value=H.data.use_token,N.value=H.data.use_mills,L(K)}).catch(H=>{p.value=[];let K=H.data.node_logs||[];K&&K.length&&L(K)}).finally(()=>{C.value=!1})})},L=V=>{var z;p.value=V.map(H=>({...H,is_success:H.error_msg==="<nil>",node_icon:Eo(H.node_type)})),y.value=(z=p.value[0])==null?void 0:z.node_key},q=V=>{y.value=V.node_key},O=V=>{bo(JSON.stringify(m.value[V])),Me.success(a("msg_copy_success"))};function M(V){return V.field.key.replace(V.node_key+".","")}return n({open:()=>{$()}}),(V,z)=>{const H=Is,K=_s,F=pt,Y=Dt,le=Vt,J=Tt,P=rt,W=St,Q=os,X=wt;return h(),D("div",null,[c(X,{open:u.value,"onUpdate:open":z[5]||(z[5]=de=>u.value=de),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:f(()=>[s("div",B8,[T(_(d(a)("btn_run_test"))+" ",1),p.value.length?(h(),D("div",E8,[s("span",null,_(d(a)("label_total_time"))+_(d(An)(N.value)),1),s("span",null,_(d(a)("label_token_consumption"))+_(B.value)+" "+_(d(a)("unit_tokens")),1)])):Z("",!0)])]),default:f(()=>[s("div",I8,[s("div",F8,[s("div",R8,_(d(a)("title_start_node_params")),1),c(W,{model:g,ref_key:"formRef",ref:E,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:f(()=>[S.value?(h(),G(Y,{key:0,name:"question",rules:[{required:!0,message:d(a)("msg_input_question")}]},{label:f(()=>[c(K,{gap:4},{default:f(()=>[z[7]||(z[7]=T("question ",-1)),c(H,{style:{margin:"0"}},{default:f(()=>[...z[6]||(z[6]=[T("string",-1)])]),_:1})]),_:1})]),default:f(()=>[c(F,{placeholder:d(a)("ph_input"),value:g.question,"onUpdate:value":z[0]||(z[0]=de=>g.question=de)},null,8,["placeholder","value"])]),_:1},8,["rules"])):Z("",!0),k.value?(h(),G(Y,{key:1,name:"openid",rules:[{required:!0,message:d(a)("msg_input_openid")}]},{label:f(()=>[c(K,{gap:4},{default:f(()=>[z[9]||(z[9]=T("openid ",-1)),c(H,{style:{margin:"0"}},{default:f(()=>[...z[8]||(z[8]=[T("string",-1)])]),_:1})]),_:1})]),default:f(()=>[c(F,{placeholder:d(a)("ph_input"),value:g.openid,"onUpdate:value":z[1]||(z[1]=de=>g.openid=de)},null,8,["placeholder","value"])]),_:1},8,["rules"])):Z("",!0),(h(!0),D(ee,null,se(w.value,de=>(h(),G(Y,{key:de.node_key,rules:[{required:de.field.required,message:d(a)("msg_input_field",{field:de.node_name})}]},{label:f(()=>[c(K,{gap:4},{default:f(()=>[T(_(de.node_name)+" "+_(M(de)),1),c(H,{style:{margin:"0"}},{default:f(()=>[T(_(de.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:f(()=>[de.field.typ=="string"?(h(),G(F,{key:0,placeholder:d(a)("ph_input"),value:de.field.Vals,"onUpdate:value":Fe=>de.field.Vals=Fe},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),de.field.typ=="number"?(h(),G(le,{key:1,style:{width:"100%"},placeholder:d(a)("ph_input"),value:de.field.Vals,"onUpdate:value":Fe=>de.field.Vals=Fe},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),de.field.typ.includes("array")?(h(),D("div",L8,[(h(!0),D(ee,null,se(de.field.Vals,(Fe,De)=>(h(),D("div",{class:"input-list-item",key:De},[c(J,null,{default:f(()=>[c(F,{placeholder:d(a)("ph_input"),value:Fe.value,"onUpdate:value":$e=>Fe.value=$e},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),de.field.Vals.length>1?(h(),G(d(at),{key:0,onClick:$e=>A(de.field.Vals,De)},null,8,["onClick"])):Z("",!0)]))),128)),s("div",V8,[c(P,{onClick:Fe=>R(de.field.Vals),block:"",type:"dashed"},{default:f(()=>[T(_(d(a)("btn_add")),1)]),_:1},8,["onClick"])])])):Z("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),C.value?(h(),D("div",M8,[C.value?(h(),G(Q,{key:0,tip:d(a)("msg_test_generating")},null,8,["tip"])):Z("",!0)])):Z("",!0),p.value.length>0?(h(),D("div",T8,[(h(!0),D(ee,null,se(p.value,(de,Fe)=>(h(),D("div",{class:qe(["list-item-block",{active:y.value==de.node_key}]),onClick:De=>q(de),key:Fe},[s("div",P8,[de.is_success?(h(),G(d(wo),{key:0,style:{color:"#138b1b"}})):(h(),G(d(Zo),{key:1,style:{color:"#d81e06"}}))]),s("div",q8,[s("img",{src:de.node_icon,alt:""},null,8,H8),s("div",U8,_(de.node_name),1)]),de.is_success?(h(),D("div",J8,_(de.use_time)+"ms",1)):Z("",!0),s("div",z8,[c(d(Wo))])],10,j8))),128))])):Z("",!0),s("div",K8,[c(P,{loading:C.value,onClick:I,style:{"background-color":"#00ad3a"},type:"primary"},{default:f(()=>[c(d(bs)),T(_(d(a)("btn_run_test")),1)]),_:1},8,["loading"])])]),s("div",G8,[m.value?(h(),D(ee,{key:0},[s("div",W8,[s("div",Z8,_(d(a)("title_log_details")),1),s("div",Y8,[s("img",{src:m.value.node_icon,alt:""},null,8,Q8),s("div",X8,_(m.value.node_name),1)]),m.value.is_success?(h(),D("div",ex,_(m.value.use_time)+"ms",1)):Z("",!0)]),v.value.length>0?(h(),D("div",tx,[s("div",sx,_(d(a)("title_generated_image_logs")),1),s("div",ox,[c(pl,{currentImageList:v.value},null,8,["currentImageList"])])])):Z("",!0),s("div",nx,[s("div",ax,[T(_(d(a)("title_input")),1),c(d(ms),{onClick:z[2]||(z[2]=de=>O("input"))})]),s("div",lx,[c(d(hs),{data:m.value.input},null,8,["data"])])]),s("div",ix,[s("div",rx,[T(_(d(a)("title_output")),1),c(d(ms),{onClick:z[3]||(z[3]=de=>O("node_output"))})]),s("div",dx,[c(d(hs),{data:m.value.node_output},null,8,["data"])])]),s("div",ux,[s("div",cx,[T(_(d(a)("title_run_log")),1),c(d(ms),{onClick:z[4]||(z[4]=de=>O("output"))})]),s("div",_x,[c(d(hs),{data:m.value.output},null,8,["data"])])])],64)):Z("",!0)])])]),_:1},8,["open"])])}}},fl=_e(px,[["__scopeId","data-v-d35d8c9d"]]),fx={class:"problem-optimization-form"},vx={class:"node-form-content"},hx={class:"gray-block"},mx={class:"gray-block-title"},gx={class:"flex-form-item"},yx={class:"form-label"},bx={key:0,class:"gray-block"},kx={class:"gray-block-title"},wx={class:"output-box"},Cx={class:"output-block"},$x={class:"output-item"},xx={class:"output-item"},Sx={class:"output-item",style:{flex:"1"}},Dx={class:"array-form-box"},Ax={class:"flex-block-item",style:{gap:"12px"}};const Ox={class:"gray-block"},Nx={class:"gray-block-title"},Bx={class:"output-box"},Ex={class:"output-block"},Ix={class:"output-item"},Fx={class:"output-item",style:{"margin-left":"4px"}},Rx={class:"output-item",style:{flex:"1"}},Lx={class:"array-form-box"},Vx={class:"flex-block-item",style:{gap:"12px"}},Mx={style:{width:"40%"}},Tx={class:"field-list-item"},jx={class:"field-label"},Px={class:"field-type"},qx=["onClick"],Hx={class:"gray-block"},Ux={class:"gray-block-title"},Jx={class:"output-box"},zx={class:"output-block"},Kx={class:"output-item"},Gx={class:"output-item",style:{"margin-left":"4px"}},Wx={class:"output-item",style:{width:"38%"}},Zx={class:"array-form-box"},Yx={class:"flex-block-item",style:{gap:"12px"}},Qx=["onClick"],Xx={__name:"custom-group-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.custom-group-node.custom-group-node-form"),a=n,l=e,i=be("getNode"),r=U([]),u=U([]);U([]);const y=U(null),p=we({}),m=()=>{y.value.open()},v=(le,J,P)=>{if(le){let W=`at_input_${J}_${P}`;p[W]=le}},C=(le,J,P)=>{P.tags=J,P.value=le};function g(le){return le.forEach(J=>{J.typ=="node"?J.node_type==1?J.value="global":J.value=J.node_id:J.value=J.key,J.children&&J.children.length>0&&(J.children=g(J.children))}),le}const $=()=>{let le=i().getAllParentVariable();le.forEach(J=>{J.tags=J.tags||[]}),le=le.filter(J=>J.group_node_key!=J.loop_parent_key).filter(J=>J.node_id!=J.group_node_key),r.value=le};function w(){let le=i().getAllParentVariable();le=g(le),le=le.filter(J=>J.group_node_key!=J.loop_parent_key).filter(J=>J.node_id!=J.group_node_key),u.value=S(le)}function S(le){const J=P=>!P||P.length===0?[]:P.map(W=>{const Q=J(W.children);return W.typ.includes("array")||Q&&Q.length>0?{...W,children:Q}:null}).filter(Boolean);return J(le)}const k=le=>{le||w()},b=U(),x={key:"",typ:"",value:"",cu_key:Math.random()*1e4},A={key:"",typ:"",value:"",cu_key:Math.random()*1e4},R={key:"",typ:"",value:"",cu_key:Math.random()*1e4},E=we({loop_type:"array",loop_number:"",loop_arrays:[],intermediate_params:[],output:[]}),B=ye(()=>{let le=E.intermediate_params,J=[];return le.forEach(P=>{P.key&&J.push({children:[],id:l.nodeId,key:P.key,label:P.key,node_id:l.nodeId,node_name:l.node.node_name,node_type:"25",original_value:l.nodeId+"."+P.key,text:P.key,typ:P.typ,value:P.key})}),J.length>0?[{label:l.node.node_name,node_id:l.nodeId,node_type:"25",typ:"node",value:l.nodeId,children:J}]:[]}),N=()=>{const le=JSON.stringify({loop:{...E,loop_arrays:E.loop_arrays.map(J=>({...J,value:J.value?J.value.join("."):""})),output:E.output.map(J=>({...J,value:J.value?J.value.join("."):""}))}});a("update-node",{...l.node,...E,node_params:le})};function I(le){if(le){let J=le.split("."),P=J[0],W=J.filter((Q,X)=>X>0).join(".");return[P,W]}return[]}const L=()=>{try{let le=l.node.dataRaw||l.node.node_params||"{}",J=JSON.parse(le).loop||{};J=JSON.parse(JSON.stringify(J)),$(),w(),E.loop_type=J.loop_type,E.loop_number=J.loop_number,E.loop_arrays=J.loop_arrays.map(P=>({...P,value:I(P.value)})),E.intermediate_params=J.intermediate_params.map(P=>({...P})),E.output=J.output.map(P=>({...P,value:I(P.value)})),E.loop_arrays.length==0&&(E.loop_arrays=[x]),E.intermediate_params.length==0&&(E.intermediate_params=[A]),E.output.length==0&&(E.output=[R])}catch(le){}};Ie(()=>E,()=>{N()},{deep:!0});const q=()=>{E.loop_arrays.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},O=le=>{E.loop_arrays.splice(le,1)},M=(le,J,P)=>{P?J.typ=P[P.length-1].typ:J.typ=""},j=()=>{E.intermediate_params.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},V=le=>{E.intermediate_params.splice(le,1)},z=()=>{E.output.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},H=le=>{E.output.splice(le,1)},K=(le,J)=>{if(le&&le.length){let P=B.value.filter(W=>W.value==le[0])[0].children;P&&P.length&&(J.typ=P.filter(W=>W.value==le[1])[0].typ)}else J.typ=""},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],Y=()=>{a("close")};return Ne(()=>{L()}),(le,J)=>{const P=ct,W=et,Q=Ye,X=Vt,de=pt,Fe=xs,De=Tt,$e=Dt,Ue=rt,ie=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_custom_group"),onClose:Y},{runBtn:f(()=>[c(P,null,{title:f(()=>[T(_(d(o)("tooltip_run_test")),1)]),default:f(()=>[s("div",{class:"action-btn",onClick:m},[c(d(bs),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName","desc"])]),default:f(()=>[s("div",fx,[s("div",vx,[c(ie,{ref_key:"formRef",ref:b,layout:"vertical",model:E},{default:f(()=>[s("div",hx,[s("div",mx,[J[2]||(J[2]=s("img",{src:w8,alt:""},null,-1)),T(" "+_(d(o)("label_loop_settings"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_loop_settings")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",gx,[s("div",yx,_(d(o)("label_loop_type")),1),c(Q,{value:E.loop_type,"onUpdate:value":J[0]||(J[0]=ge=>E.loop_type=ge),style:{width:"170px"}},{default:f(()=>[c(W,{value:"array"},{default:f(()=>[T(_(d(o)("label_use_array")),1)]),_:1}),c(W,{value:"number"},{default:f(()=>[T(_(d(o)("label_specify_count")),1)]),_:1})]),_:1},8,["value"]),E.loop_type=="number"?(h(),G(X,{key:0,placeholder:d(o)("ph_input"),style:{flex:"1"},value:E.loop_number,"onUpdate:value":J[1]||(J[1]=ge=>E.loop_number=ge),min:1,max:100},null,8,["placeholder","value"])):Z("",!0)])]),E.loop_type=="array"?(h(),D("div",bx,[s("div",kx,[J[3]||(J[3]=s("img",{src:C8,alt:""},null,-1)),T(" "+_(d(o)("label_loop_array"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_loop_array")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",wx,[s("div",Cx,[s("div",$x,_(d(o)("label_param_key")),1),s("div",xx,_(d(o)("label_type")),1),s("div",Sx,_(d(o)("label_param_value")),1)]),s("div",Dx,[(h(!0),D(ee,null,se(E.loop_arrays,(ge,ve)=>(h(),D("div",{class:"form-item-list",key:ge.cu_key},[c($e,{label:null},{default:f(()=>[s("div",Ax,[c(de,{style:{width:"25%"},value:ge.key,"onUpdate:value":he=>ge.key=he,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c(De,null,{default:f(()=>[c(de,{style:{width:"25%"},value:ge.typ,"onUpdate:value":he=>ge.typ=he,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),c(Fe,{value:ge.value,"onUpdate:value":he=>ge.value=he,onChange:(he,Ae)=>M(he,ge,Ae),onDropdownVisibleChange:k,style:{width:"50%"},options:u.value,allowClear:!1,displayRender:({labels:he})=>he.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","onUpdate:value","onChange","options","displayRender","placeholder"])]),_:2},1024),Z("",!0)])]),_:2},1024)]))),128)),E.loop_arrays.length==0?(h(),G(Ue,{key:0,onClick:q,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])):Z("",!0)])])])):Z("",!0),s("div",Ox,[s("div",Nx,[J[4]||(J[4]=s("img",{src:$8,alt:""},null,-1)),T(" "+_(d(o)("label_intermediate_variable"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_intermediate_variable")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",Bx,[s("div",Ex,[s("div",Ix,_(d(o)("label_param_key")),1),s("div",Fx,_(d(o)("label_type")),1),s("div",Rx,_(d(o)("label_param_value")),1)]),s("div",Lx,[(h(!0),D(ee,null,se(E.intermediate_params,(ge,ve)=>(h(),D("div",{class:"form-item-list",key:ge.cu_key},[c($e,{label:null},{default:f(()=>[s("div",Vx,[c(de,{style:{width:"25%"},value:ge.key,"onUpdate:value":he=>ge.key=he,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c(De,null,{default:f(()=>[c(Q,{value:ge.typ,"onUpdate:value":he=>ge.typ=he,placeholder:d(o)("ph_select"),style:{width:"25%"}},{default:f(()=>[(h(),D(ee,null,se(F,he=>c(W,{value:he.value,key:he.value},{default:f(()=>[T(_(he.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value","placeholder"]),s("div",Mx,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:he=>v(he,"intermediate_params",ve),options:r.value,defaultSelectedList:ge.tags,defaultValue:ge.value,onOpen:$,onChange:(he,Ae)=>C(he,Ae,ge,ve),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:he,payload:Ae})=>[s("div",Tx,[s("div",jx,_(he),1),s("div",Px,_(Ae.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])])]),_:2},1024),s("div",{class:"btn-hover-wrap",onClick:he=>V(ve)},[c(d(at))],8,qx)])]),_:2},1024)]))),128)),c(Ue,{onClick:j,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])])])]),s("div",Hx,[s("div",Ux,[J[5]||(J[5]=s("img",{src:en,alt:""},null,-1)),T(" "+_(d(o)("label_output"))+" ",1),c(P,null,{title:f(()=>[T(_(d(o)("tip_output")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",Jx,[s("div",zx,[s("div",Kx,_(d(o)("label_param_key")),1),s("div",Gx,_(d(o)("label_type")),1),s("div",Wx,_(d(o)("label_param_value")),1)]),s("div",Zx,[(h(!0),D(ee,null,se(E.output,(ge,ve)=>(h(),D("div",{class:"form-item-list",key:ge.cu_key},[c($e,{label:null},{default:f(()=>[s("div",Yx,[c(de,{style:{width:"25%"},value:ge.key,"onUpdate:value":he=>ge.key=he,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c(De,null,{default:f(()=>[c(de,{style:{width:"25%"},value:ge.typ,"onUpdate:value":he=>ge.typ=he,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),c(Fe,{onChange:he=>K(he,ge),value:ge.value,"onUpdate:value":he=>ge.value=he,onDropdownVisibleChange:k,style:{width:"40%"},options:B.value,allowClear:!1,displayRender:({labels:he})=>he.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["onChange","value","onUpdate:value","options","displayRender","placeholder"])]),_:2},1024),s("div",{class:"btn-hover-wrap",onClick:he=>H(ve)},[c(d(at))],8,Qx)])]),_:2},1024)]))),128)),c(Ue,{onClick:He(z,["stop"]),icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])])])])]),_:1},8,["model"])])]),c(fl,{loop_node_key:e.nodeId,ref_key:"runTestRef",ref:y},null,8,["loop_node_key"])]),_:1})}}},eS=_e(Xx,[["__scopeId","data-v-4095bf81"]]),tS={class:"field-select-box"},sS={key:0,class:"field-list-box"},oS={key:1,class:"empty-box"},nS={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.feishu-table.field-selector.field-select-alert"),l=o,i=U(!1),r=we({show:!1,selectedRowKeys:[],selectedRows:[]}),u=U([{title:a("label_field_name"),dataIndex:"field_name"},{title:a("label_data_type"),dataIndex:"ui_type"}]);U([]);const y=(v,C)=>{r.selectedRowKeys=v,r.selectedRows=C},p=({selectedRowKeys:v,selectedRows:C})=>{r.selectedRowKeys=v,r.selectedRows=C,r.show=!0},m=()=>{l("ok",r.selectedRowKeys,r.selectedRows),r.show=!1};return n({open:p}),(v,C)=>{const g=ro,$=wt;return h(),G($,{width:"746px",open:r.show,"onUpdate:open":C[0]||(C[0]=w=>r.show=w),title:d(a)("title_relate_data_table"),onOk:m,"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel")},{default:f(()=>[s("div",tS,[e.fields.length?(h(),D("div",sS,[c(g,{rowKey:"field_name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:y},dataSource:e.fields,columns:u.value,loading:i.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):Z("",!0),e.fields.length?Z("",!0):(h(),D("div",oS,[C[1]||(C[1]=s("img",{src:To,alt:""},null,-1)),s("div",null,_(d(a)("msg_no_fields_add")),1)]))])]),_:1},8,["open","title","ok-text","cancel-text"])}}},aS=_e(nS,[["__scopeId","data-v-e3e75117"]]),lS={class:"field-list"},iS={class:"field-list-row"},rS={class:"field-list-col field-list-col-head field-name-head"},dS={class:"field-list-col field-list-col-head field-type-head"},uS={key:0,class:"field-list-col field-list-col-head field-value-head"},cS={key:1,class:"field-list-col field-list-col-head field-del-head"},_S={key:0,class:"field-list-row"},pS={class:"field-list-col field-value-col"},fS={class:"field-list-col field-name-col"},vS={class:"field-list-col field-type-col"},hS={key:0,class:"field-list-col field-value-col"},mS={key:1,class:"field-list-col field-del-col"},gS=["onClick"],yS={key:0,class:"add-btn-box"},bS={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]}},emits:["change"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.feishu-table.field-selector.index"),a=n,l=e,i=be("getNode"),r=we({list:[],keys:[]}),u=ye(()=>Object.fromEntries(l.fields.map(b=>[b.field_name,b])));Ie(()=>l.list,b=>{r.list=b,r.keys=b.map(x=>x.field_name)},{immediate:!0});const y=U([]),p=()=>{let b=i().getAllParentVariable();y.value=b||[]},m=()=>{p()},v=(b,x,A,R)=>{r.list[R].value=b,r.list[R].atTags=x,$()},C=(b,x)=>{r.list=[...x],r.keys=[...b],$()},g=b=>{r.list.splice(b,1),$()},$=()=>{a("change",[...r.list],[...r.keys])},w=U(),S=()=>{w.value.open({selectedRows:l.list,selectedRowKeys:l.list.map(b=>b.field_name)})},k=b=>{switch(b.ui_type){case"Checkbox":return o("ph_input_true_false");case"MultiSelect":return o("ph_input_multi_select")}return o("ph_input_value_variable")};return Ne(()=>{p()}),(b,x)=>{const A=pt,R=ct,E=It,B=rt;return h(),D("div",null,[s("div",lS,[s("div",iS,[s("div",rS,_(d(o)("label_field_name")),1),s("div",dS,_(d(o)("label_type")),1),e.showInput?(h(),D("div",uS,_(d(o)("label_field_value")),1)):Z("",!0),l.showDelete?(h(),D("div",cS)):Z("",!0)]),e.showEmptyFieldRow?(h(),D("div",_S,[x[0]||(x[0]=s("div",{class:"field-list-col field-name-col"},"--",-1)),x[1]||(x[1]=s("div",{class:"field-list-col field-type-col"},"--",-1)),s("div",pS,[c(R,{title:d(o)("ph_select_database_first")},{default:f(()=>[c(A,{disabled:!0,placeholder:d(o)("ph_input_value_variable")},null,8,["placeholder"])]),_:1},8,["title"])])])):Z("",!0),(h(!0),D(ee,null,se(r.list,(N,I)=>{var L;return h(),D("div",{class:"field-list-row",key:N.field_name},[s("div",fS,_(N.field_name),1),s("div",vS,_(N.ui_type||((L=u.value[N.field_name])==null?void 0:L.ui_type)),1),e.showInput?(h(),D("div",hS,[c(xe,{options:y.value,defaultValue:N.value,defaultSelectedList:N.atTags,onOpen:m,onChange:(q,O)=>v(q,O,N,I),placeholder:k(N)},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])])):Z("",!0),l.showDelete?(h(),D("div",mS,[s("span",{class:"del-btn",onClick:q=>g(I)},[c(E,{class:"del-icon",name:"close-circle"})],8,gS)])):Z("",!0)])}),128))]),l.showAdd?(h(),D("div",yS,[c(B,{class:"add-btn",type:"dashed",block:"",onClick:S},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_field")),1)]),_:1})])):Z("",!0),c(aS,{ref_key:"fieldSelectAlertRef",ref:w,fields:e.fields,onOk:C},null,8,["fields"])])}}},In=_e(bS,[["__scopeId","data-v-4abfa765"]]),kS={class:"_full-input-box"},wS={class:"field-list-item"},CS={class:"field-label"},$S={class:"field-type"},xS={__name:"at-full-input",props:{type:{type:String,default:"input",validator(e){return["input","textarea"].includes(e)}},placeholder:{type:String,default:"ph_input"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1},canFull:{type:Boolean,default:!1}},emits:["open","change"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.at-input.at-full-input"),l=o,i=e,r=U(null),u=U(null),y=U(i.defaultValue),p=U(i.defaultSelectedList),m=ye(()=>i.placeholder==="ph_input"?a("ph_input"):i.placeholder);Ie(()=>i.defaultValue,$=>{y.value=$}),Ie(()=>i.defaultSelectedList,$=>{p.value=$});function v($,w){y.value=$,p.value=w,l("change",$,w)}function C(){r.value.refresh()}function g(){u.value.show()}return n({showFull:g}),($,w)=>(h(),D("div",kS,[e.canFull?(h(),G(d(Wt),{key:0,class:"full-icon",onClick:g})):Z("",!0),c(xe,{type:e.type,inputStyle:e.inputStyle,options:e.options,defaultValue:y.value,defaultSelectedList:p.value,placeholder:m.value,canRepeat:e.canRepeat,isContain:e.isContain,checkAnyLevel:e.checkAnyLevel,ref_key:"atInputRef",ref:r,onOpen:w[0]||(w[0]=S=>l("open")),onChange:v},{option:f(({label:S,payload:k})=>[s("div",wS,[s("div",CS,_(S),1),s("div",$S,_(k.typ),1)])]),_:1},8,["type","inputStyle","options","defaultValue","defaultSelectedList","placeholder","canRepeat","isContain","checkAnyLevel"]),c(js,{options:e.options,defaultValue:y.value,defaultSelectedList:p.value,placeholder:d(a)("ph_input_content_with_variable"),type:e.type,onOpen:w[1]||(w[1]=S=>l("open")),onChange:v,onOk:C,ref_key:"fullAtInputRef",ref:u},null,8,["options","defaultValue","defaultSelectedList","placeholder","type"])]))}},Qs=_e(xS,[["__scopeId","data-v-d0765ee1"]]),SS={class:"add-data-form"},DS={class:"node-box-content"},AS={class:"flex-between"},OS={class:"setting-label is-required"},NS={class:"tip"},BS={class:"flex-between"},ES={class:"setting-box mt8"},IS={class:"desc"},FS={__name:"feishu-insert-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]},variableOptions:{type:Array}},emits:["update"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-insert-data"),l=o,i=e,r=U({}),u=we({fields:[],fields_json:"",input_type_map:{fields:1},tag_map:{fields:[]}});function y(g=null){var $,w;if(u.fields=[],g){let{fields:S,input_type_map:k,tag_map:b}=((w=($=g==null?void 0:g.plugin)==null?void 0:$.params)==null?void 0:w.arguments)||{};if(S.map(x=>{x.value=x.value?x.value.toString():""}),u.fields=S,u.tag_map=b||{},k){u.input_type_map=k;for(let x in k)if(k[x]==2&&!u[`${x}_json`]){let A=JSON.stringify(u[x]);u[`${x}_json`]=A}}}u.fields.length||i.fields.map(S=>{u.fields.push({value:"",atTags:[],...S})}),C()}const p=g=>{u.fields=g,C()};function m(g){var $;($=r.value[g])==null||$.showFull()}function v(g,$,w){u[g]=$,u.tag_map[g]=w,C()}const C=()=>{l("update",{...u})};return n({init:y,clear(){C()}}),(g,$)=>{var k;const w=et,S=Ye;return h(),D("div",SS,[s("div",DS,[s("div",AS,[s("div",OS,[s("span",null,_(d(a)("label_insert_data")),1),s("span",NS,_(d(a)("tip_empty_field")),1)]),s("div",BS,[u.input_type_map.fields==2?(h(),G(d(Wt),{key:0,class:"zm-pointer",onClick:$[0]||($[0]=b=>m("fields"))})):Z("",!0),c(S,{value:u.input_type_map.fields,"onUpdate:value":$[1]||($[1]=b=>u.input_type_map.fields=b),style:{width:"130px"},onChange:C},{default:f(()=>[c(w,{value:1},{default:f(()=>[T(_(d(a)("opt_select_add_data")),1)]),_:1}),c(w,{value:2},{default:f(()=>[T(_(d(a)("opt_input_variable")),1)]),_:1})]),_:1},8,["value"])])]),s("div",ES,[u.input_type_map.fields==1?(h(),G(In,{key:0,showEmptyFieldRow:!e.tableId,list:u.fields,fields:e.fields,showAdd:!1,showDelete:!1,onChange:p},null,8,["showEmptyFieldRow","list","fields"])):(h(),D(ee,{key:1},[c(Qs,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((k=u.tag_map)==null?void 0:k.fields_json)||[],defaultValue:u.fields_json,ref:b=>r.value.fields=b,onOpen:$[2]||($[2]=b=>l("updateVar")),onChange:$[3]||($[3]=(b,x)=>v("fields_json",b,x)),placeholder:d(a)("ph_input_content")},null,8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",IS,_(d(a)("desc_data_example")),1)],64))])])])}}},RS=_e(FS,[["__scopeId","data-v-6d866f29"]]),LS={class:"add-data-form"},VS={class:"node-box-content"},MS={class:"options-item is-required"},TS={class:"options-item-tit"},jS={class:"option-label"},PS={class:"field-list-item"},qS={class:"field-label"},HS={class:"field-type"},US={class:"desc"},JS={class:"options-item is-required"},zS={class:"flex-between"},KS={class:"options-item-tit"},GS={class:"option-label"},WS={class:"flex-between"},ZS={class:"setting-box"},YS={class:"desc"},QS={__name:"feishu-update-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-update-data"),l=o,i=U({}),r=we({record_id:"",record_tags:[],fields:[],fields_json:"",input_type_map:{fields:1},tag_map:{fields:[]}});function u(C=null){var g,$,w,S,k;if(r.fields=[],C){let{fields:b,input_type_map:x,tag_map:A}=(($=(g=C==null?void 0:C.plugin)==null?void 0:g.params)==null?void 0:$.arguments)||{};if(b.map(R=>{R.value=R.value?R.value.toString():""}),r.fields=b,r.tag_map=A||{},x){r.input_type_map=x;for(let R in x)if(x[R]==2&&!r[`${R}_json`]){let E=JSON.stringify(r[R]);r[`${R}_json`]=E}}}C&&((k=(S=(w=C==null?void 0:C.plugin)==null?void 0:w.params)==null?void 0:S.arguments)!=null&&k.record_id)&&(r.record_id=C.plugin.params.arguments.record_id,r.record_tags=C.plugin.params.arguments.record_tags||[]),v()}const y=C=>{r.fields=C,v()};function p(C,g,$){r[C]=g,C=="record_id"?r.record_tags=$:r.tag_map[C]=$,v()}function m(C){var g;(g=i.value[C])==null||g.showFull()}const v=()=>{l("update",{...r})};return n({init:u}),(C,g)=>{var S;const $=et,w=Ye;return h(),D("div",LS,[s("div",VS,[s("div",MS,[s("div",TS,[s("div",jS,_(d(a)("label_record_id")),1),g[6]||(g[6]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:r.record_tags,defaultValue:r.record_id,ref:k=>i.value.record_id=k,onOpen:g[0]||(g[0]=k=>l("updateVar")),onChange:g[1]||(g[1]=(k,b)=>p("record_id",k,b)),placeholder:d(a)("ph_input_content")},{option:f(({label:k,payload:b})=>[s("div",PS,[s("div",qS,_(k),1),s("div",HS,_(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",US,_(d(a)("desc_update_record_id")),1)]),s("div",JS,[s("div",zS,[s("div",KS,[s("div",GS,_(d(a)("label_update_data")),1)]),s("div",WS,[r.input_type_map.fields==2?(h(),G(d(Wt),{key:0,class:"zm-pointer",onClick:g[2]||(g[2]=k=>m("fields"))})):Z("",!0),c(w,{value:r.input_type_map.fields,"onUpdate:value":g[3]||(g[3]=k=>r.input_type_map.fields=k),style:{width:"130px"},onChange:v},{default:f(()=>[c($,{value:1},{default:f(()=>[T(_(d(a)("opt_select_update_data")),1)]),_:1}),c($,{value:2},{default:f(()=>[T(_(d(a)("opt_input_variable")),1)]),_:1})]),_:1},8,["value"])])]),s("div",ZS,[r.input_type_map.fields==1?(h(),G(In,{key:0,showEmptyFieldRow:!e.tableId,list:r.fields,fields:e.fields,showAdd:!0,showDelete:!0,onChange:y},null,8,["showEmptyFieldRow","list","fields"])):(h(),D(ee,{key:1},[c(Qs,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((S=r.tag_map)==null?void 0:S.fields_json)||[],defaultValue:r.fields_json,ref:k=>i.value.fields=k,onOpen:g[4]||(g[4]=k=>l("updateVar")),onChange:g[5]||(g[5]=(k,b)=>p("fields_json",k,b)),placeholder:d(a)("ph_input_content")},null,8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",YS,_(d(a)("desc_update_data_example")),1)],64))])])])])}}},XS=_e(QS,[["__scopeId","data-v-be2346bd"]]),eD={class:"options-item is-required"},tD={class:"options-item-tit"},sD={class:"option-label"},oD={class:"field-list-item"},nD={class:"field-label"},aD={class:"field-type"},lD={class:"desc"},iD={__name:"feishu-del-data",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-del-data"),l=o,i=we({tags:[],value:""});function r(y=null){var p,m,v;y&&((v=(m=(p=y==null?void 0:y.plugin)==null?void 0:p.params)==null?void 0:m.arguments)!=null&&v.record_id)&&(i.value=y.plugin.params.arguments.record_id,i.tags=y.plugin.params.arguments.record_tags||[])}function u(y,p){i.value=y,i.tags=p,l("update",{record_id:y,record_tags:p})}return n({init:r}),(y,p)=>(h(),D("div",eD,[s("div",tD,[s("div",sD,_(d(a)("label_record_id")),1),p[1]||(p[1]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:i.tags,defaultValue:i.value,ref:"atInputRef",onOpen:p[0]||(p[0]=m=>l("updateVar")),onChange:u,placeholder:d(a)("ph_input_content")},{option:f(({label:m,payload:v})=>[s("div",oD,[s("div",nD,_(m),1),s("div",aD,_(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",lD,_(d(a)("desc_record_id")),1)]))}},rD=_e(iD,[["__scopeId","data-v-ec1163b4"]]),vl=()=>{const{t:e}=fe("constants.database");return[{key:"is",label:e("label_is")},{key:"isNot",label:e("label_is_not")},{key:"contains",label:e("label_contain")},{key:"doesNotContain",label:e("label_not_contain")},{key:"isEmpty",label:e("label_empty")},{key:"isNotEmpty",label:e("label_not_empty")},{key:"isGreater",label:e("label_greater_than")},{key:"isGreaterEqual",label:e("label_greater_than_or_equal")},{key:"isLess",label:e("label_less_than")},{key:"isLessEqual",label:e("label_less_than_or_equal")}]},dD=vl(),uD=()=>{let e={};for(let n of vl())e[n.key]=n;return e},hl=uD(),cD=["Text","SingleSelect","MultiSelect","DateTime","Number","Checkbox"],_D={Text:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],Number:["is","isNot","isEmpty","isNotEmpty","isGreater","isGreaterEqual","isLess","isLessEqual"],SingleSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],MultiSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],DateTime:["is","isEmpty","isNotEmpty","isGreater","isLess"],Checkbox:["is"]};function pD(e){let n=_D[e]||[];return dD.filter(o=>n.includes(o.key))}const _n=["batch_create_record","batch_delete_record","batch_get_record","batch_update_record"];function ml(e){const n=["app_id","app_secret","app_token","table_id"],o={};for(let a in e)!n.includes(a)&&e[a].required&&(o[a]=JSON.parse(JSON.stringify(e[a])));return o}const fD={class:"query-condition-filter"},vD={class:"condition-select-box"},hD={class:"select-wrapper"},mD={href:"javascript:;"},gD={href:"javascript:;"},yD={class:"field-items"},bD={class:"field-select-box"},kD={class:"operator-select-box"},wD={class:"field-value-box"},CD=["onClick"],$D={class:"add-btn-box"},xD={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},conjunction:{type:String,default:"and"}},emits:["change"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.feishu-table.query-condition-filter"),a=n,l=e,i=be("getNode"),r=we({list:[],conjunction:"and"});Ie(()=>l.where,b=>{r.list=b},{immediate:!0}),Ie(()=>l.conjunction,b=>{r.conjunction=b},{immediate:!0});const u=ye(()=>l.where.length>1),y=U([]),p=()=>{let b=i().getAllParentVariable();y.value=b||[]},m=()=>{p()},v=()=>{let b={conjunction:r.conjunction,list:r.list};a("change",b)},C=(b,x,A,R)=>{r.list[R].value=b,r.list[R].atTags=x,v()},g=(b,x)=>{r.list[x].value="",v()},$=()=>{let b={field_id:"",field_name:"",field_type:"",operator:void 0,value:"",atTags:[]};r.list.push(b),v()},w=b=>{r.list.splice(b,1),v()},S=(b,x)=>{let A={field_id:x.key,field_name:x.value,field_type:x.type,operator:void 0,value:"",atTags:[]};r.list[b]=A,v()},k=({key:b})=>{r.conjunction=b,v()};return Ne(()=>{p()}),(b,x)=>{const A=lo,R=ao,E=io,B=et,N=Ye,I=pt,L=It,q=rt,O=ct;return h(),D("div",{class:qe(["query-condition-filter-warpper",{"is-multiple":u.value}])},[s("div",fD,[x[1]||(x[1]=s("div",{class:"auxiliary-line"},null,-1)),s("div",vD,[s("div",hD,[c(E,null,{overlay:f(()=>[c(R,{style:{width:"100px"},onClick:k},{default:f(()=>[c(A,{key:"and"},{default:f(()=>[s("a",mD,_(d(o)("label_and")),1)]),_:1}),c(A,{key:"or"},{default:f(()=>[s("a",gD,_(d(o)("label_or")),1)]),_:1})]),_:1})]),default:f(()=>[s("a",{class:"ant-dropdown-link",onClick:x[0]||(x[0]=He(()=>{},["prevent"]))},[T(_(r.conjunction=="and"?d(o)("label_and"):d(o)("label_or"))+" ",1),c(d(ds))])]),_:1})])]),s("div",yD,[(h(!0),D(ee,null,se(r.list,(M,j)=>(h(),D("div",{class:"field-item",key:M.field},[s("div",bD,[c(N,{style:{width:"100px"},value:M.field_name,"onUpdate:value":V=>M.field_name=V,onChange:(V,z)=>S(j,z)},{default:f(()=>[(h(!0),D(ee,null,se(l.fieldOptions,V=>(h(),G(B,{value:V.field_name,type:V.ui_type,key:V.field_id},{default:f(()=>[T(_(V.field_name),1)]),_:2},1032,["value","type"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),s("div",kD,[c(N,{value:M.operator,"onUpdate:value":V=>M.operator=V,style:{width:"180px"},onChange:()=>g(M,j)},{default:f(()=>[(h(!0),D(ee,null,se(d(pD)(M.field_type),V=>(h(),G(B,{style:{width:"220px"},value:V.key,key:V.key},{default:f(()=>[T(_(V.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),s("div",wD,[["isEmpty","isNotEmpty"].includes(M.operator)?(h(),G(I,{key:0,placeholder:d(o)("ph_no_value_required"),disabled:""},null,8,["placeholder"])):(h(),G(xe,{key:1,options:y.value,defaultValue:M.value,defaultSelectedList:M.atTags,onOpen:m,onChange:(V,z)=>C(V,z,M,j),placeholder:d(o)("ph_input_value_variable")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"]))]),s("span",{class:"field-del-btn",onClick:V=>w(j)},[c(L,{class:"del-icon",name:"close-circle"})],8,CD)]))),128))])]),s("div",$D,[e.disabled?(h(),G(O,{key:0,title:d(o)("ph_select_database_first"),style:{width:"100%"}},{default:f(()=>[s("span",null,[c(q,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_condition")),1)]),_:1})])]),_:1},8,["title"])):(h(),G(q,{key:1,class:"add-btn",type:"dashed",block:"",onClick:$},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_condition")),1)]),_:1}))])],2)}}},SD=_e(xD,[["__scopeId","data-v-d831e46b"]]),DD={class:"field-select-box"},AD={key:0,class:"field-list-box"},OD={key:1,class:"empty-box"},ND={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.feishu-table.sort-selector.field-select-alert"),l=o,i=we({show:!1,selectedRowKeys:[],selectedRows:[]}),r=U([{title:a("label_field_name"),dataIndex:"field_name"},{title:a("label_data_type"),dataIndex:"ui_type"}]),u=(m,v)=>{i.selectedRowKeys=m,i.selectedRows=v},y=({selectedRowKeys:m,selectedRows:v})=>{i.selectedRowKeys=m,i.selectedRows=v,i.show=!0},p=()=>{l("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return n({open:y}),(m,v)=>{const C=ro,g=wt;return h(),G(g,{width:"746px",open:i.show,"onUpdate:open":v[0]||(v[0]=$=>i.show=$),title:d(a)("title_relate_data_table"),onOk:p,"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel")},{default:f(()=>[s("div",DD,[e.fields.length?(h(),D("div",AD,[c(C,{rowKey:"field_name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:u},dataSource:e.fields,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):Z("",!0),e.fields.length?Z("",!0):(h(),D("div",OD,[v[1]||(v[1]=s("img",{src:To,alt:""},null,-1)),s("div",null,_(d(a)("msg_no_fields_add")),1)]))])]),_:1},8,["open","title","ok-text","cancel-text"])}}},BD=_e(ND,[["__scopeId","data-v-4e1399ef"]]),ED={class:"field-list"},ID={class:"field-list-col field-drag-col"},FD={class:"drag-btn"},RD={class:"field-list-col field-name-col"},LD={class:"field-name-box"},VD={class:"field-name"},MD={class:"field-type-tag"},TD={class:"field-list-col field-value-col"},jD={key:0,class:"field-list-col field-del-col"},PD={class:"add-btn-box"},qD={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.feishu-table.sort-selector.index"),a=n,l=e,i=[{label:"label_asc",value:1,key:"asc"},{label:"label_desc",value:0,key:"desc"}],r=U(),u=U([]);Ie(()=>l.list,g=>{u.value=g.map($=>({...$,is_asc:$.is_asc?1:0}))});const y=g=>{u.value.splice(g,1),v()},p=(g,$)=>{u.value=$.map(w=>({...w})),v()},m=()=>{v()},v=()=>{let g=u.value.map($=>({...$,is_asc:$.is_asc==1}));a("change",g)},C=()=>{r.value.open({selectedRows:l.list,selectedRowKeys:l.list.map(g=>g.field_name)})};return(g,$)=>{const w=et,S=Ye,k=It,b=rt,x=ct;return h(),D("div",null,[s("div",ED,[(h(!0),D(ee,null,se(u.value,A=>(h(),D("div",{class:"field-list-row",key:A.name},[s("div",ID,[s("span",FD,[c(d($n))])]),s("div",RD,[s("div",LD,[s("span",VD,_(A.field_name),1),s("span",MD,_(A.ui_type),1)])]),s("div",TD,[c(S,{value:A.is_asc,"onUpdate:value":R=>A.is_asc=R,style:{width:"100%"},onChange:m},{default:f(()=>[(h(),D(ee,null,se(i,R=>c(w,{value:R.value,key:R.key},{default:f(()=>[T(_(d(o)(R.label)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),l.showDelete?(h(),D("div",jD,[s("span",{class:"del-btn",onClick:$[0]||($[0]=R=>y(g.index))},[c(k,{class:"del-icon",name:"close-circle"})])])):Z("",!0)]))),128))]),s("div",PD,[e.disabled?(h(),G(x,{key:0,title:d(o)("ph_select_database_first"),style:{width:"100%"}},{default:f(()=>[s("span",null,[c(b,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_sort_field")),1)]),_:1})])]),_:1},8,["title"])):(h(),G(b,{key:1,class:"add-btn",type:"dashed",block:"",onClick:C},{default:f(()=>[c(d(Xe)),T(" "+_(d(o)("btn_add_sort_field")),1)]),_:1}))]),c(BD,{fields:e.fields,ref_key:"fieldSelectAlertRef",ref:r,onOk:p},null,8,["fields"])])}}},HD=_e(qD,[["__scopeId","data-v-6c294e87"]]),UD={class:"select-data-form"},JD={class:"node-box-content"},zD={class:"setting-box"},KD={class:"flex-between"},GD={class:"field-list-item"},WD={class:"field-label"},ZD={class:"field-type"},YD={class:"desc"},QD={class:"flex-between"},XD={class:"field-list-item"},e6={class:"field-label"},t6={class:"field-type"},s6={class:"desc"},o6={class:"flex-between"},n6={class:"field-list-item"},a6={class:"field-label"},l6={class:"field-type"},i6={class:"desc"},r6={class:"setting-label"},d6={__name:"feishu-search-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-search-data"),l=o,i=e,r={field_names:[],filter:{conjunction:"and",conditions:[]},sort:[],page_size:100,field_names_json:"",filter_json:"",sort_json:"",input_type_map:{field_names:1,filter:1,sort:1},tag_map:{}},u=we(JSON.parse(JSON.stringify(r))),y=U(null),p=U({}),m=U(""),v=U(""),C=U([]);function g(E=null){var B,N,I,L;if(!E)Object.assign(u,JSON.parse(JSON.stringify(r)));else{let{field_names:q,filter:O,sort:M,page_size:j,input_type_map:V,tag_map:z}=((N=(B=E==null?void 0:E.plugin)==null?void 0:B.params)==null?void 0:N.arguments)||{};if(Array.isArray(O.conditions)&&O.conditions.length){for(let H of O.conditions)H.field_type==="DateTime"&&(H.value=H.value.replace(/\D/g,""));u.filter=O}else u.filter={conjunction:"and",conditions:[]};Array.isArray(q)&&(V==null?void 0:V.field_names)!=2?q.map(H=>{let K=i.fields.find(F=>F.field_name==H);K&&u.field_names.push(K)}):u.field_names=Array.isArray(q)?q:[],Array.isArray(M)&&(V==null?void 0:V.sort)!=2?u.sort=M.map(H=>({...i.fields.find(F=>F.field_name==H.field_name),is_asc:H.desc?0:1})):u.sort=Array.isArray(M)?M:[],V&&(u.input_type_map=V);for(let H in V)if(V[H]==2){let K=JSON.stringify(u[H]);Array.isArray(u[H])?u[H].length||(K=""):(L=(I=u[H])==null?void 0:I.conditions)!=null&&L.length||(K=""),u[`${H}_json`]=K}u.tag_map=z||{},u.page_size=j||100}}const $=({conjunction:E,list:B})=>{u.filter.conjunction=E,u.filter.conditions=B,A()},w=E=>{u.sort=[...E],A()},S=E=>{u.field_names=E,A()};function k(E,B,N){u[E]=B,u.tag_map[E]=N,A()}function b(E,B){const N=m.value;N&&(u[N]=E,u.tag_map[N]=B,A())}function x(E){var B;m.value=E,v.value=u[E]||"",C.value=((B=u.tag_map)==null?void 0:B[E])||[],y.value.show()}function A(){l("update",JSON.parse(JSON.stringify(u)))}function R(){var N;const E=m.value,B=(N=p.value)==null?void 0:N[E];B&&B.refresh&&B.refresh()}return n({init:g,clearSelections(){var E,B,N;((E=u.input_type_map)==null?void 0:E.filter)==1&&(u.filter.conditions=[]),((B=u.input_type_map)==null?void 0:B.field_names)==1&&(u.field_names=[]),((N=u.input_type_map)==null?void 0:N.sort)==1&&(u.sort=[]),A()}}),(E,B)=>{const N=et,I=Ye,L=Vt;return h(),D("div",UD,[s("div",JD,[s("div",zD,[c(vo,{title:d(a)("title_query_conditions"),count:u.filter.conditions.length},{extra:f(()=>[s("div",KD,[u.input_type_map.filter!=1?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:B[0]||(B[0]=q=>x("filter_json"))},[c(d(Wt))])):Z("",!0),c(I,{value:u.input_type_map.filter,"onUpdate:value":B[1]||(B[1]=q=>u.input_type_map.filter=q),style:{width:"130px"},onChange:A},{default:f(()=>[c(N,{value:1},{default:f(()=>[T(_(d(a)("opt_select_query_condition")),1)]),_:1}),c(N,{value:2},{default:f(()=>[T(_(d(a)("opt_input_variable")),1)]),_:1})]),_:1},8,["value"])])]),default:f(()=>{var q;return[u.input_type_map.filter!=1?(h(),D(ee,{key:0},[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((q=u.tag_map)==null?void 0:q.filter_json)||[],defaultValue:u.filter_json,ref:O=>p.value.filter_json=O,onOpen:B[2]||(B[2]=O=>l("updateVar")),onChange:B[3]||(B[3]=(O,M)=>k("filter_json",O,M)),placeholder:d(a)("ph_input_content")},{option:f(({label:O,payload:M})=>[s("div",GD,[s("div",WD,_(O),1),s("div",ZD,_(M.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",YD,_(d(a)("desc_filter_example")),1)],64)):(h(),G(SD,{key:1,disabled:!e.tableId,where:u.filter.conditions,"field-options":e.fields,conjunction:u.filter.conjunction,onChange:$},null,8,["disabled","where","field-options","conjunction"]))]}),_:1},8,["title","count"])]),s("div",{class:"setting-box",onWheel:B[8]||(B[8]=He(()=>{},["stop"])),onTouchmove:B[9]||(B[9]=He(()=>{},["stop"]))},[c(vo,{title:d(a)("title_query_fields"),count:u.field_names.length},{extra:f(()=>[s("div",QD,[u.input_type_map.field_names!=1?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:B[4]||(B[4]=q=>x("field_names_json"))},[c(d(Wt))])):Z("",!0),c(I,{value:u.input_type_map.field_names,"onUpdate:value":B[5]||(B[5]=q=>u.input_type_map.field_names=q),style:{width:"130px"},onChange:A},{default:f(()=>[c(N,{value:1},{default:f(()=>[T(_(d(a)("opt_select_query_fields")),1)]),_:1}),c(N,{value:2},{default:f(()=>[T(_(d(a)("opt_input_variable")),1)]),_:1})]),_:1},8,["value"])])]),default:f(()=>{var q;return[u.input_type_map.field_names!=1?(h(),D(ee,{key:0},[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((q=u.tag_map)==null?void 0:q.field_names_json)||[],defaultValue:u.field_names_json,ref:O=>p.value.field_names_json=O,onOpen:B[6]||(B[6]=O=>l("updateVar")),onChange:B[7]||(B[7]=(O,M)=>k("field_names_json",O,M)),placeholder:d(a)("ph_input_content")},{option:f(({label:O,payload:M})=>[s("div",XD,[s("div",e6,_(O),1),s("div",t6,_(M.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",s6,_(d(a)("desc_field_names_example")),1)],64)):(h(),G(In,{key:1,showAdd:!!e.tableId,showInput:!1,showEmptyFieldRow:!e.tableId,list:u.field_names,fields:e.fields,onChange:S},null,8,["showAdd","showEmptyFieldRow","list","fields"]))]}),_:1},8,["title","count"])],32),s("div",{class:"setting-box",onWheel:B[14]||(B[14]=He(()=>{},["stop"])),onTouchmove:B[15]||(B[15]=He(()=>{},["stop"]))},[c(vo,{title:d(a)("title_sort"),count:u.sort.length},{extra:f(()=>[s("div",o6,[u.input_type_map.sort!=1?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:B[10]||(B[10]=q=>x("sort_json"))},[c(d(Wt))])):Z("",!0),c(I,{value:u.input_type_map.sort,"onUpdate:value":B[11]||(B[11]=q=>u.input_type_map.sort=q),style:{width:"130px"},onChange:A},{default:f(()=>[c(N,{value:1},{default:f(()=>[T(_(d(a)("opt_select_sort")),1)]),_:1}),c(N,{value:2},{default:f(()=>[T(_(d(a)("opt_input_variable")),1)]),_:1})]),_:1},8,["value"])])]),default:f(()=>{var q;return[u.input_type_map.sort!=1?(h(),D(ee,{key:0},[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((q=u.tag_map)==null?void 0:q.sort_json)||[],defaultValue:u.sort_json,ref:O=>p.value.sort_json=O,onOpen:B[12]||(B[12]=O=>l("updateVar")),onChange:B[13]||(B[13]=(O,M)=>k("sort_json",O,M)),placeholder:d(a)("ph_input_content")},{option:f(({label:O,payload:M})=>[s("div",n6,[s("div",a6,_(O),1),s("div",l6,_(M.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",i6,_(d(a)("desc_sort_example")),1)],64)):(h(),G(HD,{key:1,disabled:!e.tableId,list:u.sort,fields:e.fields,onChange:w},null,8,["disabled","list","fields"]))]}),_:1},8,["title","count"])],32),s("div",r6,[s("span",null,_(d(a)("label_query_count")),1)]),s("div",{class:"setting-box",onWheel:B[17]||(B[17]=He(()=>{},["stop"])),onTouchmove:B[18]||(B[18]=He(()=>{},["stop"]))},[c(L,{value:u.page_size,"onUpdate:value":B[16]||(B[16]=q=>u.page_size=q),disabled:!e.tableId,min:20,max:500,style:{width:"205px"},onChange:A},null,8,["value","disabled"])],32)]),c(js,{options:e.variableOptions,defaultSelectedList:C.value,defaultValue:v.value,placeholder:d(a)("ph_input_content"),type:"textarea",onOpen:B[19]||(B[19]=q=>l("updateVar")),onChange:B[20]||(B[20]=(q,O)=>b(q,O)),onOk:R,ref_key:"fullAtInputRef",ref:y},null,8,["options","defaultSelectedList","defaultValue","placeholder"])])}}},u6=_e(d6,[["__scopeId","data-v-17ad324b"]]),c6={class:"field-item"},_6={class:"field-key"},p6={class:"tip-content"},f6={class:"field-type"},v6={class:"field-name"},h6={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(e){const n=e,o=U([]);return(a,l)=>{const i=It,r=ct,u=xn;return h(),D("div",{class:"field-tree-wrapper",onWheel:l[1]||(l[1]=He(()=>{},["stop"])),onTouchmove:l[2]||(l[2]=He(()=>{},["stop"]))},[c(u,{selectedKeys:o.value,"onUpdate:selectedKeys":l[0]||(l[0]=y=>o.value=y),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":n.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:f(({switcherCls:y})=>[s("span",{class:qe(y)},[c(i,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:f(({dataRef:y})=>[s("div",c6,[s("span",_6,_(y.key),1),y.tip?(h(),G(r,{key:0,overlayStyle:{maxWidth:"800px"}},{title:f(()=>[s("div",p6,_(y.tip),1)]),default:f(()=>[c(d(Re),{style:{"margin-left":"4px"}})]),_:2},1024)):Z("",!0),s("span",f6,_(y.typ),1),s("span",v6,_(y.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},Rs=_e(h6,[["__scopeId","data-v-5086883a"]]),m6={class:"add-data-form"},g6={class:"node-box-content"},y6={class:"options-item-tit"},b6={class:"flex-between"},k6={class:"option-label"},w6={class:"option-type"},C6=["onClick"],$6={class:"field-list-item"},x6={class:"field-label"},S6={class:"field-type"},D6={class:"desc"},A6={__name:"feishu-batch-box",props:{actionName:{type:String},action:{type:Object},variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.common"),l=o,i=e,r=we({}),u=U(null),y=U([]),p=U(""),m=U(-1),v=U(""),C=U([]);Ne(()=>{$()});function g(x,A){p.value=x,m.value=A;const R=r[x]||{};v.value=R.value||"",C.value=R.tags||[],u.value.show()}function $(x=null){var R,E,B;const A=ml(((R=i.action)==null?void 0:R.params)||{});for(let N in A){const I=r[N]||{};r[N]={...A[N],value:I.value??A[N].value??"",tags:I.tags??A[N].tags??[]}}if(x){let N=((B=(E=x==null?void 0:x.plugin)==null?void 0:E.params)==null?void 0:B.arguments)||{},I=(N==null?void 0:N.tag_map)||{};for(let L in r){const q=r[L]||{};!!String(q.value||"").length||Array.isArray(q.tags)&&q.tags.length>0||(r[L].value=N[L]??q.value??"",r[L].tags=I[L]??q.tags??[])}}}function w(x,A,R){x.value=A,x.tags=R,k()}function S(x,A){const R=p.value;if(!R)return;const E=r[R];E&&(E.value=x,E.tags=A,k())}const k=()=>{let x={tag_map:{}};for(let A in r)x[A]=r[A].value,x.tag_map[A]=r[A].tags;l("update",x)};function b(){const x=m.value;if(x!=null&&x>-1){const A=y.value||[],R=Array.isArray(A)?A[x]:A;R&&R.refresh&&R.refresh()}}return n({init:$}),(x,A)=>(h(),D("div",m6,[s("div",g6,[(h(!0),D(ee,null,se(r,(R,E,B)=>(h(),D("div",{key:E,class:"options-item is-required"},[s("div",y6,[s("div",b6,[s("div",k6,_(R.name||E),1),s("div",w6,_(R.type),1)]),s("div",{class:"btn-hover-wrap",onClick:N=>g(E,B)},[c(d(Wt))],8,C6)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:R.tags,defaultValue:R.value,ref_for:!0,ref_key:"atInputRef",ref:y,onOpen:A[0]||(A[0]=N=>l("updateVar")),onChange:(N,I)=>w(R,N,I),placeholder:d(a)("ph_input_content")},{option:f(({label:N,payload:I})=>[s("div",$6,[s("div",x6,_(N),1),s("div",S6,_(I.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",D6,_(R.desc),1)]))),128))]),c(js,{options:e.variableOptions,defaultSelectedList:C.value,defaultValue:v.value,placeholder:d(a)("ph_input_content"),type:"textarea",onOpen:A[1]||(A[1]=R=>l("updateVar")),onChange:A[2]||(A[2]=(R,E)=>S(R,E)),onOk:b,ref_key:"fullAtInputRef",ref:u},null,8,["options","defaultSelectedList","defaultValue","placeholder"])]))}},O6=_e(A6,[["__scopeId","data-v-faf5197f"]]),N6={class:"options-item is-required"},B6={class:"options-item-tit"},E6={class:"option-label"},I6={class:"min-input"},F6={class:"field-list-item"},R6={class:"field-label"},L6={class:"field-type"},V6={class:"desc"},M6={__name:"feishu-create-bitable",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-create-bitable"),l=o,i=we({tag_map:{},name:""});function r(p=null){var m,v,C;p&&((C=(v=(m=p==null?void 0:p.plugin)==null?void 0:m.params)==null?void 0:v.arguments)!=null&&C.name)&&(i.name=p.plugin.params.arguments.name,i.tag_map=p.plugin.params.arguments.tag_map||{})}function u(p,m){i.name=p,i.tag_map.name=m,y()}function y(){l("update",JSON.parse(JSON.stringify(i)))}return n({init:r,update:y}),(p,m)=>(h(),D("div",N6,[s("div",B6,[s("div",E6,_(d(a)("label_bitable_name")),1),m[1]||(m[1]=s("div",{class:"option-type"},"string",-1))]),s("div",I6,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:i.tag_map.name||[],defaultValue:i.name,ref:"atInputRef",onOpen:m[0]||(m[0]=v=>l("updateVar")),onChange:u,placeholder:d(a)("ph_input_content")},{option:f(({label:v,payload:C})=>[s("div",F6,[s("div",R6,_(v),1),s("div",L6,_(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",V6,_(d(a)("desc_bitable_app_name")),1)]))}},T6=_e(M6,[["__scopeId","data-v-57032daa"]]),j6={class:"options-item is-required"},P6={class:"options-item-tit"},q6={class:"option-label"},H6={class:"min-input"},U6={class:"field-list-item"},J6={class:"field-label"},z6={class:"field-type"},K6={class:"desc"},G6={class:"options-item"},W6={class:"options-item-tit"},Z6={class:"option-label"},Y6={class:"min-input"},Q6={class:"field-list-item"},X6={class:"field-label"},e4={class:"field-type"},t4={class:"desc"},s4={class:"options-item"},o4={class:"options-item-tit flex-between"},n4={class:"flex-between"},a4={class:"option-label"},l4={class:"field-list-item"},i4={class:"field-label"},r4={class:"field-type"},d4={class:"desc"},u4={__name:"feishu-create-table",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-create-table"),l=o,i=U(null),r=U(null),u=we({name:"",default_view_name:"",fields:"",tag_map:{}});function y(g=null){var $,w,S,k,b,x;g&&((w=($=g==null?void 0:g.plugin)==null?void 0:$.params)!=null&&w.arguments)&&(u.name=((S=g.plugin.params.arguments)==null?void 0:S.name)||"",u.default_view_name=((k=g.plugin.params.arguments)==null?void 0:k.default_view_name)||"",u.fields=((b=g.plugin.params.arguments)==null?void 0:b.fields)||"",u.tag_map=((x=g.plugin.params.arguments)==null?void 0:x.tag_map)||{})}function p(g,$,w){u[g]=$,u.tag_map[g]=w,C()}function m(){i.value.show()}function v(){r.value.refresh()}function C(){l("update",JSON.parse(JSON.stringify(u)))}return n({init:y,update:C}),(g,$)=>{var w,S,k,b;return h(),D("div",null,[s("div",j6,[s("div",P6,[s("div",q6,_(d(a)("label_table_name")),1),$[8]||($[8]=s("div",{class:"option-type"},"string",-1))]),s("div",H6,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((w=u==null?void 0:u.tag_map)==null?void 0:w.name)||[],defaultValue:u.name,ref_key:"atInputRef",ref:r,onOpen:$[0]||($[0]=x=>l("updateVar")),onChange:$[1]||($[1]=(x,A)=>p("name",x,A)),placeholder:d(a)("ph_input_content")},{option:f(({label:x,payload:A})=>[s("div",U6,[s("div",J6,_(x),1),s("div",z6,_(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",K6,_(d(a)("desc_table_name")),1)]),s("div",G6,[s("div",W6,[s("div",Z6,_(d(a)("label_view_name")),1),$[9]||($[9]=s("div",{class:"option-type"},"string",-1))]),s("div",Y6,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((S=u==null?void 0:u.tag_map)==null?void 0:S.default_view_name)||[],defaultValue:u.default_view_name,ref_key:"atInputRef",ref:r,onOpen:$[2]||($[2]=x=>l("updateVar")),onChange:$[3]||($[3]=(x,A)=>p("default_view_name",x,A)),placeholder:d(a)("ph_input_content")},{option:f(({label:x,payload:A})=>[s("div",Q6,[s("div",X6,_(x),1),s("div",e4,_(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",t4,_(d(a)("desc_view_name")),1)]),s("div",s4,[s("div",o4,[s("div",n4,[s("div",a4,_(d(a)("label_initial_fields")),1),$[10]||($[10]=s("div",{class:"option-type"},"jsonString",-1))]),s("div",{class:"btn-hover-wrap",onClick:m},[c(d(Wt))])]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((k=u==null?void 0:u.tag_map)==null?void 0:k.fields)||[],defaultValue:u.fields,ref_key:"atInputRef",ref:r,onOpen:$[4]||($[4]=x=>l("updateVar")),onChange:$[5]||($[5]=(x,A)=>p("fields",x,A)),placeholder:d(a)("ph_input_content")},{option:f(({label:x,payload:A})=>[s("div",l4,[s("div",i4,_(x),1),s("div",r4,_(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",d4,_(d(a)("desc_initial_fields")),1)]),c(js,{options:e.variableOptions,defaultSelectedList:((b=u==null?void 0:u.tag_map)==null?void 0:b.fields)||[],defaultValue:u.fields,placeholder:d(a)("ph_input_content"),type:"textarea",onOpen:$[6]||($[6]=x=>l("updateVar")),onChange:$[7]||($[7]=(x,A)=>p("fields",x,A)),onOk:v,ref_key:"fullAtInputRef",ref:i},null,8,["options","defaultSelectedList","defaultValue","placeholder"])])}}},c4=_e(u4,[["__scopeId","data-v-776e139a"]]),_4={class:"options-item is-required"},p4={class:"options-item-tit"},f4={class:"option-label"},v4={class:"min-input"},h4={class:"field-list-item"},m4={class:"field-label"},g4={class:"field-type"},y4={class:"desc"},b4={class:"options-item"},k4={class:"options-item-tit"},w4={class:"option-label"},C4={class:"min-input"},$4={class:"desc"},x4={__name:"feishu-create-view",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-create-view"),l=o,i=we({view_name:"",view_type:"grid",tag_map:{}}),r=[{label:a("opt_grid_view"),value:"grid"},{label:a("opt_kanban_view"),value:"kanban"},{label:a("opt_gallery_view"),value:"gallery"},{label:a("opt_gantt_view"),value:"gantt"},{label:a("opt_form_view"),value:"form"}];function u(m=null){var v,C,g,$,w;m&&((C=(v=m==null?void 0:m.plugin)==null?void 0:v.params)!=null&&C.arguments)&&(i.name=((g=m.plugin.params.arguments)==null?void 0:g.name)||"",i.view_name=(($=m.plugin.params.arguments)==null?void 0:$.view_name)||"",i.tag_map=((w=m.plugin.params.arguments)==null?void 0:w.tag_map)||{})}function y(m,v,C){i[m]=v,i.tag_map[m]=C,p()}function p(){l("update",JSON.parse(JSON.stringify(i)))}return n({init:u,update:p}),(m,v)=>{var g;const C=Ye;return h(),D("div",null,[s("div",_4,[s("div",p4,[s("div",f4,_(d(a)("label_view_name")),1),v[3]||(v[3]=s("div",{class:"option-type"},"string",-1))]),s("div",v4,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((g=i==null?void 0:i.tag_map)==null?void 0:g.view_name)||[],defaultValue:i.view_name,ref:"atInputRef",onOpen:v[0]||(v[0]=$=>l("updateVar")),onChange:v[1]||(v[1]=($,w)=>y("view_name",$,w)),placeholder:d(a)("ph_input_content")},{option:f(({label:$,payload:w})=>[s("div",h4,[s("div",m4,_($),1),s("div",g4,_(w.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",y4,_(d(a)("desc_view_name")),1)]),s("div",b4,[s("div",k4,[s("div",w4,_(d(a)("label_view_type")),1),v[4]||(v[4]=s("div",{class:"option-type"},"string",-1))]),s("div",C4,[c(C,{value:i.view_type,"onUpdate:value":v[2]||(v[2]=$=>i.view_type=$),options:r,placeholder:d(a)("ph_select_view"),style:{width:"100%"}},null,8,["value","placeholder"])]),s("div",$4,_(d(a)("desc_view_type")),1)])])}}},S4=_e(x4,[["__scopeId","data-v-9aeff797"]]),D4={class:"options-item is-required"},A4={class:"options-item-tit"},O4={class:"option-label"},N4={class:"min-input"},B4={class:"field-list-item"},E4={class:"field-label"},I4={class:"field-type"},F4={class:"options-item is-required"},R4={class:"options-item-tit"},L4={class:"option-label"},V4={class:"min-input"},M4={class:"desc"},T4={class:"options-item is-required"},j4={class:"options-item-tit"},P4={class:"option-label"},q4={class:"min-input"},H4={class:"field-list-item"},U4={class:"field-label"},J4={class:"field-type"},z4=["innerHTML"],K4={__name:"feishu-add-members",props:{config:{type:Object,default:()=>({app_id:"",app_secret:"",app_token:""})},variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-add-members"),l=o,i=["user_id"],r=U(null);U([]);const u=we({member_id:"",role_id:void 0,role_name:"",member_id_type:"user_id",tag_map:{}});function y(v=null){var C,g;v&&((g=(C=v==null?void 0:v.plugin)==null?void 0:C.params)!=null&&g.arguments)&&Object.assign(u,v.plugin.params.arguments)}function p(v,C,g){u[v]=C,u.tag_map[v]=g,m()}function m(){l("update",JSON.parse(JSON.stringify(u)))}return n({init:y,update:m}),(v,C)=>{var w,S;const g=et,$=Ye;return h(),D("div",null,[s("div",D4,[s("div",A4,[s("div",O4,_(d(a)("label_select_role")),1),C[5]||(C[5]=s("div",{class:"option-type"},"string",-1))]),s("div",N4,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((w=u==null?void 0:u.tag_map)==null?void 0:w.role_id)||[],defaultValue:u.role_id,ref_key:"atInputRef",ref:r,onOpen:C[0]||(C[0]=k=>l("updateVar")),onChange:C[1]||(C[1]=(k,b)=>p("role_id",k,b)),placeholder:d(a)("ph_input_content")},{option:f(({label:k,payload:b})=>[s("div",B4,[s("div",E4,_(k),1),s("div",I4,_(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])]),s("div",F4,[s("div",R4,[s("div",L4,_(d(a)("label_member_id_type")),1),C[6]||(C[6]=s("div",{class:"option-type"},"string",-1))]),s("div",V4,[c($,{value:u.member_id_type,"onUpdate:value":C[2]||(C[2]=k=>u.member_id_type=k),placeholder:d(a)("ph_select"),style:{width:"100%"}},{default:f(()=>[(h(),D(ee,null,se(i,k=>c(g,{key:k},{default:f(()=>[T(_(k),1)]),_:2},1024)),64))]),_:1},8,["value","placeholder"])]),s("div",M4,_(d(a)("desc_member_id_type")),1)]),s("div",T4,[s("div",j4,[s("div",P4,_(d(a)("label_member_id")),1),C[7]||(C[7]=s("div",{class:"option-type"},"string",-1))]),s("div",q4,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((S=u==null?void 0:u.tag_map)==null?void 0:S.member_id)||[],defaultValue:u.member_id,ref_key:"atInputRef",ref:r,onOpen:C[3]||(C[3]=k=>l("updateVar")),onChange:C[4]||(C[4]=(k,b)=>p("member_id",k,b)),placeholder:d(a)("ph_input_content")},{option:f(({label:k,payload:b})=>[s("div",H4,[s("div",U4,_(k),1),s("div",J4,_(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",{class:"desc",innerHTML:d(a)("desc_member_id_link")},null,8,z4)])])}}},G4=_e(K4,[["__scopeId","data-v-1b8a6804"]]),W4={class:"options-item is-required"},Z4={class:"options-item-tit"},Y4={class:"option-label"},Q4={class:"min-input"},X4={class:"field-list-item"},eA={class:"field-label"},tA={class:"field-type"},sA={class:"desc"},oA={class:"options-item is-required"},nA={class:"flex-between"},aA={class:"options-item-tit"},lA={class:"option-label"},iA={class:"min-input"},rA={class:"desc"},dA={__name:"feishu-update-advanced",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-update-advanced"),l=o,i=U(null),r=we({name:"",is_advanced:"0",tag_map:{}});function u(v=null){var C,g;v&&((g=(C=v==null?void 0:v.plugin)==null?void 0:C.params)!=null&&g.arguments)&&Object.assign(r,v.plugin.params.arguments)}function y(v,C,g){r[v]=C,r.tag_map[v]=g,m()}function p(v){r.is_advanced=v?"1":"0",m()}function m(){l("update",JSON.parse(JSON.stringify(r)))}return n({init:u,update:m}),(v,C)=>{var S;const g=Ms,$=Qt,w=Yt;return h(),D("div",null,[s("div",W4,[s("div",Z4,[s("div",Y4,_(d(a)("label_bitable_name")),1),C[3]||(C[3]=s("div",{class:"option-type"},"string",-1))]),s("div",Q4,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((S=r==null?void 0:r.tag_map)==null?void 0:S.name)||[],defaultValue:r.name,ref_key:"atInputRef",ref:i,onOpen:C[0]||(C[0]=k=>l("updateVar")),onChange:C[1]||(C[1]=(k,b)=>y("name",k,b)),placeholder:d(a)("ph_input_content")},{option:f(({label:k,payload:b})=>[s("div",X4,[s("div",eA,_(k),1),s("div",tA,_(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",sA,_(d(a)("desc_update_bitable_name")),1)]),s("div",oA,[s("div",nA,[s("div",aA,[s("div",lA,_(d(a)("label_enable_advanced_permission")),1),C[4]||(C[4]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(g,{checked:r.is_advanced>0,onChange:p},null,8,["checked"])])]),s("div",iA,[c(w,{value:r.is_advanced,"onUpdate:value":C[2]||(C[2]=k=>r.is_advanced=k),disabled:r.is_advanced<1,onChange:m},{default:f(()=>[c($,{value:"1"},{default:f(()=>[T(_(d(a)("opt_enable")),1)]),_:1}),c($,{value:"2"},{default:f(()=>[T(_(d(a)("opt_disable")),1)]),_:1})]),_:1},8,["value","disabled"])]),s("div",rA,_(d(a)("desc_advanced_permission")),1)])])}}},uA=_e(dA,[["__scopeId","data-v-ea53bc71"]]),cA={class:"main-box"},_A={key:0,class:"loading-box"},pA={class:"node-options"},fA={class:"options-title"},vA={class:"options-item is-required"},hA={class:"options-item-tit"},mA={class:"option-label"},gA={class:"min-input"},yA={class:"field-list-item"},bA={class:"field-label"},kA={class:"field-type"},wA={class:"desc"},CA={key:0,class:"options-item is-required"},$A={class:"options-item-tit"},xA={class:"option-label"},SA={class:"flex-center min-input"},DA={class:"field-list-item"},AA={class:"field-label"},OA={class:"field-type"},NA={class:"desc"},BA={class:"node-options"},EA={class:"options-title"},IA={class:"options-item"},Gn="feishu_bitable",FA={__name:"feishu-bittable-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.components.feishu-bittable.feishu-bittable-box"),a=n,l=e,i=be("setData"),r={search_records:u6,create_record:RS,update_record:XS,delete_record:rD,create_bitable:T6,create_tables:c4,create_views:S4,table_add_members:G4,update_advanced:uA},u=U(null),y=U(null),p=U({}),m=U(null),v=we({app_token:"",table_id:void 0,tag_map:{},table_set_type:"1"}),C=U(!1),g=U(!1),$=U({}),w=U([]),S=U([]),k=ye(()=>{var K;return((K=p.value)==null?void 0:K[m.value])||{}}),b=U([]);Ne(()=>{x()});async function x(){await R(),I(),H()}function A(){y.value.show(p.value)}async function R(K=!1){await Xa(Gn,K).then(F=>{p.value=F||{};for(let Y in p.value)if(p.value[Y].is_default){m.value=Y;break}m.value||(m.value=Object.keys(p.value)[0])})}function E(){var K;return C.value=!0,$.value={},w.value=[],!Uo(v.app_token)||Array.isArray((K=v.tag_map)==null?void 0:K.app_token)&&v.tag_map.app_token.length?(C.value=!1,Promise.resolve(null)):ss({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_tables",arguments:{app_id:k.value.appid,app_secret:k.value.app_secret,app_token:v.app_token}})}).then(F=>($.value=(F==null?void 0:F.data)||{},w.value=$.value.items||[],!v.table_id&&w.value.length==1&&(v.table_id=w.value[0].table_id,j()),F)).catch(()=>($.value={},w.value=[],v.table_set_type==1&&(v.table_id=void 0),S.value=[],null)).finally(()=>{C.value=!1})}function B(){var K,F;return g.value=!0,!Uo(v.app_token)||!v.table_id||(F=(K=v.tag_map)==null?void 0:K.table_id)!=null&&F.length?(g.value=!1,Promise.resolve(null)):ss({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_table_fields",arguments:{app_id:k.value.appid,app_secret:k.value.app_secret,app_token:v.app_token,table_id:v.table_id}})}).then(Y=>{var J;let le=((J=Y==null?void 0:Y.data)==null?void 0:J.items)||[];return S.value=le.filter(P=>cD.includes(P.ui_type)),Y}).finally(()=>{g.value=!1})}function N(K){var F,Y,le;if(!K)return el(Gn,l.actionName);K=JSON.parse(JSON.stringify(K));for(let J in K)switch(J){case"filter":if(Array.isArray(K.filter.conditions)&&K.filter.conditions.length)for(let P of K.filter.conditions)P.field_type==="DateTime"&&P.value&&(P.value<1e11&&(P.value*=1e3),P.value=["ExactDate",P.value].join(","));break;case"fields":for(let P of K.fields)if(!((F=P==null?void 0:P.atTags)!=null&&F.length)){if(P.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(P.ui_type)&&(P.value=Number(P.value)),P.ui_type==="Currency"&&(P.value=P.value.toFixed(2))),P.ui_type==="Checkbox"&&(P.value=P.value=="true"),P.ui_type==="MultiSelect"&&!Array.isArray(P.value))if(typeof P.value=="string"){const W=P.value.trim();P.value=W?W.replace(/，/g,",").split(","):[]}else P.value=[];P.ui_type==="DateTime"&&P.value<1e11&&(P.value*=1e3)}break;case"field_names":K.field_names=K.field_names.map(P=>P.field_name);break;case"sort":K.sort=K.sort.map(P=>({field_name:P.field_name,desc:P.is_asc!=1}));break;case"input_type_map":for(let P in K[J])K[J][P]==2&&(K[P]=rs(K[`${P}_json`],P=="filter"?{}:[]));break}return K.tag_map&&(v.tag_map={...K.tag_map,app_token:((Y=v==null?void 0:v.tag_map)==null?void 0:Y.app_token)||[],table_id:((le=v==null?void 0:v.tag_map)==null?void 0:le.table_id)||[]}),delete K.field_names_json,delete K.filter_json,delete K.sort_json,delete K.fields_json,K}function I(){var Y,le;let K=JSON.parse(l.node.node_params),F=((le=(Y=K==null?void 0:K.plugin)==null?void 0:Y.params)==null?void 0:le.arguments)||{};if(F.table_set_type&&(v.table_set_type=F.table_set_type),F.tag_map&&(v.tag_map=F.tag_map),F.app_token&&(v.app_token=F.app_token),F.table_id&&(v.table_id=F.table_id),F.app_id&&F.app_secret)for(let J in p.value){let P=p.value[J];P.appid==F.app_id&&P.app_secret==F.app_secret&&(m.value=J)}V(K),v.app_token&&!["table_add_members","update_advanced"].includes(l.actionName)&&E(),v.table_id&&B().then(()=>V(K))}function L(){var K,F;v.table_set_type==1?(v.table_id=((F=(K=w.value)==null?void 0:K[0])==null?void 0:F.table_id)||void 0,v.tag_map.table_id=[],S.value=[],B().then(()=>V())):(v.table_id="",S.value=[],l.actionName==="create_record"?V({plugin:{params:{arguments:{fields:[]}}}}):V()),z({fields:[]})}function q(K,F,Y){v[K]=F,v.tag_map[K]=Y,K==="app_token"?M():K==="table_id"?j():z()}function O(){v.app_token?E().then(()=>V()):V(),v.table_id&&B().then(()=>V()),z()}function M(){const K=v.table_id;S.value=[],E().then(()=>{var Y,le,J,P;const F=w.value.find(W=>W.table_id==K);v.table_set_type==2?(v.table_id=K,l.actionName==="create_record"&&typeof((Y=u.value)==null?void 0:Y.clear)=="function"&&u.value.clear(),l.actionName==="search_records"&&typeof((le=u.value)==null?void 0:le.clearSelections)=="function"&&u.value.clearSelections(),V()):F?(v.table_id=K,B().then(()=>{var W,Q;l.actionName==="create_record"?typeof((W=u.value)==null?void 0:W.clear)=="function"&&u.value.clear():l.actionName!=="create_tables"&&l.actionName!=="create_views"&&l.actionName!=="create_bitable"?V({plugin:{params:{arguments:{fields:[]}}}}):V(),l.actionName==="search_records"&&typeof((Q=u.value)==null?void 0:Q.clearSelections)=="function"&&u.value.clearSelections()})):(v.table_id=void 0,l.actionName==="create_record"?typeof((J=u.value)==null?void 0:J.clear)=="function"&&u.value.clear():l.actionName!=="create_tables"&&l.actionName!=="create_views"&&l.actionName!=="create_bitable"?V({plugin:{params:{arguments:{fields:[]}}}}):V(),l.actionName==="search_records"&&typeof((P=u.value)==null?void 0:P.clearSelections)=="function"&&u.value.clearSelections())}).catch(()=>{var F,Y,le;w.value=[],S.value=[],v.table_set_type==1?(v.table_id=void 0,l.actionName==="create_record"?typeof((F=u.value)==null?void 0:F.clear)=="function"&&u.value.clear():l.actionName!=="create_tables"&&l.actionName!=="create_views"&&l.actionName!=="create_bitable"?V({plugin:{params:{arguments:{fields:[]}}}}):V()):l.actionName==="create_record"?typeof((Y=u.value)==null?void 0:Y.clear)=="function"&&u.value.clear():V(),l.actionName==="search_records"&&typeof((le=u.value)==null?void 0:le.clearSelections)=="function"&&u.value.clearSelections()}),z()}function j(){S.value=[],B().then(()=>{z({fields:[]}),V()})}function V(K=null){Ze(()=>{var Y;const F=K??JSON.parse(l.node.node_params);typeof((Y=u.value)==null?void 0:Y.init)=="function"&&u.value.init(F)})}function z(K=null){var Q,X;let F=JSON.parse(l.node.node_params),Y=w.value.find(de=>de.table_id==v.table_id);const le=((X=(Q=F==null?void 0:F.plugin)==null?void 0:Q.params)==null?void 0:X.arguments)||{},J=K?N(K):{},P={...(le==null?void 0:le.tag_map)||{},...(J==null?void 0:J.tag_map)||{},...(v==null?void 0:v.tag_map)||{}},W={...le,...J,...v,tag_map:P,app_id:k.value.appid,app_secret:k.value.app_secret};F.plugin.output_obj=b.value,F.plugin.params=F.plugin.params||{},F.plugin.params.config_name=m.value,F.plugin.params.table_name=(Y==null?void 0:Y.name)||"",F.plugin.params.arguments=W,i({...l.node,node_params:JSON.stringify(F)})}function H(){b.value=Fs(l.action.output)}return(K,F)=>{var W,Q;const Y=os,le=et,J=Ye,P=rt;return h(),D("div",cA,[g.value||C.value?(h(),D("div",_A,[c(Y)])):Z("",!0),s("div",pA,[s("div",fA,[s("div",null,[F[10]||(F[10]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(o)("title_input")),1)]),Object.keys(p.value).length?(h(),G(J,{key:0,value:m.value,"onUpdate:value":F[0]||(F[0]=X=>m.value=X),onChange:O},{default:f(()=>[(h(!0),D(ee,null,se(p.value,X=>(h(),G(le,{key:X.name,value:X.name},{default:f(()=>[T(_(X.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(h(),G(P,{key:1,onClick:A},{default:f(()=>[T(_(d(o)("btn_unauthorized"))+" ",1),c(d(ds))]),_:1}))]),e.actionName!="create_bitable"?(h(),D(ee,{key:0},[s("div",vA,[s("div",hA,[s("div",mA,_(d(o)("label_multidimensional_table")),1)]),s("div",gA,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((W=v.tag_map)==null?void 0:W.app_token)||[],defaultValue:v.app_token,ref:"atInputRef",onOpen:F[1]||(F[1]=X=>a("updateVar")),onChange:F[2]||(F[2]=(X,de)=>q("app_token",X,de)),placeholder:d(o)("ph_input_document_url")},{option:f(({label:X,payload:de})=>[s("div",yA,[s("div",bA,_(X),1),s("div",kA,_(de.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",wA,_(d(o)("desc_multidimensional_table_id")),1)]),["table_add_members","update_advanced","roles_list","create_tables"].includes(e.actionName)?Z("",!0):(h(),D("div",CA,[s("div",$A,[s("div",xA,_(d(o)("label_select_table")),1)]),s("div",SA,[c(J,{value:v.table_set_type,"onUpdate:value":F[3]||(F[3]=X=>v.table_set_type=X),onChange:L,style:{width:"112px","flex-shrink":"0"}},{default:f(()=>[c(le,{value:"1"},{default:f(()=>[T(_(d(o)("label_select_table")),1)]),_:1}),c(le,{value:"2"},{default:f(()=>[T(_(d(o)("label_insert_variable")),1)]),_:1})]),_:1},8,["value"]),v.table_set_type==1?(h(),G(J,{key:0,value:v.table_id,"onUpdate:value":F[4]||(F[4]=X=>v.table_id=X),onChange:j,placeholder:v.app_token?d(o)("ph_select_table"):d(o)("ph_input_multidimensional_url_first"),style:{width:"100%"}},{default:f(()=>[(h(!0),D(ee,null,se(w.value,X=>(h(),G(le,{key:X.table_id,value:X.table_id},{default:f(()=>[T(_(X.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(h(),G(xe,{key:1,type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((Q=v.tag_map)==null?void 0:Q.table_id)||[],defaultValue:v.table_id,ref:"atInputRef",onOpen:F[5]||(F[5]=X=>a("updateVar")),onChange:F[6]||(F[6]=(X,de)=>q("table_id",X,de)),placeholder:d(o)("ph_input_table_id")},{option:f(({label:X,payload:de})=>[s("div",DA,[s("div",AA,_(X),1),s("div",OA,_(de.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]))]),s("div",NA,_(d(o)("desc_table_id_example")),1)]))],64)):Z("",!0),d(_n).includes(e.actionName)?(h(),G(O6,{key:1,ref_key:"childRef",ref:u,variableOptions:e.variableOptions,actionName:e.actionName,action:e.action,onUpdateVar:F[7]||(F[7]=X=>a("updateVar")),onUpdate:z},null,8,["variableOptions","actionName","action"])):(h(),G(Go(r[e.actionName]),{key:2,ref_key:"childRef",ref:u,tableId:v.table_id,fields:S.value,variableOptions:e.variableOptions,config:{...k.value,...v},onUpdate:z,onUpdateVar:F[8]||(F[8]=X=>a("updateVar"))},null,40,["tableId","fields","variableOptions","config"]))]),s("div",BA,[s("div",EA,[s("div",null,[F[11]||(F[11]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(o)("title_output")),1)])]),s("div",IA,[c(Rs,{"tree-data":b.value},null,8,["tree-data"])])]),c(gf,{ref_key:"configModalRef",ref:y,onChange:F[9]||(F[9]=X=>R(!0))},null,512)])}}},RA=_e(FA,[["__scopeId","data-v-ed3d811b"]]),LA={class:"node-options"},VA={class:"options-title"},MA={class:"options-item-tit"},TA={class:"option-label"},jA={class:"option-type"},PA={class:"field-list-item"},qA={class:"field-label"},HA={class:"field-type"},UA={class:"desc"},JA={key:0,class:"desc",style:{color:"#FB363F"}},zA={class:"node-options"},KA={class:"options-title"},GA={class:"options-item"},tn={__name:"pluginFormRender",props:{node:{type:Object,default:()=>({})},params:{type:Object},output:{type:Object},variableOptions:{type:Array},keepFormatField:{type:Array,default:()=>[]}},emits:["updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.pluginFormRender"),l=o,i=e,r=be("setData"),u=we({}),y=U([]),p=JSON.parse(i.node.node_params),m={url:{label:(k,b)=>(k==null?void 0:k.name)||b,placeholder:a("ph_url_param"),validate:k=>{if(Array.isArray(k.tags)&&k.tags.length>0)return k.__error=null,!0;const A=String(k.value||"").trim().startsWith("https:/");return k.__error=A?null:a("msg_invalid_url"),A}}};Ie(u,k=>{w()},{deep:!0}),Ie(()=>i.params,k=>{var A,R,E;Object.assign(u,JSON.parse(JSON.stringify(k||"{}")));let b=((R=(A=p==null?void 0:p.plugin)==null?void 0:A.params)==null?void 0:R.arguments)||{},x;for(let B in u)x=b[B]||"",!x&&Object.hasOwn(u[B],"default")&&(x=u[B].default),i.keepFormatField.includes(B)||(x=String(x)),x==="null"&&(x=null),u[B].value=x,u[B].tags=((E=b==null?void 0:b.tag_map)==null?void 0:E[B])||[]},{deep:!0,immediate:!0}),Ie(()=>i.output,k=>{y.value=Fs(JSON.parse(JSON.stringify(i.output||"{}")))},{deep:!0,immediate:!0});function v(k,b,x,A){k.value=b,k.tags=x,$(A,k),w()}function C(k,b){const x=m[b];return x&&x.label?x.label(k,b):(k==null?void 0:k.name)||b}function g(k){const b=m[k];return b&&b.placeholder?b.placeholder:a("ph_input_content")}function $(k,b){const x=m[k];return x&&x.validate?x.validate(b):(b.__error=null,!0)}function w(){var A,R;let k=JSON.parse(i.node.node_params);k.plugin.output_obj=y.value;let b={tag_map:{}},x;for(let E in u)x=u[E].value,(R=(A=u[E])==null?void 0:A.tags)!=null&&R.length||(u[E].type=="string"?x=String(x):["number","integer"].includes(u[E].type)&&(x=Number(x))),b[E]=x,b.tag_map[E]=u[E].tags;Object.assign(k.plugin.params,{arguments:{...b}}),r({...i.node,node_params:JSON.stringify(k)})}function S(k={}){Object.assign(u,k),w()}return n({setState:S}),(k,b)=>(h(),D("div",null,[s("div",LA,[s("div",VA,[s("div",null,[b[1]||(b[1]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(a)("label_input")),1)]),Ns(k.$slots,"input-title-extra")]),(h(!0),D(ee,null,se(u,(x,A)=>(h(),D(ee,{key:A},[k.$slots[A]?Ns(k.$slots,A,{key:0,state:u,item:x,keyName:A}):(h(),D("div",{key:1,class:qe(["options-item",{"is-required":x.required}])},[s("div",MA,[s("div",TA,_(C(x,A)),1),s("div",jA,_(x.type),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:x.tags,defaultValue:x.value,ref_for:!0,ref:"atInputRef",onOpen:b[0]||(b[0]=R=>l("updateVar")),onChange:(R,E)=>v(x,R,E,A),placeholder:g(A)},{option:f(({label:R,payload:E})=>[s("div",PA,[s("div",qA,_(R),1),s("div",HA,_(E.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",UA,_(x.desc),1),x.__error?(h(),D("div",JA,_(x.__error),1)):Z("",!0)],2))],64))),128))]),s("div",zA,[s("div",KA,[s("div",null,[b[2]||(b[2]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(a)("label_output")),1)])]),s("div",GA,[c(Rs,{"tree-data":y.value},null,8,["tree-data"])])])]))}},WA={class:"options-item is-required"},ZA={class:"options-item-tit"},YA={class:"option-label"},QA={class:"options-item is-required"},XA={class:"options-item-tit"},eO={class:"option-label"},tO={class:"tag-box"},sO={class:"field-list-item"},oO={class:"field-label"},nO={class:"field-type"},aO={__name:"official-account-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.components.official-account.official-account-box"),a=n,l=e,i=U([]),r=U([]),u=U({}),y=U(!1),p=U({app_id:"",app_secret:""});Ne(()=>{var x,A,R;if(v(),m(),l.actionName==="getTagFans"){let E=rs((x=l.node)==null?void 0:x.node_params);if(E){let B=((R=(A=E==null?void 0:E.plugin)==null?void 0:A.params)==null?void 0:R.arguments)||{};const{app_id:N,app_secret:I}=B;N&&I&&(p.value={app_id:N,app_secret:I},g())}}});function m(){const x={...l.action.params,app_id:{...l.action.params.app_id,default:null},app_name:{desc:o("label_official_account_name"),type:"string"}};l.actionName==="getTagFans"?(Object.assign(x,{tagid:{...l.action.params.tagid,default:null},tag_name:{desc:o("label_tag_name"),type:"string"},tag_type:{desc:o("label_tag_type"),type:"number",default:1}}),u.value=kn(x,["app_id","tagid"])):u.value=x}function v(){oo({app_type:"official_account"}).then(x=>{i.value=(x==null?void 0:x.data)||[]})}function C(){if(!p.value.app_secret||!p.value.app_id)return Me.warning(o("msg_please_select_official_account"));y.value||(y.value=!0,g().then(()=>{Me.success(o("msg_sync_completed"))}).finally(()=>{y.value=!1}))}function g(){return ss({name:"official_account_profile",action:"default/exec",params:JSON.stringify({business:"getTags",arguments:p.value})}).then(x=>{var A;return r.value=((A=x==null?void 0:x.data)==null?void 0:A.tags)||[],x})}function $(x,A){x.app_secret.value=A.secret,x.app_name.value=A.name,l.actionName==="getTagFans"&&(p.value={app_id:A.key,app_secret:A.secret},g())}function w(x){x.tag_name.value="",x.tag_type.value==1?x.tagid.value=null:x.tagid.value=""}function S(x,A,R){x.tag_name.value=R.name}function k(x,A,R){x.value=A,x.tags=R}const b=(x,A)=>A.name.toLowerCase().indexOf(x.toLowerCase())>=0;return(x,A)=>{const R=et,E=Ye,B=os,N=ct;return h(),G(tn,{node:e.node,params:u.value,output:e.action.output,variableOptions:e.variableOptions,keepFormatField:["tagid","tag_type"],onUpdateVar:A[1]||(A[1]=I=>a("updateVar"))},{tag_name:f(()=>[...A[2]||(A[2]=[])]),tag_type:f(()=>[...A[3]||(A[3]=[])]),app_name:f(()=>[...A[4]||(A[4]=[])]),app_secret:f(()=>[...A[5]||(A[5]=[])]),app_id:f(({state:I,item:L,keyName:q})=>[s("div",WA,[s("div",ZA,[s("div",YA,_(d(o)("label_official_account")),1)]),s("div",null,[c(E,{value:L.value,"onUpdate:value":O=>L.value=O,placeholder:d(o)("ph_select_official_account"),style:{width:"100%"},onChange:(O,M)=>$(I,M)},{default:f(()=>[(h(!0),D(ee,null,se(i.value,O=>(h(),G(R,{key:O.app_id,value:O.app_id,name:O.app_name,secret:O.app_secret},{default:f(()=>[T(_(O.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","placeholder","onChange"])])])]),tagid:f(({state:I,item:L,keyName:q})=>[s("div",QA,[s("div",XA,[s("div",eO,_(d(o)("label_official_account_tag")),1),c(N,{title:d(o)("tooltip_sync_tags")},{default:f(()=>[s("a",{onClick:C},[T(_(d(o)("btn_sync"))+" ",1),y.value?(h(),G(B,{key:0,size:"small"})):Z("",!0)])]),_:1},8,["title"])]),s("div",tO,[c(E,{value:I.tag_type.value,"onUpdate:value":O=>I.tag_type.value=O,onChange:O=>w(I),style:{width:"120px"}},{default:f(()=>[c(R,{value:1},{default:f(()=>[T(_(d(o)("btn_select_tag")),1)]),_:1}),c(R,{value:2},{default:f(()=>[T(_(d(o)("btn_insert_variable")),1)]),_:1})]),_:1},8,["value","onUpdate:value","onChange"]),I.tag_type.value==1?(h(),G(E,{key:0,value:L.value,"onUpdate:value":O=>L.value=O,placeholder:d(o)("ph_select_tag"),"show-search":"","filter-option":b,style:{width:"100%"},onChange:(O,M)=>S(I,O,M)},{default:f(()=>[(h(!0),D(ee,null,se(r.value,O=>(h(),G(R,{key:O.id,value:O.id,name:O.name},{default:f(()=>[T(_(O.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder","onChange"])):(h(),G(xe,{key:1,type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:L.tags||[],defaultValue:L.value,ref:"atInputRef",onOpen:A[0]||(A[0]=O=>a("updateVar")),onChange:(O,M)=>k(L,O,M),placeholder:d(o)("ph_input_content")},{option:f(({label:O,payload:M})=>[s("div",sO,[s("div",oO,_(O),1),s("div",nO,_(M.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"]))])])]),_:1},8,["node","params","output","variableOptions"])}}},lO=_e(aO,[["__scopeId","data-v-d3297ffe"]]),iO={class:"tpl-container"},rO={class:"node-options"},dO={class:"options-title"},uO={class:"options-item is-required"},cO={class:"options-item-tit"},_O={class:"option-label"},pO={class:"options-item is-required"},fO={class:"options-item-tit"},vO={class:"option-label"},hO={class:"options-item is-required"},mO={class:"options-item-tit"},gO={class:"option-label"},yO={class:"field-list-item"},bO={class:"field-label"},kO={class:"field-type"},wO={class:"desc"},CO={class:"options-item-tit"},$O={class:"option-label"},xO={class:"field-list-item"},SO={class:"field-label"},DO={class:"field-type"},AO={class:"options-item is-required"},OO={class:"options-item-tit"},NO={class:"option-label"},BO={key:0,class:"options-item is-required"},EO={class:"options-item-tit"},IO={class:"option-label"},FO={class:"field-list-item"},RO={class:"field-label"},LO={class:"field-type"},VO={class:"options-item is-required"},MO={class:"options-item-tit"},TO={class:"option-label"},jO={class:"field-list-item"},PO={class:"field-label"},qO={class:"field-type"},HO={class:"desc"},UO={class:"options-item is-required"},JO={class:"options-item-tit"},zO={class:"option-label"},KO={class:"field-list-item"},GO={class:"field-label"},WO={class:"field-type"},ZO={class:"node-options"},YO={class:"options-title"},QO={class:"options-item"},XO="official_send_template_message",e5={__name:"official-template-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=gn(),a=n,l=e,i=be("setData"),r=U([]),u=U([]),y=U(!1),p=U([]),m=we({app_id:void 0,template_id:void 0,app_secret:"",touser:"",url:"",data:{},miniprogram:{appid:{value:"",tags:[]},pagepath:{value:"",tags:[]}},link_type:0,tag_map:{}}),v=()=>({thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:o("msg_validation_thing")},short_thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,5}$/,txt:o("msg_validation_short_thing")},number:{reg:/^\d{1,32}(.\d{1,2})?$/,txt:o("msg_validation_number")},const:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:o("msg_validation_const")},letter:{reg:/^[a-zA-Z]{1,32}$/,txt:o("msg_validation_letter")},symbol:{reg:/^[\W_]{1,5}$/,txt:o("msg_validation_symbol")},character_string:{reg:/^[a-zA-Z0-9\W_]{1,32}$/,txt:o("msg_validation_character_string")},time:{reg:/^\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:o("msg_validation_time")},date:{reg:/^\d{4}年\d{1,2}月\d{1,2}日(\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:o("msg_validation_date")},amount:{reg:/^[$¥]?\d{1,10}(.\d{1,2})?[元]?$/,txt:o("msg_validation_amount")},phone_number:{reg:/^[0-9-+*# ]{5,17}$/,txt:o("msg_validation_phone_number")},car_number:{reg:/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[a-zA-Z0-9]{6,7}[\u4e00-\u9fa5]{0,1}$/,txt:o("msg_validation_car_number")},name:{reg:/^(?:[\u4e00-\u9fa5]{1,10}|[a-zA-Z\p{P}]{1,20})$/,txt:o("msg_validation_name")},phrase:{reg:/^[\u4e00-\u9fa5]{1,5}$/,txt:o("msg_validation_phrase")}});Ne(()=>{C()}),Ie(()=>l.action,()=>{var I;r.value=Fs(JSON.parse(JSON.stringify(((I=l.action)==null?void 0:I.output)||"{}")))},{deep:!0,immediate:!0});function C(){g(),$()}function g(){oo({app_type:"official_account"}).then(I=>{u.value=(I==null?void 0:I.data)||[]})}function $(){var q,O;let I=JSON.parse(l.node.node_params),L=((O=(q=I==null?void 0:I.plugin)==null?void 0:q.params)==null?void 0:O.arguments)||{};Object.assign(m,L),m.template_id&&b()}function w(I,L){const{key:q,secret:O,name:M}=L;m.app_secret=O,m.app_name=M,b()}function S(I,L){const{name:q,content:O}=L;m.template_name=q,m.data=B(O)}function k(){if(!m.app_secret||!m.app_id)return Me.warning(o("msg_please_select_official_account"));y.value||(y.value=!0,b().then(()=>{Me.success(o("msg_sync_completed"))}).finally(()=>{y.value=!1}))}function b(){return ss({name:XO,action:"default/exec",params:JSON.stringify({business:"getAllTemplates",arguments:{app_id:m.app_id,app_secret:m.app_secret}})}).then(I=>{var L;p.value=((L=I==null?void 0:I.data)==null?void 0:L.template_list)||[]})}function x(I,L,q,O=null){I.value=L,I.tags=q,O&&(q.length?I.format_err=!1:N(O,I)),E()}function A(I,L,q){m[I]=L,m.tag_map[I]=q,E()}function R(){switch(m.link_type){case 0:m.miniprogram.appid={value:"",tags:[]},m.miniprogram.pagepath={value:"",tags:[]},m.url="";break;case 1:m.miniprogram.appid={value:"",tags:[]},m.miniprogram.pagepath={value:"",tags:[]};break;case 2:m.url="";break}E()}function E(){let I=JSON.parse(l.node.node_params);I.plugin.output_obj=r.value,Object.assign(I.plugin.params,{arguments:{...m}}),i({...l.node,node_params:JSON.stringify(I)})}function B(I){var M;const L={},q=I.split(`
`).map(j=>j.trim()).filter(Boolean),O=v();for(const j of q){let V=j.match(/^(.*?):\s*\{\{([\w]+)\.DATA\}\}$/);if(V){let z=V[2].replace(/\d/g,"");L[V[2]]={title:V[1],value:"",tags:[],desc:((M=O[z])==null?void 0:M.txt)||"",format_err:!1};continue}if(V=j.match(/^\{\{([\w]+)\.DATA\}\}$/),V){L[V[1]]={title:V[1],value:"",tags:[]};continue}}return L}function N(I,L){let q=I.replace(/\d/g,"");const O=v();O[q]&&!O[q].reg.test(L.value)?L.format_err=!0:L.format_err=!1}return(I,L)=>{var H,K;const q=et,O=Ye,M=os,j=ct,V=Qt,z=Yt;return h(),D("div",iO,[s("div",rO,[s("div",dO,[s("div",null,[L[12]||(L[12]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(o)("label_section_input")),1)])]),s("div",uO,[s("div",cO,[s("div",_O,_(d(o)("label_official_account")),1)]),s("div",null,[c(O,{value:m.app_id,"onUpdate:value":L[0]||(L[0]=F=>m.app_id=F),placeholder:d(o)("ph_select_official_account"),style:{width:"100%"},onChange:w},{default:f(()=>[(h(!0),D(ee,null,se(u.value,F=>(h(),G(q,{key:F.app_id,name:F.app_name,secret:F.app_secret},{default:f(()=>[T(_(F.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",pO,[s("div",fO,[s("div",vO,_(d(o)("label_official_template")),1),c(j,{title:d(o)("tooltip_sync_templates")},{default:f(()=>[s("a",{onClick:k},[T(_(d(o)("btn_sync"))+" ",1),y.value?(h(),G(M,{key:0,size:"small"})):Z("",!0)])]),_:1},8,["title"])]),s("div",null,[c(O,{value:m.template_id,"onUpdate:value":L[1]||(L[1]=F=>m.template_id=F),placeholder:d(o)("ph_select_template"),style:{width:"100%"},onChange:S},{default:f(()=>[(h(!0),D(ee,null,se(p.value,F=>(h(),G(q,{key:F.template_id,name:F.title,content:F.content},{default:f(()=>[T(_(F.title),1)]),_:2},1032,["name","content"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",hO,[s("div",mO,[s("div",gO,_(d(o)("label_receiver_openid")),1),L[13]||(L[13]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",options:e.variableOptions,defaultSelectedList:((H=m.tag_map)==null?void 0:H.touser)||[],defaultValue:m.touser,ref:"atInputRef",onOpen:L[2]||(L[2]=F=>a("updateVar")),onChange:L[3]||(L[3]=(F,Y)=>A("touser",F,Y)),placeholder:d(o)("ph_input_content")},{option:f(({label:F,payload:Y})=>[s("div",yO,[s("div",bO,_(F),1),s("div",kO,_(Y.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",wO,_(d(o)("desc_receiver_openid")),1)]),(h(!0),D(ee,null,se(m.data,(F,Y)=>(h(),D("div",{class:"options-item is-required",key:Y},[s("div",CO,[s("div",$O,_(F.title),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:F.tags,defaultValue:F.value,ref_for:!0,ref:"atInputRef",onOpen:L[4]||(L[4]=le=>a("updateVar")),onChange:(le,J)=>x(F,le,J,Y),placeholder:d(o)("ph_input_content")},{option:f(({label:le,payload:J})=>[s("div",xO,[s("div",SO,_(le),1),s("div",DO,_(J.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),F.desc?(h(),D("div",{key:0,class:qe(["desc",{error:F.format_err}])},_(F.desc),3)):Z("",!0)]))),128)),s("div",AO,[s("div",OO,[s("div",NO,_(d(o)("label_jump_type")),1)]),s("div",null,[c(z,{value:m.link_type,"onUpdate:value":L[5]||(L[5]=F=>m.link_type=F),onChange:R},{default:f(()=>[c(V,{value:0},{default:f(()=>[T(_(d(o)("opt_jump_none")),1)]),_:1}),c(V,{value:1},{default:f(()=>[T(_(d(o)("opt_jump_link")),1)]),_:1}),c(V,{value:2},{default:f(()=>[T(_(d(o)("opt_jump_miniprogram")),1)]),_:1})]),_:1},8,["value"])])]),m.link_type==1?(h(),D("div",BO,[s("div",EO,[s("div",IO,_(d(o)("label_link")),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((K=m.tag_map)==null?void 0:K.url)||[],defaultValue:m.url,ref:"atInputRef",onOpen:L[6]||(L[6]=F=>a("updateVar")),onChange:L[7]||(L[7]=(F,Y)=>A("url",F,Y)),placeholder:d(o)("ph_input_content")},{option:f(({label:F,payload:Y})=>[s("div",FO,[s("div",RO,_(F),1),s("div",LO,_(Y.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])])):m.link_type==2?(h(),D(ee,{key:1},[s("div",VO,[s("div",MO,[s("div",TO,_(d(o)("label_miniprogram_appid")),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultValue:m.miniprogram.appid.value,defaultSelectedList:m.miniprogram.appid.tags,ref:"atInputRef",onOpen:L[8]||(L[8]=F=>a("updateVar")),onChange:L[9]||(L[9]=(F,Y)=>x(m.miniprogram.appid,F,Y)),placeholder:d(o)("ph_input_content")},{option:f(({label:F,payload:Y})=>[s("div",jO,[s("div",PO,_(F),1),s("div",qO,_(Y.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList","placeholder"])]),s("div",HO,_(d(o)("desc_miniprogram_appid")),1)]),s("div",UO,[s("div",JO,[s("div",zO,_(d(o)("label_miniprogram_path")),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultValue:m.miniprogram.pagepath.value,defaultSelectedList:m.miniprogram.pagepath.tags,ref:"atInputRef",onOpen:L[10]||(L[10]=F=>a("updateVar")),onChange:L[11]||(L[11]=(F,Y)=>x(m.miniprogram.pagepath,F,Y)),placeholder:d(o)("ph_input_content")},{option:f(({label:F,payload:Y})=>[s("div",KO,[s("div",GO,_(F),1),s("div",WO,_(Y.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList","placeholder"])])])],64)):Z("",!0)]),s("div",ZO,[s("div",YO,[s("div",null,[L[14]||(L[14]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(o)("label_section_output")),1)])]),s("div",QO,[c(Rs,{"tree-data":r.value},null,8,["tree-data"])])])])}}},t5=_e(e5,[["__scopeId","data-v-d4b01a55"]]),s5={class:"tag-container"},o5={class:"node-options"},n5={class:"options-title"},a5={class:"options-item is-required"},l5={class:"options-item-tit"},i5={class:"option-label"},r5={class:"options-item is-required"},d5={class:"options-item-tit"},u5={class:"option-label"},c5={class:"tag-box"},_5={class:"field-list-item"},p5={class:"field-label"},f5={class:"field-type"},v5={class:"options-item is-required"},h5={class:"options-item-tit"},m5={class:"option-label"},g5={class:"field-list-item"},y5={class:"field-label"},b5={class:"field-type"},k5={class:"desc"},w5={class:"node-options"},C5={class:"options-title"},$5={class:"options-item"},x5="official_batch_tag",S5={__name:"official-tag-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=gn(),a=n,l=e,i=be("setData"),r=U([]),u=U([]),y=U([]),p=we({app_id:void 0,app_secret:"",openid_list:"",tagid:"",tag_type:1,tag_name:1,tag_map:{}}),m=U(!1);Ne(()=>{v()}),Ie(()=>l.action,()=>{var E;r.value=Fs(JSON.parse(JSON.stringify(((E=l.action)==null?void 0:E.output)||"{}")))},{deep:!0,immediate:!0});function v(){C(),g()}function C(){oo({app_type:"official_account"}).then(E=>{u.value=(E==null?void 0:E.data)||[]})}function g(){var N,I;let E=JSON.parse(l.node.node_params),B=((I=(N=E==null?void 0:E.plugin)==null?void 0:N.params)==null?void 0:I.arguments)||{};Object.assign(p,B),p.tagid&&(p.tagid>0?p.tag_type=1:p.tag_type=2,S())}function $(E,B){const{key:N,secret:I,name:L}=B;p.app_secret=I,p.app_name=L,S()}function w(){if(!p.app_secret||!p.app_id)return Me.warning(o("msg_please_select_official_account"));m.value||(m.value=!0,S().then(()=>{Me.success(o("msg_sync_completed"))}).finally(()=>{m.value=!1}))}function S(){return ss({name:x5,action:"default/exec",params:JSON.stringify({business:"getTags",arguments:{app_id:p.app_id,app_secret:p.app_secret}})}).then(E=>{var B;return y.value=((B=E==null?void 0:E.data)==null?void 0:B.tags)||[],E})}function k(E,B,N){E==="openid_list"&&(B=B.trim(),B=B.replace(/，/g,",")),p[E]=B,p.tag_map[E]=N,A()}function b(E,B){p.tag_name=B.name,A()}function x(){p.tag_name="",p.tag_type==1?p.tagid=null:p.tagid=""}function A(){let E=JSON.parse(l.node.node_params);E.plugin.output_obj=r.value,Object.assign(E.plugin.params,{arguments:{...p}}),i({...l.node,node_params:JSON.stringify(E)})}const R=(E,B)=>B.name.toLowerCase().indexOf(E.toLowerCase())>=0;return(E,B)=>{var O,M;const N=et,I=Ye,L=os,q=ct;return h(),D("div",s5,[s("div",o5,[s("div",n5,[s("div",null,[B[7]||(B[7]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(o)("label_section_input")),1)])]),s("div",a5,[s("div",l5,[s("div",i5,_(d(o)("label_official_account")),1)]),s("div",null,[c(I,{value:p.app_id,"onUpdate:value":B[0]||(B[0]=j=>p.app_id=j),placeholder:d(o)("ph_select_official_account"),style:{width:"100%"},onChange:$},{default:f(()=>[(h(!0),D(ee,null,se(u.value,j=>(h(),G(N,{key:j.app_id,name:j.app_name,secret:j.app_secret},{default:f(()=>[T(_(j.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",r5,[s("div",d5,[s("div",u5,_(d(o)("label_official_account_tag")),1),c(q,{title:d(o)("tooltip_sync_tags")},{default:f(()=>[s("a",{onClick:w},[T(_(d(o)("btn_sync"))+" ",1),m.value?(h(),G(L,{key:0,size:"small"})):Z("",!0)])]),_:1},8,["title"])]),s("div",c5,[c(I,{value:p.tag_type,"onUpdate:value":B[1]||(B[1]=j=>p.tag_type=j),onChange:x,style:{width:"120px"}},{default:f(()=>[c(N,{value:1},{default:f(()=>[T(_(d(o)("btn_select_tag")),1)]),_:1}),c(N,{value:2},{default:f(()=>[T(_(d(o)("btn_insert_variable")),1)]),_:1})]),_:1},8,["value"]),p.tag_type==1?(h(),G(I,{key:0,value:p.tagid,"onUpdate:value":B[2]||(B[2]=j=>p.tagid=j),placeholder:d(o)("ph_select_tag"),style:{width:"100%"},onChange:b,"show-search":"","filter-option":R},{default:f(()=>[(h(!0),D(ee,null,se(y.value,j=>(h(),G(N,{key:j.id,value:j.id,name:j.name},{default:f(()=>[T(_(j.name),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["value","placeholder"])):(h(),G(xe,{key:1,type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((O=p.tag_map)==null?void 0:O.tagid)||[],defaultValue:p.tagid,ref:"atInputRef",onOpen:B[3]||(B[3]=j=>a("updateVar")),onChange:B[4]||(B[4]=(j,V)=>k("tagid",j,V)),placeholder:d(o)("ph_input_content")},{option:f(({label:j,payload:V})=>[s("div",_5,[s("div",p5,_(j),1),s("div",f5,_(V.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]))])]),s("div",v5,[s("div",h5,[s("div",m5,_(d(o)("label_fans_openid_list")),1),B[8]||(B[8]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:((M=p.tag_map)==null?void 0:M.openid_list)||[],defaultValue:p.openid_list,ref:"atInputRef",onOpen:B[5]||(B[5]=j=>a("updateVar")),onChange:B[6]||(B[6]=(j,V)=>k("openid_list",j,V)),placeholder:d(o)("ph_input_content")},{option:f(({label:j,payload:V})=>[s("div",g5,[s("div",y5,_(j),1),s("div",b5,_(V.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",k5,_(d(o)("desc_fans_openid_list")),1)])]),s("div",w5,[s("div",C5,[s("div",null,[B[9]||(B[9]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(o)("label_section_output")),1)])]),s("div",$5,[c(Rs,{"tree-data":r.value},null,8,["tree-data"])])])])}}},D5=_e(S5,[["__scopeId","data-v-824c4f2b"]]),A5={class:"field-list-row"},O5={class:"field-list-col field-list-col-head field-name-head"},N5={class:"field-list-col field-list-col-head field-type-head"},B5={key:0,class:"field-list-col field-list-col-head field-value-head"},E5={key:1,class:"field-list-col field-list-col-head field-del-head"},I5={key:0,class:"field-list-row"},F5={class:"field-list-col field-value-col"},R5={class:"field-list-col field-name-col"},L5={key:0,style:{color:"#FB363F","margin-right":"2px"}},V5={class:"field-list-col field-type-col"},M5={key:0,class:"field-list-col field-value-col"},T5={key:0,class:"field-value-inline"},j5={class:"inline-input"},P5={key:2,style:{color:"#FB363F","margin-top":"4px"}},q5={key:1,class:"field-list-col field-del-col"},H5=["onClick"],U5={__name:"index",props:{showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},msgtype:{type:String,default:""}},emits:["change"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.data-table.reply-select.index"),l=o,i=e,r=be("getNode"),u=we({list:[],keys:[]}),y=ye(()=>u.list.some(N=>x(N)));function p(){const N=String(i.msgtype||"").toLowerCase();return N==="link"?"imageText":N==="miniprogrampage"?"card":["text","image","url"].includes(N)?N:"text"}const m={imageText:{url:{required:!0,validator:N=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(N||""))?!0:/^https?:\/\//.test(String(N||"")),validationTip:a("validation_tip_url"),functionalTip:a("functional_tip_url")},title:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_title"),functionalTip:a("functional_tip_title")},description:{required:!0,validator:N=>String(N||"").trim().length>0&&String(N||"").length<=300,validationTip:a("validation_tip_description"),functionalTip:a("functional_tip_description")},thumb_url:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_thumb_url"),functionalTip:a("functional_tip_thumb_url")}},text:{content:{required:!0,validator:N=>String(N||"").trim().length>0&&String(N||"").length<=300,validationTip:a("validation_tip_content"),functionalTip:a("functional_tip_content")}},image:{thumb_url:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_image_thumb_url"),functionalTip:a("functional_tip_image_thumb_url")}},url:{title:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_title"),functionalTip:a("functional_tip_title")},url:{required:!0,validator:N=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(N||""))?!0:/^https?:\/\//.test(String(N||"")),validationTip:a("validation_tip_card_url"),functionalTip:a("functional_tip_card_url")}},card:{title:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_card_title"),functionalTip:a("functional_tip_card_title")},appid:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_appid"),functionalTip:a("functional_tip_appid")},page_path:{required:!0,validator:N=>/^\//.test(String(N||"")),validationTip:a("validation_tip_page_path"),functionalTip:a("functional_tip_page_path")},thumb_url:{required:!0,validator:N=>!!String(N||"").trim(),validationTip:a("validation_tip_card_thumb_url"),functionalTip:a("functional_tip_card_thumb_url")}}};function v(){const N=p(),I=m[N]||{};u.list.forEach((L,q)=>{var H;const O=(L.field_name||"").toLowerCase(),M=I[O]||{};let j={};(typeof L.description<"u"||typeof L.desc<"u"||typeof L.required<"u")&&(j={functionalTip:L.description||L.desc,required:L.required});let V={};if(x(L)){const K=(H=L.properties)==null?void 0:H[L.current_properties_key];K&&(typeof K.description<"u"||typeof K.desc<"u"||typeof K.required<"u")&&(V={functionalTip:K.description||K.desc,required:K.required})}const z={functionalTip:V.functionalTip??j.functionalTip??M.functionalTip??"",required:!!(V.required??j.required??M.required??L.required)};u.list[q].__functionalTip=z.functionalTip,u.list[q].__required=!!z.required,u.list[q].__error=null})}function C(N){var V,z,H,K,F;const I=p(),L=m[I]||{},q=(N.field_name||"").toLowerCase();let O=L[q];if(!O&&x(N)){const Y=(V=N.properties)==null?void 0:V[N.current_properties_key];Y&&(O={required:!!Y.required})}const M=x(N)?((H=(z=N.properties)==null?void 0:z[N.current_properties_key])==null?void 0:H.value)??"":N.value;if(!O)return N.__error=null,!0;const j=x(N)?((F=(K=N.properties)==null?void 0:K[N.current_properties_key])==null?void 0:F.atTags)??[]:N.atTags;return O.required&&!String(M||"").trim()&&(!Array.isArray(j)||j.length===0)||O.validator&&!O.validator(M)?(N.__error=O.validationTip,!1):(N.__error=null,!0)}Ie(()=>i.list,N=>{u.list=N,u.keys=N.map(I=>I.field_name),u.list.forEach(R),v()},{immediate:!0});const g=U([]),$=()=>{let N=r().getAllParentVariable();g.value=N||[]},w=()=>{$()},S=(N,I,L,q)=>{if(x(L)){const O=L.current_properties_key;L.properties[O]||(L.properties[O]={}),L.properties[O].value=N,L.properties[O].atTags=I}else u.list[q].value=N,u.list[q].atTags=I;b()},k=N=>{u.list.splice(N,1),b()},b=()=>{u.keys=u.list.map(N=>N.field_name),l("change",[...u.list],[...u.keys])};Ne(()=>{$()});function x(N){return N.media_component}function A(N,I){var q;const L=(q=N.properties)==null?void 0:q[I];N.current_properties_key=I,N.ui_type=E(L==null?void 0:L.type),N.__functionalTip=(L==null?void 0:L.desc)||"",N.__required=!!(L!=null&&L.required),N.properties[I]||(N.properties[I]={}),N.properties[I].value=N.properties[I].value??"",N.properties[I].atTags=N.properties[I].atTags??[],b()}function R(N){if(!x(N))return;const I=Object.keys(N.properties);if(!N.current_properties_key){const L=I[0];A(N,L)}}function E(N){switch((N||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return N||"Text"}}function B(){let N=!0;const I=[];return u.list.forEach(L=>{var q;if(!C(L)){N=!1;const O=x(L)?((q=L.properties)==null?void 0:q[L.current_properties_key])||{}:null;I.push({field_name:(O==null?void 0:O.name)||L.name||L.field_name,message:(O==null?void 0:O.error)||L.__error,functionalTip:(O==null?void 0:O.desc)||L.__functionalTip})}}),{ok:N,errors:I}}return n({validateAll:B}),(N,I)=>{const L=pt,q=ct,O=et,M=Ye,j=It;return h(),D("div",null,[s("div",{class:qe(["field-list",{"wide-value-col":y.value}])},[s("div",A5,[s("div",O5,_(d(a)("label_field_name")),1),s("div",N5,_(d(a)("label_type")),1),e.showInput?(h(),D("div",B5,_(d(a)("label_field_value")),1)):Z("",!0),i.showDelete?(h(),D("div",E5)):Z("",!0)]),e.showEmptyFieldRow?(h(),D("div",I5,[I[0]||(I[0]=s("div",{class:"field-list-col field-name-col"},"--",-1)),I[1]||(I[1]=s("div",{class:"field-list-col field-type-col"},"--",-1)),s("div",F5,[c(q,{title:d(a)("ph_select_database_first")},{default:f(()=>[c(L,{disabled:!0,placeholder:d(a)("ph_input_value_variable")},null,8,["placeholder"])]),_:1},8,["title"])])])):Z("",!0),(h(!0),D(ee,null,se(u.list,(V,z)=>{var H,K,F,Y,le,J;return h(),D("div",{class:"field-list-row",key:V.field_name},[s("div",R5,[V.__required?(h(),D("span",L5,"*")):Z("",!0),T(" "+_(((K=(H=V.properties)==null?void 0:H[V.current_properties_key])==null?void 0:K.name)||V.name)+" ",1),V.__functionalTip?(h(),G(q,{key:1,title:V.__functionalTip},{default:f(()=>[c(d(Re),{style:{cursor:"pointer"}})]),_:1},8,["title"])):Z("",!0)]),s("div",V5,_(V.ui_type),1),e.showInput?(h(),D("div",M5,[x(V)?(h(),D("div",T5,[c(M,{value:V.current_properties_key,"onUpdate:value":P=>V.current_properties_key=P,onChange:P=>A(V,P)},{default:f(()=>[(h(!0),D(ee,null,se(V.properties||{},(P,W)=>(h(),G(O,{key:W,value:W},{default:f(()=>[T(_(P.name||W),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"]),s("div",j5,[c(xe,{options:g.value,defaultValue:((Y=(F=V.properties)==null?void 0:F[V.current_properties_key])==null?void 0:Y.value)??"",defaultSelectedList:((J=(le=V.properties)==null?void 0:le[V.current_properties_key])==null?void 0:J.atTags)??[],onOpen:w,onChange:(P,W)=>S(P,W,V,z),placeholder:d(a)("ph_input_param_variable")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])])])):(h(),G(xe,{key:1,options:g.value,defaultValue:V.value,defaultSelectedList:V.atTags,onOpen:w,onChange:(P,W)=>S(P,W,V,z),placeholder:d(a)("ph_input_param_variable")},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])),V.__error?(h(),D("div",P5,_(V.__error),1)):Z("",!0)])):Z("",!0),i.showDelete?(h(),D("div",q5,[s("span",{class:"del-btn",onClick:P=>k(z)},[c(j,{class:"del-icon",name:"close-circle"})],8,H5)])):Z("",!0)])}),128))],2)])}}},J5=_e(U5,[["__scopeId","data-v-57a070d1"]]),z5={class:"add-data-form"},K5={class:"node-box-content"},G5={class:"setting-label"},W5={class:"tip"},Z5={class:"setting-box"},Y5={__name:"reply-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.official-send-message.reply-data"),l=o,i=e,r=U([]),u=U(null);function y(C=null){var g,$,w;r.value=[],Array.isArray((w=($=(g=C==null?void 0:C.plugin)==null?void 0:g.params)==null?void 0:$.arguments)==null?void 0:w.fields)&&C.plugin.params.arguments.fields.length?(C.plugin.params.arguments.fields.map(S=>{S.value=S.value.toString()}),r.value=C.plugin.params.arguments.fields):i.fields.map(S=>{r.value.push({value:"",atTags:[],...S})})}const p=C=>{r.value=C,m()},m=()=>{l("update",{fields:Ht(r.value)})};function v(){var C,g;return(g=(C=u.value)==null?void 0:C.validateAll)==null?void 0:g.call(C)}return n({init:y,validateAll:v}),(C,g)=>(h(),D("div",z5,[s("div",K5,[s("div",G5,[s("span",null,_(d(a)("label_reply_content")),1),s("span",W5,_(d(a)("msg_empty_field_tip")),1)]),s("div",Z5,[c(J5,{ref_key:"fieldRef",ref:u,showEmptyFieldRow:!e.tableId,list:r.value,fields:e.fields,msgtype:e.tableId,showAdd:!1,showDelete:!1,onChange:p},null,8,["showEmptyFieldRow","list","fields","msgtype"])])])]))}},Q5=_e(Y5,[["__scopeId","data-v-583a7caf"]]),X5={class:"main-box"},e7={key:0,class:"loading-box"},t7={class:"node-options"},s7={class:"options-title"},o7={class:"options-item is-required"},n7={class:"options-item-tit"},a7={class:"option-label"},l7={class:"options-item is-required"},i7={class:"options-item-tit"},r7={class:"option-label"},d7={class:"field-list-item"},u7={class:"field-label"},c7={class:"field-type"},_7={class:"options-item is-required"},p7={class:"options-item-tit"},f7={class:"option-label"},v7={class:"node-options"},h7={class:"options-title"},m7={class:"options-item"},Wn="official_send_message",g7={__name:"official-send-message-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.components.official-send-message.official-send-message-box"),a=n,l=e,i=be("setData"),r=U(null),u=we({app_id:null,msgtype:void 0,receiver:"",receiver_tags:[],app_secret:"",app_name:""}),y=U(!1),p=U(!1),m=U({}),v=U([]),C=U([]),g=U([]),$=U([]);Ne(()=>{w(),mo({name:"workflow:validate",callback:I})});async function w(){await S(),R(),O()}function S(){return oo({app_type:"official_account"}).then(M=>{v.value=(M==null?void 0:M.data)||[]})}function k(){return y.value=!0,ss({name:Wn,action:"default/exec",params:JSON.stringify({business:"getMsgType",arguments:{app_id:u.app_id}})}).then(M=>(m.value=(M==null?void 0:M.data)||{},C.value=m.value.items||[],!u.msgtype&&C.value.length==1&&(u.msgtype=C.value[0].msgtype,B()),M)).finally(()=>{y.value=!1})}function b(){return p.value=!0,ss({name:Wn,action:"default/exec",params:JSON.stringify({business:"getMsgInput",arguments:{app_id:u.app_id,app_secret:u.app_secret,msgtype:u.msgtype}})}).then(M=>{var V;let j=((V=M==null?void 0:M.data)==null?void 0:V.items)||[];return g.value=j.map(z=>({field_name:z.field||z.name,ui_type:x(z.type),name:z.name,description:z.desc,required:!!z.required,media_component:!!z.media_component,properties:z.properties||null})),M}).finally(()=>{p.value=!1})}function x(M){switch((M||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return M||"Text"}}function A(M){if(!M)return el(l.actionName);M=JSON.parse(JSON.stringify(M));for(let j in M)switch(j){case"filter":if(Array.isArray(M.filter.conditions)&&M.filter.conditions.length)for(let V of M.filter.conditions)V.field_type==="DateTime"&&V.value&&(V.value<1e11&&(V.value*=1e3),V.value=["ExactDate",V.value].join(","));break;case"fields":for(let V of M.fields)V.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(V.ui_type)&&(V.value=Number(V.value)),V.ui_type==="Currency"&&(V.value=V.value.toFixed(2))),V.ui_type==="Checkbox"&&(V.value=V.value=="true"),V.ui_type==="MultiSelect"&&(V.value=V.value.replace(/，/g,",").split(",")),V.ui_type==="DateTime"&&V.value<1e11&&(V.value*=1e3);break;case"field_names":M.field_names=M.field_names.map(V=>V.field_name);break;case"sort":M.sort=M.sort.map(V=>({field_name:V.field_name,desc:V.is_asc!=1}));break}return M}function R(){var V,z;let M=JSON.parse(l.node.node_params),j=((z=(V=M==null?void 0:M.plugin)==null?void 0:V.params)==null?void 0:z.arguments)||{};j.app_id&&(u.app_id=j.app_id),j.msgtype&&(u.msgtype=j.msgtype),j.receiver&&(u.receiver=String(j.receiver)),j.openid&&(u.receiver=String(j.openid)),j.touser&&(u.receiver=String(j.touser)),j.tag_map&&j.tag_map.receiver&&(u.receiver_tags=j.tag_map.receiver),j.app_secret&&(u.app_secret=String(j.app_secret)),j.app_name&&(u.app_name=String(j.app_name)),u.app_id&&k(),u.msgtype&&b().then(()=>N(M))}function E(M,j){m.value={},C.value=[],g.value=[],u.msgtype=void 0,j&&j.app_secret&&(u.app_secret=j.app_secret),j&&j.name&&(u.app_name=j.name),u.app_id?k().then(()=>N()):N(),L()}function B(){g.value=[],b().then(()=>N()),L()}function N(M=null){Ze(()=>{r.value&&typeof r.value.init=="function"&&r.value.init(M)})}function I(){const M=mo();if(r.value&&typeof r.value.validateAll=="function"){const j=r.value.validateAll(),V=C.value.find(z=>z.msgtype==u.msgtype);j&&j.ok===!1&&M.emit&&M.emit("workflow:validate:error",{component:o("component_official_send_message"),type:u.msgtype,typeDisplay:(V==null?void 0:V.name)||u.msgtype,message:o("msg_complete_required_fields"),errors:j.errors||[]})}}function L(M=null){let j=JSON.parse(l.node.node_params),V=C.value.find(z=>z.msgtype==u.msgtype);j.plugin.output_obj=$.value,Object.assign(j.plugin.params,{arguments:{app_id:String(u.app_id||""),app_secret:String(u.app_secret||""),msgtype:String(u.msgtype||""),touser:String(u.receiver||""),fields:(A(M)||{}).fields||[],app_name:String(u.app_name||""),msg_type_name:String((V==null?void 0:V.name)||"")}}),i({...l.node,node_params:JSON.stringify(j)})}function q(M,j){u.receiver=M,u.receiver_tags=j,L()}function O(){$.value=Fs(l.action.output)}return(M,j)=>{const V=os,z=et,H=Ye,K=ct;return h(),D("div",X5,[p.value||y.value?(h(),D("div",e7,[c(V)])):Z("",!0),s("div",t7,[s("div",s7,[s("div",null,[j[6]||(j[6]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(o)("title_input")),1)])]),s("div",o7,[s("div",n7,[s("div",a7,_(d(o)("label_official_account")),1)]),s("div",null,[c(H,{value:u.app_id,"onUpdate:value":j[0]||(j[0]=F=>u.app_id=F),placeholder:d(o)("ph_select_official_account"),style:{width:"100%"},onChange:j[1]||(j[1]=(F,Y)=>E(F,Y))},{default:f(()=>[(h(!0),D(ee,null,se(v.value,F=>(h(),G(z,{key:F.app_id,value:F.app_id,name:F.app_name,app_secret:F.app_secret},{default:f(()=>[T(_(F.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",l7,[s("div",i7,[s("div",r7,[T(_(d(o)("label_receiver"))+" ",1),c(K,{title:d(o)("tooltip_receiver_openid")},{default:f(()=>[c(d(Re))]),_:1},8,["title"])])]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:e.variableOptions,defaultSelectedList:u.receiver_tags,defaultValue:u.receiver,onOpen:j[2]||(j[2]=F=>a("updateVar")),onChange:j[3]||(j[3]=(F,Y)=>q(F,Y)),placeholder:d(o)("ph_input_receiver")},{option:f(({label:F,payload:Y})=>[s("div",d7,[s("div",u7,_(F),1),s("div",c7,_(Y.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])]),s("div",_7,[s("div",p7,[s("div",f7,_(d(o)("label_message_type")),1)]),s("div",null,[c(H,{value:u.msgtype,"onUpdate:value":j[4]||(j[4]=F=>u.msgtype=F),onChange:B,placeholder:u.app_id?d(o)("ph_select_message_type"):d(o)("ph_select_official_account_first"),style:{width:"100%"}},{default:f(()=>[(h(!0),D(ee,null,se(C.value,F=>(h(),G(z,{key:F.msgtype,value:F.msgtype},{default:f(()=>[T(_(F.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),c(Q5,{ref_key:"childRef",ref:r,tableId:u.msgtype,fields:g.value,variableOptions:e.variableOptions,onUpdate:L,onUpdateVar:j[5]||(j[5]=F=>a("updateVar"))},null,8,["tableId","fields","variableOptions"])]),s("div",v7,[s("div",h7,[s("div",null,[j[7]||(j[7]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(o)("title_output")),1)])]),s("div",m7,[c(Rs,{"tree-data":$.value},null,8,["tree-data"])])])])}}},y7=_e(g7,[["__scopeId","data-v-7b02ac09"]]),gl="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.0946%2014.4079C4.97757%2014.0753%203.98327%2013.4579%203.19596%2012.6398C3.48967%2012.2917%203.66667%2011.8419%203.66667%2011.3508C3.66667%2010.2462%202.77124%209.35078%201.66667%209.35078C1.59985%209.35078%201.5338%209.35408%201.46867%209.36048C1.37993%208.92665%201.33334%208.47752%201.33334%208.01745C1.33334%207.32058%201.44026%206.64868%201.6386%206.01725C1.64794%206.01738%201.6573%206.01745%201.66667%206.01745C2.77124%206.01745%203.66667%205.12202%203.66667%204.01745C3.66667%203.70035%203.59287%203.40052%203.46154%203.13412C4.2325%202.41725%205.1735%201.88076%206.21737%201.5918C6.54814%202.24015%207.22224%202.68413%208%202.68413C8.77777%202.68413%209.45187%202.24015%209.78264%201.5918C10.8265%201.88076%2011.7675%202.41725%2012.5385%203.13412C12.4071%203.40052%2012.3333%203.70035%2012.3333%204.01745C12.3333%205.12202%2013.2288%206.01745%2014.3333%206.01745C14.3427%206.01745%2014.3521%206.01738%2014.3614%206.01725C14.5597%206.64868%2014.6667%207.32058%2014.6667%208.01745C14.6667%208.47752%2014.6201%208.92665%2014.5313%209.36048C14.4662%209.35408%2014.4002%209.35078%2014.3333%209.35078C13.2288%209.35078%2012.3333%2010.2462%2012.3333%2011.3508C12.3333%2011.8419%2012.5103%2012.2917%2012.804%2012.6398C12.0167%2013.4579%2011.0224%2014.0753%209.9054%2014.4079C9.6476%2013.6014%208.892%2013.0175%208%2013.0175C7.108%2013.0175%206.3524%2013.6014%206.0946%2014.4079Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M8%2010.3503C9.28866%2010.3503%2010.3333%209.30559%2010.3333%208.01693C10.3333%206.72826%209.28866%205.68359%208%205.68359C6.71133%205.68359%205.66666%206.72826%205.66666%208.01693C5.66666%209.30559%206.71133%2010.3503%208%2010.3503Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e";/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function Zn(e){return Object.prototype.toString.call(e)==="[object Object]"}function Kt(e){var n,o;return Zn(e)===!1?!1:(n=e.constructor,n===void 0?!0:(o=n.prototype,!(Zn(o)===!1||o.hasOwnProperty("isPrototypeOf")===!1)))}function Cs(e){for(var n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];throw Error("[Immer] minified error nr: "+e+(o.length?" "+o.map((function(l){return"'"+l+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function to(e){return!!e&&!!e[us]}function so(e){var n;return!!e&&((function(o){if(!o||typeof o!="object")return!1;var a=Object.getPrototypeOf(o);if(a===null)return!0;var l=Object.hasOwnProperty.call(a,"constructor")&&a.constructor;return l===Object||typeof l=="function"&&Function.toString.call(l)===D7})(e)||Array.isArray(e)||!!e[na]||!!(!((n=e.constructor)===null||n===void 0)&&n[na])||Fn(e)||Rn(e))}function Io(e,n,o){o===void 0&&(o=!1),$o(e)===0?(o?Object.keys:jn)(e).forEach((function(a){o&&typeof a=="symbol"||n(a,e[a],e)})):e.forEach((function(a,l){return n(l,a,e)}))}function $o(e){var n=e[us];return n?n.i>3?n.i-4:n.i:Array.isArray(e)?1:Fn(e)?2:Rn(e)?3:0}function pn(e,n){return $o(e)===2?e.has(n):Object.prototype.hasOwnProperty.call(e,n)}function b7(e,n){return $o(e)===2?e.get(n):e[n]}function yl(e,n,o){var a=$o(e);a===2?e.set(n,o):a===3?e.add(o):e[n]=o}function k7(e,n){return e===n?e!==0||1/e==1/n:e!=e&&n!=n}function Fn(e){return x7&&e instanceof Map}function Rn(e){return S7&&e instanceof Set}function Ys(e){return e.o||e.t}function Ln(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var n=A7(e);delete n[us];for(var o=jn(n),a=0;a<o.length;a++){var l=o[a],i=n[l];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(n[l]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[l]})}return Object.create(Object.getPrototypeOf(e),n)}function Vn(e,n){return n===void 0&&(n=!1),Mn(e)||to(e)||!so(e)||($o(e)>1&&(e.set=e.add=e.clear=e.delete=w7),Object.freeze(e),n&&Io(e,(function(o,a){return Vn(a,!0)}),!0)),e}function w7(){Cs(2)}function Mn(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Bs(e){var n=O7[e];return n||Cs(18,e),n}function Yn(){return Fo}function nn(e,n){n&&(Bs("Patches"),e.u=[],e.s=[],e.v=n)}function Jo(e){fn(e),e.p.forEach(C7),e.p=null}function fn(e){e===Fo&&(Fo=e.l)}function Qn(e){return Fo={p:[],l:Fo,h:e,m:!0,_:0}}function C7(e){var n=e[us];n.i===0||n.i===1?n.j():n.g=!0}function an(e,n){n._=n.p.length;var o=n.p[0],a=e!==void 0&&e!==o;return n.h.O||Bs("ES5").S(n,e,a),a?(o[us].P&&(Jo(n),Cs(4)),so(e)&&(e=zo(n,e),n.l||Ko(n,e)),n.u&&Bs("Patches").M(o[us].t,e,n.u,n.s)):e=zo(n,o,[]),Jo(n),n.u&&n.v(n.u,n.s),e!==bl?e:void 0}function zo(e,n,o){if(Mn(n))return n;var a=n[us];if(!a)return Io(n,(function(u,y){return Xn(e,a,n,u,y,o)}),!0),n;if(a.A!==e)return n;if(!a.P)return Ko(e,a.t,!0),a.t;if(!a.I){a.I=!0,a.A._--;var l=a.i===4||a.i===5?a.o=Ln(a.k):a.o,i=l,r=!1;a.i===3&&(i=new Set(l),l.clear(),r=!0),Io(i,(function(u,y){return Xn(e,a,l,u,y,o,r)})),Ko(e,l,!1),o&&e.u&&Bs("Patches").N(a,o,e.u,e.s)}return a.o}function Xn(e,n,o,a,l,i,r){if(to(l)){var u=zo(e,l,i&&n&&n.i!==3&&!pn(n.R,a)?i.concat(a):void 0);if(yl(o,a,u),!to(u))return;e.m=!1}else r&&o.add(l);if(so(l)&&!Mn(l)){if(!e.h.D&&e._<1)return;zo(e,l),n&&n.A.l||Ko(e,l)}}function Ko(e,n,o){o===void 0&&(o=!1),!e.l&&e.h.D&&e.m&&Vn(n,o)}function ln(e,n){var o=e[us];return(o?Ys(o):e)[n]}function ea(e,n){if(n in e)for(var o=Object.getPrototypeOf(e);o;){var a=Object.getOwnPropertyDescriptor(o,n);if(a)return a;o=Object.getPrototypeOf(o)}}function vn(e){e.P||(e.P=!0,e.l&&vn(e.l))}function rn(e){e.o||(e.o=Ln(e.t))}function hn(e,n,o){var a=Fn(n)?Bs("MapSet").F(n,o):Rn(n)?Bs("MapSet").T(n,o):e.O?(function(l,i){var r=Array.isArray(l),u={i:r?1:0,A:i?i.A:Yn(),P:!1,I:!1,R:{},l:i,t:l,k:null,o:null,j:null,C:!1},y=u,p=mn;r&&(y=[u],p=Ao);var m=Proxy.revocable(y,p),v=m.revoke,C=m.proxy;return u.k=C,u.j=v,C})(n,o):Bs("ES5").J(n,o);return(o?o.A:Yn()).p.push(a),a}function $7(e){return to(e)||Cs(22,e),(function n(o){if(!so(o))return o;var a,l=o[us],i=$o(o);if(l){if(!l.P&&(l.i<4||!Bs("ES5").K(l)))return l.t;l.I=!0,a=ta(o,i),l.I=!1}else a=ta(o,i);return Io(a,(function(r,u){l&&b7(l.t,r)===u||yl(a,r,n(u))})),i===3?new Set(a):a})(e)}function ta(e,n){switch(n){case 2:return new Map(e);case 3:return Array.from(e)}return Ln(e)}var sa,Fo,Tn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",x7=typeof Map<"u",S7=typeof Set<"u",oa=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",bl=Tn?Symbol.for("immer-nothing"):((sa={})["immer-nothing"]=!0,sa),na=Tn?Symbol.for("immer-draftable"):"__$immer_draftable",us=Tn?Symbol.for("immer-state"):"__$immer_state",D7=""+Object.prototype.constructor,jn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,A7=Object.getOwnPropertyDescriptors||function(e){var n={};return jn(e).forEach((function(o){n[o]=Object.getOwnPropertyDescriptor(e,o)})),n},O7={},mn={get:function(e,n){if(n===us)return e;var o=Ys(e);if(!pn(o,n))return(function(l,i,r){var u,y=ea(i,r);return y?"value"in y?y.value:(u=y.get)===null||u===void 0?void 0:u.call(l.k):void 0})(e,o,n);var a=o[n];return e.I||!so(a)?a:a===ln(e.t,n)?(rn(e),e.o[n]=hn(e.A.h,a,e)):a},has:function(e,n){return n in Ys(e)},ownKeys:function(e){return Reflect.ownKeys(Ys(e))},set:function(e,n,o){var a=ea(Ys(e),n);if(a!=null&&a.set)return a.set.call(e.k,o),!0;if(!e.P){var l=ln(Ys(e),n),i=l==null?void 0:l[us];if(i&&i.t===o)return e.o[n]=o,e.R[n]=!1,!0;if(k7(o,l)&&(o!==void 0||pn(e.t,n)))return!0;rn(e),vn(e)}return e.o[n]===o&&(o!==void 0||n in e.o)||Number.isNaN(o)&&Number.isNaN(e.o[n])||(e.o[n]=o,e.R[n]=!0),!0},deleteProperty:function(e,n){return ln(e.t,n)!==void 0||n in e.t?(e.R[n]=!1,rn(e),vn(e)):delete e.R[n],e.o&&delete e.o[n],!0},getOwnPropertyDescriptor:function(e,n){var o=Ys(e),a=Reflect.getOwnPropertyDescriptor(o,n);return a&&{writable:!0,configurable:e.i!==1||n!=="length",enumerable:a.enumerable,value:o[n]}},defineProperty:function(){Cs(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Cs(12)}},Ao={};Io(mn,(function(e,n){Ao[e]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}})),Ao.deleteProperty=function(e,n){return Ao.set.call(this,e,n,void 0)},Ao.set=function(e,n,o){return mn.set.call(this,e[0],n,o,e[0])};var N7=(function(){function e(o){var a=this;this.O=oa,this.D=!0,this.produce=function(l,i,r){if(typeof l=="function"&&typeof i!="function"){var u=i;i=l;var y=a;return function(w){var S=this;w===void 0&&(w=u);for(var k=arguments.length,b=Array(k>1?k-1:0),x=1;x<k;x++)b[x-1]=arguments[x];return y.produce(w,(function(A){var R;return(R=i).call.apply(R,[S,A].concat(b))}))}}var p;if(typeof i!="function"&&Cs(6),r!==void 0&&typeof r!="function"&&Cs(7),so(l)){var m=Qn(a),v=hn(a,l,void 0),C=!0;try{p=i(v),C=!1}finally{C?Jo(m):fn(m)}return typeof Promise<"u"&&p instanceof Promise?p.then((function(w){return nn(m,r),an(w,m)}),(function(w){throw Jo(m),w})):(nn(m,r),an(p,m))}if(!l||typeof l!="object"){if((p=i(l))===void 0&&(p=l),p===bl&&(p=void 0),a.D&&Vn(p,!0),r){var g=[],$=[];Bs("Patches").M(l,p,g,$),r(g,$)}return p}Cs(21,l)},this.produceWithPatches=function(l,i){if(typeof l=="function")return function(p){for(var m=arguments.length,v=Array(m>1?m-1:0),C=1;C<m;C++)v[C-1]=arguments[C];return a.produceWithPatches(p,(function(g){return l.apply(void 0,[g].concat(v))}))};var r,u,y=a.produce(l,i,(function(p,m){r=p,u=m}));return typeof Promise<"u"&&y instanceof Promise?y.then((function(p){return[p,r,u]})):[y,r,u]},typeof(o==null?void 0:o.useProxies)=="boolean"&&this.setUseProxies(o.useProxies),typeof(o==null?void 0:o.autoFreeze)=="boolean"&&this.setAutoFreeze(o.autoFreeze)}var n=e.prototype;return n.createDraft=function(o){so(o)||Cs(8),to(o)&&(o=$7(o));var a=Qn(this),l=hn(this,o,void 0);return l[us].C=!0,fn(a),l},n.finishDraft=function(o,a){var l=o&&o[us],i=l.A;return nn(i,a),an(void 0,i)},n.setAutoFreeze=function(o){this.D=o},n.setUseProxies=function(o){o&&!oa&&Cs(20),this.O=o},n.applyPatches=function(o,a){var l;for(l=a.length-1;l>=0;l--){var i=a[l];if(i.path.length===0&&i.op==="replace"){o=i.value;break}}l>-1&&(a=a.slice(l+1));var r=Bs("Patches").$;return to(o)?r(o,a):this.produce(o,(function(u){return r(u,a)}))},e})(),cs=new N7,sn=cs.produce;cs.produceWithPatches.bind(cs);cs.setAutoFreeze.bind(cs);cs.setUseProxies.bind(cs);cs.applyPatches.bind(cs);var aa=cs.createDraft.bind(cs),la=cs.finishDraft.bind(cs);function Ps(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}var ia=new WeakMap,ra=new WeakMap,da=new WeakMap,ua=new WeakMap,ca=new WeakMap,_a=new WeakMap;function B7(e,n){if(e==null)return{};var o={},a=Object.keys(e),l,i;for(i=0;i<a.length;i++)l=a[i],!(n.indexOf(l)>=0)&&(o[l]=e[l]);return o}function Vs(e,n){if(e==null)return{};var o=B7(e,n),a,l;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)a=i[l],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var Pn=function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=!o,l=o?V7(n):n,i=ot.None,r=ot.None,u=0,y=null,p=null;for(var m of l){var v=m.codePointAt(0);if(!v)break;var C=W7(m,v);if([i,r]=a?[r,C]:[C,i],po(i,ot.ZWJ)&&po(r,ot.ExtPict)&&(a?y=pa(n.substring(0,u)):y=pa(n.substring(0,n.length-u)),!y)||po(i,ot.RI)&&po(r,ot.RI)&&(p!==null?p=!p:a?p=!0:p=eN(n.substring(0,n.length-u)),!p)||i!==ot.None&&r!==ot.None&&Y7(i,r))break;u+=m.length}return u||1},E7=/\s/,I7=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,F7=/['\u2018\u2019]/,R7=function(n){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=0,l=!1;n.length>0;){var i=Pn(n,o),[r,u]=qn(n,i,o);if(L7(r,u,o))l=!0,a+=i;else if(!l)a+=i;else break;n=u}return a},qn=(e,n,o)=>{if(o){var a=e.length-n;return[e.slice(a,e.length),e.slice(0,a)]}return[e.slice(0,n),e.slice(n)]},L7=function e(n,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(E7.test(n))return!1;if(F7.test(n)){var l=Pn(o,a),[i,r]=qn(o,l,a);if(e(i,r,a))return!0}return!I7.test(n)},V7=function*(n){for(var o=n.length-1,a=0;a<n.length;a++){var l=n.charAt(o-a);if(T7(l.charCodeAt(0))){var i=n.charAt(o-a-1);if(M7(i.charCodeAt(0))){yield i+l,a++;continue}}yield l}},M7=e=>e>=55296&&e<=56319,T7=e=>e>=56320&&e<=57343,ot;(function(e){e[e.None=0]="None",e[e.Extend=1]="Extend",e[e.ZWJ=2]="ZWJ",e[e.RI=4]="RI",e[e.Prepend=8]="Prepend",e[e.SpacingMark=16]="SpacingMark",e[e.L=32]="L",e[e.V=64]="V",e[e.T=128]="T",e[e.LV=256]="LV",e[e.LVT=512]="LVT",e[e.ExtPict=1024]="ExtPict",e[e.Any=2048]="Any"})(ot||(ot={}));var j7=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])$/,P7=/^(?:[\u0600-\u0605\u06DD\u070F\u0890\u0891\u08E2\u0D4E]|\uD804[\uDCBD\uDCCD\uDDC2\uDDC3]|\uD806[\uDD3F\uDD41\uDE3A\uDE84-\uDE89]|\uD807\uDD46)$/,q7=/^(?:[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BF\u09C0\u09C7\u09C8\u09CB\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0\u0CC1\u0CC3\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0D02\u0D03\u0D3F\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82\u0D83\u0DD0\u0DD1\u0DD8-\u0DDE\u0DF2\u0DF3\u0E33\u0EB3\u0F3E\u0F3F\u0F7F\u1031\u103B\u103C\u1056\u1057\u1084\u1715\u1734\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1A19\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF7\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BE-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD45\uDD46\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0\uDDCE\uDE2C-\uDE2E\uDE32\uDE33\uDE35\uDEE0-\uDEE2\uDF02\uDF03\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF62\uDF63]|\uD805[\uDC35-\uDC37\uDC40\uDC41\uDC45\uDCB1\uDCB2\uDCB9\uDCBB\uDCBC\uDCBE\uDCC1\uDDB0\uDDB1\uDDB8-\uDDBB\uDDBE\uDE30-\uDE32\uDE3B\uDE3C\uDE3E\uDEAC\uDEAE\uDEAF\uDEB6\uDF26]|\uD806[\uDC2C-\uDC2E\uDC38\uDD31-\uDD35\uDD37\uDD38\uDD3D\uDD40\uDD42\uDDD1-\uDDD3\uDDDC-\uDDDF\uDDE4\uDE39\uDE57\uDE58\uDE97]|\uD807[\uDC2F\uDC3E\uDCA9\uDCB1\uDCB4\uDD8A-\uDD8E\uDD93\uDD94\uDD96\uDEF5\uDEF6]|\uD81B[\uDF51-\uDF87\uDFF0\uDFF1]|\uD834[\uDD66\uDD6D])$/,H7=/^[\u1100-\u115F\uA960-\uA97C]$/,U7=/^[\u1160-\u11A7\uD7B0-\uD7C6]$/,J7=/^[\u11A8-\u11FF\uD7CB-\uD7FB]$/,z7=/^[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]$/,K7=/^[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]$/,G7=/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])$/,W7=(e,n)=>{var o=ot.Any;return e.search(j7)!==-1&&(o|=ot.Extend),n===8205&&(o|=ot.ZWJ),n>=127462&&n<=127487&&(o|=ot.RI),e.search(P7)!==-1&&(o|=ot.Prepend),e.search(q7)!==-1&&(o|=ot.SpacingMark),e.search(H7)!==-1&&(o|=ot.L),e.search(U7)!==-1&&(o|=ot.V),e.search(J7)!==-1&&(o|=ot.T),e.search(z7)!==-1&&(o|=ot.LV),e.search(K7)!==-1&&(o|=ot.LVT),e.search(G7)!==-1&&(o|=ot.ExtPict),o};function po(e,n){return(e&n)!==0}var Z7=[[ot.L,ot.L|ot.V|ot.LV|ot.LVT],[ot.LV|ot.V,ot.V|ot.T],[ot.LVT|ot.T,ot.T],[ot.Any,ot.Extend|ot.ZWJ],[ot.Any,ot.SpacingMark],[ot.Prepend,ot.Any],[ot.ZWJ,ot.ExtPict],[ot.RI,ot.RI]];function Y7(e,n){return Z7.findIndex(o=>po(e,o[0])&&po(n,o[1]))===-1}var Q7=/(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])*\u200D$/,pa=e=>e.search(Q7)!==-1,X7=/(?:\uD83C[\uDDE6-\uDDFF])+$/g,eN=e=>{var n=e.match(X7);if(n===null)return!1;var o=n[0].length/2;return o%2===1},fa=e=>Kt(e)&&Pe.isNodeList(e.children)&&!te.isEditor(e),Et={isAncestor(e){return Kt(e)&&Pe.isNodeList(e.children)},isElement:fa,isElementList(e){return Array.isArray(e)&&e.every(n=>Et.isElement(n))},isElementProps(e){return e.children!==void 0},isElementType:function(n,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";return fa(n)&&n[a]===o},matches(e,n){for(var o in n)if(o!=="children"&&e[o]!==n[o])return!1;return!0}},tN=["text"],sN=["text"];function va(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function co(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?va(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):va(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var ha=new WeakMap,te={above(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{voids:o=!1,mode:a="lowest",at:l=e.selection,match:i}=n;if(l){var r=te.path(e,l),u=a==="lowest";for(var[y,p]of te.levels(e,{at:r,voids:o,match:i,reverse:u}))if(!it.isText(y)&&!pe.equals(r,p))return[y,p]}},addMark(e,n,o){e.addMark(n,o)},after(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=te.point(e,n,{edge:"end"}),l=te.end(e,[]),i={anchor:a,focus:l},{distance:r=1}=o,u=0,y;for(var p of te.positions(e,co(co({},o),{},{at:i}))){if(u>r)break;u!==0&&(y=p),u++}return y},before(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=te.start(e,[]),l=te.point(e,n,{edge:"start"}),i={anchor:a,focus:l},{distance:r=1}=o,u=0,y;for(var p of te.positions(e,co(co({},o),{},{at:i,reverse:!0}))){if(u>r)break;u!==0&&(y=p),u++}return y},deleteBackward(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:o="character"}=n;e.deleteBackward(o)},deleteForward(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:o="character"}=n;e.deleteForward(o)},deleteFragment(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:o="forward"}=n;e.deleteFragment(o)},edges(e,n){return[te.start(e,n),te.end(e,n)]},end(e,n){return te.point(e,n,{edge:"end"})},first(e,n){var o=te.path(e,n,{edge:"start"});return te.node(e,o)},fragment(e,n){var o=te.range(e,n),a=Pe.fragment(e,o);return a},hasBlocks(e,n){return n.children.some(o=>te.isBlock(e,o))},hasInlines(e,n){return n.children.some(o=>it.isText(o)||te.isInline(e,o))},hasTexts(e,n){return n.children.every(o=>it.isText(o))},insertBreak(e){e.insertBreak()},insertFragment(e,n){e.insertFragment(n)},insertNode(e,n){e.insertNode(n)},insertText(e,n){e.insertText(n)},isBlock(e,n){return Et.isElement(n)&&!e.isInline(n)},isEditor(e){if(!Kt(e))return!1;var n=ha.get(e);if(n!==void 0)return n;var o=typeof e.addMark=="function"&&typeof e.apply=="function"&&typeof e.deleteBackward=="function"&&typeof e.deleteForward=="function"&&typeof e.deleteFragment=="function"&&typeof e.insertBreak=="function"&&typeof e.insertFragment=="function"&&typeof e.insertNode=="function"&&typeof e.insertText=="function"&&typeof e.isInline=="function"&&typeof e.isVoid=="function"&&typeof e.normalizeNode=="function"&&typeof e.onChange=="function"&&typeof e.removeMark=="function"&&(e.marks===null||Kt(e.marks))&&(e.selection===null||Oe.isRange(e.selection))&&Pe.isNodeList(e.children)&&Oo.isOperationList(e.operations);return ha.set(e,o),o},isEnd(e,n,o){var a=te.end(e,o);return Ct.equals(n,a)},isEdge(e,n,o){return te.isStart(e,n,o)||te.isEnd(e,n,o)},isEmpty(e,n){var{children:o}=n,[a]=o;return o.length===0||o.length===1&&it.isText(a)&&a.text===""&&!e.isVoid(n)},isInline(e,n){return Et.isElement(n)&&e.isInline(n)},isNormalizing(e){var n=da.get(e);return n===void 0?!0:n},isStart(e,n,o){if(n.offset!==0)return!1;var a=te.start(e,o);return Ct.equals(n,a)},isVoid(e,n){return Et.isElement(n)&&e.isVoid(n)},last(e,n){var o=te.path(e,n,{edge:"end"});return te.node(e,o)},leaf(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=te.path(e,n,o),l=Pe.leaf(e,a);return[l,a]},*levels(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:o=e.selection,reverse:a=!1,voids:l=!1}=n,{match:i}=n;if(i==null&&(i=()=>!0),!!o){var r=[],u=te.path(e,o);for(var[y,p]of Pe.levels(e,u))if(i(y,p)&&(r.push([y,p]),!l&&te.isVoid(e,y)))break;a&&r.reverse(),yield*r}},marks(e){var{marks:n,selection:o}=e;if(!o)return null;if(n)return n;if(Oe.isExpanded(o)){var[a]=te.nodes(e,{match:it.isText});if(a){var[l]=a,i=Vs(l,tN);return i}else return{}}var{anchor:r}=o,{path:u}=r,[y]=te.leaf(e,u);if(r.offset===0){var p=te.previous(e,{at:u,match:it.isText}),m=te.above(e,{match:w=>te.isBlock(e,w)});if(p&&m){var[v,C]=p,[,g]=m;pe.isAncestor(g,C)&&(y=v)}}var $=Vs(y,sN);return $},next(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:o="lowest",voids:a=!1}=n,{match:l,at:i=e.selection}=n;if(i){var r=te.after(e,i,{voids:a});if(r){var[,u]=te.last(e,[]),y=[r.path,u];if(pe.isPath(i)&&i.length===0)throw new Error("Cannot get the next node from the root node!");if(l==null)if(pe.isPath(i)){var[p]=te.parent(e,i);l=v=>p.children.includes(v)}else l=()=>!0;var[m]=te.nodes(e,{at:y,match:l,mode:o,voids:a});return m}}},node(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=te.path(e,n,o),l=Pe.get(e,a);return[l,a]},*nodes(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:o=e.selection,mode:a="all",universal:l=!1,reverse:i=!1,voids:r=!1}=n,{match:u}=n;if(u||(u=()=>!0),!!o){var y,p;if(oN.isSpan(o))y=o[0],p=o[1];else{var m=te.path(e,o,{edge:"start"}),v=te.path(e,o,{edge:"end"});y=i?v:m,p=i?m:v}var C=Pe.nodes(e,{reverse:i,from:y,to:p,pass:x=>{var[A]=x;return r?!1:te.isVoid(e,A)}}),g=[],$;for(var[w,S]of C){var k=$&&pe.compare(S,$[1])===0;if(!(a==="highest"&&k)){if(!u(w,S)){if(l&&!k&&it.isText(w))return;continue}if(a==="lowest"&&k){$=[w,S];continue}var b=a==="lowest"?$:[w,S];b&&(l?g.push(b):yield b),$=[w,S]}}a==="lowest"&&$&&(l?g.push($):yield $),l&&(yield*g)}},normalize(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{force:o=!1}=n,a=y=>ia.get(y)||[],l=y=>ra.get(y)||new Set,i=y=>{var p=a(y).pop(),m=p.join(",");return l(y).delete(m),p};if(te.isNormalizing(e)){if(o){var r=Array.from(Pe.nodes(e),y=>{var[,p]=y;return p}),u=new Set(r.map(y=>y.join(",")));ia.set(e,r),ra.set(e,u)}a(e).length!==0&&te.withoutNormalizing(e,()=>{for(var y of a(e))if(Pe.has(e,y)){var p=te.node(e,y),[m,v]=p;Et.isElement(m)&&m.children.length===0&&e.normalizeNode(p)}for(var C=a(e).length*42,g=0;a(e).length!==0;){if(g>C)throw new Error(`
            Could not completely normalize the editor after `.concat(C,` iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.
          `));var $=i(e);if(Pe.has(e,$)){var w=te.node(e,$);e.normalizeNode(w)}g++}})}},parent(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=te.path(e,n,o),l=pe.parent(a),i=te.node(e,l);return i},path(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{depth:a,edge:l}=o;if(pe.isPath(n)){if(l==="start"){var[,i]=Pe.first(e,n);n=i}else if(l==="end"){var[,r]=Pe.last(e,n);n=r}}return Oe.isRange(n)&&(l==="start"?n=Oe.start(n):l==="end"?n=Oe.end(n):n=pe.common(n.anchor.path,n.focus.path)),Ct.isPoint(n)&&(n=n.path),a!=null&&(n=n.slice(0,a)),n},hasPath(e,n){return Pe.has(e,n)},pathRef(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:a="forward"}=o,l={current:n,affinity:a,unref(){var{current:r}=l,u=te.pathRefs(e);return u.delete(l),l.current=null,r}},i=te.pathRefs(e);return i.add(l),l},pathRefs(e){var n=ua.get(e);return n||(n=new Set,ua.set(e,n)),n},point(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{edge:a="start"}=o;if(pe.isPath(n)){var l;if(a==="end"){var[,i]=Pe.last(e,n);l=i}else{var[,r]=Pe.first(e,n);l=r}var u=Pe.get(e,l);if(!it.isText(u))throw new Error("Cannot get the ".concat(a," point in the node at path [").concat(n,"] because it has no ").concat(a," text node."));return{path:l,offset:a==="end"?u.text.length:0}}if(Oe.isRange(n)){var[y,p]=Oe.edges(n);return a==="start"?y:p}return n},pointRef(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:a="forward"}=o,l={current:n,affinity:a,unref(){var{current:r}=l,u=te.pointRefs(e);return u.delete(l),l.current=null,r}},i=te.pointRefs(e);return i.add(l),l},pointRefs(e){var n=ca.get(e);return n||(n=new Set,ca.set(e,n)),n},*positions(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:o=e.selection,unit:a="offset",reverse:l=!1,voids:i=!1}=n;if(!o)return;var r=te.range(e,o),[u,y]=Oe.edges(r),p=l?y:u,m=!1,v="",C=0,g=0,$=0;for(var[w,S]of te.nodes(e,{at:o,reverse:l,voids:i})){if(Et.isElement(w)){if(!i&&e.isVoid(w)){yield te.start(e,S);continue}if(e.isInline(w))continue;if(te.hasInlines(e,w)){var k=pe.isAncestor(S,y.path)?y:te.end(e,S),b=pe.isAncestor(S,u.path)?u:te.start(e,S);v=te.string(e,{anchor:b,focus:k},{voids:i}),m=!0}}if(it.isText(w)){var x=pe.equals(S,p.path);for(x?(g=l?p.offset:w.text.length-p.offset,$=p.offset):(g=w.text.length,$=l?g:0),(x||m||a==="offset")&&(yield{path:S,offset:$},m=!1);;){if(C===0){if(v==="")break;C=A(v,a,l),v=qn(v,C,l)[1]}if($=l?$-C:$+C,g=g-C,g<0){C=-g;break}C=0,yield{path:S,offset:$}}}}function A(R,E,B){return E==="character"?Pn(R,B):E==="word"?R7(R,B):E==="line"||E==="block"?R.length:1}},previous(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:o="lowest",voids:a=!1}=n,{match:l,at:i=e.selection}=n;if(i){var r=te.before(e,i,{voids:a});if(r){var[,u]=te.first(e,[]),y=[r.path,u];if(pe.isPath(i)&&i.length===0)throw new Error("Cannot get the previous node from the root node!");if(l==null)if(pe.isPath(i)){var[p]=te.parent(e,i);l=v=>p.children.includes(v)}else l=()=>!0;var[m]=te.nodes(e,{reverse:!0,at:y,match:l,mode:o,voids:a});return m}}},range(e,n,o){if(Oe.isRange(n)&&!o)return n;var a=te.start(e,n),l=te.end(e,o||n);return{anchor:a,focus:l}},rangeRef(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:a="forward"}=o,l={current:n,affinity:a,unref(){var{current:r}=l,u=te.rangeRefs(e);return u.delete(l),l.current=null,r}},i=te.rangeRefs(e);return i.add(l),l},rangeRefs(e){var n=_a.get(e);return n||(n=new Set,_a.set(e,n)),n},removeMark(e,n){e.removeMark(n)},setNormalizing(e,n){da.set(e,n)},start(e,n){return te.point(e,n,{edge:"start"})},string(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:a=!1}=o,l=te.range(e,n),[i,r]=Oe.edges(l),u="";for(var[y,p]of te.nodes(e,{at:l,match:it.isText,voids:a})){var m=y.text;pe.equals(p,r.path)&&(m=m.slice(0,r.offset)),pe.equals(p,i.path)&&(m=m.slice(i.offset)),u+=m}return u},unhangRange(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:a=!1}=o,[l,i]=Oe.edges(n);if(l.offset!==0||i.offset!==0||Oe.isCollapsed(n))return n;var r=te.above(e,{at:i,match:g=>te.isBlock(e,g)}),u=r?r[1]:[],y=te.start(e,l),p={anchor:y,focus:i},m=!0;for(var[v,C]of te.nodes(e,{at:p,match:it.isText,reverse:!0,voids:a})){if(m){m=!1;continue}if(v.text!==""||pe.isBefore(C,u)){i={path:C,offset:v.text.length};break}}return{anchor:l,focus:i}},void(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return te.above(e,co(co({},n),{},{match:o=>te.isVoid(e,o)}))},withoutNormalizing(e,n){var o=te.isNormalizing(e);te.setNormalizing(e,!1);try{n()}finally{te.setNormalizing(e,o)}te.normalize(e)}},oN={isSpan(e){return Array.isArray(e)&&e.length===2&&e.every(pe.isPath)}},nN=["children"],aN=["text"],ma=new WeakMap,Pe={ancestor(e,n){var o=Pe.get(e,n);if(it.isText(o))throw new Error("Cannot get the ancestor node at path [".concat(n,"] because it refers to a text node instead: ").concat(o));return o},*ancestors(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var a of pe.ancestors(n,o)){var l=Pe.ancestor(e,a),i=[l,a];yield i}},child(e,n){if(it.isText(e))throw new Error("Cannot get the child of a text node: ".concat(JSON.stringify(e)));var o=e.children[n];if(o==null)throw new Error("Cannot get child at index `".concat(n,"` in node: ").concat(JSON.stringify(e)));return o},*children(e,n){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{reverse:a=!1}=o,l=Pe.ancestor(e,n),{children:i}=l,r=a?i.length-1:0;a?r>=0:r<i.length;){var u=Pe.child(l,r),y=n.concat(r);yield[u,y],r=a?r-1:r+1}},common(e,n,o){var a=pe.common(n,o),l=Pe.get(e,a);return[l,a]},descendant(e,n){var o=Pe.get(e,n);if(te.isEditor(o))throw new Error("Cannot get the descendant node at path [".concat(n,"] because it refers to the root editor node instead: ").concat(o));return o},*descendants(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[o,a]of Pe.nodes(e,n))a.length!==0&&(yield[o,a])},*elements(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[o,a]of Pe.nodes(e,n))Et.isElement(o)&&(yield[o,a])},extractProps(e){if(Et.isAncestor(e)){var n=Vs(e,nN);return n}else{var n=Vs(e,aN);return n}},first(e,n){for(var o=n.slice(),a=Pe.get(e,o);a&&!(it.isText(a)||a.children.length===0);)a=a.children[0],o.push(0);return[a,o]},fragment(e,n){if(it.isText(e))throw new Error("Cannot get a fragment starting from a root text node: ".concat(JSON.stringify(e)));var o=sn({children:e.children},a=>{var[l,i]=Oe.edges(n),r=Pe.nodes(a,{reverse:!0,pass:C=>{var[,g]=C;return!Oe.includes(n,g)}});for(var[,u]of r){if(!Oe.includes(n,u)){var y=Pe.parent(a,u),p=u[u.length-1];y.children.splice(p,1)}if(pe.equals(u,i.path)){var m=Pe.leaf(a,u);m.text=m.text.slice(0,i.offset)}if(pe.equals(u,l.path)){var v=Pe.leaf(a,u);v.text=v.text.slice(l.offset)}}te.isEditor(a)&&(a.selection=null)});return o.children},get(e,n){for(var o=e,a=0;a<n.length;a++){var l=n[a];if(it.isText(o)||!o.children[l])throw new Error("Cannot find a descendant at path [".concat(n,"] in node: ").concat(JSON.stringify(e)));o=o.children[l]}return o},has(e,n){for(var o=e,a=0;a<n.length;a++){var l=n[a];if(it.isText(o)||!o.children[l])return!1;o=o.children[l]}return!0},isNode(e){return it.isText(e)||Et.isElement(e)||te.isEditor(e)},isNodeList(e){if(!Array.isArray(e))return!1;var n=ma.get(e);if(n!==void 0)return n;var o=e.every(a=>Pe.isNode(a));return ma.set(e,o),o},last(e,n){for(var o=n.slice(),a=Pe.get(e,o);a&&!(it.isText(a)||a.children.length===0);){var l=a.children.length-1;a=a.children[l],o.push(l)}return[a,o]},leaf(e,n){var o=Pe.get(e,n);if(!it.isText(o))throw new Error("Cannot get the leaf node at path [".concat(n,"] because it refers to a non-leaf node: ").concat(o));return o},*levels(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var a of pe.levels(n,o)){var l=Pe.get(e,a);yield[l,a]}},matches(e,n){return Et.isElement(e)&&Et.isElementProps(n)&&Et.matches(e,n)||it.isText(e)&&it.isTextProps(n)&&it.matches(e,n)},*nodes(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{pass:o,reverse:a=!1}=n,{from:l=[],to:i}=n,r=new Set,u=[],y=e;!(i&&(a?pe.isBefore(u,i):pe.isAfter(u,i)));){if(r.has(y)||(yield[y,u]),!r.has(y)&&!it.isText(y)&&y.children.length!==0&&(o==null||o([y,u])===!1)){r.add(y);var p=a?y.children.length-1:0;pe.isAncestor(u,l)&&(p=l[u.length]),u=u.concat(p),y=Pe.get(e,u);continue}if(u.length===0)break;if(!a){var m=pe.next(u);if(Pe.has(e,m)){u=m,y=Pe.get(e,u);continue}}if(a&&u[u.length-1]!==0){var v=pe.previous(u);u=v,y=Pe.get(e,u);continue}u=pe.parent(u),y=Pe.get(e,u),r.add(y)}},parent(e,n){var o=pe.parent(n),a=Pe.get(e,o);if(it.isText(a))throw new Error("Cannot get the parent of path [".concat(n,"] because it does not exist in the root."));return a},string(e){return it.isText(e)?e.text:e.children.map(Pe.string).join("")},*texts(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[o,a]of Pe.nodes(e,n))it.isText(o)&&(yield[o,a])}};function ga(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function Nt(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?ga(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ga(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var Oo={isNodeOperation(e){return Oo.isOperation(e)&&e.type.endsWith("_node")},isOperation(e){if(!Kt(e))return!1;switch(e.type){case"insert_node":return pe.isPath(e.path)&&Pe.isNode(e.node);case"insert_text":return typeof e.offset=="number"&&typeof e.text=="string"&&pe.isPath(e.path);case"merge_node":return typeof e.position=="number"&&pe.isPath(e.path)&&Kt(e.properties);case"move_node":return pe.isPath(e.path)&&pe.isPath(e.newPath);case"remove_node":return pe.isPath(e.path)&&Pe.isNode(e.node);case"remove_text":return typeof e.offset=="number"&&typeof e.text=="string"&&pe.isPath(e.path);case"set_node":return pe.isPath(e.path)&&Kt(e.properties)&&Kt(e.newProperties);case"set_selection":return e.properties===null&&Oe.isRange(e.newProperties)||e.newProperties===null&&Oe.isRange(e.properties)||Kt(e.properties)&&Kt(e.newProperties);case"split_node":return pe.isPath(e.path)&&typeof e.position=="number"&&Kt(e.properties);default:return!1}},isOperationList(e){return Array.isArray(e)&&e.every(n=>Oo.isOperation(n))},isSelectionOperation(e){return Oo.isOperation(e)&&e.type.endsWith("_selection")},isTextOperation(e){return Oo.isOperation(e)&&e.type.endsWith("_text")},inverse(e){switch(e.type){case"insert_node":return Nt(Nt({},e),{},{type:"remove_node"});case"insert_text":return Nt(Nt({},e),{},{type:"remove_text"});case"merge_node":return Nt(Nt({},e),{},{type:"split_node",path:pe.previous(e.path)});case"move_node":{var{newPath:n,path:o}=e;if(pe.equals(n,o))return e;if(pe.isSibling(o,n))return Nt(Nt({},e),{},{path:n,newPath:o});var a=pe.transform(o,e),l=pe.transform(pe.next(o),e);return Nt(Nt({},e),{},{path:a,newPath:l})}case"remove_node":return Nt(Nt({},e),{},{type:"insert_node"});case"remove_text":return Nt(Nt({},e),{},{type:"insert_text"});case"set_node":{var{properties:i,newProperties:r}=e;return Nt(Nt({},e),{},{properties:r,newProperties:i})}case"set_selection":{var{properties:u,newProperties:y}=e;return u==null?Nt(Nt({},e),{},{properties:y,newProperties:null}):y==null?Nt(Nt({},e),{},{properties:null,newProperties:u}):Nt(Nt({},e),{},{properties:y,newProperties:u})}case"split_node":return Nt(Nt({},e),{},{type:"merge_node",path:pe.next(e.path)})}}},pe={ancestors(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:o=!1}=n,a=pe.levels(e,n);return o?a=a.slice(1):a=a.slice(0,-1),a},common(e,n){for(var o=[],a=0;a<e.length&&a<n.length;a++){var l=e[a],i=n[a];if(l!==i)break;o.push(l)}return o},compare(e,n){for(var o=Math.min(e.length,n.length),a=0;a<o;a++){if(e[a]<n[a])return-1;if(e[a]>n[a])return 1}return 0},endsAfter(e,n){var o=e.length-1,a=e.slice(0,o),l=n.slice(0,o),i=e[o],r=n[o];return pe.equals(a,l)&&i>r},endsAt(e,n){var o=e.length,a=e.slice(0,o),l=n.slice(0,o);return pe.equals(a,l)},endsBefore(e,n){var o=e.length-1,a=e.slice(0,o),l=n.slice(0,o),i=e[o],r=n[o];return pe.equals(a,l)&&i<r},equals(e,n){return e.length===n.length&&e.every((o,a)=>o===n[a])},hasPrevious(e){return e[e.length-1]>0},isAfter(e,n){return pe.compare(e,n)===1},isAncestor(e,n){return e.length<n.length&&pe.compare(e,n)===0},isBefore(e,n){return pe.compare(e,n)===-1},isChild(e,n){return e.length===n.length+1&&pe.compare(e,n)===0},isCommon(e,n){return e.length<=n.length&&pe.compare(e,n)===0},isDescendant(e,n){return e.length>n.length&&pe.compare(e,n)===0},isParent(e,n){return e.length+1===n.length&&pe.compare(e,n)===0},isPath(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")},isSibling(e,n){if(e.length!==n.length)return!1;var o=e.slice(0,-1),a=n.slice(0,-1),l=e[e.length-1],i=n[n.length-1];return l!==i&&pe.equals(o,a)},levels(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:o=!1}=n,a=[],l=0;l<=e.length;l++)a.push(e.slice(0,l));return o&&a.reverse(),a},next(e){if(e.length===0)throw new Error("Cannot get the next path of a root path [".concat(e,"], because it has no next index."));var n=e[e.length-1];return e.slice(0,-1).concat(n+1)},operationCanTransformPath(e){switch(e.type){case"insert_node":case"remove_node":case"merge_node":case"split_node":case"move_node":return!0;default:return!1}},parent(e){if(e.length===0)throw new Error("Cannot get the parent path of the root path [".concat(e,"]."));return e.slice(0,-1)},previous(e){if(e.length===0)throw new Error("Cannot get the previous path of a root path [".concat(e,"], because it has no previous index."));var n=e[e.length-1];if(n<=0)throw new Error("Cannot get the previous path of a first child path [".concat(e,"] because it would result in a negative index."));return e.slice(0,-1).concat(n-1)},relative(e,n){if(!pe.isAncestor(n,e)&&!pe.equals(e,n))throw new Error("Cannot get the relative path of [".concat(e,"] inside ancestor [").concat(n,"], because it is not above or equal to the path."));return e.slice(n.length)},transform(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return sn(e,a=>{var{affinity:l="forward"}=o;if(!(!e||(e==null?void 0:e.length)===0)){if(a===null)return null;switch(n.type){case"insert_node":{var{path:i}=n;(pe.equals(i,a)||pe.endsBefore(i,a)||pe.isAncestor(i,a))&&(a[i.length-1]+=1);break}case"remove_node":{var{path:r}=n;if(pe.equals(r,a)||pe.isAncestor(r,a))return null;pe.endsBefore(r,a)&&(a[r.length-1]-=1);break}case"merge_node":{var{path:u,position:y}=n;pe.equals(u,a)||pe.endsBefore(u,a)?a[u.length-1]-=1:pe.isAncestor(u,a)&&(a[u.length-1]-=1,a[u.length]+=y);break}case"split_node":{var{path:p,position:m}=n;if(pe.equals(p,a)){if(l==="forward")a[a.length-1]+=1;else if(l!=="backward")return null}else pe.endsBefore(p,a)?a[p.length-1]+=1:pe.isAncestor(p,a)&&e[p.length]>=m&&(a[p.length-1]+=1,a[p.length]-=m);break}case"move_node":{var{path:v,newPath:C}=n;if(pe.equals(v,C))return;if(pe.isAncestor(v,a)||pe.equals(v,a)){var g=C.slice();return pe.endsBefore(v,C)&&v.length<C.length&&(g[v.length-1]-=1),g.concat(a.slice(v.length))}else pe.isSibling(v,C)&&(pe.isAncestor(C,a)||pe.equals(C,a))?pe.endsBefore(v,a)?a[v.length-1]-=1:a[v.length-1]+=1:pe.endsBefore(C,a)||pe.equals(C,a)||pe.isAncestor(C,a)?(pe.endsBefore(v,a)&&(a[v.length-1]-=1),a[C.length-1]+=1):pe.endsBefore(v,a)&&(pe.equals(C,a)&&(a[C.length-1]+=1),a[v.length-1]-=1);break}}}})}};function ya(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function ba(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?ya(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ya(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var Ct={compare(e,n){var o=pe.compare(e.path,n.path);return o===0?e.offset<n.offset?-1:e.offset>n.offset?1:0:o},isAfter(e,n){return Ct.compare(e,n)===1},isBefore(e,n){return Ct.compare(e,n)===-1},equals(e,n){return e.offset===n.offset&&pe.equals(e.path,n.path)},isPoint(e){return Kt(e)&&typeof e.offset=="number"&&pe.isPath(e.path)},transform(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return sn(e,a=>{if(a===null)return null;var{affinity:l="forward"}=o,{path:i,offset:r}=a;switch(n.type){case"insert_node":case"move_node":{a.path=pe.transform(i,n,o);break}case"insert_text":{pe.equals(n.path,i)&&n.offset<=r&&(a.offset+=n.text.length);break}case"merge_node":{pe.equals(n.path,i)&&(a.offset+=n.position),a.path=pe.transform(i,n,o);break}case"remove_text":{pe.equals(n.path,i)&&n.offset<=r&&(a.offset-=Math.min(r-n.offset,n.text.length));break}case"remove_node":{if(pe.equals(n.path,i)||pe.isAncestor(n.path,i))return null;a.path=pe.transform(i,n,o);break}case"split_node":{if(pe.equals(n.path,i)){if(n.position===r&&l==null)return null;(n.position<r||n.position===r&&l==="forward")&&(a.offset-=n.position,a.path=pe.transform(i,n,ba(ba({},o),{},{affinity:"forward"})))}else a.path=pe.transform(i,n,o);break}}})}},lN=["anchor","focus"];function ka(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function iN(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?ka(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ka(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var Oe={edges(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:o=!1}=n,{anchor:a,focus:l}=e;return Oe.isBackward(e)===o?[a,l]:[l,a]},end(e){var[,n]=Oe.edges(e);return n},equals(e,n){return Ct.equals(e.anchor,n.anchor)&&Ct.equals(e.focus,n.focus)},includes(e,n){if(Oe.isRange(n)){if(Oe.includes(e,n.anchor)||Oe.includes(e,n.focus))return!0;var[o,a]=Oe.edges(e),[l,i]=Oe.edges(n);return Ct.isBefore(o,l)&&Ct.isAfter(a,i)}var[r,u]=Oe.edges(e),y=!1,p=!1;return Ct.isPoint(n)?(y=Ct.compare(n,r)>=0,p=Ct.compare(n,u)<=0):(y=pe.compare(n,r.path)>=0,p=pe.compare(n,u.path)<=0),y&&p},intersection(e,n){var o=Vs(e,lN),[a,l]=Oe.edges(e),[i,r]=Oe.edges(n),u=Ct.isBefore(a,i)?i:a,y=Ct.isBefore(l,r)?l:r;return Ct.isBefore(y,u)?null:iN({anchor:u,focus:y},o)},isBackward(e){var{anchor:n,focus:o}=e;return Ct.isAfter(n,o)},isCollapsed(e){var{anchor:n,focus:o}=e;return Ct.equals(n,o)},isExpanded(e){return!Oe.isCollapsed(e)},isForward(e){return!Oe.isBackward(e)},isRange(e){return Kt(e)&&Ct.isPoint(e.anchor)&&Ct.isPoint(e.focus)},*points(e){yield[e.anchor,"anchor"],yield[e.focus,"focus"]},start(e){var[n]=Oe.edges(e);return n},transform(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return sn(e,a=>{if(a===null)return null;var{affinity:l="inward"}=o,i,r;if(l==="inward"){var u=Oe.isCollapsed(a);Oe.isForward(a)?(i="forward",r=u?i:"backward"):(i="backward",r=u?i:"forward")}else l==="outward"?Oe.isForward(a)?(i="backward",r="forward"):(i="forward",r="backward"):(i=l,r=l);var y=Ct.transform(a.anchor,n,{affinity:i}),p=Ct.transform(a.focus,n,{affinity:r});if(!y||!p)return null;a.anchor=y,a.focus=p})}},kl=(e,n)=>{for(var o in e){var a=e[o],l=n[o];if(Kt(a)&&Kt(l)){if(!kl(a,l))return!1}else if(Array.isArray(a)&&Array.isArray(l)){if(a.length!==l.length)return!1;for(var i=0;i<a.length;i++)if(a[i]!==l[i])return!1}else if(a!==l)return!1}for(var r in n)if(e[r]===void 0&&n[r]!==void 0)return!1;return!0},rN=["text"],dN=["anchor","focus"];function wa(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function Ls(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?wa(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):wa(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var it={equals(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{loose:a=!1}=o;function l(i){var r=Vs(i,rN);return r}return kl(a?l(e):e,a?l(n):n)},isText(e){return Kt(e)&&typeof e.text=="string"},isTextList(e){return Array.isArray(e)&&e.every(n=>it.isText(n))},isTextProps(e){return e.text!==void 0},matches(e,n){for(var o in n)if(o!=="text"&&(!e.hasOwnProperty(o)||e[o]!==n[o]))return!1;return!0},decorations(e,n){var o=[Ls({},e)];for(var a of n){var l=Vs(a,dN),[i,r]=Oe.edges(a),u=[],y=0;for(var p of o){var{length:m}=p.text,v=y;if(y+=m,i.offset<=v&&r.offset>=y){Object.assign(p,l),u.push(p);continue}if(i.offset!==r.offset&&(i.offset===y||r.offset===v)||i.offset>y||r.offset<v||r.offset===v&&v!==0){u.push(p);continue}var C=p,g=void 0,$=void 0;if(r.offset<y){var w=r.offset-v;$=Ls(Ls({},C),{},{text:C.text.slice(w)}),C=Ls(Ls({},C),{},{text:C.text.slice(0,w)})}if(i.offset>v){var S=i.offset-v;g=Ls(Ls({},C),{},{text:C.text.slice(0,S)}),C=Ls(Ls({},C),{},{text:C.text.slice(S)})}Object.assign(C,l),g&&u.push(g),u.push(C),$&&u.push($)}o=u}return o}};function Ca(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function So(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Ca(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ca(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var uN=(e,n,o)=>{switch(o.type){case"insert_node":{var{path:a,node:l}=o,i=Pe.parent(e,a),r=a[a.length-1];if(r>i.children.length)throw new Error('Cannot apply an "insert_node" operation at path ['.concat(a,"] because the destination is past the end of the node."));if(i.children.splice(r,0,l),n)for(var[u,y]of Oe.points(n))n[y]=Ct.transform(u,o);break}case"insert_text":{var{path:p,offset:m,text:v}=o;if(v.length===0)break;var C=Pe.leaf(e,p),g=C.text.slice(0,m),$=C.text.slice(m);if(C.text=g+v+$,n)for(var[w,S]of Oe.points(n))n[S]=Ct.transform(w,o);break}case"merge_node":{var{path:k}=o,b=Pe.get(e,k),x=pe.previous(k),A=Pe.get(e,x),R=Pe.parent(e,k),E=k[k.length-1];if(it.isText(b)&&it.isText(A))A.text+=b.text;else if(!it.isText(b)&&!it.isText(A))A.children.push(...b.children);else throw new Error('Cannot apply a "merge_node" operation at path ['.concat(k,"] to nodes of different interfaces: ").concat(b," ").concat(A));if(R.children.splice(E,1),n)for(var[B,N]of Oe.points(n))n[N]=Ct.transform(B,o);break}case"move_node":{var{path:I,newPath:L}=o;if(pe.isAncestor(I,L))throw new Error("Cannot move a path [".concat(I,"] to new path [").concat(L,"] because the destination is inside itself."));var q=Pe.get(e,I),O=Pe.parent(e,I),M=I[I.length-1];O.children.splice(M,1);var j=pe.transform(I,o),V=Pe.get(e,pe.parent(j)),z=j[j.length-1];if(V.children.splice(z,0,q),n)for(var[H,K]of Oe.points(n))n[K]=Ct.transform(H,o);break}case"remove_node":{var{path:F}=o,Y=F[F.length-1],le=Pe.parent(e,F);if(le.children.splice(Y,1),n)for(var[J,P]of Oe.points(n)){var W=Ct.transform(J,o);if(n!=null&&W!=null)n[P]=W;else{var Q=void 0,X=void 0;for(var[de,Fe]of Pe.texts(e))if(pe.compare(Fe,F)===-1)Q=[de,Fe];else{X=[de,Fe];break}var De=!1;Q&&X&&(pe.equals(X[1],F)?De=!pe.hasPrevious(X[1]):De=pe.common(Q[1],F).length<pe.common(X[1],F).length),Q&&!De?(J.path=Q[1],J.offset=Q[0].text.length):X?(J.path=X[1],J.offset=0):n=null}}break}case"remove_text":{var{path:$e,offset:Ue,text:ie}=o;if(ie.length===0)break;var ge=Pe.leaf(e,$e),ve=ge.text.slice(0,Ue),he=ge.text.slice(Ue+ie.length);if(ge.text=ve+he,n)for(var[Ae,oe]of Oe.points(n))n[oe]=Ct.transform(Ae,o);break}case"set_node":{var{path:ne,properties:ue,newProperties:ke}=o;if(ne.length===0)throw new Error("Cannot set properties on the root node!");var Se=Pe.get(e,ne);for(var Le in ke){if(Le==="children"||Le==="text")throw new Error('Cannot set the "'.concat(Le,'" property of nodes!'));var Je=ke[Le];Je==null?delete Se[Le]:Se[Le]=Je}for(var bt in ue)ke.hasOwnProperty(bt)||delete Se[bt];break}case"set_selection":{var{newProperties:lt}=o;if(lt==null)n=lt;else{if(n==null){if(!Oe.isRange(lt))throw new Error('Cannot apply an incomplete "set_selection" operation properties '.concat(JSON.stringify(lt)," when there is no current selection."));n=So({},lt)}for(var kt in lt){var Ft=lt[kt];if(Ft==null){if(kt==="anchor"||kt==="focus")throw new Error('Cannot remove the "'.concat(kt,'" selection property'));delete n[kt]}else n[kt]=Ft}}break}case"split_node":{var{path:Rt,position:yt,properties:Lt}=o;if(Rt.length===0)throw new Error('Cannot apply a "split_node" operation at path ['.concat(Rt,"] because the root node cannot be split."));var At=Pe.get(e,Rt),ae=Pe.parent(e,Rt),re=Rt[Rt.length-1],ce;if(it.isText(At)){var Ce=At.text.slice(0,yt),Ve=At.text.slice(yt);At.text=Ce,ce=So(So({},Lt),{},{text:Ve})}else{var Ee=At.children.slice(0,yt),ze=At.children.slice(yt);At.children=Ee,ce=So(So({},Lt),{},{children:ze})}if(ae.children.splice(re+1,0,ce),n)for(var[Ge,dt]of Oe.points(n))n[dt]=Ct.transform(Ge,o);break}}return n},cN={transform(e,n){e.children=aa(e.children);var o=e.selection&&aa(e.selection);try{o=uN(e,o,n)}finally{e.children=la(e.children),o?e.selection=to(o)?la(o):o:e.selection=null}}},_N=["text"],pN=["children"];function $a(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function xa(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?$a(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):$a(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var fN={insertNodes(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};te.withoutNormalizing(e,()=>{var{hanging:a=!1,voids:l=!1,mode:i="lowest"}=o,{at:r,match:u,select:y}=o;if(Pe.isNode(n)&&(n=[n]),n.length!==0){var[p]=n;if(r||(e.selection?r=e.selection:e.children.length>0?r=te.end(e,[]):r=[0],y=!0),y==null&&(y=!1),Oe.isRange(r))if(a||(r=te.unhangRange(e,r)),Oe.isCollapsed(r))r=r.anchor;else{var[,m]=Oe.edges(r),v=te.pointRef(e,m);st.delete(e,{at:r}),r=v.unref()}if(Ct.isPoint(r)){u==null&&(it.isText(p)?u=E=>it.isText(E):e.isInline(p)?u=E=>it.isText(E)||te.isInline(e,E):u=E=>te.isBlock(e,E));var[C]=te.nodes(e,{at:r.path,match:u,mode:i,voids:l});if(C){var[,g]=C,$=te.pathRef(e,g),w=te.isEnd(e,r,g);st.splitNodes(e,{at:r,match:u,mode:i,voids:l});var S=$.unref();r=w?pe.next(S):S}else return}var k=pe.parent(r),b=r[r.length-1];if(!(!l&&te.void(e,{at:k}))){for(var x of n){var A=k.concat(b);b++,e.apply({type:"insert_node",path:A,node:x}),r=pe.next(r)}if(r=pe.previous(r),y){var R=te.end(e,r);R&&st.select(e,R)}}}})},liftNodes(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.withoutNormalizing(e,()=>{var{at:o=e.selection,mode:a="lowest",voids:l=!1}=n,{match:i}=n;if(i==null&&(i=pe.isPath(o)?_o(e,o):x=>te.isBlock(e,x)),!!o){var r=te.nodes(e,{at:o,match:i,mode:a,voids:l}),u=Array.from(r,x=>{var[,A]=x;return te.pathRef(e,A)});for(var y of u){var p=y.unref();if(p.length<2)throw new Error("Cannot lift node at a path [".concat(p,"] because it has a depth of less than `2`."));var m=te.node(e,pe.parent(p)),[v,C]=m,g=p[p.length-1],{length:$}=v.children;if($===1){var w=pe.next(C);st.moveNodes(e,{at:p,to:w,voids:l}),st.removeNodes(e,{at:C,voids:l})}else if(g===0)st.moveNodes(e,{at:p,to:C,voids:l});else if(g===$-1){var S=pe.next(C);st.moveNodes(e,{at:p,to:S,voids:l})}else{var k=pe.next(p),b=pe.next(C);st.splitNodes(e,{at:k,voids:l}),st.moveNodes(e,{at:p,to:b,voids:l})}}}})},mergeNodes(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.withoutNormalizing(e,()=>{var{match:o,at:a=e.selection}=n,{hanging:l=!1,voids:i=!1,mode:r="lowest"}=n;if(a){if(o==null)if(pe.isPath(a)){var[u]=te.parent(e,a);o=I=>u.children.includes(I)}else o=I=>te.isBlock(e,I);if(!l&&Oe.isRange(a)&&(a=te.unhangRange(e,a)),Oe.isRange(a))if(Oe.isCollapsed(a))a=a.anchor;else{var[,y]=Oe.edges(a),p=te.pointRef(e,y);st.delete(e,{at:a}),a=p.unref(),n.at==null&&st.select(e,a)}var[m]=te.nodes(e,{at:a,match:o,voids:i,mode:r}),v=te.previous(e,{at:a,match:o,voids:i,mode:r});if(!(!m||!v)){var[C,g]=m,[$,w]=v;if(!(g.length===0||w.length===0)){var S=pe.next(w),k=pe.common(g,w),b=pe.isSibling(g,w),x=Array.from(te.levels(e,{at:g}),I=>{var[L]=I;return L}).slice(k.length).slice(0,-1),A=te.above(e,{at:g,mode:"highest",match:I=>x.includes(I)&&wl(e,I)}),R=A&&te.pathRef(e,A[1]),E,B;if(it.isText(C)&&it.isText($)){var N=Vs(C,_N);B=$.text.length,E=N}else if(Et.isElement(C)&&Et.isElement($)){var N=Vs(C,pN);B=$.children.length,E=N}else throw new Error("Cannot merge the node at path [".concat(g,"] with the previous sibling because it is not the same kind: ").concat(JSON.stringify(C)," ").concat(JSON.stringify($)));b||st.moveNodes(e,{at:g,to:S,voids:i}),R&&st.removeNodes(e,{at:R.current,voids:i}),Et.isElement($)&&te.isEmpty(e,$)||it.isText($)&&$.text===""&&w[w.length-1]!==0?st.removeNodes(e,{at:w,voids:i}):e.apply({type:"merge_node",path:S,position:B,properties:E}),R&&R.unref()}}}})},moveNodes(e,n){te.withoutNormalizing(e,()=>{var{to:o,at:a=e.selection,mode:l="lowest",voids:i=!1}=n,{match:r}=n;if(a){r==null&&(r=pe.isPath(a)?_o(e,a):g=>te.isBlock(e,g));var u=te.pathRef(e,o),y=te.nodes(e,{at:a,match:r,mode:l,voids:i}),p=Array.from(y,g=>{var[,$]=g;return te.pathRef(e,$)});for(var m of p){var v=m.unref(),C=u.current;v.length!==0&&e.apply({type:"move_node",path:v,newPath:C}),u.current&&pe.isSibling(C,v)&&pe.isAfter(C,v)&&(u.current=pe.next(u.current))}u.unref()}})},removeNodes(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.withoutNormalizing(e,()=>{var{hanging:o=!1,voids:a=!1,mode:l="lowest"}=n,{at:i=e.selection,match:r}=n;if(i){r==null&&(r=pe.isPath(i)?_o(e,i):C=>te.isBlock(e,C)),!o&&Oe.isRange(i)&&(i=te.unhangRange(e,i));var u=te.nodes(e,{at:i,match:r,mode:l,voids:a}),y=Array.from(u,C=>{var[,g]=C;return te.pathRef(e,g)});for(var p of y){var m=p.unref();if(m){var[v]=te.node(e,m);e.apply({type:"remove_node",path:m,node:v})}}}})},setNodes(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};te.withoutNormalizing(e,()=>{var{match:a,at:l=e.selection}=o,{hanging:i=!1,mode:r="lowest",split:u=!1,voids:y=!1}=o;if(l){if(a==null&&(a=pe.isPath(l)?_o(e,l):R=>te.isBlock(e,R)),!i&&Oe.isRange(l)&&(l=te.unhangRange(e,l)),u&&Oe.isRange(l)){if(Oe.isCollapsed(l)&&te.leaf(e,l.anchor)[0].text.length>0)return;var p=te.rangeRef(e,l,{affinity:"inward"}),[m,v]=Oe.edges(l),C=r==="lowest"?"lowest":"highest",g=te.isEnd(e,v,v.path);st.splitNodes(e,{at:v,match:a,mode:C,voids:y,always:!g});var $=te.isStart(e,m,m.path);st.splitNodes(e,{at:m,match:a,mode:C,voids:y,always:!$}),l=p.unref(),o.at==null&&st.select(e,l)}for(var[w,S]of te.nodes(e,{at:l,match:a,mode:r,voids:y})){var k={},b={};if(S.length!==0){var x=!1;for(var A in n)A==="children"||A==="text"||n[A]!==w[A]&&(x=!0,w.hasOwnProperty(A)&&(k[A]=w[A]),n[A]!=null&&(b[A]=n[A]));x&&e.apply({type:"set_node",path:S,properties:k,newProperties:b})}}}})},splitNodes(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.withoutNormalizing(e,()=>{var{mode:o="lowest",voids:a=!1}=n,{match:l,at:i=e.selection,height:r=0,always:u=!1}=n;if(l==null&&(l=H=>te.isBlock(e,H)),Oe.isRange(i)&&(i=vN(e,i)),pe.isPath(i)){var y=i,p=te.point(e,y),[m]=te.parent(e,y);l=H=>H===m,r=p.path.length-y.length+1,i=p,u=!0}if(i){var v=te.pointRef(e,i,{affinity:"backward"}),[C]=te.nodes(e,{at:i,match:l,mode:o,voids:a});if(C){var g=te.void(e,{at:i,mode:"highest"}),$=0;if(!a&&g){var[w,S]=g;if(Et.isElement(w)&&e.isInline(w)){var k=te.after(e,S);if(!k){var b={text:""},x=pe.next(S);st.insertNodes(e,b,{at:x,voids:a}),k=te.point(e,x)}i=k,u=!0}var A=i.path.length-S.length;r=A+1,u=!0}var R=te.pointRef(e,i),E=i.path.length-r,[,B]=C,N=i.path.slice(0,E),I=r===0?i.offset:i.path[E]+$;for(var[L,q]of te.levels(e,{at:N,reverse:!0,voids:a})){var O=!1;if(q.length<B.length||q.length===0||!a&&te.isVoid(e,L))break;var M=v.current,j=te.isEnd(e,M,q);if(u||!v||!te.isEdge(e,M,q)){O=!0;var V=Pe.extractProps(L);e.apply({type:"split_node",path:q,position:I,properties:V})}I=q[q.length-1]+(O||j?1:0)}if(n.at==null){var z=R.current||te.end(e,[]);st.select(e,z)}v.unref(),R.unref()}}})},unsetNodes(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Array.isArray(n)||(n=[n]);var a={};for(var l of n)a[l]=null;st.setNodes(e,a,o)},unwrapNodes(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.withoutNormalizing(e,()=>{var{mode:o="lowest",split:a=!1,voids:l=!1}=n,{at:i=e.selection,match:r}=n;if(i){r==null&&(r=pe.isPath(i)?_o(e,i):C=>te.isBlock(e,C)),pe.isPath(i)&&(i=te.range(e,i));var u=Oe.isRange(i)?te.rangeRef(e,i):null,y=te.nodes(e,{at:i,match:r,mode:o,voids:l}),p=Array.from(y,C=>{var[,g]=C;return te.pathRef(e,g)}).reverse(),m=function(g){var $=g.unref(),[w]=te.node(e,$),S=te.range(e,$);a&&u&&(S=Oe.intersection(u.current,S)),st.liftNodes(e,{at:S,match:k=>Et.isAncestor(w)&&w.children.includes(k),voids:l})};for(var v of p)m(v);u&&u.unref()}})},wrapNodes(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};te.withoutNormalizing(e,()=>{var{mode:a="lowest",split:l=!1,voids:i=!1}=o,{match:r,at:u=e.selection}=o;if(u){if(r==null&&(pe.isPath(u)?r=_o(e,u):e.isInline(n)?r=S=>te.isInline(e,S)||it.isText(S):r=S=>te.isBlock(e,S)),l&&Oe.isRange(u)){var[y,p]=Oe.edges(u),m=te.rangeRef(e,u,{affinity:"inward"});st.splitNodes(e,{at:p,match:r,voids:i}),st.splitNodes(e,{at:y,match:r,voids:i}),u=m.unref(),o.at==null&&st.select(e,u)}var v=Array.from(te.nodes(e,{at:u,match:e.isInline(n)?S=>te.isBlock(e,S):S=>te.isEditor(S),mode:"lowest",voids:i}));for(var[,C]of v){var g=Oe.isRange(u)?Oe.intersection(u,te.range(e,C)):u;if(g){var $=Array.from(te.nodes(e,{at:g,match:r,mode:a,voids:i}));if($.length>0){var w=(function(){var[S]=$,k=$[$.length-1],[,b]=S,[,x]=k;if(b.length===0&&x.length===0)return"continue";var A=pe.equals(b,x)?pe.parent(b):pe.common(b,x),R=te.range(e,b,x),E=te.node(e,A),[B]=E,N=A.length+1,I=pe.next(x.slice(0,N)),L=xa(xa({},n),{},{children:[]});st.insertNodes(e,L,{at:I,voids:i}),st.moveNodes(e,{at:R,match:q=>Et.isAncestor(B)&&B.children.includes(q),to:I.concat(0),voids:i})})();if(w==="continue")continue}}}}})}},wl=(e,n)=>{if(Et.isElement(n)){var o=n;return te.isVoid(e,n)?!0:o.children.length===1?wl(e,o.children[0]):!1}else return!te.isEditor(n)},vN=(e,n)=>{if(Oe.isCollapsed(n))return n.anchor;var[,o]=Oe.edges(n),a=te.pointRef(e,o);return st.delete(e,{at:n}),a.unref()},_o=(e,n)=>{var[o]=te.node(e,n);return a=>a===o};function Sa(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function Da(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Sa(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Sa(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var hN={collapse(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{edge:o="anchor"}=n,{selection:a}=e;if(a){if(o==="anchor")st.select(e,a.anchor);else if(o==="focus")st.select(e,a.focus);else if(o==="start"){var[l]=Oe.edges(a);st.select(e,l)}else if(o==="end"){var[,i]=Oe.edges(a);st.select(e,i)}}else return},deselect(e){var{selection:n}=e;n&&e.apply({type:"set_selection",properties:n,newProperties:null})},move(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{selection:o}=e,{distance:a=1,unit:l="character",reverse:i=!1}=n,{edge:r=null}=n;if(o){r==="start"&&(r=Oe.isBackward(o)?"focus":"anchor"),r==="end"&&(r=Oe.isBackward(o)?"anchor":"focus");var{anchor:u,focus:y}=o,p={distance:a,unit:l},m={};if(r==null||r==="anchor"){var v=i?te.before(e,u,p):te.after(e,u,p);v&&(m.anchor=v)}if(r==null||r==="focus"){var C=i?te.before(e,y,p):te.after(e,y,p);C&&(m.focus=C)}st.setSelection(e,m)}},select(e,n){var{selection:o}=e;if(n=te.range(e,n),o){st.setSelection(e,n);return}if(!Oe.isRange(n))throw new Error("When setting the selection and the current selection is `null` you must provide at least an `anchor` and `focus`, but you passed: ".concat(JSON.stringify(n)));e.apply({type:"set_selection",properties:o,newProperties:n})},setPoint(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{selection:a}=e,{edge:l="both"}=o;if(a){l==="start"&&(l=Oe.isBackward(a)?"focus":"anchor"),l==="end"&&(l=Oe.isBackward(a)?"anchor":"focus");var{anchor:i,focus:r}=a,u=l==="anchor"?i:r;st.setSelection(e,{[l==="anchor"?"anchor":"focus"]:Da(Da({},u),n)})}},setSelection(e,n){var{selection:o}=e,a={},l={};if(o){for(var i in n)(i==="anchor"&&n.anchor!=null&&!Ct.equals(n.anchor,o.anchor)||i==="focus"&&n.focus!=null&&!Ct.equals(n.focus,o.focus)||i!=="anchor"&&i!=="focus"&&n[i]!==o[i])&&(a[i]=o[i],l[i]=n[i]);Object.keys(a).length>0&&e.apply({type:"set_selection",properties:a,newProperties:l})}}},mN={delete(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.withoutNormalizing(e,()=>{var{reverse:o=!1,unit:a="character",distance:l=1,voids:i=!1}=n,{at:r=e.selection,hanging:u=!1}=n;if(r){if(Oe.isRange(r)&&Oe.isCollapsed(r)&&(r=r.anchor),Ct.isPoint(r)){var y=te.void(e,{at:r,mode:"highest"});if(!i&&y){var[,p]=y;r=p}else{var m={unit:a,distance:l},v=o?te.before(e,r,m)||te.start(e,[]):te.after(e,r,m)||te.end(e,[]);r={anchor:r,focus:v},u=!0}}if(pe.isPath(r)){st.removeNodes(e,{at:r,voids:i});return}if(!Oe.isCollapsed(r)){if(!u){var[,C]=Oe.edges(r),g=te.end(e,[]);Ct.equals(C,g)||(r=te.unhangRange(e,r,{voids:i}))}var[$,w]=Oe.edges(r),S=te.above(e,{match:De=>te.isBlock(e,De),at:$,voids:i}),k=te.above(e,{match:De=>te.isBlock(e,De),at:w,voids:i}),b=S&&k&&!pe.equals(S[1],k[1]),x=pe.equals($.path,w.path),A=i?null:te.void(e,{at:$,mode:"highest"}),R=i?null:te.void(e,{at:w,mode:"highest"});if(A){var E=te.before(e,$);E&&S&&pe.isAncestor(S[1],E.path)&&($=E)}if(R){var B=te.after(e,w);B&&k&&pe.isAncestor(k[1],B.path)&&(w=B)}var N=[],I;for(var L of te.nodes(e,{at:r,voids:i})){var[q,O]=L;I&&pe.compare(O,I)===0||(!i&&te.isVoid(e,q)||!pe.isCommon(O,$.path)&&!pe.isCommon(O,w.path))&&(N.push(L),I=O)}var M=Array.from(N,De=>{var[,$e]=De;return te.pathRef(e,$e)}),j=te.pointRef(e,$),V=te.pointRef(e,w);if(!x&&!A){var z=j.current,[H]=te.leaf(e,z),{path:K}=z,{offset:F}=$,Y=H.text.slice(F);Y.length>0&&e.apply({type:"remove_text",path:K,offset:F,text:Y})}for(var le of M){var J=le.unref();st.removeNodes(e,{at:J,voids:i})}if(!R){var P=V.current,[W]=te.leaf(e,P),{path:Q}=P,X=x?$.offset:0,de=W.text.slice(X,w.offset);de.length>0&&e.apply({type:"remove_text",path:Q,offset:X,text:de})}!x&&b&&V.current&&j.current&&st.mergeNodes(e,{at:V.current,hanging:!0,voids:i});var Fe=o?j.unref()||V.unref():V.unref()||j.unref();n.at==null&&Fe&&st.select(e,Fe)}}})},insertFragment(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};te.withoutNormalizing(e,()=>{var{hanging:a=!1,voids:l=!1}=o,{at:i=e.selection}=o;if(n.length){if(i)if(Oe.isRange(i))if(a||(i=te.unhangRange(e,i)),Oe.isCollapsed(i))i=i.anchor;else{var[,r]=Oe.edges(i);if(!l&&te.void(e,{at:r}))return;var u=te.pointRef(e,r);st.delete(e,{at:i}),i=u.unref()}else pe.isPath(i)&&(i=te.start(e,i));else return;if(!(!l&&te.void(e,{at:i}))){var y=te.above(e,{at:i,match:W=>te.isInline(e,W),mode:"highest",voids:l});if(y){var[,p]=y;if(te.isEnd(e,i,p)){var m=te.after(e,p);i=m}else if(te.isStart(e,i,p)){var v=te.before(e,p);i=v}}var C=te.above(e,{match:W=>te.isBlock(e,W),at:i,voids:l}),[,g]=C,$=te.isStart(e,i,g),w=te.isEnd(e,i,g),S=$&&w,k=!$||$&&w,b=!w,[,x]=Pe.first({children:n},[]),[,A]=Pe.last({children:n},[]),R=[],E=W=>{var[Q,X]=W,de=X.length===0;return de?!1:S?!0:!(k&&pe.isAncestor(X,x)&&Et.isElement(Q)&&!e.isVoid(Q)&&!e.isInline(Q)||b&&pe.isAncestor(X,A)&&Et.isElement(Q)&&!e.isVoid(Q)&&!e.isInline(Q))};for(var B of Pe.nodes({children:n},{pass:E}))E(B)&&R.push(B);var N=[],I=[],L=[],q=!0,O=!1;for(var[M]of R)Et.isElement(M)&&!e.isInline(M)?(q=!1,O=!0,I.push(M)):q?N.push(M):L.push(M);var[j]=te.nodes(e,{at:i,match:W=>it.isText(W)||te.isInline(e,W),mode:"highest",voids:l}),[,V]=j,z=te.isStart(e,i,V),H=te.isEnd(e,i,V),K=te.pathRef(e,w?pe.next(g):g),F=te.pathRef(e,H?pe.next(V):V),Y=te.pathRef(e,g);st.splitNodes(e,{at:i,match:W=>O?te.isBlock(e,W):it.isText(W)||te.isInline(e,W),mode:O?"lowest":"highest",voids:l});var le=te.pathRef(e,!z||z&&H?pe.next(V):V);if(st.insertNodes(e,N,{at:le.current,match:W=>it.isText(W)||te.isInline(e,W),mode:"highest",voids:l}),S&&I.length&&st.delete(e,{at:Y.unref(),voids:l}),st.insertNodes(e,I,{at:K.current,match:W=>te.isBlock(e,W),mode:"lowest",voids:l}),st.insertNodes(e,L,{at:F.current,match:W=>it.isText(W)||te.isInline(e,W),mode:"highest",voids:l}),!o.at){var J;L.length>0?J=pe.previous(F.current):I.length>0?J=pe.previous(K.current):J=pe.previous(le.current);var P=te.end(e,J);st.select(e,P)}le.unref(),K.unref(),F.unref()}}})},insertText(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};te.withoutNormalizing(e,()=>{var{voids:a=!1}=o,{at:l=e.selection}=o;if(l){if(pe.isPath(l)&&(l=te.range(e,l)),Oe.isRange(l))if(Oe.isCollapsed(l))l=l.anchor;else{var i=Oe.end(l);if(!a&&te.void(e,{at:i}))return;var r=Oe.start(l),u=te.pointRef(e,r);st.delete(e,{at:l,voids:a}),l=u.unref(),st.setSelection(e,{anchor:l,focus:l})}if(!(!a&&te.void(e,{at:l}))){var{path:y,offset:p}=l;n.length>0&&e.apply({type:"insert_text",path:y,offset:p,text:n})}}})}};function Aa(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),o.push.apply(o,a)}return o}function Po(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Aa(Object(o),!0).forEach(function(a){Ps(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Aa(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}var st=Po(Po(Po(Po({},cN),fN),hN),mN);const gN={class:"editor-box"},yN={class:"field-list-item"},bN={class:"field-label"},kN={class:"field-type"},wN={__name:"draft-news-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.official-draft.components.draft-news-cont"),l=o,i=e,r=U(!1),u=Un(),y=Un(null),p=U("default"),m=U(""),v=U({excludeKeys:["insertTable","codeBlock","uploadVideo","group-video"]}),C={placeholder:a("ph_input_content"),MENU_CONF:{uploadImage:{async customUpload(V,z){var F;const H=await Hl(V),K=await ss({name:"official_draft",action:"default/exec",params:JSON.stringify({business:"upload_image",arguments:{...i.appData,media:H}})});z((F=K==null?void 0:K.data)==null?void 0:F.url)}}}},g=U(!1),$=U({});U([]);const w=U([]),S=U([]),k=U(new Set);Ut(()=>{const V=u.value;V!=null&&V.destroy()});function b(V="",z=[]){x(V,z),r.value=!0}function x(V,z){let H=Ul(i.variableOptions);S.value=z,w.value=[...z,...H].filter(F=>F&&F.value&&F.value!=""&&F.typ!=="node");const K=new Set;for(let F of w.value)V=A(V,F,K);m.value=V}function A(V,z,H){const K=new RegExp(`(${z.value})`,"g");if(!H.has(z.value)&&K.test(V)){let F=z.node_name+"."+z.text;F=F.replace(/\./g,"/"),V=V.replace(K,`<a href="zm-variable:${z.value}" target="_blank"><strong>${F}</strong></a>`),H.add(z.value)}return V}function R(V){u.value=V}function E(V){const{selection:z}=V;if(!z||!Oe.isCollapsed(z)){g.value=!1;return}const H=z.focus.path,K=z.focus.offset;te.string(V,H)[K-1]==="/"?(y.value=V,g.value=!0,N()):g.value=!1}function B(){const V=window.getSelection();if(!V||V.rangeCount===0)return null;const z=V.getRangeAt(0);if(!z.collapsed)return null;let H=z.getClientRects()[0];if(H)return H;const K=document.createElement("span");return K.textContent="​",K.style.display="inline-block",z.insertNode(K),H=K.getBoundingClientRect(),K.remove(),H}function N(V){const z=B();if(!z)return;const H=z.left+window.scrollX,K=z.bottom+window.scrollY+6;$.value=`left:${H}px; top:${K}px;`}function I(V,z,H){let K=H[H.length-1];delete K.children,L(K)}function L(V,z=!1){if(!V)return;g.value=!1;let H=V.node_name+"."+V.text;H=H.replace(/\./g,"/");const K={id:V.id,label:V.label,value:V.value,text:V.text,index:S.value.length};S.value.push(V);const F=new Set(k.value);F.add(V.value),k.value=F,z||q(H,K)}function q(V,z){const H=y.value,{selection:K}=H;K&&(Oe.isCollapsed(K)||te.deleteFragment(H),te.deleteBackward(H,"character"),te.insertNode(H,{type:"link",url:`zm-variable:${z.value}`,children:[{text:V,bold:!0}]}),te.insertText(H," "))}function O(V,z){const H=$.value.match(/left:\s*(-?\d+\.?\d*)px/),K=$.value.match(/top:\s*(-?\d+\.?\d*)px/);if(!H||!K)return;const F=parseFloat(H[1]),Y=parseFloat(K[1]);let le;V==="left"?le=F-z:le=F+z,$.value=`left:${le}px; top:${Y}px;`}function M(V){if(typeof V!="string")return"";const z=V.match(/^<div[^>]*class=["'][^"']*\bzm-editor-root\b[^"']*["'][^>]*>([\s\S]*)<\/div>$/);return z?z[1]:V}function j(){let V=Ht(m.value),z={};S.value.forEach(K=>{!z[K.value]&&V.indexOf(K.value)>-1&&(z[K.value]=K)});let H=Object.values(z);V=M(V),V=V.replace(/<a[^>]*href="zm-variable:([^"]+)"[^>]*>[\s\S]*?<\/a>/g,"$1"),l("change",V,Ht(H)),r.value=!1}return n({show:b}),(V,z)=>{const H=Ks,K=wt;return h(),G(K,{title:d(a)("title_content"),width:"880px",open:r.value,"onUpdate:open":z[1]||(z[1]=F=>r.value=F),onOk:j},{default:f(()=>[c(H,{type:"info",class:"zm-alert-info"},{message:f(()=>[T(_(d(a)("msg_rich_text_content_intro")),1)]),_:1}),s("div",gN,[c(d(kf),{style:{"border-bottom":"1px solid #ccc"},editor:u.value,defaultConfig:v.value,mode:p.value},null,8,["editor","defaultConfig","mode"]),c(d(wf),{style:{height:"480px","overflow-y":"hidden"},modelValue:m.value,"onUpdate:modelValue":z[0]||(z[0]=F=>m.value=F),defaultConfig:C,mode:p.value,onOnCreated:R,onOnChange:E},null,8,["modelValue","mode"])]),g.value?(h(),D("div",{key:0,style:jt($.value),class:"dropdown-list",ref:"dropdownList"},[c(il,{options:e.variableOptions,onChange:I,onDirectionChange:O},{option:f(({label:F,payload:Y})=>[s("div",yN,[s("div",bN,_(F),1),s("div",kN,_(Y.typ),1)])]),_:1},8,["options"])],4)):Z("",!0)]),_:1},8,["title","open"])}}},CN=_e(wN,[["__scopeId","data-v-3376cd67"]]),$N={class:"field-list-item"},xN={class:"field-label"},SN={class:"field-type"},DN={__name:"draft-newspic-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change","updateVar"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.official-draft.components.draft-newspic-cont"),l=o,i=U(!1),r=U(""),u=U([]);function y(v="",C=[]){r.value=v,u.value=C,i.value=!0}function p(v,C){r.value=v,u.value=C}function m(){l("change",Ht(r.value),Ht(u.value)),i.value=!1}return n({show:y}),(v,C)=>{const g=Ks,$=wt;return h(),G($,{title:d(a)("title_content"),width:"880px",open:i.value,"onUpdate:open":C[1]||(C[1]=w=>i.value=w),onOk:m},{default:f(()=>[c(g,{type:"info",class:"zm-alert-info"},{message:f(()=>[T(_(d(a)("msg_rich_text_content_intro")),1)]),_:1}),c(xe,{style:{"margin-top":"16px"},type:"textarea",inputStyle:"height: 420px;",options:e.variableOptions,defaultSelectedList:u.value||[],defaultValue:r.value,ref:"atInputRef",onOpen:C[0]||(C[0]=w=>l("updateVar")),onChange:p,placeholder:d(a)("ph_input_content")},{option:f(({label:w,payload:S})=>[s("div",$N,[s("div",xN,_(w),1),s("div",SN,_(S.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),_:1},8,["title","open"])}}},AN={class:"article-container"},ON={class:"node-options"},NN={class:"options-title"},BN={class:"options-item is-required"},EN={class:"options-item-tit"},IN={class:"option-label"},FN={class:"options-item is-required"},RN={class:"options-item-tit"},LN={class:"option-label"},VN={class:"node-options article-form-box"},MN={class:"options-title"},TN={href:"https://developers.weixin.qq.com/doc/subscription/api/draftbox/draftmanage/api_draft_add.html",style:{"font-weight":"400"},target:"_blank"},jN={key:0,class:"options-item"},PN={class:"news-tabs"},qN=["onClick"],HN={class:"options-item baseline is-required"},UN={class:"options-item-tit"},JN={class:"option-label"},zN={style:{width:"100%"}},KN={class:"field-list-item"},GN={class:"field-label"},WN={class:"field-type"},ZN={class:"desc"},YN={class:"options-item baseline is-required"},QN={class:"options-item-tit"},XN={class:"option-label"},e9={class:"field-list-item"},t9={class:"field-label"},s9={class:"field-type"},o9={class:"desc"},n9={class:"options-item is-required"},a9={class:"options-item-tit"},l9={class:"option-label"},i9={class:"field-list-item"},r9={class:"field-label"},d9={class:"field-type"},u9={class:"options-item"},c9={class:"options-item-tit"},_9={class:"option-label"},p9={class:"field-list-item"},f9={class:"field-label"},v9={class:"field-type"},h9={class:"options-item"},m9={class:"options-item-tit"},g9={class:"option-label"},y9={class:"field-list-item"},b9={class:"field-label"},k9={class:"field-type"},w9={class:"options-item is-required"},C9={class:"options-item-tit"},$9={class:"option-label"},x9={class:"cont-box"},S9={class:"field-list-item"},D9={class:"field-label"},A9={class:"field-type"},O9={class:"options-item"},N9={class:"options-item-tit"},B9={class:"option-label"},E9={class:"field-list-item"},I9={class:"field-label"},F9={class:"field-type"},R9={class:"options-item is-required baseline"},L9={class:"options-item-tit"},V9={class:"option-label"},M9={style:{flex:"1"}},T9={class:"field-list-item"},j9={class:"field-label"},P9={class:"field-type"},q9={class:"options-item"},H9={class:"options-item-tit"},U9={class:"option-label"},J9={class:"options-item"},z9={class:"options-item-tit"},K9={class:"option-label"},G9={class:"options-item is-required baseline"},W9={class:"options-item-tit"},Z9={class:"option-label"},Y9={class:"img-box"},Q9={class:"field-list-item"},X9={class:"field-label"},eB={class:"field-type"},tB={class:"options-item baseline"},sB={class:"options-item-tit"},oB={class:"option-label"},nB={class:"img-box"},aB={class:"field-list-item"},lB={class:"field-label"},iB={class:"field-type"},rB={class:"node-options"},dB={class:"options-title"},uB={class:"options-item"},cB={__name:"official-draft-store",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.components.official-draft.official-draft-store"),a=n,l=e,i=be("setData"),r=U(null),u=U([]),y=U([]),p={title:"",article_type:"",author:"",digest:"",content:"",content_source_url:"",need_open_comment:0,only_fans_can_comment:0,pic_crop_235_1:"",pic_crop_1_1:"",thumb_type:1,thumb_media_id:"",image_info:[{value:"",tags:[]}],product_info:[{value:"",tags:[]}],cover_info:[{value:"",tags:[]}],tag_map:{}},m=we({app_id:void 0,app_secret:"",app_name:"",article_type:"news",articles:[],media_id:"",index:0,tag_map:{}}),v=U(0),C=ye(()=>m.articles[v.value]||p);ye(()=>[{label:o("label_center"),value:1},{label:o("label_left_align"),value:2},{label:o("label_right_align"),value:3}]);const g=ye(()=>[{label:o("opt_material_url"),value:1},{label:o("opt_material_media_id"),value:2}]),$=ye(()=>[{label:o("opt_close"),value:0},{label:o("opt_open"),value:1}]),w=ye(()=>[{label:o("opt_all_users"),value:0},{label:o("opt_fans_only"),value:1}]);Ne(()=>{S()}),Ie(()=>l.action,()=>{var z;u.value=Fs(JSON.parse(JSON.stringify(((z=l.action)==null?void 0:z.output)||"{}")))},{deep:!0,immediate:!0});function S(){k(),q(),b()}function k(){oo({app_type:"official_account"}).then(z=>{y.value=(z==null?void 0:z.data)||[]})}function b(){var K,F;let z=JSON.parse(l.node.node_params),H=((F=(K=z==null?void 0:z.plugin)==null?void 0:K.params)==null?void 0:F.arguments)||{};if(l.actionName==="update_draft"&&H.articles&&Object.keys(H.articles).length&&(H.articles=[H.articles]),Object.assign(m,H),!m.app_id){let Y=rs(window.localStorage.getItem("zm:ai:draft:last:app"));Y&&(Object.assign(m,Y),V())}}function x(z,H){const{key:K,secret:F,name:Y}=H;m.app_secret=F,m.app_name=Y,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:K,app_secret:F,app_name:Y})),V()}function A(){m.articles=[],q()}function R(z,H){v.value=H}function E(z,H,K){m[z]=H,m.tag_map[z]=K,V()}function B(z,H,K){C.value[z]=H,C.value.tag_map[z]=K,V()}function N(z,H,K){z.value=H,z.tags=K,V()}function I(){r.value.show(C.value.content,C.value.tag_map.content||[])}function L(z,H){C.value.content=z,C.value.tag_map.content=H||[],V()}function q(){let z=JSON.parse(JSON.stringify(p));z.article_type=m.article_type,m.articles.push(z)}function O(z){m.articles.splice(z,1),V()}function M(z){m.articles[v.value][z].push({value:"",tags:[]})}function j(z,H){m.articles[v.value][z].splice(H,1)}function V(){Ze(()=>{let z=JSON.parse(l.node.node_params);z.plugin.output_obj=u.value;let H={...m};l.actionName==="update_draft"&&(H.articles=H.articles[0]),Object.assign(z.plugin.params,{arguments:{...H}}),i({...l.node,node_params:JSON.stringify(z)})})}return(z,H)=>{var W,Q,X,de,Fe,De,$e,Ue;const K=et,F=Ye,Y=Qt,le=Yt,J=ct,P=rt;return h(),D("div",AN,[s("div",ON,[s("div",NN,[s("div",null,[H[25]||(H[25]=s("img",{src:gl,class:"title-icon"},null,-1)),T(" "+_(d(o)("title_basic_info")),1)])]),s("div",BN,[s("div",EN,[s("div",IN,_(d(o)("label_official_account")),1)]),s("div",null,[c(F,{value:m.app_id,"onUpdate:value":H[0]||(H[0]=ie=>m.app_id=ie),placeholder:d(o)("ph_select_official_account"),style:{width:"100%"},onChange:x},{default:f(()=>[(h(!0),D(ee,null,se(y.value,ie=>(h(),G(K,{key:ie.app_id,name:ie.app_name,secret:ie.app_secret},{default:f(()=>[T(_(ie.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",FN,[s("div",RN,[s("div",LN,_(d(o)("label_article_type")),1)]),s("div",null,[c(le,{value:m.article_type,"onUpdate:value":H[1]||(H[1]=ie=>m.article_type=ie),onChange:A},{default:f(()=>[c(Y,{value:"news"},{default:f(()=>[T(_(d(o)("opt_news")),1)]),_:1}),c(Y,{value:"newspic"},{default:f(()=>[T(_(d(o)("opt_newspic")),1)]),_:1})]),_:1},8,["value"])])])]),s("div",VN,[s("div",MN,[s("div",null,[H[26]||(H[26]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(" "+_(d(o)("title_input")),1)]),s("a",TN,_(d(o)("view_help_doc")),1)]),e.actionName==="add_draft"?(h(),D("div",jN,[s("div",PN,[(h(!0),D(ee,null,se(m.articles,(ie,ge)=>(h(),D("div",{key:ge,class:qe(["news-item",{active:ge==v.value}]),onClick:ve=>R(ie,ge)},[T(_(ge==0?d(o)("main_news"):`${d(o)("secondary_news")} ${ge}`)+" ",1),m.articles.length>1?(h(),G(d(Ga),{key:0,class:"del-icon",onClick:He(ve=>O(ge),["stop"])},null,8,["onClick"])):Z("",!0)],10,qN))),128)),m.articles.length<8?(h(),D("div",{key:0,class:"news-item",onClick:q},[c(d(Xe))])):Z("",!0)])])):(h(),D(ee,{key:1},[s("div",HN,[s("div",UN,[s("div",JN,_(d(o)("label_article_id")),1)]),s("div",zN,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((W=m.tag_map)==null?void 0:W.media_id)||[],defaultValue:m.media_id,ref:"atInputRef",onOpen:H[2]||(H[2]=ie=>a("updateVar")),onChange:H[3]||(H[3]=(ie,ge)=>E("media_id",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",KN,[s("div",GN,_(ie),1),s("div",WN,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",ZN,_(d(o)("desc_article_media_id")),1)])]),s("div",YN,[s("div",QN,[s("div",XN,_(d(o)("label_article_position")),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((Q=m.tag_map)==null?void 0:Q.index)||[],defaultValue:m.index,ref:"atInputRef",onOpen:H[4]||(H[4]=ie=>a("updateVar")),onChange:H[5]||(H[5]=(ie,ge)=>E("index",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",e9,[s("div",t9,_(ie),1),s("div",s9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),s("div",o9,_(d(o)("desc_article_position")),1)])])],64)),s("div",n9,[s("div",a9,[s("div",l9,_(d(o)("label_title")),1)]),c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((X=C.value.tag_map)==null?void 0:X.title)||[],defaultValue:C.value.title,ref:"atInputRef",onOpen:H[6]||(H[6]=ie=>a("updateVar")),onChange:H[7]||(H[7]=(ie,ge)=>B("title",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",i9,[s("div",r9,_(ie),1),s("div",d9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),C.value.article_type==="news"?(h(),D(ee,{key:2},[s("div",u9,[s("div",c9,[s("div",_9,_(d(o)("label_author")),1)]),c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((de=C.value.tag_map)==null?void 0:de.author)||[],defaultValue:C.value.author,ref:"atInputRef",onOpen:H[8]||(H[8]=ie=>a("updateVar")),onChange:H[9]||(H[9]=(ie,ge)=>B("author",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",p9,[s("div",f9,_(ie),1),s("div",v9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",h9,[s("div",m9,[s("div",g9,_(d(o)("label_digest")),1)]),c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((Fe=C.value.tag_map)==null?void 0:Fe.digest)||[],defaultValue:C.value.digest,ref:"atInputRef",onOpen:H[10]||(H[10]=ie=>a("updateVar")),onChange:H[11]||(H[11]=(ie,ge)=>B("digest",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",y9,[s("div",b9,_(ie),1),s("div",k9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])],64)):Z("",!0),s("div",w9,[s("div",C9,[s("div",$9,_(d(o)("label_content")),1)]),s("div",x9,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((De=C.value.tag_map)==null?void 0:De.content)||[],defaultValue:C.value.content,ref:"atInputRef",onOpen:H[12]||(H[12]=ie=>a("updateVar")),onChange:H[13]||(H[13]=(ie,ge)=>B("content",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",S9,[s("div",D9,_(ie),1),s("div",A9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),c(J,{title:d(o)("tooltip_edit_window")},{default:f(()=>[c(d(Wt),{class:"edit-icon",onClick:I})]),_:1},8,["title"])])]),C.value.article_type==="news"?(h(),D(ee,{key:3},[s("div",O9,[s("div",N9,[s("div",B9,_(d(o)("label_content_source_url")),1)]),c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:(($e=C.value.tag_map)==null?void 0:$e.content_source_url)||[],defaultValue:C.value.content_source_url,ref:"atInputRef",onOpen:H[14]||(H[14]=ie=>a("updateVar")),onChange:H[15]||(H[15]=(ie,ge)=>B("content_source_url",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",E9,[s("div",I9,_(ie),1),s("div",F9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",R9,[s("div",L9,[s("div",V9,_(d(o)("label_cover_material")),1)]),s("div",M9,[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:((Ue=C.value.tag_map)==null?void 0:Ue.thumb_media_id)||[],defaultValue:C.value.thumb_media_id,ref:"atInputRef",onOpen:H[16]||(H[16]=ie=>a("updateVar")),onChange:H[17]||(H[17]=(ie,ge)=>B("thumb_media_id",ie,ge)),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ie,payload:ge})=>[s("div",T9,[s("div",j9,_(ie),1),s("div",P9,_(ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]),c(vs,{class:"mt4",value:C.value.thumb_type,"onUpdate:value":H[18]||(H[18]=ie=>C.value.thumb_type=ie),options:g.value,onChange:V},null,8,["value","options"])])])],64)):Z("",!0),s("div",q9,[s("div",H9,[s("div",U9,_(d(o)("label_article_comments")),1)]),c(vs,{value:C.value.need_open_comment,"onUpdate:value":H[19]||(H[19]=ie=>C.value.need_open_comment=ie),options:$.value,onChange:V},null,8,["value","options"])]),s("div",J9,[s("div",z9,[s("div",K9,_(d(o)("label_comment_audience")),1)]),c(vs,{value:C.value.only_fans_can_comment,"onUpdate:value":H[20]||(H[20]=ie=>C.value.only_fans_can_comment=ie),options:w.value,onChange:V},null,8,["value","options"])]),C.value.article_type==="news"?(h(),D(ee,{key:4},[],64)):(h(),D(ee,{key:5},[s("div",G9,[s("div",W9,[s("div",Z9,_(d(o)("label_image")),1)]),s("div",Y9,[(h(!0),D(ee,null,se(C.value.image_info,(ie,ge)=>(h(),D("div",{key:ge,class:"img-item"},[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:ie.tags||[],defaultValue:ie.value,ref_for:!0,ref:"atInputRef",onOpen:H[21]||(H[21]=ve=>a("updateVar")),onChange:(ve,he)=>N(ie,ve,he),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ve,payload:he})=>[s("div",Q9,[s("div",X9,_(ve),1),s("div",eB,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"]),c(d(at),{onClick:ve=>j("image_info",ge)},null,8,["onClick"])]))),128)),C.value.image_info.length<20?(h(),G(P,{key:0,type:"dashed",icon:Qe(d(Xe)),onClick:H[22]||(H[22]=ie=>M("image_info"))},{default:f(()=>[T(_(d(o)("btn_add_image")),1)]),_:1},8,["icon"])):Z("",!0)])]),s("div",tB,[s("div",sB,[s("div",oB,_(d(o)("label_cover_info")),1)]),s("div",nB,[(h(!0),D(ee,null,se(C.value.cover_info,(ie,ge)=>(h(),D("div",{key:ge,class:"img-item"},[c(xe,{type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:ie.tags||[],defaultValue:ie.value,ref_for:!0,ref:"atInputRef",onOpen:H[23]||(H[23]=ve=>a("updateVar")),onChange:(ve,he)=>N(ie,ve,he),placeholder:d(o)("ph_input_content_with_var")},{option:f(({label:ve,payload:he})=>[s("div",aB,[s("div",lB,_(ve),1),s("div",iB,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"]),c(d(at),{onClick:ve=>j("cover_info",ge)},null,8,["onClick"])]))),128)),C.value.cover_info.length<5?(h(),G(P,{key:0,type:"dashed",icon:Qe(d(Xe)),onClick:H[24]||(H[24]=ie=>M("cover_info"))},{default:f(()=>[T(_(d(o)("btn_add_cover")),1)]),_:1},8,["icon"])):Z("",!0)])])],64))]),s("div",rB,[s("div",dB,[s("div",null,[H[27]||(H[27]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(" "+_(d(o)("title_output")),1)])]),s("div",uB,[c(Rs,{"tree-data":u.value},null,8,["tree-data"])])]),m.article_type==="news"?(h(),G(CN,{key:0,ref_key:"newsContRef",ref:r,"variable-options":e.variableOptions,appData:{app_id:m.app_id,app_secret:m.app_secret},onChange:L},null,8,["variable-options","appData"])):(h(),G(DN,{key:1,ref_key:"newsContRef",ref:r,"variable-options":e.variableOptions,onChange:L},null,8,["variable-options"]))])}}},Oa=_e(cB,[["__scopeId","data-v-9ecba964"]]),_B={class:"options-item is-required"},pB={class:"options-item-tit"},fB={class:"option-label"},vB={key:0,class:"desc"},hB={class:"options-item is-required"},mB={class:"options-item-tit"},gB={class:"option-label"},Do={__name:"official-draft-operate",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.components.official-draft.official-draft-operate"),a=n,l=e,i=U({}),r=U([]);Ne(()=>{y(),u()});function u(){const m={...l.action.params,app_id:{...l.action.params.app_id,default:null},app_name:{desc:"label_official_account_name",type:"string"}};let v=rs(window.localStorage.getItem("zm:ai:draft:last:app"));v&&(m.app_id.default=v.app_id,m.app_name.default=v.app_name,m.app_secret.default=v.app_secret),l.actionName==="preview_message"?(m.type={...l.action.params.type,default:"touser"},i.value=kn(m,["app_id","media_id","type","account"])):i.value=m}function y(){oo({app_type:"official_account"}).then(m=>{r.value=(m==null?void 0:m.data)||[]})}function p(m,v){const{key:C,secret:g,name:$}=v;m.app_secret.value=g,m.app_name.value=$,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:C,app_secret:g,app_name:$}))}return(m,v)=>{const C=et,g=Ye,$=Qt,w=Yt;return h(),G(tn,{node:e.node,params:i.value,output:e.action.output,variableOptions:e.variableOptions,onUpdateVar:v[0]||(v[0]=S=>a("updateVar"))},Pa({app_name:f(()=>[]),app_secret:f(()=>[]),app_id:f(({state:S,item:k,keyName:b})=>[s("div",_B,[s("div",pB,[s("div",fB,_(d(o)("label_official_account")),1)]),s("div",null,[c(g,{value:k.value,"onUpdate:value":x=>k.value=x,placeholder:d(o)("ph_select_official_account"),style:{width:"100%"},onChange:(x,A)=>p(S,A)},{default:f(()=>[(h(!0),D(ee,null,se(r.value,x=>(h(),G(C,{key:x.app_id,value:x.app_id,name:x.app_name,secret:x.app_secret},{default:f(()=>[T(_(x.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","placeholder","onChange"])]),["publish_draft","preview_message"].includes(e.actionName)?(h(),D("div",vB,[c(d(Sn)),T(" "+_(d(o)("msg_unsupported_account")),1)])):Z("",!0)])]),_:2},[e.actionName==="preview_message"?{name:"type",fn:f(({state:S,item:k})=>[s("div",hB,[s("div",mB,[s("div",gB,_(d(o)("label_message_user_type")),1)]),s("div",null,[c(w,{value:k.value,"onUpdate:value":b=>k.value=b},{default:f(()=>[c($,{value:"touser"},{default:f(()=>[T(_(d(o)("opt_official_user_openid")),1)]),_:1}),c($,{value:"towxname"},{default:f(()=>[T(_(d(o)("opt_wechat_id")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])])])]),key:"0"}:void 0]),1032,["node","params","output","variableOptions"])}}},yB={__name:"official-draft-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const o={add_draft:Oa,update_draft:Oa,delete_draft:Do,publish_draft:Do,preview_message:Do,get_draft:Do},a=n,l=e,i=ye(()=>o[l.actionName]||Do);return(r,u)=>(h(),G(Go(i.value),{action:e.action,actionName:e.actionName,variableOptions:e.variableOptions,node:e.node,onUpdateVar:u[0]||(u[0]=y=>a("updateVar"))},null,40,["action","actionName","variableOptions","node"]))}},bB={class:"field-item"},kB={class:"field-key"},wB={class:"tip-content"},CB={class:"field-type"},$B={class:"field-name"},xB={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(e){const n=e,o=U([]);return(a,l)=>{const i=It,r=ct,u=xn;return h(),D("div",{class:"field-tree-wrapper",onWheel:l[1]||(l[1]=He(()=>{},["stop"])),onTouchmove:l[2]||(l[2]=He(()=>{},["stop"]))},[c(u,{selectedKeys:o.value,"onUpdate:selectedKeys":l[0]||(l[0]=y=>o.value=y),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":n.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:f(({switcherCls:y})=>[s("span",{class:qe(y)},[c(i,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:f(({dataRef:y})=>[s("div",bB,[s("span",kB,_(y.key),1),y.tip?(h(),G(r,{key:0,overlayStyle:{maxWidth:"800px"}},{title:f(()=>[s("div",wB,_(y.tip),1)]),default:f(()=>[c(d(Re),{style:{"margin-left":"4px"}})]),_:2},1024)):Z("",!0),s("span",CB,_(y.typ),1),s("span",$B,_(y.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},SB=_e(xB,[["__scopeId","data-v-aabfe7ac"]]),DB={key:0,class:"not-login-box"},AB={key:1,class:"login-info-box"},OB=["src"],NB={__name:"ding-login-box",props:{formState:{type:Object,default:()=>null}},emits:["change"],setup(e,{emit:n}){const o=e,a=n,l=U(!1),i=U(rs(localStorage.getItem("zm:workflow:ding:login:user")));let r=null;Ne(()=>{setTimeout(()=>{var C;(C=i.value)!=null&&C.unionId&&v()},100)});function u(){if(!o.formState.dingtalk_app_key||!o.formState.dingtalk_app_secret)return Me.error("缺少授权信息");l.value=!0,Ze(()=>{y(p)})}function y(C=()=>{}){window.DTFrameLogin?C():(r=document.createElement("script"),r.src="https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js",r.async=!0,r.onload=()=>C(),document.body.appendChild(r))}function p(){window.DTFrameLogin({id:"dingLoginCode",width:220,height:240},{redirect_uri:encodeURIComponent(window.location.origin),client_id:"ding8xzffz9vztwiqdcu",scope:"openid",response_type:"code",prompt:"consent"},C=>{const{redirectUrl:g,authCode:$}=C;m($)},C=>{console.error(`errorMsg of errorCbk: ${C}`)})}function m(C){const{dingtalk_app_key:g,dingtalk_app_secret:$}=o.formState;ss({name:"dingtalk_ai_table",action:"default/exec",params:JSON.stringify({business:"GetLoginUserInfo",arguments:{dingtalk_app_key:g,dingtalk_app_secret:$,dingtalk_code:C}})}).then(w=>{var S;(S=w==null?void 0:w.data)!=null&&S.unionId&&(i.value=w==null?void 0:w.data,localStorage.setItem("zm:workflow:ding:login:user",JSON.stringify(i.value)),v())})}function v(){var C;a("change","operatorId",(C=i.value)==null?void 0:C.unionId)}return(C,g)=>{var S,k;const $=rt,w=wt;return h(),D("div",null,[i.value?(h(),D("div",AB,[s("img",{class:"avatar",src:(S=i.value)==null?void 0:S.avatarUrl},null,8,OB),s("span",null,_((k=i.value)==null?void 0:k.nick),1),c(d(wo),{class:"icon"})])):(h(),D("div",DB,[g[2]||(g[2]=s("div",{class:"tit"},"请先完成登录",-1)),c($,{type:"primary",class:"link",onClick:u},{default:f(()=>[...g[1]||(g[1]=[T("去登录",-1)])]),_:1})])),c(w,{open:l.value,"onUpdate:open":g[0]||(g[0]=b=>l.value=b),footer:null,wrapClassName:"qrcode-wrap",width:"380px"},{default:f(()=>[...g[3]||(g[3]=[s("div",{class:"qrcode-box"},[s("div",{class:"title"},"扫码登录"),s("div",{class:"content"},[s("div",{class:"tip"},"请使用钉钉扫描下方二维码授权"),s("div",{id:"dingLoginCode",class:"qrcode"})])],-1)])]),_:1},8,["open"])])}}},BB=_e(NB,[["__scopeId","data-v-458a1626"]]),EB={class:"flex-center min-input"},IB={class:"field-list-item"},FB={class:"field-label"},RB={class:"field-type"},LB={__name:"ding-table-select",props:{formState:{type:Object,default:()=>null},variableOptions:{type:Array,default:()=>[]},canFull:{type:Boolean,default:!1}},emits:["open","change"],setup(e,{emit:n}){const o=e,a=n,l=U(null),i=U([]),r=we({set_type:"1",sheetIdOrName:void 0,tags:[],table_name:""}),u=ye(()=>{const{baseId:$,operatorId:w,dingtalk_app_key:S,dingtalk_app_secret:k}=o.formState;return{ok:!!($&&w&&S&&k),config:{baseId:$,operatorId:w,dingtalk_app_key:S,dingtalk_app_secret:k}}});Ie(u,$=>{i.value=[],$.ok?Uo($.config.baseId)?y():r.set_type==1&&C():(i.value=[],r.set_type==1&&C(),r.tags=[],Ze(()=>{g()}))},{immediate:!0}),Ie(()=>{var $,w;return{set_type:($=o.formState.extras)==null?void 0:$.set_type,table_name:(w=o.formState.extras)==null?void 0:w.table_name,sheetIdOrName:o.formState.sheetIdOrName,sheetIdOrName_tags:o.formState.sheetIdOrName_tags}},$=>{r.set_type=$.set_type||"1",r.sheetIdOrName=$.sheetIdOrName||void 0,r.tags=$.sheetIdOrName_tags||[],r.table_name=$.table_name||""},{immediate:!0});function y(){const{dingtalk_app_key:$,dingtalk_app_secret:w,operatorId:S,baseId:k}=o.formState;return ss({name:"dingtalk_ai_table",action:"default/exec",params:JSON.stringify({business:"AllSheets",arguments:{dingtalk_app_key:$,dingtalk_app_secret:w,operatorId:S,baseId:k}})}).then(b=>{var x;if(i.value=(b==null?void 0:b.data)||[],r.set_type==1){let A=null;r.sheetIdOrName?A=i.value.find(R=>r.sheetIdOrName==R.id):A=((x=i.value)==null?void 0:x[0])||void 0,C(A)}}).catch(()=>{r.set_type==1&&C()}).finally(()=>{g()}),!0}function p(){let $=null;r.set_type=="1"&&($=i.value[0]),C($),g()}function m($,w){r.sheetIdOrName=$,r.tags=w,g()}function v($,w){r.table_name=w.name,g()}function C($=null){$!=null&&$.id?(r.sheetIdOrName=$.id,r.table_name=$.name):(r.sheetIdOrName=r.set_type=="1"?void 0:"",r.table_name="")}function g(){a("change","sheetIdOrName",r.sheetIdOrName,r.tags,{set_type:r.set_type,table_name:r.table_name})}return($,w)=>{const S=et,k=Ye;return h(),D("div",null,[s("div",EB,[c(k,{value:r.set_type,"onUpdate:value":w[0]||(w[0]=b=>r.set_type=b),onChange:p,style:{width:"112px","flex-shrink":"0"}},{default:f(()=>[c(S,{value:"1"},{default:f(()=>[...w[3]||(w[3]=[T("选择数据表",-1)])]),_:1}),c(S,{value:"2"},{default:f(()=>[...w[4]||(w[4]=[T("插入变量",-1)])]),_:1})]),_:1},8,["value"]),r.set_type==1?(h(),G(k,{key:0,value:r.sheetIdOrName,"onUpdate:value":w[1]||(w[1]=b=>r.sheetIdOrName=b),onChange:v,placeholder:"请选择数据表",style:{width:"100%"}},{default:f(()=>[(h(!0),D(ee,null,se(i.value,b=>(h(),G(S,{key:b.id,name:b.name,value:b.id},{default:f(()=>[T(_(b.name),1)]),_:2},1032,["name","value"]))),128))]),_:1},8,["value"])):(h(),G(Qs,{key:1,type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:r.tags||[],defaultValue:r.sheetIdOrName,canFull:e.canFull,ref_key:"atInputRef",ref:l,onOpen:w[2]||(w[2]=b=>a("open")),onChange:m,placeholder:"请输入表格ID或名称，键入“/”可以插入变量"},{option:f(({label:b,payload:x})=>[s("div",IB,[s("div",FB,_(b),1),s("div",RB,_(x.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","canFull"]))]),w[5]||(w[5]=s("div",{class:"desc"},"数据表ID或名称，例如：tblz2wmlWiB1JGxS",-1))])}}},VB=_e(LB,[["__scopeId","data-v-6e6f8d31"]]),MB={class:"options-item-tit"},TB={class:"option-label"},jB=["onClick"],PB={class:"tip-content"},qB={class:"option-type"},HB={key:1,style:{"margin-left":"auto","margin-bottom":"4px"}},UB={key:0},JB=["innerHTML"],zB={key:0,class:"desc",style:{color:"#FB363F"}},KB={key:1},GB=["innerHTML"],WB={key:0,class:"desc",style:{color:"#FB363F"}},ZB={key:2},YB=["innerHTML"],QB={key:0,class:"desc",style:{color:"#FB363F"}},XB={key:3},eE=["innerHTML"],tE={key:0,class:"desc",style:{color:"#FB363F"}},sE={key:4},oE={class:"tag-box"},nE={class:"field-list-item"},aE={class:"field-label"},lE={class:"field-type"},iE={class:"field-list-item"},rE={class:"field-label"},dE={class:"field-type"},uE=["innerHTML"],cE={key:0,class:"desc",style:{color:"#FB363F"}},_E={key:5},pE={class:"tag-box"},fE={class:"field-list-item"},vE={class:"field-label"},hE={class:"field-type"},mE=["innerHTML"],gE={key:0,class:"desc",style:{color:"#FB363F"}},yE={key:6},bE={key:7},kE={key:8},wE={class:"field-list-item"},CE={class:"field-label"},$E={class:"field-type"},xE=["innerHTML"],SE={key:0,class:"desc",style:{color:"#FB363F"}},DE={__name:"field-list",props:{actionName:{type:String},items:{type:Array,default:()=>[]},formState:{type:Object,default:()=>({})},errors:{type:Object,default:()=>({})},apps:{type:Array,default:()=>[]},variableOptions:{type:Array,default:()=>[]},tagTypes:{type:Object,default:()=>({})},tagLists:{type:Object,default:()=>({})},showTagComponents:{type:Boolean,default:!1},sortedEnum:{type:Function},appChange:{type:Function},update:{type:Function},onFieldChange:{type:Function},onChangeDynamic:{type:Function},filterOption:{type:Function},tagTypeChange:{type:Function},tagChange:{type:Function},syncFieldTags:{type:Function},syncingTags:{type:Object,default:()=>({})},dateRangeTypes:{type:Object,default:()=>({})},dateRangeTypeChange:{type:Function},getRangeValue:{type:Function},onDateRangeCalendarChange:{type:Function},onDateRangeChange:{type:Function},getDisabledDateForRange:{type:Function},onOpenVar:{type:Function},onToggleAdvanced:{type:Function}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.components.dynamic-api.field-list"),o=[{label:n("label_on"),value:"true"},{label:n("label_off"),value:"false"}];function a(l){return!l||typeof l!="string"?"":l.replace(/\n/g,"<br/")}return(l,i)=>{const r=os,u=ct,y=et,p=Ye,m=Qt,v=Yt,C=hi;return h(!0),D(ee,null,se(e.items,g=>{var $,w,S,k,b,x,A,R,E,B,N,I,L,q,O,M,j,V,z,H,K,F,Y,le,J,P,W,Q,X,de,Fe,De,$e,Ue,ie,ge;return h(),D("div",{key:g.key,class:qe(["options-item",{"is-required":($=g.meta)==null?void 0:$.required}])},[s("div",MB,[s("div",TB,[T(_(((w=g.meta)==null?void 0:w.name)||g.key)+" ",1),(S=g.meta)!=null&&S.tag_component?(h(),G(u,{key:0,title:d(n)("tip_sync_tags"),overlayStyle:{maxWidth:"600px"},placement:"top"},{default:f(()=>[s("a",{onClick:ve=>e.syncFieldTags&&e.syncFieldTags(g.key,g.meta)},[T(_(d(n)("btn_sync"))+" ",1),e.syncingTags&&e.syncingTags[g.key]?(h(),G(r,{key:0,size:"small"})):Z("",!0)],8,jB)]),_:2},1032,["title"])):Z("",!0),(k=g.meta)!=null&&k.tip?(h(),G(u,{key:1,overlayStyle:{maxWidth:"600px"},placement:"top"},{title:f(()=>{var ve;return[s("div",PB,_((ve=g.meta)==null?void 0:ve.tip),1)]}),default:f(()=>[c(d(Re))]),_:2},1024)):Z("",!0)]),s("div",qB,_(((b=g.meta)==null?void 0:b.type)||"string"),1),(x=g.meta)!=null&&x.switch_component?(h(),G(vs,{key:0,style:{"margin-left":"8px"},value:String(e.formState[g.key]||"").toLowerCase()==="true"?"true":"false",options:o,onChange:ve=>{e.onFieldChange&&e.onFieldChange(g.key,ve),e.update&&e.update()}},null,8,["value","onChange"])):Z("",!0),(A=g.meta)!=null&&A.show_advanced_settings_icon?(h(),D("div",HB,[c(u,{title:d(n)("tip_advanced_settings")},{default:f(()=>[s("span",{onClick:i[0]||(i[0]=ve=>e.onToggleAdvanced&&e.onToggleAdvanced()),style:{color:"#2475FC",padding:"4px 8px",borderRadius:"24px",border:"1px solid #D9D9D9",background:"#E5EFFF",cursor:"pointer"}},[c(d(Cn))])]),_:1},8,["title"])])):Z("",!0)]),(R=g.meta)!=null&&R.select_official_component?(h(),D("div",UB,[c(p,{value:e.formState.app_id,placeholder:d(n)("ph_select_official_account"),style:{width:"100%"},onChange:i[1]||(i[1]=(ve,he)=>{e.onFieldChange&&e.onFieldChange("app_id",ve),e.appChange&&e.appChange(ve,he)})},{default:f(()=>[(h(!0),D(ee,null,se(e.apps,ve=>(h(),G(y,{key:ve.app_id,value:ve.app_id,name:ve.app_name,app_secret:ve.app_secret},{default:f(()=>[T(_(ve.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value","placeholder"]),s("div",{class:"desc",innerHTML:a((E=g.meta)==null?void 0:E.desc)},null,8,JB),e.errors[g.key]?(h(),D("div",zB,_(e.errors[g.key]),1)):Z("",!0)])):(B=g.meta)!=null&&B.enum_component?(h(),D("div",KB,[c(p,{value:e.formState[g.key],placeholder:(N=g.meta)!=null&&N.required?d(n)("ph_please_select"):d(n)("ph_please_select_optional"),style:{width:"100%"},onChange:ve=>{e.onFieldChange&&e.onFieldChange(g.key,ve),e.update&&e.update()}},{default:f(()=>{var ve,he;return[(h(!0),D(ee,null,se(e.sortedEnum?e.sortedEnum((ve=g.meta)==null?void 0:ve.enum):((he=g.meta)==null?void 0:he.enum)||[],Ae=>(h(),G(y,{key:Ae.value,value:Ae.value},{default:f(()=>[T(_(Ae.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","placeholder","onChange"]),s("div",{class:"desc",innerHTML:a((I=g.meta)==null?void 0:I.desc)},null,8,GB),e.errors[g.key]?(h(),D("div",WB,_(e.errors[g.key]),1)):Z("",!0)])):(L=g.meta)!=null&&L.radio_component?(h(),D("div",ZB,[c(v,{value:e.formState[g.key],onChange:ve=>{var Ae;const he=((Ae=ve==null?void 0:ve.target)==null?void 0:Ae.value)??ve;e.onFieldChange&&e.onFieldChange(g.key,he),e.update&&e.update()}},{default:f(()=>{var ve,he;return[(h(!0),D(ee,null,se(e.sortedEnum?e.sortedEnum((ve=g.meta)==null?void 0:ve.enum):((he=g.meta)==null?void 0:he.enum)||[],Ae=>(h(),G(m,{key:Ae.value,value:Ae.value},{default:f(()=>[T(_(Ae.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","onChange"]),s("div",{class:"desc",innerHTML:a((q=g.meta)==null?void 0:q.desc)},null,8,YB),e.errors[g.key]?(h(),D("div",QB,_(e.errors[g.key]),1)):Z("",!0)])):(O=g.meta)!=null&&O.switch_component?(h(),D("div",XB,[s("div",{class:"desc",innerHTML:a((M=g.meta)==null?void 0:M.desc)},null,8,eE),e.errors[g.key]?(h(),D("div",tE,_(e.errors[g.key]),1)):Z("",!0)])):(j=g.meta)!=null&&j.date_range_begin_component?(h(),D("div",sE,[s("div",oE,[c(p,{value:e.dateRangeTypes[(V=g.meta)==null?void 0:V.begin_date_key],onChange:ve=>e.dateRangeTypeChange&&e.dateRangeTypeChange(g.meta,ve),style:{width:"120px","padding-right":"4px"}},{default:f(()=>[c(y,{value:1},{default:f(()=>[T(_(d(n)("label_select_date")),1)]),_:1}),c(y,{value:2},{default:f(()=>[T(_(d(n)("label_insert_variable")),1)]),_:1})]),_:1},8,["value","onChange"]),e.dateRangeTypes[(z=g.meta)==null?void 0:z.begin_date_key]==1?(h(),G(C,{key:0,value:e.getRangeValue?e.getRangeValue(g.meta):null,format:"YYYY-MM-DD",style:{width:"100%"},onCalendarChange:ve=>e.onDateRangeCalendarChange&&e.onDateRangeCalendarChange(g.meta,ve),onChange:(ve,he)=>e.onDateRangeChange&&e.onDateRangeChange(g.meta,ve,he),"disabled-date":ve=>e.getDisabledDateForRange?e.getDisabledDateForRange(g.meta,ve):!1},null,8,["value","onCalendarChange","onChange","disabled-date"])):(h(),D(ee,{key:1},[c(Qs,{inputStyle:"height: 33px; width: 214px;",options:e.variableOptions,defaultSelectedList:e.formState[(((H=g.meta)==null?void 0:H.begin_date_key)||"")+"_tags"]||[],defaultValue:e.formState[(K=g.meta)==null?void 0:K.begin_date_key]||"",canFull:(F=g==null?void 0:g.meta)==null?void 0:F.text_edit_component,onOpen:i[2]||(i[2]=ve=>e.onOpenVar&&e.onOpenVar()),onChange:(ve,he)=>{var Ae;return e.onChangeDynamic&&e.onChangeDynamic((Ae=g.meta)==null?void 0:Ae.begin_date_key,ve,he)},placeholder:d(n)("ph_input_start_date")},{option:f(({label:ve,payload:he})=>[s("div",nE,[s("div",aE,_(ve),1),s("div",lE,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","canFull","onChange","placeholder"]),i[6]||(i[6]=s("div",{class:"date-range-separator"},"-",-1)),c(Qs,{inputStyle:"height: 33px; width: 214px;",options:e.variableOptions,defaultSelectedList:e.formState[(((Y=g.meta)==null?void 0:Y.end_date_key)||"")+"_tags"]||[],defaultValue:e.formState[(le=g.meta)==null?void 0:le.end_date_key]||"",canFull:(J=g==null?void 0:g.meta)==null?void 0:J.text_edit_component,onOpen:i[3]||(i[3]=ve=>e.onOpenVar&&e.onOpenVar()),onChange:(ve,he)=>{var Ae;return e.onChangeDynamic&&e.onChangeDynamic((Ae=g.meta)==null?void 0:Ae.end_date_key,ve,he)},placeholder:d(n)("ph_input_end_date")},{option:f(({label:ve,payload:he})=>[s("div",iE,[s("div",rE,_(ve),1),s("div",dE,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","canFull","onChange","placeholder"])],64))]),s("div",{class:"desc",innerHTML:a((P=g.meta)==null?void 0:P.desc)},null,8,uE),e.errors[g.key]?(h(),D("div",cE,_(e.errors[g.key]),1)):Z("",!0)])):(W=g.meta)!=null&&W.tag_component&&e.showTagComponents?(h(),D("div",_E,[s("div",pE,[c(p,{value:e.tagTypes[g.key],onChange:ve=>e.tagTypeChange&&e.tagTypeChange(g.key,ve,g.meta),style:{width:"120px"}},{default:f(()=>[c(y,{value:1},{default:f(()=>[T(_(d(n)("label_select_tag")),1)]),_:1}),c(y,{value:2},{default:f(()=>[T(_(d(n)("label_insert_variable")),1)]),_:1})]),_:1},8,["value","onChange"]),e.tagTypes[g.key]==1?(h(),G(p,{key:0,value:e.formState[g.key],placeholder:d(n)("ph_select_tag"),style:{width:"100%"},onChange:(ve,he)=>e.tagChange&&e.tagChange(g.key,ve,he),"show-search":"","filter-option":e.filterOption},{default:f(()=>[(h(!0),D(ee,null,se(e.tagLists[g.key]||[],ve=>(h(),G(y,{key:ve.id,value:ve.id,name:ve.name},{default:f(()=>[T(_(ve.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","placeholder","onChange","filter-option"])):(h(),G(Qs,{key:1,type:"textarea",inputStyle:"height: 33px;",options:e.variableOptions,defaultSelectedList:e.formState[g.key+"_tags"]||[],defaultValue:e.formState[g.key]||"",canFull:(Q=g==null?void 0:g.meta)==null?void 0:Q.text_edit_component,onOpen:i[4]||(i[4]=ve=>e.onOpenVar&&e.onOpenVar()),onChange:(ve,he)=>e.onChangeDynamic&&e.onChangeDynamic(g.key,ve,he),placeholder:d(n)("ph_input_content")},{option:f(({label:ve,payload:he})=>[s("div",fE,[s("div",vE,_(ve),1),s("div",hE,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","canFull","onChange","placeholder"]))]),s("div",{class:"desc",innerHTML:a((X=g.meta)==null?void 0:X.desc)},null,8,mE),e.errors[g.key]?(h(),D("div",gE,_(e.errors[g.key]),1)):Z("",!0)])):(de=g.meta)!=null&&de.dingtalk_user_info_component?(h(),D("div",yE,[c(BB,{formState:e.formState,onChange:e.onChangeDynamic},null,8,["formState","onChange"])])):(Fe=g.meta)!=null&&Fe.select_remote_component?(h(),D("div",bE,[c(VB,{formState:e.formState,variableOptions:e.variableOptions,canFull:(De=g==null?void 0:g.meta)==null?void 0:De.text_edit_component,onOpen:e.onOpenVar,onChange:e.onChangeDynamic},null,8,["formState","variableOptions","canFull","onOpen","onChange"])])):(h(),D("div",kE,[c(Qs,{type:(($e=g.meta)==null?void 0:$e.in)==="body"?"textarea":void 0,inputStyle:((Ue=g.meta)==null?void 0:Ue.in)==="body"?"height: 64px;":void 0,options:e.variableOptions,defaultSelectedList:e.formState[g.key+"_tags"]||[],defaultValue:e.formState[g.key]||"",canFull:(ie=g==null?void 0:g.meta)==null?void 0:ie.text_edit_component,onOpen:i[5]||(i[5]=ve=>e.onOpenVar&&e.onOpenVar()),onChange:(ve,he)=>e.onChangeDynamic&&e.onChangeDynamic(g.key,ve,he),placeholder:d(n)("ph_input_content")},{option:f(({label:ve,payload:he})=>[s("div",wE,[s("div",CE,_(ve),1),s("div",$E,_(he.typ),1)])]),_:1},8,["type","inputStyle","options","defaultSelectedList","defaultValue","canFull","onChange","placeholder"]),s("div",{class:"desc",innerHTML:a((ge=g.meta)==null?void 0:ge.desc)},null,8,xE),e.errors[g.key]?(h(),D("div",SE,_(e.errors[g.key]),1)):Z("",!0)]))],2)}),128)}}},dn=_e(DE,[["__scopeId","data-v-0ce08208"]]),AE={class:"main-box"},OE={key:0,class:"loading-box"},NE={key:1,class:"node-options"},BE={class:"options-title"},EE={key:0,class:"acton-box"},IE=["href"],FE={class:"node-options"},RE={class:"options-title"},LE={class:"node-options"},VE={class:"options-title"},ME={class:"options-item"},TE={__name:"dynamic-api-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.components.dynamic-api.dynamic-api-box"),a=n,l=e,i=be("setData"),r=go();let u="";const y=ye(()=>(g.value||[]).some(ae=>{var ce;const re=(ce=ae.meta)==null?void 0:ce.setting_cache_component;return re===!0||re===1||re==="true"||re==="1"})),p=ye(()=>String(w.click_url||"").trim()),m=ye(()=>String(w.click_title||"").trim()),v=ye(()=>{var ae;return((ae=l.action)==null?void 0:ae.params)||{}}),C=ye(()=>!!(v.value.app_id&&v.value.app_secret)),g=ye(()=>Object.entries(v.value||{}).map(([re,ce])=>({key:re,meta:ce})).filter(re=>{var ce;return!((ce=re.meta)!=null&&ce.hide_official_component)}).sort((re,ce)=>{var Ce,Ve;return+(((Ce=re.meta)==null?void 0:Ce.sort_num)||0)-+(((Ve=ce.meta)==null?void 0:Ve.sort_num)||0)}));function $(ae){return(ae||[]).slice().sort((re,ce)=>+(re.sort_num||0)-+(ce.sort_num||0))}const w=we({app_id:"",app_secret:"",app_name:"",extras:{}}),S=U(!1),k=U(!1),b=U([]),x=we({}),A=U([]),R=we({}),E=we({}),B=we({}),N=we({}),I=we({}),L=U(null),q=U({}),O=U(null),M=U(!1),j=ye(()=>g.value.some(re=>{var ce;return(ce=re.meta)==null?void 0:ce.tag_component})?g.value.some(re=>{const ce=re.meta||{},Ce=Array.isArray(ce.enum)?ce.enum:[];if(!(ce.enum_component||ce.radio_component||ce.switch_component)||Ce.length===0)return!1;const Ve=String(w[re.key]??""),Ee=Ce.find(Ge=>String(Ge==null?void 0:Ge.value)===Ve),ze=Ee==null?void 0:Ee.related_tags;return ze===!0||ze===1||ze==="true"||ze==="1"}):!1),V=ye(()=>(g.value||[]).some(ae=>{var ce;const re=(ce=ae.meta)==null?void 0:ce.plugin_config_component;return re===!0||re===1||re==="true"||re==="1"})),z=ye(()=>{var ce;const ae=(ce=l.action)==null?void 0:ce.use_advanced_settings,re=(g.value||[]).some(Ce=>{var Ee;const Ve=(Ee=Ce.meta)==null?void 0:Ee.advanced_settings;return Ve===!0||Ve===1||Ve==="true"||Ve==="1"});return ae===!0||ae===1||ae==="true"||ae==="1"||re}),H=ye(()=>{const ae=re=>{const ce=re==null?void 0:re.setting_cache_component;return ce===!0||ce===1||ce==="true"||ce==="1"};return(g.value||[]).filter(re=>{var ce;return!((ce=re.meta)!=null&&ce.tag_component&&!j.value)}).filter(re=>{var ce;return!((ce=re.meta)!=null&&ce.plugin_config_component)}).filter(re=>{var Ve;const ce=(Ve=re.meta)==null?void 0:Ve.advanced_settings;return!(ce===!0||ce===1||ce==="true"||ce==="1")}).filter(re=>!ae(re.meta))}),K=ye(()=>(g.value||[]).filter(ae=>{var ce;const re=(ce=ae.meta)==null?void 0:ce.setting_cache_component;return re===!0||re===1||re==="true"||re==="1"})),F=ye(()=>(g.value||[]).filter(ae=>{var Ee,ze;const re=(Ee=ae.meta)==null?void 0:Ee.advanced_settings,ce=re===!0||re===1||re==="true"||re==="1",Ce=(ze=ae.meta)==null?void 0:ze.plugin_config_component;return ce&&!(Ce===!0||Ce===1||Ce==="true"||Ce==="1")}));Ie(j,ae=>{if(!ae){let re=!1;g.value.forEach(ce=>{var Ce;(Ce=ce.meta)!=null&&Ce.tag_component&&(w[ce.key]&&(w[ce.key]="",re=!0),Array.isArray(w[ce.key+"_tags"])&&w[ce.key+"_tags"].length&&(w[ce.key+"_tags"]=[],re=!0))}),re&&Q()}}),Ne(()=>{Y(),mo({name:"workflow:validate",callback:W})});async function Y(){C.value&&await le(),J(),V.value&&await Ft(),g.value.forEach(async ae=>{var ce,Ce,Ve,Ee,ze,Ge;const re=String(((ce=ae.meta)==null?void 0:ce.enum_default)||"").trim();((Ce=ae.meta)!=null&&Ce.radio_component||(Ve=ae.meta)!=null&&Ve.enum_component||(Ee=ae.meta)!=null&&Ee.switch_component)&&!String(w[ae.key]||"").trim()&&re&&(w[ae.key]=re),(ze=ae.meta)!=null&&ze.tag_component&&(E[ae.key]=typeof E[ae.key]=="number"?E[ae.key]:1,await ue(ae.key,(Ge=ae.meta)==null?void 0:Ge.query_tag_service))}),$e(),he()}function le(){return oo({app_type:"official_account"}).then(ae=>{b.value=(ae==null?void 0:ae.data)||[]})}function J(){var ce,Ce,Ve;let ae=JSON.parse(l.node.node_params);u=((ce=ae==null?void 0:ae.plugin)==null?void 0:ce.name)||"";let re=((Ve=(Ce=ae==null?void 0:ae.plugin)==null?void 0:Ce.params)==null?void 0:Ve.arguments)||{};g.value.forEach(Ee=>{var Ge,dt,zt,Bt,ps,Ss;w[Ee.key]=Ee.key!=="app_id"?String(re[Ee.key]||"").trim():re[Ee.key];const ze=(re==null?void 0:re.tag_map)||{};if(w[Ee.key+"_tags"]=Array.isArray(ze[Ee.key])?ze[Ee.key]:[],(Ge=Ee.meta)!=null&&Ge.date_range_begin_component){const ks=(dt=Ee.meta)==null?void 0:dt.end_date_key,Gt=(zt=Ee.meta)==null?void 0:zt.date_type_key;w[ks]=String(re[ks]||"").trim(),w[ks+"_tags"]=Array.isArray(ze[ks])?ze[ks]:[];const xt=re[Gt];N[(Bt=Ee.meta)==null?void 0:Bt.begin_date_key]=typeof N[(ps=Ee.meta)==null?void 0:ps.begin_date_key]=="number"?N[(Ss=Ee.meta)==null?void 0:Ss.begin_date_key]:xt==null?1:Number(xt)||1}}),re.app_secret&&(w.app_secret=String(re.app_secret)),re.app_name&&(w.app_name=String(re.app_name)),re.extras&&(w.extras=re.extras)}function P(ae,re){re&&re.app_secret&&(w.app_secret=re.app_secret),re&&re.name&&(w.app_name=re.name),Q(),g.value.forEach(async ce=>{var Ce,Ve;(Ce=ce.meta)!=null&&Ce.tag_component&&await ue(ce.key,(Ve=ce.meta)==null?void 0:Ve.query_tag_service)})}function W(){var ce;l.node;const ae=mo(),re=Ae();re&&re.ok===!1&&ae.emit&&ae.emit("workflow:validate:error",{component:(ce=l.node)==null?void 0:ce.node_name,type:"",typeDisplay:"",message:"请完善字段后再继续",errors:re.errors||[]})}function Q(ae=null){let re=JSON.parse(l.node.node_params);re.plugin.output_obj=A.value;const ce=ve();At(ce),Object.assign(re.plugin.params,{arguments:{...ce,tag_map:{...ge()}},rendering:ie()}),V.value&&(re.plugin.params.config_name=O.value||""),re.plugin.params.use_plugin_config=!!V.value,i({...l.node,node_params:JSON.stringify(re)}),Ue()}function X(ae,re,ce,Ce={}){w[ae]=re,w[ae+"_tags"]=ce,typeof w.extras=="object"?Object.assign(w.extras,Ce):w.extras=Ce,Q()}function de(ae,re){w[ae]=re,Q()}function Fe(ae){return String(ae||"").replace(/`/g,"").trim()}function De(ae){return`${String(r.query.id||"")}:${u}:${ae}`}function $e(){var ce,Ce,Ve;if(!y.value)return;let ae="",re="";for(const Ee of g.value||[]){const ze=(ce=Ee.meta)==null?void 0:ce.setting_cache_component;if(!(ze===!0||ze===1||ze==="true"||ze==="1"))continue;if(!ae){const Bt=Fe((Ce=Ee.meta)==null?void 0:Ce.click_url),ps=Fe((Ve=Ee.meta)==null?void 0:Ve.click_title);Bt&&(ae=Bt,re=ps)}const dt=Ee.key;if(!String(w[dt]==null?"":w[dt]).trim()){const Bt=localStorage.getItem(De(dt));Bt!=null&&(w[dt]=Ee.key==="app_id"?Bt:String(Bt))}}ae&&(w.click_url=ae),re&&(w.click_title=re)}function Ue(){y.value&&g.value.forEach(ae=>{var Ee;const re=(Ee=ae.meta)==null?void 0:Ee.setting_cache_component;if(!(re===!0||re===1||re==="true"||re==="1"))return;const Ce=ae.key,Ve=String(w[Ce]==null?"":w[Ce]);localStorage.setItem(De(Ce),Ve)})}function ie(){return g.value.filter(ae=>{var Ce,Ve,Ee,ze;if((Ce=ae.meta)!=null&&Ce.tag_component&&!j.value)return!1;const re=(Ve=ae.meta)==null?void 0:Ve.setting_cache_component;return!(re===!0||re===1||re==="true"||re==="1"||(Ee=ae.meta)!=null&&Ee.plugin_config_component||(ze=ae.meta)!=null&&ze.advanced_settings)}).map(ae=>{var Ve,Ee,ze,Ge,dt,zt,Bt,ps,Ss,ks,Gt;let re=((Ve=ae.meta)==null?void 0:Ve.name)||ae.key,ce=String(w[ae.key]??"");const Ce=Array.isArray(w[ae.key+"_tags"])?w[ae.key+"_tags"]:[];if(ae.key==="app_id"&&(re=o("label_official_account_name"),ce=String(w.app_name??"")),(Ee=ae.meta)!=null&&Ee.select_remote_component&&ae.key==="sheetIdOrName"&&((ze=w==null?void 0:w.extras)!=null&&ze.table_name)&&(ce=String(w.extras.table_name)),(Ge=ae.meta)!=null&&Ge.enum_component||(dt=ae.meta)!=null&&dt.radio_component||(zt=ae.meta)!=null&&zt.switch_component){const xt=(((Bt=ae.meta)==null?void 0:Bt.enum)||[]).find(as=>String(as==null?void 0:as.value)===ce);xt&&xt.name&&(ce=String(xt.name))}if((ps=ae.meta)!=null&&ps.tag_component&&E[ae.key]==1){const xt=(R[ae.key]||[]).find(as=>String(as.id)===String(ce));xt&&xt.name&&(ce=String(xt.name))}if((Ss=ae.meta)!=null&&Ss.date_range_begin_component){const xt=(ks=ae.meta)==null?void 0:ks.begin_date_key,as=(Gt=ae.meta)==null?void 0:Gt.end_date_key,qs=String(w[xt]||""),me=String(w[as]||""),Be=Array.isArray(w[xt+"_tags"])?w[xt+"_tags"]:[],je=Array.isArray(w[as+"_tags"])?w[as+"_tags"]:[];ce=[qs,me].filter(Boolean).join(" ~ ");const Te=[...Be,...je];return{label:re,value:ce,key:ae.key,tags:Te}}return{label:re,value:ce,key:ae.key,tags:Ce}})}function ge(){const ae={};return g.value.forEach(re=>{var Ce,Ve,Ee,ze;if((Ce=re.meta)!=null&&Ce.plugin_config_component||(Ve=re.meta)!=null&&Ve.tag_component&&!j.value)return;const ce=Array.isArray(w[re.key+"_tags"])?w[re.key+"_tags"]:[];if(ce.length&&(ae[re.key]=ce),(Ee=re.meta)!=null&&Ee.date_range_begin_component){const Ge=(ze=re.meta)==null?void 0:ze.end_date_key,dt=Array.isArray(w[Ge+"_tags"])?w[Ge+"_tags"]:[];dt.length&&(ae[Ge]=dt)}}),ae}function ve(){const ae={};return g.value.forEach(re=>{var ce,Ce,Ve,Ee,ze,Ge;if(!((ce=re.meta)!=null&&ce.plugin_config_component)&&!((Ce=re.meta)!=null&&Ce.tag_component&&!j.value)&&(ae[re.key]=String(w[re.key]||""),(Ve=re.meta)!=null&&Ve.date_range_begin_component)){const dt=(Ee=re.meta)==null?void 0:Ee.end_date_key,zt=(ze=re.meta)==null?void 0:ze.date_type_key;ae[dt]=String(w[dt]||"");const Bt=N[(Ge=re.meta)==null?void 0:Ge.begin_date_key]||1;ae[zt]=String(Bt)}}),w.app_secret&&(ae.app_secret=String(w.app_secret||"")),w.app_name&&(ae.app_name=String(w.app_name||"")),w.extras&&(ae.extras=w.extras),ae}function he(){A.value=Fs(l.action.output),Q()}function Ae(){Object.keys(x).forEach(re=>{x[re]=""});const ae={ok:!0,errors:[]};return g.value.forEach(re=>{const ce=re.key,Ce=re.meta||{},Ve=w[ce],Ee=String(Ve??"").trim(),ze=Array.isArray(w[ce+"_tags"])?w[ce+"_tags"]:[];if(!Ce.plugin_config_component){if(Ce.select_official_component){if(Ce.required&&!Ee){const Ge=Ce.error||o("msg_select_official_account");x[ce]=Ge,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:Ge})}return}if(Ce.enum_component||Ce.radio_component||Ce.switch_component){const Ge=(Ce.enum||[]).map(dt=>String(dt.value));if(Ce.required&&!Ee){const dt=Ce.error||o("msg_please_select");x[ce]=dt,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:dt})}else if(Ee&&Ge.length&&!Ge.includes(Ee)){const dt=Ce.error||o("msg_invalid_selection");x[ce]=dt,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:dt})}return}if(Ce.date_range_begin_component){const Ge=Ce.begin_date_key,dt=Ce.end_date_key,zt=String(w[Ge]||"").trim(),Bt=String(w[dt]||"").trim(),ps=Array.isArray(w[Ge+"_tags"])?w[Ge+"_tags"]:[],Ss=Array.isArray(w[dt+"_tags"])?w[dt+"_tags"]:[];if(Ce.required&&(!zt&&ps.length===0||!Bt&&Ss.length===0)){const Gt=Ce.error||o("msg_select_date_range");x[ce]=Gt,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:Gt});return}if(N[Ge]===2){const Gt=xt=>/^\d{4}-\d{2}-\d{2}$/.test(xt)?is(xt).isValid():!1;if(zt&&ps.length===0&&!Gt(zt)){const xt=Ce.error||o("msg_start_date_format");x[ce]=xt,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:xt});return}if(Bt&&Ss.length===0&&!Gt(Bt)){const xt=Ce.error||o("msg_end_date_format");x[ce]=xt,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:xt});return}}if(zt&&Bt){const Gt=is(zt),xt=is(Bt);if(xt.isBefore(Gt)){const me=Ce.error||o("msg_end_after_start");x[ce]=me,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:me});return}const as=xt.diff(Gt,"day"),qs=Number(Ce.date_range_max_interval||0);if(qs>0&&as+1>qs){const me=Ce.error||o("msg_date_range_limit",{days:qs});x[ce]=me,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:me});return}}return}if(Ce.required&&!Ee&&(!Array.isArray(ze)||ze.length===0)){const Ge=Ce.error||o("msg_please_input_content");x[ce]=Ge,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:Ge})}else if(ce.toLowerCase().includes("url")&&Ee&&(!Array.isArray(ze)||ze.length===0)&&!(/^https?:\/\//.test(Ee)||Uo(Ee))){const dt=Ce.error||o("msg_correct_url");x[ce]=dt,ae.ok=!1,ae.errors.push({field_name:Ce.name||ce,message:dt})}}}),ae}function oe(ae,re,ce){E[ae]=re,re==1&&ue(ae,ce==null?void 0:ce.query_tag_service)}function ne(ae,re,ce){w[ae]=re,w[ae+"_name"]=(ce==null?void 0:ce.name)||"",Q()}function ue(ae,re){var Ve;const ce=JSON.parse(l.node.node_params),Ce=(Ve=ce==null?void 0:ce.plugin)==null?void 0:Ve.name;return!Ce||!re?(R[ae]=[],Promise.resolve([])):!w.app_id||!w.app_secret?(R[ae]=[],Promise.resolve([])):ss({name:Ce,action:"default/exec",params:JSON.stringify({business:re,arguments:{app_id:w.app_id,app_secret:w.app_secret}})}).then(Ee=>{var ze;return R[ae]=((ze=Ee==null?void 0:Ee.data)==null?void 0:ze.tags)||[],Ee})}function ke(ae,re){if(!w.app_id||!w.app_secret)return Me.warning(o("msg_select_official_account_first"));B[ae]||(B[ae]=!0,ue(ae,re==null?void 0:re.query_tag_service).then(()=>{Me.success(o("msg_sync_completed"))}).finally(()=>{B[ae]=!1}))}const Se=(ae,re)=>re.name.toLowerCase().indexOf(ae.toLowerCase())>=0;function Le(ae,re){N[ae.begin_date_key]=re;const ce=ae==null?void 0:ae.date_type_key;ce&&(w[ce]=String(re));const Ce=ae.begin_date_key,Ve=ae.end_date_key;re===1?(w[Ce]="",w[Ve]="",w[Ce+"_tags"]=[],w[Ve+"_tags"]=[],I[Ce]=null):re===2&&(w[Ce]="",w[Ve]="",I[Ce]=null),Q()}function Je(ae){const re=w[ae.begin_date_key],ce=w[ae.end_date_key];return[re?is(re):null,ce?is(ce):null]}function bt(ae,re){const ce=ae.begin_date_key;Array.isArray(re)&&re[0]?I[ce]=re[0]:I[ce]=null}function lt(ae,re,ce){w[ae.begin_date_key]=ce[0]||"",w[ae.end_date_key]=ce[1]||"",!ce[0]&&!ce[1]&&(I[ae.begin_date_key]=null),Q()}function kt(ae,re){if(!re)return!1;const ce=ae.end_date_max?is(ae.end_date_max):null;if(ce&&re.isAfter(ce,"day"))return!0;const Ce=I[ae.begin_date_key],Ve=Number(ae.date_range_max_interval||0);if(Ce&&Ve>0){const Ee=is(Ce).add(Ve-1,"day");return re.isAfter(Ee,"day")}return!1}function Ft(ae=!1){return Xa(u,ae).then(re=>{var Ee,ze;q.value=re||{};const ce=Object.keys(q.value),Ce=ce.find(Ge=>{var dt;return(dt=q.value[Ge])==null?void 0:dt.is_default});let Ve=null;try{const Ge=JSON.parse(l.node.node_params);Ve=((ze=(Ee=Ge==null?void 0:Ge.plugin)==null?void 0:Ee.params)==null?void 0:ze.config_name)||""}catch{}Ve&&ce.includes(Ve)?O.value=Ve:O.value=Ce||ce[0]||null})}function Rt(){const ae={[l.actionName||"default"]:l.action||{}};L.value&&L.value.show(q.value,u,ae)}function yt(){let ae=[];At(ae),Object.assign(w,ae),Q()}function Lt(){M.value=!M.value}function At(ae){var re;try{const ce=O.value||"",Ce=ce?((re=q.value)==null?void 0:re[ce])||{}:{};if(!Ce||Object.keys(Ce).length===0)return;g.value.forEach(Ve=>{const Ee=Ve.meta||{};if(!(Ee.plugin_config_component===!0||Ee.plugin_config_component===1||Ee.plugin_config_component==="true"||Ee.plugin_config_component==="1"))return;const Ge=Ve.key,dt=Ce[Ge];dt!=null&&(ae[Ge]=Fe(dt))})}catch{}}return(ae,re)=>{const ce=os,Ce=et,Ve=Ye,Ee=rt;return h(),D("div",AE,[k.value||S.value?(h(),D("div",OE,[c(ce)])):Z("",!0),y.value?(h(),D("div",NE,[s("div",BE,[s("div",null,[re[2]||(re[2]=s("img",{src:gl,class:"title-icon"},null,-1)),T(_(d(o)("title_settings")),1)]),p.value?(h(),D("div",EE,[s("a",{href:p.value,target:"_blank",rel:"noopener noreferrer"},_(m.value||p.value),9,IE)])):Z("",!0)]),c(dn,{items:K.value,formState:w,errors:x,apps:b.value,variableOptions:e.variableOptions,tagTypes:E,tagLists:R,showTagComponents:j.value,sortedEnum:$,appChange:P,onFieldChange:de,update:Q,onChangeDynamic:X,filterOption:Se,tagTypeChange:oe,tagChange:ne,syncFieldTags:ke,syncingTags:B,dateRangeTypes:N,dateRangeTypeChange:Le,getRangeValue:Je,onDateRangeCalendarChange:bt,onDateRangeChange:lt,getDisabledDateForRange:kt,onToggleAdvanced:Lt,onOpenVar:()=>a("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])])):Z("",!0),s("div",FE,[s("div",RE,[s("div",null,[re[3]||(re[3]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(o)("title_input")),1)]),V.value?(h(),D(ee,{key:0},[Object.keys(q.value).length?(h(),G(Ve,{key:0,value:O.value,"onUpdate:value":re[0]||(re[0]=ze=>O.value=ze),onChange:yt,style:{"min-width":"160px"}},{default:f(()=>[(h(!0),D(ee,null,se(q.value,(ze,Ge)=>(h(),G(Ce,{key:Ge,value:Ge},{default:f(()=>[T(_(ze.name||Ge),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(h(),G(Ee,{key:1,onClick:Rt},{default:f(()=>[T(_(d(o)("btn_unauthorized"))+" ",1),c(d(ds))]),_:1}))],64)):Z("",!0)]),c(dn,{items:H.value,formState:w,errors:x,apps:b.value,variableOptions:e.variableOptions,tagTypes:E,tagLists:R,showTagComponents:j.value,sortedEnum:$,appChange:P,onFieldChange:de,update:Q,onChangeDynamic:X,filterOption:Se,tagTypeChange:oe,tagChange:ne,syncFieldTags:ke,syncingTags:B,dateRangeTypes:N,dateRangeTypeChange:Le,getRangeValue:Je,onDateRangeCalendarChange:bt,onDateRangeChange:lt,getDisabledDateForRange:kt,onToggleAdvanced:Lt,onOpenVar:()=>a("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"]),z.value&&M.value?(h(),G(dn,{key:0,items:F.value,formState:w,errors:x,apps:b.value,variableOptions:e.variableOptions,tagTypes:E,tagLists:R,showTagComponents:j.value,sortedEnum:$,appChange:P,onFieldChange:de,update:Q,onChangeDynamic:X,filterOption:Se,tagTypeChange:oe,tagChange:ne,syncFieldTags:ke,syncingTags:B,dateRangeTypes:N,dateRangeTypeChange:Le,getRangeValue:Je,onDateRangeCalendarChange:bt,onDateRangeChange:lt,getDisabledDateForRange:kt,onToggleAdvanced:Lt,onOpenVar:()=>a("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])):Z("",!0)]),s("div",LE,[s("div",VE,[s("div",null,[re[4]||(re[4]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(o)("title_output")),1)])]),s("div",ME,[c(SB,{"tree-data":A.value},null,8,["tree-data"])])]),c(yf,{ref_key:"configModalRef",ref:L,onChange:re[1]||(re[1]=ze=>Ft(!0))},null,512)])}}},jE=_e(TE,[["__scopeId","data-v-684dd406"]]),PE=["src"],qE={class:"node-options"},HE={class:"options-item"},UE={class:"kv"},JE={class:"v"},zE={class:"kv"},KE={class:"v"},GE={key:0,class:"kv"},WE={class:"v"},ZE={key:1,class:"kv"},YE={class:"v"},QE={key:2,class:"kv"},XE={class:"v"},eI={class:"node-options"},tI={class:"options-item"},sI={__name:"http-tool-box",props:{node:{type:Object,default:()=>({})}},setup(e){be("setData");const n=e,o=U([]),a=U({method:"",url:"",query:"",headers:"",body:""}),l=ye(()=>`${a.value.method||""} ${a.value.url||""}`.trim());function i(){var y,p,m;const r=JSON.parse(n.node.node_params||"{}"),u=((p=(y=r==null?void 0:r.plugin)==null?void 0:y.params)==null?void 0:p.arguments)||{};a.value.method=u.method||"",a.value.url=u.url||"",a.value.query=u.query||"",a.value.headers=u.headers||"",a.value.body=u.body||"",o.value=((m=r==null?void 0:r.plugin)==null?void 0:m.output_obj)||[]}return Ne(()=>{i()}),(r,u)=>{const y=os;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,desc:l.value},{"node-icon":f(()=>{var p;return[(p=e.node.properties)!=null&&p.node_icon?(h(),D("img",{key:0,class:"node-icon",src:e.node.properties.node_icon},null,8,PE)):(h(),G(y,{key:1,size:"small"}))]}),_:1},8,["title","desc"])]),default:f(()=>[s("div",null,[s("div",qE,[u[5]||(u[5]=s("div",{class:"options-title"},[s("div",null,[s("img",{src:Jt,class:"title-icon"}),T("输入")])],-1)),s("div",HE,[s("div",UE,[u[0]||(u[0]=s("div",{class:"k"},"请求方法",-1)),s("div",JE,_(a.value.method),1)]),s("div",zE,[u[1]||(u[1]=s("div",{class:"k"},"请求地址",-1)),s("div",KE,_(a.value.url),1)]),a.value.query?(h(),D("div",GE,[u[2]||(u[2]=s("div",{class:"k"},"查询参数",-1)),s("div",WE,_(a.value.query),1)])):Z("",!0),a.value.headers?(h(),D("div",ZE,[u[3]||(u[3]=s("div",{class:"k"},"请求头",-1)),s("div",YE,_(a.value.headers),1)])):Z("",!0),a.value.body?(h(),D("div",QE,[u[4]||(u[4]=s("div",{class:"k"},"请求体",-1)),s("div",XE,_(a.value.body),1)])):Z("",!0)])]),s("div",eI,[u[6]||(u[6]=s("div",{class:"options-title"},[s("div",null,[s("img",{src:Zt,class:"title-icon"}),T("输出")])],-1)),s("div",tI,[c(Rs,{"tree-data":o.value},null,8,["tree-data"])])])])]),_:1})}}},oI=_e(sI,[["__scopeId","data-v-75477467"]]),nI={class:"qrcode-box"},aI={class:"title"},lI={class:"content"},iI={class:"tip"},rI={class:"desc"},dI={__name:"qrcode-box",setup(e,{expose:n}){const{t:o}=fe("components.common.qrcode-box"),a=U(!1);function l(){a.value=!0}return n({show:l}),(i,r)=>{const u=wt;return h(),G(u,{open:a.value,"onUpdate:open":r[0]||(r[0]=y=>a.value=y),footer:null,wrapClassName:"qrcode-wrap",width:"380px"},{default:f(()=>[s("div",nI,[s("div",aI,_(d(o)("title_scan_to_login")),1),s("div",lI,[s("div",iI,_(d(o)("msg_scan_with_wechat")),1),r[1]||(r[1]=s("img",{class:"qrcode",src:"https://xiaokefu.com.cn/static/home/img/zhima.jpg"},null,-1)),s("div",rI,_(d(o)("msg_qrcode_valid")),1)])])]),_:1},8,["open"])}}},uI=_e(dI,[["__scopeId","data-v-fdc58f28"]]),cI={class:"_main-box"},_I={key:0,class:"login-info-box"},pI={class:"tit"},fI={class:"desc"},vI={class:"official-info"},hI=["src"],mI={__name:"official-article-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(e,{emit:n}){const{t:o}=gn(),a=n,{loginInfo:l,loginStatus:i,loading:r,refresh:u,goLogin:y}=bf();qa();const p=U(null),m=U("admin");return Ne(()=>{p.value.setState({username:{value:m.value,tags:[]}})}),(v,C)=>{const g=rt;return h(),D("div",cI,[d(i)?Z("",!0):(h(),D("div",_I,[s("div",pI,_(d(o)("title_login")),1),c(g,{type:"primary",class:"link",onClick:d(y)},{default:f(()=>[T(_(d(o)("btn_login")),1)]),_:1},8,["onClick"]),s("div",fI,[T(_(d(o)("msg_logged_in"))+" ",1),c(g,{type:"link",onClick:d(u),loading:d(r)},{default:f(()=>[T(_(d(o)("btn_refresh")),1)]),_:1},8,["onClick","loading"])])])),c(tn,{ref_key:"formRef",ref:p,node:e.node,params:e.action.params,output:e.action.output,variableOptions:e.variableOptions,onUpdateVar:C[0]||(C[0]=$=>a("updateVar"))},Pa({username:f(({state:$,keyName:w,item:S})=>[]),_:2},[d(i)?{name:"input-title-extra",fn:f(()=>{var $,w;return[s("div",vI,[s("img",{class:"avatar",src:($=d(l))==null?void 0:$.headimgurl},null,8,hI),s("span",null,_((w=d(l))==null?void 0:w.nickname),1),c(d(wo),{class:"icon"})])]}),key:"0"}:void 0]),1032,["node","params","output","variableOptions"]),c(uI)])}}},gI=_e(mI,[["__scopeId","data-v-2aaaa6de"]]),yI=["src"],bI={key:2,class:"node-options"},kI={class:"options-title"},wI={class:"options-item-tit"},CI={class:"option-label"},$I={class:"option-type"},xI={class:"field-list-item"},SI={class:"field-label"},DI={class:"field-type"},AI={class:"desc"},OI={__name:"zm-plugins-node-form",props:{node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.zm-plugins-node-form"),o=be("getNode"),a=be("setData"),l=e,i={feishu_bitable:RA,official_account_profile:lO,official_batch_tag:D5,official_send_template_message:t5,official_send_message:y7,official_draft:yB,http_tool:oI,official_article:gI},r={"official_article:get_official_article":["url","number"]},u=we({}),y=U({}),p=U(null),m=U([]),v=U(!1),C=U({}),g=ye(()=>p.value?p.value.desc:y.value.description);let $={};async function w(){b(),$=JSON.parse(l.node.node_params),await S(),await k()}function S(){var R;return ll({name:(R=$==null?void 0:$.plugin)==null?void 0:R.name}).then(E=>{var N;let B=(E==null?void 0:E.data)||{};C.value=B.remote,v.value=((N=B==null?void 0:B.local)==null?void 0:N.multiNode)||!1})}function k(){var R;return ss({name:((R=$==null?void 0:$.plugin)==null?void 0:R.name)||"",action:"default/get-schema",params:{}}).then(E=>{var I,L,q;let B=(E==null?void 0:E.data)||{};y.value=C.value;const N=(I=$==null?void 0:$.plugin)==null?void 0:I.name;if(Bo(N)||v.value){const O=$.plugin.params.business;p.value=B[O];let M=r[`${N}:${O}`];Array.isArray(M)&&(p.value.params=kn(p.value.params,M))}else{Object.assign(u,B);for(let O in u)u[O].value=String(($==null?void 0:$.plugin.params[O])||""),u[O].tags=((q=(L=$==null?void 0:$.plugin)==null?void 0:L.tag_map)==null?void 0:q[O])||[]}})}function b(){m.value=o().getAllParentVariable()}function x(R,E,B){R.value=E,R.tags=B,A()}function A(){let R={params:{},tag_map:{}};for(let E in u){let B=u[E].value;u[E].type=="string"?B=String(B):["number","integer"].includes(u[E].type)&&(B=Number(B)),R.params[E]=B,R.tag_map[E]=u[E].tags}$.plugin.params=R.params,$.plugin.tag_map=R.tag_map,a({...l.node,node_params:JSON.stringify($)})}return Ne(()=>{w()}),(R,E)=>{const B=os;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,desc:g.value},{"node-icon":f(()=>[y.value.icon?(h(),D("img",{key:0,class:"node-icon",src:y.value.icon},null,8,yI)):(h(),G(B,{key:1,size:"small"}))]),_:1},8,["title","desc"])]),default:f(()=>{var N,I,L;return[(N=p.value)!=null&&N.common_template?(h(),G(jE,{key:0,node:e.node,action:p.value,actionName:d($).plugin.params.business,variableOptions:m.value,onUpdateVar:b},null,8,["node","action","actionName","variableOptions"])):d(Bo)((L=(I=d($))==null?void 0:I.plugin)==null?void 0:L.name)?(h(),D(ee,{key:1},[i[d($).plugin.name]?(h(),G(Go(i[d($).plugin.name]),{key:0,node:e.node,action:p.value,actionName:d($).plugin.params.business,variableOptions:m.value,onUpdateVar:b},null,40,["node","action","actionName","variableOptions"])):(h(),G(tn,{key:1,node:e.node,params:p.value.params,output:p.value.output,variableOptions:m.value,onUpdateVar:b},null,8,["node","params","output","variableOptions"]))],64)):(h(),D("div",bI,[s("div",kI,[s("div",null,[E[0]||(E[0]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(n)("label_input")),1)])]),(h(!0),D(ee,null,se(u,(q,O)=>(h(),D("div",{key:O,class:qe(["options-item",{"is-required":q.required}])},[s("div",wI,[s("div",CI,_(O),1),s("div",$I,_(q.type),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:m.value,defaultSelectedList:q.tags,defaultValue:q.value,ref_for:!0,ref:"atInputRef",onOpen:b,onChange:(M,j)=>x(q,M,j),placeholder:d(n)("ph_input_content")},{option:f(({label:M,payload:j})=>[s("div",xI,[s("div",SI,_(M),1),s("div",DI,_(j.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),s("div",AI,_(q.description),1)],2))),128))]))]}),_:1})}}},NI=_e(OI,[["__scopeId","data-v-177578b1"]]),BI={class:"variable-node"},EI={class:"node-form-content"},II={class:"gray-block multi-modal-box"},FI={class:"output-label"},RI={class:"output-label-text"},LI={class:"multi-modal-input"},VI={style:{color:"#8c8c8c"}},MI={class:"gray-block"},TI={class:"output-label"},jI={class:"output-label-text"},PI={class:"output-desc"},qI={class:"field-items"},HI={class:"field-name-box"},UI={class:"field-name"},JI={class:"field-value-box"},zI={__name:"session-trigger-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.session-trigger-form"),a=n,l=e,i=be("getNode"),r=be("getGraph"),u=U([]),y=U([]),p=we({question_multiple_switch:!1}),m=ye(()=>u.value.map(b=>b.variable)),v=b=>{S()};function C(){const b=i();if(b){let A=b.getGlobalVariable().diy_global||[];A.forEach(R=>{R.label=R.key,R.value="global."+R.key}),y.value=A||[]}}function g(b){b&&C()}const $=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...l.node})},10)},w=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},S=()=>{let b=JSON.parse(l.node.node_params);b.trigger.outputs=[...u.value],b.trigger.chat_config={...p};let x={...l.node,node_params:JSON.stringify(b)};a("update-node",x),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",x)},10)},k=()=>{C();try{let b=l.node.dataRaw||l.node.node_params||"{}";b=JSON.parse(b);const x=b.trigger||{outputs:[],chat_config:{question_multiple_switch:!1}};p.question_multiple_switch=x.chat_config.question_multiple_switch,u.value=x.outputs.map(A=>(A.tags=A.tags||[],A))}catch(b){}};return Ne(()=>{k()}),(b,x)=>{const A=Ms,R=ct,E=et,B=Ye;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,onChangeTitle:$,onDeleteNode:w,desc:d(o)("desc_session_trigger")},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",BI,[s("div",EI,[s("div",II,[s("div",FI,[x[1]||(x[1]=s("img",{src:Zt,alt:"",class:"output-label-icon"},null,-1)),s("span",RI,_(d(o)("label_multi_modal_input")),1),x[2]||(x[2]=T("    ",-1)),c(A,{checked:p.question_multiple_switch,"onUpdate:checked":x[0]||(x[0]=N=>p.question_multiple_switch=N),onChange:v},null,8,["checked"])]),s("div",LI,[s("div",VI,[T(_(d(o)("msg_multi_modal_desc"))+" ",1),c(R,{placement:"left"},{title:f(()=>[s("div",null,_(d(o)("tip_question_multiple")),1),s("pre",null,[s("code",null,`"question_multiple":[
  {
    "type":"text",
    "text":"`+_(d(o)("sample_text_content"))+`"
  },{
    "type":"image_url",
    "image_url":{
      "url":"`+_(d(o)("sample_image_url"))+`"
    }
  }
]
              `,1)])]),default:f(()=>[c(d(Re))]),_:1})])])]),s("div",MI,[s("div",TI,[x[3]||(x[3]=s("img",{src:Zt,alt:"",class:"output-label-icon"},null,-1)),s("span",jI,_(d(o)("label_output")),1),s("span",PI,_(d(o)("msg_output_auto_mapped")),1)]),s("div",qI,[(h(!0),D(ee,null,se(u.value,(N,I)=>(h(),D("div",{class:"field-item",key:I},[s("div",HI,[s("span",UI,_(N.key),1),c(R,null,{title:f(()=>[T(_(N.desc),1)]),default:f(()=>[c(d(Re))]),_:2},1024)]),s("div",JI,[c(B,{style:{width:"200px"},placeholder:d(o)("ph_select_variable"),value:N.variable,"onUpdate:value":L=>N.variable=L,allowClear:"",onDropdownVisibleChange:g,onChange:S},{default:f(()=>[(h(!0),D(ee,null,se(y.value,L=>(h(),G(E,{disabled:m.value.includes(L.value),value:L.value,key:L.key},{default:f(()=>[s("span",null,_(L.label),1)]),_:2},1032,["disabled","value"]))),128))]),_:1},8,["placeholder","value","onUpdate:value"])])]))),128))])])])])]),_:1})}}},KI=_e(zI,[["__scopeId","data-v-274b3442"]]),GI="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23hp676wcw9__clip0_12661_41280)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'%3e%3cpath%20d='M7.99993%2014.7779C11.375%2014.7779%2014.1111%2012.0418%2014.1111%208.66678C14.1111%205.29171%2011.375%202.55566%207.99993%202.55566C4.62487%202.55566%201.88883%205.29171%201.88883%208.66678C1.88883%2012.0418%204.62487%2014.7779%207.99993%2014.7779Z'/%3e%3cpath%20d='M7.9198%205.11768L7.9194%208.78728L10.5102%2011.378'%20stroke-linecap='round'/%3e%3cpath%20d='M1.33334%203.00016L3.66667%201.3335'%20stroke-linecap='round'/%3e%3cpath%20d='M14.6667%203.00016L12.3333%201.3335'%20stroke-linecap='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='hp676wcw9__clip0_12661_41280'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",WI={class:"variable-node"},ZI={class:"node-form-content"},YI={class:"gray-block"},QI={class:"output-label"},XI={class:"output-label-text"},eF={class:"form-item"},tF={key:0,class:"form-item"},sF={key:1,class:"form-item custom-textarea"},oF={__name:"timing-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.timing-trigger-node.timing-trigger-node-form"),a=n,l=e;function i(){let g=[];for(let $=0;$<31;$++)g.push({label:$+1+o("label_day"),value:$+1+""});return g}const r=ye(()=>[{value:"day",label:o("label_every_day")},{value:"week",label:o("label_every_week"),children:[{value:"0",label:o("label_sunday")},{value:"1",label:o("label_monday")},{value:"2",label:o("label_tuesday")},{value:"3",label:o("label_wednesday")},{value:"4",label:o("label_thursday")},{value:"5",label:o("label_friday")},{value:"6",label:o("label_saturday")}]},{value:"month",label:o("label_every_month"),children:i()}]),u=we({type:"select_time",time_value:[],every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""});Ie(()=>u,()=>{v()},{deep:!0}),be("getNode");const y=be("getGraph"),p=()=>{setTimeout(()=>{y().eventCenter.emit("custom:trigger-change",{...l.node})},10)},m=()=>{setTimeout(()=>{y().eventCenter.emit("custom:trigger-change",null)},10)},v=()=>{let g=JSON.parse(l.node.node_params),$="",w="",S="";u.time_value&&u.time_value.length&&($=u.time_value[0],u.time_value[0]=="week"&&(w=u.time_value[1]),u.time_value[0]=="month"&&(S=u.time_value[1])),g.trigger.cron_config={...u,every_type:$,week_number:w,month_day:S};let k={...l.node,node_params:JSON.stringify(g)};a("update-node",k),setTimeout(()=>{y().eventCenter.emit("custom:trigger-change",k)},10)},C=()=>{try{let g=l.node.dataRaw||l.node.node_params||"{}";g=JSON.parse(g);let $=g.trigger.cron_config;u.type=$.type,u.linux_crontab=$.linux_crontab,u.every_type=$.every_type,u.week_number=$.week_number,u.month_day=$.month_day,u.hour_minute=$.hour_minute;let w=$.every_type;w=="day"&&(u.time_value=["day"]),w=="week"&&(u.time_value=["week",$.week_number]),w=="month"&&(u.time_value=["month",$.month_day])}catch(g){}};return Ne(()=>{C()}),(g,$)=>{const w=Qt,S=Yt,k=xs,b=mi,x=_s,A=Ts;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,onChangeTitle:p,onDeleteNode:m,desc:d(o)("desc_timing_trigger")},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",WI,[s("div",ZI,[s("div",YI,[s("div",QI,[$[4]||($[4]=s("img",{src:GI,alt:"",class:"output-label-icon"},null,-1)),s("span",XI,_(d(o)("label_trigger_time")),1)]),s("div",eF,[c(S,{value:u.type,"onUpdate:value":$[0]||($[0]=R=>u.type=R)},{default:f(()=>[c(w,{value:"select_time"},{default:f(()=>[T(_(d(o)("label_select_time")),1)]),_:1}),c(w,{value:"linux_crontab"},{default:f(()=>[T(_(d(o)("label_linux_crontab")),1)]),_:1})]),_:1},8,["value"])]),u.type==="select_time"?(h(),D("div",tF,[c(x,{gap:8},{default:f(()=>[c(k,{value:u.time_value,"onUpdate:value":$[1]||($[1]=R=>u.time_value=R),options:r.value,placeholder:d(o)("ph_select"),style:{width:"194px"}},null,8,["value","options","placeholder"]),c(b,{allowClear:!1,value:u.hour_minute,"onUpdate:value":$[2]||($[2]=R=>u.hour_minute=R),valueFormat:"HH:mm",format:"HH:mm",style:{width:"124px"}},null,8,["value"])]),_:1})])):(h(),D("div",sF,[c(A,{value:u.linux_crontab,"onUpdate:value":$[3]||($[3]=R=>u.linux_crontab=R),placeholder:d(o)("ph_input_code"),style:{"min-height":"142px",background:"#262626",color:"#bfbfbf"}},null,8,["value","placeholder"])]))])])])]),_:1})}}},nF=_e(oF,[["__scopeId","data-v-35d220cc"]]),aF="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1763712774665'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='300'%20height='300'%3e%3cpath%20d='M692.352%20335.04c11.712%200.128%2023.36%200.96%2034.944%202.432-31.232-156.8-186.88-273.152-365.184-273.152C163.008%2064.32%200%20210.048%200%20394.88c0%20106.944%2054.336%20194.688%20144.768%20262.784l-36.096%20117.12%20126.592-68.224c41.536%2011.2%2084.032%2017.728%20126.848%2019.584h33.856a312%20312%200%200%201-11.136-81.6%20306.88%20306.88%200%200%201%20307.84-308.032l-0.32-1.536z%20m-194.56-105.408a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312c-27.328%202.176-51.328-19.328-54.4-48.64%202.88-29.312%2027.008-50.816%2054.4-48.512z%20m-253.44%2097.152c-27.456%202.304-51.648-19.2-54.656-48.64%203.008-29.312%2027.2-50.88%2054.656-48.512a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312z'%20fill='currentColor'%20p-id='1850'%3e%3c/path%3e%3cpath%20d='M1024%20638.464c0-155.52-145.92-283.52-308.608-283.52-172.416%200-308.096%20126.784-308.096%20282.304%200%20155.52%20135.68%20282.368%20308.096%20282.368a426.176%20426.176%200%200%200%20109.44-18.304L924.16%20960l-28.416-97.216C968.832%20803.84%201024%20726.208%201024%20638.464z%20m-408.448-48.832c-19.968%200-36.16-17.408-36.16-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.56%2042.56%2014.72%2045.184%2038.784-2.624%2024.064-22.784%2041.344-45.184%2038.848z%20m199.04%200c-19.84%200-36.096-17.408-36.096-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.368%2042.432%2014.848%2045.248%2038.784-2.688%2024.064-22.848%2041.344-45.248%2038.848z'%20fill='currentColor'%20p-id='1851'%3e%3c/path%3e%3c/svg%3e",lF={class:"variable-node"},iF={class:"node-form-content"},rF={class:"gray-block"},dF={class:"output-label"},uF={class:"output-label-text"},cF={class:"app-item-list"},_F=["onClick"],pF={class:"form-item"},fF={class:"form-item-label"},vF={class:"form-item-content"},hF={class:"gray-block"},mF={class:"output-label"},gF={class:"output-label-text"},yF={class:"ml8",href:"https://developers.weixin.qq.com/doc/subscription/guide/product/message/Receiving_standard_messages.html",target:"_blank"},bF={class:"field-items"},kF={class:"field-name-box"},wF={class:"field-name"},CF={class:"field-value-box"},$F={__name:"official-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const o=Co(),{t:a}=fe("views.workflow.components.node-form-drawer.official-trigger-node.official-trigger-node-form"),l=ye(()=>o.officialList),i=ye(()=>o.triggerOfficialList),r=n,u=e,y=be("getNode"),p=be("getGraph"),m=U([{label:a("label_private_message"),value:"message"},{label:a("label_subscribe_unsubscribe"),value:"subscribe_unsubscribe"},{label:a("label_qrcode_scan"),value:"qrcode_scan"},{label:a("label_menu_click"),value:"menu_click"}]),v=we({msg_type:"",app_ids:[]}),C=ye(()=>v.app_ids.map(I=>l.value.find(L=>L.app_id==I)).filter(Boolean)),g=U([]),$=U([]);ye(()=>g.value.map(I=>I.variable));function w(){const I=y();if(I){let q=I.getGlobalVariable().diy_global||[];q.forEach(O=>{O.label=O.key,O.value="global."+O.key}),$.value=q||[]}}function S(I){I&&w()}const k=()=>{setTimeout(()=>{p().eventCenter.emit("custom:trigger-change",{...u.node})},10)},b=()=>{setTimeout(()=>{p().eventCenter.emit("custom:trigger-change",null)},10)},x=()=>{let I=JSON.parse(u.node.node_params);I.trigger.outputs=[...g.value],I.trigger.trigger_official_config={msg_type:v.msg_type,app_ids:v.app_ids.join(",")};let L={...u.node,node_params:JSON.stringify(I)};r("update-node",L),setTimeout(()=>{p().eventCenter.emit("custom:trigger-change",L)},10)},A=()=>{w();try{let I=u.node.dataRaw||u.node.node_params||"{}";I=JSON.parse(I);const L=I.trigger||{outputs:[]};let q=L.trigger_official_config;v.msg_type=q.msg_type,v.app_ids=q.app_ids?q.app_ids.split(","):[];let O=L.outputs;O||(O=i.value.find(M=>M.msg_type==q.msg_type).fields),g.value=O.map(M=>(M.tags=M.tags||[],M))}catch(I){}},R=()=>{E.value.open({},JSON.parse(JSON.stringify(v.app_ids)))},E=U(null),B=I=>{v.app_ids=I||[],E.value.close(),x()},N=I=>{v.app_ids=v.app_ids.filter(L=>L!=I.app_id),x()};return Ne(()=>{A()}),(I,L)=>{const q=rt,O=Ye,M=ct,j=et;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,onChangeTitle:k,onDeleteNode:b,desc:d(a)("desc_official_trigger")},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",lF,[s("div",iF,[s("div",rF,[s("div",dF,[L[1]||(L[1]=s("img",{src:aF,alt:"",class:"output-label-icon"},null,-1)),s("span",uF,_(d(a)("label_official_account")),1)]),s("div",null,[c(q,{onClick:R,type:"dashed"},{default:f(()=>[c(d(Xe)),T(_(d(a)("btn_add_official")),1)]),_:1}),s("div",cF,[(h(!0),D(ee,null,se(C.value,V=>(h(),D("div",{class:"app-item",key:V.app_id},[T(_(V.app_name)+" ",1),s("span",{onClick:z=>N(V),class:"close-icon"},[c(d(Zo))],8,_F)]))),128))])]),s("div",pF,[s("div",fF,_(d(a)("label_trigger_event")),1),s("div",vF,[c(O,{options:m.value,value:v.msg_type,"onUpdate:value":L[0]||(L[0]=V=>v.msg_type=V),style:{width:"100%"},showArrow:!1,disabled:""},null,8,["options","value"])])])]),s("div",hF,[s("div",mF,[L[2]||(L[2]=s("img",{src:en,alt:"",class:"output-label-icon"},null,-1)),s("span",gF,_(d(a)("label_output")),1),s("a",yF,_(d(a)("btn_view_document")),1)]),s("div",bF,[(h(!0),D(ee,null,se(g.value,(V,z)=>(h(),D("div",{class:"field-item",key:z},[s("div",kF,[s("span",wF,_(V.key),1),c(M,null,{title:f(()=>[T(_(V.desc),1)]),default:f(()=>[c(d(Re))]),_:2},1024)]),s("div",CF,[c(O,{style:{width:"200px"},placeholder:d(a)("ph_select_variable"),value:V.variable,"onUpdate:value":H=>V.variable=H,allowClear:"",onDropdownVisibleChange:S,onChange:x},{default:f(()=>[(h(!0),D(ee,null,se($.value,H=>(h(),G(j,{value:H.value,key:H.key},{default:f(()=>[s("span",null,_(H.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onUpdate:value"])])]))),128))])])]),c(Cf,{ref_key:"wxAppRef",ref:E,title:d(a)("btn_add_official"),onOk:B},null,8,["title"])])]),_:1})}}},xF=_e($F,[["__scopeId","data-v-72fbc4b3"]]),SF="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%234f9846fr4__clip0_12833_126304)'%20stroke='%23262626'%20stroke-width='1.33333'%3e%3cpath%20d='M4%203.30905V2.33337C4%201.78109%204.4477%201.33337%205%201.33337H13.6667C14.219%201.33337%2014.6667%201.78109%2014.6667%202.33337V11C14.6667%2011.5523%2014.219%2012%2013.6667%2012H12.6725'/%3e%3cpath%20d='M11.6667%203.33337H2.33337C1.78109%203.33337%201.33337%203.78109%201.33337%204.33337V13.6667C1.33337%2014.219%201.78109%2014.6667%202.33337%2014.6667H11.6667C12.219%2014.6667%2012.6667%2014.219%2012.6667%2013.6667V4.33337C12.6667%203.78109%2012.219%203.33337%2011.6667%203.33337Z'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%209L10%209'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%206L10%209L7%2012'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='4f9846fr4__clip0_12833_126304'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",DF="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M8%201.66663H2V12.3333H8V1.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%203.66663H8V14.3333H14V3.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4.33337%205.66663L5.66671%206.92979L4.44447%208.33329'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.3334%207.66663L11.6667%208.92979L10.4445%2010.3333'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",AF={class:"modal-title-block"},OF={key:0,class:"run-detail"},NF={class:"flex-content-box"},BF={class:"test-model-box"},EF={class:"top-title"},IF={key:2,class:"input-list-box"},FF={class:"add-btn-box"},RF={key:0,class:"result-list-box loading-box"},LF={key:1,class:"result-list-box"},VF=["onClick"],MF={class:"status-block"},TF={class:"icon-name-box"},jF=["src"],PF={class:"node-name"},qF={key:0,class:"time-tag"},HF={class:"right-active-icon"},UF={class:"save-btn-box"},JF={class:"preview-box"},zF={class:"preview-title"},KF={class:"title-text"},GF={class:"icon-name-box"},WF=["src"],ZF={class:"node-name"},YF={key:0,class:"time-tag"},QF={class:"preview-content-block"},XF={class:"title-block"},eR={class:"preview-code-box"},tR={class:"preview-content-block"},sR={class:"title-block"},oR={class:"preview-code-box"},nR={class:"preview-content-block"},aR={class:"title-block"},lR={class:"preview-code-box"},iR={__name:"run-test",props:{batch_node_key:{type:String,default:""}},emits:["save"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.nodes.batch-group-node.components.run-test"),l=Pt(),i=ye(()=>l.robotInfo.isLockedByOther),r=e;ye(()=>[]);const u=U(!1),y=U(""),p=U([]),m=ye(()=>y.value?p.value.filter(j=>j.node_key==y.value)[0]:null),v=U(!1),C=we({is_draft:!0,robot_key:l.robotInfo.robot_key,question:"",openid:""}),g=async()=>{if(i.value){Me.warning(a("msg_locked_by_other_cannot_test"));return}l.robotInfo.loop_save_canvas_status++,await Ze();let j=localStorage.getItem("workflow_batch_run_test_data")||"{}";j=JSON.parse(j),C.question=j.question||"",C.openid=j.openid||"",C.global=j.global||"",p.value=[],y.value="",setTimeout(()=>{k()},1e3),u.value=!0},$=U([]),w=U(!1),S=U(!1),k=()=>{Xl({robot_key:C.robot_key,batch_node_key:r.batch_node_key}).then(j=>{w.value=j.data.is_need_question,S.value=j.data.is_need_openid,w.value||(C.question=""),$.value=j.data.loop_test_params.map(V=>({...V,field:{...V.field,Vals:b(V.field)}}))})};function b(j){return j.typ=="string"||j.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const x=(j,V)=>{j.splice(V,1)},A=j=>{j.push({value:"",key:Math.random()*1e4})},R=U(null),E=U(0),B=U(0),N=()=>{R.value.validate().then(()=>{let j={...C,batch_node_key:r.batch_node_key},V=JSON.parse(JSON.stringify($.value));V.forEach(z=>{z.field.typ.includes("array")&&(z.field.Vals=z.field.Vals.map(H=>H.value))}),j.batch_test_params=JSON.stringify(V),v.value=!0,p.value=[],localStorage.setItem("workflow_batch_run_test_data",JSON.stringify({...j})),Ql({...j}).then(z=>{Me.success(a("msg_test_result_generated"));let H=z.data.node_logs||[];E.value=z.data.use_token,B.value=z.data.use_mills,I(H)}).catch(z=>{p.value=[];let H=z.data.node_logs||[];H&&H.length&&I(H)}).finally(()=>{v.value=!1})})},I=j=>{var V;p.value=j.map(z=>({...z,is_success:z.error_msg==="<nil>",node_icon:Eo(z.node_type)})),y.value=(V=p.value[0])==null?void 0:V.node_key},L=j=>{y.value=j.node_key},q=j=>{bo(JSON.stringify(m.value[j])),Me.success(a("msg_copy_success"))};function O(j){return j.field.key.replace(j.node_key+".","")}return n({open:()=>{g()}}),(j,V)=>{const z=Is,H=_s,K=pt,F=Dt,Y=Vt,le=Tt,J=rt,P=St,W=os,Q=wt;return h(),D("div",null,[c(Q,{open:u.value,"onUpdate:open":V[5]||(V[5]=X=>u.value=X),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:f(()=>[s("div",AF,[T(_(d(a)("btn_run_test"))+" ",1),p.value.length?(h(),D("div",OF,[s("span",null,_(d(a)("label_total_time"))+"："+_(d(An)(B.value)),1),s("span",null,_(d(a)("label_token_usage"))+"："+_(E.value)+" "+_(d(a)("label_tokens")),1)])):Z("",!0)])]),default:f(()=>[s("div",NF,[s("div",BF,[s("div",EF,_(d(a)("title_start_node_params")),1),c(P,{model:C,ref_key:"formRef",ref:R,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:f(()=>[w.value?(h(),G(F,{key:0,name:"question",rules:[{required:!0,message:d(a)("msg_input_question")}]},{label:f(()=>[c(H,{gap:4},{default:f(()=>[T(_(d(a)("label_question"))+" ",1),c(z,{style:{margin:"0"}},{default:f(()=>[T(_(d(a)("label_string")),1)]),_:1})]),_:1})]),default:f(()=>[c(K,{placeholder:d(a)("ph_input"),value:C.question,"onUpdate:value":V[0]||(V[0]=X=>C.question=X)},null,8,["placeholder","value"])]),_:1},8,["rules"])):Z("",!0),S.value?(h(),G(F,{key:1,name:"openid",rules:[{required:!0,message:d(a)("msg_input_openid")}]},{label:f(()=>[c(H,{gap:4},{default:f(()=>[T(_(d(a)("label_openid"))+" ",1),c(z,{style:{margin:"0"}},{default:f(()=>[T(_(d(a)("label_string")),1)]),_:1})]),_:1})]),default:f(()=>[c(K,{placeholder:d(a)("ph_input"),value:C.openid,"onUpdate:value":V[1]||(V[1]=X=>C.openid=X)},null,8,["placeholder","value"])]),_:1},8,["rules"])):Z("",!0),(h(!0),D(ee,null,se($.value,X=>(h(),G(F,{key:X.node_key,rules:[{required:X.field.required,message:`${d(a)("ph_input")}${X.node_name}`}]},{label:f(()=>[c(H,{gap:4},{default:f(()=>[T(_(X.node_name)+" "+_(O(X)),1),c(z,{style:{margin:"0"}},{default:f(()=>[T(_(X.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:f(()=>[X.field.typ=="string"?(h(),G(K,{key:0,placeholder:d(a)("ph_input"),value:X.field.Vals,"onUpdate:value":de=>X.field.Vals=de},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),X.field.typ=="number"?(h(),G(Y,{key:1,style:{width:"100%"},placeholder:d(a)("ph_input"),value:X.field.Vals,"onUpdate:value":de=>X.field.Vals=de},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),X.field.typ.includes("array")?(h(),D("div",IF,[(h(!0),D(ee,null,se(X.field.Vals,(de,Fe)=>(h(),D("div",{class:"input-list-item",key:Fe},[c(le,null,{default:f(()=>[c(K,{placeholder:d(a)("ph_input"),value:de.value,"onUpdate:value":De=>de.value=De},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),X.field.Vals.length>1?(h(),G(d(at),{key:0,onClick:De=>x(X.field.Vals,Fe)},null,8,["onClick"])):Z("",!0)]))),128)),s("div",FF,[c(J,{onClick:de=>A(X.field.Vals),block:"",type:"dashed"},{default:f(()=>[T(_(d(a)("btn_add")),1)]),_:1},8,["onClick"])])])):Z("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),v.value?(h(),D("div",RF,[v.value?(h(),G(W,{key:0,tip:d(a)("msg_generating_test_result")},null,8,["tip"])):Z("",!0)])):Z("",!0),p.value.length>0?(h(),D("div",LF,[(h(!0),D(ee,null,se(p.value,(X,de)=>(h(),D("div",{class:qe(["list-item-block",{active:y.value==X.node_key}]),onClick:Fe=>L(X),key:de},[s("div",MF,[X.is_success?(h(),G(d(wo),{key:0,style:{color:"#138b1b"}})):(h(),G(d(Zo),{key:1,style:{color:"#d81e06"}}))]),s("div",TF,[s("img",{src:X.node_icon,alt:""},null,8,jF),s("div",PF,_(X.node_name),1)]),X.is_success?(h(),D("div",qF,_(X.use_time)+"ms",1)):Z("",!0),s("div",HF,[c(d(Wo))])],10,VF))),128))])):Z("",!0),s("div",UF,[c(J,{loading:v.value,onClick:N,style:{"background-color":"#00ad3a"},type:"primary"},{default:f(()=>[c(d(bs)),T(_(d(a)("btn_run_test")),1)]),_:1},8,["loading"])])]),s("div",JF,[m.value?(h(),D(ee,{key:0},[s("div",zF,[s("div",KF,_(d(a)("title_log_details")),1),s("div",GF,[s("img",{src:m.value.node_icon,alt:""},null,8,WF),s("div",ZF,_(m.value.node_name),1)]),m.value.is_success?(h(),D("div",YF,_(m.value.use_time)+"ms",1)):Z("",!0)]),s("div",QF,[s("div",XF,[T(_(d(a)("label_input")),1),c(d(ms),{onClick:V[2]||(V[2]=X=>q("input"))})]),s("div",eR,[c(d(hs),{data:m.value.input},null,8,["data"])])]),s("div",tR,[s("div",sR,[T(_(d(a)("label_output")),1),c(d(ms),{onClick:V[3]||(V[3]=X=>q("node_output"))})]),s("div",oR,[c(d(hs),{data:m.value.node_output},null,8,["data"])])]),s("div",nR,[s("div",aR,[T(_(d(a)("label_run_log")),1),c(d(ms),{onClick:V[4]||(V[4]=X=>q("output"))})]),s("div",lR,[c(d(hs),{data:m.value.output},null,8,["data"])])])],64)):Z("",!0)])])]),_:1},8,["open"])])}}},Cl=_e(iR,[["__scopeId","data-v-8c14a688"]]),rR={class:"problem-optimization-form"},dR={class:"node-form-content"},uR={class:"gray-block"},cR={class:"gray-block-title"},_R={class:"row-form-item"},pR={class:"form-label"},fR={class:"row-form-item"},vR={class:"form-label"},hR={class:"gray-block"},mR={class:"gray-block-title"},gR={class:"output-box"},yR={class:"output-block"},bR={class:"output-item",style:{width:"25%"}},kR={class:"output-item",style:{width:"30%"}},wR={class:"output-item",style:{width:"45%"}},CR={class:"array-form-box"},$R={class:"flex-block-item",style:{gap:"12px"}},xR={class:"gray-block"},SR={class:"gray-block-title"},DR={class:"output-box"},AR={class:"output-block"},OR={class:"output-item",style:{width:"23%"}},NR={class:"output-item",style:{width:"27%"}},BR={class:"output-item",style:{width:"45%"}},ER={class:"array-form-box"},IR={class:"flex-block-item",style:{gap:"12px"}},FR=["onClick"],RR={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.batch-group-form.index"),a=n,l=e,i=be("getNode"),r=U([]),u=U([]),y=U(null);function p(O){return O.forEach(M=>{M.typ=="node"?M.node_type==1?M.value="global":M.value=M.node_id:M.value=M.key,M.children&&M.children.length>0&&(M.children=p(M.children))}),O}function m(){let O=i().getAllParentVariable();O=p(O),O=O.filter(M=>M.group_node_key!=M.loop_parent_key).filter(M=>M.node_id!=M.group_node_key),r.value=v(O)}function v(O){const M=j=>!j||j.length===0?[]:j.map(V=>{const z=M(V.children);return V.typ.includes("array")||z&&z.length>0?{...V,children:z}:null}).filter(Boolean);return M(O)}const C=()=>{let O=i().getAllParentVariable();O.forEach(M=>{M.tags=M.tags||[]}),O=O.filter(M=>M.group_node_key==M.loop_parent_key),u.value=p(O)},g=O=>{O||C()},$=U(),w={key:"",typ:"",value:"",_id:fo(16)},S={key:"",typ:"",value:"",_id:fo(16)},k=we({chan_number:10,max_run_number:500,batch_arrays:[],output:[]});function b(O){if(O){let M=O.split("."),j=M[0],V=M.filter((z,H)=>H>0).join(".");return[j,V]}return[]}const x=O=>{O&&m()},A=(O,M,j)=>{j?M.typ=j[j.length-1].typ:M.typ=""},R=()=>{k.output.push({key:"",typ:"",value:"",_id:fo(16)})},E=O=>{k.output.splice(O,1)},B=(O,M)=>{if(O&&O.length){let j=u.value.filter(V=>V.value==O[0])[0].children;if(j&&j.length){let V=j.filter(z=>z.value==O[1])[0].typ;M.typ=M.typ=V.startsWith("array")?V:`array<${V}>`}}else M.typ=""},N=()=>{a("close")},I=()=>{var M;let O=k.batch_arrays[0];O&&O.key&&O.typ&&O.value?(M=y.value)==null||M.open():Me.error(o("msg_fill_execution_array"))},L=()=>{try{let O=l.node.dataRaw||l.node.node_params||"{}",M=JSON.parse(O).batch||{};m(),C(),k.chan_number=M.chan_number,k.max_run_number=M.max_run_number,k.batch_arrays=M.batch_arrays.map(j=>({...j,value:b(j.value)})),k.output=M.output.map(j=>({...j,value:b(j.value)})),k.batch_arrays.length==0&&(k.batch_arrays=[w]),k.output.length==0&&(k.output=[S])}catch(O){}},q=()=>{const O=JSON.stringify({batch:{...k,batch_arrays:k.batch_arrays.map(M=>({...M,value:M.value?M.value.join("."):""})),chan_number:k.chan_number,max_run_number:k.max_run_number,output:k.output.map(M=>{let j=M.value?M.value.join("."):"";return{...M,value:j}})}});a("update-node",{...l.node,node_params:O})};return Ie(()=>k,()=>{q()},{deep:!0}),Ne(()=>{L()}),(O,M)=>{const j=ct,V=Vt,z=pt,H=xs,K=Tt,F=Dt,Y=rt,le=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_batch_group"),onClose:N},{runBtn:f(()=>[c(j,null,{title:f(()=>[T(_(d(o)("btn_run_test")),1)]),default:f(()=>[s("div",{class:"action-btn",onClick:I},[c(d(bs),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName","desc"])]),default:f(()=>[s("div",rR,[s("div",dR,[c(le,{ref_key:"formRef",ref:$,layout:"vertical",model:k},{default:f(()=>[s("div",uR,[s("div",cR,[M[2]||(M[2]=s("img",{src:SF,alt:""},null,-1)),s("span",null,_(d(o)("title_execution_settings")),1)]),s("div",_R,[s("div",pR,[s("span",null,_(d(o)("label_parallel_count")),1),c(j,null,{title:f(()=>[T(_(d(o)("tip_parallel_count")),1)]),default:f(()=>[c(d(Re),{class:"tip-icon"})]),_:1})]),s("div",null,[c(V,{style:{width:"300px"},max:10,min:1,precision:0,step:1,placeholder:d(o)("ph_input_value"),value:k.chan_number,"onUpdate:value":M[0]||(M[0]=J=>k.chan_number=J)},null,8,["placeholder","value"])])]),s("div",fR,[s("div",vR,[s("span",null,_(d(o)("label_max_execution_count")),1),c(j,null,{title:f(()=>[T(_(d(o)("tip_max_execution_count")),1)]),default:f(()=>[c(d(Re),{class:"tip-icon"})]),_:1})]),s("div",null,[c(V,{style:{width:"300px"},max:500,min:1,precision:0,step:1,placeholder:d(o)("ph_input_value"),value:k.max_run_number,"onUpdate:value":M[1]||(M[1]=J=>k.max_run_number=J)},null,8,["placeholder","value"])])])]),s("div",hR,[s("div",mR,[M[3]||(M[3]=s("img",{src:DF,alt:""},null,-1)),T(" "+_(d(o)("title_execution_array"))+" ",1),c(j,null,{title:f(()=>[T(_(d(o)("tip_execution_array")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",gR,[s("div",yR,[s("div",bR,_(d(o)("label_param_key")),1),s("div",kR,_(d(o)("label_type")),1),s("div",wR,_(d(o)("label_param_value")),1)]),s("div",CR,[(h(!0),D(ee,null,se(k.batch_arrays,(J,P)=>(h(),D("div",{class:"form-item-list",key:J._id},[c(F,{label:null},{default:f(()=>[s("div",$R,[c(z,{style:{width:"25%"},value:J.key,"onUpdate:value":W=>J.key=W,placeholder:d(o)("ph_input_value")},null,8,["value","onUpdate:value","placeholder"]),c(K,null,{default:f(()=>[c(z,{style:{width:"30%"},value:J.typ,"onUpdate:value":W=>J.typ=W,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),c(H,{onChange:(W,Q)=>A(W,J,Q),value:J.value,"onUpdate:value":W=>J.value=W,onDropdownVisibleChange:x,style:{width:"45%"},options:r.value,allowClear:!1,displayRender:({labels:W})=>W.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select_value")},null,8,["onChange","value","onUpdate:value","options","displayRender","placeholder"])]),_:2},1024)])]),_:2},1024)]))),128))])])]),s("div",xR,[s("div",SR,[M[4]||(M[4]=s("img",{src:en,alt:""},null,-1)),T(" "+_(d(o)("title_output"))+" ",1),c(j,null,{title:f(()=>[T(_(d(o)("tip_output")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",DR,[s("div",AR,[s("div",OR,_(d(o)("label_param_key")),1),s("div",NR,_(d(o)("label_type")),1),s("div",BR,_(d(o)("label_param_value")),1)]),s("div",ER,[(h(!0),D(ee,null,se(k.output,(J,P)=>(h(),D("div",{class:"form-item-list",key:J._id},[c(F,{label:null},{default:f(()=>[s("div",IR,[c(z,{style:{width:"25%"},value:J.key,"onUpdate:value":W=>J.key=W,placeholder:d(o)("ph_input_value")},null,8,["value","onUpdate:value","placeholder"]),c(K,null,{default:f(()=>[c(z,{style:{width:"30%"},value:J.typ,"onUpdate:value":W=>J.typ=W,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),c(H,{onChange:W=>B(W,J),value:J.value,"onUpdate:value":W=>J.value=W,onDropdownVisibleChange:g,style:{width:"45%"},options:u.value,allowClear:!1,displayRender:({labels:W})=>W.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select_value")},null,8,["onChange","value","onUpdate:value","options","displayRender","placeholder"])]),_:2},1024),s("div",{class:"btn-hover-wrap",onClick:W=>E(P)},[c(d(at))],8,FR)])]),_:2},1024)]))),128)),c(Y,{onClick:He(R,["stop"]),icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])])])])]),_:1},8,["model"])])]),c(Cl,{batch_node_key:e.nodeId,ref_key:"runTestRef",ref:y},null,8,["batch_node_key"])]),_:1})}}},LR=_e(RR,[["__scopeId","data-v-d7aabfd1"]]),VR={class:"sub-field-item"},MR={style:{width:"200px"}},TR={class:"field-list-item"},jR={class:"field-label"},PR={class:"field-type"},qR=["onClick"],HR={key:1,class:"btn-hover-wrap",style:{opacity:"0"}},UR=["onClick"],JR={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array},variableOptions:{type:Array,default:()=>[]}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.end-node-form.subs-key"),o=e,a=ye(()=>o.level>2?o.typOptions.filter(m=>m.value!="object"):o.typOptions),l=ye(()=>o.level==2?"165px":"130px"),i=(m,v)=>{v[m].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(m,v)=>{v.splice(m,1)},u=m=>{m.subs=[]},y=m=>m.typ=="object"&&o.level<=2,p=(m,v,C)=>{C.tags=v,C.desc=m};return(m,v)=>{const C=pt,g=_s,$=et,w=Ye,S=tt("SubsKey",!0);return h(!0),D(ee,null,se(o.data,(k,b)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${o.level}`]),key:k.cu_key},[s("div",VR,[c(g,null,{default:f(()=>[v[0]||(v[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(C,{style:jt({width:l.value}),value:k.key,"onUpdate:value":x=>k.key=x,placeholder:d(n)("ph_input")},null,8,["style","value","onUpdate:value","placeholder"])]),_:2},1024),c(w,{onChange:x=>u(k),value:k.typ,"onUpdate:value":x=>k.typ=x,placeholder:d(n)("ph_select"),style:{width:"114px"}},{default:f(()=>[(h(!0),D(ee,null,se(a.value,x=>(h(),G($,{value:x.value},{default:f(()=>[T(_(x.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","placeholder"]),s("div",MR,[k.typ!="object"?(h(),G(xe,{key:0,options:e.variableOptions,defaultSelectedList:k.tags,defaultValue:k.desc,onChange:(x,A)=>p(x,A,k),placeholder:d(n)("ph_input_value")},{option:f(({label:x,payload:A})=>[s("div",TR,[s("div",jR,_(x),1),s("div",PR,_(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])):Z("",!0)]),y(k)?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:x=>i(b,o.data)},[c(d(Mt))],8,qR)):(h(),D("div",HR,[c(d(Mt))])),s("div",{class:"btn-hover-wrap",onClick:x=>r(b,o.data)},[c(d(at))],8,UR)]),k.subs&&k.subs.length>0?(h(),G(S,{key:0,level:o.level+1,typOptions:o.typOptions,variableOptions:o.variableOptions,data:k.subs},null,8,["level","typOptions","variableOptions","data"])):Z("",!0)],2))),128)}}},zR=_e(JR,[["__scopeId","data-v-f59d7f1d"]]),KR={class:"problem-optimization-form"},GR={class:"node-form-content"},WR={class:"gray-block"},ZR={class:"gray-block-title"},YR={key:0,class:"gray-block",style:{"margin-top":"12px"}},QR={class:"gray-block-title"},XR={class:"array-form-box"},eL={class:"field-key-title"},tL={class:"field-key",style:{width:"200px"}},sL={class:"field-key",style:{width:"114px"}},oL={class:"field-key",style:{flex:"1"}},nL={class:"form-item-list"},aL={class:"flex-block-item",style:{gap:"8px"}},lL={class:"msg_content_return_setting"},iL={class:"flex-block-item",style:{gap:"8px"}},rL={style:{width:"200px"}},dL={class:"field-list-item"},uL={class:"field-label"},cL={class:"field-type"},_L=["onClick"],pL=["onClick"],fL={key:0,class:"sub-field-box"},vL={class:"gray-block",style:{"margin-top":"12px"}},hL={class:"gray-block-title"},mL={class:"array-form-box"},gL={class:"form-item-label",style:{"margin-bottom":"8px"}},yL={class:"input-block-item"},bL={class:"input-header"},kL={key:0},wL={key:1},CL={key:2},$L=["onClick"],xL={class:"field-list-item"},SL={class:"field-label"},DL={class:"field-type"},AL={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.end-node-form.index"),a=n,l=e,i={text:o("ph_text_message"),image:o("ph_image_message"),voice:o("ph_voice_message")},r=[{label:o("label_return_message"),value:"message"},{label:o("label_return_message_and_variable"),value:"variable"}],u=U([]),y=we({}),p=(L,q)=>{if(L){let O=`at_input_${q}`;y[O]=L}},m=(L,q,O)=>{O.tags=q,O.content=L},v=(L,q,O)=>{O.tags=q,O.desc=L},C=()=>{const L=l.lf.getNodeModelById(l.nodeId);if(L){let q=L.getAllParentVariable();q.forEach(O=>{O.tags=O.tags||[]}),u.value=q}};function g(L){return L.typ?$(u.value,L.typ):u.value}function $(L,q){function O(M){const j=[];for(const V of M)if(V.children&&V.children.length>0){const z=O(V.children);if(z.length>0){const H={...V,children:z};j.push(H)}}else V.typ&&V.typ===q&&j.push({...V});return j}return O(L)}const w=we({out_type:"message",messages:[{key:nt(16),type:"text",content:""}],outputs:[{key:"",typ:"",subs:[]}]}),S=()=>{const L=JSON.stringify({finish:{...w}});a("update-node",{...l.node,node_params:L})},k=()=>{try{let L=l.node.dataRaw||l.node.node_params||"{}",q=JSON.parse(L).finish||{};q=JSON.parse(JSON.stringify(q)),C(),w.out_type=q.out_type||"message",w.messages=q.messages||[],w.messages.length==0&&(w.messages=[{key:nt(16),type:"text",content:""}]),w.outputs=q.outputs||[]}catch(L){}};Ie(()=>w,()=>{S()},{deep:!0});const b=L=>{if(w.messages.length>=5)return Me.warning(o("msg_max_5_messages"));w.messages.push({key:nt(16),type:L,content:""})},x=L=>{if(w.messages.length<=1)return Me.warning(o("msg_min_1_message"));w.messages.splice(L,1)},A=()=>{a("close")},R=()=>{w.outputs.push({key:"",typ:"string",subs:[],cu_key:nt(16)})},E=L=>{w.outputs.splice(L,1)},B=L=>{L.subs=[],L.desc=void 0,L.tags=[]},N=L=>{w.outputs[L].subs.push({key:"",value:"",subs:[],cu_key:nt(16)})},I=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return Ne(()=>{k()}),(L,q)=>{const O=Dn,M=pt,j=et,V=Ye,z=Tt,H=Dt,K=rt,F=lo,Y=ao,le=io,J=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_end_node"),onClose:A},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",KR,[s("div",GR,[c(J,{ref:"formRef",layout:"vertical",model:w},{default:f(()=>[s("div",WR,[s("div",ZR,_(d(o)("title_output_type")),1),c(O,{class:"customer-segmented",value:w.out_type,"onUpdate:value":q[0]||(q[0]=P=>w.out_type=P),options:r},null,8,["value"])]),w.out_type=="variable"?(h(),D("div",YR,[s("div",QR,_(d(o)("title_output_variable")),1),s("div",XR,[s("div",eL,[s("div",tL,_(d(o)("label_param_key")),1),s("div",sL,_(d(o)("label_type")),1),s("div",oL,_(d(o)("label_param_value")),1)]),s("div",nL,[c(H,{label:null},{default:f(()=>[s("div",aL,[c(M,{style:{width:"200px"},disabled:"",value:"content",placeholder:d(o)("ph_input_value")},null,8,["placeholder"]),c(z,null,{default:f(()=>[c(V,{value:"string",disabled:"",placeholder:d(o)("ph_select_value"),style:{width:"114px"}},{default:f(()=>[(h(),D(ee,null,se(I,P=>c(j,{value:P.value,key:P.value},{default:f(()=>[T(_(P.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["placeholder"])]),_:1}),s("div",lL,[c(d(Sn),{style:{color:"#faad14"}}),T(" "+_(d(o)("msg_content_return_setting")),1)])])]),_:1})]),(h(!0),D(ee,null,se(w.outputs,(P,W)=>(h(),D("div",{class:"form-item-list",key:W},[c(H,{label:null},{default:f(()=>[s("div",iL,[c(M,{style:{width:"200px"},value:P.key,"onUpdate:value":Q=>P.key=Q,placeholder:d(o)("ph_input_value")},null,8,["value","onUpdate:value","placeholder"]),c(z,null,{default:f(()=>[c(V,{onChange:Q=>B(P),value:P.typ,"onUpdate:value":Q=>P.typ=Q,placeholder:d(o)("ph_select_value"),style:{width:"114px"}},{default:f(()=>[(h(),D(ee,null,se(I,Q=>c(j,{value:Q.value,key:Q.value},{default:f(()=>[T(_(Q.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value","placeholder"])]),_:2},1024),s("div",rL,[P.typ!="object"?(h(),G(xe,{key:0,options:g(P),defaultSelectedList:P.tags,defaultValue:P.desc,onOpen:C,onChange:(Q,X)=>v(Q,X,P,W),placeholder:d(o)("ph_input_variable_value")},{option:f(({label:Q,payload:X})=>[s("div",dL,[s("div",uL,_(Q),1),s("div",cL,_(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])):Z("",!0)]),P.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:Q=>N(W)},[c(d(Mt))],8,_L)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:Q=>E(W)},[c(d(at))],8,pL)]),P.subs&&P.subs.length>0?(h(),D("div",fL,[c(z,null,{default:f(()=>[c(zR,{data:P.subs,level:2,typOptions:I,variableOptions:u.value},null,8,["data","variableOptions"])]),_:2},1024)])):Z("",!0)]),_:2},1024)]))),128)),c(K,{onClick:R,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])])])):Z("",!0),s("div",vL,[s("div",hL,_(d(o)("title_custom_message")),1),s("div",mL,[s("div",gL,_(d(o)("msg_custom_message_desc")),1),(h(!0),D(ee,null,se(w.messages,(P,W)=>(h(),D("div",{class:"form-item-list",key:W},[c(H,{label:null},{default:f(()=>[s("div",yL,[s("div",bL,[s("div",null,[T(_(W+1)+"、 ",1),P.type=="text"?(h(),D("span",kL,_(d(o)("label_text_message")),1)):Z("",!0),P.type=="image"?(h(),D("span",wL,_(d(o)("label_image_message")),1)):Z("",!0),P.type=="voice"?(h(),D("span",CL,_(d(o)("label_voice_message")),1)):Z("",!0)]),s("div",{class:"btn-hover-wrap",onClick:Q=>x(W)},[c(d(at))],8,$L)]),c(xe,{inputStyle:"height: 100px;",ref_for:!0,ref:Q=>p(Q,W),options:u.value,defaultSelectedList:P.tags,defaultValue:P.content,onOpen:C,type:"textarea",onChange:(Q,X)=>m(Q,X,P,W),placeholder:i[P.type]},{option:f(({label:Q,payload:X})=>[s("div",xL,[s("div",SL,_(Q),1),s("div",DL,_(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])])]),_:2},1024)]))),128)),c(le,null,{overlay:f(()=>[c(Y,null,{default:f(()=>[c(F,{onClick:q[1]||(q[1]=P=>b("text"))},{default:f(()=>[s("a",null,_(d(o)("label_text")),1)]),_:1}),c(F,{onClick:q[2]||(q[2]=P=>b("image"))},{default:f(()=>[s("a",null,_(d(o)("label_image")),1)]),_:1}),c(F,{onClick:q[3]||(q[3]=P=>b("voice"))},{default:f(()=>[s("a",null,_(d(o)("label_voice")),1)]),_:1})]),_:1})]),default:f(()=>[s("div",null,[c(K,{type:"dashed",block:""},{default:f(()=>[c(d(Xe)),T(_(d(o)("btn_add_message",{count:w.messages.length})),1)]),_:1})])]),_:1})])])]),_:1},8,["model"])])])]),_:1})}}},OL=_e(AL,[["__scopeId","data-v-c1b4847b"]]),NL=()=>{const{t:e}=fe("constants.voice");return[{label:e("label_close"),value:!1},{label:e("label_open"),value:!0}]},Xs=NL(),BL=()=>{const{t:e}=fe("constants.voice");return[{label:e("voice_male"),value:"male-qn-jingying"},{label:e("voice_female"),value:"female-chengshu"},{label:e("voice_boy"),value:"clever_boy"},{label:e("voice_girl"),value:"lovely_girl"}]},qo=BL(),EL=()=>{const{t:e}=fe("constants.voice");return{happy:e("emotion_happy"),sad:e("emotion_sad"),angry:e("emotion_angry"),fearful:e("emotion_fearful"),disgusted:e("emotion_disgusted"),surprised:e("emotion_surprised"),calm:e("emotion_calm"),fluent:e("emotion_fluent"),whisper:e("emotion_whisper")}},IL=EL(),FL=[8e3,16e3,22050,24e3,32e3,44100],RL=[32e3,64e3,128e3,256e3],LL=["mp3","pcm","flac","wav"],VL=()=>{const{t:e}=fe("constants.voice");return[{label:e("channel_mono"),value:1},{label:e("channel_stereo"),value:2}]},ML=VL(),TL={url:"url",hex:"hex"},jL=()=>{const{t:e}=fe("constants.voice");return{spacious_echo:e("effect_spacious_echo"),auditorium_echo:e("effect_auditorium_echo"),lofi_telephone:e("effect_lofi_telephone"),robotic:e("effect_robotic")}},PL=jL(),qL=()=>{const{t:e}=fe("constants.voice");return{auto:e("language_auto"),Chinese:e("language_chinese"),Yue:e("language_yue"),English:e("language_english"),Arabic:e("language_arabic"),Russian:e("language_russian"),Spanish:e("language_spanish"),French:e("language_french"),Portuguese:e("language_portuguese"),German:e("language_german"),Turkish:e("language_turkish"),Dutch:e("language_dutch"),Ukrainian:e("language_ukrainian"),Vietnamese:e("language_vietnamese"),Indonesian:e("language_indonesian"),Japanese:e("language_japanese"),Italian:e("language_italian"),Korean:e("language_korean"),Thai:e("language_thai"),Polish:e("language_polish"),Romanian:e("language_romanian"),Greek:e("language_greek"),Czech:e("language_czech"),Finnish:e("language_finnish"),Hindi:e("language_hindi"),Bulgarian:e("language_bulgarian"),Danish:e("language_danish"),Hebrew:e("language_hebrew"),Malay:e("language_malay"),Persian:e("language_persian"),Slovak:e("language_slovak"),Swedish:e("language_swedish"),Croatian:e("language_croatian"),Filipino:e("language_filipino"),Hungarian:e("language_hungarian"),Norwegian:e("language_norwegian"),Slovenian:e("language_slovenian"),Catalan:e("language_catalan"),Nynorsk:e("language_nynorsk"),Tamil:e("language_tamil"),Afrikaans:e("language_afrikaans")}},$l=qL(),HL=()=>{const{t:e}=fe("constants.voice");return{speed:{ui_type:"slider",key:"voice_setting.speed",label:e("label_speed"),type:"number",required:!0,tooltip:e("tooltip_speed"),default:1,min:.5,max:2,step:.1,marks:{.5:"0.5",2:"2"}},vol:{ui_type:"slider",key:"voice_setting.vol",label:e("label_volume"),type:"number",required:!0,tooltip:e("tooltip_volume"),default:1,min:0,max:10,step:1,marks:{0:"0",10:"10"}},pitch:{ui_type:"slider",key:"voice_setting.pitch",label:e("label_pitch"),type:"number",required:!0,tooltip:e("tooltip_pitch"),default:0,min:-12,max:12,step:1,marks:{"-12":"-12",12:"12"}}}},As=HL(),UL=()=>{const{t:e}=fe("constants.voice");return{pitch:{ui_type:"slider",key:"voice_modify.pitch",label:e("label_pitch"),type:"number",tooltip:e("tooltip_pitch_modify"),default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},intensity:{ui_type:"slider",key:"voice_modify.intensity",label:e("label_intensity"),type:"number",tooltip:e("tooltip_intensity"),default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},timbre:{ui_type:"slider",key:"voice_modify.timbre",label:e("label_timbre"),type:"number",tooltip:e("tooltip_timbre"),default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}}}},Os=UL(),JL=()=>{const{t:e}=fe("constants.voice");return{data:{desc:e("desc_audio_synthesis_result"),type:"object",properties:{audio:{desc:e("desc_audio_data"),type:"string"},status:{desc:e("desc_audio_synthesis_status"),type:"number"}}},extra_info:{desc:e("desc_audio_extra_info"),type:"object",properties:{audio_length:{desc:e("desc_audio_length"),type:"number"},audio_sample_rate:{desc:e("desc_audio_sample_rate"),type:"number"},audio_size:{desc:e("desc_audio_size"),type:"number"},bitrate:{desc:e("desc_bitrate"),type:"number"},word_count:{desc:e("desc_word_count"),type:"number"},invisible_character_ratio:{desc:e("desc_invisible_character_ratio"),type:"number"},usage_characters:{desc:e("desc_usage_characters"),type:"number"},audio_format:{desc:e("desc_audio_format"),type:"string"},audio_channel:{desc:e("desc_audio_channel"),type:"number"}}},trace_id:{desc:e("desc_request_trace_id"),type:"string"},base_resp:{desc:e("desc_base_response"),type:"object",properties:{status_code:{desc:e("desc_status_code"),type:"number"},status_msg:{desc:e("desc_status_msg"),type:"string"}}}}},zL=JL(),KL=()=>{const{t:e}=fe("constants.voice");return{input_sensitive:{desc:e("desc_input_sensitive"),type:"boolean"},input_sensitive_type:{desc:e("desc_sensitive_type"),type:"number"},demo_audio:{desc:e("desc_demo_audio"),type:"string"},base_resp:{desc:e("desc_base_response"),type:"object",properties:{status_code:{desc:e("desc_status_code"),type:"number"},status_msg:{desc:e("desc_status_msg"),type:"string"}}}}},GL=KL(),WL={class:"node-options"},ZL={class:"options-title"},YL={class:"options-item is-required"},QL={class:"options-item-tit"},XL={class:"option-label"},eV={class:"field-list-item"},tV={class:"field-label"},sV={class:"field-type"},oV={class:"desc"},nV={class:"options-item is-required"},aV={class:"options-item-tit"},lV={class:"option-label"},iV={class:"field-list-item"},rV={class:"field-label"},dV={class:"field-type"},uV={class:"desc"},cV={class:"options-item"},_V={class:"options-item-tit flex-between"},pV={class:"option-label"},fV={class:"options-item"},vV={class:"form-box"},hV={class:"form-item"},mV={class:"form-tit"},gV={class:"form-cont"},yV={class:"field-list-item"},bV={class:"field-label"},kV={class:"field-type"},wV={class:"form-item"},CV={class:"form-tit"},$V={class:"form-cont"},xV={class:"field-list-item"},SV={class:"field-label"},DV={class:"field-type"},AV={class:"options-item"},OV={class:"options-item-tit"},NV={class:"option-label"},BV={class:"form-box"},EV={class:"form-item"},IV={class:"form-tit"},FV={class:"form-cont"},RV={class:"field-list-item"},LV={class:"field-label"},VV={class:"field-type"},MV={class:"form-item"},TV={class:"form-tit"},jV={class:"form-cont"},PV={class:"options-item"},qV={class:"form-box"},HV={class:"form-item"},UV={class:"form-tit c262626"},JV={class:"form-cont"},zV={class:"options-item"},KV={class:"form-box"},GV={class:"form-item"},WV={class:"form-tit"},ZV={class:"form-cont"},YV={class:"form-item"},QV={class:"form-tit"},XV={class:"form-cont"},eM={class:"form-item"},tM={class:"form-tit"},sM={class:"form-cont"},oM={class:"node-options"},nM={class:"options-title"},aM={class:"options-item"},lM={__name:"voice-clone-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.voice-clone-form"),o=e,a=be("getNode"),l=be("setData");U(null);const i=U([]),r=U([]);U([]);const u=we({model_id:0,model:"",model_config_id:0,file_url:"",voice_id:"",clone_prompt:{prompt_audio_url:"",prompt_text:"",tag_map:{}},text:"",language_boost:"auto",need_noise_reduction:!1,need_volume_normalization:!1,aigc_watermark:!1,tag_map:{}}),y=U(!1);Ne(()=>{p()});function p(){v(),r.value=Fs(GL),m()}function m(){var k;let w=JSON.parse(o.node.node_params),S=((k=w==null?void 0:w.voice_clone)==null?void 0:k.arguments)||{};S.tag_map=S.tag_map?S.tag_map:{},Object.assign(u,S)}function v(){i.value=a().getAllParentVariable()}function C(w,S,k,b=null){b=b||u,b[w]=S,u.tag_map[w]=k,$()}function g(){y.value=!y.value}function $(){let w=JSON.parse(o.node.node_params);u.model_id=Number(u.model_id||0),Object.assign(w.voice_clone,{model_config_id:u.model_config_id,arguments:u,output:r.value}),l({...o.node,node_params:JSON.stringify(w)})}return(w,S)=>{const k=ct,b=et,x=Ye;return h(),G(ft,{class:"voice-clone-form"},{default:f(()=>{var A,R,E,B,N;return[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(n)("desc_voice_clone")},null,8,["title","iconName","desc"]),s("div",WL,[s("div",ZL,[s("div",null,[S[12]||(S[12]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(n)("label_input")),1)])]),s("div",YL,[s("div",QL,[s("div",XL,_(d(n)("label_clone_audio_file")),1),S[13]||(S[13]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((A=u.tag_map)==null?void 0:A.file_url)||[],defaultValue:u.file_url,ref:"atInputRef",placeholder:d(n)("ph_input_file_url"),onOpen:v,onChange:S[0]||(S[0]=(I,L)=>C("file_url",I,L))},{option:f(({label:I,payload:L})=>[s("div",eV,[s("div",tV,_(I),1),s("div",sV,_(L.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",oV,_(d(n)("msg_clone_audio")),1)]),s("div",nV,[s("div",aV,[s("div",lV,_(d(n)("label_voice_id")),1),S[14]||(S[14]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((R=u.tag_map)==null?void 0:R.voice_id)||[],defaultValue:u.voice_id,ref:"atInputRef",placeholder:d(n)("ph_input_voice_id"),onOpen:v,onChange:S[1]||(S[1]=(I,L)=>C("voice_id",I,L))},{option:f(({label:I,payload:L})=>[s("div",iV,[s("div",rV,_(I),1),s("div",dV,_(L.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])]),s("div",uV,_(d(n)("msg_voice_id_desc")),1)]),s("div",cV,[s("div",_V,[s("div",pV,_(d(n)("label_clone_sample_audio")),1),s("a",{onClick:g},[T(_(d(n)("label_advanced_settings"))+" ",1),y.value?(h(),G(d(Mo),{key:1})):(h(),G(d(ds),{key:0}))])])]),y.value?(h(),D(ee,{key:0},[s("div",fV,[s("div",vV,[s("div",hV,[s("div",mV,[c(k,{title:d(n)("tip_audio_file")},{default:f(()=>[T(_(d(n)("label_audio_file"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",gV,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((E=u.tag_map)==null?void 0:E.prompt_audio_url)||[],defaultValue:u.clone_prompt.prompt_audio_url,ref:"atInputRef",placeholder:d(n)("ph_input_file_url"),onOpen:v,onChange:S[2]||(S[2]=(I,L)=>C("prompt_audio_url",I,L,u.clone_prompt))},{option:f(({label:I,payload:L})=>[s("div",yV,[s("div",bV,_(I),1),s("div",kV,_(L.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])]),s("div",wV,[s("div",CV,[c(k,{title:d(n)("tip_text")},{default:f(()=>[T(_(d(n)("label_text"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",$V,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((B=u.tag_map)==null?void 0:B.prompt_text)||[],defaultValue:u.clone_prompt.prompt_text,ref:"atInputRef",placeholder:d(n)("ph_input_sample_text"),onOpen:v,onChange:S[3]||(S[3]=(I,L)=>C("prompt_text",I,L,u.clone_prompt))},{option:f(({label:I,payload:L})=>[s("div",xV,[s("div",SV,_(I),1),s("div",DV,_(L.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])])])]),s("div",AV,[s("div",OV,[s("div",NV,_(d(n)("label_clone_preview_params")),1)]),s("div",BV,[s("div",EV,[s("div",IV,[c(k,{title:d(n)("tip_preview_text")},{default:f(()=>[T(_(d(n)("label_preview_text"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",FV,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((N=u.tag_map)==null?void 0:N.text)||[],defaultValue:u.text,ref:"atInputRef",placeholder:d(n)("ph_input_preview_text"),onOpen:v,onChange:S[4]||(S[4]=(I,L)=>C("text",I,L))},{option:f(({label:I,payload:L})=>[s("div",RV,[s("div",LV,_(I),1),s("div",VV,_(L.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"])])]),s("div",MV,[s("div",TV,[c(k,{title:d(n)("tip_small_language_recognition")},{default:f(()=>[T(_(d(n)("label_small_language_recognition"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",jV,[c(x,{value:u.language_boost,"onUpdate:value":S[5]||(S[5]=I=>u.language_boost=I),placeholder:d(n)("ph_select"),onChange:$},{default:f(()=>[(h(!0),D(ee,null,se(d($l),(I,L)=>(h(),G(b,{key:L,value:L},{default:f(()=>[T(_(I),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])])])]),s("div",PV,[s("div",qV,[s("div",HV,[s("div",UV,[c(k,{title:d(n)("tip_preview_audio_model")},{default:f(()=>[T(_(d(n)("label_preview_audio_model"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",JV,[c(Gs,{style:{width:"276px"},"model-type":"TTS",modeName:u.model,"onUpdate:modeName":S[6]||(S[6]=I=>u.model=I),modeId:u.model_id,"onUpdate:modeId":S[7]||(S[7]=I=>u.model_id=I),useConfigId:u.model_config_id,"onUpdate:useConfigId":S[8]||(S[8]=I=>u.model_config_id=I),onChange:$},null,8,["modeName","modeId","useConfigId"])])])])]),s("div",zV,[s("div",KV,[s("div",GV,[s("div",WV,[c(k,{title:d(n)("tip_noise_reduction")},{default:f(()=>[T(_(d(n)("label_noise_reduction"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",ZV,[c(vs,{value:u.need_noise_reduction,"onUpdate:value":S[9]||(S[9]=I=>u.need_noise_reduction=I),options:d(Xs),onChange:$},null,8,["value","options"])])]),s("div",YV,[s("div",QV,[c(k,{title:d(n)("tip_volume_normalization")},{default:f(()=>[T(_(d(n)("label_volume_normalization"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",XV,[c(vs,{value:u.need_volume_normalization,"onUpdate:value":S[10]||(S[10]=I=>u.need_volume_normalization=I),options:d(Xs),onChange:$},null,8,["value","options"])])]),s("div",eM,[s("div",tM,[c(k,{title:d(n)("tip_audio_rhythm_mark")},{default:f(()=>[T(_(d(n)("label_audio_rhythm_mark"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",sM,[c(vs,{value:u.aigc_watermark,"onUpdate:value":S[11]||(S[11]=I=>u.aigc_watermark=I),options:d(Xs),onChange:$},null,8,["value","options"])])])])])],64)):Z("",!0)]),s("div",oM,[s("div",nM,[s("div",null,[S[15]||(S[15]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(n)("label_output")),1)])]),s("div",aM,[c(Rs,{"tree-data":r.value},null,8,["tree-data"])])])]}),_:1})}}},iM=_e(lM,[["__scopeId","data-v-367a04ed"]]);function rM(e={}){return bn.get({url:"/manage/getMiniMaxVoiceList",params:e})}const dM={class:"zm-line2"},uM={__name:"select-voice-modal",props:{modelConfigId:{type:[Number,String]},voiceType:{type:String,default:"all"}},emits:["change"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.components.select-voice-modal"),l=o,i=e,r=U(!1),u=U(!1),y=U(""),p=U([]),m=U([]),v=U([]),C=ye(()=>[{title:a("label_index"),dataIndex:"index",key:"index",width:80},{title:a("label_name"),dataIndex:"voice_name",width:120},{title:a("label_id"),dataIndex:"voice_id",width:80},{title:a("label_description"),dataIndex:"description",width:200}]),g=ye(()=>y.value?p.value.filter(b=>b.voice_name.indexOf(y.value)>-1||b.voice_id==y.value):p.value);function $(b=[]){m.value=b,w(),r.value=!0}function w(){u.value=!0,rM({model_config_id:i.modelConfigId,voice_type:i.voiceType}).then(b=>{p.value=(b==null?void 0:b.data)||[],p.value.forEach((x,A)=>{var R;x.index=A+1,x.description=((R=x==null?void 0:x.description)==null?void 0:R[0])||""}),v.value=p.value.filter(x=>m.value.includes(x.voice_id))}).finally(()=>{u.value=!1})}function S(b,x){m.value=b,v.value=x}function k(){l("change",Ht(m.value),Ht(v.value)),r.value=!1}return n({show:$}),(b,x)=>{const A=pt,R=ct,E=ro,B=wt;return h(),G(B,{open:r.value,"onUpdate:open":x[1]||(x[1]=N=>r.value=N),title:d(a)("title_select_voice"),width:"670px",onOk:k},{default:f(()=>[c(A,{value:y.value,"onUpdate:value":x[0]||(x[0]=N=>y.value=N),valueModifiers:{trim:!0},placeholder:d(a)("ph_search_voice"),"allow-clear":"",style:{width:"240px"}},{suffix:f(()=>[c(d(Wa))]),_:1},8,["value","placeholder"]),c(E,{class:"mt16",loading:u.value,columns:C.value,"data-source":g.value,pagination:!1,"row-key":"voice_id","row-selection":{type:"radio",selectedRowKeys:m.value,onChange:S},scroll:{y:500}},{bodyCell:f(({column:N,record:I})=>[N.dataIndex==="description"?(h(),G(R,{key:0,title:I.description},{default:f(()=>[s("div",dM,_(I.description),1)]),_:2},1032,["title"])):Z("",!0)]),_:1},8,["loading","columns","data-source","row-selection"])]),_:1},8,["open","title"])}}},cM=_e(uM,[["__scopeId","data-v-2eafea07"]]),_M={class:"node-options"},pM={class:"options-title"},fM={class:"options-item is-required"},vM={class:"options-item-tit"},hM={class:"option-label"},mM={class:"options-item is-required"},gM={class:"options-item-tit"},yM={class:"option-label"},bM={class:"field-list-item"},kM={class:"field-label"},wM={class:"field-type"},CM={class:"desc"},$M={class:"options-item is-required"},xM={class:"options-item-tit"},SM={class:"option-label"},DM={class:"flex-between"},AM={class:"options-item is-required"},OM={class:"options-item-tit"},NM={class:"option-label"},BM={class:"flex-between"},EM={class:"field-list-item"},IM={class:"field-label"},FM={class:"field-type"},RM={class:"options-item"},LM={class:"options-item-tit"},VM={class:"option-label"},MM={class:"form-box"},TM={class:"option-type"},jM={class:"form-cont"},PM={class:"form-item"},qM={class:"form-tit required"},HM={class:"form-cont"},UM={class:"form-item"},JM={class:"form-tit required"},zM={class:"form-cont"},KM={class:"options-item"},GM={class:"options-item-tit"},WM={class:"option-label"},ZM={class:"form-box"},YM={class:"form-item"},QM={class:"form-tit"},XM={class:"form-cont"},eT={class:"form-item"},tT={class:"form-tit"},sT={class:"form-cont"},oT={class:"form-item"},nT={class:"form-tit"},aT={class:"form-cont"},lT={class:"form-item"},iT={class:"form-tit"},rT={class:"form-cont"},dT={class:"options-item"},uT={class:"options-item-tit"},cT={class:"option-label"},_T={class:"form-box"},pT={class:"option-type"},fT={class:"form-cont"},vT={class:"form-item"},hT={class:"form-tit"},mT={class:"form-cont"},gT={class:"options-item"},yT={class:"options-item-tit"},bT={class:"option-label"},kT={class:"form-box"},wT={class:"form-item"},CT={class:"form-tit"},$T={class:"form-cont"},xT={class:"form-item"},ST={class:"form-tit"},DT={class:"form-cont"},AT={class:"form-item"},OT={class:"form-tit"},NT={class:"form-cont"},BT={class:"form-item"},ET={class:"form-tit"},IT={class:"form-cont"},FT={class:"form-item"},RT={class:"form-tit"},LT={class:"form-cont"},VT={class:"node-options"},MT={class:"options-title"},TT={class:"options-item"},jT={__name:"voice-synthesis-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.voice-synthesis-form"),o=e,a=be("getNode"),l=be("setData"),i=U(null),r=U([]),u=U([]),y=U([]),p=we({model_id:0,use_model:"",model_config_id:0,text:"",voice_set_type:1,voice_setting:{voice_id:"male-qn-jingying",voice_name:"",speed:1,vol:1,pitch:0,emotion:"happy",text_normalization:!1},audio_setting:{sample_rate:32e3,bitrate:128e3,format:"mp3",channel:1,force_cbr:!1},voice_modify:{pitch:0,intensity:0,timbre:0,sound_effects:""},language_boost:"auto",output_format:"url",subtitle_enable:!1,aigc_watermark:!1,tag_map:{}}),m=U(!1),v=ye(()=>{var q,O;const N=p.voice_setting.voice_id,L=qo.some(M=>M.value==N)?"-1":((O=(q=y.value)==null?void 0:q[0])==null?void 0:O.voice_id)??N;return[...qo,{label:n("opt_custom"),value:L}]}),C=ye(()=>[...qo,...y.value.map(N=>({label:N.voice_name,value:N.voice_id}))]);Ne(()=>{g()});function g(){w(),u.value=Fs(zL),$()}function $(){var L,q;let N=JSON.parse(o.node.node_params),I=((L=N==null?void 0:N.text_to_audio)==null?void 0:L.arguments)||{};if(I.tag_map=I.tag_map?I.tag_map:{},Object.assign(p,I),(q=p.voice_setting)!=null&&q.voice_id&&qo.findIndex(O=>{var M;return O.value==((M=p.voice_setting)==null?void 0:M.voice_id)})<0){const{voice_id:O,voice_name:M}=p.voice_setting;y.value=[{voice_id:O,voice_name:M}]}}function w(){r.value=a().getAllParentVariable()}function S(N,I,L){p[N]=I,p.tag_map[N]=L,B()}function k(N,I){p.voice_setting.voice_id=N,p.tag_map.voice_setting_voice_id=I,B()}function b(){if(!p.model_config_id)return Me.warning(n("msg_select_voice_model_first"));i.value.show([p.voice_setting.voice_id])}function x(){p.voice_setting.voice_id="male-qn-jingying",B()}function A(){B()}function R(N,I){p.voice_setting.voice_id=N[0],p.voice_setting.voice_name=I[0].voice_name,y.value=I,B()}function E(){m.value=!m.value}function B(){let N=JSON.parse(o.node.node_params);p.model_id=Number(p.model_id||0),Object.assign(N.text_to_audio,{voice_type:"all",model_config_id:p.model_config_id,arguments:p,output:u.value}),l({...o.node,node_params:JSON.stringify(N)})}return(N,I)=>{const L=ct,q=et,O=Ye,M=ko,j=yi,V=Vt,z=gi;return h(),G(ft,{class:"voice-synthesis-form"},{default:f(()=>{var H,K;return[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(n)("desc_voice_synthesis")},null,8,["title","iconName","desc"]),s("div",_M,[s("div",pM,[s("div",null,[I[19]||(I[19]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(n)("label_input")),1)])]),s("div",fM,[s("div",vM,[s("div",hM,_(d(n)("label_voice_model")),1)]),c(Gs,{"model-type":"TTS",modeName:p.use_model,"onUpdate:modeName":I[0]||(I[0]=F=>p.use_model=F),modeId:p.model_id,"onUpdate:modeId":I[1]||(I[1]=F=>p.model_id=F),useConfigId:p.model_config_id,"onUpdate:useConfigId":I[2]||(I[2]=F=>p.model_config_id=F),onChange:x},null,8,["modeName","modeId","useConfigId"])]),s("div",mM,[s("div",gM,[s("div",yM,_(d(n)("label_text")),1),I[20]||(I[20]=s("div",{class:"option-type"},"string",-1))]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:((H=p.tag_map)==null?void 0:H.text)||[],defaultValue:p.text,ref:"atInputRef",onOpen:w,onChange:I[3]||(I[3]=(F,Y)=>S("text",F,Y))},{option:f(({label:F,payload:Y})=>[s("div",bM,[s("div",kM,_(F),1),s("div",wM,_(Y.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),s("div",CM,_(d(n)("msg_text_desc")),1)]),s("div",$M,[s("div",xM,[s("div",SM,_(d(n)("label_select_voice")),1)]),s("div",DM,[c(vs,{value:p.voice_setting.voice_id,"onUpdate:value":I[4]||(I[4]=F=>p.voice_setting.voice_id=F),options:v.value,onChange:B},null,8,["value","options"]),c(L,{placement:"left",title:d(n)("label_advanced_settings")},{default:f(()=>[s("span",{class:"setting-icon",onClick:E},[c(d(Cn))])]),_:1},8,["title"])])]),s("div",AM,[s("div",OM,[s("div",NM,_(d(n)("label_voice_settings")),1),I[21]||(I[21]=s("div",{class:"option-type"},"string",-1))]),s("div",BM,[c(O,{value:p.voice_set_type,"onUpdate:value":I[5]||(I[5]=F=>p.voice_set_type=F),onChange:A},{default:f(()=>[c(q,{value:1},{default:f(()=>[T(_(d(n)("label_select_voice_type")),1)]),_:1}),c(q,{value:2},{default:f(()=>[T(_(d(n)("label_set_voice")),1)]),_:1})]),_:1},8,["value"]),p.voice_set_type==1?(h(),G(O,{key:0,value:p.voice_setting.voice_id,"onUpdate:value":I[6]||(I[6]=F=>p.voice_setting.voice_id=F),open:!1,onDropdownVisibleChange:b,style:{width:"100%"}},{default:f(()=>[c(q,{value:"-1"},{default:f(()=>[T(_(d(n)("ph_select")),1)]),_:1}),(h(!0),D(ee,null,se(C.value,F=>(h(),G(q,{value:F.value,key:F.item},{default:f(()=>[T(_(F.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(h(),G(xe,{key:1,type:"textarea",inputStyle:"height: 33px",options:r.value,defaultSelectedList:((K=p.tag_map)==null?void 0:K.voice_setting_voice_id)||[],defaultValue:p.voice_setting.voice_id,ref:"atInputRef",placeholder:d(n)("ph_input_content"),onOpen:w,onChange:k},{option:f(({label:F,payload:Y})=>[s("div",EM,[s("div",IM,_(F),1),s("div",FM,_(Y.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","placeholder"]))])]),m.value?(h(),D(ee,{key:0},[s("div",RM,[s("div",LM,[s("div",VM,_(d(n)("label_voice_settings_label")),1)]),s("div",MM,[(h(),D(ee,null,se(["speed","vol","pitch"],F=>s("div",{key:F,class:"form-item"},[s("div",{class:qe(["form-tit",{required:d(As)[F]}.required])},[c(L,{title:d(As)[F].tooltip},{default:f(()=>[T(_(d(As)[F].label)+" ",1),c(d(Re)),s("span",TM,_(d(As)[F].type),1)]),_:2},1032,["title"])],2),s("div",jM,[c(z,null,{default:f(()=>[c(j,{span:15},{default:f(()=>[c(M,{value:p.voice_setting[F],"onUpdate:value":Y=>p.voice_setting[F]=Y,step:d(As)[F].step,min:d(As)[F].min,max:d(As)[F].max,marks:d(As)[F].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),c(j,{span:7},{default:f(()=>[c(V,{value:p.voice_setting[F],"onUpdate:value":Y=>p.voice_setting[F]=Y,placeholder:d(n)("ph_select"),min:d(As)[F].min,max:d(As)[F].max,class:"ml16"},null,8,["value","onUpdate:value","placeholder","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),s("div",PM,[s("div",qM,[c(L,{title:d(n)("tip_emotion")},{default:f(()=>[T(_(d(n)("label_emotion"))+" ",1),c(d(Re)),I[22]||(I[22]=s("span",{class:"option-type"},"string",-1))]),_:1},8,["title"])]),s("div",HM,[c(O,{value:p.voice_setting.emotion,"onUpdate:value":I[7]||(I[7]=F=>p.voice_setting.emotion=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d(IL),(F,Y)=>(h(),G(q,{key:Y},{default:f(()=>[T(_(F),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])])]),s("div",UM,[s("div",JM,[c(L,{title:d(n)("tip_text_normalization")},{default:f(()=>[T(_(d(n)("label_text_normalization"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",zM,[c(vs,{value:p.voice_setting.text_normalization,"onUpdate:value":I[8]||(I[8]=F=>p.voice_setting.text_normalization=F),options:d(Xs),onChange:B},null,8,["value","options"])])])])]),s("div",KM,[s("div",GM,[s("div",WM,_(d(n)("label_audio_settings")),1)]),s("div",ZM,[s("div",YM,[s("div",QM,[c(L,{title:d(n)("tip_sample_rate")},{default:f(()=>[T(_(d(n)("label_sample_rate"))+" ",1),c(d(Re))]),_:1},8,["title"]),I[23]||(I[23]=s("span",{class:"option-type"},"Number",-1))]),s("div",XM,[c(O,{value:p.audio_setting.sample_rate,"onUpdate:value":I[9]||(I[9]=F=>p.audio_setting.sample_rate=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d(FL),F=>(h(),G(q,{key:F},{default:f(()=>[T(_(F),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])])]),s("div",eT,[s("div",tT,[c(L,{title:d(n)("tip_bitrate")},{default:f(()=>[T(_(d(n)("label_bitrate"))+" ",1),c(d(Re))]),_:1},8,["title"]),I[24]||(I[24]=s("span",{class:"option-type"},"Number",-1))]),s("div",sT,[c(O,{value:p.audio_setting.bitrate,"onUpdate:value":I[10]||(I[10]=F=>p.audio_setting.bitrate=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d(RL),F=>(h(),G(q,{key:F},{default:f(()=>[T(_(F),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])])]),s("div",oT,[s("div",nT,[c(L,{title:d(n)("tip_format")},{default:f(()=>[T(_(d(n)("label_format"))+" ",1),c(d(Re))]),_:1},8,["title"]),I[25]||(I[25]=s("span",{class:"option-type"},"string",-1))]),s("div",aT,[c(O,{value:p.audio_setting.format,"onUpdate:value":I[11]||(I[11]=F=>p.audio_setting.format=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d(LL),F=>(h(),G(q,{key:F},{default:f(()=>[T(_(F),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])])]),s("div",lT,[s("div",iT,[c(L,{title:d(n)("tip_channel")},{default:f(()=>[T(_(d(n)("label_channel"))+" ",1),c(d(Re))]),_:1},8,["title"]),I[26]||(I[26]=s("span",{class:"option-type"},"Number",-1))]),s("div",rT,[c(O,{value:p.audio_setting.channel,"onUpdate:value":I[12]||(I[12]=F=>p.audio_setting.channel=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d(ML),F=>(h(),G(q,{key:F.value,value:F.value},{default:f(()=>[T(_(F.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])])])]),s("div",dT,[s("div",uT,[s("div",cT,_(d(n)("label_voice_effect_settings")),1)]),s("div",_T,[(h(),D(ee,null,se(["pitch","intensity","timbre"],F=>s("div",{key:F,class:"form-item"},[s("div",{class:qe(["form-tit",{required:d(Os)[F]}.required])},[c(L,{title:d(Os)[F].tooltip},{default:f(()=>[T(_(d(Os)[F].label)+" ",1),c(d(Re)),s("span",pT,_(d(Os)[F].type),1)]),_:2},1032,["title"])],2),s("div",fT,[c(z,null,{default:f(()=>[c(j,{span:15},{default:f(()=>[c(M,{value:p.voice_modify[F],"onUpdate:value":Y=>p.voice_modify[F]=Y,step:d(Os)[F].step,min:d(Os)[F].min,max:d(Os)[F].max,marks:d(Os)[F].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),c(j,{span:7},{default:f(()=>[c(V,{value:p.voice_modify[F],"onUpdate:value":Y=>p.voice_modify[F]=Y,placeholder:d(n)("ph_select"),min:d(Os)[F].min,max:d(Os)[F].max,class:"ml16"},null,8,["value","onUpdate:value","placeholder","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),s("div",vT,[s("div",hT,[c(L,{title:d(n)("tip_sound_effect")},{default:f(()=>[T(_(d(n)("label_sound_effect"))+" ",1),c(d(Re)),I[27]||(I[27]=s("span",{class:"option-type"},"string",-1))]),_:1},8,["title"])]),s("div",mT,[c(O,{value:p.voice_modify.sound_effects,"onUpdate:value":I[13]||(I[13]=F=>p.voice_modify.sound_effects=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[c(q,{value:""},{default:f(()=>[T(_(d(n)("opt_none")),1)]),_:1}),(h(!0),D(ee,null,se(d(PL),(F,Y)=>(h(),G(q,{key:Y,value:Y},{default:f(()=>[T(_(F),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])])])]),s("div",gT,[s("div",yT,[s("div",bT,_(d(n)("label_other_settings")),1)]),s("div",kT,[s("div",wT,[s("div",CT,[c(L,{title:d(n)("tip_small_language_recognition")},{default:f(()=>[T(_(d(n)("label_small_language_recognition"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",$T,[c(O,{value:p.language_boost,"onUpdate:value":I[14]||(I[14]=F=>p.language_boost=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d($l),(F,Y)=>(h(),G(q,{key:Y,value:Y},{default:f(()=>[T(_(F),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",xT,[s("div",ST,[c(L,{title:d(n)("tip_output_format")},{default:f(()=>[T(_(d(n)("label_output_format"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",DT,[c(O,{value:p.output_format,"onUpdate:value":I[15]||(I[15]=F=>p.output_format=F),placeholder:d(n)("ph_select"),onChange:B},{default:f(()=>[(h(!0),D(ee,null,se(d(TL),(F,Y)=>(h(),G(q,{key:Y,value:Y},{default:f(()=>[T(_(F),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),s("div",AT,[s("div",OT,[c(L,{title:d(n)("tip_constant_bitrate_control")},{default:f(()=>[T(_(d(n)("label_constant_bitrate_control"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",NT,[c(vs,{value:p.audio_setting.force_cbr,"onUpdate:value":I[16]||(I[16]=F=>p.audio_setting.force_cbr=F),options:d(Xs),onChange:B},null,8,["value","options"])])]),s("div",BT,[s("div",ET,[c(L,{title:d(n)("tip_subtitle_service")},{default:f(()=>[T(_(d(n)("label_subtitle_service"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",IT,[c(vs,{value:p.subtitle_enable,"onUpdate:value":I[17]||(I[17]=F=>p.subtitle_enable=F),options:d(Xs),onChange:B},null,8,["value","options"])])]),s("div",FT,[s("div",RT,[c(L,{title:d(n)("tip_add_audio_rhythm_mark")},{default:f(()=>[T(_(d(n)("label_add_audio_rhythm_mark"))+" ",1),c(d(Re))]),_:1},8,["title"])]),s("div",LT,[c(vs,{value:p.aigc_watermark,"onUpdate:value":I[18]||(I[18]=F=>p.aigc_watermark=F),options:d(Xs),onChange:B},null,8,["value","options"])])])])])],64)):Z("",!0)]),s("div",VT,[s("div",MT,[s("div",null,[I[28]||(I[28]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(n)("label_output")),1)])]),s("div",TT,[c(Rs,{"tree-data":u.value},null,8,["tree-data"])])]),c(cM,{ref_key:"voiceModalRef",ref:i,modelConfigId:p.model_config_id,onChange:R},null,8,["modelConfigId"])]}),_:1})}}},PT=_e(jT,[["__scopeId","data-v-b413d73d"]]),qT="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.09452%2014.4098C4.97749%2014.0772%203.98319%2013.4598%203.19588%2012.6417C3.48959%2012.2936%203.66659%2011.8438%203.66659%2011.3527C3.66659%2010.2482%202.77116%209.35274%201.66659%209.35274C1.59977%209.35274%201.53372%209.35604%201.46858%209.36244C1.37985%208.9286%201.33325%208.47947%201.33325%208.0194C1.33325%207.32254%201.44018%206.65064%201.63852%206.0192C1.64786%206.01934%201.65721%206.0194%201.66659%206.0194C2.77116%206.0194%203.66659%205.12397%203.66659%204.0194C3.66659%203.7023%203.59279%203.40247%203.46145%203.13607C4.23242%202.4192%205.17342%201.88271%206.21729%201.59375C6.54805%202.2421%207.22215%202.68608%207.99992%202.68608C8.77769%202.68608%209.45179%202.2421%209.78255%201.59375C10.8264%201.88271%2011.7674%202.4192%2012.5384%203.13607C12.4071%203.40247%2012.3333%203.7023%2012.3333%204.0194C12.3333%205.12397%2013.2287%206.0194%2014.3333%206.0194C14.3426%206.0194%2014.352%206.01934%2014.3613%206.0192C14.5597%206.65064%2014.6666%207.32254%2014.6666%208.0194C14.6666%208.47947%2014.62%208.9286%2014.5313%209.36244C14.4661%209.35604%2014.4001%209.35274%2014.3333%209.35274C13.2287%209.35274%2012.3333%2010.2482%2012.3333%2011.3527C12.3333%2011.8438%2012.5103%2012.2936%2012.804%2012.6417C12.0167%2013.4598%2011.0224%2014.0772%209.90532%2014.4098C9.64752%2013.6034%208.89192%2013.0194%207.99992%2013.0194C7.10792%2013.0194%206.35232%2013.6034%206.09452%2014.4098Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.99984%2010.3542C9.2885%2010.3542%2010.3332%209.3095%2010.3332%208.02083C10.3332%206.73217%209.2885%205.6875%207.99984%205.6875C6.71117%205.6875%205.6665%206.73217%205.6665%208.02083C5.6665%209.3095%206.71117%2010.3542%207.99984%2010.3542Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e",HT="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",UT={class:"problem-optimization-form"},JT={class:"node-form-content"},zT={class:"gray-block"},KT={class:"gray-block-title"},GT={class:"model-setting-form"},WT={class:"model-label"},ZT={class:"model-content"},YT={class:"model-setting-form"},QT={class:"model-label"},XT={class:"model-content"},ej={class:"model-setting-form"},tj={class:"model-label"},sj={class:"model-content"},oj={key:0,class:"model-setting-form"},nj={class:"model-label"},aj={class:"model-content"},lj={key:1,class:"model-setting-form"},ij={class:"model-label"},rj={class:"model-content"},dj={key:0,class:"gray-block mt16"},uj={class:"gray-block-title"},cj={style:{width:"409px"},class:"flex-between-box"},_j={class:"array-form-box"},pj={class:"flex-block-item"},fj={class:"field-list-item"},vj={class:"field-label"},hj={class:"field-type"},mj=["onClick"],gj={class:"gray-block mt16"},yj={class:"gray-block-title"},bj={class:"key-label"},kj={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.image-generation-node-form.index"),a=n,l=e,i=ye(()=>[{label:o("label_show"),value:"1"},{label:o("label_hide"),value:"0"}]),r=ye(()=>[{label:o("label_enable"),value:"1"},{label:o("label_disable"),value:"0"}]),u=U([]),y=be("getNode"),p=we({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[{value:"",key:nt(16)}],image_watermark:"1",image_optimize_prompt:"1"}),m=U(null),v=U(null),C=()=>{m.value.refresh()},g=()=>{v.value.show()},$=ye(()=>{let le=[];if(p.image_num>0)for(let J=0;J<+p.image_num;J++){let P=String.fromCharCode(97+J);le.push(`picture_url_${P}`)}return le}),w=()=>{p.size=void 0,p.image_num="1",p.input_images=[{value:"",key:nt(16)}]},S=ye(()=>uf(p.model_config_id,p.use_model,"IMAGE")||{}),k=ye(()=>S.value.image_generation?JSON.parse(S.value.image_generation):{}),b=Xp(),x=ye(()=>k.value.image_sizes?k.value.image_sizes.split(",").map(le=>b.find(J=>J.value==le)):[]),A=ye(()=>+k.value.image_max||1),R=ye(()=>k.value.image_optimize_prompt=="1"),E=ye(()=>k.value.image_watermark=="1"),B=ye(()=>+k.value.image_inputs_image_max||1),N=()=>{let le=[{key:"msg",typ:"string"}];$.value.forEach(P=>{le.push({key:P,typ:"string"})});const J=JSON.stringify({image_generation:{...p,image_num:p.image_num>0?p.image_num+"":"1",input_images:p.input_images.map(P=>P.value).filter(Boolean),output:le}});a("update-node",{...l.node,node_params:J})},I=()=>{try{let le=l.node.dataRaw||l.node.node_params||"{}",J=JSON.parse(le).image_generation||{};O(),j(),J=JSON.parse(JSON.stringify(J)),p.model_config_id=J.model_config_id,p.use_model=J.use_model,p.size=J.size,p.image_num=J.image_num,p.prompt=J.prompt,p.prompt_tags=J.prompt_tags,p.input_images=J.input_images.map(P=>({value:P,key:nt(16)})),p.image_watermark=J.image_watermark,p.image_optimize_prompt=J.image_optimize_prompt}catch(le){}},L=U([]),q=le=>{le&&O()},O=()=>{let le=y().getAllParentVariable();L.value=le||[]},M=(le,J)=>{p.prompt_tags=J,p.prompt=le},j=()=>{const le=l.lf.getNodeModelById(l.nodeId);if(le){let J=le.getAllParentVariable();J.forEach(P=>{P.tags=P.tags||[]}),u.value=J}},V=we({}),z=(le,J,P)=>{if(le){let W=`at_input_${J}_${P}`;V[W]=le}},H=(le,J,P)=>{P.tags=J,P.value=le},K=()=>{if(p.input_images.length>=B.value)return Me.error(o("msg_max_images_limit",{val:B.value}));p.input_images.push({value:"",key:nt(16)})},F=le=>{p.input_images.splice(le,1)};Ie(()=>p,()=>{N()},{deep:!0});const Y=()=>{a("close")};return Ne(()=>{I()}),(le,J)=>{const P=et,W=Ye,Q=ct,X=Vt,de=Dn,Fe=Dt,De=rt,$e=Tt,Ue=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_generate_image"),onClose:Y},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",UT,[s("div",JT,[c(Ue,{ref:"formRef",layout:"vertical",model:p},{default:f(()=>[s("div",zT,[s("div",KT,[J[8]||(J[8]=s("img",{src:qT,alt:""},null,-1)),T(_(d(o)("label_model_settings")),1)]),s("div",GT,[s("div",WT,_(d(o)("label_model")),1),s("div",ZT,[c(Gs,{modelType:"IMAGE",modeName:p.use_model,"onUpdate:modeName":J[0]||(J[0]=ie=>p.use_model=ie),modeId:p.model_config_id,"onUpdate:modeId":J[1]||(J[1]=ie=>p.model_config_id=ie),onChange:w},null,8,["modeName","modeId"])])]),s("div",YT,[s("div",QT,_(d(o)("label_ratio")),1),s("div",XT,[c(W,{placeholder:d(o)("ph_select"),value:p.size,"onUpdate:value":J[2]||(J[2]=ie=>p.size=ie),style:{width:"100%"}},{default:f(()=>[(h(!0),D(ee,null,se(x.value,ie=>(h(),G(P,{value:ie.value,key:ie.value},{default:f(()=>[T(_(ie.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value"])])]),s("div",ej,[s("div",tj,[T(_(d(o)("label_max_count"))+" ",1),c(Q,null,{title:f(()=>[T(_(d(o)("tip_max_count")),1)]),default:f(()=>[c(d(Re))]),_:1})]),s("div",sj,[c(X,{placeholder:d(o)("ph_select"),style:{width:"100%"},value:p.image_num,"onUpdate:value":J[3]||(J[3]=ie=>p.image_num=ie),min:1,max:A.value},null,8,["placeholder","value","max"])])]),E.value?(h(),D("div",oj,[s("div",nj,_(d(o)("label_watermark")),1),s("div",aj,[c(de,{class:"customer-segmented",value:p.image_watermark,"onUpdate:value":J[4]||(J[4]=ie=>p.image_watermark=ie),options:i.value},null,8,["value","options"])])])):Z("",!0),R.value?(h(),D("div",lj,[s("div",ij,_(d(o)("label_optimize_prompt")),1),s("div",rj,[c(de,{class:"customer-segmented",value:p.image_optimize_prompt,"onUpdate:value":J[5]||(J[5]=ie=>p.image_optimize_prompt=ie),options:r.value},null,8,["value","options"])])])):Z("",!0)]),S.value.input_image==1||S.value.input_text==1?(h(),D("div",dj,[s("div",uj,[J[9]||(J[9]=s("img",{src:HT,alt:""},null,-1)),T(_(d(o)("label_input")),1)]),S.value.input_text==1?(h(),G(Fe,{key:0,name:"use_model"},{label:f(()=>[s("div",cj,[s("div",null,_(d(o)("label_prompt")),1),s("div",{class:"btn-hover-wrap",onClick:g},[c(d(Wt))])])]),default:f(()=>[c(xe,{options:L.value,defaultSelectedList:p.prompt_tags,defaultValue:p.prompt,ref_key:"promptInputRef",ref:m,placeholder:d(o)("ph_input_message"),"input-style":"height: 76px",type:"textarea",onOpen:q,onChange:J[6]||(J[6]=(ie,ge)=>M(ie,ge))},null,8,["options","defaultSelectedList","defaultValue","placeholder"])]),_:1})):Z("",!0),S.value.input_image==1?(h(),G(Fe,{key:1,label:d(o)("label_reference_image"),name:"use_model"},{default:f(()=>[c($e,null,{default:f(()=>[s("div",_j,[(h(!0),D(ee,null,se(p.input_images,(ie,ge)=>(h(),D("div",{class:"form-item-list",key:ie.key},[s("div",pj,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:ve=>z(ve,"input_images",ge),options:u.value,defaultSelectedList:ie.tags,defaultValue:ie.value,onOpen:j,onChange:(ve,he)=>H(ve,he,ie),placeholder:d(o)("ph_input_value")},{option:f(({label:ve,payload:he})=>[s("div",fj,[s("div",vj,_(ve),1),s("div",hj,_(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"]),s("div",{class:"btn-hover-wrap",onClick:ve=>F(ge)},[c(d(at))],8,mj)])]))),128)),c(De,{onClick:K,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_reference_image")),1)]),_:1},8,["icon"])])]),_:1})]),_:1},8,["label"])):Z("",!0)])):Z("",!0),s("div",gj,[s("div",yj,[J[10]||(J[10]=s("img",{src:en,alt:""},null,-1)),T(_(d(o)("label_output")),1)]),J[12]||(J[12]=s("div",{class:"output-item"},[s("div",{class:"key-label"},"msg"),s("div",{class:"key-value"},"string")],-1)),(h(!0),D(ee,null,se($.value,ie=>(h(),D("div",{class:"output-item",key:ie},[s("div",bj,_(ie),1),J[11]||(J[11]=s("div",{class:"key-value"},"string",-1))]))),128))])]),_:1},8,["model"])])]),c(js,{options:L.value,defaultSelectedList:p.prompt_tags,defaultValue:p.prompt,placeholder:d(o)("ph_input_message"),"input-style":"height: 76px",type:"textarea",onOpen:q,onChange:J[7]||(J[7]=(ie,ge)=>M(ie,ge)),onOk:C,ref_key:"fullAtInputRef",ref:v},null,8,["options","defaultSelectedList","defaultValue","placeholder"])]),_:1})}}},wj=_e(kj,[["__scopeId","data-v-39ad1480"]]),Cj={class:"problem-optimization-form"},$j={class:"node-form-content"},xj={class:"gray-block"},Sj={class:"model-setting-form"},Dj={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.explain-node-form.index"),a=n,l=e,i=we({content:""}),r=()=>{const p=JSON.stringify({...i});a("update-node",{...l.node,node_params:p})},u=()=>{try{let p=l.node.dataRaw||l.node.node_params||"{}",m=JSON.parse(p);i.content=m.content}catch(p){}};Ie(()=>i,()=>{r()},{deep:!0});const y=()=>{a("close")};return Ne(()=>{u()}),(p,m)=>{const v=Ts,C=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:"",onClose:y},null,8,["title","iconName"])]),default:f(()=>[s("div",Cj,[s("div",$j,[c(C,{ref:"formRef",layout:"vertical",model:i},{default:f(()=>[s("div",xj,[m[1]||(m[1]=s("div",{class:"gray-block-title"},null,-1)),s("div",Sj,[c(v,{style:{"min-height":"300px"},value:i.content,"onUpdate:value":m[0]||(m[0]=g=>i.content=g),valueModifiers:{trim:!0},"auto-size":"",placeholder:d(o)("ph_input_comment")},null,8,["value","placeholder"])])])]),_:1},8,["model"])])])]),_:1})}}},Aj=_e(Dj,[["__scopeId","data-v-e735e841"]]),xl={__name:"add-key-modal",props:{request_content_type:{type:String,default:""},level:{type:Number,default:1}},emits:["add","edit","addSub"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.webhook-trigger-node-form.add-key-modal"),l=o,i=e,r=ye(()=>{if(i.request_content_type=="multipart/form-data")return[{lable:"string",value:"string"},{lable:"file",value:"file"}];if(i.request_content_type=="application/x-www-form-urlencoded")return[{lable:"string",value:"string"}];if(i.request_content_type=="application/json"){let x=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return i.level>=2?x.filter(A=>A.value!="object"):x}return[{lable:"string",value:"string"}]}),u=U(!1),y=U(a("title_add_param"));let p="add";const m=(x,A)=>A?/^[a-zA-Z_]+$/.test(A)?Promise.resolve():Promise.reject(a("msg_only_letters_underscore")):Promise.reject(a("msg_enter_key"));let v=0;const C=we({key:"",typ:"string",cu_key:"",desc:void 0,subs:[]}),g=()=>{C.typ="string",u.value=!0},$=()=>{Object.assign(C,{key:"",typ:"string",cu_key:nt(16),subs:[]}),p="add",y.value=a("title_add_param"),u.value=!0},w=x=>{v=x,Object.assign(C,{key:"",typ:"string",cu_key:nt(16),subs:[]}),p="addSub",y.value=a("title_add_param"),u.value=!0},S=(x,A)=>{v=A,Object.assign(C,{key:"",typ:"string",cu_key:nt(16),subs:[]}),Object.assign(C,{...x}),p="edit",y.value=a("title_edit_param"),u.value=!0},k=U(null),b=()=>{k.value.validate().then(()=>{p=="add"&&l("add",{...C}),p=="addSub"&&l("addSub",{...C},v),p=="edit"&&l("edit",{...C},v),u.value=!1})};return n({show:g,add:$,edit:S,addSub:w}),(x,A)=>{const R=pt,E=Dt,B=et,N=Ye,I=St,L=wt;return h(),D("div",null,[c(L,{open:u.value,"onUpdate:open":A[2]||(A[2]=q=>u.value=q),title:y.value,onOk:b,width:472,"ok-text":d(a)("btn_confirm"),"cancel-text":d(a)("btn_cancel")},{default:f(()=>[c(I,{ref_key:"formRef",ref:k,layout:"vertical",model:C,style:{margin:"24px 0"}},{default:f(()=>[c(E,{label:d(a)("label_param_key"),name:"key",rules:[{required:!0,validator:(q,O)=>m(q,O)}]},{default:f(()=>[c(R,{value:C.key,"onUpdate:value":A[0]||(A[0]=q=>C.key=q),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["label","rules"]),c(E,{label:d(a)("label_param_type"),name:"typ",rules:[{required:!0,message:d(a)("msg_select_type")}]},{default:f(()=>[c(N,{value:C.typ,"onUpdate:value":A[1]||(A[1]=q=>C.typ=q),placeholder:d(a)("ph_select"),style:{width:"100%"}},{default:f(()=>[(h(!0),D(ee,null,se(r.value,q=>(h(),G(B,{value:q.value},{default:f(()=>[T(_(q.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","placeholder"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["open","title","ok-text","cancel-text"])])}}},Oj={class:"sub-field-item"},Nj={class:"key-title-item"},Bj={class:"typ-title-item"},Ej={class:"value-title-item"},Ij=["onClick"],Fj=["onClick"],Rj=["onClick"],Lj={__name:"subs-key",props:{data:{},level:{type:Number},globalOptions:{type:Array},request_content_type:{type:String,default:""}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.webhook-trigger-node-form.subs-key"),o=e;ye(()=>o.level>2?C.filter(g=>g.value!="object"):C);let a=0;const l=(g,$)=>{$.splice(g,1)},i=U(null),r=g=>{a=g,i.value.add()},u=(g,$)=>{i.value.edit(g,$)},y=g=>{o.data[a].subs.push(g)},p=(g,$)=>{o.data[$].typ!=g.typ&&(g.desc=void 0),o.data.splice($,1,g)},m=g=>g.typ=="object"&&o.level<=2,v=g=>{let $=g.typ;return $=="file"&&($="string"),$?o.globalOptions.filter(w=>w.typ==$):o.globalOptions};let C=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return(g,$)=>{const w=et,S=Ye,k=tt("SubsKey",!0);return h(),D(ee,null,[(h(!0),D(ee,null,se(o.data,(b,x)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${o.level}`]),key:b.cu_key},[s("div",Oj,[$[0]||($[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),s("div",Nj,_(b.key),1),s("div",Bj,_(b.typ),1),s("div",Ej,[b.typ!="object"?(h(),G(S,{key:0,placeholder:d(n)("ph_select_variable"),value:b.desc,"onUpdate:value":A=>b.desc=A,style:{width:"90%"}},{default:f(()=>[(h(!0),D(ee,null,se(v(b),A=>(h(),G(w,{value:A.value,key:A.key},{default:f(()=>[s("span",null,_(A.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["placeholder","value","onUpdate:value"])):Z("",!0)]),m(b)?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:A=>r(x,o.data)},[c(d(Mt))],8,Ij)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:A=>u(b,x)},[c(d(eo))],8,Fj),s("div",{class:"btn-hover-wrap",onClick:A=>l(x,o.data)},[c(d(at))],8,Rj)]),b.subs&&b.subs.length>0?(h(),G(k,{key:0,request_content_type:o.request_content_type,level:o.level+1,data:b.subs,globalOptions:o.globalOptions},null,8,["request_content_type","level","data","globalOptions"])):Z("",!0)],2))),128)),c(xl,{onAdd:y,level:o.level,request_content_type:o.request_content_type,onEdit:p,ref_key:"addParamsModalRef",ref:i},null,8,["level","request_content_type"])],64)}}},Na=_e(Lj,[["__scopeId","data-v-37e48ef6"]]),Vj={class:"variable-node"},Mj={class:"node-form-content"},Tj={class:"gray-block"},jj={class:"mt8"},Pj={class:"array-form-box"},qj={class:"form-item-label"},Hj={class:"flex-block-item"},Uj={class:"at-input-flex1"},Jj=["onClick"],zj={key:0,class:"array-form-box"},Kj={class:"array-form-box"},Gj={class:"th-header-block"},Wj={class:"td-title",style:{width:"180px"}},Zj={class:"td-title",style:{width:"90px"}},Yj={class:"td-title",style:{width:"160px"}},Qj={class:"td-title",style:{flex:"1"}},Xj={class:"key-block-item"},eP={class:"key-item",style:{width:"180px"}},tP={class:"key-item",style:{width:"90px"}},sP={class:"key-item",style:{width:"160px"}},oP={class:"key-item btn-block",style:{flex:"1"}},nP=["onClick"],aP=["onClick"],lP=["onClick"],iP={key:0,class:"sub-field-box"},rP={class:"mt8"},dP={key:1,class:"array-form-box"},uP={class:"array-form-box"},cP={class:"th-header-block"},_P={class:"td-title",style:{width:"180px"}},pP={class:"td-title",style:{width:"90px"}},fP={class:"td-title",style:{width:"160px"}},vP={class:"td-title",style:{flex:"1"}},hP={class:"key-block-item"},mP={class:"key-item",style:{width:"180px"}},gP={class:"key-item",style:{width:"90px"}},yP={class:"key-item",style:{width:"160px"}},bP={class:"key-item btn-block",style:{flex:"1"}},kP=["onClick"],wP=["onClick"],CP={class:"mt8"},$P={key:2,class:"array-form-box"},xP={class:"array-form-box"},SP={class:"th-header-block"},DP={class:"td-title",style:{width:"180px"}},AP={class:"td-title",style:{width:"90px"}},OP={class:"td-title",style:{width:"160px"}},NP={class:"td-title",style:{flex:"1"}},BP={class:"key-block-item"},EP={class:"key-item",style:{width:"180px"}},IP={class:"key-item",style:{width:"90px"}},FP={class:"key-item",style:{width:"160px"}},RP={class:"key-item btn-block",style:{flex:"1"}},LP=["onClick"],VP=["onClick"],MP=["onClick"],TP={key:0,class:"sub-field-box"},jP={class:"mt8"},PP={class:"gray-block mt16"},qP={key:0,class:"mt8"},HP={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.webhook-trigger-node-form.index"),a=n,l=e,i=we({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""});Ie(()=>i,()=>{p()},{deep:!0}),be("getNode");const r=be("getGraph"),u=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...l.node})},10)},y=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},p=()=>{let q=JSON.parse(l.node.node_params);q.trigger.trigger_web_hook_config={...i};let O={...l.node,node_params:JSON.stringify(q)};a("update-node",O),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",O)},10)},m=()=>{try{let q=l.node.dataRaw||l.node.node_params||"{}";q=JSON.parse(q),C();let O=q.trigger.trigger_web_hook_config;i.url=O.url,i.method=O.method||"GET",i.switch_verify=O.switch_verify||"1",i.switch_allow_ip=O.switch_allow_ip||"0",i.allow_ips=O.allow_ips?O.allow_ips.split(",").join(`
`):"",i.params=O.params||[],i.form=O.form||[],i.x_form=O.x_form||[],i.json=O.json||[],i.request_content_type=O.request_content_type||"none",i.response_type=O.response_type||"now",i.response_now=O.response_now||""}catch(q){}},v=U([]);function C(){const q=l.lf.getNodeModelById(l.nodeId);if(q){let M=q.getGlobalVariable().diy_global||[];M.forEach(j=>{j.label=j.key,j.value="global."+j.key}),v.value=M||[]}}const g=ye(()=>v.value.filter(q=>q.typ=="string")),$=q=>{q&&C()},w=q=>{let O=q.typ;return O=="file"&&(O="string"),O?v.value.filter(M=>M.typ==O):v.value},S=()=>{i.params.push({key:"",typ:"string",desc:void 0})},k=q=>{i.params.splice(q,1)},b=(q,O)=>{i[O].splice(q,1)},x=U(null),A=()=>{x.value.add()},R=q=>{x.value.addSub(q)},E=(q,O)=>{x.value.edit(q,O)},B=q=>{i.request_content_type=="multipart/form-data"&&i.form.push(q),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.push(q),i.request_content_type=="application/json"&&i.json.push(q)},N=(q,O)=>{i.request_content_type=="multipart/form-data"&&i.form.splice(O,1,q),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.splice(O,1,q),i.request_content_type=="application/json"&&i.json.splice(O,1,q)},I=(q,O)=>{i.request_content_type=="multipart/form-data"&&(i.form[O].subs||(i.form[O].subs=[]),i.form[O].subs.push(q)),i.request_content_type=="application/x-www-form-urlencoded"&&(i.x_form[O].subs||(i.x_form[O].subs=[]),i.x_form[O].subs.push(q)),i.request_content_type=="application/json"&&(i.json[O].subs||(i.json[O].subs=[]),i.json[O].subs.push(q))},L=()=>{bo(i.url),Me.success(o("msg_copy_success"))};return Ne(()=>{m()}),(q,O)=>{const M=et,j=Ye,V=pt,z=rt,H=bi,K=Dt,F=Qt,Y=Yt,le=Ts,J=Tt,P=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,onChangeTitle:u,onDeleteNode:y,desc:d(o)("desc_webhook_trigger")},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",Vj,[s("div",Mj,[c(P,{ref:"formRef",layout:"vertical",model:i},{default:f(()=>[s("div",Tj,[c(K,{label:d(o)("label_request_url")},{default:f(()=>[c(H,{compact:""},{default:f(()=>[c(j,{value:i.method,"onUpdate:value":O[0]||(O[0]=W=>i.method=W),style:{width:"20%"}},{default:f(()=>[c(M,{value:"POST"},{default:f(()=>[...O[9]||(O[9]=[T("POST",-1)])]),_:1}),c(M,{value:"GET"},{default:f(()=>[...O[10]||(O[10]=[T("GET",-1)])]),_:1})]),_:1},8,["value"]),c(V,{readonly:"",value:i.url,"onUpdate:value":O[1]||(O[1]=W=>i.url=W),style:{width:"65%"}},null,8,["value"]),c(z,{onClick:O[2]||(O[2]=W=>L()),style:{width:"15%"},type:"primary"},{default:f(()=>[T(_(d(o)("btn_copy")),1)]),_:1})]),_:1})]),_:1},8,["label"]),c(K,{label:d(o)("label_auth")},{default:f(()=>[c(Y,{value:i.switch_verify,"onUpdate:value":O[3]||(O[3]=W=>i.switch_verify=W)},{default:f(()=>[c(F,{value:"1"},{default:f(()=>[T(_(d(o)("label_need_auth")),1)]),_:1}),c(F,{value:"0"},{default:f(()=>[T(_(d(o)("label_no_auth")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),c(K,{label:d(o)("label_ip_whitelist")},{default:f(()=>[c(Y,{value:i.switch_allow_ip,"onUpdate:value":O[4]||(O[4]=W=>i.switch_allow_ip=W)},{default:f(()=>[c(F,{value:"0"},{default:f(()=>[T(_(d(o)("label_not_enable")),1)]),_:1}),c(F,{value:"1"},{default:f(()=>[T(_(d(o)("label_enable")),1)]),_:1})]),_:1},8,["value"]),s("div",jj,[c(le,{value:i.allow_ips,"onUpdate:value":O[5]||(O[5]=W=>i.allow_ips=W),style:{"min-height":"74px"},placeholder:d(o)("ph_input_ip")},null,8,["value","placeholder"])])]),_:1},8,["label"]),s("div",Pj,[s("div",qj,_(d(o)("label_params")),1),(h(!0),D(ee,null,se(i.params,(W,Q)=>(h(),D("div",{class:"form-item-list",key:Q},[c(K,{label:null},{default:f(()=>[s("div",Hj,[c(J,null,{default:f(()=>[c(V,{style:{width:"120px"},value:W.key,"onUpdate:value":X=>W.key=X,placeholder:d(o)("ph_input_key")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1024),s("div",Uj,[c(j,{style:{width:"100%"},placeholder:d(o)("ph_select_variable"),value:W.desc,"onUpdate:value":X=>W.desc=X,onDropdownVisibleChange:$},{default:f(()=>[(h(!0),D(ee,null,se(g.value,X=>(h(),G(M,{value:X.value,key:X.key},{default:f(()=>[s("span",null,_(X.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onUpdate:value"])]),s("div",{class:"btn-hover-wrap",onClick:X=>k(Q)},[c(d(at))],8,Jj)])]),_:2},1024)]))),128)),c(z,{onClick:S,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_param")),1)]),_:1},8,["icon"])]),i.method=="POST"?(h(),D(ee,{key:0},[c(K,{label:d(o)("label_body")},{default:f(()=>[c(Y,{value:i.request_content_type,"onUpdate:value":O[6]||(O[6]=W=>i.request_content_type=W)},{default:f(()=>[c(F,{value:"none"},{default:f(()=>[...O[11]||(O[11]=[T("none",-1)])]),_:1}),c(F,{value:"multipart/form-data"},{default:f(()=>[...O[12]||(O[12]=[T("form-data",-1)])]),_:1}),c(F,{value:"application/x-www-form-urlencoded"},{default:f(()=>[...O[13]||(O[13]=[T("x-www-form-urlencoded",-1)])]),_:1}),c(F,{value:"application/json"},{default:f(()=>[...O[14]||(O[14]=[T("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),i.request_content_type=="multipart/form-data"?(h(),D("div",zj,[s("div",Kj,[s("div",Gj,[s("div",Wj,_(d(o)("label_key")),1),s("div",Zj,_(d(o)("label_value_type")),1),s("div",Yj,_(d(o)("label_all_variables")),1),s("div",Qj,_(d(o)("label_operation")),1)]),(h(!0),D(ee,null,se(i.form,(W,Q)=>(h(),D("div",{class:"form-item-list",key:Q},[c(K,{label:null},{default:f(()=>[s("div",Xj,[s("div",eP,_(W.key),1),s("div",tP,_(W.typ),1),s("div",sP,[c(j,{placeholder:d(o)("ph_select_variable"),value:W.desc,"onUpdate:value":X=>W.desc=X,style:{width:"90%"},onDropdownVisibleChange:$},{default:f(()=>[(h(!0),D(ee,null,se(w(W),X=>(h(),G(M,{value:X.value,key:X.key},{default:f(()=>[s("span",null,_(X.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["placeholder","value","onUpdate:value"])]),s("div",oP,[W.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:X=>R(Q)},[c(d(Mt))],8,nP)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:X=>E(W,Q)},[c(d(eo))],8,aP),s("div",{class:"btn-hover-wrap",onClick:X=>b(Q,"form")},[c(d(at))],8,lP)])]),W.subs&&W.subs.length>0?(h(),D("div",iP,[c(J,null,{default:f(()=>[c(Na,{data:W.subs,request_content_type:i.request_content_type,level:2,globalOptions:v.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):Z("",!0)]),_:2},1024)]))),128))]),s("div",rP,[c(z,{onClick:A,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("label_add_param")),1)]),_:1},8,["icon"])])])):Z("",!0),i.request_content_type=="application/x-www-form-urlencoded"?(h(),D("div",dP,[s("div",uP,[s("div",cP,[s("div",_P,_(d(o)("label_key")),1),s("div",pP,_(d(o)("label_value_type")),1),s("div",fP,_(d(o)("label_all_variables")),1),s("div",vP,_(d(o)("label_operation")),1)]),(h(!0),D(ee,null,se(i.x_form,(W,Q)=>(h(),D("div",{class:"form-item-list",key:Q},[c(K,{label:null},{default:f(()=>[s("div",hP,[s("div",mP,_(W.key),1),s("div",gP,_(W.typ),1),s("div",yP,[c(j,{placeholder:d(o)("ph_select_variable"),value:W.desc,"onUpdate:value":X=>W.desc=X,style:{width:"90%"},onDropdownVisibleChange:$},{default:f(()=>[(h(!0),D(ee,null,se(w(W),X=>(h(),G(M,{value:X.value,key:X.key},{default:f(()=>[s("span",null,_(X.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["placeholder","value","onUpdate:value"])]),s("div",bP,[s("div",{class:"btn-hover-wrap",onClick:X=>E(W,Q)},[c(d(eo))],8,kP),s("div",{class:"btn-hover-wrap",onClick:X=>b(Q,"x_form")},[c(d(at))],8,wP)])])]),_:2},1024)]))),128))]),s("div",CP,[c(z,{onClick:A,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("label_add_param")),1)]),_:1},8,["icon"])])])):Z("",!0),i.request_content_type=="application/json"?(h(),D("div",$P,[s("div",xP,[s("div",SP,[s("div",DP,_(d(o)("label_key")),1),s("div",AP,_(d(o)("label_value_type")),1),s("div",OP,_(d(o)("label_all_variables")),1),s("div",NP,_(d(o)("label_operation")),1)]),(h(!0),D(ee,null,se(i.json,(W,Q)=>(h(),D("div",{class:"form-item-list",key:Q},[c(K,{label:null},{default:f(()=>[s("div",BP,[s("div",EP,_(W.key),1),s("div",IP,_(W.typ),1),s("div",FP,[W.typ!="object"?(h(),G(j,{key:0,placeholder:d(o)("ph_select_variable"),value:W.desc,"onUpdate:value":X=>W.desc=X,style:{width:"90%"},onDropdownVisibleChange:$},{default:f(()=>[(h(!0),D(ee,null,se(w(W),X=>(h(),G(M,{value:X.value,key:X.key},{default:f(()=>[s("span",null,_(X.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["placeholder","value","onUpdate:value"])):Z("",!0)]),s("div",RP,[W.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:X=>R(Q)},[c(d(Mt))],8,LP)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:X=>E(W,Q)},[c(d(eo))],8,VP),s("div",{class:"btn-hover-wrap",onClick:X=>b(Q,"json")},[c(d(at))],8,MP)])]),W.subs&&W.subs.length>0?(h(),D("div",TP,[c(J,null,{default:f(()=>[c(Na,{data:W.subs,request_content_type:i.request_content_type,level:2,globalOptions:v.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):Z("",!0)]),_:2},1024)]))),128))]),s("div",jP,[c(z,{onClick:A,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("label_add_param")),1)]),_:1},8,["icon"])])])):Z("",!0)],64)):Z("",!0)]),s("div",PP,[c(K,{label:d(o)("label_response")},{default:f(()=>[c(Y,{value:i.response_type,"onUpdate:value":O[7]||(O[7]=W=>i.response_type=W)},{default:f(()=>[c(F,{value:"message_variable"},{default:f(()=>[T(_(d(o)("label_return_after_end")),1)]),_:1}),c(F,{value:"now"},{default:f(()=>[T(_(d(o)("label_return_now")),1)]),_:1})]),_:1},8,["value"]),i.response_type=="now"?(h(),D("div",qP,[c(le,{value:i.response_now,"onUpdate:value":O[8]||(O[8]=W=>i.response_now=W),style:{"min-height":"74px"},placeholder:d(o)("ph_input_response")},null,8,["value","placeholder"])])):Z("",!0)]),_:1},8,["label"])])]),_:1},8,["model"]),c(xl,{request_content_type:i.request_content_type,onAdd:B,onEdit:N,onAddSub:I,ref_key:"addKeyModalRef",ref:x},null,8,["request_content_type"])])])]),_:1})}}},UP=_e(HP,[["__scopeId","data-v-6ded2b1c"]]),JP={class:"import-library-node-form"},zP={class:"node-form-content"},KP={class:"gray-block"},GP={class:"gray-block-title"},WP={class:"avatar-box"},ZP=["src"],YP={class:"content-box"},QP={class:"list-name"},XP={class:"list-intro"},eq=["onClick"],tq={class:"btn-block"},sq={class:"gray-block mt16"},oq={class:"gray-block-title"},nq={key:0,class:"flex-block-item"},aq={class:"form-item-label required"},lq={class:"form-content-box flex1"},iq={class:"field-list-item"},rq={class:"field-label"},dq={class:"field-type"},uq={key:1,class:"flex-block-item"},cq={class:"form-item-label required"},_q={class:"form-content-box flex1"},pq={class:"field-list-item"},fq={class:"field-label"},vq={class:"field-type"},hq={key:2,class:"flex-block-item"},mq={class:"form-item-label"},gq={class:"form-content-box flex1"},yq={class:"field-list-item"},bq={class:"field-label"},kq={class:"field-type"},wq={class:"flex-block-item"},Cq={class:"form-item-label required"},$q={class:"form-content-box flex1"},xq={class:"field-list-item"},Sq={class:"field-label"},Dq={class:"field-type"},Aq={class:"flex-block-item"},Oq={class:"form-item-label required"},Nq={class:"form-content-box flex1"},Bq={class:"field-list-item"},Eq={class:"field-label"},Iq={class:"field-type"},Fq={class:"flex-block-item"},Rq={class:"form-item-label"},Lq={class:"form-content-box flex1"},Vq={class:"field-list-item"},Mq={class:"field-label"},Tq={class:"field-type"},jq={class:"flex-block-item"},Pq={class:"form-item-label"},qq={class:"form-content-box flex1"},Hq={class:"field-list-item"},Uq={class:"field-label"},Jq={class:"field-type"},zq={class:"gray-block mt16"},Kq={class:"gray-block-title"},Gq={class:"options-item"},Wq={class:"desc"},Zq={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.import-library-node-form.index"),a=n,l=e,i=ye(()=>[{label:o("label_import_content"),value:"content"},{label:o("label_import_url"),value:"url"}]),r=ye(()=>[{label:o("label_import_anyway"),value:"import"},{label:o("label_not_import"),value:"not import"},{label:o("label_update_content"),value:"update"}]),u=U({}),y=U([]),p=U([]),m=()=>{const O=l.lf.getNodeModelById(l.nodeId);if(O){let M=O.getAllParentVariable();M.forEach(j=>{j.tags=j.tags||[]}),y.value=M,p.value=v(M)}};function v(O){function M(j){const V=[];for(const z of j)if(z.children&&z.children.length>0){const H=M(z.children);if(H.length>0){const K={...z,children:H};V.push(K)}}else z.typ&&z.typ==="array<string>"&&V.push({...z});return V}return M(O)}const C=U(null),g=we({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),$=()=>{const O=JSON.stringify({library_import:{...g,library_id:g.library_id.join(",")}});a("update-node",{...l.node,node_params:O})},w=()=>{try{let O=l.node.dataRaw||l.node.node_params||"{}",M=JSON.parse(O).library_import||{};m(),M=JSON.parse(JSON.stringify(M));for(let j in M)j=="library_id"?g.library_id=M[j]?M[j].split(","):[]:g[j]=M[j];nl({ability_type:"library_ability_official_account"}).then(j=>{var z;let V=(j==null?void 0:j.data)||{};((z=V==null?void 0:V.user_config)==null?void 0:z.switch_status)==1&&(C.value=V)}),setTimeout(()=>{I()},300)}catch(O){}},S=ye(()=>{let O=g.library_id[0],M=[{group_name:"未分组",id:"0"}];return O&&u.value[O]||M}),k=U([]),b=U(null),x=ye(()=>k.value.filter(O=>C.value?g.library_id.includes(O.id):g.library_id.includes(O.id)&&O.type!=3)),A=ye(()=>x.value&&x.value.length?x.value[0].type:-1),R=O=>{let M=g.library_id.indexOf(O.id);g.library_id.splice(M,1)},E=O=>{N(),g.library_id=[...O],g.library_group_id="0",Ze(()=>{I()})},B=()=>{b.value.open([...g.library_id])},N=async()=>{const O=await Vo({type:""});O&&(k.value=O.data||[])},I=()=>{Ze(()=>{g.library_id.length!=0&&Jl({group_type:A.value==0?1:0,library_id:g.library_id[0]}).then(O=>{u.value={...u.value,[g.library_id[0]]:O.data}})})},L=(O,M,j)=>{g[j]=O};Ie(()=>g,()=>{$()},{deep:!0}),Ie(()=>g.library_id,()=>{I()},{deep:!0});const q=()=>{a("close")};return Ne(()=>{w(),N()}),(O,M)=>{const j=It,V=rt,z=Dt,H=et,K=Ye,F=Dn,Y=ct,le=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_import_library"),onClose:q},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",JP,[s("div",zP,[c(le,{ref:"formRef",layout:"vertical",model:g},{default:f(()=>[s("div",KP,[s("div",GP,[c(j,{name:"nav-library",style:{"font-size":"14px",color:"#333"}}),T(" "+_(d(o)("label_library")),1)]),c(z,{label:null},{default:f(()=>[(h(!0),D(ee,null,se(x.value,J=>(h(),D("div",{class:"konwledge-list-item",key:J.id},[s("div",WP,[s("img",{src:J.avatar,alt:""},null,8,ZP)]),s("div",YP,[s("div",QP,_(J.library_name),1),s("div",XP,_(J.library_intro),1)]),s("div",{class:"btn-hover-wrap",onClick:P=>R(J)},[c(d(at))],8,eq)]))),128)),s("div",tq,[s("div",null,[c(V,{onClick:B,icon:Qe(d(Xe)),block:"",type:"dashed"},{default:f(()=>[T(_(d(o)("btn_add_library")),1)]),_:1},8,["icon"])])])]),_:1}),c(z,{label:d(o)("label_library_group")},{default:f(()=>[c(K,{value:g.library_group_id,"onUpdate:value":M[0]||(M[0]=J=>g.library_group_id=J),style:{width:"100%"},placeholder:d(o)("ph_select")},{default:f(()=>[(h(!0),D(ee,null,se(S.value,J=>(h(),G(H,{value:J.id,key:J.id},{default:f(()=>[T(_(J.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),A.value!=2&&A.value>=0?(h(),G(z,{key:0,label:d(o)("label_import_type")},{default:f(()=>[c(F,{class:"customer-segmented",value:g.import_type,"onUpdate:value":M[1]||(M[1]=J=>g.import_type=J),options:i.value},null,8,["value","options"])]),_:1},8,["label"])):Z("",!0),A.value==2?(h(),G(z,{key:1,label:d(o)("label_qa_repeat")},{default:f(()=>[c(F,{class:"customer-segmented",value:g.qa_repeat_op,"onUpdate:value":M[2]||(M[2]=J=>g.qa_repeat_op=J),options:r.value},null,8,["value","options"])]),_:1},8,["label"])):Z("",!0),A.value!=2&&A.value>=0&&g.import_type=="url"?(h(),G(z,{key:2,label:d(o)("label_url_repeat")},{default:f(()=>[c(F,{class:"customer-segmented",value:g.normal_url_repeat_op,"onUpdate:value":M[3]||(M[3]=J=>g.normal_url_repeat_op=J),options:r.value},null,8,["value","options"])]),_:1},8,["label"])):Z("",!0)]),s("div",sq,[s("div",oq,[c(j,{name:"input",style:{"font-size":"14px",color:"#333"}}),T(" "+_(d(o)("label_input")),1)]),A.value!=2&&A.value>=0?(h(),D(ee,{key:0},[g.import_type=="content"?(h(),D("div",nq,[s("div",aq,_(d(o)("label_document_title")),1),s("div",lq,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:y.value,defaultValue:g.normal_title,onOpen:m,onChange:M[4]||(M[4]=(J,P)=>L(J,P,"normal_title")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",iq,[s("div",rq,_(J),1),s("div",dq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])])):Z("",!0),g.import_type=="content"?(h(),D("div",uq,[s("div",cq,_(d(o)("label_document_content")),1),s("div",_q,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:y.value,defaultValue:g.normal_content,onOpen:m,onChange:M[5]||(M[5]=(J,P)=>L(J,P,"normal_content")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",pq,[s("div",fq,_(J),1),s("div",vq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])])):Z("",!0),g.import_type=="url"?(h(),D("div",hq,[s("div",mq,_(d(o)("label_document_url")),1),s("div",gq,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:y.value,defaultValue:g.normal_url,onOpen:m,onChange:M[6]||(M[6]=(J,P)=>L(J,P,"normal_url")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",yq,[s("div",bq,_(J),1),s("div",kq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])])):Z("",!0)],64)):Z("",!0),A.value==2?(h(),D(ee,{key:1},[s("div",wq,[s("div",Cq,_(d(o)("label_segment_question")),1),s("div",$q,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:y.value,defaultValue:g.qa_question,onOpen:m,onChange:M[7]||(M[7]=(J,P)=>L(J,P,"qa_question")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",xq,[s("div",Sq,_(J),1),s("div",Dq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])]),s("div",Aq,[s("div",Oq,_(d(o)("label_segment_answer")),1),s("div",Nq,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:y.value,defaultValue:g.qa_answer,onOpen:m,onChange:M[8]||(M[8]=(J,P)=>L(J,P,"qa_answer")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",Bq,[s("div",Eq,_(J),1),s("div",Iq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])]),s("div",Fq,[s("div",Rq,[T(_(d(o)("label_answer_images"))+" ",1),c(Y,{title:d(o)("tip_answer_images")},{default:f(()=>[c(d(Re))]),_:1},8,["title"])]),s("div",Lq,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:p.value,defaultValue:g.qa_images_variable,onOpen:m,onChange:M[9]||(M[9]=(J,P)=>L(J,P,"qa_images_variable")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",Vq,[s("div",Mq,_(J),1),s("div",Tq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])]),s("div",jq,[s("div",Pq,[T(_(d(o)("label_similar_questions"))+" ",1),c(Y,{title:d(o)("tip_similar_questions")},{default:f(()=>[c(d(Re))]),_:1},8,["title"])]),s("div",qq,[c(xe,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:p.value,defaultValue:g.qa_similar_question_variable,onOpen:m,onChange:M[10]||(M[10]=(J,P)=>L(J,P,"qa_similar_question_variable")),placeholder:d(o)("ph_input_value")},{option:f(({label:J,payload:P})=>[s("div",Hq,[s("div",Uq,_(J),1),s("div",Jq,_(P.typ),1)])]),_:1},8,["options","defaultValue","placeholder"])])])],64)):Z("",!0)]),s("div",zq,[s("div",Kq,[c(j,{name:"output",style:{"font-size":"14px",color:"#333"}}),T(" "+_(d(o)("label_output")),1)]),s("div",Gq,[M[11]||(M[11]=s("div",{class:"option-label"},"msg",-1)),s("div",Wq,_(d(o)("msg_output_description")),1)])])]),_:1},8,["model"]),c(dl,{ref_key:"librarySelectAlertRef",ref:b,showWxType:!!C.value,select_type:"radio",onChange:E},null,8,["showWxType"])])])]),_:1})}}},Yq=_e(Zq,[["__scopeId","data-v-fa583c3f"]]),Qq={class:"sub-field-item"},Xq=["onClick"],eH=["onClick"],tH={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.json-node-form.subs-key"),o=e,a=ye(()=>o.level>2?o.typOptions.filter(p=>p.value!="object"):o.typOptions),l=ye(()=>o.level==2?"180px":"146px"),i=(p,m)=>{m[p].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(p,m)=>{m.splice(p,1)},u=p=>{p.subs=[]},y=p=>p.typ=="object"&&o.level<=2;return(p,m)=>{const v=pt,C=et,g=Ye,$=tt("SubsKey",!0);return h(!0),D(ee,null,se(o.data,(w,S)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${o.level}`]),key:w.cu_key},[s("div",Qq,[m[0]||(m[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(v,{class:"mr12",style:jt({width:l.value}),value:w.key,"onUpdate:value":k=>w.key=k,placeholder:d(n)("ph_input")},null,8,["style","value","onUpdate:value","placeholder"]),m[1]||(m[1]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(g,{class:"mr12",onChange:k=>u(w),value:w.typ,"onUpdate:value":k=>w.typ=k,placeholder:d(n)("ph_select"),style:jt({width:l.value})},{default:f(()=>[(h(!0),D(ee,null,se(a.value,k=>(h(),G(C,{value:k.value},{default:f(()=>[T(_(k.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","placeholder","style"]),y(w)?(h(),D("div",{key:0,class:"btn-hover-wrap mr12",onClick:k=>i(S,o.data)},[c(d(Mt))],8,Xq)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:k=>r(S,o.data)},[c(d(at))],8,eH)]),w.subs&&w.subs.length>0?(h(),G($,{key:0,level:o.level+1,typOptions:o.typOptions,data:w.subs},null,8,["level","typOptions","data"])):Z("",!0)],2))),128)}}},sH=_e(tH,[["__scopeId","data-v-fadeb932"]]),oH={class:"problem-optimization-form"},nH={class:"node-form-content"},aH={class:"gray-block"},lH={class:"gray-block-title"},iH={class:"array-form-box"},rH={class:"gray-block mt16"},dH={class:"gray-block-title"},uH={class:"output-box"},cH={class:"output-block"},_H={class:"output-item"},pH={class:"output-item"},fH={class:"flex-block-item",style:{gap:"12px"}},vH=["onClick"],hH={key:0,class:"sub-field-box"},mH={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.json-node-form.index"),a=n,l=e,i=U([]);function r(){const k=l.lf.getNodeModelById(l.nodeId);if(k){let b=k.getAllParentVariable();i.value=u(b)}}function u(k){function b(x){const A=[];for(const R of x)if(R.children&&R.children.length>0){const E=b(R.children);if(E.length>0){const B={...R,children:E};A.push(B)}}else R.typ&&(R.typ.startsWith("array<")||R.typ==="object")&&A.push({...R});return A}return b(k)}const y=k=>{k&&r()},p=we({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),m=()=>{const k=JSON.stringify({json_encode:{...p}});a("update-node",{...l.node,node_params:k})},v=(k,b)=>{p.input_tags=b,p.input_variable=k},C=()=>{try{let k=l.node.dataRaw||l.node.node_params||"{}",b=JSON.parse(k).json_encode||{};b=JSON.parse(JSON.stringify(b)),r(),p.input_variable=b.input_variable,b.output.length>0&&(p.output=b.output)}catch(k){}};Ie(()=>p,()=>{m()},{deep:!0});const g=k=>{k.subs=[]},$=k=>{p.output[k].subs.push({key:"",value:"",subs:[],cu_key:nt(16)})},w=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],S=()=>{a("close")};return Ne(()=>{C()}),(k,b)=>{const x=pt,A=et,R=Ye,E=Tt,B=Dt,N=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_json_encode"),onClose:S},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",oH,[s("div",nH,[c(N,{ref:"formRef",layout:"vertical",model:p},{default:f(()=>[s("div",aH,[s("div",lH,_(d(o)("label_input")),1),s("div",iH,[c(xe,{options:i.value,defaultSelectedList:p.input_tags,defaultValue:p.input_variable,checkAnyLevel:!0,ref:"atInputRef",placeholder:d(o)("ph_input_message"),onOpen:y,onChange:b[0]||(b[0]=(I,L)=>v(I,L))},null,8,["options","defaultSelectedList","defaultValue","placeholder"])])]),s("div",rH,[s("div",dH,_(d(o)("label_output_custom")),1),s("div",uH,[s("div",cH,[s("div",_H,_(d(o)("label_param_key")),1),s("div",pH,_(d(o)("label_type")),1)]),s("div",{class:"array-form-box",onMousedown:b[1]||(b[1]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(p.output,(I,L)=>(h(),D("div",{class:"form-item-list",key:L},[c(B,{label:null,name:["output",L,"key"]},{default:f(()=>[s("div",fH,[c(x,{style:{width:"214px"},value:I.key,"onUpdate:value":q=>I.key=q,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c(E,null,{default:f(()=>[c(R,{onChange:q=>g(I),value:I.typ,"onUpdate:value":q=>I.typ=q,placeholder:d(o)("ph_select"),showArrow:!1,disabled:"",style:{width:"214px"}},{default:f(()=>[(h(),D(ee,null,se(w,q=>c(A,{value:q.value,key:q.value},{default:f(()=>[T(_(q.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value","placeholder"])]),_:2},1024),I.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:q=>$(L)},[c(d(Mt))],8,vH)):Z("",!0)]),I.subs&&I.subs.length>0?(h(),D("div",hH,[c(E,null,{default:f(()=>[c(sH,{data:I.subs,level:2,typOptions:w},null,8,["data"])]),_:2},1024)])):Z("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},gH=_e(mH,[["__scopeId","data-v-05cd2745"]]),yH={class:"sub-field-item"},bH=["onClick"],kH=["onClick"],wH={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.json-reverse-node-form.subs-key"),o=e,a=ye(()=>o.level>2?o.typOptions.filter(p=>p.value!="object"):o.typOptions),l=ye(()=>o.level==2?"180px":"146px"),i=(p,m)=>{m[p].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(p,m)=>{m.splice(p,1)},u=p=>{p.subs=[]},y=p=>p.typ=="object"&&o.level<=2;return(p,m)=>{const v=pt,C=et,g=Ye,$=tt("SubsKey",!0);return h(!0),D(ee,null,se(o.data,(w,S)=>(h(),D("div",{class:qe(["sub-field-item-box",`sub-field-item-box_${o.level}`]),key:w.cu_key},[s("div",yH,[m[0]||(m[0]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(v,{class:"mr12",style:jt({width:l.value}),value:w.key,"onUpdate:value":k=>w.key=k,placeholder:d(n)("ph_input")},null,8,["style","value","onUpdate:value","placeholder"]),m[1]||(m[1]=s("img",{class:"fork-icon",src:ys,alt:""},null,-1)),c(g,{class:"mr12",onChange:k=>u(w),value:w.typ,"onUpdate:value":k=>w.typ=k,placeholder:d(n)("ph_select"),style:jt({width:l.value})},{default:f(()=>[(h(!0),D(ee,null,se(a.value,k=>(h(),G(C,{value:k.value},{default:f(()=>[T(_(k.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","placeholder","style"]),y(w)?(h(),D("div",{key:0,class:"btn-hover-wrap mr12",onClick:k=>i(S,o.data)},[c(d(Mt))],8,bH)):Z("",!0),s("div",{class:"btn-hover-wrap",onClick:k=>r(S,o.data)},[c(d(at))],8,kH)]),w.subs&&w.subs.length>0?(h(),G($,{key:0,level:o.level+1,typOptions:o.typOptions,data:w.subs},null,8,["level","typOptions","data"])):Z("",!0)],2))),128)}}},CH=_e(wH,[["__scopeId","data-v-11f0bcaa"]]),$H={class:"problem-optimization-form"},xH={class:"node-form-content"},SH={class:"gray-block"},DH={class:"gray-block-title"},AH={class:"array-form-box"},OH={class:"gray-block mt16"},NH={class:"gray-block-title"},BH={class:"output-box"},EH={class:"output-block"},IH={class:"output-item"},FH={class:"output-item"},RH={class:"flex-block-item",style:{gap:"12px"}},LH=["onClick"],VH={key:0,class:"sub-field-box"},MH={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.json-reverse-node-form.index"),a=n,l=e,i=U([]);function r(){const k=l.lf.getNodeModelById(l.nodeId);if(k){let b=k.getAllParentVariable();i.value=u(y(b))}}function u(k){return k.forEach(b=>{b.typ=="node"?b.node_type==1?b.value="global":b.value=b.node_id:b.value=b.key,b.children&&b.children.length>0&&(b.children=u(b.children))}),k}function y(k){function b(x){const A=[];for(const R of x)if(R.children&&R.children.length>0){const E=b(R.children);if(E.length>0){const B={...R,children:E};A.push(B)}}else R.typ&&(l.node.loop_parent_key&&(R.node_type==25||R.node_type==30)?(R.typ==="object"||R.typ=="string"||R.typ=="array<object>")&&A.push({...R}):(R.typ==="object"||R.typ=="string")&&A.push({...R}));return A}return b(k)}const p=we({input_variable:[],input_tags:[],output:[{key:"",typ:"object",subs:[]}]}),m=()=>{const k=JSON.stringify({json_decode:{...p,input_variable:p.input_variable?p.input_variable.join("."):""}});a("update-node",{...l.node,node_params:k})},v=()=>{try{let k=l.node.dataRaw||l.node.node_params||"{}",b=JSON.parse(k).json_decode||{};b=JSON.parse(JSON.stringify(b)),r(),p.input_variable=tl(b.input_variable),b.output.length>0&&(p.output=b.output)}catch(k){}};Ie(()=>p,()=>{m()},{deep:!0});const C=k=>{k.subs=[]},g=k=>{p.output[k].subs.push({key:"",value:"",subs:[],cu_key:nt(16)})},$=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],w=k=>{k||r()},S=()=>{a("close")};return Ne(()=>{v()}),(k,b)=>{const x=xs,A=pt,R=et,E=Ye,B=Tt,N=Dt,I=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc_json_decode"),onClose:S},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",$H,[s("div",xH,[c(I,{ref:"formRef",layout:"vertical",model:p},{default:f(()=>[s("div",SH,[s("div",DH,_(d(o)("label_input_string")),1),s("div",AH,[c(x,{value:p.input_variable,"onUpdate:value":b[0]||(b[0]=L=>p.input_variable=L),onDropdownVisibleChange:w,style:{width:"400px"},options:i.value,"change-on-select":"",allowClear:!1,displayRender:({labels:L})=>L.join("/"),"field-names":{children:"children"},placeholder:d(o)("ph_select")},null,8,["value","options","displayRender","placeholder"])])]),s("div",OH,[s("div",NH,_(d(o)("label_output_custom")),1),s("div",BH,[s("div",EH,[s("div",IH,_(d(o)("label_param_key")),1),s("div",FH,_(d(o)("label_type")),1)]),s("div",{class:"array-form-box",onMousedown:b[1]||(b[1]=He(()=>{},["stop"]))},[(h(!0),D(ee,null,se(p.output,(L,q)=>(h(),D("div",{class:"form-item-list",key:q},[c(N,{label:null,name:["output",q,"key"]},{default:f(()=>[s("div",RH,[c(A,{style:{width:"214px"},value:L.key,"onUpdate:value":O=>L.key=O,placeholder:d(o)("ph_input")},null,8,["value","onUpdate:value","placeholder"]),c(B,null,{default:f(()=>[c(E,{onChange:O=>C(L),value:L.typ,"onUpdate:value":O=>L.typ=O,placeholder:d(o)("ph_select"),showArrow:!1,disabled:"",style:{width:"214px"}},{default:f(()=>[(h(),D(ee,null,se($,O=>c(R,{value:O.value,key:O.value},{default:f(()=>[T(_(O.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value","placeholder"])]),_:2},1024),L.typ=="object"?(h(),D("div",{key:0,class:"btn-hover-wrap",onClick:O=>g(q)},[c(d(Mt))],8,LH)):Z("",!0)]),L.subs&&L.subs.length>0?(h(),D("div",VH,[c(B,null,{default:f(()=>[c(CH,{data:L.subs,level:2,typOptions:$},null,8,["data"])]),_:2},1024)])):Z("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},TH=_e(MH,[["__scopeId","data-v-2d5e9181"]]),jH="/assets/img/menu-guide-CcoPw7QZ.png",PH={class:"problem-optimization-form"},qH={class:"node-form-content"},HH={class:"gray-block"},UH={class:"gray-block-title"},JH={class:"array-form-box"},zH={key:0,class:"menu-list-box"},KH={class:"menu-border-box"},GH={class:"drag-btn"},WH={class:"index-number"},ZH={class:"input-box"},YH={class:"action-btn"},QH={class:"gray-block mt16"},XH={class:"gray-block-title"},eU={class:"options-item"},tU={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(e,{emit:n}){const{t:o}=fe("views.workflow.components.node-form-drawer.qa-node-form.index"),a=n,l=e,i=U(null),r=U(null),u=U([]);function y(){const E=l.lf.getNodeModelById(l.nodeId);if(E){let B=E.getAllParentVariable();u.value=B}}const p=E=>{E&&y()},m=U({menu_type:"-1",serial_no:"-1",content:o("default_other_case")}),v=we({answer_text:"",answer_type:"text",menu_content:[{menu_type:"1",serial_no:"1",content:"",key:nt(16)},{menu_type:"1",serial_no:"2",content:"",key:nt(16)}],outputs:[{key:"question",typ:"string",subs:[]},{key:"question_multiple",typ:"array<object>",subs:[]}]}),C=()=>{let E=v.menu_content.map((I,L)=>({...I,serial_no:(L+1).toString()}));E.push(m.value);const N=JSON.stringify({question:{...v,reply_content_list:[{reply_type:"smartMenu",smart_menu:{menu_content:E}}]}});a("update-node",{...l.node,node_params:N})},g=(E,B)=>{v.answer_text=E},$=(E,B,N)=>{N.content=E},w=()=>{var E;try{let B=l.node.dataRaw||l.node.node_params||"{}",N=JSON.parse(B).question||{};N=JSON.parse(JSON.stringify(N)),v.answer_text=N.answer_text||"",v.answer_type=N.answer_type||"text";let I=N.reply_content_list||[];if(I.length>0){let L=((E=I[0].smart_menu)==null?void 0:E.menu_content)||[];if(L.length>0){let q=L.find(O=>O.menu_type=="-1");q&&(m.value=q),v.menu_content=L.filter(O=>O.menu_type!="-1").map(O=>({...O,key:nt(16)}))}}y()}catch(B){}};Ie(()=>v,()=>{C()},{deep:!0});const S=()=>{i.value.refresh()},k=()=>{r.value.show()},b=()=>{a("close")},x=()=>{},A=E=>{if(v.menu_content.length<=1)return Me.warning(o("msg_min_menu_required"));v.menu_content.splice(E,1)},R=()=>{v.menu_content.push({menu_type:"1",serial_no:(v.menu_content.length+1).toString(),content:"",key:nt(16)})};return Ne(()=>{w()}),(E,B)=>{const N=_s,I=Qt,L=no,q=Yt,O=Dt,M=It,j=rt,V=ct,z=St;return h(),G(ft,null,{header:f(()=>[c(vt,{title:e.node.node_name,iconName:e.node.node_icon_name,desc:d(o)("desc"),onClose:b},null,8,["title","iconName","desc"])]),default:f(()=>[s("div",PH,[s("div",qH,[c(z,{ref:"formRef",layout:"vertical",model:v},{default:f(()=>[s("div",HH,[c(N,{justify:"space-between"},{default:f(()=>[s("div",UH,_(d(o)("title_question_content")),1),s("div",{class:"btn-hover-wrap",onClick:k},[c(d(Wt))])]),_:1}),s("div",JH,[c(xe,{inputStyle:"height: 100px;",options:u.value,defaultValue:v.answer_text,ref_key:"atInputRef",ref:i,placeholder:d(o)("ph_input_message"),"input-style":"height: 130px",type:"textarea",onOpen:p,onChange:B[0]||(B[0]=(H,K)=>g(H,K))},null,8,["options","defaultValue","placeholder"])]),c(O,{label:d(o)("label_answer_type")},{default:f(()=>[c(q,{value:v.answer_type,"onUpdate:value":B[1]||(B[1]=H=>v.answer_type=H)},{default:f(()=>[c(I,{value:"text"},{default:f(()=>[T(_(d(o)("opt_direct_answer")),1)]),_:1}),c(I,{value:"menu"},{default:f(()=>[T(_(d(o)("opt_smart_menu"))+" ",1),c(L,{title:null},{content:f(()=>[...B[5]||(B[5]=[s("div",null,[s("img",{style:{width:"330px"},src:jH,alt:""})],-1)])]),default:f(()=>[c(d(Re))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),v.answer_type=="menu"?(h(),D("div",zH,[c(d(ja),{modelValue:v.menu_content,"onUpdate:modelValue":B[2]||(B[2]=H=>v.menu_content=H),"item-key":"key",onEnd:x,group:"table-rows",handle:".drag-btn"},{item:f(({element:H,index:K})=>[(h(),D("div",{key:H.id,class:"menu-item"},[s("div",KH,[s("span",GH,[c(M,{name:"drag"})]),s("span",WH,_(K+1),1),s("div",ZH,[c(xe,{inputStyle:"height: 22px;",bordered:!1,options:u.value,defaultValue:H.content,placeholder:d(o)("ph_input_message"),onOpen:p,onChange:(F,Y)=>$(F,Y,H)},null,8,["options","defaultValue","placeholder","onChange"])])]),s("span",YH,[c(d(at),{onClick:F=>A(K)},null,8,["onClick"])])]))]),_:1},8,["modelValue"]),s("div",null,[c(j,{onClick:B[3]||(B[3]=H=>R()),type:"dashed",block:""},{default:f(()=>[c(d(Xe)),T(_(d(o)("btn_add_menu")),1)]),_:1})])])):Z("",!0)]),s("div",QH,[s("div",XH,_(d(o)("title_output")),1),B[8]||(B[8]=s("div",{class:"options-item"},[s("div",{class:"option-label"},"question"),s("div",{class:"option-type"},"string")],-1)),s("div",eU,[B[6]||(B[6]=s("div",{class:"option-label"},"question_multiple",-1)),B[7]||(B[7]=s("div",{class:"option-type",textContent:"array<object>"},null,-1)),c(V,{placement:"left"},{title:f(()=>[s("div",null,_(d(o)("tip_question_multiple")),1),s("pre",null,[s("code",null,`"question_multiple":[
  {
    "type":"text",
    "text":"`+_(d(o)("sample_text_content"))+`"
  },{
    "type":"image_url",
    "image_url":{
      "url":"`+_(d(o)("sample_image_url"))+`"
    }
  }
]
              `,1)])]),default:f(()=>[c(d(Re))]),_:1})])])]),_:1},8,["model"])]),c(js,{options:u.value,defaultValue:v.answer_text,placeholder:d(o)("ph_input_message_with_slash"),type:"textarea",onOpen:p,onChange:B[4]||(B[4]=(H,K)=>g(H,K)),onOk:S,ref_key:"fullAtInputRef",ref:r},null,8,["options","defaultValue","placeholder"])])]),_:1})}}},sU=_e(tU,[["__scopeId","data-v-e9c11ff9"]]),oU=["src"],nU={class:"workflow-form"},aU={class:"node-options"},lU={class:"options-title"},iU={class:"options-item-tit"},rU={class:"option-label"},dU={class:"option-type"},uU={class:"field-list-item"},cU={class:"field-label"},_U={class:"field-type"},pU={class:"desc"},fU={class:"node-options"},vU={class:"options-title"},hU={class:"options-item"},mU={__name:"zm-workflow-node-form",props:{node:{type:Object,default:()=>({})}},setup(e){const{t:n}=fe("views.workflow.components.node-form-drawer.zm-workflow-node-form"),o=be("getNode"),a=be("setData"),l=e,i=U([]),r=U([]),u=U({}),y=U([]);let p={};async function m(){var w,S;C(),p=JSON.parse(l.node.node_params),y.value=((w=p==null?void 0:p.workflow)==null?void 0:w.output)||[],u.value=((S=p==null?void 0:p.workflow)==null?void 0:S.robot_info)||{},v()}function v(){var w;Ua({robot_id:(w=p==null?void 0:p.workflow)==null?void 0:w.robot_id}).then(S=>{var x,A,R;let k=rs((x=S==null?void 0:S.data)==null?void 0:x.node_params),b=((A=p==null?void 0:p.workflow)==null?void 0:A.params)||[];i.value=((R=k==null?void 0:k.start)==null?void 0:R.diy_global)||[];for(let E of i.value){let B=b.find(N=>E.key==N.key);E.variable=(B==null?void 0:B.variable)||"",E.tags=Array.isArray(B==null?void 0:B.tags)?B.tags:[]}})}function C(){r.value=o().getAllParentVariable()}function g(w,S,k){w.variable=S,w.tags=k,$()}function $(){let w=JSON.parse(JSON.stringify(i.value));for(let S of w)S.variable=String(S.variable);p.workflow.params=w,a({...l.node,node_params:JSON.stringify(p)})}return Ne(()=>{m()}),(w,S)=>{const k=os;return h(),G(ft,null,{header:f(()=>{var b;return[c(vt,{title:e.node.node_name,desc:(b=u.value)==null?void 0:b.robot_intro},{"node-icon":f(()=>[u.value.robot_avatar?(h(),D("img",{key:0,class:"node-icon",src:u.value.robot_avatar},null,8,oU)):(h(),G(k,{key:1,size:"small"}))]),_:1},8,["title","desc"])]}),default:f(()=>[s("div",nU,[s("div",aU,[s("div",lU,[s("div",null,[S[0]||(S[0]=s("img",{src:Jt,class:"title-icon"},null,-1)),T(_(d(n)("label_input")),1)])]),(h(!0),D(ee,null,se(i.value,b=>(h(),D("div",{key:b.key,class:qe(["options-item",{"is-required":b.required}])},[s("div",iU,[s("div",rU,_(b.name||b.key),1),s("div",dU,_(b.typ),1)]),s("div",null,[c(xe,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:b.tags,defaultValue:b.variable,ref_for:!0,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:C,onChange:(x,A)=>g(b,x,A)},{option:f(({label:x,payload:A})=>[s("div",uU,[s("div",cU,_(x),1),s("div",_U,_(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),s("div",pU,_(b.desc),1)],2))),128))]),s("div",fU,[s("div",vU,[s("div",null,[S[1]||(S[1]=s("img",{src:Zt,class:"title-icon"},null,-1)),T(_(d(n)("label_output")),1)])]),s("div",hU,[c(Rs,{"tree-data":y.value},null,8,["tree-data"])])])])]),_:1})}}},gU=_e(mU,[["__scopeId","data-v-619378ae"]]),yU=["width"],bU={class:"node-form-drawer-body"},kU=["node-key"],wU={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.node-form-drawer.index"),l={"start-node":cg,"problem-optimization-node":Qg,"ai-dialogue-node":I1,"add-data-node":Cy,"knowledge-base-node":tb,"code-run-node":t2,"http-node":kk,"http-tool-node":x3,"delete-data-node":Y3,"variable-assignment-node":dw,"update-data-node":ww,"parameter-extraction-node":uC,"select-data-node":QC,"question-node":$$,"judge-node":M$,"specify-reply-node":K$,"immediately-reply-node":s8,"mcp-node":k8,"custom-group":eS,"batch-group":LR,"zm-plugins-node":NI,"session-trigger-node":KI,"timing-trigger-node":nF,"end-node":OL,"official-trigger-node":xF,"image-generation-node":wj,"voice-clone-node":iM,"voice-synthesis-node":PT,"explain-node":Aj,"webhook-trigger-node":UP,"import-library-node":Yq,"json-node":gH,"json-reverse-node":TH,"qa-node":sU,"zm-workflow-node":gU},i=o,r=e,u=ye({get:()=>r.open,set:b=>i("update:open",b)}),y=()=>{u.value=!1},p=ye(()=>{var R,E,B;let b=rs((R=r.node)==null?void 0:R.node_params);return((E=b==null?void 0:b.plugin)==null?void 0:E.name)=="feishu_bitable"||((B=b==null?void 0:b.plugin)==null?void 0:B.name)=="official_send_message"?600:(()=>{var q;const N=(q=b==null?void 0:b.plugin)==null?void 0:q.params;if(!N)return!1;const I=N==null?void 0:N.params;if(I&&typeof I=="object")for(const O in I){const M=I[O];if(M&&M.date_range_begin_component)return!0}const L=N==null?void 0:N.arguments;if(L&&typeof L=="object"){const O=Object.keys(L||{});if(O.includes("date_type")||O.includes("begin_date")&&O.includes("end_date"))return!0}return!1})()?640:{"delete-data-node":600,"update-data-node":600,"select-data-node":600,"judge-node":600,"custom-group":640,"timing-trigger-node":420,"batch-group":640,"webhook-trigger-node":620,"end-node":650}[r.nodeType]||480}),m=()=>r.lf.getNodeModelById(r.nodeId),v=()=>r.lf.graphModel,C=b=>{S(b)},g=b=>{i("change-title",b)},$=()=>{u.value=!1;let b=m();v().eventCenter.emit("custom:node:delete",b)};Us("lf",r.lf),Us("getNode",m),Us("getGraph",v),Us("setData",C),Us("changeTitle",g),Us("deleteNode",$),Us("close",y);const w=ye(()=>{const b=`${r.nodeType}`;return l[b]||null}),S=b=>{b.dataRaw=b.node_params,i("update-node",b)},k=()=>{u.value=!1};return n({open}),(b,x)=>{const A=rt,R=ki;return h(),G(Pl,{name:"slide-right",appear:""},{default:f(()=>[u.value?(h(),D("div",{key:0,width:p.value,style:jt({width:p.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:jl(k,["esc"])},[s("div",bU,[s("div",{class:"drawer-form","node-key":r.nodeType},[w.value?(h(),G(Go(w.value),{lf:r.lf,"node-id":r.nodeId,"node-type":r.nodeType,node:r.node,key:r.nodeId,onClose:k,onUpdateNode:S},null,40,["lf","node-id","node-type","node"])):(h(),G(R,{key:1,status:"warning",title:d(a)("msg_component_load_failed"),"sub-title":d(a)("msg_component_not_found")},{extra:f(()=>[c(A,{type:"primary",onClick:k},{default:f(()=>[T(_(d(a)("btn_close")),1)]),_:1})]),_:1},8,["title","sub-title"]))],8,kU)])],44,yU)):Z("",!0)]),_:1})}}},CU=_e(wU,[["__scopeId","data-v-825600b4"]]);function $U(e,n="id",o="parentId",a="children"){const l=[],i=new Map;for(const r of e)i.set(r[n],{...r,[a]:[]});for(const r of e){const u=i.get(r[n]),y=r[o];y!=null&&i.has(y)?i.get(y)[a].push(u):l.push(u)}return l}class Sl{constructor({lf:n}){this.lf=n,this.elk=new $f}async layout(n){const o=JSON.parse(JSON.stringify(n)),{nodes:a,edges:l}=o,i=new Map(a.map(g=>[g.id,g])),r=a.map(g=>{var w;let $={id:g.id,parentId:((w=g.properties)==null?void 0:w.loop_parent_key)||null};return g.children&&g.children.length>0?$.layoutOptions={"elk.padding":"[top=112, right=32, bottom=32, left=32]","elk.nodeSize.constraints":"MINIMUM_SIZE","elk.nodeSize.minimum":"[600, 420]","elk.spacing.nodeNode":100,"elk.layered.spacing.nodeNodeBetweenLayers":120}:($.width=g.properties.width||420,$.height=g.properties.height||100,$.layoutOptions={"elk.nodeSize.constraints":"FIXED"}),$}),u=new Map;l.forEach(g=>{u.set(g.id,{...g})});const y=$U(r),p=l.map(g=>({id:g.id,sources:[g.sourceNodeId],targets:[g.targetNodeId]})),m={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"RIGHT","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.nodePlacement.bk.fixedAlignment":"TOP","elk.spacing.nodeNode":200,"elk.layered.spacing.nodeNodeBetweenLayers":200,"elk.layered.considerHierarchy":"true","elk.spacing.componentComponent":80},children:y,edges:p},v=await this.elk.layout(m);function C(g,$=null,w=0,S=0){for(const k of g){const b=i.get(k.id);if(!b)continue;let x,A;$?(x=w+k.x,A=S+k.y):(x=k.x,A=k.y),b.x=x+k.width/2,b.y=A+k.height/2,b.properties||(b.properties={}),b.width=k.width,b.height=k.height,b.properties.width=k.width,b.properties.height=k.height,k.children&&k.children.length>0&&C(k.children,k,x,A)}}C(v.children),l.forEach(g=>{const $=u.get(g.id),w=v.edges.find(S=>S.id===g.id);if(w&&w.sections&&w.sections.length>0){const S=w.sections[0];if(S){$&&(g.sourceAnchorId=$.sourceAnchorId,g.targetAnchorId=$.targetAnchorId),g.startPoint={...S.startPoint},g.endPoint={...S.endPoint};const k=S.startPoint,b=S.endPoint,x=b.x-k.x,A=b.y-k.y;let N=50+Math.sqrt(x*x+A*A)*.3;N=Math.max(10,Math.min(N,100));const q={x:k.x+Math.abs(x)*.3,y:k.y},O={x:b.x-Math.abs(x)*.3,y:b.y};Math.abs(A)>Math.abs(x)?(q.x=k.x,q.y=k.y+Math.abs(A)*.3,O.x=b.x,O.y=b.y-Math.abs(A)*.3):(q.x=k.x+Math.abs(x)*.3,q.y=k.y,O.x=b.x-Math.abs(x)*.3,O.y=b.y),g.pointsList=[{...k},q,O,{...b}],g.properties||(g.properties={}),g.properties.offset=Math.round(N)}}else if($&&(g.sourceAnchorId=$.sourceAnchorId,g.targetAnchorId=$.targetAnchorId,g.type=$.type||"custom-bezier-edge",g.startPoint&&g.endPoint&&(!g.pointsList||g.pointsList.length===0))){const S=g.endPoint.x-g.startPoint.x,k=g.endPoint.y-g.startPoint.y;let R=50+Math.sqrt(S*S+k*k)*.3;R=Math.max(10,Math.min(R,100));const N={x:g.startPoint.x+Math.abs(S)*.3,y:g.startPoint.y},I={x:g.endPoint.x-Math.abs(S)*.3,y:g.endPoint.y};Math.abs(k)>Math.abs(S)?(N.x=g.startPoint.x,N.y=g.startPoint.y+Math.abs(k)*.3,I.x=g.endPoint.x,I.y=g.endPoint.y-Math.abs(k)*.3):(N.x=g.startPoint.x+Math.abs(S)*.3,N.y=g.startPoint.y,I.x=g.endPoint.x-Math.abs(S)*.3,I.y=g.endPoint.y),g.pointsList=[{...g.startPoint},N,I,{...g.endPoint}],g.properties||(g.properties={}),g.properties.offset=Math.round(R)}}),this.lf.clearSelectElements(),this.lf.clearData(),this.lf.graphModel.graphDataToModel(o),this.fitView(o.nodes),o.nodes.forEach(g=>{if(g.children&&g.children.length){let $=this.lf.graphModel.getElement(g.id);$&&$.setZIndex(-9999)}})}fitView(n){if(!n||n.length===0){this.lf.resetZoom(),this.lf.resetTranslate();return}const{width:o,height:a}=this.lf.graphModel;let l=1/0,i=1/0,r=-1/0,u=-1/0;n.forEach($=>{const w=($.width||$.properties.width)/2,S=($.height||$.properties.height)/2;l=Math.min(l,$.x-w),i=Math.min(i,$.y-S),r=Math.max(r,$.x+w),u=Math.max(u,$.y+S)});const y=r-l,p=u-i;if(y===0||p===0)return;const m=.1,v=o/(y*(1+m)),C=a/(p*(1+m));let g=Math.min(v,C);g>1?g=1:g<.3&&(g=.3),this.lf.zoom(g),this.lf.translateCenter()}}Ds(Sl,"pluginName","elk");class Dl{constructor({lf:n}){this.lf=n,this.padding={top:94,right:16,bottom:16,left:16},this.resize_padding=30,this.handleNodeDrag=this.handleNodeDrag.bind(this),n.on("node:drag",this.handleNodeDrag)}handleNodeDrag({data:n}){this.lf.off("node:drag",this.handleNodeDrag);try{const o=this.lf.graphModel.getNodeModelById(n.id);if(!o)return;const{x:a,y:l,width:i,height:r}=o,u=o.getProperties();if(u.loop_parent_key){const y=this.lf.graphModel.getNodeModelById(u.loop_parent_key);if(y){const{x:p,y:m,width:v,height:C}=y,g=a-i/2,$=a+i/2,w=l-r/2,S=l+r/2,k=p-v/2+this.padding.left,b=p+v/2-this.padding.right,x=m-C/2+this.padding.top,A=m+C/2-this.padding.bottom;let R=v,E=C,B=p,N=m,I=!1;if(g<k){const L=k-g+this.resize_padding;R+=L,B-=L/2,I=!0}if($>b){const L=$-b+this.resize_padding;R+=L,B+=L/2,I=!0}if(w<x){const L=x-w+this.resize_padding;E+=L,N-=L/2,I=!0}if(S>A){const L=S-A+this.resize_padding;E+=L,N+=L/2,I=!0}I&&(y.x=B,y.y=N,y._width=y.width=R,y._height=y.height=E)}}}finally{this.lf.on("node:drag",this.handleNodeDrag)}}}Ds(Dl,"pluginName","groupAutoResize");const xU={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},computed:{t(){return fe("views.workflow.components.edges.custom-line.index").t}},watch:{isSelected(e){if(e){let o=this.getGraphModel().getSelectElements(!0);o.nodes.length===0&&o.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const e=this.getGraphModel(),n=this.getModel();e.eventCenter.emit("custom:edge:delete",n),this.$emit("delete")}}},SU={class:"custom-line-popup"};function DU(e,n,o,a,l,i){return $s((h(),D("div",SU,[s("button",{class:"delete-btn",onClick:n[0]||(n[0]=He((...r)=>i.handleDelete&&i.handleDelete(...r),["stop"]))},_(i.t("btn_delete")),1)],512)),[[Es,l.isDeleteConfirmShow]])}const AU=_e(xU,[["render",DU],["__scopeId","data-v-082b85f0"]]),OU=70,NU=36;let BU=class extends xi{constructor(n){super(n),this.isMounted=!1,this.r=Qe(AU,{properties:n.model.getProperties(),isSelected:n.model.isSelected,isHovered:n.model.isHovered}),this.app=yo({render:()=>this.r,provide:()=>({getModel:()=>n.model,getGraphModel:()=>n.graphModel}),mounted:()=>{}})}getText(){const{model:n}=this.props,{customWidth:o=OU,customHeight:a=NU}=n.getProperties(),l=n.id,{startPoint:i,endPoint:r,arrowConfig:u,pointsList:y}=n;let p={x:(i.x+r.x-o)/2,y:(i.y+r.y-a)/2,width:o,height:a};if(y.length>2){let v=Math.round(y.length/2);p.x=y[v-1].x+5,p.y=y[v-1].y}const m={width:o,height:a};return setTimeout(()=>{const v=document.querySelector("#line_"+l).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(v))},0),_t("foreignObject",{...p,id:"line_"+l},[_t("div",{id:l,style:m,className:"vue-app-wrapper"})])}},EU=class extends Si{initEdgeData(n){super.initEdgeData(n)}createId(){return Js("customEdge")}getEdgeStyle(){const n=super.getEdgeStyle();return this.isSelected||this.isHovered?n.stroke="#2475FC":n.stroke="#A1A7B3",n.strokeWidth=2,n}getArrowStyle(){const n=super.getArrowStyle();return n.refX=0,n}getOutlineStyle(){const n=super.getOutlineStyle();return n.stroke="none",n.hover.stroke="none",n}getData(){const n=super.getData();return n.sourceAnchorId=this.sourceAnchorId,n.targetAnchorId=this.targetAnchorId,n}updatePathByAnchor(){const n=this.graphModel.getNodeModelById(this.sourceNodeId),o=n==null?void 0:n.getDefaultAnchor().find(i=>i.id===this.sourceAnchorId),a=this.graphModel.getNodeModelById(this.targetNodeId),l=a==null?void 0:a.getDefaultAnchor().find(i=>i.id===this.targetAnchorId);if(o){const i={x:o==null?void 0:o.x,y:o==null?void 0:o.y};this.updateStartPoint(i)}if(l){const i={x:l==null?void 0:l.x,y:l==null?void 0:l.y};this.updateEndPoint(i)}this.pointsList=[],this.initPoints()}};const IU={type:"custom-edge",view:BU,model:EU},FU={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(e){if(e){const n=this.getGraphModel(),o=this.getModel();if(n.getNodeModelById(o.sourceNodeId).properties.isTriggerNode){this.isDeleteConfirmShow=!1;return}const l=n.getSelectElements(!0);l.nodes.length===0&&l.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const e=this.getGraphModel(),n=this.getModel();e.eventCenter.emit("custom:edge:delete",n),this.$emit("delete")}}},RU={class:"custom-line-popup"};function LU(e,n,o,a,l,i){return $s((h(),D("div",RU,[s("div",{class:"minus-circle-outlined",onClick:n[0]||(n[0]=He((...r)=>i.handleDelete&&i.handleDelete(...r),["stop"]))})],512)),[[Es,l.isDeleteConfirmShow]])}const VU=_e(FU,[["render",LU],["__scopeId","data-v-96663205"]]);class MU extends Di{constructor(n){super(n),this.isMounted=!1,this.r=Qe(VU,{properties:n.model.getProperties(),isSelected:n.model.isSelected,isHovered:n.model.isHovered}),this.app=yo({render:()=>this.r,provide:()=>({getModel:()=>n.model,getGraphModel:()=>n.graphModel}),mounted:()=>{}})}getEndArrow(){const{model:n}=this.props,{stroke:o,strokeWidth:a}=n.getArrowStyle();return _t("path",{stroke:o,strokeWidth:a,d:"M -9 -7 0 0 -9 7",fill:"none"})}getText(){const{model:n}=this.props,{startPoint:o,endPoint:a,pointsList:l}=n,i=n.id,r=24,u=24,y=r/2,p=u/2,m=k=>{const{x:b,y:x}=o,{x:A,y:R}=l[1],{x:E,y:B}=l[2],{x:N,y:I}=a,L=k*k,q=L*k,O=1-k,M=O*O,j=M*O;return{x:b*j+3*A*M*k+3*E*O*L+N*q,y:x*j+3*R*M*k+3*B*O*L+I*q}},v=(k=5)=>{let b=0,x=m(0);for(let A=1;A<=k;A++){const R=A/k,E=m(R),B=E.x-x.x,N=E.y-x.y;b+=Math.sqrt(B*B+N*N),x=E}return b},C=k=>{const b=k/2;let x=0,A=1,R=.5,E=1e-4;for(;A-x>E;)R=(x+A)/2,B(R)<b?x=R:A=R;function B(N){let I=0,L=m(0);const q=5;for(let O=1;O<=q;O++){const M=O/q*N,j=m(M),V=j.x-L.x,z=j.y-L.y;I+=Math.sqrt(V*V+z*z),L=j}return I}return m(R)},g=v(),$=C(g),w={x:$.x-y,y:$.y-p,width:r,height:u},S={width:r,height:u};return setTimeout(()=>{var b,x;const k=(b=document.querySelector(`#line_${i}`))==null?void 0:b.querySelector(".vue-app-wrapper");!this.isMounted&&k?(this.isMounted=!0,this.app.mount(k)):(x=this.r)!=null&&x.component&&(this.r.component.props.isSelected=n.isSelected,this.r.component.props.isHovered=n.isHovered,this.r.component.props.properties=n.getProperties())},0),_t("foreignObject",{...w,id:`line_${i}`},[_t("div",{id:i,style:S,className:"vue-app-wrapper"})])}}class TU extends Ai{initEdgeData(n){super.initEdgeData(n)}setAttributes(n){super.setAttributes(n);let o=this.getProperties().offset;o&&(this.offset=o,this.pointsList=[],this.initPoints())}createId(){return Js("customEdge")}getEdgeStyle(){const n=super.getEdgeStyle();return this.isSelected||this.isHovered?n.stroke="#37e1ffff":n.stroke="#2475FC",n.strokeWidth=2,n}getArrowStyle(){return{...super.getArrowStyle(),...this.arrowStyle,refX:0,refY:0}}getOutlineStyle(){const n=super.getOutlineStyle();return n.stroke="none",n.hover.stroke="none",n}getData(){const n=super.getData();return n.sourceAnchorId=this.sourceAnchorId,n.targetAnchorId=this.targetAnchorId,n}updatePathByAnchor(){const n=this.graphModel.getNodeModelById(this.sourceNodeId),o=n==null?void 0:n.getDefaultAnchor().find(i=>i.id===this.sourceAnchorId),a=this.graphModel.getNodeModelById(this.targetNodeId),l=a==null?void 0:a.getDefaultAnchor().find(i=>i.id===this.targetAnchorId);if(o){const i={x:o==null?void 0:o.x,y:o==null?void 0:o.y};this.updateStartPoint(i)}if(l){const i={x:l==null?void 0:l.x,y:l==null?void 0:l.y};this.updateEndPoint(i)}this.pointsList=[],this.initPoints()}}const jU={type:"custom-bezier-edge",view:MU,model:TU},PU={name:"QuestionNode",components:{PopupMenu:Qo},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{type:"node",excludedNodeTypes:[],nodeListTabActive:1}},mounted(){this.getGraph().eventCenter.on("custom:showPopupMenu",this.onShowPopupMenu)},methods:{onShowPopupMenu(e){const{type:n,loop_parent_key:o}=e.model.properties;if(o){let a=["custom-group","batch-group","end-node","qa-node"];this.getGraph().getNodeModelById(o).type=="batch-group"&&a.push("terminate-node"),this.excludedNodeTypes=a}else this.excludedNodeTypes=["explain-node","terminate-node"]},handleAddNode(e){this.$emit("click-item",e)}}};function qU(e,n,o,a,l,i){const r=tt("PopupMenu");return h(),G(r,{onAddNode:i.handleAddNode,type:l.type,excludedNodeTypes:l.excludedNodeTypes,active:l.nodeListTabActive,"onUpdate:active":n[0]||(n[0]=u=>l.nodeListTabActive=u)},null,8,["onAddNode","type","excludedNodeTypes","active"])}const HU=_e(PU,[["render",qU]]),Ba=444,Ea=620;class UU{constructor({lf:n}){Ds(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=n,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${Ba}px`,this.__menuDOM.style.height=`${Ea}px`,this.isMounted=!1,this.r=Qe(HU,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:o,event:a})=>{this.hideMenu(),n.graphModel.eventCenter.emit("custom:addNode",{node:o,event:a,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=yo({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>n.graphModel}),mounted:()=>{}})}render(n,o){this.container=o,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),n.on("custom:showPopupMenu",({anchorData:a,model:l})=>{this._activeData=l,this._activeAnchorData=a,this.createMenu()}),n.on("node:click",({data:a})=>{this.hideMenu()}),n.on("edge:click",({data:a})=>{this.hideMenu()}),n.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const n=this._activeAnchorData;let o=n.x+5,a=n.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([o,a])}showMenu(){const[n,o]=this.getContextMenuPosition(),a=this.lf.graphModel.height-64,l=this.lf.graphModel.width-64;this.__menuDOM.style.display="flex";const i=Math.min(525,a-20),r=Ba;let u=n+10;u+r>l&&(u=n-r-20),u<0&&(u=4),this.__menuDOM.style.left=`${u}px`;let y=o;o+i>a?y=o-(o+i-a)-10:y=o-10,y<0&&(y=4),this.__menuDOM.style.top=`${y}px`,this.__menuDOM.style.height=`${i>0?i:Ea}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class Al{constructor({lf:n}){Ds(this,"handleHistoryKeyDown",n=>{if(this.isInputElement(n.target))return;const{ctrlKey:o,key:a,metaKey:l}=n,i=o||l;if(i&&a.toLowerCase()==="z"&&!n.shiftKey){n.preventDefault(),n.stopPropagation(),this.undo();return}if(i&&(a.toLowerCase()==="y"||a.toLowerCase()==="z"&&n.shiftKey)){n.preventDefault(),n.stopPropagation(),this.redo();return}});this.lf=n,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const n=this.lf.getGraphData(),o=this.lf.getSelectElements(!0);let a=[...o.nodes,...o.edges].map(l=>l.id);return{nodes:JSON.parse(JSON.stringify(n.nodes||[])),edges:JSON.parse(JSON.stringify(n.edges||[])),selectedElementIds:a||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(n="change"){if(this.isProcessing)return;const o=this.createSnapshot();o.operation=n,this.historyStack.push(o),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const n=this.historyStack.pop();this.redoStack.push(n);const o=this.historyStack[this.historyStack.length-1];this.restoreState(o),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const n=this.redoStack.pop();this.historyStack.push(n),this.restoreState(n),this.notifyHistoryChange()}restoreState(n){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),n.nodes.forEach(o=>{o.width=o.properties.width,o.height=o.properties.height}),this.lf.graphModel.graphDataToModel({nodes:n.nodes||[],edges:n.edges||[]}),n.selectedElementIds&&n.selectedElementIds.length>0&&n.selectedElementIds.forEach(o=>{this.lf.selectElementById(o,!0)})}finally{this.isProcessing=!1}}isInputElement(n){if(["INPUT","TEXTAREA","SELECT"].includes(n.tagName))return!0;let a=n;for(;a&&a!==document.body;){if(a.hasAttribute&&a.hasAttribute("contenteditable"))return!0;a=a.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(o=>{this.lf.on(o,()=>{this.saveCurrentState(o)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(n,o,a){this.maxHistorySize=a&&a.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(n){this.historyStack=[],this.redoStack=[];const o={nodes:JSON.parse(JSON.stringify(n.nodes||[])),edges:JSON.parse(JSON.stringify(n.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(o),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(n){typeof n=="function"&&this.historyChangeCallbacks.push(n)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(n=>{try{const o=this.historyStack.map((i,r)=>({index:r,timestamp:i.timestamp,operation:i.operation,nodeCount:i.nodes?i.nodes.length:0,edgeCount:i.edges?i.edges.length:0,nodes:i.nodes||[],edges:i.edges||[],selectedElementIds:i.selectedElementIds||[]})),a=this.redoStack.map((i,r)=>({index:r,timestamp:i.timestamp,operation:i.operation,nodeCount:i.nodes?i.nodes.length:0,edgeCount:i.edges?i.edges.length:0,nodes:i.nodes||[],edges:i.edges||[],selectedElementIds:i.selectedElementIds||[]})),l=this.historyStack.length-1;n({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:o[l],historyDetails:o,redoDetails:a,currentHistoryIndex:l})}catch(o){console.error("History change callback error:",o)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(n="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const o=this.createSnapshot();o.operation=n,this.historyStack.push(o),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(n="commit"){this.isProcessing=!1,this.saveCurrentState(n)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}Ds(Al,"pluginName","canvasHistory");class Ol{constructor({lf:n}){Ds(this,"wheelEventListener",n=>{if(n.shiftKey){n.preventDefault();const o=this.lf.getTransform();let a=o.SCALE_X,l=o.SCALE_Y;n.deltaY>0?this.lf.translate(-100*a,100*l):this.lf.translate(100*a,-100*l)}else if(n.ctrlKey){n.preventDefault();const{transformModel:o}=this.lf.graphModel,[a,l]=o.HtmlPointToCanvasPoint([n.clientX,n.clientY]),i=this.lf.getTransform();this.zoom=i.SCALE_X,n.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[a,l])}});Ds(this,"keydownListener",n=>{var r;const o=(r=n==null?void 0:n.key)==null?void 0:r.toLowerCase(),{graphModel:{eventCenter:a}}=this.lf,l=n.target,i=l===document.body||this.lf.container.contains(l);if(n.ctrlKey){if(o==="c"){if(!i)return;let u=this.lf.getSelectElements(!0);if(u=JSON.parse(JSON.stringify(u)),u.nodes.length===0)return;u.edges=[];const y=u.nodes.filter(p=>p.type!=="start-node"&&p.type!=="custom-group"&&p.properties.isTriggerNode!=!0);if(y.length>0){this.basePointX=20,this.basePointY=20;let p={x:1/0,y:1/0};y.forEach(m=>{m.id="",m.nodeSortKey="",m.properties.id="",m.properties.next_node_key="",m.properties.nodeSortKey="",m.properties.node_key="",!m.width&&m.properties.width&&(m.width=m.properties.width),!m.height&&m.properties.height&&(m.height=m.properties.height),m.x<p.x&&(p.x=m.x),m.y<p.y&&(p.y=m.y)}),this.clipboard={nodes:y,basePoint:p}}else this.clipboard=null;return}if(o==="v"){if(!i||!this.clipboard||this.clipboard.nodes.length===0)return;if(this.clipboard&&this.clipboard.nodes.length>0){const u={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};a.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:u}),this.basePointX+=20,this.basePointY+=20}return}}if(o==="delete"&&i){a.emit("custom:keyoard:delete");return}n.ctrlKey&&!this.isCtrlPressed&&(n.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});Ds(this,"keyupListener",n=>{!n.ctrlKey&&this.isCtrlPressed&&(n.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=n,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}Ds(Ol,"pluginName","custom-keyboard");const{t:ws}=fe("views.workflow.components.nodes.base-node");function Nl(e,n){return e.map(o=>{let a=n?n.node_id:o.node_id,l=n?n.node_name:o.node_name,i=n?n.node_type:o.node_type,r=o.name||o.key,u=n?`${n.text}.${r}`:r,y=o.children||o.subs||[],p="",m="";i==1?m=`global.${u}`:n?m=`${n.original_value}.${o.key}`:m=`${a}.${o.key}`,p=`【${m}】`;let v={label:r,value:p,original_value:m,node_id:a,node_name:l,node_type:i,text:u,key:o.key,id:a,typ:o.typ,children:y||[]};return v.children&&v.children.length>0&&(v.children=Nl(v.children,v)),v})}class ht extends Oi{constructor(n){super(n)}renderVue(n,o){this.isMounted=!1,this.r=Qe(n,{properties:o.model.getProperties(),isSelected:o.model.isSelected,isHovered:o.model.isHovered}),this.app=yo({render:()=>this.r,provide:()=>({getNode:()=>o.model,getGraph:()=>o.graphModel,resetSize:()=>{if(this.r&&this.r.el){let a=this.r.el.clientHeight,l=this.r.el.clientWidth;o.model.properties={...o.model.properties,width:l,height:a},o.model.width=l,o.model.height=a,o.model._width=l,o.model._height=a,o.model.refreshBranch(),o.graphModel.eventCenter.emit("custom:setData",o.model)}},updateAnchorList:a=>{o.model.properties.anchorList=a},setData:a=>{a.dataRaw=a.node_params,Ze(()=>{o.model.properties={...o.model.properties,...a};let l=null;this.r&&this.r.el&&(l=this.r.el.clientHeight),o.model.height=l||a.height||o.model.properties.height,o.model._height=l||a.height||o.model.properties.height,o.model.refreshBranch(),o.graphModel.eventCenter.emit("custom:setData",o.model)})},setTitle:a=>{o.model.properties.node_name=a,o.graphModel.eventCenter.emit("custom:setNodeName",{node_name:a,node_id:o.model.id,node_type:o.model.type})}}),mounted:()=>{}})}shouldUpdate(){const n={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(n)))return this.preProperties=JSON.stringify(n),!0}getAnchorShape(n){let o=this.props.graphModel.getNodeEdges(this.props.model.id),a=o.map($=>$.sourceAnchorId),l=o.map($=>$.targetAnchorId),i=!1;const{x:r,y:u,type:y}=n,p=10;y==="left"?i=l.includes(n.id):i=a.includes(n.id);const m=_t("circle",{className:"custom-anchor-circle",cx:r,cy:u,r:p,fill:"#fff",stroke:"#2475FC","stroke-width":2}),v=_t("g",{className:"custom-anchor-arrow",transform:`translate(${r-p-2}, ${u-p-2})`},[_t("circle",{cx:12,cy:12,r:p,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),_t("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),C=_t("g",{className:`custom-anchor-plus ${i?"anchor-hide":""}`,transform:`translate(${r-p-2}, ${u-p-2})`},[_t("circle",{cx:12,cy:12,r:p,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),_t("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),_t("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return _t("g",{id:n.id,className:`custom-anchor custom-anchor-${y} ${i?"anchor-selected":"anchor-not-selected"}`,onClick:$=>{$.stopPropagation();const{graphModel:w,model:S}=this.props;y==="right"&&!i&&w.eventCenter.emit("custom:showPopupMenu",{anchorData:n,model:S})}},m,v,C)}setHtml(n){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const o=document.createElement("div");o.className="root-node",o.id="node-"+this.props.model.id,n.appendChild(o),this.app.mount(o)}}}class mt extends Ni{createId(){return Js(this.type)}initNodeData(n){this.width=n.properties.width,this.height=n.properties.height,super.initNodeData(n)}getAnchorLineStyle(){const n=super.getAnchorLineStyle();return n.stroke="#2475FC",n}getOutlineStyle(){const n=super.getOutlineStyle();return n.stroke="none",n.hover.stroke="none",n}getGlobalVariable(){const{nodes:n}=this.graphModel;let o=n.find(i=>i.type==="start-node");if(!o)return{sys_global:[],diy_global:[],all_global:[]};let a=JSON.parse(o.properties.node_params);return{sys_global:a.start.sys_global,diy_global:a.start.diy_global,all_global:[...a.start.sys_global,...a.start.diy_global]}}getAllParentVariable(){var y,p,m;const n=[],o=new Set,a=this.incoming.edges,{nodes:l}=this.graphModel;let i=l.find(v=>v.type==="start-node");i&&(o.add(i.id),n.push(i));const r=v=>{var C,g;for(let $=0;$<v.length;$++){let S=v[$].sourceNode;if(!o.has(S.id)){if(o.add(S.id),ho.includes(S.type))if(S.type==="zm-plugins-node"){let k=rs(S.properties.node_params);(ef.includes(k.plugin.name)||(g=(C=k.plugin)==null?void 0:C.output_obj)!=null&&g.length)&&n.push(S)}else n.push(S);r(S.incoming.edges)}}};r(a);let u=[];if(this.properties.loop_parent_key){let v=l.find(C=>C.id==this.properties.loop_parent_key);v&&(n.filter(g=>g.id==this.properties.loop_parent_key).length>0||n.push(v))}for(const v of n){if(!ho.includes(v.type))continue;let C=JSON.parse(v.properties.node_params),g={label:v.properties.node_name,value:v.id,node_id:v.id,node_type:v.properties.node_type,typ:"node",children:[],loop_parent_key:v.properties.loop_parent_key};if(v.type==="http-node"&&(g.children=C.curl.output),v.type==="http-tool-node"&&(g.children=C.curl.output),v.type==="zm-workflow-node"&&(g.children=C.workflow.output),v.type==="voice-synthesis-node"&&(g.children=C.text_to_audio.output),v.type==="voice-clone-node"&&(g.children=C.voice_clone.output),v.type==="zm-plugins-node"&&(g.children=C.plugin.output||C.plugin.output_obj),v.type==="code-run-node"&&(g.children=C.code_run.output),v.type==="parameter-extraction-node"&&(g.children=C.params_extractor.output),v.type==="qa-node"&&(g.children=C.question.outputs),v.type==="start-node"&&(g.children=[...C.start.diy_global,...C.start.sys_global]),v.type==="custom-group"&&(this.properties.loop_parent_key==v.id?g.children=[...((y=C.loop)==null?void 0:y.intermediate_params)||[],...((p=C.loop)==null?void 0:p.loop_arrays)||[]]:g.children=C.loop.output),v.type==="batch-group"&&(this.properties.loop_parent_key==v.id?g.children=[...((m=C.batch)==null?void 0:m.batch_arrays)||[]]:g.children=C.batch.output),v.type==="import-library-node"&&(g.children=C.library_import.outputs),v.type==="json-node"&&(g.children=C.json_encode.output),v.type==="json-reverse-node"&&(g.children=C.json_decode.output),v.type==="select-data-node"&&(g.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),v.type==="knowledge-base-node"&&(g.children=[{key:"special.lib_paragraph_list",typ:"string",name:ws("var_knowledge_base_reference"),label:ws("var_knowledge_base_reference")}]),v.type==="ai-dialogue-node"&&(g.children=[{key:"special.llm_reply_content",typ:"string",name:ws("var_ai_reply_content"),label:ws("var_ai_reply_content")}]),v.type==="specify-reply-node"&&(g.children=[{key:"special.llm_reply_content",typ:"string",name:ws("var_message_content"),label:ws("var_message_content")}]),v.type==="immediately-reply-node"&&(g.children=[{key:"special.llm_reply_content",typ:"string",name:ws("var_message_content"),label:ws("var_message_content")}]),v.type==="problem-optimization-node"&&(g.children=[{key:"special.question_optimize_reply_content",typ:"string",name:ws("var_question_optimization_result"),label:ws("var_question_optimization_result")}]),v.type==="mcp-node"&&(g.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:ws("var_tool_generated_content")}]),v.type==="image-generation-node"){let $=C.image_generation.image_num;if($>0){let w=[];for(let S=0;S<+$;S++){let k=String.fromCharCode(97+S);w.push({key:`picture_url_${k}`,typ:"string",name:`picture_url_${k}`,label:`picture_url_${k}`})}g.children=w}}g.children=Array.isArray(g.children)?g.children:[],g.children.forEach($=>{$.node_id=v.id,$.node_name=v.properties.node_name,$.node_type=v.properties.node_type}),g.children=Nl(g.children,null),u.push(g)}return u}getTriggerNodes(){const{nodes:n}=this.graphModel;return n.filter(a=>a.properties.isTriggerNode)}refreshBranch(){this.incoming.edges.forEach(n=>{n.updatePathByAnchor()}),this.outgoing.edges.forEach(n=>{n.updatePathByAnchor()})}}const Hn="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",JU={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[],node_header_bg_color:""}},computed:{allMenus(){return[...this.menus,...this.localMenus]},t(){return fe("views.workflow.components.nodes.base-node").t}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(e){this.isShowMenu=!1,this.$emit("handleMenu",e)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){this.isShowMenu=!1;let e=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",e)},documentClick(e){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(e.target)&&e.target!==this.$el.querySelector(".node-menu-btn")&&e.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImgUrl(){return Eo(this.node_type)},updateTitle(e){this.setTitle(e)}}},zU=["data-node-name","data-node-type"],KU={class:"node-header-left"},GU={key:0,class:"node-icon"},WU=["src"],ZU={class:"node-title"},YU={key:0,class:"node-menu-wrapper"},QU={class:"node-menus"},XU=["onClick"],eJ={class:"node-body"};function tJ(e,n,o,a,l,i){return h(),D("div",{class:qe(["node-common-wrapper",[`node-common-wrapper_${o.iconName}`]]),"data-node-name":o.title,"data-node-type":o.node_type},[s("div",{class:qe(["node-common",{isHovered:o.isHovered,isSelected:o.isSelected}])},[s("div",{class:"node-header",style:jt({background:o.properties.node_header_bg_color||"none"})},[s("div",KU,[o.iconUrl||o.iconName?(h(),D("span",GU,[s("img",{src:o.iconUrl||i.getImgUrl(o.iconName),alt:""},null,8,WU)])):Z("",!0),s("span",ZU,_(o.title),1)]),s("div",null,[o.hideMenus?Z("",!0):(h(),D("div",YU,[s("div",{class:"node-menu-btn",onClick:n[0]||(n[0]=He((...r)=>i.showMenu&&i.showMenu(...r),["stop"]))},[...n[2]||(n[2]=[s("img",{class:"btn-icon",src:Hn,alt:""},null,-1)])]),$s(s("div",QU,[(h(!0),D(ee,null,se(i.allMenus,r=>(h(),D("div",{class:"node-menu",key:r.key,onClick:He(u=>i.handleMenu(r),["stop"])},_(i.t(r.name)),9,XU))),128)),s("div",{class:"node-menu del-btn",onClick:n[1]||(n[1]=He(r=>i.handleDelete(e.item),["stop"]))},_(i.t("btn_delete")),1)],512),[[Es,l.isShowMenu]])]))])],4),s("div",eJ,[Ns(e.$slots,"default",{},void 0,!0)])],2)],10,zU)}const gt=_e(JU,[["render",tJ],["__scopeId","data-v-7dc626f5"]]),sJ={name:"StartNode",components:{NodeCommon:gt},inject:["resetSize"],setup(){const{t:e}=fe("views.workflow.components.nodes.session-trigger-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{outputs:[],show:!1}},computed:{options(){return[...this.outputs]}},watch:{properties:{handler(e,n){const o=e.node_params||"{}",a=n.node_params||"{}";o!=a&&this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let e=JSON.parse(this.properties.node_params);this.outputs=e.trigger.outputs,this.$nextTick(()=>{this.resetSize()})}}},oJ={class:"start-node"},nJ={class:"start-node-options"},aJ={class:"options-title"},lJ={class:"options-list"},iJ={class:"option-label"},rJ={class:"option-type"};function dJ(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,"icon-url":o.properties.node_icon,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",oJ,[s("div",nJ,[s("div",aJ,_(a.t("label_output")),1),s("div",lJ,[(h(!0),D(ee,null,se(i.options,u=>(h(),D("div",{class:qe(["options-item",{"is-required":u.required}]),key:u.key},[s("div",iJ,_(u.key),1),s("div",rJ,_(u.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}const uJ=_e(sJ,[["render",dJ],["__scopeId","data-v-7e1309df"]]);let cJ=class extends ht{constructor(n){super(n),this.renderVue(uJ,n)}},_J=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",isHovered:r,isSelected:u,nodeId:n}]}};const pJ={type:"session-trigger-node",model:_J,view:cJ},fJ={name:"StartNode",components:{NodeCommon:gt},inject:["resetSize","setData","getGraph","getNode"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(){const{t:e}=fe("views.workflow.components.nodes.start-node");return{t:e}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(e,n){const o=e.node_params||"{}",a=n.node_params||"{}";o!=a&&this.reset()},deep:!0}},mounted(){this.reset();const e=this.getGraph();e.eventCenter.on("custom:trigger-add",this.onTriggerAdd),e.eventCenter.on("custom:trigger-change",this.onTriggerChange)},beforeUnmount(){const e=this.getGraph();e.eventCenter.off("custom:trigger-change",this.onTriggerChange),e.eventCenter.off("custom:trigger-add",this.onTriggerAdd)},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let e=JSON.parse(this.properties.node_params);this.sys_global=e.start.sys_global,this.diy_global=e.start.diy_global,this.trigger_list=e.start.trigger_list,this.$nextTick(()=>{this.resetSize()})},update(){let e=JSON.parse(this.properties.node_params);e.start.sys_global=this.sys_global,e.start.diy_global=this.diy_global,e.start.trigger_list=this.trigger_list,this.setData({node_params:JSON.stringify(e)})},onTriggerAdd(e){const{trigger:n}=JSON.parse(e.properties.node_params);this.trigger_list.push(n);const{outputs:o}=n,a=new Map(this.diy_global.map((l,i)=>[l.key,{item:l,index:i}]));o&&Array.isArray(o)&&o.forEach(l=>{if(a.has(l.key)){const{index:i}=a.get(l.key);this.diy_global[i]=l}else this.diy_global.push(l)}),this.update()},onTriggerChange(e){const o=this.getNode().getTriggerNodes(),a=[];o.forEach(l=>{const r=JSON.parse(l.properties.node_params).trigger||null;r&&(r.trigger_name=l.properties.node_name,a.push(r))}),this.trigger_list=a,this.update()}}},vJ={class:"start-node"},hJ={class:"start-node-options"},mJ={class:"options-title"},gJ={class:"options-list"},yJ={class:"option-label"},bJ={class:"option-type"};function kJ(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:f(()=>[s("div",vJ,[s("div",hJ,[s("div",mJ,_(a.t("output")),1),s("div",gJ,[(h(!0),D(ee,null,se(i.options,u=>(h(),D("div",{class:qe(["options-item",{"is-required":u.required}]),key:u.key},[s("div",yJ,_(u.key),1),s("div",bJ,_(u.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const wJ=_e(fJ,[["render",kJ],["__scopeId","data-v-119eef00"]]);let CJ=class extends ht{constructor(n){super(n),this.renderVue(wJ,n)}},$J=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(i,r,u,y)=>{if(i.id==r.id)return!1;const p=i.graphModel.edges.map(v=>v.sourceAnchorId),m=u.id;return u.type==="right"&&!p.includes(m)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,u,y)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[n,o];const a=["session-trigger-node"],l={message:"只允许连接左边的锚点",validate:(i,r,u,y)=>i.id==r.id?!1:y.type==="left"||a.includes(i.type)};this.targetRules=[l]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+25,id:y+"-anchor_left",type:"anchor_left",isHovered:r,isSelected:u,nodeId:n},{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",isHovered:r,isSelected:u,nodeId:n}]}};const xJ={type:"start-node",model:$J,view:CJ},jo={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(e){const n=e,o=sl(),{allModelList:a}=Lo(o);let l=ol(a.value).newList;const i=U(""),r=()=>{if(!n.useModel){i.value="";return}for(const u of l)if(u.children){for(const y of u.children)if(n.useModel==y.name&&n.modelConfigId==u.id){i.value=y.show_model_name||y.deployment_name||y.name;return}}};return Ie(()=>[n.useModel,n.modelConfigId],()=>{r()},{immediate:!0}),(u,y)=>(h(),D("span",null,_(i.value),1))}},Zs={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(e,{expose:n}){const o=e,a=be("getNode"),l=U([]),i=U("");function r(){let v=a().getAllParentVariable();l.value=u(v)}function u(v){return v.forEach(C=>{C.typ=="node"?C.node_type==1?C.value="global":C.value=C.node_id:C.value=C.key,C.children&&C.children.length>0&&(C.children=u(C.children))}),v}const y=(v,C)=>{for(const g of v){if(g.value===C)return g.label;if(g.children&&g.children.length>0){const $=y(g.children,C);if($)return $}}return null},p=()=>{if(!o.value||o.value.length===0)return"";r();let v=[];o.value.forEach(C=>{const g=y(l.value,C);g&&v.push(g)}),i.value=v.join("/")},m=()=>{p()};return Ie(()=>o.value,()=>{p()},{immediate:!0}),n({refresh:m}),(v,C)=>(h(),D("span",null,_(i.value),1))}},SJ={class:"ai-dialogue-node"},DJ={class:"field-list"},AJ={class:"field-item"},OJ={class:"field-item-label"},NJ={class:"field-item-content"},BJ={class:"field-value"},EJ={class:"field-key"},IJ={class:"field-item"},FJ={class:"field-item-label"},RJ={class:"field-item-content"},LJ={class:"field-value"},VJ={class:"field-key"},MJ={class:"field-item"},TJ={class:"field-item-label"},jJ={class:"field-item-content"},PJ={class:"category-list"},qJ={class:"field-value category-value"},HJ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.question-node.index"),o=e,a=be("setData"),l=be("resetSize"),i=Pt(),{modelList:r}=Lo(i),u=U([]),y=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[]});function p(C){if(C&&typeof C=="string"){let g=C.split("."),$=g[0],w=g.filter((S,k)=>k>0).join(".");return[$,w]}else if(C&&typeof C=="object"&&C.length===2)return C;return["global","question"]}const m=()=>{const C=o.properties.dataRaw||o.properties.node_params||"{}";let g={};try{g=JSON.parse(C).cate||{}}catch{g={}}g=JSON.parse(JSON.stringify(g));for(let $ in g)if($==="question_value")y.question_value=p(g.question_value);else if($=="categorys")if(g.categorys&&g.categorys.length>0){let w=g.categorys.map(S=>({...S}));y[$]=w}else y[$]=[{category:"",next_node_key:"",key:nt(16)}];else y[$]=g[$];!y.model_config_id&&r.value.length>0&&(y.model_config_id=r.value[0].id,y.use_model=r.value[0].children[0].name),Ze(()=>{l()})},v=()=>{const C=y.model_config_id?+y.model_config_id:y.model_config_id,g=JSON.stringify({cate:{...y,question_value:y.question_value.join("."),model_config_id:C}});a({...o.node,...y,node_params:g})};return Ie(()=>o.properties,(C,g)=>{const $=C.dataRaw||C.node_params||"{}",w=g.dataRaw||g.node_params||"{}";$!=w&&m()},{deep:!0}),Ne(()=>{m(),l(),v()}),Ut(()=>{}),(C,g)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",SJ,[s("div",DJ,[s("div",AJ,[s("div",OJ,_(d(n)("label_user_question")),1),s("div",NJ,[s("div",BJ,[s("span",EJ,[c(Zs,{ref:"questionTextRef",value:y.question_value},null,8,["value"])])])])]),s("div",IJ,[s("div",FJ,_(d(n)("label_llm_model")),1),s("div",RJ,[s("div",LJ,[s("span",VJ,[c(jo,{useModel:y.use_model,modelConfigId:y.model_config_id},null,8,["useModel","modelConfigId"])])])])]),s("div",MJ,[s("div",TJ,_(d(n)("label_question_category")),1),s("div",jJ,[s("div",PJ,[(h(!0),D(ee,null,se(y.categorys,$=>(h(),D("div",{class:"field-value category-value",key:$.key},[s("span",null,_($.category),1)]))),128)),s("div",qJ,[s("span",null,_(d(n)("label_default_category")),1)])])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},UJ=_e(HJ,[["__scopeId","data-v-d5adcf59"]]);let JJ=class extends ht{constructor(n){super(n),this.renderVue(UJ,n)}},zJ=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getAnchorPos(){return tf(this.properties)}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;let p=[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n}],m=this.getAnchorPos(),v=a-i/2;for(let C=0;C<m.length;C++)p.push({id:m[C].id,x:o+l/2,y:v+132+C*32,type:"right",nodeId:n});return p.push({id:y+"-anchor_right",x:o+l/2,y:i/2+a-28,type:"right",nodeId:n}),p}};const KJ={type:"question-node",model:zJ,view:JJ},GJ={name:"QuestionNode",components:{NodeCommon:gt},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(){const{t:e}=fe("views.workflow.components.nodes.action-node.index");return{t:e}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(e){if(e.key==="delete"){let n=this.getNode();this.getGraph().deleteNode(n.id)}}}},WJ={class:"question-node"},ZJ={class:"node-desc"};function YJ(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,menus:l.menus,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,onHandleMenu:i.handleMenu},{default:f(()=>[s("div",WJ,[s("div",ZJ,_(o.properties.content||a.t("msg_click_to_set_content")),1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const QJ=_e(GJ,[["render",YJ],["__scopeId","data-v-9d6ac88e"]]);let XJ=class extends ht{constructor(n){super(n),this.renderVue(QJ,n)}},ez=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;let p=[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n}];return this.properties.node_type!=5&&p.push({x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}),p}};const tz={type:"action-node",model:ez,view:XJ},Bl=e=>{let n=[];return e.forEach(o=>{o.children&&o.children.length>0?n.push(...Bl(o.children)):n.push(o)}),n},sz={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open","resize"],props:{type:{type:String,default:"input",validator(e){return["input","textarea"].includes(e)}},placeholder:{type:String,default:"ph_input"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},setup(){const{t:e}=fe("views.workflow.components.at-input.at-text");return{t:e}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},computed:{computedPlaceholder(){return this.placeholder==="ph_input"?this.t("ph_input"):this.placeholder}},watch:{defaultValue(e){e!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(e){this.onOpen(e)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(e){const n=document.createElement("div");n.innerHTML=e;let o="";return Array.from(n.childNodes).forEach(a=>{let l="";this.type==="textarea"?a.nodeName==="BR"?l=`
`:a.classList&&a.classList.contains("j-mention-at")?l=a.dataset.value:l=a.textContent:a.classList&&a.classList.contains("j-mention-at")?l=a.dataset.value:a.nodeName==="BR"?l="":l=a.textContent.replace(/\n/g,""),(l==="&nbsp;"||l===" ")&&(l=""),o+=l}),o},onChange(){let n=this.$refs.JMention.innerHTML,o=this.getText(n);this.localValue=o;let a={};this.selectedList.forEach(i=>{!a[i.value]&&o.indexOf(i.value)!==-1&&(a[i.value]=i)});let l=Object.values(a);this.$emit("change",o,l)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const e=this.$refs.JMention;let n=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=this.defaultSelectedList||[],a=Bl(this.options),l=[...o,...a].filter(r=>r&&r.value&&r.value!=""&&r.typ!=="node");const i=new Set;l.forEach(r=>{const u=new RegExp(`(${r.value})`,"g");if(u.test(this.defaultValue)&&!i.has(r.value)){let y=r.node_name+"."+r.text;y=y.replace(/\./g,"/"),n=n.replace(u,`<span class="j-mention-at" data-id="${r.node_id}" contentEditable="false" data-value="${r.value}">${y}</span>`),i.add(r.value),this.selectOption(r,!0)}}),e.innerHTML=n,this.localValue=this.defaultValue,this.$nextTick(()=>{this.$emit("resize")})},initShowOptionList(){this.showOptions=this.options.filter(e=>this.atText?e.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(e.id+""))},getLastChar(e=1){const n=window.getSelection();if(n.rangeCount<=0)return;const o=n.getRangeAt(0),a=o.startOffset,l=o.startContainer;let i="";if(l.nodeType===Node.TEXT_NODE)i=l.textContent.slice(0,a);else if(l.nodeType===Node.ELEMENT_NODE){const r=l.childNodes;for(let u=0;u<r.length;u++){const y=r[u];y.nodeType===Node.TEXT_NODE&&(u===r.length-1?i+=y.textContent.slice(0,a):i+=y.textContent)}}return i.slice(-e)},getLastAtText(){const e=window.getSelection();if(e.rangeCount<=0)return;const n=e.getRangeAt(0),o=n.startOffset,a=n.startContainer;let l="";if(a.nodeType===Node.TEXT_NODE)l=a.textContent.slice(0,o);else if(a.nodeType===Node.ELEMENT_NODE){const r=a.childNodes;for(let u=0;u<r.length;u++){const y=r[u];y.nodeType===Node.TEXT_NODE&&(u===r.length-1?l+=y.textContent.slice(0,o):l+=y.textContent)}}const i=l.lastIndexOf("/");return i===-1?"":l.slice(i+1)},async getCaretPosition(){const e=window.getSelection();if(e.rangeCount<=0)return{top:0,left:0};const o=e.getRangeAt(0).getBoundingClientRect(),a=await this.getDropdownListSize();let l=o.bottom,i=o.left;const r=window.innerWidth,u=window.innerHeight;return i+a.width>r&&(i=r-a.width),l+a.height>u&&(l=o.top-a.height),{top:l,left:i,x:i,y:l}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const e=this.$refs.dropdownList.offsetWidth,n=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:e,height:n}},updateSelectedList(){const n=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const o of n){let a=o.dataset.value;const l=this.options.find(i=>i.value==a);this.selectedList.push(l),this.selectedIdSet.add(a)}this.$emit("update:selectedList",this.selectedList),!(n.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(e){return this.options.filter(o=>o.label.startsWith(e)).length>0},updateValue(){this.onChange()},insertAtCaret(e,n){let o=this.atText.length+1;this.getLastChar(o)!=="/"+this.atText&&(o=0);const l=window.getSelection();if(l.rangeCount<=0)return;const i=l.getRangeAt(0),r=i.startOffset,u=i.startContainer;let y=r-o,p=u;if(y<0){let m=u.previousSibling;for(;m;){if(m.nodeType===Node.TEXT_NODE){y=m.textContent.length-o,p=m;break}m=m.previousSibling}}if(p.nodeType===Node.TEXT_NODE){p.replaceData(y,o," ");const m=document.createElement("span");m.contentEditable="false",m.classList.add("j-mention-at"),m.style=this.atTextStyle,m.textContent=`${e}`;for(const g in n)m.dataset[g]=n[g];const v=document.createRange();v.setStart(p,y),v.insertNode(m);let C=m.nextSibling;i.setStart(C,1),i.setEnd(C,1),l.removeAllRanges(),l.addRange(i)}},onSelectOption(e,n,o){let a=o[o.length-1];delete a.children,this.selectOption(a)},selectOption(e,n=!1){if(!e)return;this.showDropdown=!1,this.showAtList=!1;let o=e.node_name+"."+e.text;o=o.replace(/\./g,"/");const a={id:e.id,label:e.label,value:e.value,text:e.text,index:this.selectedList.length};this.selectedList.push(e),this.selectedIdSet.add(e.value),n||(this.insertAtCaret(o,a),this.initShowOptionList(),this.updateValue())}}};function oz(e,n,o,a,l,i){return h(),D("span",{ref:"JMention",class:qe(["j-mention",["type-"+o.type]])},null,2)}const $t=_e(sz,[["render",oz]]),nz={class:"ai-dialogue-node"},az={class:"field-list"},lz={class:"field-item"},iz={class:"field-item-content"},rz={class:"field-list-item"},dz={class:"field-text"},uz={key:1},cz={class:"field-item"},_z={class:"field-item-label"},pz={class:"field-item-content"},fz={class:"field-value"},vz={class:"field-key"},hz={key:0,class:"field-item menu-list-box"},mz={class:"field-text"},gz={key:1},yz={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.qa-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=U([]),y=U([]),p=we({answer_text:"",answer_type:"text",reply_content_list:[],menu_content:[{menu_type:"1",serial_no:"1",content:""},{menu_type:"1",serial_no:"2",content:""}],outputs:[{key:"question",typ:"string",subs:[]},{key:"question_multiple",typ:"array<object>",subs:[]}]}),m=()=>{let w=o.properties.nodeSortKey,S=l().edges;if(p.answer_type=="text")p.menu_content.forEach((k,b)=>{let x=w+"-anchor_"+b,A=S.find(R=>R.sourceAnchorId==x);A&&l().eventCenter.emit("custom:edge:delete",A)});else{let k=w+"-anchor_right",b=S.find(x=>x.sourceAnchorId==k);b&&l().eventCenter.emit("custom:edge:delete",b)}};Ie(()=>p.answer_type,w=>{m()});const v=()=>{var b;$();const w=o.properties.dataRaw||o.properties.node_params||"{}";let S=JSON.parse(w).question||{};S=JSON.parse(JSON.stringify(S)),p.answer_text=S.answer_text||"",p.answer_type=S.answer_type||"text",p.reply_content_list=S.reply_content_list||[];let k=S.reply_content_list||[];if(k.length>0){let x=((b=k[0].smart_menu)==null?void 0:b.menu_content)||[];x.length>0&&(p.menu_content=x)}Ze(()=>{r()})},C=()=>{const w=JSON.stringify({question:{...p}});a({...o.node,node_params:w})},g=w=>{C()},$=()=>{let w=i().getAllParentVariable();y.value=w||[]};return Ie(()=>o.properties,v,{deep:!0}),Ne(()=>{v(),r(),l().eventCenter.on("custom:setNodeName",g)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",g)}),(w,S)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",nz,[s("div",az,[s("div",lz,[s("div",{class:"field-item-label",onClick:m},_(d(n)("label_question_content")),1),s("div",iz,[s("div",rz,[s("div",dz,[p.answer_text.length>0?(h(),G($t,{key:0,options:y.value,defaultValue:p.answer_text,ref:"atInputRef"},null,8,["options","defaultValue"])):(h(),D("span",uz,"--"))])])])]),s("div",cz,[s("div",_z,_(d(n)("label_answer_type")),1),s("div",pz,[s("div",fz,[s("span",vz,_(d(n)(p.answer_type=="text"?"label_direct_answer":"label_smart_menu_answer")),1)])])]),p.answer_type=="menu"?(h(),D("div",hz,[(h(!0),D(ee,null,se(p.menu_content,(k,b)=>(h(),D("div",{class:"menu-list-item",key:b},[s("div",mz,[k.content.length>0?(h(),G($t,{key:0,options:y.value,defaultValue:k.content,ref_for:!0,ref:"atInputRef"},null,8,["options","defaultValue"])):(h(),D("span",gz,"--"))])]))),128))])):Z("",!0)])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},bz=_e(yz,[["__scopeId","data-v-3d7ec566"]]);let kz=class extends ht{constructor(n){super(n),this.renderVue(bz,n)}},wz=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){var m;const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;let p={};try{p=JSON.parse(this.properties.dataRaw).question}catch{}if(p.answer_type=="menu"){let v=[];if(p.reply_content_list&&p.reply_content_list.length>0){let C=((m=p.reply_content_list[0].smart_menu)==null?void 0:m.menu_content)||[],g=a-i/2;C.forEach(($,w)=>{v.push({id:y+"-anchor_"+w,x:o+l/2,y:g+132+w*32,type:"right",nodeId:n})})}return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},...v]}else return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const Cz={type:"qa-node",model:wz,view:kz},$z={class:"ai-dialogue-node"},xz={class:"field-list"},Sz={class:"field-item"},Dz={class:"field-item-label"},Az={class:"field-item-content"},Oz={class:"field-value"},Nz={class:"field-item"},Bz={class:"field-item-label"},Ez={class:"field-item-content"},Iz={class:"field-value"},Fz={class:"field-key"},Rz={class:"field-item"},Lz={class:"field-item-label"},Vz={class:"field-item-content"},Mz={class:"field-value is-required"},Tz={class:"field-key"},jz={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.ai-dialogue-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=Pt(),{modelList:y}=Lo(u),p=U(null),m=U([]),v=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),C=U([]);function g(b){if(b){let x=b.split("."),A=x[0],R=x.filter((E,B)=>B>0).join(".");return[A,R]}return["global","question"]}const $=()=>{const b=o.properties.dataRaw||o.properties.node_params||"{}";let x={};try{x=JSON.parse(b).llm||{}}catch{x={}}S();const{model_config_id:A,use_model:R,context_pair:E,temperature:B,max_token:N,prompt:I,prompt_tags:L,question_value:q,enable_thinking:O,libs_node_key:M}=JSON.parse(JSON.stringify(x));v.model_config_id=A,v.use_model=R,v.context_pair=E||0,v.temperature=B,v.max_token=N,v.prompt=I,v.enable_thinking=O,v.prompt_tags=L||[],v.libs_node_key=M,v.question_value=g(q),!v.model_config_id&&y.value.length>0&&(v.model_config_id=y.value[0].id,v.use_model=y.value[0].children[0].name),Ze(()=>{r()})},w=()=>{const b=JSON.stringify({llm:{...v,question_value:v.question_value.join("."),model_config_id:v.model_config_id?+v.model_config_id:v.model_config_id}});a({...o.node,...v,node_params:b})},S=()=>{let b=i().getAllParentVariable();C.value=b},k=b=>{S(),v.prompt_tags&&v.prompt_tags.length>0&&v.prompt_tags.forEach(x=>{if(x.node_id==b.node_id){let A=x.label.split("/");A[0]=b.node_name,x.label=A.join("/"),x.node_name=b.node_name}}),w(),p.value.refresh()};return Ie(()=>o.properties,$,{deep:!0}),Ne(()=>{$(),r(),l().eventCenter.on("custom:setNodeName",k)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",k)}),(b,x)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:m.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",$z,[s("div",xz,[s("div",Sz,[s("div",Dz,_(d(n)("label_user_question")),1),s("div",Az,[s("div",Oz,[c(Zs,{ref_key:"questionTextRef",ref:p,value:v.question_value},null,8,["value"])])])]),s("div",Nz,[s("div",Bz,_(d(n)("label_llm_model")),1),s("div",Ez,[s("div",Iz,[s("span",Fz,[c(jo,{useModel:v.use_model,modelConfigId:v.model_config_id},null,8,["useModel","modelConfigId"])])])])]),s("div",Rz,[s("div",Lz,_(d(n)("label_output")),1),s("div",Vz,[s("div",Mz,[s("span",Tz,_(d(n)("label_ai_reply_content")),1),x[0]||(x[0]=s("span",{class:"field-type"},"string",-1))])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Pz=_e(jz,[["__scopeId","data-v-6ccf6fc5"]]);let qz=class extends ht{constructor(n){super(n),this.renderVue(Pz,n)}},Hz=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const Uz={type:"ai-dialogue-node",model:Hz,view:qz},Jz={class:"ai-dialogue-node"},zz={class:"field-list"},Kz={class:"field-item"},Gz={class:"field-item-label"},Wz={class:"field-item-content"},Zz={class:"field-value"},Yz={class:"field-key"},Qz={key:0,class:"field-type"},Xz={class:"field-item"},eK={class:"field-item-label"},tK={class:"field-item-content"},sK={class:"field-text"},oK={class:"right-arrow"},nK={class:"field-text2"},aK={class:"field-item"},lK={class:"field-item-label"},iK={class:"field-item-content"},rK={class:"field-text"},dK={class:"right-arrow"},uK={class:"field-text2"},cK={key:0,class:"field-item"},_K={class:"field-item-label"},pK={class:"field-item-content"},fK={class:"field-text"},vK={class:"right-arrow"},hK={class:"field-text2"},mK={key:1,class:"field-item"},gK={class:"field-item-label"},yK={class:"field-item-content"},bK={class:"field-list-item body_raw"},kK={class:"field-item"},wK={class:"field-item-label"},CK={class:"field-item-content"},$K={class:"field-key"},xK={class:"field-type"},SK={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.http-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=U([]),y=we({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[]});function p(S){return S.forEach(k=>{k.cu_key=Math.random()*1e4,k.subs&&k.subs.length?p(k.subs):k.subs=[]}),S}const m=U([]),v=()=>{const S=o.properties.dataRaw||o.properties.node_params||"{}";let k={};try{k=JSON.parse(S).curl||{}}catch{k={}}g(),k=JSON.parse(JSON.stringify(k));for(let b in k){if(b=="headers"||b=="params"||b=="body"){k[b]&&k[b].length>0?y[b]=k[b].map(x=>({...x,cu_key:Math.random()*1e4})):y[b]=[];continue}if(b=="output"){y.output=p(k[b]);continue}y[b]=k[b]}Ze(()=>{r()})},C=()=>{const S=JSON.stringify({curl:{...y}});a({...o.node,...y,node_params:S})},g=()=>{let S=i().getAllParentVariable();S.forEach(k=>{k.tags=k.tags||[]}),m.value=S},$=S=>{ns.includes(S.node_type)&&(g(),Ze(()=>{y.body_raw_tags&&y.body_raw_tags.length>0&&y.body_raw_tags.forEach(b=>{if(b.node_id==S.node_id){let x=b.label.split("/");x[0]=S.node_name,b.label=x.join("/"),b.node_name=S.node_name}}),["headers","params","body"].forEach(b=>{y[b].forEach(A=>{A.tags&&A.tags.length>0&&A.tags.forEach(R=>{if(R.node_id==S.node_id){let E=R.label.split("/");E[0]=S.node_name,R.label=E.join("/"),R.node_name=S.node_name}})})}),C()}))},w=()=>{};return Ie(()=>o.properties,v,{deep:!0}),Ne(()=>{v(),r(),l().eventCenter.on("custom:setNodeName",$)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",$)}),(S,k)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,onClick:w},{default:f(()=>[s("div",Jz,[s("div",zz,[s("div",Kz,[s("div",Gz,_(d(n)("label_request_url")),1),s("div",Wz,[s("div",Zz,[s("span",Yz,_(y.method),1),y.rawurl?(h(),D("span",Qz,_(y.rawurl),1)):Z("",!0)])])]),s("div",Xz,[s("div",eK,_(d(n)("label_headers")),1),s("div",tK,[(h(!0),D(ee,null,se(y.headers,b=>(h(),D("div",{class:"field-list-item",key:b.cu_key},[s("div",sK,_(b.key),1),s("div",oK,[c(d(zs))]),s("div",nK,[c($t,{options:m.value,"default-value":b.value,defaultSelectedList:b.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),s("div",aK,[s("div",lK,_(d(n)("label_params")),1),s("div",iK,[(h(!0),D(ee,null,se(y.params,b=>(h(),D("div",{class:"field-list-item",key:b.cu_key},[s("div",rK,_(b.key),1),s("div",dK,[c(d(zs))]),s("div",uK,[c($t,{options:m.value,"default-value":b.value,defaultSelectedList:b.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),y.type==1?(h(),D("div",cK,[s("div",_K,_(d(n)("label_body")),1),s("div",pK,[(h(!0),D(ee,null,se(y.body,b=>(h(),D("div",{class:"field-list-item",key:b.cu_key},[s("div",fK,_(b.key),1),s("div",vK,[c(d(zs))]),s("div",hK,[c($t,{options:m.value,"default-value":b.value,defaultSelectedList:b.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):Z("",!0),y.type==2?(h(),D("div",mK,[s("div",gK,_(d(n)("label_body")),1),s("div",yK,[s("div",bK,_(y.body_raw),1)])])):Z("",!0),s("div",kK,[s("div",wK,_(d(n)("label_output_fields")),1),s("div",CK,[(h(!0),D(ee,null,se(y.output,b=>(h(),D("div",{class:"field-value",key:b.cu_key},[s("span",$K,_(b.key),1),s("span",xK,_(b.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},DK=_e(SK,[["__scopeId","data-v-94585598"]]);let AK=class extends ht{constructor(n){super(n),this.renderVue(DK,n)}},OK=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+26,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+26,id:y+"-anchor_right",type:"right",nodeId:n}]}};const NK={type:"http-node",model:OK,view:AK},BK={class:"ai-dialogue-node"},EK={class:"field-list"},IK={class:"field-item"},FK={class:"field-item-content"},RK={class:"field-value"},LK={class:"field-key"},VK={class:"field-type"},MK={class:"field-item"},TK={class:"field-item-content"},jK={class:"field-text"},PK={class:"right-arrow"},qK={class:"field-text2"},HK={class:"field-item"},UK={class:"field-item-content"},JK={class:"field-text"},zK={class:"right-arrow"},KK={class:"field-text2"},GK={key:0,class:"field-item"},WK={class:"field-item-content"},ZK={class:"field-text"},YK={class:"right-arrow"},QK={class:"field-text2"},XK={key:1,class:"field-item"},eG={class:"field-item-content"},tG={class:"field-list-item"},sG={class:"field-item"},oG={class:"field-item-content"},nG={class:"field-key"},aG={class:"field-type"},lG={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const n=e,o=be("setData"),a=be("getGraph"),l=be("getNode"),i=be("resetSize"),r=U([]),u=we({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function y(w){return w.forEach(S=>{S.cu_key=Math.random()*1e4,S.subs&&S.subs.length?y(S.subs):S.subs=[]}),w}const p=U([]),m=()=>{const w=n.properties.dataRaw||n.properties.node_params||"{}";let S={};try{S=JSON.parse(w).curl||{}}catch{S={}}C(),S=JSON.parse(JSON.stringify(S));for(let k in S){if(k=="headers"||k=="params"||k=="body"){S[k]&&S[k].length>0?u[k]=S[k].map(b=>({...b,cu_key:Math.random()*1e4})):u[k]=[];continue}if(k=="output"){u.output=y(S[k]);continue}u[k]=S[k]}Ze(()=>{i()})},v=()=>{const w=JSON.stringify({curl:{...u}});o({...n.node,...u,node_params:w})},C=()=>{let w=l().getAllParentVariable();w.forEach(S=>{S.tags=S.tags||[]}),p.value=w},g=w=>{ns.includes(w.node_type)&&(C(),Ze(()=>{u.body_raw_tags&&u.body_raw_tags.length>0&&u.body_raw_tags.forEach(k=>{if(k.node_id==w.node_id){let b=k.label.split("/");b[0]=w.node_name,k.label=b.join("/"),k.node_name=w.node_name}}),["headers","params","body"].forEach(k=>{u[k].forEach(x=>{x.tags&&x.tags.length>0&&x.tags.forEach(A=>{if(A.node_id==w.node_id){let R=A.label.split("/");R[0]=w.node_name,A.label=R.join("/"),A.node_name=w.node_name}})})}),v()}))},$=()=>{};return Ie(()=>n.properties,m,{deep:!0}),Ne(()=>{m(),i(),a().eventCenter.on("custom:setNodeName",g)}),Ut(()=>{a().eventCenter.off("custom:setNodeName",g)}),(w,S)=>(h(),G(gt,{properties:e.properties,title:n.properties.node_name,menus:r.value,"icon-url":n.properties.node_icon,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,onClick:$},{default:f(()=>[s("div",BK,[s("div",EK,[s("div",IK,[S[0]||(S[0]=s("div",{class:"field-item-label"},"请求地址",-1)),s("div",FK,[s("div",RK,[s("span",LK,_(u.method),1),s("span",VK,_(u.rawurl),1)])])]),s("div",MK,[S[1]||(S[1]=s("div",{class:"field-item-label"},"HEADERS",-1)),s("div",TK,[(h(!0),D(ee,null,se(u.headers,k=>(h(),D("div",{class:"field-list-item",key:k.cu_key},[s("div",jK,_(k.key),1),s("div",PK,[c(d(zs))]),s("div",qK,[c($t,{options:p.value,"default-value":k.value,defaultSelectedList:k.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),s("div",HK,[S[2]||(S[2]=s("div",{class:"field-item-label"},"PARAMS",-1)),s("div",UK,[(h(!0),D(ee,null,se(u.params,k=>(h(),D("div",{class:"field-list-item",key:k.cu_key},[s("div",JK,_(k.key),1),s("div",zK,[c(d(zs))]),s("div",KK,[c($t,{options:p.value,"default-value":k.value,defaultSelectedList:k.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),u.type==1?(h(),D("div",GK,[S[3]||(S[3]=s("div",{class:"field-item-label"},"BODY",-1)),s("div",WK,[(h(!0),D(ee,null,se(u.body,k=>(h(),D("div",{class:"field-list-item",key:k.cu_key},[s("div",ZK,_(k.key),1),s("div",YK,[c(d(zs))]),s("div",QK,[c($t,{options:p.value,"default-value":k.value,defaultSelectedList:k.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):Z("",!0),u.type==2?(h(),D("div",XK,[S[4]||(S[4]=s("div",{class:"field-item-label"},"BODY",-1)),s("div",eG,[s("div",tG,_(u.body_raw),1)])])):Z("",!0),s("div",sG,[S[5]||(S[5]=s("div",{class:"field-item-label"},"输出字段",-1)),s("div",oG,[(h(!0),D(ee,null,se(u.output,k=>(h(),D("div",{class:"field-value",key:k.cu_key},[s("span",nG,_(k.key),1),s("span",aG,_(k.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-url","isSelected","isHovered","node-key","node_type"]))}},iG=_e(lG,[["__scopeId","data-v-1b3b9123"]]);let rG=class extends ht{constructor(n){super(n),this.renderVue(iG,n)}},dG=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+26,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+26,id:y+"-anchor_right",type:"right",nodeId:n}]}};const uG={type:"http-tool-node",model:dG,view:rG},cG={class:"ai-dialogue-node"},_G={class:"field-list"},pG={class:"field-item"},fG={class:"field-item-label"},vG={class:"field-item-content"},hG={class:"field-value"},mG={class:"field-item"},gG={class:"field-item-label"},yG={class:"field-item-content"},bG={class:"field-value is-required"},kG={class:"field-key"},wG={class:"field-item"},CG={class:"field-item-label"},$G={class:"field-item-content"},xG={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.knowledge-base-node.index"),o=Pt(),a=ye(()=>o.robotInfo.rrf_weight),l=e,i=be("setData"),r=be("getGraph"),u=be("getNode"),y=be("resetSize"),p=U(null),m=U([]),v=we({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[],rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),C=U([]);function g(R){if(R){let E=R.split("."),B=E[0],N=E.filter((I,L)=>L>0).join(".");return[B,N]}return["global","question"]}const $=()=>{const R=l.properties.dataRaw||l.properties.node_params||"{}";let E={};try{E=JSON.parse(R).libs||{}}catch{E={}}x(),E=JSON.parse(JSON.stringify(E));for(let B in E)B=="library_ids"?v[B]=E[B]?E[B].split(","):[]:B=="question_value"?v.question_value=g(E.question_value):B=="rrf_weight"?v.rrf_weight=E[B]?JSON.parse(E[B]):E[B]:v[B]=E[B];(!v.rrf_weight||Object.keys(v.rrf_weight).length==0)&&(v.rrf_weight=a.value),Ze(()=>{y()})},w=()=>{const R=JSON.stringify({libs:{...v,rerank_model_config_id:v.rerank_model_config_id?+v.rerank_model_config_id:void 0,question_value:v.question_value.join("."),library_ids:v.library_ids.join(","),rrf_weight:JSON.stringify(v.rrf_weight),recall_neighbor_switch:v.recall_neighbor_switch,recall_neighbor_before_num:v.recall_neighbor_before_num,recall_neighbor_after_num:v.recall_neighbor_before_num}});i({...l.node,node_params:R})},S=U([]),k=ye(()=>S.value.filter(R=>v.library_ids.includes(R.id))),b=async()=>{const R=await Vo({type:""});R&&(S.value=R.data||[],Ze(()=>{y()}))},x=()=>{let R=u().getAllParentVariable();C.value=R},A=()=>{x(),w(),p.value.refresh()};return Ie(()=>l.properties,$,{deep:!0}),Ne(()=>{b(),$(),r().eventCenter.on("custom:setNodeName",A)}),Ut(()=>{r().eventCenter.off("custom:setNodeName",A)}),(R,E)=>(h(),G(gt,{properties:e.properties,title:l.properties.node_name,menus:m.value,"icon-name":l.properties.node_icon_name,isSelected:l.isSelected,isHovered:l.isHovered,"node-key":l.properties.node_key,node_type:l.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",cG,[s("div",_G,[s("div",pG,[s("div",fG,_(d(n)("label_user_question")),1),s("div",vG,[s("div",hG,[c(Zs,{ref_key:"questionTextRef",ref:p,value:v.question_value},null,8,["value"])])])]),s("div",mG,[s("div",gG,_(d(n)("label_output_fields")),1),s("div",yG,[s("div",bG,[s("span",kG,_(d(n)("label_knowledge_base_reference")),1),E[0]||(E[0]=s("span",{class:"field-type"},"string",-1))])])]),s("div",wG,[s("div",CG,_(d(n)("label_knowledge_base")),1),s("div",$G,[(h(!0),D(ee,null,se(k.value,B=>(h(),D("div",{class:"library-item",key:B.id},_(B.library_name),1))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},SG=_e(xG,[["__scopeId","data-v-071c05c4"]]);let DG=class extends ht{constructor(n){super(n),this.renderVue(SG,n)}},AG=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const OG={type:"knowledge-base-node",model:AG,view:DG},NG={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:gt},setup(){const{t:e}=fe("views.workflow.components.nodes.end-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}},BG={class:"end-node"},EG={class:"node-desc"};function IG(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,menus:l.menus,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,onHandleMenu:i.handleMenu,style:{width:"420px",height:"116px"}},{default:f(()=>[s("div",BG,[s("div",EG,_(a.t("msg_trigger_node_end_return_result")),1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const FG=_e(NG,[["render",IG],["__scopeId","data-v-34061572"]]);let RG=class extends ht{constructor(n){super(n),this.renderVue(FG,n)}},LG=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n}]}};const VG={type:"end-node",model:LG,view:RG},MG={class:"explain-node"},TG={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const n=be("resetSize"),o=e;Ie(()=>o.properties,(i,r)=>{const u=i.node_params||"{}",y=r.node_params||"{}";u!=y&&l()},{deep:!0});const a=we({content:""}),l=()=>{if(!o.properties||!o.properties.node_params)return;let i=JSON.parse(o.properties.node_params);Object.assign(a,i),Ze(()=>{n()})};return Ne(()=>{l()}),(i,r)=>{const u=Ts;return h(),G(gt,{properties:e.properties,title:e.properties.node_name,"icon-url":e.properties.node_icon,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",MG,[c(u,{"auto-size":"",bordered:!1,class:"explain-textarea",value:a.content,"onUpdate:value":r[0]||(r[0]=y=>a.content=y),placeholder:""},null,8,["value"])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}}};let jG=class extends ht{constructor(n){super(n),this.renderVue(TG,n)}},PG=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[]}};const qG={type:"explain-node",model:PG,view:jG},HG={class:"ai-dialogue-node"},UG={class:"field-list"},JG={class:"field-item"},zG={class:"field-item-label"},KG={class:"field-item-content"},GG={class:"field-text"},WG={class:"right-arrow"},ZG={class:"field-text"},YG={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.variable-assignment-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=U([]),y=we({list:[]}),p=U([]),m=()=>{const w=o.properties.dataRaw||o.properties.node_params||"{}";let S=[];try{S=JSON.parse(w).assign||[]}catch(k){}g(),S.forEach(k=>{k.tags=k.tags||[]}),y.list=S,Ze(()=>{v()})},v=()=>{let w=JSON.parse(o.properties.node_params);w.assign=[...y.list],a({...o.node,node_params:JSON.stringify(w)})};function C(w){return w?w.split(".")[1]:""}const g=()=>{let w=i().getAllParentVariable();w.forEach(S=>{S.tags=S.tags||[]}),p.value=w},$=w=>{ns.includes(w.node_type)&&(g(),Ze(()=>{y.list.forEach(S=>{S.tags&&S.tags.length>0&&S.tags.forEach(k=>{if(k.node_id==w.node_id){let b=k.label.split("/");b[0]=w.node_name,k.label=b.join("/"),k.node_name=w.node_name}})}),v()}))};return Ie(()=>o.properties,m,{deep:!0}),Ne(()=>{m(),r(),l().eventCenter.on("custom:setNodeName",$)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",$)}),(w,S)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",HG,[s("div",UG,[s("div",JG,[s("div",zG,_(d(n)("label_variable")),1),s("div",KG,[(h(!0),D(ee,null,se(y.list,(k,b)=>(h(),D("div",{class:"field-list-item",key:b},[s("div",GG,[c($t,{options:p.value,"default-value":k.value,defaultSelectedList:k.tags,class:"field-value"},null,8,["options","default-value","defaultSelectedList"])]),s("div",WG,[c(d(zs))]),s("div",ZG,_(C(k.variable)),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},QG=_e(YG,[["__scopeId","data-v-5ac41ec7"]]);let XG=class extends ht{constructor(n){super(n),this.renderVue(QG,n)}},eW=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",nodeId:n}]}};const tW={type:"variable-assignment-node",model:eW,view:XG},sW={class:"judge-node"},oW={class:"if-box-label"},nW={class:"if-box-content"},aW={class:"condition-box"},lW={key:0,class:"condition-left-box"},iW={class:"connection-text"},rW={key:1,class:"condition-line"},dW={class:"condition-body"},uW={class:"field-items"},cW={class:"field-name"},_W={class:"field-rule"},pW={class:"field-value"},fW={class:"else-box"},vW={class:"else-box-label"},hW={class:"else-box-content"},mW={class:"else-desc"},gW={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.judge-node.index"),o=e,a=be("resetSize"),l=be("getNode"),i=be("updateAnchorList"),r=we({term:[]}),u=U([]),y=U([]);function p(){let b=l().getAllParentVariable();u.value=m(b)}function m(b){return b.forEach(x=>{x.typ=="node"?x.node_type==1?x.value="global":x.value=x.node_id:x.value=x.key,x.children&&x.children.length>0&&(x.children=m(x.children))}),b}let v=[{label:n("label_equal"),value:1},{label:n("label_not_equal"),value:2},{label:n("label_contain"),value:3},{label:n("label_not_contain"),value:4},{label:n("label_is_empty"),value:5},{label:n("label_not_empty"),value:6}],C=[{label:n("label_contain_one"),value:3},{label:n("label_not_contain_one"),value:4},{label:n("label_is_empty"),value:5},{label:n("label_not_empty"),value:6}];function g(b){let x="";if(b.variable&&b.variable.length>0){let A=u.value.filter(R=>R.key==b.variable[0]);A&&A.length&&(x=A[0].typ),x=="object"&&(A[0]&&A[0].children&&(A=A[0].subs.filter(R=>R.key==b.variable[1])),A&&A.length&&(x=A[0].typ),x=="object"&&(A[0]&&A[0].children&&(A=A[0].subs.filter(R=>R.key==b.variable[2])),A&&A.length&&(x=A[0].typ)))}return x}function $(b){if(!b.variable)return[];let x=g(b);return x==""?b.is_mult?C:v:x=="boole"?[{label:n("label_equal"),value:1},{label:n("label_not_equal"),value:2}]:x.includes("array")?C:v}const w=b=>{let x=$(b),A=x.findIndex(R=>R.value==b.type);return x[A].label},S=()=>{try{let b=JSON.parse(o.properties.node_params).term||[];b=b.map(x=>{let A=x.terms.map(R=>{let E="";for(let B=0;B<gs.length;B++)if(R.variable.indexOf(gs[B])>-1){E=gs[B];break}if(E!=""){let B=R.variable.split(".");R.variable=[B[0],E]}else R.variable=R.variable.split(".");return{...R,type:R.type>0?R.type:1,key:Math.random()*1e4}});return{...x,is_or:x.is_or?1:0,terms:A,key:Math.random()*1e4}}),r.term=b,Ze(()=>{a(),k()})}catch(b){}},k=()=>{const b=o.properties.nodeSortKey;let x=[],A=56;for(let R=0;R<r.term.length;R++){let E=r.term[R];if(E){let B=0,N=A,I=8,L=2,q=24,O=E.terms.length;B=O*q+I*2+L*(O-1),R>0&&R<r.term.length&&(N+=8),A=N+B,x.push({id:b+"-anchor_"+R,offsetHeight:B,offsetTop:N})}}x.length>0&&x.push({id:b+"-anchor_right",offsetHeight:24,offsetTop:A+8}),i(x)};return Ie(()=>o.properties.node_params,(b,x)=>{b!=x&&S()},{deep:!0}),Ne(()=>{p(),S()}),(b,x)=>(h(),G(gt,{properties:e.properties,title:e.properties.node_name,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",sW,[(h(!0),D(ee,null,se(r.term,(A,R)=>(h(),D("div",{class:"if-box",ref_for:!0,ref:E=>y.value[R]=E,key:R},[s("div",oW,_(R==0?d(n)("label_if"):d(n)("label_else_if")),1),s("div",nW,[s("div",aW,[A.terms.length>1?(h(),D("div",lW,[s("span",iW,_(A.is_or==1?d(n)("label_or"):d(n)("label_and")),1)])):Z("",!0),A.terms.length>1?(h(),D("div",rW)):Z("",!0),s("div",dW,[s("div",uW,[(h(!0),D(ee,null,se(A.terms,(E,B)=>(h(),D("div",{class:"field-item",key:B},[s("span",cW,[c(Zs,{value:E.variable},null,8,["value"])]),s("span",_W,_(w(E)),1),s("span",pW,_(E.value),1)]))),128))])])])])]))),128)),s("div",fW,[s("div",vW,_(d(n)("label_else")),1),s("div",hW,[s("div",mW,_(d(n)("msg_else_desc")),1)])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},yW=_e(gW,[["__scopeId","data-v-3e76d8fc"]]);let bW=class extends ht{constructor(n){super(n),this.renderVue(yW,n)}},kW=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r)=>{if(l.id==i.id)return!1;const u=l.graphModel.edges.map(p=>p.sourceAnchorId),y=r.id;return r.type==="right"&&!u.includes(y)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i}=this,{nodeSortKey:r,anchorList:u}=this.properties;let y=[{x:o-l/2,y:a-i/2+24,id:r+"-anchor_left",type:"left",nodeId:n}];if(u)for(let p=0;p<u.length;p++){let{offsetTop:m,offsetHeight:v}=u[p],C=a-i/2;y.push({id:u[p].id,nodeId:n,x:o+l/2,y:C+m+v/2,type:"right"})}return y}};const wW={type:"judge-node",model:kW,view:bW},CW={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:gt,AtText:$t},setup(){const{t:e}=fe("views.workflow.components.nodes.specify-reply-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(e,n){e.dataRaw!==n.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let e=this.properties.dataRaw||this.properties.node_params||"{}";const o=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(e){this.formState.content&&ns.includes(e.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(n=>{if(n.node_id==e.node_id){let o=n.label.split("/");o[0]=e.node_name,n.label=o.join("/"),n.node_name=e.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let e=this.getNode().getAllParentVariable();this.valueOptions=e||[]},update(){let e=JSON.parse(this.properties.node_params);e.reply={...this.formState},this.setData({node_params:JSON.stringify(e)})}}},$W={class:"specify-reply-node"},xW={class:"static-field-list"},SW={class:"static-field-item"},DW={class:"static-field-item-label"},AW={class:"static-field-item-content"},OW={class:"static-field-value"};function NW(e,n,o,a,l,i){const r=tt("AtText"),u=tt("node-common");return h(),G(u,{properties:o.properties,title:o.properties.node_name,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type},{default:f(()=>[s("div",$W,[s("div",xW,[s("div",SW,[s("div",DW,_(a.t("label_message_content")),1),s("div",AW,[s("div",OW,[l.formState.content.length>0?(h(),G(r,{key:0,options:l.valueOptions,defaultSelectedList:l.formState.content_tags,defaultValue:l.formState.content,ref:"atInputRef",class:"text-input",onResize:i.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):Z("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const BW=_e(CW,[["render",NW],["__scopeId","data-v-860ab624"]]);let EW=class extends ht{constructor(n){super(n),this.renderVue(BW,n)}},IW=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r)=>{if(l.id==i.id)return!1;const u=l.graphModel.edges.map(p=>p.sourceAnchorId),y=r.id;return r.type==="right"&&!u.includes(y)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i}=this,{nodeSortKey:r}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:r+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:r+"-anchor_right",type:"right",nodeId:n}]}};const FW={type:"specify-reply-node",model:IW,view:EW},RW={name:"ImmediatelyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:gt,AtText:$t},setup(){const{t:e}=fe("views.workflow.components.nodes.immediately-reply-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(e,n){e.dataRaw!==n.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let e=this.properties.dataRaw||this.properties.node_params||"{}";const o=JSON.parse(e).immediately_reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(e){this.formState.content&&ns.includes(e.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(n=>{if(n.node_id==e.node_id){let o=n.label.split("/");o[0]=e.node_name,n.label=o.join("/"),n.node_name=e.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let e=this.getNode().getAllParentVariable();this.valueOptions=e||[]},update(){let e=JSON.parse(this.properties.node_params);e.immediately_reply={...this.formState},this.setData({node_params:JSON.stringify(e)})}}},LW={class:"specify-reply-node"},VW={class:"static-field-list"},MW={class:"static-field-item"},TW={class:"static-field-item-label"},jW={class:"static-field-item-content"},PW={class:"static-field-value"};function qW(e,n,o,a,l,i){const r=tt("AtText"),u=tt("node-common");return h(),G(u,{properties:o.properties,title:o.properties.node_name,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type},{default:f(()=>[s("div",LW,[s("div",VW,[s("div",MW,[s("div",TW,_(a.t("label_message_content")),1),s("div",jW,[s("div",PW,[l.formState.content.length>0?(h(),G(r,{key:0,options:l.valueOptions,defaultSelectedList:l.formState.content_tags,defaultValue:l.formState.content,ref:"atInputRef",class:"text-input",onResize:i.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):Z("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const HW=_e(RW,[["render",qW],["__scopeId","data-v-31641b6f"]]);let UW=class extends ht{constructor(n){super(n),this.renderVue(HW,n)}},JW=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r)=>{if(l.id==i.id)return!1;const u=l.graphModel.edges.map(p=>p.sourceAnchorId),y=r.id;return r.type==="right"&&!u.includes(y)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i}=this,{nodeSortKey:r}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:r+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:r+"-anchor_right",type:"right",nodeId:n}]}};const zW={type:"immediately-reply-node",model:JW,view:UW},KW={class:"ai-dialogue-node"},GW={class:"field-list"},WW={class:"field-item"},ZW={class:"field-item-label"},YW={class:"field-item-content"},QW={class:"field-value"},XW={class:"field-item"},eZ={class:"field-item-label"},tZ={class:"field-item-content"},sZ={class:"field-value"},oZ={class:"field-key"},nZ={class:"field-item"},aZ={class:"field-item-label"},lZ={class:"field-item-content"},iZ={class:"field-key"},rZ={class:"field-type"},dZ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.parameter-extraction-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=Pt(),{modelList:y}=Lo(u),p=U(null),m=U([]),v=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),C=U([]),g=U([]);function $(E){if(E){let B=E.split("."),N=B[0],I=B.filter((L,q)=>q>0).join(".");return[N,I]}return["global","question"]}function w(E){return E.forEach(B=>{B.cu_key=Math.random()*1e4,B.subs&&B.subs.length?w(B.subs):B.subs=[]}),E}const S=()=>{const E=o.properties.dataRaw||o.properties.node_params||"{}";let B={};try{B=JSON.parse(E).params_extractor||{}}catch{B={}}B=JSON.parse(JSON.stringify(B)),b(),x();for(let N in B){if(N=="output"){v.output=w(B[N]);continue}if(N=="question_value"){v.question_value=$(B[N]);continue}v[N]=B[N]}!v.model_config_id&&y.value.length>0&&(v.model_config_id=y.value[0].id,v.use_model=y.value[0].children[0].name),Ze(()=>{r()})},k=()=>{const E=JSON.stringify({params_extractor:{...v,question_value:v.question_value.join("."),model_config_id:v.model_config_id?+v.model_config_id:v.model_config_id}});a({...o.node,...v,node_params:E})},b=()=>{let E=i().getAllParentVariable();E.forEach(B=>{B.tags=B.tags||[]}),C.value=E};function x(){let E=i().getAllParentVariable();g.value=A(E)}function A(E){return E.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=A(B.children))}),E}const R=E=>{ns.includes(E.node_type)&&(b(),v.prompt_tags&&v.prompt_tags.length>0&&v.prompt_tags.forEach(B=>{if(B.node_id==E.node_id){let N=B.label.split("/");N[0]=E.node_name,B.label=N.join("/"),B.node_name=E.node_name}}),k(),p.value.refresh())};return Ie(()=>o.properties.dataRaw,(E,B)=>{E!=B&&S()},{deep:!0}),Ne(()=>{S(),r(),l().eventCenter.on("custom:setNodeName",R)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",R)}),(E,B)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:m.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",KW,[s("div",GW,[s("div",WW,[s("div",ZW,_(d(n)("label_user_question")),1),s("div",YW,[s("div",QW,[c(Zs,{ref_key:"questionTextRef",ref:p,value:v.question_value},null,8,["value"])])])]),s("div",XW,[s("div",eZ,_(d(n)("label_llm_model")),1),s("div",tZ,[s("div",sZ,[s("span",oZ,[c(jo,{useModel:v.use_model,modelConfigId:v.model_config_id},null,8,["useModel","modelConfigId"])])])])]),s("div",nZ,[s("div",aZ,_(d(n)("label_output_fields")),1),s("div",lZ,[(h(!0),D(ee,null,se(v.output,N=>(h(),D("div",{class:qe(["field-value",{"is-required":N.required}]),key:N.cu_key},[s("span",iZ,_(N.key),1),s("span",rZ,_(N.typ),1)],2))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},uZ=_e(dZ,[["__scopeId","data-v-d025744c"]]);let cZ=class extends ht{constructor(n){super(n),this.renderVue(uZ,n)}},_Z=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const pZ={type:"parameter-extraction-node",model:_Z,view:cZ},fZ={class:"ai-dialogue-node"},vZ={class:"static-field-list"},hZ={class:"static-field-item"},mZ={class:"static-field-item-label"},gZ={class:"static-field-item-content"},yZ={class:"static-field-value"},bZ={class:"static-field-item"},kZ={class:"static-field-item-label"},wZ={class:"static-field-item-content"},CZ={class:"static-field-value"},$Z={class:"static-field-item"},xZ={class:"static-field-item-label"},SZ={class:"static-field-item-content"},DZ={class:"static-field-value"},AZ={class:"static-field-key"},OZ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.problem-optimization-node.index"),o=e,a=U(null),l=be("setData"),i=be("getGraph"),r=be("getNode"),u=be("resetSize"),y=Pt(),{modelList:p}=Lo(y),m=U([]),v=we({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),C=U([]);function g(b){if(b){let x=b.split("."),A=x[0],R=x.filter((E,B)=>B>0).join(".");return[A,R]}return["global","question"]}const $=()=>{const b=o.properties.dataRaw||o.properties.node_params||"{}";let x={};try{x=JSON.parse(b).question_optimize||{}}catch{x={}}S();const{model_config_id:A,use_model:R,context_pair:E,temperature:B,max_token:N,prompt:I,prompt_tags:L,question_value:q,enable_thinking:O}=JSON.parse(JSON.stringify(x));v.model_config_id=A,v.use_model=R,v.context_pair=E||0,v.temperature=B,v.max_token=N,v.prompt=I,v.enable_thinking=O,v.prompt_tags=L||[],v.question_value=g(q),!v.model_config_id&&p.value.length>0&&(v.model_config_id=p.value[0].id,v.use_model=p.value[0].children[0].name),Ze(()=>{u()})},w=()=>{const b={...v,node_params:JSON.stringify({question_optimize:{...v,question_value:v.question_value.join("."),model_config_id:v.model_config_id?+v.model_config_id:v.model_config_id}})};l(b)},S=()=>{let b=r().getAllParentVariable();C.value=b},k=b=>{S(),v.prompt_tags&&v.prompt_tags.length>0&&v.prompt_tags.forEach(x=>{if(x.node_id==b.node_id){let A=x.label.split("/");A[0]=b.node_name,x.label=A.join("/"),x.node_name=b.node_name}}),w(),a.value.refresh()};return Ie(()=>o.properties,$,{deep:!0}),Ne(()=>{$(),Ze(()=>{u()}),i().eventCenter.on("custom:setNodeName",k)}),Ut(()=>{i().eventCenter.off("custom:setNodeName",k)}),(b,x)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:m.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",fZ,[s("div",vZ,[s("div",hZ,[s("div",mZ,_(d(n)("label_user_question")),1),s("div",gZ,[s("div",yZ,[c(Zs,{ref_key:"questionTextRef",ref:a,value:v.question_value},null,8,["value"])])])]),s("div",bZ,[s("div",kZ,_(d(n)("label_llm_model")),1),s("div",wZ,[s("div",CZ,[c(jo,{useModel:v.use_model,modelConfigId:v.model_config_id},null,8,["useModel","modelConfigId"])])])]),s("div",$Z,[s("div",xZ,_(d(n)("label_output")),1),s("div",SZ,[s("div",DZ,[s("span",AZ,_(d(n)("label_problem_optimization_result")),1),x[0]||(x[0]=s("span",{class:"static-field-type"},"string",-1))])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},NZ=_e(OZ,[["__scopeId","data-v-6765acf7"]]);let BZ=class extends ht{constructor(n){super(n),this.renderVue(NZ,n)}},EZ=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const IZ={type:"problem-optimization-node",model:EZ,view:BZ},Ro="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",FZ={class:"add-data-node"},RZ={class:"static-field-list"},LZ={class:"static-field-item"},VZ={class:"static-field-item-label"},MZ={class:"static-field-item-content"},TZ={class:"static-field-value"},jZ={class:"static-field-item"},PZ={class:"static-field-item-label"},qZ={class:"static-field-item-content"},HZ={key:0,class:"static-field-value"},UZ={class:"field-name"},JZ={class:"field-name"},zZ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.add-data-node.index"),o=e,a=be("setData"),l=be("resetSize"),i=be("getNode"),r=be("getGraph"),u=U(null);let y={};const p=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),m=U([]),v=()=>{let w=i().getAllParentVariable();m.value=w||[]},C=()=>{let w=o.properties.dataRaw||o.properties.node_params||"{}";y=JSON.parse(w),v(),p.formData=y.form_insert,g(),Ze(()=>{l()})},g=()=>{y.form_insert=Ht(p.formData),a({...o.node,node_params:JSON.stringify(y)})};Ie(()=>o.properties.dataRaw,(w,S)=>{w!==S&&C()}),Ne(()=>{r().eventCenter.on("custom:setNodeName",$),C()}),yn(()=>{r().eventCenter.off("custom:setNodeName",$)});const $=w=>{!p.formData.datas||p.formData.datas.length==0||ns.includes(w.node_type)&&(v(),p.formData.datas.forEach(S=>{S.atTags&&S.atTags.length>0&&S.atTags.forEach(k=>{if(k.node_id==w.node_id){let b=k.label.split("/");b[0]=w.node_name,k.label=b.join("/"),k.node_name=w.node_name}})}),g(),Ze(()=>{u.value.map(S=>S.refresh()),l()}))};return(w,S)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",FZ,[s("div",RZ,[s("div",LZ,[s("div",VZ,_(d(n)("label_data_table")),1),s("div",MZ,[s("div",TZ,_(p.formData.form_name||"--"),1)])]),s("div",jZ,[s("div",PZ,_(d(n)("label_insert_data")),1),s("div",qZ,[p.formData.datas.length==0?(h(),D("div",HZ,"--")):Z("",!0),(h(!0),D(ee,null,se(p.formData.datas,k=>(h(),D("div",{class:"static-field-value",key:k.id},[s("span",UZ,[c($t,{options:m.value,"default-value":k.value,defaultSelectedList:k.atTags,ref_for:!0,ref_key:"atInputRef",ref:u},null,8,["options","default-value","defaultSelectedList"])]),S[0]||(S[0]=s("span",{class:"field-arrow"},[s("img",{src:Ro,alt:""})],-1)),s("span",JZ,_(k.name),1)]))),128))])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},KZ=_e(zZ,[["__scopeId","data-v-b454bc24"]]);let GZ=class extends ht{constructor(n){super(n),this.renderVue(KZ,n)}},WZ=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",nodeId:n}]}};const ZZ={type:"add-data-node",model:WZ,view:GZ},YZ={class:"node-box"},QZ={class:"static-field-list"},XZ={class:"static-field-item"},eY={class:"static-field-item-label"},tY={class:"static-field-item-content"},sY={class:"static-field-value"},oY={class:"static-field-item",style:{"align-items":"center"}},nY={class:"static-field-item-label"},aY={class:"static-field-item-content"},lY={key:0,class:"static-field-value"},iY={class:"condition-box"},rY={key:0,class:"condition-left-box"},dY={class:"connection-text"},uY={key:1,class:"condition-line"},cY={class:"condition-body"},_Y={class:"field-items"},pY={class:"field-name"},fY={class:"field-rule"},vY={class:"field-value"},hY={class:"static-field-item"},mY={class:"static-field-item-label"},gY={class:"static-field-item-content"},yY={class:"options-list"},bY={class:"option-label"},kY={class:"option-label"},wY={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.update-data-node.index"),o=e,a=be("setData"),l=be("resetSize"),i=be("getNode"),r=Ws();let u={};const y=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),p=U([]),m=()=>{let k=i().getAllParentVariable();p.value=k||[]},v=()=>{let k=o.properties.dataRaw||o.properties.node_params||"{}";u=JSON.parse(k),m();let b=g(u.form_update.where||[]);u.form_update.where=b,y.formData=u.form_update,y.formData.form_id&&w(y.formData.form_id),C(),Ze(()=>{l()})},C=()=>{let k={...Ht(y.formData)};k.where=$(k.where),u.form_update=k,a({...o.node,node_params:JSON.stringify(u)})},g=k=>{let b=[];return k.forEach(x=>{let A=JSON.parse(JSON.stringify(x)),R=A.rule.split("_");A.form_field_id=A.form_field_id*1,A.field_type=R[0],R.shift(),A.rule=R.join("_"),b.push(A)}),b},$=k=>{let b=[];return k.forEach(x=>{let A=JSON.parse(JSON.stringify(x));A.form_field_id=A.form_field_id*1,A.rule=x.field_type+"_"+x.rule,b.push(A)}),b},w=async k=>{r.getFormFieldList({form_id:k}).then(b=>{b.forEach(x=>{x.id=x.id*1}),y.fieldList=b}).catch(()=>{})},S=(k,b)=>Bn(b,k);return Ie(()=>o.properties.dataRaw,(k,b)=>{k!==b&&v()}),Ne(()=>{v()}),(k,b)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type},{default:f(()=>[s("div",YZ,[s("div",QZ,[s("div",XZ,[s("div",eY,_(d(n)("label_data_table")),1),s("div",tY,[s("div",sY,_(y.formData.form_name||"--"),1)])]),s("div",oY,[s("div",nY,_(d(n)("label_update_condition")),1),s("div",aY,[y.formData.where.length==0?(h(),D("span",lY,"--")):Z("",!0),s("div",iY,[y.formData.where.length>1?(h(),D("div",rY,[s("span",dY,_(y.formData.typ==1?d(n)("label_and"):d(n)("label_or")),1)])):Z("",!0),y.formData.where.length>1?(h(),D("div",uY)):Z("",!0),s("div",cY,[s("div",_Y,[(h(!0),D(ee,null,se(y.formData.where,x=>(h(),D("div",{class:"field-item",key:x.id},[s("span",pY,_(x.field_name),1),s("span",fY,_(S(x.field_type,x.rule)),1),s("span",vY,[c($t,{options:p.value,"default-value":x.rule_value1,defaultSelectedList:x.atTags},null,8,["options","default-value","defaultSelectedList"]),x.rule_value2?(h(),D(ee,{key:0},[b[0]||(b[0]=s("span",null,"-",-1)),c($t,{options:p.value,"default-value":x.rule_value2,defaultSelectedList:x.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):Z("",!0)])]))),128))])])])])]),s("div",hY,[s("div",mY,_(d(n)("label_update_data")),1),s("div",gY,[s("div",yY,[(h(!0),D(ee,null,se(y.formData.datas,x=>(h(),D("div",{class:"options-item",key:x.key},[s("div",bY,[c($t,{options:p.value,"default-value":x.value,defaultSelectedList:x.atTags},null,8,["options","default-value","defaultSelectedList"])]),b[1]||(b[1]=s("span",{class:"field-arrow"},[s("img",{src:Ro,alt:""})],-1)),s("div",kY,_(x.name),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},CY=_e(wY,[["__scopeId","data-v-dd087e51"]]);let $Y=class extends ht{constructor(n){super(n),this.renderVue(CY,n)}},xY=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",nodeId:n}]}};const SY={type:"update-data-node",model:xY,view:$Y},DY={class:"node-box"},AY={class:"static-field-list"},OY={class:"static-field-item"},NY={class:"static-field-item-label"},BY={class:"static-field-item-content"},EY={class:"static-field-value"},IY={class:"static-field-item",style:{"align-items":"center"}},FY={class:"static-field-item-label"},RY={class:"static-field-item-content"},LY={key:0,class:"static-field-value"},VY={class:"condition-box"},MY={key:0,class:"condition-left-box"},TY={class:"connection-text"},jY={key:1,class:"condition-line"},PY={class:"condition-body"},qY={class:"field-items"},HY={class:"field-name"},UY={class:"field-rule"},JY={class:"field-value"},zY={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.delete-data-node.index"),o=e,a=be("resetSize"),l=be("setData"),i=be("getNode"),r=Ws();let u={};const y=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),p=U([]),m=()=>{let k=i().getAllParentVariable();p.value=k||[]},v=()=>{let k=o.properties.dataRaw||o.properties.node_params||"{}";u=JSON.parse(k),m();let b=$(u.form_delete.where||[]);u.form_delete.where=b,y.formData=u.form_delete,y.formData.form_id&&w(y.formData.form_id),C(),Ze(()=>{a()})},C=()=>{let k={...Ht(y.formData)};k.where=g(k.where),u.form_delete=k,l({...o.node,node_params:JSON.stringify(u)})},g=k=>{let b=[];return k.forEach(x=>{let A=JSON.parse(JSON.stringify(x));A.form_field_id=A.form_field_id*1,A.rule=x.field_type+"_"+x.rule,b.push(A)}),b},$=k=>{let b=[];return k.forEach(x=>{let A=JSON.parse(JSON.stringify(x)),R=A.rule.split("_");A.form_field_id=A.form_field_id*1,A.field_type=R[0],R.shift(),A.rule=R.join("_"),b.push(A)}),b},w=async k=>{r.getFormFieldList({form_id:k}).then(b=>{b.forEach(x=>{x.id=x.id*1}),y.fieldList=b,Ze(()=>{a()})}).catch(()=>{})},S=(k,b)=>Bn(b,k);return Ie(()=>o.properties.dataRaw,(k,b)=>{k!==b&&v()}),Ne(()=>{v()}),(k,b)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type},{default:f(()=>[s("div",DY,[s("div",AY,[s("div",OY,[s("div",NY,_(d(n)("label_data_table")),1),s("div",BY,[s("div",EY,_(y.formData.form_name||"--"),1)])]),s("div",IY,[s("div",FY,_(d(n)("label_delete_condition")),1),s("div",RY,[y.formData.where.length==0?(h(),D("span",LY,"--")):Z("",!0),s("div",VY,[y.formData.where.length>1?(h(),D("div",MY,[s("span",TY,_(y.formData.typ==1?d(n)("label_and"):d(n)("label_or")),1)])):Z("",!0),y.formData.where.length>1?(h(),D("div",jY)):Z("",!0),s("div",PY,[s("div",qY,[(h(!0),D(ee,null,se(y.formData.where,x=>(h(),D("div",{class:"field-item",key:x.id},[s("span",HY,_(x.field_name),1),s("span",UY,_(S(x.field_type,x.rule)),1),s("span",JY,[c($t,{options:p.value,"default-value":x.rule_value1,defaultSelectedList:x.atTags},null,8,["options","default-value","defaultSelectedList"]),x.rule_value2?(h(),D(ee,{key:0},[b[0]||(b[0]=s("span",null,"-",-1)),c($t,{options:p.value,"default-value":x.rule_value2,defaultSelectedList:x.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):Z("",!0)])]))),128))])])])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},KY=_e(zY,[["__scopeId","data-v-72e8fbe6"]]);let GY=class extends ht{constructor(n){super(n),this.renderVue(KY,n)}},WY=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",nodeId:n}]}};const ZY={type:"delete-data-node",model:WY,view:GY},YY={class:"node-box"},QY={class:"static-field-list"},XY={class:"static-field-item"},eQ={class:"static-field-item-label"},tQ={class:"static-field-item-content"},sQ={class:"static-field-value"},oQ={class:"static-field-item",style:{"align-items":"center"}},nQ={class:"static-field-item-label"},aQ={class:"static-field-item-content"},lQ={key:0,class:"static-field-value"},iQ={class:"condition-box"},rQ={key:0,class:"condition-left-box"},dQ={class:"connection-text"},uQ={key:1,class:"condition-line"},cQ={class:"condition-body"},_Q={class:"field-items"},pQ={class:"field-name"},fQ={class:"field-rule"},vQ={class:"field-value"},hQ={class:"static-field-item"},mQ={class:"static-field-item-label"},gQ={class:"static-field-item-content"},yQ={class:"options-list"},bQ={class:"option-label"},kQ={class:"option-type"},wQ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.select-data-node.index"),o=e,a=be("setData"),l=be("resetSize"),i=be("getNode"),r=be("getGraph"),u=Ws();let y={};const p=we({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),m=U([]),v=()=>{let A=i().getAllParentVariable();m.value=A||[]},C=()=>{let A=o.properties.dataRaw||o.properties.node_params||"{}";y=JSON.parse(A),v();let R=$(y.form_select.where||[]);y.form_select.where=R,p.formData=y.form_select,p.formData.form_id&&k(p.formData.form_id),g(),Ze(()=>{l()})},g=()=>{let A={...Ht(p.formData)};A.where=w(A.where),y.form_select=A,a({...o.node,node_params:JSON.stringify(y)})},$=A=>{let R=[];return A.forEach(E=>{let B=JSON.parse(JSON.stringify(E)),N=B.rule.split("_");B.form_field_id=B.form_field_id*1,B.field_type=N[0],N.shift(),B.rule=N.join("_"),R.push(B)}),R},w=A=>{let R=[];return A.forEach(E=>{let B=JSON.parse(JSON.stringify(E));B.form_field_id=B.form_field_id*1,B.rule=E.field_type+"_"+E.rule,R.push(B)}),R},S=async()=>{const A=await u.getFormList();A&&(p.tableList=A)},k=async A=>{u.getFormFieldList({form_id:A}).then(R=>{R.forEach(E=>{E.id=E.id*1}),p.fieldList=R}).catch(()=>{})},b=(A,R)=>Bn(R,A),x=()=>{C()};return Ie(()=>o.properties.dataRaw,(A,R)=>{A!==R&&C()}),Ne(()=>{S(),C(),r().eventCenter.on("custom:setNodeName",x)}),Ut(()=>{r().eventCenter.off("custom:setNodeName",x)}),(A,R)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type},{default:f(()=>[s("div",YY,[s("div",QY,[s("div",XY,[s("div",eQ,_(d(n)("label_data_table")),1),s("div",tQ,[s("div",sQ,_(p.formData.form_name||"--"),1)])]),s("div",oQ,[s("div",nQ,_(d(n)("label_query_conditions")),1),s("div",aQ,[p.formData.where.length==0?(h(),D("span",lQ,"--")):Z("",!0),s("div",iQ,[p.formData.where.length>1?(h(),D("div",rQ,[s("span",dQ,_(p.formData.typ==1?d(n)("text_and"):d(n)("text_or")),1)])):Z("",!0),p.formData.where.length>1?(h(),D("div",uQ)):Z("",!0),s("div",cQ,[s("div",_Q,[(h(!0),D(ee,null,se(p.formData.where,E=>(h(),D("div",{class:"field-item",key:E.id},[s("span",pQ,_(E.field_name),1),s("span",fQ,_(b(E.field_type,E.rule)),1),s("span",vQ,[c($t,{options:m.value,"default-value":E.rule_value1,defaultSelectedList:E.atTags},null,8,["options","default-value","defaultSelectedList"]),E.rule_value2?(h(),D(ee,{key:0},[R[0]||(R[0]=s("span",null,"-",-1)),c($t,{options:m.value,"default-value":E.rule_value2,defaultSelectedList:E.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):Z("",!0)])]))),128))])])])])]),s("div",hQ,[s("div",mQ,_(d(n)("label_query_fields")),1),s("div",gQ,[s("div",yQ,[(h(!0),D(ee,null,se(p.formData.fields,E=>(h(),D("div",{class:"options-item",key:E.key},[s("div",bQ,_(E.name),1),s("div",kQ,_(E.type),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},CQ=_e(wQ,[["__scopeId","data-v-98205d12"]]);let $Q=class extends ht{constructor(n){super(n),this.renderVue(CQ,n)}},xQ=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",nodeId:n}]}};const SQ={type:"select-data-node",model:xQ,view:$Q},DQ={class:"ai-dialogue-node"},AQ={class:"field-list"},OQ={class:"field-item"},NQ={class:"field-item-label"},BQ={class:"field-item-content"},EQ={class:"field-text"},IQ={class:"right-arrow"},FQ={class:"field-text"},RQ={class:"field-item"},LQ={class:"field-item-label"},VQ={class:"field-item-content"},MQ={class:"field-key"},TQ={class:"field-type"},jQ={class:"field-item"},PQ={class:"field-item-label"},qQ={class:"field-item-content"},HQ={class:"field-value"},UQ={class:"field-key"},JQ=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,zQ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.code-run-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=U([]),y=we({language:"javaScript",main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),p=U([]);function m(S){return S.forEach(k=>{k.cu_key=Math.random()*1e4,k.subs&&k.subs.length?m(k.subs):k.subs=[]}),S}const v=()=>{const S=o.properties.dataRaw||o.properties.node_params||"{}";let k={};try{k=JSON.parse(S).code_run||{}}catch{k={}}$(),k=JSON.parse(JSON.stringify(k));for(let b in k){if(b=="params"){k[b]&&k[b].length>0?y[b]=k[b].map(x=>({...x,cu_key:Math.random()*1e4})):y[b]=[];continue}if(b=="output"){y.output=m(k[b]);continue}y[b]=k[b]}y.main_func=y.main_func||JQ,y.language=y.language||"javaScript",y.params=y.params.map(b=>{let x="";for(let A=0;A<gs.length;A++)if(b.variable.indexOf(gs[A])>-1){x=gs[A];break}if(x!=""){let A=b.variable.split(".");b.variable=[A[0],x]}else b.variable=b.variable.split(".");return{...b,key:Math.random()*1e4}}),Ze(()=>{r()})},C=()=>{const S=JSON.stringify({code_run:{...y,params:g()}});a({...o.node,...y,node_params:S})};function g(){let S=[];return y.params.forEach(k=>{S.push({field:k.field,variable:k.variable&&k.variable.length>0?k.variable.join("."):""})}),S}const $=()=>{let S=i().getAllParentVariable();p.value=S},w=S=>{ns.includes(S.node_type)&&($(),Ze(()=>{C()}))};return Ie(()=>o.properties,v,{deep:!0}),Ne(()=>{v(),r(),l().eventCenter.on("custom:setNodeName",w)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",w)}),(S,k)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",DQ,[s("div",AQ,[s("div",OQ,[s("div",NQ,_(d(n)("label_input_params")),1),s("div",BQ,[(h(!0),D(ee,null,se(y.params,b=>(h(),D("div",{class:"field-list-item",key:b.cu_key},[s("div",EQ,[c(Zs,{value:b.variable},null,8,["value"])]),s("div",IQ,[c(d(zs))]),s("div",FQ,_(b.field),1)]))),128))])]),s("div",RQ,[s("div",LQ,_(d(n)("label_output_fields")),1),s("div",VQ,[(h(!0),D(ee,null,se(y.output,b=>(h(),D("div",{class:"field-value",key:b.cu_key},[s("span",MQ,_(b.key),1),s("span",TQ,_(b.typ),1)]))),128))])]),s("div",jQ,[s("div",PQ,_(d(n)("label_exception_handling")),1),s("div",qQ,[s("div",HQ,[s("span",UQ,_(d(n)("msg_exception_branch")),1)])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},KQ=_e(zQ,[["__scopeId","data-v-5e96413c"]]);let GQ=class extends ht{constructor(n){super(n),this.renderVue(KQ,n)}},WQ=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(a,l,i,r)=>{if(a.id==l.id)return!1;const u=a.graphModel.edges.map(p=>p.sourceAnchorId),y=i.id;return i.type==="right"&&!u.includes(y)}};this.sourceRules=[n];const o={message:"只允许连接左边的锚点",validate:(a,l,i,r)=>a.id==l.id?!1:r.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+28,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+28,id:y+"-anchor_right",type:"right",nodeId:n},{x:o+l/2,y:a+i/2-28,id:y+"-anchor_right_exception",type:"right",nodeId:n}]}};const ZQ={type:"code-run-node",model:WQ,view:GQ},YQ={name:"QuestionNode",components:{NodeCommon:gt,AtText:$t},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"btn_delete",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}},valueOptions:[]}},computed:{t(){return fe("views.workflow.components.nodes.mcp-node.index").t}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.valueOptions=this.getNode().getAllParentVariable()||[],this.loadProvider(),this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.$nextTick(()=>{this.resetSize()})},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{properties:{handler(e,n){e.dataRaw!==n.dataRaw&&(this.nodeParams=JSON.parse(this.properties.node_params||"{}"),this.$nextTick(()=>{const o=this.$refs.atTextRef;(Array.isArray(o)?o:o?[o]:[]).forEach(l=>{l&&l.refresh&&l.refresh()}),this.resetSize()}))},deep:!0}},methods:{onUpatateNodeName(e){var a,l;this.valueOptions=this.getNode().getAllParentVariable()||[];const n=i=>{!Array.isArray(i)||i.length===0||i.forEach(r=>{if(r&&r.node_id==e.node_id){if(r.label){let u=r.label.split("/");u[0]=e.node_name,r.label=u.join("/")}r.node_name=e.node_name}})},o=((l=(a=this.nodeParams)==null?void 0:a.mcp)==null?void 0:l.tag_map)||{};Object.keys(o).forEach(i=>{n(o[i])}),this.$nextTick(()=>{const i=this.$refs.atTextRef;(Array.isArray(i)?i:i?[i]:[]).forEach(u=>{u&&u.refresh&&u.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.resetSize()})},loadProvider(){var e;al({provider_id:((e=this.nodeParams)==null?void 0:e.mcp.provider_id)||""}).then(n=>{var a;this.mcpInfo=(n==null?void 0:n.data)||{};let o=rs((a=this.mcpInfo)==null?void 0:a.tools,[]);this.toolInfo=o.find(l=>{var i;return l.name==((i=this.nodeParams)==null?void 0:i.mcp.tool_name)}),this.$nextTick(()=>{this.resetSize()})})},update(e){let n=this.nodeParams;n.mcp.arguments=e.arguments,n.mcp.tag_map=e.tag_map,this.setData({node_params:JSON.stringify(n)})},getArgValue(e){var o,a,l;const n=(l=(a=(o=this.nodeParams)==null?void 0:o.mcp)==null?void 0:a.arguments)==null?void 0:l[e];return n==null?"":String(n)},getArgTags(e){var o,a,l;const n=(l=(a=(o=this.nodeParams)==null?void 0:o.mcp)==null?void 0:a.tag_map)==null?void 0:l[e];return Array.isArray(n)?n:[]}},computed:{propList(){var a;const e=((a=this.toolInfo)==null?void 0:a.inputSchema)||{},n=(e==null?void 0:e.properties)||{},o=Array.isArray(e==null?void 0:e.required)?e.required:[];return Object.keys(n).map(l=>(n[l],{key:l,required:o.includes(l)}))}}},QQ={class:"_main"},XQ={class:"label"};function eX(e,n,o,a,l,i){const r=tt("at-text"),u=Is,y=tt("node-common");return h(),G(y,{properties:o.properties,title:o.properties.node_name,"icon-url":l.mcpInfo.avatar,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,style:{"min-width":"320px","min-height":"94px"}},{default:f(()=>[s("div",QQ,[(h(!0),D(ee,null,se(i.propList,p=>(h(),D("div",{key:p.key},[s("span",XQ,_(p.key)+"：",1),i.getArgValue(p.key)?(h(),G(u,{key:0},{default:f(()=>[c(r,{options:l.valueOptions,defaultSelectedList:i.getArgTags(p.key),defaultValue:i.getArgValue(p.key),ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(h(),G(u,{key:1},{default:f(()=>[...n[0]||(n[0]=[T("--",-1)])]),_:1}))]))),128))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key"])}const tX=_e(YQ,[["render",eX],["__scopeId","data-v-cbb89e3e"]]);let sX=class extends ht{constructor(n){super(n),this.renderVue(tX,n)}},oX=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const nX={type:"mcp-node",model:oX,view:sX},aX={name:"feishu-table-render",components:{AtText:$t},props:{business:{type:String},nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{BatchActions:_n,batchActionParam:{},operatorMap:hl,actionState:{}}},async mounted(){_n.includes(this.business)&&await this.initParams(),this.dataFormat()},watch:{nodeParams:{handler(e,n){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{async initParams(){await ss({name:"feishu_bitable",action:"default/get-schema",params:{}}).then(e=>{var o;let n=(e==null?void 0:e.data)||{};this.batchActionParam=ml(((o=n[this.business])==null?void 0:o.params)||{})})},dataFormat(){var a,l,i,r,u;let e=((i=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:i.arguments)||{},{config_name:n,table_name:o}=((u=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:u.params)||{};this.actionState={...e,config_name:n,table_name:o}}}},lX={class:"_main"},iX={key:0},rX={key:1},dX={key:2},uX={key:3},cX={key:4},_X={key:0,class:"field-box"},pX={key:0},fX={key:1},vX={key:1},hX={key:5},mX={key:0,class:"field-box"},gX={class:"arrow-icon"},yX={key:0},bX={key:1},kX={key:1},wX={key:0,class:"field-box"},CX={key:1},$X={key:0,class:"field-box"},xX={key:0},SX={key:1},DX={key:1},AX={key:10},OX={class:"label"},NX={key:0,class:"field-box"},BX={key:1};function EX(e,n,o,a,l,i){var y,p;const r=Is,u=tt("at-text");return h(),D("div",lX,[s("div",null,[n[0]||(n[0]=s("span",{class:"label"},"配置：",-1)),c(r,null,{default:f(()=>{var m;return[T(_(((m=l.actionState)==null?void 0:m.config_name)||"--"),1)]}),_:1})]),["create_bitable","create_tables","table_add_members","update_advanced","roles_list"].includes(o.business)?Z("",!0):(h(),D("div",iX,[n[1]||(n[1]=s("span",{class:"label"},"数据表：",-1)),c(r,null,{default:f(()=>{var m,v,C,g,$,w,S;return[(v=(m=l.actionState)==null?void 0:m.tag_map)!=null&&v.table_id&&((g=(C=l.actionState)==null?void 0:C.tag_map)!=null&&g.table_id.length)?(h(),G(u,{key:0,class:"batch-render-at",options:o.valueOptions,defaultSelectedList:l.actionState.tag_map.table_id,defaultValue:($=l.actionState)==null?void 0:$.table_id},null,8,["options","defaultSelectedList","defaultValue"])):(h(),D(ee,{key:1},[T(_(((w=l.actionState)==null?void 0:w.table_name)||((S=l.actionState)==null?void 0:S.table_id)||"--"),1)],64))]}),_:1})])),o.business=="create_bitable"?(h(),D("div",rX,[n[2]||(n[2]=s("span",{class:"label"},"多维表名称：",-1)),c(r,null,{default:f(()=>{var m,v,C;return[c(u,{class:"batch-render-at",options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.name)||[],defaultValue:((C=l.actionState)==null?void 0:C.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):o.business=="create_tables"?(h(),D("div",dX,[n[3]||(n[3]=s("span",{class:"label"},"数据表名称：",-1)),c(r,null,{default:f(()=>{var m,v,C;return[c(u,{class:"batch-render-at",options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.name)||[],defaultValue:((C=l.actionState)==null?void 0:C.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):o.business=="create_views"?(h(),D("div",uX,[n[4]||(n[4]=s("span",{class:"label"},"视图名称：",-1)),c(r,null,{default:f(()=>{var m,v,C;return[c(u,{class:"batch-render-at",options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.view_name)||[],defaultValue:((C=l.actionState)==null?void 0:C.view_name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):o.business=="create_record"?(h(),D("div",cX,[n[7]||(n[7]=s("span",{class:"label"},"插入数据：",-1)),Array.isArray(l.actionState.fields)?(h(),D("div",_X,[(h(!0),D(ee,null,se(l.actionState.fields,m=>(h(),G(r,{class:"field-tag",key:m.field_name},{default:f(()=>[s("span",null,_(m.field_name),1),n[5]||(n[5]=s("span",{class:"arrow-icon"},[s("img",{src:Ro})],-1)),m.value?(h(),D("span",pX,[c(u,{options:o.valueOptions,defaultSelectedList:m.atTags,defaultValue:m.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(h(),D("span",fX))]),_:2},1024))),128))])):(h(),D("div",vX,[c(r,null,{default:f(()=>[...n[6]||(n[6]=[T("--",-1)])]),_:1})]))])):o.business=="delete_record"?(h(),D("div",hX,[n[9]||(n[9]=s("span",{class:"label"},"删除ID：",-1)),l.actionState.record_id?(h(),G(r,{key:0},{default:f(()=>[c(u,{options:o.valueOptions,defaultSelectedList:l.actionState.record_tags,defaultValue:l.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(h(),G(r,{key:1},{default:f(()=>[...n[8]||(n[8]=[T("--",-1)])]),_:1}))])):o.business=="search_records"?(h(),D(ee,{key:6},[s("div",null,[n[11]||(n[11]=s("span",{class:"label"},"查询条件：",-1)),Array.isArray((p=(y=l.actionState)==null?void 0:y.filter)==null?void 0:p.conditions)&&l.actionState.filter.conditions.length?(h(),D("div",mX,[(h(!0),D(ee,null,se(l.actionState.filter.conditions,m=>(h(),G(r,{class:"field-tag",key:m.field_id},{default:f(()=>{var v;return[s("span",null,_(m.field_name),1),s("span",gX,_((v=l.operatorMap[m.operator])==null?void 0:v.label),1),m.value?(h(),D("span",yX,[c(u,{options:o.valueOptions,defaultSelectedList:m.atTags,defaultValue:m.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(h(),D("span",bX))]}),_:2},1024))),128))])):(h(),D("div",kX,[c(r,null,{default:f(()=>[...n[10]||(n[10]=[T("--",-1)])]),_:1})]))]),s("div",null,[n[13]||(n[13]=s("span",{class:"label"},"查询字段：",-1)),Array.isArray(l.actionState.field_names)&&l.actionState.field_names.length?(h(),D("div",wX,[(h(!0),D(ee,null,se(l.actionState.field_names,m=>(h(),G(r,{class:"field-tag",key:m.field},{default:f(()=>[T(_(m),1)]),_:2},1024))),128))])):(h(),D("div",CX,[c(r,null,{default:f(()=>[...n[12]||(n[12]=[T("--",-1)])]),_:1})]))])],64)):o.business=="update_record"?(h(),D(ee,{key:7},[s("div",null,[n[15]||(n[15]=s("span",{class:"label"},"更新ID：",-1)),l.actionState.record_id?(h(),G(r,{key:0},{default:f(()=>[c(u,{options:o.valueOptions,defaultSelectedList:l.actionState.record_tags,defaultValue:l.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(h(),G(r,{key:1},{default:f(()=>[...n[14]||(n[14]=[T("--",-1)])]),_:1}))]),s("div",null,[n[18]||(n[18]=s("span",{class:"label"},"更新数据：",-1)),Array.isArray(l.actionState.fields)?(h(),D("div",$X,[(h(!0),D(ee,null,se(l.actionState.fields,m=>(h(),G(r,{class:"field-tag",key:m.field_name},{default:f(()=>[s("span",null,_(m.field_name),1),n[16]||(n[16]=s("span",{class:"arrow-icon"},[s("img",{src:Ro})],-1)),m.value?(h(),D("span",xX,[c(u,{options:o.valueOptions,defaultSelectedList:m.atTags,defaultValue:m.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(h(),D("span",SX))]),_:2},1024))),128))])):(h(),D("div",DX,[c(r,null,{default:f(()=>[...n[17]||(n[17]=[T("--",-1)])]),_:1})]))])],64)):o.business=="update_advanced"?(h(),D(ee,{key:8},[s("div",null,[n[20]||(n[20]=s("span",{class:"label"},"多维表名称：",-1)),l.actionState.name?(h(),G(r,{key:0},{default:f(()=>{var m,v;return[c(u,{options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.name)||[],defaultValue:l.actionState.name},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(h(),G(r,{key:1},{default:f(()=>[...n[19]||(n[19]=[T("--",-1)])]),_:1}))]),s("div",null,[n[21]||(n[21]=s("span",{class:"label"},"高级权限：",-1)),c(r,null,{default:f(()=>[T(_(l.actionState.is_advanced==0?"不设置":l.actionState.is_advanced==1?"开启":"关闭"),1)]),_:1})])],64)):o.business=="table_add_members"?(h(),D(ee,{key:9},[s("div",null,[n[22]||(n[22]=s("span",{class:"label"},"多维表：",-1)),c(r,null,{default:f(()=>{var m,v,C;return[c(u,{class:"batch-render-at",options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.app_token)||[],defaultValue:((C=l.actionState)==null?void 0:C.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})]),s("div",null,[n[24]||(n[24]=s("span",{class:"label"},"协作者角色：",-1)),l.actionState.role_id?(h(),G(r,{key:0},{default:f(()=>{var m,v;return[c(u,{options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.role_id)||[],defaultValue:l.actionState.role_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(h(),G(r,{key:1},{default:f(()=>[...n[23]||(n[23]=[T("--",-1)])]),_:1}))]),s("div",null,[n[26]||(n[26]=s("span",{class:"label"},"协作者ID：",-1)),l.actionState.member_id?(h(),G(r,{key:0},{default:f(()=>{var m,v;return[c(u,{options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.member_id)||[],defaultValue:l.actionState.member_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(h(),G(r,{key:1},{default:f(()=>[...n[25]||(n[25]=[T("--",-1)])]),_:1}))])],64)):o.business=="roles_list"?(h(),D("div",AX,[n[27]||(n[27]=s("span",{class:"label"},"多维表：",-1)),c(r,null,{default:f(()=>{var m,v,C;return[c(u,{class:"batch-render-at",options:o.valueOptions,defaultSelectedList:((v=(m=l.actionState)==null?void 0:m.tag_map)==null?void 0:v.app_token)||[],defaultValue:((C=l.actionState)==null?void 0:C.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):l.BatchActions.includes(o.business)?(h(!0),D(ee,{key:11},se(l.batchActionParam,(m,v)=>(h(),D("div",{key:v},[s("span",OX,_(m.name)+"：",1),l.actionState[v]?(h(),D("div",NX,[c(r,null,{default:f(()=>{var C;return[c(u,{class:"batch-render-at",options:o.valueOptions,defaultSelectedList:((C=l.actionState)==null?void 0:C.tag_map[v])||[],defaultValue:l.actionState[v].toString()},null,8,["options","defaultSelectedList","defaultValue"])]}),_:2},1024)])):(h(),D("div",BX,[c(r,null,{default:f(()=>[...n[28]||(n[28]=[T("--",-1)])]),_:1})]))]))),128)):Z("",!0)])}const IX=_e(aX,[["render",EX],["__scopeId","data-v-129e71b0"]]),FX={name:"feishu-table-render",components:{AtText:$t,QuestionCircleOutlined:Re},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{operatorMap:hl,actionState:{}}},mounted(){this.dataFormat()},watch:{nodeParams:{handler(e,n){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{dataFormat(){var l,i;let e=((i=(l=this.nodeParams)==null?void 0:l.plugin)==null?void 0:i.params)||{},n=(e==null?void 0:e.arguments)||{},{config_name:o,table_name:a}=e||{};this.actionState={...e,...n,config_name:o,table_name:a},this.actionState},getFieldLabel(e){var n,o;return((o=(n=e==null?void 0:e.properties)==null?void 0:n[e==null?void 0:e.current_properties_key])==null?void 0:o.name)||(e==null?void 0:e.name)},getFieldValue(e){var n;if(e!=null&&e.media_component){const o=((n=e==null?void 0:e.properties)==null?void 0:n[e==null?void 0:e.current_properties_key])||{};return(o==null?void 0:o.value)??""}return(e==null?void 0:e.value)??""},getFieldTags(e){var n;if(e!=null&&e.media_component){const o=((n=e==null?void 0:e.properties)==null?void 0:n[e==null?void 0:e.current_properties_key])||{};return(o==null?void 0:o.atTags)??[]}return(e==null?void 0:e.atTags)??[]}}},RX={class:"_main"},LX={class:"label"},VX={class:"hint"},MX={key:0},TX={key:1},jX={key:0,class:"field-box"},PX={key:0},qX={key:1},HX={key:1};function UX(e,n,o,a,l,i){var p,m;const r=Is,u=tt("QuestionCircleOutlined"),y=tt("at-text");return h(),D("div",RX,[s("div",null,[n[0]||(n[0]=s("span",{class:"label"},"公众号：",-1)),c(r,null,{default:f(()=>{var v;return[T(_(((v=l.actionState)==null?void 0:v.app_name)||"--"),1)]}),_:1})]),s("div",null,[s("span",LX,[n[2]||(n[2]=T("接收人 ",-1)),s("span",VX,[c(u),n[1]||(n[1]=s("span",{class:"hint-pop"},"接收人openid",-1))]),n[3]||(n[3]=T("： ",-1))]),(p=l.actionState)!=null&&p.touser?(h(),D("span",MX,[c(y,{options:o.valueOptions,defaultSelectedList:[],defaultValue:(((m=l.actionState)==null?void 0:m.touser)||"").toString()},null,8,["options","defaultValue"])])):(h(),D("span",TX,[c(r,null,{default:f(()=>[...n[4]||(n[4]=[T("--",-1)])]),_:1})]))]),s("div",null,[n[5]||(n[5]=s("span",{class:"label"},"消息类型：",-1)),c(r,null,{default:f(()=>{var v;return[T(_(((v=l.actionState)==null?void 0:v.msg_type_name)||"--"),1)]}),_:1})]),s("div",null,[n[8]||(n[8]=s("span",{class:"label"},"回复内容：",-1)),Array.isArray(l.actionState.fields)?(h(),D("div",jX,[(h(!0),D(ee,null,se(l.actionState.fields,v=>(h(),G(r,{class:"field-tag",key:v.field_name},{default:f(()=>[s("span",null,_(i.getFieldLabel(v)),1),n[6]||(n[6]=s("span",{class:"arrow-icon"},[s("img",{src:Ro})],-1)),i.getFieldValue(v)?(h(),D("span",PX,[c(y,{options:o.valueOptions,defaultSelectedList:i.getFieldTags(v),defaultValue:i.getFieldValue(v).toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(h(),D("span",qX))]),_:2},1024))),128))])):(h(),D("div",HX,[c(r,null,{default:f(()=>[...n[7]||(n[7]=[T("--",-1)])]),_:1})]))])])}const JX=_e(FX,[["render",UX],["__scopeId","data-v-127f9965"]]),zX={name:"feishu-table-render",inject:["getGraph","setData"],components:{AtText:$t},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{atTextRef:null,actionState:{}}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.dataFormat()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{nodeParams:{handler(e,n){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{onUpatateNodeName(e){var a;if(!ns.includes(e.node_type))return;const n=l=>{!Array.isArray(l)||l.length===0||l.forEach(i=>{if(i&&i.node_id==e.node_id){if(i.label){let r=i.label.split("/");r[0]=e.node_name,i.label=r.join("/")}i.node_name=e.node_name}})};(((a=this.actionState)==null?void 0:a.rendering)||[]).forEach(l=>{n(l==null?void 0:l.tags)}),this.$nextTick(()=>{const l=this.$refs.atTextRef;(Array.isArray(l)?l:l?[l]:[]).forEach(r=>{r&&r.refresh&&r.refresh()}),this.update(),this.dataFormat(),this.$emit("updateSize")})},update(){this.setData({node_params:JSON.stringify(this.nodeParams)})},dataFormat(){var a,l,i;let e=((l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)||{},n=(e==null?void 0:e.arguments)||{},o=(e==null?void 0:e.rendering)||{};if(Array.isArray(e==null?void 0:e.rendering)){const r=((i=e==null?void 0:e.arguments)==null?void 0:i.tag_map)||(e==null?void 0:e.tag_map)||{};e.rendering.forEach(u=>{if(u&&(!Array.isArray(u.tags)||u.tags.length===0)){const y=u.key,p=y&&r?r[y]:null;Array.isArray(p)&&p.length&&(u.tags=p)}})}this.actionState={...e,...n,...o}},getFieldLabel(e){var n,o;return((o=(n=e==null?void 0:e.properties)==null?void 0:n[e==null?void 0:e.current_properties_key])==null?void 0:o.name)||(e==null?void 0:e.name)},getFieldValue(e){var n;if(e!=null&&e.media_component){const o=((n=e==null?void 0:e.properties)==null?void 0:n[e==null?void 0:e.current_properties_key])||{};return(o==null?void 0:o.value)??""}return(e==null?void 0:e.value)??""},getFieldTags(e){var n;if(e!=null&&e.media_component){const o=((n=e==null?void 0:e.properties)==null?void 0:n[e==null?void 0:e.current_properties_key])||{};return(o==null?void 0:o.atTags)??[]}return(e==null?void 0:e.atTags)??[]}}},KX={class:"_main"},GX={key:0},WX={class:"label"};function ZX(e,n,o,a,l,i){var y,p;const r=Is,u=tt("at-text");return h(),D("div",KX,[(y=l.actionState)!=null&&y.use_plugin_config?(h(),D("div",GX,[n[0]||(n[0]=s("span",{class:"label"},"配置：",-1)),c(r,null,{default:f(()=>{var m;return[T(_(((m=l.actionState)==null?void 0:m.config_name)||"--"),1)]}),_:1})])):Z("",!0),(h(!0),D(ee,null,se(((p=l.actionState)==null?void 0:p.rendering)||[],(m,v)=>(h(),D("div",{key:m.key||v},[s("span",WX,_(m.label)+"：",1),m.value?(h(),G(r,{key:0},{default:f(()=>[c(u,{options:o.valueOptions,defaultSelectedList:m.tags,defaultValue:m.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(h(),G(r,{key:1},{default:f(()=>[...n[1]||(n[1]=[T("--",-1)])]),_:1}))]))),128))])}const YX=_e(zX,[["render",ZX],["__scopeId","data-v-1bfd27cc"]]),QX={name:"QuestionNode",components:{AtText:$t,FeishuTableRender:IX,OfficialSendMessageRender:JX,DynamicRender:YX,NodeCommon:gt},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(){const{t:e}=fe("views.workflow.components.nodes.zm-plugins-node.index");return{t:e}},data(){return{atTextRef:null,menus:[{name:"btn_delete",key:"delete",color:"#fb363f"}],formState:{},nodeParams:{},info:{},isMultiNode:!1,pluginData:{},valueOptions:[]}},computed:{pluginName(){var e,n;return((n=(e=this.nodeParams)==null?void 0:e.plugin)==null?void 0:n.name)||null},business(){var e,n,o;return((o=(n=(e=this.nodeParams)==null?void 0:e.plugin)==null?void 0:n.params)==null?void 0:o.business)||null},isFeishuTbPlugin(){return this.pluginName==="feishu_bitable"},isOfficialSendMessagePlugin(){return this.pluginName==="official_send_message"}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{properties:{handler(e,n){e.dataRaw!==n.dataRaw&&(this.nodeParamsFormat(),this.formStateFormat())},deep:!0}},methods:{onUpatateNodeName(e){var a,l,i,r,u,y;if(!ns.includes(e.node_type))return;this.valueOptions=this.getNode().getAllParentVariable()||[];const n=p=>{!Array.isArray(p)||p.length===0||p.forEach(m=>{if(m&&m.node_id==e.node_id){if(m.label){let v=m.label.split("/");v[0]=e.node_name,m.label=v.join("/")}m.node_name=e.node_name}})};this.formState&&typeof this.formState=="object"&&Object.keys(this.formState).forEach(p=>{var m;n((m=this.formState[p])==null?void 0:m.tags)});const o=[];(l=(a=this.nodeParams)==null?void 0:a.plugin)!=null&&l.tag_map&&o.push(this.nodeParams.plugin.tag_map),(y=(u=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:u.arguments)!=null&&y.tag_map&&o.push(this.nodeParams.plugin.params.arguments.tag_map),o.forEach(p=>{!p||typeof p!="object"||Object.keys(p).forEach(m=>{n(p[m])})}),this.$nextTick(()=>{const p=this.$refs.atTextRef;(Array.isArray(p)?p:p?[p]:[]).forEach(v=>{v&&v.refresh&&v.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.updateSize()})},async init(){this.valueOptions=this.getNode().getAllParentVariable(),this.nodeParamsFormat(),await this.loadPluginInfo(),await this.loadPluginParams(),this.updateSize()},loadPluginInfo(){return ll({name:this.pluginName}).then(e=>{var o;let n=(e==null?void 0:e.data)||{};this.info=n.remote||{},this.isMultiNode=((o=n==null?void 0:n.local)==null?void 0:o.multiNode)||!1}).catch(()=>{this.info={icon:this.properties.node_icon||""},this.isMultiNode=!1})},loadPluginParams(){return ss({name:this.pluginName,action:"default/get-schema",params:{}}).then(e=>{this.pluginData=(e==null?void 0:e.data)||{},this.formStateFormat(),this.update(this.pluginData)}).catch(()=>{this.pluginData={},this.formStateFormat(),this.update(this.pluginData)})},nodeParamsFormat(){this.nodeParams=JSON.parse(this.properties.node_params)},formStateFormat(){if(this.isFeishuTbPlugin||this.isOfficialSendMessagePlugin)return;let e=JSON.parse(JSON.stringify(this.pluginData));const n={official_account_profile:this.officialAccountHandle,official_batch_tag:this.officialTagHandle,official_send_template_message:this.officialTemplateHandle,official_article:this.officialArticleHandle,official_draft:this.officialDraftHandle};n[this.pluginName]?n[this.pluginName](e):this.defaultHandle(e),this.updateSize()},update(e){var y,p,m,v,C;typeof e=="string"&&(e=JSON.parse(e));const n=JSON.parse(this.properties.node_params),o=this.business&&(e!=null&&e[this.business])?e[this.business]:e,a=Bo(this.pluginName)||this.isMultiNode,l=a?((p=(y=n==null?void 0:n.plugin)==null?void 0:y.params)==null?void 0:p.arguments)||{}:((m=n==null?void 0:n.plugin)==null?void 0:m.params)||{},i={...l};for(const g in this.formState||{}){const $=this.formState[g]||{},w=($==null?void 0:$.enum_component)||($==null?void 0:$.radio_component),S=$==null?void 0:$.enum_default;w&&(i[g]==null||String(i[g]).trim()==="")&&S!=null&&S!==""&&(i[g]=S);const k=$==null?void 0:$.setting_cache_component;if(k===!0||k===1||k==="true"||k==="1"){const x=String(($==null?void 0:$.value)??"");if(x!=="")i[g]=x;else{const A=localStorage.getItem(this.getCacheKey(g));A!=null&&(i[g]=String(A))}}}n.plugin=n.plugin||{},n.plugin.params=n.plugin.params||{};const r=(C=(v=n==null?void 0:n.plugin)==null?void 0:v.params)==null?void 0:C.use_plugin_config;n.plugin.params.use_plugin_config=o&&Object.prototype.hasOwnProperty.call(o,"use_plugin_config")?!!o.use_plugin_config:!!r,a?n.plugin.params.arguments={...l,...i,tag_map:l.tag_map||{}}:n.plugin.params={...n.plugin.params,...i},n.plugin.output_obj=Fs((o==null?void 0:o.output)||{});const u=JSON.stringify(n);this.properties.node_params!==u&&this.setData({...this.properties,node_params:u})},defaultHandle(e){var a,l,i,r,u,y,p,m,v,C,g,$,w;let n,o;Bo(this.pluginName)||this.isMultiNode?(this.formState=((a=e==null?void 0:e[this.business])==null?void 0:a.params)||{},n=((r=(i=(l=this.nodeParams)==null?void 0:l.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},o=((m=(p=(y=(u=this.nodeParams)==null?void 0:u.plugin)==null?void 0:y.params)==null?void 0:p.arguments)==null?void 0:m.tag_map)||{}):(n=((C=(v=this.nodeParams)==null?void 0:v.plugin)==null?void 0:C.params)||{},o=(($=(g=this.nodeParams)==null?void 0:g.plugin)==null?void 0:$.tag_map)||{},this.formState=e);for(let S in this.formState){this.formState[S].value=String(n[S]||""),this.formState[S].tags=o[S]||[];const k=(w=this.formState[S])==null?void 0:w.setting_cache_component;if((k===!0||k===1||k==="true"||k==="1")&&!String(this.formState[S].value||"").trim()){const A=localStorage.getItem(this.getCacheKey(S));A!=null&&(this.formState[S].value=String(A))}}this.isMultiNode&&this.ensureMultiNodeRendering()},getCacheKey(e){let n="",o="";const a=typeof window<"u"?String(window.location.hash||""):"";return a.includes("?")&&(a.split("?")[1]||"").split("&").forEach(r=>{const[u,y]=r.split("=");u==="id"&&(n=decodeURIComponent(y||"")),u==="robot_key"&&(o=decodeURIComponent(y||""))}),n||(n=String(localStorage.getItem("last_local_robot_id")||"")),`${n||o||""}:${this.pluginName}:${e}`},ensureMultiNodeRendering(){var i,r,u,y,p,m,v,C,g,$,w,S,k,b,x,A;const e=(u=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:u.rendering;if(Array.isArray(e)&&e.length){const R=((v=(m=(p=(y=this.nodeParams)==null?void 0:y.plugin)==null?void 0:p.params)==null?void 0:m.arguments)==null?void 0:v.tag_map)||((g=(C=this.nodeParams)==null?void 0:C.plugin)==null?void 0:g.tag_map)||{};let E=!1;const B=e.map(N=>{var O,M;const I=N==null?void 0:N.key;if((Array.isArray(N==null?void 0:N.tags)?N.tags:[]).length)return N;const q=Array.isArray(R==null?void 0:R[I])?R[I]:Array.isArray((M=(O=this.formState)==null?void 0:O[I])==null?void 0:M.tags)?this.formState[I].tags:[];return q.length?(E=!0,{...N,tags:q}):N});if(E){const N=JSON.parse(this.properties.node_params);N.plugin=N.plugin||{},N.plugin.params=N.plugin.params||{},N.plugin.params.rendering=B,(w=($=this.nodeParams)==null?void 0:$.plugin)!=null&&w.params&&(this.nodeParams.plugin.params.rendering=B),this.setData({...this.properties,node_params:JSON.stringify(N)})}return}const n=Object.keys(this.formState||{}).filter(R=>R!=="app_secret").filter(R=>{var E,B;return!((B=(E=this.formState)==null?void 0:E[R])!=null&&B.hide_official_component)}).filter(R=>{var E,B;return!((B=(E=this.formState)==null?void 0:E[R])!=null&&B.advanced_settings)}).filter(R=>{var N,I;const E=(I=(N=this.formState)==null?void 0:N[R])==null?void 0:I.plugin_config_component;return!(E===!0||E===1||E==="true"||E==="1")}).filter(R=>{var N,I;const E=(I=(N=this.formState)==null?void 0:N[R])==null?void 0:I.setting_cache_component;return!(E===!0||E===1||E==="true"||E==="1")}).sort((R,E)=>{var B,N,I,L;return+(((N=(B=this.formState)==null?void 0:B[R])==null?void 0:N.sort_num)||0)-+(((L=(I=this.formState)==null?void 0:I[E])==null?void 0:L.sort_num)||0)}),o=((b=(k=(S=this.nodeParams)==null?void 0:S.plugin)==null?void 0:k.params)==null?void 0:b.arguments)||{},a=n.map(R=>{var L,q,O;const E=((L=this.formState)==null?void 0:L[R])||{};let B=(E==null?void 0:E.name)||R,N=String((E==null?void 0:E.value)??"");const I=Array.isArray(E==null?void 0:E.tags)?E.tags:[];if(R==="app_id"&&(B=this.t("label_official_account_name"),N=String(o.app_name??((O=(q=this.formState)==null?void 0:q.app_name)==null?void 0:O.value)??"")),E!=null&&E.enum_component||E!=null&&E.radio_component){const M=((E==null?void 0:E.enum)||[]).find(j=>String(j==null?void 0:j.value)===N)||((E==null?void 0:E.enum)||[]).find(j=>String(j==null?void 0:j.value)===(E==null?void 0:E.enum_default));M&&M.name&&(N=String(M.name))}return{label:B,value:N,tags:I,key:R}});if(!a.length)return;const l=JSON.parse(this.properties.node_params);l.plugin=l.plugin||{},l.plugin.params=l.plugin.params||{},l.plugin.params.rendering=a,(A=(x=this.nodeParams)==null?void 0:x.plugin)!=null&&A.params&&(this.nodeParams.plugin.params.rendering=a),this.setData({...this.properties,node_params:JSON.stringify(l)})},officialAccountHandle(e){var n,o,a,l,i,r,u,y,p,m,v;if((n=e==null?void 0:e[this.business])==null||delete n.params.app_id,(o=e==null?void 0:e[this.business])==null||delete o.params.app_secret,(a=e==null?void 0:e[this.business])!=null&&a.params)if(this.business==="getTagFans"){let C=((r=(i=(l=this.nodeParams)==null?void 0:l.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},g=((m=(p=(y=(u=this.nodeParams)==null?void 0:u.plugin)==null?void 0:y.params)==null?void 0:p.arguments)==null?void 0:m.tag_map)||{};this.formState={app_name:{type:"string",name:this.t("label_official_account_name"),value:C.app_name,tags:[]}},C.tag_type==1?this.formState.tag_name={type:"string",name:this.t("label_tag_name"),value:C.tag_name,tags:[]}:(v=g==null?void 0:g.tagid)!=null&&v.length?this.formState.tagid={type:"string",name:this.t("label_tag_name"),value:C.tagid,tags:g.tagid||[]}:this.formState.tagid={type:"string",name:this.t("label_tag_id"),value:C.tagid,tags:[]},this.formState.next_openid={type:"string",name:this.t("label_last_batch_openid"),value:C.next_openid,tags:g.next_openid||[]},this.updateSize();return}else e[this.business].params={app_name:{type:"string",name:this.t("label_official_account_name")},...e[this.business].params};this.defaultHandle(e)},officialTemplateHandle(){var o,a,l,i,r,u,y;let e=((l=(a=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:a.params)==null?void 0:l.arguments)||{},n=((y=(u=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:u.arguments)==null?void 0:y.tag_map)||{};switch(this.formState={app_name:{type:"string",name:this.t("label_official_account_name"),value:e.app_name,tags:[]},template_name:{type:"string",name:this.t("label_template_name"),value:e.template_name,tags:[]},touser:{type:"string",name:this.t("label_receiver"),value:e.touser,tags:n.touser||[]}},e.link_type){case 0:this.formState.link_type={type:"string",name:this.t("label_template_jump"),value:this.t("text_no_jump"),tags:[]};break;case 1:this.formState.link_type={type:"string",name:this.t("label_template_jump"),value:this.t("text_jump_link"),tags:[]},this.formState.url={type:"string",name:this.t("label_jump_link"),value:e.url,tags:n.url||[]};break;case 2:this.formState.link_type={type:"string",name:this.t("label_template_jump"),value:this.t("text_jump_miniprogram"),tags:[]},this.formState.miniprogram_app={type:"string",name:this.t("label_miniprogram_appid"),...e.miniprogram.appid},this.formState.miniprogram_path={type:"string",name:this.t("label_miniprogram_path"),...e.miniprogram.pagepath};break}this.updateSize()},officialTagHandle(){var o,a,l,i,r,u,y;let e=((l=(a=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:a.params)==null?void 0:l.arguments)||{},n=((y=(u=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:u.arguments)==null?void 0:y.tag_map)||{};this.formState={app_name:{type:"string",name:this.t("label_official_account_name"),value:e.app_name,tags:[]},openid_list:{type:"string",name:this.t("label_fans_openid_list"),value:e.openid_list,tags:[]}},e.tag_type==1?this.formState.tag_name={type:"string",name:this.t("label_tag_name"),value:e.tag_name,tags:[]}:this.formState.tagid={type:"string",name:this.t("label_tag_name"),value:e.tagid,tags:n.tagid||[]},this.updateSize()},officialArticleHandle(){var o,a,l,i,r,u,y;let e=((l=(a=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:a.params)==null?void 0:l.arguments)||{},n=((y=(u=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:u.arguments)==null?void 0:y.tag_map)||{};this.formState={url:{type:"string",name:"",value:e.url,tags:n.url||[]},number:{type:"string",name:"",value:e.number,tags:n.number||[]}},this.updateSize()},officialDraftHandle(){var a,l,i,r,u,y,p;let e=((i=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:i.arguments)||{},n=((p=(y=(u=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:u.params)==null?void 0:y.arguments)==null?void 0:p.tag_map)||{},o=e.article_type?e.article_type=="news"?this.t("text_news_message"):this.t("text_image_message"):"--";switch(this.business){case"add_draft":this.formState={app_name:{type:"string",name:this.t("label_official_account_name"),value:e.app_name,tags:[]},article_type:{type:"string",name:this.t("label_article_type"),value:o,tags:[]}};break;case"update_draft":case"publish_draft":case"delete_draft":case"preview_message":case"get_draft":default:this.formState={app_name:{type:"string",name:this.t("label_official_account_name"),value:e.app_name,tags:[]},media_id:{type:"string",name:this.t("label_article_id"),value:e.media_id,tags:n.media_id||[]}},this.business==="preview_message"&&(this.formState.account={type:"string",name:this.t("label_receive_user"),value:e.account,tags:n.account||[]});break}this.updateSize()},updateSize(){this.$nextTick(()=>{this.resetSize()})}}},XX={key:0,class:"ding-group-node"},eee={key:1,class:"ding-group-node"},tee={class:"label"};function see(e,n,o,a,l,i){const r=tt("DynamicRender"),u=tt("FeishuTableRender"),y=tt("OfficialSendMessageRender"),p=tt("at-text"),m=Is,v=tt("node-common");return h(),G(v,{properties:o.properties,title:o.properties.node_name,iconUrl:o.properties.node_icon||l.info.icon,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,style:{"min-width":"320px","min-height":"157px"}},{default:f(()=>[l.isMultiNode?(h(),D("div",XX,[c(r,{nodeParams:l.nodeParams,business:i.business,valueOptions:l.valueOptions,onUpdateSize:i.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])])):(h(),D("div",eee,[i.isFeishuTbPlugin?(h(),G(u,{key:0,nodeParams:l.nodeParams,business:i.business,valueOptions:l.valueOptions,onUpdateSize:i.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):Z("",!0),i.isOfficialSendMessagePlugin?(h(),G(y,{key:1,nodeParams:l.nodeParams,business:i.business,valueOptions:l.valueOptions,onUpdateSize:i.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):(h(!0),D(ee,{key:2},se(l.formState,(C,g)=>(h(),D("div",{key:g},[s("span",tee,_(C.name||g)+"：",1),C.value?(h(),G(m,{key:0},{default:f(()=>[c(p,{options:l.valueOptions,defaultSelectedList:C.tags,defaultValue:C.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(h(),G(m,{key:1},{default:f(()=>[...n[0]||(n[0]=[T("--",-1)])]),_:1}))]))),128))]))]),_:1},8,["properties","title","iconUrl","isSelected","isHovered","node-key"])}const oee=_e(QX,[["render",see],["__scopeId","data-v-31417b6f"]]);let nee=class extends ht{constructor(n){super(n),this.renderVue(oee,n)}},aee=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const lee={type:"zm-plugins-node",model:aee,view:nee},iee="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cg%20clip-path='url(%23cmdkkm1o9__clip0_12048_97931)'%20stroke='%23fff'%20stroke-width='1.16667'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M6.79163%2013.2109H5.04163V14.9609'/%3e%3cpath%20d='M14.9584%2014.9609H13.2084V13.2109'/%3e%3cpath%20d='M13.2084%206.78906H14.9584V5.03906'/%3e%3cpath%20d='M5.04163%205.03906H6.79163V6.78906'/%3e%3cpath%20d='M6.79163%205.125C5.21015%206.16842%204.16663%207.96112%204.16663%209.99757C4.16663%2010.295%204.18888%2010.5871%204.23181%2010.8726'/%3e%3cpath%20d='M10.875%2015.7708C10.5896%2015.8137%2010.2974%2015.8359%2010%2015.8359C7.96357%2015.8359%206.17086%2014.7924%205.12744%2013.2109'/%3e%3cpath%20d='M15.7682%209.125C15.8111%209.41043%2015.8334%209.70262%2015.8334%2010C15.8334%2012.0364%2014.7898%2013.8291%2013.2084%2014.8726'/%3e%3cpath%20d='M9.125%204.22925C9.41043%204.18632%209.70262%204.16406%2010%204.16406C12.0364%204.16406%2013.8291%205.20758%2014.8726%206.78906'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='cmdkkm1o9__clip0_12048_97931'%3e%3cpath%20fill='%23fff'%20transform='translate(3%203)'%20d='M0%200H14V14H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",ree={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){return(n,o)=>(h(),D(ee,null,[s("div",{class:qe(["border-line line-left",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2),s("div",{class:qe(["border-line line-right",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2),s("div",{class:qe(["border-line line-top",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2),s("div",{class:qe(["border-line line-botttom",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2)],64))}},dee=_e(ree,[["__scopeId","data-v-8d9d5c66"]]),uee={class:"custom-group-content"},cee={class:"top-block"},_ee={class:"title-block"},pee={class:"title-text"},fee={class:"btn-block"},vee={style:{color:"#fb363f"}},hee={class:"info-block"},mee={class:"info-item"},gee={class:"info-label"},yee={class:"info-content"},bee={key:0,class:"label-text"},kee={key:1,class:"label-text"},wee={key:2,class:"label-value"},Cee={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.custom-group-node.index"),o=e,a=be("getGraph"),l=be("getNode"),i=be("addNode"),r=be("setData"),u=be("resetSize"),y=U(["custom-group","batch-group","end-node","qa-node"]),p=U(!1),m=ye(()=>l().id),v=x=>{i(x),p.value=!1},C=()=>{p.value=!0},g=U(null),$=()=>{g.value.open()},w=we({loop_type:"array",loop_number:"",loop_arrays:[{key:"",typ:"array",value:"",cu_key:Math.random()*1e4}],intermediate_params:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}],output:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}]}),S=()=>{const x=o.properties.dataRaw||o.properties.node_params||"{}";let A={};try{A=JSON.parse(x).loop||{}}catch{A={}}A=JSON.parse(JSON.stringify(A)),w.loop_type=A.loop_type,w.loop_number=A.loop_number,w.loop_arrays=A.loop_arrays,w.intermediate_params=A.intermediate_params,w.output=A.output,Ze(()=>{u()})},k=()=>{const x=JSON.stringify({loop:{...w}});r({...o.node,...w,node_params:x})};Ie(()=>o.properties,()=>{S()},{deep:!0});const b=()=>{let x=l();a().deleteNode(x.id)};return Ne(()=>{S(),u(),k()}),(x,A)=>{const R=ct,E=no,B=lo,N=ao,I=io;return h(),D("div",uee,[c(dee,{isHovered:e.isHovered,isSelected:e.isSelected},null,8,["isHovered","isSelected"]),s("div",{class:"header-box",style:jt({background:e.properties.node_header_bg_color})},[s("div",cee,[s("div",_ee,[A[2]||(A[2]=s("img",{src:iee,alt:""},null,-1)),s("div",pee,_(o.properties.node_name),1)]),s("div",fee,[c(E,{title:null,trigger:"click",open:p.value,"onUpdate:open":A[0]||(A[0]=L=>p.value=L),arrow:!1,placement:"right"},{content:f(()=>[c(Qo,{style:{height:"550px",width:"500px"},excludedNodeTypes:y.value,onAddNode:v,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:f(()=>[c(R,{title:d(n)("tooltip_create_inner_node")},{default:f(()=>[s("div",{class:"btn-item",onClick:He(C,["stop"])},[c(d(Mt))])]),_:1},8,["title"])]),_:1},8,["open"]),c(R,{title:d(n)("tooltip_run_test")},{default:f(()=>[s("div",{class:"btn-item",onClick:He($,["stop"])},[c(d(bs))])]),_:1},8,["title"]),c(I,{trigger:"click"},{overlay:f(()=>[c(N,null,{default:f(()=>[c(B,{onClick:b},{default:f(()=>[s("div",vee,_(d(n)("btn_delete")),1)]),_:1})]),_:1})]),default:f(()=>[s("div",{class:"btn-item",onClick:A[1]||(A[1]=He(()=>{},["stop"]))},[...A[3]||(A[3]=[s("img",{class:"btn-icon",src:Hn,alt:""},null,-1)])])]),_:1})])]),s("div",hee,[s("div",mee,[s("div",gee,_(d(n)("label_loop_type")),1),s("div",yee,[w.loop_type=="array"?(h(),D("div",bee,_(d(n)("text_loop_array")),1)):Z("",!0),w.loop_type=="number"?(h(),D("div",kee,_(d(n)("text_loop_number")),1)):Z("",!0),w.loop_type=="number"?(h(),D("div",wee,_(w.loop_number),1)):Z("",!0)])])])],4),A[4]||(A[4]=s("div",{class:"node-body"},[s("div",{class:"node-content"})],-1)),c(fl,{ref_key:"runTestRef",ref:g,loop_node_key:m.value},null,8,["loop_node_key"])])}}},$ee=_e(Cee,[["__scopeId","data-v-dd0a5870"]]),{t:es}=fe("views.workflow.components.nodes.base-node");function El(e,n){return e.map(o=>{let a=n?n.node_id:o.node_id,l=n?n.node_name:o.node_name,i=n?n.node_type:o.node_type,r=o.name||o.key,u=n?`${n.text}.${r}`:r,y=o.children||o.subs||[],p="",m="";i==1?m=`global.${u}`:n?m=`${n.original_value}.${o.key}`:m=`${a}.${o.key}`,p=`【${m}】`;let v={label:r,value:p,original_value:m,node_id:a,node_name:l,node_type:i,text:u,key:o.key,id:a,typ:o.typ,children:y||[]};return v.children&&v.children.length>0&&(v.children=El(v.children,v)),v})}let xee=class extends Yo.view{constructor(n){super(n),this.div=null,this.app=null}getShape(){const n=super.getShape(),{model:o}=this.props,{width:a,height:l,x:i,y:r}=o;return this.div=_t("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),n.props.children.push(_t("foreignObject",{x:i-a/2,y:r-l/2,width:a,height:l,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),n}async mountVueComponentOnNextTick(){const n=this.div.__e;if(!n){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=Qe($ee,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=yo({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:o=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:o,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let o=this.r.el.clientHeight,a=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:a,height:o},this.props.model._width=a,this.props.model._height=o,this.props.model.refreshBranch()}},setData:o=>{o.dataRaw=o.node_params,Ze(()=>{this.props.model.properties={...this.props.model.properties,...o};let a=null;this.r&&this.r.el&&(a=this.r.el.clientHeight),this.props.model._height=a||o.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:o=>{this.props.model.properties.node_name=o}})}),this.app.mount(n);else if(this.r&&this.r.component){const o=this.props.model.getProperties(),a=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(o)!==JSON.stringify(a)&&(this.r.component.props.properties=o)}}getAnchorShape(n){let o=this.props.graphModel.getNodeEdges(this.props.model.id),a=o.map($=>$.sourceAnchorId),l=o.map($=>$.targetAnchorId),i=!1;const{x:r,y:u,type:y}=n,p=10;y==="left"?i=l.includes(n.id):i=a.includes(n.id);const m=_t("circle",{className:"custom-anchor-circle",cx:r,cy:u,r:p,fill:"#fff",stroke:"#2475FC","stroke-width":2}),v=_t("g",{className:"custom-anchor-arrow",transform:`translate(${r-p-2}, ${u-p-2})`},[_t("circle",{cx:12,cy:12,r:p,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),_t("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),C=_t("g",{className:`custom-anchor-plus ${i?"anchor-hide":""}`,transform:`translate(${r-p-2}, ${u-p-2})`},[_t("circle",{cx:12,cy:12,r:p,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),_t("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),_t("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return _t("g",{id:n.id,className:`custom-anchor custom-anchor-${y} ${i?"anchor-selected":"anchor-not-selected"}`,onClick:$=>{$.stopPropagation();const{graphModel:w,model:S}=this.props;y==="right"&&!i&&w.eventCenter.emit("custom:showPopupMenu",{anchorData:n,model:S})}},m,v,C)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}},See=class extends Yo.model{initNodeData(n){super.initNodeData(n),this.DEFAULT_TOP_Z_INDEX=Number.MAX_SAFE_INTEGER,this.DEFAULT_BOTTOM_Z_INDEX=1,this.topGroupZIndex=1,this.width=n.width||600,this.height=n.height||420,this.zIndex=1,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}setSelected(n){super.setSelected(n)}getNodeStyle(){const n=super.getNodeStyle();return n.stroke="none",n.strokeWidth=2,n.fill="#F0F2F5",n.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",n}getOutlineStyle(){const n=super.getOutlineStyle();return n.stroke="none",n.hover.stroke="none",n}getAnchorLineStyle(){const n=super.getAnchorLineStyle();return n.stroke="#2475FC",n}getAddableOutlineStyle(){const n=super.getAddableOutlineStyle();return n.stroke="#52c41a",n.strokeDasharray="4 4",n.strokeWidth=2,n}isAllowAppendIn(n){return!n.properties.disabled_add_group}setAttributes(){const n={message:es("err_only_right_anchor"),validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:es("err_group_connection_rule"),validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:es("err_only_left_anchor"),validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+28,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+28,id:y+"-anchor_right",type:"right",nodeId:n}]}getAllParentVariable(){const n=[],o=new Set,a=this.incoming.edges,{nodes:l}=this.graphModel;let i=l.find(p=>p.type==="start-node");i&&(o.add(i.id),n.push(i));const r=p=>{for(let m=0;m<p.length;m++){let C=p[m].sourceNode;o.has(C.id)||(o.add(C.id),ho.includes(C.type)&&n.push(C),r(C.incoming.edges))}};r(a),l.filter(p=>p.properties.loop_parent_key==this.id).forEach(p=>{n.push(p)});let y=[];for(const p of n){if(!ho.includes(p.type))continue;let m=JSON.parse(p.properties.node_params),v={label:p.properties.node_name,value:p.id,node_id:p.id,node_type:p.properties.node_type,typ:"node",children:[],loop_parent_key:p.properties.loop_parent_key,group_node_key:this.id};if(p.type==="http-node"&&(v.children=m.curl.output),p.type==="http-tool-node"&&(v.children=m.curl.output),p.type==="code-run-node"&&(v.children=m.code_run.output),p.type==="parameter-extraction-node"&&(v.children=m.params_extractor.output),p.type==="start-node"&&(v.children=[...m.start.diy_global,...m.start.sys_global]),p.type==="custom-group"&&(v.children=m.loop.output),p.type==="import-library-node"&&(v.children=m.library_import.outputs),p.type==="qa-node"&&(v.children=m.question.outputs),p.type==="json-node"&&(v.children=m.json_encode.output),p.type==="json-reverse-node"&&(v.children=m.json_decode.output),p.type==="select-data-node"&&(v.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),p.type==="knowledge-base-node"&&(v.children=[{key:"special.lib_paragraph_list",typ:"string",name:es("var_knowledge_base_reference"),label:es("var_knowledge_base_reference")}]),p.type==="ai-dialogue-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:es("var_ai_reply_content"),label:es("var_ai_reply_content")}]),p.type==="specify-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:es("var_message_content"),label:es("var_message_content")}]),p.type==="immediately-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:es("var_message_content"),label:es("var_message_content")}]),p.type==="problem-optimization-node"&&(v.children=[{key:"special.question_optimize_reply_content",typ:"string",name:es("var_question_optimization_result"),label:es("var_question_optimization_result")}]),p.type==="mcp-node"&&(v.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:es("var_tool_generated_content")}]),p.type==="image-generation-node"){let C=m.image_generation.image_num;if(C>0){let g=[];for(let $=0;$<+C;$++){let w=String.fromCharCode(97+$);g.push({key:`picture_url_${w}`,typ:"string",name:`picture_url_${w}`,label:`picture_url_${w}`})}v.children=g}}if(p.type==="zm-plugins-node"){let C=m.plugin.output_obj?JSON.parse(JSON.stringify(m.plugin.output_obj)):[];const g=$=>{$.forEach(w=>{w.name=w.key||"",w.subs&&w.subs.length>0&&g(w.subs)})};g(C),v.children=C||[]}v.children.forEach(C=>{C.node_id=p.id,C.node_name=p.properties.node_name,C.node_type=p.properties.node_type}),v.children=El(v.children,null),y.push(v)}return y}refreshBranch(){this.incoming.edges.forEach(n=>{n.updatePathByAnchor()}),this.outgoing.edges.forEach(n=>{n.updatePathByAnchor()})}};const Dee={type:"custom-group",view:xee,model:See},Aee={name:"groupStartNode",components:{NodeCommon:gt},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{}},computed:{},watch:{properties:{handler(){},deep:!0}},mounted(){},methods:{}};function Oee(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,"hide-menus":!0,style:{width:"200px"}},null,8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Nee=_e(Aee,[["render",Oee],["__scopeId","data-v-e00a21c6"]]);let Bee=class extends ht{constructor(n){super(n),this.renderVue(Nee,n)}},Eee=class extends mt{setAttributes(){this.width=200,this.height=72;const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",isHovered:r,isSelected:u,nodeId:n}]}};const Iee={type:"group-start-node",model:Eee,view:Bee},Fee={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:gt},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},computed:{t(){return fe("views.workflow.components.nodes.terminate-node.index").t}},mounted(){this.$nextTick(()=>{this.resetSize()})},methods:{handleMenu(){}}},Ree={class:"end-node"},Lee={class:"node-desc"};function Vee(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,menus:l.menus,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,onHandleMenu:i.handleMenu,style:{width:"420px",height:"116px"}},{default:f(()=>[s("div",Ree,[s("div",Lee,_(i.t("msg_terminate_desc")),1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const Mee=_e(Fee,[["render",Vee],["__scopeId","data-v-fb8372f4"]]);let Tee=class extends ht{constructor(n){super(n),this.renderVue(Mee,n)}},jee=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n}]}};const Pee={type:"terminate-node",model:jee,view:Tee},qee={class:"start-node"},Hee={key:0,class:"start-node-options"},Uee={class:"options-title"},Jee={class:"options-list"},zee={class:"options-item"},Kee={key:0,class:"option-label"},Gee={key:1,class:"option-label"},Wee={key:2,class:"option-label"},Zee={key:0},Yee={key:1,class:"start-node-options"},Qee={class:"options-title"},Xee={class:"options-list"},ete={class:"options-item"},tte={class:"option-label"},ste={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.timing-trigger-node.index"),o=be("resetSize"),a=e;Ie(()=>a.properties,(u,y)=>{const p=u.node_params||"{}",m=y.node_params||"{}";p!=m&&r()},{deep:!0});let l={1:"text_monday",2:"text_tuesday",3:"text_wednesday",4:"text_thursday",5:"text_friday",6:"text_saturday",0:"text_sunday"};const i=we({type:"select_time",every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""}),r=()=>{if(!a.properties||!a.properties.node_params)return;let y=JSON.parse(a.properties.node_params).trigger.cron_config||{};Object.assign(i,y),Ze(()=>{o()})};return Ne(()=>{r()}),(u,y)=>(h(),G(gt,{properties:e.properties,title:e.properties.node_name,"icon-url":e.properties.node_icon,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",qee,[i.type=="select_time"?(h(),D("div",Hee,[s("div",Uee,_(d(n)("label_execution_time")),1),s("div",Jee,[s("div",zee,[i.every_type=="day"?(h(),D("div",Kee,_(d(n)("text_every_day"))+" "+_(i.hour_minute),1)):Z("",!0),i.every_type=="week"?(h(),D("div",Gee,_(d(n)("text_every_week"))+" "+_(d(n)(d(l)[i.week_number]))+" "+_(i.hour_minute),1)):Z("",!0),i.every_type=="month"?(h(),D("div",Wee,[T(_(d(n)("text_every_month"))+" ",1),i.month_day?(h(),D("span",Zee,_(i.month_day)+_(d(n)("text_day_suffix")),1)):Z("",!0),T(" "+_(i.hour_minute),1)])):Z("",!0)])])])):(h(),D("div",Yee,[s("div",Qee,_(d(n)("label_execution_time")),1),s("div",Xee,[s("div",ete,[s("div",tte,_(d(n)("text_linux_crontab_code")),1)])])]))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},ote=_e(ste,[["__scopeId","data-v-353e57c9"]]);let nte=class extends ht{constructor(n){super(n),this.renderVue(ote,n)}},ate=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",isHovered:r,isSelected:u,nodeId:n}]}};const lte={type:"timing-trigger-node",model:ate,view:nte},ite={class:"start-node"},rte={class:"start-node-options"},dte={class:"options-title"},ute={class:"options-list"},cte={class:"options-item"},_te={class:"option-label"},pte={class:"start-node-options"},fte={class:"options-list"},vte={class:"option-label"},hte={key:0,class:"options-item"},mte={class:"start-node-options"},gte={class:"options-title"},yte={class:"options-list"},bte={class:"option-label"},kte={class:"option-type"},wte={key:0,class:"options-item"},Cte={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.official-trigger-node.index"),o=Co(),a=be("resetSize"),l=e,i=ye(()=>o.officialList);Ie(()=>l.properties,(g,$)=>{const w=g.node_params||"{}",S=$.node_params||"{}";w!=S&&v()},{deep:!0});let r={message:"text_private_message",subscribe_unsubscribe:"text_subscribe_unsubscribe",qrcode_scan:"text_qrcode_scan",menu_click:"text_menu_click"};const u=we({msg_type:"",app_ids:[]}),y=ye(()=>u.app_ids.map(g=>i.value.find($=>$.app_id==g)).filter(Boolean)),p=U([]),m=ye(()=>[...p.value]),v=()=>{if(!l.properties||!l.properties.node_params)return;let g=JSON.parse(l.properties.node_params);p.value=g.trigger.outputs||[];let $=g.trigger.trigger_official_config;u.msg_type=$.msg_type,u.app_ids=$.app_ids?$.app_ids.split(","):[],Ze(()=>{a()})},C=()=>{let g=i.value.find($=>$.app_id=="sdwdw");y.value};return Ne(()=>{v()}),(g,$)=>(h(),G(gt,{properties:e.properties,title:e.properties.node_name,"icon-url":e.properties.node_icon,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",ite,[s("div",rte,[s("div",dte,_(d(n)("label_trigger_event")),1),s("div",ute,[s("div",cte,[s("div",_te,_(d(n)(d(r)[u.msg_type])),1)])])]),s("div",pte,[s("div",{class:"options-title",onClick:C},_(d(n)("label_official_account")),1),s("div",fte,[(h(!0),D(ee,null,se(y.value.slice(0,1),w=>(h(),D("div",{class:"options-item",key:w.app_id},[s("div",vte,_(w.app_name),1)]))),128)),y.value.length>1?(h(),D("div",hte,[...$[0]||($[0]=[s("div",{class:"option-label"},"...",-1)])])):Z("",!0)])]),s("div",mte,[s("div",gte,_(d(n)("label_output")),1),s("div",yte,[(h(!0),D(ee,null,se(m.value.slice(0,2),w=>(h(),D("div",{class:qe(["options-item",{"is-required":w.required}]),key:w.key},[s("div",bte,_(w.key),1),s("div",kte,_(w.typ),1)],2))),128)),m.value.length>2?(h(),D("div",wte,[...$[1]||($[1]=[s("div",{class:"option-label"},"...",-1)])])):Z("",!0)])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},$te=_e(Cte,[["__scopeId","data-v-4d3f5ee7"]]);let xte=class extends ht{constructor(n){super(n),this.renderVue($te,n)}},Ste=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",isHovered:r,isSelected:u,nodeId:n}]}};const Dte={type:"official-trigger-node",model:Ste,view:xte},Ate="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cpath%20d='M12.4647%206.7C12.573%206.69991%2012.6803%206.72119%2012.7804%206.76263C12.8805%206.80406%2012.9714%206.86484%2013.048%206.94148C13.1246%207.01811%2013.1853%207.1091%2013.2266%207.20923C13.268%207.30936%2013.2892%207.41667%2013.289%207.525V14.675C13.289%2014.8937%2013.2022%2015.1034%2013.0476%2015.2581C12.893%2015.4128%2012.6834%2015.4998%2012.4647%2015.5H5.32363C5.21533%2015.5001%205.10807%2015.4788%205.00801%2015.4374C4.90796%2015.3959%204.81706%2015.3351%204.74055%2015.2585C4.66403%2015.1818%204.6034%2015.0908%204.56212%2014.9907C4.52084%2014.8906%204.49973%2014.7833%204.5%2014.675V7.525C4.5%207.30643%204.58673%207.0968%204.74115%206.94212C4.89557%206.78744%205.10506%206.70036%205.32363%206.7H12.4654H12.4647ZM8.8945%208.7625C8.82228%208.76241%208.75075%208.77658%208.68402%208.80419C8.61729%208.83181%208.55667%208.87233%208.50563%208.92343C8.4546%208.97453%208.41415%209.0352%208.38662%209.10197C8.35909%209.16873%208.34501%209.24028%208.34519%209.3125V10.55H7.10906C7.00013%2010.5497%206.89358%2010.5818%206.80294%2010.6423C6.71231%2010.7027%206.64168%2010.7887%206.60005%2010.8894C6.55841%2010.99%206.54765%2011.1008%206.56912%2011.2076C6.59059%2011.3144%206.64332%2011.4124%206.72063%2011.4891C6.82375%2011.5922%206.96331%2011.65%207.10906%2011.65H8.34519V12.8875C8.34537%2012.9961%208.37768%2013.1021%208.43804%2013.1924C8.4984%2013.2826%208.58412%2013.3529%208.68439%2013.3946C8.78466%2013.4362%208.895%2013.4472%209.00151%2013.4262C9.10803%2013.4052%209.20595%2013.3532%209.28294%2013.2766C9.334%2013.2255%209.37449%2013.1648%209.40209%2013.0981C9.42969%2013.0313%209.44387%2012.9597%209.44381%2012.8875V11.65H10.6799C10.7887%2011.6501%2010.8951%2011.618%2010.9856%2011.5576C11.0761%2011.4972%2011.1466%2011.4113%2011.1882%2011.3108C11.2298%2011.2103%2011.2406%2011.0996%2011.2193%2010.993C11.198%2010.8863%2011.1454%2010.7883%2011.0684%2010.7116C11.0174%2010.6604%2010.9569%2010.6198%2010.8902%2010.5921C10.8236%2010.5644%2010.7521%2010.5501%2010.6799%2010.55H9.44313V9.3125C9.44313%209.16675%209.38527%209.02696%209.28228%208.92383C9.17928%208.82071%209.03956%208.76268%208.89381%208.7625H8.8945ZM14.8139%204.5C14.9839%204.5003%2015.1477%204.56357%2015.2738%204.67758C15.3999%204.7916%2015.4792%204.94828%2015.4966%205.11737L15.5%205.1875V12.0666C15.5003%2012.1982%2015.4628%2012.327%2015.392%2012.4379C15.3213%2012.5488%2015.2202%2012.637%2015.1007%2012.6922C14.9813%2012.7473%2014.8486%2012.7671%2014.7183%2012.7491C14.588%2012.731%2014.4656%2012.676%2014.3656%2012.5905C14.2316%2012.4752%2014.1471%2012.3127%2014.1298%2012.1367L14.1264%2012.0666V6.14931C14.1263%206.08512%2014.1038%206.02296%2014.0628%205.97361C14.0217%205.92427%2013.9647%205.89084%2013.9016%205.87912L13.8521%205.87431H7.93269C7.76272%205.87433%207.5988%205.81127%207.47268%205.69734C7.34655%205.58341%207.2672%205.42672%207.25%205.25762L7.24656%205.1875C7.24649%205.01749%207.30941%204.85349%207.42318%204.72715C7.53694%204.60082%207.69348%204.52112%207.86256%204.50344L7.93338%204.5H14.8125H14.8139Z'%20fill='%23fff'/%3e%3c/svg%3e",Ote={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){return(n,o)=>(h(),D(ee,null,[s("div",{class:qe(["border-line line-left",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2),s("div",{class:qe(["border-line line-right",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2),s("div",{class:qe(["border-line line-top",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2),s("div",{class:qe(["border-line line-botttom",{isSelected:e.isSelected,isHovered:e.isHovered}])},null,2)],64))}},Nte=_e(Ote,[["__scopeId","data-v-f0b41657"]]),Bte={class:"custom-group-content"},Ete={class:"top-block"},Ite={class:"title-block"},Fte={class:"title-text"},Rte={class:"btn-block"},Lte={style:{color:"#fb363f"}},Vte={class:"info-block"},Mte={class:"info-item"},Tte={class:"info-label"},jte={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.batch-group-node.index"),o=e,a=be("getGraph"),l=be("getNode"),i=be("addNode");be("setData");const r=be("resetSize"),u=U(["custom-group","batch-group","end-node","terminate-node","qa-node"]),y=U(!1),p=ye(()=>l().id),m=k=>{i(k),y.value=!1},v=()=>{y.value=!0},C=U(null),g=()=>{let k=$.batch_arrays[0];k&&k.key&&k.typ&&k.value?C.value.open():Me.error(n("msg_fill_execution_array"))},$=we({chan_number:10,max_run_number:500,batch_arrays:[{key:"",typ:"",value:"",_id:fo(16)}],output:[{key:"",typ:"",value:"",_id:fo(16)}]}),w=()=>{const k=o.properties.dataRaw||o.properties.node_params||"{}";let b={};try{b=JSON.parse(k).batch||{}}catch{b={}}$.chan_number=b.chan_number,$.batch_arrays=b.batch_arrays,$.output=b.output,Ze(()=>{r()})};Ie(()=>o.properties,(k,b)=>{JSON.stringify(k)!==JSON.stringify(b)&&w()},{deep:!0});const S=()=>{let k=l();a().deleteNode(k.id)};return Ne(()=>{w(),r()}),(k,b)=>{const x=ct,A=no,R=lo,E=ao,B=io;return h(),D("div",Bte,[c(Nte,{isHovered:e.isHovered,isSelected:e.isSelected},null,8,["isHovered","isSelected"]),s("div",{class:"header-box",style:jt({background:e.properties.node_header_bg_color})},[s("div",Ete,[s("div",Ite,[b[2]||(b[2]=s("img",{src:Ate,alt:""},null,-1)),s("div",Fte,_(o.properties.node_name),1)]),s("div",Rte,[c(A,{title:null,trigger:"click",open:y.value,"onUpdate:open":b[0]||(b[0]=N=>y.value=N),placement:"right"},{content:f(()=>[c(Qo,{style:{width:"500px",height:"550px"},excludedNodeTypes:u.value,onAddNode:m,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:f(()=>[c(x,{title:d(n)("tooltip_create_inner_node")},{default:f(()=>[s("div",{class:"btn-item",onClick:He(v,["stop"])},[c(d(Mt))])]),_:1},8,["title"])]),_:1},8,["open"]),c(x,{title:d(n)("tooltip_run_test")},{default:f(()=>[s("div",{class:"btn-item",onClick:He(g,["stop"])},[c(d(bs))])]),_:1},8,["title"]),c(B,{trigger:"click"},{overlay:f(()=>[c(E,null,{default:f(()=>[c(R,{onClick:S},{default:f(()=>[s("div",Lte,_(d(n)("btn_delete")),1)]),_:1})]),_:1})]),default:f(()=>[s("div",{class:"btn-item",onClick:b[1]||(b[1]=He(()=>{},["stop"]))},[...b[3]||(b[3]=[s("img",{class:"btn-icon",src:Hn,alt:""},null,-1)])])]),_:1})])]),s("div",Vte,[s("div",Mte,[s("div",Tte,_(d(n)("label_execution_array")),1),b[4]||(b[4]=s("div",{class:"info-content"},[s("div",{class:"label-text"},"input")],-1))])])],4),b[5]||(b[5]=s("div",{class:"node-body"},[s("div",{class:"node-content"})],-1)),c(Cl,{ref_key:"runTestRef",ref:C,batch_node_key:p.value},null,8,["batch_node_key"])])}}},Pte=_e(jte,[["__scopeId","data-v-a19a7e48"]]),{t:ts}=fe("views.workflow.components.nodes.base-node");function Il(e,n){return e.map(o=>{let a=n?n.node_id:o.node_id,l=n?n.node_name:o.node_name,i=n?n.node_type:o.node_type,r=o.name||o.key,u=n?`${n.text}.${r}`:r,y=o.children||o.subs||[],p="",m="";i==1?m=`global.${u}`:n?m=`${n.original_value}.${o.key}`:m=`${a}.${o.key}`,p=`【${m}】`;let v={label:r,value:p,original_value:m,node_id:a,node_name:l,node_type:i,text:u,key:o.key,id:a,typ:o.typ,children:y||[]};return v.children&&v.children.length>0&&(v.children=Il(v.children,v)),v})}class qte extends Yo.view{constructor(n){super(n),this.div=null,this.app=null}getShape(){const n=super.getShape(),{model:o}=this.props,{width:a,height:l,x:i,y:r}=o;return this.div=_t("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),n.props.children.push(_t("foreignObject",{x:i-a/2,y:r-l/2,width:a,height:l,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),n}async mountVueComponentOnNextTick(){const n=this.div.__e;if(!n){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=Qe(Pte,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=yo({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:o=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:o,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let o=this.r.el.clientHeight,a=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:a,height:o},this.props.model._width=a,this.props.model._height=o,this.props.model.refreshBranch()}},setData:o=>{o.dataRaw=o.node_params,Ze(()=>{this.props.model.properties={...this.props.model.properties,...o};let a=null;this.r&&this.r.el&&(a=this.r.el.clientHeight),this.props.model._height=a||o.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:o=>{this.props.model.properties.node_name=o}})}),this.app.mount(n);else if(this.r&&this.r.component){const o=this.props.model.getProperties(),a=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(o)!==JSON.stringify(a)&&(this.r.component.props.properties=o)}}getAnchorShape(n){let o=this.props.graphModel.getNodeEdges(this.props.model.id),a=o.map($=>$.sourceAnchorId),l=o.map($=>$.targetAnchorId),i=!1;const{x:r,y:u,type:y}=n,p=10;y==="left"?i=l.includes(n.id):i=a.includes(n.id);const m=_t("circle",{className:"custom-anchor-circle",cx:r,cy:u,r:p,fill:"#fff",stroke:"#2475FC","stroke-width":2}),v=_t("g",{className:"custom-anchor-arrow",transform:`translate(${r-p-2}, ${u-p-2})`},[_t("circle",{cx:12,cy:12,r:p,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),_t("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),C=_t("g",{className:`custom-anchor-plus ${i?"anchor-hide":""}`,transform:`translate(${r-p-2}, ${u-p-2})`},[_t("circle",{cx:12,cy:12,r:p,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),_t("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),_t("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return _t("g",{id:n.id,className:`custom-anchor custom-anchor-${y} ${i?"anchor-selected":"anchor-not-selected"}`,onClick:$=>{$.stopPropagation();const{graphModel:w,model:S}=this.props;y==="right"&&!i&&w.eventCenter.emit("custom:showPopupMenu",{anchorData:n,model:S})}},m,v,C)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}}class Hte extends Yo.model{initNodeData(n){super.initNodeData(n),this.width=n.width||600,this.height=n.height||420,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}getNodeStyle(){const n=super.getNodeStyle();return n.stroke="none",n.strokeWidth=2,n.fill="#F0F2F5",n.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",n}getOutlineStyle(){const n=super.getOutlineStyle();return n.stroke="none",n.hover.stroke="none",n}getAnchorLineStyle(){const n=super.getAnchorLineStyle();return n.stroke="#2475FC",n}getAddableOutlineStyle(){const n=super.getAddableOutlineStyle();return n.stroke="#52c41a",n.strokeDasharray="4 4",n.strokeWidth=2,n}isAllowAppendIn(n){return!n.properties.disabled_add_group}setAttributes(){const n={message:ts("err_only_right_anchor"),validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:ts("err_group_connection_rule"),validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:ts("err_only_left_anchor"),validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+28,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+28,id:y+"-anchor_right",type:"right",nodeId:n}]}getAllParentVariable(){const n=[],o=new Set,a=this.incoming.edges,{nodes:l}=this.graphModel;let i=l.find(p=>p.type==="start-node");i&&(o.add(i.id),n.push(i));const r=p=>{for(let m=0;m<p.length;m++){let C=p[m].sourceNode;o.has(C.id)||(o.add(C.id),ho.includes(C.type)&&n.push(C),r(C.incoming.edges))}};r(a),l.filter(p=>p.properties.loop_parent_key==this.id).forEach(p=>{n.push(p)});let y=[];for(const p of n){if(!ho.includes(p.type))continue;let m=JSON.parse(p.properties.node_params),v={label:p.properties.node_name,value:p.id,node_id:p.id,node_type:p.properties.node_type,typ:"node",children:[],loop_parent_key:p.properties.loop_parent_key,group_node_key:this.id};if(p.type==="http-node"&&(v.children=m.curl.output),p.type==="http-tool-node"&&(v.children=m.curl.output),p.type==="code-run-node"&&(v.children=m.code_run.output),p.type==="parameter-extraction-node"&&(v.children=m.params_extractor.output),p.type==="start-node"&&(v.children=[...m.start.diy_global,...m.start.sys_global]),p.type==="custom-group"&&(v.children=m.loop.output),p.type==="import-library-node"&&(v.children=m.library_import.outputs),p.type==="json-node"&&(v.children=m.json_encode.output),p.type==="json-reverse-node"&&(v.children=m.json_decode.output),p.type==="select-data-node"&&(v.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),p.type==="knowledge-base-node"&&(v.children=[{key:"special.lib_paragraph_list",typ:"string",name:ts("var_knowledge_base_reference"),label:ts("var_knowledge_base_reference")}]),p.type==="ai-dialogue-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:ts("var_ai_reply_content"),label:ts("var_ai_reply_content")}]),p.type==="specify-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:ts("var_message_content"),label:ts("var_message_content")}]),p.type==="immediately-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:ts("var_message_content"),label:ts("var_message_content")}]),p.type==="problem-optimization-node"&&(v.children=[{key:"special.question_optimize_reply_content",typ:"string",name:ts("var_question_optimization_result"),label:ts("var_question_optimization_result")}]),p.type==="mcp-node"&&(v.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:ts("var_tool_generated_content")}]),p.type==="image-generation-node"){let C=m.image_generation.image_num;if(C>0){let g=[];for(let $=0;$<+C;$++){let w=String.fromCharCode(97+$);g.push({key:`picture_url_${w}`,typ:"string",name:`picture_url_${w}`,label:`picture_url_${w}`})}v.children=g}}if(p.type==="zm-plugins-node"){let C=m.plugin.output_obj?JSON.parse(JSON.stringify(m.plugin.output_obj)):[];const g=$=>{$.forEach(w=>{w.name=w.key||"",w.subs&&w.subs.length>0&&g(w.subs)})};g(C),v.children=C||[]}v.children.forEach(C=>{C.node_id=p.id,C.node_name=p.properties.node_name,C.node_type=p.properties.node_type}),v.children=Il(v.children,null),y.push(v)}return y}refreshBranch(){this.incoming.edges.forEach(n=>{n.updatePathByAnchor()}),this.outgoing.edges.forEach(n=>{n.updatePathByAnchor()})}}const Ute={type:"batch-group",view:qte,model:Hte},Jte={class:"ai-dialogue-node"},zte={class:"field-list"},Kte={class:"field-item"},Gte={class:"field-item-label"},Wte={class:"field-item-content"},Zte={class:"field-value"},Yte={class:"field-key"},Qte={class:"field-item"},Xte={class:"field-item-label"},ese={class:"field-item-content"},tse={class:"field-value"},sse={class:"field-key"},ose={class:"field-item"},nse={class:"field-item-label"},ase={class:"options-list"},lse={class:"option-label"},ise={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.image-generation-node.index"),o=e,a=be("getNode"),l=be("resetSize"),i=U([]),r=U([]),u=we({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[],image_watermark:"1",image_optimize_prompt:"1"}),y=ye(()=>{let v=["msg"];if(u.image_num>0)for(let C=0;C<+u.image_num;C++){let g=String.fromCharCode(97+C);v.push(`picture_url_${g}`)}return v}),p=()=>{const v=o.properties.dataRaw||o.properties.node_params||"{}";let C={};try{m(),C=JSON.parse(v).image_generation||{},u.model_config_id=C.model_config_id,u.use_model=C.use_model,u.size=C.size,u.image_num=C.image_num,u.prompt=C.prompt,u.prompt_tags=C.prompt_tags,u.input_images=C.input_images,u.image_watermark=C.image_watermark,u.image_optimize_prompt=C.image_optimize_prompt}catch{C={}}Ze(()=>{l()})};function m(){let v=a().getAllParentVariable();i.value=v||[]}return Ie(()=>o.properties,(v,C)=>{const g=v.dataRaw||v.node_params||"{}",$=C.dataRaw||C.node_params||"{}";g!=$&&p()},{deep:!0}),Ne(()=>{p(),l()}),Ut(()=>{}),(v,C)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:r.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",Jte,[s("div",zte,[s("div",Kte,[s("div",Gte,_(d(n)("label_model")),1),s("div",Wte,[s("div",Zte,[s("span",Yte,[c(jo,{useModel:u.use_model,modelConfigId:u.model_config_id},null,8,["useModel","modelConfigId"])])])])]),s("div",Qte,[s("div",Xte,_(d(n)("label_prompt")),1),s("div",ese,[s("div",tse,[s("span",sse,[c($t,{options:i.value,defaultSelectedList:u.prompt_tags,defaultValue:u.prompt,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])])])])]),s("div",ose,[s("div",nse,_(d(n)("label_output")),1),s("div",ase,[(h(!0),D(ee,null,se(y.value,g=>(h(),D("div",{class:"options-item",key:g},[s("div",lse,_(g),1),C[0]||(C[0]=s("div",{class:"option-type"},"string",-1))]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},rse=_e(ise,[["__scopeId","data-v-a9aa9074"]]);let dse=class extends ht{constructor(n){super(n),this.renderVue(rse,n)}},use=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const cse={type:"image-generation-node",model:use,view:dse},_se={class:"ai-dialogue-node"},pse={class:"field-list"},fse={class:"field-item"},vse={class:"field-item-label"},hse={class:"field-item-content"},mse={class:"field-list-item"},gse={class:"field-text"},yse={key:1},bse={class:"field-item"},kse={class:"field-item-label"},wse={class:"field-item-content"},Cse={class:"field-key"},$se={class:"field-type"},xse={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.json-node.index"),o=e,a=be("setData"),l=be("getGraph"),i=be("getNode"),r=be("resetSize"),u=U([]),y=U([]),p=we({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),m=()=>{const $=o.properties.dataRaw||o.properties.node_params||"{}";let w={};try{w=JSON.parse($).json_encode||{}}catch{w={}}g(),w=JSON.parse(JSON.stringify(w)),p.input_variable=w.input_variable,p.input_tags=w.input_tags||[],p.output=w.output,Ze(()=>{r()})},v=()=>{const $=JSON.stringify({json_encode:{...p}});a({...o.node,node_params:$})},C=$=>{ns.includes($.node_type)&&Ze(()=>{v()})},g=()=>{let $=i().getAllParentVariable();y.value=$||[]};return Ie(()=>o.properties,m,{deep:!0}),Ne(()=>{m(),r(),l().eventCenter.on("custom:setNodeName",C)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",C)}),($,w)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",_se,[s("div",pse,[s("div",fse,[s("div",vse,_(d(n)("label_input_params")),1),s("div",hse,[s("div",mse,[s("div",gse,[p.input_variable.length>0?(h(),G($t,{key:0,options:y.value,defaultSelectedList:p.input_tags,defaultValue:p.input_variable,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(h(),D("span",yse,"--"))])])])]),s("div",bse,[s("div",kse,_(d(n)("label_output_fields")),1),s("div",wse,[(h(!0),D(ee,null,se(p.output,(S,k)=>(h(),D("div",{class:"field-value",key:k},[s("span",Cse,_(S.key),1),s("span",$se,_(S.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Sse=_e(xse,[["__scopeId","data-v-25132303"]]);let Dse=class extends ht{constructor(n){super(n),this.renderVue(Sse,n)}},Ase=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const Ose={type:"json-node",model:Ase,view:Dse},Nse={class:"ai-dialogue-node"},Bse={class:"field-list"},Ese={class:"field-item"},Ise={class:"field-item-label"},Fse={class:"field-item-content"},Rse={class:"field-list-item"},Lse={class:"field-text"},Vse={class:"field-item"},Mse={class:"field-item-label"},Tse={class:"field-item-content"},jse={class:"field-key"},Pse={class:"field-type"},qse={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.json-reverse-node.index"),o=e,a=be("setData"),l=be("getGraph");be("getNode");const i=be("resetSize"),r=U([]),u=we({input_variable:[],output:[{key:"",typ:"object",subs:[]}]}),y=()=>{const v=o.properties.dataRaw||o.properties.node_params||"{}";let C={};try{C=JSON.parse(v).json_decode||{}}catch{C={}}C=JSON.parse(JSON.stringify(C)),u.input_variable=tl(C.input_variable),u.output=C.output,Ze(()=>{i()})},p=()=>{const v=JSON.stringify({json_decode:{input_variable:u.input_variable?u.input_variable.join("."):"",...u}});a({...o.node,node_params:v})},m=v=>{ns.includes(v.node_type)&&Ze(()=>{p()})};return Ie(()=>o.properties,y,{deep:!0}),Ne(()=>{y(),i(),l().eventCenter.on("custom:setNodeName",m)}),Ut(()=>{l().eventCenter.off("custom:setNodeName",m)}),(v,C)=>(h(),G(gt,{properties:e.properties,title:o.properties.node_name,menus:r.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",Nse,[s("div",Bse,[s("div",Ese,[s("div",Ise,_(d(n)("label_input_params")),1),s("div",Fse,[s("div",Rse,[s("div",Lse,[c(Zs,{value:u.input_variable},null,8,["value"])])])])]),s("div",Vse,[s("div",Mse,_(d(n)("label_output_fields")),1),s("div",Tse,[(h(!0),D(ee,null,se(u.output,(g,$)=>(h(),D("div",{class:"field-value",key:$},[s("span",jse,_(g.key),1),s("span",Pse,_(g.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Hse=_e(qse,[["__scopeId","data-v-9486e307"]]);let Use=class extends ht{constructor(n){super(n),this.renderVue(Hse,n)}},Jse=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n}]}};const zse={type:"json-reverse-node",model:Jse,view:Use},Kse={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:gt,AtText:$t},setup(){const{t:e}=fe("views.workflow.components.nodes.voice-synthesis-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{use_model:"",text:"",text_tags:[]}}},computed:{},watch:{properties:{handler(e,n){e.dataRaw!==n.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var a,l;this.getValueOptions();let e=this.properties.dataRaw||this.properties.node_params||"{}",n=JSON.parse(e),o=((a=n==null?void 0:n.text_to_audio)==null?void 0:a.arguments)||{};this.formState.use_model=o.use_model||"--",this.formState.text=o.text||"",this.formState.text_tags=((l=o==null?void 0:o.tag_map)==null?void 0:l.text)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let e=this.getNode().getAllParentVariable();this.valueOptions=e||[]}}},Gse={class:"specify-reply-node"},Wse={class:"static-field-list"},Zse={class:"static-field-item"},Yse={class:"static-field-item-label"},Qse={class:"static-field-item-content"},Xse={class:"static-field-value"},eoe={class:"static-field-item"},toe={class:"static-field-item-label"},soe={class:"static-field-item-content"},ooe={class:"static-field-value"},noe={key:1};function aoe(e,n,o,a,l,i){const r=tt("at-text"),u=tt("node-common");return h(),G(u,{properties:o.properties,title:o.properties.node_name,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type},{default:f(()=>[s("div",Gse,[s("div",Wse,[s("div",Zse,[s("div",Yse,_(a.t("label_voice_model")),1),s("div",Qse,[s("div",Xse,_(l.formState.use_model),1)])]),s("div",eoe,[s("div",toe,_(a.t("label_text")),1),s("div",soe,[s("div",ooe,[l.formState.text.length>0?(h(),G(r,{key:0,options:l.valueOptions,defaultSelectedList:l.formState.text_tags,defaultValue:l.formState.text,class:"text",ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(h(),D("span",noe,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const loe=_e(Kse,[["render",aoe],["__scopeId","data-v-f72b865d"]]);let ioe=class extends ht{constructor(n){super(n),this.renderVue(loe,n)}},roe=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r)=>{if(l.id==i.id)return!1;const u=l.graphModel.edges.map(p=>p.sourceAnchorId),y=r.id;return r.type==="right"&&!u.includes(y)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i}=this,{nodeSortKey:r}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:r+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:r+"-anchor_right",type:"right",nodeId:n}]}};const doe={type:"voice-synthesis-node",model:roe,view:ioe},uoe={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:gt,AtText:$t},setup(){const{t:e}=fe("views.workflow.components.nodes.voice-clone-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{file_url:"",file_url_tags:[]}}},computed:{},watch:{properties:{handler(e,n){e.dataRaw!==n.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var a,l;this.getValueOptions();let e=this.properties.dataRaw||this.properties.node_params||"{}",n=JSON.parse(e),o=((a=n==null?void 0:n.voice_clone)==null?void 0:a.arguments)||{};this.formState.file_url=o.file_url||"--",this.formState.file_url_tags=((l=o==null?void 0:o.tag_map)==null?void 0:l.file_url)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let e=this.getNode().getAllParentVariable();this.valueOptions=e||[]}}},coe={class:"specify-reply-node"},_oe={class:"static-field-list"},poe={class:"static-field-item"},foe={class:"static-field-item-label"},voe={class:"static-field-item-content"},hoe={class:"static-field-value"},moe={key:1};function goe(e,n,o,a,l,i){const r=tt("at-text"),u=tt("node-common");return h(),G(u,{properties:o.properties,title:o.properties.node_name,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type},{default:f(()=>[s("div",coe,[s("div",_oe,[s("div",poe,[s("div",foe,_(a.t("label_clone_audio")),1),s("div",voe,[s("div",hoe,[l.formState.file_url.length>0?(h(),G(r,{key:0,options:l.valueOptions,defaultSelectedList:l.formState.file_url_tags,defaultValue:l.formState.file_url,ref:"atInputRef",class:"text"},null,8,["options","defaultSelectedList","defaultValue"])):(h(),D("span",moe,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const yoe=_e(uoe,[["render",goe],["__scopeId","data-v-89e51e67"]]);let boe=class extends ht{constructor(n){super(n),this.renderVue(yoe,n)}},koe=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r)=>{if(l.id==i.id)return!1;const u=l.graphModel.edges.map(p=>p.sourceAnchorId),y=r.id;return r.type==="right"&&!u.includes(y)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i}=this,{nodeSortKey:r}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:r+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:r+"-anchor_right",type:"right",nodeId:n}]}};const woe={type:"voice-clone-node",model:koe,view:boe},Coe={class:"start-node"},$oe={class:"start-node-options"},xoe={class:"options-title"},Soe={class:"options-list"},Doe={class:"options-item"},Aoe={class:"option-label"},Ooe={class:"start-node"},Noe={class:"start-node-options"},Boe={class:"options-title"},Eoe={class:"options-list"},Ioe={class:"options-item"},Foe={class:"option-label"},Roe={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.webhook-trigger-node.index"),o=be("resetSize"),a=e;Ie(()=>a.properties,(r,u)=>{const y=r.node_params||"{}",p=u.node_params||"{}";y!=p&&i()},{deep:!0});const l=we({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""}),i=()=>{if(!a.properties||!a.properties.node_params)return;let u=JSON.parse(a.properties.node_params).trigger.trigger_web_hook_config;Object.assign(l,u),Ze(()=>{o()})};return Ne(()=>{i()}),(r,u)=>(h(),G(gt,{title:e.properties.node_name,"icon-url":e.properties.node_icon,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",Coe,[s("div",$oe,[s("div",xoe,_(d(n)("label_request_url")),1),s("div",Soe,[s("div",Doe,[s("div",Aoe,_(l.url),1)])])])]),s("div",Ooe,[s("div",Noe,[s("div",Boe,_(d(n)("label_request_method")),1),s("div",Eoe,[s("div",Ioe,[s("div",Foe,_(l.method),1)])])])])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Loe=_e(Roe,[["__scopeId","data-v-834edc03"]]);let Voe=class extends ht{constructor(n){super(n),this.renderVue(Loe,n)}},Moe=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o+l/2,y:a-i/2+25,id:y+"-anchor_right",type:"right",isHovered:r,isSelected:u,nodeId:n}]}};const Toe={type:"webhook-trigger-node",model:Moe,view:Voe},joe={class:"ai-dialogue-node"},Poe={class:"field-list"},qoe={class:"field-item"},Hoe={class:"field-item-label"},Uoe={class:"field-item-content"},Joe={class:"field-value"},zoe={class:"field-key"},Koe={class:"field-item"},Goe={class:"field-item-label"},Woe={class:"field-item-content"},Zoe={class:"field-value"},Yoe={class:"field-key"},Qoe={class:"field-item"},Xoe={class:"field-item-label"},ene={class:"field-item-content"},tne={class:"field-value"},sne={class:"field-key"},one={key:0,class:"field-item"},nne={class:"field-item-label"},ane={class:"field-item-content"},lne={class:"field-value"},ine={class:"field-key"},rne={key:1,class:"field-item"},dne={class:"field-item-label"},une={class:"field-item-content"},cne={class:"field-value"},_ne={class:"field-key"},pne={key:2,class:"field-item"},fne={class:"field-item-label"},vne={class:"field-item-content"},hne={class:"field-value"},mne={class:"field-key"},gne={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(e){const{t:n}=fe("views.workflow.components.nodes.import-library-node.index"),o=Co(),a=ye(()=>o.libraryLists),l=e,i=be("getNode"),r=be("resetSize"),u=U([]),y=U([]),p=we({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),m=ye(()=>a.value.filter(w=>p.library_id.includes(w.id))),v=ye(()=>{var w;return(w=m.value[0])==null?void 0:w.library_name}),C=ye(()=>m.value&&m.value.length?m.value[0].type:-1),g=()=>{const w=l.properties.dataRaw||l.properties.node_params||"{}";let S={};try{$(),S=JSON.parse(w).library_import||{};for(let k in S)k=="library_id"?p.library_id=S[k]?S[k].split(","):[]:p[k]=S[k]}catch{image_generation={}}Ze(()=>{r()})};function $(){let w=i().getAllParentVariable();u.value=w||[]}return Ie(()=>l.properties,(w,S)=>{const k=w.dataRaw||w.node_params||"{}",b=S.dataRaw||S.node_params||"{}";k!=b&&g()},{deep:!0}),Ne(()=>{g(),r()}),Ut(()=>{}),(w,S)=>(h(),G(gt,{properties:e.properties,title:l.properties.node_name,menus:y.value,"icon-name":l.properties.node_icon_name,isSelected:l.isSelected,isHovered:l.isHovered,"node-key":l.properties.node_key,node_type:l.properties.node_type,style:{width:"420px"}},{default:f(()=>[s("div",joe,[s("div",Poe,[s("div",qoe,[s("div",Hoe,_(d(n)("label_knowledge_base")),1),s("div",Uoe,[s("div",Joe,[s("span",zoe,_(v.value),1)])])]),C.value==2?(h(),D(ee,{key:0},[s("div",Koe,[s("div",Goe,_(d(n)("label_segment_question")),1),s("div",Woe,[s("div",Zoe,[s("span",Yoe,[c($t,{options:u.value,defaultValue:p.qa_question},null,8,["options","defaultValue"])])])])]),s("div",Qoe,[s("div",Xoe,_(d(n)("label_segment_answer")),1),s("div",ene,[s("div",tne,[s("span",sne,[c($t,{options:u.value,defaultValue:p.qa_answer},null,8,["options","defaultValue"])])])])])],64)):Z("",!0),C.value!=2&&C.value>=0?(h(),D(ee,{key:1},[p.import_type=="content"?(h(),D("div",one,[s("div",nne,_(d(n)("label_document_title")),1),s("div",ane,[s("div",lne,[s("span",ine,[c($t,{options:u.value,defaultValue:p.normal_title},null,8,["options","defaultValue"])])])])])):Z("",!0),p.import_type=="content"?(h(),D("div",rne,[s("div",dne,_(d(n)("label_document_content")),1),s("div",une,[s("div",cne,[s("span",_ne,[c($t,{options:u.value,defaultValue:p.normal_content},null,8,["options","defaultValue"])])])])])):Z("",!0),p.import_type=="url"?(h(),D("div",pne,[s("div",fne,_(d(n)("label_document_url")),1),s("div",vne,[s("div",hne,[s("span",mne,[c($t,{options:u.value,defaultValue:p.normal_url},null,8,["options","defaultValue"])])])])])):Z("",!0)],64)):Z("",!0)])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},yne=_e(gne,[["__scopeId","data-v-fd02d36a"]]);let bne=class extends ht{constructor(n){super(n),this.renderVue(yne,n)}},kne=class extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r)=>{if(l.id==i.id)return!1;const u=l.graphModel.edges.map(p=>p.sourceAnchorId),y=r.id;return r.type==="right"&&!u.includes(y)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i}=this,{nodeSortKey:r}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:r+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+25,id:r+"-anchor_right",type:"right",nodeId:n}]}};const wne={type:"import-library-node",model:kne,view:bne},Cne={name:"ZmWorkflowNode",components:{NodeCommon:gt},inject:["getNode","getGraph","resetSize","setData"],setup(){const{t:e}=fe("views.workflow.components.nodes.zm-workflow-node.index");return{t:e}},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],robotAvatar:"",nodeParams:{},options:[]}},mounted(){this.init()},methods:{init(){var e,n,o;this.nodeParams=rs(this.properties.node_params),this.robotAvatar=(o=(n=(e=this.nodeParams)==null?void 0:e.workflow)==null?void 0:n.robot_info)==null?void 0:o.robot_avatar,this.loadRobotNode()},handleMenu(e){if(e.key==="delete"){let n=this.getNode();this.getGraph().deleteNode(n.id)}},loadRobotNode(){var e,n;Ua({robot_id:(n=(e=this.nodeParams)==null?void 0:e.workflow)==null?void 0:n.robot_id}).then(o=>{var l,i;let a=rs((l=o==null?void 0:o.data)==null?void 0:l.node_params);this.options=((i=a==null?void 0:a.start)==null?void 0:i.diy_global)||[],this.update(),this.$nextTick(()=>{this.resetSize()})})},update(){var o;let e=this.nodeParams,n=((o=e==null?void 0:e.workflow)==null?void 0:o.params)||[];if(!Array.isArray(n)||!n.length){let a=JSON.parse(JSON.stringify(this.options));for(let l of a)l.variable=String(l.variable||"");e.workflow.params=a,this.setData({node_params:JSON.stringify(e)})}}}},$ne={class:"start-node"},xne={class:"start-node-options"},Sne={class:"options-title"},Dne={class:"options-list",style:{"max-height":"82px",overflow:"hidden"}},Ane={class:"option-label"},One={class:"option-type"},Nne={class:"start-node-options"},Bne={class:"options-title"},Ene={class:"options-list"},Ine={class:"options-item"},Fne={class:"option-label"};function Rne(e,n,o,a,l,i){const r=tt("node-common");return h(),G(r,{properties:o.properties,title:o.properties.node_name,menus:l.menus,"icon-url":l.robotAvatar,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,onHandleMenu:i.handleMenu},{default:f(()=>[s("div",$ne,[s("div",xne,[s("div",Sne,_(a.t("label_input_params")),1),s("div",Dne,[(h(!0),D(ee,null,se(l.options,u=>(h(),D("div",{class:qe(["options-item",{"is-required":u.required}]),key:u.key},[s("div",Ane,_(u.key),1),s("div",One,_(u.typ),1)],2))),128))])]),s("div",Nne,[s("div",Bne,_(a.t("label_exception_handling")),1),s("div",Ene,[s("div",Ine,[s("div",Fne,_(a.t("msg_error_handling")),1)])])])])]),_:1},8,["properties","title","menus","icon-url","isSelected","isHovered","node-key","onHandleMenu"])}const Lne=_e(Cne,[["render",Rne],["__scopeId","data-v-55e981f1"]]);class Vne extends ht{constructor(n){super(n),this.renderVue(Lne,n)}}class Mne extends mt{setAttributes(){const n={message:"只允许从右边的锚点连出",validate:(l,i,r,u)=>{if(l.id==i.id)return!1;const y=l.graphModel.edges.map(m=>m.sourceAnchorId),p=r.id;return r.type==="right"&&!y.includes(p)}},o={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(l,i,r,u)=>l.properties.loop_parent_key?l.properties.loop_parent_key===i.properties.loop_parent_key:!i.properties.loop_parent_key};this.sourceRules=[n,o];const a={message:"只允许连接左边的锚点",validate:(l,i,r,u)=>l.id==i.id?!1:u.type==="left"};this.targetRules=[a]}getDefaultAnchor(){const{id:n,x:o,y:a,width:l,height:i,isHovered:r,isSelected:u}=this,{nodeSortKey:y}=this.properties;return[{x:o-l/2,y:a-i/2+24,id:y+"-anchor_left",type:"left",nodeId:n},{x:o+l/2,y:a-i/2+24,id:y+"-anchor_right",type:"right",nodeId:n},{x:o+l/2,y:a+i/2-28,id:y+"-anchor_right_exception",type:"right",nodeId:n}]}}const Tne={type:"zm-workflow-node",model:Mne,view:Vne};function jne(e){ut(pJ,e),ut(xJ,e),ut(KJ,e),ut(tz,e),ut(NK,e),ut(uG,e),ut(Cz,e),ut(Uz,e),ut(OG,e),ut(VG,e),ut(Pee,e),ut(qG,e),ut(wW,e),ut(tW,e),ut(FW,e),ut(zW,e),ut(pZ,e),ut(IZ,e),ut(ZZ,e),ut(SY,e),ut(ZY,e),ut(SQ,e),ut(ZQ,e),ut(nX,e),ut(lee,e),ut(Dee,e),ut(Iee,e),ut(lte,e),ut(Dte,e),ut(Ute,e),ut(cse,e),ut(Ose,e),ut(zse,e),ut(doe,e),ut(woe,e),ut(Toe,e),ut(wne,e),ut(Tne,e)}const Pne={class:"logic-flow-wrapper"},Ia="dont_show_delete_node_confirm",qne={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.workflow-canvas"),l=o;let i=null;const r=U(null),{setStorage:u,getStorage:y}=zl(),p=U(y(Ia)||!1),m=U(null),v=U(!1),C=U(null),g=U(null),$=Bi(),w=U(""),S=U([]),k={nodes:[]},b={width:160,height:140,bottomPosition:24,rightPosition:16},x={exclusiveMode:!1},A=oe=>{i&&i.zoom(oe)};function R(){if(g.value){i=new Ei({container:g.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[Ii,Fi,UU,Ri,Al,Ol,Li,Dl,Sl],pluginsOptions:{miniMap:b,selectionSelect:x,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),r.value=i,jne(i),ut(IU,i),ut(jU,i),i.setDefaultEdgeType("custom-bezier-edge"),i.on("graph:rendered",({graphModel:ue})=>{w.value=ue.flowId});let oe={},ne=[];i.on("node:dragstart",({data:ue})=>{let ke=i.graphModel.getElement(ue.id);oe[ke.id]=ke.zIndex,ne=[];let Se=i.graphModel.dynamicGroup.getGroupByNodeId(ue.id);Se?(Se.properties.width=Se._width,Se.properties.height=Se._height):ke.properties.loop_parent_key||(ke.properties.disabled_add_group=!0),ue.children&&ue.children.length>0?(ke.setZIndex(-9999),ne=ue.children||[],ne.forEach(Le=>{let Je=i.getNodeModelById(Le);oe[Je.id]=Je.zIndex,Je.setZIndex(999999)})):ke.setZIndex(999999),ke.refreshBranch()}),i.on("node:drop",({data:ue})=>{let ke=i.graphModel.getElement(ue.id),Se=i.graphModel.dynamicGroup.getGroupByNodeId(ue.id);ue.properties.loop_parent_key&&!Se&&i.getNodeModelById(ue.properties.loop_parent_key).addChild(ue.id),ue.children&&ue.children.length?(ke.setZIndex(-9999),ue.children.forEach(Le=>{let Je=i.getNodeModelById(Le);Je.setZIndex(oe[Je.id])})):ke.setZIndex(oe[ke.id]),ke.refreshBranch()}),i.on("node:drag",({data:ue})=>{const ke=ue.id,Se=i.graphModel.getNodeEdges(ke),Le=i.graphModel.dynamicGroup.getGroupByNodeId(ue.id);setTimeout(()=>{Se.forEach(Je=>{if(Je.type==="custom-bezier-edge"){const{startPoint:bt,endPoint:lt}=Je,kt=lt.x-bt.x,Ft=lt.y-bt.y;let At=10+Math.sqrt(kt*kt+Ft*Ft)*.3;const ae=10,re=1e3;At=Math.round(At),At=Math.max(ae,Math.min(At,re)),Je.setProperties({offset:At})}}),Le&&Le.refreshBranch()},0)}),i.on("node:add",()=>{}),i.on("custom:addNode",ue=>{z(ue)}),i.on("custom:addGroupNode",({data:ue,group_id:ke})=>{H(ue,ke)}),i.on("group:add-node",({childId:ue})=>{i.getNodeModelById(ue).properties.loop_parent_key}),i.on("element:click",ue=>{S.value=[ue.data]}),i.on("node:click",({data:ue})=>{De(ue)}),i.on("blank:click",()=>{he()}),i.on("selection:selected",ue=>{let ke=[];ue.elements.forEach(Se=>{let Le=i.getDataById(Se.id);(Se.BaseType==="node"||Se.BaseType==="edge")&&ke.push(Le)}),S.value=ke}),i.on("node:delete",({data:ue})=>{let ke=JSON.parse(JSON.stringify(ue));ie(ke)}),i.on("edge:delete",({data:ue})=>{let ke=JSON.parse(JSON.stringify(ue));ge(ke)}),i.on("custom:node:delete",ue=>{W(ue)}),i.on("custom:edge:delete",ue=>{Q(ue)}),i.on("custom:keyoard:delete",()=>{X()}),i.on("custom:paste",F),i.render(k),i.setZoomMiniSize(.01),i.setZoomMaxSize(8)}}const E=oe=>{const ne=zn(),ue=JSON.parse(oe.properties.node_params),{trigger_list:ke}=ue.start,Se=[],Le=[];let Je=0;return ke.forEach(bt=>{const lt=`trigger_${bt.trigger_type}`,kt=Js(lt),Ft=ne[lt],Rt=kt.substring(0,8)+kt.substring(kt.length-8),yt=Js(lt),Lt=cn(bt);Lt.id=kt,Lt.x=oe.x-600,Lt.y=oe.y+Je,Lt.properties.node_key=kt,Lt.properties.nodeSortKey=Rt;const At={id:yt,sourceNodeId:kt,targetNodeId:oe.id,properties:{isTriggerEdge:!0}};Je+=Ft.height+50,Se.push(Lt),Le.push(At)}),{nodes:Se,edges:Le}},B=()=>{const oe=JSON.parse(JSON.stringify(i.getGraphRawData())),ne=[],ue=[],ke=[];return oe.edges.forEach(Se=>{Se.properties.isTriggerEdge||ue.push(Se)}),oe.nodes.forEach(Se=>{Se.properties.isTriggerNode?ke.push(Se):ne.push(Se)}),oe.nodes=ne,oe.edges=ue,oe.triggers=ke,oe},N=oe=>{const ne=zn();let ue={nodes:[],edges:[]};oe.nodes.forEach(Se=>{let Le=ne[Se.type];Se.properties.node_icon_name=Le.properties.node_icon_name,Se.properties.node_header_bg_color||(Se.properties.node_header_bg_color=Le.properties.node_header_bg_color||"#fff"),Se.properties.width||(Se.properties.width=Le.width),Se.properties.height||(Se.properties.height=Le.height),Se.type=="start-node"&&(ue=E(Se))}),oe.nodes.unshift(...ue.nodes),i.clearData(),i.graphModel.graphDataToModel(oe),i.graphModel.translateCenter(),i.extension.miniMap.show(),ue.edges.forEach(Se=>{i.graphModel.addEdge(Se)});const ke=i.extension.canvasHistory;ke&&ke.setInitialState(oe),I(oe.nodes)},I=oe=>{Ze(()=>{oe.forEach(ne=>{if(ne.loop_parent_key){const ue=i.getNodeModelById(ne.loop_parent_key);ue&&(ue.addChild(ne.id),i.graphModel.dynamicGroup.sendNodeToFront(ue))}})})};let L={};const q=()=>{const{nodes:oe}=i.graphModel,ne=oe.find(Se=>Se.type==="start-node"),ue=ne.x-600,ke=ne.y;return{x:ue,y:ke}},O=(oe,ne)=>{const ue=ne.x-ne.width/2,ke=ne.x+ne.width/2,Se=ne.y-ne.height/2,Le=ne.y+ne.height/2,Je=oe.x-oe._width/2,bt=oe.x+oe._width/2,lt=oe.y-oe._height/2,kt=oe.y+oe._height/2;let Ft=!1,Rt=oe._width,yt=oe._height,Lt=0,At=0;if(ke>bt-20){const ae=ke-bt+50;Rt+=ae,Lt+=ae/2,Ft=!0}if(ue<Je+20){const ae=Je-ue+50;Rt+=ae,Lt-=ae/2,Ft=!0}if(Le>kt-20){const ae=Le-kt+50;yt+=ae,At+=ae/2,Ft=!0}if(Se<lt+20){const ae=lt-Se+50;yt+=ae,At-=ae/2,Ft=!0}Ft&&(oe.properties.width=Rt,oe.properties.height=yt,oe._width=Rt,oe._height=yt,oe.width=Rt,oe.height=yt,oe.x+=Lt,oe.y+=At)},M=oe=>{const ne=oe.node||oe,ue=oe.anchorData,ke=oe.event;if(ne.id=ne.id||Js(ne.type),ne.nodeSortKey=ne.id.substring(0,8)+ne.id.substring(ne.id.length-8),ue){let Se=i.graphModel.dynamicGroup.getGroupByNodeId(ue.nodeId);Se?ne.properties.loop_parent_key=Se.id:ne.properties.disabled_add_group=!0}if(oe.isCopy||(L[ne.type]?(L[ne.type]=L[ne.type]+1,ne.properties.node_name=ne.properties.node_name+L[ne.type]):L[ne.type]=1),ne.properties.width=ne.width,ne.properties.height=ne.height,ne.properties.nodeSortKey=ne.nodeSortKey,ke){const{transformModel:Se}=i.graphModel,{left:Le,top:Je}=g.value.getBoundingClientRect(),[bt,lt]=Se.HtmlPointToCanvasPoint([ke.clientX-Le,ke.clientY-Je]);ne.x=bt+ne.width/2,ne.y=lt+ne.height/2}else if(!ne.x&&!ne.y)if(ue)ne.x=ue.x+ne.width+100,ne.y=ue.y+ne.height/2-24;else if(oe.isTriggerNode){let Se=q();ne.x=Se.x,ne.y=Se.y,ne.properties.disabled_add_group=!0}else{const{transformModel:Se}=i.graphModel,Le=Se.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);ne.x=Le[0],ne.y=Le[1],ne.properties.disabled_add_group=!0}return ne},j=oe=>{setTimeout(()=>{H({node:{type:"group-start-node",with:200,properties:{node_type:27,node_name:a("node_loop_start"),node_icon_name:"start-node",node_params:JSON.stringify({})}}},oe.id)},100)},V=oe=>{setTimeout(()=>{H({node:{type:"group-start-node",with:200,properties:{node_type:31,node_name:a("node_batch_start"),node_icon_name:"start-node",node_params:JSON.stringify({})}}},oe.id)},100)},z=oe=>{const ne=M(oe),ue=oe.model,ke=oe.anchorData;let Se=!1;if(i.graphModel.nodes.forEach(Je=>{!Se&&Je.type=="session-trigger-node"&&(Se=!0)}),Se&&ne.type=="session-trigger-node")return Me.error(a("msg_duplicate_session_trigger"));let Le=i.addNode(ne);if(Le.type=="custom-group"&&j(Le),Le.type=="batch-group"&&V(Le),oe.isTriggerNode){const{nodes:Je}=i.graphModel,bt=Je.find(kt=>kt.type==="start-node");let lt={type:"custom-bezier-edge",sourceNodeId:ne.id,targetNodeId:bt.id,properties:{isTriggerEdge:!0}};i.graphModel.addEdge(lt),i.graphModel.eventCenter.emit("custom:trigger-add",ne)}if(ke){let Je=Le.anchors.find(lt=>lt.type==="left");i.graphModel.addEdge({type:"custom-bezier-edge",sourceNodeId:ue.id,targetNodeId:Le.id,sourceAnchorId:ke.id,targetAnchorId:Je.id,startPoint:{x:ke.x,y:ke.y},endPoint:{x:Je.x,y:Je.y}});const bt=i.graphModel.dynamicGroup.getGroupByNodeId(ke.nodeId);if(bt&&bt.id){const lt=i.getNodeModelById(bt.id);lt.addChild(Le.id),O(lt,Le),i.graphModel.dynamicGroup.sendNodeToFront(lt)}}i.graphModel.clearSelectElements(),Le.setSelected(!0)},H=(oe,ne)=>{const ue=oe.node||oe;ue.id=Js(ue.type),ue.nodeSortKey=ue.id.substring(0,8)+ue.id.substring(ue.id.length-8),ue.properties.width=ue.width,ue.properties.height=ue.height,ue.properties.nodeSortKey=ue.nodeSortKey,ue.properties.loop_parent_key=ne;const ke=i.getNodeModelById(ne);ue.x=ke.x,ue.y=ke.y;let Se=0;i.graphModel.nodes.forEach(Je=>{Je.zIndex>Se&&(Se=Je.zIndex)}),Se=Se+99;let Le=i.addNode(ue);ke.addChild(Le.id),Le.setZIndex(Se),i.graphModel.clearSelectElements(),i.graphModel.dynamicGroup.sendNodeToFront(ke)},K=async()=>{const oe=i.getGraphRawData(),ne=i.extension.canvasHistory;ne&&ne.beginTransaction(),i.extension.elk.layout(oe).then(()=>{ne&&ne.commitTransaction("auto-layout")}).catch(ue=>{Me.error(a("msg_layout_failed")+ue),ne&&ne.rollbackTransaction()})},F=({originalNodes:oe,basePoint:ne,pasteBasePoint:ue})=>{const ke=i.extension.canvasHistory;ke&&ke.beginTransaction();try{const Se=oe.map(Je=>{const bt=Je.x-ne.x,lt=Je.y-ne.y,kt=JSON.parse(JSON.stringify(Je));return kt.x=ue.x+bt,kt.y=ue.y+lt,M({node:kt,isCopy:!0})}),{nodes:Le}=i.addElements({nodes:Se});i.clearSelectElements(),Le.forEach(Je=>{Je.setSelected(!0)})}finally{ke&&ke.commitTransaction("paste")}},Y=oe=>{oe.height&&(oe.properties.height=oe.height);let ne=i.getNodeModelById(oe.id);ne.height=oe.properties.height||oe.height||ne.height,ne.properties=oe.properties,oe.properties.node_type==2&&oe.properties.node_sub_type==21&&ne.graphModel.getNodeEdges(oe.id).forEach(ke=>{ke.sourceNodeId==ne.id&&(ne.getAnchorInfo(ke.sourceAnchorId)||ne.graphModel.deleteEdgeById(ke.id))}),ne.refreshBranch()};function le(oe){return i.getNodeModelById(oe.id)}function J(oe){return i.getEdgeModelById(oe.id)}function P(){const{nodes:oe}=i.getGraphData();return oe.filter(ue=>ue.properties.isTriggerNode)}const W=oe=>{oe&&oe.id&&(S.value=[oe]),de()},Q=oe=>{oe&&oe.id&&(S.value=[oe]),de()},X=()=>{let oe=i.getSelectElements(!0);S.value=[...oe.nodes,...oe.edges],de()},de=()=>{if(S.value.length===0)return;const oe=S.value.filter(ke=>le(ke)?!["start-node","group-start-node"].includes(ke.type):!0);if(oe.length===0){S.value=[];return}const ne=S.value.filter(ke=>ke.properties.isTriggerNode===!0);if(ne.length>0&&P().length-ne.length<1){Me.error(a("msg_keep_at_least_one_trigger"));return}const ue=()=>{const ke=i.extension.canvasHistory;ke&&ke.replaceLastState("replace-before-delete");let Se=!1;oe.forEach(Le=>{le(Le)?(Le.properties.isTriggerNode&&(Se=!0),i.deleteNode(Le.id)):J(Le)&&i.deleteEdge(Le.id)}),Se&&i.graphModel.eventCenter.emit("custom:trigger-change",null),ke&&ke.saveCurrentState("delete"),S.value=[],i.clearSelectElements()};if(p.value){ue();return}if(oe.length>1||oe.length===1&&le(oe[0])){const ke=oe.length>1?a("title_batch_delete"):a("title_delete_node"),Se=a("msg_confirm_delete_elements",{count:oe.length});let Le=!1;wt.confirm({title:ke,content:Qe("div",{},[Qe("p",Se),Qe(Za,{class:"dont-show-again-checkbox",onChange:Je=>{Le=Je.target.checked}},()=>a("label_dont_show_again"))]),onOk:()=>{Le&&(p.value=!0,u(Ia,!0)),ue()},onCancel:()=>{}})}else ue()},Fe=["group-start-node","terminate-node"],De=oe=>{const ne=JSON.parse(JSON.stringify(oe));ne.properties.dataRaw=ne.properties.dataRaw||ne.properties.node_params,l("selectNode",ne),!Fe.includes(oe.type)&&(C.value=ne,v.value=!0)},$e=oe=>{C.value.properties=oe,Y(JSON.parse(JSON.stringify(C.value)))},Ue=oe=>{C.value.properties.node_name=oe,Y(JSON.parse(JSON.stringify(C.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:oe,node_id:C.value.id,node_type:C.value.type})},ie=oe=>{l("onDeleteNode",oe),C.value&&oe.id===C.value.id&&(v.value=!1,setTimeout(()=>{C.value=null},350))},ge=oe=>{l("onDeleteEdge",oe)},ve=()=>{l("runTest")},he=()=>{l("blankClick"),v.value&&(v.value=!1),S.value.length>0&&(S.value=[],i.clearSelectElements())},Ae=oe=>{if(!i||!oe)return;const ne=i.getNodeModelById(oe);if(!ne)return;A(1);const ue=ne.x+150,ke=ne.y;try{if(i.focusOn)i.focusOn({id:oe,coordinate:{x:ue,y:ke}});else{const{transformModel:Se}=i.graphModel,{width:Le,height:Je}=i.graphModel,{SCALE_X:bt,SCALE_Y:lt}=Se,kt=Le/2,Ft=Je/2,Rt=(kt-ue)/bt,yt=(Ft-ke)/lt;Se.TRANSLATE_X=Rt,Se.TRANSLATE_Y=yt}De({id:ne.id,type:ne.type,properties:ne.properties,x:ne.x,y:ne.y})}catch(Se){console.error("Failed to focus on node:",Se)}};return Ne(()=>{R()}),yn(()=>{i&&i.destroy&&i.destroy()}),n({lfRef:r,setData:N,getData:B,updateNode:Y,focusOnNode:Ae}),(oe,ne)=>(h(),D("div",Pne,[s("div",{ref_key:"containerRef",ref:g,class:"logic-flow-container"},null,512),c(d($),{"flow-id":w.value},null,8,["flow-id"]),d(i)?(h(),G(Bm,{key:0,lf:d(i),onRunTest:ve,onAddNode:z,onZoomChange:A,onAutoLayout:K},null,8,["lf"])):Z("",!0),C.value?(h(),G(CU,{key:1,ref_key:"nodeFormDrawerRef",ref:m,open:v.value,"onUpdate:open":ne[0]||(ne[0]=ue=>v.value=ue),destroyOnClose:!0,"node-id":C.value.id,node:C.value.properties,"node-type":C.value.type,lf:d(i),onUpdateNode:$e,onChangeTitle:Ue},null,8,["open","node-id","node","node-type","lf"])):Z("",!0)]))}},Hne={class:"modal-title-block"},Une={key:0,class:"run-detail"},Jne={class:"flex-content-box"},zne={class:"test-model-box"},Kne={class:"top-title"},Gne={class:"option-desc"},Wne={key:2,class:"input-list-box"},Zne={class:"add-btn-box"},Yne={class:"input-list-box"},Qne={class:"add-btn-box"},Xne={key:0,class:"result-list-box loading-box"},eae={key:1,class:"result-list-box"},tae=["onClick"],sae={class:"status-block"},oae={class:"icon-name-box"},nae=["src"],aae={class:"node-name"},lae={key:0,class:"time-tag"},iae={class:"right-active-icon"},rae={class:"save-btn-box"},dae={class:"preview-box"},uae={class:"preview-title"},cae={class:"title-text"},_ae={class:"icon-name-box"},pae=["src"],fae={class:"node-name"},vae={key:0,class:"time-tag"},hae={key:0,class:"preview-content-block"},mae={class:"title-block"},gae={class:"preview-img-box"},yae={class:"preview-content-block"},bae={class:"title-block"},kae={class:"preview-code-box"},wae={class:"preview-content-block"},Cae={class:"title-block"},$ae={class:"preview-code-box"},xae={class:"preview-content-block"},Sae={class:"title-block"},Dae={class:"preview-code-box"},Aae={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.components.run-test.index"),l=ye(()=>({openid:"38fjp8344ru43",question:a("placeholder_hello"),question_multiple:`{"type":"text", "text":"${a("placeholder_what_is_this")}"}`,conversationid:"12345"})),i=e,r=U(!1),u=ye(()=>i.start_node_params.diy_global||[]),y=ye(()=>{let J=i.start_node_params.trigger_list||[],P=!1;return J.forEach(W=>{var Q;W.trigger_type==1&&(P=(Q=W.chat_config)==null?void 0:Q.question_multiple_switch)}),P}),p=o,m=go().query,v=U(!1),C=U(""),g=U([]),$=ye(()=>C.value?g.value.filter(J=>J.node_key==C.value)[0]:null),w=ye(()=>{let J=[];if($.value&&$.value.node_type==33){let P=$.value.output;for(let W in P)W.includes("picture_url_")&&J.push(P[W])}return J}),S=U(!1),k=we({is_draft:!0,robot_key:m.robot_key,global:"",globalState:{},question:"",question_multiple:[{value:""}],dialogue_id:"",session_id:""}),b=()=>{r.value=!1,R();let J=localStorage.getItem("workflow_run_test_data")||"{}";J=JSON.parse(J),k.global=J.global||"",k.question="",k.question_multiple=[{value:""}],k.dialogue_id="",k.session_id="",g.value=[],C.value="",p("getGlobal"),Ze(()=>{u.value.forEach(P=>{k.globalState[P.key]=x(P)});try{let P=J.global?JSON.parse(J.global):{};for(let W in k.globalState)P[W]&&(Array.isArray(P[W])?k.globalState[W]=P[W].map(Q=>({value:typeof Q=="object"?JSON.stringify(Q):Q,key:Math.random()*1e3})):k.globalState[W]=P[W])}catch(P){}}),v.value=!0};function x(J){return J.typ=="string"||J.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function A(){let J={};return u.value.forEach(P=>{if(P.typ=="string"){const W=(k.globalState[P.key]||"").trim();J[P.key]=W||(l.value[P.key]??"")}if(P.typ=="number"){const W=k.globalState[P.key];if(W!==""&&W!=null)J[P.key]=+W;else{const Q=l.value[P.key];J[P.key]=Q!=null&&Q!==""&&!isNaN(Number(Q))?Number(Q):""}}if(P.typ.includes("array")){let W=k.globalState[P.key].map(Q=>(Q.value=typeof Q.value=="string"?Q.value.trim():Q.value,on(Q.value)?JSON.parse(Q.value):Q.value)).filter(Q=>Q);if((!Array.isArray(W)||W.length===0)&&l.value[P.key]){const Q=l.value[P.key];on(Q)?W=[JSON.parse(Q)]:W=[Q]}J[P.key]=W}P.typ==="object"&&on(P.value)&&(J[P.key]=JSON.parse(P.value))}),JSON.stringify(J)}function R(){const P=i.lf.getGraphData().nodes.find(W=>W.type==="session-trigger-node");if(P){const Q=JSON.parse(P.properties.node_params||"{}").trigger||{};return Q.chat_config?Q.chat_config.question_multiple_switch:!1}}const E=(J,P)=>{k.globalState[J].splice(P,1)},B=J=>{k.globalState[J].push({value:"",key:Math.random()*1e4})},N=J=>{k.question_multiple.splice(J,1)},I=J=>{k.question_multiple.push({value:""})},L=U(null),q=U(0),O=U(0),M=()=>{L.value.validate().then(()=>{let J={...k};const P=R();J.global=A(),delete J.globalState;let W=J.question_multiple.filter(X=>X.value);J.question_multiple=JSON.stringify(W.map(X=>X.value)),S.value=!0,g.value=[];const Q=le();Object.keys(Q).length&&localStorage.setItem("workflow_run_test_data",JSON.stringify({global:JSON.stringify(Q)})),ei({...J,question_multiple_switch:P}).then(X=>{k.dialogue_id=X.data.dialog_id,k.session_id=X.data.session_id;let de=X.data.node_logs||[];q.value=X.data.use_token,O.value=X.data.use_mills,j(de)}).catch(X=>{g.value=[],r.value=!1;let de=X.data.node_logs||[];de&&de.length&&j(de)}).finally(()=>{S.value=!1})})},j=J=>{var W;J[J.length-1].node_type==43?(r.value=!0,Me.success(a("msg_continue_qa_params"))):(Me.success(a("msg_test_result_generated")),k.question="",k.question_multiple=[{value:""}],r.value=!1),g.value=J.map(Q=>{let X=Eo(Q.node_type);return Q.node_type==45&&(X=Q.node_icon||Eo(Q.node_type)),{...Q,is_success:Q.error_msg==="<nil>",node_icon:X}}),C.value=(W=g.value[0])==null?void 0:W.node_key},V=J=>{C.value=J.node_key},z=J=>{bo(JSON.stringify($.value[J])),Me.success(a("msg_copy_success"))},H=()=>{b()};function K(J){const P=l.value[J.key];return P?`${P}`:a("ph_input")}function F(J){try{return JSON.parse(J)}catch{return null}}function Y(J,P){return JSON.stringify(J)===JSON.stringify(P)}function le(){const J={};return u.value.forEach(P=>{const W=P.key;if(P.typ==="string"){const Q=String(k.globalState[W]||"").trim();if(!Q)return;const X=l.value[W];if(X!=null&&Q===String(X))return;J[W]=Q;return}if(P.typ==="number"){const Q=k.globalState[W];if(Q===""||Q==null)return;const X=+Q,de=l.value[W];if(de!=null&&!isNaN(Number(de))&&X===Number(de))return;J[W]=X;return}if(P.typ.includes("array")){const X=(Array.isArray(k.globalState[W])?k.globalState[W]:[]).map(De=>String((De==null?void 0:De.value)||"").trim()).filter(De=>De).map(De=>{const $e=F(De);return $e??De});if(!X.length)return;let de=[];const Fe=l.value[W];if(Fe!=null){const De=F(String(Fe));de=De!=null?[De]:[String(Fe)]}if(de.length&&Y(X,de))return;J[W]=X;return}}),J}return n({open:H}),(J,P)=>{const W=Is,Q=ct,X=_s,de=pt,Fe=Vt,De=Tt,$e=rt,Ue=Dt,ie=St,ge=os,ve=wt;return h(),D("div",null,[c(ve,{open:v.value,"onUpdate:open":P[5]||(P[5]=he=>v.value=he),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:f(()=>[s("div",Hne,[T(_(d(a)("btn_run_test"))+_(k.dialogue_id)+" ",1),g.value.length?(h(),D("div",Une,[s("span",null,_(d(a)("label_total_time"))+"："+_(d(An)(O.value)),1),s("span",null,_(d(a)("label_token_usage"))+"："+_(q.value)+" "+_(d(a)("label_tokens")),1)])):Z("",!0)])]),default:f(()=>[s("div",Jne,[s("div",zne,[s("div",Kne,_(d(a)("title_start_node_params")),1),c(ie,{model:k,ref_key:"formRef",ref:L,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:f(()=>[$s(s("div",null,[(h(!0),D(ee,null,se(u.value,he=>(h(),G(Ue,{name:["globalState",he.key],key:he.key,rules:[{required:he.required,message:d(a)("msg_input_key",{key:he.key})}]},{label:f(()=>[c(X,{gap:4},{default:f(()=>[T(_(he.key)+" ",1),c(W,{style:{margin:"0"}},{default:f(()=>[T(_(he.typ),1)]),_:2},1024),c(Q,{title:he.desc},{default:f(()=>[s("div",Gne,_(he.desc),1)]),_:2},1032,["title"])]),_:2},1024)]),default:f(()=>[he.typ=="string"?(h(),G(de,{key:0,placeholder:K(he),value:k.globalState[he.key],"onUpdate:value":Ae=>k.globalState[he.key]=Ae},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),he.typ=="number"?(h(),G(Fe,{key:1,style:{width:"100%"},placeholder:K(he),value:k.globalState[he.key],"onUpdate:value":Ae=>k.globalState[he.key]=Ae},null,8,["placeholder","value","onUpdate:value"])):Z("",!0),he.typ.includes("array")?(h(),D("div",Wne,[(h(!0),D(ee,null,se(k.globalState[he.key],(Ae,oe)=>(h(),D("div",{class:"input-list-item",key:oe},[c(De,null,{default:f(()=>[c(de,{placeholder:K(he),value:Ae.value,"onUpdate:value":ne=>Ae.value=ne},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),k.globalState[he.key].length>1?(h(),G(d(at),{key:0,onClick:ne=>E(he.key,oe)},null,8,["onClick"])):Z("",!0)]))),128)),s("div",Zne,[c($e,{onClick:Ae=>B(he.key),block:"",type:"dashed"},{default:f(()=>[T(_(d(a)("btn_add")),1)]),_:1},8,["onClick"])])])):Z("",!0)]),_:2},1032,["name","rules"]))),128))],512),[[Es,!r.value]]),r.value?(h(),D(ee,{key:0},[c(Ue,null,{label:f(()=>[c(X,{gap:4},{default:f(()=>[P[7]||(P[7]=T("question ",-1)),c(W,{style:{margin:"0"}},{default:f(()=>[...P[6]||(P[6]=[T("string",-1)])]),_:1})]),_:1})]),default:f(()=>[c(de,{placeholder:d(a)("msg_input_key",{key:"question"}),value:k.question,"onUpdate:value":P[0]||(P[0]=he=>k.question=he)},null,8,["placeholder","value"])]),_:1}),y.value?(h(),G(Ue,{key:0},{label:f(()=>[c(X,{gap:4},{default:f(()=>[P[9]||(P[9]=T("question_multiple ",-1)),c(W,{style:{margin:"0"}},{default:f(()=>[...P[8]||(P[8]=[T("string",-1)])]),_:1})]),_:1})]),default:f(()=>[s("div",Yne,[(h(!0),D(ee,null,se(k.question_multiple,(he,Ae)=>(h(),D("div",{class:"input-list-item",key:Ae},[c(De,null,{default:f(()=>[c(de,{placeholder:d(a)("ph_input"),value:he.value,"onUpdate:value":oe=>he.value=oe},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),k.question_multiple.length>1?(h(),G(d(at),{key:0,onClick:oe=>N(Ae)},null,8,["onClick"])):Z("",!0)]))),128)),s("div",Qne,[c($e,{onClick:P[1]||(P[1]=he=>I()),block:"",type:"dashed"},{default:f(()=>[T(_(d(a)("btn_add")),1)]),_:1})])])]),_:1})):Z("",!0)],64)):Z("",!0)]),_:1},8,["model"]),S.value?(h(),D("div",Xne,[S.value?(h(),G(ge,{key:0,tip:d(a)("msg_generating_test_result")},null,8,["tip"])):Z("",!0)])):Z("",!0),g.value.length>0?(h(),D("div",eae,[(h(!0),D(ee,null,se(g.value,(he,Ae)=>(h(),D("div",{class:qe(["list-item-block",{active:C.value==he.node_key}]),onClick:oe=>V(he),key:Ae},[s("div",sae,[he.is_success?(h(),G(d(wo),{key:0,style:{color:"#138b1b"}})):(h(),G(d(Zo),{key:1,style:{color:"#d81e06"}}))]),s("div",oae,[s("img",{src:he.node_icon,alt:""},null,8,nae),s("div",aae,_(he.node_name),1)]),he.is_success?(h(),D("div",lae,_(he.use_time)+"ms",1)):Z("",!0),s("div",iae,[c(d(Wo))])],10,tae))),128))])):Z("",!0),s("div",rae,[c($e,{loading:S.value,onClick:M,style:{"background-color":"#00ad3a"},type:"primary"},{default:f(()=>[c(d(bs)),T(_(r.value?d(a)("btn_continue_test"):d(a)("btn_run_test")),1)]),_:1},8,["loading"])])]),s("div",dae,[$.value?(h(),D(ee,{key:0},[s("div",uae,[s("div",cae,_(d(a)("title_log_details")),1),s("div",_ae,[s("img",{src:$.value.node_icon,alt:""},null,8,pae),s("div",fae,_($.value.node_name),1)]),$.value.is_success?(h(),D("div",vae,_($.value.use_time)+"ms",1)):Z("",!0)]),w.value.length>0?(h(),D("div",hae,[s("div",mae,_(d(a)("title_generated_image_log")),1),s("div",gae,[c(pl,{currentImageList:w.value},null,8,["currentImageList"])])])):Z("",!0),s("div",yae,[s("div",bae,[T(_(d(a)("label_input")),1),c(d(ms),{onClick:P[2]||(P[2]=he=>z("input"))})]),s("div",kae,[c(d(hs),{data:$.value.input},null,8,["data"])])]),s("div",wae,[s("div",Cae,[T(_(d(a)("label_output")),1),c(d(ms),{onClick:P[3]||(P[3]=he=>z("node_output"))})]),s("div",$ae,[c(d(hs),{data:$.value.node_output},null,8,["data"])])]),s("div",xae,[s("div",Sae,[T(_(d(a)("label_run_log")),1),c(d(ms),{onClick:P[4]||(P[4]=he=>z("output"))})]),s("div",Dae,[c(d(hs),{data:$.value.output},null,8,["data"])])])],64)):Z("",!0)])])]),_:1},8,["open"])])}}},Oae=_e(Aae,[["__scopeId","data-v-1d0f8889"]]),Nae=["data-lf"],Bae={class:"header-content"},Eae={class:"robot-status-text"},Iae={key:1,class:"robot-status-box status-0"},Fae={class:"robot-status-text"},Rae={key:0,class:"header-right"},Lae={key:0,class:"last-save-time"},Vae={key:0,class:"auto-save-hint"},Mae={style:{display:"flex","align-items":"center",gap:"8px"}},Tae={style:{color:"#262626"}},jae={style:{color:"#8c8c8c","font-weight":"normal"}},Pae={class:"lock-config"},qae={style:{color:"#595959"}},Hae={style:{color:"#595959"}},Uae={style:{"margin-top":"24px","text-align":"right"}},Jae={key:1,class:"lock-tip"},zae={class:"lock-info"},Kae={__name:"page-header",props:{lf:{default:()=>null,type:Object},saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.page-header"),l=Pt(),i=ye(()=>l.robotInfo),r=o,u=e,y=U(null),p=qa(),m=ye(()=>{var I;const N=(I=p.userInfo)==null?void 0:I.role_type;return N==1||N==2}),v=U(!1),C=U(10),g=U(!1),$=async()=>{g.value=!0;try{await si({draft_exptime:C.value}),Me.success(a("msg_lock_settings_saved")),v.value=!1}catch{Me.error(a("msg_save_failed"))}finally{g.value=!1}};Ne(async()=>{var N;try{const I=await ti(),L=+((N=I==null?void 0:I.data)==null?void 0:N.draft_exptime);typeof L=="number"&&(C.value=Math.max(10,Math.min(60,Math.round(L))))}catch{}});const w=()=>{},S=()=>{r("edit")},k=(N="handle")=>{const I=mo();let L=!1;const q=[],O=M=>{L=!0;const j=(M==null?void 0:M.component)||"未命名组件",V=(M==null?void 0:M.typeDisplay)||(M==null?void 0:M.type)||"";(Array.isArray(M==null?void 0:M.errors)?M.errors:[]).forEach(H=>{q.push(`【${j}${V?" - "+V:""}】字段「${H.field_name}」：${H.message}`)})};if(I.on&&I.on("workflow:validate:error",O),I.emit&&I.emit("workflow:validate",{action:"save"}),I.off&&I.off("workflow:validate:error",O),L){wt.warning({title:a("title_form_incomplete"),content:q.length?Qe("div",q.map(M=>Qe("div",M))):a("msg_complete_required_before_save")});return}r("save",N)},b=()=>{const N=mo();let I=!1;const L=[],q=O=>{I=!0;const M=(O==null?void 0:O.component)||"未命名组件",j=(O==null?void 0:O.typeDisplay)||(O==null?void 0:O.type)||"";(Array.isArray(O==null?void 0:O.errors)?O.errors:[]).forEach(z=>{L.push(`【${M}${j?" - "+j:""}】字段「${z.field_name}」：${z.message}`)})};if(N.on&&N.on("workflow:validate:error",q),N.emit&&N.emit("workflow:validate",{action:"release"}),N.off&&N.off("workflow:validate:error",q),I){wt.warning({title:a("title_form_incomplete"),content:L.length?Qe("div",L.map(O=>Qe("div",O))):a("msg_complete_required_before_release")});return}r("release")},x=()=>{r("getGlobal")},A=()=>{r("getVersionRecord")},R=()=>{r("edit")},E=()=>{y.value.open()};function B(N,I="YY-MM-DD HH:mm:ss"){return!N||N<=0?"--":is(N*1e3).format(I)}return n({openRunTest:E}),(N,I)=>{const L=rt,q=ct,O=It,M=Vt,j=no;return h(),D("div",{class:"page-header","data-lf":e.lf},[s("div",Bae,[c(xf),i.value.start_node_key!=""?(h(),D("div",{key:0,class:"robot-status-box status-1",onClick:S},[c(d(wo),{class:"robot-status-icon"}),s("div",Eae,_(d(a)("status_published")),1)])):(h(),D("div",Iae,[c(d(Sn),{class:"robot-status-icon"}),s("div",Fae,_(d(a)("status_unpublished")),1)]))]),u.showRight?(h(),D("div",Rae,[e.currentVersion==""&&e.isEditing?(h(),D(ee,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(h(),D("div",Lae,[T(_(B(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+_(i.value.draft_save_type=="handle"?d(a)("save_type_manual"):d(a)("save_type_auto"))+_(d(a)("save_draft"))+" ",1),e.isEditing&&!e.isLockedByOther&&(!e.autoSaveEnabled||!e.isLeader)?(h(),D("span",Vae,_(d(a)("msg_auto_save_stopped")),1)):Z("",!0)])):Z("",!0),e.isLockedByOther?Z("",!0):(h(),D(ee,{key:1},[c(L,{class:"save-draft",onClick:I[0]||(I[0]=V=>k("handle"))},{default:f(()=>[T(_(d(a)("save_draft")),1)]),_:1}),c(L,{type:"primary",loading:u.saveLoading,class:"publish-robot",onClick:b},{default:f(()=>[T(_(d(a)("publish_robot")),1)]),_:1},8,["loading"])],64))],64)):Z("",!0),!e.isEditing&&!e.currentVersion||e.isLockedByOther?(h(),G(L,{key:1,disabled:e.isLockedByOther,type:"primary",class:"ml8",onClick:R},{icon:f(()=>[c(d(eo))]),default:f(()=>[T(" "+_(d(a)("btn_edit")),1)]),_:1},8,["disabled"])):Z("",!0),c(q,{title:d(a)("tooltip_history_details")},{default:f(()=>[c(L,{onClick:I[1]||(I[1]=V=>A())},{default:f(()=>[c(d(wi))]),_:1})]),_:1},8,["title"]),m.value?(h(),G(j,{key:2,trigger:"click",placement:"bottomRight",open:v.value,"onUpdate:open":I[5]||(I[5]=V=>v.value=V),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onOnOpenChange:w},{title:f(()=>[s("div",Mae,[c(O,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),s("span",Tae,_(d(a)("title_lock_settings")),1),s("span",jae,_(d(a)("desc_lock_restriction")),1)])]),content:f(()=>[s("div",Pae,[s("span",qae,_(d(a)("label_lock_after_edit")),1),c(M,{value:C.value,"onUpdate:value":I[2]||(I[2]=V=>C.value=V),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),s("span",Hae,_(d(a)("label_minutes_before_edit")),1)]),s("div",Uae,[c(L,{class:"ml8",onClick:I[3]||(I[3]=V=>v.value=!1)},{default:f(()=>[T(_(d(a)("btn_cancel")),1)]),_:1}),c(L,{type:"primary",class:"ml8",loading:g.value,onClick:$},{default:f(()=>[T(_(d(a)("btn_save")),1)]),_:1},8,["loading"])])]),default:f(()=>[c(L,{class:"",onClick:I[4]||(I[4]=V=>v.value=!0),style:{padding:"5px 9px"}},{default:f(()=>[c(O,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):Z("",!0)])):Z("",!0),e.isLockedByOther?(h(),D("div",Jae,[s("div",null,_(d(a)("msg_locked_by_other")),1),s("div",zae,"（"+_(d(a)("label_user")+e.loginUserName||"--")+" "+_(d(a)("label_ip")+e.lockRemoteAddr||"--")+" "+_(d(a)("label_user_agent")+e.lockUserAgent||"--")+"）",1)])):Z("",!0),c(Oae,{ref_key:"runTestRef",ref:y,lf:e.lf,start_node_params:e.start_node_params,onGetGlobal:x,onSave:k,isLockedByOther:e.isLockedByOther},null,8,["lf","start_node_params","isLockedByOther"])],8,Nae)}}},Gae=_e(Kae,[["__scopeId","data-v-b65fa9b6"]]),Wae={class:"form-box"},Zae={class:"form-item"},Yae={class:"form-label"},Qae={class:"form-content"},Xae={class:"version-input-box"},ele={class:"form-item"},tle={class:"form-label"},sle={class:"form-content"},Fa="wf_uni_identifier",ole={__name:"version-model",emits:["ok","handleOpenErrorNode"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.version-model"),l=go().query,i=U(!1);let r="";const u=Pt(),y=U(""),p=U(""),m=U(""),v=U(""),C=U(!1),g=o,$=async x=>{let A=await b();if(A.res==1&&A.data&&A.data.err_node_key){g("handleOpenErrorNode",A.data.err_node_key);return}v.value="",r=x,i.value=!0},w=()=>{try{let x=localStorage.getItem(Fa);return x||(x=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(Fa,x)),x}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},S=()=>{try{const x=navigator.userAgent||"",A=navigator.platform||"";let R="Unknown";/Windows/i.test(x)?R="Windows":/Macintosh|Mac OS X/i.test(x)?R="MacOS":/Linux/i.test(x)?R="Linux":/Android/i.test(x)?R="Android":/iPhone|iPad|iPod/i.test(x)&&(R="iOS");let E="Unknown",B="";const N=x.match(/Edg\/([\d\.]+)/)||x.match(/Chrome\/([\d\.]+)/)||x.match(/Firefox\/([\d\.]+)/)||x.match(/Version\/([\d\.]+).*Safari/);return N&&(x.includes("Edg/")?E="Edge":x.includes("Chrome/")?E="Chrome":x.includes("Firefox/")?E="Firefox":x.includes("Safari")&&!x.includes("Chrome")&&(E="Safari"),B=N[1]),`platform=${A}; os=${R}; browser=${E}/${B}; ua=${x}`}catch{return"ua=unknown"}},k=()=>{C.value=!0,oi({robot_key:l.robot_key,node_list:r,version:`${y.value}.${p.value}.${m.value}`,version_desc:v.value,uni_identifier:w(),user_agent:S(),draft_save_type:"automatic",draft_save_time:+u.robotInfo.draft_save_time||0}).then(async x=>{await u.getRobot(l.id),u.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+u.robotInfo.draft_save_time||0,uni_identifier:w(),user_agent:S()}),i.value=!1,x&&x.res==0&&(Me.success(a("msg_publish_success")),g("ok"))}).catch(x=>{x.data&&x.data.err_node_key&&g("handleOpenErrorNode",x.data.err_node_key),i.value=!1}).finally(()=>{C.value=!1})},b=async()=>Ja({robot_key:l.robot_key}).then(x=>{let A=x.data.version_params||[];return y.value=A[0],p.value=A[1],m.value=A[2],x}).catch(x=>x);return n({show:$}),(x,A)=>{const R=Vt,E=Ts,B=wt;return h(),D("div",null,[c(B,{open:i.value,"onUpdate:open":A[4]||(A[4]=N=>i.value=N),title:d(a)("title_publish"),"ok-text":d(a)("btn_publish_now"),onOk:k,confirmLoading:C.value,width:600},{default:f(()=>[s("div",Wae,[s("div",Zae,[s("div",Yae,_(d(a)("label_version_number")),1),s("div",Qae,[s("div",Xae,[A[5]||(A[5]=T(" v ",-1)),c(R,{value:y.value,"onUpdate:value":A[0]||(A[0]=N=>y.value=N),precision:0,min:0,max:1e3},null,8,["value"]),A[6]||(A[6]=s("span",null,".",-1)),c(R,{value:p.value,"onUpdate:value":A[1]||(A[1]=N=>p.value=N),precision:0,min:0,max:1e3},null,8,["value"]),A[7]||(A[7]=s("span",null,".",-1)),c(R,{value:m.value,"onUpdate:value":A[2]||(A[2]=N=>m.value=N),precision:0,min:0,max:1e3},null,8,["value"])])])]),s("div",ele,[s("div",tle,_(d(a)("label_version_description")),1),s("div",sle,[c(E,{value:v.value,"onUpdate:value":A[3]||(A[3]=N=>v.value=N),placeholder:d(a)("ph_version_desc"),"auto-size":{minRows:4,maxRows:7}},null,8,["value","placeholder"])])])])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},nle=_e(ole,[["__scopeId","data-v-f2415888"]]),ale={class:"version-detail"},lle={class:"version-header"},ile={class:"version-title"},rle={class:"version-desc flex-center"},dle={class:"version-file-box"},ule={class:"version-text"},cle={class:"version-text"},_le=["onClick"],ple={class:"version-header"},fle={class:"version-title"},vle={class:"time-text flex-center"},hle={class:"version-file-box"},mle={class:"version-text"},gle={class:"version-text"},yle={class:"version-desc"},ble={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(e,{expose:n,emit:o}){const{t:a}=fe("views.workflow.publish-detail"),l=go().query,i=U(!1),r=U(""),u=U(""),y=o,p=e,m=Pt(),v=ye(()=>m.robotInfo),C=U([]),g=()=>{i.value=!0,$(),un({robot_key:l.robot_key}).then(b=>{const x=(b==null?void 0:b.data)||{};r.value=x.remote_addr||"",u.value=x.user_agent||""})},$=()=>{ni({robot_key:l.robot_key}).then(b=>{C.value=b.data.versions||[]})},w=b=>{wt.confirm({title:a("msg_confirm_restore_version",{version:b.version}),icon:null,content:Qe("div",{style:"color:red;"},a("msg_restore_warning")),onOk(){Jn({robot_key:l.robot_key,version_id:b.version_id}).then(x=>{y("setVersion",x.data),i.value=!1,x.res==0&&Me.success(a("msg_set_success"))})},onCancel(){}})},S=b=>{b==""?za({robot_key:l.robot_key,data_type:1}).then(x=>{y("preview",x.data,b),i.value=!1}):Jn({robot_key:l.robot_key,version_id:b}).then(x=>{y("preview",x.data,b),i.value=!1})};function k(b,x="YYYY-MM-DD HH:mm:ss"){return b<=0?"--":is(b*1e3).format(x)}return n({showDrawer:g}),(b,x)=>{const A=It,R=no,E=lo,B=ao,N=io,I=$i;return h(),D("div",null,[c(I,{open:i.value,"onUpdate:open":x[2]||(x[2]=L=>i.value=L),title:d(a)("title_publish_detail"),placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:f(()=>[s("div",ale,[v.value.draft_save_time&&v.value.draft_save_time!=0?(h(),D("div",{key:0,class:"version-list",onClick:x[0]||(x[0]=L=>S(""))},[s("div",lle,[s("div",ile,_(d(a)("label_current_draft")),1)]),s("div",rle,[T(_(d(a)("label_saved_at"))+_(k(v.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),s("div",dle,[c(R,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:f(()=>[s("div",ule," IP："+_(r.value||"--"),1),s("div",cle," User Agent："+_(u.value||"--"),1)]),default:f(()=>[c(A,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):Z("",!0),(h(!0),D(ee,null,se(C.value,(L,q)=>(h(),D("div",{class:"version-list",onClick:O=>S(L.version_id),key:L.version},[s("div",ple,[s("div",fle,[T(" v"+_(L.version)+" ",1),s("span",vle,[T(_(k(L.create_time))+" ",1),s("div",hle,[c(R,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:f(()=>[s("div",mle," IP："+_(L.last_edit_ip||"--"),1),s("div",gle," User Agent："+_(L.last_edit_user_agent||"--"),1)]),default:f(()=>[c(A,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),c(N,null,{overlay:f(()=>[c(B,null,{default:f(()=>[c(E,{disabled:p.isLockedByOther,onClick:O=>w(L)},{default:f(()=>[T(_(d(a)("btn_restore_version")),1)]),_:1},8,["disabled","onClick"])]),_:2},1024)]),default:f(()=>[s("div",{class:"hover-btn-box",onClick:x[1]||(x[1]=He(()=>{},["stop"]))},[c(d(Ci))])]),_:2},1024)]),s("div",yle,_(L.version_desc),1)],8,_le))),128))])]),_:1},8,["open","title"])])}}},kle=_e(ble,[["__scopeId","data-v-dde8e7a9"]]),wle={class:"workflow-page"},Cle={class:"page-body"},$le={class:"page-left"},xle={class:"page-container"},Ra="wf_uni_identifier",Sle=300*1e3,La=60*1e3,Dle=20*1e3,Va="wf_autosave_leader_",Ma=120*1e3,Ale={__name:"index",setup(e){const{t:n}=fe("views.workflow.index"),o=sl(),a=go(),l=a.query,i=U(a.query.robot_key),r=()=>{try{let me=localStorage.getItem(Ra);return me||(me=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(Ra,me)),me}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},u=()=>{try{const me=navigator.userAgent||"",Be=navigator.platform||"";let je="Unknown";/Windows/i.test(me)?je="Windows":/Macintosh|Mac OS X/i.test(me)?je="MacOS":/Linux/i.test(me)?je="Linux":/Android/i.test(me)?je="Android":/iPhone|iPad|iPod/i.test(me)&&(je="iOS");let Te="Unknown",Ke="";const We=me.match(/Edg\/([\d\.]+)/)||me.match(/Chrome\/([\d\.]+)/)||me.match(/Firefox\/([\d\.]+)/)||me.match(/Version\/([\d\.]+).*Safari/);return We&&(me.includes("Edg/")?Te="Edge":me.includes("Chrome/")?Te="Chrome":me.includes("Firefox/")?Te="Firefox":me.includes("Safari")&&!me.includes("Chrome")&&(Te="Safari"),Ke=We[1]),`platform=${Be}; os=${je}; browser=${Te}/${Ke}; ua=${me}`}catch{return"ua=unknown"}},y=U(null),p=U(null),m=Co(),v=Pt(),C=ye(()=>{var me;return(me=p.value)==null?void 0:me.lfRef});ye(()=>m.triggerList);const g=U(""),$=U(""),w=U(null),S=ye(()=>v.robotInfo.loop_save_canvas_status);Ie(S,me=>{me>0&&Se("automatic")});const k=sf(),b=U(!0),x=U(!1),A=U(!0);let R=null,E=null,B=Date.now(),N="";const I=U(""),L=U(""),q=U(""),O=U(!1),M=`${Date.now()}_${Math.random()}`;let j=null;const V=()=>`${Va}${i.value}`,z=()=>`wf_open_tabs_${i.value}`;function H(){try{const me=parseInt(localStorage.getItem(z())||"0",10)||0;localStorage.setItem(z(),String(me+1))}catch(me){console.warn("incrementOpenTabs error",me)}}function K(){try{const me=parseInt(localStorage.getItem(z())||"0",10)||0,Be=Math.max(0,me-1);Be<=0?setTimeout(()=>{localStorage.removeItem(z()),localStorage.removeItem(V())},0):localStorage.setItem(z(),String(Be))}catch(me){console.warn("decrementOpenTabs error",me)}}function F(){try{const me=Date.now();for(let Be=0;Be<localStorage.length;Be++){const je=localStorage.key(Be);if(je&&je.startsWith(Va)){const Te=localStorage.getItem(je);let Ke=null;try{Ke=Te?JSON.parse(Te):null}catch{Ke=null}(!Ke||typeof Ke.ts!="number"||me-Ke.ts>La)&&localStorage.removeItem(je)}}}catch(me){console.warn("cleanupExpiredLeaderKeys error",me)}}function Y(){try{const me=localStorage.getItem(V());return me?JSON.parse(me):null}catch{return null}}function le(){localStorage.setItem(V(),JSON.stringify({tabId:M,ts:Date.now()}))}function J(){const me=Y();return!me||Date.now()-me.ts>La?(le(),!0):me.tabId===M}function P(){const me=Y();me&&me.tabId===M&&localStorage.removeItem(V())}function W(me){try{const Be=localStorage.getItem(me),je=Be?JSON.parse(Be):null;je&&je.tabId===M&&localStorage.removeItem(me)}catch{}}function Q(me){me.key===V()&&(yt(),F(),O.value=J())}function X(){document.visibilityState==="visible"&&(O.value=J()),F(),yt()}function de(){Fe(),F(),O.value=J(),j=setInterval(()=>{const me=J();O.value=me,me&&localStorage.setItem(V(),JSON.stringify({tabId:M,ts:Date.now()}))},Dle),window.addEventListener("storage",Q),document.addEventListener("visibilitychange",X),window.addEventListener("beforeunload",()=>{P(),K()}),window.addEventListener("pagehide",()=>{P(),K()})}function Fe(){j&&clearInterval(j),j=null,window.removeEventListener("storage",Q),document.removeEventListener("visibilitychange",X),window.removeEventListener("beforeunload",P)}function De(){try{const me=ke();return JSON.stringify(me)}catch{return""}}function $e(){Ue(),N=De(),B=Date.now(),E=setInterval(()=>{if(!b.value)return;const me=De();me&&me!==N&&(N=me,B=Date.now(),ie())},2*1e3)}function Ue(){E&&clearInterval(E),E=null}function ie(){try{if(!b.value||x.value)return;(!A.value||!J())&&(le(),A.value=!0),yt()}catch{}}function ge(){ve(),R=setInterval(()=>{b.value&&A.value&&Date.now()-B>=Sle&&(A.value=!1,Me.warning(n("msg_auto_save_paused")),yt())},30*1e3)}function ve(){R&&clearInterval(R),R=null}async function he(){try{const me=await un({robot_key:i.value,uni_identifier:r(),user_agent:u()}),Be=(me==null?void 0:me.data)||{};x.value=!Be.lock_res,I.value=Be.remote_addr||"",L.value=Be.user_agent||"",q.value=Be.login_user_name||"",v.setIsLockedByOther(x.value),yt()}catch{x.value=!1,v.setIsLockedByOther(x.value)}}async function Ae(){try{const me=await un({robot_key:i.value,uni_identifier:r(),user_agent:u()}),Be=(me==null?void 0:me.data)||{};return Be.lock_res?(x.value=!1,I.value="",L.value="",q.value="",v.setIsLockedByOther(x.value),!0):(x.value=!Be.lock_res,I.value=Be.remote_addr||"",L.value=Be.user_agent||"",q.value=Be.login_user_name||"",v.setIsLockedByOther(x.value),!1)}catch{return x.value=!1,v.setIsLockedByOther(x.value),!0}}function oe(me){me=me||[];let Be=[],je=[];me.forEach(Te=>{if(Te.node_type==0){let Ke=JSON.parse(Te.node_info_json);Ke.type=="custom-edge"&&(Ke.pointsList=[],Ke.type="custom-bezier-edge"),je.push(Ke)}else{const Ke=k[Te.node_type];Te.type=Ke;let We=JSON.parse(Te.node_info_json);Te.node_type!=0&&(We.type=k[Te.node_type],We.id=Te.node_key||Js(We.type),We.x=We.x||0,We.y=We.y||0),Te.node_type==-1&&(Te.node_params=We.dataRaw),We.nodeSortKey?Te.nodeSortKey=We.nodeSortKey:Te.nodeSortKey=We.id.substring(0,8)+We.id.substring(We.id.length-8),Te.dataRaw=We.dataRaw||Te.node_params,delete Te.node_info_json,We.loop_parent_key=Te.loop_parent_key,We.properties=Te,We.properties.width=We.width,We.properties.height=We.height,Be.push(We)}}),ue({nodes:Be,edges:je})}const ne=me=>{y.value.open(me,!0)},ue=me=>{p.value.setData(me)},ke=()=>{let me=p.value.getData(),Be=[],je={};return me.edges.forEach(Te=>{let Ke={node_key:Te.id,node_name:"edge",node_type:0},We={...Te};Ke.node_info_json=We,Be.push(Ke),Te.sourceAnchorId&&(je[Te.sourceAnchorId]=Te.targetNodeId),Te.targetAnchorId&&(je[Te.targetAnchorId]=Te.sourceNodeId)}),me.nodes.forEach(Te=>{var qt;let Ke={...Te.properties,node_type:+Te.properties.node_type,node_key:Te.id};Ke.node_info_json={type:Te.type,x:Te.x,y:Te.y,width:Te.properties.width,height:Te.properties.height,id:Te.id,nodeSortKey:Ke.nodeSortKey,dataRaw:Te.properties.node_params},Ke.next_node_key=je[Ke.nodeSortKey+"-anchor_right"]||"",Ke.prev_node_key=je[Ke.nodeSortKey+"-anchor_left"]||"";let We=JSON.parse(Ke.node_params);if(Ke.node_type==1,Ke.node_type==2&&We.term&&We.term.length>0&&We.term.forEach((Ot,ls)=>{let Xt=Ke.nodeSortKey+"-anchor_"+ls;Ot.next_node_key=je[Xt]||""}),Ke.node_type==3&&We.cate&&We.cate.categorys&&We.cate.categorys.length>0&&We.cate.categorys.forEach((Ot,ls)=>{let Xt=Ke.nodeSortKey+"-anchor_"+ls;Ot.next_node_key=je[Xt]||""}),Ke.node_type==43&&We.question.answer_type=="menu"&&We.question&&We.question.reply_content_list&&We.question.reply_content_list.length>0&&(((qt=We.question.reply_content_list[0].smart_menu)==null?void 0:qt.menu_content)||[]).forEach((ls,Xt)=>{let uo=Ke.nodeSortKey+"-anchor_"+Xt;ls.next_node_key=je[uo]||""}),Ke.node_type==17){let Ot=je[Ke.nodeSortKey+"-anchor_right_exception"];Ot&&(We.code_run.exception=Ot)}if(Ke.node_type==41){let Ot=je[Ke.nodeSortKey+"-anchor_right_exception"];Ot&&(We.workflow.exception=Ot)}Ke.node_params=We,delete Ke.dataRaw,Be.push(Ke)}),Be},Se=async me=>{if(x.value){me==="handle"&&Me.warning(n("msg_save_locked_by_other"));return}if(!b.value||!A.value&&me==="automatic")return;let Be=ke();if(me==="handle"){const je=+v.robotInfo.draft_save_time||0,Te={robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:je,re_cover_save:0,uni_identifier:r(),user_agent:u()},Ke=await Ft(Te,!1);Ke.saved?Me.success(n("msg_save_success")):Ke.behind;return}try{await Hs({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"automatic",draft_save_time:+v.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:u()}),await v.getRobot(l.id);const je=+v.robotInfo.draft_save_time||is().unix();v.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:je})}catch{}};let Le=null,Je=!1,bt=!1,lt=0;const kt=ye(()=>n("msg_confirm_override_draft"));async function Ft(me,Be){var je,Te;try{const Ke={...me,uni_identifier:r(),user_agent:u()},We=await Hs(Ke);if(!(((je=We==null?void 0:We.data)==null?void 0:je.behind_draft)==1||(We==null?void 0:We.behind_draft)==1)){await v.getRobot(l.id);const Ot=+v.robotInfo.draft_save_time||is().unix();return v.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Ot}),{saved:!0,behind:!1}}if(Be){const Ot=Date.now();if(Je||bt&&Ot-lt<Ma)return A.value=!1,yt(),{saved:!1,behind:!0};Je=!0,bt=!0,lt=Ot}return await new Promise(Ot=>{wt.confirm({title:n("title_prompt"),icon:null,content:kt.value,okText:n("btn_confirm"),cancelText:n("btn_cancel"),async onOk(){var uo;const ls={...me,re_cover_save:1,uni_identifier:r(),user_agent:u()},Xt=await Hs(ls);if(Xt&&Xt.res==0||!((uo=Xt==null?void 0:Xt.data)!=null&&uo.behind_draft)){await v.getRobot(l.id);const Fl=+v.robotInfo.draft_save_time||is().unix();v.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Fl})}Be&&(A.value=!0,yt(),Je=!1,bt=!1,lt=Date.now()),Ot({saved:!0,behind:!0})},onCancel(){Be&&(A.value=!1,yt(),Je=!1,lt=Date.now()),Ot({saved:!1,behind:!0})}})})}catch(Ke){if(!(((Te=Ke==null?void 0:Ke.data)==null?void 0:Te.behind_draft)==1||(Ke==null?void 0:Ke.behind_draft)==1))return{saved:!1,behind:!1};if(Be){const qt=Date.now();if(Je||bt&&qt-lt<Ma)return A.value=!1,yt(),{saved:!1,behind:!0};Je=!0,bt=!0,lt=qt}return await new Promise(qt=>{wt.confirm({title:n("title_prompt"),icon:null,content:kt.value,okText:n("btn_confirm"),cancelText:n("btn_cancel"),async onOk(){var Xt;const Ot={...me,re_cover_save:1,uni_identifier:r(),user_agent:u()},ls=await Hs(Ot);if(ls&&ls.res==0||!((Xt=ls==null?void 0:ls.data)!=null&&Xt.behind_draft)){await v.getRobot(l.id);const uo=+v.robotInfo.draft_save_time||is().unix();v.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:uo})}Be&&(A.value=!0,yt(),Je=!1,bt=!1,lt=Date.now()),qt({saved:!0,behind:!0})},onCancel(){Be&&(A.value=!1,yt(),Je=!1,lt=Date.now()),qt({saved:!1,behind:!0})}})})}}async function Rt(){if(x.value||!b.value||!A.value)return;const me=ke(),Be=+v.robotInfo.draft_save_time||0,je={robot_key:i.value,data_type:1,node_list:JSON.stringify(me),draft_save_type:"automatic",draft_save_time:Be,re_cover_save:0,uni_identifier:r()};await Ft(je,!0)}function yt(){Le&&clearInterval(Le),Le=null,O.value=J(),b.value&&A.value&&!x.value&&J()&&(Le=setInterval(()=>{Rt()},60*1e3))}yn(()=>{Le&&clearInterval(Le),ve(),Ue(),Fe(),P(),K()});const Lt=U(null),At=U(!1),ae=me=>{Lt.value.show(me)},re=async()=>{if(x.value){Me.warning(n("msg_publish_locked_by_other"));return}let me=ke();for(let Be=0;Be<me.length;Be++){let je=me[Be];je.node_type==0||je.node_type==-1||je.node_type==43||je.loop_parent_key||(je.node_type==1?je.next_node_key=="":je.node_type==7||je.node_type==3?je.prev_node_key=="":je.next_node_key==""||je.prev_node_key=="")}try{await Hs({robot_key:i.value,data_type:1,node_list:JSON.stringify(me),draft_save_type:"handle",draft_save_time:+v.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:u()}),await v.getRobot(l.id),v.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+v.robotInfo.draft_save_time||0}),ae(JSON.stringify(me))}catch{At.value=!1}};let ce=U(null);const Ce=me=>{ce.value=me,me.properties.node_sub_type!=51&&ie()},Ve=()=>{ie()},Ee=async()=>Df({model_type:"LLM"}).then(me=>{let Be=me.data||[],{newList:je}=ol(Be);v.setModelList(je)}),ze=U({diy_global:[],sys_global:[]}),Ge=()=>{let Be=ke().filter(je=>je.node_type==1);Be.length>0&&(ze.value=Be[0].node_params.start)},dt=U(null),zt=()=>{A.value=!1,yt(),dt.value.showDrawer()},Bt=me=>{if(x.value){Me.warning(n("msg_restore_locked_by_other"));return}const Be=ke();Hs({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:+v.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:u()}).then(()=>{v.getRobot(l.id).then(()=>{v.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+v.robotInfo.draft_save_time||0})}),g.value="",$.value=null,oe(me),Me.success(n("msg_draft_saved_and_restored")),b.value=!0,A.value=!0,yt()})},ps=async(me,Be)=>{if(!x.value){const je=ke();try{await Hs({robot_key:i.value,data_type:1,node_list:JSON.stringify(je),draft_save_type:"automatic",draft_save_time:+v.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:u()}),await v.getRobot(l.id),v.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+v.robotInfo.draft_save_time||0})}catch{}}$.value=Be,clearInterval(Le),oe(me)},Ss=async()=>{if(x.value){Me.warning(n("msg_save_locked_by_other"));return}if(!b.value)return;let me=ke();await Hs({robot_key:i.value,data_type:1,node_list:JSON.stringify(me),draft_save_type:"automatic",draft_save_time:+v.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:u()}),await v.getRobot(l.id),Ja({robot_key:i.value}).then(Be=>{w.value.openRunTest()}).catch(Be=>{Be.data&&Be.data.err_node_key&&qs(Be.data.err_node_key)})},ks=async()=>{if(x.value){Me.warning(n("msg_edit_locked_by_other"));return}await Ae()&&(b.value=!0,A.value=!0,N=De(),B=Date.now(),$e(),yt(),Me.success(n("msg_enter_edit_mode")),ne(1))},Gt=me=>{me=Array.isArray(me)?me:[];let Be=[],je=[];if(me.forEach(Te=>{Te.node_type==21&&(Te.has_loaded===""||Te.plugin_version!==Te.remote_plugin_version?je.push(Te):Te.has_loaded==="false"&&Be.push(Te))}),Be.length||je.length){let Te=[...new Set([...Be.map(qt=>qt.node_name),...je.map(qt=>qt.node_name)])];const Ke={"font-weight":500,"margin-top":"8px","margin-bottom":"4px"},We={color:"#8c8c8c"};wt.confirm({title:n("title_workflow_fix"),content:Qe("div",{},[Qe("div",{style:Ke},n("msg_plugin_abnormal_prompt")),Qe("div",{style:We},Te.join("、"))]),onOk:async()=>{const qt=[];Be.length&&qt.push(hf({name:Be.map(Ot=>Ot.plugin_name).toString()})),je.length&&qt.push(mf({download_data:JSON.stringify(je.map(Ot=>({url:Ot.latest_version_detail_url,version_id:Ot.latest_version_detail_id})))})),await Promise.all(qt),Me.success(n("msg_operation_reload")),setTimeout(()=>{window.location.reload()},1200)}})}},xt=async()=>{await Ee(),await m.getTriggerList(i.value),m.getTriggerOfficialMsg(i.value),await o.getAllmodelList(),m.getAllLibraryList();const me=await za({robot_key:i.value,data_type:1});oe(me.data),Gt(me.data)};Us("handleAutoSaveDraft",async(me="automatic")=>{await Se(me)});const qs=me=>{p.value.focusOnNode(me)};return Ne(async()=>{H(),await xt(),await he(),x.value?(b.value=!1,A.value=!1,Me.warning(n("msg_switched_to_view_mode"))):await Ae()?(b.value=!0,A.value=!0):(b.value=!1,A.value=!1),de(),yt();let me=V();Ie(()=>a.query.robot_key,Be=>{!Be||Be===i.value||(W(me),K(),i.value=Be,me=V(),H(),de(),yt())}),ge(),$e(),a.query.show_tips&&Me.info(n("msg_canvas_scroll_tips"),6)}),(me,Be)=>(h(),D("div",wle,[c(Gae,{ref_key:"pageHeaderRef",ref:w,onEdit:ks,onSave:Se,onRelease:re,onGetGlobal:Ge,onGetVersionRecord:zt,lf:C.value,currentVersion:$.value,start_node_params:ze.value,saveLoading:At.value,isEditing:b.value,isLockedByOther:x.value,lockRemoteAddr:I.value,lockUserAgent:L.value,loginUserName:q.value,autoSaveEnabled:A.value,isLeader:O.value},null,8,["lf","currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),s("div",Cle,[s("div",$le,[c(Lf)]),s("div",xle,[c(qne,{ref_key:"workflowCanvasRef",ref:p,onSelectedNode:Ce,onOnDeleteNode:Ve,onRunTest:Ss},null,512)])]),c(Sf,{ref_key:"addRobotAlertRef",ref:y},null,512),c(nle,{ref_key:"versionModelRef",ref:Lt,onHandleOpenErrorNode:qs},null,512),c(kle,{ref_key:"publishDetailRef",ref:dt,onPreview:ps,onSetVersion:Bt,isLockedByOther:x.value},null,8,["isLockedByOther"])]))}},Tre=_e(Ale,[["__scopeId","data-v-766d25b7"]]);export{Tre as default};
//# sourceMappingURL=index-DN7n8YRU.js.map
