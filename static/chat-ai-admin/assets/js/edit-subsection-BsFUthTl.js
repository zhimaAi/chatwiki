import{b as we,d as qe,aW as Ce,aX as Le,aY as Me,aZ as Se,aG as De}from"../../index-BZRrEp3V.js";import{f as l,r as J,w as Ie,ab as Ue,Y as d,_ as i,k as n,a2 as v,n as W,A as X,a5 as t,ae as m,a1 as G,a6 as Ae,u as K,a7 as b,F as Q,a9 as Ee,G as h,ad as ze,y as Oe}from"./vue-chunks-Ci-XTWEs.js";import{U as Be}from"./index-Ddg7keXh.js";import{u as Fe}from"./util-BwuffJOK.js";import{C as Ge}from"./index-C70Vlv3T.js";import{M as Ne}from"./index-BMSQkwth.js";import{I as Te,a2 as Ve,bj as je,bk as $e,u as Ke,v as Qe,Q as Pe,Y as Re,Z as Ye,O as He,B as Ze,ax as Je,M as We,a as k}from"./ui-antd-BWf8LxGy.js";const Xe={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},et={class:"custom-modal-header"},tt={key:1},st={key:2},at={class:"form-box-wrapper"},ot={key:0,class:"form-item"},lt={class:"form-content"},nt={key:1,class:"form-item"},it={class:"form-content"},rt={class:"star-item-box"},dt={key:2},ut={class:"form-item"},vt={class:"form-content"},ct={class:"form-item"},_t={class:"form-content"},mt={class:"form-item"},pt={class:"form-content"},ft={key:0,class:"error-tip"},gt={key:3,class:"form-item"},yt={class:"form-content"},bt={key:0,class:"error-tip"},ht={class:"form-item"},kt={class:"form-content"},xt={class:"upload-box-wrapper"},wt={key:0},qt={key:4,class:"form-item"},Ct={class:"form-label-box"},Lt={class:"form-content"},Mt={class:"ai-generate-wrapper"},St={class:"form-box-wrapper ai-generate-wrapper-box"},Dt={class:"ai-generate-wrapper-left"},It={class:"form-box-wrapper-options"},Ut={class:"form-item flex1"},At={class:"form-content"},Et={class:"form-item flex1"},zt={class:"form-content dual-inputs"},Ot={class:"input-group"},Bt={class:"form-label-input-box"},Ft={class:"form-box-wrapper-content"},Gt={class:"problem-box"},Nt={class:"problem-content"},Tt={class:"problem-box"},Vt={class:"problem-content"},jt={class:"form-item generate-btn-box"},$t={class:"result-nav"},Kt={key:0,class:"tip"},Qt={key:1,class:"result-nav-text"},Pt={key:0,class:"container"},Rt={class:"result-container"},Yt=["innerHTML"],Ht={class:"result-footer"},Zt={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(ee,{expose:te,emit:se}){const ae=l(!1),_=l(!1),N=l(!1),q=l(!1),C=l(!1),r=J({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5}),oe=new Ne({html:!0,linkify:!0,typographer:!0}),P=l(""),L=J({finish:"",content:""});Ie(()=>L.content,()=>{P.value=oe.render(L.content)});const M=Ue(),le=M.query,S=M.name,I=ee,T=se,ne=l(""),ie=["azure","ollama","xinference","openaiAgent"],R=l("1"),x=l(!1),U=l(""),g=l(""),p=l(""),y=l(""),f=l(""),w=l([]),D=l(0),A=l(""),E=l("0"),c=l(!1),re=s=>{_.value=!1,N.value=!1,C.value=!1,U.value=s.title||"",g.value=s.content||"",A.value=s.id||"",p.value=s.answer||"",w.value=s.images||[],y.value=s.question||"",f.value=s.similar_questions?s.similar_questions.join(`
`):"",c.value=I.detailsInfo.is_qa_doc=="1",D.value=s.category_id||0,E.value=s.group_id||"0",j(),c&&de(),x.value=!0},Y=l([]),de=()=>{De({library_id:I.detailsInfo.library_id}).then(s=>{Y.value=s.data||[]})},V=l([]),j=()=>{Se({file_id:le.id}).then(s=>{let e=s.data||[];e=e.map(o=>({value:o.id,payload:{...o,color:Xe[o.type]}})),S=="categaryManages"?V.value=[...e]:V.value=[{value:0,payload:{id:0,name:"未标记"}},...e],T("handleStatrList",s.data||[])})},H=()=>{if(Z(),!g.value&&!c.value)return k.error("请输入分段内容");if(!y.value&&c.value)return k.error("请输入分段问题");if(!p.value&&c.value)return k.error("请输入分段答案");if(c.value&&p.value.length>1e4||!c.value&&g.value.length>1e4)return;if(S=="categaryManages"&&D.value<=0)return k.error("请选择分类标记");let s={title:U.value,content:g.value,question:y.value,answer:p.value,images:w.value,category_id:D.value};c.value&&(s.group_id=E.value||0);let e=f.value.trim();e?(e=e.split(`
`),s.similar_questions=JSON.stringify(e)):s.similar_questions="[]",A.value?s.id=A.value:s.file_id=M.query.id;let o=new FormData;for(let u in s)Fe.isArray(s[u])?s[u].forEach($=>{o.append(u,$)}):o.append(u,s[u]);S=="knowledgeDocument"&&(o.delete("file_id"),o.append("library_id",M.query.id)),S=="libraryConfig"&&(o.delete("file_id"),o.append("library_id",I.detailsInfo.library_id)),S=="categaryManages"?(o.delete("file_id"),o.append("library_id",M.query.id),Le(o).then(u=>{k.success(s.id?"修改成功":"添加成功"),x.value=!1,T("handleEdit",{...s}),j()})):Me(o).then(u=>{k.success(s.id?"修改成功":"添加成功"),x.value=!1,T("handleEdit",{...s}),j()})},ue=()=>{_.value=!0},z=l(""),ve=async()=>{L.content="",z.value="",q.value=!0,C.value=!0;try{let s={library_id:I.detailsInfo.library_id,model_config_id:r.model_config_id,use_model:r.use_model,num:r.count,question:y.value,answer:p.value};const e=await Ce(s);z.value=e.data.map(o=>o).join(`
`),L.content=e.data.map((o,u)=>`<div class="dialog-message">${u+1}. ${o}</div>`).join(""),N.value=!0}finally{q.value=!1}},ce=()=>{f.value?f.value+=`
${z.value}`:f.value+=z.value,k.success("保存成功"),N.value=!1,_.value=!1,C.value=!1},_e=s=>{r.use_model=ie.includes(s.rawData.model_define)&&s.rawData.deployment_name?s.rawData.deployment_name:s.rawData.name,r.use_model_icon=s.icon,r.use_model_name=s.use_model_name,r.model_config_id=s.rawData.id,ne.value=s.rawData.model_define},O=l([]),me=s=>{O.value=s,Oe(()=>{(!r.ai_chunk_model||!Number(r.ai_chunk_model_config_id))&&pe()})},pe=()=>{if(O.value.length>0){let s=null,e=null;for(let o of O.value)if(o.model_define==="tongyi"){s=o;for(let u of s.children)if(u.name==="qwen-max"){e=u;break}break}s||(s=O.value[0],e=s.children[0]),s&&e&&(r.use_model=e.name,r.model_config_id=e.model_config_id,r.ai_chunk_model=e.name,r.ai_chunk_model_config_id=e.model_config_id)}};function fe(s){return s.split(`
`).map(e=>e.trim()).filter(e=>e).join(`
`)}const Z=()=>{f.value=fe(f.value)};return te({showModal:re}),(s,e)=>{const o=Ze,u=Te,$=Ve,ge=Qe,ye=Ke,B=Pe,F=qe,be=Ye,he=Re,ke=He,xe=We;return i(),d("div",null,[n(xe,{open:x.value,"onUpdate:open":e[13]||(e[13]=a=>x.value=a),onOk:H,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:_.value?C.value?"944px":"472px":"746px","ok-button-props":{style:{display:_.value?"none":"block"}}},{title:v(()=>[t("div",et,[_.value?(i(),G(o,{key:0,type:"text",class:"back-button",onClick:e[0]||(e[0]=a=>_.value=!1)},{icon:v(()=>[n(K(Je),{style:{"font-size":"12px"}})]),_:1})):m("",!0),_.value?(i(),d("span",tt,"AI生成相似问法")):(i(),d("span",st,b(A.value?"编辑分段":"新增分段"),1))])]),footer:v(()=>[_.value?m("",!0):(i(),d(Q,{key:0},[n(o,{onClick:e[12]||(e[12]=a=>x.value=!1)},{default:v(()=>e[32]||(e[32]=[h("取消")])),_:1,__:[32]}),n(o,{type:"primary",onClick:H},{default:v(()=>e[33]||(e[33]=[h("确定")])),_:1,__:[33]})],64))]),default:v(()=>[W(t("div",at,[c.value?m("",!0):(i(),d("div",ot,[e[14]||(e[14]=t("div",{class:"form-label"},"分段标题：",-1)),t("div",lt,[n(u,{maxLength:25,value:U.value,"onUpdate:value":e[1]||(e[1]=a=>U.value=a),placeholder:"请输入分段标题"},null,8,["value"])])])),c.value?m("",!0):(i(),d("div",nt,[e[15]||(e[15]=t("div",{class:"form-label"},"分段分类标记",-1)),t("div",it,[n($,{value:D.value,"onUpdate:value":e[2]||(e[2]=a=>D.value=a),options:V.value},{label:v(({payload:a})=>[t("div",rt,[a.id>0?(i(),G(K(je),{key:0,style:Ae({color:a.color})},null,8,["style"])):(i(),G(K($e),{key:1})),t("div",null,b(a.name||"-"),1),a.data_count>0?(i(),d("span",dt,"("+b(a.data_count)+")",1)):m("",!0)])]),_:1},8,["value","options"])])])),c.value?(i(),d(Q,{key:2},[t("div",ut,[e[16]||(e[16]=t("div",{class:"form-label required"},"所属分组：",-1)),t("div",vt,[n(ye,{value:E.value,"onUpdate:value":e[3]||(e[3]=a=>E.value=a),style:{width:"100%"}},{default:v(()=>[(i(!0),d(Q,null,Ee(Y.value,a=>(i(),G(ge,{value:a.id},{default:v(()=>[h(b(a.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),t("div",ct,[e[17]||(e[17]=t("div",{class:"form-label required"},"分段问题：",-1)),t("div",_t,[n(B,{placeholder:"请输入分段问题",value:y.value,"onUpdate:value":e[4]||(e[4]=a=>y.value=a),style:{height:"100px"}},null,8,["value"])])]),t("div",mt,[e[18]||(e[18]=t("div",{class:"form-label required"},"分段答案：",-1)),t("div",pt,[n(B,{placeholder:"请输入分段答案",value:p.value,"onUpdate:value":e[5]||(e[5]=a=>p.value=a),style:{height:"100px"}},null,8,["value"]),p.value.length>1e4?(i(),d("div",ft,"分段答案最多支持10000个字符")):m("",!0)])])],64)):(i(),d("div",gt,[e[19]||(e[19]=t("div",{class:"form-label required"},"分段内容：",-1)),t("div",yt,[n(B,{style:{height:"150px"},value:g.value,"onUpdate:value":e[6]||(e[6]=a=>g.value=a),placeholder:"请输入分段内容"},null,8,["value"]),g.value.length>1e4?(i(),d("div",bt,"分段内容最多支持10000个字符")):m("",!0)])])),t("div",ht,[t("div",kt,[t("div",xt,[n(he,{activeKey:R.value,"onUpdate:activeKey":e[7]||(e[7]=a=>R.value=a),size:"small"},{default:v(()=>[n(be,{key:"1"},{tab:v(()=>[t("span",null,[n(F,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),e[20]||(e[20]=h(" 答案附图 ")),w.value.length?(i(),d("span",wt,"("+b(w.value.length)+")",1)):m("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Be,{value:w.value,"onUpdate:value":e[8]||(e[8]=a=>w.value=a)},null,8,["value"])])])]),c.value?(i(),d("div",qt,[t("div",Ct,[e[22]||(e[22]=t("div",{class:"form-label"},"相似问法",-1)),t("div",{class:"ai-generate",onClick:ue},[n(F,{name:"ai-generate",style:{"font-size":"14px"}}),e[21]||(e[21]=t("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),t("div",Lt,[n(B,{placeholder:"请输入相似问法",value:f.value,"onUpdate:value":e[9]||(e[9]=a=>f.value=a),style:{height:"100px"},onBlur:Z},null,8,["value"]),e[23]||(e[23]=t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])])):m("",!0)],512),[[X,!_.value]]),W(t("div",Mt,[t("div",St,[t("div",Dt,[t("div",It,[t("div",Ut,[e[24]||(e[24]=t("div",{class:"form-label required"},"相似问法模型：",-1)),t("div",At,[n(Ge,{modelValue:r.use_model,"onUpdate:modelValue":e[10]||(e[10]=a=>r.use_model=a),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":r.model_config_id,onChange:_e,onLoaded:me},null,8,["modelValue","model-config-id"])])]),t("div",Et,[t("div",zt,[t("div",Ot,[e[26]||(e[26]=t("div",{class:"form-label required"},"问题个数：",-1)),t("div",Bt,[n(ke,{value:r.count,"onUpdate:value":e[11]||(e[11]=a=>r.count=a),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),e[25]||(e[25]=h("个 "))])])])])]),t("div",Ft,[t("div",Gt,[e[27]||(e[27]=t("div",{class:"problem"},"问题",-1)),t("div",Nt,b(y.value),1)]),t("div",Tt,[e[28]||(e[28]=t("div",{class:"problem"},"答案",-1)),t("div",Vt,b(p.value),1)])]),t("div",jt,[n(o,{onClick:ve,loading:q.value,class:"generate-btn"},{default:v(()=>[n(F,{name:"ai-generate-white",style:{"font-size":"16px"}}),e[29]||(e[29]=h(" 开始生成 "))]),_:1,__:[29]},8,["loading"])])]),t("div",{class:ze(["ai-generate-wrapper-right",{"show-result":C.value}])},[t("div",$t,[n(F,{name:"generate-icon",style:{"font-size":"14px"}}),q.value?(i(),d("span",Kt,"相似问法生成中...")):(i(),d("div",Qt,"相似问法生成完毕"))]),!L.content&&q.value&&!ae.value?(i(),d("div",Pt,e[30]||(e[30]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)]))):m("",!0),t("div",Rt,[t("div",{class:"dialog-content",innerHTML:P.value},null,8,Yt)]),t("div",Ht,[n(o,{class:"result-footer-btn",type:"primary",onClick:ce},{default:v(()=>e[31]||(e[31]=[h("保存相似问法")])),_:1,__:[31]})])],2)])],512),[[X,_.value]])]),_:1},8,["open","width","ok-button-props"])])}}},os=we(Zt,[["__scopeId","data-v-aaaff20f"]]);export{os as E,Xe as c};
