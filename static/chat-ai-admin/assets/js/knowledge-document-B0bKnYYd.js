import{_ as no}from"./cu-scroll-C_QJcxx1.js";import{_ as ke,az as zo,aA as lo,aB as ao,aC as Eo,aD as He,aE as No,d as qt,aF as Ao,aj as Ot,aG as io,aH as Ho,aI as Po,aJ as Bo,aK as Ko,c as It,aL as Pe,aM as Wo,aN as Vo,a4 as Qo,aO as jo,aP as Yo,ay as Xt,a as Jo,aQ as Xo,au as Zo,aR as es,am as ts,aS as os,aT as ss,aU as ns,aV as ls,aW as as}from"../../index-C5-B0r5-.js";import{r as le,q as uo,ac as a,ad as n,k as t,ar as s,as as e,n as rt,ae as F,az as v,u as q,at as h,F as H,ax as de,G as m,B as ie,av as Rt,aw as We,f as c,e as me,o as St,ah as ro,ai as fe,af as is,J as Lt,b as us,A as Zt}from"./vue-chunks-CGLjTDrY.js";import{E as ds,v as Ut,a9 as rs,ae as ct,bz as _s,bA as cs,af as ps,bB as fs,G as _o,b as M,M as ue,W as Be,o as co,T as Dt,y as Ve,z as Qe,D as vs,av as ms,I as Ue,a6 as Fe,a0 as Ae,k as po,ar as _t,h as fo,i as vo,B as Mt,bC as ys,aT as gs,F as Ke,e as pt,w as mo,x as yo,V as hs,aQ as go,bn as ks,bD as bs,Q as ws,aM as xs,a5 as Cs,bu as $s,al as Ss,ai as bt,aR as it,bE as wt,bF as Ls,aN as qs,az as Os,ab as Is,$ as Rs,d as xt}from"./ui-antd-B11sc9DP.js";import{E as Us}from"./edit-subsection-xJH9lVnk.js";import{U as ho}from"./upload-input-CkC8DyfI.js";import{t as eo}from"./validate-8MtiUsxW.js";import{M as to}from"./model-select-DkFuDwQt.js";import{O as Ds}from"./open-grapg-modal-qLf0LgXk.js";import{R as Ms}from"./rename-modal-DrrHe3kB.js";import{_ as Ts}from"./page-alert-NlbsKG4S.js";import{d as Fs}from"./vuedraggable.umd-u2TvJqwU.js";const Gs={class:"subsection-box"},zs=["onDblclick"],Es={class:"list-item"},Ns={class:"list-content"},As={class:"status-error"},Hs=["onClick","innerHTML"],Ps={class:"similar-question-list"},Bs={class:"list-item list-item-answer"},Ks=["innerHTML"],Ws={class:"fragment-img"},Vs=["src"],Qs={class:"right-opration"},js=["onClick"],Ys=["onClick"],Js=["onClick"],Xs=["onClick"],Zs={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(J,{expose:K,emit:te}){const G=te,b=J,W=le({selectedRowKeys:[]}),L=_=>{W.selectedRowKeys=_},z=()=>{W.selectedRowKeys=[]},x=_=>{G("openEditSubscription",_)},k=_=>{ue.confirm({title:"提示",icon:t(Be),content:"确认是否删除该问答?",onOk(){return new Promise((I,j)=>{lo({id:_}).then(U=>{M.success("删除成功"),G("handleDelParagraph",_),I()}).catch(()=>{I()})})},onCancel(){}})},R=(_,I)=>{zo({id:_.id,category_id:I}).then(j=>{M.success("设置成功"),G("getList")})},C=(_,I,j)=>{let U=j.field,D=j.order;D?D=D==="ascend"?"asc":"desc":U="",G("handleSort",{sort_field:U,sort_type:D})};function d(_,I,j={}){if(!I||!_)return _;const{highlightClass:U="highlight",caseSensitive:D=!1,wholeWord:Y=!1}=j,T=D?"g":"gi";let g;return Y?g=new RegExp(`\\b${P(I)}\\b`,T):g=new RegExp(P(I),T),_.replace(g,i=>`<span class="${U}">${i}</span>`)}function P(_){return _.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return K({handleOpenEditModal:x,state:W,resetSelect:z}),(_,I)=>{const j=Ut,U=ct,D=ds,Y=_o,T=uo("viewer");return n(),a("div",Gs,[t(Y,{"data-source":J.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:W.selectedRowKeys,onChange:L},pagination:!1,loading:b.isLoading,onChange:C},{default:s(()=>[t(D,{key:"id","data-index":"id",width:1148},{title:s(()=>[m("问答（共"+h(b.total)+"个）",1)]),default:s(({record:g})=>[e("div",{class:"qa-list-box",onDblclick:i=>x(g)},[e("div",Es,[I[0]||(I[0]=e("div",{class:"list-label"},"问题",-1)),e("div",Ns,[g.status==2?(n(),F(j,{key:0,placement:"top"},{title:s(()=>[e("span",null,h(g.errmsg),1)]),default:s(()=>[e("span",null,[e("span",As,[t(q(rs))])])]),_:2},1024)):v("",!0),e("span",{onClick:i=>x(g),innerHTML:d(g.question,b.search),class:"question-text"},null,8,Hs),g.similar_questions&&g.similar_questions.length?(n(),F(U,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[e("div",Ps,[(n(!0),a(H,null,de(g.similar_questions,(i,r)=>(n(),a("div",{class:"similar-question-list-item",key:r},h(i),1))),128))])]),title:s(()=>[e("span",null,"共 "+h(g.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[e("a",null,"（"+h(g.similar_questions.length)+"）",1)]),_:2},1024)):v("",!0)])]),e("div",Bs,[I[1]||(I[1]=e("div",{class:"list-label"},"答案",-1)),e("div",{class:"list-content",innerHTML:d(g.answer,b.search)},null,8,Ks)]),rt((n(),a("div",Ws,[(n(!0),a(H,null,de(g.images,(i,r)=>(n(),a("img",{key:r,src:i,alt:""},null,8,Vs))),128))])),[[T]])],40,zs)]),_:1}),t(D,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),t(D,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),t(D,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),t(D,{title:"操作",key:"action","data-index":"action",width:120},{default:s(({record:g,index:i})=>[e("div",Qs,[g.category_id>0?(n(),a("div",{key:0,class:"hover-btn-box",onClick:r=>R(g,0)},[t(q(_s),{style:{color:"#F59A23"}})],8,js)):(n(),a("div",{key:1,class:"hover-btn-box",onClick:r=>R(g,4)},[t(q(cs))],8,Ys)),e("div",{class:"hover-btn-box",onClick:ie(r=>x(g),["stop"])},[t(q(ps))],8,Js),e("div",{class:"hover-btn-box",onClick:ie(r=>k(g.id),["stop"])},[t(q(fs))],8,Xs)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},en=ke(Zs,[["__scopeId","data-v-f54edaa7"]]),tn={class:"alert-box"},on={class:"upload-file-box"},sn={key:0,class:"hight-set"},nn={key:0,class:"set-box"},ln={class:"form-item"},an={class:"form-item-body"},un={class:"form-item"},dn={class:"form-item-body"},rn={class:"form-item"},_n={class:"form-item-body"},cn={key:1,class:"set-box"},pn={class:"form-item"},fn={class:"form-item-body"},vn={class:"form-item"},mn={class:"form-item-body"},yn={class:"form-item"},gn={class:"form-item-body"},hn={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(J,{expose:K,emit:te}){const G=ao(),{qa_index_type:b}=G;Rt();const L=We().query,z=c(!1),x=c(!1),k=c([]),R=te,C=c([]),d=J,P=me(()=>d.library_id||L.id),_=le({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),I=c(!0),j=i=>{_.group_id=void 0,i>=0&&(_.group_id=i),z.value=!0},U=()=>{let i=new FormData;k.value.forEach(r=>{i.append("library_files",r)}),Eo(i).then(r=>{let N=[];for(let $ in r.data)N.push({lable:r.data[$],value:$});C.value=N})},D=()=>{if(k.value.length==0){M.error("请选择文件");return}x.value=!0;let i=new FormData;i.append("library_id",P.value);let r=!1;if(k.value.forEach(N=>{(N.name.includes(".xlsx")||N.name.includes(".csv"))&&(r=!0),i.append("library_files",N)}),r){if(!_.question_column)return x.value=!1,M.error("请选择问题所在列");if(!_.answer_column)return x.value=!1,M.error("请选择答案所在列");i.append("question_column",_.question_column),i.append("answer_column",_.answer_column),_.similar_column&&i.append("similar_column",_.similar_column)}else i.append("question_lable",_.question_lable),i.append("answer_lable",_.answer_lable),i.append("similar_label",_.similar_label);i.append("group_id",_.group_id>=0?_.group_id:0),i.append("is_qa_doc",1),i.append("qa_index_type",b),He(i).then(N=>{R("ok"),z.value=!1,k.value=[],x.value=!1}).catch(()=>{x.value=!1})},Y=()=>{k.value=[]},T=c(1),g=i=>{_.question_column=void 0,_.answer_column=void 0,_.similar_column=void 0,_.question_lable="问题：",_.answer_lable="答案：",_.similar_label="相似问法：",k.value=i,i&&i.length>0&&(i[0].type.includes(".document")?T.value=2:(T.value=1,U()))};return K({show:j}),(i,r)=>{const N=co,$=Qe,A=Ve,se=Dt,E=Ue,ce=ue;return n(),a("div",null,[t(ce,{width:680,open:z.value,"onUpdate:open":r[9]||(r[9]=S=>z.value=S),"confirm-loading":x.value,maskClosable:!1,title:"上传文档",onOk:D,onCancel:Y},{default:s(()=>[e("div",tn,[t(N,{"show-icon":""},{message:s(()=>[...r[10]||(r[10]=[e("div",null,[m(" 通过word或者Excel形式导入问答，建议您参考"),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),m("  "),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),m("创建导入文档 ")],-1),e("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),e("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])]),_:1})]),t(se,{align:"center",style:{margin:"16px 0"}},{default:s(()=>[r[11]||(r[11]=e("div",null,"所属分组：",-1)),t(A,{value:_.group_id,"onUpdate:value":r[0]||(r[0]=S=>_.group_id=S),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),a(H,null,de(d.groupLists.filter(S=>S.id>=0),S=>(n(),F($,{value:S.id},{default:s(()=>[m(h(S.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),e("div",on,[t(ho,{type:2,value:k.value,"onUpdate:value":r[1]||(r[1]=S=>k.value=S),onChange:g},null,8,["value"])]),k.value.length>0?(n(),a("div",sn,[e("a",{onClick:r[2]||(r[2]=S=>I.value=!I.value)},[r[12]||(r[12]=m("高级设置： ",-1)),I.value?(n(),F(q(ms),{key:1})):(n(),F(q(vs),{key:0}))]),I.value?(n(),a(H,{key:0},[T.value==1?(n(),a("div",nn,[e("div",ln,[r[13]||(r[13]=e("div",{class:"form-item-label required"},"问题所在列：",-1)),e("div",an,[t(A,{value:_.question_column,"onUpdate:value":r[3]||(r[3]=S=>_.question_column=S),placeholder:"请选择列名",style:{width:"100%"}},{default:s(()=>[(n(!0),a(H,null,de(C.value,S=>(n(),F($,{value:S.value,key:S.value},{default:s(()=>[m(h(S.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",un,[r[14]||(r[14]=e("div",{class:"form-item-label"},"相似问法所在列：",-1)),e("div",dn,[t(A,{value:_.similar_column,"onUpdate:value":r[4]||(r[4]=S=>_.similar_column=S),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),a(H,null,de(C.value,S=>(n(),F($,{value:S.value,key:S.value},{default:s(()=>[m(h(S.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",rn,[r[15]||(r[15]=e("div",{class:"form-item-label required"},"答案所在列：",-1)),e("div",_n,[t(A,{value:_.answer_column,"onUpdate:value":r[5]||(r[5]=S=>_.answer_column=S),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),a(H,null,de(C.value,S=>(n(),F($,{value:S.value,key:S.value},{default:s(()=>[m(h(S.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):v("",!0),T.value==2?(n(),a("div",cn,[e("div",pn,[r[16]||(r[16]=e("div",{class:"form-item-label"},"问题开始标识符：",-1)),e("div",fn,[t(E,{placeholder:"请输入标识符",value:_.question_lable,"onUpdate:value":r[6]||(r[6]=S=>_.question_lable=S)},null,8,["value"])])]),e("div",vn,[r[17]||(r[17]=e("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),e("div",mn,[t(E,{placeholder:"请输入标识符",value:_.similar_label,"onUpdate:value":r[7]||(r[7]=S=>_.similar_label=S)},null,8,["value"])])]),e("div",yn,[r[18]||(r[18]=e("div",{class:"form-item-label"},"答案开始标识符：",-1)),e("div",gn,[t(E,{placeholder:"请输入标识符",value:_.answer_lable,"onUpdate:value":r[8]||(r[8]=S=>_.answer_lable=S)},null,8,["value"])])])])):v("",!0)],64)):v("",!0)])):v("",!0)]),_:1},8,["open","confirm-loading"])])}}},ko=ke(hn,[["__scopeId","data-v-f60dc02a"]]),kn={class:"form-item"},bn={class:"form-content"},wn={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(J,{expose:K,emit:te}){const G=We().query,b=c(!1),W=te,L=c("新建分组"),z=J,x=le({group_name:"",id:"",library_id:G.id}),k=C=>{x.group_name=C.group_name||"",x.id=C.id||"",L.value=C.id?"编辑分组":"新建分组",x.library_id=C.library_id,b.value=!0},R=()=>{if(!x.group_name)return M.error("请输入分组名称");No({...x,group_type:z.group_type}).then(C=>{M.success(`${L.value}成功`),b.value=!1,W("ok")})};return K({show:k}),(C,d)=>{const P=Ue,_=ue;return n(),a("div",null,[t(_,{open:b.value,"onUpdate:open":d[1]||(d[1]=I=>b.value=I),title:L.value,onOk:R},{default:s(()=>[e("div",kn,[d[2]||(d[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",bn,[t(P,{maxLength:15,value:x.group_name,"onUpdate:value":d[0]||(d[0]=I=>x.group_name=I),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},bo=ke(wn,[["__scopeId","data-v-239b5ad3"]]),xn={class:"qa-list-wrapper"},Cn={class:"group-head-box"},$n={class:"head-title"},Sn={class:"flex-between-box"},Ln={class:"search-box"},qn={class:"classify-box"},On=["onClick"],In={class:"classify-title"},Rn={class:"right-content"},Un={key:0,class:"btn-box"},Dn={class:"hover-btn-wrap"},Mn=["onClick"],Tn=["onClick"],Fn={class:"main-content-box"},Gn={class:"head-content"},zn={class:"title"},En={class:"pover-group-content-box"},Nn={class:"group-head-box"},An={class:"head-title"},Hn={class:"flex-between-box"},Pn={class:"search-box"},Bn={class:"classify-box classify-scroll-box"},Kn=["onClick"],Wn={class:"classify-title"},Vn={class:"right-content"},Qn={key:0,class:"btn-box"},jn={class:"hover-btn-wrap"},Yn=["onClick"],Jn=["onClick"],Xn={class:"btn-right-box"},Zn={class:"des-content-block"},el={key:0,class:"alert-icon-box"},tl={class:"content-block"},ol={class:"pagination-box"},oo="qa_document_group_box_width",ut=180,Ct=256,sl={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(J){const K=c(null),G=We().query,b=c(""),W=c([]),L=c(-1),z=me(()=>W.value.find(O=>O.id==L.value)||{}),x=me(()=>W.value.filter(O=>O.group_name.includes(b.value))),k=J,R=me(()=>k.library_id||G.id),C=c([]),d=c(localStorage.getItem("qa_document_group_hide_key")==1),P=c(0),_=c(0),I={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},j=c({is_qa_doc:"1",library_id:R.value}),U=c({page:1,size:100}),D=le({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:R.value,search:""}),Y=O=>{D.sort_field=O.sort_field,D.sort_type=O.sort_type,T()},T=()=>{U.value.page=1,se()},g=(O,p)=>{U.value.page=O,U.value.size=p,se()},i=()=>{d.value=!d.value,localStorage.setItem("qa_document_group_hide_key",d.value?1:2)},r=()=>{Po({id:R.value}).then(()=>{M.success("操作完成"),se()})},N=c(null),$=O=>{O.group_id||L.value>=0&&(O.group_id=L.value),N.value.showModal(JSON.parse(JSON.stringify(O)))},A=c(!1),se=()=>{A.value=!0,Ao({...U.value,...D,group_id:L.value}).then(O=>{A.value=!1;let p=O.data,ve=p.list||[];ve.forEach(_e=>{_e.status_text=I[_e.status],_e.similar_questions&&(_e.similar_questions=JSON.parse(_e.similar_questions))}),C.value=ve,P.value=p.total,_.value=p.exception_total,K.value&&K.value.resetSelect()})};se();const E=()=>{Ot({library_id:R.value}).then(O=>{let ve=(O.data||[]).reduce((_e,Q)=>_e+ +Q.total,0);W.value=[{group_name:"全部分组",id:-1,total:ve},...O.data]})};E();const ce=c(null),S=O=>{ce.value.show({...O,library_id:R.value})},re=()=>{E(),se()},De=O=>{L.value=O.id,T()},ee=O=>{ue.confirm({title:`确认删除分组${O.group_name}`,icon:t(Be),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){io({id:O.id}).then(()=>{M.success("删除成功"),E(),L.value==O.id&&(L.value=-1,T())})}})},ye=c(null),be=()=>{ye.value.show(L.value)},V=c(!1),we=le({group_id:void 0,ids:""}),Se=()=>{if(K.value.state.selectedRowKeys.length==0)return M.error("请选择你要移动的问答");we.ids=K.value.state.selectedRowKeys.join(","),we.group_id=void 0,V.value=!0},je=()=>{if(K.value.state.selectedRowKeys.length==0)return M.error("请选择你要删除的问答");ue.confirm({title:"提示",icon:t(Be),content:"确认是否删除所选问答?",onOk(){lo({id:K.value.state.selectedRowKeys.join(",")}).then(O=>{M.success("删除成功"),se()})},onCancel(){}})},ft=()=>{if(!we.group_id)return M.error("请选择分组");Ko({...we}).then(()=>{V.value=!1,M.success("移动成功"),re()})},Le=c(ut),pe=c(!1);St(()=>{const O=parseInt(localStorage.getItem(oo));O&&O>=ut&&O<=Ct&&(Le.value=O)});let qe=!1,Ye=0,ge=0;const ae=O=>{d.value||(qe=!0,pe.value=!0,Ye=O.clientX,ge=Le.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",xe),document.addEventListener("mouseup",Je))},xe=O=>{if(!qe)return;let p=ge+(O.clientX-Ye);p=Math.max(ut,Math.min(Ct,p)),Le.value=p},Je=()=>{qe&&(qe=!1,pe.value=!1,localStorage.setItem(oo,Le.value),document.body.style.cursor="",document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",Je))},Oe=c(!1),vt=()=>{let O="";K.value.state.selectedRowKeys.length>0&&(O=K.value.state.selectedRowKeys.join(",")),Ho({library_id:G.id,export_type:2,group_id:L.value,data_ids:O}).then(p=>{Oe.value=!0})},B=()=>{Bo.push({path:"/library/details/export-record",query:G})};return(O,p)=>{const ve=qt,_e=Ut,Q=Ue,Ie=vo,Ge=fo,Xe=po,Ze=no,mt=ct,he=Mt,et=ys,yt=Qe,gt=Ve,tt=Dt,ot=ue,ht=gs;return n(),a(H,null,[e("div",xn,[e("div",{class:fe(["group-content-box",[{collapsed:d.value},{"no-transition":pe.value}]]),style:ro(d.value?{}:{width:Le.value+"px",minWidth:ut+"px",maxWidth:Ct+"px"})},[e("div",Cn,[e("div",$n,[t(_e,{title:"收起问答分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:i},[t(ve,{name:"put-away"})])]),_:1}),e("div",Sn,[p[16]||(p[16]=e("div",null,"问答分组",-1)),t(_e,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:p[0]||(p[0]=w=>S({}))},[t(q(Fe))])]),_:1})])]),e("div",Ln,[t(Q,{value:b.value,"onUpdate:value":p[2]||(p[2]=w=>b.value=w),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t(q(Ae),{onClick:p[1]||(p[1]=ie(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",qn,[t(Ze,{style:{"padding-right":"24px"}},{default:s(()=>[(n(!0),a(H,null,de(x.value,w=>(n(),a("div",{class:fe(["classify-item",{active:w.id==L.value}]),onClick:Re=>De(w),key:w.id},[e("div",In,h(w.group_name),1),e("div",Rn,[e("div",{class:fe(["num",{"num-block":w.id<=0}])},h(w.total),3),w.id>0?(n(),a("div",Un,[t(Xe,{placement:"bottomRight"},{overlay:s(()=>[t(Ge,null,{default:s(()=>[t(Ie,null,{default:s(()=>[e("div",{onClick:ie(Re=>S(w),["stop"])},"重命名",8,Mn)]),_:2},1024),t(Ie,null,{default:s(()=>[e("div",{onClick:ie(Re=>ee(w),["stop"])},"删 除",8,Tn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",Dn,[t(q(_t))])]),_:2},1024)])):v("",!0)])],10,On))),128))]),_:1})]),d.value?v("",!0):(n(),a("div",{key:0,class:"resize-bar",onMousedown:ae},null,32))],6),e("div",Fn,[t(Ze,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[e("div",Gn,[e("div",zn,[d.value?(n(),F(mt,{key:0,title:null,placement:"bottom"},{content:s(()=>[e("div",En,[e("div",Nn,[e("div",An,[e("div",Hn,[p[17]||(p[17]=e("div",null,"问答分组",-1)),t(_e,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:p[3]||(p[3]=w=>S({}))},[t(q(Fe))])]),_:1})])]),e("div",Pn,[t(Q,{allowClear:"",value:b.value,"onUpdate:value":p[5]||(p[5]=w=>b.value=w),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t(q(Ae),{onClick:p[4]||(p[4]=ie(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",Bn,[(n(!0),a(H,null,de(x.value,w=>(n(),a("div",{class:fe(["classify-item",{active:w.id==L.value}]),onClick:Re=>De(w),key:w.id},[e("div",Wn,h(w.group_name),1),e("div",Vn,[e("div",{class:fe(["num",{"num-block":w.id<=0}])},h(w.total),3),w.id>0?(n(),a("div",Qn,[t(Xe,{placement:"bottomRight"},{overlay:s(()=>[t(Ge,null,{default:s(()=>[t(Ie,null,{default:s(()=>[e("div",{onClick:ie(Re=>S(w),["stop"])},"重命名",8,Yn)]),_:2},1024),t(Ie,null,{default:s(()=>[e("div",{onClick:ie(Re=>ee(w),["stop"])},"删 除",8,Jn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",jn,[t(q(_t))])]),_:2},1024)])):v("",!0)])],10,Kn))),128))])])]),default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:i},[t(ve,{name:"expand"})])]),_:1})):v("",!0),e("div",null,h(z.value.group_name),1),e("div",Xn,[e("div",null,[t(Q,{onChange:T,value:D.search,"onUpdate:value":p[6]||(p[6]=w=>D.search=w),placeholder:"搜索问答"},{suffix:s(()=>[t(q(Ae))]),_:1},8,["value"])]),t(he,{onClick:je},{default:s(()=>[...p[18]||(p[18]=[m("批量删除",-1)])]),_:1}),t(he,{onClick:Se},{default:s(()=>[...p[19]||(p[19]=[m("批量移动",-1)])]),_:1}),t(he,{onClick:p[7]||(p[7]=w=>be())},{default:s(()=>[...p[20]||(p[20]=[m("批量导入",-1)])]),_:1}),t(he,{onClick:p[8]||(p[8]=w=>vt())},{default:s(()=>[...p[21]||(p[21]=[m("批量导出",-1)])]),_:1}),t(he,{onClick:p[9]||(p[9]=w=>$({})),type:"primary",icon:t(q(Fe))},{default:s(()=>[...p[22]||(p[22]=[m("问答",-1)])]),_:1},8,["icon"])])]),e("div",Zn,[_.value>0?(n(),a("div",el,[t(ve,{name:"alert-icon"}),e("div",null,h(_.value)+"个问答学习失败",1),e("a",{onClick:r},"重新学习")])):v("",!0)])]),e("div",tl,[t(en,{ref_key:"subsectionBoxRef",ref:K,total:P.value,isLoading:A.value,paragraphLists:C.value,search:D.search,onOpenEditSubscription:$,onHandleDelParagraph:re,onGetList:se,onHandleSort:Y},null,8,["total","isLoading","paragraphLists","search"]),e("div",ol,[t(et,{current:U.value.page,"onUpdate:current":p[10]||(p[10]=w=>U.value.page=w),"page-size":U.value.size,"onUpdate:pageSize":p[11]||(p[11]=w=>U.value.size=w),total:P.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:g},null,8,["current","page-size","total"])])])]),_:1})])]),t(Us,{detailsInfo:j.value,onHandleEdit:re,ref_key:"editSubscriptionRef",ref:N},null,8,["detailsInfo"]),t(bo,{ref_key:"addGroupRef",ref:ce,onOk:re},null,512),t(ko,{groupLists:W.value,library_id:J.library_id,onOk:re,ref_key:"qaUploadModalRef",ref:ye},null,8,["groupLists","library_id"]),t(ot,{open:V.value,"onUpdate:open":p[13]||(p[13]=w=>V.value=w),title:"批量移动分组",onOk:ft},{default:s(()=>[t(tt,{align:"center",style:{margin:"24px 0"}},{default:s(()=>[p[23]||(p[23]=e("div",null,"移动到分组：",-1)),t(gt,{value:we.group_id,"onUpdate:value":p[12]||(p[12]=w=>we.group_id=w),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),a(H,null,de(W.value.filter(w=>w.id>=0),w=>(n(),F(yt,{value:w.id},{default:s(()=>[m(h(w.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["open"]),t(ot,{open:Oe.value,"onUpdate:open":p[15]||(p[15]=w=>Oe.value=w),title:null,footer:null,width:640},{default:s(()=>[t(ht,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:s(()=>[t(he,{style:{"margin-right":"16px"},onClick:p[14]||(p[14]=w=>Oe.value=!1)},{default:s(()=>[...p[24]||(p[24]=[m("知道了",-1)])]),_:1}),t(he,{onClick:B,type:"primary"},{default:s(()=>[...p[25]||(p[25]=[m("去下载",-1)])]),_:1})]),_:1})]),_:1},8,["open"])],64)}}},Vi=ke(sl,[["__scopeId","data-v-d2b8e852"]]),nl={class:"form-box"},ll={class:"upload-document-type-box"},al=["onClick"],il={class:"right-block"},ul={class:"title-block"},dl={class:"title-text"},rl={class:"desc"},_l={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(J,{expose:K,emit:te}){const G=Rt(),b=We(),W=Ke.useForm,L=c(!1),z=c("添加自定义文档"),x=J,k=le({library_id:b.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),R=c([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),C=Y=>{k.qa_index_type=Y},d=le({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:P,validate:_,validateInfos:I}=W(k,d),j=()=>{L.value=!0,P(),k.file_name="",k.is_qa_doc=0,k.qa_index_type=1,k.library_id=x.libraryInfo.id||b.query.id,x.libraryInfo.type==2&&(k.is_qa_doc=1)},U=c(!1),D=()=>{_().then(()=>{let Y={...Lt(k),group_id:x.group_id};U.value=!0,He(Y).then(T=>{M.success(`${z.value}成功`),L.value=!1,G.push("/library/preview?id="+T.data.file_ids[0])}).finally(()=>{U.value=!1})})};return K({add:j}),(Y,T)=>{const g=Ue,i=pt,r=yo,N=mo,$=qt,A=Ke,se=ue;return n(),a("div",null,[t(se,{open:L.value,"onUpdate:open":T[2]||(T[2]=E=>L.value=E),title:z.value,onOk:D,width:"472px",confirmLoading:U.value},{default:s(()=>[e("div",nl,[t(A,{layout:"vertical"},{default:s(()=>[t(i,is({label:"文档名称"},q(I).file_name),{default:s(()=>[t(g,{type:"text",placeholder:"请输入文档名称",value:k.file_name,"onUpdate:value":T[0]||(T[0]=E=>k.file_name=E)},null,8,["value"])]),_:1},16),v("",!0),k.is_qa_doc==1?(n(),F(i,{key:1,label:"索引方式",required:""},{default:s(()=>[e("div",ll,[(n(!0),a(H,null,de(R.value,E=>(n(),a("div",{class:fe(["type-item",{active:k.qa_index_type==E.value}]),key:E.value,onClick:ce=>C(E.value)},[e("div",il,[e("div",ul,[t($,{name:k.qa_index_type==E.value?E.iconNameActive:E.iconName},null,8,["name"]),e("div",dl,h(E.title),1)]),e("div",rl,h(E.desc),1)]),k.qa_index_type==E.value?(n(),F($,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],10,al))),128))])]),_:1})):v("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},cl=ke(_l,[["__scopeId","data-v-2205ab5f"]]),pl="/assets/img/guide-image-DSu20zRj.png",fl={class:"container"},vl={class:"guide-content"},ml={class:"content-box"},yl={__name:"guide-learning-tips",setup(J,{expose:K}){const te=It(),G=c(!1),b=c(!1),W=c(""),L=()=>{setTimeout(()=>{G.value=!0},500)},z=()=>{te.setGuideLearningTips(b.value),G.value=!1},x=()=>{te.setGuideLearningTips(b.value),G.value=!1};return K({show:L}),(k,R)=>{const C=hs,d=Mt,P=ue;return n(),a("div",fl,[t(P,{open:G.value,"onUpdate:open":R[1]||(R[1]=_=>G.value=_),title:W.value,onOk:z,onCancel:x,width:"472px"},{footer:s(()=>[t(d,{type:"primary",onClick:z},{default:s(()=>[...R[5]||(R[5]=[m("我知道了",-1)])]),_:1})]),default:s(()=>[e("div",vl,[R[4]||(R[4]=e("img",{src:pl,alt:"操作引导",class:"guide-image"},null,-1)),e("div",ml,[R[3]||(R[3]=e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),t(C,{checked:b.value,"onUpdate:checked":R[0]||(R[0]=_=>b.value=_)},{default:s(()=>[...R[2]||(R[2]=[e("div",{class:"content-check"},"不再显示此提示",-1)])]),_:1},8,["checked"])])])]),_:1},8,["open","title"])])}}},gl=ke(yl,[["__scopeId","data-v-d94a3a33"]]),hl={__name:"edit-online-doc",emits:["ok"],setup(J,{expose:K,emit:te}){const G=te,b=le({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),W=c({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),L=c(!1),z=C=>{C=JSON.parse(JSON.stringify(C)),b.id=C.id||"",b.file_name=C.file_name||"",b.doc_auto_renew_frequency=+C.doc_auto_renew_frequency||1,C.doc_auto_renew_minute>0&&(b.doc_auto_renew_minute=Pe(C.doc_auto_renew_minute)),L.value=!0},x=c(!1),k=c(null),R=()=>{k.value.validate().then(()=>{x.value=!0,Wo({...b,doc_auto_renew_minute:b.doc_auto_renew_minute?Pe(b.doc_auto_renew_minute):0}).then(()=>{L.value=!1,x.value=!1,G("ok")})}).catch(()=>{x.value=!1})};return K({show:z}),(C,d)=>{const P=Ue,_=pt,I=Qe,j=Ve,U=go,D=Ke,Y=ue;return n(),a("div",null,[t(Y,{open:L.value,"onUpdate:open":d[3]||(d[3]=T=>L.value=T),"confirm-loading":x.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:R},{default:s(()=>[t(D,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:k,model:b,rules:W.value},{default:s(()=>[t(_,{name:"file_name",label:"文件名称"},{default:s(()=>[t(P,{value:b.file_name,"onUpdate:value":d[0]||(d[0]=T=>b.file_name=T),placeholder:"请输入"},null,8,["value"])]),_:1}),t(_,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:s(()=>[t(j,{value:b.doc_auto_renew_frequency,"onUpdate:value":d[1]||(d[1]=T=>b.doc_auto_renew_frequency=T),style:{width:"100%"}},{default:s(()=>[t(I,{value:1},{default:s(()=>[...d[4]||(d[4]=[m("不自动更新",-1)])]),_:1}),t(I,{value:2},{default:s(()=>[...d[5]||(d[5]=[m("每天",-1)])]),_:1}),t(I,{value:3},{default:s(()=>[...d[6]||(d[6]=[m("每3天",-1)])]),_:1}),t(I,{value:4},{default:s(()=>[...d[7]||(d[7]=[m("每7天",-1)])]),_:1}),t(I,{value:5},{default:s(()=>[...d[8]||(d[8]=[m("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),b.doc_auto_renew_frequency>1?(n(),F(_,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[t(U,{valueFormat:"HH:mm",value:b.doc_auto_renew_minute,"onUpdate:value":d[2]||(d[2]=T=>b.doc_auto_renew_minute=T),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},kl={class:"form-item"},bl={class:"form-content"},wl={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(J,{expose:K,emit:te}){const G=c(!1),b=te,W=c("修改分组"),L=J,z=le({group_id:"",file_id:""}),x=c([]),k=d=>{z.group_id=d.group_id||"0",z.file_id=d.id||"",C(),G.value=!0},R=()=>{if(!z.group_id)return M.error("请选择分组");Vo({...z,library_id:L.libraryId,sense:L.sense}).then(d=>{M.success(`${W.value}成功`),G.value=!1,b("ok")})},C=()=>{Ot({library_id:L.libraryId,group_type:1}).then(d=>{x.value=d.data||[]})};return K({show:k}),(d,P)=>{const _=Qe,I=Ve,j=ue;return n(),a("div",null,[t(j,{open:G.value,"onUpdate:open":P[1]||(P[1]=U=>G.value=U),title:W.value,onOk:R},{default:s(()=>[e("div",kl,[P[2]||(P[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",bl,[t(I,{value:z.group_id,"onUpdate:value":P[0]||(P[0]=U=>z.group_id=U),style:{width:"100%"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),a(H,null,de(x.value,U=>(n(),F(_,{value:U.id},{default:s(()=>[m(h(U.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},xl=ke(wl,[["__scopeId","data-v-b85f6cc4"]]),Cl="/assets/img/feishu-redirct-example-qgH_904t.png",$l={key:0,class:"file-list"},Sl={__name:"add-feishu-document",props:{libraryId:{type:[Number,String],default:""}},emits:["ok"],setup(J,{expose:K,emit:te}){const G=te,b=J,W=It(),L=`${window.location.origin}/manage/feishuUserAuthLogin/callback`,z=c(null),x={feishu_app_id:"",feishu_app_secret:"",user_access_token:"",file_type:1,feishu_document_id_list:[]},k=c(!1),R=c(!1),C=c(1),d=le({feishu_document_id_list:[]}),P=le({feishu_app_id:{message:"请输入飞书 AppId",required:!0},feishu_app_secret:{message:"请输入飞书 AppSecret",required:!0}}),_=c([]);function I(g=null){Object.assign(d,JSON.parse(JSON.stringify(x))),g?(Object.assign(d,g),j(),C.value=2):C.value=1,k.value=!0}function j(){const{feishu_app_id:g,feishu_app_secret:i,user_access_token:r}=d;jo({feishu_app_id:g,feishu_app_secret:i,user_access_token:r}).then(N=>{_.value=U((N==null?void 0:N.data)||[])})}function U(g=[]){return g.map(i=>{if(Array.isArray(i.children)){i.checkable=!1;const r=U(i.children);return{...i,children:r}}return i.checkable=!0,i}).filter(i=>{var r;return!!(i.type==="docx"||i.type==="folder"&&((r=i.children)!=null&&r.length))})}function D(g=[]){const i=[];function r(N){for(const $ of N)$.type==="docx"&&$.token&&i.push($.token),Array.isArray($.children)&&r($.children)}return r(g),i}const Y=g=>{Qo(g),M.success("复制成功")};function T(){z.value.validate().then(()=>{if(C.value==1){M.loading("正在进行验证...");let g="";const i={feishu_app_id:d.feishu_app_id,feishu_app_secret:d.feishu_app_secret},r={...i,id:b.libraryId};let N={...i,token:W.getToken??"",feishu_frontend_auth_redirect_url:Yo(`${g}/#/library/details/knowledge-document?${Xt(r)}`)};window.location.href=`${g}/manage/feishuUserAuthLogin/redirect?${Xt(N)}`}else{if(d.file_type==2){if(!d.feishu_document_id_list.length)return M.error("请选择同步文件")}else if(d.feishu_document_id_list=D(_.value),!d.feishu_document_id_list.length)return M.error("暂无可同步文件");let g={library_id:b.libraryId,doc_type:6,...d,doc_auto_renew_minute:Pe(d.doc_auto_renew_minute),feishu_document_id_list:d.feishu_document_id_list.toString()};delete g.file_type,delete g.user_access_token,R.value=!0,He(g).then(i=>{G("ok"),M.success("添加完成"),k.value=!1}).finally(()=>{R.value=!1})}})}return K({show:I}),(g,i)=>{const r=ks,N=ct,$=co,A=Ue,se=pt,E=Ke,ce=yo,S=mo,re=bs,De=ue;return n(),F(De,{open:k.value,"onUpdate:open":i[5]||(i[5]=ee=>k.value=ee),"confirm-loading":R.value,maskClosable:!1,title:C.value==1?"导入飞书知识库":"请选择需要同步的文件",width:"646px",onOk:T},{default:s(()=>[C.value==1?(n(),a(H,{key:0},[t($,{class:"zm-alert-info","show-icon":"",type:"info"},{message:s(()=>[i[7]||(i[7]=m(" 请先在",-1)),i[8]||(i[8]=e("a",{href:"https://open.feishu.cn/document/server-docs/api-call-guide/terminology",target:"_blank"},"飞书开发者后台",-1)),i[9]||(i[9]=m("创建自建应用获取App ID 和 App Secret，并将需要同步的 ",-1)),i[10]||(i[10]=e("a",{href:"https://open.feishu.cn/document/server-docs/docs/wiki-v2/wiki-qa#b5da330b",target:"_blank"},"知识库授权给对应应用",-1)),i[11]||(i[11]=m("； ",-1)),t(N,null,{title:s(()=>[t(r,{width:"600px",src:q(Cl)},null,8,["src"])]),default:s(()=>[i[6]||(i[6]=m(" 在飞书应用中填写重定向URL：",-1)),e("a",{onClick:i[0]||(i[0]=ee=>Y(L)),title:"点击复制"},h(L))]),_:1}),i[12]||(i[12]=m(" 。完成后，系统将自动同步知识库目录下.docx格式的云文档 ",-1))]),_:1}),t(E,{class:"mt16",layout:"vertical",ref_key:"formRef",ref:z,model:d,rules:P},{default:s(()=>[t(se,{name:"feishu_app_id",label:"AppId"},{default:s(()=>[t(A,{value:d.feishu_app_id,"onUpdate:value":i[1]||(i[1]=ee=>d.feishu_app_id=ee),valueModifiers:{trim:!0},placeholder:"请输入飞书 AppId"},null,8,["value"])]),_:1}),t(se,{name:"feishu_app_secret",label:"AppSecret"},{default:s(()=>[t(A,{value:d.feishu_app_secret,"onUpdate:value":i[2]||(i[2]=ee=>d.feishu_app_secret=ee),valueModifiers:{trim:!0},placeholder:"请输入飞书 AppSecret"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])],64)):(n(),F(E,{key:1,layout:"vertical",ref_key:"formRef",ref:z,model:d,rules:P},{default:s(()=>[t(se,{label:"文件范围"},{default:s(()=>[t(S,{value:d.file_type,"onUpdate:value":i[3]||(i[3]=ee=>d.file_type=ee)},{default:s(()=>[t(ce,{value:1},{default:s(()=>[...i[13]||(i[13]=[m("权限范围内所有文件",-1)])]),_:1}),t(ce,{value:2},{default:s(()=>[...i[14]||(i[14]=[m("部分文件",-1)])]),_:1})]),_:1},8,["value"]),d.file_type==2?(n(),a("div",$l,[t(re,{checkedKeys:d.feishu_document_id_list,"onUpdate:checkedKeys":i[4]||(i[4]=ee=>d.feishu_document_id_list=ee),multiple:"",checkable:"","field-names":{key:"token"},"tree-data":_.value},{title:s(({name:ee,type:ye})=>[ye==="docx"?(n(),a(H,{key:0},[m(h(ee)+".docx",1)],64)):(n(),a(H,{key:1},[m(h(ee),1)],64))]),_:1},8,["checkedKeys","tree-data"])])):v("",!0)]),_:1})]),_:1},8,["model","rules"]))]),_:1},8,["open","confirm-loading","title"])}}},Ll=ke(Sl,[["__scopeId","data-v-6eb9dbbc"]]),ql={class:"details-library-page"},Ol={class:"group-head-box"},Il={class:"head-title"},Rl={class:"flex-between-box"},Ul={class:"classify-box",style:{"margin-top":"16px"}},Dl=["onClick"],Ml={key:0,class:"drag-btn"},Tl={key:1,style:{width:"20px"}},Fl={class:"classify-title"},Gl={class:"right-content"},zl={key:0,class:"btn-box"},El={class:"hover-btn-wrap"},Nl=["onClick"],Al=["onClick"],Hl={class:"main-content-box"},Pl={class:"group-header-title"},Bl={class:"pover-group-content-box"},Kl={class:"group-head-box"},Wl={class:"head-title"},Vl={class:"flex-between-box"},Ql={class:"search-box"},jl={class:"classify-box classify-scroll-box"},Yl=["onClick"],Jl={class:"classify-title"},Xl={class:"right-content"},Zl={key:0,class:"btn-box"},ea={class:"hover-btn-wrap"},ta=["onClick"],oa=["onClick"],sa={class:"title"},na={class:"list-tools"},la={class:"tools-items"},aa={class:"right-box"},ia={key:0,class:"status-box"},ua={class:"status-item"},da={class:"status-content"},ra={class:"status-item"},_a={class:"status-content content-tip"},ca={class:"status-item"},pa={class:"status-content content-tip"},fa={key:1,class:"status-select-box"},va={class:"tool-item"},ma={class:"tool-item"},ya={class:"dropdown-btn-menu"},ga={key:0,class:"desc"},ha={key:1,class:"desc"},ka={class:"dropdown-btn-menu"},ba={class:"dropdown-btn-menu"},wa={class:"dropdown-btn-menu"},xa={class:"list-content"},Ca={key:0,class:"doc-name-td"},$a=["href"],Sa=["onClick"],La={key:0},qa={key:1},Oa=["onClick"],Ia={key:0},Ra={key:1},Ua={key:2,class:"url-remark"},Da=["onClick"],Ma={key:0,class:"pdf-progress-box"},Ta={class:"progress-title"},Fa={class:"status-box"},Ga=["onClick"],za={class:"progress-bar"},Ea={class:"num-box"},Na={key:0,class:"status-tag running"},Aa={key:2,class:"status-tag running"},Ha={key:3,class:"status-tag complete"},Pa={class:"status-tag status-error"},Ba=["onClick"],Ka={class:"status-tag status-error"},Wa={class:"status-tag"},Va=["onClick"],Qa={key:7,class:"status-tag"},ja={key:8,class:"status-tag running"},Ya={class:"status-tag error"},Ja={key:10,class:"status-tag cancel"},Xa={key:11,class:"status-tag subning"},Za={class:"status-tag"},ei=["onClick"],ti={key:1,class:"status-tag running"},oi={key:2,class:"status-tag complete"},si={class:"status-tag error"},ni=["onClick"],li={class:"zm-line1 reason-text"},ai={key:4,class:"status-tag running"},ii={class:"status-tag warning"},ui={class:"reason-text"},di=["onClick"],ri={key:0},_i={key:1},ci={key:0,class:"text-block"},pi={class:"time-content-box"},fi={key:0},vi={key:1},mi={key:2},yi={key:3},gi={key:4},hi={key:5,class:"ml4"},ki={key:6},bi=["onClick"],wi={key:1},xi={key:0},Ci={key:1},$i=["onClick"],Si=["onClick"],Li={class:"upload-file-box"},qi={class:"select-card-box"},Oi=["onClick"],Ii={class:"card-title"},Ri={key:0,class:"card-switch-box"},Ui={class:"card-desc"},Di={key:0,class:"card-switch"},so="qa_document_group_box_width",dt=180,$t=256,Mi={__name:"knowledge-document",props:{type:{type:[Number,String],default:()=>2},library_id:{type:[Number,String],default:()=>""}},setup(J){const{setStorage:K}=ts("localStorage"),te=ao(),{changeGraphSwitch:G}=te,b=Jo(),W=me(()=>{var l;return((l=b.companyInfo)==null?void 0:l.neo4j_status)=="true"}),L=me(()=>{var l;return((l=b.companyInfo)==null?void 0:l.ali_ocr_switch)=="1"}),z=J,x=me(()=>z.library_id||Y.id),k=c(localStorage.getItem("document_group_hide_key")==1),R=c(""),C=c([]),d=c(-1),P=me(()=>C.value.find(l=>l.id==d.value)||{}),_=me(()=>C.value.filter(l=>l.group_name.includes(R.value))),I=It(),j=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],U=We(),D=Rt(),Y=U.query,T=c(!1),g=c(null),i=c(null),r=c(null),N=c(!1),$=c({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});le({selectedRowKeys:[]});const A=le({use_model:"",model_config_id:""}),se=(l,o)=>{let y=o.modelName,X=o.modelId;ye.value.length>0?ue.confirm({title:`确定切换模型为${y}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){A.use_model=y,A.model_config_id=X,E()},onCancel(){}}):(A.use_model=y,A.model_config_id=X,E())},E=(l=!0,o=null)=>{as({...Lt($.value),use_model:A.use_model,model_config_id:A.model_config_id}).then(()=>{$.value.use_model=A.use_model,$.value.model_config_id=A.model_config_id,typeof o=="function"&&o(),l&&M.success("保存成功")})},ce=c([]),S=l=>{ce.value=l},re=c([]),De=l=>{re.value=l,ee()},ee=()=>{if(!$.value.id){setTimeout(()=>{ee()},100);return}if(re.value.length>0&&!$.value.use_model){let l=null,o=null;for(let y of re.value)if(y.model_define==="chatwiki"){l=y;for(let X of l.children)if(X.name==="text-embedding-v2"){o=X;break}break}l||(l=re.value[0],o=l.children[0]),l&&(A.use_model=o.name,A.model_config_id=o.model_config_id,E(!1))}},ye=c([]),be=le({learned_err_count:0,learned_count:0,learned_wait_count:0}),V=le({library_id:x.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),we=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],Se=c([]),je=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"更新频率/时间",dataIndex:"doc_auto_renew_frequency",key:"doc_auto_renew_frequency",width:260},{title:"文章更新时间",dataIndex:"official_article_update_time",key:"official_article_update_time",width:220},{title:"合计",dataIndex:"total_hits",key:"total_hits",width:150,sorter:!0},{title:"昨日",dataIndex:"yesterday_hits",key:"yesterday_hits",width:150,sorter:!0},{title:"今日",dataIndex:"today_hits",key:"today_hits",width:150,sorter:!0},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],ft=l=>{pe()},Le=(l,o,y)=>{V.page=l.current,V.size=l.pageSize,V.sort_field="",V.sort_type="",y.order&&y.field&&(V.sort_field=y.field,V.sort_type=y.order=="ascend"?"asc":"desc"),ae()},pe=()=>{V.page=1,ae(),Me()};let qe=!1;const Ye=({id:l})=>{ye.value.length==1&&(qe=!0),ls({id:l}).then(()=>{qe&&V.page>1&&V.page--,ae(),Me(),M.success("删除成功")})},ge=(l,o={})=>{let y=U.name;if(l.status=="4"){if(y=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+l.id+"&page="+V.page);return}return D.push({path:"/library/document-segmentation",query:{document_id:l.id,page:V.page}})}if(l.status=="3"&&$.value.type!=2)return M.error("学习失败,不可预览");if(l.status=="0")return M.error("转换中,稍候可预览");if(l.status=="1")return M.error("学习中,不可预览");if(l.status=="6")return M.error("获取中,不可预览");if(l.status=="7")return M.error("获取失败,不可预览");if(l.status=="10")return M.error("正在分段,不可预览");if(y=="libraryConfig"){window.open("/#/library/preview?id="+l.id);return}D.push({name:"libraryPreview",query:{id:l.id,...o}})},ae=()=>{let l=Lt(V);l.status==0&&(l.status=""),l.group_id=d.value,T.value=!0,Xo(l).then(o=>{let y=o.data.info;!A.use_model&&A.use_model!=y.use_model&&(A.use_model=y.use_model,A.model_config_id=y.model_config_id),$.value={...y},N.value=y.graph_switch==1,y.graph_switch=="0"||!W.value?Se.value=je.filter(Z=>!["graph_status","graph_entity_count"].includes(Z.key)):Se.value=je,z.type!=3&&(Se.value=Se.value.filter(Z=>Z.key!="official_article_update_time"));let X=o.data.list||[],Ce=o.data.count_data||{};V.total=o.data.total,be.learned_count=Ce.learned_count,be.learned_err_count=Ce.learned_err_count,be.learned_wait_count=Ce.learned_wait_count;let oe=!1;ye.value=X.map(Z=>(["1","6","0","5"].includes(Z.status)&&(oe=!0),Z.file_size_str=Zo(Z.file_size),Z.update_time=xt(Z.update_time*1e3).format("YYYY-MM-DD HH:mm"),Z.official_article_update_time=xt(Z.official_article_update_time*1e3).format("YYYY-MM-DD HH:mm"),Z.doc_last_renew_time_desc=Z.doc_last_renew_time>0?xt(Z.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",Z)),oe&&Je(),!oe&&clearInterval(xe.value)}).finally(()=>{T.value=!1})},xe=c(null),Je=()=>{clearInterval(xe.value),xe.value=setInterval(()=>{ae()},1e3*5)},Oe=c(null),vt=l=>{if(re.value.length==0){ue.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){D.push({path:"/user/model"})}});return}let{key:o}=l;o==1&&Xe(),o==2&&O(),o==3&&Oe.value.add(),o==4&&r.value.show()},B=le({open:!1,urls:"",library_id:x.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(l,o)=>eo(o)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),O=()=>{B.open=!0,B.confirmLoading=!1,B.urls="",B.doc_auto_renew_minute="02:00",B.doc_auto_renew_frequency=1},p=c(null),ve=()=>{p.value.validate().then(()=>{B.confirmLoading=!0,He({library_id:B.library_id,urls:JSON.stringify(eo(B.urls)),doc_auto_renew_frequency:B.doc_auto_renew_frequency,doc_auto_renew_minute:Pe(B.doc_auto_renew_minute),doc_type:2,group_id:d.value}).then(()=>{B.open=!1,B.confirmLoading=!1,pe()})}).catch(()=>{B.confirmLoading=!1})},_e=()=>{B.open=!1},Q=le({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),Ie=me(()=>Q.fileList.filter(l=>l.type==="application/pdf").length>0),Ge=c(null),Xe=()=>{if($.value.type==2){Ge.value.show();return}Q.fileList=[],Q.open=!0},Ze=()=>{Q.fileList=[]},mt=l=>{Q.fileList=l},he=()=>{if(g.value&&!I.getGuideLearningTips&&Q.fileList.length>1&&g.value.show(),Q.fileList.length==0){M.error("请选择文件");return}Q.confirmLoading=!0;let l=new FormData;l.append("library_id",V.library_id),l.append("group_id",d.value||0);let o=!1;Q.fileList.forEach(y=>{(y.name.includes(".xlsx")||y.name.includes(".csv"))&&(o=!0),l.append("library_files",y)}),Ie.value&&l.append("pdf_parse_type",Q.pdf_parse_type),He(l).then(y=>{ae(),Q.open=!1,Q.fileList=[],Q.confirmLoading=!1,o&&y.data.file_ids.length==1&&D.push("/library/document-segmentation?document_id="+y.data.file_ids[0])}).catch(()=>{Q.confirmLoading=!1})},et=c(null),yt=l=>{et.value.show(l)},gt=l=>{D.push({path:"/library/document-segmentation",query:{document_id:l.id}})},tt=l=>{ss({id:l.id}).then(()=>{ae()})},ot=()=>{if(N.value){N.value=!1;let l={graph_model_config_id:$.value.graph_model_config_id,graph_use_model:$.value.graph_use_model};if((!l.graph_model_config_id||!l.graph_use_model)&&ce.value.length>0){let y=ce.value[0].children[0];l.graph_use_model=y.name,l.graph_model_config_id=y.model_config_id}i.value.show(l)}else $.value.graph_switch=0,E(!1,()=>{ae(),G(0)})},ht=l=>{N.value=!0,$.value.graph_switch=1,$.value.graph_model_config_id=l.graph_model_config_id,$.value.graph_use_model=l.graph_use_model,E(!1,()=>{ae(),G(1)})},w=l=>{if(l.key==4&&!L.value)return!1;Q.pdf_parse_type=l.key},Re=()=>{window.open("#/user/aliocr")},Tt=c(null),Ft=l=>{Tt.value.show({...l})},wo=l=>{ns({id:l.id}).then(o=>{M.success("更新成功"),ae()})},xo=l=>{ue.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){os({id:l.id}).then(o=>{M.success("取消成功"),ae()})}})},Co=l=>{K("graph:autoOpenFileId",l.id),D.push({path:"/library/details/knowledge-graph",query:{id:x.value}})},$o=l=>{let o=`/manage/downloadLibraryFile?id=${l.id}&token=${I.getToken}`;var y=document.createElement("a");y.href=o,y.style.display="none",y.click()},Gt=()=>{k.value=!k.value,localStorage.setItem("document_group_hide_key",k.value?1:2)},Me=()=>{Ot({library_id:x.value,group_type:1}).then(l=>{let y=(l.data||[]).reduce((X,Ce)=>X+ +Ce.total,0);C.value=[{group_name:"全部分组",id:-1,total:y},...l.data]})};Me();const zt=c(null),st=l=>{zt.value.show({...l,library_id:x.value})},Et=c(null),So=l=>{Et.value.show({...l,sense:1})},kt=()=>{Me(),ae()},Nt=l=>{d.value=l.id,pe()},At=l=>{ue.confirm({title:`确认删除分组${l.group_name}`,icon:t(Be),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){io({id:l.id,sense:1}).then(()=>{M.success("删除成功"),Me(),d.value==l.id&&(d.value=-1,pe())})}})},ze=c(dt),nt=c(!1);St(()=>{const l=parseInt(localStorage.getItem(so));l&&l>=dt&&l<=$t&&(ze.value=l),Lo()});const Lo=()=>{const{user_access_token:l,feishu_app_id:o,feishu_app_secret:y,...X}=Y;l&&o&&y&&(D.replace({query:X}),r.value.show({user_access_token:l,feishu_app_id:o,feishu_app_secret:y}))};let lt=!1,Ht=0,Pt=0;const qo=l=>{k.value||(lt=!0,nt.value=!0,Ht=l.clientX,Pt=ze.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Bt),document.addEventListener("mouseup",Kt))},Bt=l=>{if(!lt)return;let o=Pt+(l.clientX-Ht);o=Math.max(dt,Math.min($t,o)),ze.value=o},Kt=()=>{lt&&(lt=!1,nt.value=!1,localStorage.setItem(so,ze.value),document.body.style.cursor="",document.removeEventListener("mousemove",Bt),document.removeEventListener("mouseup",Kt))},Oo=l=>l.draggedContext.element.id>0&&l.relatedContext.element.id>0,Io=async()=>{try{const l=C.value.filter(o=>o.id>0).map((o,y)=>({id:o.id,sort:C.value.length-y}));await es({library_id:x.value,sense:1,sort_group:JSON.stringify(l)}),M.success("排序已保存")}catch(l){console.error("排序保存失败:",l),Me()}};return St(()=>{Y.page&&(V.page=+Y.page),ae()}),us(()=>{xe.value&&clearInterval(xe.value)}),(l,o)=>{const y=qt,X=Ut,Ce=Ue,oe=vo,Z=fo,at=po,Wt=no,Vt=ct,$e=Dt,Te=Qe,Qt=Ve,Ro=ws,Uo=Mt,Do=$s,Ee=Ss,jt=qs,Mo=_o,Ne=pt,Yt=Ke,Jt=ue,To=Rs,Fo=go,Go=uo("copy");return n(),a("div",ql,[e("div",{class:fe(["group-content-box",[{collapsed:k.value},{"no-transition":nt.value}]]),style:ro(k.value?{}:{width:ze.value+"px",minWidth:dt+"px",maxWidth:$t+"px"})},[e("div",Ol,[e("div",Il,[t(X,{title:"收起问答分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:Gt},[t(y,{name:"put-away"})])]),_:1}),e("div",Rl,[o[17]||(o[17]=e("div",null,"知识分组",-1)),t(X,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=f=>st({}))},[t(q(Fe))])]),_:1})])]),v("",!0)]),e("div",Ul,[t(Wt,{style:{"padding-right":"24px"}},{default:s(()=>[t(q(Fs),{modelValue:C.value,"onUpdate:modelValue":o[3]||(o[3]=f=>C.value=f),"item-key":"id",disabled:nt.value,onEnd:Io,move:Oo,handle:".drag-btn"},{item:s(({element:f})=>[e("div",{class:fe(["classify-item",{active:f.id==d.value}]),onClick:u=>Nt(f)},[f.id>0?(n(),a("span",Ml,[t(y,{name:"drag"})])):(n(),a("span",Tl)),e("div",Fl,h(f.group_name),1),e("div",Gl,[e("div",{class:fe(["num",{"num-block":f.id<=0}])},h(f.total),3),f.id>0?(n(),a("div",zl,[t(at,{placement:"bottomRight"},{overlay:s(()=>[t(Z,null,{default:s(()=>[t(oe,null,{default:s(()=>[e("div",{onClick:ie(u=>st(f),["stop"])},"重命名",8,Nl)]),_:2},1024),t(oe,null,{default:s(()=>[e("div",{onClick:ie(u=>At(f),["stop"])},"删 除",8,Al)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",El,[t(q(_t))])]),_:2},1024)])):v("",!0)])],10,Dl)]),_:1},8,["modelValue","disabled"])]),_:1})]),k.value?v("",!0):(n(),a("div",{key:0,class:"resize-bar",onMousedown:qo},null,32))],6),e("div",Hl,[t(Wt,{scrollbar:!1},{default:s(()=>[e("div",Pl,[k.value?(n(),F(Vt,{key:0,title:null,placement:"bottom"},{content:s(()=>[e("div",Bl,[e("div",Kl,[e("div",Wl,[e("div",Vl,[o[18]||(o[18]=e("div",null,"问答分组",-1)),t(X,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:o[4]||(o[4]=f=>st({}))},[t(q(Fe))])]),_:1})])]),e("div",Ql,[t(Ce,{allowClear:"",value:R.value,"onUpdate:value":o[6]||(o[6]=f=>R.value=f),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t(q(Ae),{onClick:o[5]||(o[5]=ie(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",jl,[(n(!0),a(H,null,de(_.value,f=>(n(),a("div",{class:fe(["classify-item",{active:f.id==d.value}]),onClick:u=>Nt(f),key:f.id},[e("div",Jl,h(f.group_name),1),e("div",Xl,[e("div",{class:fe(["num",{"num-block":f.id<=0}])},h(f.total),3),f.id>0?(n(),a("div",Zl,[t(at,{placement:"bottomRight"},{overlay:s(()=>[t(Z,null,{default:s(()=>[t(oe,null,{default:s(()=>[e("div",{onClick:ie(u=>st(f),["stop"])},"重命名",8,ta)]),_:2},1024),t(oe,null,{default:s(()=>[e("div",{onClick:ie(u=>At(f),["stop"])},"删 除",8,oa)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",ea,[t(q(_t))])]),_:2},1024)])):v("",!0)])],10,Yl))),128))])])]),default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:Gt},[t(y,{name:"expand"})])]),_:1})):v("",!0),e("div",sa,h(P.value.group_name),1)]),e("div",na,[e("div",la,[rt(t($e,{align:"center",class:"tool-item custom-select-box"},{default:s(()=>[o[19]||(o[19]=e("span",null,"嵌入模型：",-1)),t(to,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:A.use_model,modeId:A.model_config_id,style:{width:"240px"},onChange:se,onLoaded:De},null,8,["modeName","modeId"])]),_:1},512),[[Zt,!1]])]),e("div",aa,[$.value.type==0?(n(),a("div",ia,[e("div",ua,[o[20]||(o[20]=e("div",{class:"status-label"},"已学习：",-1)),e("div",da,h(be.learned_count),1)]),e("div",ra,[o[21]||(o[21]=e("div",{class:"status-label"},"，未学习：",-1)),e("div",_a,h(be.learned_wait_count),1)]),e("div",ca,[o[22]||(o[22]=e("div",{class:"status-label"},"，学习失败：",-1)),e("div",pa,h(be.learned_err_count),1)])])):v("",!0),$.value.type==0?(n(),a("div",fa,[t(Qt,{value:V.status,"onUpdate:value":o[7]||(o[7]=f=>V.status=f),style:{width:"150px"},placeholder:"请选择",onChange:ft},{default:s(()=>[(n(),a(H,null,de(we,f=>t(Te,{key:f.id,value:f.id},{default:s(()=>[m(h(f.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):v("",!0),e("div",va,[t(Ce,{style:{width:"140px"},value:V.file_name,"onUpdate:value":o[8]||(o[8]=f=>V.file_name=f),placeholder:"文档名称搜索",onChange:pe},{suffix:s(()=>[t(q(Ae),{onClick:pe,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),W.value?(n(),F($e,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:s(()=>[rt(t(to,{modelType:"LLM",onLoaded:S},null,512),[[Zt,!1]]),o[23]||(o[23]=e("span",null,"生成知识图谱：",-1)),t(Ro,{checked:N.value,"onUpdate:checked":o[9]||(o[9]=f=>N.value=f),onChange:ot,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})):v("",!0),e("div",ma,[t(at,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:s(()=>[t(Z,{onClick:vt},{default:s(()=>[(n(),F(oe,{key:1},{default:s(()=>[e("div",ya,[t($e,{class:"title-block",gap:4},{default:s(()=>[t(y,{name:"doc-icon"}),o[24]||(o[24]=e("div",{class:"title"},"本地文档",-1))]),_:1}),$.value.type==2?(n(),a("div",ga," 上传本地 docx/csv/xlsx 等格式文件 ")):(n(),a("div",ha," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),$.value.type!=2?(n(),F(oe,{key:2},{default:s(()=>[e("div",ka,[t($e,{class:"title-block",gap:4},{default:s(()=>[t(y,{name:"link-icon"}),o[25]||(o[25]=e("div",{class:"title"},"在线数据",-1))]),_:1}),o[26]||(o[26]=e("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):v("",!0),(n(),F(oe,{key:3},{default:s(()=>[e("div",ba,[t($e,{class:"title-block",gap:4},{default:s(()=>[t(y,{name:"cu-doc-icon"}),o[27]||(o[27]=e("div",{class:"title"},"自定义文档",-1))]),_:1}),o[28]||(o[28]=e("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1})),$.value.type==0?(n(),F(oe,{key:4},{default:s(()=>[e("div",wa,[t($e,{class:"title-block",gap:4},{default:s(()=>[t(y,{name:"feishu-doc"}),o[29]||(o[29]=e("div",{class:"title"},"飞书知识库",-1))]),_:1}),o[30]||(o[30]=e("div",{class:"desc"},"在线获取飞书知识库下docx格式云文档内容",-1))])]),_:1})):v("",!0)]),_:1})]),default:s(()=>[J.type!=3?(n(),F(Uo,{key:0,type:"primary"},{icon:s(()=>[t(q(Fe))]),default:s(()=>[o[31]||(o[31]=e("span",null,"添加内容",-1))]),_:1})):v("",!0)]),_:1})])])]),$.value.type==0?(n(),F(Ts,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:s(()=>[...o[32]||(o[32]=[e("div",null,[e("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),e("p",null,"2、未学习的文档数据不会被检索到。")],-1)])]),_:1})):v("",!0),e("div",xa,[t(Mo,{columns:Se.value,"data-source":ye.value,scroll:{x:1e3},"row-key":"id",pagination:{current:V.page,total:V.total,pageSize:V.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:Le},{bodyCell:s(({column:f,record:u})=>[f.key==="file_name"?(n(),a("div",Ca,[u.doc_type==2?(n(),F(Vt,{key:0,title:null},{content:s(()=>[o[33]||(o[33]=m(" 原链接：",-1)),e("a",{href:u.doc_url,target:"_blank"},h(u.doc_url),9,$a),rt(t(q(xs),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Go,`${u.doc_url}`]])]),default:s(()=>[e("a",{onClick:ne=>ge(u)},[["5","6","7"].includes(u.status)?(n(),a("span",La,h(u.doc_url),1)):(n(),a("span",qa,h(u.file_name),1))],8,Sa)]),_:2},1024)):(n(),a("a",{key:1,onClick:ne=>ge(u)},[["5","6","7"].includes(u.status)?(n(),a("span",Ia,h(u.doc_url),1)):(n(),a("span",Ra,h(u.file_name),1))],8,Oa)),u.doc_type==2&&u.remark?(n(),a("div",Ua," 备注："+h(u.remark),1)):v("",!0)])):v("",!0),f.key==="graph_entity_count"?(n(),a("a",{key:1,onClick:ne=>Co(u)},h(u.graph_entity_count),9,Da)):v("",!0),f.key==="status"?(n(),a(H,{key:2},[u.file_ext=="pdf"&&u.pdf_parse_type>=2?(n(),a(H,{key:0},[u.status==0?(n(),a("div",Ma,[e("div",Ta,[e("span",Fa,[t(q(Cs)),o[34]||(o[34]=m("文档解析中",-1))]),e("a",{onClick:ne=>xo(u)},"取消",8,Ga)]),e("div",za,[t(Do,{size:"small",class:"progress-bar-box",percent:parseInt(u.ocr_pdf_index/u.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),e("div",Ea,h(u.ocr_pdf_index)+" / "+h(u.ocr_pdf_total),1)])])):v("",!0)],64)):(n(),a(H,{key:1},[u.status==0?(n(),a("span",Na,[t(Ee,{size:"small"}),o[35]||(o[35]=m(" 转换中",-1))])):v("",!0)],64)),u.status==1?(n(),a("span",Aa,[t(Ee,{size:"small"}),o[36]||(o[36]=m(" 学习中",-1))])):v("",!0),u.status==2?(n(),a("span",Ha,[t(q(bt)),o[37]||(o[37]=m(" 学习完成",-1))])):v("",!0),u.status==3?(n(),F(X,{key:4,placement:"top"},{title:s(()=>[e("span",null,h(u.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Pa,[t(q(it)),o[38]||(o[38]=m(" 转换失败",-1))]),$.value.type==2?(n(),a("a",{key:0,class:"ml8",onClick:ne=>ge(u)},"学习",8,Ba)):v("",!0)])]),_:2},1024)):v("",!0),u.status==8?(n(),F(X,{key:5,placement:"top"},{title:s(()=>[e("span",null,h(u.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Ka,[t(q(it)),o[39]||(o[39]=m(" 转化异常",-1))])])]),_:2},1024)):v("",!0),u.status==4?(n(),a(H,{key:6},[e("span",Wa,[t(q(wt)),o[40]||(o[40]=m(" 待学习",-1))]),e("a",{class:"ml8",onClick:ne=>ge(u)},"学习",8,Va)],64)):v("",!0),u.status==5?(n(),a("span",Qa,[t(q(wt)),o[41]||(o[41]=m(" 待获取",-1))])):v("",!0),u.status==6?(n(),a("span",ja,[t(Ee,{size:"small"}),o[42]||(o[42]=m(" 获取中",-1))])):v("",!0),u.status==7?(n(),F(X,{key:9,placement:"top"},{title:s(()=>[e("span",null,h(u.errmsg),1)]),default:s(()=>[e("span",Ya,[t(q(it)),o[43]||(o[43]=m(" 获取失败",-1))])]),_:2},1024)):v("",!0),u.status==9?(n(),a("span",Ja,[t(q(Be)),o[44]||(o[44]=m(" 取消解析",-1))])):v("",!0),u.status==10?(n(),a("span",Xa,[t(Ee,{size:"small"}),o[45]||(o[45]=m(" 正在分段 ",-1))])):v("",!0)],64)):v("",!0),f.key==="graph_status"?(n(),a(H,{key:3},[u.graph_status==0?(n(),a(H,{key:0},[e("span",Za,[t(q(wt)),o[46]||(o[46]=m(" 待生成",-1))]),e("a",{class:"ml8",onClick:ne=>tt(u)},"生成",8,ei)],64)):u.graph_status==1?(n(),a("span",ti,[t(q(Ls)),o[47]||(o[47]=m(" 排队中",-1))])):u.graph_status==2?(n(),a("span",oi,[t(q(bt)),o[48]||(o[48]=m(" 生成完成",-1))])):u.graph_status==3?(n(),a(H,{key:3},[e("span",si,[t(q(it)),o[49]||(o[49]=m(" 生成失败",-1))]),e("a",{class:"ml8",onClick:ne=>tt(u)},"生成",8,ni),u.graph_err_msg?(n(),F(X,{key:0,title:u.graph_err_msg},{default:s(()=>[e("div",li,"原因："+h(u.graph_err_msg),1)]),_:2},1032,["title"])):v("",!0)],64)):u.graph_status==4?(n(),a("span",ai,[t(Ee,{size:"small"}),o[50]||(o[50]=m(" 生成中",-1))])):u.graph_status==5?(n(),a(H,{key:5},[e("span",ii,[t(q(bt)),o[51]||(o[51]=m(" 部分成功",-1))]),e("div",ui,[m(" 失败数："+h(u.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:ne=>ge(u,{graph_status:3})},"详情",8,di)])],64)):v("",!0)],64)):v("",!0),f.key==="file_size"?(n(),a(H,{key:4},[u.doc_type==3?(n(),a("span",ri,"-")):(n(),a("span",_i,h(u.file_size_str),1))],64)):v("",!0),f.key==="doc_auto_renew_frequency"?(n(),a(H,{key:5},[u.doc_type==2?(n(),a("div",ci,[e("div",pi,[u.doc_auto_renew_frequency==1?(n(),a("span",fi,"不自动更新")):v("",!0),u.doc_auto_renew_frequency==2?(n(),a("span",vi,"每天")):v("",!0),u.doc_auto_renew_frequency==3?(n(),a("span",mi,"每3天")):v("",!0),u.doc_auto_renew_frequency==4?(n(),a("span",yi,"每7天")):v("",!0),u.doc_auto_renew_frequency==5?(n(),a("span",gi,"每30天")):v("",!0),u.doc_auto_renew_frequency>1&&u.doc_auto_renew_minute>0?(n(),a("span",hi,h(q(Pe)(u.doc_auto_renew_minute)),1)):v("",!0),u.doc_auto_renew_frequency>1?(n(),a("span",ki,"更新")):v("",!0),e("a",{class:"ml4 btn-hover-block",onClick:ne=>Ft(u)},"修改",8,bi)]),t($e,{align:"center"},{default:s(()=>[m(" 最近更新: "+h(u.doc_last_renew_time_desc)+" ",1),t(jt,{title:"确认更新?",onConfirm:ne=>wo(u)},{default:s(()=>[...o[52]||(o[52]=[e("a",{class:"ml4 btn-hover-block"},"更新",-1)])]),_:1},8,["onConfirm"])]),_:2},1024)])):(n(),a("div",wi,"--"))],64)):v("",!0),f.key==="paragraph_count"?(n(),a(H,{key:6},[u.status==0||u.status==1?(n(),a("span",xi,"-")):(n(),a("span",Ci,h(u.paragraph_count),1))],64)):v("",!0),f.key==="action"?(n(),F($e,{key:7,gap:8},{default:s(()=>[t(X,null,{title:s(()=>[...o[53]||(o[53]=[m("重新分段",-1)])]),default:s(()=>[t(q(Os),{class:"btn-hover-block",onClick:ne=>gt(u)},null,8,["onClick"])]),_:2},1024),t(at,null,{overlay:s(()=>[t(Z,null,{default:s(()=>[u.doc_type==2?(n(),F(oe,{key:0},{default:s(()=>[e("div",{onClick:ne=>Ft(u)},"编辑",8,$i)]),_:2},1024)):v("",!0),t(oe,{disabled:u.status==6||u.status==7||u.status==0},{default:s(()=>[e("div",{onClick:ne=>ge(u)},"预览",8,Si)]),_:2},1032,["disabled"]),t(oe,{onClick:ne=>yt(u)},{default:s(()=>[...o[54]||(o[54]=[e("div",null,"重命名",-1)])]),_:1},8,["onClick"]),t(jt,{title:"确定要删除吗?",onConfirm:ne=>Ye(u)},{default:s(()=>[t(oe,null,{default:s(()=>[...o[55]||(o[55]=[e("span",null,"删除",-1)])]),_:1})]),_:1},8,["onConfirm"]),t(oe,{onClick:ne=>So(u)},{default:s(()=>[...o[56]||(o[56]=[e("div",null,"修改分组",-1)])]),_:1},8,["onClick"]),t(oe,{onClick:ne=>$o(u)},{default:s(()=>[...o[57]||(o[57]=[e("div",null,"下载文档",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[e("div",{class:"table-btn",onClick:o[10]||(o[10]=ie(()=>{},["prevent"]))},[t(q(Is),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1})]),t(Jt,{open:Q.open,"onUpdate:open":o[12]||(o[12]=f=>Q.open=f),"confirm-loading":Q.confirmLoading,maskClosable:!1,title:"上传文档",onOk:he,onCancel:Ze,width:"740px"},{default:s(()=>[t(Yt,{class:"mt24"},{default:s(()=>[t(Ne,{required:"",label:""},{default:s(()=>[e("div",Li,[t(ho,{type:$.value.type,maxCount:20,value:Q.fileList,"onUpdate:value":o[11]||(o[11]=f=>Q.fileList=f),onChange:mt},null,8,["type","value"])])]),_:1}),Ie.value?(n(),F(Ne,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:s(()=>[e("div",qi,[(n(),a(H,null,de(j,f=>e("div",{key:f.key,class:fe(["select-card-item",{active:Q.pdf_parse_type==f.key},{disabled:f.key==4&&!L.value}]),onClick:ie(u=>w(f),["stop"])},[t(y,{class:"check-arrow",name:"check-arrow-filled"}),e("div",Ii,[t(y,{name:f.icon,style:{"font-size":"16px"}},null,8,["name"]),m(" "+h(f.title)+" ",1),f.key==4&&!L.value?(n(),a("div",Ri,"未开启")):v("",!0)]),e("div",Ui,h(f.desc),1),f.key==4&&!L.value?(n(),a("div",Di,[o[58]||(o[58]=m(" 未开启阿里云OCR ",-1)),e("div",{class:"card-switch-btn",onClick:ie(Re,["stop"])},"去开启")])):v("",!0)],10,Oi)),64))])]),_:1})):v("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),t(ko,{onOk:ae,ref_key:"qaUploadModalRef",ref:Ge},null,512),t(Jt,{open:B.open,"onUpdate:open":o[16]||(o[16]=f=>B.open=f),"confirm-loading":B.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:ve,onCancel:_e},{default:s(()=>[t(Yt,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:p,model:B,rules:B.rules},{default:s(()=>[t(Ne,{name:"urls",label:"网页链接"},{default:s(()=>[t(To,{style:{height:"120px"},value:B.urls,"onUpdate:value":o[13]||(o[13]=f=>B.urls=f),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),t(Ne,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:s(()=>[t(Qt,{value:B.doc_auto_renew_frequency,"onUpdate:value":o[14]||(o[14]=f=>B.doc_auto_renew_frequency=f),style:{width:"100%"}},{default:s(()=>[t(Te,{value:1},{default:s(()=>[...o[59]||(o[59]=[m("不自动更新",-1)])]),_:1}),t(Te,{value:2},{default:s(()=>[...o[60]||(o[60]=[m("每天",-1)])]),_:1}),t(Te,{value:3},{default:s(()=>[...o[61]||(o[61]=[m("每3天",-1)])]),_:1}),t(Te,{value:4},{default:s(()=>[...o[62]||(o[62]=[m("每7天",-1)])]),_:1}),t(Te,{value:5},{default:s(()=>[...o[63]||(o[63]=[m("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),B.doc_auto_renew_frequency>1?(n(),F(Ne,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[t(Fo,{valueFormat:"HH:mm",value:B.doc_auto_renew_minute,"onUpdate:value":o[15]||(o[15]=f=>B.doc_auto_renew_minute=f),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),t(cl,{libraryInfo:$.value,group_id:d.value,onOk:pe,ref_key:"addCustomDocumentRef",ref:Oe},null,8,["libraryInfo","group_id"]),t(Ms,{onOk:pe,ref_key:"renameModalRef",ref:et},null,512),t(Ds,{onOk:ht,ref_key:"openGrapgModalRef",ref:i},null,512),t(gl,{ref_key:"guideLearningTipsRef",ref:g},null,512),t(hl,{onOk:ae,ref_key:"editOnlineDocRef",ref:Tt},null,512),t(bo,{group_type:"1",ref_key:"addGroupRef",ref:zt,onOk:kt},null,512),t(xl,{libraryId:x.value,sense:1,ref_key:"editGroupRef",ref:Et,onOk:kt},null,8,["libraryId"]),t(Ll,{ref_key:"feishuRef",ref:r,libraryId:x.value,onOk:kt},null,8,["libraryId"])])}}},Qi=ke(Mi,[["__scopeId","data-v-fbeb3760"]]);export{Qi as K,Vi as Q};
