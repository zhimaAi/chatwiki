import{_ as ae}from"./cu-scroll-CeyRYmkN.js";import{_ as le}from"./page-alert-i26_USk5.js";import{b as Q,cf as W,d as ie,cg as re,h as ue,ch as de}from"../../index-ZzVqUZIR.js";import{r as M,q as pe,Y as h,_,k as t,a2 as s,a5 as n,n as _e,a1 as N,ae as R,G as m,u as g,a7 as c,F as I,a9 as J,B as V,f as v,o as ce,a4 as B,ab as me,af as ge}from"./vue-chunks-yZ4gwLzA.js";import{w as fe,p as ve,a5 as G,aa as be,ae as ye,ab as he,bu as we,x as xe,M as P,a as D,O as Y,F as H,e as ke,W as Se,$ as $e,a0 as Ce,i as qe,j as Oe,ax as Fe,y as Ke,J as Re,B as De,br as Le,D as Ee,g as ze,b as Ue,c as Ae,bv as Be}from"./ui-antd-BJtyvQX6.js";import{u as Me}from"./util-BwuffJOK.js";import{U as Ne}from"./index-D_L7CMlN.js";import{I as Ie}from"./import-knowledge-modal-DgpzZNyM.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./utils-smNh_pj2.js";import"./index-BfMA38Vj.js";import"./validate-8MtiUsxW.js";import"./model-select-DoQzbsHY.js";import"./index-CkBKI6U4.js";const Qe={class:"subsection-box"},Pe={class:"qa-list-box"},Te={class:"list-item"},je={class:"list-content"},Je={class:"status-error"},Ve={class:"similar-question-list"},Ge={class:"list-item list-item-answer"},He={class:"list-content"},We={class:"fragment-img"},Ye=["src"],Xe={key:0,class:"status-block status-green"},Ze={key:1,class:"status-block status-gray"},et=["href"],tt={class:"right-opration"},st=["onClick"],nt=["onClick"],ot={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1}},emits:["handleDelParagraph","openEditSubscription"],setup(L,{expose:F,emit:E}){const w=E,x=L,f=M({selectedRowKeys:[]}),k=r=>{f.selectedRowKeys=r},i=()=>{f.selectedRowKeys=[]},S=r=>{w("openEditSubscription",r)},q=r=>{P.confirm({title:"提示",icon:t(Y),content:"确认是否删除该分段?",onOk(){return new Promise((d,O)=>{W({ids:r}).then(K=>{D.success("删除成功"),w("handleDelParagraph",r),d()}).catch(()=>{d()})})},onCancel(){}})};return F({handleOpenEditModal:S,state:f,resetSelect:i}),(r,d)=>{const O=ve,K=be,u=fe,a=xe,p=pe("viewer");return _(),h("div",Qe,[t(a,{"data-source":L.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:f.selectedRowKeys,onChange:k},pagination:!1,loading:x.isLoading},{default:s(()=>[t(u,{key:"id","data-index":"id",width:1148},{title:s(()=>[m("问答（共"+c(x.total)+"个）",1)]),default:s(({record:o})=>[n("div",Pe,[n("div",Te,[d[0]||(d[0]=n("div",{class:"list-label"},"问题",-1)),n("div",je,[o.status==2?(_(),N(O,{key:0,placement:"top"},{title:s(()=>[n("span",null,c(o.errmsg),1)]),default:s(()=>[n("span",null,[n("span",Je,[t(g(G))])])]),_:2},1024)):R("",!0),m(" "+c(o.question)+" ",1),o.similar_questions&&o.similar_questions.length?(_(),N(K,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[n("div",Ve,[(_(!0),h(I,null,J(o.similar_questions,($,b)=>(_(),h("div",{class:"similar-question-list-item",key:b},c($),1))),128))])]),title:s(()=>[n("span",null,"共 "+c(o.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[n("a",null,"（"+c(o.similar_questions.length)+"）",1)]),_:2},1024)):R("",!0)])]),n("div",Ge,[d[1]||(d[1]=n("div",{class:"list-label"},"答案",-1)),n("div",He,c(o.answer),1)]),_e((_(),h("div",We,[(_(!0),h(I,null,J(o.images,($,b)=>(_(),h("img",{key:b,src:$,alt:""},null,8,Ye))),128))])),[[p]])])]),_:1}),t(u,{title:"是否导入知识库",key:"is_import","data-index":"is_import",width:180},{default:s(({record:o})=>[o.is_import==1?(_(),h("div",Xe,[t(g(ye)),d[2]||(d[2]=m("已导入 ",-1))])):R("",!0),o.is_import==0?(_(),h("div",Ze,[t(g(G)),d[3]||(d[3]=m("未导入 ",-1))])):R("",!0),n("div",null,[n("a",{href:`/#/library/details/knowledge-document?id=${o.library_id}`,target:"_blank"},c(o.library_name),9,et)])]),_:1}),t(u,{title:"操作",key:"action","data-index":"action",width:120},{default:s(({record:o,index:$})=>[n("div",tt,[n("div",{class:"hover-btn-box",onClick:V(b=>S(o),["stop"])},[t(g(he))],8,st),n("div",{class:"hover-btn-box",onClick:V(b=>q(o.id),["stop"])},[t(g(we))],8,nt)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},at=Q(ot,[["__scopeId","data-v-5c44c0f0"]]),lt={class:"form-box"},it={class:"upload-box-wrapper"},rt={key:0},ut={__name:"edit-subsection",emits:["ok"],setup(L,{expose:F,emit:E}){const w=E,x=v(!1),f=v("1"),k=H.useForm,i=M({images:[],question:"",answer:"",id:""}),S=M({question:[{required:!0,message:"请输入分段问题",trigger:"change"}],answer:[{required:!0,message:"请输入分段答案",trigger:"change"}]}),{validate:q,validateInfos:r}=k(i,S),d=()=>{q().then(()=>{O()}).catch(u=>{})},O=()=>{let u={...i},a=new FormData;for(let p in u)Me.isArray(u[p])?u[p].forEach(o=>{a.append(p,o)}):a.append(p,u[p]);re(a).then(p=>{D.success("编辑成功"),x.value=!1,w("ok")})};return F({show:u=>{i.question=u.question,i.answer=u.answer,i.id=u.id,i.title=u.title,i.images=u.images||[],x.value=!0}}),ce(()=>{}),(u,a)=>{const p=Se,o=ke,$=ie,b=Ce,z=$e,U=H,l=P;return _(),N(l,{open:x.value,"onUpdate:open":a[4]||(a[4]=e=>x.value=e),onOk:d,title:"编辑分段",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:944},{default:s(()=>[n("div",lt,[t(U,{layout:"vertical"},{default:s(()=>[t(o,B({ref:"question",label:"分段问题"},g(r).question),{default:s(()=>[t(p,{placeholder:"请输入分段问题",value:i.question,"onUpdate:value":a[0]||(a[0]=e=>i.question=e),style:{height:"100px"}},null,8,["value"])]),_:1},16),t(o,B({ref:"answer",label:"分段答案"},g(r).answer),{default:s(()=>[t(p,{placeholder:"请输入分段问题",value:i.answer,"onUpdate:value":a[1]||(a[1]=e=>i.answer=e),style:{height:"100px"}},null,8,["value"])]),_:1},16),t(o,B({label:"附件"},g(r).images),{default:s(()=>[n("div",it,[t(z,{activeKey:f.value,"onUpdate:activeKey":a[2]||(a[2]=e=>f.value=e),size:"small"},{default:s(()=>[t(b,{key:"1"},{tab:s(()=>[n("span",null,[t($,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),a[5]||(a[5]=m(" 图片 ",-1)),i.images.length?(_(),h("span",rt,"("+c(i.images.length)+")",1)):R("",!0)])]),_:1})]),_:1},8,["activeKey"]),t(Ne,{value:i.images,"onUpdate:value":a[3]||(a[3]=e=>i.images=e)},null,8,["value"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])}}},dt=Q(ut,[["__scopeId","data-v-da7576bf"]]),pt={class:"main-content-box"},_t={class:"breadcrumb-block"},ct={class:"btn-wrapper-box"},mt={class:"content-block"},gt={class:"pagination-box"},ft={__name:"index",setup(L){const F=ue(),w=me().query,x=w.file_name,f=v(""),k=v(null),i=v(0),S=v(!1),q=v([]),r=v({page:1,size:100}),d=v(null),O=l=>{d.value.show(JSON.parse(JSON.stringify(l)))},K=(l,e)=>{r.value.page=l,r.value.size=e,a()},u=()=>{r.value.page=1,a()},a=()=>{S.value=!0,de({...r.value,id:w.id,is_import:f.value}).then(l=>{let e=l.data.list||[];e.forEach(C=>{C.images&&(C.images=JSON.parse(C.images))}),q.value=e,i.value=l.data.total,U(l.data.total,l.data.import_total),k.value.resetSelect()}).finally(()=>{S.value=!1})};a();const p=v(null),o=()=>{let l=k.value.state.selectedRowKeys;if(l.length==0)return D.error("请选择你要导入的问答");p.value.show({id:w.id,ids:l.join(",")})},$=()=>{let l=k.value.state.selectedRowKeys;if(l.length==0)return D.error("请选择你要删除的问答");P.confirm({title:"提示",icon:t(Y),content:"确认是否删除选中的分段?",onOk(){W({ids:l.join(",")}).then(e=>{D.success("删除成功"),a()})},onCancel(){}})},b=l=>{let e=F.getToken,C=`/manage/exportFAQFileAllQA?id=${w.id}&token=${e}&ext=${l}`;window.location.href=C},z=v([]),U=(l,e)=>{z.value=[{value:"",payload:{num:l,title:"全部"}},{value:0,payload:{num:l-e,title:"未导入"}},{value:1,payload:{num:e,title:"已导入"}}]};return(l,e)=>{const C=ge("router-link"),T=Oe,X=qe,Z=Ke,A=De,j=Ae,ee=Ue,te=Ee,se=Re,ne=Be,oe=ae;return _(),h(I,null,[n("div",pt,[t(oe,{style:{"padding-right":"48px"},scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[n("div",_t,[t(X,null,{default:s(()=>[t(T,null,{default:s(()=>[t(C,{to:"/ai-extract-faq/list"},{default:s(()=>[t(g(Fe)),e[5]||(e[5]=m(" 文档提取FAQ ",-1))]),_:1})]),_:1}),t(T,null,{default:s(()=>[m(c(g(x)),1)]),_:1})]),_:1})]),t(le,{class:"mb16",title:"使用说明"},{default:s(()=>[...e[6]||(e[6]=[n("div",null,[n("p",null," 您可以查看、编辑提取处的问答对，并直接将问答对导入到知识库中。您也可以将知识库下载成文档，批量导入导问答知识库中。 ")],-1)])]),_:1}),n("div",ct,[t(Z,{onChange:u,value:f.value,"onUpdate:value":e[0]||(e[0]=y=>f.value=y),options:z.value},{label:s(({payload:y={}})=>[n("div",null,c(y.title)+"（"+c(y.num)+"）",1)]),_:1},8,["value","options"]),t(se,{gap:8},{default:s(()=>[t(A,{onClick:o,type:"primary",icon:t(g(Le))},{default:s(()=>[...e[7]||(e[7]=[m("导入知识库",-1)])]),_:1},8,["icon"]),t(A,{onClick:$},{default:s(()=>[...e[8]||(e[8]=[m("批量删除",-1)])]),_:1}),t(te,null,{overlay:s(()=>[t(ee,null,{default:s(()=>[t(j,{onClick:e[1]||(e[1]=y=>b("docx")),key:"1"},{default:s(()=>[...e[9]||(e[9]=[m("下载为docx",-1)])]),_:1}),t(j,{onClick:e[2]||(e[2]=y=>b("xlsx")),key:"2"},{default:s(()=>[...e[10]||(e[10]=[m("下载为xlsx",-1)])]),_:1})]),_:1})]),default:s(()=>[t(A,{type:"primary"},{default:s(()=>[e[11]||(e[11]=m(" 下载 ",-1)),t(g(ze))]),_:1})]),_:1})]),_:1})]),n("div",mt,[t(at,{ref_key:"subsectionBoxRef",ref:k,total:i.value,isLoading:S.value,paragraphLists:q.value,onOpenEditSubscription:O,onHandleDelParagraph:a},null,8,["total","isLoading","paragraphLists"]),n("div",gt,[t(ne,{current:r.value.page,"onUpdate:current":e[3]||(e[3]=y=>r.value.page=y),"page-size":r.value.size,"onUpdate:pageSize":e[4]||(e[4]=y=>r.value.size=y),total:i.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:K},null,8,["current","page-size","total"])])])]),_:1})]),t(dt,{ref_key:"editSubscriptionRef",ref:d,onOk:a},null,512),t(Ie,{ref_key:"importKnowledgeModalRef",ref:p,onOk:u},null,512)],64)}}},Dt=Q(ft,[["__scopeId","data-v-f8f8a40f"]]);export{Dt as default};
