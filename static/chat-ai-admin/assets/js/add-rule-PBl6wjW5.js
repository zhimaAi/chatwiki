import{_ as rt,d as st}from"../../index-CB2DywzJ.js";import{aw as ut,f as C,e as de,r as E,w as J,o as dt,ac as x,k as i,as as c,ar as p,u as q,av as pt,ad as S,G as Y,B as L,F as X,ax as W,at as Q,ai as pe,n as me,az as O,A as mt,aH as _t,aG as yt,ae as _e,y as ye}from"./vue-chunks-CGLjTDrY.js";import{E as ft,e as ct,P as vt,M as gt}from"./multi-reply-CV3HEx6I.js";import{c as kt,e as fe,f as wt,h as ce,i as ht}from"./index-CtAQivSJ.js";import{b as h,m as Mt,F as St,M as bt,n as Ct,e as Dt,I as xt,$ as Lt,k as $t,h as At,i as Pt,v as Yt,ae as Rt,aJ as Tt,aP as It,B as Ut,y as Nt,z as Ot,a6 as Bt,d as F}from"./ui-antd-BHaxN-GS.js";import{u as qt}from"./robot-BQqgDPGj.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";import"./index-DxgALpad.js";import"./index-CoChppVN.js";const Ft="/assets/img/smart-menu-rule-XgK3l2pz.png",Ht={class:"subManage-edit"},zt=["href"],Et={class:"main"},Jt={class:"left-pane"},Kt={class:"menu-content-box"},Vt={class:"insert-row"},jt=["onClick"],Gt={class:"title-list"},Xt=["onDragstart","onDragenter","onDragleave","onDrop"],Wt={class:"title-item"},Qt={class:"drag-handle"},Zt=["onClick"],en=["onUpdate:modelValue","onBlur","onKeyup"],tn=["onClick"],nn=["onClick"],ln=["onMousedown"],on=["onMousedown"],an=["onMousedown"],rn=["onMousedown"],sn={class:"row-icons"},un={class:"btn-container"},dn={class:"right-pane"},pn=["src"],mn={class:"item-box"},_n={class:"tips-box"},yn=10,fn={__name:"add-rule",setup(cn){const Z={span:3},ee={span:21},D=ut().query,B=C(+D.rule_id||+D["rule-id"]||0),ve=pt(),ge=de(()=>`/#/robot/ability/smart-menu?id=${D.id}&robot_key=${D.robot_key}`),ke=qt(),we=de(()=>ke.keywordReplySwitchStatus==="1"),te=C(null),r=E({menu_title:"",menu_description:""}),he={},ne=C([]),Me=new ft(ct),K=C(!1),le=C(null),Se=["yyyy-MM-dd hh:mm:ss","MM-dd hh:mm:ss","yyyy-MM-dd hh:mm","MM-dd hh:mm","yyyy-MM-dd","MM月dd日"];function be(t){const e={"yyyy-MM-dd hh:mm:ss":"YYYY-MM-DD HH:mm:ss","MM-dd hh:mm:ss":"MM-DD HH:mm:ss","yyyy-MM-dd hh:mm":"YYYY-MM-DD HH:mm","MM-dd hh:mm":"MM-DD HH:mm","yyyy-MM-dd":"YYYY-MM-DD",MM月dd日:"MM月DD日"};return F().format(e[t]||"YYYY-MM-DD HH:mm:ss")}function oe(t){var n,d;const e=(d=(n=le.value)==null?void 0:n.$el)==null?void 0:d.querySelector("textarea");if(e&&typeof e.selectionStart=="number"){const u=e.selectionStart,_=e.selectionEnd,w=r.menu_description||"";r.menu_description=w.slice(0,u)+t+w.slice(_),ye(()=>{e.focus();const a=Math.min(u+t.length,(r.menu_description||"").length);e.setSelectionRange(a,a)})}else r.menu_description=(r.menu_description||"")+t}function Ce(t){oe(`{{${t}}}`)}function De(t){const e=(t==null?void 0:t.native)||"";e&&(oe(e),K.value=!1)}function xe(){return document.body}function Le(t,e){return e?/^https?:\/\//.test(String(e))?Promise.resolve():Promise.reject("链接需以http或https开头"):Promise.resolve()}function $e(t,e){return e?/^wx/.test(String(e))?Promise.resolve():Promise.reject("当前填写的appid可能不是小程序的appid，请检查核实。"):Promise.resolve()}function V(){const t=String(o.keyword||"").trim();t&&ce({id:o.rule_id||0,robot_id:D.id,keyword:t}).then(e=>{var u,_;const n=(u=e==null?void 0:e.data)==null?void 0:u.is_repeat,d=((_=e==null?void 0:e.data)==null?void 0:_.rule_name)||"";n&&h.error(`关键词与规则「${d}」重复`)})}function Ae(t){return(t||[]).map(e=>({...e,status:"1"}))}function Pe(t){const e={text:"2",image:"4",card:"3",imageText:"1",url:"5",smartMenu:"6"};return(t||[]).map(n=>e[n.type]||"").filter(Boolean)}function Ye(t,e){return Array.isArray(f.value)&&f.value.length>0?Promise.resolve():Promise.reject("请至少添加一个菜单标题")}const f=C([{id:Date.now(),text:"",isPure:!1,orderDisplay:1,replyConfig:null,editingIndex:!1,orderDisplayStr:""}]),H=C(""),T=C(null),j=C(!1);let $=-1;const R=C(-1);function Re(t){$=t}function Te(t){if($===-1||$===t){R.value=t;return}const e=[...f.value],[n]=e.splice($,1);e.splice(t,0,n),f.value=e,$=t,R.value=t}function Ie(t){R.value===t&&(R.value=-1)}function Ue(t){if($===t||$<0)return;const e=[...f.value],[n]=e.splice($,1);e.splice(t,0,n),f.value=e,$=-1,R.value=-1}function Ne(){$=-1,R.value=-1}function Oe(t){const e=f.value[t];T.value=(e==null?void 0:e.id)??null}function Be(t){const e=f.value[t];setTimeout(()=>{if(j.value){j.value=!1;return}(T.value??null)===((e==null?void 0:e.id)??null)&&(T.value=null)},0)}function qe(){j.value=!0}function Fe(t){const e=f.value[t];e.text="当前行为换行",e.isPure=!0,e.isNewline=!0,e.replyConfig=null,T.value=null}function He(t){const e=f.value[t];e.isPure=!0,e.replyConfig=null}function ze(t){const e=f.value.length;if(e>=yn){h.warning("菜单标题最多10条");return}const n=e+1;f.value.splice(t+1,0,{id:Date.now()+Math.random(),text:"",isPure:!1,orderDisplay:n,replyConfig:null,editingIndex:!1,orderDisplayStr:""})}function Ee(t){if(f.value.length<=1){h.warning("至少保留1条菜单标题");return}f.value.splice(t,1)}function Je(t){const e=f.value[t];e.orderDisplayStr=String(e.orderDisplay||""),e.editingIndex=!0,ye(()=>{})}function ae(t){const e=f.value[t],n=parseInt(String(e.orderDisplayStr||"").replace(/\D+/g,""),10);e.orderDisplay=isNaN(n)?e.orderDisplay:Math.max(1,Math.min(10,n)),e.editingIndex=!1}J(f,t=>{try{const e=(t||[]).map(n=>({menu_type:n.isPure?"0":"1",content:String(n.text||"")}));H.value=JSON.stringify(e)}catch{H.value=String((t||[]).length||"")}},{deep:!0,immediate:!0});const I=C(!1),o=E({rule_name:"",match_type:"full",keyword:"",replyList:[{type:"text",description:""}]});let A=-1;function ie(t){var n,d,u,_,w;if(!f.value[t].text){h.error("请输入菜单标题");return}A=t;const e=f.value[t];o.rule_name=((n=e.replyConfig)==null?void 0:n.rule_name)||String(e.text||""),o.keyword=((d=e.replyConfig)==null?void 0:d.keyword)||String(e.text||""),o.match_type=((u=e.replyConfig)==null?void 0:u.match_type)||"full",o.replyList=Array.isArray((_=e.replyConfig)==null?void 0:_.replyList)?JSON.parse(JSON.stringify(e.replyConfig.replyList)):[{type:"text",description:""}],o.rule_id=((w=e.replyConfig)==null?void 0:w.rule_id)||e.rule_id||"",o.rule_id&&fe({id:o.rule_id}).then(a=>{const y=(a==null?void 0:a.data)||{};o.rule_name=(y==null?void 0:y.name)||o.rule_name;const v=Array.isArray(y==null?void 0:y.full_keyword)?y.full_keyword:[],M=Array.isArray(y==null?void 0:y.half_keyword)?y.half_keyword:[];v.length>0?(o.match_type="full",o.keyword=String(v[0]||"")):M.length>0&&(o.match_type="partial",o.keyword=String(M[0]||""));const s=Array.isArray(y==null?void 0:y.reply_content)?y.reply_content:[];o.replyList=s.map(m=>({type:(m==null?void 0:m.type)||(m==null?void 0:m.reply_type)||"text",description:(m==null?void 0:m.description)||"",thumb_url:(m==null?void 0:m.thumb_url)||(m==null?void 0:m.pic)||"",title:(m==null?void 0:m.title)||"",url:(m==null?void 0:m.url)||"",appid:(m==null?void 0:m.appid)||"",page_path:(m==null?void 0:m.page_path)||"",smart_menu_id:(m==null?void 0:m.smart_menu_id)||"",smart_menu:(m==null?void 0:m.smart_menu)||{}}))}).catch(()=>{}),I.value=!0}async function Ke(){if(A<0){I.value=!1;return}const t=String(o.rule_name||"").trim(),e=String(o.keyword||"").trim();if(!t||!e){h.warning("请完善规则名与关键字");return}if(!Array.isArray(o.replyList)||o.replyList.length===0){h.warning("请至少添加一条回复内容");return}for(const n of ne.value)if(n&&n.validate&&!await n.validate())return;ce({id:o.rule_id||0,robot_id:D.id,keyword:e}).then(n=>{var w,a;const d=(w=n==null?void 0:n.data)==null?void 0:w.is_repeat,u=((a=n==null?void 0:n.data)==null?void 0:a.rule_name)||"";if(d)return h.error(`关键词与规则「${u}」重复`),Promise.reject("repeat");const _={robot_id:D.id,name:t,full_keyword:o.match_type==="full"?[e]:[],half_keyword:o.match_type==="partial"?[e]:[],reply_content:JSON.stringify(Ae(o.replyList)),reply_type:Pe(o.replyList),reply_num:"0",forced_enable:1};return o.rule_id&&(_.id=o.rule_id),ht(_)}).then(n=>{var _;if(!(n&&n.res==0)){h.error("保存失败，请稍后重试");return}const d=((_=n==null?void 0:n.data)==null?void 0:_.id)||"",u={rule_name:o.rule_name,keyword:o.keyword,match_type:o.match_type,replyList:JSON.parse(JSON.stringify(o.replyList)),rule_id:String(d||o.rule_id||"")};f.value[A].replyConfig=u,o.rule_id=u.rule_id,I.value=!1,h.success("保存成功")}).catch(n=>{})}function Ve(){I.value=!1}function je(){o.replyList.length>=5||o.replyList.push({type:"text",description:""})}function Ge(t){o.replyList.splice(t,1)}function Xe({reply_index:t,...e}){t>=0&&t<o.replyList.length&&(o.replyList[t]=e)}const U=C(!1),b=E({title:"",appid:"",path:""}),N=C(!1),P=E({title:"",url:""});function re(t){t==="appid"?window.open("https://www.kancloud.cn/wikizhima/wikixkf/1011121","_blank"):window.open("https://www.kancloud.cn/wikizhima/wikixkf/1010959","_blank")}function We(t){A=t;const e=f.value[t],n=String(e.text||"");let d=n,u="",_="";if(/<a[\s\S]*?<\/a>/i.test(n)){const w=n.match(/<a[\s\S]*?>([\s\S]*?)<\/a>/i),a=n.match(/data-miniprogram-appid=['"][\s\S]*?['"]/i),y=n.match(/data-miniprogram-path=['"][\s\S]*?['"]/i);if(w&&w[1]!=null&&(d=w[1]),a){const v=String(a[0]||"").match(/data-miniprogram-appid=['"]\s*([^'"]+)\s*['"]/i);v&&v[1]!=null&&(u=v[1])}if(y){const v=String(y[0]||"").match(/data-miniprogram-path=['"]\s*([^'"]+)\s*['"]/i);v&&v[1]!=null&&(_=v[1])}}b.title=String(d||""),b.appid=String(u||""),b.path=String(_||""),U.value=!0}function Qe(){const t=String(b.title||"").trim(),e=String(b.appid||"").trim(),n=String(b.path||"").trim();if(!t||!e||!n){h.warning("请完善小程序卡片信息");return}if(!/^wx/.test(e)){h.warning("当前填写的appid可能不是小程序的appid，请检查核实。");return}if(A<0){U.value=!1;return}const d=f.value[A];d.text=`<a  href='#' data-miniprogram-path='${n}' data-miniprogram-appid='${e}'  >${t}</a>`,d.linkType="mini",d.replyConfig=null,U.value=!1}function Ze(){U.value=!1}function et(t){A=t;const e=f.value[t],n=String(e.text||"");let d=n,u="";if(/<a[\s\S]*?<\/a>/i.test(n)){const _=n.match(/<a[\s\S]*?>([\s\S]*?)<\/a>/i),w=n.match(/href\s*=\s*['"][\s\S]*?['"]/i);if(_&&_[1]!=null&&(d=_[1]),w){const a=String(w[0]||"").match(/href\s*=\s*['"]\s*([^'"]+)\s*['"]/i);a&&a[1]!=null&&(u=a[1])}u&&(u=u.replace(/`/g,"").trim())}P.title=String(d||""),P.url=String(u||""),N.value=!0}function tt(){const t=String(P.title||"").trim(),e=String(P.url||"").trim();if(!t||!e){h.warning("请完善链接信息");return}if(!/^https?:\/\//.test(e)){h.warning("链接需以http或https开头");return}if(A<0){N.value=!1;return}const n=f.value[A];n.text=`<a href="${e}">${t}</a>`,n.linkType="url",n.replyConfig=null,N.value=!1}function nt(){N.value=!1}J(()=>r.duration_type,t=>{t==="week"?((!Array.isArray(r.week_day)||r.week_day.length===0)&&(r.week_day=["1"]),r.week_duration=Array.isArray(r.week_day)?r.week_day:[r.week_day]):t==="time_range"&&Array.isArray(r.date_range)&&r.date_range.length===2&&r.date_range[0]&&r.date_range[1]?(r.start_day=F(r.date_range[0]).format("YYYY-MM-DD"),r.end_day=F(r.date_range[1]).format("YYYY-MM-DD")):(r.start_day="",r.end_day="")}),J(()=>r.week_day,t=>{r.duration_type==="week"&&(r.week_duration=Array.isArray(t)?t:[t])}),J(()=>r.date_range,t=>{r.duration_type==="time_range"&&Array.isArray(t)&&t.length===2&&t[0]&&t[1]&&(r.start_day=F(t[0]).format("YYYY-MM-DD"),r.end_day=F(t[1]).format("YYYY-MM-DD"))});const lt=()=>{var t;(t=te.value)==null||t.validate().then(async()=>{if(!r.menu_title||!r.menu_description){h.warning("请完善菜单名称和菜单内容");return}const e=f.value.map(d=>{var M,s;const u=!!d.linkType,_=!!d.isPure,w=d.isNewline===!0,a=String(d.text||"");if(w||a==="")return{menu_type:"0",serial_no:"",content:"",rule_id:""};if(u)return{menu_type:"0",serial_no:"",content:a,rule_id:""};if(_)return{menu_type:"0",serial_no:"",content:a,rule_id:""};const y=String(((M=d.replyConfig)==null?void 0:M.id)||((s=d.replyConfig)==null?void 0:s.rule_id)||"");return{menu_type:"1",serial_no:String(d.orderDisplay||""),content:a,rule_id:y}}),n={robot_id:D.id,menu_title:r.menu_title,menu_description:r.menu_description,menu_content:JSON.stringify(e)};B.value&&(n.id=B.value);try{const d=await wt(n);d&&d.res==0&&(h.success("保存成功"),ve.push({path:"/robot/ability/smart-menu",query:{id:D.id,robot_key:D.robot_key}}))}catch{h.error("保存失败，请稍后重试")}})};return dt(async()=>{const t=+(D.copy_id||0),e=async n=>{const d=await kt({id:n,robot_id:D.id}),u=(d==null?void 0:d.data)||{};if(r.menu_title=u.menu_title||"",r.menu_description=u.menu_description||u.menu_content||"",Array.isArray(u.menu_content)){const _=u.menu_content;f.value=_.map((a,y)=>{const v=String((a==null?void 0:a.menu_type)||""),M=String((a==null?void 0:a.content)||""),s=/<a[\s\S]*?<\/a>/.test(M),m=s&&/data-miniprogram-appid/i.test(M);return{id:Date.now()+y,text:v==="0"&&M===""?"当前行为换行":M,isPure:v==="0",isNewline:v==="0"&&M==="",orderDisplay:a&&a.serial_no!==void 0&&String(a.serial_no).trim()!==""?Number(a.serial_no):y+1,editingIndex:!1,orderDisplayStr:"",replyConfig:null,linkType:s?m?"mini":"url":"",rule_id:String((a==null?void 0:a.rule_id)||"")}});const w=f.value.map((a,y)=>({idx:y,rid:String(a.rule_id||"")})).filter(a=>!!a.rid);for(const a of w)try{const y=await fe({id:a.rid}),v=(y==null?void 0:y.data)||{},M=Array.isArray(v==null?void 0:v.reply_content)?v.reply_content:[];f.value[a.idx].replyConfig={rule_name:(v==null?void 0:v.name)||String(f.value[a.idx].text||""),keyword:String(f.value[a.idx].text||""),match_type:"full",replyList:M.map(s=>({type:(s==null?void 0:s.type)||(s==null?void 0:s.reply_type)||"text",description:(s==null?void 0:s.description)||"",thumb_url:(s==null?void 0:s.thumb_url)||(s==null?void 0:s.pic)||"",title:(s==null?void 0:s.title)||"",url:(s==null?void 0:s.url)||"",appid:(s==null?void 0:s.appid)||"",page_path:(s==null?void 0:s.page_path)||"",smart_menu_id:(s==null?void 0:s.smart_menu_id)||"",smart_menu:(s==null?void 0:s.smart_menu)||{}})),rule_id:a.rid}}catch{}}};try{if(!B.value&&t){await e(t);return}if(!B.value)return;await e(B.value)}catch{h.error("加载规则失败，请稍后重试")}}),(t,e)=>{const n=Ct,d=Mt,u=xt,_=Dt,w=Lt,a=Yt,y=Pt,v=At,M=$t,s=Rt,m=st,ot=Tt,se=Ut,z=St,ue=Ot,at=Nt,G=bt;return S(),x("div",Ht,[i(d,{class:"subManage-breadcrumb"},{default:p(()=>[i(n,null,{default:p(()=>[c("a",{href:ge.value},"智能菜单",8,zt)]),_:1}),i(n,null,{default:p(()=>[...e[20]||(e[20]=[Y("新增规则",-1)])]),_:1})]),_:1}),c("div",Et,[c("div",Jt,[i(z,{ref_key:"formRef",ref:te,model:r,rules:he,layout:"vertical"},{default:p(()=>[i(_,{name:"menu_title",label:"菜单名称",rules:[{required:!0,message:"请输入菜单名称"}]},{default:p(()=>[i(u,{value:r.menu_title,"onUpdate:value":e[0]||(e[0]=l=>r.menu_title=l),placeholder:"请输入"},null,8,["value"])]),_:1}),i(_,{name:"menu_description",label:"菜单内容",rules:[{required:!0,message:"请输入菜单内容"}]},{default:p(()=>[c("div",Kt,[i(w,{ref_key:"menuContentRef",ref:le,value:r.menu_description,"onUpdate:value":e[1]||(e[1]=l=>r.menu_description=l),rows:6,placeholder:"请输入菜单内容，每行一条"},null,8,["value"]),c("div",Vt,[e[22]||(e[22]=c("span",{class:"insert-label"},"插入：",-1)),i(M,null,{overlay:p(()=>[i(v,null,{default:p(()=>[(S(),x(X,null,W(Se,l=>i(y,{key:l},{default:p(()=>[i(a,{title:be(l)},{default:p(()=>[c("a",{onClick:L(g=>Ce(l),["prevent"])},Q(l),9,jt)]),_:2},1032,["title"])]),_:2},1024)),64))]),_:1})]),default:p(()=>[c("a",{class:"insert-btn",onClick:e[2]||(e[2]=L(()=>{},["prevent"]))},"时间")]),_:1}),i(s,{open:K.value,"onUpdate:open":e[3]||(e[3]=l=>K.value=l),placement:"bottomLeft",trigger:"click",getPopupContainer:xe},{content:p(()=>[i(q(vt),{data:q(Me),emojiSize:18,showPreview:!1,set:"apple",onSelect:De},null,8,["data"])]),default:p(()=>[e[21]||(e[21]=c("a",{class:"insert-btn"},"表情符号",-1))]),_:1},8,["open"])])])]),_:1}),i(_,{name:"menu_content",label:"菜单标题",rules:[{validator:Ye}]},{default:p(()=>[i(u,{value:H.value,"onUpdate:value":e[4]||(e[4]=l=>H.value=l),style:{display:"none"}},null,8,["value"]),i(ot,null,{default:p(()=>[c("div",Gt,[(S(!0),x(X,null,W(f.value,(l,g)=>(S(),x("div",{class:pe(["title-row",{"drag-over":R.value===g}]),key:l.id,draggable:"true",onDragstart:k=>Re(g),onDragover:e[6]||(e[6]=L(()=>{},["prevent"])),onDragenter:L(k=>Te(g),["prevent"]),onDragleave:k=>Ie(g),onDrop:L(k=>Ue(g),["prevent"]),onDragend:Ne},[c("div",Wt,[c("div",Qt,[i(q(It))]),!l.isPure&&!l.linkType?me((S(),x("div",{key:0,class:"index-badge",onClick:k=>Je(g)},Q(l.orderDisplay),9,Zt)),[[mt,!l.editingIndex]]):O("",!0),!l.isPure&&!l.linkType&&l.editingIndex?me((S(),x("input",{key:1,class:"index-input-edit",type:"number",min:"1",max:"10",inputmode:"numeric",autofocus:"","onUpdate:modelValue":k=>l.orderDisplayStr=k,onBlur:k=>ae(g),onKeyup:_t(k=>ae(g),["enter"])},null,40,en)),[[yt,l.orderDisplayStr]]):O("",!0),c("div",{class:pe(["input-box",{focused:T.value===l.id}])},[i(u,{value:l.text,"onUpdate:value":k=>l.text=k,disabled:l.isNewline===!0,placeholder:"请输入菜单标题、40个字以内",maxLength:"40",onFocus:k=>Oe(g,k),onBlur:k=>Be(g)},{suffix:p(()=>{var k;return[!l.isPure&&!l.linkType&&((k=l.replyConfig)!=null&&k.rule_id||l.rule_id||l.replyConfig)?(S(),x("a",{key:0,class:"suffix-action",onClick:it=>ie(g)},"编辑",8,tn)):!l.isPure&&!l.linkType&&!we.value?(S(),_e(a,{key:1},{title:p(()=>[...e[23]||(e[23]=[Y("需要开启自动回复",-1)])]),default:p(()=>[c("a",{class:"suffix-action disabled",onClick:e[5]||(e[5]=L(()=>{},["prevent"]))},"添加回复")]),_:1})):!l.isPure&&!l.linkType?(S(),x("a",{key:2,class:"suffix-action",onClick:it=>ie(g)},"添加回复",8,nn)):O("",!0)]}),_:2},1032,["value","onUpdate:value","disabled","onFocus","onBlur"]),T.value===l.id?(S(),x("div",{key:0,class:"float-toolbar",onMousedown:L(qe,["stop"])},[c("a",{onMousedown:L(k=>We(g),["prevent","stop"])},"插入小程序链接",40,ln),c("a",{onMousedown:L(k=>et(g),["prevent","stop"])},"插入网址链接",40,on),!l.isPure&&!l.linkType?(S(),x("a",{key:0,onMousedown:L(k=>He(g),["prevent","stop"])},"转为纯文本",40,an)):O("",!0),!l.isPure&&!l.linkType?(S(),x("a",{key:1,onMousedown:L(k=>Fe(g),["prevent","stop"])},"换行",40,rn)):O("",!0)],32)):O("",!0)],2)]),c("div",sn,[i(m,{onClick:k=>ze(g),name:"smart-add",size:"16",style:{color:"#8C8C8C",cursor:"pointer"}},null,8,["onClick"]),i(m,{onClick:k=>Ee(g),name:"smart-delete",size:"16",style:{color:"#8C8C8C",cursor:"pointer"}},null,8,["onClick"])])],42,Xt))),128))])]),_:1})]),_:1},8,["rules"]),c("div",un,[i(se,{type:"primary",onClick:lt},{default:p(()=>[...e[24]||(e[24]=[Y("保存",-1)])]),_:1})])]),_:1},8,["model"])]),c("div",dn,[c("img",{src:q(Ft),alt:"smart-menu-preview",class:"preview-smart-img"},null,8,pn)])]),i(G,{open:I.value,"onUpdate:open":e[10]||(e[10]=l=>I.value=l),title:`${o.rule_id?"编辑":"添加"}菜单标题回复内容`,width:720,onOk:Ke,onCancel:Ve},{default:p(()=>[i(z,{model:o,layout:"vertical",class:"reply-modal-form"},{default:p(()=>[i(_,{label:"规则名",name:"rule_name",rules:[{required:!0,message:"请输入规则名"}]},{default:p(()=>[i(u,{value:o.rule_name,"onUpdate:value":e[7]||(e[7]=l=>o.rule_name=l)},null,8,["value"])]),_:1}),i(_,{label:"关键字",name:"keyword",rules:[{required:!0,message:"请输入关键字"}]},{default:p(()=>[i(u,{value:o.keyword,"onUpdate:value":e[9]||(e[9]=l=>o.keyword=l),maxlength:30,placeholder:"请输入关键字",onFocus:V,onPressEnter:V,onBlur:V},{addonBefore:p(()=>[i(at,{value:o.match_type,"onUpdate:value":e[8]||(e[8]=l=>o.match_type=l),style:{width:"120px"}},{default:p(()=>[i(ue,{value:"full"},{default:p(()=>[...e[25]||(e[25]=[Y("全匹配",-1)])]),_:1}),i(ue,{value:"partial"},{default:p(()=>[...e[26]||(e[26]=[Y("半匹配",-1)])]),_:1})]),_:1},8,["value"])]),_:1},8,["value"]),e[27]||(e[27]=c("div",{class:"tip-box",style:{"margin-top":"4px"}},"关键字最多输入30个字",-1))]),_:1}),i(_,{name:"replyList",label:"回复内容",rules:[{required:!0,message:""}]},{default:p(()=>[c("div",mn,[(S(!0),x(X,null,W(o.replyList,(l,g)=>(S(),_e(gt,{key:g,ref_for:!0,ref_key:"replyRefs",ref:ne,value:o.replyList[g],"onUpdate:value":k=>o.replyList[g]=k,reply_index:g,show_smart:!0,onChange:Xe,onDel:Ge},null,8,["value","onUpdate:value","reply_index"]))),128)),i(se,{type:"dashed",style:{width:"100%"},disabled:o.replyList.length>=5,onClick:je},{icon:p(()=>[i(q(Bt))]),default:p(()=>[Y(" 添加回复内容("+Q(o.replyList.length)+"/5) ",1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),i(G,{open:U.value,"onUpdate:open":e[16]||(e[16]=l=>U.value=l),title:"编辑小程序卡片",width:720,onOk:Qe,onCancel:Ze},{default:p(()=>[i(z,{model:b,labelCol:Z,wrapperCol:ee},{default:p(()=>[i(_,{label:"卡片标题",name:"title",rules:[{required:!0,message:"请输入卡片标题"}]},{default:p(()=>[i(u,{value:b.title,"onUpdate:value":e[11]||(e[11]=l=>b.title=l),placeholder:"请输入卡片标题"},null,8,["value"])]),_:1}),i(_,{label:"Appid",name:"appid",rules:[{required:!0,message:"请输入Appid"},{validator:$e}]},{default:p(()=>[i(u,{value:b.appid,"onUpdate:value":e[12]||(e[12]=l=>b.appid=l),placeholder:"请输入Appid 格式为：wx*****"},null,8,["value"]),c("div",_n,[c("div",null,[e[28]||(e[28]=Y("1：小程序只能填写自己的appid；",-1)),c("a",{onClick:e[13]||(e[13]=l=>re("appid"))},"查找appid")]),c("div",null,[e[29]||(e[29]=Y("2：公众号只能填写跟公众号已经关联的小程序的appid；",-1)),c("a",{onClick:e[14]||(e[14]=l=>re("assoc"))},"查看关联方法")])])]),_:1},8,["rules"]),i(_,{label:"小程序路径",name:"path",rules:[{required:!0,message:"请输入小程序路径"}]},{default:p(()=>[i(u,{value:b.path,"onUpdate:value":e[15]||(e[15]=l=>b.path=l),placeholder:"请输入小程序路径"},null,8,["value"]),e[30]||(e[30]=c("div",{class:"tips-box"},[c("div",null,"小程序路径是指小程序的某一特定页面的地址，请联系小程序开发者获取路径,比如 pages/index/index?a=2&b=1。")],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),i(G,{open:N.value,"onUpdate:open":e[19]||(e[19]=l=>N.value=l),title:"编辑链接",width:720,onOk:tt,onCancel:nt},{default:p(()=>[i(z,{model:P,labelCol:Z,wrapperCol:ee},{default:p(()=>[i(_,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}]},{default:p(()=>[i(u,{value:P.title,"onUpdate:value":e[17]||(e[17]=l=>P.title=l),placeholder:"请输入标题"},null,8,["value"])]),_:1}),i(_,{label:"打开链接",name:"url",rules:[{required:!0,message:"请输入打开链接"},{validator:Le}]},{default:p(()=>[i(u,{value:P.url,"onUpdate:value":e[18]||(e[18]=l=>P.url=l),placeholder:"请输入打开链接 必须包含http:// 或 https://"},null,8,["value"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["open"])])}}},Ln=rt(fn,[["__scopeId","data-v-01b8290a"]]);export{Ln as default};
