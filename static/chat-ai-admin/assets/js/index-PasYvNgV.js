import{ag as de,r as i,j as Z,J as fe,i as H,a as r,b as n,e as z,p as o,F as O,l as U,y as B,v as m,t as F,q as ee,Y as ve,u as q,E as _e,ah as me,h as X}from"./vue-chunks-BdaA73Wf.js";import{E as he}from"./empty-box-DAN5iPDv.js";import{a6 as te,u as se}from"../../index-DSFcP5NQ.js";import{L as ye}from"./loading-box-CQ9Pukre.js";import{_ as ae}from"./emoji-mart-BBMRoEa3.js";import{q as ge,W as ke,I as be}from"./ui-antd-Dl1wwwCD.js";import{_ as we}from"./main-tab-CdcTMZsk.js";import{P as Ce}from"./public-network-check-BgOXIe2j.js";import{u as Re}from"./usePublicNetworkCheck-B51wgX5Y.js";import"./editor-cherry-CFIsbKoN.js";import"./empty-BFmzY9bl.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./list-tabs-Dv38O5dh.js";import"./index-BuURB1pl.js";const xe="/assets/img/default-mcp-5uSmehjD.png";function Se(w={}){return te.get({url:"/manage/getMcpSquareTypeList",params:w})}function qe(w={}){return te.get({url:"/manage/getMcpSquareList",params:w})}const Me={class:"_plugin-box"},Ee={key:1,class:"plugin-list"},Te=["onClick"],$e={class:"base-info"},Ae=["src"],Be={key:1,class:"avatar",src:xe},De={class:"info"},Ie={class:"head"},Le={class:"name zm-line1"},Ne=["href"],We={class:"source"},ze={class:"popover-type-box"},Oe={__name:"square",props:{filterData:{type:Object,default:null},scrollRoot:{type:Object,default:null}},setup(w,{expose:D}){const{t:I}=se("views.explore.mcp.components.square"),M=w;de();const h=i(!0),p=i([]),y=i({}),C=i({}),k=i({}),d=i(1),L=i(50),R=i(!0),x=i(!1),E=i(null);let b=null,l=0;Z(()=>{c(),window.addEventListener("resize",Y),ie()}),fe(()=>{window.removeEventListener("resize",Y),b&&(b.disconnect(),b=null)});function S(s,e){if(!s)return null;const t=document.createElement("canvas").getContext("2d");t.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const f=t.measureText(s).width,u=(e==null?void 0:e.title_width)||120;return f>u?s:null}function j(){p.value=[],d.value=1,R.value=!0,c(!0)}async function c(s=!1){h.value=!0;const e={...M.filterData||{},page:d.value,size:L.value};qe(e).then(a=>{var f;let t=((f=a==null?void 0:a.data)==null?void 0:f.data)||[];s||d.value===1?p.value=t:p.value=[...p.value,...t],R.value=Array.isArray(t)&&t.length>=L.value,H(()=>{P()})}).finally(()=>{h.value=!1,x.value=!1})}function J(s){window.open(s.source_url,"_blank")}function ne(s,e){const a=k.value[e];return Array.isArray(a)?a:s.filter_type_list}function oe(s,e){if(typeof s>"u")return;const a=y.value[s];e?a!==e&&(y.value[s]=e,P()):a&&delete y.value[s]}function le(){Object.keys(y.value).forEach(e=>{const a=y.value[e],t=p.value[Number(e)];if(!a||!t)return;const f=a.clientWidth,G=getComputedStyle(a).gap||"0px",T=parseFloat(G.split(" ")[0])||0,_=document.createElement("div");_.style.position="absolute",_.style.visibility="hidden",_.style.display="flex",_.style.flexWrap="nowrap",_.style.gap=G,a.appendChild(_);const N=[];t.filter_type_list.forEach(g=>{const v=document.createElement("div");v.className="type-tag",v.style.whiteSpace="nowrap",v.textContent=g.type_title,_.appendChild(v),N.push(v.getBoundingClientRect().width+T)});const $=document.createElement("div");$.className="type-tag type-more",$.style.whiteSpace="nowrap",$.textContent="更多",_.appendChild($);const ce=$.getBoundingClientRect().width+T;a.removeChild(_);const ue=N.reduce((g,v,V)=>g+v+(V>0?T:0),0),W=k.value[e],K=!!C.value[e];if(ue<=f){(K||!Array.isArray(W)||W.length!==t.filter_type_list.length)&&(k.value[e]=t.filter_type_list,C.value[e]=!1);return}let Q=0,A=0;for(let g=0;g<N.length;g++){const v=(A>0?T:0)+N[g],V=(A>0?T:0)+ce;if(Q+v+V<=f)Q+=v,A++;else break}const pe=Array.isArray(W)?W.length:0;(!K||pe!==A)&&(k.value[e]=t.filter_type_list.slice(0,A),C.value[e]=!0)})}function Y(){H(()=>P())}function ie(){b=new IntersectionObserver(s=>{s.forEach(e=>{e.isIntersecting&&!h.value&&!x.value&&R.value&&p.value.length>0&&(x.value=!0,d.value+=1,c())})},{root:M.scrollRoot||null,threshold:.1}),H(()=>{E.value&&b.observe(E.value)})}function P(){l&&(cancelAnimationFrame(l),l=0),l=requestAnimationFrame(()=>{l=0,le()})}function re(s,e){s&&e&&(e.title_width=s.offsetWidth)}return D({search:j}),(s,e)=>{const a=ge;return n(),r("div",Me,[h.value?(n(),z(ye,{key:0})):p.value.length?(n(),r("div",Ee,[(n(!0),r(O,null,U(p.value,(t,f)=>(n(),r("div",{key:t.name,onClick:u=>J(t),class:"plugin-item"},[o("div",$e,[t.icon?(n(),r("img",{key:0,class:"avatar",src:t.icon},null,8,Ae)):(n(),r("img",Be)),o("div",De,[o("div",Ie,[o("span",Le,m(t.title),1),o("a",{class:"source",href:t.source_url,target:"_blank"},m(t.source),9,Ne)]),o("div",We,m(t.author),1)])]),B(a,{title:S(t.description,t),placement:"top"},{default:F(()=>[o("div",{class:"desc zm-line1",ref_for:!0,ref:u=>re(u,t)},m(t.description),513)]),_:2},1032,["title"]),o("div",{class:"type-box",ref_for:!0,ref:u=>oe(f,u)},[(n(!0),r(O,null,U(ne(t,f),u=>(n(),r("div",{key:u,class:"type-tag"},m(u.type_title),1))),128)),C.value[f]?(n(),z(a,{key:0,placement:"top"},{title:F(()=>[o("div",ze,[(n(!0),r(O,null,U(t.filter_type_list,u=>(n(),r("div",{key:u,class:"type-tag"},m(u.type_title),1))),128))])]),default:F(()=>[o("div",{class:"type-tag type-more",onClick:e[0]||(e[0]=ve(()=>{},["stop"]))},m(q(I)("label_more")),1)]),_:2},1024)):ee("",!0)],512)],8,Te))),128)),o("div",{ref_key:"loadMoreRef",ref:E,class:"load-more-sentinel"},null,512)])):(n(),z(he,{key:2,title:q(I)("msg_no_available_mcp")},null,8,["title"]))])}}},Ue=ae(Oe,[["__scopeId","data-v-34d70e7c"]]),Fe={class:"_container"},je={class:"header"},Pe={class:"main-tab-box"},Ve={class:"filter-box"},He={class:"radio-tabs"},Je=["onClick"],Ye=["src"],Ge={__name:"index",setup(w){const{t:D}=se("views.explore.mcp.index"),{isPublicNetwork:I}=Re(),M=me(),h=i(null),p=i(null),y=i(null),C=i(localStorage.getItem("zm:explore:active")||"5"),k=i([]),d=_e({title:"",filter_type:0});Z(()=>{M.query.active>1&&h.value.change(M.query.active),L()});function L(){Se().then(l=>{k.value=(l==null?void 0:l.data)||[]})}function R(){p.value.search()}function x(l){d.filter_type=l,R()}function E(l){l>1&&(C.value=l)}function b(){h.value.update()}return(l,S)=>{const j=be;return n(),r("div",Fe,[o("div",je,[o("div",Pe,[B(we,{ref_key:"tabRef",ref:h,onChange:E},null,512)])]),q(I)?(n(),r("div",{key:1,class:"content",ref_key:"contentRef",ref:y},[o("div",Ve,[o("div",He,[o("div",{onClick:S[0]||(S[0]=c=>x(0)),class:X(["radio-tab",{active:d.filter_type==0}])},[o("span",null,m(q(D)("label_all")),1)],2),(n(!0),r(O,null,U(k.value,c=>(n(),r("div",{onClick:J=>x(c.id),key:c.id,class:X(["radio-tab",{active:c.id==d.filter_type}])},[c.icon_path?(n(),r("img",{key:0,class:"icon",src:c.icon_path},null,8,Ye)):ee("",!0),o("span",null,m(c.type_title),1)],10,Je))),128))]),B(j,{value:d.title,"onUpdate:value":S[1]||(S[1]=c=>d.title=c),valueModifiers:{trim:!0},onChange:R,style:{width:"360px"},allowClear:"",placeholder:q(D)("ph_search_mcp")},{suffix:F(()=>[B(q(ke))]),_:1},8,["value","placeholder"])]),B(Ue,{onInstallReport:b,filterData:d,scrollRoot:y.value,ref_key:"pluginRef",ref:p},null,8,["filterData","scrollRoot"])],512)):(n(),z(Ce,{key:0}))])}}},_t=ae(Ge,[["__scopeId","data-v-b8efc777"]]);export{_t as default};
//# sourceMappingURL=index-PasYvNgV.js.map
