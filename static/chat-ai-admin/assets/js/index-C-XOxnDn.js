import{b as W,d as te,ac as se}from"../../index-ZzVqUZIR.js";import{aa as ne,f as h,o as Z,Y as o,_ as t,a1 as A,k as u,F as P,a9 as q,a5 as e,a7 as d,G as z,ae as j,B as N,r as ae,e as oe,a2 as k,u as X,l as le,ad as Q,ab as ke}from"./vue-chunks-yZ4gwLzA.js";import{E as ie}from"./empty-box-DHZAPcYj.js";import{c as $e,b as ce,s as Y,a as ue,r as de,t as be,u as Ce,d as ee,e as xe,o as we,f as Pe}from"./index-CqPQTDjX.js";import{L as _e}from"./loading-box-D2cAv7r8.js";import{U as re}from"./update-modal-BbjkIBMC.js";import{z as pe,au as fe,aa as ve,B as he,a2 as De,ao as ge,aw as me,k as Re,F as Oe,e as Ie,I as ye,M as J,a as E,p as Se,H as Te,X as Ae}from"./ui-antd-BJtyvQX6.js";import{_ as Me}from"./tool-icon-IWVrYlVb.js";import{_ as Be}from"./no-permission-DtJ3NYHG.js";import{_ as Ue}from"./main-tab-Ue5DTRSS.js";import"./utils-smNh_pj2.js";import"./empty-BFmzY9bl.js";/* empty css                                                                     */import"./list-tabs-DVVNXmfG.js";const qe={class:"_plugin-box"},ze={key:1,class:"plugin-list"},je=["onClick"],Ne={class:"type-tag"},Ee={class:"base-info"},Fe=["src"],Le={class:"info"},Ve={class:"head"},Je={class:"name zm-line1"},We={class:"source"},He={class:"desc zm-line1"},Ge={class:"version"},Ke={class:"action-box"},Xe={class:"left"},Ye={class:"right"},Qe=["href"],Ze=["onClick"],et={key:1},tt=["onClick"],st={__name:"remotePlugins",props:{filterData:{type:Object,default:null}},emits:["installReport"],setup(L,{expose:M,emit:B}){const $=B,r=L,g=ne(),C=h(null),w=h(!0),x=h([]),c=h({});Z(()=>{D()});function f(){x.value=[],D()}async function D(){w.value=!0,await U(),$e(r.filterData).then(p=>{let v=(p==null?void 0:p.data)||[];v.forEach(_=>{var s;let{local:R,has_update:i}=((s=c.value)==null?void 0:s[_.name])||{};_.local=R,_.has_update=i}),x.value=v}).finally(()=>{w.value=!1})}async function U(){await ce().then(p=>{let v=(p==null?void 0:p.data)||[];$("installReport",v.length);let _={};v.forEach(R=>{_[R.local.name]={local:R.local,has_update:R.remote.latest_version!=R.local.version}}),c.value=_})}function m(p){g.push({path:"/plugins/detail",query:{name:p.name}})}function y(p){C.value.show(p,p.latest_version_detail,p.local||null)}return M({search:f}),(p,v)=>{const _=te,R=pe;return t(),o("div",qe,[w.value?(t(),A(_e,{key:0})):x.value.length?(t(),o("div",ze,[(t(!0),o(P,null,q(x.value,i=>(t(),o("div",{onClick:s=>m(i),key:i.name,class:"plugin-item"},[e("div",Ne,d(i.filter_type_title),1),e("div",Ee,[e("img",{class:"avatar",src:i.icon},null,8,Fe),e("div",Le,[e("div",Ve,[e("span",Je,d(i.title),1)]),e("div",We,d(i.author),1)])]),e("div",He,d(i.description),1),e("div",Ge,"版本：v"+d(i.latest_version),1),e("div",Ke,[e("div",Xe,[u(_,{name:"download"}),z(" "+d(i.installed_count||0),1)]),e("div",Ye,[i.help_url?(t(),o(P,{key:0},[e("a",{onClick:v[0]||(v[0]=N(()=>{},["stop"])),class:"c595959",href:i.help_url,target:"_blank"},"使用说明",8,Qe),u(R,{type:"vertical"})],64)):j("",!0),i.local?(t(),o(P,{key:1},[i.has_update?(t(),o("a",{key:0,onClick:N(s=>y(i),["stop"])},"更新",8,Ze)):(t(),o("span",et,"已安装"))],64)):(t(),o("a",{key:2,onClick:N(s=>y(i),["stop"])},"安装",8,tt))])])],8,je))),128))])):(t(),A(ie,{key:2,title:"暂无可用插件"})),u(re,{ref_key:"updateRef",ref:C,onOk:D},null,512)])}}},nt=W(st,[["__scopeId","data-v-eb3d4766"]]),at={class:"head-box"},ot={class:"base-info-box"},lt=["src"],it={class:"info-box"},ct={class:"left"},ut={class:"name zm-line1"},dt={class:"right"},_t={class:"link"},rt={class:"tools-box"},pt={class:"info"},ft={class:"tit zm-line1"},vt={class:"btns"},ht=["onClick"],gt=["onClick"],mt={class:"body-box"},yt={key:0,class:"no-auth-box"},kt={key:1,class:"action-box"},$t={class:"tit"},bt={class:"desc"},Ct={class:"params"},xt={class:"params-box"},wt={class:"field"},Pt={class:"name"},Dt={class:"type"},Rt={key:0,class:"required"},Ot={class:"desc"},It={__name:"feishu-config-box",emits:["del","edit","auth"],setup(L,{expose:M,emit:B}){const $=h(!1),r=h({}),g=h({}),C=h({}),w=h(!1),x=h(!1),c=ae({}),f=oe(()=>Object.keys(g.value).length);function D(i){r.value=i,m(),y(),$.value=!0}function U(){$.value=!1}function m(){ue({name:r.value.name}).then(i=>{g.value=se(i==null?void 0:i.data,{})})}function y(){de({name:r.value.name,action:"default/get-schema",params:{}}).then(i=>{let s=(i==null?void 0:i.data)||{};for(let T in s)s[T].type!="node"&&delete s[T];C.value=s})}function p(){Object.assign(c,{name:"",appid:"",app_secret:"",is_default:!1}),(!g.value||!Object.keys(g.value).length)&&(c.is_default=!0),w.value=!0}function v(i,s){for(let T in g.value)g.value[T].is_default=T==s;Y({name:r.value.name,data:JSON.stringify(g.value)}).then(T=>{m()})}function _(i,s){J.confirm({title:"提示",content:"确认删除该配置？",onOk:()=>{delete g.value[s],Y({name:r.value.name,data:JSON.stringify(g.value)}).then(T=>{m(),E.success("已删除")})}})}function R(){try{if(x.value=!0,!c.name)throw"请输入凭证名称";if(g.value[c.name])throw"凭证名称已存在";if(!c.appid)throw"请输入APP ID";if(!c.app_secret)throw"请输入APP Secret";Y({name:r.value.name,data:JSON.stringify({...g.value,[c.name]:c})}).then(i=>{w.value=!1,m(),E.success("已保存")}).finally(()=>{x.value=!1})}catch(i){x.value=!1,E.error(i)}}return M({show:D,hide:U}),(i,s)=>{const T=ge,H=he,G=ve,a=me,l=Re,b=ye,O=Ie,S=Oe,V=J;return t(),o("div",null,[u(a,{open:$.value,"onUpdate:open":s[1]||(s[1]=n=>$.value=n),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:k(()=>[e("div",at,[e("div",ot,[e("img",{class:"avatar",src:r.value.icon},null,8,lt),e("div",it,[e("div",ct,[e("div",ut,d(r.value.title),1),e("div",null,d(r.value.author),1)]),e("div",dt,[u(X(fe),{onClick:s[0]||(s[0]=n=>$.value=!1),class:"icon"})])])]),e("div",_t,d(r.value.description),1),f.value>0?(t(),A(G,{key:0,placement:"bottom"},{content:k(()=>[e("div",rt,[(t(!0),o(P,null,q(g.value,(n,I)=>(t(),o("div",{key:I,class:"tool-item"},[s[7]||(s[7]=e("img",{class:"cover",src:Me},null,-1)),e("div",pt,[e("div",ft,d(n.name),1),e("div",vt,[n.is_default?(t(),A(T,{key:0,color:"#f50"},{default:k(()=>[...s[6]||(s[6]=[z("默认",-1)])]),_:1})):(t(),o("a",{key:1,onClick:F=>v(n,I)},"设为默认",8,ht)),e("a",{onClick:F=>_(n,I)},"删除",8,gt)])])]))),128))])]),default:k(()=>[u(H,{type:"primary",icon:le(X(De)),class:"auth-btn",onClick:p},{default:k(()=>[z(" 已授权"+d(f.value)+"个凭证 ",1)]),_:1},8,["icon"])]),_:1})):(t(),A(H,{key:1,type:"primary",class:"auth-btn",onClick:p},{default:k(()=>[...s[8]||(s[8]=[z("立即授权",-1)])]),_:1}))]),e("div",mt,[f.value?(t(),o("div",kt,[(t(!0),o(P,null,q(C.value,(n,I)=>(t(),o("div",{key:I,class:"action-item"},[e("div",$t,d(n.title),1),e("div",bt,d(n.desc),1),e("div",Ct,[(t(!0),o(P,null,q(Object.keys(n.params).slice(0,3),(F,K)=>(t(),A(T,{key:K,bordered:!1},{default:k(()=>[z(d(F),1)]),_:2},1024))),128)),u(G,{placement:"right"},{content:k(()=>[e("div",xt,[(t(!0),o(P,null,q(n.params,(F,K)=>(t(),o("div",{key:K,class:"param-item"},[e("div",wt,[e("span",Pt,d(K),1),e("span",Dt,d(F.type),1),F.required?(t(),o("span",Rt,"必填")):j("",!0)]),e("div",Ot,d(F.desc),1)]))),128))])]),default:k(()=>[s[12]||(s[12]=e("a",null,"参数",-1))]),_:2},1024)])]))),128))])):(t(),o("div",yt,[s[9]||(s[9]=e("img",{src:Be},null,-1)),s[10]||(s[10]=e("div",{class:"tit"},"需要授权",-1)),s[11]||(s[11]=e("div",{class:"desc"},"授权后，配置将显示在这里",-1)),e("a",{class:"link",onClick:p},"立即授权")]))])]),_:1},8,["open"]),u(V,{open:w.value,"onUpdate:open":s[5]||(s[5]=n=>w.value=n),"confirm-loading":x.value,title:"API Key授权配置",width:"620px",onOk:R},{default:k(()=>[u(l,{type:"info","show-icon":"",message:"配置凭据后，工作流可直接调用此插件"}),u(S,{class:"mt16",model:c,"label-col":{span:4},"wrapper-col":{span:20}},{default:k(()=>[u(O,{label:"凭证名称",name:"name",rules:[{required:!0,message:"请输入凭证名称!"}]},{default:k(()=>[u(b,{value:c.name,"onUpdate:value":s[2]||(s[2]=n=>c.name=n),valueModifiers:{trim:!0},maxlength:16,placeholder:"请输入凭证名称"},null,8,["value"]),s[13]||(s[13]=e("div",{class:"tip-desc"},"仅用于区分多个授权配置的名称，不用于接口调用",-1))]),_:1}),u(O,{label:"APP ID",name:"appid",rules:[{required:!0,message:"请输入APP ID!"}]},{default:k(()=>[u(b,{value:c.appid,"onUpdate:value":s[3]||(s[3]=n=>c.appid=n),valueModifiers:{trim:!0},placeholder:"请输入APP ID"},null,8,["value"])]),_:1}),u(O,{label:"APP Secret",name:"app_secret",rules:[{required:!0,message:"请输入APP Secret!"}]},{default:k(()=>[u(b,{value:c.app_secret,"onUpdate:value":s[4]||(s[4]=n=>c.app_secret=n),valueModifiers:{trim:!0},placeholder:"请输入APP Secret"},null,8,["value"]),s[14]||(s[14]=e("div",{class:"tip-desc"},"如何获取APP ID和APP Secret",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},St=W(It,[["__scopeId","data-v-25612f86"]]),Tt={class:"head-box"},At={class:"base-info-box"},Mt=["src"],Bt={class:"info-box"},Ut={class:"left"},qt={class:"name zm-line1"},zt={class:"right"},jt={class:"link"},Nt={class:"body-box"},Et={class:"action-box"},Ft={class:"tit"},Lt={class:"desc"},Vt={class:"params"},Jt={class:"params-box"},Wt={class:"field"},Ht={class:"name"},Gt={class:"type"},Kt={key:0,class:"required"},Xt={class:"desc"},Yt={__name:"config-box",emits:["del","edit","auth"],setup(L,{expose:M,emit:B}){const $=h(!1),r=h({}),g=h({});function C(c){r.value=c,x(),$.value=!0}function w(){$.value=!1}function x(){de({name:r.value.name,action:"default/get-schema",params:{}}).then(c=>{let f=(c==null?void 0:c.data)||{};for(let D in f)f[D].type!="node"&&delete f[D];g.value=f})}return M({show:C,hide:w}),(c,f)=>{const D=ge,U=ve,m=me;return t(),o("div",null,[u(m,{open:$.value,"onUpdate:open":f[1]||(f[1]=y=>$.value=y),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:k(()=>[e("div",Tt,[e("div",At,[e("img",{class:"avatar",src:r.value.icon},null,8,Mt),e("div",Bt,[e("div",Ut,[e("div",qt,d(r.value.title),1),e("div",null,d(r.value.author),1)]),e("div",zt,[u(X(fe),{onClick:f[0]||(f[0]=y=>$.value=!1),class:"icon"})])])]),e("div",jt,d(r.value.description),1)]),e("div",Nt,[e("div",Et,[(t(!0),o(P,null,q(g.value,(y,p)=>(t(),o("div",{key:p,class:"action-item"},[e("div",Ft,d(y.title),1),e("div",Lt,d(y.desc),1),e("div",Vt,[(t(!0),o(P,null,q(Object.keys(y.params).slice(0,3),(v,_)=>(t(),A(D,{key:_,bordered:!1},{default:k(()=>[z(d(v),1)]),_:2},1024))),128)),u(U,{placement:"right"},{content:k(()=>[e("div",Jt,[(t(!0),o(P,null,q(y.params,(v,_)=>(t(),o("div",{key:_,class:"param-item"},[e("div",Wt,[e("span",Ht,d(_),1),e("span",Gt,d(v.type),1),v.required?(t(),o("span",Kt,"必填")):j("",!0)]),e("div",Xt,d(v.desc),1)]))),128))])]),default:k(()=>[f[2]||(f[2]=e("a",null,"参数",-1))]),_:2},1024)])]))),128))])])]),_:1},8,["open"])])}}},Qt=W(Yt,[["__scopeId","data-v-13aca134"]]),Zt={class:"_plugin-box"},es={key:1,class:"plugin-list"},ts=["onClick"],ss={class:"type-tag"},ns={class:"base-info"},as=["src"],os={class:"info"},ls={class:"head"},is={class:"name zm-line1"},cs={class:"source"},us={class:"version"},ds={key:0,class:"tag"},_s={class:"action-box"},rs={class:"right"},ps=["onClick"],fs=["href"],vs=["onClick"],hs=["onClick"],gs={class:"text-center mt24"},ms={__name:"installPlugins",props:{filterData:{type:Object,default:null}},emits:["installReport","tabChange"],setup(L,{expose:M,emit:B}){const $=B,r=L,g=ne(),C=h(null),w=h(null),x=h(null),c=h(!0),f=h([]),D=["feishu_bitable","official_account_profile","official_batch_tag","official_send_template_message","official_send_message"];Z(()=>{v()});function U(a,l){if(!a)return null;const O=document.createElement("canvas").getContext("2d");O.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const S=O.measureText(a).width,V=(l==null?void 0:l.title_width)||120;return S>V?a:null}function m(){f.value=[],v()}const y=h([]),p=oe(()=>r.filterData.filter_type==0||r.filterData.filter_type==5?[...y.value,...f.value]:f.value);function v(){be(r.filterData).then(a=>{let l=(a==null?void 0:a.data)||[];l=l.map(b=>{var O,S;return{...b.remote,local:b.local,has_update:((O=b.remote)==null?void 0:O.latest_version)!=((S=b.local)==null?void 0:S.version),installing:!1}}),y.value=l}),c.value=!0,ce(r.filterData).then(a=>{let l=(a==null?void 0:a.data)||[];$("installReport",l.length),l=l.map(b=>{var O,S;return{...b.remote,local:b.local,has_update:((O=b.remote)==null?void 0:O.latest_version)!=((S=b.local)==null?void 0:S.version),installing:!1}}),f.value=l}).finally(()=>{c.value=!1})}async function _(a){const l=()=>a.local.has_loaded=!a.local.has_loaded;if(!a.local.has_loaded)J.confirm({title:"确认关闭该插件？",content:"关闭后，其他应用的位置都不可使用！确认关闭？",okText:"确定",cancelText:"取消",onOk:()=>{a.local.type=="trigger"?ee({id:a.trigger_config_id,switch_status:0}).then(()=>{E.success("已关闭")}).catch(l):xe({name:a.name}).then(()=>{E.success("已关闭")}).catch(l)},onCancel(){l()}});else{if(a.local.type=="trigger"){ee({id:a.trigger_config_id,switch_status:1}).then(()=>{E.success("已开启")});return}if(a.name=="feishu_bitable"){let{data:b}=await ue({name:a.name});if(b=se(b,{}),!Object.keys(b).length)return l(),J.confirm({title:"授权飞书应用接口权限",content:le("div",{style:{color:" red"}},"请先完成信息配置，获取接口权限"),okText:"确定",cancelText:"取消",onOk:()=>{R(a)}})}we({name:a.name}).then(()=>{E.success("已开启")}).catch(l)}}function R(a){w.value.show(a)}function i(a){J.confirm({title:"确认删除该插件？",content:"删除后，其他应用的位置都不可使用！确认删除？",okText:"确定",cancelText:"取消",onOk:()=>{Ce({name:a.name}).then(()=>{E.success("已删除"),v()})}})}function s(a){a.local.type!="trigger"&&g.push({path:"/plugins/detail",query:{name:a.name}})}function T(a){a.name==="feishu_bitable"?R(a):x.value.show(a)}function H(a){C.value.show(a,a.latest_version_detail,a.local)}function G(a,l){a&&l&&(l.title_width=a.offsetWidth)}return M({search:m}),(a,l)=>{const b=Se,O=Te,S=pe,V=he;return t(),o("div",Zt,[c.value?(t(),A(_e,{key:0})):p.value.length?(t(),o("div",es,[(t(!0),o(P,null,q(p.value,n=>(t(),o("div",{onClick:I=>s(n),key:n.name,class:Q(["plugin-item",{"trigger-plugin-item":n.local.type=="trigger"}])},[e("div",ss,d(n.filter_type_title),1),e("div",ns,[e("img",{class:"avatar",src:n.icon},null,8,as),e("div",os,[e("div",ls,[e("span",is,d(n.title),1)]),e("div",cs,d(n.author),1)])]),u(b,{title:U(n.description,n),placement:"top"},{default:k(()=>[e("div",{class:"desc zm-line1",ref_for:!0,ref:I=>G(I,n)},d(n.description),513)]),_:2},1032,["title"]),e("div",us,[z("版本：v"+d(n.local.version)+" ",1),n.has_update?(t(),o("span",ds,"有更新")):j("",!0)]),e("div",_s,[e("div",{class:"left",onClick:l[0]||(l[0]=N(()=>{},["stop"]))},[u(O,{checked:n.local.has_loaded,"onUpdate:checked":I=>n.local.has_loaded=I,onChange:I=>_(n)},null,8,["checked","onUpdate:checked","onChange"])]),e("div",rs,[n.local.type!="trigger"?(t(),o("span",{key:0,class:"zm-link-pointer",onClick:N(I=>i(n),["stop"])},"删除",8,ps)):j("",!0),n.help_url?(t(),o(P,{key:1},[u(S,{type:"vertical"}),e("a",{onClick:l[1]||(l[1]=N(()=>{},["stop"])),class:"c595959",href:n.help_url,target:"_blank"},"使用说明",8,fs)],64)):j("",!0),D.includes(n.name)?(t(),o(P,{key:2},[u(S,{type:"vertical"}),e("a",{onClick:N(I=>T(n),["stop"])},"配置",8,vs)],64)):j("",!0),n.has_update?(t(),o(P,{key:3},[u(S,{type:"vertical"}),e("a",{onClick:N(I=>H(n),["stop"])},"更新",8,hs)],64)):j("",!0)])])],10,ts))),128))])):(t(),A(ie,{key:2,title:"暂未安装插件"},{desc:k(()=>[e("div",null,[l[4]||(l[4]=z("更多功能可到 ",-1)),e("a",{onClick:l[2]||(l[2]=n=>$("tabChange",3))},"探索>插件广场"),l[5]||(l[5]=z(" 中去添加",-1))]),e("div",gs,[u(V,{class:"btn",type:"primary",onClick:l[3]||(l[3]=n=>$("tabChange",3))},{default:k(()=>[...l[6]||(l[6]=[z("去添加",-1)])]),_:1})])]),_:1})),u(re,{ref_key:"updateRef",ref:C,onOk:v},null,512),u(St,{ref_key:"feishuRef",ref:w},null,512),u(Qt,{ref_key:"configRef",ref:x},null,512)])}}},ys=W(ms,[["__scopeId","data-v-eb8675c2"]]),ks={class:"_container"},$s={class:"header"},bs={class:"main-tab-box"},Cs={class:"content"},xs={class:"filter-box"},ws={class:"radio-tabs"},Ps=["onClick"],Ds=["src"],Rs={__name:"index",setup(L){const M=ke(),B=h(null),$=h(null),r=h(localStorage.getItem("zm:explore:active")||"2"),g=h([]),C=ae({title:"",filter_type:0});Z(()=>{M.query.active>1&&B.value.change(M.query.active),w()});function w(){Pe().then(m=>{g.value=(m==null?void 0:m.data)||[]})}function x(){$.value.search()}function c(m){C.filter_type=m,x()}function f(m){m>1&&(r.value=m)}function D(m){B.value.change(m)}function U(){B.value.update()}return(m,y)=>{const p=te,v=ye;return t(),o("div",ks,[e("div",$s,[e("div",bs,[u(Ue,{ref_key:"tabRef",ref:B,onChange:f},null,512)])]),e("div",Cs,[e("div",xs,[e("div",ws,[e("div",{onClick:y[0]||(y[0]=_=>c(0)),class:Q(["radio-tab",{active:C.filter_type==0}])},[u(p,{name:"icon-all"}),y[2]||(y[2]=e("span",null,"全部",-1))],2),(t(!0),o(P,null,q(g.value,_=>(t(),o("div",{onClick:R=>c(_.id),key:_.id,class:Q(["radio-tab",{active:_.id==C.filter_type}])},[e("img",{class:"icon",src:_.id==C.filter_type?_.icon_active_path:_.icon_path},null,8,Ds),e("span",null,d(_.type_title),1)],10,Ps))),128))]),u(v,{value:C.title,"onUpdate:value":y[1]||(y[1]=_=>C.title=_),valueModifiers:{trim:!0},onChange:x,style:{width:"360px"},allowClear:"",placeholder:"搜索插件"},{suffix:k(()=>[u(X(Ae))]),_:1},8,["value"])]),r.value==3?(t(),A(nt,{key:0,onInstallReport:U,filterData:C,ref_key:"pluginRef",ref:$},null,8,["filterData"])):(t(),A(ys,{key:1,onTabChange:D,onInstallReport:U,filterData:C,ref_key:"pluginRef",ref:$},null,8,["filterData"]))])])}}},Ls=W(Rs,[["__scopeId","data-v-b0f3d353"]]);export{Ls as default};
