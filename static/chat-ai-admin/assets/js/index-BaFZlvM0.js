import{ac as v,ad as _,as as e,k as s,az as R,G as q,at as U,ak as be,ae as N,ar as l,ah as De,ai as ae,f as L,c as G,r as B,e as Q,n as ue,A as pe,u as C,J as Z,aw as Me,F as j,ax as W,aA as bt,E as yt,w as le,l as Ye,h as qe,aE as de,aF as fe,af as et,o as ye,b as gt,B as kt,y as tt,aC as wt,aB as xt,p as $t}from"./vue-chunks-CGLjTDrY.js";import{_ as M,d as ie,a3 as Ct,X as St,$ as qt,af as Lt,a as It,A as Rt,ag as Ee,c as Et,ae as Ut}from"../../index-DxV-PNCd.js";import{B as ee,T as we,I as me,$ as xe,an as He,a5 as Ot,as as Vt,al as ot,M as Y,b as J,F as Ue,e as Te,y as je,z as ze,a4 as st,a3 as nt,aD as Pt,v as ne,aE as At,Q as oe,at as ge,a6 as Oe,D as it,av as Nt,aj as Dt,ak as Mt,w as Be,x as Ke,ah as H,aF as lt,O as $e,o as Tt,R as jt,N as zt,V as at,af as rt,J as Bt,W as Se,a1 as Kt,U as Xe,ae as Jt,j as Ne,ag as Ft,G as Wt,ao as Qt,aG as Gt,h as Ht,i as Xt,k as Zt}from"./ui-antd-AfNpv4wx.js";import{C as Yt}from"./cu-upload-CiYxFes3.js";import{u as Ve}from"./robot-CbQxxX9E.js";import{q as eo,t as to,u as oo,v as so,w as no,g as io,x as lo}from"./index-BNO9ztvM.js";import{_ as ao,a as ro,M as co}from"./meta-filter-box-DPAUln1z.js";import{g as dt,M as Je,u as _o}from"./model-select-CjmsccZQ.js";import{L as uo}from"./library-select-alert-BHTTi_wg.js";import{_ as po}from"./recommendation-AQ4_FPQ9.js";import{W as mo}from"./index-igCyWfr0.js";import{_ as ct}from"./cu-scroll-qHaWhCWu.js";import{a as ho}from"./index-DCeQ7cs_.js";import{g as _t}from"./index-BlSWNDZy.js";import{_ as vo}from"./empty-CzGZrENG.js";import{d as Pe}from"./vuedraggable.umd-BzpNiY3c.js";import{_ as fo}from"./empty-BFmzY9bl.js";import{i as bo,e as yo,f as go}from"./index-BCTnpgUM.js";import{A as ko}from"./add-collaborator-sOxx12_K.js";import{R as wo}from"./robot-select-alert-Dnl5Nuhz.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./index-w0T-47HX.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-CiRf6fZ3.js";const xo={class:"edit-box-header"},$o={class:"left-box"},Co={class:"edit-box-title"},So={key:0},qo={key:0,class:"title-tip"},Lo={class:"right-box"},Io={class:"extra-box"},Ro={class:"actions-box"},Eo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(p,{emit:a}){const d=a,n=p,r=t=>{d("edit"),d("update:isEdit",t)},o=()=>{d("save")};return(t,m)=>{const b=ie,x=ee,h=we;return _(),v("div",{class:ae(["edit-box",{"is-edit":p.isEdit}])},[e("div",xo,[e("div",$o,[s(b,{class:"edit-box-icon",name:n.iconName},null,8,["name"]),e("span",Co,[q(U(n.title)+" ",1),t.$slots.icon?(_(),v("span",So,[be(t.$slots,"icon",{},void 0,!0)])):R("",!0)]),t.$slots.tip?(_(),v("span",qo,[be(t.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",Lo,[e("div",Io,[be(t.$slots,"extra",{},()=>[e("div",Ro,[n.isEdit?(_(),N(h,{key:0,gap:8},{default:l(()=>[s(x,{onClick:o,size:"small",type:"primary"},{default:l(()=>[...m[2]||(m[2]=[q("保存",-1)])]),_:1}),s(x,{onClick:m[0]||(m[0]=E=>r(!1)),size:"small"},{default:l(()=>[...m[3]||(m[3]=[q("取消",-1)])]),_:1})]),_:1})):(_(),N(x,{key:1,onClick:m[1]||(m[1]=E=>r(!0)),size:"small"},{default:l(()=>[...m[4]||(m[4]=[q("修改",-1)])]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:De({...p.bodyStyle})},[be(t.$slots,"default",{},void 0,!0)],4)],2)}}},X=M(Eo,[["__scopeId","data-v-1b63f826"]]),Uo={class:"robot-form-box"},Oo={class:"form-item"},Vo={class:"form-item-body robot-name-item"},Po={class:"robot-avetar-upload"},Ao=["src"],No={class:"robot-name-box"},Do={class:"form-item"},Mo={class:"form-item-body"},To={class:"robot-info-box"},jo={class:"robot-name-box"},zo=["src"],Bo={class:"robot-name"},Ko={class:"robot-intro"},Jo={__name:"basic-config",setup(p){const a=Ve(),d=L(!1),{robotInfo:n,updateRobotInfo:r}=G("robotInfo"),o=B({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),t=Q(()=>a.robotList||[]),m=Q(()=>a.robotGroupList||[]),b=Q(()=>{let y="未分组",c=t.value.find(w=>w.id==n.id)||{};if(c.group_id>0){let w=m.value.find(u=>u.id==c.group_id);w&&(y=w.group_name)}return y}),x=()=>{r({...Z(o)}),d.value=!1},h=y=>{let c=y[0];return o.robot_avatar=c,Ct(c).then(w=>{o.robot_avatar_url=w}),!1},E=()=>{o.robot_name=n.robot_name,o.robot_intro=n.robot_intro,o.robot_avatar=n.robot_avatar,o.robot_avatar_url=n.robot_avatar_url};return(y,c)=>{const w=me,u=xe;return _(),N(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:d.value,"onUpdate:isEdit":c[2]||(c[2]=f=>d.value=f),onSave:x,onEdit:E},{default:l(()=>[ue(e("div",Uo,[e("div",Oo,[c[3]||(c[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",Vo,[s(Yt,{accept:"image/*",onChange:h},{default:l(()=>[e("div",Po,[o.robot_avatar_url?(_(),v("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,Ao)):R("",!0)])]),_:1}),e("div",No,[s(w,{value:o.robot_name,"onUpdate:value":c[0]||(c[0]=f=>o.robot_name=f),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Do,[c[4]||(c[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",Mo,[s(u,{rows:3,value:o.robot_intro,"onUpdate:value":c[1]||(c[1]=f=>o.robot_intro=f),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[pe,d.value]]),ue(e("div",To,[e("div",jo,[e("img",{class:"robot-avatar",src:C(n).robot_avatar_url,alt:""},null,8,zo),e("span",Bo,U(C(n).robot_name),1)]),e("div",Ko,[e("span",null,"分组："+U(b.value),1),e("span",null,"简介："+U(C(n).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[pe,!d.value]])]),_:1},8,["isEdit"])}}},Fo=M(Jo,[["__scopeId","data-v-0adbabe6"]]),Wo={class:"ai-create-box"},Qo={class:"input-box"},Go={key:1},Ho={key:2},Xo={class:"quick-tags-box"},Zo={class:"ai-list-box"},Yo={key:0,class:"loading-box"},es={key:0,class:"prompt-list-box"},ts={class:"prompt-list"},os={class:"prompt-header"},ss={class:"prompt-title"},ns={class:"prompt-content"},is={class:"prompt-list"},ls={class:"prompt-header"},as={class:"prompt-title"},rs={class:"prompt-content"},ds={class:"prompt-list"},cs={class:"prompt-header"},_s={class:"prompt-title"},us={class:"prompt-content"},ps={class:"prompt-list"},ms={class:"prompt-header"},hs={class:"prompt-title"},vs={class:"prompt-content"},fs={class:"prompt-list"},bs={class:"prompt-header"},ys={class:"prompt-title"},gs={class:"prompt-content"},ks={class:"prompt-header"},ws={class:"prompt-title"},xs={class:"prompt-content"},$s={key:1,class:"empty-box"},Cs={__name:"ai-create-prompt",emits:["handleAiSave"],setup(p,{expose:a,emit:d}){const n=He.PRESENTED_IMAGE_SIMPLE,r=L(!1),o=L(!1),t=Me().query,m=d,b=L(""),x=L(!1),h=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],E=L("在上方输入框输入要求，点击生成提示词"),y=()=>{c.value=!1,u.promptStruct=w,b.value="",E.value="在上方输入框输入要求，点击生成提示词",r.value=!0},c=L(!1),w={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},u=B({promptStruct:w}),f=S=>{b.value=S},i=()=>{if(!b.value)return J.error("请输入AI 生成提示词");if(x.value)return J.error("正在生成中...");x.value=!0,eo({id:t.id,demand:b.value}).then(S=>{u.promptStruct=JSON.parse(S.data.promptStruct),c.value=!0}).finally(()=>{x.value=!1}).catch(S=>{c.value=!1,E.value=S.msg})},k=()=>{if(!c.value)return J.error("请先生成提示词");m("handleAiSave",u.promptStruct),r.value=!1};return a({show:y}),(S,g)=>{const V=ee,z=xe,O=ie,D=Vt,P=ot,te=He,K=Y;return _(),v("div",null,[s(K,{open:r.value,"onUpdate:open":g[1]||(g[1]=I=>r.value=I),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:l(()=>[s(V,{type:"primary",loading:o.value,onClick:k},{default:l(()=>[...g[2]||(g[2]=[q("使用该提示",-1)])]),_:1},8,["loading"])]),default:l(()=>[e("div",Wo,[e("div",Qo,[s(z,{style:{width:"100%"},value:b.value,"onUpdate:value":g[0]||(g[0]=I=>b.value=I),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:ae(["btn-box",{"disabed-status":x.value}]),onClick:i},[x.value?(_(),N(C(Ot),{key:0})):R("",!0),s(O,{name:"ai-mark"}),x.value?(_(),v("span",Go,"生成中...")):(_(),v("span",Ho,"生成"))],2)]),e("div",Xo,[g[3]||(g[3]=e("div",{class:"quick-label"},"快捷生成：",-1)),(_(),v(j,null,W(h,I=>s(D,{key:I.title,onClick:se=>f(I.title),color:"blue"},{default:l(()=>[q(U(I.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Zo,[x.value?(_(),v("div",Yo,[s(P,{tip:"正在生成中..."})])):(_(),v(j,{key:1},[c.value?(_(),v("div",es,[e("div",ts,[e("div",os,[e("div",ss,U(u.promptStruct.role.subject),1)]),e("div",ns,U(u.promptStruct.role.describe),1)]),e("div",is,[e("div",ls,[e("div",as,U(u.promptStruct.task.subject),1)]),e("div",rs,U(u.promptStruct.task.describe),1)]),e("div",ds,[e("div",cs,[e("div",_s,U(u.promptStruct.constraints.subject),1)]),e("div",us,U(u.promptStruct.constraints.describe),1)]),e("div",ps,[e("div",ms,[e("div",hs,U(u.promptStruct.output.subject),1)]),e("div",vs,U(u.promptStruct.output.describe),1)]),e("div",fs,[e("div",bs,[e("div",ys,U(u.promptStruct.tone.subject),1)]),e("div",gs,U(u.promptStruct.tone.describe),1)]),(_(!0),v(j,null,W(u.promptStruct.custom,(I,se)=>(_(),v("div",{class:"prompt-list",key:se+I.key?I.key:""},[e("div",ks,[e("div",ws,U(I.subject),1)]),e("div",xs,U(I.describe),1)]))),128))])):(_(),v("div",$s,[s(te,{image:C(n),description:E.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},Ss=M(Cs,[["__scopeId","data-v-1dd9dabe"]]),qs={__name:"upload-prompt",setup(p,{expose:a}){const d=L(!1),n=B({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),r=L(null),o=h=>{if(h.prompt_type==0&&!h.prompt)return J.error("自定义提示为空,无法上传");r.value&&r.value.resetFields();let E={...h};n.title="",n.group_id=0,n.prompt="",n.prompt_struct={},n.prompt_type=E.prompt_type,E.prompt_type==0?n.prompt=E.prompt:n.prompt_struct=JSON.stringify(E.prompt_struct),d.value=!0},t=L([]);(()=>{St().then(h=>{t.value=[{id:0,group_name:"默认分组"},...h.data]})})();const b=L(!1),x=()=>{r.value.validate().then(()=>{let h={...n};b.value=!0,qt({...h}).then(()=>{J.success("保存成功"),d.value=!1}).finally(()=>{b.value=!1})})};return a({show:o}),(h,E)=>{const y=me,c=Te,w=ze,u=je,f=Ue,i=Y;return _(),v("div",null,[s(i,{open:d.value,"onUpdate:open":E[2]||(E[2]=k=>d.value=k),title:"保存到提示词库",width:580,onOk:x,confirmLoading:b.value},{default:l(()=>[s(f,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:r,model:n},{default:l(()=>[s(c,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:l(()=>[s(y,{value:n.title,"onUpdate:value":E[0]||(E[0]=k=>n.title=k),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),s(c,{name:"group_id",label:"分组"},{default:l(()=>[s(u,{value:n.group_id,"onUpdate:value":E[1]||(E[1]=k=>n.group_id=k),style:{width:"100%"}},{default:l(()=>[(_(!0),v(j,null,W(t.value,k=>(_(),N(w,{value:k.id},{default:l(()=>[q(U(k.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},Ls={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(p){p&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(p){const a=[],d=[],n=(r,o)=>{if(!r||r.length===0)return!1;for(let t=0;t<r.length;t++){const m=r[t],b=m[this.valueKey];if(b===p)return a[o]=m,d[o]=b,!0;if(m[this.childrenKey]&&m[this.childrenKey].length>0){if(a[o]=m,d[o]=b,n(m[this.childrenKey],o+1))return!0;a[o]=null,d[o]=null}}return!1};n(this.options,0),this.selectedPath=a.filter(r=>r),this.selectedValuePath=d.filter(r=>r!=null),this.updateActivePath()},findPathByValues(p){if(!p||p.length===0)return;const a=[];let d=this.options;for(let n=0;n<p.length;n++){const r=p[n],o=d.find(t=>t[this.valueKey]===r);if(o)a.push(o),d=o[this.childrenKey]||[];else break}this.selectedPath=a,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let p=0;p<this.selectedPath.length;p++){const a=this.selectedPath[p];a[this.childrenKey]&&a[this.childrenKey].length>0&&this.activePath.push({title:a[this.labelKey],options:a[this.childrenKey],level:p+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(p,a,d){this.hasChildren(p)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,a),this.selectedPath.push(p),this.selectedValuePath=this.selectedValuePath.slice(0,a),this.selectedValuePath.push(p[this.valueKey]),this.activePath=this.activePath.slice(0,a+1),this.hasChildren(p)&&this.activePath.push({title:p[this.labelKey],options:p[this.childrenKey],level:a+1}),this.$emit("select",p,this.selectedPath,a),this.selectedPath,(this.checkAnyLevel&&!this.isClickRight&&a>0||!this.hasChildren(p))&&(this.$emit("change",p[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:p[this.valueKey])),this.isClickRight=!1},isActive(p,a){return!this.selectedPath||this.selectedPath.length<=a?!1:p[this.valueKey]===this.selectedPath[a][this.valueKey]},hasChildren(p){return p[this.childrenKey]&&p[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const p=this.$el;if(!p)return;const a=p.getBoundingClientRect(),d=window.innerWidth,n=180;a.right+n>d&&a.left>n?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",n)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",n))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},Is={class:"cascade-panel"},Rs={class:"cascade-panel-body"},Es=["onClick"],Us={class:"item-content"},Os={class:"item-label"},Vs={key:0,class:"cascade-panel-empty"};function Ps(p,a,d,n,r,o){return _(),v("div",Is,[e("div",{class:ae(["cascade-panel-container",[`expand-direction-${r.expandDirection}`]])},[(_(!0),v(j,null,W(r.activePath,(t,m)=>(_(),v("div",{class:"cascade-panel-list",key:m},[e("div",Rs,[(_(!0),v(j,null,W(t.options,b=>(_(),v("div",{class:ae(["cascade-panel-item",{active:o.isActive(b,m)}]),key:b.value,onClick:x=>o.handleSelect(b,m,x)},[e("div",Us,[e("span",Os,U(b.label),1),o.hasChildren(b)?(_(),v("span",{key:0,class:"item-icon",onClick:a[0]||(a[0]=(...x)=>o.handleRightClick&&o.handleRightClick(...x))},[...a[1]||(a[1]=[e("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[e("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):R("",!0)])],10,Es))),128)),t.options&&t.options.length===0?(_(),v("div",Vs," 暂无数据 ")):R("",!0)])]))),128))],2)])}const As=M(Ls,[["render",Ps],["__scopeId","data-v-83ffe662"]]),ut=p=>{let a=[];return p.forEach(d=>{d.children&&d.children.length>0?a.push(...ut(d.children)):a.push(d)}),a},Ns={name:"JMention",components:{CascadePanel:As},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(p){return["input","textarea"].includes(p)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(p){p.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(p){this.onOpen(p)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(p){p.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(p){p.target.closest(".dropdown-list")&&p.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(p){this.$emit("open",p)},getText(p){const a=document.createElement("div");a.innerHTML=p;let d="";return Array.from(a.childNodes).forEach(n=>{let r="";this.type==="textarea"?n.nodeName==="BR"?r=`
`:n.classList&&n.classList.contains("j-mention-at")?r=n.dataset.value:r=n.textContent:n.classList&&n.classList.contains("j-mention-at")?r=n.dataset.value:n.nodeName==="BR"?r="":r=n.textContent.replace(/\n/g,""),(r==="&nbsp;"||r===" ")&&(r=""),d+=r}),d},onChange(){const p=this.$refs.JMention;if(!p)return;let a=p.innerHTML,d=this.getText(a);this.localValue=d;let n={};this.selectedList.forEach(o=>{!n[o.value]&&d.indexOf(o.value)!==-1&&(n[o.value]=o)});let r=Object.values(n);this.$emit("change",d.trim(),r)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const p=this.$refs.JMention;let a=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=this.defaultSelectedList||[],n=ut(this.options),r=[...d,...n].filter(t=>t&&t.value&&t.value!=""&&t.typ!=="node");const o=new Set;r.forEach(t=>{const m=new RegExp(`(${t.value})`,"g");m.test(this.defaultValue)&&!o.has(t.value)&&(a=a.replace(m,`<span class="j-mention-at" data-id="${t.id}" contentEditable="false" data-value="${t.value}">${t.label}</span>`),o.add(t.value),this.selectOption(t,!0))}),p.innerHTML=a,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(p=>this.atText?p.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(p.id+""))},getLastChar(p=1){const a=window.getSelection();if(a.rangeCount<=0)return;const d=a.getRangeAt(0),n=d.startOffset,r=d.startContainer;let o="";if(r.nodeType===Node.TEXT_NODE)o=r.textContent.slice(0,n);else if(r.nodeType===Node.ELEMENT_NODE){const t=r.childNodes;for(let m=0;m<t.length;m++){const b=t[m];b.nodeType===Node.TEXT_NODE&&(m===t.length-1?o+=b.textContent.slice(0,n):o+=b.textContent)}}return o.slice(-p)},getLastAtText(){const p=window.getSelection();if(p.rangeCount<=0)return;const a=p.getRangeAt(0),d=a.startOffset,n=a.startContainer;let r="";if(n.nodeType===Node.TEXT_NODE)r=n.textContent.slice(0,d);else if(n.nodeType===Node.ELEMENT_NODE){const t=n.childNodes;for(let m=0;m<t.length;m++){const b=t[m];b.nodeType===Node.TEXT_NODE&&(m===t.length-1?r+=b.textContent.slice(0,d):r+=b.textContent)}}const o=r.lastIndexOf("/");return o===-1?"":r.slice(o+1)},async getCaretPosition(){const p=window.getSelection();if(p.rangeCount<=0)return{top:0,left:0};const d=p.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize(),r=window.innerWidth,o=window.innerHeight;let t=d.bottom,m=d.left;return t+n.height>o&&(t=d.top-n.height),m+n.width>r&&(m=d.right-n.width),t<0&&(t=0),m<0&&(m=0),{top:t,left:m}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const p=this.$refs.dropdownList.offsetWidth,a=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:p,height:a}},updateSelectedList(){const a=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const d of a){let n=d.dataset.value;const r=this.options.find(o=>o.value==n);this.selectedList.push(r),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(a.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(p){return this.options.filter(d=>d.label.startsWith(p)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(p){this.handleDropdownLogic(p),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(p){const a=this.getLastChar();if(p.inputType==="deleteContentBackward"&&!this.atText)a!="/"&&(this.showDropdown=!1);else if(a==="/")this.showDropdown=!0,this.atText="";else{const r=this.getLastAtText();this.atText=r;const o=this.checkStartWith(r);r&&(this.showDropdown=o)}if(!this.showDropdown)return;const{top:d,left:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${n}px; top:${d}px;`},insertAtCaret(p,a){let d=this.atText.length+1;this.getLastChar(d)!=="/"+this.atText&&(d=0);const r=window.getSelection();if(r.rangeCount<=0)return;const o=r.getRangeAt(0),t=o.startOffset,m=o.startContainer;let b=t-d,x=m;if(b<0){let h=m.previousSibling;for(;h;){if(h.nodeType===Node.TEXT_NODE){b=h.textContent.length-d,x=h;break}h=h.previousSibling}}if(x.nodeType===Node.TEXT_NODE){x.replaceData(b,d,"");const h=document.createElement("span");h.contentEditable="false",h.classList.add("j-mention-at"),h.style=this.atTextStyle,h.textContent=`${p}`;for(const y in a)h.dataset[y]=a[y];const E=document.createRange();E.setStart(x,b),E.insertNode(h),o.setStartAfter(h),o.setEndAfter(h),r.removeAllRanges(),r.addRange(o)}},onSelectOption(p,a,d){let n=d[d.length-1];delete n.children,this.selectOption(n)},selectOption(p,a=!1){if(!p)return;this.showDropdown=!1;let d=p.label;const n={id:p.id,label:p.label,value:p.value,text:p.text,index:this.selectedList.length};this.selectedList.push(p),this.selectedIdSet.add(p.value),a||(this.insertAtCaret(d,n),this.initShowOptionList(),this.updateValue())},handleDirectionChange(p,a){const d=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),n=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!d||!n)return;const r=parseFloat(d[1]),o=parseFloat(n[1]);let t;p==="left"?t=r-a:t=r+a,this.positionStyle=`left:${t}px; top:${o}px;`}}},Ds={style:{width:"100%",position:"relative"}},Ms={class:"mention-input-warpper mention-promt-input",ref:"JMentionContainer"},Ts=["placeholder"],js={key:0,class:"placeholder"};function zs(p,a,d,n,r,o){const t=bt("CascadePanel");return _(),v("div",Ds,[a[4]||(a[4]=e("div",null,null,-1)),(_(),N(yt,{to:"body"},[r.showDropdown?(_(),v("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:De(r.positionStyle)},[s(t,{options:r.showOptions,checkAnyLevel:d.checkAnyLevel,onChange:o.onSelectOption,onDirectionChange:o.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):R("",!0)])),e("div",Ms,[e("div",{ref:"JMention",style:De([d.inputStyle]),class:ae(["j-mention",[{"show-placeholder":r.localValue.length==0},"type-"+d.type]]),contenteditable:"plaintext-only",placeholder:d.placeholder,onFocus:a[0]||(a[0]=(...m)=>o.onFocus&&o.onFocus(...m)),onInput:a[1]||(a[1]=(...m)=>o.debouncedUpdate&&o.debouncedUpdate(...m)),onClick:a[2]||(a[2]=(...m)=>o.clickJMention&&o.clickJMention(...m)),onBlur:a[3]||(a[3]=(...m)=>o.handleBlur&&o.handleBlur(...m))},null,46,Ts),r.localValue.length==0?(_(),v("span",js,U(d.placeholder),1)):R("",!0)],512)])}const Bs=M(Ns,[["render",zs],["__scopeId","data-v-e0c464c2"]]),Ks={class:"prompt-box"},Js={class:"tab-header"},Fs={key:0,class:"opt-block"},Ws={key:1,class:"opt-block"},Qs={class:"tip-text"},Gs={key:0,class:"prompt-list-box"},Hs={class:"prompt-list"},Xs={class:"prompt-header"},Zs={class:"prompt-title"},Ys={key:0,class:"btn-wrapper-box"},en={class:"prompt-content"},tn={class:"prompt-list"},on={class:"prompt-header"},sn={class:"prompt-title"},nn={key:0,class:"btn-wrapper-box"},ln={class:"prompt-content"},an={class:"prompt-list"},rn={class:"prompt-header"},dn={class:"prompt-title"},cn={key:0,class:"btn-wrapper-box"},_n={class:"prompt-content"},un={class:"prompt-list"},pn={class:"prompt-header"},mn={class:"prompt-title"},hn={key:0,class:"btn-wrapper-box"},vn={class:"prompt-content"},fn={class:"prompt-list"},bn={class:"prompt-header"},yn={class:"prompt-title"},gn={key:0,class:"btn-wrapper-box"},kn={class:"swich-item"},wn={class:"swich-item"},xn={class:"prompt-content"},$n={class:"prompt-list"},Cn={class:"prompt-header"},Sn={class:"prompt-title"},qn={key:0,class:"btn-wrapper-box"},Ln={class:"prompt-content"},In={class:"prompt-header"},Rn={class:"prompt-title",style:{flex:"1"}},En={key:0,class:"btn-wrapper-box"},Un=["onClick"],On={class:"prompt-content"},Vn={key:0,class:"add-theme-block"},Pn={class:"show-more-block"},An={class:"diy-switch-box"},Nn={class:"swich-item"},Dn={class:"swich-item"},Mn={class:"field-list-item"},Tn={class:"field-label"},jn={class:"field-type"},ce="- 请使用markdown格式回答问题。",_e="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",zn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(p){const a=Ve(),d=L(!1),{robotInfo:n,updateRobotInfo:r}=G("robotInfo"),o=p;let t={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const m=L({}),b=L(!1),x=L(!1),h=L(!1),E=L(!1),y=L(null),c=Q(()=>a.chatVariables.map($=>{let he=$.variable_key+"（"+$.variable_name+"）",re=`【chat_variable:${$.variable_key}】`;return{...$,label:he,value:re}}));le(()=>c,()=>{setTimeout(()=>{y.value&&y.value.refresh()},500)},{deep:!0});const w=(T,$)=>{u.prompt=T},u=B({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),f=L(localStorage.getItem("system_prompt_words_ishide")=="1"),i=()=>{f.value=!f.value,localStorage.setItem("system_prompt_words_ishide",f.value?1:0)},k=(T,$)=>T.includes($),S=L(n.prompt_type),g=Q(()=>n.prompt_type);le(()=>n,()=>{u.prompt=n.prompt,u.prompt_struct=n.prompt_struct,m.value=n.prompt_struct_default},{immediate:!0,deep:!0}),le(()=>u.prompt_struct.output.describe,T=>{b.value=k(T,ce),x.value=k(T,_e)},{immediate:!0,deep:!0}),le(()=>u.prompt,T=>{h.value=k(T,ce),E.value=k(T,_e)},{immediate:!0,deep:!0});const V=(T,$)=>{T?($=="outSwitch"&&(u.prompt_struct.output.describe?u.prompt_struct.output.describe+=`
`+ce:u.prompt_struct.output.describe+=ce),$=="imgSwitch"&&(u.prompt_struct.output.describe?u.prompt_struct.output.describe+=`
`+_e:u.prompt_struct.output.describe+=_e)):($=="outSwitch"&&(u.prompt_struct.output.describe=u.prompt_struct.output.describe.replace(new RegExp(ce,"g"),"")),$=="imgSwitch"&&(u.prompt_struct.output.describe=u.prompt_struct.output.describe.replace(new RegExp(_e,"g"),"")),u.prompt_struct.output.describe=u.prompt_struct.output.describe.trim())},z=(T,$)=>{T?($=="outDiySwitch"&&(u.prompt?u.prompt+=`
`+ce:u.prompt+=ce),$=="imgDiySwitch"&&(u.prompt?u.prompt+=`
`+_e:u.prompt+=_e)):($=="outDiySwitch"&&(u.prompt=u.prompt.replace(new RegExp(ce,"g"),"")),$=="imgDiySwitch"&&(u.prompt=u.prompt.replace(new RegExp(_e,"g"),"")),u.prompt=u.prompt.trim())},O=T=>{u.prompt_struct[T].describe=m.value[T].describe},D=()=>{let T=n.work_flow_ids.split(","),$=o.robotList.filter(re=>T.includes(re.id)),he=[];he=$.map(re=>`- ${re.robot_name} ${re.robot_intro}`).join(`
`),u.prompt_struct.skill.describe=he},P=()=>{u.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),S.value=1},te=T=>{u.prompt_struct.custom.splice(T,1)},K=()=>{r({...Z(u),prompt_type:S.value}),d.value=!1},I=T=>{S.value=1,r({prompt_type:S.value,prompt:u.prompt,prompt_struct:T}),d.value=!1},se=()=>{S.value==0&&y.value&&y.value.refresh(),d.value=!0},F=()=>{d.value=!1},ke=L(null),Ae=()=>{ke.value.show()},Fe=L(null),pt=()=>{Fe.value.show()},We=L(null),mt=()=>{We.value.show({...u,prompt_type:S.value})},ht=T=>{T.prompt_type==1?(S.value=1,u.prompt_struct=T.prompt_struct):(S.value=0,u.prompt=T.prompt),K()};return(T,$)=>{const he=st,re=nt,Qe=ne,vt=ie,Le=ee,Ge=we,ve=xe,Ie=oe,ft=me;return _(),v("div",Ks,[e("div",Js,[s(re,{activeKey:S.value,"onUpdate:activeKey":$[0]||($[0]=A=>S.value=A)},{default:l(()=>[(_(),N(he,{key:1,tab:"结构化提示词"})),(_(),N(he,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),d.value?(_(),v("div",Fs,[s(Qe,null,{title:l(()=>[...$[22]||($[22]=[q("将当前编辑的提示词保存到提示词库中",-1)])]),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:mt},[s(C(Pt)),$[23]||($[23]=q("上传 ",-1))])]),_:1}),s(Qe,null,{title:l(()=>[...$[24]||($[24]=[q("从提示词库导入提示词",-1)])]),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:pt},[s(C(At)),$[25]||($[25]=q("导入 ",-1))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:Ae},[s(vt,{name:"ai-mark"}),$[26]||($[26]=q(" AI自动生成 ",-1))]),s(Ge,{gap:8},{default:l(()=>[s(Le,{size:"small",type:"primary",onClick:K},{default:l(()=>[...$[27]||($[27]=[q("保存",-1)])]),_:1}),s(Le,{size:"small",onClick:F},{default:l(()=>[...$[28]||($[28]=[q("取消",-1)])]),_:1})]),_:1})])):(_(),v("div",Ws,[e("span",Qs,"当前类型："+U(g.value==1?"结构化提示词":"自定义提示词"),1),s(Le,{size:"small",onClick:se},{default:l(()=>[...$[29]||($[29]=[q("修改",-1)])]),_:1})]))]),S.value==1?(_(),v("div",Gs,[e("div",Hs,[e("div",Xs,[e("div",Zs,U(u.prompt_struct.role.subject),1),d.value?(_(),v("div",Ys,[e("a",{onClick:$[1]||($[1]=A=>O("role"))},"恢复默认")])):R("",!0)]),e("div",en,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.role.describe,"onUpdate:value":$[2]||($[2]=A=>u.prompt_struct.role.describe=A),placeholder:C(t).role},null,8,["disabled","value","placeholder"])])]),e("div",tn,[e("div",on,[e("div",sn,U(u.prompt_struct.task.subject),1),d.value?(_(),v("div",nn,[e("a",{onClick:$[3]||($[3]=A=>O("task"))},"恢复默认")])):R("",!0)]),e("div",ln,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.task.describe,"onUpdate:value":$[4]||($[4]=A=>u.prompt_struct.task.describe=A),placeholder:C(t).task},null,8,["disabled","value","placeholder"])])]),f.value?(_(),v(j,{key:0},[e("div",an,[e("div",rn,[e("div",dn,U(u.prompt_struct.constraints.subject),1),d.value?(_(),v("div",cn,[e("a",{onClick:$[5]||($[5]=A=>O("constraints"))},"恢复默认")])):R("",!0)]),e("div",_n,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.constraints.describe,"onUpdate:value":$[6]||($[6]=A=>u.prompt_struct.constraints.describe=A),placeholder:C(t).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",un,[e("div",pn,[e("div",mn,U(u.prompt_struct.skill.subject),1),d.value?(_(),v("div",hn,[e("a",{onClick:$[7]||($[7]=A=>D())},"自动导入技能")])):R("",!0)]),e("div",vn,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.skill.describe,"onUpdate:value":$[8]||($[8]=A=>u.prompt_struct.skill.describe=A),placeholder:C(t).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",fn,[e("div",bn,[e("div",yn,U(u.prompt_struct.output.subject),1),d.value?(_(),v("div",gn,[e("div",kn,[$[30]||($[30]=q(" 输出markdown： ",-1)),s(Ie,{onChange:$[9]||($[9]=A=>V(A,"outSwitch")),checked:b.value,"onUpdate:checked":$[10]||($[10]=A=>b.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",wn,[$[31]||($[31]=q(" 回复图片： ",-1)),s(Ie,{onChange:$[11]||($[11]=A=>V(A,"imgSwitch")),checked:x.value,"onUpdate:checked":$[12]||($[12]=A=>x.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:$[13]||($[13]=A=>O("output"))},"恢复默认")])):R("",!0)]),e("div",xn,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.output.describe,"onUpdate:value":$[14]||($[14]=A=>u.prompt_struct.output.describe=A),placeholder:C(t).output},null,8,["disabled","value","placeholder"])])]),e("div",$n,[e("div",Cn,[e("div",Sn,U(u.prompt_struct.tone.subject),1),d.value?(_(),v("div",qn,[e("a",{onClick:$[15]||($[15]=A=>O("tone"))},"恢复默认")])):R("",!0)]),e("div",Ln,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.tone.describe,"onUpdate:value":$[16]||($[16]=A=>u.prompt_struct.tone.describe=A),placeholder:C(t).tone},null,8,["disabled","value","placeholder"])])]),(_(!0),v(j,null,W(u.prompt_struct.custom,(A,Ce)=>(_(),v("div",{class:"prompt-list",key:Ce+A.key?A.key:""},[e("div",In,[e("div",Rn,[s(ft,{bordered:!1,disabled:!d.value,style:{width:"100%"},value:A.subject,"onUpdate:value":Re=>A.subject=Re,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),d.value?(_(),v("div",En,[e("div",{class:"hover-btn-box",onClick:Re=>te(Ce)},[s(C(ge))],8,Un)])):R("",!0)]),e("div",On,[s(ve,{bordered:!1,disabled:!d.value,value:A.describe,"onUpdate:value":Re=>A.describe=Re,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),d.value?(_(),v("div",Vn,[s(Le,{onClick:P,block:"",icon:Ye(C(Oe))},{default:l(()=>[...$[32]||($[32]=[q("添加主题",-1)])]),_:1},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",Pn,[e("div",{class:"btn-item",onClick:i},[f.value?(_(),v(j,{key:1},[$[34]||($[34]=q("收起",-1)),s(C(Nt))],64)):(_(),v(j,{key:0},[$[33]||($[33]=q("展开",-1)),s(C(it))],64))])])])):(_(),v("div",{key:1,class:ae(["diy-prompt-box",{"is-disabled":!d.value}])},[d.value?(_(),N(Ge,{key:0,align:"center",justify:"space-between",style:{margin:"8px 0"}},{default:l(()=>[$[37]||($[37]=e("div",{style:{color:"#8c8c8c"}},' 键入"/"可以插入变量，用户输入的参数会填充变量作为最终的提示词 ',-1)),e("div",An,[e("div",Nn,[$[35]||($[35]=q(" 输出markdown： ",-1)),s(Ie,{onChange:$[17]||($[17]=A=>z(A,"outDiySwitch")),checked:h.value,"onUpdate:checked":$[18]||($[18]=A=>h.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Dn,[$[36]||($[36]=q(" 回复图片： ",-1)),s(Ie,{onChange:$[19]||($[19]=A=>z(A,"imgDiySwitch")),checked:E.value,"onUpdate:checked":$[20]||($[20]=A=>E.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])]),_:1})):R("",!0),s(Bs,{type:"textarea",inputStyle:"height: 126px",defaultValue:u.prompt,options:c.value,disabled:!0,checkAnyLevel:!0,ref_key:"atinputRef",ref:y,onChange:$[21]||($[21]=(A,Ce)=>w(A))},{option:l(({label:A,payload:Ce})=>[e("div",Mn,[e("div",Tn,U(A),1),e("div",jn,U(Ce.typ),1)])]),_:1},8,["defaultValue","options"])],2)),s(Ss,{onHandleAiSave:I,ref_key:"aiCreatePromptRef",ref:ke},null,512),s(ao,{onOk:ht,ref_key:"importPromptRef",ref:Fe},null,512),s(qs,{ref_key:"uploadPromptRef",ref:We},null,512)])}}},Bn=M(zn,[["__scopeId","data-v-20245495"]]),Kn={class:"actions-box"},Jn={class:"setting-info-block"},Fn={class:"set-item w-100"},Wn={class:"set-item"},Qn={class:"set-item"},Gn={class:"set-item"},Hn={class:"set-item"},Xn={class:"form-box"},Zn={class:"form-item"},Yn={class:"form-item-body"},ei={class:"form-item",style:{display:"flex","align-items":"center"}},ti={class:"form-item"},oi={class:"form-item-label"},si={class:"form-item-body"},ni={class:"number-box"},ii={class:"number-slider-box"},li={class:"number-input-box"},ai={class:"form-item"},ri={class:"form-item-label"},di={class:"form-item-body"},ci={class:"number-box"},_i={class:"number-slider-box"},ui={class:"number-input-box"},pi={class:"form-item"},mi={class:"form-item-label"},hi={class:"form-item-body"},vi={class:"number-box"},fi={class:"number-slider-box"},bi={class:"number-input-box"},yi={class:"form-item justify-between"},gi={class:"form-item-label"},ki={class:"form-item justify-between"},wi={class:"form-item-label"},xi={class:"form-item justify-between"},$i={class:"form-item-label"},Ci={__name:"model-settings",setup(p){const a=B({sm:24,md:24,lg:12,xl:24,xxl:24});L([]);const d=L(!1),{robotInfo:n,updateRobotInfo:r,getRobot:o}=G("robotInfo"),t=B({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0,question_multiple_switch:1}),m=L(!1),b=(f,i)=>{const k=i.attrs;t.question_multiple_switch=Number(k.input_image)||0,k&&k.input_image==1?m.value=!1:m.value=!0,t.use_model&&t.use_model.toLowerCase().includes("deepseek-r1")?t.prompt_role_type="1":t.prompt_role_type="0"},x=L({}),h=(f,i)=>{x.value=i},E=Q(()=>{if(!t.model_config_id)return!1;let f=t.model_config_id+"#"+t.use_model;return x.value[f]}),y=()=>{let f={...Z(t)};r(f),d.value=!1},c=()=>{o(n.id).then(f=>{t.model_config_id=f.data.model_config_id,t.use_model=f.data.use_model})},w=f=>{t.use_model=n.use_model,t.model_config_id=n.model_config_id,t.temperature=n.temperature,t.max_token=n.max_token,t.context_pair=n.context_pair,t.think_switch=Number(n.think_switch),t.prompt_role_type=n.prompt_role_type,t.enable_thinking=n.enable_thinking,t.question_multiple_switch=Number(n.question_multiple_switch)||0,d.value=f};qe(()=>{t.use_model=n.use_model,t.model_config_id=n.model_config_id,t.temperature=n.temperature,t.max_token=n.max_token,t.context_pair=n.context_pair,t.think_switch=Number(n.think_switch),t.prompt_role_type=n.prompt_role_type,t.enable_thinking=n.enable_thinking,t.question_multiple_switch=Number(n.question_multiple_switch)||0});const u=Q(()=>dt(t.model_config_id,t.use_model));return(f,i)=>{const k=ee,S=Mt,g=Ke,V=Be,z=ne,O=lt,D=$e,P=oe,te=Dt,K=Y;return _(),N(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:d.value,"onUpdate:isEdit":i[14]||(i[14]=I=>d.value=I)},{extra:l(()=>[e("div",Kn,[s(k,{onClick:i[0]||(i[0]=I=>w(!0)),size:"small"},{default:l(()=>[...i[15]||(i[15]=[q("修改",-1)])]),_:1})])]),default:l(()=>[e("div",Jn,[e("div",Fn,[i[16]||(i[16]=q(" LLM模型： ",-1)),e("span",null,U(u.value),1)]),e("div",Wn,[i[17]||(i[17]=q(" 温度： ",-1)),e("span",null,U(t.temperature),1)]),e("div",Qn,[i[18]||(i[18]=q(" 最大token： ",-1)),e("span",null,U(t.max_token),1)]),e("div",Gn,[i[19]||(i[19]=q(" 上下文数量： ",-1)),e("span",null,U(t.context_pair),1)]),e("div",Hn,[i[20]||(i[20]=q(" 显示推理过程： ",-1)),e("span",null,U(t.think_switch==1?"开":"关"),1)])]),s(K,{open:d.value,"onUpdate:open":i[13]||(i[13]=I=>d.value=I),width:672,title:"模型设置",onCancel:c,onOk:y},{default:l(()=>[e("div",Xn,[s(te,{gutter:[32,24]},{default:l(()=>[s(S,de(fe(a)),{default:l(()=>[e("div",Zn,[i[21]||(i[21]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",Yn,[s(Je,{modelType:"LLM",modeName:t.use_model,"onUpdate:modeName":i[1]||(i[1]=I=>t.use_model=I),modeId:t.model_config_id,"onUpdate:modeId":i[2]||(i[2]=I=>t.model_config_id=I),onChange:b,onLoaded:h},null,8,["modeName","modeId"])])])]),_:1},16),s(S,de(fe(a)),{default:l(()=>[e("div",ei,[i[24]||(i[24]=e("div",{class:"form-item-label mb12"},[e("span",null,"提示词所属角色： ")],-1)),e("div",null,[s(V,{value:t.prompt_role_type,"onUpdate:value":i[3]||(i[3]=I=>t.prompt_role_type=I)},{default:l(()=>[s(g,{value:"0"},{default:l(()=>[...i[22]||(i[22]=[q("系统角色（System）",-1)])]),_:1}),s(g,{value:"1"},{default:l(()=>[...i[23]||(i[23]=[q("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])])])]),_:1},16),s(S,de(fe(a)),{default:l(()=>[e("div",ti,[e("div",oi,[i[26]||(i[26]=e("span",null,"温度 ",-1)),s(z,null,{title:l(()=>[...i[25]||(i[25]=[q("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),e("div",si,[e("div",ni,[e("div",ii,[s(O,{class:"custom-slider",value:t.temperature,"onUpdate:value":i[4]||(i[4]=I=>t.temperature=I),min:0,max:2,step:.1},null,8,["value"])]),e("div",li,[s(D,{value:t.temperature,"onUpdate:value":i[5]||(i[5]=I=>t.temperature=I),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),s(S,de(fe(a)),{default:l(()=>[e("div",ai,[e("div",ri,[i[28]||(i[28]=e("span",null,"最大token ",-1)),s(z,null,{title:l(()=>[...i[27]||(i[27]=[q("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),e("div",di,[e("div",ci,[e("div",_i,[s(O,{class:"custom-slider",value:t.max_token,"onUpdate:value":i[6]||(i[6]=I=>t.max_token=I),min:0,max:100*1024},null,8,["value"])]),e("div",ui,[s(D,{value:t.max_token,"onUpdate:value":i[7]||(i[7]=I=>t.max_token=I),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),s(S,de(fe(a)),{default:l(()=>[e("div",pi,[e("div",mi,[i[30]||(i[30]=e("span",null,"上下文数量 ",-1)),s(z,null,{title:l(()=>[...i[29]||(i[29]=[q("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),e("div",hi,[e("div",vi,[e("div",fi,[s(O,{class:"custom-slider",value:t.context_pair,"onUpdate:value":i[8]||(i[8]=I=>t.context_pair=I),min:0,max:50},null,8,["value"])]),e("div",bi,[s(D,{value:t.context_pair,"onUpdate:value":i[9]||(i[9]=I=>t.context_pair=I),min:0,max:50},null,8,["value"])])])])])]),_:1},16),s(S,de(fe(a)),{default:l(()=>[e("div",yi,[e("div",gi,[i[32]||(i[32]=e("span",null,"多模态输入 ",-1)),s(z,null,{title:l(()=>[...i[31]||(i[31]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),s(ro,{title:"当前选择的模型不支持多模态输入",disabled:!m.value},{default:l(()=>[s(P,{checked:t.question_multiple_switch,"onUpdate:checked":i[10]||(i[10]=I=>t.question_multiple_switch=I),checkedValue:1,unCheckedValue:0,disabled:m.value},null,8,["checked","disabled"])]),_:1},8,["disabled"])])]),_:1},16),E.value?(_(),N(S,de(et({key:0},a)),{default:l(()=>[e("div",ki,[e("div",wi,[i[34]||(i[34]=e("span",null,"深度思考 ",-1)),s(z,null,{title:l(()=>[...i[33]||(i[33]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),s(P,{checked:t.enable_thinking,"onUpdate:checked":i[11]||(i[11]=I=>t.enable_thinking=I),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):R("",!0),s(S,de(fe(a)),{default:l(()=>[e("div",xi,[e("div",$i,[i[36]||(i[36]=e("span",null,"显示推理过程 ",-1)),s(z,null,{title:l(()=>[...i[35]||(i[35]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),s(P,{checked:t.think_switch,"onUpdate:checked":i[12]||(i[12]=I=>t.think_switch=I),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Si=M(Ci,[["__scopeId","data-v-5cd8b1bd"]]),qi={class:"recall-settings-box"},Li={class:"form-box"},Ii={class:"form-item is-required"},Ri={class:"form-item-body"},Ei={class:"retrieval-mode-items"},Ui=["onClick"],Oi={class:"retrieval-mode-title"},Vi={class:"title-text"},Pi={key:0,style:{width:"32px"},src:po,alt:""},Ai={class:"retrieval-mode-desc"},Ni={key:0,class:"form-item"},Di={class:"form-item"},Mi={class:"form-item-label"},Ti={class:"form-item-body"},ji={class:"number-box"},zi={class:"number-slider-box"},Bi={class:"number-input-box"},Ki={key:1,class:"form-item"},Ji={class:"form-item-label"},Fi={class:"form-item-body"},Wi={class:"number-box"},Qi={class:"number-slider-box"},Gi={class:"number-input-box"},Hi={class:"form-item"},Xi={class:"form-item-label"},Zi={key:0,class:"form-item-body"},Yi={class:"form-item"},el={class:"form-item-label"},tl={key:0,class:"form-item-body"},ol={__name:"recall-settings-alert",emits:["change"],setup(p,{expose:a,emit:d}){const n=d,r=L([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=B({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{}}),t=L(null),m=L(!1),b=L({}),x=L([]),h=(i,k=null)=>{b.value=k,E(),o.rerank_status=i.rerank_status||0,o.rerank_use_model=i.rerank_use_model||void 0,o.rerank_model_config_id=i.rerank_model_config_id>0?i.rerank_model_config_id:"",o.top_k=i.top_k,o.similarity=i.similarity,o.search_type=i.search_type,o.meta_search_switch=Number(i.meta_search_switch),o.meta_search_type=Number(i.meta_search_type),o.meta_search_condition_list=i.meta_search_condition_list,o.rrf_weight=i.rrf_weight,m.value=!0},E=()=>{Lt({id:b.value.id}).then(i=>{x.value=(i==null?void 0:i.data)||[]})},y=i=>{i==0&&(o.rerank_model_config_id="",o.rerank_use_model="")},c=i=>{o.search_type=i},w=()=>o.rerank_status==1&&!o.rerank_model_config_id,u=()=>{if(w())return J.error("请选择Rerank模型");o.meta_search_switch==1&&!t.value.verify()||(m.value=!1,f())},f=()=>{n("change",Z(o))};return a({open:h}),(i,k)=>{const S=ie,g=ne,V=lt,z=$e,O=oe,D=Y;return _(),N(D,{width:"746px",open:m.value,"onUpdate:open":k[11]||(k[11]=P=>m.value=P),title:"召回设置",onOk:u},{default:l(()=>[e("div",qi,[e("div",Li,[e("div",Ii,[k[12]||(k[12]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",Ri,[e("div",Ei,[(_(!0),v(j,null,W(r.value,P=>(_(),v("div",{class:ae(["retrieval-mode-item",{active:o.search_type==P.value}]),key:P.value,onClick:te=>c(P.value)},[o.search_type==P.value?(_(),N(S,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",Oi,[s(S,{name:P.iconName,class:"title-icon"},null,8,["name"]),e("span",Vi,U(P.title),1),P.isRecommendation?(_(),v("img",Pi)):R("",!0)]),e("div",Ai,U(P.desc),1)],10,Ui))),128))])])]),o.search_type==1?(_(),v("div",Ni,[s(mo,{rrf_weight:o.rrf_weight,"onUpdate:rrf_weight":k[0]||(k[0]=P=>o.rrf_weight=P)},null,8,["rrf_weight"])])):R("",!0),e("div",Di,[e("div",Mi,[k[14]||(k[14]=e("span",null,"Top K ",-1)),s(g,null,{title:l(()=>[...k[13]||(k[13]=[q("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),e("div",Ti,[e("div",ji,[e("div",zi,[s(V,{class:"custom-slider",value:o.top_k,"onUpdate:value":k[1]||(k[1]=P=>o.top_k=P),min:1,max:500},null,8,["value"])]),e("div",Bi,[s(z,{value:o.top_k,"onUpdate:value":k[2]||(k[2]=P=>o.top_k=P),min:1,max:500},null,8,["value"])])])])]),o.search_type<=2?(_(),v("div",Ki,[e("div",Ji,[k[16]||(k[16]=e("span",null,"相似度阈值 ",-1)),s(g,null,{title:l(()=>[...k[15]||(k[15]=[q("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:l(()=>[s(C(H),{class:"question-icon"})]),_:1})]),e("div",Fi,[e("div",Wi,[e("div",Qi,[s(V,{class:"custom-slider",value:o.similarity,"onUpdate:value":k[3]||(k[3]=P=>o.similarity=P),min:0,max:1,step:.01},null,8,["value"])]),e("div",Gi,[s(z,{value:o.similarity,"onUpdate:value":k[4]||(k[4]=P=>o.similarity=P),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",Hi,[e("div",Xi,[k[17]||(k[17]=e("span",null,"Rerank模型",-1)),k[18]||(k[18]=q("   ",-1)),s(O,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":k[5]||(k[5]=P=>o.rerank_status=P),onChange:y},null,8,["checked"])]),o.rerank_status==1?(_(),v("div",Zi,[s(Je,{modelType:"RERANK",modeName:o.rerank_use_model,"onUpdate:modeName":k[6]||(k[6]=P=>o.rerank_use_model=P),modeId:o.rerank_model_config_id,"onUpdate:modeId":k[7]||(k[7]=P=>o.rerank_model_config_id=P),style:{width:"60%"}},null,8,["modeName","modeId"])])):R("",!0)]),e("div",Yi,[e("div",el,[s(g,{title:"元数据过滤是使用元数据属性（例如分组，知识创建时间等）来细化和控制系統内相关信息的检索过程。召回时仅会召回满足要求的知识。"},{default:l(()=>[e("span",null,[k[19]||(k[19]=q("元数据过滤 ",-1)),s(C(H))])]),_:1}),k[20]||(k[20]=q("   ",-1)),s(O,{checkedValue:1,unCheckedValue:0,checked:o.meta_search_switch,"onUpdate:checked":k[8]||(k[8]=P=>o.meta_search_switch=P)},null,8,["checked"])]),o.meta_search_switch==1?(_(),v("div",tl,[s(co,{rule:o.meta_search_condition_list,"onUpdate:rule":k[9]||(k[9]=P=>o.meta_search_condition_list=P),type:o.meta_search_type,"onUpdate:type":k[10]||(k[10]=P=>o.meta_search_type=P),ref_key:"metaFilterRef",ref:t,class:"meta-box","meta-data":x.value},null,8,["rule","type","meta-data"])])):R("",!0)])])])]),_:1},8,["open"])}}},sl=M(ol,[["__scopeId","data-v-b31e732f"]]),nl={class:"list-box"},il=["onClick"],ll={class:"avater-box"},al=["src"],rl={class:"content-box"},dl={class:"title-block"},cl={class:"title-text"},_l={class:"desc-box"},ul={class:"right-icon"},pl={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(p,{expose:a,emit:d}){const n=d,r=p,o=L(!1);le(()=>r.list,()=>{r.list.length==0&&(o.value=!1)},{});const t=()=>{o.value=!0},m=()=>{document.visibilityState==="visible"&&n("refreshList")};ye(()=>{document.addEventListener("visibilitychange",m)}),gt(()=>{document.removeEventListener("visibilitychange",m)});const b=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return a({show:t}),(x,h)=>{const E=Tt,y=ct,c=Y;return _(),v("div",null,[s(c,{open:o.value,"onUpdate:open":h[0]||(h[0]=w=>o.value=w),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:l(()=>[s(E,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),s(y,{scrollbar:!1,style:{height:"400px"}},{default:l(()=>[e("div",nl,[(_(!0),v(j,null,W(r.list,w=>(_(),v("div",{class:"list-item",onClick:u=>b(w),key:w.id},[e("div",ll,[e("img",{src:w.avatar,alt:""},null,8,al)]),e("div",rl,[e("div",dl,[h[1]||(h[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",cl,U(w.library_name),1)]),e("div",_l,U(w.library_intro),1)]),e("div",ul,[s(C(jt))])],8,il))),128))])]),_:1})]),_:1},8,["open"])])}}},ml=M(pl,[["__scopeId","data-v-0ebe0aeb"]]),hl={class:"actions-box"},vl={key:0,class:"library-list"},fl=["onClick"],bl={class:"library-avatar"},yl=["src"],gl={class:"info-content-box"},kl={class:"library-title-block"},wl={class:"title-text"},xl={class:"desc-info-block"},$l=["onClick"],Cl={class:"setting-info-block"},Sl={class:"set-item"},ql={key:0},Ll={key:1},Il={key:2},Rl={key:3},El={class:"set-item"},Ul={key:0,class:"set-item"},Ol={class:"set-item"},Vl={key:0},Pl={key:1},Al={__name:"index",setup(p){const a=It();Q(()=>{var O;return((O=a.companyInfo)==null?void 0:O.neo4j_status)=="true"});const d=L(!1),{robotInfo:n,updateRobotInfo:r}=G("robotInfo"),o=B({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{}}),t=L([]),m=L(null),b=L(null),x=Q(()=>t.value.filter(O=>b.value?o.library_ids.includes(O.id):o.library_ids.includes(O.id)&&O.type!=3)),h=Q(()=>x.value.filter(O=>O.graph_switch==0)),E=O=>{let D=o.library_ids.indexOf(O.id);o.library_ids.splice(D,1),k()},y=O=>{o.library_ids=[...O],k()},c=()=>{m.value.open([...o.library_ids])},w=L(null),u=()=>{w.value.open(Z(o),n)},f=L(null),i=O=>{o.rerank_status=O.rerank_status,o.rerank_use_model=O.rerank_use_model,o.rerank_model_config_id=O.rerank_model_config_id,o.top_k=O.top_k,o.similarity=O.similarity,o.search_type=O.search_type,o.meta_search_switch=O.meta_search_switch,o.meta_search_type=O.meta_search_type,o.meta_search_condition_list=O.meta_search_condition_list,o.rrf_weight=O.rrf_weight,(O.search_type==1||O.search_type==4)&&h.value.length>0&&f.value.show(),k()},k=()=>{let O={...Z(o)};O.library_ids=O.library_ids.join(","),O.op_type_relation_library=1,O.rrf_weight=JSON.stringify(O.rrf_weight),r({...O})},S=async()=>{const O=await Rt({type:"",show_open_docs:1});O&&(t.value=O.data||[])},g=()=>{ho({ability_type:"library_ability_official_account"}).then(O=>{var P;let D=(O==null?void 0:O.data)||{};((P=D==null?void 0:D.user_config)==null?void 0:P.switch_status)==1&&(b.value=D)})};o.rerank_use_model=n.rerank_use_model||void 0,qe(()=>{o.library_ids=n.library_ids.split(","),o.rerank_status=n.rerank_status||0,o.rerank_use_model=n.rerank_use_model||void 0,o.rerank_model_config_id=n.rerank_model_config_id||"",o.top_k=n.top_k,o.similarity=n.similarity,o.search_type=n.search_type,o.meta_search_switch=n.meta_search_switch,o.meta_search_type=n.meta_search_type,o.meta_search_condition_list=n.meta_search_condition_list,o.rrf_weight=n.rrf_weight!=""?JSON.parse(n.rrf_weight):{vector:0,search:0,graph:0}});const V=O=>{window.open(`#/library/details/knowledge-document?id=${O.id}`)},z=Q(()=>dt(o.rerank_model_config_id,o.rerank_use_model,"RERANK"));return ye(()=>{g(),S()}),(O,D)=>{const P=ee,te=we;return _(),N(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:d.value,"onUpdate:isEdit":D[0]||(D[0]=K=>d.value=K),bodyStyle:{padding:0}},{extra:l(()=>[e("div",hl,[s(te,{gap:8},{default:l(()=>[s(P,{size:"small",onClick:u},{default:l(()=>[...D[1]||(D[1]=[q("召回设置",-1)])]),_:1}),s(P,{size:"small",onClick:c},{default:l(()=>[...D[2]||(D[2]=[q("关联知识库",-1)])]),_:1})]),_:1})])]),default:l(()=>[x.value.length>0?(_(),v("div",vl,[(_(!0),v(j,null,W(x.value,K=>(_(),v("div",{class:"library-item",key:K.id,onClick:I=>V(K)},[e("div",bl,[e("img",{src:K.avatar,alt:""},null,8,yl)]),e("div",gl,[e("div",kl,[e("div",wl,U(K.library_name),1)]),e("div",xl,U(K.library_intro),1)]),K.id!=C(n).default_library_id?(_(),v("div",{key:0,class:"close-btn",onClick:kt(I=>E(K),["stop"])},[s(C(ge))],8,$l)):R("",!0)],8,fl))),128))])):R("",!0),e("div",Cl,[e("div",Sl,[D[3]||(D[3]=q(" 检索模式： ",-1)),o.search_type==1?(_(),v("span",ql,"混合检索")):R("",!0),o.search_type==2?(_(),v("span",Ll,"向量检索")):R("",!0),o.search_type==3?(_(),v("span",Il,"全文检索")):R("",!0),o.search_type==4?(_(),v("span",Rl,"知识图谱检索")):R("",!0)]),e("div",El,[D[4]||(D[4]=q(" Top K： ",-1)),e("span",null,U(o.top_k),1)]),o.search_type<=2?(_(),v("div",Ul,[D[5]||(D[5]=q(" 相似度阈值： ",-1)),e("span",null,U(o.similarity),1)])):R("",!0),e("div",Ol,[D[6]||(D[6]=q(" Rerank模型： ",-1)),o.rerank_status==0?(_(),v("span",Vl,"关")):(_(),v("span",Pl,U(z.value),1))])]),s(uo,{ref_key:"librarySelectAlertRef",ref:m,onChange:y,showWxType:!!b.value},null,8,["showWxType"]),s(sl,{ref_key:"recallSettingsAlertRef",ref:w,onChange:i},null,512),s(ml,{list:h.value,onRefreshList:S,ref_key:"noOpenGraphModalRef",ref:f},null,8,["list"])]),_:1},8,["isEdit"])}}},Nl=M(Al,[["__scopeId","data-v-0d28b5b9"]]),Dl={class:"library-checkbox-box"},Ml={class:"list-box",ref:"scrollContainer"},Tl={class:"library-name"},jl={class:"library-desc"},zl={key:0,class:"empty-box"},Bl={__name:"library-select-alert",emits:["change"],setup(p,{expose:a,emit:d}){const n=d,r=B({indeterminate:!1,checkAll:!1,checkedList:[]}),o=L(!1),t=c=>{h(),r.checkedList=c,o.value=!0},m=()=>{o.value=!1,x()};L("");const b=L([]),x=()=>{n("change",[...r.checkedList])},h=async()=>{const c=await _t();if(c){let w=c.data||[];b.value=w}},E=L(!1),y=()=>{window.open("/#/database/list")};return a({open:t}),(c,w)=>{const u=at,f=zt,i=ot,k=Y;return _(),N(k,{width:"746px",open:o.value,"onUpdate:open":w[1]||(w[1]=S=>o.value=S),title:"关联数据表",onOk:m},{default:l(()=>[e("div",Dl,[s(i,{spinning:E.value,delay:100},{default:l(()=>[s(f,{value:r.checkedList,"onUpdate:value":w[0]||(w[0]=S=>r.checkedList=S),style:{width:"100%"}},{default:l(()=>[e("div",Ml,[(_(!0),v(j,null,W(b.value,S=>(_(),v("div",{class:"list-item-wraapper",key:S.id},[s(u,{class:"list-item",value:S.id},{default:l(()=>[e("div",Tl,U(S.name),1),e("div",jl,U(S.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!E.value&&!b.value.length?(_(),v("div",zl,[w[3]||(w[3]=e("img",{src:vo,alt:""},null,-1)),e("div",null,[w[2]||(w[2]=q(" 暂无数据表, 请先去添加数据表 ",-1)),e("a",{onClick:y}," 去添加")])])):R("",!0)])]),_:1},8,["open"])}}},Kl=M(Bl,[["__scopeId","data-v-890ab853"]]),Jl={class:"actions-box"},Fl={key:0,class:"library-list"},Wl=["onClick"],Ql={class:"library-name"},Gl={class:"library-intro"},Hl={__name:"index",setup(p){const a=L(!1),{robotInfo:d,updateRobotInfo:n}=G("robotInfo"),r=B({form_ids:[]}),o=L([]),t=L(null),m=Q(()=>o.value.filter(c=>r.form_ids.includes(c.id))),b=c=>{let w=r.form_ids.indexOf(c.id);r.form_ids.splice(w,1),E()},x=c=>{r.form_ids=[...c],E()},h=()=>{t.value.open([...r.form_ids])},E=()=>{let c={...Z(r)};c.form_ids=c.form_ids.join(","),n({...c})};return(async()=>{const c=await _t();c&&(o.value=c.data||[])})(),qe(()=>{r.form_ids=d.form_ids.split(",")}),(c,w)=>{const u=ne,f=ee,i=we;return _(),N(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:a.value,"onUpdate:isEdit":w[0]||(w[0]=k=>a.value=k),bodyStyle:{padding:0}},{tip:l(()=>[s(u,{placement:"top"},{title:l(()=>[...w[1]||(w[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])]),default:l(()=>[s(C(H))]),_:1})]),extra:l(()=>[e("div",Jl,[s(i,{gap:8},{default:l(()=>[s(f,{size:"small",onClick:h},{default:l(()=>[...w[2]||(w[2]=[q("关联数据表",-1)])]),_:1})]),_:1})])]),default:l(()=>[m.value.length>0?(_(),v("div",Fl,[(_(!0),v(j,null,W(m.value,k=>(_(),v("div",{class:"library-item",key:k.id},[e("span",{class:"close-btn",onClick:S=>b(k)},[s(C(ge))],8,Wl),e("div",Ql,U(k.name),1),e("div",Gl,U(k.description),1)]))),128))])):R("",!0),s(Kl,{ref_key:"librarySelectAlertRef",ref:t,onChange:x},null,512)]),_:1},8,["isEdit"])}}},Xl=M(Hl,[["__scopeId","data-v-077d8df6"]]),Zl={class:"form-box"},Yl={class:"question-title"},ea={class:"question-options"},ta={class:"question-option"},oa={class:"drag-btn"},sa={class:"action-box"},na={class:"robot-info-box"},ia={class:"robot-welcome-content"},la={class:"robot-welcome-question"},aa={__name:"welcome-words",setup(p){const a=L(!1),d=L(!1),{robotInfo:n,updateRobotInfo:r,scrollBoxToBottom:o}=G("robotInfo"),t=B({welcomes:{content:"",question:[]}}),m=()=>{let y=!1;if(t.welcomes.question.length>0){for(let c=0;c<t.welcomes.question.length;c++)if(!t.welcomes.question[c].content){y=c+1;break}}return y},b=()=>{t.welcomes.question.push({content:"",id:Ee(8)})},x=y=>{t.welcomes.question.splice(y,1)},h=()=>{if(!t.welcomes.content)return J.error("请输入欢迎语");if(m())return J.error("引导问题内容不能为空");r({...Z(t)}),a.value=!1},E=()=>{let y={...n.welcomes},c=[];y.question.forEach(({content:w,id:u})=>{let f={id:u,content:w};f.id||(f.id=Ee(6)),c.push(f)}),t.welcomes.content=y.content,t.welcomes.question=c};return(y,c)=>{const w=xe,u=ie,f=me;return _(),N(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:a.value,"onUpdate:isEdit":c[4]||(c[4]=i=>a.value=i),onSave:h,onEdit:E},{default:l(()=>[ue(e("div",Zl,[e("div",Yl,[s(w,{value:t.welcomes.content,"onUpdate:value":c[0]||(c[0]=i=>t.welcomes.content=i),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",ea,[s(C(Pe),{modelValue:t.welcomes.question,"onUpdate:modelValue":c[1]||(c[1]=i=>t.welcomes.question=i),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=i=>d.value=!0),onEnd:c[3]||(c[3]=i=>d.value=!1)},{item:l(({element:i,index:k})=>[e("div",ta,[e("span",oa,[s(u,{name:"drag"})]),s(f,{class:"question-option-content",value:i.content,"onUpdate:value":S=>i.content=S,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",sa,[s(C(ge),{class:"del-btn",onClick:S=>x(k)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:b},[s(C(Oe),{class:"add-btn-icon"}),c[5]||(c[5]=q("添加引导问题 ",-1))])])],512),[[pe,a.value]]),ue(e("div",na,[e("div",ia,U(C(n).welcomes.content),1),e("div",la,[(_(!0),v(j,null,W(C(n).welcomes.question,(i,k)=>(_(),v("div",{class:"question-item",key:k},U(i.content),1))),128))])],512),[[pe,!a.value]])]),_:1},8,["isEdit"])}}},ra=M(aa,[["__scopeId","data-v-9b840ded"]]),da={class:"form-box"},ca={class:"question-title"},_a={class:"question-options"},ua={class:"question-option"},pa={class:"drag-btn"},ma={class:"action-box"},ha={class:"robot-info-box"},va={class:"robot-unknown-content"},fa={class:"robot-unknown-question"},ba={__name:"unknown-problem-prompt",setup(p){const a=L(!1),d=L(!1),{robotInfo:n,updateRobotInfo:r,scrollBoxToBottom:o}=G("robotInfo"),t=B({unknown_question_prompt:{content:"",question:[]}}),m=()=>{t.unknown_question_prompt.question.push({content:"",id:Ee(8)}),tt(()=>{o()})},b=E=>{t.unknown_question_prompt.question.splice(E,1)},x=()=>{r({...Z(t)}),a.value=!1},h=()=>{let E={...n.unknown_question_prompt},y=[];E.question&&E.question.forEach(({content:c,id:w})=>{let u={id:w,content:c};u.id||(u.id=Ee(6)),y.push(u)}),E.content&&(t.unknown_question_prompt.content=E.content),y&&(t.unknown_question_prompt.question=y)};return ye(()=>{}),(E,y)=>{const c=ne,w=xe,u=ie,f=me;return _(),N(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:a.value,"onUpdate:isEdit":y[4]||(y[4]=i=>a.value=i),onSave:x,onEdit:h},{tip:l(()=>[s(c,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...y[5]||(y[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])]),default:l(()=>[s(C(H))]),_:1})]),default:l(()=>[ue(e("div",da,[e("div",ca,[s(w,{value:t.unknown_question_prompt.content,"onUpdate:value":y[0]||(y[0]=i=>t.unknown_question_prompt.content=i),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",_a,[s(C(Pe),{modelValue:t.unknown_question_prompt.question,"onUpdate:modelValue":y[1]||(y[1]=i=>t.unknown_question_prompt.question=i),"item-key":"id",handle:".drag-btn",onStart:y[2]||(y[2]=i=>d.value=!0),onEnd:y[3]||(y[3]=i=>d.value=!1)},{item:l(({element:i,index:k})=>[e("div",ua,[e("span",pa,[s(u,{name:"drag"})]),s(f,{class:"question-option-content",value:i.content,"onUpdate:value":S=>i.content=S,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ma,[s(C(ge),{class:"del-btn",onClick:S=>b(k)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:m},[s(C(Oe),{class:"add-btn-icon"}),y[6]||(y[6]=q("添加引导问题 ",-1))])])],512),[[pe,a.value]]),ue(e("div",ha,[e("div",va,U(C(n).unknown_question_prompt.content),1),e("div",fa,[(_(!0),v(j,null,W(C(n).unknown_question_prompt.question,(i,k)=>(_(),v("div",{class:"question-item",key:k},U(i.content),1))),128))])],512),[[pe,!a.value]])]),_:1},8,["isEdit"])}}},ya=M(ba,[["__scopeId","data-v-aca01d0e"]]),ga={class:"robot-info-box"},ka={class:"modal-box",ref:"modalBoxRef"},wa={class:"modal-item-box"},xa={class:"modal-item"},$a={class:"modal-item"},Ca={__name:"problem-optimization",setup(p){const a=L(!1);L(!1);const{robotInfo:d,updateRobotInfo:n}=G("robotInfo"),r=L("0"),o=B({optimize_question_use_model:"",optimize_question_model_config_id:""});ye(()=>{r.value=d.optimize_question_model_config_id!=0?"1":"0",o.optimize_question_use_model=d.optimize_question_use_model,o.optimize_question_model_config_id=d.optimize_question_model_config_id});const t=L([]),m=y=>{t.value=y,tt(()=>{(!o.optimize_question_use_model||!Number(o.optimize_question_model_config_id))&&b()})},b=()=>{if(t.value.length>0){let y=null,c=null;for(let w of t.value)if(w.model_define==="tongyi"){y=w;for(let u of y.children)if(u.name==="qwen-max"){c=u;break}break}y||(y=t.value[0],c=y.children[0]),y&&c&&(o.optimize_question_use_model=c.name,o.optimize_question_model_config_id=c.model_config_id)}},x=()=>{a.value=!1,n({...Z(o)})},h=y=>{y!=1&&(o.optimize_question_use_model="",o.optimize_question_model_config_id=0)},E=y=>{n({})};return(y,c)=>{const w=ne,u=oe,f=Ke,i=Be,k=xe,S=Y;return _(),N(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:l(()=>[...c[7]||(c[7]=[e("span",null,null,-1)])]),default:l(()=>[e("div",ga,[c[9]||(c[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),s(w,null,{title:l(()=>[...c[8]||(c[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])]),default:l(()=>[e("div",{class:"dialog-bg-set",onClick:c[0]||(c[0]=g=>a.value=!0)}," 对话背景设置 ")]),_:1})]),s(u,{onChange:E,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(d).enable_question_optimize,"onUpdate:checked":c[1]||(c[1]=g=>C(d).enable_question_optimize=g),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",ka,[s(S,{getContainer:()=>y.$refs.modalBoxRef,open:a.value,"onUpdate:open":c[6]||(c[6]=g=>a.value=g),width:472,title:"用户问题建议设置",onOk:x},{default:l(()=>[e("div",wa,[e("div",xa,[c[12]||(c[12]=e("div",{class:"label"},"模型",-1)),s(i,{value:r.value,"onUpdate:value":c[2]||(c[2]=g=>r.value=g),onChange:h},{default:l(()=>[s(f,{value:"0"},{default:l(()=>[...c[10]||(c[10]=[q("跟随机器人",-1)])]),_:1}),s(f,{value:"1"},{default:l(()=>[...c[11]||(c[11]=[q("指定模型",-1)])]),_:1})]),_:1},8,["value"]),r.value=="1"?(_(),N(Je,{key:0,modelType:"LLM",modeName:o.optimize_question_use_model,"onUpdate:modeName":c[3]||(c[3]=g=>o.optimize_question_use_model=g),modeId:o.optimize_question_model_config_id,"onUpdate:modeId":c[4]||(c[4]=g=>o.optimize_question_model_config_id=g),style:{width:"100%","margin-top":"8px"},onLoaded:m},null,8,["modeName","modeId"])):R("",!0)]),e("div",$a,[c[13]||(c[13]=e("div",{class:"label"},"对话背景",-1)),s(k,{style:{height:"120px"},value:C(d).optimize_question_dialogue_background,"onUpdate:value":c[5]||(c[5]=g=>C(d).optimize_question_dialogue_background=g),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Sa=M(Ca,[["__scopeId","data-v-13ab9369"]]),qa={class:"robot-info-box"},La={class:"robot-prompt"},Ia={__name:"suggested-issues",setup(p){L(!1);const{robotInfo:a,updateRobotInfo:d}=G("robotInfo"),n=r=>{d({})};return(r,o)=>{const t=$e,m=oe;return _(),N(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:l(()=>[...o[2]||(o[2]=[e("span",null,null,-1)])]),default:l(()=>[e("div",qa,[e("div",La,[o[3]||(o[3]=q(" 开启后，机器人回答问题后，自动根据对话内容提供 ",-1)),s(t,{value:C(a).question_guide_num,"onUpdate:value":o[0]||(o[0]=b=>C(a).question_guide_num=b),style:{width:"80px"},precision:0,min:1,max:10,onBlur:n},null,8,["value"]),o[4]||(o[4]=q(" 条用户提问建议，最大不超过10条。 ",-1))])]),s(m,{onChange:n,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(a).enable_question_guide,"onUpdate:checked":o[1]||(o[1]=b=>C(a).enable_question_guide=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ra=M(Ia,[["__scopeId","data-v-bec632a5"]]),Ea={__name:"sensitive-words",setup(p){L(!1);const{robotInfo:a,updateRobotInfo:d}=G("robotInfo");B({prompt:""});const n=()=>{window.open("/#/user/sensitive-words")},r=o=>{d({})};return(o,t)=>{const m=oe;return _(),N(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:l(()=>[...t[1]||(t[1]=[e("span",null,null,-1)])]),default:l(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[t[2]||(t[2]=q(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，",-1)),e("span",{onClick:n,style:{cursor:"pointer"}},"设置敏词 >")])]),s(m,{onChange:r,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:C(a).sensitive_words_switch,"onUpdate:checked":t[0]||(t[0]=b=>C(a).sensitive_words_switch=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ua=M(Ea,[["__scopeId","data-v-f1e5ad50"]]),Oa={class:"direct-title"},Va={class:"direct-desc"},Pa={class:"qa"},Aa={class:"prompt-form-item-label"},Na={class:"direct-switch"},Da={class:"similarity"},Ma={class:"number-input-box"},Ta={__name:"chat-edit-alert",emits:["save"],setup(p,{expose:a,emit:d}){const n=d,r=L(1),o=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],t=B(o()),m=L(!1),b=B({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{b.chat_type=r.value.toString(),t.forEach(y=>{y.chat_type==r.value&&(b.chat_type=="3"?(b.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch==1?"true":"false",b.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score.toString()):b.chat_type=="1"&&(b.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch==1?"true":"false",b.library_qa_direct_reply_score=y.library_qa_direct_reply_score.toString()))}),h(),Object.assign(t,o()),m.value=!1},h=()=>{n("save",Z(b))};ye(()=>{});const E=y=>{r.value=parseInt(y.chat_type),b.chat_type=y.chat_type,b.library_qa_direct_reply_score=y.library_qa_direct_reply_score,b.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch,b.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score,b.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch,t.forEach(c=>{c.chat_type=="3"?(c.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score,c.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch=="true"?1:0):c.chat_type=="1"&&(c.library_qa_direct_reply_score=y.library_qa_direct_reply_score,c.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch=="true"?1:0)}),m.value=!0};return le(()=>m.value,y=>{y===!1&&Object.assign(t,o())},{immediate:!0}),a({open:E}),(y,c)=>{const w=ne,u=oe,f=$e,i=Ke,k=Be,S=Y;return _(),N(S,{width:"746px",open:m.value,"onUpdate:open":c[1]||(c[1]=g=>m.value=g),title:"聊天模式设置",onOk:x},{default:l(()=>[s(k,{class:"direct-box",value:r.value,"onUpdate:value":c[0]||(c[0]=g=>r.value=g)},{default:l(()=>[(_(!0),v(j,null,W(t,g=>(_(),N(i,{class:ae(["direct-item",{active:r.value==g.direct_id}]),value:g.direct_id,key:g.direct_id},{default:l(()=>[e("div",Oa,U(g.direct_title),1),e("div",Va,U(g.direct_desc),1),ue(e("div",Pa,[e("div",Aa,[c[4]||(c[4]=e("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),s(w,null,wt({default:l(()=>[s(C(H),{class:"question-icon"})]),_:2},[g.chat_type=="1"?{name:"title",fn:l(()=>[c[2]||(c[2]=q("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"0"}:g.chat_type=="3"?{name:"title",fn:l(()=>[c[3]||(c[3]=q("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"1"}:void 0]),1024),e("div",Na,[g.chat_type=="1"?(_(),N(u,{key:0,checkedValue:1,unCheckedValue:0,checked:g.library_qa_direct_reply_switch,"onUpdate:checked":V=>g.library_qa_direct_reply_switch=V},null,8,["checked","onUpdate:checked"])):g.chat_type=="3"?(_(),N(u,{key:1,checkedValue:1,unCheckedValue:0,checked:g.mixture_qa_direct_reply_switch,"onUpdate:checked":V=>g.mixture_qa_direct_reply_switch=V},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[pe,g.isQaDirectReply&&r.value==g.direct_id]]),ue(e("div",Da,[c[5]||(c[5]=e("span",null,"相似度超过",-1)),e("div",Ma,[g.chat_type=="1"?(_(),N(f,{key:0,value:g.library_qa_direct_reply_score,"onUpdate:value":V=>g.library_qa_direct_reply_score=V,disabled:!g.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):g.chat_type=="3"?(_(),N(f,{key:1,value:g.mixture_qa_direct_reply_score,"onUpdate:value":V=>g.mixture_qa_direct_reply_score=V,disabled:!g.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),c[6]||(c[6]=e("span",null,"时直接回复答案",-1))],512),[[pe,g.isQaDirectReply&&r.value==g.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},ja=M(Ta,[["__scopeId","data-v-96e9d8b8"]]),za={class:"actions-box"},Ba={class:"setting-info-block"},Ka={class:"set-item"},Ja={key:0},Fa={key:1},Wa={key:2},Qa={class:"set-item"},Ga={key:0,class:"set-item"},Ha={class:"set-item"},Xa={key:0,class:"set-item"},Za={class:"form-box"},Ya={__name:"index",setup(p){const a=L(!1),d=L(null),{robotInfo:n,updateRobotInfo:r}=G("robotInfo"),o=B({chat_type:n.chat_type,library_qa_direct_reply_score:n.library_qa_direct_reply_score,library_qa_direct_reply_switch:n.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:n.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:n.mixture_qa_direct_reply_switch}),t=x=>{o.chat_type=x.chat_type,o.library_qa_direct_reply_score=x.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,m()},m=()=>{r({...Z(o)}),a.value=!1},b=()=>{d.value.open(Z(o)),a.value=!0};return(x,h)=>{const E=ne,y=ee;return _(),N(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:a.value,"onUpdate:isEdit":h[1]||(h[1]=c=>a.value=c),bodyStyle:{padding:0}},{tip:l(()=>[s(E,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...h[2]||(h[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])]),default:l(()=>[s(C(H))]),_:1})]),extra:l(()=>[e("div",za,[s(y,{size:"small",onClick:h[0]||(h[0]=c=>b(!0))},{default:l(()=>[...h[3]||(h[3]=[q("修改",-1)])]),_:1})])]),default:l(()=>[e("div",Ba,[e("div",Ka,[h[4]||(h[4]=q(" 聊天模式： ",-1)),C(n).chat_type=="1"?(_(),v("span",Ja,"仅知识库")):R("",!0),C(n).chat_type=="2"?(_(),v("span",Fa,"直连模式")):R("",!0),C(n).chat_type=="3"?(_(),v("span",Wa,"混合模式")):R("",!0)]),C(n).chat_type=="1"?(_(),v(j,{key:0},[e("div",Qa,[h[5]||(h[5]=q(" 命中问答知识时直接回复答案： ",-1)),e("span",null,U(C(n).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),C(n).library_qa_direct_reply_switch=="true"?(_(),v("div",Ga,[h[6]||(h[6]=q(" 相似度阈值： ",-1)),e("span",null,U(C(n).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),C(n).chat_type=="3"?(_(),v(j,{key:1},[e("div",Ha,[h[7]||(h[7]=q(" 命中问答知识时直接回复答案： ",-1)),e("span",null,U(C(n).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),C(n).mixture_qa_direct_reply_switch=="true"?(_(),v("div",Xa,[h[8]||(h[8]=q(" 相似度阈值： ",-1)),e("span",null,U(C(n).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",Za,[s(ja,{ref_key:"ChatEditAlertRef",ref:d,onSave:t},null,512)])]),_:1},8,["isEdit"])}}},er=M(Ya,[["__scopeId","data-v-ed6b923e"]]),tr={class:"switch-box"},or={class:"switch-box-body"},sr={class:"switch-box-header"},nr={class:"left-box"},ir={class:"switch-box-title"},lr={key:0,class:"title-tip"},ar={class:"right-box"},rr={class:"extra-box"},dr={class:"switch-desc"},cr={class:"switch-box-right"},_r={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(p,{emit:a}){const d=a,n=p,r=L(n.value),o=t=>{d("update:value",t),d("change",t)};return(t,m)=>{const b=ie,x=oe;return _(),v("div",tr,[e("div",or,[e("div",sr,[e("div",nr,[s(b,{class:"switch-box-icon",name:n.iconName},null,8,["name"]),e("span",ir,U(n.title),1),t.$slots.tip?(_(),v("span",lr,[be(t.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",ar,[e("div",rr,[be(t.$slots,"extra",{},()=>[m[1]||(m[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",dr,[be(t.$slots,"default",{},void 0,!0)])]),e("div",cr,[s(x,{checked:r.value,"onUpdate:checked":m[0]||(m[0]=h=>r.value=h),onChange:o,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},ur=M(_r,[["__scopeId","data-v-0548f52d"]]),pr="/assets/img/phone-head-CDwwPhYa.png",mr="/assets/img/phone-body-CbEf8GZP.png",hr="/assets/img/phone-footer-ClQtNpln.png",vr={class:"common-problem-box"},fr={class:"left-content-box"},br={key:0,class:"empty-box"},yr={key:1,class:"lists-box"},gr={class:"drag-btn"},kr={class:"title"},wr={class:"opration-box"},xr={class:"preview-box"},$r={class:"phone-body"},Cr={key:0,class:"question-box"},Sr={__name:"common-problem",setup(p){L(!1);const{robotInfo:a,updateRobotInfo:d}=G("robotInfo"),n=Q(()=>a.common_question_list?JSON.parse(a.common_question_list):[]),r=L([]);r.value=n.value,le(n,()=>{r.value=n.value});const o=Ue.useForm,t=L(!1),m=L("添加问题"),b=B({question:"",index:-1}),x=B({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:h,validate:E,validateInfos:y}=o(b,x),c=()=>{if(n.value.length>=10)return J.error("最多设置10条常用问题");t.value=!0,h(),b.question="",b.index=-1},w=(S,g)=>{t.value=!0,h(),b.question=S,b.index=g},u=S=>{let g=[];g=n.value.filter((V,z)=>S!=z),Y.confirm({title:"提醒",icon:s(Se),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){d({common_question_list:JSON.stringify(g)})},onCancel(){}})},f=()=>{E().then(()=>{let S=[];b.index>=0?S=n.value.map((g,V)=>V===b.index?b.question:g):S=[b.question,...n.value],d({common_question_list:JSON.stringify(S)}),t.value=!1})},i=S=>{d({})},k=S=>{d({common_question_list:JSON.stringify(r.value)})};return(S,g)=>{const V=ne,z=oe,O=Bt,D=ee,P=ie,te=me,K=Te,I=Ue,se=Y;return _(),v("div",vr,[e("div",fr,[s(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:l(()=>[s(V,null,{title:l(()=>[...g[4]||(g[4]=[q("最多10条。开启后，常见问题会显示在每条问答后面",-1)])]),default:l(()=>[s(C(H),{class:"quess-icon"})]),_:1})]),extra:l(()=>[s(z,{onChange:i,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(a).enable_common_question,"onUpdate:checked":g[0]||(g[0]=F=>C(a).enable_common_question=F),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),s(O,{type:"vertical"}),s(D,{type:"primary",size:"small",onClick:c},{default:l(()=>[...g[5]||(g[5]=[q("添加",-1)])]),_:1})]),default:l(()=>[n.value.length==0?(_(),v("div",br,[g[7]||(g[7]=e("img",{src:fo,alt:""},null,-1)),g[8]||(g[8]=e("div",{class:"title"},"暂无数据",-1)),g[9]||(g[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),s(D,{onClick:c,type:"primary"},{default:l(()=>[...g[6]||(g[6]=[q("立即添加",-1)])]),_:1})])):(_(),v("div",yr,[s(C(Pe),{modelValue:r.value,"onUpdate:modelValue":g[1]||(g[1]=F=>r.value=F),handle:".drag-btn","item-key":"index",onEnd:k},{item:l(({element:F,index:ke})=>[(_(),v("div",{class:"list-item",key:ke},[e("span",gr,[s(P,{name:"drag"})]),e("div",kr,U(F),1),e("div",wr,[s(C(rt),{onClick:Ae=>w(F,ke)},null,8,["onClick"]),s(C(ge),{onClick:Ae=>u(ke)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",xr,[g[12]||(g[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:pr,alt:""})],-1)),e("div",$r,[g[11]||(g[11]=e("div",null,[e("img",{class:"body-img",src:mr,alt:""})],-1)),n.value.length&&C(a).enable_common_question=="true"?(_(),v("div",Cr,[g[10]||(g[10]=e("div",{class:"name"},"常见问题",-1)),(_(!0),v(j,null,W(n.value,F=>(_(),v("div",{class:"list-item",key:F},U(F),1))),128))])):R("",!0)]),g[13]||(g[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:hr,alt:""})],-1))]),s(se,{open:t.value,"onUpdate:open":g[3]||(g[3]=F=>t.value=F),title:m.value,onOk:f,width:"476px"},{default:l(()=>[s(I,{class:"form-box",layout:"vertical"},{default:l(()=>[s(K,et({label:"问题名称"},C(y).question),{default:l(()=>[s(te,{maxLength:100,value:b.question,"onUpdate:value":g[2]||(g[2]=F=>b.question=F),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},qr=M(Sr,[["__scopeId","data-v-dce83f0d"]]),Lr={__name:"display-aitations",setup(p){const{robotInfo:a,updateRobotInfo:d}=G("robotInfo"),n=L(!1);le(()=>a.answer_source_switch,o=>{n.value=o=="true"},{immediate:!0});const r=()=>{d({answer_source_switch:n.value?"true":"false"})};return(o,t)=>(_(),N(ur,{title:"显示引文","icon-name":"jibenpeizhi",value:n.value,"onUpdate:value":t[0]||(t[0]=m=>n.value=m),onChange:r},{extra:l(()=>[...t[1]||(t[1]=[e("span",null,null,-1)])]),default:l(()=>[t[2]||(t[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1},8,["value"]))}},Ir={__name:"show-like",setup(p){const{robotInfo:a,updateRobotInfo:d}=G("robotInfo"),n=r=>{d({})};return(r,o)=>{const t=oe;return _(),N(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:l(()=>[...o[1]||(o[1]=[e("span",null,null,-1)])]),default:l(()=>[o[2]||(o[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),s(t,{onChange:n,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:C(a).feedback_switch,"onUpdate:checked":o[0]||(o[0]=m=>C(a).feedback_switch=m),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Rr=M(Ir,[["__scopeId","data-v-73894b10"]]),Er={class:"content-box"},Ur={key:0,class:"add-btn-block"},Or={class:"list-content"},Vr={key:0,class:"user-block"},Pr={class:"name-box"},Ar={class:"name"},Nr={class:"remark-text"},Dr={key:0,class:"hover-btn-box"},Mr={key:0},Tr={key:1},jr={key:2},zr={key:1,class:"hover-btn-box"},Br={class:"role-menu-box"},Kr=["onClick"],Jr={class:"menu-header"},Fr={key:0,class:"check-box"},Wr=["onClick"],Qr={class:"menu-header"},Gr={key:0,class:"check-box"},Hr=["onClick"],Xr={class:"menu-header"},Zr={key:0,class:"check-box"},Yr={class:"hover-btn-box"},ed={key:0},td={key:1},od={key:2},sd=["onClick"],nd={__name:"role-permission",setup(p){const a=Et(),d=Q(()=>a.user_name),n=Me().query,r=L(Ut(n.id)),o=L([]),t=B({object_id:n.id,object_type:1}),m=()=>{bo({...t}).then(c=>{let w=c.data||[];o.value=w})};m();const b=L(null),x=()=>{b.value.show(o.value,[{object_id:+n.id,object_type:1,operate_rights:4}])},h=(c,w)=>{let u=w==4?"管理":w==2?"编辑":"查看";Y.confirm({title:"提示?",icon:s(Se),content:"确认修改该协作者权限为【"+u+"】",okText:"确认",cancelText:"取消",onOk:()=>{let f=[{object_id:+c.object_id,object_type:+c.object_type,operate_rights:+w}];yo({identity_ids:c.identity_id,identity_type:c.identity_type,object_array:JSON.stringify(f)}).then(i=>{J.success("修改成功"),m()})},onCancel(){}})},E=c=>{Y.confirm({title:"提示?",icon:s(Se),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{go({identity_id:c.identity_id,identity_type:c.identity_type,object_id:c.object_id,object_type:c.object_type}).then(w=>{J.success("删除成功"),m()})},onCancel(){}})},y=L([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(c,w)=>{const u=ee,f=Kt,i=Jt,k=Wt,S=ct;return _(),N(S,null,{default:l(()=>[e("div",Er,[r.value==4?(_(),v("div",Ur,[s(u,{type:"primary",onClick:x,icon:Ye(C(Oe))},{default:l(()=>[...w[0]||(w[0]=[q("添加协助者",-1)])]),_:1},8,["icon"])])):R("",!0),e("div",Or,[s(k,{columns:y.value,"data-source":o.value,pagination:!1},{bodyCell:l(({column:g,record:V})=>[g.key==="name"?(_(),v("div",Vr,[s(f,{shape:"square",src:V.avatar,size:40},{icon:l(()=>[V.avatar?R("",!0):(_(),N(C(Xe),{key:0}))]),_:2},1032,["src"]),e("div",Pr,[e("div",Ar,U(V.user_name),1),e("div",Nr,U(V.name),1)])])):R("",!0),g.key==="operate_rights"?(_(),v(j,{key:1},[r.value==2||V.user_name==d.value?(_(),v("div",Dr,[V.operate_rights==4?(_(),v("span",Mr,"管理")):R("",!0),V.operate_rights==2?(_(),v("span",Tr,"编辑")):R("",!0),V.operate_rights==1?(_(),v("span",jr,"查看")):R("",!0)])):V.role_type==1||V.is_creator==1?(_(),v("div",zr,"管理")):(_(),N(i,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[e("div",Br,[e("div",{class:"role-menu",onClick:z=>h(V,4)},[e("div",Jr,[s(C(Xe)),w[1]||(w[1]=e("span",{class:"title"},"管理",-1))]),w[2]||(w[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),V.operate_rights==4?(_(),v("div",Fr,[s(C(Ne))])):R("",!0)],8,Kr),e("div",{class:"role-menu",onClick:z=>h(V,2)},[e("div",Qr,[s(C(rt)),w[3]||(w[3]=e("span",{class:"title"},"编辑",-1))]),w[4]||(w[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),V.operate_rights==2?(_(),v("div",Gr,[s(C(Ne))])):R("",!0)],8,Wr),e("div",{class:"role-menu",onClick:z=>h(V,1)},[e("div",Xr,[s(C(Ft)),w[5]||(w[5]=e("span",{class:"title"},"查看",-1))]),w[6]||(w[6]=e("div",{class:"desc"},"仅查看",-1)),V.operate_rights==1?(_(),v("div",Zr,[s(C(Ne))])):R("",!0)],8,Hr)])]),default:l(()=>[e("div",Yr,[V.operate_rights==4?(_(),v("span",ed,"管理")):R("",!0),V.operate_rights==2?(_(),v("span",td,"编辑")):R("",!0),V.operate_rights==1?(_(),v("span",od,"查看")):R("",!0),s(C(it))])]),_:2},1024))],64)):R("",!0),g.key==="action"?(_(),v(j,{key:2},[r.value==4&&V.user_name!=d.value?(_(),v(j,{key:0},[V.role_type!=1&&V.is_creator!=1?(_(),v("a",{key:0,onClick:z=>E(V)},"移除",8,sd)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),s(ko,{onOk:m,ref_key:"addCollaboratorRef",ref:b},null,512)]),_:1})}}},id=M(nd,[["__scopeId","data-v-64f2a2fa"]]),ld={class:"actions-box"},ad={key:0,class:"library-list"},rd=["onClick"],dd={class:"library-name"},cd={class:"library-intro"},_d={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(p){const a=L(!1),{robotInfo:d,getRobot:n}=G("robotInfo"),r=p,o=B({work_flow_ids:[]}),t=L(null),m=Q(()=>r.robotList.filter(y=>o.work_flow_ids.includes(y.id))),b=y=>{let c=o.work_flow_ids.indexOf(y.id);o.work_flow_ids.splice(c,1),E()},x=y=>{o.work_flow_ids=[...y],E()},h=()=>{t.value.open([...o.work_flow_ids])},E=()=>{let y={...Z(o)};y.work_flow_ids=y.work_flow_ids.join(","),to({id:d.id,...y}).then(c=>{J.success("保存成功"),n(d.id)})};return qe(()=>{o.work_flow_ids=d.work_flow_ids.split(",")}),(y,c)=>{const w=ne,u=ee,f=we;return _(),N(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:a.value,"onUpdate:isEdit":c[0]||(c[0]=i=>a.value=i),bodyStyle:{padding:0}},{tip:l(()=>[s(w,{placement:"top"},{title:l(()=>[...c[1]||(c[1]=[e("span",null,"支持关联工作流",-1)])]),default:l(()=>[s(C(H))]),_:1})]),extra:l(()=>[e("div",ld,[s(f,{gap:8},{default:l(()=>[s(u,{size:"small",onClick:h},{default:l(()=>[...c[2]||(c[2]=[q("添加技能",-1)])]),_:1})]),_:1})])]),default:l(()=>[m.value.length>0?(_(),v("div",ad,[(_(!0),v(j,null,W(m.value,i=>(_(),v("div",{class:"library-item",key:i.id},[e("span",{class:"close-btn",onClick:k=>b(i)},[s(C(ge))],8,rd),e("div",dd,U(i.robot_name),1),e("div",cd,U(i.robot_intro),1)]))),128))])):R("",!0),s(wo,{ref_key:"robotSelectAlertRef",ref:t,onChange:x},null,512)]),_:1},8,["isEdit"])}}},ud=M(_d,[["__scopeId","data-v-e0ced8ed"]]),pd={class:"robot-info-box"},md={class:"set-block"},hd={class:"switch-item"},vd={__name:"chat-cache",setup(p){const{robotInfo:a,updateRobotInfo:d}=G("robotInfo"),n=B({valid_time:"",cache_switch:0}),r=B({unix:"h",hValue:24,mValue:1440}),o=()=>{r.unix==="h"?n.valid_time=r.hValue*3600:n.valid_time=r.mValue*60,d({cache_config:{...n}})},t=()=>{o()},m=()=>{r.unix=="h"?r.hValue=parseInt(r.mValue/60):r.mValue=parseInt(r.hValue*60)},b=()=>{Y.confirm({title:"确定清空缓存?",icon:s(Se),content:"确定操作清空缓存吗？",onOk(){oo({id:a.id,robot_key:a.robot_key}).then(x=>{J.success("清空成功")})}})};return le(()=>a.cache_config,()=>{let x=a.cache_config||{};x=JSON.parse(JSON.stringify(x)),n.cache_switch=x.cache_switch,n.valid_time=x.valid_time,x.valid_time%3600==0?(r.unix="h",r.hValue=x.valid_time/3600):(r.unix="m",r.mValue=parseInt(x.valid_time/60)||1440)},{immediate:!0,deep:!0}),qe(()=>{}),(x,h)=>{const E=$e,y=ze,c=je,w=Qt,u=ee,f=oe;return _(),N(X,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:l(()=>[...h[4]||(h[4]=[e("span",null,null,-1)])]),default:l(()=>[e("div",pd,[h[7]||(h[7]=q(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ",-1)),e("div",md,[s(w,{compact:""},{default:l(()=>[r.unix=="h"?(_(),N(E,{key:0,onBlur:o,precision:0,value:r.hValue,"onUpdate:value":h[0]||(h[0]=i=>r.hValue=i),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(_(),N(E,{key:1,onBlur:o,precision:0,value:r.mValue,"onUpdate:value":h[1]||(h[1]=i=>r.mValue=i),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),s(c,{value:r.unix,"onUpdate:value":h[2]||(h[2]=i=>r.unix=i),style:{width:"70px"},onChange:m},{default:l(()=>[s(y,{value:"h"},{default:l(()=>[...h[5]||(h[5]=[q("小时",-1)])]),_:1}),s(y,{value:"m"},{default:l(()=>[...h[6]||(h[6]=[q("分钟",-1)])]),_:1})]),_:1},8,["value"])]),_:1})])]),e("div",hd,[s(u,{onClick:b,size:"small"},{default:l(()=>[...h[8]||(h[8]=[q("清空缓存",-1)])]),_:1}),s(f,{onChange:t,checkedValue:1,unCheckedValue:0,checked:n.cache_switch,"onUpdate:checked":h[3]||(h[3]=i=>n.cache_switch=i),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])]),_:1})}}},fd=M(vd,[["__scopeId","data-v-e779aa9b"]]),bd={key:0},yd={key:1},gd={key:2,placeholder:"请选择默认值"},kd={key:3,placeholder:"请选择默认值"},wd={class:"drag-btn"},xd={__name:"add-variable-modal",emits:["ok"],setup(p,{expose:a,emit:d}){const n=Me().query,r=L(!1),o=d,t=B({robot_key:n.robot_key,id:"",variable_type:"input_string",variable_key:"",variable_name:"",max_input_length:10,default_value:"",must_input:!1,options:[{label:""}]}),m=Q(()=>t.options.filter(u=>u.label)),b=(u={})=>{t.id=u.id||"",t.variable_type=u.variable_type||"input_string",t.variable_key=u.variable_key||"",t.variable_name=u.variable_name||"",t.max_input_length=u.max_input_length||10,t.default_value=u.default_value||"",t.must_input=u.must_input=="1",t.options=u.options||[{label:""}],r.value=!0},x=(u,f)=>f?/^[a-zA-Z_]+$/.test(f)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key"),h=L(),E=()=>{h.value.validate().then(()=>{let u=[];if(t.variable_type=="select_one"&&(u=t.options.filter(i=>i.label!=""),u.length==0))return J.error("请填写选项");let f=t.max_input_length;(t.variable_type=="select_one"||t.variable_type=="checkbox_switch")&&(f=1),so({...t,max_input_length:f,must_input:t.must_input?1:0,options:JSON.stringify(u)}).then(i=>{J.success(t.id?"更新成功":"创建成功"),r.value=!1,o("ok")})})},y=()=>{t.options.push({label:""})},c=u=>{t.options.length>1&&t.options.splice(u,1)},w=()=>{t.options=[{label:""}],t.variable_type=="checkbox_switch"?t.default_value="2":t.default_value=void 0};return a({show:b}),(u,f)=>{const i=ze,k=je,S=Te,g=me,V=$e,z=at,O=ee,D=ie,P=Gt,te=Ue,K=Y;return _(),v("div",null,[s(K,{open:r.value,"onUpdate:open":f[10]||(f[10]=I=>r.value=I),title:"字段详情",onOk:E,width:648,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"70vh","overflow-y":"auto","padding-right":"12px"}},{default:l(()=>[s(te,{model:t,ref_key:"formRef",ref:h,layout:"vertical","label-col":{span:4},"wrapper-col":{span:24}},{default:l(()=>[s(S,{label:"字段类型",name:"variable_type"},{default:l(()=>[s(k,{onChange:w,value:t.variable_type,"onUpdate:value":f[0]||(f[0]=I=>t.variable_type=I),placeholder:"请选择字段类型"},{default:l(()=>[s(i,{value:"input_string"},{default:l(()=>[...f[11]||(f[11]=[q("文本",-1)])]),_:1}),s(i,{value:"input_number"},{default:l(()=>[...f[12]||(f[12]=[q("数字",-1)])]),_:1}),s(i,{value:"select_one"},{default:l(()=>[...f[13]||(f[13]=[q("下拉单选",-1)])]),_:1}),s(i,{value:"checkbox_switch"},{default:l(()=>[...f[14]||(f[14]=[q("复选框",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s(S,{label:"字段key",name:"variable_key",rules:[{required:!0,validator:(I,se)=>x(I,se)}]},{default:l(()=>[s(g,{value:t.variable_key,"onUpdate:value":f[1]||(f[1]=I=>t.variable_key=I),maxLength:10,placeholder:"请输入字段key"},null,8,["value"])]),_:1},8,["rules"]),s(S,{label:"字段名",name:"variable_name",rules:[{required:!0}]},{default:l(()=>[s(g,{value:t.variable_name,"onUpdate:value":f[2]||(f[2]=I=>t.variable_name=I),maxLength:10,placeholder:"请输入字段名"},null,8,["value"])]),_:1}),["input_string","input_number"].includes(t.variable_type)?(_(),N(S,{key:0,label:"最大长度",name:"max_input_length"},{default:l(()=>[s(V,{value:t.max_input_length,"onUpdate:value":f[3]||(f[3]=I=>t.max_input_length=I),placeholder:"请输入",precision:0,min:1,max:50},null,8,["value"])]),_:1})):R("",!0),s(S,{label:"默认值",name:"default_value"},{default:l(()=>[t.variable_type=="input_string"?(_(),v("div",bd,[s(g,{value:t.default_value,"onUpdate:value":f[4]||(f[4]=I=>t.default_value=I),placeholder:"请输入默认值"},null,8,["value"])])):R("",!0),t.variable_type=="input_number"?(_(),v("div",yd,[s(V,{maxLength:50,style:{width:"100%"},stringMode:"",value:t.default_value,"onUpdate:value":f[5]||(f[5]=I=>t.default_value=I),placeholder:"请输入默认值"},null,8,["value"])])):R("",!0),t.variable_type=="select_one"?(_(),v("div",gd,[s(k,{value:t.default_value,"onUpdate:value":f[6]||(f[6]=I=>t.default_value=I),style:{width:"100%"}},{default:l(()=>[(_(!0),v(j,null,W(m.value,I=>(_(),N(i,{value:I.label},{default:l(()=>[q(U(I.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])):R("",!0),t.variable_type=="checkbox_switch"?(_(),v("div",kd,[s(k,{value:t.default_value,"onUpdate:value":f[7]||(f[7]=I=>t.default_value=I),style:{width:"100%"}},{default:l(()=>[s(i,{value:"1"},{default:l(()=>[...f[15]||(f[15]=[q("选中",-1)])]),_:1}),s(i,{value:"2"},{default:l(()=>[...f[16]||(f[16]=[q("不选中",-1)])]),_:1})]),_:1},8,["value"])])):R("",!0)]),_:1}),t.variable_type!="checkbox_switch"?(_(),N(S,{key:1,label:null,name:"must_input"},{default:l(()=>[s(z,{checked:t.must_input,"onUpdate:checked":f[8]||(f[8]=I=>t.must_input=I)},{default:l(()=>[...f[17]||(f[17]=[q("必填",-1)])]),_:1},8,["checked"])]),_:1})):R("",!0),t.variable_type==="select_one"?(_(),N(S,{key:2,label:"选项",name:"options"},{default:l(()=>[s(O,{type:"dashed",onClick:y},{default:l(()=>[...f[18]||(f[18]=[q("+ 添加选项",-1)])]),_:1}),s(P,null,{default:l(()=>[s(C(Pe),{modelValue:t.options,"onUpdate:modelValue":f[9]||(f[9]=I=>t.options=I),"item-key":"index",group:"table-rows",handle:".drag-btn"},{item:l(({element:I,index:se})=>[(_(),v("div",{key:se,class:"option-item"},[e("span",wd,[s(D,{name:"drag"})]),s(g,{value:I.label,"onUpdate:value":F=>I.label=F,maxLength:50,placeholder:"请输入选项标签"},null,8,["value","onUpdate:value"]),s(O,{type:"link",danger:"",onClick:F=>c(se)},{default:l(()=>[...f[19]||(f[19]=[q("删除",-1)])]),_:1},8,["onClick"])]))]),_:1},8,["modelValue"])]),_:1})]),_:1})):R("",!0)]),_:1},8,["model"])]),_:1},8,["open"])])}}},$d=M(xd,[["__scopeId","data-v-560786fa"]]),Cd={class:"actions-box"},Sd={class:"form-box"},qd={class:"variable-list-box"},Ld={class:"variable-info-block"},Id={class:"type-tags"},Rd={class:"btn-box"},Ed=["onClick"],Ud=["onClick"],Od={__name:"index",setup(p){const a=Ve();let d={input_string:"string",input_number:"number",select_one:"string",checkbox_switch:"boolean"};const n=Q(()=>a.chatVariables),r=L(null),o=()=>{if(n.value.length>=10)return J.error("最多添加10个变量");r.value.show()},t=x=>{r.value.show(JSON.parse(JSON.stringify(x)))},m=()=>{a.fetchChatVariables()},b=x=>{Y.confirm({title:"删除确认?",icon:s(Se),content:`确认删除该变量【${x.variable_name}】?`,okType:"danger",onOk(){no({robot_key:x.robot_key,id:x.id}).then(h=>{J.success("删除成功"),m()})}})};return ye(()=>{}),(x,h)=>{const E=ne,y=ee,c=we,w=ie,u=Xt,f=Ht,i=Zt;return _(),N(X,{class:"setting-box",title:"变量","icon-name":"variable-icon"},{tip:l(()=>[s(E,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...h[0]||(h[0]=[e("span",null,"变量将以表单形式让用户在对话前填写，用户填写的表单内容将自动替换提示词中的变量。提示词中输入/可选择变量",-1)])]),default:l(()=>[s(C(H))]),_:1})]),extra:l(()=>[e("div",Cd,[s(c,{gap:8},{default:l(()=>[s(y,{size:"small",onClick:o},{default:l(()=>[...h[1]||(h[1]=[q("新增变量",-1)])]),_:1})]),_:1})])]),default:l(()=>[e("div",Sd,[e("div",qd,[(_(!0),v(j,null,W(n.value,k=>(_(),v("div",{class:"variable-item",key:k.id},[e("div",Ld,[e("span",{class:ae({"is-required":k.must_input==1})},U(k.variable_key),3),e("span",null,"（"+U(k.variable_name)+"）",1),e("span",Id,U(C(d)[k.variable_type]),1)]),s(i,null,{overlay:l(()=>[s(f,null,{default:l(()=>[s(u,null,{default:l(()=>[e("a",{onClick:S=>t(k)},"编 辑",8,Ed)]),_:2},1024),s(u,null,{default:l(()=>[e("a",{onClick:S=>b(k)},"删 除",8,Ud)]),_:2},1024)]),_:2},1024)]),default:l(()=>[e("div",Rd,[s(w,{name:"more-cycle"})])]),_:2},1024)]))),128))])]),s($d,{ref_key:"addVariableModalRef",ref:r,onOk:m},null,512)]),_:1})}}},Vd=M(Od,[["__scopeId","data-v-e41cfbb3"]]),Pd={class:"robot-info-box"},Ad={class:"robot-prompt"},Nd={__name:"answer-prompt",setup(p){L(!1);const{robotInfo:a,updateRobotInfo:d}=G("robotInfo"),n=o=>{d({})},r=()=>{a.tips_before_answer_content,a.tips_before_answer_content==""&&(a.tips_before_answer_content="思考中、请稍等"),n()};return(o,t)=>{const m=me,b=oe;return _(),N(X,{class:"setting-box",title:"答案生成中提示语","icon-name":"suggested-issues"},{extra:l(()=>[...t[2]||(t[2]=[e("span",null,null,-1)])]),default:l(()=>[e("div",Pd,[e("div",Ad,[t[3]||(t[3]=q(" 开启后，WebAPP、嵌入网站对外服务中，答案生成前会显示提示语 ",-1)),s(m,{value:C(a).tips_before_answer_content,"onUpdate:value":t[0]||(t[0]=x=>C(a).tips_before_answer_content=x),style:{width:"280px"},maxLength:10,placeholder:"请输入",onBlur:r},null,8,["value"])])]),s(b,{onChange:n,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(a).tips_before_answer_switch,"onUpdate:checked":t[1]||(t[1]=x=>C(a).tips_before_answer_switch=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Dd=M(Nd,[["__scopeId","data-v-a03407ec"]]),Md={key:0,class:"robot-config-page"},Td={class:"setting-box"},jd={class:"setting-box"},zd={class:"setting-box"},Bd={class:"setting-box"},Kd={class:"setting-box"},Jd={class:"setting-box"},Fd={class:"setting-box"},Wd={class:"setting-box"},Qd={class:"setting-box"},Gd={class:"setting-box"},Hd={class:"setting-box"},Xd={class:"setting-box"},Zd={class:"setting-box"},Yd={class:"setting-box"},ec={class:"setting-box"},tc={class:"setting-box"},oc={class:"setting-box"},sc={key:1,class:"robot-config-page"},nc={key:2,class:"robot-config-page"},Ze="/robot/config/basic-config/activeKey",ic={__name:"index",setup(p){const a=Ve(),d=L(null),{robotInfo:n}=xt(a),{getRobot:r,fetchChatVariables:o}=a,t=_o(),m=()=>{d.value.scrollTop=d.value.scrollHeight},b=L(+localStorage.getItem(Ze)||1),x=L(!1),h=B(n.value),E=f=>{let i=JSON.parse(JSON.stringify(f));f.robot_avatar&&(i.robot_avatar=new File([f.robot_avatar],f.robot_avatar.name)),!i.op_type_relation_library&&h.op_type_relation_library&&delete h.op_type_relation_library,Object.assign(h,i),w()},y=L([]),c=()=>{io({application_type:1}).then(f=>{y.value=f.data||[]})};$t("robotInfo",{robotInfo:h,updateRobotInfo:E,scrollBoxToBottom:m,getRobot:r});const w=()=>{let f;h.robot_avatar&&(f=new File([h.robot_avatar],h.robot_avatar.name));let i=JSON.parse(JSON.stringify(Z(h)));f&&(i.robot_avatar=f);let k=i.welcomes;k.question=k.question.map(g=>g.content),i.welcomes=JSON.stringify(k),i.prompt_struct=JSON.stringify(i.prompt_struct);let S=i.unknown_question_prompt;S.question=S.question.map(g=>g.content),i.unknown_question_prompt=JSON.stringify(S),i.cache_config=JSON.stringify(i.cache_config),delete i.robot_avatar_url,x.value=!0,lo(i).then(g=>{if(g.res!=0)return J.error(g.msg);x.value=!1,J.success("保存成功"),r(h.id)}).catch(()=>{x.value=!1})},u=()=>{localStorage.setItem(Ze,b.value)};return ye(()=>{c(),t.getAllmodelList(),o()}),(f,i)=>{const k=st,S=nt;return _(),v(j,null,[s(S,{class:"tab-wrapper",onChange:u,activeKey:b.value,"onUpdate:activeKey":i[0]||(i[0]=g=>b.value=g)},{default:l(()=>[(_(),N(k,{key:1,tab:"基础配置"})),R("",!0),(_(),N(k,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),b.value==1?(_(),v("div",Md,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:d},[e("div",Td,[s(Fo)]),e("div",jd,[s(Nl)]),e("div",zd,[s(Si)]),e("div",Bd,[s(er)]),e("div",Kd,[s(fd)]),e("div",Jd,[s(Bn,{robotList:y.value},null,8,["robotList"])]),e("div",Fd,[s(ud,{robotList:y.value},null,8,["robotList"])]),e("div",Wd,[s(Xl)]),e("div",Qd,[s(ra)]),e("div",Gd,[s(Vd)]),e("div",Hd,[s(ya)]),e("div",Xd,[s(Ua)]),e("div",Zd,[s(Sa)]),e("div",Yd,[s(Ra)]),e("div",ec,[s(Lr)]),e("div",tc,[s(Dd)]),e("div",oc,[s(Rr)])],512)])):R("",!0),b.value==2?(_(),v("div",sc,[s(qr)])):R("",!0),b.value==3?(_(),v("div",nc,[s(id)])):R("",!0)],64)}}},Oc=M(ic,[["__scopeId","data-v-8c5676e2"]]);export{Oc as default};
