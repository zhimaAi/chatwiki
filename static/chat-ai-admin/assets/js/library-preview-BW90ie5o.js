import{L as l,M as p,V as t,j as o,Q as a,u as Q,a3 as Z,a4 as G,af as fe,X as I,Y as O,F as B,a1 as Y,a7 as ue,a8 as F,E as me,a0 as ve,r as y,b as N,A as Oe,$ as Ie,a5 as Ee,P as T}from"./vue-chunks-DrvJJrR0.js";import{_ as Pe}from"./empty-CzGZrENG.js";import{_ as K,B as he,M as ne,E as Le,e as j,c as Ce}from"../../index-B7hMzf9q.js";import{P as be}from"./PlusOutlined-DL-hdu2z.js";import{n as Ae,o as De,p as Fe,b as Me,q as Te}from"./index-BuFCIUi8.js";import{C as oe}from"./cu-scroll-OB5tyCcl.js";import{U as Be}from"./index-DVlH1-gY.js";import"./index-Dw_8Y6aL.js";import{I as je}from"./Input-CL6tjIMU.js";import{_ as Re,T as Ue}from"./index-DKxe4foz.js";import{_ as Ve}from"./TextArea-CG0P41dy.js";import{_ as ze}from"./index-fgx08nOg.js";import{_ as He,F as Qe}from"./index-BKI2K5cz.js";import{S as Ne,_ as Ke}from"./index-NynCXQ0s.js";import{B as Je,_ as We}from"./index-D8MPnKDp.js";import{_ as Xe,S as Ye}from"./SettingOutlined-XSNkqOUP.js";import{D as Ze}from"./DownOutlined-B5dBaul-.js";import{_ as Ge,M as et}from"./index-B74dmqu4.js";import"./index-Zn_D09PO.js";import{D as tt}from"./dropdown-BiEW6MsM.js";import{S as ot}from"./index-ZVG0aRlo.js";import{L as nt}from"./LeftOutlined-CA0JWJxB.js";import"./dayjs-Bv4VEw_C.js";import"./axios-Cm0UX6qg.js";import"./qs-QntUJHOZ.js";import"./crypto-js-BpV8n4kc.js";import"./index-BMJXFAbq.js";import"./Password-gTEcwCfD.js";import"./inputProps-D8s__VTw.js";import"./index-YwUTZXQz.js";import"./colors-AwmC3pbR.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./CheckOutlined-C9DwVUk4.js";import"./useRefs-Bj34oM9A.js";import"./collapseMotion-ChcyS4Km.js";import"./FormItemContext-DpTNEgKz.js";import"./index-CBMSGrct.js";import"./Search-CVTK-J_z.js";import"./SearchOutlined-BgR6uuBy.js";import"./Dropdown-Cwmk4BWs.js";import"./index-Dvj-et0N.js";import"./slide-CiMyoPxP.js";import"./responsiveObserve-DuhiEUQX.js";import"./QuestionCircleOutlined-yzwF_I28.js";import"./move-CNAILSVj.js";import"./shallowequal-CfnxU2uU.js";import"./RightOutlined-CMGSfS0w.js";const se=e=>(Z("data-v-16e77398"),e=e(),G(),e),st={class:"empty-box"},at=se(()=>t("img",{src:Pe,alt:""},null,-1)),lt=se(()=>t("div",{class:"title"},"知识库文档为空，请添加分段",-1)),it=se(()=>t("span",null,"添加分段",-1)),rt={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(e,{emit:c}){const n=c,f=()=>{n("openEditSubscription",{})};return(u,m)=>{const v=he;return l(),p("div",st,[at,lt,t("div",null,[o(v,{type:"primary",onClick:f},{icon:a(()=>[o(Q(be))]),default:a(()=>[it]),_:1})])])}}},_e=K(rt,[["__scopeId","data-v-16e77398"]]),ct=e=>(Z("data-v-cdb41e8b"),e=e(),G(),e),ut={class:"subsection-box"},_t={class:"subsection-box-title"},dt=["onClick"],pt={class:"top-block"},ft={class:"title"},mt={class:"right-opration"},vt=["onClick"],ht=ct(()=>t("span",{class:"v-line"},null,-1)),bt=["onClick"],yt={key:0,class:"content-box"},gt={key:1,class:"content-box"},kt=["innerHTML"],wt={class:"fragment-img"},$t=["src"],xt={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription"],setup(e,{expose:c,emit:n}){const f=n,u=e,m=r=>{f("openEditSubscription",r)},v=r=>{ne.confirm({title:"提示",icon:o(Le),content:"确认是否删除该分段?",onOk(){return new Promise((w,g)=>{Ae({id:r}).then(s=>{j.success("删除成功"),f("handleDelParagraph",r),w()}).catch(()=>{w()})})},onCancel(){}})},S=r=>{f("handleScrollTargetPage",r)};return c({handleOpenEditModal:m}),(r,w)=>{const g=fe("viewer");return l(),p("div",ut,[t("div",_t,[I(" 分段预览 "),t("span",null,"共"+O(u.total)+"个分段",1)]),(l(!0),p(B,null,Y(u.paragraphLists,s=>(l(),p("div",{onClick:$=>S(s.page_num),class:"list-item",key:s.id},[t("div",pt,[t("div",ft,[I(" id："+O(s.id)+" "+O(s.title)+" ",1),t("span",null,"共"+O(s.word_total)+"个字符",1),t("span",null,"状态："+O(s.status_text),1)]),t("div",mt,[t("a",{onClick:ue($=>m(s),["stop"])},"编辑",8,vt),ht,t("a",{onClick:ue($=>v(s.id),["stop"])},"删除",8,bt)])]),s.question?(l(),p("div",yt,"Q："+O(s.question),1)):F("",!0),s.answer?(l(),p("div",gt,"A："+O(s.answer),1)):F("",!0),t("div",{class:"content-box",innerHTML:s.content},null,8,kt),me((l(),p("div",wt,[(l(!0),p(B,null,Y(s.images,($,q)=>(l(),p("img",{key:q,src:$,alt:""},null,8,$t))),128))])),[[g]])],8,dt))),128))])}}},de=K(xt,[["__scopeId","data-v-cdb41e8b"]]);var d={},ae;Object.defineProperty(d,"__esModule",{value:!0});d.controlDefaultValue=d.capitalize=d.camelize=d.cacheStringFunction=void 0;d.getDataAndAriaProps=Dt;d.isSymbol=d.isString=d.isOn=d.isObject=d.isFunction=ae=d.isArray=d.hyphenate=void 0;d.renderHelper=Mt;d.resolvePropValue=At;d.toPx=Ft;d.wrapPromiseFn=Tt;const ye=e=>typeof e=="function";d.isFunction=ye;d.controlDefaultValue=Symbol("controlDefaultValue");ae=d.isArray=Array.isArray;const St=e=>typeof e=="string";d.isString=St;const qt=e=>typeof e=="symbol";d.isSymbol=qt;const Ot=e=>e!==null&&typeof e=="object";d.isObject=Ot;const It=/^on[^a-z]/,Et=e=>It.test(e);d.isOn=Et;const ee=e=>{const c=Object.create(null);return n=>c[n]||(c[n]=e(n))};d.cacheStringFunction=ee;const Pt=/-(\w)/g;d.camelize=ee(e=>e.replace(Pt,(c,n)=>n?n.toUpperCase():""));const Lt=/\B([A-Z])/g;d.hyphenate=ee(e=>e.replace(Lt,"-$1").toLowerCase());d.capitalize=ee(e=>e.charAt(0).toUpperCase()+e.slice(1));const Ct=Object.prototype.hasOwnProperty,pe=(e,c)=>Ct.call(e,c);function At(e,c,n,f){const u=e[n];if(u!=null){const m=pe(u,"default");if(m&&f===void 0){const v=u.default;f=u.type!==Function&&ye(v)?v():v}u.type===Boolean&&(!pe(c,n)&&!m?f=!1:f===""&&(f=!0))}return f}function Dt(e){return Object.keys(e).reduce((c,n)=>((n.startsWith("data-")||n.startsWith("aria-"))&&(c[n]=e[n]),c),{})}function Ft(e){return typeof e=="number"?`${e}px`:e}function Mt(e){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return typeof e=="function"?e(c):e??n}function Tt(e){let c;const n=new Promise(u=>{c=e(()=>{u(!0)})}),f=()=>{c==null||c()};return f.then=(u,m)=>n.then(u,m),f.promise=n,f}const J=e=>(Z("data-v-bc21f471"),e=e(),G(),e),Bt={class:"form-box-wrapper"},jt={class:"form-item"},Rt=J(()=>t("div",{class:"form-label"},"分段标题：",-1)),Ut={class:"form-content"},Vt={class:"form-item"},zt=J(()=>t("div",{class:"form-label required"},"分段问题：",-1)),Ht={class:"form-content"},Qt={class:"form-item"},Nt=J(()=>t("div",{class:"form-label required"},"分段答案：",-1)),Kt={class:"form-content"},Jt={key:1,class:"form-item"},Wt=J(()=>t("div",{class:"form-label required"},"分段内容：",-1)),Xt={class:"form-content"},Yt={class:"form-item"},Zt=J(()=>t("div",{class:"form-label"},"附件",-1)),Gt={class:"form-content"},eo={class:"upload-box-wrapper"},to={key:0},oo={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(e,{expose:c,emit:n}){const f=ve(),u=e,m=n,v=y("1"),S=y(!1),r=y(""),w=y(""),g=y(""),s=y(""),$=y([]),q=y(""),L=y(!1),P=_=>{r.value=_.title||"",w.value=_.content||"",q.value=_.id||"",g.value=_.answer||"",$.value=_.images||[],s.value=_.question||"",L.value=u.detailsInfo.is_qa_doc=="1",S.value=!0},A=()=>{if(!w.value&&!L.value)return j.error("请输入分段内容");if(!s.value&&L.value)return j.error("请输入分段问题");if(!g.value&&L.value)return j.error("请输入分段答案");let _={title:r.value,content:w.value,question:s.value,answer:g.value,images:$.value};q.value?_.id=q.value:_.file_id=f.query.id;let h=new FormData;for(let C in _)ae(_[C])?_[C].forEach(D=>{h.append(C,D)}):h.append(C,_[C]);De(h).then(C=>{j.success(_.id?"修改成功":"添加成功"),S.value=!1,m("handleEdit",{..._})})};return c({showModal:P}),(_,h)=>{const C=je,D=Ve,R=Ce,U=Re,te=Ue,W=ne;return l(),p("div",null,[o(W,{open:S.value,"onUpdate:open":h[6]||(h[6]=x=>S.value=x),title:"编辑分段",onOk:A,width:"746px"},{default:a(()=>[t("div",Bt,[t("div",jt,[Rt,t("div",Ut,[o(C,{value:r.value,"onUpdate:value":h[0]||(h[0]=x=>r.value=x),placeholder:"请输入分段标题"},null,8,["value"])])]),L.value?(l(),p(B,{key:0},[t("div",Vt,[zt,t("div",Ht,[o(D,{placeholder:"请输入分段问题",value:s.value,"onUpdate:value":h[1]||(h[1]=x=>s.value=x),style:{height:"100px"}},null,8,["value"])])]),t("div",Qt,[Nt,t("div",Kt,[o(D,{placeholder:"请输入分段答案",value:g.value,"onUpdate:value":h[2]||(h[2]=x=>g.value=x),style:{height:"150px"}},null,8,["value"])])])],64)):(l(),p("div",Jt,[Wt,t("div",Xt,[o(D,{style:{height:"150px"},value:w.value,"onUpdate:value":h[3]||(h[3]=x=>w.value=x),placeholder:"请输入分段内容"},null,8,["value"])])])),t("div",Yt,[Zt,t("div",Gt,[t("div",eo,[o(te,{activeKey:v.value,"onUpdate:activeKey":h[4]||(h[4]=x=>v.value=x),size:"small"},{default:a(()=>[o(U,{key:"1"},{tab:a(()=>[t("span",null,[o(R,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),I(" 图片 "),$.value.length?(l(),p("span",to,"("+O($.value.length)+")",1)):F("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(Be,{value:$.value,"onUpdate:value":h[5]||(h[5]=x=>$.value=x)},null,8,["value"])])])])])]),_:1},8,["open"])])}}},no=K(oo,[["__scopeId","data-v-bc21f471"]]),so={class:"mode-box"},ao=["innerHTML"],lo={class:"tag-item"},io={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(e){const c=e,n=y(""),f=N(()=>{const{is_table_file:u,is_qa_doc:m,is_diy_split:v,question_lable:S,answer_lable:r,separators:w,chunk_size:g,chunk_overlap:s,question_column:$,answer_column:q,qa_index_type:L,doc_type:P}=c.detailsInfo;if(u!=1&&m!=1&&v!=1)return P==3?(n.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(n.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(u!=1&&m==1)return P==3?(n.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(n.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${S}"
答案开始标识符："${r}"`,"智能分段：QA文档");if(u!=1&&m!=1&&v==1)return n.value=`分段模式：自定义分段
文档标识符：${w}
分段最大长度：${g}字符
文段重叠长度：${s}字符`,"自定义分段";if(u==1&&m!=1)return n.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(u==1&&m==1){let A=L==1?"问题与答案一起生成索引":"仅对问题生成索引";return n.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${$}"
答案所在列："${q}"
索引方式：${A}`,"智能分段：QA文档"}});return(u,m)=>{const v=ze;return l(),p("div",so,[o(v,null,{title:a(()=>[t("div",{class:"tooltip-text-box",innerHTML:n.value},null,8,ao)]),default:a(()=>[t("div",lo,O(f.value),1)]),_:1})])}}},ro=K(io,[["__scopeId","data-v-6ee0b31f"]]),co={__name:"update-frequency",emits:["ok"],setup(e,{expose:c,emit:n}){const f=n,u=y(!1),m=y(!1),v=Oe({doc_auto_renew_frequency:1,id:""}),S=w=>{let{doc_auto_renew_frequency:g,id:s}=w;v.doc_auto_renew_frequency=+g,v.id=s,u.value=!0},r=()=>{m.value=!0,Fe({...v}).then(w=>{f("ok",v.doc_auto_renew_frequency),u.value=!1,j.success("设置成功")}).finally(()=>{m.value=!1})};return c({open:S}),(w,g)=>{const s=Ne,$=Ke,q=He,L=Qe,P=ne;return l(),p("div",null,[o(P,{open:u.value,"onUpdate:open":g[1]||(g[1]=A=>u.value=A),"confirm-loading":m.value,maskClosable:!1,title:"设置更新频率",onOk:r},{default:a(()=>[o(L,{style:{margin:"32px 0"},layout:"vertical",model:v},{default:a(()=>[o(q,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:a(()=>[o($,{value:v.doc_auto_renew_frequency,"onUpdate:value":g[0]||(g[0]=A=>v.doc_auto_renew_frequency=A),style:{width:"100%"}},{default:a(()=>[o(s,{value:1},{default:a(()=>[I("不自动更新")]),_:1}),o(s,{value:2},{default:a(()=>[I("每天")]),_:1}),o(s,{value:3},{default:a(()=>[I("每3天")]),_:1}),o(s,{value:4},{default:a(()=>[I("每7天")]),_:1}),o(s,{value:5},{default:a(()=>[I("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},uo=e=>(Z("data-v-2ec0df89"),e=e(),G(),e),_o={class:"library-preview-page"},po={class:"breadcrumb-block"},fo={class:"document-title-block"},mo={class:"title"},vo=uo(()=>t("span",null,"添加分段",-1)),ho={key:0,class:"page-loading-box"},bo={class:"content-block"},yo={key:1,class:"pdf-view-box"},go={class:"view-content-wrap"},ko={class:"view-content-box"},wo=["onClick"],$o={key:0,class:"content-box"},xo={key:1,class:"content-box"},So=["innerHTML"],qo={class:"fragment-img"},Oo=["src"],Io={class:"right-contnt-box"},Eo={class:"content-block"},Po={__name:"library-preview",setup(e){const c=y({fade:!1,scrollbarTrackClickable:!0,interactive:!0}),n=ve(),f=Ie(),u=N(()=>r.value.is_table_file=="1"),m=N(()=>r.value.doc_type),v=N(()=>{let i=r.value.status;return!(i=="1"||i=="2")||_.value.length==0}),S=N(()=>r.value.status),r=y({}),w=()=>{f.back()},g=y(null);let s=-1;const $=i=>{let b=document.querySelectorAll(".subsection-box .list-item")[i];b.classList.add("flash-border"),s>=0&&document.querySelectorAll(".subsection-box .list-item")[s].classList.remove("flash-border"),setTimeout(()=>{s=-1,b.classList.remove("flash-border")},2500),s=i,g.value.scrollToElement({el:b,time:1e3})},q=y(!0);(async()=>{Me({id:n.query.id}).then(i=>{r.value=i.data;let b=i.data.status;b==1||b==2?R():q.value=!1})})();const P=y({page:1,size:10}),A=y({}),_=y([]),h=y(0),C={0:"未转换",1:"已转换",2:"转换异常"};let D=!0;const R=()=>{D=!0,Te({file_id:n.query.id,...P.value}).then(i=>{var X,z;q.value=!1,D=!1;let b=i.data,E=b.list||[],k=((X=b.info)==null?void 0:X.is_qa_doc)=="1"&&((z=b.info)==null?void 0:z.is_table_file)=="1";E.forEach(H=>{H.status_text=C[H.status],H.isExcelQa=k}),A.value=b.info,P.value.page==1&&(_.value=[]),_.value=[..._.value,...E],h.value=b.total})},U=()=>{D||_.value.length>=h.value||(P.value.page++,R())},te=i=>{if(!i.id){P.value.page=1,R();return}let b=_.value,E=b.findIndex(k=>k.id==i.id);if(E>-1){let k=b[E];k.title=i.title,k.content=i.content,k.question=i.question,k.answer=i.answer,k.answer=i.answer,k.images=i.images,k.word_total=i.question.length+i.answer.length+i.content.length,b.splice(E,1,k),_.value=b}},W=i=>{let b=_.value,E=b.findIndex(k=>k.id==i);E>-1&&(b.splice(E,1),_.value=b,h.value=h.value--)};y(!0);const x=y(null),V=i=>{x.value.showModal(JSON.parse(JSON.stringify(i)))},le=y(null),ge=i=>{i.key==1&&f.push("/library/document-segmentation?document_id="+n.query.id+"&source=preview"),i.key==2&&le.value.open({id:n.query.id,doc_auto_renew_frequency:r.value.doc_auto_renew_frequency})},ke=i=>{r.value.doc_auto_renew_frequency=i};return(i,b)=>{const E=Ee("router-link"),k=We,X=Je,z=Ge,H=et,ie=he,we=tt,$e=Xe,xe=ot,Se=fe("viewer");return l(),p("div",_o,[t("div",po,[o(X,null,{default:a(()=>[o(k,null,{default:a(()=>[o(E,{to:"/library/list"},{default:a(()=>[I(" 知识库管理 ")]),_:1})]),_:1}),o(k,null,{default:a(()=>[o(E,{to:{path:"/library/details/knowledge-document",query:{id:r.value.library_id}}},{default:a(()=>[I(O(r.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),o(k,null,{default:a(()=>[I("知识库详情")]),_:1})]),_:1})]),t("div",fo,[o(Q(nt),{onClick:w}),t("span",mo,O(r.value.file_name),1),o(ro,{detailsInfo:r.value},null,8,["detailsInfo"]),o($e,{style:{"margin-left":"auto"}},{default:a(()=>[(S.value==2||m.value==2)&&m.value!=3?(l(),T(we,{key:0},{overlay:a(()=>[o(H,{onClick:ge},{default:a(()=>[S.value==2?(l(),T(z,{key:"1"},{default:a(()=>[I("重新分段")]),_:1})):F("",!0),m.value==2?(l(),T(z,{key:"2"},{default:a(()=>[I("设置更新频率")]),_:1})):F("",!0)]),_:1})]),default:a(()=>[o(ie,null,{icon:a(()=>[o(Q(Ye))]),default:a(()=>[o(Q(Ze))]),_:1})]),_:1})):F("",!0),o(ie,{onClick:b[0]||(b[0]=M=>V({})),type:"primary"},{icon:a(()=>[o(Q(be))]),default:a(()=>[vo]),_:1})]),_:1})]),q.value?(l(),p("div",ho,[o(xe)])):(l(),p(B,{key:1},[u.value||m.value==3?(l(),p(B,{key:0},[v.value?(l(),T(_e,{key:0,onOpenEditSubscription:V})):(l(),T(oe,{key:1,scrollbar:{minSize:0},onOnScrollEnd:U},{default:a(()=>[t("div",bo,[o(de,{ref:"subsectionBoxRef",total:h.value,paragraphLists:_.value,detailsInfo:r.value,onOpenEditSubscription:V,onHandleDelParagraph:W},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(l(),p("div",yo,[t("div",go,[o(oe,{scrollbar:c.value,class:"scroll-box",onOnScrollEnd:U},{default:a(()=>[t("div",ko,[(l(!0),p(B,null,Y(_.value,(M,re)=>(l(),p("div",{class:"list-item",onClick:ce=>$(re),key:re},[M.question?(l(),p("div",$o,O(M.question),1)):F("",!0),M.answer?(l(),p("div",xo,O(M.answer),1)):F("",!0),t("div",{class:"content-box",innerHTML:M.content},null,8,So),me((l(),p("div",qo,[(l(!0),p(B,null,Y(M.images,(ce,qe)=>(l(),p("img",{key:qe,src:ce,alt:""},null,8,Oo))),128))])),[[Se]])],8,wo))),128))])]),_:1},8,["scrollbar"])]),t("div",Io,[v.value?(l(),T(_e,{key:0,onOpenEditSubscription:V})):(l(),T(oe,{key:1,scrollbar:c.value,ref_key:"rightScrollRef",ref:g,onOnScrollEnd:U},{default:a(()=>[t("div",Eo,[o(de,{ref:"subsectionBoxRef",total:h.value,detailsInfo:r.value,paragraphLists:_.value,onOpenEditSubscription:V,onHandleDelParagraph:W},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64)),o(no,{detailsInfo:r.value,onHandleEdit:te,ref_key:"editSubscriptionRef",ref:x},null,8,["detailsInfo"]),o(co,{onOk:ke,ref_key:"updateFrequencyRef",ref:le},null,512)])}}},Sn=K(Po,[["__scopeId","data-v-2ec0df89"]]);export{Sn as default};
