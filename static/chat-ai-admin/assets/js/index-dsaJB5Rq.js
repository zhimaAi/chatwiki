import{Y as p,_ as l,a5 as e,k as t,ae as R,G as C,a7 as U,a3 as ve,a1 as M,a2 as i,a6 as dt,ad as we,f as S,c as W,r as F,e as oe,n as ce,A as ue,u as g,J as Z,ab as Je,F as T,a9 as H,w as _e,l as Qe,o as ke,j as _t,h as qe,ak as me,al as ye,a4 as Ge,b as ct,B as ut,y as Ke,ai as pt,ag as mt,p as vt}from"./vue-chunks-Ci-XTWEs.js";import{b as J,d as pe,af as ft,a1 as bt,a4 as ht,ag as yt,ah as kt,e as gt,F as xt,ai as Ue,h as $t,ae as wt}from"../../index-BZRrEp3V.js";import{B as le,E as ge,I as xe,Q as $e,aj as Be,$ as qt,ao as St,ah as He,M as te,a as Y,F as Oe,e as We,u as je,v as Me,Z as Ze,Y as Ye,az as Ct,p as se,aA as Lt,X as ne,ap as fe,z as Re,g as Xe,ar as It,ae as Ut,af as Rt,q as Ve,R as ze,ab as ee,aB as et,O as Se,aC as Et,k as Ot,ay as At,ad as jt,ag as Mt,a9 as tt,x as Vt,H as Ae,V as zt,U as Te,a8 as Dt,h as Ee,aa as Nt,y as Pt,ak as Bt}from"./ui-antd-BWf8LxGy.js";import{C as Tt}from"./cu-upload-CQ6vMq3L.js";import{u as ot}from"./robot-ChheCicf.js";import{j as Ft,k as Jt,g as Qt,l as Gt}from"./index-BOvAmdHY.js";import{_ as Kt}from"./index-D-GrJqwf.js";import{h as st}from"./index-UUVUVnDU.js";import{C as Ht}from"./index-C70Vlv3T.js";import{L as Wt}from"./library-select-alert-BVVRhpkh.js";import{_ as Zt}from"./recommendation-AQ4_FPQ9.js";import{_ as nt}from"./cu-scroll-BD8CyTy-.js";import{g as lt}from"./index-zZra8f7T.js";import{_ as Yt}from"./empty-CzGZrENG.js";import{d as De}from"./vuedraggable.umd-DJBjom-v.js";import{M as Xt}from"./model-select-S5ievtWN.js";import{_ as eo}from"./empty-BFmzY9bl.js";import{i as to,e as oo,f as so}from"./index-rzC8Sks4.js";import{A as no}from"./add-collaborator-CJqlRWtE.js";import{R as lo}from"./robot-select-alert-B6wZ61Qq.js";import"./utils-ChQO-_r6.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const io={class:"edit-box-header"},ao={class:"left-box"},ro={class:"edit-box-title"},_o={key:0},co={key:0,class:"title-tip"},uo={class:"right-box"},po={class:"extra-box"},mo={class:"actions-box"},vo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(D,{emit:m}){const x=m,_=D,r=n=>{x("edit"),x("update:isEdit",n)},s=()=>{x("save")};return(n,f)=>{const b=pe,a=le,$=ge;return l(),p("div",{class:we(["edit-box",{"is-edit":D.isEdit}])},[e("div",io,[e("div",ao,[t(b,{class:"edit-box-icon",name:_.iconName},null,8,["name"]),e("span",ro,[C(U(_.title)+" ",1),n.$slots.icon?(l(),p("span",_o,[ve(n.$slots,"icon",{},void 0,!0)])):R("",!0)]),n.$slots.tip?(l(),p("span",co,[ve(n.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",uo,[e("div",po,[ve(n.$slots,"extra",{},()=>[e("div",mo,[_.isEdit?(l(),M($,{key:0,gap:8},{default:i(()=>[t(a,{onClick:s,size:"small",type:"primary"},{default:i(()=>f[2]||(f[2]=[C("保存")])),_:1,__:[2]}),t(a,{onClick:f[0]||(f[0]=d=>r(!1)),size:"small"},{default:i(()=>f[3]||(f[3]=[C("取消")])),_:1,__:[3]})]),_:1})):(l(),M(a,{key:1,onClick:f[1]||(f[1]=d=>r(!0)),size:"small"},{default:i(()=>f[4]||(f[4]=[C("修改")])),_:1,__:[4]}))])],!0)])])]),e("div",{class:"edit-box-body",style:dt({...D.bodyStyle})},[ve(n.$slots,"default",{},void 0,!0)],4)],2)}}},X=J(vo,[["__scopeId","data-v-dbe09743"]]),fo={class:"robot-form-box"},bo={class:"form-item"},ho={class:"form-item-body robot-name-item"},yo={class:"robot-avetar-upload"},ko=["src"],go={class:"robot-name-box"},xo={class:"form-item"},$o={class:"form-item-body"},wo={class:"robot-info-box"},qo={class:"robot-name-box"},So=["src"],Co={class:"robot-name"},Lo={class:"robot-intro"},Io={__name:"basic-config",setup(D){const m=ot(),x=S(!1),{robotInfo:_,updateRobotInfo:r}=W("robotInfo"),s=F({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=oe(()=>m.robotList||[]),f=oe(()=>m.robotGroupList||[]),b=oe(()=>{let c="未分组",o=n.value.find(u=>u.id==_.id)||{};if(o.group_id>0){let u=f.value.find(y=>y.id==o.group_id);u&&(c=u.group_name)}return c}),a=()=>{r({...Z(s)}),x.value=!1},$=c=>{let o=c[0];return s.robot_avatar=o,ft(o).then(u=>{s.robot_avatar_url=u}),!1},d=()=>{s.robot_name=_.robot_name,s.robot_intro=_.robot_intro,s.robot_avatar=_.robot_avatar,s.robot_avatar_url=_.robot_avatar_url};return(c,o)=>{const u=xe,y=$e;return l(),M(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:x.value,"onUpdate:isEdit":o[2]||(o[2]=L=>x.value=L),onSave:a,onEdit:d},{default:i(()=>[ce(e("div",fo,[e("div",bo,[o[3]||(o[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",ho,[t(Tt,{accept:"image/*",onChange:$},{default:i(()=>[e("div",yo,[s.robot_avatar_url?(l(),p("img",{key:0,class:"robot-avetar",src:s.robot_avatar_url},null,8,ko)):R("",!0)])]),_:1}),e("div",go,[t(u,{value:s.robot_name,"onUpdate:value":o[0]||(o[0]=L=>s.robot_name=L),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",xo,[o[4]||(o[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",$o,[t(y,{rows:3,value:s.robot_intro,"onUpdate:value":o[1]||(o[1]=L=>s.robot_intro=L),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ue,x.value]]),ce(e("div",wo,[e("div",qo,[e("img",{class:"robot-avatar",src:g(_).robot_avatar_url,alt:""},null,8,So),e("span",Co,U(g(_).robot_name),1)]),e("div",Lo,[e("span",null,"分组："+U(b.value),1),e("span",null,"简介："+U(g(_).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[ue,!x.value]])]),_:1},8,["isEdit"])}}},Uo=J(Io,[["__scopeId","data-v-7fc4a51d"]]),Ro={class:"ai-create-box"},Eo={class:"input-box"},Oo={key:1},Ao={key:2},jo={class:"quick-tags-box"},Mo={class:"ai-list-box"},Vo={key:0,class:"loading-box"},zo={key:0,class:"prompt-list-box"},Do={class:"prompt-list"},No={class:"prompt-header"},Po={class:"prompt-title"},Bo={class:"prompt-content"},To={class:"prompt-list"},Fo={class:"prompt-header"},Jo={class:"prompt-title"},Qo={class:"prompt-content"},Go={class:"prompt-list"},Ko={class:"prompt-header"},Ho={class:"prompt-title"},Wo={class:"prompt-content"},Zo={class:"prompt-list"},Yo={class:"prompt-header"},Xo={class:"prompt-title"},es={class:"prompt-content"},ts={class:"prompt-list"},os={class:"prompt-header"},ss={class:"prompt-title"},ns={class:"prompt-content"},ls={class:"prompt-header"},is={class:"prompt-title"},as={class:"prompt-content"},rs={key:1,class:"empty-box"},ds={__name:"ai-create-prompt",emits:["handleAiSave"],setup(D,{expose:m,emit:x}){const _=Be.PRESENTED_IMAGE_SIMPLE,r=S(!1),s=S(!1),n=Je().query,f=x,b=S(""),a=S(!1),$=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],d=S("在上方输入框输入要求，点击生成提示词"),c=()=>{o.value=!1,y.promptStruct=u,b.value="",d.value="在上方输入框输入要求，点击生成提示词",r.value=!0},o=S(!1),u={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},y=F({promptStruct:u}),L=A=>{b.value=A},h=()=>{if(!b.value)return Y.error("请输入AI 生成提示词");if(a.value)return Y.error("正在生成中...");a.value=!0,Ft({id:n.id,demand:b.value}).then(A=>{y.promptStruct=JSON.parse(A.data.promptStruct),o.value=!0}).finally(()=>{a.value=!1}).catch(A=>{o.value=!1,d.value=A.msg})},I=()=>{if(!o.value)return Y.error("请先生成提示词");f("handleAiSave",y.promptStruct),r.value=!1};return m({show:c}),(A,v)=>{const q=le,N=$e,V=pe,w=St,K=He,O=Be,z=te;return l(),p("div",null,[t(z,{open:r.value,"onUpdate:open":v[1]||(v[1]=E=>r.value=E),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:i(()=>[t(q,{type:"primary",loading:s.value,onClick:I},{default:i(()=>v[2]||(v[2]=[C("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:i(()=>[e("div",Ro,[e("div",Eo,[t(N,{style:{width:"100%"},value:b.value,"onUpdate:value":v[0]||(v[0]=E=>b.value=E),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:we(["btn-box",{"disabed-status":a.value}]),onClick:h},[a.value?(l(),M(g(qt),{key:0})):R("",!0),t(V,{name:"ai-mark"}),a.value?(l(),p("span",Oo,"生成中...")):(l(),p("span",Ao,"生成"))],2)]),e("div",jo,[v[3]||(v[3]=e("div",{class:"quick-label"},"快捷生成：",-1)),(l(),p(T,null,H($,E=>t(w,{key:E.title,onClick:Q=>L(E.title),color:"blue"},{default:i(()=>[C(U(E.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Mo,[a.value?(l(),p("div",Vo,[t(K,{tip:"正在生成中..."})])):(l(),p(T,{key:1},[o.value?(l(),p("div",zo,[e("div",Do,[e("div",No,[e("div",Po,U(y.promptStruct.role.subject),1)]),e("div",Bo,U(y.promptStruct.role.describe),1)]),e("div",To,[e("div",Fo,[e("div",Jo,U(y.promptStruct.task.subject),1)]),e("div",Qo,U(y.promptStruct.task.describe),1)]),e("div",Go,[e("div",Ko,[e("div",Ho,U(y.promptStruct.constraints.subject),1)]),e("div",Wo,U(y.promptStruct.constraints.describe),1)]),e("div",Zo,[e("div",Yo,[e("div",Xo,U(y.promptStruct.output.subject),1)]),e("div",es,U(y.promptStruct.output.describe),1)]),e("div",ts,[e("div",os,[e("div",ss,U(y.promptStruct.tone.subject),1)]),e("div",ns,U(y.promptStruct.tone.describe),1)]),(l(!0),p(T,null,H(y.promptStruct.custom,(E,Q)=>(l(),p("div",{class:"prompt-list",key:Q+E.key?E.key:""},[e("div",ls,[e("div",is,U(E.subject),1)]),e("div",as,U(E.describe),1)]))),128))])):(l(),p("div",rs,[t(O,{image:g(_),description:d.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},_s=J(ds,[["__scopeId","data-v-abe0e674"]]),cs={__name:"upload-prompt",setup(D,{expose:m}){const x=S(!1),_=F({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),r=S(null),s=$=>{if($.prompt_type==0&&!$.prompt)return Y.error("自定义提示为空,无法上传");r.value&&r.value.resetFields();let d={...$};_.title="",_.group_id=0,_.prompt="",_.prompt_struct={},_.prompt_type=d.prompt_type,d.prompt_type==0?_.prompt=d.prompt:_.prompt_struct=JSON.stringify(d.prompt_struct),x.value=!0},n=S([]);(()=>{bt().then($=>{n.value=[{id:0,group_name:"默认分组"},...$.data]})})();const b=S(!1),a=()=>{r.value.validate().then(()=>{let $={..._};b.value=!0,ht({...$}).then(()=>{Y.success("保存成功"),x.value=!1}).finally(()=>{b.value=!1})})};return m({show:s}),($,d)=>{const c=xe,o=We,u=Me,y=je,L=Oe,h=te;return l(),p("div",null,[t(h,{open:x.value,"onUpdate:open":d[2]||(d[2]=I=>x.value=I),title:"保存到提示词库",width:580,onOk:a,confirmLoading:b.value},{default:i(()=>[t(L,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:r,model:_},{default:i(()=>[t(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:i(()=>[t(c,{value:_.title,"onUpdate:value":d[0]||(d[0]=I=>_.title=I),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(o,{name:"group_id",label:"分组"},{default:i(()=>[t(y,{value:_.group_id,"onUpdate:value":d[1]||(d[1]=I=>_.group_id=I),style:{width:"100%"}},{default:i(()=>[(l(!0),p(T,null,H(n.value,I=>(l(),M(u,{value:I.id},{default:i(()=>[C(U(I.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},us={class:"prompt-box"},ps={class:"tab-header"},ms={key:0,class:"opt-block"},vs={key:1,class:"opt-block"},fs={class:"tip-text"},bs={key:0,class:"prompt-list-box"},hs={class:"prompt-list"},ys={class:"prompt-header"},ks={class:"prompt-title"},gs={key:0,class:"btn-wrapper-box"},xs={class:"prompt-content"},$s={class:"prompt-list"},ws={class:"prompt-header"},qs={class:"prompt-title"},Ss={key:0,class:"btn-wrapper-box"},Cs={class:"prompt-content"},Ls={class:"prompt-list"},Is={class:"prompt-header"},Us={class:"prompt-title"},Rs={key:0,class:"btn-wrapper-box"},Es={class:"prompt-content"},Os={class:"prompt-list"},As={class:"prompt-header"},js={class:"prompt-title"},Ms={key:0,class:"btn-wrapper-box"},Vs={class:"prompt-content"},zs={class:"prompt-list"},Ds={class:"prompt-header"},Ns={class:"prompt-title"},Ps={key:0,class:"btn-wrapper-box"},Bs={class:"swich-item"},Ts={class:"swich-item"},Fs={class:"prompt-content"},Js={class:"prompt-list"},Qs={class:"prompt-header"},Gs={class:"prompt-title"},Ks={key:0,class:"btn-wrapper-box"},Hs={class:"prompt-content"},Ws={class:"prompt-header"},Zs={class:"prompt-title",style:{flex:"1"}},Ys={key:0,class:"btn-wrapper-box"},Xs=["onClick"],en={class:"prompt-content"},tn={key:0,class:"add-theme-block"},on={class:"show-more-block"},sn={key:1,class:"diy-prompt-box"},nn={key:0,class:"diy-switch-box"},ln={class:"swich-item"},an={class:"swich-item"},re="- 请使用markdown格式回答问题。",de="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",rn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(D){const m=S(!1),{robotInfo:x,updateRobotInfo:_}=W("robotInfo"),r=D;let s={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const n=S({}),f=S(!1),b=S(!1),a=S(!1),$=S(!1),d=F({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),c=S(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{c.value=!c.value,localStorage.setItem("system_prompt_words_ishide",c.value?1:0)},u=(B,k)=>B.includes(k),y=S(x.prompt_type);_e(()=>x,()=>{d.prompt=x.prompt,d.prompt_struct=x.prompt_struct,n.value=x.prompt_struct_default},{immediate:!0,deep:!0}),_e(()=>d.prompt_struct.output.describe,B=>{f.value=u(B,re),b.value=u(B,de)},{immediate:!0,deep:!0}),_e(()=>d.prompt,B=>{a.value=u(B,re),$.value=u(B,de)},{immediate:!0,deep:!0});const L=(B,k)=>{B?(k=="outSwitch"&&(d.prompt_struct.output.describe?d.prompt_struct.output.describe+=`
`+re:d.prompt_struct.output.describe+=re),k=="imgSwitch"&&(d.prompt_struct.output.describe?d.prompt_struct.output.describe+=`
`+de:d.prompt_struct.output.describe+=de)):(k=="outSwitch"&&(d.prompt_struct.output.describe=d.prompt_struct.output.describe.replace(new RegExp(re,"g"),"")),k=="imgSwitch"&&(d.prompt_struct.output.describe=d.prompt_struct.output.describe.replace(new RegExp(de,"g"),"")),d.prompt_struct.output.describe=d.prompt_struct.output.describe.trim())},h=(B,k)=>{B?(k=="outDiySwitch"&&(d.prompt?d.prompt+=`
`+re:d.prompt+=re),k=="imgDiySwitch"&&(d.prompt?d.prompt+=`
`+de:d.prompt+=de)):(k=="outDiySwitch"&&(d.prompt=d.prompt.replace(new RegExp(re,"g"),"")),k=="imgDiySwitch"&&(d.prompt=d.prompt.replace(new RegExp(de,"g"),"")),d.prompt=d.prompt.trim())},I=B=>{d.prompt_struct[B].describe=n.value[B].describe},A=()=>{let B=x.work_flow_ids.split(","),k=r.robotList.filter(he=>B.includes(he.id)),P=[];P=k.map(he=>`- ${he.robot_name} ${he.robot_intro}`).join(`
`),d.prompt_struct.skill.describe=P},v=()=>{d.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),y.value=1},q=B=>{d.prompt_struct.custom.splice(B,1)},N=()=>{_({...Z(d),prompt_type:y.value}),m.value=!1},V=B=>{y.value=1,_({prompt_type:y.value,prompt:d.prompt,prompt_struct:B}),m.value=!1},w=()=>{m.value=!0},K=()=>{m.value=!1},O=S(null),z=()=>{O.value.show()},E=S(null),Q=()=>{E.value.show()},G=S(null),ie=()=>{G.value.show({...d,prompt_type:y.value})},be=B=>{B.prompt_type==1?(y.value=1,d.prompt_struct=B.prompt_struct):(y.value=0,d.prompt=B.prompt),N()};return(B,k)=>{const P=Ze,he=Ye,Ne=se,it=pe,Ce=le,at=ge,ae=$e,Le=ne,rt=xe;return l(),p("div",us,[e("div",ps,[t(he,{activeKey:y.value,"onUpdate:activeKey":k[0]||(k[0]=j=>y.value=j)},{default:i(()=>[(l(),M(P,{key:1,tab:"结构化提示词"})),(l(),M(P,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),m.value?(l(),p("div",ms,[t(Ne,null,{title:i(()=>k[22]||(k[22]=[C("将当前编辑的提示词保存到提示词库中")])),default:i(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:ie},[t(g(Ct)),k[23]||(k[23]=C("上传 "))])]),_:1}),t(Ne,null,{title:i(()=>k[24]||(k[24]=[C("从提示词库导入提示词")])),default:i(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Q},[t(g(Lt)),k[25]||(k[25]=C("导入 "))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:z},[t(it,{name:"ai-mark"}),k[26]||(k[26]=C(" AI自动生成 "))]),t(at,{gap:8},{default:i(()=>[t(Ce,{size:"small",type:"primary",onClick:N},{default:i(()=>k[27]||(k[27]=[C("保存")])),_:1,__:[27]}),t(Ce,{size:"small",onClick:K},{default:i(()=>k[28]||(k[28]=[C("取消")])),_:1,__:[28]})]),_:1})])):(l(),p("div",vs,[e("span",fs,"当前类型："+U(y.value==1?"结构化提示词":"自定义提示词"),1),t(Ce,{size:"small",onClick:w},{default:i(()=>k[29]||(k[29]=[C("修改")])),_:1,__:[29]})]))]),y.value==1?(l(),p("div",bs,[e("div",hs,[e("div",ys,[e("div",ks,U(d.prompt_struct.role.subject),1),m.value?(l(),p("div",gs,[e("a",{onClick:k[1]||(k[1]=j=>I("role"))},"恢复默认")])):R("",!0)]),e("div",xs,[t(ae,{bordered:!1,disabled:!m.value,value:d.prompt_struct.role.describe,"onUpdate:value":k[2]||(k[2]=j=>d.prompt_struct.role.describe=j),placeholder:g(s).role},null,8,["disabled","value","placeholder"])])]),e("div",$s,[e("div",ws,[e("div",qs,U(d.prompt_struct.task.subject),1),m.value?(l(),p("div",Ss,[e("a",{onClick:k[3]||(k[3]=j=>I("task"))},"恢复默认")])):R("",!0)]),e("div",Cs,[t(ae,{bordered:!1,disabled:!m.value,value:d.prompt_struct.task.describe,"onUpdate:value":k[4]||(k[4]=j=>d.prompt_struct.task.describe=j),placeholder:g(s).task},null,8,["disabled","value","placeholder"])])]),c.value?(l(),p(T,{key:0},[e("div",Ls,[e("div",Is,[e("div",Us,U(d.prompt_struct.constraints.subject),1),m.value?(l(),p("div",Rs,[e("a",{onClick:k[5]||(k[5]=j=>I("constraints"))},"恢复默认")])):R("",!0)]),e("div",Es,[t(ae,{bordered:!1,disabled:!m.value,value:d.prompt_struct.constraints.describe,"onUpdate:value":k[6]||(k[6]=j=>d.prompt_struct.constraints.describe=j),placeholder:g(s).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",Os,[e("div",As,[e("div",js,U(d.prompt_struct.skill.subject),1),m.value?(l(),p("div",Ms,[e("a",{onClick:k[7]||(k[7]=j=>A())},"自动导入技能")])):R("",!0)]),e("div",Vs,[t(ae,{bordered:!1,disabled:!m.value,value:d.prompt_struct.skill.describe,"onUpdate:value":k[8]||(k[8]=j=>d.prompt_struct.skill.describe=j),placeholder:g(s).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",zs,[e("div",Ds,[e("div",Ns,U(d.prompt_struct.output.subject),1),m.value?(l(),p("div",Ps,[e("div",Bs,[k[30]||(k[30]=C(" 输出markdown： ")),t(Le,{onChange:k[9]||(k[9]=j=>L(j,"outSwitch")),checked:f.value,"onUpdate:checked":k[10]||(k[10]=j=>f.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Ts,[k[31]||(k[31]=C(" 回复图片： ")),t(Le,{onChange:k[11]||(k[11]=j=>L(j,"imgSwitch")),checked:b.value,"onUpdate:checked":k[12]||(k[12]=j=>b.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:k[13]||(k[13]=j=>I("output"))},"恢复默认")])):R("",!0)]),e("div",Fs,[t(ae,{bordered:!1,disabled:!m.value,value:d.prompt_struct.output.describe,"onUpdate:value":k[14]||(k[14]=j=>d.prompt_struct.output.describe=j),placeholder:g(s).output},null,8,["disabled","value","placeholder"])])]),e("div",Js,[e("div",Qs,[e("div",Gs,U(d.prompt_struct.tone.subject),1),m.value?(l(),p("div",Ks,[e("a",{onClick:k[15]||(k[15]=j=>I("tone"))},"恢复默认")])):R("",!0)]),e("div",Hs,[t(ae,{bordered:!1,disabled:!m.value,value:d.prompt_struct.tone.describe,"onUpdate:value":k[16]||(k[16]=j=>d.prompt_struct.tone.describe=j),placeholder:g(s).tone},null,8,["disabled","value","placeholder"])])]),(l(!0),p(T,null,H(d.prompt_struct.custom,(j,Pe)=>(l(),p("div",{class:"prompt-list",key:Pe+j.key?j.key:""},[e("div",Ws,[e("div",Zs,[t(rt,{bordered:!1,disabled:!m.value,style:{width:"100%"},value:j.subject,"onUpdate:value":Ie=>j.subject=Ie,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),m.value?(l(),p("div",Ys,[e("div",{class:"hover-btn-box",onClick:Ie=>q(Pe)},[t(g(fe))],8,Xs)])):R("",!0)]),e("div",en,[t(ae,{bordered:!1,disabled:!m.value,value:j.describe,"onUpdate:value":Ie=>j.describe=Ie,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),m.value?(l(),p("div",tn,[t(Ce,{onClick:v,block:"",icon:Qe(g(Re))},{default:i(()=>k[32]||(k[32]=[C("添加主题")])),_:1,__:[32]},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",on,[e("div",{class:"btn-item",onClick:o},[c.value?(l(),p(T,{key:1},[k[34]||(k[34]=C("收起")),t(g(It))],64)):(l(),p(T,{key:0},[k[33]||(k[33]=C("展开")),t(g(Xe))],64))])])])):(l(),p("div",sn,[m.value?(l(),p("div",nn,[e("div",ln,[k[35]||(k[35]=C(" 输出markdown： ")),t(Le,{size:"small",onChange:k[17]||(k[17]=j=>h(j,"outDiySwitch")),checked:a.value,"onUpdate:checked":k[18]||(k[18]=j=>a.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",an,[k[36]||(k[36]=C(" 回复图片： ")),t(Le,{size:"small",onChange:k[19]||(k[19]=j=>h(j,"imgDiySwitch")),checked:$.value,"onUpdate:checked":k[20]||(k[20]=j=>$.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):R("",!0),t(ae,{bordered:m.value,value:d.prompt,"onUpdate:value":k[21]||(k[21]=j=>d.prompt=j),disabled:!m.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(_s,{onHandleAiSave:V,ref_key:"aiCreatePromptRef",ref:O},null,512),t(Kt,{onOk:be,ref_key:"importPromptRef",ref:E},null,512),t(cs,{ref_key:"uploadPromptRef",ref:G},null,512)])}}},dn=J(rn,[["__scopeId","data-v-c1235ef1"]]),_n={class:"actions-box"},cn={class:"setting-info-block"},un={class:"set-item w-100"},pn={key:0,class:"set-item-content"},mn=["src"],vn={key:1},fn={class:"set-item"},bn={class:"set-item"},hn={class:"set-item"},yn={class:"set-item"},kn={class:"form-box"},gn={class:"form-item"},xn={class:"form-item-body"},$n={class:"form-item",style:{display:"flex","align-items":"center"}},wn={class:"form-item"},qn={class:"form-item-label"},Sn={class:"form-item-body"},Cn={class:"number-box"},Ln={class:"number-slider-box"},In={class:"number-input-box"},Un={class:"form-item"},Rn={class:"form-item-label"},En={class:"form-item-body"},On={class:"number-box"},An={class:"number-slider-box"},jn={class:"number-input-box"},Mn={class:"form-item"},Vn={class:"form-item-label"},zn={class:"form-item-body"},Dn={class:"number-box"},Nn={class:"number-slider-box"},Pn={class:"number-input-box"},Bn={class:"form-item justify-between"},Tn={class:"form-item-label"},Fn={class:"form-item justify-between"},Jn={class:"form-item-label"},Qn={__name:"model-settings",setup(D){const m=["azure","ollama","xinference","openaiAgent","doubao"],x=["doubao"],_=["azure"],r=F({sm:24,md:24,lg:12,xl:24,xxl:24}),s=S([]),n=S(!1),{robotInfo:f,updateRobotInfo:b}=W("robotInfo"),a=F({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0}),$=S(""),d=S(""),c=S(""),o=V=>{a.use_model=m.includes(V.rawData.model_define)&&V.rawData.deployment_name?V.rawData.show_model_name||V.rawData.deployment_name:V.rawData.name,a.use_model_icon=V.icon,a.use_model_name=V.use_model_name,a.model_config_id=V.rawData.id,$.value=V.rawData.model_define,a.use_model&&a.use_model.toLowerCase().includes("deepseek-r1")?a.prompt_role_type="1":a.prompt_role_type="0"},u=S({}),y=(V,w)=>{u.value=w},L=oe(()=>{if(!a.model_config_id)return!1;let V=a.model_config_id+"#"+a.use_model;return u.value[V]}),h=S(!1),I=V=>{V.target.closest(".custom-select")||(h.value=!1)};ke(()=>{m.indexOf($.value)>-1?a.use_model=c.value:a.use_model=f.use_model,document.addEventListener("click",I)}),_t(()=>{document.removeEventListener("click",I)});const A=()=>{c.value=a.use_model;let V={...Z(a)};_.indexOf($.value)>-1&&(V.use_model="默认"),b(V),n.value=!1},v=V=>{m.indexOf($.value)>-1?a.use_model=c.value:a.use_model=f.use_model,a.model_config_id=f.model_config_id,a.temperature=f.temperature,a.max_token=f.max_token,a.context_pair=f.context_pair,a.think_switch=Number(f.think_switch),a.prompt_role_type=f.prompt_role_type,a.enable_thinking=f.enable_thinking,n.value=V};qe(()=>{a.model_config_id=f.model_config_id,a.temperature=f.temperature,a.max_token=f.max_token,a.context_pair=f.context_pair,a.think_switch=Number(f.think_switch),a.prompt_role_type=f.prompt_role_type,a.enable_thinking=f.enable_thinking});function q(V,w,K){const O=new Set(V.map(z=>z.model_define));return w.filter(z=>{let E=z[K];O.has(E)&&V.filter(Q=>{if(Q.model_define==E)return Q.children=kt(Q.children,z.children),!1})}),V}return(()=>{st({model_type:"LLM"}).then(V=>{c.value=f.use_model;let w=V.data||[],K=[];s.value=w.map(O=>{K=[];for(let z=0;z<O.model_info.llm_model_list.length;z++){const E=O.model_info.llm_model_list[z];m.indexOf(O.model_info.model_define)>-1&&f.model_config_id==O.model_config.id&&(c.value=O.model_config.show_model_name||O.model_config.deployment_name,$.value=O.model_info.model_define,d.value=O.model_info.model_define),K.push({name:E,deployment_name:O.model_config.deployment_name,show_model_name:x.includes(O.model_info.model_define)?O.model_config.show_model_name:"",id:O.model_config.id,model_define:O.model_info.model_define,icon:O.model_info.model_icon_url,use_model_name:O.model_info.model_name})}return{id:O.model_config.id,name:O.model_info.model_name,model_define:O.model_info.model_define,icon:O.model_info.model_icon_url,children:K,deployment_name:O.model_config.deployment_name}}),s.value=q(yt(s.value,"model_define"),s.value,"model_define"),f.use_model&&f.model_config_id&&s.value.some(O=>O.children.some(z=>{const E=m.includes(z.model_define)&&z.deployment_name?z.deployment_name:z.name;if(m.includes(z.model_define)&&z.deployment_name&&z.id===f.model_config_id)return a.use_model_icon=z.icon,a.use_model_name=z.use_model_name,a.use_model=z.show_model_name||z.deployment_name,!0;if(E===f.use_model&&z.id===f.model_config_id)return a.use_model_icon=z.icon,a.use_model_name=z.use_model_name,!0}))})})(),(V,w)=>{const K=le,O=Rt,z=ze,E=Ve,Q=se,G=et,ie=Se,be=ne,B=Ut,k=te;return l(),M(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:n.value,"onUpdate:isEdit":w[12]||(w[12]=P=>n.value=P)},{extra:i(()=>[e("div",_n,[t(K,{onClick:w[0]||(w[0]=P=>v(!0)),size:"small"},{default:i(()=>w[13]||(w[13]=[C("修改")])),_:1,__:[13]})])]),default:i(()=>[e("div",cn,[e("div",un,[w[14]||(w[14]=C(" LLM模型： ")),a.use_model_icon&&a.use_model_name?(l(),p("span",pn,[e("img",{src:a.use_model_icon,class:"model-icon"},null,8,mn),C(U(a.use_model_name)+" "+U(a.use_model),1)])):(l(),p("span",vn,U(a.use_model),1))]),e("div",fn,[w[15]||(w[15]=C(" 温度： ")),e("span",null,U(a.temperature),1)]),e("div",bn,[w[16]||(w[16]=C(" 最大token： ")),e("span",null,U(a.max_token),1)]),e("div",hn,[w[17]||(w[17]=C(" 上下文数量： ")),e("span",null,U(a.context_pair),1)]),e("div",yn,[w[18]||(w[18]=C(" 显示推理过程： ")),e("span",null,U(a.think_switch==1?"开":"关"),1)])]),t(k,{open:n.value,"onUpdate:open":w[11]||(w[11]=P=>n.value=P),width:672,title:"模型设置",onOk:A},{default:i(()=>[e("div",kn,[t(B,{gutter:[32,24]},{default:i(()=>[t(O,me(ye(r)),{default:i(()=>[e("div",gn,[w[19]||(w[19]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",xn,[t(Ht,{modelValue:a.use_model,"onUpdate:modelValue":w[1]||(w[1]=P=>a.use_model=P),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":a.model_config_id,onChange:o,onLoaded:y},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(O,me(ye(r)),{default:i(()=>[e("div",$n,[w[22]||(w[22]=e("div",{class:"form-item-label mb12"},[e("span",null,"提示词所属角色： ")],-1)),e("div",null,[t(E,{value:a.prompt_role_type,"onUpdate:value":w[2]||(w[2]=P=>a.prompt_role_type=P)},{default:i(()=>[t(z,{value:"0"},{default:i(()=>w[20]||(w[20]=[C("系统角色（System）")])),_:1,__:[20]}),t(z,{value:"1"},{default:i(()=>w[21]||(w[21]=[C("用户角色（User）")])),_:1,__:[21]})]),_:1},8,["value"])])])]),_:1},16),t(O,me(ye(r)),{default:i(()=>[e("div",wn,[e("div",qn,[w[24]||(w[24]=e("span",null,"温度 ",-1)),t(Q,null,{title:i(()=>w[23]||(w[23]=[C("温度越低，回答越严谨。温度越高，回答越发散。")])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),e("div",Sn,[e("div",Cn,[e("div",Ln,[t(G,{class:"custom-slider",value:a.temperature,"onUpdate:value":w[3]||(w[3]=P=>a.temperature=P),min:0,max:2,step:.1},null,8,["value"])]),e("div",In,[t(ie,{value:a.temperature,"onUpdate:value":w[4]||(w[4]=P=>a.temperature=P),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(O,me(ye(r)),{default:i(()=>[e("div",Un,[e("div",Rn,[w[26]||(w[26]=e("span",null,"最大token ",-1)),t(Q,null,{title:i(()=>w[25]||(w[25]=[C("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),e("div",En,[e("div",On,[e("div",An,[t(G,{class:"custom-slider",value:a.max_token,"onUpdate:value":w[5]||(w[5]=P=>a.max_token=P),min:0,max:100*1024},null,8,["value"])]),e("div",jn,[t(ie,{value:a.max_token,"onUpdate:value":w[6]||(w[6]=P=>a.max_token=P),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(O,me(ye(r)),{default:i(()=>[e("div",Mn,[e("div",Vn,[w[28]||(w[28]=e("span",null,"上下文数量 ",-1)),t(Q,null,{title:i(()=>w[27]||(w[27]=[C("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),e("div",zn,[e("div",Dn,[e("div",Nn,[t(G,{class:"custom-slider",value:a.context_pair,"onUpdate:value":w[7]||(w[7]=P=>a.context_pair=P),min:0,max:50},null,8,["value"])]),e("div",Pn,[t(ie,{value:a.context_pair,"onUpdate:value":w[8]||(w[8]=P=>a.context_pair=P),min:0,max:50},null,8,["value"])])])])])]),_:1},16),L.value?(l(),M(O,me(Ge({key:0},r)),{default:i(()=>[e("div",Bn,[e("div",Tn,[w[30]||(w[30]=e("span",null,"深度思考 ",-1)),t(Q,null,{title:i(()=>w[29]||(w[29]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),t(be,{checked:a.enable_thinking,"onUpdate:checked":w[9]||(w[9]=P=>a.enable_thinking=P),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):R("",!0),t(O,me(ye(r)),{default:i(()=>[e("div",Fn,[e("div",Jn,[w[32]||(w[32]=e("span",null,"显示推理过程 ",-1)),t(Q,null,{title:i(()=>w[31]||(w[31]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),t(be,{checked:a.think_switch,"onUpdate:checked":w[10]||(w[10]=P=>a.think_switch=P),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Gn=J(Qn,[["__scopeId","data-v-6e25e8b5"]]),Kn={class:"recall-settings-box"},Hn={class:"form-box"},Wn={class:"form-item is-required"},Zn={class:"form-item-body"},Yn={class:"retrieval-mode-items"},Xn=["onClick"],el={class:"retrieval-mode-title"},tl={class:"title-text"},ol={key:0,style:{width:"32px"},src:Zt,alt:""},sl={class:"retrieval-mode-desc"},nl={class:"form-item"},ll={class:"form-item-label"},il={class:"form-item-body"},al={class:"number-box"},rl={class:"number-slider-box"},dl={class:"number-input-box"},_l={key:0,class:"form-item"},cl={class:"form-item-label"},ul={class:"form-item-body"},pl={class:"number-box"},ml={class:"number-slider-box"},vl={class:"number-input-box"},fl={class:"form-item"},bl={class:"form-item-label"},hl={key:0,class:"form-item-body"},yl=["src"],kl={__name:"recall-settings-alert",emits:["change"],setup(D,{expose:m,emit:x}){const _=x,r=S([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=F({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),n=S(!1),f=L=>{y(),s.rerank_status=L.rerank_status||0,s.rerank_use_model=L.rerank_use_model||void 0,s.rerank_model_config_id=L.rerank_model_config_id>0?L.rerank_model_config_id:"",s.top_k=L.top_k,s.similarity=L.similarity,s.search_type=L.search_type,n.value=!0},b=(L,h)=>{if(!L||!h){s.rerank_model_config_id="";return}s.rerank_model_config_id=h.rerank_model_config_id},a=L=>{L==0&&(s.rerank_model_config_id="",s.rerank_use_model="")},$=L=>{s.search_type=L},d=()=>s.rerank_status==1&&!s.rerank_model_config_id,c=()=>{if(d())return Y.error("请选择Rerank模型");n.value=!1,o()},o=()=>{_("change",Z(s))},u=S([]),y=()=>{st({model_type:"RERANK"}).then(L=>{let h=L.data||[];u.value=h.map(I=>({id:I.model_config.id,name:I.model_info.model_name,icon:I.model_info.model_icon_url,children:I.model_info.rerank_model_list}))})};return m({open:f}),(L,h)=>{const I=pe,A=se,v=et,q=Se,N=ne,V=ge,w=Me,K=Et,O=je,z=te;return l(),M(z,{width:"746px",open:n.value,"onUpdate:open":h[6]||(h[6]=E=>n.value=E),title:"召回设置",onOk:c},{default:i(()=>[e("div",Kn,[e("div",Hn,[e("div",Wn,[h[7]||(h[7]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",Zn,[e("div",Yn,[(l(!0),p(T,null,H(r.value,E=>(l(),p("div",{class:we(["retrieval-mode-item",{active:s.search_type==E.value}]),key:E.value,onClick:Q=>$(E.value)},[s.search_type==E.value?(l(),M(I,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",el,[t(I,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",tl,U(E.title),1),E.isRecommendation?(l(),p("img",ol)):R("",!0)]),e("div",sl,U(E.desc),1)],10,Xn))),128))])])]),e("div",nl,[e("div",ll,[h[9]||(h[9]=e("span",null,"Top K ",-1)),t(A,null,{title:i(()=>h[8]||(h[8]=[C("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),e("div",il,[e("div",al,[e("div",rl,[t(v,{class:"custom-slider",value:s.top_k,"onUpdate:value":h[0]||(h[0]=E=>s.top_k=E),min:1,max:10},null,8,["value"])]),e("div",dl,[t(q,{value:s.top_k,"onUpdate:value":h[1]||(h[1]=E=>s.top_k=E),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(l(),p("div",_l,[e("div",cl,[h[11]||(h[11]=e("span",null,"相似度阈值 ",-1)),t(A,null,{title:i(()=>h[10]||(h[10]=[C("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:i(()=>[t(g(ee),{class:"question-icon"})]),_:1})]),e("div",ul,[e("div",pl,[e("div",ml,[t(v,{class:"custom-slider",value:s.similarity,"onUpdate:value":h[2]||(h[2]=E=>s.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",vl,[t(q,{value:s.similarity,"onUpdate:value":h[3]||(h[3]=E=>s.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",fl,[e("div",bl,[h[12]||(h[12]=e("span",null,"Rerank模型",-1)),h[13]||(h[13]=C("   ")),t(N,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":h[4]||(h[4]=E=>s.rerank_status=E),onChange:a},null,8,["checked"])]),s.rerank_status==1?(l(),p("div",hl,[t(O,{allowClear:"",value:s.rerank_use_model,"onUpdate:value":h[5]||(h[5]=E=>s.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:b,style:{width:"60%"}},{default:i(()=>[(l(!0),p(T,null,H(u.value,E=>(l(),M(K,{key:E.id},{label:i(()=>[t(V,{align:"center",gap:8},{default:i(()=>[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,yl),C(U(E.name),1)]),_:2},1024)]),default:i(()=>[(l(!0),p(T,null,H(E.children,Q=>(l(),M(w,{value:Q,rerank_model_config_id:E.id,key:Q},{default:i(()=>[e("span",null,U(Q),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):R("",!0)])])])]),_:1},8,["open"])}}},gl=J(kl,[["__scopeId","data-v-00131927"]]),xl={class:"list-box"},$l=["onClick"],wl={class:"avater-box"},ql=["src"],Sl={class:"content-box"},Cl={class:"title-block"},Ll={class:"title-text"},Il={class:"desc-box"},Ul={class:"right-icon"},Rl={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(D,{expose:m,emit:x}){const _=x,r=D,s=S(!1);_e(()=>r.list,()=>{r.list.length==0&&(s.value=!1)},{});const n=()=>{s.value=!0},f=()=>{document.visibilityState==="visible"&&_("refreshList")};ke(()=>{document.addEventListener("visibilitychange",f)}),ct(()=>{document.removeEventListener("visibilitychange",f)});const b=a=>{window.open(`/#/library/details/knowledge-config?id=${a.id}`)};return m({show:n}),(a,$)=>{const d=Ot,c=nt,o=te;return l(),p("div",null,[t(o,{open:s.value,"onUpdate:open":$[0]||($[0]=u=>s.value=u),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:i(()=>[t(d,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(c,{scrollbar:!1,style:{height:"400px"}},{default:i(()=>[e("div",xl,[(l(!0),p(T,null,H(r.list,u=>(l(),p("div",{class:"list-item",onClick:y=>b(u),key:u.id},[e("div",wl,[e("img",{src:u.avatar,alt:""},null,8,ql)]),e("div",Sl,[e("div",Cl,[$[1]||($[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",Ll,U(u.library_name),1)]),e("div",Il,U(u.library_intro),1)]),e("div",Ul,[t(g(At))])],8,$l))),128))])]),_:1})]),_:1},8,["open"])])}}},El=J(Rl,[["__scopeId","data-v-a87bd0fa"]]),Ol={class:"actions-box"},Al={key:0,class:"library-list"},jl=["onClick"],Ml=["onClick"],Vl={class:"library-name"},zl={class:"library-name-text"},Dl={class:"library-intro"},Nl={class:"setting-info-block"},Pl={class:"set-item"},Bl={key:0},Tl={key:1},Fl={key:2},Jl={key:3},Ql={class:"set-item"},Gl={key:0,class:"set-item"},Kl={class:"set-item"},Hl={key:0},Wl={key:1},Zl={__name:"index",setup(D){const m=gt(),x=oe(()=>{var q;return((q=m.companyInfo)==null?void 0:q.neo4j_status)=="true"}),_=S(!1),{robotInfo:r,updateRobotInfo:s}=W("robotInfo"),n=F({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),f=S([]),b=S(null),a=oe(()=>f.value.filter(q=>n.library_ids.includes(q.id))),$=oe(()=>a.value.filter(q=>q.graph_switch==0)),d=q=>{let N=n.library_ids.indexOf(q.id);n.library_ids.splice(N,1),I()},c=q=>{n.library_ids=[...q],I()},o=()=>{b.value.open([...n.library_ids])},u=S(null),y=()=>{u.value.open(Z(n))},L=S(null),h=q=>{n.rerank_status=q.rerank_status,n.rerank_use_model=q.rerank_use_model,n.rerank_model_config_id=q.rerank_model_config_id,n.top_k=q.top_k,n.similarity=q.similarity,n.search_type=q.search_type,(q.search_type==1||q.search_type==4)&&$.value.length>0&&L.value.show(),I()},I=()=>{let q={...Z(n)};q.library_ids=q.library_ids.join(","),s({...q})},A=async()=>{const q=await xt({type:"",show_open_docs:1});q&&(f.value=q.data||[])};n.rerank_use_model=r.rerank_use_model||void 0,qe(()=>{n.library_ids=r.library_ids.split(","),n.rerank_status=r.rerank_status||0,n.rerank_use_model=r.rerank_use_model||void 0,n.rerank_model_config_id=r.rerank_model_config_id||"",n.top_k=r.top_k,n.similarity=r.similarity,n.search_type=r.search_type});const v=q=>{window.open(`#/library/details/knowledge-document?id=${q.id}`)};return ke(()=>{A()}),(q,N)=>{const V=le,w=ge,K=se;return l(),M(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:_.value,"onUpdate:isEdit":N[0]||(N[0]=O=>_.value=O),bodyStyle:{padding:0}},{extra:i(()=>[e("div",Ol,[t(w,{gap:8},{default:i(()=>[t(V,{size:"small",onClick:y},{default:i(()=>N[1]||(N[1]=[C("召回设置")])),_:1,__:[1]}),t(V,{size:"small",onClick:o},{default:i(()=>N[2]||(N[2]=[C("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[a.value.length>0?(l(),p("div",Al,[(l(!0),p(T,null,H(a.value,O=>(l(),p("div",{class:"library-item",key:O.id,onClick:z=>v(O)},[O.id!=g(r).default_library_id?(l(),p("span",{key:0,class:"close-btn",onClick:ut(z=>d(O),["stop"])},[t(g(fe))],8,Ml)):R("",!0),e("div",Vl,[x.value?(l(),M(K,{key:0},{title:i(()=>[C(U(O.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:i(()=>[e("div",{class:we(["graph-tag",{active:O.graph_switch==1}])},"Graph",2)]),_:2},1024)):R("",!0),e("div",zl,U(O.library_name),1)]),e("div",Dl,U(O.library_intro),1)],8,jl))),128))])):R("",!0),e("div",Nl,[e("div",Pl,[N[3]||(N[3]=C(" 检索模式： ")),n.search_type==1?(l(),p("span",Bl,"混合检索")):R("",!0),n.search_type==2?(l(),p("span",Tl,"向量检索")):R("",!0),n.search_type==3?(l(),p("span",Fl,"全文检索")):R("",!0),n.search_type==4?(l(),p("span",Jl,"知识图谱检索")):R("",!0)]),e("div",Ql,[N[4]||(N[4]=C(" Top K： ")),e("span",null,U(n.top_k),1)]),n.search_type<=2?(l(),p("div",Gl,[N[5]||(N[5]=C(" 相似度阈值： ")),e("span",null,U(n.similarity),1)])):R("",!0),e("div",Kl,[N[6]||(N[6]=C(" Rerank模型： ")),n.rerank_status==0?(l(),p("span",Hl,"关")):(l(),p("span",Wl,U(n.rerank_use_model),1))])]),t(Wt,{ref_key:"librarySelectAlertRef",ref:b,onChange:c},null,512),t(gl,{ref_key:"recallSettingsAlertRef",ref:u,onChange:h},null,512),t(El,{list:$.value,onRefreshList:A,ref_key:"noOpenGraphModalRef",ref:L},null,8,["list"])]),_:1},8,["isEdit"])}}},Yl=J(Zl,[["__scopeId","data-v-d7abace9"]]),Xl={class:"library-checkbox-box"},ei={class:"list-box",ref:"scrollContainer"},ti={class:"library-name"},oi={class:"library-desc"},si={key:0,class:"empty-box"},ni={__name:"library-select-alert",emits:["change"],setup(D,{expose:m,emit:x}){const _=x,r=F({indeterminate:!1,checkAll:!1,checkedList:[]}),s=S(!1),n=o=>{$(),r.checkedList=o,s.value=!0},f=()=>{s.value=!1,a()};S("");const b=S([]),a=()=>{_("change",[...r.checkedList])},$=async()=>{const o=await lt();if(o){let u=o.data||[];b.value=u}},d=S(!1),c=()=>{window.open("/#/database/list")};return m({open:n}),(o,u)=>{const y=Mt,L=jt,h=He,I=te;return l(),M(I,{width:"746px",open:s.value,"onUpdate:open":u[1]||(u[1]=A=>s.value=A),title:"关联数据表",onOk:f},{default:i(()=>[e("div",Xl,[t(h,{spinning:d.value,delay:100},{default:i(()=>[t(L,{value:r.checkedList,"onUpdate:value":u[0]||(u[0]=A=>r.checkedList=A),style:{width:"100%"}},{default:i(()=>[e("div",ei,[(l(!0),p(T,null,H(b.value,A=>(l(),p("div",{class:"list-item-wraapper",key:A.id},[t(y,{class:"list-item",value:A.id},{default:i(()=>[e("div",ti,U(A.name),1),e("div",oi,U(A.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!d.value&&!b.value.length?(l(),p("div",si,[u[3]||(u[3]=e("img",{src:Yt,alt:""},null,-1)),e("div",null,[u[2]||(u[2]=C(" 暂无数据表, 请先去添加数据表 ")),e("a",{onClick:c}," 去添加")])])):R("",!0)])]),_:1},8,["open"])}}},li=J(ni,[["__scopeId","data-v-b559dd08"]]),ii={class:"actions-box"},ai={key:0,class:"library-list"},ri=["onClick"],di={class:"library-name"},_i={class:"library-intro"},ci={__name:"index",setup(D){const m=S(!1),{robotInfo:x,updateRobotInfo:_}=W("robotInfo"),r=F({form_ids:[]}),s=S([]),n=S(null),f=oe(()=>s.value.filter(o=>r.form_ids.includes(o.id))),b=o=>{let u=r.form_ids.indexOf(o.id);r.form_ids.splice(u,1),d()},a=o=>{r.form_ids=[...o],d()},$=()=>{n.value.open([...r.form_ids])},d=()=>{let o={...Z(r)};o.form_ids=o.form_ids.join(","),_({...o})};return(async()=>{const o=await lt();o&&(s.value=o.data||[])})(),qe(()=>{r.form_ids=x.form_ids.split(",")}),(o,u)=>{const y=se,L=le,h=ge;return l(),M(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:m.value,"onUpdate:isEdit":u[0]||(u[0]=I=>m.value=I),bodyStyle:{padding:0}},{tip:i(()=>[t(y,{placement:"top"},{title:i(()=>u[1]||(u[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:i(()=>[t(g(ee))]),_:1})]),extra:i(()=>[e("div",ii,[t(h,{gap:8},{default:i(()=>[t(L,{size:"small",onClick:$},{default:i(()=>u[2]||(u[2]=[C("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[f.value.length>0?(l(),p("div",ai,[(l(!0),p(T,null,H(f.value,I=>(l(),p("div",{class:"library-item",key:I.id},[e("span",{class:"close-btn",onClick:A=>b(I)},[t(g(fe))],8,ri),e("div",di,U(I.name),1),e("div",_i,U(I.description),1)]))),128))])):R("",!0),t(li,{ref_key:"librarySelectAlertRef",ref:n,onChange:a},null,512)]),_:1},8,["isEdit"])}}},ui=J(ci,[["__scopeId","data-v-c40914ca"]]),pi={class:"form-box"},mi={class:"question-title"},vi={class:"question-options"},fi={class:"question-option"},bi={class:"drag-btn"},hi={class:"action-box"},yi={class:"robot-info-box"},ki={class:"robot-welcome-content"},gi={class:"robot-welcome-question"},xi={__name:"welcome-words",setup(D){const m=S(!1),x=S(!1),{robotInfo:_,updateRobotInfo:r,scrollBoxToBottom:s}=W("robotInfo"),n=F({welcomes:{content:"",question:[]}}),f=()=>{let c=!1;if(n.welcomes.question.length>0){for(let o=0;o<n.welcomes.question.length;o++)if(!n.welcomes.question[o].content){c=o+1;break}}return c},b=()=>{n.welcomes.question.push({content:"",id:Ue(8)})},a=c=>{n.welcomes.question.splice(c,1)},$=()=>{if(!n.welcomes.content)return Y.error("请输入欢迎语");if(f())return Y.error("引导问题内容不能为空");r({...Z(n)}),m.value=!1},d=()=>{let c={..._.welcomes},o=[];c.question.forEach(({content:u,id:y})=>{let L={id:y,content:u};L.id||(L.id=Ue(6)),o.push(L)}),n.welcomes.content=c.content,n.welcomes.question=o};return(c,o)=>{const u=$e,y=pe,L=xe;return l(),M(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:m.value,"onUpdate:isEdit":o[4]||(o[4]=h=>m.value=h),onSave:$,onEdit:d},{default:i(()=>[ce(e("div",pi,[e("div",mi,[t(u,{value:n.welcomes.content,"onUpdate:value":o[0]||(o[0]=h=>n.welcomes.content=h),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",vi,[t(g(De),{modelValue:n.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=h=>n.welcomes.question=h),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=h=>x.value=!0),onEnd:o[3]||(o[3]=h=>x.value=!1)},{item:i(({element:h,index:I})=>[e("div",fi,[e("span",bi,[t(y,{name:"drag"})]),t(L,{class:"question-option-content",value:h.content,"onUpdate:value":A=>h.content=A,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",hi,[t(g(fe),{class:"del-btn",onClick:A=>a(I)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:b},[t(g(Re),{class:"add-btn-icon"}),o[5]||(o[5]=C("添加引导问题 "))])])],512),[[ue,m.value]]),ce(e("div",yi,[e("div",ki,U(g(_).welcomes.content),1),e("div",gi,[(l(!0),p(T,null,H(g(_).welcomes.question,(h,I)=>(l(),p("div",{class:"question-item",key:I},U(h.content),1))),128))])],512),[[ue,!m.value]])]),_:1},8,["isEdit"])}}},$i=J(xi,[["__scopeId","data-v-ea227a87"]]),wi={class:"form-box"},qi={class:"question-title"},Si={class:"question-options"},Ci={class:"question-option"},Li={class:"drag-btn"},Ii={class:"action-box"},Ui={class:"robot-info-box"},Ri={class:"robot-unknown-content"},Ei={class:"robot-unknown-question"},Oi={__name:"unknown-problem-prompt",setup(D){const m=S(!1),x=S(!1),{robotInfo:_,updateRobotInfo:r,scrollBoxToBottom:s}=W("robotInfo"),n=F({unknown_question_prompt:{content:"",question:[]}}),f=()=>{n.unknown_question_prompt.question.push({content:"",id:Ue(8)}),Ke(()=>{s()})},b=d=>{n.unknown_question_prompt.question.splice(d,1)},a=()=>{r({...Z(n)}),m.value=!1},$=()=>{let d={..._.unknown_question_prompt},c=[];d.question&&d.question.forEach(({content:o,id:u})=>{let y={id:u,content:o};y.id||(y.id=Ue(6)),c.push(y)}),d.content&&(n.unknown_question_prompt.content=d.content),c&&(n.unknown_question_prompt.question=c)};return ke(()=>{}),(d,c)=>{const o=se,u=$e,y=pe,L=xe;return l(),M(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:m.value,"onUpdate:isEdit":c[4]||(c[4]=h=>m.value=h),onSave:a,onEdit:$},{tip:i(()=>[t(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>c[5]||(c[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:i(()=>[t(g(ee))]),_:1})]),default:i(()=>[ce(e("div",wi,[e("div",qi,[t(u,{value:n.unknown_question_prompt.content,"onUpdate:value":c[0]||(c[0]=h=>n.unknown_question_prompt.content=h),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Si,[t(g(De),{modelValue:n.unknown_question_prompt.question,"onUpdate:modelValue":c[1]||(c[1]=h=>n.unknown_question_prompt.question=h),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=h=>x.value=!0),onEnd:c[3]||(c[3]=h=>x.value=!1)},{item:i(({element:h,index:I})=>[e("div",Ci,[e("span",Li,[t(y,{name:"drag"})]),t(L,{class:"question-option-content",value:h.content,"onUpdate:value":A=>h.content=A,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ii,[t(g(fe),{class:"del-btn",onClick:A=>b(I)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:f},[t(g(Re),{class:"add-btn-icon"}),c[6]||(c[6]=C("添加引导问题 "))])])],512),[[ue,m.value]]),ce(e("div",Ui,[e("div",Ri,U(g(_).unknown_question_prompt.content),1),e("div",Ei,[(l(!0),p(T,null,H(g(_).unknown_question_prompt.question,(h,I)=>(l(),p("div",{class:"question-item",key:I},U(h.content),1))),128))])],512),[[ue,!m.value]])]),_:1},8,["isEdit"])}}},Ai=J(Oi,[["__scopeId","data-v-bc797bf6"]]),ji={class:"robot-info-box"},Mi={class:"modal-box",ref:"modalBoxRef"},Vi={class:"modal-item-box"},zi={class:"modal-item"},Di={class:"modal-item"},Ni={__name:"problem-optimization",setup(D){const m=S(!1);S(!1);const{robotInfo:x,updateRobotInfo:_}=W("robotInfo"),r=S("0"),s=F({optimize_question_use_model:"",optimize_question_model_config_id:""});ke(()=>{r.value=x.optimize_question_model_config_id!=0?"1":"0",s.optimize_question_use_model=x.optimize_question_use_model,s.optimize_question_model_config_id=x.optimize_question_model_config_id});const n=S([]),f=c=>{n.value=c,Ke(()=>{(!s.optimize_question_use_model||!Number(s.optimize_question_model_config_id))&&b()})},b=()=>{if(n.value.length>0){let c=null,o=null;for(let u of n.value)if(u.model_define==="tongyi"){c=u;for(let y of c.children)if(y.name==="qwen-max"){o=y;break}break}c||(c=n.value[0],o=c.children[0]),c&&o&&(s.optimize_question_use_model=o.name,s.optimize_question_model_config_id=o.model_config_id)}},a=()=>{m.value=!1,_({...Z(s)})},$=c=>{c!=1&&(s.optimize_question_use_model="",s.optimize_question_model_config_id=0)},d=c=>{_({})};return(c,o)=>{const u=se,y=ne,L=ze,h=Ve,I=$e,A=te;return l(),M(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:i(()=>o[7]||(o[7]=[e("span",null,null,-1)])),default:i(()=>[e("div",ji,[o[9]||(o[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),t(u,null,{title:i(()=>o[8]||(o[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:i(()=>[e("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=v=>m.value=!0)}," 对话背景设置 ")]),_:1})]),t(y,{onChange:d,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:g(x).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=v=>g(x).enable_question_optimize=v),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",Mi,[t(A,{getContainer:()=>c.$refs.modalBoxRef,open:m.value,"onUpdate:open":o[6]||(o[6]=v=>m.value=v),width:472,title:"用户问题建议设置",onOk:a},{default:i(()=>[e("div",Vi,[e("div",zi,[o[12]||(o[12]=e("div",{class:"label"},"模型",-1)),t(h,{value:r.value,"onUpdate:value":o[2]||(o[2]=v=>r.value=v),onChange:$},{default:i(()=>[t(L,{value:"0"},{default:i(()=>o[10]||(o[10]=[C("跟随机器人")])),_:1,__:[10]}),t(L,{value:"1"},{default:i(()=>o[11]||(o[11]=[C("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),r.value=="1"?(l(),M(Xt,{key:0,modelType:"LLM",modeName:s.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=v=>s.optimize_question_use_model=v),modeId:s.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=v=>s.optimize_question_model_config_id=v),style:{width:"100%","margin-top":"8px"},onLoaded:f},null,8,["modeName","modeId"])):R("",!0)]),e("div",Di,[o[13]||(o[13]=e("div",{class:"label"},"对话背景",-1)),t(I,{style:{height:"120px"},value:g(x).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=v=>g(x).optimize_question_dialogue_background=v),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Pi=J(Ni,[["__scopeId","data-v-a42248ec"]]),Bi={class:"robot-info-box"},Ti={class:"robot-prompt"},Fi={__name:"suggested-issues",setup(D){S(!1);const{robotInfo:m,updateRobotInfo:x}=W("robotInfo"),_=r=>{x({})};return(r,s)=>{const n=Se,f=ne;return l(),M(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:i(()=>s[2]||(s[2]=[e("span",null,null,-1)])),default:i(()=>[e("div",Bi,[e("div",Ti,[s[3]||(s[3]=C(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),t(n,{value:g(m).question_guide_num,"onUpdate:value":s[0]||(s[0]=b=>g(m).question_guide_num=b),style:{width:"80px"},precision:0,min:1,max:10,onBlur:_},null,8,["value"]),s[4]||(s[4]=C(" 条用户提问建议，最大不超过10条。 "))])]),t(f,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:g(m).enable_question_guide,"onUpdate:checked":s[1]||(s[1]=b=>g(m).enable_question_guide=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ji=J(Fi,[["__scopeId","data-v-f6a291d4"]]),Qi={__name:"sensitive-words",setup(D){S(!1);const{robotInfo:m,updateRobotInfo:x}=W("robotInfo");F({prompt:""});const _=()=>{window.open("/#/user/sensitive-words")},r=s=>{x({})};return(s,n)=>{const f=ne;return l(),M(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:i(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:i(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[n[2]||(n[2]=C(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),e("span",{onClick:_,style:{cursor:"pointer"}},"设置敏词 >")])]),t(f,{onChange:r,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:g(m).sensitive_words_switch,"onUpdate:checked":n[0]||(n[0]=b=>g(m).sensitive_words_switch=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Gi=J(Qi,[["__scopeId","data-v-56c388e6"]]),Ki={class:"direct-title"},Hi={class:"direct-desc"},Wi={class:"qa"},Zi={class:"prompt-form-item-label"},Yi={class:"direct-switch"},Xi={class:"similarity"},ea={class:"number-input-box"},ta={__name:"chat-edit-alert",emits:["save"],setup(D,{expose:m,emit:x}){const _=x,r=S(1),s=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],n=F(s()),f=S(!1),b=F({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),a=()=>{b.chat_type=r.value.toString(),n.forEach(c=>{c.chat_type==r.value&&(b.chat_type=="3"?(b.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch==1?"true":"false",b.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score.toString()):b.chat_type=="1"&&(b.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch==1?"true":"false",b.library_qa_direct_reply_score=c.library_qa_direct_reply_score.toString()))}),$(),Object.assign(n,s()),f.value=!1},$=()=>{_("save",Z(b))};ke(()=>{});const d=c=>{r.value=parseInt(c.chat_type),b.chat_type=c.chat_type,b.library_qa_direct_reply_score=c.library_qa_direct_reply_score,b.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch,b.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,b.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch,n.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=c.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch=="true"?1:0)}),f.value=!0};return _e(()=>f.value,c=>{c===!1&&Object.assign(n,s())},{immediate:!0}),m({open:d}),(c,o)=>{const u=se,y=ne,L=Se,h=ze,I=Ve,A=te;return l(),M(A,{width:"746px",open:f.value,"onUpdate:open":o[1]||(o[1]=v=>f.value=v),title:"聊天模式设置",onOk:a},{default:i(()=>[t(I,{class:"direct-box",value:r.value,"onUpdate:value":o[0]||(o[0]=v=>r.value=v)},{default:i(()=>[(l(!0),p(T,null,H(n,v=>(l(),M(h,{class:we(["direct-item",{active:r.value==v.direct_id}]),value:v.direct_id,key:v.direct_id},{default:i(()=>[e("div",Ki,U(v.direct_title),1),e("div",Hi,U(v.direct_desc),1),ce(e("div",Wi,[e("div",Zi,[o[4]||(o[4]=e("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),t(u,null,pt({default:i(()=>[t(g(ee),{class:"question-icon"})]),_:2},[v.chat_type=="1"?{name:"title",fn:i(()=>[o[2]||(o[2]=C("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:v.chat_type=="3"?{name:"title",fn:i(()=>[o[3]||(o[3]=C("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),e("div",Yi,[v.chat_type=="1"?(l(),M(y,{key:0,checkedValue:1,unCheckedValue:0,checked:v.library_qa_direct_reply_switch,"onUpdate:checked":q=>v.library_qa_direct_reply_switch=q},null,8,["checked","onUpdate:checked"])):v.chat_type=="3"?(l(),M(y,{key:1,checkedValue:1,unCheckedValue:0,checked:v.mixture_qa_direct_reply_switch,"onUpdate:checked":q=>v.mixture_qa_direct_reply_switch=q},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[ue,v.isQaDirectReply&&r.value==v.direct_id]]),ce(e("div",Xi,[o[5]||(o[5]=e("span",null,"相似度超过",-1)),e("div",ea,[v.chat_type=="1"?(l(),M(L,{key:0,value:v.library_qa_direct_reply_score,"onUpdate:value":q=>v.library_qa_direct_reply_score=q,disabled:!v.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):v.chat_type=="3"?(l(),M(L,{key:1,value:v.mixture_qa_direct_reply_score,"onUpdate:value":q=>v.mixture_qa_direct_reply_score=q,disabled:!v.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),o[6]||(o[6]=e("span",null,"时直接回复答案",-1))],512),[[ue,v.isQaDirectReply&&r.value==v.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},oa=J(ta,[["__scopeId","data-v-ba2922ca"]]),sa={class:"actions-box"},na={class:"setting-info-block"},la={class:"set-item"},ia={key:0},aa={key:1},ra={key:2},da={class:"set-item"},_a={key:0,class:"set-item"},ca={class:"set-item"},ua={key:0,class:"set-item"},pa={class:"form-box"},ma={__name:"index",setup(D){const m=S(!1),x=S(null),{robotInfo:_,updateRobotInfo:r}=W("robotInfo"),s=F({chat_type:_.chat_type,library_qa_direct_reply_score:_.library_qa_direct_reply_score,library_qa_direct_reply_switch:_.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:_.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:_.mixture_qa_direct_reply_switch}),n=a=>{s.chat_type=a.chat_type,s.library_qa_direct_reply_score=a.library_qa_direct_reply_score,s.library_qa_direct_reply_switch=a.library_qa_direct_reply_switch,s.mixture_qa_direct_reply_score=a.mixture_qa_direct_reply_score,s.mixture_qa_direct_reply_switch=a.mixture_qa_direct_reply_switch,f()},f=()=>{r({...Z(s)}),m.value=!1},b=()=>{x.value.open(Z(s)),m.value=!0};return(a,$)=>{const d=se,c=le;return l(),M(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:m.value,"onUpdate:isEdit":$[1]||($[1]=o=>m.value=o),bodyStyle:{padding:0}},{tip:i(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>$[2]||($[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:i(()=>[t(g(ee))]),_:1})]),extra:i(()=>[e("div",sa,[t(c,{size:"small",onClick:$[0]||($[0]=o=>b(!0))},{default:i(()=>$[3]||($[3]=[C("修改")])),_:1,__:[3]})])]),default:i(()=>[e("div",na,[e("div",la,[$[4]||($[4]=C(" 聊天模式： ")),g(_).chat_type=="1"?(l(),p("span",ia,"仅知识库")):R("",!0),g(_).chat_type=="2"?(l(),p("span",aa,"直连模式")):R("",!0),g(_).chat_type=="3"?(l(),p("span",ra,"混合模式")):R("",!0)]),g(_).chat_type=="1"?(l(),p(T,{key:0},[e("div",da,[$[5]||($[5]=C(" 命中问答知识时直接回复答案： ")),e("span",null,U(g(_).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),g(_).library_qa_direct_reply_switch=="true"?(l(),p("div",_a,[$[6]||($[6]=C(" 相似度阈值： ")),e("span",null,U(g(_).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),g(_).chat_type=="3"?(l(),p(T,{key:1},[e("div",ca,[$[7]||($[7]=C(" 命中问答知识时直接回复答案： ")),e("span",null,U(g(_).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),g(_).mixture_qa_direct_reply_switch=="true"?(l(),p("div",ua,[$[8]||($[8]=C(" 相似度阈值： ")),e("span",null,U(g(_).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",pa,[t(oa,{ref_key:"ChatEditAlertRef",ref:x,onSave:n},null,512)])]),_:1},8,["isEdit"])}}},va=J(ma,[["__scopeId","data-v-eafe1264"]]),fa={class:"switch-box"},ba={class:"switch-box-body"},ha={class:"switch-box-header"},ya={class:"left-box"},ka={class:"switch-box-title"},ga={key:0,class:"title-tip"},xa={class:"right-box"},$a={class:"extra-box"},wa={class:"switch-desc"},qa={class:"switch-box-right"},Sa={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(D,{emit:m}){const x=m,_=D,r=S(_.value),s=n=>{x("update:value",n),x("change",n)};return(n,f)=>{const b=pe,a=ne;return l(),p("div",fa,[e("div",ba,[e("div",ha,[e("div",ya,[t(b,{class:"switch-box-icon",name:_.iconName},null,8,["name"]),e("span",ka,U(_.title),1),n.$slots.tip?(l(),p("span",ga,[ve(n.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",xa,[e("div",$a,[ve(n.$slots,"extra",{},()=>[f[1]||(f[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",wa,[ve(n.$slots,"default",{},void 0,!0)])]),e("div",qa,[t(a,{checked:r.value,"onUpdate:checked":f[0]||(f[0]=$=>r.value=$),onChange:s,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ca=J(Sa,[["__scopeId","data-v-8d185d5f"]]),La="/assets/img/phone-head-CDwwPhYa.png",Ia="/assets/img/phone-body-CbEf8GZP.png",Ua="/assets/img/phone-footer-ClQtNpln.png",Ra={class:"common-problem-box"},Ea={class:"left-content-box"},Oa={key:0,class:"empty-box"},Aa={key:1,class:"lists-box"},ja={class:"drag-btn"},Ma={class:"title"},Va={class:"opration-box"},za={class:"preview-box"},Da={class:"phone-body"},Na={key:0,class:"question-box"},Pa={__name:"common-problem",setup(D){S(!1);const{robotInfo:m,updateRobotInfo:x}=W("robotInfo"),_=oe(()=>m.common_question_list?JSON.parse(m.common_question_list):[]),r=S([]);r.value=_.value,_e(_,()=>{r.value=_.value});const s=Oe.useForm,n=S(!1),f=S("添加问题"),b=F({question:"",index:-1}),a=F({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:$,validate:d,validateInfos:c}=s(b,a),o=()=>{if(_.value.length>=10)return Y.error("最多设置10条常用问题");n.value=!0,$(),b.question="",b.index=-1},u=(A,v)=>{n.value=!0,$(),b.question=A,b.index=v},y=A=>{let v=[];v=_.value.filter((q,N)=>A!=N),te.confirm({title:"提醒",icon:t(Ae),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){x({common_question_list:JSON.stringify(v)})},onCancel(){}})},L=()=>{d().then(()=>{let A=[];b.index>=0?A=_.value.map((v,q)=>q===b.index?b.question:v):A=[b.question,..._.value],x({common_question_list:JSON.stringify(A)}),n.value=!1})},h=A=>{x({})},I=A=>{x({common_question_list:JSON.stringify(r.value)})};return(A,v)=>{const q=se,N=ne,V=Vt,w=le,K=pe,O=xe,z=We,E=Oe,Q=te;return l(),p("div",Ra,[e("div",Ea,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:i(()=>[t(q,null,{title:i(()=>v[4]||(v[4]=[C("最多10条。开启后，常见问题会显示在每条问答后面")])),default:i(()=>[t(g(ee),{class:"quess-icon"})]),_:1})]),extra:i(()=>[t(N,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:g(m).enable_common_question,"onUpdate:checked":v[0]||(v[0]=G=>g(m).enable_common_question=G),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(V,{type:"vertical"}),t(w,{type:"primary",size:"small",onClick:o},{default:i(()=>v[5]||(v[5]=[C("添加")])),_:1,__:[5]})]),default:i(()=>[_.value.length==0?(l(),p("div",Oa,[v[7]||(v[7]=e("img",{src:eo,alt:""},null,-1)),v[8]||(v[8]=e("div",{class:"title"},"暂无数据",-1)),v[9]||(v[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),t(w,{onClick:o,type:"primary"},{default:i(()=>v[6]||(v[6]=[C("立即添加")])),_:1,__:[6]})])):(l(),p("div",Aa,[t(g(De),{modelValue:r.value,"onUpdate:modelValue":v[1]||(v[1]=G=>r.value=G),handle:".drag-btn","item-key":"index",onEnd:I},{item:i(({element:G,index:ie})=>[(l(),p("div",{class:"list-item",key:ie},[e("span",ja,[t(K,{name:"drag"})]),e("div",Ma,U(G),1),e("div",Va,[t(g(tt),{onClick:be=>u(G,ie)},null,8,["onClick"]),t(g(fe),{onClick:be=>y(ie)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",za,[v[12]||(v[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:La,alt:""})],-1)),e("div",Da,[v[11]||(v[11]=e("div",null,[e("img",{class:"body-img",src:Ia,alt:""})],-1)),_.value.length&&g(m).enable_common_question=="true"?(l(),p("div",Na,[v[10]||(v[10]=e("div",{class:"name"},"常见问题",-1)),(l(!0),p(T,null,H(_.value,G=>(l(),p("div",{class:"list-item",key:G},U(G),1))),128))])):R("",!0)]),v[13]||(v[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Ua,alt:""})],-1))]),t(Q,{open:n.value,"onUpdate:open":v[3]||(v[3]=G=>n.value=G),title:f.value,onOk:L,width:"476px"},{default:i(()=>[t(E,{class:"form-box",layout:"vertical"},{default:i(()=>[t(z,Ge({label:"问题名称"},g(c).question),{default:i(()=>[t(O,{maxLength:100,value:b.question,"onUpdate:value":v[2]||(v[2]=G=>b.question=G),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Ba=J(Pa,[["__scopeId","data-v-5125783f"]]),Ta={__name:"display-aitations",setup(D){const{robotInfo:m,updateRobotInfo:x}=W("robotInfo"),_=S(!1);_e(()=>m.answer_source_switch,s=>{_.value=s=="true"},{immediate:!0});const r=()=>{x({answer_source_switch:_.value?"true":"false"})};return(s,n)=>(l(),M(Ca,{title:"显示引文","icon-name":"jibenpeizhi",value:_.value,"onUpdate:value":n[0]||(n[0]=f=>_.value=f),onChange:r},{extra:i(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:i(()=>[n[2]||(n[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},Fa={__name:"show-like",setup(D){const{robotInfo:m,updateRobotInfo:x}=W("robotInfo"),_=r=>{x({})};return(r,s)=>{const n=ne;return l(),M(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:i(()=>s[1]||(s[1]=[e("span",null,null,-1)])),default:i(()=>[s[2]||(s[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),t(n,{onChange:_,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:g(m).feedback_switch,"onUpdate:checked":s[0]||(s[0]=f=>g(m).feedback_switch=f),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Ja=J(Fa,[["__scopeId","data-v-4948feb9"]]),Qa={class:"content-box"},Ga={key:0,class:"add-btn-block"},Ka={class:"list-content"},Ha={key:0,class:"user-block"},Wa={class:"name-box"},Za={class:"name"},Ya={class:"remark-text"},Xa={key:0,class:"hover-btn-box"},er={key:0},tr={key:1},or={key:2},sr={key:1,class:"hover-btn-box"},nr={class:"role-menu-box"},lr=["onClick"],ir={class:"menu-header"},ar={key:0,class:"check-box"},rr=["onClick"],dr={class:"menu-header"},_r={key:0,class:"check-box"},cr=["onClick"],ur={class:"menu-header"},pr={key:0,class:"check-box"},mr={class:"hover-btn-box"},vr={key:0},fr={key:1},br={key:2},hr=["onClick"],yr={__name:"role-permission",setup(D){const m=$t(),x=oe(()=>m.user_name),_=Je().query,r=S(wt(_.id)),s=S([]),n=F({object_id:_.id,object_type:1}),f=()=>{to({...n}).then(o=>{let u=o.data||[];s.value=u})};f();const b=S(null),a=()=>{b.value.show(s.value,[{object_id:+_.id,object_type:1,operate_rights:4}])},$=(o,u)=>{let y=u==4?"管理":u==2?"编辑":"查看";te.confirm({title:"提示?",icon:t(Ae),content:"确认修改该协作者权限为【"+y+"】",okText:"确认",cancelText:"取消",onOk:()=>{let L=[{object_id:+o.object_id,object_type:+o.object_type,operate_rights:+u}];oo({identity_ids:o.identity_id,identity_type:o.identity_type,object_array:JSON.stringify(L)}).then(h=>{Y.success("修改成功"),f()})},onCancel(){}})},d=o=>{te.confirm({title:"提示?",icon:t(Ae),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{so({identity_id:o.identity_id,identity_type:o.identity_type,object_id:o.object_id,object_type:o.object_type}).then(u=>{Y.success("删除成功"),f()})},onCancel(){}})},c=S([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(o,u)=>{const y=le,L=zt,h=Dt,I=Pt,A=nt;return l(),M(A,null,{default:i(()=>[e("div",Qa,[r.value==4?(l(),p("div",Ga,[t(y,{type:"primary",onClick:a,icon:Qe(g(Re))},{default:i(()=>u[0]||(u[0]=[C("添加协助者")])),_:1,__:[0]},8,["icon"])])):R("",!0),e("div",Ka,[t(I,{columns:c.value,"data-source":s.value,pagination:!1},{bodyCell:i(({column:v,record:q})=>[v.key==="name"?(l(),p("div",Ha,[t(L,{shape:"square",src:q.avatar,size:40},{icon:i(()=>[q.avatar?R("",!0):(l(),M(g(Te),{key:0}))]),_:2},1032,["src"]),e("div",Wa,[e("div",Za,U(q.user_name),1),e("div",Ya,U(q.name),1)])])):R("",!0),v.key==="operate_rights"?(l(),p(T,{key:1},[r.value==2||q.user_name==x.value?(l(),p("div",Xa,[q.operate_rights==4?(l(),p("span",er,"管理")):R("",!0),q.operate_rights==2?(l(),p("span",tr,"编辑")):R("",!0),q.operate_rights==1?(l(),p("span",or,"查看")):R("",!0)])):q.role_type==1||q.is_creator==1?(l(),p("div",sr,"管理")):(l(),M(h,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:i(()=>[e("div",nr,[e("div",{class:"role-menu",onClick:N=>$(q,4)},[e("div",ir,[t(g(Te)),u[1]||(u[1]=e("span",{class:"title"},"管理",-1))]),u[2]||(u[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),q.operate_rights==4?(l(),p("div",ar,[t(g(Ee))])):R("",!0)],8,lr),e("div",{class:"role-menu",onClick:N=>$(q,2)},[e("div",dr,[t(g(tt)),u[3]||(u[3]=e("span",{class:"title"},"编辑",-1))]),u[4]||(u[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),q.operate_rights==2?(l(),p("div",_r,[t(g(Ee))])):R("",!0)],8,rr),e("div",{class:"role-menu",onClick:N=>$(q,1)},[e("div",ur,[t(g(Nt)),u[5]||(u[5]=e("span",{class:"title"},"查看",-1))]),u[6]||(u[6]=e("div",{class:"desc"},"仅查看",-1)),q.operate_rights==1?(l(),p("div",pr,[t(g(Ee))])):R("",!0)],8,cr)])]),default:i(()=>[e("div",mr,[q.operate_rights==4?(l(),p("span",vr,"管理")):R("",!0),q.operate_rights==2?(l(),p("span",fr,"编辑")):R("",!0),q.operate_rights==1?(l(),p("span",br,"查看")):R("",!0),t(g(Xe))])]),_:2},1024))],64)):R("",!0),v.key==="action"?(l(),p(T,{key:2},[r.value==4&&q.user_name!=x.value?(l(),p(T,{key:0},[q.role_type!=1&&q.is_creator!=1?(l(),p("a",{key:0,onClick:N=>d(q)},"移除",8,hr)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),t(no,{onOk:f,ref_key:"addCollaboratorRef",ref:b},null,512)]),_:1})}}},kr=J(yr,[["__scopeId","data-v-3b4cded6"]]),gr={class:"actions-box"},xr={key:0,class:"library-list"},$r=["onClick"],wr={class:"library-name"},qr={class:"library-intro"},Sr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(D){const m=S(!1),{robotInfo:x,getRobot:_}=W("robotInfo"),r=D,s=F({work_flow_ids:[]}),n=S(null),f=oe(()=>r.robotList.filter(c=>s.work_flow_ids.includes(c.id))),b=c=>{let o=s.work_flow_ids.indexOf(c.id);s.work_flow_ids.splice(o,1),d()},a=c=>{s.work_flow_ids=[...c],d()},$=()=>{n.value.open([...s.work_flow_ids])},d=()=>{let c={...Z(s)};c.work_flow_ids=c.work_flow_ids.join(","),Jt({id:x.id,...c}).then(o=>{Y.success("保存成功"),_(x.id)})};return qe(()=>{s.work_flow_ids=x.work_flow_ids.split(",")}),(c,o)=>{const u=se,y=le,L=ge;return l(),M(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:m.value,"onUpdate:isEdit":o[0]||(o[0]=h=>m.value=h),bodyStyle:{padding:0}},{tip:i(()=>[t(u,{placement:"top"},{title:i(()=>o[1]||(o[1]=[e("span",null,"支持关联工作流",-1)])),default:i(()=>[t(g(ee))]),_:1})]),extra:i(()=>[e("div",gr,[t(L,{gap:8},{default:i(()=>[t(y,{size:"small",onClick:$},{default:i(()=>o[2]||(o[2]=[C("添加技能")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[f.value.length>0?(l(),p("div",xr,[(l(!0),p(T,null,H(f.value,h=>(l(),p("div",{class:"library-item",key:h.id},[e("span",{class:"close-btn",onClick:I=>b(h)},[t(g(fe))],8,$r),e("div",wr,U(h.robot_name),1),e("div",qr,U(h.robot_intro),1)]))),128))])):R("",!0),t(lo,{ref_key:"robotSelectAlertRef",ref:n,onChange:a},null,512)]),_:1},8,["isEdit"])}}},Cr=J(Sr,[["__scopeId","data-v-13cb67dc"]]),Lr={class:"robot-info-box"},Ir={class:"set-block"},Ur={__name:"chat-cache",setup(D){const{robotInfo:m,updateRobotInfo:x}=W("robotInfo"),_=F({valid_time:"",cache_switch:0}),r=F({unix:"h",hValue:24,mValue:1440}),s=()=>{r.unix==="h"?_.valid_time=r.hValue*3600:_.valid_time=r.mValue*60,x({cache_config:{..._}})},n=()=>{s()},f=()=>{r.unix=="h"?r.hValue=parseInt(r.mValue/60):r.mValue=parseInt(r.hValue*60)};return _e(()=>m.cache_config,()=>{let b=m.cache_config||{};b=JSON.parse(JSON.stringify(b)),m.cache_config,_.cache_switch=b.cache_switch,_.valid_time=b.valid_time,b.valid_time%3600==0?(r.unix="h",r.hValue=b.valid_time/3600):(r.unix="m",r.mValue=parseInt(b.valid_time/60)||1440)},{immediate:!0,deep:!0}),qe(()=>{}),(b,a)=>{const $=Se,d=Me,c=je,o=Bt,u=ne;return l(),M(X,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:i(()=>a[4]||(a[4]=[e("span",null,null,-1)])),default:i(()=>[e("div",Lr,[a[7]||(a[7]=C(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ")),e("div",Ir,[t(o,{compact:""},{default:i(()=>[r.unix=="h"?(l(),M($,{key:0,onBlur:s,precision:0,value:r.hValue,"onUpdate:value":a[0]||(a[0]=y=>r.hValue=y),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(l(),M($,{key:1,onBlur:s,precision:0,value:r.mValue,"onUpdate:value":a[1]||(a[1]=y=>r.mValue=y),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),t(c,{value:r.unix,"onUpdate:value":a[2]||(a[2]=y=>r.unix=y),style:{width:"70px"},onChange:f},{default:i(()=>[t(d,{value:"h"},{default:i(()=>a[5]||(a[5]=[C("小时")])),_:1,__:[5]}),t(d,{value:"m"},{default:i(()=>a[6]||(a[6]=[C("分钟")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})])]),t(u,{onChange:n,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:_.cache_switch,"onUpdate:checked":a[3]||(a[3]=y=>_.cache_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Rr=J(Ur,[["__scopeId","data-v-e6c2742e"]]),Er={key:0,class:"robot-config-page"},Or={class:"setting-box"},Ar={class:"setting-box"},jr={class:"setting-box"},Mr={class:"setting-box"},Vr={class:"setting-box"},zr={class:"setting-box"},Dr={class:"setting-box"},Nr={class:"setting-box"},Pr={class:"setting-box"},Br={class:"setting-box"},Tr={class:"setting-box"},Fr={class:"setting-box"},Jr={class:"setting-box"},Qr={class:"setting-box"},Gr={class:"setting-box"},Kr={key:1,class:"robot-config-page"},Hr={key:2,class:"robot-config-page"},Fe="/robot/config/basic-config/activeKey",Wr={__name:"index",setup(D){const m=ot(),x=S(null),{robotInfo:_}=mt(m),{getRobot:r}=m,s=()=>{x.value.scrollTop=x.value.scrollHeight},n=S(+localStorage.getItem(Fe)||1),f=S(!1),b=F(_.value),a=u=>{let y=JSON.parse(JSON.stringify(u));u.robot_avatar&&(y.robot_avatar=new File([u.robot_avatar],u.robot_avatar.name)),Object.assign(b,y),c()},$=S([]);(()=>{Qt({application_type:1}).then(u=>{$.value=u.data||[]})})(),vt("robotInfo",{robotInfo:b,updateRobotInfo:a,scrollBoxToBottom:s,getRobot:r});const c=()=>{let u;b.robot_avatar&&(u=new File([b.robot_avatar],b.robot_avatar.name));let y=JSON.parse(JSON.stringify(Z(b)));u&&(y.robot_avatar=u);let L=y.welcomes;L.question=L.question.map(I=>I.content),y.welcomes=JSON.stringify(L),y.prompt_struct=JSON.stringify(y.prompt_struct);let h=y.unknown_question_prompt;h.question=h.question.map(I=>I.content),y.unknown_question_prompt=JSON.stringify(h),y.cache_config=JSON.stringify(y.cache_config),delete y.robot_avatar_url,f.value=!0,Gt(y).then(I=>{if(I.res!=0)return Y.error(I.msg);f.value=!1,Y.success("保存成功"),r(b.id)}).catch(()=>{f.value=!1})},o=()=>{localStorage.setItem(Fe,n.value)};return(u,y)=>{const L=Ze,h=Ye;return l(),p(T,null,[t(h,{class:"tab-wrapper",onChange:o,activeKey:n.value,"onUpdate:activeKey":y[0]||(y[0]=I=>n.value=I)},{default:i(()=>[(l(),M(L,{key:1,tab:"基础配置"})),R("",!0),(l(),M(L,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),n.value==1?(l(),p("div",Er,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:x},[e("div",Or,[t(Uo)]),e("div",Ar,[t(Yl)]),e("div",jr,[t(Gn)]),e("div",Mr,[t(va)]),e("div",Vr,[t(Rr)]),e("div",zr,[t(dn,{robotList:$.value},null,8,["robotList"])]),e("div",Dr,[t(Cr,{robotList:$.value},null,8,["robotList"])]),e("div",Nr,[t(ui)]),e("div",Pr,[t($i)]),e("div",Br,[t(Ai)]),e("div",Tr,[t(Gi)]),e("div",Fr,[t(Pi)]),e("div",Jr,[t(Ji)]),e("div",Qr,[t(Ta)]),e("div",Gr,[t(Ja)])],512)])):R("",!0),n.value==2?(l(),p("div",Kr,[t(Ba)])):R("",!0),n.value==3?(l(),p("div",Hr,[t(kr)])):R("",!0)],64)}}},kd=J(Wr,[["__scopeId","data-v-400b4aaf"]]);export{kd as default};
