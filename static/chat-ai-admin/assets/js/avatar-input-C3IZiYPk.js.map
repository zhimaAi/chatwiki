{"version":3,"file":"avatar-input-C3IZiYPk.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/public-library/add/components/avatar-input.vue"],"sourcesContent":["<template>\r\n  <div class=\"avatar-uploader\">\r\n    <img class=\"avatar\" v-if=\"value\" :src=\"value\" alt=\"avatar\" />\r\n    <a-upload\r\n      class=\"upload-upload\"\r\n      v-model:file-list=\"fileList\"\r\n      list-type=\"picture-card\"\r\n      :show-upload-list=\"false\"\r\n      :before-upload=\"beforeUpload\"\r\n      accept=\".jpg,.png,.jpeg\"\r\n      @preview=\"handlePreview\"\r\n    >\r\n      <div>\r\n        <loading-outlined v-if=\"loading\"></loading-outlined>\r\n        <plus-outlined v-else></plus-outlined>\r\n        <div class=\"ant-upload-text\">{{ t('btn_upload_photo') }}</div>\r\n      </div>\r\n    </a-upload>\r\n\r\n    <a-modal :open=\"previewVisible\" :title=\"previewTitle\" :footer=\"null\" @cancel=\"handleCancel\">\r\n      <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\" />\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch } from 'vue'\r\nimport { message, Form } from 'ant-design-vue'\r\nimport { LoadingOutlined, PlusOutlined } from '@ant-design/icons-vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.public-library.add.components.avatar-input')\r\n\r\nfunction getBase64(file) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n    reader.readAsDataURL(file)\r\n    reader.onload = () => resolve(reader.result)\r\n    reader.onerror = (error) => reject(error)\r\n  })\r\n}\r\n\r\nconst emit = defineEmits(['update:value', 'change'])\r\nconst props = defineProps({\r\n  value: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst fileList = ref([])\r\nconst loading = ref(false)\r\nconst imageUrl = ref('')\r\n\r\nwatch(\r\n  () => props.value,\r\n  (val) => {\r\n    imageUrl.value = val\r\n  },\r\n  {\r\n    immediate: true\r\n  }\r\n)\r\n\r\nconst formItemContext = Form.useInjectFormItemContext()\r\n\r\nconst triggerChange = () => {\r\n  let data = {\r\n    imageUrl: imageUrl.value,\r\n    file: fileList.value[0].originFileObj\r\n  }\r\n\r\n  emit('change', data)\r\n  emit('update:value', data.imageUrl)\r\n\r\n  formItemContext.onFieldChange()\r\n}\r\n\r\nconst beforeUpload = (file) => {\r\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'\r\n\r\n  if (!isJpgOrPng) {\r\n    message.error(t('msg_format_error'))\r\n    return false\r\n  }\r\n\r\n  const isLt2M = file.size / 1024 < 100\r\n\r\n  if (!isLt2M) {\r\n    message.error(t('msg_size_error'))\r\n    return false\r\n  }\r\n\r\n  fileList.value = [file]\r\n\r\n  getBase64(file).then((base64Url) => {\r\n    imageUrl.value = base64Url\r\n    loading.value = false\r\n\r\n    triggerChange()\r\n  })\r\n\r\n  return false\r\n}\r\n\r\nconst previewVisible = ref(false)\r\nconst previewImage = ref('')\r\nconst previewTitle = ref('')\r\n\r\nconst handleCancel = () => {\r\n  previewVisible.value = false\r\n  previewTitle.value = ''\r\n}\r\nconst handlePreview = async (file) => {\r\n  if (!file.url && !file.preview) {\r\n    file.preview = await getBase64(file.originFileObj)\r\n  }\r\n  previewImage.value = file.url || file.preview\r\n  previewVisible.value = true\r\n  previewTitle.value = file.name || file.url.substring(file.url.lastIndexOf('/') + 1)\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.avatar-uploader::v-deep(.ant-upload) {\r\n  margin: 0 !important;\r\n}\r\n\r\n.ant-upload-select-picture-card i {\r\n  font-size: 32px;\r\n  color: #999;\r\n}\r\n\r\n.ant-upload-select-picture-card .ant-upload-text {\r\n  margin-top: 8px;\r\n  color: #666;\r\n}\r\n\r\n.avatar-uploader {\r\n  display: flex;\r\n}\r\n\r\n.avatar-uploader .avatar {\r\n  margin-right: 5px;\r\n  padding: 9px;\r\n  border: 1px solid #D9D9D9;\r\n  border-radius: 7px;\r\n  width: 102px;\r\n  height: 102px;\r\n}\r\n</style>\r\n"],"names":["t","useI18n","getBase64","file","resolve","reject","reader","error","emit","__emit","props","__props","fileList","ref","loading","imageUrl","watch","val","formItemContext","Form","triggerChange","data","beforeUpload","base64Url","message","previewVisible","previewImage","previewTitle","handleCancel","handlePreview","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_a_upload","$event","_createElementVNode","_createBlock","_unref","LoadingOutlined","PlusOutlined","_hoisted_3","_toDisplayString","_component_a_modal"],"mappings":"+dA+BA,KAAM,CAAE,EAAAA,CAAC,EAAKC,EAAQ,kDAAkD,EAExE,SAASC,EAAUC,EAAM,CACvB,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMC,EAAS,IAAI,WACnBA,EAAO,cAAcH,CAAI,EACzBG,EAAO,OAAS,IAAMF,EAAQE,EAAO,MAAM,EAC3CA,EAAO,QAAWC,GAAUF,EAAOE,CAAK,CAC1C,CAAC,CACH,CAEA,MAAMC,EAAOC,EACPC,EAAQC,EAORC,EAAWC,EAAI,EAAE,EACjBC,EAAUD,EAAI,EAAK,EACnBE,EAAWF,EAAI,EAAE,EAEvBG,EACE,IAAMN,EAAM,MACXO,GAAQ,CACPF,EAAS,MAAQE,CACnB,EACA,CACE,UAAW,EACf,CACA,EAEA,MAAMC,EAAkBC,EAAK,yBAAwB,EAE/CC,EAAgB,IAAM,CAC1B,IAAIC,EAAO,CACT,SAAUN,EAAS,MACnB,KAAMH,EAAS,MAAM,CAAC,EAAE,aAC5B,EAEEJ,EAAK,SAAUa,CAAI,EACnBb,EAAK,eAAgBa,EAAK,QAAQ,EAElCH,EAAgB,cAAa,CAC/B,EAEMI,EAAgBnB,GACDA,EAAK,OAAS,cAAgBA,EAAK,OAAS,YAOhDA,EAAK,KAAO,KAAO,KAOlCS,EAAS,MAAQ,CAACT,CAAI,EAEtBD,EAAUC,CAAI,EAAE,KAAMoB,GAAc,CAClCR,EAAS,MAAQQ,EACjBT,EAAQ,MAAQ,GAEhBM,EAAa,CACf,CAAC,EAEM,KAbLI,EAAQ,MAAMxB,EAAE,gBAAgB,CAAC,EAC1B,KARPwB,EAAQ,MAAMxB,EAAE,kBAAkB,CAAC,EAC5B,IAsBLyB,EAAiBZ,EAAI,EAAK,EAC1Ba,EAAeb,EAAI,EAAE,EACrBc,EAAed,EAAI,EAAE,EAErBe,EAAe,IAAM,CACzBH,EAAe,MAAQ,GACvBE,EAAa,MAAQ,EACvB,EACME,EAAgB,MAAO1B,GAAS,CAChC,CAACA,EAAK,KAAO,CAACA,EAAK,UACrBA,EAAK,QAAU,MAAMD,EAAUC,EAAK,aAAa,GAEnDuB,EAAa,MAAQvB,EAAK,KAAOA,EAAK,QACtCsB,EAAe,MAAQ,GACvBE,EAAa,MAAQxB,EAAK,MAAQA,EAAK,IAAI,UAAUA,EAAK,IAAI,YAAY,GAAG,EAAI,CAAC,CACpF,8BAvHE,OAAA2B,EAAA,EAAAC,EAqBM,MArBNC,EAqBM,CApBsBrB,EAAA,WAA1BoB,EAA6D,MAAA,OAAxD,MAAM,SAAuB,IAAKpB,EAAA,MAAO,IAAI,8BAClDsB,EAcWC,EAAA,CAbT,MAAM,gBACE,YAAWtB,EAAA,yCAAAA,EAAQ,MAAAuB,GAC3B,YAAU,eACT,mBAAkB,GAClB,gBAAeb,EAChB,OAAO,kBACN,UAASO,cAEV,IAIM,CAJNO,EAIM,MAAA,KAAA,CAHoBtB,EAAA,WAAxBuB,EAAoDC,EAAAC,CAAA,EAAA,CAAA,IAAA,EAAA,QACpDF,EAAsCC,EAAAE,CAAA,EAAA,CAAA,IAAA,CAAA,CAAA,GACtCJ,EAA8D,MAA9DK,EAA8DC,EAA9BJ,EAAAtC,CAAA,EAAC,kBAAA,CAAA,EAAA,CAAA,4BAIrCiC,EAEUU,EAAA,CAFA,KAAMlB,EAAA,MAAiB,MAAOE,EAAA,MAAe,OAAQ,KAAO,SAAQC,cAC5E,IAA6D,CAA7DQ,EAA6D,MAAA,CAAxD,IAAI,UAAU,MAAA,CAAA,MAAA,MAAA,EAAqB,IAAKV,EAAA"}