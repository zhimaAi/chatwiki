import{w as H}from"./index-BuDcjXHQ.js";import{u as P,a5 as E,j as K}from"../../index-DSFcP5NQ.js";import{ah as j,r as b,c as G,E as B,e as S,b as m,t as r,p as t,y as a,a as k,q as C,v as g,u as o,_ as y,F,l as W,h as A,ap as N,j as Q}from"./vue-chunks-BdaA73Wf.js";import{d as z}from"./utils-CvB22N-W.js";import{eC as X}from"./util-DTYBDRN2.js";import{_ as J}from"./emoji-mart-BBMRoEa3.js";import{c as Z,I as L,J as ee,an as te,F as oe,ad as se,aO as ae,aJ as ne,aH as O,M as le,b as ie,P as de,x as _e,W as U}from"./ui-antd-Dl1wwwCD.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";import"./thirdMcp-CLnTK-fz.js";import"./index-BuURB1pl.js";const ue={class:"flex-content-box"},re={class:"test-model-box"},ce={class:"top-title"},pe={key:0,class:"result-list-box"},ve=["onClick"],me={class:"status-block"},ge={class:"icon-name-box"},he=["src"],fe={class:"node-name"},ke={key:0,class:"time-tag"},ye={class:"right-active-icon"},be={class:"preview-box"},xe={class:"preview-title"},we={class:"title-text"},Ce={class:"icon-name-box"},qe=["src"],De={class:"node-name"},Ye={key:0,class:"time-tag"},Me={class:"preview-content-block"},$e={class:"title-block"},Ie={class:"preview-code-box"},Se={class:"preview-content-block"},Ne={class:"title-block"},ze={class:"preview-code-box"},Oe={class:"preview-content-block"},Re={class:"title-block"},Fe={class:"preview-code-box"},Ue={__name:"logs-detail",emits:["save","getGlobal"],setup(T,{expose:_,emit:R}){const{t:u}=P("views.robot.robot-config.invoke-logs.components.logs-detail"),q=j().query,c=b(!1),h=b(""),s=b([]),v=G(()=>h.value?s.value.filter(d=>d.node_key==h.value)[0]:null),p=B({robot_key:q.robot_key,question:"",openid:""}),$=d=>{p.question=d.question||"",p.openid=d.openid||"",s.value=[],h.value="",D(d.node_logs),c.value=!0},D=d=>{var e;s.value=d.map(l=>({...l,is_success:l.error_msg==="<nil>",node_icon:X(l.node_type)})),h.value=(e=s.value[0])==null?void 0:e.node_key},Y=d=>{h.value=d.node_key},x=d=>{E(JSON.stringify(v.value[d])),ie.success(u("msg_copy_success"))};return _({show:$}),(d,e)=>{const l=te,i=ee,w=L,M=Z,f=oe,I=le;return m(),S(I,{open:c.value,"onUpdate:open":e[5]||(e[5]=n=>c.value=n),title:o(u)("title_log_detail"),footer:null,width:880,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:r(()=>[t("div",ue,[t("div",re,[t("div",ce,g(o(u)("label_start_node_params")),1),a(f,{model:p,ref:"formRef",layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:r(()=>[a(M,{name:"question",rules:[{required:!0,message:o(u)("msg_input_question")}]},{label:r(()=>[a(i,{gap:4},{default:r(()=>[e[7]||(e[7]=y("question ",-1)),a(l,{style:{margin:"0"}},{default:r(()=>[...e[6]||(e[6]=[y("string",-1)])]),_:1})]),_:1})]),default:r(()=>[a(w,{readonly:"",placeholder:o(u)("ph_input"),value:p.question,"onUpdate:value":e[0]||(e[0]=n=>p.question=n)},null,8,["placeholder","value"])]),_:1},8,["rules"]),a(M,{name:"openid",rules:[{required:!0,message:o(u)("msg_input_openid")}]},{label:r(()=>[a(i,{gap:4},{default:r(()=>[e[9]||(e[9]=y("openid ",-1)),a(l,{style:{margin:"0"}},{default:r(()=>[...e[8]||(e[8]=[y("string",-1)])]),_:1})]),_:1})]),default:r(()=>[a(w,{readonly:"",placeholder:o(u)("ph_input"),value:p.openid,"onUpdate:value":e[1]||(e[1]=n=>p.openid=n)},null,8,["placeholder","value"])]),_:1},8,["rules"])]),_:1},8,["model"]),s.value.length>0?(m(),k("div",pe,[(m(!0),k(F,null,W(s.value,(n,V)=>(m(),k("div",{class:A(["list-item-block",{active:h.value==n.node_key}]),onClick:Ee=>Y(n),key:V},[t("div",me,[n.is_success?(m(),S(o(se),{key:0,style:{color:"#138b1b"}})):(m(),S(o(ae),{key:1,style:{color:"#d81e06"}}))]),t("div",ge,[t("img",{src:n.node_icon,alt:""},null,8,he),t("div",fe,g(n.node_name),1)]),n.is_success?(m(),k("div",ke,g(n.use_time)+"ms",1)):C("",!0),t("div",ye,[a(o(ne))])],10,ve))),128))])):C("",!0)]),t("div",be,[v.value?(m(),k(F,{key:0},[t("div",xe,[t("div",we,g(o(u)("title_log_detail")),1),t("div",Ce,[t("img",{src:v.value.node_icon,alt:""},null,8,qe),t("div",De,g(v.value.node_name),1)]),v.value.is_success?(m(),k("div",Ye,g(v.value.use_time)+"ms",1)):C("",!0)]),t("div",Me,[t("div",$e,[y(g(o(u)("label_input")),1),a(o(O),{onClick:e[2]||(e[2]=n=>x("input"))})]),t("div",Ie,[a(o(N),{data:v.value.input},null,8,["data"])])]),t("div",Se,[t("div",Ne,[y(g(o(u)("label_output")),1),a(o(O),{onClick:e[3]||(e[3]=n=>x("node_output"))})]),t("div",ze,[a(o(N),{data:v.value.node_output},null,8,["data"])])]),t("div",Oe,[t("div",Re,[y(g(o(u)("label_run_log")),1),a(o(O),{onClick:e[4]||(e[4]=n=>x("output"))})]),t("div",Fe,[a(o(N),{data:v.value.output},null,8,["data"])])])],64)):C("",!0)])])]),_:1},8,["open","title"])}}},Pe=J(Ue,[["__scopeId","data-v-4ddd6a99"]]),je={class:"user-model-page"},Be={class:"page-title"},Je={class:"list-wrapper"},Le={class:"content-wrapper"},Te={class:"search-block"},Ve=["onClick"],He={__name:"index",setup(T){const{t:_}=P("views.robot.robot-config.invoke-logs.index"),R=j().query,u=K(),q=b([]),c=b([z().subtract(6,"day"),z()]),h=b(!1),s=B({robot_id:R.id,page:1,size:20,total:0,openid:"",question:"",start_date:c.value[0].format("YYYY-MM-DD"),end_date:c.value[1].format("YYYY-MM-DD")}),v=e=>{s.page=e.current,s.size=e.pageSize,D()},p=()=>{s.page=1,D()},$=e=>{s.start_date="",s.end_date="",c.value&&c.value.length>0&&(s.start_date=c.value[0].format("YYYY-MM-DD"),s.end_date=c.value[1].format("YYYY-MM-DD")),p()},D=()=>{h.value=!0,H({...s}).then(e=>{let l=e.data.list||[];q.value=l.map(i=>(i.duration_mills_desc=`${i.duration_mills}ms`,i.total_token_desc=`${(i.total_token/1e3).toFixed(3)}`,i.create_time_desc=z(i.create_time*1e3).format("YYYY-MM-DD HH:mm:ss"),i.node_logs=i.node_logs?JSON.parse(i.node_logs):[],i)),s.total=+e.data.total||0}).finally(()=>{h.value=!1})},Y=b(null),x=e=>{Y.value.show({...e})},d=[{title:_("label_openid"),dataIndex:"openid",key:"openid",width:150},{title:_("label_question"),dataIndex:"question",key:"question",width:250},{title:_("label_workflow_version"),key:"version",dataIndex:"version",width:130},{title:_("label_duration"),key:"duration_mills_desc",dataIndex:"duration_mills_desc",width:130},{title:_("label_token_consumption"),key:"total_token_desc",dataIndex:"total_token_desc",width:130},{title:_("label_invoke_time"),key:"create_time_desc",dataIndex:"create_time_desc",width:150},{title:_("label_action"),key:"action",width:100}];return Q(()=>{p()}),(e,l)=>{const i=de,w=L,M=_e;return m(),k("div",je,[t("div",Be,g(o(_)("title_invoke_logs")),1),t("div",Je,[t("div",Le,[t("div",Te,[a(i,{value:c.value,"onUpdate:value":l[0]||(l[0]=f=>c.value=f),allowClear:!1,onChange:$,style:{width:"256px"},presets:o(u)},null,8,["value","presets"]),a(w,{style:{width:"256px"},value:s.openid,"onUpdate:value":l[1]||(l[1]=f=>s.openid=f),onChange:p,placeholder:o(_)("ph_input_openid")},{suffix:r(()=>[a(o(U))]),_:1},8,["value","placeholder"]),a(w,{style:{width:"256px"},value:s.question,"onUpdate:value":l[2]||(l[2]=f=>s.question=f),onChange:p,placeholder:o(_)("ph_input_question")},{suffix:r(()=>[a(o(U))]),_:1},8,["value","placeholder"])]),a(M,{class:"table-list",columns:d,"data-source":q.value,loading:h.value,sticky:"",pagination:{current:s.page,total:s.total,pageSize:s.size,show_quick_jumper:!0,show_size_changer:!0,pageSizeOptions:["10","20","50","100"]},onChange:v},{bodyCell:r(({column:f,record:I})=>[f.key==="action"?(m(),k("a",{key:0,onClick:n=>x(I)},g(o(_)("btn_view_detail")),9,Ve)):C("",!0)]),_:1},8,["data-source","loading","pagination"])]),a(Pe,{ref_key:"logsDetailRef",ref:Y},null,512)])])}}},it=J(He,[["__scopeId","data-v-6b19d8ec"]]);export{it as default};
//# sourceMappingURL=index-uEw7odJJ.js.map
