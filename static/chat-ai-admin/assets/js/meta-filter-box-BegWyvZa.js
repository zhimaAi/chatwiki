import{_ as st}from"./cu-scroll-D9utH_KS.js";import{_ as X,X as ot,a0 as lt,d as nt,a7 as at}from"../../index-CB2DywzJ.js";import{v as Q,aq as it,B as R,az as ut,al as rt,D as Z,av as ct,br as dt,an as pt,M as J,W as _t,h as vt,i as yt,k as ht,z as ft,y as mt,a8 as kt,O as bt,I as gt,a6 as Ct,b as xt,d as V}from"./ui-antd-BHaxN-GS.js";import{f as j,ac as a,ad as s,k as p,ar as r,as as t,F as g,ax as M,ai as tt,ae as m,az as f,at as u,u as x,G as k,l as $t,K as Ot,e as Y,ak as q,aE as T,af as K,r as Dt,w as W,B as St}from"./vue-chunks-CGLjTDrY.js";const jt={class:"prompt-wrapper"},Bt={class:"group-box"},Ut={class:"group-list-box"},wt=["onClick"],Ht={class:"group-name"},Nt={class:"name-text"},Lt={class:"content-box"},Mt={class:"opration-btn-block"},It={class:"content-scroll-box"},Pt={key:0,class:"loading-box"},zt={class:"prompt-list-box"},Et={class:"prompt-header"},At={class:"prompt-title"},Ft={key:0,class:"prompt-type diy"},Gt={key:1,class:"prompt-type"},Jt={class:"title"},Vt={class:"right-btn-box"},Yt=["onClick"],qt=["onClick"],Tt={class:"prompt-content-box"},Kt={key:0,class:"prompt-content"},Wt=["onClick"],Xt={key:1,class:"structure-list-box"},Qt={class:"structure-list"},Rt={class:"structure-title"},Zt={class:"structure-content"},te={class:"structure-list"},ee={class:"structure-title"},se={class:"structure-content"},oe=["onClick"],le={class:"structure-list"},ne={class:"structure-title"},ae={class:"structure-content"},ie={key:0,class:"structure-list"},ue={class:"structure-title"},re={class:"structure-content"},ce={class:"structure-list"},de={class:"structure-title"},pe={class:"structure-content"},_e={class:"structure-list"},ve={class:"structure-title"},ye={class:"structure-content"},he={class:"structure-title"},fe={class:"structure-content"},me={class:"empty-content"},ke={__name:"index",emits:["ok"],setup(I,{expose:O,emit:B}){const b=j(!1),h=B,$=()=>{b.value=!0,D(),o()},c=y=>{J.confirm({title:"导入确认",icon:$t(_t),content:"确定将该条提示导入",onOk(){h("ok",y),b.value=!1},onCancel(){}})},v=j(-1),U=j([]),D=()=>{ot().then(y=>{U.value=[{id:-1,group_name:"全部"},{id:0,group_name:"默认分组"},...y.data]})},P=y=>{v.value=y.id,o()},w=j([]),H=j(!1),S=j(!1),z=()=>{S.value=!0,o(),D()},o=()=>{H.value=!0,lt({group_id:v.value,page:1,size:9999}).then(y=>{let i=y.data.list||[];i=i.map(C=>({...C,isHide:!0,prompt_struct:C.prompt_struct?JSON.parse(C.prompt_struct):{}})),w.value=i}).finally(()=>{H.value=!1,S.value=!1})},l=y=>{y.isHide=!y.isHide},_=()=>{window.open("#/user/prompt-library")};return O({show:$}),(y,i)=>{const C=Q,N=st,L=R,E=rt,A=pt,F=J;return s(),a("div",null,[p(F,{open:b.value,"onUpdate:open":i[0]||(i[0]=e=>b.value=e),title:null,width:950,footer:null,wrapClassName:"add-prommpt-modal"},{default:r(()=>[t("div",jt,[t("div",Bt,[i[1]||(i[1]=t("div",{class:"main-title"},"导入提示词",-1)),p(N,{style:{height:"480px"}},{default:r(()=>[t("div",Ut,[(s(!0),a(g,null,M(U.value,e=>(s(),a("div",{class:tt(["group-list",{active:e.id==v.value}]),onClick:n=>P(e),key:e.id},[t("div",Ht,[t("div",Nt,u(e.group_name),1),e.group_desc?(s(),m(C,{key:0},{title:r(()=>[k(u(e.group_desc),1)]),default:r(()=>[p(x(it))]),_:2},1024)):f("",!0)])],10,wt))),128))])]),_:1})]),t("div",Lt,[t("div",Mt,[p(L,{loading:S.value,onClick:z},{default:r(()=>[S.value?f("",!0):(s(),m(x(ut),{key:0})),i[2]||(i[2]=k("刷新列表",-1))]),_:1},8,["loading"]),p(L,{onClick:_},{default:r(()=>[...i[3]||(i[3]=[k("管理知识库",-1)])]),_:1})]),t("div",It,[p(N,{style:{padding:"0 24px"}},{default:r(()=>[H.value?(s(),a("div",Pt,[p(E)])):f("",!0),t("div",zt,[(s(!0),a(g,null,M(w.value,e=>(s(),a("div",{class:"prompt-list",key:e.id},[t("div",Et,[t("div",At,[e.prompt_type==0?(s(),a("div",Ft,"自定义")):f("",!0),e.prompt_type==1?(s(),a("div",Gt,"结构化")):f("",!0),t("div",Jt,u(e.title),1)]),t("div",Vt,[p(C,{title:e.isHide?"展开":"收起"},{default:r(()=>[t("div",{class:"hover-btn-box",onClick:n=>l(e)},[e.isHide?(s(),m(x(Z),{key:0})):(s(),m(x(ct),{key:1}))],8,Yt)]),_:2},1032,["title"]),t("div",{class:"hover-btn-box primary",onClick:n=>c(e)},[p(x(dt)),i[4]||(i[4]=k("导入 ",-1))],8,qt)])]),t("div",Tt,[e.prompt_type==0?(s(),a("div",Kt,[e.isHide?(s(),a(g,{key:0},[k(u(e.prompt.slice(0,200))+" ",1),e.prompt.length>200?(s(),a("span",{key:0,onClick:n=>l(e),style:{cursor:"pointer"}},"...",8,Wt)):f("",!0)],64)):(s(),a(g,{key:1},[k(u(e.prompt),1)],64))])):(s(),a("div",Xt,[t("div",Qt,[t("div",Rt,u(e.prompt_struct.role.subject),1),t("div",Zt,u(e.prompt_struct.role.describe),1)]),t("div",te,[t("div",ee,u(e.prompt_struct.task.subject),1),t("div",se,[k(u(e.prompt_struct.task.describe)+" ",1),e.isHide?(s(),a("span",{key:0,onClick:n=>l(e),style:{cursor:"pointer"}},"...",8,oe)):f("",!0)])]),e.isHide?f("",!0):(s(),a(g,{key:0},[t("div",le,[t("div",ne,u(e.prompt_struct.constraints.subject),1),t("div",ae,u(e.prompt_struct.constraints.describe),1)]),e.prompt_struct.skill?(s(),a("div",ie,[t("div",ue,u(e.prompt_struct.skill.subject),1),t("div",re,u(e.prompt_struct.skill.describe),1)])):f("",!0),t("div",ce,[t("div",de,u(e.prompt_struct.output.subject),1),t("div",pe,u(e.prompt_struct.output.describe),1)]),t("div",_e,[t("div",ve,u(e.prompt_struct.tone.subject),1),t("div",ye,u(e.prompt_struct.tone.describe),1)]),(s(!0),a(g,null,M(e.prompt_struct.custom,n=>(s(),a("div",{class:"structure-list",key:n.subject},[t("div",he,u(n.subject),1),t("div",fe,u(n.describe),1)]))),128))],64))]))])]))),128))]),w.value.length==0?(s(),m(A,{key:1,style:{"padding-top":"100px"}},{description:r(()=>[t("div",me,[i[6]||(i[6]=t("div",{class:"title"},"你还没有添加任何提示词",-1)),i[7]||(i[7]=t("div",{class:"desc"}," 可以在系统设置-提示词库中维护提示词模板，然后再聊天机器人和工作流中引用 ",-1)),t("div",null,[p(L,{type:"primary",onClick:_},{default:r(()=>[...i[5]||(i[5]=[k("立即添加",-1)])]),_:1})])])]),_:1})):f("",!0)]),_:1})])])])]),_:1},8,["open"])])}}},Le=X(ke,[["__scopeId","data-v-1a540f46"]]),Me={__name:"index",props:{disabled:{type:Boolean,default:!1}},setup(I){const O=Ot(),B=Y(()=>{const{disabled:h,...$}=O;return $}),b=Y(()=>{const{title:h,overlayClassName:$,overlayStyle:c,mouseEnterDelay:v,mouseLeaveDelay:U,...D}=O;return D});return(h,$)=>I.disabled?(s(),a("div",T(K({key:1},b.value)),[q(h.$slots,"default")],16)):(s(),m(x(Q),T(K({key:0},B.value)),{default:r(()=>[q(h.$slots,"default")]),_:3},16))}},be={class:"query-condition-filter"},ge={class:"condition-select-box"},Ce={class:"select-wrapper"},xe={class:"field-items"},$e={class:"field-select-box"},Oe={class:"operator-select-box"},De={class:"field-value-box"},Se=["onClick"],je={key:0,class:"add-btn-box"},Be={__name:"meta-filter-box",props:{rule:{type:String},type:{type:Number},metaData:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change","update:rule","update:type"],setup(I,{expose:O,emit:B}){const b=B,h=I,$=[{value:1,label:"是",use_types:[0,1,2]},{value:2,label:"不是",use_types:[0,1,2]},{value:3,label:"内容包含",use_types:[0]},{value:4,label:"内容不包含",use_types:[0]},{value:5,label:"为空",use_types:[0,1,2]},{value:6,label:"不为空",use_types:[0,1,2]},{value:7,label:"大于",use_types:[1,2]},{value:8,label:"等于",use_types:[1,2]},{value:9,label:"小于",use_types:[1,2]},{value:10,label:"大于等于",use_types:[1,2]},{value:11,label:"小于等于",use_types:[1,2]}],c=Dt({list:[],type:1});W(()=>h.rule,()=>{let o=at(h.rule,[]);o.forEach(l=>{l.type==1&&l.value>0&&(l.value=V(l.value*1e3))}),c.list=o},{immediate:!0}),W(()=>h.type,()=>{c.type=h.type},{immediate:!0});const v=()=>{let o={type:c.type,list:c.list},l=JSON.parse(JSON.stringify(c.list));l.forEach(_=>{_.type==1&&_.value&&(_.value=V(_.value).startOf("minute").unix()),_.value=_.value.toString()}),b("update:rule",JSON.stringify(l)),b("update:type",c.type),b("change",o)},U=()=>{let o={key:void 0,type:void 0,op:void 0,value:""};c.list.push(o),v()},D=o=>{c.list.splice(o,1),v()},P=({key:o})=>{c.type=o,v()};function w(o,l,_){o.type=_.type,o.value="",v()}function H(o){[5,6].includes(o.op)&&(o.value=""),v()}function S(o){return $.filter(l=>l.use_types.includes(o))}function z(){try{for(let o of c.list){if(!o.key)throw"请选择过滤元数据";if(!o.op)throw"请选择过滤操作符";if(o.value&&![5,6].includes(o.op)&&!o.value)throw"请选择过滤元数据值"}if(!c.list.length)throw"请完善至少一条过滤规则";return!0}catch(o){return xt.error(o),!1}}return O({verify:z}),(o,l)=>{const _=yt,y=vt,i=ht,C=ft,N=mt,L=kt,E=bt,A=gt,F=nt,e=R;return s(),a("div",{class:tt(["query-condition-filter-warpper",{"is-multiple":c.list.length>1}])},[t("div",be,[l[3]||(l[3]=t("div",{class:"auxiliary-line"},null,-1)),t("div",ge,[t("div",Ce,[p(i,{onClick:P},{overlay:r(()=>[p(y,{style:{width:"100px"}},{default:r(()=>[(s(),m(_,{key:1},{default:r(()=>[...l[1]||(l[1]=[t("a",{href:"javascript:;"},"且",-1)])]),_:1})),(s(),m(_,{key:2},{default:r(()=>[...l[2]||(l[2]=[t("a",{href:"javascript:;"},"或",-1)])]),_:1}))]),_:1})]),default:r(()=>[t("a",{class:"ant-dropdown-link",onClick:l[0]||(l[0]=St(()=>{},["prevent"]))},[k(u(c.type==1?"且":"或")+" ",1),p(x(Z))])]),_:1})])]),t("div",xe,[(s(!0),a(g,null,M(c.list,(n,G)=>(s(),a("div",{class:"field-item",key:G},[t("div",$e,[p(N,{value:n.key,"onUpdate:value":d=>n.key=d,placeholder:"请选择",style:{width:"200px"},onChange:(d,et)=>w(n,d,et)},{default:r(()=>[(s(!0),a(g,null,M(h.metaData,d=>(s(),m(C,{value:d.key,key:d.key,type:d.type},{default:r(()=>[k(u(d.name),1)]),_:2},1032,["value","type"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),t("div",Oe,[p(N,{value:n.op,"onUpdate:value":d=>n.op=d,style:{width:"120px"},placeholder:"请选择",options:S(n.type),onChange:d=>H(n)},null,8,["value","onUpdate:value","options","onChange"])]),t("div",De,[[5,6].includes(n.op)?f("",!0):(s(),a(g,{key:0},[n.type==1?(s(),m(L,{key:0,value:n.value,"onUpdate:value":d=>n.value=d,onChange:v,format:"YYYY-MM-DD HH:mm",style:{width:"100%"}},null,8,["value","onUpdate:value"])):n.type==2?(s(),m(E,{key:1,value:n.value,"onUpdate:value":d=>n.value=d,placeholder:"请输入",onBlur:v,style:{width:"100%"}},null,8,["value","onUpdate:value"])):(s(),m(A,{key:2,value:n.value,"onUpdate:value":d=>n.value=d,valueModifiers:{trim:!0},placeholder:"请输入",maxlength:20,onBlur:v,style:{width:"100%"}},null,8,["value","onUpdate:value"]))],64))]),t("span",{class:"field-del-btn",onClick:d=>D(G)},[p(F,{class:"del-icon",name:"close-circle"})],8,Se)]))),128))])]),c.list.length<10?(s(),a("div",je,[p(e,{class:"add-btn",type:"dashed",block:"",onClick:U},{default:r(()=>[p(x(Ct)),l[4]||(l[4]=k(" 添加条件 ",-1))]),_:1})])):f("",!0)],2)}}},Ie=X(Be,[["__scopeId","data-v-0ef47d0b"]]);export{Ie as M,Le as _,Me as a};
