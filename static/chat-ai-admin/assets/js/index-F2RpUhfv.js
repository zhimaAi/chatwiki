import{G as U,E as q,T as Q,M as N,d as G,R as z,X as et,H as at,y as nt,z as ot}from"./ui-antd-BHaxN-GS.js";import{co as lt,cp as st,_ as O,cq as it,j as dt,A as _t,cr as ut,cs as rt,ct,cu as pt,cv as mt}from"../../index-CB2DywzJ.js";import{P as vt}from"./page-tabs-B6pKMLdc.js";import{f as c,ac as x,ad as v,k as o,ar as i,G as p,at as r,as as s,av as yt,r as T,ae as R,o as gt,u as Y,az as L,F as ft,ax as bt}from"./vue-chunks-CGLjTDrY.js";import{a1 as ht}from"./index-CoChppVN.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";const kt={__name:"detail-modal",setup(B,{expose:C}){const f=c(!1),y=c(!1),b=c([]),h=(l,t)=>{f.value=!0,y.value=!0,t==1?m(l):u(l)},m=l=>{lt({begin_date_ymd:l.begin_date_ymd,end_date_ymd:l.end_date_ymd,library_id:l.library_id,data_id:l.data_id}).then(t=>{b.value=t.data||[]}).finally(()=>{y.value=!1})},u=l=>{st({begin_date_ymd:l.begin_date_ymd,end_date_ymd:l.end_date_ymd,library_id:l.library_id,group_id:l.group_id}).then(t=>{b.value=t.data||[]}).finally(()=>{y.value=!1})};return C({show:h}),(l,t)=>{const a=q,M=Q,k=U,g=N;return v(),x("div",null,[o(g,{open:f.value,"onUpdate:open":t[0]||(t[0]=_=>f.value=_),title:"机器人分布详情",width:624,footer:null},{default:i(()=>[o(k,{"data-source":b.value,loading:y.value,pagination:!1,scroll:{y:500}},{default:i(()=>[o(a,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:_})=>[p(r(_+1),1)]),_:1}),o(a,{key:"robot_name",title:"机器人",width:140},{default:i(({record:_})=>[p(r(_.robot_name),1)]),_:1}),o(a,{key:"tip",title:"触发次数",width:120},{default:i(({record:_})=>[o(M,{gap:12},{default:i(()=>[s("span",null,r(_.tip),1)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading"])]),_:1},8,["open"])])}}},wt={class:"unknow-list-box"},xt=["onClick"],Dt={__name:"unknow-question-modal",setup(B,{expose:C}){yt();const f=c(!1),y=c(!1),b=c([]),h=T({begin_date_ymd:"",end_date_ymd:""}),m=l=>{f.value=!0,y.value=!0,h.begin_date_ymd=l.begin_date_ymd,h.end_date_ymd=l.end_date_ymd,it(l).then(t=>{b.value=t.data||[]}).finally(()=>{y.value=!1})},u=l=>{ht({id:l.robot_id}).then(t=>{let a=`id=${l.robot_id}&robot_key=${t.data.robot_key}&start_date=${h.begin_date_ymd}&end_date=${h.end_date_ymd}`;window.open(`/#/robot/config/unknown_issue?${a}`)})};return C({show:m}),(l,t)=>{const a=q,M=Q,k=U,g=N;return v(),R(g,{open:f.value,"onUpdate:open":t[0]||(t[0]=_=>f.value=_),title:"未知问题机器人分布详情",width:700,footer:null},{default:i(()=>[s("div",wt,[o(k,{"data-source":b.value,loading:y.value,pagination:!1,scroll:{y:500}},{default:i(()=>[o(a,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:_})=>[p(r(_+1),1)]),_:1}),o(a,{key:"robot_name",title:"机器人",width:200},{default:i(({record:_})=>[p(r(_.robot_name),1)]),_:1}),o(a,{key:"unknow_count",title:"未知问题数量",width:150},{default:i(({record:_})=>[o(M,{gap:12},{default:i(()=>[s("span",null,r(_.unknow_question_total),1)]),_:2},1024)]),_:1}),o(a,{key:"action",title:"操作",width:120},{default:i(({record:_})=>[s("a",{onClick:$=>u(_)},"查看明细",8,xt)]),_:1})]),_:1},8,["data-source","loading"])])]),_:1},8,["open"])}}},Ct=O(Dt,[["__scopeId","data-v-d9a85bea"]]),Mt={class:"library-page"},Yt={class:"statics-block"},Lt={class:"statics-item"},Rt={class:"num"},St={class:"title"},zt={class:"num"},$t={class:"search-box"},Tt={class:"tab-box"},Ut={class:"library-page-body"},qt={class:"list-box"},Qt={key:0},Bt={key:1,class:"qa-list-box"},Pt={class:"list-item"},Vt={class:"list-content"},Gt={class:"list-item",style:{color:"#8c8c8c"}},Nt={class:"list-content"},Ot={key:0},Ft={key:0},It=["onClick"],jt={__name:"index",setup(B){const C=dt(),f=c([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),y=c(0),b=c(0),h=c(null),m=c([G().startOf("month"),G()]),u=c(1),l=c([]),t=T({begin_date_ymd:m.value[0].format("YYYYMMDD"),end_date_ymd:m.value[1].format("YYYYMMDD"),library_id:void 0}),a=T({page:1,size:100,total:0}),M=[{label:"按内容",value:1},{label:"按知识库分组",value:3},{label:"按知识库",value:2}],k=c([]),g=c(!1),_=()=>{g.value=!0,ct({...t,...a}).then(d=>{let e=d.data.list||[];e=e.map(w=>({...w})),k.value=e,a.total=+d.data.total}).finally(()=>{g.value=!1})},$=()=>{g.value=!0,pt({...t,...a}).then(d=>{let e=d.data.list||[];e=e.map(w=>({...w})),k.value=e,a.total=+d.data.total}).finally(()=>{g.value=!1})},P=()=>{g.value=!0,mt({...t,...a}).then(d=>{let e=d.data.list||[];e=e.map(w=>({...w})),k.value=e,a.total=+d.data.total}).finally(()=>{g.value=!1})},F=()=>{a.total=0,u.value==1?a.size=100:a.size=20,S()},I=d=>{a.page=d.current,a.size=d.pageSize,u.value==1&&_(),u.value==2&&$(),u.value==3&&P()},S=()=>{a.page=1,u.value==1&&_(),u.value==2&&$(),u.value==3&&P()},j=()=>{t.begin_date_ymd="",t.end_date_ymd="",m.value&&m.value.length>0&&(t.begin_date_ymd=m.value[0].format("YYYYMMDD"),t.end_date_ymd=m.value[1].format("YYYYMMDD")),S()},V=c(null),A=d=>{V.value.show({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:d.library_id,data_id:d.data_id,group_id:d.group_id},u.value)},E=()=>{ut().then(d=>{y.value=d.data.tip_total})},H=()=>{rt({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd}).then(d=>{b.value=d.data.unknow_question_total})},J=()=>{h.value.show({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd})};return gt(()=>{S(),E(),H(),_t().then(d=>{l.value=d.data})}),(d,e)=>{const w=et,X=at,K=ot,W=nt,D=q,Z=Q,tt=U;return v(),x("div",Mt,[o(vt,{class:"mb-16",tabs:f.value,active:"/trigger-statics/list"},null,8,["tabs"]),s("div",Yt,[s("div",Lt,[e[3]||(e[3]=s("div",{class:"title"},"合计触发次数",-1)),s("div",Rt,r(y.value),1)]),s("div",{class:"statics-item unknown-item cursor-pointer",onClick:J},[s("a",St,[e[4]||(e[4]=p("未知问题合计数量 ",-1)),o(Y(z))]),s("div",zt,r(b.value),1)])]),s("div",$t,[o(w,{value:m.value,"onUpdate:value":e[0]||(e[0]=n=>m.value=n),allowClear:!1,onChange:j,style:{width:"256px"},presets:Y(C)},null,8,["value","presets"])]),s("div",Tt,[e[5]||(e[5]=s("div",{class:"main-title"},"触发次数排行榜",-1)),o(X,{onChange:F,value:u.value,"onUpdate:value":e[1]||(e[1]=n=>u.value=n),options:M},null,8,["value"]),u.value==1||u.value==3?(v(),R(W,{key:0,placeholder:"全部知识库",allowClear:"",onChange:S,value:t.library_id,"onUpdate:value":e[2]||(e[2]=n=>t.library_id=n),style:{width:"220px"}},{default:i(()=>[(v(!0),x(ft,null,bt(l.value,n=>(v(),R(K,{value:n.id},{default:i(()=>[p(r(n.library_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])):L("",!0)]),s("div",Ut,[s("div",qt,[o(tt,{"data-source":k.value,sticky:"",loading:g.value,pagination:{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:I,scroll:{x:800}},{default:i(()=>[o(D,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:n})=>[p(r(n+(a.page-1)*a.size+1),1)]),_:1}),u.value==1?(v(),R(D,{key:"content","data-index":"content",title:"知识内容",width:380},{default:i(({record:n})=>[n.content?(v(),x("div",Qt,r(n.content),1)):(v(),x("div",Bt,[s("div",Pt,[e[6]||(e[6]=s("div",{class:"list-label"},"问题",-1)),s("div",Vt,r(n.question),1)]),s("div",Gt,[e[7]||(e[7]=s("div",{class:"list-label"},"答案",-1)),s("div",Nt,r(n.answer),1)])]))]),_:1})):L("",!0),u.value==3?(v(),R(D,{key:"group_name",title:"知识库分组",width:120},{default:i(({record:n})=>[p(r(n.group_name),1)]),_:1})):L("",!0),o(D,{key:"library_name",title:"所属知识库",width:140},{default:i(({record:n})=>[p(r(n.library_name)+" ",1),u.value==1?(v(),x("span",Ot,[o(Y(z)),p(" "+r(n.group_name||"未分组")+" ",1),n.library_file_name?(v(),x("span",Ft,[o(Y(z)),p(" "+r(n.library_file_name),1)])):L("",!0)])):L("",!0)]),_:1}),o(D,{key:"tip",title:"触发次数",width:100},{default:i(({record:n})=>[o(Z,{gap:12},{default:i(()=>[s("span",null,r(n.tip),1),s("a",{onClick:At=>A(n)},[e[8]||(e[8]=p("详情",-1)),o(Y(z))],8,It)]),_:2},1024)]),_:1}),o(D,{key:"percentage",title:"占比",width:100},{default:i(({record:n})=>[p(r(n.percentage)+"% ",1)]),_:1})]),_:1},8,["data-source","loading","pagination"])])]),o(kt,{ref_key:"detailModalRef",ref:V},null,512),o(Ct,{ref_key:"unknowQuestionModalRef",ref:h},null,512)])}}},ee=O(jt,[["__scopeId","data-v-239d4eee"]]);export{ee as default};
