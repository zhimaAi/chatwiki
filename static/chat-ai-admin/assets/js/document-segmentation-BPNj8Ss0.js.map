{"version":3,"file":"document-segmentation-BPNj8Ss0.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/library/document-segmentation/document-segmentation.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.breadcrumb-block {\r\n  height: 48px;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.page-title {\r\n  height: 38px;\r\n  border-radius: 2px;\r\n  display: flex;\r\n  gap: 8px;\r\n  align-items: center;\r\n  color: #262626;\r\n  margin-bottom: 16px;\r\n  font-weight: 600;\r\n  font-size: 14px;\r\n  line-height: 22px;\r\n  .title {\r\n    font-weight: 600;\r\n    font-size: 14px;\r\n    line-height: 22px;\r\n  }\r\n}\r\n.document-segmentation {\r\n  position: relative;\r\n  height: 100%;\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  .page-container {\r\n    display: flex;\r\n    flex: 1;\r\n    overflow: hidden;\r\n\r\n    .page-left {\r\n      width: 430px;\r\n      height: 100%;\r\n      overflow-y: auto;\r\n      &::-webkit-scrollbar {\r\n        display: none;\r\n      }\r\n    }\r\n    .page-right {\r\n      flex: 1;\r\n      height: 100%;\r\n      padding-left: 24px;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n}\r\n.document-fragment-preview {\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  height: 100%;\r\n  overflow: hidden;\r\n\r\n  padding: 14px 16px;\r\n  background-color: #f2f4f7;\r\n\r\n  .preview-header {\r\n    display: flex;\r\n    height: 22px;\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n\r\n    .label-text {\r\n      font-weight: 600;\r\n      color: #242933;\r\n    }\r\n    .fragment-number {\r\n      padding-left: 8px;\r\n      color: #7a8699;\r\n    }\r\n  }\r\n\r\n  .preview-box {\r\n    flex: 1;\r\n    overflow-y: auto;\r\n    .fragment-item {\r\n      margin-top: 8px;\r\n      &.fragment-father-son-item{\r\n        margin: 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n.footer-btn-box {\r\n  height: 56px;\r\n  position: fixed;\r\n  left: 16px;\r\n  right: 16px;\r\n  bottom: 16px;\r\n  background: #fff;\r\n  border-top: 1px solid #f0f0f0;\r\n  box-shadow: 0 -8px 4px 0 #00000014;\r\n  border-radius: 0 0 8px 8px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 8px;\r\n}\r\n\r\n.loading-wrap {\r\n  position: absolute;\r\n  z-index: 99;\r\n  top: 100px;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.loading-box {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  color: #595959;\r\n  margin-top: 200px;\r\n}\r\n</style>\r\n\r\n<template>\r\n  <!-- loading -->\r\n  <div class=\"loading-wrap\" v-if=\"spinning\">\r\n    <a-spin></a-spin>\r\n  </div>\r\n\r\n  <div class=\"document-segmentation\">\r\n    <div class=\"breadcrumb-block\">\r\n      <a-breadcrumb>\r\n        <a-breadcrumb-item>\r\n          <router-link to=\"/library/list\"> {{ t('breadcrumb_knowledge_base') }} </router-link></a-breadcrumb-item\r\n        >\r\n        <a-breadcrumb-item>\r\n          <router-link\r\n            :to=\"{\r\n              path: '/library/details/knowledge-document',\r\n              query: {\r\n                id: libFileInfo.library_id\r\n              }\r\n            }\"\r\n          >\r\n            {{ libFileInfo.library_name }}{{ t('breadcrumb_knowledge_base_suffix') }}</router-link\r\n          >\r\n        </a-breadcrumb-item>\r\n        <a-breadcrumb-item>{{ t('breadcrumb_segmentation_setting') }}</a-breadcrumb-item>\r\n      </a-breadcrumb>\r\n    </div>\r\n    <div class=\"page-title\">\r\n      <LeftOutlined @click=\"goBack\" />\r\n      <span class=\"title\">{{ t('page_title') }}</span>\r\n      <!-- <div class=\"page-title-right\" v-if=\"library_type == 0\" style=\"margin-left: auto\">\r\n        <a-button type=\"primary\" :loading=\"saveLoading\" @click=\"handleSaveLibFileSplit\"\r\n          >保存</a-button\r\n        >\r\n      </div> -->\r\n    </div>\r\n    <div class=\"page-container\">\r\n      <div class=\"page-left\">\r\n        <SegmentationSetting\r\n          :excellQaLists=\"excellQaLists\"\r\n          :libFileInfo=\"libFileInfo\"\r\n          :library_type=\"library_type\"\r\n          :mode=\"settingMode\"\r\n          ref=\"segmentationSettingRef\"\r\n          @change=\"onChangeSetting\"\r\n          @changeChunkType=\"onChangeChunkType\"\r\n          @save=\"handleSaveLibFileSplit\"\r\n          @validate=\"onValidate\"\r\n        />\r\n      </div>\r\n      <div class=\"page-right\">\r\n        <div class=\"document-fragment-preview\">\r\n          <div class=\"preview-header\">\r\n            <span class=\"label-text\">{{ t('segmentation_preview') }}</span>\r\n            <span class=\"fragment-number\">{{ t('fragment_total', { total: documentFragmentTotal }) }}</span>\r\n          </div>\r\n          <Empty v-if=\"isEmpty && !aiLoading\"></Empty>\r\n          <div v-if=\"aiLoading\" class=\"loading-box\"><a-spin />{{ t('data_processing') }}</div>\r\n          <div class=\"preview-box\" ref=\"previewBoxRef\">\r\n            <div\r\n              class=\"fragment-item\"\r\n              :class=\"{'fragment-father-son-item': formData.chunk_type == 4}\"\r\n              v-for=\"(item, index) in documentFragmentList\"\r\n              :key=\"index\"\r\n            >\r\n              <DocumentFragment\r\n                :chunk_type=\"formData.chunk_type\"\r\n                :father_chunk_paragraph_number=\"item.father_chunk_paragraph_number\"\r\n                :number=\"item.number\"\r\n                :title=\"item.title\"\r\n                :content=\"item.content\"\r\n                :total=\"item.word_total\"\r\n                :question=\"item.question\"\r\n                :answer=\"item.answer\"\r\n                :images=\"item.images\"\r\n                :isNeedDashedLine=\"getIsNeedDashedLine(item, index)\"\r\n                :similar_question_list=\"item.similar_question_list\"\r\n                @delete=\"handleDeleteFragment(index)\"\r\n                @edit=\"handleEditFragment(item, index)\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- <div class=\"footer-btn-box\" v-if=\"library_type == 2\">\r\n      <a-button type=\"primary\" :loading=\"saveLoading\" @click=\"handleSaveLibFileSplit\"\r\n        >保存</a-button\r\n      >\r\n    </div> -->\r\n    <!-- 设置 -->\r\n    <EditFragmentAlert ref=\"editFragmentAlertRef\" @ok=\"saveFragment\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, createVNode, computed, onUnmounted, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { Modal, message } from 'ant-design-vue'\r\nimport { ExclamationCircleOutlined, LeftOutlined } from '@ant-design/icons-vue'\r\nimport Empty from './components/empty.vue'\r\nimport SegmentationSetting from './components/segmentation-setting.vue'\r\nimport DocumentFragment from './components/document-fragment.vue'\r\nimport EditFragmentAlert from './components/edit-fragment-alert.vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nimport {\r\n  getLibFileSplit,\r\n  getLibFileSplitPreview,\r\n  getLibFileSplitAiChunks,\r\n  getLibFileInfo,\r\n  saveLibFileSplit,\r\n  getLibraryInfo,\r\n  getLibFileExcelTitle\r\n} from '@/api/library/index'\r\nimport { useLibraryStore } from '@/stores/modules/library'\r\nimport {useMathJax} from \"@/composables/useMathJax.js\";\r\n\r\nconst { t } = useI18n('views.library.document-segmentation.document-segmentation')\r\n\r\nconst libraryStore = useLibraryStore()\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst { renderMath } = useMathJax()\r\n\r\nconst { setInitDocumentFragmentList } = libraryStore\r\nconst { document_id } = route.query\r\nconst spinning = ref(true)\r\nconst settingMode = ref(1) // 1 表格，0 非表格\r\nconst current_chunk_type = ref(1)\r\nlet itWasEdited = false\r\nconst defaultAiChunkPrumpt = t('default_ai_chunk_prompt')\r\nlet formData = {\r\n  id: document_id,\r\n  separators_no: '', // 自定义分段-分隔符序号集\r\n  chunk_size: 512, // 自定义分段-分段最大长度 默认512，最大值不得超过2000\r\n  not_merged_text: false,\r\n  chunk_overlap: 50, // 自定义分段-分段重叠长度 默认为50，最小不得低于10，最大不得超过最大分段长度的50%\r\n  is_qa_doc: 0, // 0 普通文档 1 QA文档\r\n  question_lable: '', // QA文档-问题开始标识符\r\n  similar_label: '', // QA文档-相似度标识符\r\n  answer_lable: '', // QA文档-答案开始标识符\r\n  enable_extract_image: true,\r\n  ai_chunk_size: 5000, // ai大模型分段最大字符数\r\n  ai_chunk_model:'', // ai大模型分段模型名称\r\n  ai_chunk_model_config_id: '', // ai大模型分段模型配置id\r\n  ai_chunk_prumpt: defaultAiChunkPrumpt,\r\n  ai_chunk_task_id: ''  //  ai分段数据id，如果有ai分段数据就有值\r\n}\r\nlet isEdit = false\r\n\r\nconst segmentationSettingRef = ref(null)\r\n\r\nconst onChangeSetting = (data) => {\r\n  if (typeof data.separators_no == 'object') {\r\n    data.separators_no = JSON.stringify(data.separators_no)\r\n  }\r\n  if (typeof data.father_chunk_separators_no == 'object') {\r\n    data.father_chunk_separators_no = JSON.stringify(data.father_chunk_separators_no)\r\n  }\r\n  if (typeof data.son_chunk_separators_no == 'object') {\r\n    data.son_chunk_separators_no = JSON.stringify(data.son_chunk_separators_no)\r\n  }\r\n  isEdit = true\r\n  formData = {\r\n    ...formData,\r\n    ...data\r\n  }\r\n  if (itWasEdited) {\r\n    Modal.confirm({\r\n      title: t('alert_reminder'),\r\n      icon: createVNode(ExclamationCircleOutlined),\r\n      content: t('alert_content_changed'),\r\n      okText: t('alert_confirm'),\r\n      okType: 'danger',\r\n      cancelText: t('alert_cancel'),\r\n      onOk() {\r\n        itWasEdited = false\r\n        getDocumentFragment('create')\r\n      },\r\n      onCancel() {}\r\n    })\r\n  } else {\r\n    itWasEdited = false\r\n    getDocumentFragment('create')\r\n  }\r\n}\r\n\r\n// 获取文档状态（是否已经转换为PDF）\r\nlet maxLoopNumber = 60 * 10\r\nlet loopNumber = 0\r\nlet library_id = null\r\nconst libFileInfo = ref({})\r\n\r\nconst library_type = ref(0)\r\nconst getDocumentStatus = () => {\r\n  if (!spinning.value) {\r\n    spinning.value = true\r\n  }\r\n\r\n  getLibFileInfo({ id: document_id }).then(async (res) => {\r\n    const { status } = res.data\r\n    library_type.value = res.data.library_type\r\n    libFileInfo.value = res.data\r\n    formData = {\r\n      ...formData,\r\n      separators_no: res.data.separators_no || '[12,11]',\r\n      chunk_size: +res.data.chunk_size || 512,\r\n      not_merged_text: res.data.not_merged_text  == 'true',\r\n      ai_chunk_size: +res.data.ai_chunk_size || 5000, // ai模型的默认值是5000\r\n      chunk_overlap: +res.data.chunk_overlap || 50,\r\n      is_qa_doc: library_type.value == 2 ? 1 : 0,\r\n      question_lable: res.data.question_lable,\r\n      similar_label: res.data.similar_label,\r\n      answer_lable: res.data.answer_lable,\r\n      question_column: res.data.question_column,\r\n      similar_column: res.data.similar_column,\r\n      answer_column: res.data.answer_column,\r\n      enable_extract_image: res.data.enable_extract_image == 'true',\r\n      qa_index_type: +res.data.qa_index_type,\r\n\r\n      chunk_type: +res.data.chunk_type,\r\n      semantic_chunk_size: +res.data.semantic_chunk_size || 512,\r\n      semantic_chunk_overlap: +res.data.semantic_chunk_overlap || 50,\r\n      semantic_chunk_threshold: +res.data.semantic_chunk_threshold || 90,\r\n      semantic_chunk_use_model: res.data.semantic_chunk_use_model || '',\r\n      ai_chunk_prumpt: res.data.ai_chunk_prumpt || '',\r\n      ai_chunk_model: res.data.ai_chunk_model || '',\r\n      semantic_chunk_model_config_id:\r\n        res.data.semantic_chunk_model_config_id > 0 ? res.data.semantic_chunk_model_config_id : '',\r\n      ai_chunk_model_config_id:\r\n        res.data.ai_chunk_model_config_id > 0 ? res.data.ai_chunk_model_config_id : '',\r\n      ai_chunk_task_id: res.data.ai_chunk_task_id || '',\r\n      father_chunk_paragraph_type: +res.data.father_chunk_paragraph_type || 2,\r\n      father_chunk_separators_no: res.data.father_chunk_separators_no || '[12,11]',\r\n      father_chunk_chunk_size: +res.data.father_chunk_chunk_size || 1024,\r\n      son_chunk_separators_no: res.data.son_chunk_separators_no || '[8,10]',\r\n      son_chunk_chunk_size: +res.data.son_chunk_chunk_size || 512,\r\n    }\r\n\r\n    if (res.data.chunk_type == 0) {\r\n      formData = {\r\n        ...formData,\r\n        separators_no: res.data.normal_chunk_default_separators_no,\r\n        chunk_size: res.data.normal_chunk_default_chunk_size,\r\n        not_merged_text: res.data.normal_chunk_default_not_merged_text == 'true',\r\n        chunk_overlap: res.data.normal_chunk_default_chunk_overlap,\r\n        chunk_type: +res.data.default_chunk_type,\r\n        semantic_chunk_size: +res.data.semantic_chunk_default_chunk_size,\r\n        semantic_chunk_overlap: +res.data.semantic_chunk_default_chunk_overlap,\r\n        semantic_chunk_threshold: +res.data.semantic_chunk_default_threshold,\r\n        semantic_chunk_use_model: res.data.default_use_model || '',\r\n        semantic_chunk_model_config_id: res.data.default_model_config_id > 0 ? res.data.default_model_config_id : ''\r\n      }\r\n    }\r\n\r\n    // await getInfo(res.data.library_id)\r\n    if (status == 0) {\r\n      loopNumber++\r\n      if (loopNumber > maxLoopNumber) {\r\n        Modal.error({\r\n          title: t('alert_reminder'),\r\n          content: t('alert_parse_slow')\r\n        })\r\n        return\r\n      }\r\n      setTimeout(() => {\r\n        getDocumentStatus()\r\n      }, 1000)\r\n    } else if (status == 4 || status == 2) {\r\n      spinning.value = false\r\n      settingMode.value = parseInt(res.data.is_table_file)\r\n      library_id = res.data.library_id\r\n\r\n      if (library_type.value == 2) {\r\n        if (formData.question_lable || formData.question_column) {\r\n          getDocumentFragment()\r\n        }\r\n      } else {\r\n        getDocumentFragment()\r\n      }\r\n      // library_type.value  != 2 && getDocumentFragment()\r\n    } else {\r\n      router.replace('/library/details?id=' + res.data.library_id)\r\n    }\r\n\r\n    if (res.data.is_table_file == 1) {\r\n      getExcelQaTitle()\r\n    }\r\n  })\r\n}\r\n\r\nonMounted(async() => {\r\n  await getDocumentStatus()\r\n})\r\n\r\nconst excellQaLists = ref([])\r\nconst getExcelQaTitle = () => {\r\n  // 获取excel的QA  问题所在列 下拉列表\r\n  getLibFileExcelTitle({ id: document_id }).then((res) => {\r\n    let datas = []\r\n    for (let key in res.data) {\r\n      datas.push({\r\n        lable: res.data[key],\r\n        value: key\r\n      })\r\n    }\r\n    excellQaLists.value = datas\r\n  })\r\n}\r\n\r\n// 获取文档切片\r\nconst isAiSave = ref(false)\r\nconst aiLoading = ref(false)\r\nconst task_id = ref('');\r\nconst error = ref(null);\r\nlet timer = null // 轮询定时器\r\nconst documentFragmentList = ref([])\r\nconst initDocumentFragmentList = ref([])\r\nconst documentFragmentTotal = ref(0)\r\nconst isEmpty = computed(() => documentFragmentTotal.value <= 0)\r\n\r\nconst getDocumentFragment = (type) => {\r\n\r\n  let params = {\r\n    ...formData,\r\n    semantic_chunk_model_config_id: formData.semantic_chunk_model_config_id\r\n      ? +formData.semantic_chunk_model_config_id\r\n      : 0,\r\n    ai_chunk_model_config_id: formData.ai_chunk_model_config_id\r\n      ? +formData.ai_chunk_model_config_id\r\n      : 0,\r\n  }\r\n\r\n  if (formData.chunk_type == 3) {\r\n    // 之前有分段数据可以传taskid过去直接获取\r\n    if (formData.ai_chunk_task_id && !type) {\r\n      params.ai_chunk_task_id = formData.ai_chunk_task_id\r\n    }\r\n\r\n    if (type && type === 'create') {\r\n      // 如果是主动点击的生成分段预览则不传taskid\r\n      params.ai_chunk_preview = true\r\n      delete params.ai_chunk_task_id\r\n    }\r\n  }\r\n  let fun = getLibFileSplit\r\n  if(type ==  'create'){\r\n    fun = getLibFileSplitPreview\r\n  }\r\n\r\n  return fun(params)\r\n    .then((res) => {\r\n      initDocumentFragmentList.value = res.data.list || []\r\n      setInitDocumentFragmentList(initDocumentFragmentList.value)\r\n      documentFragmentList.value = res.data.list || []\r\n      documentFragmentTotal.value = res.data.list.length || 0\r\n      renderMath(previewBoxRef.value)\r\n\r\n      if (formData.chunk_type == 3) {\r\n        // ai分段\r\n        task_id.value = res.data.split_params?.ai_chunk_task_id || ''\r\n        aiLoading.value = true\r\n        segmentationSettingRef.value.reLoading = true\r\n        error.value = null\r\n        // 之前没有ai分段数据，重新异步请求ai分段数据\r\n        // 之前不管有没有ai分段数据，只要是点击生成分段预览则重新异步请求ai分段数据\r\n        if (!formData.ai_chunk_task_id && settingMode.value != 1 || (type && type === 'create')) {\r\n          // 清空之前的页面分段数据，重新请求\r\n          documentFragmentList.value = []\r\n          documentFragmentTotal.value = 0\r\n          startPolling()\r\n        } else {\r\n          aiLoading.value = false\r\n          segmentationSettingRef.value.reLoading = false\r\n        }\r\n      }\r\n    })\r\n    .finally(() => {\r\n      if (formData.chunk_type != 3) {\r\n        segmentationSettingRef.value.reLoading = false\r\n        segmentationSettingRef.value.saveLoading = false\r\n      }\r\n    })\r\n}\r\n\r\nconst onChangeChunkType = (chunk_type) => {\r\n  current_chunk_type.value = chunk_type\r\n}\r\n\r\n// 轮询查询结果\r\nconst pollData = async () => {\r\n  try {\r\n    const res = await getAiDocumentFragment()\r\n\r\n    // 条件1: 接口返回错误信息\r\n    if (res.data.err_msg) {\r\n      error.value = res.data.err_msg;\r\n      return true; // 停止轮询\r\n    }\r\n\r\n    // 条件2: 接口返回有效数据\r\n    if (res.data.list?.length > 0) {\r\n      initDocumentFragmentList.value = res.data.list || []\r\n      setInitDocumentFragmentList(initDocumentFragmentList.value)\r\n      documentFragmentList.value = res.data.list || []\r\n      documentFragmentTotal.value = res.data.list.length || 0\r\n      return true; // 停止轮询\r\n    }\r\n\r\n    return false; // 继续轮询\r\n  } catch (err) {\r\n    error.value = t('message_request_exception');\r\n    return true; // 停止轮询\r\n  }\r\n};\r\n\r\nfunction formatError (errorStr) {\r\n  return errorStr.split(\"message:\")[1]\r\n}\r\n\r\n// 启动轮询控制\r\nconst startPolling = () => {\r\n  const executePoll = async () => {\r\n    const shouldStop = await pollData();\r\n    if (!shouldStop) {\r\n      timer = setTimeout(executePoll, 3000); // 3秒后再次执行\r\n    } else {\r\n      aiLoading.value = false\r\n      segmentationSettingRef.value.reLoading = false\r\n      segmentationSettingRef.value.saveLoading = false\r\n      if (timer !== null) {\r\n        clearTimeout(timer);\r\n        timer = null;\r\n      }\r\n      if (isAiSave.value) {\r\n        // 保存\r\n        handleSaveLibFileSplit()\r\n      }\r\n\r\n      if (error.value) {\r\n        let errorText = formatError(error.value)\r\n        Modal.error({\r\n          title: t('alert_segmentation_failed'),\r\n          content: errorText ? t('alert_model_failed_reason', { reason: errorText }) : t('alert_model_failed')\r\n        })\r\n      }\r\n    }\r\n  };\r\n  executePoll(); // 立即执行首次查询\r\n};\r\n\r\nconst getAiDocumentFragment = () => {\r\n  return getLibFileSplitAiChunks({\r\n    id: formData.id,\r\n    task_id: task_id.value\r\n  })\r\n}\r\n\r\n// 编辑文档片段\r\nconst editFragmentAlertRef = ref(null)\r\nlet editFragmentIndex = null\r\n\r\nconst handleEditFragment = (item, index) => {\r\n  let { title, content, question, answer, images, similar_question_list } = item\r\n  editFragmentIndex = index\r\n  editFragmentAlertRef.value.open({ title, content, question, answer, images, similar_question_list })\r\n}\r\n\r\nconst saveFragment = ({ title, content, question, answer, images,similar_question_list }) => {\r\n  if (\r\n    documentFragmentList.value[editFragmentIndex].title != title ||\r\n    documentFragmentList.value[editFragmentIndex].content != content ||\r\n    documentFragmentList.value[editFragmentIndex].question != question ||\r\n    documentFragmentList.value[editFragmentIndex].answer != answer\r\n  ) {\r\n    itWasEdited = true\r\n  }\r\n  documentFragmentList.value[editFragmentIndex].title = title\r\n  documentFragmentList.value[editFragmentIndex].content = content\r\n  documentFragmentList.value[editFragmentIndex].question = question\r\n  documentFragmentList.value[editFragmentIndex].answer = answer\r\n  documentFragmentList.value[editFragmentIndex].images = images\r\n  documentFragmentList.value[editFragmentIndex].similar_question_list = similar_question_list ? similar_question_list.split('\\n') : []\r\n\r\n  documentFragmentList.value[editFragmentIndex].word_total =\r\n    answer.length + question.length + content.length\r\n}\r\n\r\n// 删除文档片段\r\nconst handleDeleteFragment = (index) => {\r\n  Modal.confirm({\r\n    title: t('alert_reminder'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('alert_delete_fragment'),\r\n    okText: t('alert_confirm'),\r\n    okType: 'danger',\r\n    cancelText: t('alert_cancel'),\r\n    onOk() {\r\n      itWasEdited = true\r\n      documentFragmentList.value.splice(index, 1)\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\nconst validateMessage = ref('')\r\nconst onValidate = (data) => {\r\n  // 获取错误信息\r\n  validateMessage.value = data\r\n}\r\n\r\nconst saveLoading = ref(false)\r\n\r\nconst updataFormData = () => {\r\n  let data = segmentationSettingRef.value.formState\r\n  data = JSON.parse(JSON.stringify(data))\r\n  if (typeof data.separators_no == 'object') {\r\n    data.separators_no = JSON.stringify(data.separators_no)\r\n  }\r\n  if (typeof data.father_chunk_separators_no == 'object') {\r\n    data.father_chunk_separators_no = JSON.stringify(data.father_chunk_separators_no)\r\n  }\r\n  if (typeof data.son_chunk_separators_no == 'object') {\r\n    data.son_chunk_separators_no = JSON.stringify(data.son_chunk_separators_no)\r\n  }\r\n  formData = {\r\n    ...formData,\r\n    ...data\r\n  }\r\n}\r\nconst handleSaveLibFileSplit = async () => {\r\n  // 如果右侧的数据不是当前保存选中的分段类型则清空内容重新分段\r\n  // 如果之前已经分段成功了，保存的时候不再另外分段了\r\n  // if (documentFragmentTotal.value <= 0 || formData.chunk_type != current_chunk_type.value) {\r\n  //   updataFormData()\r\n  //   await getDocumentFragment()\r\n  // }\r\n\r\n  updataFormData()\r\n  if (validateMessage.value) {\r\n    return message.error(validateMessage.value)\r\n  }\r\n\r\n  if (formData.chunk_type == 3 && !documentFragmentList.value.length) {\r\n    // ai分段的保存\r\n    isAiSave.value = true\r\n    return false\r\n  }\r\n\r\n  // 如果点击了生成预览，则不传ai_chunk_task_id, 没点击生成预览，则传ai_chunk_task_id\r\n  if (task_id.value !== formData.ai_chunk_task_id) {\r\n    delete formData.ai_chunk_task_id\r\n  }\r\n\r\n  let split_params = {\r\n    ...formData,\r\n    chunk_async: true,\r\n    semantic_chunk_model_config_id: formData.semantic_chunk_model_config_id\r\n      ? +formData.semantic_chunk_model_config_id\r\n      : 0,\r\n    ai_chunk_model_config_id: formData.ai_chunk_model_config_id\r\n      ? +formData.ai_chunk_model_config_id\r\n      : 0,\r\n    is_table_file: settingMode.value\r\n  }\r\n\r\n  delete split_params.id\r\n\r\n  let parmas = {\r\n    id: document_id,\r\n    chunk_async: true,\r\n    word_total: documentFragmentTotal.value,\r\n    split_params: JSON.stringify(split_params),\r\n    list: JSON.stringify(documentFragmentList.value)\r\n  }\r\n\r\n  // 非表格的也需要存储qa_index_type\r\n  if (split_params.is_qa_doc == 1) {\r\n    // 表格类型 + QA文档\r\n    parmas.qa_index_type = split_params.qa_index_type\r\n  }\r\n\r\n  saveLoading.value = true\r\n\r\n  saveLibFileSplit(parmas)\r\n    .then(() => {\r\n      message.success(t('message_save_success'))\r\n      let page = 1\r\n      if (route.query.page) {\r\n        page = route.query.page\r\n      }\r\n      router.replace('/library/details?id=' + library_id + '&page=' + page)\r\n    })\r\n    .finally(() => {\r\n      saveLoading.value = false\r\n    })\r\n    .catch((err) => {\r\n      console.log(err, '==')\r\n      err.data && err.data.index && handleScrollToErrorDom(err.data.index)\r\n    })\r\n}\r\n\r\n// 取消和上一步\r\nconst handleCancel = () => {\r\n  Modal.confirm({\r\n    title: t('alert_exit_confirm'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: '',\r\n    okText: t('alert_confirm'),\r\n    okType: 'danger',\r\n    cancelText: t('alert_cancel'),\r\n    onOk() {\r\n      router.replace('/library/details?id=' + library_id)\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst previewBoxRef = ref(null)\r\nconst handleScrollToErrorDom = (index) => {\r\n  index = index - 1\r\n  let fragmentElements = previewBoxRef.value.querySelectorAll('.fragment-item')\r\n  if (fragmentElements.length >= index) {\r\n    let scorllElement = fragmentElements[index]\r\n    scorllElement.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' })\r\n  }\r\n}\r\nconst goBack = () => {\r\n  router.back()\r\n}\r\n\r\nfunction getIsNeedDashedLine(item, index) {\r\n  if(formData.chunk_type != 4){\r\n    return false\r\n  }\r\n  if(index == 0){\r\n    return false\r\n  }\r\n  let preItem = documentFragmentList.value[index - 1]\r\n  if(item.father_chunk_paragraph_number == preItem.father_chunk_paragraph_number){\r\n    return true\r\n  }\r\n\r\n  return false\r\n\r\n}\r\n\r\n// 组件卸载时清理\r\nonUnmounted(() => {\r\n  if (timer) {\r\n    clearTimeout(timer);\r\n    timer = null;\r\n  }\r\n});\r\n</script>\r\n"],"names":["t","useI18n","libraryStore","useLibraryStore","route","useRoute","router","useRouter","renderMath","useMathJax","setInitDocumentFragmentList","document_id","spinning","ref","settingMode","current_chunk_type","itWasEdited","defaultAiChunkPrumpt","formData","segmentationSettingRef","onChangeSetting","data","Modal","createVNode","ExclamationCircleOutlined","getDocumentFragment","maxLoopNumber","loopNumber","library_id","libFileInfo","library_type","getDocumentStatus","getLibFileInfo","res","status","getExcelQaTitle","onMounted","excellQaLists","getLibFileExcelTitle","datas","key","isAiSave","aiLoading","task_id","error","timer","documentFragmentList","initDocumentFragmentList","documentFragmentTotal","isEmpty","computed","type","params","fun","getLibFileSplit","getLibFileSplitPreview","previewBoxRef","_a","startPolling","onChangeChunkType","chunk_type","pollData","getAiDocumentFragment","formatError","errorStr","executePoll","handleSaveLibFileSplit","errorText","getLibFileSplitAiChunks","editFragmentAlertRef","editFragmentIndex","handleEditFragment","item","index","title","content","question","answer","images","similar_question_list","saveFragment","handleDeleteFragment","validateMessage","onValidate","saveLoading","updataFormData","message","split_params","parmas","saveLibFileSplit","page","err","handleScrollToErrorDom","fragmentElements","goBack","getIsNeedDashedLine","preItem","onUnmounted","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_a_spin","_createElementVNode","_hoisted_2","_hoisted_3","_component_a_breadcrumb","_component_a_breadcrumb_item","_component_router_link","_unref","_toDisplayString","_hoisted_4","LeftOutlined","_hoisted_5","_hoisted_6","_hoisted_7","SegmentationSetting","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_createBlock","Empty","_hoisted_13","_Fragment","_renderList","_normalizeClass","DocumentFragment","$event","EditFragmentAlert"],"mappings":"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"}