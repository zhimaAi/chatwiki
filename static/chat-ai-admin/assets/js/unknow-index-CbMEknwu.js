import{_ as Ae}from"./cu-scroll-CpIj948h.js";import{u as qe}from"./robot-CIzNpArp.js";import{d as G}from"./utils-CvB22N-W.js";import{ah as se,ag as Ce,r as c,E as j,j as Ee,w as Ie,a as y,b as u,p as e,y as o,t as a,F as E,l as oe,u as t,e as A,_ as C,v as s,c as te,o as je,q as Q,z as pe,D as we,h as Be,an as ke,ao as xe,m as me,V as Je}from"./vue-chunks-BdaA73Wf.js";import{u as X,_ as ve,A as Pe,aZ as Qe,a$ as Ve,am as He,d as Xe}from"../../index-DSFcP5NQ.js";import{T as Ze,r as We,P as et,B as fe,M as ue,aX as tt,aQ as nt,a4 as ot,m as Se,q as ye,x as Me,u as st,v as at,V as De,Z as ge,$ as he,G as Oe,e as lt,b as H,b7 as Ue,F as re,c as ze,ac as Le,H as it,D as rt,f as ut,g as _t,i as dt,w as ct,a9 as mt,J as pt}from"./ui-antd-Dl1wwwCD.js";import{M as be}from"./model-select-CMPvMrAQ.js";import{_ as Z}from"./emoji-mart-BBMRoEa3.js";import{u as vt}from"./index-BuDcjXHQ.js";import{a8 as ft,a9 as Ye,aa as yt,ab as gt}from"./index-Cg7-0swo.js";import{U as Ne}from"./index-XVLbk3qE.js";import{M as ht}from"./editor-code-DlsHKXTn.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./editor-cherry-CFIsbKoN.js";import"./elkjs-BN8GIjVH.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./other-LrIFyvU9.js";import"./index-MT9fcN3v.js";import"./index-B_UHbFfL.js";const bt={class:"zm-date"},wt={class:"date-btn"},kt={class:"date-content"},Te={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(B,{emit:_}){const{t:T}=X("views.robot.robot-config.unknown-issue.components.date"),n=se().query,I=Ce(),l=B,b=c(1),m=_;let v=j([{label:T("today"),value:!0,key:2,start_date:G().startOf("day"),end_date:G().endOf("day")},{label:T("yesterday"),value:!1,key:3,start_date:G().subtract(1,"day").startOf("day"),end_date:G().startOf("day").subtract(1,"millisecond")},{label:T("last_7_days"),value:!1,key:4,start_date:G().subtract(6,"day").startOf("day"),end_date:G().endOf("day").subtract(1,"millisecond")},{label:T("custom"),value:!1,key:5,start_date:G().startOf("month").startOf("day"),end_date:G().endOf("day")}]);const r=c(null),M=c(null),L=c([]),D=h=>h>=G().subtract(0,"day"),O=()=>{let h=b.value,d=null;v.forEach(p=>{p.key==h&&(d=p)}),L.value=[d.start_date,d.end_date],r.value=d.start_date.startOf("day").format("YYYYMMDD"),M.value=d.end_date.endOf("day").format("YYYYMMDD"),Y()},N=(h,d)=>{r.value=h[0].startOf("day").format("YYYYMMDD"),M.value=h[1].endOf("day").format("YYYYMMDD"),b.value=5,Y()},Y=()=>{m("dateChange",{start_time:r.value,end_time:M.value})};return Ee(()=>{n.start_date&&n.end_date?(b.value=5,L.value=[G(n.start_date),G(n.end_date)],r.value=G(n.start_date).format("YYYYMMDD"),M.value=G(n.end_date).format("YYYYMMDD"),Y(),setTimeout(()=>{I.push({path:I.path,query:{id:n.id,robot_key:n.robot_key}})},400)):(b.value=parseInt(l.datekey),O())}),Ie(()=>l.datekey,(h,d)=>{b.value=parseInt(l.datekey.split("-")[0]),O()}),(h,d)=>{const p=Ze,w=We,x=et;return u(),y("div",bt,[e("div",wt,[o(w,{value:b.value,"onUpdate:value":d[0]||(d[0]=U=>b.value=U),onChange:O},{default:a(()=>[(u(!0),y(E,null,oe(t(v),U=>(u(),A(p,{class:"date-btn-button",value:U.key,key:U.key},{default:a(()=>[C(s(U.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",kt,[o(x,{value:L.value,"onUpdate:value":d[1]||(d[1]=U=>L.value=U),onChange:N,format:"YYYY-MM-DD",disabledDate:D,allowClear:!1},null,8,["value"])])])}}},xt={class:"custom-modal-header"},$t={class:"ai-generate-wrapper"},qt={class:"form-box-wrapper ai-generate-wrapper-box"},Ct={class:"ai-generate-wrapper-left"},It={class:"form-box-wrapper-options"},St={class:"form-item flex1"},Mt={class:"form-label required"},Dt={class:"form-content"},Ot={class:"form-item generate-btn-box"},Ut={key:0,class:"progress-box"},zt={class:"tip"},Lt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(B,{expose:_,emit:T}){const{t:n}=X("views.robot.robot-config.unknown-issue.components.ai-generate-modal"),I=c(10),l=c(!1),b=c(!1),m=j({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),v=B,r=T,M=c(!1),L=()=>{M.value=!0},D=()=>{l.value=!1},O=async()=>{var K;b.value=!0;try{let $={library_id:(K=v.detailsInfo)==null?void 0:K.library_id,model_config_id:m.model_config_id,use_model:m.use_model,num:m.count};M.value=!1,l.value=!0,w()}finally{b.value=!1}},N=c(!1),Y=c(!1);let h=null;const d=te(()=>I.value>=100?"success":"active"),p=te(()=>({"0%":"#108ee9","100%":"#87d068"})),w=()=>{N.value=!0,Y.value=!1,I.value=0,h=setInterval(()=>{I.value<100?(I.value+=Math.floor(Math.random()*10)+1,I.value>100&&(I.value=100)):(clearInterval(h),N.value=!1,Y.value=!0)},800)},x=()=>{r("handleDownload")},U=K=>{if(N.value)return K.preventDefault(),K.returnValue=n("before_unload_tip"),n("before_unload_tip")};return je(()=>{clearInterval(h),window.removeEventListener("beforeunload",U)}),_({showModal:L,hideModal:D}),(K,$)=>{const J=ve,f=fe,z=ue,S=tt,V=nt;return u(),y("div",null,[o(z,{open:M.value,"onUpdate:open":$[2]||($[2]=F=>M.value=F),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:a(()=>[e("div",xt,[e("span",null,s(t(n)("title")),1)])]),footer:a(()=>[...$[4]||($[4]=[])]),default:a(()=>[e("div",$t,[e("div",qt,[e("div",Ct,[e("div",It,[e("div",St,[e("div",Mt,s(t(n)("model_selection_label")),1),e("div",Dt,[o(be,{modelType:"LLM",modeName:m.use_model,"onUpdate:modeName":$[0]||($[0]=F=>m.use_model=F),modeId:m.model_config_id,"onUpdate:modeId":$[1]||($[1]=F=>m.model_config_id=F)},null,8,["modeName","modeId"])])])]),e("div",Ot,[o(f,{onClick:O,loading:b.value,class:"generate-btn"},{default:a(()=>[o(J,{name:"ai-generate-white",style:{"font-size":"16px"}}),C(" "+s(t(n)("generate_button")),1)]),_:1},8,["loading"])])])])])]),_:1},8,["open"]),o(z,{open:l.value,"onUpdate:open":$[3]||($[3]=F=>l.value=F),title:t(n)("generating_title"),footer:null,width:746},{default:a(()=>[I.value<100?(u(),y("div",Ut,[o(S,{type:"circle",percent:I.value,status:d.value,"stroke-color":p.value},null,8,["percent","status","stroke-color"]),e("div",zt,s(t(n)("generating_tip")),1)])):(u(),A(V,{key:1,status:"success",title:t(n)("complete_title")},{subTitle:a(()=>[C(s(t(n)("complete_subtitle")),1)]),extra:a(()=>[o(f,{onClick:x,type:"primary"},{default:a(()=>[C(s(t(n)("download_button")),1)]),_:1})]),_:1},8,["title"]))]),_:1},8,["open","title"])])}}},Yt=Z(Lt,[["__scopeId","data-v-14558442"]]),Nt={class:"list-wrapper"},Tt={class:"content-wrapper"},Rt={class:"tip-icon"},Kt={class:"tip-title"},Ft={class:"tip-content"},Gt={class:"search-block"},At={key:0},Et={key:1},jt={__name:"index",setup(B){const{t:_}=X("views.robot.robot-config.unknown-issue.index"),T=se().query,n=c(1),I=c([]),l=j({robot_id:T.id,start_day:"",end_day:"",page:1,size:10,total:0}),b=c(null),m=O=>{l.page=O.current,l.size=O.pageSize,L()},v=()=>{l.page=1,L()},r=()=>{n.value=2,b.value&&b.value.hideModal()},M=O=>{l.start_day=O.start_time,l.end_day=O.end_time,v()},L=()=>{vt({...l}).then(O=>{let N=O.data.list;I.value=N,l.total=+O.data.total})},D=[{title:_("column_unknown_question"),dataIndex:"question",key:"question",width:"60%"},{title:_("column_trigger_date"),dataIndex:"show_date",key:"show_date",width:"20%"},{title:_("column_trigger_count"),key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return(O,N)=>{const Y=Se,h=ye,d=Me;return u(),y(E,null,[e("div",Nt,[e("div",Tt,[o(Y,{"show-icon":"",class:"alert-box"},{icon:a(()=>[e("div",Rt,[o(t(ot))])]),message:a(()=>[e("div",Kt,s(t(_)("tip_title")),1),e("div",Ft,[e("p",null,s(t(_)("tip_content")),1)])]),_:1}),e("div",Gt,[o(Te,{datekey:"4",onDateChange:M})]),o(d,{class:"table-list",columns:D,"data-source":I.value,pagination:{current:l.page,total:l.total,pageSize:l.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:m},{bodyCell:a(({column:p,record:w})=>[p.key==="question"?(u(),y(E,{key:0},[w.question.length>100?(u(),y("div",At,[o(h,{overlayClassName:"search-content-tip",placement:"top"},{title:a(()=>[C(s(w.question),1)]),default:a(()=>[e("div",null,s(w.question.slice(0,100)+"..."),1)]),_:2},1024)])):(u(),y("div",Et,s(w.question),1))],64)):Q("",!0)]),_:1},8,["data-source","pagination"])])]),o(Yt,{ref_key:"aiGenerateRef",ref:b,onHandleDownload:r},null,512)],64)}}},Bt=Z(jt,[["__scopeId","data-v-9429828a"]]),Jt={class:"custom-modal-header"},Pt={key:1},Qt={key:2},Vt={class:"form-box-wrapper"},Ht={class:"form-item"},Xt={class:"form-label required"},Zt={class:"form-content"},Wt={class:"form-item"},en={class:"form-label required"},tn={class:"form-content"},nn={class:"form-item"},on={class:"form-label required"},sn={class:"form-content"},an={class:"form-item"},ln={class:"form-label-box"},rn={class:"form-label required"},un={class:"ai-generate-text"},_n={class:"form-content"},dn={class:"form-content-tip"},cn={class:"form-item"},mn={class:"form-label required"},pn={class:"form-content"},vn={key:0,class:"error-tip"},fn={class:"form-item"},yn={class:"form-label"},gn={class:"form-content"},hn={class:"upload-box-wrapper"},bn={key:0},wn={class:"ai-generate-wrapper"},kn={class:"form-box-wrapper ai-generate-wrapper-box"},xn={class:"ai-generate-wrapper-left"},$n={class:"form-box-wrapper-options"},qn={class:"form-item flex1"},Cn={class:"form-label required"},In={class:"form-content"},Sn={class:"form-item flex1"},Mn={class:"form-content dual-inputs"},Dn={class:"input-group"},On={class:"form-label required"},Un={class:"form-label-input-box"},zn={class:"form-box-wrapper-content"},Ln={class:"problem-box"},Yn={class:"problem"},Nn={class:"problem-content"},Tn={class:"problem-box"},Rn={class:"problem"},Kn={class:"problem-content"},Fn={class:"form-item generate-btn-box"},Gn={class:"result-nav"},An={key:0,class:"tip"},En={key:1,class:"result-nav-text"},jn={key:0,class:"container"},Bn={class:"result-container"},Jn=["innerHTML"],Pn={class:"result-footer"},Qn={__name:"import-library-modal",emits:["ok"],setup(B,{expose:_,emit:T}){const{t:n}=X("views.robot.robot-config.unknown-issue.summarize.components.import-library-modal"),I=c(!1),l=c(!1),b=c(!1),m=c(!1),v=c(!1),r=j({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),M=new ht({html:!0,linkify:!0,typographer:!0}),L=c(""),D=j({finish:"",content:""});Ie(()=>D.content,()=>{L.value=M.render(D.content)});const O=T,N=c("1"),Y=c(!1),h=c(""),d=c(""),p=c(""),w=c(""),x=c(""),U=c([]),K=c(""),$=c("0"),J=c([]),f=()=>{Pe({type:2}).then(q=>{$.value="0",J.value=q.data||[]})};f();const z=()=>{F()},S=q=>{var i;f(),l.value=!1,b.value=!1,v.value=!1,h.value="",d.value="",K.value=q.id||"",p.value=q.answer||"",U.value=q.images||[],w.value=q.question||"",x.value=q.similar_questions?q.similar_questions.join(`
`):"",$.value=q.group_id||"0",r.library_id=q.library_id||"",r.library_id||(r.library_id=(i=J.value[0])==null?void 0:i.id),F(),Y.value=!0},V=c([]),F=()=>{He({library_id:r.library_id}).then(q=>{V.value=q.data||[]})},ne=()=>{if(le(),!w.value)return H.error(n("validation_question"));if(!p.value)return H.error(n("validation_answer"));if(p.value.length>1e4)return;let q={title:h.value,content:d.value,question:w.value,answer:p.value,images:U.value,library_id:r.library_id};q.group_id=$.value||0;let i=x.value.trim();i?(i=i.split(`
`),q.similar_questions=JSON.stringify(i)):q.similar_questions="[]";let g=new FormData;for(let R in q)Ue.isArray(q[R])?q[R].forEach(P=>{g.append(R,P)}):g.append(R,q[R]);Ve(g).then(R=>{ft({id:K.value,to_library_id:r.library_id}).then(P=>{H.success(n("success_import")),Y.value=!1,O("ok")})})},ae=()=>{if(!r.library_id)return H.error(n("validation_library"));l.value=!0},W=c(""),_e=async()=>{D.content="",W.value="",m.value=!0,v.value=!0;try{let q={library_id:r.library_id,model_config_id:r.model_config_id,use_model:r.use_model,num:r.count,question:w.value,answer:p.value};const i=await Qe(q);W.value=i.data.map(g=>g).join(`
`),D.content=i.data.map((g,R)=>`<div class="dialog-message">${R+1}. ${g}</div>`).join(""),b.value=!0}finally{m.value=!1}},de=()=>{x.value?x.value+=`
${W.value}`:x.value+=W.value,H.success(n("success_save")),b.value=!1,l.value=!1,v.value=!1};function ee(q){return q.split(`
`).map(i=>i.trim()).filter(i=>i).join(`
`)}const le=()=>{x.value=ee(x.value)};return _({showModal:S}),(q,i)=>{const g=fe,R=at,P=st,ce=De,ie=ve,Re=he,Ke=ge,Fe=Oe,Ge=ue;return u(),y("div",null,[o(Ge,{open:Y.value,"onUpdate:open":i[12]||(i[12]=k=>Y.value=k),onOk:ne,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:l.value?v.value?"944px":"472px":"746px","ok-button-props":{style:{display:l.value?"none":"block"}}},{title:a(()=>[e("div",Jt,[l.value?(u(),A(g,{key:0,type:"text",class:"back-button",onClick:i[0]||(i[0]=k=>l.value=!1)},{icon:a(()=>[o(t(lt),{style:{"font-size":"12px"}})]),_:1})):Q("",!0),l.value?(u(),y("span",Pt,s(t(n)("title_ai_generate")),1)):(u(),y("span",Qt,s(t(n)("title_import_library")),1))])]),footer:a(()=>[l.value?Q("",!0):(u(),y(E,{key:0},[o(g,{onClick:i[11]||(i[11]=k=>Y.value=!1)},{default:a(()=>[C(s(t(n)("button_cancel")),1)]),_:1}),o(g,{type:"primary",onClick:ne},{default:a(()=>[C(s(t(n)("button_confirm")),1)]),_:1})],64))]),default:a(()=>[pe(e("div",Vt,[e("div",Ht,[e("div",Xt,s(t(n)("label_library")),1),e("div",Zt,[o(P,{onChange:z,value:r.library_id,"onUpdate:value":i[1]||(i[1]=k=>r.library_id=k),style:{width:"100%"},placeholder:t(n)("placeholder_select")},{default:a(()=>[(u(!0),y(E,null,oe(J.value,k=>(u(),A(R,{value:k.id,key:k.id},{default:a(()=>[C(s(k.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),e("div",Wt,[e("div",en,s(t(n)("label_category")),1),e("div",tn,[o(P,{value:$.value,"onUpdate:value":i[2]||(i[2]=k=>$.value=k),style:{width:"100%"}},{default:a(()=>[(u(!0),y(E,null,oe(V.value,k=>(u(),A(R,{value:k.id},{default:a(()=>[C(s(k.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",nn,[e("div",on,s(t(n)("label_question")),1),e("div",sn,[o(ce,{placeholder:t(n)("placeholder_question"),value:w.value,"onUpdate:value":i[3]||(i[3]=k=>w.value=k),style:{height:"100px"}},null,8,["placeholder","value"])])]),e("div",an,[e("div",ln,[e("div",rn,s(t(n)("label_similar_questions")),1),e("div",{class:"ai-generate",onClick:ae},[o(ie,{name:"ai-generate",style:{"font-size":"14px"}}),e("div",un,s(t(n)("button_ai_generate")),1)])]),e("div",_n,[o(ce,{placeholder:t(n)("placeholder_similar_questions"),value:x.value,"onUpdate:value":i[4]||(i[4]=k=>x.value=k),style:{height:"100px"},onBlur:le},null,8,["placeholder","value"]),e("div",dn,s(t(n)("tip_similar_questions")),1)])]),e("div",cn,[e("div",mn,s(t(n)("label_answer")),1),e("div",pn,[o(ce,{placeholder:t(n)("placeholder_answer"),value:p.value,"onUpdate:value":i[5]||(i[5]=k=>p.value=k),maxlength:1e4,style:{height:"100px"}},null,8,["placeholder","value"]),p.value.length>1e4?(u(),y("div",vn,s(t(n)("error_answer_length")),1)):Q("",!0)])]),e("div",fn,[e("div",yn,s(t(n)("label_attachments")),1),e("div",gn,[e("div",hn,[o(Ke,{activeKey:N.value,"onUpdate:activeKey":i[6]||(i[6]=k=>N.value=k),size:"small"},{default:a(()=>[o(Re,{key:"1"},{tab:a(()=>[e("span",null,[o(ie,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),C(" "+s(t(n)("tab_images"))+" ",1),U.value.length?(u(),y("span",bn,"("+s(U.value.length)+")",1)):Q("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(Ne,{value:U.value,"onUpdate:value":i[7]||(i[7]=k=>U.value=k)},null,8,["value"])])])])],512),[[we,!l.value]]),pe(e("div",wn,[e("div",kn,[e("div",xn,[e("div",$n,[e("div",qn,[e("div",Cn,s(t(n)("label_model")),1),e("div",In,[o(be,{modelType:"LLM",modeName:r.use_model,"onUpdate:modeName":i[8]||(i[8]=k=>r.use_model=k),modeId:r.model_config_id,"onUpdate:modeId":i[9]||(i[9]=k=>r.model_config_id=k)},null,8,["modeName","modeId"])])]),e("div",Sn,[e("div",Mn,[e("div",Dn,[e("div",On,s(t(n)("label_question_count")),1),e("div",Un,[o(Fe,{value:r.count,"onUpdate:value":i[10]||(i[10]=k=>r.count=k),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),i[13]||(i[13]=C("个 ",-1))])])])])]),e("div",zn,[e("div",Ln,[e("div",Yn,s(t(n)("label_question")),1),e("div",Nn,s(w.value),1)]),e("div",Tn,[e("div",Rn,s(t(n)("label_answer")),1),e("div",Kn,s(p.value),1)])]),e("div",Fn,[o(g,{onClick:_e,loading:m.value,class:"generate-btn"},{default:a(()=>[o(ie,{name:"ai-generate-white",style:{"font-size":"16px"}}),C(" "+s(t(n)("button_generate")),1)]),_:1},8,["loading"])])]),e("div",{class:Be(["ai-generate-wrapper-right",{"show-result":v.value}])},[e("div",Gn,[o(ie,{name:"generate-icon",style:{"font-size":"14px"}}),m.value?(u(),y("span",An,s(t(n)("generating")),1)):(u(),y("div",En,s(t(n)("generate_complete")),1))]),!D.content&&m.value&&!I.value?(u(),y("div",jn,[...i[14]||(i[14]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)])])):Q("",!0),e("div",Bn,[e("div",{class:"dialog-content",innerHTML:L.value},null,8,Jn)]),e("div",Pn,[o(g,{class:"result-footer-btn",type:"primary",onClick:de},{default:a(()=>[C(s(t(n)("button_save")),1)]),_:1})])],2)])],512),[[we,l.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Vn=Z(Qn,[["__scopeId","data-v-616f4680"]]),Hn={class:"form-box"},Xn={__name:"auto-cluster-modal",emits:["ok"],setup(B,{expose:_,emit:T}){const{t:n}=X("views.robot.robot-config.unknown-issue.summarize.components.auto-cluster-modal"),I=T,l=se().query,b=c(!1),m=j({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:l.id}),v=re.useForm;c(!1);const r=h=>{m.unknown_summary_model_config_id=h.unknown_summary_model_config_id||"",m.unknown_summary_use_model=h.unknown_summary_use_model||"",m.unknown_summary_similarity=h.unknown_summary_similarity||"",m.unknown_summary_status=h.unknown_summary_status||"",b.value=!0},M=j({unknown_summary_similarity:[{required:!0,message:n("validation_similarity"),trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:n("validation_vector_model"),trigger:"change"}]}),{validate:L,validateInfos:D}=v(m,M),O=h=>{h.length},N=()=>{L().then(()=>{Y()}).catch(h=>{})},Y=()=>{Ye({...m}).then(h=>{H.success(n("save_success")),b.value=!1,I("ok")})};return _({show:r}),(h,d)=>{const p=ze,w=ye,x=Oe,U=re,K=ue;return u(),y("div",null,[o(K,{open:b.value,"onUpdate:open":d[3]||(d[3]=$=>b.value=$),title:t(n)("title"),onOk:N},{default:a(()=>[e("div",Hn,[o(U,{layout:"vertical"},{default:a(()=>[o(p,ke(xe(t(D).unknown_summary_model_config_id)),{label:a(()=>[C(s(t(n)("label_vector_model")),1)]),default:a(()=>[o(be,{modelType:"TEXT EMBEDDING",modeName:m.unknown_summary_use_model,"onUpdate:modeName":d[0]||(d[0]=$=>m.unknown_summary_use_model=$),modeId:m.unknown_summary_model_config_id,"onUpdate:modeId":d[1]||(d[1]=$=>m.unknown_summary_model_config_id=$),onLoaded:O,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),o(p,ke(xe(t(D).unknown_summary_similarity)),{label:a(()=>[C(s(t(n)("label_similarity_threshold"))+" ",1),o(w,null,{title:a(()=>[C(s(t(n)("tooltip_similarity")),1)]),default:a(()=>[o(t(Le),{class:"ml4"})]),_:1})]),default:a(()=>[o(x,{placeholder:t(n)("placeholder_similarity"),style:{width:"100%"},value:m.unknown_summary_similarity,"onUpdate:value":d[2]||(d[2]=$=>m.unknown_summary_similarity=$),min:0,max:1,precision:2,step:.1},null,8,["placeholder","value"])]),_:1},16)]),_:1})])]),_:1},8,["open","title"])])}}},Zn=Z(Xn,[["__scopeId","data-v-54716319"]]),Wn={class:"form-box"},eo={class:"upload-box-wrapper"},to={key:0},no={__name:"set-answer-modal",emits:["ok"],setup(B,{expose:_,emit:T}){const{t:n}=X("views.robot.robot-config.unknown-issue.summarize.components.set-answer-modal"),I=T,l=se().query,b=c("1"),m=c(!1),v=j({id:l.id,question:"",unknown_list:"",answer:"",images:[]}),r=re.useForm,M=c(!1),L=d=>{Object.assign(v,JSON.parse(JSON.stringify(d))),m.value=!0},D=j({question:[{required:!0,message:n("validation_question"),trigger:"change"}],unknown_list:[{required:!0,message:n("validation_similar_questions"),trigger:"change"}],answer:[{required:!0,message:n("validation_answer"),trigger:"change"}]}),{validate:O,validateInfos:N}=r(v,D),Y=()=>{O().then(()=>{h()}).catch(d=>{})},h=()=>{let d={...v},p=d.unknown_list.trim();p?(p=p.split(`
`),d.unknown_list=JSON.stringify(p)):d.unknown_list="[]";let w=new FormData;for(let x in d)Ue.isArray(d[x])?d[x].forEach(U=>{w.append(x,U)}):w.append(x,d[x]);M.value=!0,yt(w).then(x=>{H.success(n("save_success")),m.value=!1,I("ok")}).finally(()=>{M.value=!1})};return _({show:L}),(d,p)=>{const w=De,x=ze,U=ve,K=he,$=ge,J=Ne,f=re,z=ue;return u(),y("div",null,[o(z,{open:m.value,"onUpdate:open":p[5]||(p[5]=S=>m.value=S),title:t(n)("title"),onOk:Y,width:746,confirmLoading:M.value},{default:a(()=>[e("div",Wn,[o(f,{layout:"vertical"},{default:a(()=>[o(x,me({label:t(n)("label_question")},t(N).question),{default:a(()=>[o(w,{placeholder:t(n)("placeholder_question"),value:v.question,"onUpdate:value":p[0]||(p[0]=S=>v.question=S),style:{height:"100px"}},null,8,["placeholder","value"])]),_:1},16,["label"]),o(x,me({label:t(n)("label_similar_questions")},t(N).unknown_list),{default:a(()=>[o(w,{placeholder:t(n)("placeholder_similar_questions"),value:v.unknown_list,"onUpdate:value":p[1]||(p[1]=S=>v.unknown_list=S),style:{height:"100px"}},null,8,["placeholder","value"])]),_:1},16,["label"]),o(x,me({label:t(n)("label_answer")},t(N).answer),{default:a(()=>[o(w,{placeholder:t(n)("placeholder_answer"),value:v.answer,"onUpdate:value":p[2]||(p[2]=S=>v.answer=S),maxlength:1e4,style:{height:"100px"}},null,8,["placeholder","value"])]),_:1},16,["label"]),o(x,{label:t(n)("label_attachments")},{default:a(()=>[e("div",eo,[o($,{activeKey:b.value,"onUpdate:activeKey":p[3]||(p[3]=S=>b.value=S),size:"small"},{default:a(()=>[o(K,{key:"1"},{tab:a(()=>[e("span",null,[o(U,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),C(" "+s(t(n)("tab_images"))+" ",1),v.images.length?(u(),y("span",to,"("+s(v.images.length)+")",1)):Q("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(J,{value:v.images,"onUpdate:value":p[4]||(p[4]=S=>v.images=S)},null,8,["value"])])]),_:1},8,["label"])]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},oo=Z(no,[["__scopeId","data-v-bd3c83a6"]]),so={class:"user-model-page"},ao={class:"search-block"},lo={class:"left-block"},io={class:"right-block"},ro={class:"list-box"},uo={class:"qa-list-box"},_o={class:"list-item"},co={class:"list-label"},mo={class:"list-content"},po={class:"classify-scroll-box"},vo={key:0,class:"list-item"},fo={class:"list-label"},yo={class:"list-content"},go={class:"fragment-img"},ho=["src"],bo={class:"import-td-box"},wo={key:0,class:"status-block success"},ko={key:1,class:"status-block none"},xo=["href"],$o=["onClick"],qo=["onClick"],Co={__name:"index",setup(B){const{t:_}=X("views.robot.robot-config.unknown-issue.summarize.index"),T=Xe(),n=qe(),{getRobot:I}=n,l=te(()=>n.robotInfo),b=te(()=>l.value.unknown_summary_status==1),m=se().query;Ce(),c(2);const v=j({start_day:"",end_day:""}),r=j({page:1,size:10,total:0}),M=c([]),L=c(!1),D=()=>{let f={robot_id:m.id,...v,...r};L.value=!0,gt({...f}).then(z=>{M.value=z.data.list.map(S=>({...S,images:S.images?JSON.parse(S.images):[],unknown_list:S.unknown_list?JSON.parse(S.unknown_list):[]})),r.total=+z.data.total||0}).finally(()=>{L.value=!1})};D();const O=f=>{let z=T.getToken,S=v.start_day,V=v.end_day,F=`/manage/getUnknownIssueSummary?robot_id=${m.id}&token=${z}&start_day=${S}&end_day=${V}&export=${f}`;window.location.href=F},N=f=>{r.page=f.current,r.size=f.pageSize,D()},Y=()=>{r.page=1,D()},h=f=>{v.start_day=f.start_time,v.end_day=f.end_time,Y()},d=c(null),p=f=>{d.value.showModal({id:f.id,library_id:f.to_library_id>0?f.to_library_id:"",answer:f.answer,question:f.question,similar_questions:f.unknown_list,images:f.images})},w=c(null),x=()=>{w.value.show({unknown_summary_model_config_id:l.value.unknown_summary_model_config_id,unknown_summary_use_model:l.value.unknown_summary_use_model,unknown_summary_similarity:l.value.unknown_summary_similarity,unknown_summary_status:l.value.unknown_summary_status})},U=f=>{f?w.value.show({unknown_summary_model_config_id:l.value.unknown_summary_model_config_id,unknown_summary_use_model:l.value.unknown_summary_use_model,unknown_summary_similarity:l.value.unknown_summary_similarity,unknown_summary_status:1}):Ye({id:m.id,unknown_summary_model_config_id:l.value.unknown_summary_model_config_id,unknown_summary_use_model:l.value.unknown_summary_use_model,unknown_summary_similarity:l.value.unknown_summary_similarity,unknown_summary_status:0}).then(z=>{H.success(_("save_success")),I(m.id)})},K=c(null),$=f=>{K.value.show({id:f.id,question:f.question,answer:f.answer,unknown_list:f.unknown_list.join(`
`),images:f.images})},J=()=>{I(m.id)};return(f,z)=>{const S=Se,V=ye,F=it,ne=fe,ae=_t,W=ut,_e=dt,de=mt,ee=ct,le=pt,q=Me,i=Je("viewer");return u(),y("div",so,[o(S,{"show-icon":"",style:{"padding-top":"16px"}},{message:a(()=>[e("p",null,s(t(_)("alert_message_1")),1),e("p",null,s(t(_)("alert_message_2")),1)]),_:1}),e("div",ao,[e("div",lo,[e("span",null,s(t(_)("auto_cluster")),1),o(V,null,{title:a(()=>[C(s(t(_)("auto_cluster_tooltip")),1)]),default:a(()=>[o(t(Le)),z[2]||(z[2]=C("： ",-1))]),_:1}),o(F,{onChange:U,checked:b.value,"checked-children":t(_)("switch_on"),"un-checked-children":t(_)("switch_off")},null,8,["checked","checked-children","un-checked-children"]),e("a",{onClick:x},s(t(_)("settings")),1)]),e("div",io,[o(Te,{datekey:"4",onDateChange:h}),o(ne,{type:"primary",onClick:Y},{default:a(()=>[C(s(t(_)("query")),1)]),_:1}),o(_e,null,{overlay:a(()=>[o(W,null,{default:a(()=>[o(ae,{onClick:z[0]||(z[0]=g=>O("docx")),key:"1"},{default:a(()=>[C(s(t(_)("download_docx")),1)]),_:1}),o(ae,{onClick:z[1]||(z[1]=g=>O("xlsx")),key:"2"},{default:a(()=>[C(s(t(_)("download_xlsx")),1)]),_:1})]),_:1})]),default:a(()=>[o(ne,{type:"primary"},{default:a(()=>[C(s(t(_)("download"))+" ",1),o(t(rt))]),_:1})]),_:1})])]),e("div",ro,[o(q,{"data-source":M.value,loading:L.value,pagination:{current:r.page,total:r.total,pageSize:r.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:N},{default:a(()=>[o(ee,{key:"question",title:t(_)("column_cluster_question"),width:480},{default:a(({record:g})=>[e("div",uo,[e("div",_o,[e("div",co,s(t(_)("column_question")),1),e("div",mo,[C(s(g.question)+" ",1),g.unknown_total>0?(u(),A(de,{key:0,placement:"topLeft"},{content:a(()=>[e("div",po,[(u(!0),y(E,null,oe(g.unknown_list,(R,P)=>(u(),y("div",{class:"list-item",key:P},s(R),1))),128))])]),title:a(()=>[e("span",null,s(t(_)("cluster_count",{count:g.unknown_total})),1)]),default:a(()=>[e("a",null,"（"+s(g.unknown_total)+"） ",1)]),_:2},1024)):Q("",!0)])]),g.answer?(u(),y("div",vo,[e("div",fo,s(t(_)("column_answer")),1),e("div",yo,s(g.answer),1)])):Q("",!0),pe((u(),y("div",go,[(u(!0),y(E,null,oe(g.images,(R,P)=>(u(),y("img",{key:P,src:R,alt:""},null,8,ho))),128))])),[[i]])])]),_:1},8,["title"]),o(ee,{key:"show_date",title:t(_)("column_trigger_date"),width:120},{default:a(({record:g})=>[C(s(g.show_date),1)]),_:1},8,["title"]),o(ee,{key:"to_library_id",title:t(_)("column_imported"),width:160},{default:a(({record:g})=>[e("div",bo,[g.to_library_id>0?(u(),y("div",wo,[z[3]||(z[3]=e("span",null,null,-1)),C(" "+s(t(_)("imported_yes")),1)])):(u(),y("div",ko,[z[4]||(z[4]=e("span",null,null,-1)),C(" "+s(t(_)("imported_no")),1)])),e("a",{href:`/#/library/details/knowledge-document?id=${g.to_library_id}`,target:"_blank"},s(g.to_library_name),9,xo)])]),_:1},8,["title"]),o(ee,{key:"action",title:t(_)("column_action"),width:135},{default:a(({record:g})=>[o(le,{gap:8},{default:a(()=>[e("a",{onClick:R=>$(g)},s(t(_)("action_set_answer")),9,$o),e("a",{onClick:R=>p(g)},s(t(_)("action_import_library")),9,qo)]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data-source","loading","pagination"])]),o(Vn,{onOk:D,ref_key:"importLibraryModalRef",ref:d},null,512),o(Zn,{onOk:J,ref_key:"autoClusterModalRef",ref:w},null,512),o(oo,{onOk:D,ref_key:"setAnswerModalRef",ref:K},null,512)])}}},Io=Z(Co,[["__scopeId","data-v-5bd68873"]]),So={class:"user-model-page"},$e="/robot/config/unknown_issue/activeKey",Mo={__name:"unknow-index",setup(B){const{t:_}=X("views.robot.robot-config.unknown-issue.unknow-index"),T=qe(),n=c(+localStorage.getItem($e)||1),I=te(()=>T.robotInfo),l=te(()=>I.value.unknown_summary_status==1),b=()=>{localStorage.setItem($e,n.value)};return(m,v)=>{const r=he,M=ge,L=Ae;return u(),y(E,null,[o(M,{class:"tab-wrapper",activeKey:n.value,"onUpdate:activeKey":v[0]||(v[0]=D=>n.value=D),onChange:b},{default:a(()=>[l.value?(u(),y(E,{key:0},[(u(),A(r,{key:2,tab:t(_)("unknown_issue_summary")},null,8,["tab"])),(u(),A(r,{key:1,tab:t(_)("unknown_issue_statistics")},null,8,["tab"]))],64)):(u(),y(E,{key:1},[(u(),A(r,{key:1,tab:t(_)("unknown_issue_statistics")},null,8,["tab"])),(u(),A(r,{key:2,tab:t(_)("unknown_issue_summary")},null,8,["tab"]))],64))]),_:1},8,["activeKey"]),e("div",So,[o(L,null,{default:a(()=>[n.value==1?(u(),A(Bt,{key:0})):(u(),A(Io,{key:1}))]),_:1})])],64)}}},Xo=Z(Mo,[["__scopeId","data-v-094a48c5"]]);export{Xo as default};
//# sourceMappingURL=unknow-index-CbMEknwu.js.map
