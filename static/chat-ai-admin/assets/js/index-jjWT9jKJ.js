import{_ as Ie}from"./empty-CzGZrENG.js";import{f as m,aw as te,w as De,r as ee,ac as x,ad as c,k as e,ar as t,F as G,ax as X,ae as Y,as as o,at as D,u as L,G as g,n as de,af as Ue,A as ie,az as Z,e as Se}from"./vue-chunks-CGLjTDrY.js";import{i as qe,j as Te,k as Ee,l as Re,m as Ne,n as Ae,o as Ve,p as Le,q as ge,r as Pe,a as Ye,s as ze,t as Je,v as Be}from"./index-D_MN-GJN.js";import{_ as ae,d as Ke,c as je,l as me,bQ as He}from"../../index-CB2DywzJ.js";import{F as oe,e as _e,Q as he,O as Qe,I as ke,T as be,v as pe,ah as xe,M as Q,b as B,w as we,x as Ce,X as Ge,bH as We,y as Xe,z as Ze,bK as et,B as fe,J as Fe,W as ce,o as tt,ax as at,aw as nt,bu as lt,aT as ot,d as st,al as rt,a6 as ve,aH as ut,k as dt,D as it,h as ct,i as _t,a4 as pt,am as ft,a3 as mt,E as vt,G as yt}from"./ui-antd-BHaxN-GS.js";import{a as ye}from"./validate-8MtiUsxW.js";import{d as gt}from"./vuedraggable.umd-B2hsG2dX.js";import{u as ht}from"./database-D6E_MwAz.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";import"./vue-pdf-embed-Bj6uRJ-9.js";const kt={class:"add-data-sheet"},bt={class:"field-name"},xt={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(K,{expose:P,emit:z}){const V=m("添加数据"),S=te().query,v=z,b=K;De(()=>b.column,O=>{l()});const F=m([]),l=()=>{let O=[];b.column.forEach(_=>{y[_.name]="",_.rules=[],_.required=="true"&&_.rules.push({required:!0,message:`请输入${_.name}`}),_.type=="number"&&_.rules.push({type:"number",message:`${_.name}必须为数字`}),_.type=="integer"&&_.rules.push({asyncValidator:N}),_.type=="boolean"&&(y[_.name]="false"),O.push({..._}),F.value=O})},N=(O,_)=>new Promise((p,s)=>_==""||Number.isInteger(+_)?p():s("请输入整数")),A=m(!1),y=ee({form_id:S.form_id}),q=O=>{A.value=!0,$.value&&$.value.resetFields(),l(),y.id="",Object.assign(y,E(O)),y.id?V.value="修改数据":V.value="添加数据"},$=m(null),w=()=>{$.value.validate().then(O=>{qe({...y}).then(_=>{let p=y.id?"修改成功":"添加成功";B.success(p),A.value=!1,v("ok")})})};function E(O){const _={};for(let p in O)if(O.hasOwnProperty(p)){const s=O[p];!isNaN(Number(s))&&typeof s=="string"&&s!=""?_[p]=Number(s):_[p]=s}return _}return P({show:q}),(O,_)=>{const p=pe,s=be,R=he,i=Qe,d=ke,I=_e,r=oe,a=Q;return c(),x("div",kt,[e(a,{open:A.value,"onUpdate:open":_[0]||(_[0]=n=>A.value=n),title:V.value,onOk:w,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(r,{style:{"margin-top":"16px"},model:y,ref_key:"formRef",ref:$,layout:"vertical"},{default:t(()=>[(c(!0),x(G,null,X(F.value,n=>(c(),Y(I,{name:n.name,key:n.id,rules:n.rules},{label:t(()=>[e(s,{gap:4,style:{width:"100%"}},{default:t(()=>[o("div",bt,D(n.name),1),e(p,null,{title:t(()=>[g(D(n.description),1)]),default:t(()=>[e(L(xe))]),_:2},1024)]),_:2},1024)]),default:t(()=>[n.type=="boolean"?(c(),Y(R,{key:0,checked:y[n.name],"onUpdate:checked":u=>y[n.name]=u,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):n.type=="number"||n.type=="integer"?(c(),Y(i,{key:1,style:{width:"100%"},value:y[n.name],"onUpdate:value":u=>y[n.name]=u,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(c(),Y(d,{key:2,value:y[n.name],"onUpdate:value":u=>y[n.name]=u,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},wt=ae(xt,[["__scopeId","data-v-0de1a1fc"]]),Ct={__name:"export-modal",setup(K,{expose:P}){const V=te().query,T=m("导出数据"),S=m(!1),v=ee({dates:[],type:1}),b=()=>{S.value=!0,v.type=1,v.dates=[]},F=ee({dates:[{validator:async($,w)=>v.type==2&&!w.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),l=oe.useForm,{resetFields:N,validate:A,validateInfos:y}=l(v,F),q=()=>{A().then(()=>{let $={form_id:V.form_id};v.type==2&&($.start_date=v.dates[0],$.end_date=v.dates[1]),Te($),S.value=!1})};return P({show:b}),($,w)=>{const E=Ce,O=we,_=_e,p=Ge,s=oe,R=Q;return c(),x("div",null,[e(R,{open:S.value,"onUpdate:open":w[2]||(w[2]=i=>S.value=i),title:T.value,onOk:q,width:450},{default:t(()=>[e(s,{class:"mt16",layout:"vertical"},{default:t(()=>[e(_,{label:""},{default:t(()=>[e(O,{value:v.type,"onUpdate:value":w[0]||(w[0]=i=>v.type=i),name:"radioGroup"},{default:t(()=>[e(E,{value:1},{default:t(()=>[...w[3]||(w[3]=[g("全部数据",-1)])]),_:1}),e(E,{value:2},{default:t(()=>[...w[4]||(w[4]=[g("自定义日期",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),de(e(_,Ue({required:"",label:"选择导出日期"},L(y).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":w[1]||(w[1]=i=>v.dates=i),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[ie,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},Ft=ae(Ct,[["__scopeId","data-v-ca624632"]]),$t={class:"add-data-sheet"},Ot={class:"filter-list-box"},Mt={style:{"margin-left":"48px"}},It={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(K,{expose:P,emit:z}){const V=m("添加分类"),S=te().query,v=z,b=K;m([]);const F=m(!1),l=ee({form_id:S.form_id,name:"",condition:[],type:"1",id:""}),N=()=>{let r=[{form_field_id:b.column[0].id,form_filed_type:b.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];l.condition=r},A=r=>{l.condition.splice(r,1)},y=(r,a)=>{r.rule=void 0,r.rule_value1="",r.rule_value2="",r.form_filed_type=b.column.filter(n=>n.id==r.form_field_id)[0].type},q=(r,a)=>a.form_field_id==r.id?!1:l.condition.map(u=>u.form_field_id).includes(r.id),$=()=>{let r=l.condition.map(n=>n.form_field_id),a=b.column.filter(n=>!r.includes(n.id));if(!a.length){B.error("字段已全部添加");return}l.condition.push({form_field_id:a[0].id,form_filed_type:a[0].type,rule:void 0,rule_value1:"",rule_value2:""})},w=r=>!r.rule||r.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(r.rule),E=r=>!r.rule||r.form_filed_type=="boolean"?!1:["between"].includes(r.rule),O=(r,a,n)=>new Promise((u,U)=>w(n)?a?n.form_filed_type=="integer"?Number.isInteger(+a)?u():U("请输入整数"):n.form_filed_type=="number"?ye(a)?u():U("请输入数字"):u():U("请输入"):u()),_=(r,a,n)=>new Promise((u,U)=>E(n)?a?n.form_filed_type=="integer"?Number.isInteger(+a)?+a<+n.rule_value1?U("右边的值需要大于左边的值"):u():U("请输入整数"):n.form_filed_type=="number"?ye(a)?+a<+n.rule_value1?U("右边的值需要大于左边的值"):u():U("请输入数字"):u():U("请输入"):u()),p=()=>{F.value=!0,V.value="添加分类",N(),l.name="",l.type="1",l.id=""},s=r=>{F.value=!0,V.value="编辑分类",Ee({form_id:S.form_id,id:r.id}).then(a=>{let n=a.data.conditions||"[]";n=JSON.parse(n),n=n.map(u=>({form_field_id:u.form_field_id+"",form_filed_type:b.column.filter(U=>U.id==u.form_field_id)[0].type,rule:R(u.rule),rule_value1:u.rule_value1,rule_value2:u.rule_value2})),l.condition=n,l.name=a.data.name,l.type=a.data.type,l.id=a.data.id})};function R(r){const a=["string_","integer_","number_","boolean_"];for(const n of a)if(r.startsWith(n))return r.slice(n.length);return r}const i=m(null),d=()=>{i.value.validate().then(r=>{let a=l.condition.map(f=>({form_field_id:+f.form_field_id,rule:f.form_filed_type+"_"+f.rule,rule_value1:f.rule_value1,rule_value2:f.rule_value2})),n={...l,condition:JSON.stringify(a)},u=Re,U="添加成功";l.id&&(u=Ne,U="编辑成功"),u(n).then(f=>{B.success(U),F.value=!1,v("ok")})}).catch(r=>{})},I=m({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return P({show:p,edit:s}),(r,a)=>{const n=ke,u=_e,U=Ze,f=Xe,h=We,j=fe,H=Ce,le=we,se=oe,re=Q;return c(),x("div",$t,[e(re,{open:F.value,"onUpdate:open":a[2]||(a[2]=M=>F.value=M),title:V.value,onOk:d,width:790},{default:t(()=>[e(se,{class:"form-box",style:{"margin-top":"16px"},model:l,ref_key:"filterFormRef",ref:i,layout:"vertical"},{default:t(()=>[e(u,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(n,{maxLength:64,value:l.name,"onUpdate:value":a[0]||(a[0]=M=>l.name=M),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),a[6]||(a[6]=o("div",{class:"form-required-item"},"筛选条件",-1)),o("div",Ot,[(c(!0),x(G,null,X(l.condition,(M,J)=>(c(),Y(h,{key:J,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[o("div",null,"条件"+D(J+1)+":",1),e(u,null,{default:t(()=>[e(f,{value:M.form_field_id,"onUpdate:value":k=>M.form_field_id=k,style:{width:"150px"},placeholder:"请选择",onChange:k=>y(M,J)},{default:t(()=>[(c(!0),x(G,null,X(b.column,k=>(c(),Y(U,{disabled:q(k,M),key:k.id,value:k.id},{default:t(()=>[g(D(k.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(u,{name:["condition",J,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(f,{value:M.rule,"onUpdate:value":k=>M.rule=k,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(c(!0),x(G,null,X(I.value[M.form_filed_type],k=>(c(),Y(U,{key:k.value,value:k.value},{default:t(()=>[g(D(k.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),de(e(u,{name:["condition",J,"rule_value1"],rules:{asyncValidator:(k,ne)=>O(k,ne,M)}},{default:t(()=>[e(n,{value:M.rule_value1,"onUpdate:value":k=>M.rule_value1=k,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[ie,w(M)]]),de(e(u,{name:["condition",J,"rule_value2"],rules:{asyncValidator:(k,ne)=>_(k,ne,M),trigger:"blur"}},{default:t(()=>[e(n,{value:M.rule_value2,"onUpdate:value":k=>M.rule_value2=k,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[ie,E(M)]]),l.condition.length>1?(c(),Y(L(et),{key:0,onClick:k=>A(J)},null,8,["onClick"])):Z("",!0)]),_:2},1024))),128)),o("div",Mt,[e(j,{onClick:$},{default:t(()=>[...a[3]||(a[3]=[g("添加条件",-1)])]),_:1})])]),e(u,{label:"条件之间关系",required:""},{default:t(()=>[e(le,{value:l.type,"onUpdate:value":a[1]||(a[1]=M=>l.type=M)},{default:t(()=>[e(H,{value:"1"},{default:t(()=>[...a[4]||(a[4]=[g("与（And）",-1)])]),_:1}),e(H,{value:"2"},{default:t(()=>[...a[5]||(a[5]=[g("或（Or）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},$e=ae(It,[["__scopeId","data-v-81eb5a66"]]),Dt={class:"custom-table"},Ut={class:"t-body"},St={class:"t-row"},qt={class:"t-item"},Tt={class:"t-item"},Et={class:"drag-btn"},Rt={key:0},Nt={key:1},At={class:"t-item"},Vt={class:"t-item flex-none",style:{width:"120px"}},Lt=["onClick"],Pt=["onClick"],Yt={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(K,{expose:P,emit:z}){const T=te().query,S=z,v=m("管理分类"),b=m(!1),F=K,l=()=>{ge({form_id:T.form_id}).then(p=>{q.value=p.data.map(s=>({...s}))})},N=()=>{l(),S("ok"),S("change")},A=()=>{l(),b.value=!0},y=()=>{b.value=!1},q=m(),$=()=>{let p=[];q.value.reverse().forEach((s,R)=>{p.push({id:+s.id,sort:+R+1})}),Ae({form_id:T.form_id,filter_sort:JSON.stringify(p)}).then(s=>{B.success("排序成功"),l(),S("change")})},w=p=>{Ve({form_id:T.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(s=>{B.success("设置成功"),l(),S("change")})},E=(p,s)=>{Q.confirm({title:"删除确认",icon:e(ce),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Le({id:p.id,form_id:T.form_id}).then(R=>{B.success("删除成功"),q.value.splice(s,1),S("change")})},onCancel(){}})},O=m(null),_=p=>{O.value.edit(p)};return P({show:A}),(p,s)=>{const R=he,i=Ke,d=pe,I=Fe,r=Q;return c(),x("div",null,[e(r,{open:b.value,"onUpdate:open":s[1]||(s[1]=a=>b.value=a),title:v.value,onCancel:y,footer:null,width:760},{default:t(()=>[o("div",Dt,[s[6]||(s[6]=o("div",{class:"t-head"},[o("div",{class:"td"},[o("div",{style:{width:"24px"}}),g(" 分类名称 ")]),o("div",{class:"td"},"类型"),o("div",{class:"td"},"启用分类"),o("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),o("div",Ut,[o("div",St,[s[2]||(s[2]=o("div",{class:"t-item"},[o("div",{style:{width:"24px"}}),g(" 全部 ")],-1)),s[3]||(s[3]=o("div",{class:"t-item"},"系统分类",-1)),o("div",qt,[e(R,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),s[4]||(s[4]=o("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1))]),e(L(gt),{modelValue:q.value,"onUpdate:modelValue":s[0]||(s[0]=a=>q.value=a),"item-key":"id",onEnd:$,group:"table-rows",handle:".drag-btn"},{item:t(({element:a,index:n})=>[(c(),x("div",{key:a.id,class:"t-row"},[o("div",Tt,[o("span",Et,[e(i,{name:"drag"})]),a.name.length>10?(c(),x("span",Rt,[e(d,null,{title:t(()=>[g(D(a.name),1)]),default:t(()=>[g(" "+D(a.name.slice(0,10)+"..."),1)]),_:2},1024)])):(c(),x("span",Nt,D(a.name),1))]),s[5]||(s[5]=o("div",{class:"t-item"},"自定义分类",-1)),o("div",At,[e(R,{onChange:u=>w(a),checked:a.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),o("div",Vt,[o("a",{onClick:u=>_(a)},"编辑",8,Lt),e(I,{type:"vertical"}),o("a",{onClick:u=>E(a,n)},"删除",8,Pt)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e($e,{onOk:N,column:F.column,ref_key:"addFilrerModalRef",ref:O},null,8,["column"])])}}},zt=ae(Yt,[["__scopeId","data-v-f1db0fc5"]]),Jt={class:"upload-box"},Bt={class:"ant-upload-drag-icon"},Kt={key:0,class:"progress-box"},jt={key:0},Ht={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(K,{expose:P,emit:z}){const V=je(),T=z,S=te().query,v=K,b=m(!1),F=m(!1),l=ee({total:0,success:0,err_data:[]}),N=m([]),A=i=>{const d=i.file.status;if(d==="done")if(i.file.response.res==0){let I=i.file.response.data.task_id;$(I)}else return N.value=[],B.error(i.file.response.msg);else d==="error"&&(N.value=[],B.error(`${i.file.name} file upload failed.`))};function y(i){}let q=null;const $=i=>{q&&clearInterval(q),b.value=!1,p.value=!0,s.value=10,l.total=0,l.success=0,l.err_data=[],q=setInterval(()=>{Pe({task_id:i}).then(d=>{let I=d.data;s.value=(I.processed/I.total).toFixed(),I.finish&&(T("ok"),clearInterval(q),s.value=100),I.total>0&&(l.total=I.total,l.success=I.success,l.err_data=I.err_data)}).catch(()=>{clearInterval(q)})},2e3)},w=()=>{let i;i=v.column.map(d=>d.name),i="id,"+i.join(",")+`
`,me(i,[],[],"导入数据模板.csv")},E=()=>{let i={id:""};v.column.forEach(d=>{i[d.name]=""}),He([i],"导入数据模板.json")},O=()=>{N.value=[],b.value=!0},_=()=>{},p=m(!1),s=m(10),R=()=>{let i="id,",d=["id"];for(let a in l.err_data[0])a!="id"&&a!="err_msg"&&(i+=a+",",d.push(a));i=i+`err_msg
`,d.push("err_msg");let I=l.err_data,r="失败数据_"+st().format("YYYY/MM/DD HH:mm")+".xlsx";me(i,I,d,r)};return P({show:O}),(i,d)=>{const I=tt,r=at,a=Q,n=lt,u=fe,U=ot;return c(),x("div",null,[e(a,{open:b.value,"onUpdate:open":d[1]||(d[1]=f=>b.value=f),title:"导入数据","confirm-loading":F.value,onOk:_,footer:null,width:746},{default:t(()=>[e(I,{"show-icon":"",class:"alert-box"},{message:t(()=>[o("div",null,[d[3]||(d[3]=g(" 支持通过Excel或者json文件导入数据。 ",-1)),o("a",{onClick:w,class:"mr8"},"excel模板"),o("a",{onClick:E},"json模板")]),d[4]||(d[4]=o("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1))]),_:1}),o("div",Jt,[e(r,{fileList:N.value,"onUpdate:fileList":d[0]||(d[0]=f=>N.value=f),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:L(V).getToken},data:{form_id:L(S).form_id},action:"/manage/uploadFormFile",onChange:A,onDrop:y},{default:t(()=>[o("p",Bt,[e(L(nt))]),d[5]||(d[5]=o("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),d[6]||(d[6]=o("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1))]),_:1},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(a,{open:p.value,"onUpdate:open":d[2]||(d[2]=f=>p.value=f),title:"导入数据",footer:null,width:746},{default:t(()=>[s.value<100?(c(),x("div",Kt,[e(n,{type:"circle",percent:s.value},null,8,["percent"]),d[7]||(d[7]=o("div",{class:"tip"},"数据导入中，请勿关闭页面",-1))])):(c(),Y(U,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[g("导入成功"+D(l.success)+"，导入失败"+D(l.total-l.success)+" ",1),l.total-l.success>0?(c(),x("span",jt," 您可以下载失败数据，修改后重新导入 ")):Z("",!0)]),extra:t(()=>[l.total-l.success>0?(c(),Y(u,{key:0,onClick:R,type:"primary"},{default:t(()=>[...d[8]||(d[8]=[g("下载失败数据",-1)])]),_:1})):Z("",!0)]),_:1}))]),_:1},8,["open"])])}}},Qt=ae(Ht,[["__scopeId","data-v-c09a8f6a"]]),Gt={key:0,class:"loading-box"},Wt={key:1,class:"empty-box"},Xt={key:2,class:"field-manage-page"},Zt={class:"page-title"},ea={key:0},ta={key:1},aa={class:"table-wrapper customize-scroll-style"},na={key:0},la={key:1},oa={key:0},sa={key:1},ra=["onClick"],ua=["onClick"],da={__name:"index",setup(K){const P=ht(),z=Se(()=>P.databaseInfo.entry_count),T=te().query,S=m([]),v=m([]),b=m(!0),F=ee({form_id:T.form_id,page:1,size:10,total:0}),l=m(!1),N=f=>{F.page=f.current,F.size=f.pageSize,y()},A=()=>{F.page=1,y()},y=()=>{l.value=!0,ze({...F,filter_id:$.value}).then(f=>{S.value=f.data.list||[],F.total=+f.data.total||0,P.getDatabaseInfo({id:T.form_id})}).finally(()=>{l.value=!1})};Ye({form_id:T.form_id}).then(f=>{v.value=f.data,b.value=!1,y()});const q=m([]),$=m(""),w=()=>{ge({form_id:T.form_id}).then(f=>{let h=f.data||[];if(q.value=h.filter(j=>j.enabled=="true"),$.value){let j=h.filter(H=>H.id==$.value);(j.length&&j[0].enabled=="false"||!j.length)&&($.value="",y())}})};w();const E=()=>{w(),y()},O=()=>{F.page=1,y()},_=m(null),p=(f,h)=>{h==="add"&&_.value.show()},s=f=>{Q.confirm({title:"删除确认",icon:e(ce),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Be({id:f.id}).then(h=>{B.success("删除成功"),E()})},onCancel(){}})},R=()=>{Q.confirm({title:"清空数据提示",icon:e(ce),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){Je({form_id:T.form_id}).then(f=>{B.success("清空成功"),E()})},onCancel(){}})},i=m(null),d=(f={})=>{i.value.show(JSON.parse(JSON.stringify(f)))},I=m(null),r=(f={})=>{I.value.show()},a=m(null),n=()=>{a.value.show()},u=m(null),U=()=>{u.value.show()};return(f,h)=>{const j=rt,H=fe,le=_t,se=ct,re=dt,M=be,J=pt,k=pe,ne=mt,ue=vt,Oe=Fe,Me=yt;return c(),x(G,null,[b.value?(c(),x("div",Gt,[e(j)])):Z("",!0),!b.value&&!v.value.length?(c(),x("div",Wt,[...h[3]||(h[3]=[o("img",{src:Ie,alt:""},null,-1),o("div",null,"暂无字段, 请先去添加字段",-1)])])):Z("",!0),!b.value&&v.value.length?(c(),x("div",Xt,[o("div",Zt,[h[7]||(h[7]=g(" 数据管理 ",-1)),e(M,{gap:16},{default:t(()=>[e(H,{type:"primary",onClick:h[0]||(h[0]=C=>d())},{icon:t(()=>[e(L(ve))]),default:t(()=>[h[4]||(h[4]=g(" 添加数据 ",-1))]),_:1}),e(H,{onClick:h[1]||(h[1]=C=>r())},{icon:t(()=>[e(L(ut))]),default:t(()=>[h[5]||(h[5]=g(" 导入数据 ",-1))]),_:1}),e(re,null,{overlay:t(()=>[e(se,null,{default:t(()=>[e(le,{key:"1"},{default:t(()=>[o("div",{onClick:n},"导出数据")]),_:1}),e(le,{key:"2"},{default:t(()=>[o("div",{onClick:R},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(H,null,{default:t(()=>[h[6]||(h[6]=g(" 更多操作 ",-1)),e(L(it))]),_:1})]),_:1})]),_:1})]),e(ne,{class:"tabs-wrapper",activeKey:$.value,"onUpdate:activeKey":h[2]||(h[2]=C=>$.value=C),type:"editable-card",onEdit:p,onChange:O},{addIcon:t(()=>[e(L(ve)),h[8]||(h[8]=g(" 添加分类 ",-1))]),rightExtra:t(()=>[o("span",{class:"setting-btn",onClick:U},[e(L(ft)),h[9]||(h[9]=g(" 管理分类 ",-1))])]),default:t(()=>[e(J,{key:"",closable:!1},{tab:t(()=>[g("全部 ("+D(z.value)+")",1)]),_:1}),(c(!0),x(G,null,X(q.value,C=>(c(),Y(J,{key:C.id,closable:!1},{tab:t(()=>[C.name.length>8?(c(),x("span",ea,[e(k,null,{title:t(()=>[g(D(C.name),1)]),default:t(()=>[g(" "+D(C.name.slice(0,8)+"..."),1)]),_:2},1024)])):(c(),x("span",ta,D(C.name),1)),g(" ("+D(C.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),o("div",aa,[e(Me,{sticky:"","data-source":S.value,loading:l.value,scroll:{x:1e3},pagination:{current:F.page,total:F.total,pageSize:F.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:N},{default:t(()=>[e(ue,{key:"id","data-index":"id",title:"id",width:60}),(c(!0),x(G,null,X(v.value,C=>(c(),Y(ue,{key:C.name,"data-index":C.name,width:165},{title:t(()=>[C.name.length>12?(c(),x("span",na,[e(k,null,{title:t(()=>[g(D(C.name),1)]),default:t(()=>[g(" "+D(C.name.slice(0,12)+"..."),1)]),_:2},1024)])):(c(),x("span",la,D(C.name),1)),e(k,null,{title:t(()=>[g(D(C.description),1)]),default:t(()=>[e(L(xe),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:W})=>[W[C.name].length>10?(c(),x("span",oa,[e(k,null,{title:t(()=>[g(D(W[C.name]),1)]),default:t(()=>[g(" "+D(W[C.name].slice(0,9)+"..."),1)]),_:2},1024)])):(c(),x("span",sa,D(W[C.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(ue,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:C})=>[o("span",null,[o("a",{onClick:W=>d(C)},"编辑",8,ra),e(Oe,{type:"vertical"}),o("a",{onClick:W=>s(C)},"删除",8,ua)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(wt,{onOk:E,column:v.value,ref_key:"addDataModalRef",ref:i},null,8,["column"]),e($e,{onOk:E,column:v.value,ref_key:"addFilrerModalRef",ref:_},null,8,["column"]),e(Ft,{ref_key:"exportModalRef",ref:a},null,512),e(zt,{onOk:y,onChange:w,column:v.value,ref_key:"filterManageModalRef",ref:u},null,8,["column"]),e(Qt,{onOk:A,column:v.value,ref_key:"importDataModalRef",ref:I},null,8,["column"])])):Z("",!0)],64)}}},xa=ae(da,[["__scopeId","data-v-fe0434d1"]]);export{xa as default};
