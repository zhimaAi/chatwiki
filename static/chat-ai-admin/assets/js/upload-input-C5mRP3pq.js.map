{"version":3,"file":"upload-input-C5mRP3pq.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/library/add-library/components/upload-input.vue"],"sourcesContent":["<template>\r\n  <div class=\"upload-input\" :class=\"{ disabled: fileList.length >= props.maxCount }\">\r\n    <a-upload-dragger :file-list=\"fileList\" name=\"file\" :multiple=\"true\" :max-count=\"props.maxCount\" :accept=\"getAccept\"\r\n      :beforeUpload=\"beforeUpload\" @remove=\"handleRemove\" class=\"ant-upload-drag\">\r\n      <div class=\"ant-upload-drag-icon\">\r\n        <inbox-outlined></inbox-outlined>\r\n      </div>\r\n      <div class=\"ant-upload-text\">{{ t('upload_text') }}</div>\r\n      <div class=\"ant-upload-hint\">\r\n        <p>{{ t('upload_hint', { maxCount: props.maxCount }) }}</p>\r\n        <p>\r\n          <span>{{ t('support_file_types') }}</span><span class=\"ant-upload-hint-ext\" v-for=\"ext in fileTypes\" :key=\"ext\">.{{ ext }}</span>\r\n        </p>\r\n      </div>\r\n    </a-upload-dragger>\r\n\r\n    <div class=\"disabled-mask\" @click=\"showMaxCountErrorTip\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { InboxOutlined } from '@ant-design/icons-vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.library.add-library.components.upload-input')\r\n\r\nconst emit = defineEmits(['change', 'update:value'])\r\n\r\nconst props = defineProps({\r\n  value: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  maxCount: {\r\n    type: Number,\r\n    default: 1\r\n  },\r\n  type: {\r\n    type: [String, Number],\r\n    default: 0\r\n  },\r\n})\r\n\r\nlet fileTypes = ['pdf', 'docx', 'ofd', 'txt', 'md', 'xlsx', 'csv', 'html']\r\nif(props.type == 2){\r\n  fileTypes = ['docx', 'csv', 'xlsx']\r\n}\r\nconst getAccept = computed(() => {\r\n  return fileTypes.map((item) => `.${item}`).join(',')\r\n})\r\n\r\nconst fileList = ref([])\r\n\r\nwatch(\r\n  () => props.value,\r\n  (val) => {\r\n    fileList.value = val\r\n  },\r\n  {\r\n    immediate: true\r\n  }\r\n)\r\n\r\nlet timer = null\r\n\r\nconst showMaxCountErrorTip = () => {\r\n  if (fileList.value.length >= props.maxCount) {\r\n    return message.error(t('max_files_error', { maxCount: props.maxCount }))\r\n  }\r\n}\r\n\r\nconst onChange = () => {\r\n  if (fileList.value.length > props.maxCount) {\r\n    message.error(t('max_files_error', { maxCount: props.maxCount }))\r\n  }\r\n\r\n  let files = [...fileList.value]\r\n\r\n  emit('change', files)\r\n\r\n  emit('update:value', files)\r\n}\r\n\r\nconst handleRemove = (file) => {\r\n  removeFile(file)\r\n\r\n  onChange()\r\n}\r\n\r\nconst removeFile = (file) => {\r\n  for (let i = 0; i < fileList.value.length; i++) {\r\n    if (fileList.value[i].uid === file.uid) {\r\n      fileList.value.splice(i, 1)\r\n      break\r\n    }\r\n  }\r\n}\r\n\r\nconst beforeUpload = (file) => {\r\n  const ext = file.name.split('.').pop()\r\n  const isWhitelistFile = fileTypes.includes(ext.toLowerCase())\r\n\r\n  if (!isWhitelistFile) {\r\n    message.error(t('unsupported_format_error'))\r\n    return false\r\n  }\r\n\r\n  const isLt100M = file.size / 1024 / 1024 < 100\r\n\r\n  if (!isLt100M) {\r\n    message.error(t('file_size_error'))\r\n    return false\r\n  }\r\n\r\n  fileList.value = [...(fileList.value || []), file]\r\n\r\n  if (fileList.value.length > props.maxCount) {\r\n    fileList.value = fileList.value.splice(0, props.maxCount)\r\n  }\r\n\r\n  if (timer) {\r\n    clearTimeout(timer)\r\n  }\r\n\r\n  timer = setTimeout(() => {\r\n    onChange()\r\n    clearTimeout(timer)\r\n  }, 50)\r\n\r\n  return false\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.ant-upload-drag {\r\n  .ant-upload-drag-icon {\r\n    font-size: 48px;\r\n    color: #2475fc;\r\n  }\r\n\r\n  .ant-upload-text {\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n    text-align: center;\r\n    color: #000000;\r\n  }\r\n\r\n  .ant-upload-hint {\r\n    line-height: 20px;\r\n    margin-top: 4px;\r\n    font-size: 12px;\r\n    color: rgba(0, 0, 0, 0.45);\r\n    text-align: center;\r\n  }\r\n}\r\n\r\n.upload-input {\r\n  .ant-upload-hint-ext {\r\n    padding-right: 4px;\r\n  }\r\n\r\n  .disabled-mask {\r\n    display: none;\r\n    cursor: pointer;\r\n    height: 176px;\r\n  }\r\n\r\n  &.disabled {\r\n    position: relative;\r\n\r\n    .disabled-mask {\r\n      display: block;\r\n      position: absolute;\r\n      left: 0;\r\n      right: 0;\r\n      top: 0;\r\n      bottom: 0;\r\n      opacity: 0;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["t","useI18n","emit","__emit","props","__props","fileTypes","getAccept","computed","item","fileList","ref","watch","val","timer","showMaxCountErrorTip","message","onChange","files","handleRemove","file","removeFile","i","beforeUpload","ext","_createElementBlock","_normalizeClass","_createVNode","_component_a_upload_dragger","_createElementVNode","_hoisted_1","_unref","InboxOutlined","_hoisted_2","_toDisplayString","_hoisted_3","_Fragment","_renderList"],"mappings":"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"}