{"version":3,"file":"chat-BLPxWtxf.js","sources":["../../../../front-end/chat-ai-admin-vue/src/stores/modules/chat.js"],"sourcesContent":["import { reactive, ref } from 'vue'\r\nimport { defineStore } from 'pinia'\r\nimport {\r\n  sendAiMessage,\r\n  chatWelcome,\r\n  getDialogueList,\r\n  getChatMessage,\r\n  questionGuide,\r\n  getSessionRecordList,\r\n  getSessionChannelList,\r\n  editVariables,\r\n} from '@/api/chat'\r\nimport { editPrompt } from '@/api/robot/index'\r\nimport { getUuid, getOpenid, devLog, extractVoiceInfo, removeVoiceFormat } from '@/utils/index'\r\nimport { useEventBus } from '@/hooks/event/useEventBus'\r\nimport { useIM } from '@/hooks/event/useIM'\r\nimport { DEFAULT_USER_AVATAR } from '@/constants/index'\r\n\r\nexport const useChatStore = defineStore('chat', () => {\r\n  const emitter = useEventBus()\r\n  const messageList = ref([])\r\n  const im = useIM()\r\n\r\n  let mySSE = null\r\n\r\n  // 对话id\r\n  const dialogue_id = ref(0)\r\n  const rel_user_id = ref()\r\n\r\n  const openid = ref('')\r\n  // 用户信息\r\n  const user = reactive({\r\n    admin_user_id: '',\r\n    avatar: '',\r\n    id: '',\r\n    name: '',\r\n    nickname: '',\r\n    openid: ''\r\n  })\r\n  // 机器人的信息\r\n  const robot = reactive({\r\n    id: '',\r\n    library_ids: '',\r\n    form_ids: '',\r\n    prompt: '',\r\n    robot_avatar: '',\r\n    robot_intro: '',\r\n    robot_key: '',\r\n    robot_name: '',\r\n    openid: '',\r\n    welcomes: { reasoning_content: '', content: '', question: [] },\r\n    enable_question_guide: false,\r\n    enable_common_question: false,\r\n    common_question_list: [],\r\n    question_multiple_switch: 0,\r\n  })\r\n\r\n  const chat_variables = ref({\r\n    need_fill_variable: false,\r\n    fill_variables: [],\r\n    wait_variables: [],\r\n    session_id: 0,\r\n    dialogue_id: 0,\r\n  })\r\n\r\n  // 存储聊天记录必备的数据\r\n  const createMsg = async (data) => {\r\n    messageList.value = []\r\n    // 重置聊天记录是否加载完成的状态\r\n    chatMessageLoadCompleted.value = false\r\n    sendLock.value = false\r\n\r\n    if (!data.dialogue_id) {\r\n      dialogue_id.value = 0\r\n    } else {\r\n      dialogue_id.value = data.dialogue_id\r\n    }\r\n\r\n    rel_user_id.value = data.rel_user_id\r\n\r\n    openid.value = data.openid || getOpenid(16)\r\n\r\n    robot.robot_key = data.robot_key\r\n    robot.openid = openid.value\r\n\r\n    user.openid = openid.value\r\n    user.avatar = data.avatar || DEFAULT_USER_AVATAR\r\n    user.name = data.name || ''\r\n    user.nickname = data.nickname || ''\r\n  }\r\n\r\n  // 创建对话\r\n  const isNewChat = ref(false)\r\n  const createChat = async (data) => {\r\n    if (mySSE) {\r\n      mySSE.abort()\r\n      mySSE = null\r\n    }\r\n    messageList.value = []\r\n    // 重置聊天记录是否加载完成的状态\r\n    chatMessageLoadCompleted.value = false\r\n    sendLock.value = false\r\n\r\n    if (!data.dialogue_id) {\r\n      isNewChat.value = true\r\n      dialogue_id.value = 0\r\n    } else {\r\n      isNewChat.value = false\r\n      dialogue_id.value = data.dialogue_id\r\n    }\r\n\r\n    openid.value = data.openid || getOpenid(data.robot_key)\r\n\r\n    robot.robot_key = data.robot_key\r\n    robot.openid = openid.value\r\n\r\n    user.openid = openid.value\r\n    user.avatar = data.avatar || DEFAULT_USER_AVATAR\r\n    user.name = data.name || ''\r\n    user.nickname = data.nickname || ''\r\n\r\n    const res = await chatWelcome({\r\n      robot_key: robot.robot_key,\r\n      openid: openid.value,\r\n      nickname: user.nickname,\r\n      name: user.name,\r\n      // avatar: user.avatar || DEFAULT_USER_AVATAR, // lion要求把请求的avatar 干掉\r\n      is_background: data.is_background || undefined,\r\n      dialogue_id: dialogue_id.value,\r\n    })\r\n\r\n    try {\r\n      let userInfo = res.data.customer\r\n      let robotInfo = res.data.robot\r\n      user.admin_user_id = userInfo.admin_user_id\r\n      user.avatar = userInfo.avatar\r\n      user.id = userInfo.id\r\n      user.name = userInfo.name\r\n      user.nickname = userInfo.nickname\r\n      robot.library_ids = robotInfo.library_ids\r\n      robot.prompt = robotInfo.prompt\r\n      robot.robot_avatar = robotInfo.robot_avatar\r\n      robot.robot_intro = robotInfo.robot_intro\r\n      robot.robot_key = robotInfo.robot_key\r\n      robot.robot_name = robotInfo.robot_name\r\n      robot.form_ids = robotInfo.form_ids\r\n      robot.id = robotInfo.id\r\n      robot.enable_question_guide = robotInfo.enable_question_guide == 'true'\r\n      robot.enable_common_question = robotInfo.enable_common_question == 'true'\r\n      robot.common_question_list = robotInfo.common_question_list\r\n      robot.question_multiple_switch = Number(robotInfo.question_multiple_switch) || 0\r\n      \r\n      if (robotInfo.welcomes) {\r\n        robot.welcomes = JSON.parse(robotInfo.welcomes)\r\n      }\r\n\r\n      chat_variables.value = {}\r\n      \r\n      setTimeout(()=>{\r\n        chat_variables.value = res.data.chat_variable || {}\r\n      })\r\n\r\n      // 插入欢迎语\r\n      insertWelcomeMsg(res.data.message)\r\n      // 连接im\r\n      im.connect(openid.value)\r\n      im.on('message', onImMessage)\r\n\r\n      return res\r\n    } catch (e) {\r\n      Promise.reject(e)\r\n    }\r\n  }\r\n\r\n  // 插入来自im的聊天记录\r\n  const onImMessage = (msg) => {\r\n    if (!msg) {\r\n      return\r\n    }\r\n\r\n    if (msg.msg_type == 'receiver_notify') {\r\n      return\r\n    }\r\n\r\n    if (msg.dialogue_id != dialogue_id.value) {\r\n      return\r\n    }\r\n\r\n    msg.uid = getUuid(32)\r\n    msg.loading = false\r\n    msg.isWelcome = true\r\n    msg.name = msg.name || msg.nickname\r\n    if (msg.is_customer == 1) {\r\n      msg.name = msg.name || user.name\r\n      msg.avatar = msg.avatar || user.avatar\r\n    } else {\r\n      msg.name = msg.name || robot.name\r\n      msg.robot_avatar = msg.avatar || robot.robot_avatar\r\n    }\r\n\r\n    if (msg.menu_json && typeof msg.menu_json === 'string') {\r\n      msg.menu_json = JSON.parse(msg.menu_json)\r\n    }\r\n\r\n    if (msg.quote_file && typeof msg.quote_file === 'string') {\r\n      msg.quote_file = JSON.parse(msg.quote_file)\r\n    }\r\n    if (msg.reply_content_list && typeof msg.reply_content_list === 'string') {\r\n      try { msg.reply_content_list = JSON.parse(msg.reply_content_list) } catch (_) { msg.reply_content_list = [] }\r\n    }\r\n\r\n    messageList.value.push(msg)\r\n\r\n    emitter.emit('updateAiMessage', msg)\r\n  }\r\n\r\n  //  插入欢迎语\r\n  const insertWelcomeMsg = (msg) => {\r\n    if (msg) {\r\n      msg.uid = getUuid(32)\r\n      msg.loading = false\r\n      msg.isWelcome = true\r\n      msg.robot_avatar = robot.robot_avatar\r\n\r\n      if (msg.menu_json) {\r\n        msg.menu_json = JSON.parse(msg.menu_json)\r\n      }\r\n\r\n      if (msg.quote_file) {\r\n        msg.quote_file = JSON.parse(msg.quote_file)\r\n      }\r\n\r\n      messageList.value.push(msg)\r\n    }\r\n  }\r\n  // 推送用户的消息到列表\r\n  const pushUserMessage = (msg) => {\r\n    msg.uid = getUuid(32)\r\n    msg.loading = false\r\n    msg.avatar = user.avatar\r\n    msg.openid = user.openid\r\n    msg.msg_type = msg.msg_type || 1\r\n    msg.is_customer = 1\r\n    messageList.value.push(msg)\r\n  }\r\n\r\n  const pushAiMessage = (msg) => {\r\n    messageList.value.push(msg)\r\n\r\n    emitter.emit('updateAiMessage', msg)\r\n  }\r\n\r\n  // 更新AI的消息到列表\r\n  const updateAiMessage = (type, content, uid) => {\r\n    let msgIndex = messageList.value.findIndex((item) => item.uid == uid)\r\n\r\n    if (type == 'reply_content_list') {\r\n      if (content !== undefined && typeof content === 'string') {\r\n        messageList.value[msgIndex].reply_content_list = JSON.parse(content)\r\n      }\r\n    }\r\n\r\n    if (type == 'reasoning_content') {\r\n      let oldText = messageList.value[msgIndex].reasoning_content || ''\r\n      messageList.value[msgIndex].reasoning_content = oldText + content\r\n\r\n      // 推理开始\r\n      messageList.value[msgIndex].reasoning_status = true\r\n      messageList.value[msgIndex].show_reasoning = true\r\n    }\r\n\r\n    if (type == 'sending') {\r\n\r\n      // 开始生成中\r\n      messageList.value[msgIndex].startLoading = false\r\n      // 推理结束\r\n      messageList.value[msgIndex].reasoning_status = false\r\n\r\n      let oldText = messageList.value[msgIndex].content || ''\r\n      // console.log('sending', content.length, content)\r\n      messageList.value[msgIndex].content = oldText + content\r\n      messageList.value[msgIndex].voice_content = extractVoiceInfo(messageList.value[msgIndex].content)\r\n      messageList.value[msgIndex].content = removeVoiceFormat(messageList.value[msgIndex].content)\r\n    }\r\n\r\n    if(type == 'start_quote_file'){\r\n      messageList.value[msgIndex].quote_loading = true\r\n    }\r\n\r\n    if (type == 'quote_file') {\r\n      messageList.value[msgIndex].quote_file = content.length > 0 ? content : []\r\n      messageList.value[msgIndex].show_quote_file = true\r\n      messageList.value[msgIndex].quote_loading = false\r\n    }\r\n\r\n    if (type == 'ai_message') {\r\n      // 【ID1017779】【芝麻AI】机器人直连\r\n      // 在实时聊天的时候，也需要把 ai_message 中的菜单内容显示出来\r\n      if (content.menu_json && content.msg_type == 2) {\r\n        let menu_json_obj = JSON.parse(content.menu_json)\r\n        //messageList.value[msgIndex].content = menu_json_obj.content\r\n        messageList.value[msgIndex].question = menu_json_obj.question\r\n      }\r\n\r\n      messageList.value[msgIndex].startLoading = false\r\n      messageList.value[msgIndex].id = content.id\r\n\r\n      messageList.value[msgIndex].content = content.content\r\n      // 提取语音消息\r\n      messageList.value[msgIndex].voice_content = extractVoiceInfo(messageList.value[msgIndex].content)\r\n      messageList.value[msgIndex].content = removeVoiceFormat(messageList.value[msgIndex].content)\r\n      if (content.reply_content_list !== undefined && typeof content.reply_content_list === 'string') {\r\n        messageList.value[msgIndex].reply_content_list = JSON.parse(content.reply_content_list)\r\n      }\r\n      if (content.quote_file && typeof content.quote_file === 'string') {\r\n        messageList.value[msgIndex].quote_file = JSON.parse(content.quote_file)\r\n      }\r\n    }\r\n\r\n    if (type == 'debug') {\r\n      messageList.value[msgIndex].debug = content.length > 0 ? content : []\r\n    }\r\n\r\n    if (type == 'error') {\r\n      messageList.value[msgIndex].error = content.length > 0 ? content : []\r\n    }\r\n    if (type == 'recall_time') {\r\n      messageList.value[msgIndex].recall_time = content || 0\r\n    }\r\n    if (type == 'request_time') {\r\n      messageList.value[msgIndex].request_time = content || 0\r\n    }\r\n\r\n    if (type == 'guess_you_want') {\r\n      // 猜你想问 插入\r\n      messageList.value = messageList.value.map((item) => {\r\n        return {\r\n          ...item,\r\n          question_tabkey: -1,\r\n          guess_you_want: []\r\n        }\r\n      })\r\n      messageList.value[msgIndex].guess_you_want = content\r\n      messageList.value[msgIndex].question_tabkey = content.length > 0 ? 1 : 2\r\n    }\r\n    if (type == 'set_question_tabkey') {\r\n      messageList.value = messageList.value.map((item) => {\r\n        return {\r\n          ...item,\r\n          question_tabkey: -1\r\n        }\r\n      })\r\n      // 猜你想问 常见问题的tabkey  1为 猜你想问 2为 常见问题\r\n      messageList.value[msgIndex].question_tabkey = content\r\n    }\r\n\r\n    emitter.emit('updateAiMessage', messageList.value[msgIndex])\r\n  }\r\n\r\n  // 关闭AI的消息加载状态\r\n  const closeAiMessageLoading = () => {\r\n    let msgIndex = messageList.value.length - 1\r\n\r\n    messageList.value[msgIndex].loading = false\r\n  }\r\n\r\n  // 发送消息\r\n  const sendLock = ref(false)\r\n\r\n  const sendMessage = (data) => {\r\n    if (sendLock.value) {\r\n      return\r\n    }\r\n\r\n    let aiMsg = {\r\n      startLoading: true, // 对话开始状态\r\n      loading: true,\r\n      id: '',\r\n      content: '',\r\n      reasoning_content: '',\r\n      uid: getUuid(32),\r\n      robot_avatar: robot.robot_avatar,\r\n      msg_type: 1,\r\n      quote_file: [],\r\n      debug: [],\r\n      error: '',\r\n      recall_time: '',\r\n      request_time: '',\r\n      show_reasoning: false,\r\n      reasoning_status: false,\r\n      quote_loading: false,\r\n      show_quote_file: true,\r\n      voice_content: [],\r\n    }\r\n    let params = {\r\n      robot_key: robot.robot_key,\r\n      openid: robot.openid,\r\n      question: data.message,\r\n      // prompt: robot.prompt,\r\n      // library_ids: robot.library_ids,\r\n      form_ids: robot.form_ids,\r\n      dialogue_id: dialogue_id.value,\r\n      global: data.global\r\n    }\r\n\r\n    let variables_key = `chat_prompt_variables_${robot.robot_key}`\r\n\r\n    if(localStorage.getItem(variables_key)){\r\n      params.chat_prompt_variables = localStorage.getItem(variables_key)\r\n      localStorage.removeItem(variables_key)\r\n    }\r\n\r\n    if (import.meta.env.DEV) {\r\n      params.debug = 0\r\n    }\r\n\r\n    sendLock.value = true\r\n    mySSE = sendAiMessage(params)\r\n\r\n    mySSE.onMessage = (res) => {\r\n      if (res.event !== 'sending') {\r\n        devLog(res)\r\n      }\r\n      // 更新对话id\r\n      if (res.event == 'dialogue_id') {\r\n        dialogue_id.value = res.data\r\n      }\r\n\r\n      // 插入用户的问题到聊天记录\r\n      if (res.event == 'c_message') {\r\n        let data = JSON.parse(res.data)\r\n        // 插入用户的问题到聊天记录\r\n\r\n        pushUserMessage(data)\r\n      }\r\n\r\n      // 插入AI的回答到聊天记录\r\n      if (res.event == 'robot') {\r\n        // 插入AI的回答到聊天记录\r\n        pushAiMessage(aiMsg)\r\n\r\n        if (isNewChat.value) {\r\n          // 插入新的对话记录\r\n          insertNewSession()\r\n\r\n          isNewChat.value = false\r\n        }\r\n      }\r\n\r\n      // 更新功能中心回复\r\n      if (res.event == 'reply_content_list') {\r\n        updateAiMessage('reply_content_list', res.data, aiMsg.uid)\r\n      }\r\n\r\n      // 更新机器人深度思考的内容\r\n      if (res.event == 'reasoning_content') {\r\n        updateAiMessage('reasoning_content', res.data, aiMsg.uid)\r\n      }\r\n\r\n      // 更新机器人的消息\r\n      if (res.event == 'sending') {\r\n        updateAiMessage('sending', res.data, aiMsg.uid)\r\n      }\r\n\r\n      // 更新机器人消息的消息id时间等\r\n      if (res.event == 'ai_message') {\r\n        let data = JSON.parse(res.data)\r\n\r\n        updateAiMessage('ai_message', data, aiMsg.uid)\r\n      }\r\n\r\n      if(res.event == 'start_quote_file'){\r\n        updateAiMessage('start_quote_file', res.data, aiMsg.uid)\r\n      }\r\n\r\n      // 更新引用文件\r\n      if (res.event == 'quote_file') {\r\n        let data = JSON.parse(res.data)\r\n\r\n        updateAiMessage('quote_file', data, aiMsg.uid)\r\n      }\r\n\r\n      // 更新prompt日志\r\n      if (res.event == 'debug') {\r\n        let data = JSON.parse(res.data)\r\n\r\n        updateAiMessage('debug', data, aiMsg.uid)\r\n      }\r\n\r\n      // 更新prompt错误日志\r\n      if (res.event == 'error') {\r\n        let data = res.data\r\n\r\n        updateAiMessage('error', data, aiMsg.uid)\r\n      }\r\n      // 更新prompt recall_time\r\n      if (res.event == 'recall_time') {\r\n        let data = res.data\r\n\r\n        updateAiMessage('recall_time', data, aiMsg.uid)\r\n      }\r\n      // 更新prompt request_time\r\n      if (res.event == 'request_time') {\r\n        let data = res.data\r\n\r\n        updateAiMessage('request_time', data, aiMsg.uid)\r\n      }\r\n      if (res.event == 'chat_prompt_variables') {\r\n        let data = res.data\r\n        if(data){\r\n          data = JSON.parse(data)\r\n          chat_variables.value.need_fill_variable = data.need_fill_variable\r\n          chat_variables.value.fill_variables = data.fill_variables || []\r\n          chat_variables.value.session_id = data.session_id\r\n        }\r\n      }\r\n      // 猜你想问\r\n      if (res.event == 'finish') {\r\n        if (robot.enable_question_guide) {\r\n          // 相关问题开关开启了\r\n          questionGuide({\r\n            robot_key: robot.robot_key,\r\n            openid: robot.openid,\r\n            dialogue_id: dialogue_id.value\r\n          }).then((res) => {\r\n            updateAiMessage('guess_you_want', res.data || [], aiMsg.uid)\r\n          })\r\n        } else {\r\n          updateAiMessage('set_question_tabkey', 2, aiMsg.uid)\r\n        }\r\n      }\r\n    }\r\n\r\n    mySSE.onClose = () => {\r\n      closeAiMessageLoading()\r\n      sendLock.value = false\r\n\r\n      mySSE = null\r\n    }\r\n  }\r\n\r\n  const handleEditVariables = (data) => {\r\n    editVariables({\r\n      robot_key: robot.robot_key,\r\n      openid: robot.openid,\r\n      dialogue_id: dialogue_id.value,\r\n      chat_prompt_variables: JSON.stringify(data.chat_prompt_variables),\r\n      session_id: chat_variables.value.session_id\r\n    }).then(res=>{\r\n      chat_variables.value.fill_variables = data.chat_prompt_variables\r\n    })\r\n  }\r\n\r\n  // 获取对话记录\r\n  const myChatListSize = 25\r\n  const myChatList = ref([])\r\n  const myChatListLoading = ref(false)\r\n  const myChatListLoadCompleted = ref(false)\r\n\r\n  const getMyChatList = async () => {\r\n    if (myChatListLoadCompleted.value || myChatListLoading.value) {\r\n      return false\r\n    }\r\n\r\n    let min_id = 0\r\n\r\n    if (myChatList.value.length > 0) {\r\n      min_id = myChatList.value[myChatList.value.length - 1].id\r\n    }\r\n\r\n    myChatListLoading.value = true\r\n\r\n    const res = await getDialogueList({\r\n      min_id: min_id,\r\n      size: myChatListSize,\r\n      robot_key: robot.robot_key\r\n    })\r\n\r\n    myChatListLoading.value = false\r\n\r\n    const list = res.data || []\r\n\r\n    if (list.length === 0) {\r\n      myChatListLoadCompleted.value = true\r\n      return false\r\n    }\r\n\r\n    myChatList.value = [...myChatList.value, ...list]\r\n\r\n    return res\r\n  }\r\n  // 插入最新一条对话记录\r\n  const insertNewSession = () => {\r\n    getDialogueList({\r\n      min_id: 0,\r\n      size: 1,\r\n      robot_key: robot.robot_key\r\n    }).then((res) => {\r\n      const list = res.data || []\r\n\r\n      if (list[0]) {\r\n        myChatList.value.unshift(list[0])\r\n      }\r\n    })\r\n  }\r\n\r\n  // 打开对话\r\n  const openChat = async (data) => {\r\n    if (mySSE) {\r\n      mySSE.abort()\r\n      mySSE = null\r\n    }\r\n    let res = await createChat(data)\r\n\r\n    return res\r\n  }\r\n\r\n  // 获取聊天记录\r\n  const chatMessagePageSize = 20\r\n  const chatMessageLoadCompleted = ref(false)\r\n\r\n  const onGetChatMessage = async () => {\r\n    if (chatMessageLoadCompleted.value) {\r\n      return\r\n    }\r\n\r\n    let min_id = 0\r\n    let list = messageList.value.filter((item) => !item.isWelcome)\r\n\r\n    if (list.length > 0) {\r\n      min_id = list[0].id\r\n    }\r\n\r\n    const request_dialogue_id = dialogue_id.value;\r\n    let params = {\r\n      robot_key: robot.robot_key,\r\n      openid: user.openid,\r\n      min_id: min_id,\r\n      size: chatMessagePageSize,\r\n      dialogue_id: request_dialogue_id,\r\n      rel_user_id: rel_user_id.value\r\n    }\r\n\r\n    try {\r\n      const res = await getChatMessage(params)\r\n      if (dialogue_id.value !== request_dialogue_id) {\r\n        return Promise.resolve(null);\r\n      }\r\n      const list = res.data.list || []\r\n      const _customer = res?.data?.customer || {}\r\n      const newRobot = res.data.robot\r\n      // 消息加载完了\r\n      if (list.length === 0) {\r\n        chatMessageLoadCompleted.value = true\r\n        return\r\n      }\r\n      // 把消息倒过来\r\n      list.sort((a, b) => {\r\n        return a.id - b.id\r\n      })\r\n      list.forEach((item) => {\r\n        item.loading = false\r\n        item.uid = getUuid(32)\r\n\r\n        item.name = item.name || item.nickname\r\n        if (item.is_customer == 1) {\r\n          item.name = item.name || user.name || _customer.name\r\n          item.avatar = item.avatar || user.avatar || _customer.avatar\r\n        } else {\r\n          item.name = item.name || robot.robot_name || newRobot.robot_name\r\n          item.robot_avatar = item.avatar || robot.robot_avatar || newRobot.robot_avatar\r\n          item.avatar = item.robot_avatar\r\n        }\r\n\r\n        if (item.menu_json) {\r\n          item.menu_json = JSON.parse(item.menu_json)\r\n        }\r\n\r\n        if (item.quote_file) {\r\n          item.quote_file = JSON.parse(item.quote_file)\r\n        }\r\n\r\n        if (item.reply_content_list && typeof item.reply_content_list === 'string') {\r\n          try { item.reply_content_list = JSON.parse(item.reply_content_list) } catch (_) { item.reply_content_list = [] }\r\n        }\r\n\r\n        item.voice_content = extractVoiceInfo(item.content)\r\n        item.content = removeVoiceFormat(item.content)\r\n\r\n      })\r\n\r\n      messageList.value = [...list, ...messageList.value]\r\n      return res\r\n    } catch (err) {\r\n      Promise.reject(err)\r\n    }\r\n  }\r\n\r\n  const getRecordList = async (params) => {\r\n    try {\r\n      const res = await getSessionRecordList(params)\r\n      if (!res) {\r\n        return Promise.reject(res)\r\n      }\r\n      return res\r\n    } catch (err) {\r\n      Promise.reject(err)\r\n    }\r\n  }\r\n\r\n  const getChannelList = async (params) => {\r\n    try {\r\n      const res = await getSessionChannelList(params)\r\n      if (!res) {\r\n        return Promise.reject(res)\r\n      }\r\n      return res\r\n    } catch (err) {\r\n      Promise.reject(err)\r\n    }\r\n  }\r\n\r\n  // 提示词\r\n  const changeRobotPrompt = (text) => {\r\n    robot.prompt = text\r\n  }\r\n\r\n  const saveRobotPrompt = () => {\r\n    return editPrompt({\r\n      id: robot.id,\r\n      prompt: robot.prompt\r\n    })\r\n  }\r\n\r\n  function $reset() {\r\n    // 关闭im\r\n    im.close()\r\n\r\n    dialogue_id.value = 0\r\n    messageList.value = []\r\n    openid.value = ''\r\n    // 用户信息\r\n    user.admin_user_id = ''\r\n    user.avatar = ''\r\n    user.id = ''\r\n    user.name = ''\r\n    user.nickname = ''\r\n    user.openid = ''\r\n\r\n    // 机器人的信息\r\n    robot.id = ''\r\n    robot.library_ids = ''\r\n    robot.form_ids = ''\r\n    robot.prompt = ''\r\n    robot.robot_avatar = ''\r\n    robot.robot_intro = ''\r\n    robot.robot_key = ''\r\n    robot.robot_name = ''\r\n    robot.openid = ''\r\n    robot.welcomes = { content: '', question: [] }\r\n    // 是否是新的对话\r\n    isNewChat.value = false\r\n    // 消息加载完了\r\n    chatMessageLoadCompleted.value = false\r\n    // 是否正在发送消息\r\n    sendLock.value = false\r\n    // 对话记录\r\n    myChatListLoading.value = false\r\n    myChatListLoadCompleted.value = false\r\n    myChatList.value = []\r\n  }\r\n\r\n  return {\r\n    $reset,\r\n    user,\r\n    robot,\r\n    dialogue_id,\r\n    openid,\r\n    sendLock,\r\n    messageList,\r\n    createChat,\r\n    createMsg,\r\n    sendMessage,\r\n    getMyChatList,\r\n    myChatList,\r\n    openChat,\r\n    onGetChatMessage,\r\n    changeRobotPrompt,\r\n    saveRobotPrompt,\r\n    getRecordList,\r\n    getChannelList,\r\n    chat_variables,\r\n    handleEditVariables\r\n  }\r\n})\r\n"],"names":["useChatStore","defineStore","emitter","useEventBus","messageList","ref","im","useIM","mySSE","dialogue_id","rel_user_id","openid","user","reactive","robot","chat_variables","createMsg","data","chatMessageLoadCompleted","sendLock","getOpenid","DEFAULT_USER_AVATAR","isNewChat","createChat","res","chatWelcome","userInfo","robotInfo","insertWelcomeMsg","onImMessage","e","msg","getUuid","pushUserMessage","pushAiMessage","updateAiMessage","type","content","uid","msgIndex","item","oldText","extractVoiceInfo","removeVoiceFormat","menu_json_obj","closeAiMessageLoading","sendMessage","aiMsg","params","variables_key","sendAiMessage","devLog","insertNewSession","questionGuide","handleEditVariables","editVariables","myChatListSize","myChatList","myChatListLoading","myChatListLoadCompleted","getMyChatList","min_id","getDialogueList","list","openChat","chatMessagePageSize","onGetChatMessage","request_dialogue_id","getChatMessage","_customer","_a","newRobot","a","b","err","getRecordList","getSessionRecordList","getChannelList","getSessionChannelList","changeRobotPrompt","text","saveRobotPrompt","editPrompt","$reset"],"mappings":"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"}