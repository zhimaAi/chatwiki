import{_ as ae,b as oe,w as Re,x as Oe,y as at,r as st,z as nt,A as Ve,d as ot,B as lt,C as it,E as dt,F as rt,G as _t,H as ct,I as ut}from"../../index-CB2DywzJ.js";import{f,ac as T,ad as h,F as X,ax as ue,ai as Pe,at as l,u as t,w as me,k as e,ar as s,ae as q,as as i,r as ee,af as le,G as k,az as Y,J as je,e as de,B as ge,y as pe,o as pt}from"./vue-chunks-CGLjTDrY.js";import{_ as mt}from"./cu-scroll-D9utH_KS.js";import{g as Ne}from"./index-CoChppVN.js";import{g as Ie}from"./index-D_MN-GJN.js";import{v as Ee}from"./validate-8MtiUsxW.js";import{F as re,a5 as vt,a6 as ye,u as ht,M as te,b as H,e as be,I as Se,y as Ae,z as Fe,a7 as Le,f as ze,w as Be,x as Ke,a8 as ft,d as _e,G as ke,E as Te,H as Je,a9 as Ye,B as we,W as ve,aa as Ue,v as qe,k as He,ab as gt,h as Qe,i as Ge,ac as yt,ad as bt,Z as kt,ae as wt,D as xt,U as $t,j as Ce,af as Ct,ag as Dt,T as Me,ai as Ot,Q as St,$ as Lt,N as Bt,aj as Tt,ak as Ut,V as Mt}from"./ui-antd-BHaxN-GS.js";import{d as De}from"./role_avatar-DL0r08JY.js";import{g as xe,a as Ze,b as Rt,s as Vt,d as Pt,c as jt,e as Nt,f as It,h as Et}from"./index-DNhlFGD2.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";const At={class:"page-tabs"},Ft=["onClick"],zt={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(Q,{emit:o}){const{t:L}=oe(),a=o,D=Q,C=f([{value:1,title:L("views.user.model.teamMembers"),langKey:"views.user.model.teamMembers"}]),v=p=>{a("update:value",p),a("change",p)};return(p,n)=>(h(),T("div",At,[(h(!0),T(X,null,ue(C.value,V=>(h(),T("div",{class:Pe(["tab-item",{active:D.value==V.value}]),onClick:S=>v(V.value),key:V.value},l(t(L)(V.langKey)),11,Ft))),128))]))}},Kt=ae(zt,[["__scopeId","data-v-85a6ddaa"]]),Jt={class:"avatar-uploader"},Yt=["src"],qt={key:1},Ht=["src"],Qt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(Q,{emit:o}){function L(r){return new Promise((y,m)=>{const E=new FileReader;E.readAsDataURL(r),E.onload=()=>y(E.result),E.onerror=F=>m(F)})}const a=o,D=Q,C=f([]),v=f(!1),p=f("");me(()=>D.value,r=>{p.value=r},{immediate:!0});const n=re.useInjectFormItemContext(),V=()=>{let r={imageUrl:p.value,file:C.value[0].originFileObj};a("change",r),a("update:value",r.imageUrl),n.onFieldChange()},S=r=>r.type==="image/jpeg"||r.type==="image/png"?r.size/1024<1024?(C.value=[r],L(r).then(E=>{p.value=E,v.value=!1,V()}),!1):(H.error("成员头像图片大小不能超过1M"),!1):(H.error("机器人头像只支持JPG、PNG格式的图片"),!1),O=f(!1),N=f(""),w=f(""),P=()=>{O.value=!1,w.value=""},I=async r=>{!r.url&&!r.preview&&(r.preview=await L(r.originFileObj)),N.value=r.url||r.preview,O.value=!0,w.value=r.name||r.url.substring(r.url.lastIndexOf("/")+1)};return(r,y)=>{const m=ht,E=te;return h(),T("div",Jt,[e(m,{"file-list":C.value,"onUpdate:fileList":y[0]||(y[0]=F=>C.value=F),"list-type":"picture-card","show-upload-list":!1,"before-upload":S,accept:".jpg,.png,.jpeg",onPreview:I},{default:s(()=>[p.value?(h(),T("img",{key:0,class:"avatar",src:p.value,alt:"avatar"},null,8,Yt)):(h(),T("div",qt,[v.value?(h(),q(t(vt),{key:0})):(h(),q(t(ye),{key:1})),y[1]||(y[1]=i("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list"]),e(E,{open:O.value,title:w.value,footer:null,onCancel:P},{default:s(()=>[i("img",{alt:"example",style:{width:"100%"},src:N.value},null,8,Ht)]),_:1},8,["open","title"])])}}},Gt=ae(Qt,[["__scopeId","data-v-1945844c"]]),Zt={class:"form-box"},Wt={class:"avatar-box"},Xt={class:"tip"},ea={class:"flex-item-box"},ta={class:"flex-item-box"},aa={class:"flex-item-box"},sa={class:"flex-item-box"},na={key:0,style:{"margin-top":"4px"}},oa={__name:"add-team-members",emits:["ok"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.add-team-members"),D=L,C=re.useForm,v=f(!1),p=f(a("add_team_member")),n=ee({user_name:"",nick_name:"",avatar:"",avatar_url:"",user_roles:"3",password:"",check_password:"",department_ids:[],expire_time_type:0,expire_time:"",id:""}),V=f([]),S=()=>{xe({}).then(g=>{let x=g.data||[];V.value=Oe(x)})},O=g=>{n.avatar=g.file},N=f([]);Re({page:1,size:200,search:""}).then(g=>{let x=g.data.list||[];N.value=x.filter(J=>J.id!="1"&&J.role_type!=1)});const w=ee({user_name:[{message:a("please_input_login_account"),required:!0},{validator:async(g,x)=>!/^[a-zA-Z0-9_.-]+$/.test(x)&&x?Promise.reject(a("account_format_tip")):Promise.resolve()}],nick_name:[{message:a("input_nickname"),required:!0}],avatar_url:[{message:a("please_upload_avatar"),required:!0}],user_roles:[{message:a("please_select_member_role"),required:!0}],password:[{message:a("please_input_login_password"),required:!0},{validator:async(g,x)=>!Ee(x)&&x?Promise.reject(a("password_format_tip")):Promise.resolve()}],check_password:[{message:a("please_input_confirm_password"),required:!0},{validator:async(g,x)=>x!=n.password&&x?Promise.reject(a("passwords_not_match")):Promise.resolve()}],expire_time:[{validator:async(g,x)=>n.expire_time_type==1&&!x?Promise.reject(a("please_select_specify_date")):Promise.resolve()}],department_ids:[{message:a("please_select_department"),required:!0}]}),{resetFields:P,validate:I,validateInfos:r}=C(n,w),y=g=>{p.value=a("add_team_member"),v.value=!0,P(),n.user_name="",n.nick_name="",n.avatar="",n.avatar_url=De,n.user_roles="3",n.password="",n.check_password="",n.expire_time_type=0,n.expire_time="",n.department_ids=g?[g]:[],n.id="",S()},m=g=>{p.value=a("edit_team_member"),n.user_name=g.user_name,n.nick_name=g.nick_name,n.avatar_url=g.avatar||De,n.avatar="",n.user_roles=g.user_roles,n.password="",n.check_password="",n.id=g.id,g.expire_time>0?(n.expire_time_type=1,n.expire_time=_e(g.expire_time*1e3)):(n.expire_time_type=0,n.expire_time=""),n.department_ids=g.departments.map(x=>+x.id),delete w.password,delete w.check_password,v.value=!0,S()},E=f(!1),F=()=>{I().then(()=>{let g={...je(n)};g.expire_time_type==1?g.expire_time=_e(g.expire_time).unix():g.expire_time=0,g.department_ids=n.department_ids.join(","),delete g.avatar_url,E.value=!0,at(g).then(x=>{H.success(`${p.value}${a("success")}`),v.value=!1,D("ok")}).finally(()=>{E.value=!1})})},U=g=>g&&g<_e().startOf("day");return o({add:y,edit:m}),(g,x)=>{const J=Se,j=be,B=Fe,d=Ae,u=Le,c=ze,b=Ke,M=Be,A=ft,G=re,se=te;return h(),T("div",null,[e(se,{open:v.value,"onUpdate:open":x[9]||(x[9]=_=>v.value=_),title:p.value,onOk:F,width:"746px"},{default:s(()=>[i("div",Zt,[i("div",Wt,[e(Gt,{value:n.avatar_url,"onUpdate:value":x[0]||(x[0]=_=>n.avatar_url=_),onChange:O},null,8,["value"]),i("div",Xt,l(t(a)("click_to_replace_tip")),1)]),e(G,{layout:"vertical",autocomplete:"off"},{default:s(()=>[i("div",ea,[e(j,le({label:t(a)("member_nickname")},t(r).nick_name),{default:s(()=>[e(J,{maxlength:100,type:"text",placeholder:t(a)("input_nickname"),value:n.nick_name,"onUpdate:value":x[1]||(x[1]=_=>n.nick_name=_)},null,8,["placeholder","value"])]),_:1},16,["label"]),e(j,le({label:t(a)("login_account")},t(r).user_name),{default:s(()=>[e(J,{disabled:n.id!="",type:"text",placeholder:t(a)("account_format_tip"),value:n.user_name,"onUpdate:value":x[2]||(x[2]=_=>n.user_name=_)},null,8,["disabled","placeholder","value"])]),_:1},16,["label"])]),i("div",ta,[e(j,le({label:t(a)("member_role")},t(r).user_roles),{default:s(()=>[e(d,{value:n.user_roles,"onUpdate:value":x[3]||(x[3]=_=>n.user_roles=_),style:{width:"100%"},placeholder:t(a)("select_member_role")},{default:s(()=>[(h(!0),T(X,null,ue(N.value,_=>(h(),q(B,{key:_.id,value:_.id},{default:s(()=>[k(l(_.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},16,["label"]),e(j,le({label:t(a)("select_department")},t(r).department_ids,{name:"department_ids"}),{default:s(()=>[e(u,{value:n.department_ids,"onUpdate:value":x[4]||(x[4]=_=>n.department_ids=_),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:t(a)("please_select"),"allow-clear":"",multiple:"","tree-default-expand-all":"","tree-data":V.value,"tree-node-filter-prop":"label"},{title:s(({value:_,label:W})=>[i("div",null,l(W),1)]),_:1},8,["value","placeholder","tree-data"])]),_:1},16,["label"])]),i("div",aa,[n.id?Y("",!0):(h(),q(j,le({key:0,label:t(a)("login_password")},t(r).password),{default:s(()=>[e(c,{value:n.password,"onUpdate:value":x[5]||(x[5]=_=>n.password=_),placeholder:t(a)("password_format_tip")},null,8,["value","placeholder"])]),_:1},16,["label"])),n.id?Y("",!0):(h(),q(j,le({key:1,label:t(a)("confirm_password")},t(r).check_password),{default:s(()=>[e(c,{value:n.check_password,"onUpdate:value":x[6]||(x[6]=_=>n.check_password=_),placeholder:t(a)("reinput_password")},null,8,["value","placeholder"])]),_:1},16,["label"]))]),i("div",sa,[e(j,le({label:t(a)("expire_time")},t(r).expire_time,{required:""}),{default:s(()=>[e(M,{value:n.expire_time_type,"onUpdate:value":x[7]||(x[7]=_=>n.expire_time_type=_)},{default:s(()=>[e(b,{value:0},{default:s(()=>[k(l(t(a)("permanent_valid")),1)]),_:1}),e(b,{value:1},{default:s(()=>[k(l(t(a)("specify_time")),1)]),_:1})]),_:1},8,["value"]),n.expire_time_type==1?(h(),T("div",na,[e(A,{showNow:!1,format:"YYYY-MM-DD HH:mm","disabled-date":U,value:n.expire_time,"onUpdate:value":x[8]||(x[8]=_=>n.expire_time=_),"show-time":{defaultValue:t(_e)("00:00","HH:mm")}},null,8,["value","show-time"])])):Y("",!0)]),_:1},16,["label"])])]),_:1})])]),_:1},8,["open","title"])])}}},la=ae(oa,[["__scopeId","data-v-a371e569"]]),ia={class:"form-box"},da={__name:"reset-password",emits:["ok"],setup(Q,{expose:o,emit:L}){const a=L,D=re.useForm,{t:C}=oe("views.user.manage.components.reset-password"),v=f(!1),p=de(()=>C("modal_title")),n=ee({password:"",check_password:"",id:""}),V=ee({password:[{message:C("enter_login_password"),required:!0},{validator:async(I,r)=>!Ee(r)&&r?Promise.reject(C("password_must_contain")):Promise.resolve()}],check_password:[{message:C("enter_confirm_password"),required:!0},{validator:async(I,r)=>r!=n.password&&r?Promise.reject(C("passwords_not_match")):Promise.resolve()}]}),{resetFields:S,validate:O,validateInfos:N}=D(n,V),w=I=>{I.id,v.value=!0,S(),n.password="",n.check_password="",n.id=I.id},P=()=>{O().then(()=>{st({...je(n)}).then(I=>{H.success(C("modification_successful")),v.value=!1,a("ok")})})};return o({open:w}),(I,r)=>{const y=ze,m=be,E=re,F=te;return h(),T("div",null,[e(F,{open:v.value,"onUpdate:open":r[2]||(r[2]=U=>v.value=U),title:p.value,onOk:P,width:"476px"},{default:s(()=>[i("div",ia,[e(E,{layout:"vertical"},{default:s(()=>[e(m,le({label:t(C)("login_password")},t(N).password),{default:s(()=>[e(y,{value:n.password,"onUpdate:value":r[0]||(r[0]=U=>n.password=U),placeholder:t(C)("password_placeholder")},null,8,["value","placeholder"])]),_:1},16,["label"]),e(m,le({label:t(C)("confirm_password")},t(N).check_password),{default:s(()=>[e(y,{value:n.check_password,"onUpdate:value":r[1]||(r[1]=U=>n.check_password=U),placeholder:t(C)("re_enter_password")},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1})])]),_:1},8,["open","title"])])}}},ra=ae(da,[["__scopeId","data-v-cb499b69"]]),_a={key:0,class:"form-wrapper"},ca={class:"select"},ua={class:"tools-wrapper"},pa=["src"],ma={class:"item-name"},va={key:1,class:"form-wrapper"},ha={class:"main-tabs-box"},fa={class:"select"},ga={class:"tools-wrapper"},ya={class:"item-name"},ba={class:"tools-wrapper"},ka={class:"item-name"},wa={key:2,class:"form-wrapper"},xa={class:"select"},$a={class:"tools-wrapper"},Ca={class:"item-name"},Da={__name:"see-model-alert",props:{robotList:{type:Array,default:()=>[]},libraryList:{type:Array,default:()=>[]},formList:{type:Array,default:()=>[]}},emits:["save","ok"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.components.see-model-alert"),D=L,C=Q,v=f([]),p=f(""),n=f(!1),V=f([]),S=f([]),O=d=>{const u=[];return d.map(c=>{u.push(c.id)}),u},N=d=>{v.value=d},w=f(1),P=de(()=>[{value:2,payload:{title:a("department_knowledge_base")}},{value:1,payload:{title:a("member_knowledge_base")}}]),I=f(P.value);me(P,d=>{I.value=d},{immediate:!0});let r=null;const y=f(1),m=f(1),E=f(),F=async(d,u,c)=>{v.value=[],y.value=d,m.value=1,w.value=1,r=JSON.parse(JSON.stringify(c)),E.value=r.id,c=JSON.parse(JSON.stringify(c)),I.value=P,c.managed_robot_list=c.managed_robot_list||[],c.managed_library_list=c.managed_library_list||[],c.managed_form_list=c.managed_form_list||[];let b=[];d==1?(p.value=a("add_member_robot"),b=C.robotList,b.forEach(M=>{let A=c.managed_robot_list.filter(G=>G.id==M.id);A.length?M.operate_rights=A[0].operate_rights:M.operate_rights="4"}),u&&u=="edit"&&(p.value=a("edit_member_robot"),v.value=O(c.managed_robot_list))):d==2?(p.value=a("add_member_knowledge"),b=C.libraryList,b.forEach(M=>{let A=c.managed_library_list.filter(G=>G.id==M.id);A.length?M.operate_rights=A[0].operate_rights:M.operate_rights="4"}),u&&u=="edit"&&(p.value=a("edit_member_knowledge"),v.value=O(c.managed_library_list))):d==3&&(p.value=a("add_member_database"),b=C.formList,b.forEach(M=>{let A=c.managed_form_list.filter(G=>G.id==M.id);A.length?M.operate_rights=A[0].operate_rights:M.operate_rights="4"}),u&&u=="edit"&&(p.value=a("edit_member_database"),v.value=O(c.managed_form_list))),V.value=b,n.value=!0},U=()=>{Ze({object_type:y.value,identity_type:m.value,identity_id:E.value,tab:m.value}).then(d=>{S.value=d.data||[]})},g=()=>{w.value==2&&U()},x=(d,u)=>{v.value=[],m.value=1,w.value=1,y.value=d,E.value=u;let c=[];d==1?(p.value=a("batch_update_member_robot"),c=C.robotList):d==2?(p.value=a("batch_update_member_knowledge"),c=C.libraryList):d==3&&(p.value=a("batch_update_member_database"),c=C.formList),c.forEach(b=>{b.operate_rights="4"}),V.value=c,n.value=!0},J=(d,u,c)=>{v.value=[],u.is_user?m.value=1:m.value=2,E.value=u.id;const b=de(()=>[{value:2,payload:{title:m.value==1?a("department_knowledge_base"):a("superior_knowledge_base")}},{value:1,payload:{title:m.value==1?a("member_knowledge_base"):a("department_knowledge_base")}}]);I.value=b.value,me(b,A=>{I.value=A},{immediate:!0}),w.value=1,y.value=d;let M=[];d==1?(p.value=a("add_member_robot"),M=C.robotList):d==2?(p.value=a("add_member_knowledge"),M=C.libraryList):d==3&&(p.value=a("add_member_database"),M=C.formList),M.forEach(A=>{let G=c.filter(se=>se.object_id==A.id);G.length?A.operate_rights=G[0].operate_rights:A.operate_rights="4"}),v.value=c.map(A=>A.object_id),V.value=M,n.value=!0},j=()=>{let d={identity_ids:E.value,identity_type:m.value,object_type:y.value},u=[];V.value.forEach(c=>{v.value.includes(c.id)&&u.push({object_id:+c.id,object_type:+y.value,operate_rights:+c.operate_rights})}),d.object_array=JSON.stringify(u),Rt(d).then(c=>{n.value=!1,H.success(a("save_success")),D("ok")})},B=()=>{};return o({open:F,handleBatchOpen:x,handleDepartmentOpen:J}),(d,u)=>{const c=Te,b=Ke,M=Be,A=ke,G=Je,se=te;return h(),q(se,{class:"add-model-alert",width:"800px",open:n.value,"onUpdate:open":u[1]||(u[1]=_=>n.value=_),title:p.value,onOk:j,onCancel:B},{default:s(()=>[y.value==1?(h(),T("div",_a,[i("div",ca,l(t(a)("selected_count",{count:v.value.length})),1),e(A,{"data-source":V.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:v.value,onChange:N}},{default:s(()=>[e(c,{title:t(a)("robot"),"data-index":"robot_name",width:350},{default:s(({record:_})=>[i("div",ua,[i("img",{class:"model-logo",src:_.robot_avatar,alt:""},null,8,pa),i("div",ma,l(_.robot_name),1)])]),_:1},8,["title"]),e(c,{title:t(a)("permission"),"data-index":"operate_rights",width:350},{default:s(({record:_})=>[e(M,{value:_.operate_rights,"onUpdate:value":W=>_.operate_rights=W},{default:s(()=>[e(b,{value:"4"},{default:s(()=>[k(l(t(a)("manage")),1)]),_:1}),e(b,{value:"2"},{default:s(()=>[k(l(t(a)("edit")),1)]),_:1}),e(b,{value:"1"},{default:s(()=>[k(l(t(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection"])])):y.value==2?(h(),T("div",va,[i("div",ha,[e(G,{value:w.value,"onUpdate:value":u[0]||(u[0]=_=>w.value=_),options:I.value,onChange:g},{label:s(({payload:_})=>[k(l(_.title),1)]),_:1},8,["value","options"])]),w.value==1?(h(),T(X,{key:0},[i("div",fa,l(t(a)("selected_count",{count:v.value.length})),1),e(A,{"data-source":V.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:v.value,onChange:N}},{default:s(()=>[e(c,{title:t(a)("knowledge_base"),"data-index":"library_name",width:350},{default:s(({record:_})=>[i("div",ga,[i("div",ya,l(_.library_name),1)])]),_:1},8,["title"]),e(c,{title:t(a)("permission"),"data-index":"operate_rights",width:350},{default:s(({record:_})=>[e(M,{value:_.operate_rights,"onUpdate:value":W=>_.operate_rights=W},{default:s(()=>[e(b,{value:"4"},{default:s(()=>[k(l(t(a)("manage")),1)]),_:1}),e(b,{value:"2"},{default:s(()=>[k(l(t(a)("edit")),1)]),_:1}),e(b,{value:"1"},{default:s(()=>[k(l(t(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection"])],64)):(h(),q(A,{key:1,"data-source":S.value,pagination:!1,scroll:{y:500},"row-key":"id"},{default:s(()=>[e(c,{title:t(a)("knowledge_base"),"data-index":"name",width:350},{default:s(({record:_})=>[i("div",ba,[i("div",ka,l(_.name),1)])]),_:1},8,["title"]),e(c,{title:t(a)("permission"),"data-index":"operate_rights",width:350},{default:s(({record:_})=>[e(M,{value:_.operate_rights,"onUpdate:value":W=>_.operate_rights=W,disabled:""},{default:s(()=>[e(b,{value:"4"},{default:s(()=>[k(l(t(a)("manage")),1)]),_:1}),e(b,{value:"2"},{default:s(()=>[k(l(t(a)("edit")),1)]),_:1}),e(b,{value:"1"},{default:s(()=>[k(l(t(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source"]))])):y.value==3?(h(),T("div",wa,[i("div",xa,l(t(a)("selected_count",{count:v.value.length})),1),e(A,{"data-source":V.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:v.value,onChange:N}},{default:s(()=>[e(c,{title:t(a)("database"),"data-index":"name",width:350},{default:s(({record:_})=>[i("div",$a,[i("div",Ca,l(_.name),1)])]),_:1},8,["title"]),e(c,{title:t(a)("permission"),"data-index":"operate_rights",width:350},{default:s(({record:_})=>[e(M,{value:_.operate_rights,"onUpdate:value":W=>_.operate_rights=W},{default:s(()=>[e(b,{value:"4"},{default:s(()=>[k(l(t(a)("manage")),1)]),_:1}),e(b,{value:"2"},{default:s(()=>[k(l(t(a)("edit")),1)]),_:1}),e(b,{value:"1"},{default:s(()=>[k(l(t(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection"])])):Y("",!0)]),_:1},8,["open","title"])}}},We=ae(Da,[["__scopeId","data-v-99415df6"]]),Oa={class:"form-box"},Sa={class:"form-item"},La={class:"form-label"},Ba={class:"form-content"},Ta={key:0,class:"form-item"},Ua={class:"form-label"},Ma={class:"form-content"},Ra={__name:"add-department",emits:["ok"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.components.add-department"),D=f(!1),C=L,v=ee({department_name:"",id:"",pid:""}),p=f(""),n=w=>{v.id="",v.pid=w.id>0?w.id||"":void 0,v.department_name="",p.value=a("add_department"),D.value=!0,O()},V=w=>{v.id=w.id||"",v.pid=w.pid||"",v.department_name=w.title||"",p.value=a("rename"),D.value=!0},S=f([]),O=()=>{xe({}).then(w=>{let P=w.data||[];S.value=Oe(P)})},N=()=>{if(!v.department_name)return H.error(a("please_enter_department_name"));if(!v.id&&!v.pid)return H.error(a("please_select_parent_department"));Vt({...v}).then(w=>{H.success(a("modify_success")),D.value=!1,C("ok")})};return o({show:n,rename:V}),(w,P)=>{const I=Se,r=Le,y=te;return h(),T("div",null,[e(y,{open:D.value,"onUpdate:open":P[2]||(P[2]=m=>D.value=m),title:p.value,onOk:N,width:472},{default:s(()=>[i("div",Oa,[i("div",Sa,[i("div",La,l(t(a)("department_name")),1),i("div",Ba,[e(I,{maxLength:10,value:v.department_name,"onUpdate:value":P[0]||(P[0]=m=>v.department_name=m),placeholder:t(a)("please_enter_department_name")},null,8,["value","placeholder"])])]),v.id?Y("",!0):(h(),T("div",Ta,[i("div",Ua,l(t(a)("parent_department")),1),i("div",Ma,[e(r,{value:v.pid,"onUpdate:value":P[1]||(P[1]=m=>v.pid=m),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:t(a)("please_select"),"allow-clear":"","tree-default-expand-all":"","tree-data":S.value,"tree-node-filter-prop":"label"},{title:s(({value:m,label:E})=>[i("div",null,l(E),1)]),_:1},8,["value","placeholder","tree-data"])])]))])]),_:1},8,["open","title"])])}}},Va=ae(Ra,[["__scopeId","data-v-311427c8"]]),Pa={class:"del-box"},ja={class:"icon-box"},Na={class:"top-title"},Ia={class:"content"},Ea={class:"footer-btn"},Aa={class:"set-box"},Fa={class:"set-desc"},za={class:"set-item"},Ka={class:"set-label"},Ja={__name:"del-department",emits:["ok"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.components.del-department"),D=f(!1),C=f(!1),v=L,p=ee({id:"",new_department_id:void 0});let n=[];const V=r=>{if(n=[],n=S(r),p.new_department_id=void 0,p.id=r.id,r.children.length==0){te.confirm({title:a("tip"),icon:e(ve),content:a("confirm_delete_department"),onOk(){w()}});return}D.value=!0,I()};function S(r){let y=[r.id];if(r.children&&r.children.length>0)for(const m of r.children)y=y.concat(S(m));return y}const O=()=>{C.value=!0},N=()=>{p.new_department_id="",w()},w=()=>{Pt({...p}).then(r=>{C.value=!1,D.value=!1,H.success(a("delete_success")),v("ok",p.id)})},P=f([]),I=()=>{jt().then(r=>{let y=r.data||[];P.value=y.filter(m=>!n.includes(+m.id))})};return o({show:V}),(r,y)=>{const m=we,E=te,F=Fe,U=Ae;return h(),T("div",null,[e(E,{open:D.value,"onUpdate:open":y[1]||(y[1]=g=>D.value=g),title:null,footer:null,width:480,closable:!1},{default:s(()=>[i("div",Pa,[i("div",ja,[e(t(Ye))]),i("div",Na,l(t(a)("delete_department")),1),i("div",Ia,l(t(a)("confirm_delete")),1),i("div",Ea,[e(m,{onClick:y[0]||(y[0]=g=>D.value=!1)},{default:s(()=>[k(l(t(a)("close")),1)]),_:1}),e(m,{danger:"",onClick:N},{default:s(()=>[k(l(t(a)("direct_delete")),1)]),_:1}),e(m,{type:"primary",onClick:O},{default:s(()=>[k(l(t(a)("delete_and_set")),1)]),_:1})])])]),_:1},8,["open"]),e(E,{open:C.value,"onUpdate:open":y[3]||(y[3]=g=>C.value=g),title:t(a)("set_department"),width:472,onOk:w},{default:s(()=>[i("div",Aa,[i("div",Fa,l(t(a)("delete_before_notice")),1),i("div",za,[i("div",Ka,l(t(a)("belong_department")),1),i("div",null,[e(U,{value:p.new_department_id,"onUpdate:value":y[2]||(y[2]=g=>p.new_department_id=g),style:{width:"100%"},placeholder:t(a)("please_select")},{default:s(()=>[(h(!0),T(X,null,ue(P.value,g=>(h(),q(F,{key:g.id,value:g.id},{default:s(()=>[k(l(g.department_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])])])]),_:1},8,["open","title"])])}}},Ya=ae(Ja,[["__scopeId","data-v-4e524606"]]),qa={class:"department-tree-search"},Ha={class:"flex-block"},Qa={class:"tree-list-box"},Ga={style:{"margin-right":"4px"}},Za={class:"action-btn toggle-btn"},Wa={class:"doc-item"},Xa={key:0,class:"tree-title"},es={style:{color:"#f50"}},ts={style:{color:"#f50"}},as={key:1,class:"tree-title"},ss={class:"use-num"},ns={key:2,class:"doc-action-box"},os={class:"menu-name"},ls={class:"menu-name"},is={class:"menu-name",style:{color:"#fb363f"}},ds={__name:"department-tree",emits:["select","save","refresh"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.components.department-tree"),D=L;let C=[];const v=[],p=(d,u)=>{let c;for(let b=0;b<u.length;b++){const M=u[b];M.children&&(M.children.some(A=>A.key===d)?c=M.key:p(d,M.children)&&(c=p(d,M.children)))}return c},n=f([]),V=f([]),S=f(""),O=f(!0),N=f([]);let w="",P={};const I=d=>{n.value=d,O.value=!1};me(S,d=>{const u=v.map(c=>c.title.indexOf(d)>-1?p(c.key,N.value):null).filter((c,b,M)=>c&&M.indexOf(c)===b);n.value=u,S.value=d,O.value=!0});const r=d=>{for(let u=0;u<d.length;u++){const c=d[u],b=c.key;v.push({key:b,title:c.title}),c.children&&r(c.children)}},y=d=>{xe({}).then(u=>{let c=u.data||[];C=[],C=nt(c),r(C),N.value=C,d&&(c.forEach(b=>{b.is_default==1&&(w=b.id,P=b)}),pe(()=>{w&&(V.value=[w],D("select",P))}))})};y(!0);let m={};const E=d=>{V.value[0]==d?pe(()=>{w&&(V.value=[w],D("select",P))}):D("refresh"),y()},F=f(),U=d=>{F.value.show(d)},g=d=>{F.value.rename(d)},x=(d,u)=>{u.node.is_user,u.node.id,u.selected||pe(()=>{V.value=[u.node.id]}),m={...u.node},D("select",m)},J=f(null),j=d=>{J.value.show(d)},B=()=>{y(),D("refresh")};return o({getLists:y}),(d,u)=>{const c=Ue,b=qe,M=Ge,A=Qe,G=He,se=bt;return h(),T(X,null,[i("div",qa,[i("div",Ha,[e(c,{value:S.value,"onUpdate:value":u[0]||(u[0]=_=>S.value=_),placeholder:t(a)("search_department"),style:{flex:"1"}},null,8,["value","placeholder"]),i("div",{class:"add-btn-box",onClick:u[1]||(u[1]=_=>U({}))},[e(t(ye))])]),i("div",Qa,[e(se,{"expanded-keys":n.value,selectedKeys:V.value,"onUpdate:selectedKeys":u[3]||(u[3]=_=>V.value=_),"auto-expand-parent":O.value,onSelect:x,"tree-data":N.value,blockNode:"",onExpand:I},{switcherIcon:s(({switcherCls:_})=>[i("div",Ga,[i("span",Za,[e(t(yt),{style:{"font-size":"12px"},class:Pe(_)},null,8,["class"])])])]),title:s(_=>[i("div",Wa,[_.title.indexOf(S.value)>-1&&S.value?(h(),T("span",Xa,[_.title.length>3&&_.level>3?(h(),q(b,{key:0},{title:s(()=>[k(l(_.title),1)]),default:s(()=>[k(" "+l(_.title.substring(0,_.title.indexOf(S.value)))+" ",1),i("span",es,l(S.value),1),k(" "+l(_.title.substring(_.title.indexOf(S.value)+S.value.length)),1)]),_:2},1024)):(h(),T(X,{key:1},[k(l(_.title.substring(0,_.title.indexOf(S.value)))+" ",1),i("span",ts,l(S.value),1),k(" "+l(_.title.substring(_.title.indexOf(S.value)+S.value.length)),1)],64))])):(h(),T("span",as,[_.title.length>3&&_.level>3?(h(),q(b,{key:0},{title:s(()=>[k(l(_.title),1)]),default:s(()=>[k(" "+l(_.title),1)]),_:2},1024)):(h(),T(X,{key:1},[k(l(_.title),1)],64))])),i("div",ss,l(_.children_nums),1),_.is_user?Y("",!0):(h(),T("div",ns,[e(G,null,{overlay:s(()=>[e(A,null,{default:s(()=>[e(M,{key:"addDoc",onClick:ge(W=>U(_),["stop","prevent"])},{default:s(()=>[i("span",os,l(t(a)("add_sub_department")),1)]),_:1},8,["onClick"]),e(M,{key:"importDoc",onClick:ge(W=>g(_),["stop","prevent"])},{default:s(()=>[i("span",ls,l(t(a)("rename")),1)]),_:1},8,["onClick"]),_.is_default!=1?(h(),q(M,{key:"del",onClick:ge(W=>j(_),["stop","prevent"])},{default:s(()=>[i("span",is,l(t(a)("delete")),1)]),_:1},8,["onClick"])):Y("",!0)]),_:2},1024)]),default:s(()=>[i("span",{class:"action-btn",onClick:u[2]||(u[2]=ge(()=>{},["stop"]))},[e(t(gt))])]),_:2},1024)]))])]),_:1},8,["expanded-keys","selectedKeys","auto-expand-parent","tree-data"])])]),e(Va,{ref_key:"addDepartmentRef",ref:F,onOk:B},null,512),e(Ya,{ref_key:"delDepartmentRef",ref:J,onOk:E},null,512)],64)}}},rs=ae(ds,[["__scopeId","data-v-d652065a"]]),_s={class:"main-content-box"},cs={style:{"margin-top":"12px"}},us={class:"list-content"},ps={key:0,class:"user-block"},ms={class:"role-menu-box"},vs=["onClick"],hs={class:"menu-header"},fs={class:"title"},gs={class:"desc"},ys={key:0,class:"check-box"},bs=["onClick"],ks={class:"menu-header"},ws={class:"title"},xs={class:"desc"},$s={key:0,class:"check-box"},Cs=["onClick"],Ds={class:"menu-header"},Os={class:"title"},Ss={class:"desc"},Ls={key:0,class:"check-box"},Bs={class:"hover-btn-box"},Ts=["onClick"],Us={__name:"knowledge-permissions",props:{treeParmas:{type:Object,default:()=>({})}},setup(Q){const{t:o}=oe("views.user.manage.components.knowledge-permissions"),L=f("2"),a=f([]),D=de(()=>o({2:"knowledge_base",1:"robot",3:"database"}[L.value]||"knowledge_base")),C=de(()=>o({2:"add_knowledge_base_permission",1:"add_robot_permission",3:"add_database_permission"}[L.value]||"add_knowledge_base_permission")),v=de(()=>({4:"manage",2:"edit",1:"view"}));de(()=>({4:"manage_desc",2:"edit_desc",1:"view_desc"}));const p=Q;me(()=>p.treeParmas,U=>{n()},{deep:!0});const n=()=>{Ze({object_type:L.value,identity_type:p.treeParmas.is_user?1:2,identity_id:p.treeParmas.id}).then(U=>{let g=U.data||[];a.value=g})};n();const V=()=>{n()},S=(U,g)=>{const x=v[g],J=o(x);te.confirm({title:o("prompt"),icon:e(ve),content:o("confirm_modify_permission",{role:J}),okText:o("confirm"),cancelText:o("cancel"),onOk:()=>{let j=[{object_id:+U.object_id,object_type:+U.object_type,operate_rights:+g}];Nt({identity_ids:U.identity_id,identity_type:2,object_array:JSON.stringify(j)}).then(B=>{H.success(o("modify_success")),n()})},onCancel(){}})},O=U=>{te.confirm({title:o("prompt"),icon:e(ve),content:o("confirm_delete_data"),okText:o("confirm"),okType:"danger",cancelText:o("cancel"),onOk:()=>{It({identity_id:U.identity_id,identity_type:2,object_id:U.object_id,object_type:U.object_type}).then(g=>{H.success(o("delete_success")),n()})},onCancel(){}})},N=f([]),w=f([]),P=f([]),I=async()=>{await Ne().then(U=>{N.value=U.data}).catch(()=>{})},r=async()=>{await Ve({type:""}).then(U=>{w.value=U.data}).catch(()=>{})},y=async()=>{await Ie().then(U=>{P.value=U.data}).catch(()=>{})},m=f(null),E=async()=>{if(!p.treeParmas.id)return H.error(o("select_department_first"));let U=L.value;U==1?await I():U==2?await r():U==3&&await y(),m.value.handleDepartmentOpen(U,p.treeParmas,a.value)},F=de(()=>[{dataIndex:"name",key:"name"},{title:o("permission"),dataIndex:"role",key:"role"},{title:o("action"),dataIndex:"action",key:"action",width:80}]);return(U,g)=>{const x=kt,J=Be,j=we,B=wt,d=ke;return h(),T(X,null,[i("div",_s,[e(J,{value:L.value,"onUpdate:value":g[0]||(g[0]=u=>L.value=u),onChange:V},{default:s(()=>[e(x,{value:"2"},{default:s(()=>[k(l(t(o)("knowledge_base")),1)]),_:1}),e(x,{value:"1"},{default:s(()=>[k(l(t(o)("robot")),1)]),_:1}),e(x,{value:"3"},{default:s(()=>[k(l(t(o)("database")),1)]),_:1})]),_:1},8,["value"]),i("div",cs,[e(j,{type:"primary",onClick:E},{default:s(()=>[k(l(C.value),1)]),_:1})]),i("div",us,[e(d,{columns:F.value,"data-source":a.value,pagination:!1},{headerCell:s(({column:u})=>[u.key==="name"?(h(),T(X,{key:0},[k(l(D.value),1)],64)):Y("",!0)]),bodyCell:s(({column:u,record:c})=>[u.key==="name"?(h(),T("div",ps,l(c.name),1)):Y("",!0),u.key==="role"?(h(),q(B,{key:1,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:s(()=>[i("div",ms,[i("div",{class:"role-menu",onClick:b=>S(c,4)},[i("div",hs,[e(t($t)),i("span",fs,l(t(o)("manage")),1)]),i("div",gs,l(t(o)("manage_desc")),1),c.operate_rights==4?(h(),T("div",ys,[e(t(Ce))])):Y("",!0)],8,vs),i("div",{class:"role-menu",onClick:b=>S(c,2)},[i("div",ks,[e(t(Ct)),i("span",ws,l(t(o)("edit")),1)]),i("div",xs,l(t(o)("edit_desc")),1),c.operate_rights==2?(h(),T("div",$s,[e(t(Ce))])):Y("",!0)],8,bs),i("div",{class:"role-menu",onClick:b=>S(c,1)},[i("div",Ds,[e(t(Dt)),i("span",Os,l(t(o)("view")),1)]),i("div",Ss,l(t(o)("view_desc")),1),c.operate_rights==1?(h(),T("div",Ls,[e(t(Ce))])):Y("",!0)],8,Cs)])]),default:s(()=>[i("div",Bs,[k(l(t(o)(v.value[c.operate_rights]))+" ",1),e(t(xt))])]),_:2},1024)):Y("",!0),u.key==="action"?(h(),T("a",{key:2,onClick:b=>O(c)},l(t(o)("delete")),9,Ts)):Y("",!0)]),_:1},8,["columns","data-source"])])]),e(We,{ref_key:"seeModelAlertRef",ref:m,robotList:N.value,libraryList:w.value,formList:P.value,onOk:n},null,8,["robotList","libraryList","formList"])],64)}}},Ms=ae(Us,[["__scopeId","data-v-4a761a45"]]),Rs={__name:"batch-edit-department",emits:["ok"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.components.batch-edit-department"),D=f(!1),C=L,v=re.useForm,p=ee({user_ids:"",department_ids:[]}),n=ee({department_ids:[{message:a("please_select_department"),required:!0}]}),{resetFields:V,validate:S,validateInfos:O}=v(p,n),N=y=>{p.user_ids=y,p.department_ids=[],D.value=!0,P()},w=f([]),P=()=>{xe({}).then(y=>{let m=y.data||[];w.value=Oe(m)})},I=f(!1),r=()=>{S().then(()=>{let y={...p};y.department_ids=p.department_ids.join(","),I.value=!0,Et(y).then(m=>{H.success(a("batch_edit_department_success")),D.value=!1,C("ok")}).finally(()=>{I.value=!1})})};return o({show:N}),(y,m)=>{const E=Le,F=be,U=re,g=te;return h(),T("div",null,[e(g,{open:D.value,"onUpdate:open":m[1]||(m[1]=x=>D.value=x),title:t(a)("batch_edit_department"),onOk:r,confirmLoading:I.value},{default:s(()=>[e(U,{layout:"vertical",style:{"margin-top":"24px"}},{default:s(()=>[e(F,le({label:t(a)("select_department")},t(O).department_ids),{default:s(()=>[e(E,{value:p.department_ids,"onUpdate:value":m[0]||(m[0]=x=>p.department_ids=x),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:t(a)("please_select"),"allow-clear":"",multiple:"","tree-default-expand-all":"","tree-data":w.value,"tree-node-filter-prop":"label"},{title:s(({value:x,label:J})=>[i("div",null,l(J),1)]),_:1},8,["value","placeholder","tree-data"])]),_:1},16,["label"])]),_:1})]),_:1},8,["open","title","confirmLoading"])])}}},Vs={class:"flex-content-box"},Ps={class:"left-department-box"},js={class:"team-members-pages"},Ns={class:"main-tabs-block"},Is={class:"list-box"},Es={class:"user-box"},As=["src"],Fs={class:"name-info"},zs={class:"user-name"},Ks={class:"nick-name"},Js={key:0,class:"list-content"},Ys={key:1,class:"list-preview list-content"},qs={style:{display:"inline"}},Hs={class:"list-item-box"},Qs={class:"list-item"};const Gs={key:0,class:"status-block green"},Zs={key:1,class:"status-block yellow"},Ws={class:"disabled"},Xs={class:"disabled"},en={class:"disabled"},tn=["onClick"],an=["onClick"],sn=["onClick"],nn={__name:"team-members",setup(Q){const{t:o}=oe("views.user.manage.team-members"),L=f(1),a=de(()=>[{value:1,payload:{title:o("team_members")}}]),D=ee({page:1,size:10,total:0,search:""}),C=f([]),v=f([]),p=f([]),n=f(null),V=$=>{D.page=$.current,D.size=$.pageSize,r()},S=ee({id:""}),O=$=>{Object.assign(S,{...$}),L.value==1&&N()},N=()=>{D.page=1,r()},w=f([]),P=$=>{let z=[];return $.map(ne=>{z.push(ne.name||ne.department_name)}),z.join(", ")},I=f(!1),r=()=>{let $={page:D.page,size:D.size,search:D.search};S.id&&S.is_default!=1&&($.department_id=S.id),I.value=!0,lt($).then(z=>{let ne=z.data.list;ne.forEach(K=>{K.create_time=_e(K.create_time*1e3).format("YYYY-MM-DD HH:mm"),K.expire_time_desc=K.expire_time=="0"?o("permanent"):_e(K.expire_time*1e3).format("YYYY-MM-DD HH:mm"),K.expire_status=0,(K.expire_time=="0"||_e().unix()<K.expire_time)&&(K.expire_status=1),K.managed_robot_list=K.managed_robot_list?JSON.parse(K.managed_robot_list):[],K.managed_library_list=K.managed_library_list?JSON.parse(K.managed_library_list):[],K.managed_form_list=K.managed_form_list?JSON.parse(K.managed_form_list):[],K.departments=K.departments?JSON.parse(K.departments):[]}),w.value=ne,F.selectedRowKeys=[],D.total=+z.data.total}).finally(()=>{I.value=!1})},y=()=>{L.value==1&&N()},m=f(null),E=()=>{r(),m.value.getLists()},F=ee({selectedRowKeys:[]}),U=$=>{F.selectedRowKeys=$},g=$=>({disabled:$.role_type==1}),x=$=>{it({user_id:$.id}).then(z=>{H.success($.login_switch==1?o("login_disabled_success"):o("login_enabled_success")),r()})},J=f(null),j=()=>{J.value.add(S.id)},B=$=>{J.value.edit($)},d=f(null),u=$=>{d.value.open($)},c=$=>{te.confirm({title:o("confirm_delete_title"),icon:e(ve),content:o("confirm_delete_content"),okText:o("confirm"),okType:"danger",cancelText:o("cancel"),onOk:()=>{dt({id:$.id}).then(z=>{H.success(o("delete_success")),r()})},onCancel(){}})},b=async()=>{await Ne().then($=>{C.value=$.data}).catch(()=>{})},M=async()=>{await Ve({type:""}).then($=>{v.value=$.data}).catch(()=>{})},A=async()=>{await Ie().then($=>{p.value=$.data}).catch(()=>{})},G=async $=>{let z=[];if(F.selectedRowKeys.forEach(ne=>{w.value.filter(he=>he.id==ne)[0].role_type==1||z.push(ne)}),F.selectedRowKeys=z,F.selectedRowKeys.length==0)return H.error(o("please_select_members"));$==1?await b():$==2?await M():$==3&&await A(),n.value.handleBatchOpen($,F.selectedRowKeys.join(","))},se=f(null),_=()=>{if(F.selectedRowKeys.length==0)return H.error(o("please_select_members"));se.value.show(F.selectedRowKeys.join(","))},W=async($,z)=>{$==1?await b():$==2?await M():$==3&&await A(),n.value.open($,"add",z)},Z=async($,z)=>{$==1?await b():$==2?await M():$==3&&await A(),n.value.open($,"edit",z)};return($,z)=>{const ne=mt,K=Je,he=we,bn=Ge,kn=Qe,wn=He,fe=Me,Xe=Ue,$e=qe,ce=Te,xn=ot,et=St,tt=ke;return h(),T("div",Vs,[i("div",Ps,[e(ne,{style:{"padding-right":"24px"}},{default:s(()=>[e(rs,{ref_key:"departmentTreeRef",ref:m,onSelect:O,onRefresh:r},null,512)]),_:1})]),i("div",js,[e(ne,{style:{"padding-right":"24px"}},{default:s(()=>[i("div",Ns,[e(K,{value:L.value,"onUpdate:value":z[0]||(z[0]=R=>L.value=R),options:a.value,onChange:y},{label:s(({payload:R})=>[k(l(R.title),1)]),_:1},8,["value","options"])]),L.value==1?(h(),T(X,{key:0},[e(fe,{justify:"space-between"},{default:s(()=>[e(fe,{gap:8},{default:s(()=>[e(he,{type:"primary",onClick:j},{icon:s(()=>[e(t(ye))]),default:s(()=>[k(" "+l(t(o)("add_team_member")),1)]),_:1}),Y("",!0),e(he,{onClick:_},{default:s(()=>[k(l(t(o)("batch_modify_department")),1)]),_:1})]),_:1}),e(Xe,{value:D.search,"onUpdate:value":z[4]||(z[4]=R=>D.search=R),placeholder:t(o)("search_placeholder"),style:{width:"288px"},onSearch:N},null,8,["value","placeholder"])]),_:1}),i("div",Is,[e(tt,{"data-source":w.value,scroll:{x:1100},loading:I.value,"row-key":"id","row-selection":{selectedRowKeys:F.selectedRowKeys,onChange:U,getCheckboxProps:g},pagination:{current:D.page,total:D.total,pageSize:D.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:V},{default:s(()=>[e(ce,{title:t(o)("member_name"),"data-index":"user_name",width:"190px"},{default:s(({record:R})=>[i("div",Es,[i("img",{src:R.avatar||t(De),alt:""},null,8,As),i("div",Fs,[i("div",zs,[R.user_name&&R.user_name.length>7?(h(),q($e,{key:0,title:R.user_name},{default:s(()=>[k(l(R.user_name),1)]),_:2},1032,["title"])):(h(),T(X,{key:1},[k(l(R.user_name),1)],64))]),i("div",Ks,[R.nick_name&&R.nick_name.length>7?(h(),q($e,{key:0,title:R.nick_name},{default:s(()=>[k(l(R.nick_name),1)]),_:2},1032,["title"])):(h(),T(X,{key:1},[k(l(R.nick_name),1)],64))])])])]),_:1},8,["title"]),e(ce,{title:t(o)("role"),"data-index":"role_name",width:"100px"},{default:s(({record:R})=>[k(l(R.role_name),1)]),_:1},8,["title"]),e(ce,{"data-index":"departments",width:"200px"},{title:s(()=>[k(l(t(o)("department")),1)]),default:s(({record:R})=>[R.departments&&R.departments.length==0?(h(),T("div",Js," -- ")):(h(),T("div",Ys,[e($e,null,{title:s(()=>[i("div",qs,l(P(R.departments)),1)]),default:s(()=>[i("div",Hs,[i("div",Qs,l(P(R.departments)),1)])]),_:2},1024)]))]),_:1}),Y("",!0),Y("",!0),Y("",!0),e(ce,{title:t(o)("status"),"data-index":"expire_status",width:"120px"},{default:s(({record:R})=>[R.expire_status==1?(h(),T("div",Gs,[e(t(Ot)),k(l(t(o)("active")),1)])):Y("",!0),R.expire_status==0?(h(),T("div",Zs,[e(t(Ye)),k(l(t(o)("expired")),1)])):Y("",!0)]),_:1},8,["title"]),e(ce,{title:t(o)("expiry_time"),"data-index":"expire_time_desc",width:"130px"},{default:s(({record:R})=>[k(l(R.expire_time_desc),1)]),_:1},8,["title"]),e(ce,{title:t(o)("login"),"data-index":"login_switch",width:"90px",fixed:"right"},{default:s(({record:R})=>[e(et,{onChange:ie=>x(R),checked:R.login_switch=="1",disabled:R.role_type=="1","checked-children":t(o)("on"),"un-checked-children":t(o)("off")},null,8,["onChange","checked","disabled","checked-children","un-checked-children"])]),_:1},8,["title"]),e(ce,{title:t(o)("actions"),"data-index":"action",width:"240px",fixed:"right"},{default:s(({record:R})=>[R.role_type=="1"?(h(),q(fe,{key:0,gap:16},{default:s(()=>[i("span",Ws,l(t(o)("edit")),1),i("span",Xs,l(t(o)("reset_password")),1),i("span",en,l(t(o)("delete")),1)]),_:1})):(h(),q(fe,{key:1,gap:16},{default:s(()=>[i("a",{onClick:ie=>B(R)},l(t(o)("edit")),9,tn),i("a",{onClick:ie=>u(R)},l(t(o)("reset_password")),9,an),i("a",{onClick:ie=>c(R)},l(t(o)("delete")),9,sn)]),_:2},1024))]),_:1},8,["title"])]),_:1},8,["data-source","loading","row-selection","pagination"])])],64)):(h(),q(Ms,{key:1,treeParmas:S},null,8,["treeParmas"]))]),_:1}),e(la,{ref_key:"addTeamMembersRef",ref:J,onOk:E},null,512),e(ra,{ref_key:"resetPasswordRef",ref:d,onOk:r},null,512),e(We,{ref_key:"seeModelAlertRef",ref:n,robotList:C.value,libraryList:v.value,formList:p.value,onOk:r},null,8,["robotList","libraryList","formList"]),e(Rs,{ref_key:"batchEditDepartmentRef",ref:se,onOk:E},null,512)])])}}},on=ae(nn,[["__scopeId","data-v-7b5d5a5c"]]),ln={class:"form-box"},dn={class:"title-row"},rn={class:"check-num"},_n={key:0},cn={__name:"add-role",emits:["ok"],setup(Q,{expose:o,emit:L}){const{t:a}=oe("views.user.manage.components.add-role"),D=L,C=re.useForm,v=f([]),p=f({}),n=f(!1),V=f(a("add_role_title")),S=f(""),O=ee({name:"",mark:"",role_type:""}),N=ee({name:[{message:a("role_name_required"),required:!0}]}),{resetFields:w,validate:P,validateInfos:I}=C(O,N),r=async()=>{await rt().then(j=>{let B=j.data||[];B.forEach(d=>{d.uni_key=="System"&&(d.children=d.children.filter(u=>u.uni_key!="AccountManage"))}),v.value=B;for(let d=0;d<B.length;d++){const u=B[d];p.value[u.uni_key]=[]}})},y=async()=>{await r(),V.value=a("add_role_title"),S.value="",n.value=!0,O.name="",O.mark="",w()},m=j=>{V.value=a("edit_role_title"),S.value=j.id,_t({id:j.id}).then(B=>{let d=B.data,u=d.role_permission||[];O.name=d.name,O.mark=d.mark,O.role_type=d.role_type,p.value=E(v.value,u),n.value=!0})},E=(j,B)=>{let d={};return j.forEach(u=>{d[u.uni_key]=[];for(let c=0;c<u.children.length;c++){const b=u.children[c];B.includes(b.uni_key)&&d[u.uni_key].push(b.uni_key),b.children&&b.children.length>0&&b.children.forEach(M=>{B.includes(M.uni_key)&&d[u.uni_key].push(M.uni_key)})}}),d},F=j=>{let B=[];for(let d in j)j[d].map(c=>{B.push(c)});return B},U=()=>{P().then(()=>{let j=F(p.value),B={id:S.value,mark:O.mark};O.role_type==0&&(B.name=O.name,B.role_type=O.role_type,B.uni_keys=j.join(",")),ct(B).then(d=>{n.value=!1,H.success(a("save_success")),D("ok")})})},g=(j,B)=>{j.children&&pe(()=>{if(!p.value[B].includes(j.uni_key)){let d=j.children.map(u=>u.uni_key);p.value[B]=p.value[B].filter(u=>!d.includes(u))}})},x=(j,B,d)=>{pe(()=>{p.value[d].includes(j.uni_key)&&(p.value[d].push(B.uni_key),p.value[d]=[...new Set(p.value[d])])})},J=j=>{let B=j.length;return j.forEach(d=>{d.children&&d.children.length&&(B=B+d.children.length)}),B};return pt(()=>{r()}),o({add:y,edit:m}),(j,B)=>{const d=Se,u=be,c=Lt,b=Me,M=Mt,A=Ut,G=Tt,se=Bt,_=re,W=te;return h(),T("div",null,[e(W,{open:n.value,"onUpdate:open":B[2]||(B[2]=Z=>n.value=Z),title:V.value,onOk:U,width:"746px"},{default:s(()=>[i("div",ln,[e(_,{layout:"vertical"},{default:s(()=>[e(u,le({label:t(a)("role_name_label")},t(I).name),{default:s(()=>[e(d,{type:"text",maxlength:100,disabled:O.role_type>0,placeholder:t(a)("role_name_placeholder"),value:O.name,"onUpdate:value":B[0]||(B[0]=Z=>O.name=Z)},null,8,["disabled","placeholder","value"])]),_:1},16,["label"]),e(u,{label:t(a)("role_mark_label")},{default:s(()=>[e(c,{value:O.mark,"onUpdate:value":B[1]||(B[1]=Z=>O.mark=Z),placeholder:t(a)("role_mark_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(u,{label:t(a)("role_permission_label")},{default:s(()=>[(h(!0),T(X,null,ue(v.value,Z=>(h(),T("div",{class:"role-check-box",key:Z.uni_key},[e(b,{class:"title-boock",justify:"space-between"},{default:s(()=>[i("div",dn,l(Z.name),1),i("div",rn,l(p.value[Z.uni_key].length)+"/"+l(J(Z.children)),1)]),_:2},1024),e(se,{value:p.value[Z.uni_key],"onUpdate:value":$=>p.value[Z.uni_key]=$,style:{width:"100%"}},{default:s(()=>[e(G,{gutter:[0,12]},{default:s(()=>[(h(!0),T(X,null,ue(Z.children,$=>(h(),q(A,{span:$.children&&$.children.length?12:6,key:$.uni_key},{default:s(()=>[e(M,{onChange:z=>g($,Z.uni_key),disabled:O.role_type>0,value:$.uni_key},{default:s(()=>[k(l($.name),1)]),_:2},1032,["onChange","disabled","value"]),$.children&&$.children.length>0?(h(),T("span",_n,[B[3]||(B[3]=k("( ",-1)),(h(!0),T(X,null,ue($.children,z=>(h(),q(M,{onChange:ne=>x(z,$,Z.uni_key),key:z.uni_key,disabled:O.role_type>0,value:z.uni_key},{default:s(()=>[k(l(z.name),1)]),_:2},1032,["onChange","disabled","value"]))),128)),B[4]||(B[4]=k(" )",-1))])):Y("",!0)]),_:2},1032,["span"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])]))),128))]),_:1},8,["label"])]),_:1})])]),_:1},8,["open","title"])])}}},un=ae(cn,[["__scopeId","data-v-43a5dc8f"]]),pn={class:"team-members-pages"},mn={class:"list-box"},vn={__name:"role-permissions",setup(Q){const{t:o}=oe("views.user.manage.role-permissions");f("");const L=ee({page:1,size:10,total:0,search:""}),a=f([{}]),D=O=>{L.page=O.current,L.size=O.pageSize,v()},C=()=>{L.page=1,v()},v=()=>{let O={page:L.page,size:L.size,search:L.search};Re(O).then(N=>{let w=N.data.list;w.forEach(P=>{P.update_time=_e(P.update_time*1e3).format("YYYY-MM-DD HH:mm")}),a.value=w,L.total=+N.data.total})};C();const p=f(null),n=()=>{p.value.add()},V=O=>{p.value.edit(O)},S=O=>{te.confirm({title:o("confirm_title"),icon:e(ve),content:o("confirm_content"),okText:o("ok_text"),okType:"danger",cancelText:o("cancel_text"),onOk:()=>{ut({id:O.id}).then(N=>{H.success(o("delete_success")),v()})},onCancel(){}})};return(O,N)=>{const w=we,P=Ue,I=Me,r=Te,y=ke;return h(),T("div",pn,[e(I,{justify:"space-between"},{default:s(()=>[e(w,{type:"primary",onClick:n},{icon:s(()=>[e(t(ye))]),default:s(()=>[k(" "+l(t(o)("add_role_btn")),1)]),_:1}),e(P,{value:L.search,"onUpdate:value":N[0]||(N[0]=m=>L.search=m),placeholder:t(o)("search_placeholder"),style:{width:"288px"},onSearch:C},null,8,["value","placeholder"])]),_:1}),i("div",mn,[e(y,{"data-source":a.value,pagination:{current:L.page,total:L.total,pageSize:L.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:D},{default:s(()=>[e(r,{title:t(o)("column_role"),"data-index":"name",width:"157px"},{default:s(({record:m})=>[k(l(m.name),1)]),_:1},8,["title"]),e(r,{title:t(o)("column_remark"),"data-index":"mark",width:"480px"},{default:s(({record:m})=>[k(l(m.mark),1)]),_:1},8,["title"]),e(r,{title:t(o)("column_update_time"),"data-index":"update_time",width:"150px"},{default:s(({record:m})=>[k(l(m.update_time),1)]),_:1},8,["title"]),e(r,{title:t(o)("column_operate_name"),"data-index":"operate_name",width:"130px"},{default:s(({record:m})=>[k(l(m.operate_name),1)]),_:1},8,["title"]),e(r,{title:t(o)("column_create_name"),"data-index":"create_name",width:"130px"},{default:s(({record:m})=>[k(l(m.create_name),1)]),_:1},8,["title"]),e(r,{title:t(o)("column_action"),"data-index":"action",width:"178px"},{default:s(({record:m})=>[e(I,{gap:16,class:"action-box"},{default:s(()=>[e(w,{type:"link",onClick:E=>V(m)},{default:s(()=>[k(l(t(o)("btn_edit")),1)]),_:1},8,["onClick"]),e(w,{type:"link",onClick:E=>S(m),disabled:m.role_type<=3&&m.role_type>0},{default:s(()=>[k(l(t(o)("btn_delete")),1)]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data-source","pagination"])]),e(un,{ref_key:"addRoleRef",ref:p,onOk:v},null,512)])}}},hn=ae(vn,[["__scopeId","data-v-efdca3a8"]]),fn={class:"user-model-page"},gn={class:"list-wrapper"},yn={__name:"index",setup(Q){const o=f(1),L=()=>{};return(a,D)=>(h(),T("div",fn,[e(Kt,{value:o.value,"onUpdate:value":D[0]||(D[0]=C=>o.value=C),onChange:L},null,8,["value"]),i("div",gn,[o.value==1?(h(),q(on,{key:0})):(h(),q(hn,{key:1}))])]))}},In=ae(yn,[["__scopeId","data-v-a224fd51"]]);export{In as default};
