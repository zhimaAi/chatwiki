import{_ as Ie}from"./empty-CzGZrENG.js";import{u as te,aD as Pe,_ as ce,bC as Ce,bl as ze,bD as ne}from"../../index-DSFcP5NQ.js";import{_ as se}from"./emoji-mart-BBMRoEa3.js";import{a as d,b as _,p as t,v as l,u as o,r as y,E as X,c as ue,w as oe,y as i,t as r,h as M,_ as c,q as g,F as j,l as J,e as R,z as ie,D as me,a1 as pe,i as Ue,V as Se,m as le}from"./vue-chunks-BdaA73Wf.js";import{M as re}from"./model-select-CMPvMrAQ.js";import{M as Ne}from"./editor-code-DlsHKXTn.js";import{m as Le,G as he,B as ve,M as fe,b as ge,F as _e,v as je,u as Fe,I as ke,J as De,q as be,ac as ee,H as Oe,V as ye,s as Te,r as Ee,a0 as Me,O as Be,z as Re,c as Ve,Z as Ae,$ as Qe}from"./ui-antd-Dl1wwwCD.js";import{U as Ge}from"./index-XVLbk3qE.js";const He={class:"empty-box"},Ke={class:"title"},Je={class:"info"},Xe={__name:"empty",setup(K){const{t:B}=te("views.library.document-segmentation.components.empty");return(F,n)=>(_(),d("div",He,[n[0]||(n[0]=t("img",{src:Ie,alt:""},null,-1)),t("div",Ke,l(o(B)("title")),1),t("div",Je,l(o(B)("info")),1)]))}},eo=se(Xe,[["__scopeId","data-v-4a68ac40"]]),Ze={class:"custom-modal-header"},We={class:"ai-generate-wrapper"},Ye={class:"ai-generate-wrapper-left"},et={class:"form-box-wrapper-options"},tt={class:"form-item flex1"},st={class:"form-label required"},nt={class:"form-content"},ot={class:"form-item flex1"},at={class:"form-content dual-inputs"},lt={class:"input-group"},it={class:"form-label required"},rt={class:"form-label-input-box"},_t={class:"form-item generate-btn-box"},ct={class:"result-nav"},dt={key:0,class:"tip"},mt={key:1,class:"result-nav-text"},ut={key:0,class:"container"},pt={class:"result-container"},ht=["innerHTML"],vt={class:"result-footer"},ft={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(K,{expose:B,emit:F}){const{t:n}=te("views.library.document-segmentation.components.ai-generate-modal"),u=Pe(),q=y(!1),p=y(!1),x=y(!1),e=y(!1),k=X({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),V=new Ne({html:!0,linkify:!0,typographer:!0}),Q=y(""),w=X({content:""}),S=ue(()=>u.initDocumentFragmentList);oe(()=>w.content,()=>{Q.value=V.render(w.content)});const G=F;y("");const N=y(!1),D=()=>{p.value=!1,e.value=!1,N.value=!0},h=()=>{ge.success(n("message_success")),p.value=!1,e.value=!1,N.value=!1,G("handleEdit",O.value)},O=y("");function T(I,f){let P="",z=0;for(const U of I){if(z>=f)break;const v=U.content.trim()||"",Z=f-z;if(v.length<=Z)P+=v,z+=v.length;else{P+=v.slice(0,Z),z=f;break}}return P}const $=async()=>{w.content="",O.value="",x.value=!0,e.value=!0;try{const I=await T(S.value,k.count);let f={ai_prompt_model_config_id:k.model_config_id,ai_prompt_model:k.use_model,ai_prompt_question:I};const P=await Ce(f);O.value=P.data,w.content=`<div class="dialog-message">${P.data}</div>`,p.value=!0}finally{x.value=!1}};return B({showModal:D}),(I,f)=>{const P=Le,z=he,U=ce,v=ve,Z=fe;return _(),d("div",null,[i(Z,{open:N.value,"onUpdate:open":f[3]||(f[3]=L=>N.value=L),onOk:h,maskClosable:!1,width:e.value?"944px":"472px","ok-button-props":{style:{display:"none"}}},{title:r(()=>[t("div",Ze,[t("span",null,l(o(n)("title")),1)])]),footer:r(()=>[...f[5]||(f[5]=[])]),default:r(()=>[t("div",We,[t("div",{class:M(["form-box-wrapper ai-generate-wrapper-box",{"show-generate":e.value}])},[t("div",Ye,[i(P,{class:"alert-box",message:o(n)("alert_message"),type:"info"},null,8,["message"]),t("div",et,[t("div",tt,[t("div",st,l(o(n)("label_select_model")),1),t("div",nt,[i(re,{modelType:"LLM",modeName:k.use_model,"onUpdate:modeName":f[0]||(f[0]=L=>k.use_model=L),modeId:k.model_config_id,"onUpdate:modeId":f[1]||(f[1]=L=>k.model_config_id=L)},null,8,["modeName","modeId"])])]),t("div",ot,[t("div",at,[t("div",lt,[t("div",it,l(o(n)("label_content_prefix")),1),t("div",rt,[i(z,{value:k.count,"onUpdate:value":f[2]||(f[2]=L=>k.count=L),min:1,max:1e4,style:{width:"137px"}},null,8,["value"]),c(l(o(n)("label_count_suffix")),1)])])])])]),t("div",_t,[i(v,{onClick:$,loading:x.value,class:"generate-btn"},{default:r(()=>[i(U,{name:"ai-generate-white",style:{"font-size":"16px"}}),c(" "+l(o(n)("btn_generate")),1)]),_:1},8,["loading"])])]),t("div",{class:M(["ai-generate-wrapper-right",{"show-result":e.value}])},[t("div",ct,[i(U,{name:"generate-icon",style:{"font-size":"14px"}}),x.value?(_(),d("span",dt,l(o(n)("tip_generating")),1)):(_(),d("div",mt,l(o(n)("tip_completed")),1))]),!w.content&&x.value&&!q.value?(_(),d("div",ut,[...f[4]||(f[4]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)])])):g("",!0),t("div",pt,[t("div",{class:"dialog-content",innerHTML:Q.value},null,8,ht)]),t("div",vt,[i(v,{class:"result-footer-btn",disabled:O.value=="",type:"primary",onClick:h},{default:r(()=>[c(l(o(n)("btn_use_prompt")),1)]),_:1},8,["disabled"])])],2)],2)])]),_:1},8,["open","width"])])}}},gt=se(ft,[["__scopeId","data-v-1d43fb03"]]),kt={class:"segmentation-setting"},bt={class:"setting-items"},yt={class:"setting-item intelligent-setting active"},xt={class:"setting-item-body"},wt={class:"sub-setting-item-name"},qt={key:0,class:"custom-setting-form excel-qa-form"},$t={class:"form-item"},It={class:"form-item-box"},Pt={class:"form-item-label"},Ct={class:"form-item-body"},zt={class:"form-item-box"},Ut={class:"form-item-label not-required"},St={class:"form-item-body"},Nt={class:"form-item-box"},Lt={class:"form-item-label"},jt={class:"form-item-body"},Ft={class:"sub-setting-item-name"},Dt={class:"indexing-methods-box"},Ot={class:"list-title-block"},Tt={class:"list-content"},Et={class:"list-title-block"},Mt={class:"list-content"},Bt={class:"btn-box-block"},Rt={key:1,class:"custom-setting-form excel-qa-form"},Vt={class:"form-item"},At={class:"form-item-box"},Qt={class:"form-item-label"},Gt={class:"form-item-body"},Ht={class:"form-item-box"},Kt={class:"form-item-label not-required"},Jt={class:"form-item-body"},Xt={class:"form-item-box"},Zt={class:"form-item-label"},Wt={class:"form-item-body"},Yt={class:"sub-setting-item-name"},es={class:"indexing-methods-box"},ts={class:"list-title-block"},ss={class:"list-content"},ns={class:"list-title-block"},os={class:"list-content"},as={class:"btn-box-block"},ls={key:0,class:"custom-setting-form subsection-form"},is={class:"form-item"},rs={key:0,class:"form-item-title"},_s={class:"form-item-label"},cs={class:"form-item-body"},ds={class:"form-item-tip"},ms={class:"select-card-box"},us={class:"card-title"},ps={class:"card-desc"},hs={class:"card-title"},vs={class:"card-desc"},fs={class:"card-title"},gs={class:"card-desc"},ks={class:"card-title"},bs={class:"card-desc"},ys={class:"form-item",style:{"margin-bottom":"18px"}},xs={class:"form-item-label"},ws={class:"form-item-body"},qs={class:"form-item"},$s={class:"form-item-label"},Is={class:"form-item-body"},Ps={class:"unit-text"},Cs={class:"form-item"},zs={class:"form-item-label not-required"},Us={class:"form-item-body"},Ss={class:"unit-text"},Ns={class:"form-item"},Ls={class:"form-item-body"},js={class:"form-item",style:{"margin-bottom":"16px"}},Fs={class:"form-item-label"},Ds={class:"form-item-body"},Os={class:"form-item",style:{"margin-bottom":"16px"}},Ts={class:"form-item-label"},Es={class:"form-item-body"},Ms={class:"form-item"},Bs={class:"form-item-label"},Rs={class:"form-item-body"},Vs={class:"unit-text"},As={class:"form-item"},Qs={class:"form-item-label not-required"},Gs={class:"form-item-body"},Hs={class:"unit-text"},Ks={class:"form-item",style:{"margin-bottom":"16px"}},Js={class:"form-item-label"},Xs={class:"form-item-body"},Zs={class:"form-item",style:{"margin-bottom":"16px"}},Ws={class:"form-item-label-box"},Ys={class:"form-item-label"},en={class:"form-item-body"},tn={class:"form-item",style:{"margin-bottom":"16px"}},sn={class:"form-item-label"},nn={class:"form-item-body form-item-inptu-numbner-box"},on={class:"main-title-block"},an={class:"form-item"},ln={class:"form-item-label"},rn={class:"form-item-body"},_n={key:0,class:"form-item"},cn={class:"form-item-label"},dn={class:"form-item-body"},mn={key:1,class:"form-item"},un={class:"form-item-label"},pn={class:"form-item-body"},hn={class:"unit-text"},vn={class:"main-title-block"},fn={class:"form-item"},gn={class:"form-item-label"},kn={class:"form-item-body"},bn={class:"form-item"},yn={class:"form-item-label"},xn={class:"form-item-body"},wn={class:"unit-text"},qn={class:"btn-box-block"},$n={class:"btn-box-block"},In={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1},status:{type:String,default:""}},emits:["change","validate","save","changeChunkType"],setup(K,{expose:B,emit:F}){const{t:n}=te("views.library.document-segmentation.components.segmentation-setting"),u=_e.useForm,q=F,p=K;ue(()=>p.libFileInfo.doc_type=="1"&&(p.libFileInfo.file_ext=="docx"||p.libFileInfo.file_ext=="html"));const x=n("default_ai_chunk_prompt");oe(p,m=>{let s=m.libFileInfo;e.separators_no=ne(s.separators_no,[12,11]),e.chunk_size=+s.chunk_size||512,e.not_merged_text=s.not_merged_text=="true",e.ai_chunk_size=+s.ai_chunk_size||5e3,e.chunk_overlap=+s.chunk_overlap||50,e.question_lable=s.question_lable,e.similar_label=s.similar_label,e.answer_lable=s.answer_lable,e.question_column=s.question_column||void 0,e.answer_column=s.answer_column||void 0,e.similar_column=s.similar_column||void 0,e.qa_index_type=+s.qa_index_type,e.enable_extract_image=s.enable_extract_image=="true",e.chunk_type=+s.chunk_type,e.semantic_chunk_size=+s.semantic_chunk_size||512,e.semantic_chunk_overlap=+s.semantic_chunk_overlap||50,e.semantic_chunk_threshold=+s.semantic_chunk_threshold||90,e.semantic_chunk_use_model=s.semantic_chunk_use_model||"",e.ai_chunk_prumpt=s.ai_chunk_prumpt||x,e.ai_chunk_model=s.ai_chunk_model||"",e.semantic_chunk_model_config_id=s.semantic_chunk_model_config_id>0?s.semantic_chunk_model_config_id:"",e.ai_chunk_model_config_id=s.ai_chunk_model_config_id>0?s.ai_chunk_model_config_id:"",e.father_chunk_paragraph_type=+s.father_chunk_paragraph_type||2,e.father_chunk_separators_no=ne(s.father_chunk_separators_no,[12,11]),e.father_chunk_chunk_size=+s.father_chunk_chunk_size||1024,e.son_chunk_separators_no=ne(s.son_chunk_separators_no,[8,10]),e.son_chunk_chunk_size=+s.son_chunk_chunk_size||512,setTimeout(()=>{e.semantic_chunk_use_model=s.semantic_chunk_use_model||"",e.semantic_chunk_model_config_id=s.semantic_chunk_model_config_id>0?s.semantic_chunk_model_config_id:""},200),s.chunk_type==0&&(e.separators_no=ne(s.normal_chunk_default_separators_no,[12,11]),e.chunk_size=+s.normal_chunk_default_chunk_size||512,e.not_merged_text=s.normal_chunk_default_not_merged_text=="true",e.chunk_overlap=+s.normal_chunk_default_chunk_overlap||50,e.chunk_type=+s.default_chunk_type,e.semantic_chunk_size=+s.semantic_chunk_default_chunk_size||512,e.semantic_chunk_overlap=+s.semantic_chunk_default_chunk_overlap||50,e.semantic_chunk_threshold=+s.semantic_chunk_default_threshold||90,setTimeout(()=>{e.semantic_chunk_use_model=s.default_use_model,e.semantic_chunk_model_config_id=s.default_model_config_id>0?s.default_model_config_id:""},100)),e.is_qa_doc=p.library_type==2?1:0});const e=X({separators_no:[],not_merged_text:!1,chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:x,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512});let k={};setTimeout(()=>{k=JSON.parse(JSON.stringify(e))},500);const V=y([]),Q=y(null),w=m=>{V.value=m,Ue(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&S()})},S=()=>{if(V.value.length>0){let m=null,s=null;for(let E of V.value)if(E.model_define==="tongyi"){m=E;for(let C of m.children)if(C.name==="qwen-max"){s=C;break}break}m||(m=V.value[0],s=m.children[0]),m&&s&&(e.ai_chunk_model=s.name,e.ai_chunk_model_config_id=s.model_config_id)}},G=()=>{Object.assign(e,k)},N=()=>{q("save")},D=X({question_lable:[{message:n("validation_error_question_label"),validator:async(m,s)=>e.is_qa_doc==1&&p.mode==0?s?Promise.resolve():Promise.reject(n("validation_error_question_label")):Promise.resolve()}],semantic_chunk_model_config_id:[{message:n("validation_error_embedding_model"),validator:async(m,s)=>e.is_qa_doc==0&&e.chunk_type==2?s?Promise.resolve():Promise.reject(n("validation_error_embedding_model")):Promise.resolve()}],ai_chunk_model_config_id:[{message:n("validation_error_ai_llm"),validator:async(m,s)=>e.is_qa_doc==0&&e.chunk_type==3?s?Promise.resolve():Promise.reject(n("validation_error_ai_llm")):Promise.resolve()}],answer_lable:[{message:n("validation_error_answer_label"),validator:async(m,s)=>e.is_qa_doc==1&&p.mode==0?s?Promise.resolve():Promise.reject(n("validation_error_answer_label")):Promise.resolve()}],separators_no:[{message:n("validation_error_separator"),validator:async(m,s)=>p.mode!=1&&e.is_qa_doc==0&&s.length==0&&e.chunk_type==1?Promise.reject(n("validation_error_separator")):Promise.resolve()}],chunk_size:[{validator:async(m,s)=>{if(p.mode!=1&&e.chunk_type==1)if(s){if(s>1e4)return Promise.reject(n("validation_error_max_length_exceeded"))}else return Promise.reject(n("validation_error_max_length"));else if(e.chunk_type==3&&!s)return Promise.reject(n("validation_error_max_characters"));return Promise.resolve()}}],ai_chunk_size:[{validator:async(m,s)=>e.chunk_type==3&&!s?Promise.reject(n("validation_error_max_characters")):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(m,s)=>!e.ai_chunk_prumpt&&!s?Promise.reject(n("validation_error_prompt")):Promise.resolve()}],chunk_overlap:[{validator:async(m,s)=>p.mode!=1&&e.chunk_type==1&&s>parseInt(e.chunk_size/2)?Promise.reject(n("validation_error_overlap_exceeded")):Promise.resolve()}],question_column:[{message:n("validation_error_question_column"),validator:async(m,s)=>p.mode==1&&e.is_qa_doc==1?s?Promise.resolve():Promise.reject(n("validation_error_question_column")):Promise.resolve()}],answer_column:[{message:n("validation_error_answer_column"),validator:async(m,s)=>p.mode==1&&e.is_qa_doc==1?s?Promise.resolve():Promise.reject(n("validation_error_answer_column")):Promise.resolve()}]}),{resetFields:h,validate:O,validateInfos:T}=u(e,D),$=y(!1),I=y(!1),f=()=>{$.value=!0,e.chunk_type!=3&&(I.value=!0),P()},P=(m=!0)=>{let s=pe(e);O().then(()=>{q("change",{...s}),q("validate","")}).catch(E=>{const{errorFields:C}=E;if(C.length>0){m&&C[0].name,ge.error(C[0].errors[0]),q("validate",C[0].errors[0]),$.value=!1,I.value=!1;return}q("validate",""),q("change",{...s})})};let z=null;const U=()=>{z&&(clearTimeout(z),z=null),z=setTimeout(()=>{P()},500)},v=y([]);(()=>{ze().then(m=>{v.value=m.data||[]})})();const L=m=>{m!=e.qa_index_type&&(e.qa_index_type=m,P())},xe=m=>{e.ai_chunk_prumpt=m};return oe(()=>e.chunk_type,m=>{q("changeChunkType",m)}),oe(()=>$.value,m=>{}),B({formState:e,reLoading:$,saveLoading:I,reChange:f}),(m,s)=>{const E=je,C=Fe,b=ce,W=ve,ae=ke,H=he,A=De,Y=be,we=Oe,qe=ye,de=Te,$e=Ee;return _(),d("div",kt,[t("div",bt,[t("div",yt,[t("div",xt,[g("",!0),e.is_qa_doc==1?(_(),d(j,{key:1},[t("div",wt,l(o(n)("file_split")),1),p.mode==1?(_(),d("div",qt,[t("div",$t,[t("div",It,[t("div",Pt,l(o(n)("question_column")),1),t("div",Ct,[i(C,{value:e.question_column,"onUpdate:value":s[2]||(s[2]=a=>e.question_column=a),onChange:U,placeholder:o(n)("ph_select_column"),style:{width:"100%"}},{default:r(()=>[(_(!0),d(j,null,J(p.excellQaLists,a=>(_(),R(E,{value:a.value,key:a.value},{default:r(()=>[c(l(a.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),t("div",zt,[t("div",Ut,l(o(n)("similar_question_column")),1),t("div",St,[i(C,{allowClear:"",value:e.similar_column,"onUpdate:value":s[3]||(s[3]=a=>e.similar_column=a),onChange:U,placeholder:o(n)("ph_select_similar_column"),style:{width:"100%"}},{default:r(()=>[(_(!0),d(j,null,J(p.excellQaLists,a=>(_(),R(E,{value:a.value,key:a.value},{default:r(()=>[c(l(a.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),t("div",Nt,[t("div",Lt,l(o(n)("answer_column")),1),t("div",jt,[i(C,{value:e.answer_column,"onUpdate:value":s[4]||(s[4]=a=>e.answer_column=a),onChange:U,placeholder:o(n)("ph_select_answer_column"),style:{width:"100%"}},{default:r(()=>[(_(!0),d(j,null,J(p.excellQaLists,a=>(_(),R(E,{value:a.value,key:a.value},{default:r(()=>[c(l(a.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])])]),t("div",Ft,l(o(n)("indexing_method")),1),t("div",Dt,[t("div",{class:M(["list-item",{active:e.qa_index_type==1}]),onClick:s[5]||(s[5]=a=>L(1))},[i(b,{class:"check-icon",name:"check-arrow-filled"}),t("div",Ot,[i(b,{name:"file-search"}),c(" "+l(o(n)("qa_index_with_answer")),1)]),t("div",Tt,l(o(n)("qa_index_with_answer_desc")),1)],2),t("div",{class:M(["list-item",{active:e.qa_index_type==2}]),onClick:s[6]||(s[6]=a=>L(2))},[i(b,{class:"check-icon",name:"check-arrow-filled"}),t("div",Et,[i(b,{name:"comment-search"}),c(" "+l(o(n)("qa_index_question_only")),1)]),t("div",Mt,l(o(n)("qa_index_question_only_desc")),1)],2),s[34]||(s[34]=t("div",{class:"btn-box-block"},null,-1)),t("div",Bt,[i(W,{type:"primary",block:"",onClick:N},{default:r(()=>[c(l(o(n)("btn_save")),1)]),_:1})])])])):(_(),d("div",Rt,[t("div",Vt,[t("div",At,[t("div",Qt,l(o(n)("question_start_label")),1),t("div",Gt,[i(ae,{placeholder:o(n)("ph_input_label"),value:e.question_lable,"onUpdate:value":s[7]||(s[7]=a=>e.question_lable=a),onChange:U},null,8,["placeholder","value"])])]),t("div",Ht,[t("div",Kt,l(o(n)("similar_question_start_label")),1),t("div",Jt,[i(ae,{placeholder:o(n)("ph_input_label"),value:e.similar_label,"onUpdate:value":s[8]||(s[8]=a=>e.similar_label=a),onChange:U},null,8,["placeholder","value"])])]),t("div",Xt,[t("div",Zt,l(o(n)("answer_start_label")),1),t("div",Wt,[i(ae,{placeholder:o(n)("ph_input_label"),value:e.answer_lable,"onUpdate:value":s[9]||(s[9]=a=>e.answer_lable=a),onChange:U},null,8,["placeholder","value"])])])]),t("div",Yt,l(o(n)("indexing_method")),1),t("div",es,[t("div",{class:M(["list-item",{active:e.qa_index_type==1}]),onClick:s[10]||(s[10]=a=>L(1))},[i(b,{class:"check-icon",name:"check-arrow-filled"}),t("div",ts,[i(b,{name:"file-search"}),c(" "+l(o(n)("qa_index_with_answer")),1)]),t("div",ss,l(o(n)("qa_index_with_answer_desc")),1)],2),t("div",{class:M(["list-item",{active:e.qa_index_type==2}]),onClick:s[11]||(s[11]=a=>L(2))},[i(b,{class:"check-icon",name:"check-arrow-filled"}),t("div",ns,[i(b,{name:"comment-search"}),c(" "+l(o(n)("qa_index_question_only")),1)]),t("div",os,l(o(n)("qa_index_question_only_desc")),1)],2),s[35]||(s[35]=t("div",{class:"btn-box-block"},null,-1)),t("div",as,[i(W,{type:"primary",block:"",onClick:N},{default:r(()=>[c(l(o(n)("btn_save")),1)]),_:1})])])]))],64)):(_(),d(j,{key:2},[p.mode!=1?(_(),d("div",ls,[t("div",is,[K.status==="paragraphsSegmented"?(_(),d("div",rs,l(o(n)("segmentation_cleaning_rules")),1)):g("",!0),t("div",_s,l(o(n)("segmentation_method")),1),t("div",cs,[t("div",ds,l(o(n)("segmentation_method_tip")),1),t("div",ms,[t("div",{class:M(["select-card-item",{active:e.chunk_type==1}]),onClick:s[12]||(s[12]=a=>e.chunk_type=1)},[i(b,{class:"check-arrow",name:"check-arrow-filled"}),t("div",us,[i(b,{name:"ordinary-segmentation",class:"title-icon"}),c(" "+l(o(n)("ordinary_segmentation")),1)]),t("div",ps,l(o(n)("ordinary_segmentation_desc")),1)],2),t("div",{class:M(["select-card-item",{active:e.chunk_type==2}]),onClick:s[13]||(s[13]=a=>e.chunk_type=2)},[i(b,{class:"check-arrow",name:"check-arrow-filled"}),t("div",hs,[i(b,{name:"semantic-segmentation",class:"title-icon"}),c(" "+l(o(n)("semantic_segmentation")),1)]),t("div",vs,l(o(n)("semantic_segmentation_desc")),1)],2),p.library_type==0?(_(),d("div",{key:0,class:M(["select-card-item",{active:e.chunk_type==4}]),onClick:s[14]||(s[14]=a=>e.chunk_type=4)},[i(b,{class:"check-arrow",name:"check-arrow-filled"}),t("div",fs,[i(b,{name:"semantic-segmentation",class:"title-icon"}),c(" "+l(o(n)("parent_child_segmentation")),1)]),t("div",gs,l(o(n)("parent_child_segmentation_desc")),1)],2)):g("",!0),t("div",{class:M(["select-card-item",{active:e.chunk_type==3}]),onClick:s[15]||(s[15]=a=>e.chunk_type=3)},[i(b,{class:"check-arrow",name:"check-arrow-filled"}),t("div",ks,[i(b,{name:"semantic-segmentation",class:"title-icon"}),c(" "+l(o(n)("ai_segmentation")),1)]),t("div",bs,l(o(n)("ai_segmentation_desc")),1)],2)])])]),e.chunk_type==1?(_(),d(j,{key:0},[t("div",ys,[t("div",xs,l(o(n)("segmentation_separator")),1),t("div",ws,[i(C,{placeholder:o(n)("ph_select"),style:{width:"100%"},mode:"tags",value:e.separators_no,"onUpdate:value":s[16]||(s[16]=a=>e.separators_no=a)},{default:r(()=>[(_(!0),d(j,null,J(v.value,a=>(_(),R(E,{value:a.no,key:a.no},{default:r(()=>[c(l(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value"])])]),i(A,{gap:16},{default:r(()=>[t("div",qs,[t("div",$s,l(o(n)("segmentation_max_length")),1),t("div",Is,[i(A,{align:"center",gap:8},{default:r(()=>[i(H,{style:{flex:"1"},value:e.chunk_size,"onUpdate:value":s[17]||(s[17]=a=>e.chunk_size=a),placeholder:o(n)("ph_segmentation_max_length"),min:200,max:1e4,precision:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),t("span",Ps,l(o(n)("unit_characters")),1)]),_:1})])]),t("div",Cs,[t("div",zs,l(o(n)("segmentation_overlap_length")),1),t("div",Us,[i(A,{align:"center",gap:8},{default:r(()=>[i(H,{style:{flex:"1"},value:e.chunk_overlap,"onUpdate:value":s[18]||(s[18]=a=>e.chunk_overlap=a),placeholder:o(n)("ph_segmentation_overlap_length"),min:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),t("span",Ss,l(o(n)("unit_characters")),1)]),_:1})])])]),_:1}),t("div",Ns,[t("div",Ls,[i(A,{align:"center"},{default:r(()=>[t("div",null,[c(l(o(n)("auto_merge_small_segments"))+" ",1),i(Y,{title:o(n)("auto_merge_small_segments_tooltip")},{default:r(()=>[i(o(ee))]),_:1},8,["title"]),s[36]||(s[36]=c(" ：",-1))]),i(we,{checkedValue:!1,unCheckedValue:!0,checked:e.not_merged_text,"onUpdate:checked":s[19]||(s[19]=a=>e.not_merged_text=a),"checked-children":o(n)("switch_on"),"un-checked-children":o(n)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1})])])],64)):g("",!0),ie(t("div",null,[t("div",js,[t("div",Fs,l(o(n)("embedding_model")),1),t("div",Ds,[i(re,{modelType:"TEXT EMBEDDING",modeName:e.semantic_chunk_use_model,"onUpdate:modeName":s[20]||(s[20]=a=>e.semantic_chunk_use_model=a),modeId:e.semantic_chunk_model_config_id,"onUpdate:modeId":s[21]||(s[21]=a=>e.semantic_chunk_model_config_id=a),style:{width:"100%"},onLoaded:w},null,8,["modeName","modeId"])])]),t("div",Os,[t("div",Ts,[c(l(o(n)("segmentation_threshold"))+" ",1),i(Y,null,{title:r(()=>[c(l(o(n)("segmentation_threshold_tooltip")),1)]),default:r(()=>[i(o(ee),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),s[37]||(s[37]=c("： ",-1))]),t("div",Es,[i(H,{style:{width:"100%"},value:e.semantic_chunk_threshold,"onUpdate:value":s[22]||(s[22]=a=>e.semantic_chunk_threshold=a),placeholder:o(n)("ph_input_segmentation_threshold"),precision:0,min:0,max:100},null,8,["value","placeholder"])])]),i(A,{gap:16},{default:r(()=>[t("div",Ms,[t("div",Bs,l(o(n)("segmentation_max_length")),1),t("div",Rs,[i(A,{align:"center",gap:8},{default:r(()=>[i(H,{style:{flex:"1"},value:e.semantic_chunk_size,"onUpdate:value":s[23]||(s[23]=a=>e.semantic_chunk_size=a),placeholder:o(n)("ph_segmentation_max_length"),min:200,max:1e4,precision:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),t("span",Vs,l(o(n)("unit_characters")),1)]),_:1})])]),t("div",As,[t("div",Qs,l(o(n)("segmentation_overlap_length")),1),t("div",Gs,[i(A,{align:"center",gap:8},{default:r(()=>[i(H,{style:{flex:"1"},value:e.semantic_chunk_overlap,"onUpdate:value":s[24]||(s[24]=a=>e.semantic_chunk_overlap=a),placeholder:o(n)("ph_segmentation_overlap_length"),min:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),t("span",Hs,l(o(n)("unit_characters")),1)]),_:1})])])]),_:1})],512),[[me,e.chunk_type==2]]),ie(t("div",null,[t("div",Ks,[t("div",Js,l(o(n)("ai_llm")),1),t("div",Xs,[i(re,{modelType:"LLM",placeholder:o(n)("ph_select_ai_llm"),modeName:e.ai_chunk_model,"onUpdate:modeName":s[25]||(s[25]=a=>e.ai_chunk_model=a),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":s[26]||(s[26]=a=>e.ai_chunk_model_config_id=a),style:{width:"100%"},onLoaded:w},null,8,["placeholder","modeName","modeId"])])]),t("div",Zs,[t("div",Ws,[t("div",Ys,l(o(n)("prompt_setting")),1)]),t("div",en,[i(qe,{maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":s[27]||(s[27]=a=>e.ai_chunk_prumpt=a),placeholder:o(x)},null,8,["value","placeholder"])])]),t("div",tn,[t("div",sn,[c(l(o(n)("max_characters_per_time"))+" ",1),i(Y,null,{title:r(()=>[c(l(o(n)("max_characters_per_time_tooltip")),1)]),default:r(()=>[i(o(ee),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),s[38]||(s[38]=c("： ",-1))]),t("div",nn,[i(H,{class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":s[28]||(s[28]=a=>e.ai_chunk_size=a),placeholder:o(n)("ph_input_max_characters"),precision:0,min:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),c(" "+l(o(n)("unit_characters")),1)])])],512),[[me,e.chunk_type==3]]),e.chunk_type==4&&p.library_type==0?(_(),d(j,{key:1},[t("div",on,l(o(n)("parent_block_context")),1),t("div",an,[t("div",ln,l(o(n)("segmentation_type")),1),t("div",rn,[i($e,{value:e.father_chunk_paragraph_type,"onUpdate:value":s[29]||(s[29]=a=>e.father_chunk_paragraph_type=a)},{default:r(()=>[i(de,{value:1},{default:r(()=>[c(l(o(n)("segmentation_type_full_text"))+" ",1),i(Y,{title:o(n)("segmentation_type_full_text_tooltip")},{default:r(()=>[i(o(ee))]),_:1},8,["title"])]),_:1}),i(de,{value:2},{default:r(()=>[c(l(o(n)("segmentation_type_paragraph"))+" ",1),i(Y,{title:o(n)("segmentation_type_paragraph_tooltip")},{default:r(()=>[i(o(ee))]),_:1},8,["title"])]),_:1})]),_:1},8,["value"])])]),e.father_chunk_paragraph_type==2?(_(),d("div",_n,[t("div",cn,l(o(n)("segmentation_separator")),1),t("div",dn,[i(C,{placeholder:o(n)("ph_select"),style:{width:"100%"},mode:"tags",value:e.father_chunk_separators_no,"onUpdate:value":s[30]||(s[30]=a=>e.father_chunk_separators_no=a)},{default:r(()=>[(_(!0),d(j,null,J(v.value,a=>(_(),R(E,{value:a.no,key:a.no},{default:r(()=>[c(l(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value"])])])):g("",!0),e.father_chunk_paragraph_type==2?(_(),d("div",mn,[t("div",un,l(o(n)("segmentation_max_length")),1),t("div",pn,[i(A,{align:"center",gap:8},{default:r(()=>[i(H,{style:{flex:"1"},value:e.father_chunk_chunk_size,"onUpdate:value":s[31]||(s[31]=a=>e.father_chunk_chunk_size=a),placeholder:o(n)("ph_segmentation_max_length"),min:200,max:1e4,precision:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),t("span",hn,l(o(n)("unit_characters")),1)]),_:1})])])):g("",!0),t("div",vn,l(o(n)("child_block_retrieval")),1),t("div",fn,[t("div",gn,l(o(n)("segmentation_separator")),1),t("div",kn,[i(C,{placeholder:o(n)("ph_select"),style:{width:"100%"},mode:"tags",value:e.son_chunk_separators_no,"onUpdate:value":s[32]||(s[32]=a=>e.son_chunk_separators_no=a)},{default:r(()=>[(_(!0),d(j,null,J(v.value,a=>(_(),R(E,{value:a.no,key:a.no},{default:r(()=>[c(l(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value"])])]),t("div",bn,[t("div",yn,l(o(n)("segmentation_max_length")),1),t("div",xn,[i(A,{align:"center",gap:8},{default:r(()=>[i(H,{style:{flex:"1"},value:e.son_chunk_chunk_size,"onUpdate:value":s[33]||(s[33]=a=>e.son_chunk_chunk_size=a),placeholder:o(n)("ph_segmentation_max_length"),min:200,max:1e4,precision:0,formatter:a=>parseInt(a),parser:a=>parseInt(a)},null,8,["value","placeholder","formatter","parser"]),t("span",wn,l(o(n)("unit_characters")),1)]),_:1})])])],64)):g("",!0),t("div",qn,[i(W,{onClick:G,style:{flex:"1"}},{default:r(()=>[c(l(o(n)("btn_reset")),1)]),_:1}),i(W,{onClick:f,loading:$.value,style:{flex:"1"},type:"primary",ghost:""},{default:r(()=>[c(l(o(n)("btn_generate_segment_preview")),1)]),_:1},8,["loading"])]),t("div",$n,[p.hideSave?g("",!0):(_(),R(W,{key:0,type:"primary",block:"",disabled:I.value,onClick:N},{default:r(()=>[c(l(o(n)("btn_save")),1)]),_:1},8,["disabled"]))])])):g("",!0)],64))])])]),i(gt,{ref_key:"aiGenerateRef",ref:Q,onHandleEdit:xe},null,512)])}}},to=se(In,[["__scopeId","data-v-33eb2e2f"]]),Pn={class:"fragment-header"},Cn={class:"fragment-info"},zn={class:"fragment-number"},Un={key:0},Sn={key:0,class:"fragment-title"},Nn={class:"fragment-content-lenght"},Ln={key:1,class:"fragment-content-status"},jn={class:"cfb363f"},Fn={class:"fragment-action"},Dn={class:"fragment-content"},On={key:0,class:"fragment-content"},Tn={key:1,class:"fragment-content"},En={key:2,class:"fragment-content"},Mn={class:"fragment-img"},Bn=["src"],Rn={__name:"document-fragment",props:{number:{type:[Number,String]},father_chunk_paragraph_number:{type:[Number,String]},chunk_type:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]},status:{type:String,default:""},currentData:{type:Object,default:()=>{}},isNeedDashedLine:{type:Boolean,default:!1}},emits:["edit","delete"],setup(K,{emit:B}){const{t:F}=te("views.library.document-segmentation.components.document-fragment"),n=B,u=K,q=()=>{n("edit")},p=()=>{n("delete")};return(x,e)=>{var w,S,G;const k=be,V=Re,Q=Se("viewer");return _(),d("div",{class:M(["document-fragment",{"dashed-line":u.isNeedDashedLine,mt8:u.chunk_type==4&&!u.isNeedDashedLine}])},[t("div",Pn,[t("div",Cn,[t("span",zn,[e[0]||(e[0]=c("#",-1)),u.chunk_type==4?(_(),d("span",Un,l(u.father_chunk_paragraph_number)+"-",1)):g("",!0),c(l(u.number),1)]),u.title?(_(),d("span",Sn,l(u.title),1)):g("",!0),t("span",Nn,l(o(F)("total_characters",{total:u.total})),1),u.status==="paragraphsSegmented"?(_(),d("span",Ln,[c(l(((w=u.currentData)==null?void 0:w.status_text)||"-"),1),((S=u.currentData)==null?void 0:S.status)==3?(_(),R(o(Me),{key:0})):g("",!0),((G=u.currentData)==null?void 0:G.status)==2&&u.currentData.errmsg?(_(),R(k,{key:1,title:u.currentData.errmsg},{default:r(()=>[t("strong",jn,[e[1]||(e[1]=c("原因",-1)),i(o(Be),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):g("",!0)])):g("",!0)]),t("div",Fn,[t("a",{onClick:q},l(o(F)("edit")),1),i(V,{type:"vertical"}),t("a",{onClick:p},l(o(F)("delete")),1)])]),t("div",Dn,l(u.content),1),u.question?(_(),d("div",On,"Q："+l(u.question),1)):g("",!0),u.similar_question_list&&u.similar_question_list.join("")?(_(),d("div",Tn,l(o(F)("similar_questions"))+l(u.similar_question_list.join("/")),1)):g("",!0),u.answer?(_(),d("div",En,"A："+l(u.answer),1)):g("",!0),ie((_(),d("div",Mn,[(_(!0),d(j,null,J(u.images,(N,D)=>(_(),d("img",{key:D,src:N,alt:""},null,8,Bn))),128))])),[[Q]])],2)}}},so=se(Rn,[["__scopeId","data-v-5df9be7b"]]),Vn={class:"upload-box-wrapper"},An={key:0},Qn={__name:"edit-fragment-alert",emits:["ok"],setup(K,{expose:B,emit:F}){const{t:n}=te("views.library.document-segmentation.components.edit-fragment-alert"),u=F,q=y("1"),p=_e.useForm,x=y(!1),e=X({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),k=X({content:[{message:n("validation_content"),validator:async(D,h)=>S.value||h?Promise.resolve():Promise.reject(n("validation_content"))}],question:[{message:n("validation_question"),validator:async(D,h)=>S.value?h?Promise.resolve():Promise.reject(n("validation_question")):Promise.resolve()}],answer:[{message:n("validation_answer"),validator:async(D,h)=>S.value?h?Promise.resolve():Promise.reject(n("validation_answer")):Promise.resolve()}]}),{resetFields:V,validate:Q,validateInfos:w}=p(e,k),S=y(!1),G=({title:D,content:h,question:O,answer:T,images:$,similar_question_list:I})=>{e.title=D,e.content=h,e.question=O,e.answer=T,e.images=$||[],e.similar_question_list=I?I.join(`
`):"",S.value=O!="",x.value=!0},N=()=>{Q().then(()=>{x.value=!1,u("ok",pe(e))})};return B({open:G}),(D,h)=>{const O=ke,T=Ve,$=ye,I=ce,f=Qe,P=Ae,z=_e,U=fe;return _(),d("div",null,[i(U,{open:x.value,"onUpdate:open":h[7]||(h[7]=v=>x.value=v),title:o(n)("title"),onOk:N,width:"746px"},{default:r(()=>[i(z,{layout:"vertical"},{default:r(()=>[i(T,{label:o(n)("label_title")},{default:r(()=>[i(O,{type:"text",placeholder:o(n)("ph_title"),value:e.title,"onUpdate:value":h[0]||(h[0]=v=>e.title=v)},null,8,["placeholder","value"])]),_:1},8,["label"]),S.value?(_(),d(j,{key:0},[i(T,le({label:o(n)("label_question")},o(w).question),{default:r(()=>[i($,{placeholder:o(n)("ph_question"),value:e.question,"onUpdate:value":h[1]||(h[1]=v=>e.question=v),style:{height:"100px"}},null,8,["placeholder","value"])]),_:1},16,["label"]),i(T,{label:o(n)("label_similar")},{default:r(()=>[i($,{placeholder:o(n)("ph_similar"),value:e.similar_question_list,"onUpdate:value":h[2]||(h[2]=v=>e.similar_question_list=v),style:{height:"100px"}},null,8,["placeholder","value"])]),_:1},8,["label"]),i(T,le({label:o(n)("label_answer")},o(w).answer),{default:r(()=>[i($,{placeholder:o(n)("ph_answer"),value:e.answer,"onUpdate:value":h[3]||(h[3]=v=>e.answer=v),style:{height:"140px"}},null,8,["placeholder","value"])]),_:1},16,["label"])],64)):(_(),R(T,le({key:1,label:o(n)("label_content")},o(w).content),{default:r(()=>[i($,{placeholder:o(n)("ph_content"),value:e.content,"onUpdate:value":h[4]||(h[4]=v=>e.content=v),style:{height:"150px"}},null,8,["placeholder","value"])]),_:1},16,["label"])),i(T,{label:o(n)("label_attachment")},{default:r(()=>[t("div",Vn,[i(P,{activeKey:q.value,"onUpdate:activeKey":h[5]||(h[5]=v=>q.value=v),size:"small"},{default:r(()=>[i(f,{key:"1"},{tab:r(()=>[t("span",null,[i(I,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),c(" "+l(o(n)("tab_images"))+" ",1),e.images.length?(_(),d("span",An,"("+l(e.images.length)+")",1)):g("",!0)])]),_:1})]),_:1},8,["activeKey"]),i(Ge,{value:e.images,"onUpdate:value":h[6]||(h[6]=v=>e.images=v)},null,8,["value"])])]),_:1},8,["label"])]),_:1})]),_:1},8,["open","title"])])}}},no=se(Qn,[["__scopeId","data-v-5802e40c"]]);export{so as D,no as E,to as S,eo as a};
//# sourceMappingURL=edit-fragment-alert-D8mTY6SS.js.map
