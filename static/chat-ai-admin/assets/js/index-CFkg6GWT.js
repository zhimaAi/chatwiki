import{_ as K,a as W,d as j,cv as at,cw as nt,cx as lt,ad as it,ac as ct}from"../../index-DxV-PNCd.js";import{f as r,av as J,e as Q,q as rt,ac as d,ad as i,k as _,ar as z,as as t,ae as S,at as v,G as E,n as ut,l as B,r as q,o as dt,aw as _t,u as g,ai as F,az as U,F as H,ax as G,y as vt,B as pt}from"./vue-chunks-CGLjTDrY.js";import{_ as mt}from"./main-tab-Oe1gk5RM.js";import{E as ft}from"./empty-box-C6xHnjvN.js";import{L as X}from"./loading-box-BFrpPJwN.js";/* empty css                                                                     */import{g as ht,u as Y,a as kt,b as gt}from"./template-B9c4Nrc_.js";import{B as yt,M as N,W as R,b as Z,a0 as bt,I as xt,v as wt,bL as Tt}from"./ui-antd-AfNpv4wx.js";import{u as Ct}from"./usePublicNetworkCheck-Gk3eB7lo.js";import{P as $t}from"./public-network-check-CwdAqxDb.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./list-tabs-DJ9IUgC9.js";import"./index-IIUHUqQG.js";import"./empty-BFmzY9bl.js";const Mt={class:"_container _plugin-detail-cont"},Dt={key:1,class:"content"},Nt={class:"base-info"},Lt={class:"top"},St=["src"],zt={class:"info"},Et={class:"left"},Bt={class:"name zm-line1"},Rt={class:"source"},Vt=["src"],At={class:"right"},Ot={class:"desc"},Pt={class:"detail-info"},It={class:"left"},qt={class:"main-block"},Ft=["innerHTML"],Ut={__name:"detail-model",setup(tt,{expose:V}){const f=r(!1),A=n=>{h.value=n.robot_id,p(),f.value=!0},L=J(),y=W(),{companyInfo:b}=y,x=Q(()=>b==null?void 0:b.version),w=r(!0),h=r(null),a=r({});function p(){w.value=!0,ht({robot_id:h.value}).then(n=>{a.value=(n==null?void 0:n.data)||{}}).finally(()=>{w.value=!1})}function O(){const n=a.value;function u(m,c){return m=Number(m.replace(/\D/g,"")),c=Number(c.replace(/\D/g,"")),m>=c}const T=()=>{Y({template_id:n.id,csl_url:n.csl_url}).then(m=>{Z.success("使用成功");const{id:c,robot_key:D}=m.data,C=L.resolve({path:"/robot/config/workflow",query:{id:c,robot_key:D}});window.open(C.href,"_blank"),f.value=!1})};u(x.value,n.version)?N.confirm({title:"提示",content:`确定使用模板【${n.name}】创建应用吗?`,icon:B(R),okText:"确 认",cancelText:"取 消",onOk:T}):N.confirm({title:"提示",content:"当前系统版本过低，可能无法使用此模板；请您升级到最新版本后使用！",icon:B(R),okText:"继续使用",cancelText:"取 消",onOk:T})}return V({show:A}),(n,u)=>{const T=j,m=yt,c=N,D=rt("viewer");return i(),d("div",null,[_(c,{open:f.value,"onUpdate:open":u[0]||(u[0]=C=>f.value=C),title:"模板详情",wrapClassName:"no-padding-modal",footer:null,width:800},{default:z(()=>[t("div",Mt,[w.value?(i(),S(X,{key:0})):(i(),d("div",Dt,[t("div",Nt,[t("div",Lt,[t("img",{class:"avatar",src:a.value.avatar},null,8,St),t("div",zt,[t("div",Et,[t("div",Bt,v(a.value.name),1),t("div",Rt,[t("img",{class:"avatar",src:a.value.account_avatar},null,8,Vt),E(" "+v(a.value.author),1)])]),t("div",At,[_(m,{class:"use-btn",type:"primary",ghost:"",onClick:O},{default:z(()=>[_(T,{name:"icon-rocket"}),u[1]||(u[1]=E(" 使用模板 ",-1))]),_:1})])])]),t("div",Ot,v(a.value.description),1)]),t("div",Pt,[t("div",It,[t("div",qt,[u[2]||(u[2]=t("div",{class:"main-tit"},"使用说明",-1)),ut(t("pre",{class:"text-cont",innerHTML:a.value.instructions},null,8,Ft),[[D]])])])])]))])]),_:1},8,["open"])])}}},Ht=K(Ut,[["__scopeId","data-v-69534367"]]),Gt={class:"_container"},Kt={class:"header"},Wt={class:"main-tab-box"},jt={key:1,class:"content"},Jt={class:"left-box hide-scrollbar"},Qt={class:"title"},Xt={class:"cate-box"},Yt={key:0,class:"count"},Zt=["onClick"],te={class:"count"},ee={class:"_plugin-box",style:{"margin-top":"12px"}},oe={key:0,class:"plugin-list"},se=["onClick"],ae={class:"main-pic-box"},ne=["src"],le={class:"base-info-box"},ie={class:"title zm-line1"},ce={class:"avater-box"},re=["src"],ue={class:"author-text"},de={class:"action-box"},_e={class:"left"},ve={class:"right"},pe=["onClick"],me={__name:"index",setup(tt){const{isPublicNetwork:V}=Ct(T),f=_t(),A=J(),L=r(null);r(localStorage.getItem("zm:explore:active")||"4");const y=r(!0),b=r(!1),x=r([]),w=r([]),h=r(0),a=q({keyword:"",category:null}),p=q({current:1,pageSize:50,total:0}),O=W(),{companyInfo:n}=O,u=Q(()=>n==null?void 0:n.version);dt(()=>{f.query.active>1&&L.value.change(f.query.active)});function T(){vt(()=>{m(),c()})}function m(){kt().then(o=>{let s=(o==null?void 0:o.data)||[];h.value=0,s.map(l=>h.value+=Number((l==null?void 0:l.template_count)||0)),w.value=s})}async function c(){var s;y.value=!0;let o={page:p.current,size:p.pageSize};a.keyword&&(o.keyword=a.keyword),a.category&&(o.category_id=(s=a.category)==null?void 0:s.id),gt(o).then(l=>{var $,e;let k=(($=l==null?void 0:l.data)==null?void 0:$.data)||[];(!k.length||k.length<p.pageSize)&&(b.value=!0),x.value.push(...k),p.current+=1,p.total=Number(((e=l==null?void 0:l.data)==null?void 0:e.total)||0)}).finally(()=>{y.value=!1})}function D(o){y.value||b.value||at(o,c)}function C(){p.current=1,p.total=0,x.value=[],c()}function P(o){a.category=o,C()}function et(o,s){return o=Number(o.replace(/\D/g,"")),s=Number(s.replace(/\D/g,"")),o>=s}function ot(o){const s=()=>{Y({template_id:o.id,csl_url:o.csl_url}).then(l=>{Z.success("使用成功"),c();const{id:k,robot_key:$}=l.data,e=A.resolve({path:"/robot/config/workflow",query:{id:k,robot_key:$}});window.open(e.href,"_blank")})};et(u.value,o.version)?N.confirm({title:"提示",content:`确定使用模板【${o.name}】创建应用吗?`,icon:B(R),okText:"确 认",cancelText:"取 消",onOk:s}):N.confirm({title:"提示",content:"当前系统版本过低，可能无法使用此模板；请您升级到最新版本后使用！",icon:B(R),okText:"继续使用",cancelText:"取 消",onOk:s})}const I=r(null),st=o=>{I.value.show(o)};return(o,s)=>{const l=xt,k=wt,$=j;return i(),d("div",Gt,[t("div",Kt,[t("div",Wt,[_(mt,{ref_key:"tabRef",ref:L},null,512)])]),g(V)?(i(),d("div",jt,[t("div",Jt,[t("div",Qt,[_(l,{value:a.keyword,"onUpdate:value":s[0]||(s[0]=e=>a.keyword=e),valueModifiers:{trim:!0},onChange:C,style:{width:"100%"},allowClear:"",placeholder:"搜索模板"},{suffix:z(()=>[_(g(bt))]),_:1},8,["value"])]),t("div",Xt,[t("div",{class:F(["cate-item",{active:!a.category}]),onClick:s[1]||(s[1]=e=>P(null))},[s[2]||(s[2]=t("div",null,"全部",-1)),h.value>0?(i(),d("span",Yt,v(h.value),1)):U("",!0)],2),(i(!0),d(H,null,G(w.value,e=>{var M;return i(),d("div",{key:e.id,class:F(["cate-item",{active:e.id==((M=a.category)==null?void 0:M.id)}]),onClick:fe=>P(e)},[t("div",null,v(e.name),1),t("span",te,v(e.template_count||0),1)],10,Zt)}),128))])]),t("div",{class:"right-box",onScroll:D},[t("div",ee,[x.value.length?(i(),d("div",oe,[(i(!0),d(H,null,G(x.value,e=>(i(),d("div",{key:e.id,class:"plugin-item",onClick:M=>st(e)},[t("div",ae,[t("img",{src:e.main_pic||g(nt),alt:""},null,8,ne)]),t("div",le,[t("div",ie,v(e.name),1),t("div",ce,[t("img",{src:e.avatar||g(lt),alt:""},null,8,re),t("div",ue,v(e.author),1)]),_(k,{title:g(ct)(e.description,e,14,2.5,60),placement:"top"},{default:z(()=>[t("div",{class:"desc zm-line",ref_for:!0,ref:M=>g(it)(M,e)},v(e.description),513)]),_:2},1032,["title"]),t("div",de,[t("div",_e,[_(g(Tt)),E(" "+v(e.use_count||0),1)]),t("div",ve,[t("a",{onClick:pt(M=>ot(e),["stop","prevent"])},[_($,{name:"icon-rocket"}),s[3]||(s[3]=E(" 使用模板",-1))],8,pe)])])])],8,se))),128))])):(i(),S(ft,{key:1,title:"暂无可用插件"})),y.value?(i(),S(X,{key:2})):U("",!0)])],32)])):(i(),S($t,{key:0})),_(Ht,{ref_key:"detailModelRef",ref:I},null,512)])}}},Ee=K(me,[["__scopeId","data-v-0bcd60fd"]]);export{Ee as default};
