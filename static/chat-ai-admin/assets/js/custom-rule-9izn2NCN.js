import{f as C,r as q,o as G,ac as l,as as m,k as d,ar as p,av as H,ad as s,G as K,ae as h,az as x,F as z,at as r}from"./vue-chunks-CGLjTDrY.js";import{am as P,aw as I,ax as Q}from"./index-BNO9ztvM.js";import{_ as U}from"../../index-DxV-PNCd.js";import{B as W,aa as Y,G as A,Q as J,ae as X,bH as Z,M as N,b as v,W as $}from"./ui-antd-AfNpv4wx.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";const ee={class:"custom-rule-page"},te={class:"toolbar"},ae={class:"table-box"},ne={key:0},se={key:0},oe={style:{"max-width":"360px","white-space":"normal"}},ce={style:{"margin-left":"4px"}},ie={key:5},le=["onClick"],_e={key:0,class:"actions-disabled"},me=["onClick"],ue=["onClick"],pe={__name:"custom-rule",setup(he){const y=H(),w=C(""),b=C([]),f=C(!1),c=q({page:1,size:10,total:0}),R=[{title:"规则名",dataIndex:"rule_name",key:"rule_name"},{title:"自动删评",dataIndex:"delete_comment_switch",key:"delete_comment_switch"},{title:"自动回复评论",dataIndex:"reply_comment_switch",key:"reply_comment_switch"},{title:"评论精选",dataIndex:"elect_comment_switch",key:"elect_comment_switch"},{title:"生效群发文章",dataIndex:"task_info",key:"task_info"},{title:"规则启用",dataIndex:"switch",key:"switch"},{title:"创建时间",dataIndex:"create_time",key:"create_time"},{title:"操作",dataIndex:"actions",key:"actions"}],k=()=>{f.value=!0,P({page:c.page,size:c.size,rule_name:w.value,is_default:0}).then(e=>{const t=(e==null?void 0:e.data)||{list:[],total:0};b.value=t.list||[],c.total=+t.total||0}).finally(()=>{f.value=!1})},S=()=>{c.page=1,k()},B=e=>{c.page=e.current,c.size=e.pageSize,k()},M={delete_comment_switch:"自动删评",reply_comment_switch:"自动回复评论",elect_comment_switch:"评论精选",switch:"规则启用"},g=async(e,t,_)=>{if(!_){N.confirm({title:"提示",content:`确认关闭${e.rule_name}中的${M[t]}？`,icon:d($),onOk:async()=>{const i=_?1:0;await I({id:e.id,change_fields:t,switch_status:i}),e[t]=String(i),v.success("操作成功")}});return}const u=_?1:0;await I({id:e.id,change_fields:t,switch_status:u}),e[t]=String(u),v.success("操作成功")},D=e=>{y.push({path:"/explore/index/ai-comment-management/create-custom-rule",query:{id:e.id}})},O=e=>{y.push({path:"/explore/index/ai-comment-management/create-custom-rule",query:{id:e.id,copy:1}})},V=e=>{N.confirm({title:"确认删除该规则，删除后，使用该规则的群发，会使用默认规则？",icon:d($),onOk:async()=>{await Q({id:e.id}),v.success("删除成功"),k()}})},E=()=>{y.push({path:"/explore/index/ai-comment-management/create-custom-rule"})},F=e=>{try{const t=new Date(Number(e)*1e3),_=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${_}-${u}-${i}`}catch{return""}};return G(()=>{k()}),(e,t)=>{const _=W,u=Y,i=J,L=X,T=Z,j=A;return s(),l("div",ee,[m("div",te,[d(_,{type:"primary",onClick:E},{default:p(()=>[...t[1]||(t[1]=[K("添加规则",-1)])]),_:1}),d(u,{value:w.value,"onUpdate:value":t[0]||(t[0]=o=>w.value=o),allowClear:"",placeholder:"请输入规则名称搜索",style:{width:"300px"},onSearch:S,onPressEnter:S},null,8,["value"])]),m("div",ae,[d(j,{columns:R,"data-source":b.value,loading:f.value,"row-key":"id",pagination:{current:c.page,pageSize:c.size,total:c.total,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:B},{headerCell:p(({column:o})=>[typeof o.title=="string"?(s(),l("span",ne,r(o.title),1)):x("",!0)]),bodyCell:p(({column:o,record:a})=>[o.key==="delete_comment_switch"?(s(),h(i,{key:0,checked:Number(a.delete_comment_switch)===1,onChange:n=>g(a,"delete_comment_switch",n)},null,8,["checked","onChange"])):o.key==="reply_comment_switch"?(s(),h(i,{key:1,checked:Number(a.reply_comment_switch)===1,onChange:n=>g(a,"reply_comment_switch",n)},null,8,["checked","onChange"])):o.key==="elect_comment_switch"?(s(),h(i,{key:2,checked:Number(a.elect_comment_switch)===1,onChange:n=>g(a,"elect_comment_switch",n)},null,8,["checked","onChange"])):o.key==="switch"?(s(),h(i,{key:3,checked:Number(a.switch)===1,onChange:n=>g(a,"switch",n)},null,8,["checked","onChange"])):o.key==="task_info"?(s(),l(z,{key:4},[(a.task_info||[]).length===0?(s(),l("span",se,"-")):(s(),l(z,{key:1},[m("span",null,r((a.task_info||[]).slice(0,2).map(n=>n.task_name).join("，")),1),(a.task_info||[]).length>2?(s(),h(L,{key:0,trigger:"hover",placement:"top"},{content:p(()=>[m("div",oe,r((a.task_info||[]).map(n=>n.task_name).join("，")),1)]),default:p(()=>[m("a",ce,"+"+r((a.task_info||[]).length-2),1)]),_:2},1024)):x("",!0)],64))],64)):o.key==="create_time"?(s(),l("span",ie,r(F(a.create_time)),1)):o.key==="actions"?(s(),h(T,{key:6},{default:p(()=>[m("a",{onClick:n=>D(a)},"编辑",8,le),a.is_default=="1"?(s(),l("span",_e,"删除")):(s(),l("a",{key:1,onClick:n=>V(a)},"删除",8,me)),m("a",{onClick:n=>O(a)},"复制",8,ue)]),_:2},1024)):x("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},Ce=U(pe,[["__scopeId","data-v-406c2ec9"]]);export{Ce as default};
