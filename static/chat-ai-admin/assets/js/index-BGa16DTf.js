import{c as G,ah as J,r as A,j as K,a as l,b as d,p as i,y as u,v as r,u as _,t as h,_ as y,F as M,l as C,q as D,Y as Q,ag as W}from"./vue-chunks-BdaA73Wf.js";import{b as Z,d as tt,s as L}from"./index-C67uUbSa.js";import{u as et}from"./robot-CIzNpArp.js";import{d as st}from"./utils-CvB22N-W.js";import{u as nt,o as ot}from"../../index-DSFcP5NQ.js";import{L as at}from"./list-empty-BC6w9WU7.js";import{_ as T}from"./emoji-mart-BBMRoEa3.js";import{H as it,m as rt,a1 as _t,B as lt,X as dt,am as ut,f as ct,g as pt,i as mt,M as E,b as v}from"./ui-antd-Dl1wwwCD.js";import"./editor-cherry-CFIsbKoN.js";import"./index-Cg7-0swo.js";import"./elkjs-BN8GIjVH.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./other-LrIFyvU9.js";const ht={class:"user-model-page"},ft={class:"switch-block"},yt={class:"switch-title"},bt={class:"switch-desc"},kt={class:"search-block"},vt={class:"left-block"},gt={class:"list-box"},xt={key:0,class:"list-empty"},wt={key:1,class:"list-grid"},St={class:"card-header"},At={class:"card-content"},Mt={class:"card-title"},Ct={class:"card-text"},Dt={key:0,class:"line-text"},Lt={key:1,class:"empty-line"},Et=["innerHTML"],Tt={key:3,href:"javascript:;",class:"link"},Rt={key:0},Yt={class:"card-footer"},Nt={class:"footer-left"},Ft={class:"menu-name"},qt={class:"update-time"},Bt={__name:"smart-menu",setup(R){const{t:o}=nt("views.robot.robot-config.smart-menu.smart-menu"),f=et(),Y=G(()=>f.smartMenuSwitchStatus==="1"),p=J().query,g=W(),x=A(!1),b=A([]),N=ot,w=()=>{const n={robot_id:p.id};x.value=!0,Z({...n}).then(e=>{const t=(e==null?void 0:e.data)||{list:[]};b.value=(t.list||[]).map(s=>({id:Number(s.id||0),menu_title:s.menu_title||"",update_time:Number(s.update_time||s.create_time||0),avatar_url:s.avatar_url||"",switch_status:String(s.switch_status??"0"),priority_num:Number(s.priority_num||0),reply_num:Number(s.reply_num||0),reply_content:Array.isArray(s.reply_content)?s.reply_content:[],menu_content:Array.isArray(s.menu_content)?s.menu_content:[],menu_description:s.menu_description||""}))}).catch(()=>{}).finally(()=>{x.value=!1})};function F(n){const e=[];return(Array.isArray(n)?n:[]).forEach(t=>{const s=(t==null?void 0:t.type)||(t==null?void 0:t.reply_type);if(s==="text")t!=null&&t.description&&e.push({text:t.description});else if(s==="imageText"){const a=(t==null?void 0:t.title)||(t==null?void 0:t.description)||s("text_image_text_link");e.push({text:a,url:t==null?void 0:t.url})}else if(s==="url"){const a=(t==null?void 0:t.title)||s("text_link");e.push({text:a,url:t==null?void 0:t.url})}else if(s==="image")e.push({text:s("text_image")});else if(s==="card"){const a=(t==null?void 0:t.title)||s("text_mini_program_card");e.push({text:a})}}),e.slice(0,8)}function q(n){const e=[];return(Array.isArray(n)?n:[]).forEach(t=>{const s=String((t==null?void 0:t.menu_type)||""),a=String((t==null?void 0:t.content)||"");if(s==="0")if(a==="")e.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(a)){const k=/href\s*=\s*['"]\s*#\s*['"]/i.test(a)?a.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):a.replace(/href=/ig,'target="_blank" href=');e.push({kind:"html",html:k})}else e.push({kind:"text",text:a});else s==="1"&&e.push({kind:"keyword",text:a,serial_no:(t==null?void 0:t.serial_no)||""})}),e.slice(0,20)}function B(n){return Array.isArray(n==null?void 0:n.menu_content)&&n.menu_content.length?q(n.menu_content):F((n==null?void 0:n.reply_content)||[])}function O(n){var s,a;const e=(a=(s=n.target)==null?void 0:s.closest)==null?void 0:a.call(s,"a");if(!e)return;const t=String(e.getAttribute("href")||"");(t==="#"||t==="javascript:;")&&(n.preventDefault(),n.stopPropagation())}const j=()=>{g.push({path:"/robot/ability/smart-menu/add-rule",query:{id:p.id,robot_key:p.robot_key}})},I=n=>{g.push({path:"/robot/ability/smart-menu/add-rule",query:{id:p.id,robot_key:p.robot_key,rule_id:n.id}})},V=n=>{E.confirm({title:o("msg_confirm_delete"),okText:o("btn_confirm"),onOk:()=>{tt({id:n.id,robot_id:p.id}).then(e=>{e&&e.res==0&&(v.success(o("msg_delete_success")),w())})}})},$=n=>{const e=n?"1":"0";if(!n){E.confirm({title:o("msg_confirm_close"),okText:o("btn_confirm"),cancelText:o("btn_cancel"),onOk(){L({robot_id:p.id,ability_type:"robot_smart_menu",switch_status:e}).then(t=>{t&&t.res==0&&(f.setSmartMenuSwitchStatus(e),v.success(o("msg_operation_success")),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:p.id}})))})}});return}L({robot_id:p.id,ability_type:"robot_smart_menu",switch_status:e}).then(t=>{t&&t.res==0&&(f.setSmartMenuSwitchStatus(e),v.success(o("msg_operation_success")),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:p.id}})))})};function z(n,e="YYYY-MM-DD"){return n?st(n*1e3).format(e):""}return K(async()=>{w()}),(n,e)=>{const t=it,s=rt,a=lt,k=dt,S=pt,H=ct,P=mt;return d(),l("div",ht,[i("div",ft,[i("span",yt,r(_(o)("title_smart_menu")),1),u(t,{onChange:$,checked:Y.value,"checked-children":_(o)("switch_on"),"un-checked-children":_(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"]),i("span",bt,r(_(o)("switch_desc")),1)]),u(s,null,{message:h(()=>[i("p",null,r(_(o)("alert_description")),1),i("p",null,r(_(o)("alert_usage")),1)]),_:1}),i("div",kt,[i("div",vt,[u(a,{type:"primary",onClick:j},{icon:h(()=>[u(_(_t))]),default:h(()=>[y(" "+r(_(o)("btn_add_smart_menu")),1)]),_:1})])]),i("div",gt,[b.value.length===0?(d(),l("div",xt,[u(at,{size:"200",text:_(o)("text_no_data")},null,8,["text"])])):(d(),l("div",wt,[(d(!0),l(M,null,C(b.value,m=>(d(),l("div",{class:"list-card",key:m.id},[i("div",St,[u(k,{src:m.avatar_url||_(N),size:40,shape:"square",class:"sm-avatar"},null,8,["src"]),i("div",At,[i("div",Mt,r(m.menu_description),1),i("div",Ct,[(d(!0),l(M,null,C(B(m),(c,U)=>(d(),l("div",{key:U,class:"reply-line",onClick:e[0]||(e[0]=X=>O(X))},[c.kind==="text"?(d(),l("span",Dt,r(c.text),1)):c.kind==="newline"?(d(),l("div",Lt)):c.kind==="html"?(d(),l("span",{key:2,innerHTML:c.html},null,8,Et)):c.kind==="keyword"?(d(),l("a",Tt,[c.serial_no?(d(),l("div",Rt,r(c.serial_no),1)):D("",!0),y(" "+r(c.text),1)])):D("",!0)]))),128))])])]),i("div",Yt,[i("div",Nt,[i("div",Ft,r(m.menu_title),1),i("div",qt,r(_(o)("text_updated_on"))+r(z(m.update_time,"YYYY-MM-DD")),1)]),u(P,{placement:"bottomRight"},{overlay:h(()=>[u(H,null,{default:h(()=>[u(S,{key:"edit",onClick:c=>I(m)},{default:h(()=>[y(r(_(o)("btn_edit")),1)]),_:1},8,["onClick"]),u(S,{key:"del",onClick:c=>V(m),style:{color:"#FF4D4F"}},{default:h(()=>[y(r(_(o)("btn_delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:h(()=>[i("a",{class:"more-btn",onClick:e[1]||(e[1]=Q(()=>{},["prevent"]))},[u(_(ut))])]),_:2},1024)])]))),128))]))])])}}},Ot=T(Bt,[["__scopeId","data-v-2a799433"]]),jt={class:"auto-reply-home"},It={__name:"index",setup(R){return(o,f)=>(d(),l("div",jt,[u(Ot)]))}},ee=T(It,[["__scopeId","data-v-f69f60dd"]]);export{ee as default};
//# sourceMappingURL=index-BGa16DTf.js.map
