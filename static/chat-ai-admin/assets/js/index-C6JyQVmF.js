import{r as p,E as R,a as U,b as j,y as n,t as g,p as t,m as M,u as r,a1 as B,aj as q,v as x}from"./vue-chunks-BdaA73Wf.js";import{u as S,s as C,d as J}from"../../index-DSFcP5NQ.js";import{v as N}from"./validate-8MtiUsxW.js";import{_ as L}from"./emoji-mart-BBMRoEa3.js";import{F,c as V,d as D,M as E,b as A,p as G}from"./ui-antd-Dl1wwwCD.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";const H="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2040%2040'%20class='design-iconfont'%3e%3crect%20width='40'%20height='40'%20rx='20'%20fill='%232475FC'/%3e%3cpath%20d='M10.0835%2030.5H31.0835'%20stroke='%23fff'%20stroke-width='2.275'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M12.4165%2021.5867V25.8333H16.6848L28.7498%2013.763L24.4886%209.5L12.4165%2021.5867Z'%20stroke='%23fff'%20stroke-width='2.275'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",T={class:"form-box"},z={__name:"modify-account",emits:["ok"],setup(O,{expose:d,emit:_}){const v=_,h=F.useForm,{t:o}=S("views.user.account.components.modify-account"),l=p(!1),k=p(o("title_modify_password")),a=R({password:"",check_password:"",old_password:"",id:""}),m=R({old_password:[{message:o("msg_input_old_password"),required:!0}],password:[{message:o("msg_input_password"),required:!0},{validator:async(i,e)=>!N(e)&&e?Promise.reject(o("ph_password_rule")):e==a.old_password?Promise.reject(o("msg_password_same")):Promise.resolve()}],check_password:[{message:o("msg_input_confirm_password"),required:!0},{validator:async(i,e)=>e!=a.password&&e?Promise.reject(o("msg_password_mismatch")):Promise.resolve()}]}),{resetFields:w,validate:b,validateInfos:c}=h(a,m),s=i=>{l.value=!0,w(),a.password="",a.check_password="",a.old_password="",a.id=i.user_id},u=()=>{b().then(()=>{C({...B(a)}).then(i=>{A.success(o("msg_modify_success")),l.value=!1,v("ok")})})};return d({open:s}),(i,e)=>{const y=D,P=V,I=F,$=E;return j(),U("div",null,[n($,{open:l.value,"onUpdate:open":e[3]||(e[3]=f=>l.value=f),title:k.value,onOk:u,width:"476px"},{default:g(()=>[t("div",T,[n(I,{layout:"vertical"},{default:g(()=>[n(P,M({label:r(o)("label_old_password")},r(c).old_password),{default:g(()=>[n(y,{value:a.old_password,"onUpdate:value":e[0]||(e[0]=f=>a.old_password=f),placeholder:r(o)("ph_input_old_password")},null,8,["value","placeholder"])]),_:1},16,["label"]),n(P,M({label:r(o)("label_password")},r(c).password),{default:g(()=>[n(y,{value:a.password,"onUpdate:value":e[1]||(e[1]=f=>a.password=f),placeholder:r(o)("ph_password_rule")},null,8,["value","placeholder"])]),_:1},16,["label"]),n(P,M({label:r(o)("label_confirm_password")},r(c).check_password),{default:g(()=>[n(y,{value:a.check_password,"onUpdate:value":e[2]||(e[2]=f=>a.check_password=f),placeholder:r(o)("ph_reinput_password")},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1})])]),_:1},8,["open","title"])])}}},Z=L(z,[["__scopeId","data-v-dadbbc8d"]]),K={class:"upload-box"},Q={__name:"modify-avatar",emits:["ok"],setup(O,{expose:d,emit:_}){const v=_;function h(s){return new Promise((u,i)=>{const e=new FileReader;e.readAsDataURL(s),e.onload=()=>u(e.result),e.onerror=y=>i(y)})}const o=p([]),l=p(""),k=s=>s.type==="image/jpeg"||s.type==="image/png"?s.size/1024<1024?(o.value=[s],h(s).then(e=>{l.value=e,a()}),!1):(A.error("成员头像图片大小不能超过1M"),!1):(A.error("机器人头像只支持JPG、PNG格式的图片"),!1),a=()=>{let s={imageUrl:l.value,file:o.value[0].originFileObj};c(s)};p("修改登录密码");const m=R({id:""}),w=p(null),b=s=>{m.id=s.user_id,w.value.click()},c=s=>{C({...B(m),avatar:s.file}).then(u=>{A.success("修改成功"),v("ok",s.imageUrl)})};return d({setAvatar:b}),(s,u)=>{const i=G;return j(),U("div",K,[n(i,{"file-list":o.value,"onUpdate:fileList":u[0]||(u[0]=e=>o.value=e),"list-type":"picture-card","show-upload-list":!1,"before-upload":k,accept:".jpg,.png,.jpeg"},{default:g(()=>[t("div",{ref_key:"uploadBtnRef",ref:w},"修改头像",512)]),_:1},8,["file-list"])])}}},W=L(Q,[["__scopeId","data-v-f5e61674"]]),X={class:"user-account"},Y={class:"page-title"},ss={class:"user-avatar-box"},es=["src"],os={class:"user-info-items"},ts={class:"user-info-item"},as={class:"item-left"},rs={class:"item-label"},ns={class:"item-value"},ls={class:"user-info-item"},is={class:"item-left"},ds={class:"item-label"},cs={__name:"index",setup(O){const{t:d}=S(),_=J(),{userInfo:v,avatar:h,user_name:o}=q(_),l=p(null),k=()=>{l.value.open(v.value)},a=()=>{_.reset(!0)},m=p(null),w=()=>{m.value.setAvatar(v.value)},b=c=>{_.setAvatar(c)};return(c,s)=>(j(),U("div",X,[t("div",Y,x(r(d)("views.user.account.accountSettings")),1),t("div",ss,[t("img",{class:"user-avatar",src:r(h),alt:""},null,8,es),t("span",{class:"change-avatar",onClick:w},[...s[0]||(s[0]=[t("img",{class:"change-btn",src:H,alt:"",srcset:""},null,-1)])])]),t("div",os,[t("div",ts,[t("div",as,[t("span",rs,x(r(d)("views.user.account.loginAccount")),1),t("span",ns,x(r(o)),1)]),s[1]||(s[1]=t("div",{class:"item-right"},null,-1))]),t("div",ls,[t("div",is,[t("span",ds,x(r(d)("views.user.account.accountPassword")),1),s[2]||(s[2]=t("span",{class:"item-value"},"**************",-1))]),t("div",{class:"item-right",onClick:k},[t("a",null,x(r(d)("common.change")),1)])])]),n(Z,{onOk:a,ref_key:"modifyAccountRef",ref:l},null,512),n(W,{onOk:b,ref_key:"modifyAvatarRef",ref:m},null,512)]))}},ys=L(cs,[["__scopeId","data-v-c0eaeb88"]]);export{ys as default};
//# sourceMappingURL=index-C6JyQVmF.js.map
