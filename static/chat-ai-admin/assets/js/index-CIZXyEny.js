import{X as _e,Y as i,_ as t,k as R,a5 as o,a6 as ue,a3 as te,G as F,a7 as h,ag as W,f as $,w as se,o as oe,y as J,b as ie,a1 as z,u as C,ae as w,F as N,a9 as D,ad as V,q as ae,a2 as H,n as ne,H as le,J as K,aa as he}from"./vue-chunks-yZ4gwLzA.js";import{u as re}from"./useEventBus-DbXWCKa0.js";import{g as pe}from"./index-BT8AeJHF.js";import{aa as Q,ah as Z,b3 as ee,h as me,b as P,d as X}from"../../index-ZzVqUZIR.js";import{u as ve}from"./useIM-pdql3nFx.js";import{B as U,M as fe,S as ge,P as ye}from"./pull-up.esm-DIiTC7VE.js";import{O as ke}from"./observe-dom.esm-B25JyVKH.js";import{ah as be,au as Le,aw as Te,v as we,u as Se,I as xe}from"./ui-antd-BJtyvQX6.js";import{_ as Ce}from"./index-CTzlnj_K.js";import{M as $e}from"./multiple-message-Du9Eel5L.js";import{h as Me}from"./index-WejToLyd.js";import"./utils-smNh_pj2.js";import"./index-BfMA38Vj.js";const Re=(d={})=>Q.get({url:"/manage/getReceiverList",params:d}),Ie=(d={})=>Q.post({url:"/chat/message",data:d}),Ne=(d={})=>Q.post({url:"/manage/setReceiverRead",data:d}),Y=_e("chatMonitor",{state:()=>({im:null,selectedRobotId:"",robotList:[],selectedReceiverId:"",receiverList:[],receiverListPage:{page:0,size:10},activeChat:null,chatMessagePageSize:10,messageList:[],messageListScrollTop:0,chatMessageLoadCompleted:!1,messageListLoading:!1}),getters:{},actions:{async init(){this.selectedRobotId="",this.selectedReceiverId="",this.robotList=[],this.receiverList=[],this.messageList=[],this.receiverListPage={page:0,size:10},this.messageListScrollTop=0,this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.activeChat=null,await this.getRobotList(),await this.getReceiverList(),this.receiverList.length>0&&await this.switchChat(this.receiverList[0]),this.initIM()},closeIM(){this.im&&this.im.close()},initIM(){const d=ve(),c=me();this.im=d,d.connect(c.user_id),d.on("message",s=>{!s.data||s.msg_type!=="receiver_notify"||((s.change=="create"||s.change=="update")&&this.onAddReceiver(s),s.change=="delete"&&this.onDeleteReceiver(s),(s.change=="c_message"||s.change=="ai_message")&&this.onAddMessage(s))})},onAddMessage(d){if(!this.activeChat)return;const c=re();let s=d.data;if(this.activeChat.session_id==s.session_id){if(s.displayName=s.name||s.nickname,s.dispayTime=ee(s.create_time),s.uid=Z(32),s.loading=!1,s.menu_json&&typeof s.menu_json=="string"&&(s.menu_json=JSON.parse(s.menu_json)),s.quote_file&&typeof s.quote_file=="string"&&(s.quote_file=JSON.parse(s.quote_file)),s.reply_content_list&&typeof s.reply_content_list=="string")try{s.reply_content_list=JSON.parse(s.reply_content_list)}catch{s.reply_content_list=[]}this.messageList.push(s),c.emit("onAddMessage",s)}},onAddReceiver(d){let c=d.data;c.displayName=c.name||c.nickname,c.come_from=JSON.parse(c.come_from);let s=this.receiverList.findIndex(n=>n.session_id==c.session_id);s!==-1?this.receiverList.splice(s,1,c):(this.selectedRobotId==""||this.selectedRobotId==c.robot_id)&&this.receiverList.unshift(c)},onDeleteReceiver(d){let c=d.data,s=this.receiverList.findIndex(n=>n.id==c);s!=-1&&(this.activeChat&&this.activeChat.id==c&&(this.activeChat=null),this.receiverList.splice(s,1))},async getRobotList(d){try{const c=await pe(d);return this.robotList=c.data||[],c}catch(c){throw console.error("Failed to get robot list:",c),c}},async getReceiverList(d){d!=null&&d.page?this.receiverListPage.page=d.page:this.receiverListPage.page++;const c={...this.receiverListPage,robot_id:this.selectedRobotId,...d};try{const s=await Re(c);let n=s.data.list||[];for(let e=0;e<n.length;e++)if(n[e].displayName=n[e].name||n[e].nickname,n[e].come_from)try{n[e].come_from=JSON.parse(n[e].come_from)}catch(u){console.error("Failed to parse come_from:",u)}return this.receiverListPage.page===1?this.receiverList=n:this.receiverList=this.receiverList.concat(n),s}catch(s){throw console.error("Failed to get receiver list:",s),this.receiverListPage.page>1&&this.receiverListPage.page--,s}},changeRobot(d){this.activeChat=null,this.resetReceiverList(d)},resetReceiverList(d){return this.receiverListPage.page=0,this.receiverList=[],this.getReceiverList(d)},async getChatMessage(){if(this.messageListLoading)return;this.messageListLoading=!0;let d=0,c=this.messageList.filter(n=>!n.isWelcome);c.length>0&&(d=c[0].id);let s={robot_key:this.activeChat.robot_key,openid:this.activeChat.openid,min_id:d,size:this.chatMessagePageSize,rel_user_id:this.activeChat.rel_user_id};return Ie(s).then(n=>{var L,g;this.messageListLoading=!1;let e=n.data.list||[];const u=((L=n==null?void 0:n.data)==null?void 0:L.customer)||{},v=((g=n==null?void 0:n.data)==null?void 0:g.robot)||{};e.sort((a,f)=>a.id-f.id);for(let a=0;a<e.length;a++){if(e[a].displayName=e[a].name||e[a].nickname,e[a].is_customer==1?(e[a].displayName=e[a].displayName||u.name,e[a].avatar=e[a].avatar||u.avatar):(e[a].displayName=e[a].displayName||v.robot_name,e[a].avatar=e[a].avatar||v.robot_avatar),e[a].uid=Z(32),e[a].menu_json&&typeof e[a].menu_json=="string"&&(e[a].menu_json=JSON.parse(e[a].menu_json)),e[a].quote_file&&typeof e[a].quote_file=="string"&&(e[a].quote_file=JSON.parse(e[a].quote_file)),e[a].reply_content_list&&typeof e[a].reply_content_list=="string")try{e[a].reply_content_list=JSON.parse(e[a].reply_content_list)}catch{e[a].reply_content_list=[]}e[a].dispayTime=ee(e[a].create_time)}return this.messageList=[...e,...this.messageList],e.length<this.chatMessagePageSize&&(this.chatMessageLoadCompleted=!0),n}).catch(n=>{this.messageListLoading=!1})},claerUnread(){return Ne({id:this.selectedReceiverId})},async switchChat(d){this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.messageList=[],this.messageListScrollTop=0,this.selectedReceiverId=d.id,this.activeChat=d,this.claerUnread(),await this.getChatMessage()}}}),Be={class:"no-data"},De={class:"no-data-text"},Oe={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(d){const c=d;return(s,n)=>{const e=X;return t(),i("div",Be,[R(e,{name:"empty",style:ue({"font-size":`${c.size}px`})},null,8,["style"]),o("div",De,[te(s.$slots,"default",{},()=>[F(h(c.text),1)],!0)])])}}},ce=P(Oe,[["__scopeId","data-v-35f939c8"]]),Ae={key:1,class:"chat-list"},qe=["onClick"],He={class:"avatar"},Pe=["src","alt"],ze={class:"chat-info"},je={class:"nickname"},Ue={class:"last-message"},Fe={class:"webapp-source"},Je={key:0,class:"loading-wrapper"},Ee={key:1,class:"finished-text"},Ve={__name:"chat-list ",emits:["switchChat"],setup(d,{expose:c,emit:s}){U.use(fe),U.use(ge),U.use(ke),U.use(ye);const n=s,e=Y(),{getReceiverList:u}=e,{receiverList:v,selectedReceiverId:L}=W(e),g=$(null);let a=null;const f=$(!1),S=$(!1),I=()=>{a=new U(g.value,{scrollY:!0,click:!0,observeDOM:!0,mouseWheel:!0,bounce:!1,scrollbar:{fade:!0,interactive:!0},pullUpLoad:!0}),a.on("pullingUp",()=>{y()})},y=async(k={})=>{if(f.value||S.value){a.finishPullUp();return}f.value=!0;try{(await u(k)).data.list.length===0&&!k.keyword&&(S.value=!0)}catch(x){console.error("加载更多数据失败:",x)}finally{f.value=!1,a.finishPullUp()}},m=k=>{n("switchChat",k)};return se(v,k=>{k.length>0&&J(()=>{a&&a.refresh()})}),oe(()=>{J(()=>{I()})}),ie(()=>{a&&a.destroy()}),c({getData:y}),(k,x)=>{const b=be;return t(),i("div",{class:"scroll-wrapper",ref_key:"scrollRef",ref:g},[C(v).length==0?(t(),z(ce,{key:0,size:"140",text:"暂无机器人接待中会话"})):(t(),i("div",Ae,[(t(!0),i(N,null,D(C(v),l=>(t(),i("div",{key:l.id,class:V(["chat-item",{active:l.id===C(L)}]),onClick:B=>m(l)},[o("div",He,[o("img",{src:l.avatar,alt:l.displayName},null,8,Pe),l.unread>0?(t(),i("span",{key:0,class:V(["dot",{plus:l.unread>9}])},h(l.unread),3)):w("",!0)]),o("div",ze,[o("div",je,h(l.displayName),1),o("div",Ue,h(l.last_chat_message),1),o("div",Fe,"来自："+h(l.come_from.app_name),1)])],10,qe))),128)),f.value?(t(),i("div",Je,[R(b,{size:"small"}),x[0]||(x[0]=o("span",{class:"loading-text"},"加载中...",-1))])):w("",!0),S.value?(t(),i("div",Ee,"没有更多了")):w("",!0)]))],512)}}},We=P(Ve,[["__scopeId","data-v-973fe8e9"]]),Ye={__name:"chat-message-scroll",props:{topTriggerDistance:{type:Number,default:10},bottomTriggerDistance:{type:Number,default:40},isLoading:{type:Boolean,default:!1},scrollTop:{type:Number,default:0}},emits:["scroll-top","scroll-bottom","scroll"],setup(d,{expose:c,emit:s}){const n=d,e=s,u=$(null),v=$({scrollTop:0,scrollHeight:0,clientHeight:0,scrollDirection:"down",scrollStartDiff:n.topTriggerDistance,scrollEndDiff:n.bottomTriggerDistance}),L=$(null),g=m=>{const{scrollTop:k}=m,x=v.value.scrollTop-k;v.value.scrollDirection=x>0?"up":"down",Object.assign(v.value,{scrollTop:k,scrollHeight:m.scrollHeight,clientHeight:m.clientHeight})},a=()=>{const{scrollTop:m,scrollHeight:k,clientHeight:x,scrollStartDiff:b,scrollEndDiff:l,scrollDirection:B}=v.value;e("scroll",{...v.value}),n.isLoading||(Math.abs(m)<=b&&B==="up"&&e("scroll-top",{...v.value}),Math.abs(k-m-x)<=l&&B==="down"&&e("scroll-bottom",{...v.value}))},f=m=>{g(m.target),L.value&&(clearTimeout(L.value),L.value=null),L.value=setTimeout(()=>{a()},100)};function S(){u.value&&(u.value.scrollTop=0)}function I(){u.value&&(u.value.scrollTop=u.value.scrollHeight)}function y(){return u.value&&Object.assign(v.value,{scrollTop:u.value.scrollTop,scrollHeight:u.value.scrollHeight,clientHeight:u.value.clientHeight}),JSON.parse(JSON.stringify(v.value))}return se(()=>n.scrollTop,m=>{u.value&&(u.value.scrollTop=m)}),c({scrollToTop:S,scrollToBottom:I,getState:y}),(m,k)=>(t(),i("div",{class:"chat-message-scroll",ref_key:"scrollContainer",ref:u,onScroll:f},[te(m.$slots,"default",{},void 0,!0)],544))}},Ge=P(Ye,[["__scopeId","data-v-23d37ca8"]]),Qe={class:"chat-message-warpper"},Xe={class:"chat-message-content"},Ke={key:0,class:"is-loaded"},Ze={class:"avatar"},et=["src","alt"],tt={class:"message-content"},st={class:"message-info"},ot={class:"nickname"},it={class:"time"},at={key:0,class:"reply-list"},nt={key:0,class:"reply-item reply-text"},lt=["innerHTML"],rt={key:1,class:"reply-item reply-image"},ct={class:"message-content"},dt=["src"],_t={key:2,class:"reply-item reply-url"},ut={class:"url-row"},ht=["href"],pt={key:3,class:"reply-item reply-card"},mt={class:"card-row"},vt=["src"],ft={class:"card-title-box"},gt={class:"card-title"},yt={key:4,class:"reply-item reply-imageText"},kt=["href"],bt=["src"],Lt={class:"imageText-text"},Tt={class:"imageText-title"},wt={class:"imageText-desc"},St={key:5,class:"reply-item reply-smartMenu"},xt={class:"smart-menu-box"},Ct={key:0,class:"card-title"},$t={class:"card-text"},Mt={key:0,class:"line-text"},Rt={key:1,class:"empty-line"},It=["innerHTML"],Nt={key:3,href:"javascript:;",class:"link"},Bt={key:0},Dt={key:1,class:"message-bubble"},Ot={key:0,class:"text-content"},At={key:1},qt={key:1,class:"image-content"},Ht=["src"],Pt={key:2,class:"image-content"},zt=["src"],jt={key:3,class:"menu-content"},Ut={class:"menus-label"},Ft={key:0,class:"menu-items"},Jt=["onClick"],Et={key:4,class:"multiple-content"},Vt={key:5,class:"answer-reference-box"},Wt=["onClick"],Yt={__name:"chat-message",emits:["openLibrary"],setup(d,{expose:c,emit:s}){const n=s,e=$(null),u=Y(),{getChatMessage:v}=u,{messageList:L,messageListScrollTop:g,messageListLoading:a,chatMessageLoadCompleted:f,activeChat:S}=W(u),I=()=>{};function y(T,p,M){let q=K(T);p.robot_key=S.value.robot_key,p.robot_id=S.value.robot_id,q.forEach(r=>{r.message_id=M.id,r.openid=M.openid,r.robot_key=S.value.robot_key,r.robot_id=S.value.robot_id}),n("openLibrary",q,K(p))}function m(T){const p=[];return(Array.isArray(T)?T:[]).forEach(M=>{const q=String((M==null?void 0:M.menu_type)||""),r=String((M==null?void 0:M.content)||"");if(q==="0")if(r==="")p.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(r)){const G=/href\s*=\s*['"]\s*#\s*['"]/i.test(r)?r.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):r.replace(/href=/ig,'target="_blank" href=');p.push({kind:"html",html:G})}else p.push({kind:"text",text:r});else q==="1"&&p.push({kind:"keyword",text:r,serial_no:(M==null?void 0:M.serial_no)||""})}),p.slice(0,20)}const k=T=>{const{scrollTop:p}=T;g.value=p},x=async()=>{if(f.value)return;let T=e.value.getState();await v(),J(()=>{let p=e.value.getState();p.scrollDirection=="up"&&(g.value=p.scrollHeight-T.scrollHeight)})},b=async()=>{},l=()=>{e.value.scrollToBottom()},B=()=>{e.value.scrollToTop()};function A(T){try{return T?Array.isArray(T)?T:typeof T=="string"?JSON.parse(T||"[]"):[]:[]}catch{return[]}}return c({scrollToTop:B,scrollToBottom:l}),(T,p)=>{const M=X,q=ae("viewer");return t(),i("div",Qe,[R(Ge,{ref_key:"scrollViewRef",ref:e,scrollTop:C(g),"onUpdate:scrollTop":p[0]||(p[0]=r=>le(g)?g.value=r:null),"is-loading":C(a),onScroll:k,onScrollTop:x,onScrollBottom:b},{default:H(()=>[o("div",Xe,[C(f)?(t(),i("div",Ke,"没用更多聊天记录了")):w("",!0),(t(!0),i(N,null,D(C(L),(r,G)=>(t(),i("div",{key:G,class:V(["message-item",r.is_customer==0?"right":""])},[o("div",Ze,[o("img",{src:r.avatar,alt:r.displayName},null,8,et)]),o("div",tt,[o("div",st,[o("span",ot,h(r.displayName),1),p[1]||(p[1]=o("i",{class:"gap"},null,-1)),o("span",it,h(r.dispayTime),1)]),A(r.reply_content_list).length?(t(),i("div",at,[(t(!0),i(N,null,D(A(r.reply_content_list),(_,j)=>{var E;return t(),i(N,{key:j},[(_.reply_type||_.type)==="text"?(t(),i("div",nt,[o("div",{class:"message-content",innerHTML:_.description},null,8,lt)])):(_.reply_type||_.type)==="image"?(t(),i("div",rt,[o("div",ct,[ne(o("img",{class:"msg-img",src:_.pic||_.thumb_url},null,8,dt),[[q]])])])):(_.reply_type||_.type)==="url"?(t(),i("div",_t,[o("div",ut,[o("a",{class:"url-link",href:_.url,target:"_blank"},h(_.url),9,ht)])])):(_.reply_type||_.type)==="card"?(t(),i("div",pt,[o("div",mt,[_.thumb_url?(t(),i("img",{key:0,src:_.thumb_url,class:"card-thumb"},null,8,vt)):w("",!0),o("div",ft,[R(M,{class:"think-icon",name:"applet"}),o("span",gt,h(_.title),1)])])])):(_.reply_type||_.type)==="imageText"?(t(),i("div",yt,[o("a",{class:"imageText-row",href:_.url,target:"_blank"},[_.thumb_url?(t(),i("img",{key:0,src:_.thumb_url,class:"imageText-thumb"},null,8,bt)):w("",!0),o("div",Lt,[o("div",Tt,h(_.title),1),o("div",wt,h(_.description),1)])],8,kt)])):(_.reply_type||_.type)==="smartMenu"?(t(),i("div",St,[o("div",xt,[_.smart_menu&&_.smart_menu.menu_description?(t(),i("div",Ct,h(_.smart_menu.menu_description),1)):w("",!0),o("div",$t,[(t(!0),i(N,null,D(m(((E=_.smart_menu)==null?void 0:E.menu_content)||[]),(O,de)=>(t(),i("div",{key:de,class:"reply-line"},[O.kind==="text"?(t(),i("span",Mt,h(O.text),1)):O.kind==="newline"?(t(),i("div",Rt)):O.kind==="html"?(t(),i("span",{key:2,innerHTML:O.html},null,8,It)):O.kind==="keyword"?(t(),i("a",Nt,[O.serial_no?(t(),i("div",Bt,h(O.serial_no),1)):w("",!0),F(" "+h(O.text),1)])):w("",!0)]))),128))])])])):w("",!0)],64)}),128))])):w("",!0),r.msg_type==1&&r.content==""?w("",!0):(t(),i("div",Dt,[r.msg_type==1?(t(),i("div",Ot,[r.is_customer==0?(t(),z(Ce,{key:0,content:r.content},null,8,["content"])):(t(),i("div",At,h(r.content),1))])):r.received_message_type=="image"&&r.media_id_to_oss_url?(t(),i("div",qt,[o("img",{src:r.media_id_to_oss_url,alt:"image"},null,8,Ht)])):r.msg_type==3?(t(),i("div",Pt,[o("img",{src:r.content,alt:"image"},null,8,zt)])):r.msg_type==2?(t(),i("div",jt,[o("div",Ut,h(r.menu_json.content),1),r.menu_json.question&&r.menu_json.question.length>0?(t(),i("div",Ft,[(t(!0),i(N,null,D(r.menu_json.question,(_,j)=>(t(),i("div",{key:j,class:"menu-item",onClick:E=>I(_)},h(_),9,Jt))),128))])):w("",!0)])):r.msg_type==99?(t(),i("div",Et,[R($e,{message:r.content},null,8,["message"])])):w("",!0),r.quote_file&&r.quote_file.length?(t(),i("div",Vt,[p[2]||(p[2]=o("div",{class:"answer-reference-label"},"回答参考",-1)),o("div",null,[(t(!0),i(N,null,D(r.quote_file,(_,j)=>(t(),i("div",{class:"list-item",key:j},[R(M,{name:"attachment"}),o("span",{onClick:E=>y(r.quote_file,_,r)},h(_.file_name),9,Wt)]))),128))])])):w("",!0)]))])],2))),128))])]),_:1},8,["scrollTop","is-loading"])])}}},Gt=P(Yt,[["__scopeId","data-v-e61f5262"]]),Qt={class:"library-info-content"},Xt={class:"file-list"},Kt=["onClick"],Zt={class:"document-items"},es={class:"document-item-header"},ts={class:"left-box"},ss={class:"document-title"},os={key:0,class:"document-title"},is={class:"document-size"},as={class:"document-item-body"},ns={class:"document-similarity"},ls={key:0,class:"document-content"},rs={key:1,class:"document-content"},cs={class:"document-content"},ds={class:"fragment-img"},_s=["src"],us={__name:"library-info-alert",setup(d,{expose:c}){const s=he(),n=$(!1),e=$([]),u=$(null),v=()=>{e.value=[],u.value=null},L=(y,m)=>{v(),e.value=y,u.value=m.id,n.value=!0,f(m)},g=y=>{y.id!=u.value&&(u.value=y.id,f(y))},a=$([]),f=y=>{Me({message_id:y.message_id,file_id:y.id,robot_key:y.robot_key,openid:y.openid}).then(m=>{a.value=m.data||[]})},S=()=>{s.push("/library/preview?id="+u.value)},I=()=>{n.value=!1};return c({open:L}),(y,m)=>{const k=X,x=Te,b=ae("viewer");return t(),z(x,{class:"library-info-alert",open:n.value,"onUpdate:open":m[0]||(m[0]=l=>n.value=l),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:H(()=>[o("span",{class:"close-btn",onClick:I},[R(C(Le))])]),default:H(()=>[o("div",Qt,[o("div",Xt,[(t(!0),i(N,null,D(e.value,l=>(t(),i("div",{class:V(["file-item",{active:u.value==l.id}]),key:l.id,onClick:B=>g(l)},h(l.file_name),11,Kt))),128))]),o("div",Zt,[(t(!0),i(N,null,D(a.value,l=>(t(),i("div",{class:"document-item",key:l.id},[o("div",es,[o("div",ts,[o("span",ss,"id："+h(l.id),1),l.title?(t(),i("span",os,h(l.title),1)):w("",!0),o("span",is," 共"+h(l.word_total)+"个字符 ",1)]),o("div",{class:"right-box"},[o("a",{onClick:S},"查看源文档>")])]),o("div",as,[o("div",ns,[m[1]||(m[1]=F(" 相似度： ",-1)),R(k,{name:"similarity",style:{"font-size":"16px"}}),F(h(l.similarity),1)]),l.question?(t(),i("div",ls,"Q："+h(l.question),1)):w("",!0),l.answer?(t(),i("div",rs,"A："+h(l.answer),1)):w("",!0),o("div",cs,h(l.content),1),ne((t(),i("div",ds,[(t(!0),i(N,null,D(l.images,(B,A)=>(t(),i("img",{key:A,src:B,alt:""},null,8,_s))),128))])),[[b]])])]))),128))])])]),_:1},8,["open"])}}},hs=P(us,[["__scopeId","data-v-1eece137"]]),ps={key:0,class:"chat-box-warpper"},ms={class:"chat-box-header"},vs={class:"nickname"},fs={class:"chat-source"},gs={class:"chat-box-content"},ys={key:1},ks={__name:"chat-box",setup(d,{expose:c}){const s=Y(),{activeChat:n}=W(s),e=$(null),u=()=>{e.value.scrollToBottom()},v=()=>{e.value.scrollToTop()},L=$(null),g=(a,f)=>{L.value.open(a,f)};return c({scrollToTop:v,scrollToBottom:u}),(a,f)=>(t(),i(N,null,[C(n)?(t(),i("div",ps,[o("div",ms,[o("div",vs,h(C(n).name||C(n).nickname),1),o("div",fs," 来自："+h(C(n).come_from.robot_name)+" - "+h(C(n).come_from.app_name),1)]),o("div",gs,[R(Gt,{ref_key:"chatMessageRef",ref:e,onOpenLibrary:g},null,512)])])):(t(),i("div",ys)),R(hs,{ref_key:"libraryInfoAlertRef",ref:L},null,512)],64))}},bs=P(ks,[["__scopeId","data-v-d67bf9eb"]]),Ls={class:"chat-monitor-page"},Ts={class:"page-left"},ws={class:"app-list-box"},Ss={class:"search-box"},xs={class:"chat-list-wrapper"},Cs={class:"page-body"},$s={__name:"index",setup(d){const c=re(),s=Y(),{init:n,changeRobot:e,switchChat:u,closeIM:v}=s,{robotList:L,selectedRobotId:g,activeChat:a}=W(s),f=$(null),S=$(null),I=$(""),y=()=>{const b={keyword:I.value,page:1};e(b)},m=async b=>{var l;await u(b),(l=S.value)==null||l.scrollToBottom()},k=()=>{J(()=>{var b;(b=S.value)==null||b.scrollToBottom()})},x=()=>{const b={keyword:I.value,page:1};f.value&&f.value.getData(b)};return oe(async()=>{await n(),J(()=>{var b;(b=S.value)==null||b.scrollToBottom()}),c.on("onAddMessage",k)}),ie(()=>{c.off("onAddMessage",k),v()}),(b,l)=>{const B=we,A=Se,T=xe;return t(),i("div",Ls,[o("div",Ts,[o("div",ws,[R(A,{value:C(g),"onUpdate:value":l[0]||(l[0]=p=>le(g)?g.value=p:null),style:{width:"100%"},onChange:y},{default:H(()=>[R(B,{value:""},{default:H(()=>[...l[2]||(l[2]=[F("全部应用",-1)])]),_:1}),(t(!0),i(N,null,D(C(L),p=>(t(),z(B,{value:p.id,key:p.id},{default:H(()=>[o("span",null,h(p.robot_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),o("div",Ss,[R(T,{value:I.value,"onUpdate:value":l[1]||(l[1]=p=>I.value=p),placeholder:"搜索客户昵称或openld，按enter搜索","enter-button":"",style:{width:"100%"},onSearch:x,allowClear:"",onPressEnter:x},null,8,["value"])]),o("div",xs,[R(We,{ref_key:"chatListRef",ref:f,onSwitchChat:m},null,512)])]),o("div",Cs,[C(a)?(t(),z(bs,{key:0,ref_key:"chatBoxRef",ref:S},null,512)):(t(),z(ce,{key:1,style:{background:"#F2F4F7"},size:"250"},{default:H(()=>[...l[3]||(l[3]=[o("div",null,[o("p",null,"请在左侧列表先选择会话"),o("p",null,"通过本功能，可以实时查看机器人接待中的会话消息，监控机器人回复效果")],-1)])]),_:1}))])])}}},Us=P($s,[["__scopeId","data-v-0d77ff6e"]]);export{Us as default};
