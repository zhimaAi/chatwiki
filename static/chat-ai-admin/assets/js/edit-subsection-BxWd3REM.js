import{_ as ge,d as ye,aX as be,aY as xe,aZ as ke,a_ as he,al as we}from"../../index-C1Xsov4S.js";import{f as l,r as Y,w as qe,aa as Ie,Y as r,_ as i,k as n,a2 as u,n as J,A as Z,a5 as t,ae as p,a1 as O,a6 as Se,u as K,a7 as b,F as V,ab as Le,G as x,ac as Ce}from"./vue-chunks-DCKTEHpB.js";import{U as Ue}from"./index-DnH49Zzm.js";import{u as Me}from"./util-BwuffJOK.js";import{M as Ee}from"./model-select-Dnf798RG.js";import{M as Ne}from"./index-BMSQkwth.js";import{I as ze,z as Ae,bv as Be,bw as Fe,v as Oe,w as Ge,X as Te,a0 as je,a1 as De,H as $e,B as Ke,ay as Ve,M as He,a as k}from"./ui-antd-D64OvTpt.js";const Pe={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},Qe={class:"custom-modal-header"},Re={key:1},Xe={key:2},Ye={class:"form-box-wrapper"},Je={key:0,class:"form-item"},Ze={class:"form-content"},We={key:1,class:"form-item"},et={class:"form-content"},tt={class:"star-item-box"},st={key:2},at={class:"form-item"},ot={class:"form-content"},lt={class:"form-item"},nt={class:"form-content"},it={class:"form-item"},rt={class:"form-content"},ut={key:0,class:"error-tip"},dt={key:3,class:"form-item"},vt={class:"form-content"},ct={key:0,class:"error-tip"},pt={class:"form-item"},mt={class:"form-content"},_t={class:"upload-box-wrapper"},ft={key:0},gt={key:4,class:"form-item"},yt={class:"form-label-box"},bt={class:"form-content"},xt={class:"ai-generate-wrapper"},kt={class:"form-box-wrapper ai-generate-wrapper-box"},ht={class:"ai-generate-wrapper-left"},wt={class:"form-box-wrapper-options"},qt={class:"form-item flex1"},It={class:"form-content"},St={class:"form-item flex1"},Lt={class:"form-content dual-inputs"},Ct={class:"input-group"},Ut={class:"form-label-input-box"},Mt={class:"form-box-wrapper-content"},Et={class:"problem-box"},Nt={class:"problem-content"},zt={class:"problem-box"},At={class:"problem-content"},Bt={class:"form-item generate-btn-box"},Ft={class:"result-nav"},Ot={key:0,class:"tip"},Gt={key:1,class:"result-nav-text"},Tt={key:0,class:"container"},jt={class:"result-container"},Dt=["innerHTML"],$t={class:"result-footer"},Kt={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(W,{expose:ee,emit:te}){const se=l(!1),v=l(!1),G=l(!1),q=l(!1),I=l(!1),m=Y({use_model:"",is_offline:"",model_config_id:"",count:5}),ae=new Ne({html:!0,linkify:!0,typographer:!0}),H=l(""),S=Y({finish:"",content:""});qe(()=>S.content,()=>{H.value=ae.render(S.content)});const L=Ie(),oe=L.query,C=L.name,M=W,T=te;l("");const P=l("1"),h=l(!1),E=l(""),g=l(""),_=l(""),y=l(""),f=l(""),w=l([]),U=l(0),N=l(""),z=l("0"),d=l(!1),le=a=>{v.value=!1,G.value=!1,I.value=!1,E.value=a.title||"",g.value=a.content||"",N.value=a.id||"",_.value=a.answer||"",w.value=a.images||[],y.value=a.question||"",f.value=a.similar_questions?a.similar_questions.join(`
`):"",d.value=M.detailsInfo.is_qa_doc=="1",U.value=a.category_id||0,z.value=a.group_id||"0",D(),d&&ne(),h.value=!0},Q=l([]),ne=()=>{we({library_id:M.detailsInfo.library_id}).then(a=>{Q.value=a.data||[]})},j=l([]),D=()=>{he({file_id:oe.id}).then(a=>{let e=a.data||[];e=e.map(o=>({value:o.id,payload:{...o,color:Pe[o.type]}})),C=="categaryManages"?j.value=[...e]:j.value=[{value:0,payload:{id:0,name:"未标记"}},...e],T("handleStatrList",a.data||[])})},R=()=>{if(X(),!g.value&&!d.value)return k.error("请输入分段内容");if(!y.value&&d.value)return k.error("请输入分段问题");if(!_.value&&d.value)return k.error("请输入分段答案");if(d.value&&_.value.length>1e4||!d.value&&g.value.length>1e4)return;if(C=="categaryManages"&&U.value<=0)return k.error("请选择分类标记");let a={title:E.value,content:g.value,question:y.value,answer:_.value,images:w.value,category_id:U.value};d.value&&(a.group_id=z.value||0);let e=f.value.trim();e?(e=e.split(`
`),a.similar_questions=JSON.stringify(e)):a.similar_questions="[]",N.value?a.id=N.value:a.file_id=L.query.id;let o=new FormData;for(let c in a)Me.isArray(a[c])?a[c].forEach($=>{o.append(c,$)}):o.append(c,a[c]);C=="knowledgeDocument"&&(o.delete("file_id"),o.append("library_id",L.query.id)),C=="libraryConfig"&&(o.delete("file_id"),o.append("library_id",M.detailsInfo.library_id)),C=="categaryManages"?(o.delete("file_id"),o.append("library_id",L.query.id),xe(o).then(c=>{k.success(a.id?"修改成功":"添加成功"),h.value=!1,T("handleEdit",{...a}),D()})):ke(o).then(c=>{k.success(a.id?"修改成功":"添加成功"),h.value=!1,T("handleEdit",{...a}),D()})},ie=()=>{v.value=!0},A=l(""),re=async()=>{S.content="",A.value="",q.value=!0,I.value=!0;try{let a={library_id:M.detailsInfo.library_id,model_config_id:m.model_config_id,use_model:m.use_model,num:m.count,question:y.value,answer:_.value};const e=await be(a);A.value=e.data.map(o=>o).join(`
`),S.content=e.data.map((o,c)=>`<div class="dialog-message">${c+1}. ${o}</div>`).join(""),G.value=!0}finally{q.value=!1}},ue=()=>{f.value?f.value+=`
${A.value}`:f.value+=A.value,k.success("保存成功"),G.value=!1,v.value=!1,I.value=!1};function de(a){return a.split(`
`).map(e=>e.trim()).filter(e=>e).join(`
`)}const X=()=>{f.value=de(f.value)};return ee({showModal:le}),(a,e)=>{const o=Ke,c=ze,$=Ae,ve=Ge,ce=Oe,B=Te,F=ye,pe=De,me=je,_e=$e,fe=He;return i(),r("div",null,[n(fe,{open:h.value,"onUpdate:open":e[14]||(e[14]=s=>h.value=s),onOk:R,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:v.value?I.value?"944px":"472px":"746px","ok-button-props":{style:{display:v.value?"none":"block"}}},{title:u(()=>[t("div",Qe,[v.value?(i(),O(o,{key:0,type:"text",class:"back-button",onClick:e[0]||(e[0]=s=>v.value=!1)},{icon:u(()=>[n(K(Ve),{style:{"font-size":"12px"}})]),_:1})):p("",!0),v.value?(i(),r("span",Re,"AI生成相似问法")):(i(),r("span",Xe,b(N.value?"编辑分段":"新增分段"),1))])]),footer:u(()=>[v.value?p("",!0):(i(),r(V,{key:0},[n(o,{onClick:e[13]||(e[13]=s=>h.value=!1)},{default:u(()=>[...e[33]||(e[33]=[x("取消",-1)])]),_:1}),n(o,{type:"primary",onClick:R},{default:u(()=>[...e[34]||(e[34]=[x("确定",-1)])]),_:1})],64))]),default:u(()=>[J(t("div",Ye,[d.value?p("",!0):(i(),r("div",Je,[e[15]||(e[15]=t("div",{class:"form-label"},"分段标题：",-1)),t("div",Ze,[n(c,{maxLength:25,value:E.value,"onUpdate:value":e[1]||(e[1]=s=>E.value=s),placeholder:"请输入分段标题"},null,8,["value"])])])),d.value?p("",!0):(i(),r("div",We,[e[16]||(e[16]=t("div",{class:"form-label"},"分段分类标记",-1)),t("div",et,[n($,{value:U.value,"onUpdate:value":e[2]||(e[2]=s=>U.value=s),options:j.value},{label:u(({payload:s})=>[t("div",tt,[s.id>0?(i(),O(K(Be),{key:0,style:Se({color:s.color})},null,8,["style"])):(i(),O(K(Fe),{key:1})),t("div",null,b(s.name||"-"),1),s.data_count>0?(i(),r("span",st,"("+b(s.data_count)+")",1)):p("",!0)])]),_:1},8,["value","options"])])])),d.value?(i(),r(V,{key:2},[t("div",at,[e[17]||(e[17]=t("div",{class:"form-label required"},"所属分组：",-1)),t("div",ot,[n(ce,{value:z.value,"onUpdate:value":e[3]||(e[3]=s=>z.value=s),style:{width:"100%"}},{default:u(()=>[(i(!0),r(V,null,Le(Q.value,s=>(i(),O(ve,{value:s.id},{default:u(()=>[x(b(s.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),t("div",lt,[e[18]||(e[18]=t("div",{class:"form-label required"},"分段问题：",-1)),t("div",nt,[n(B,{placeholder:"请输入分段问题",value:y.value,"onUpdate:value":e[4]||(e[4]=s=>y.value=s),style:{height:"100px"}},null,8,["value"])])]),t("div",it,[e[19]||(e[19]=t("div",{class:"form-label required"},"分段答案：",-1)),t("div",rt,[n(B,{placeholder:"请输入分段答案",value:_.value,"onUpdate:value":e[5]||(e[5]=s=>_.value=s),style:{height:"100px"}},null,8,["value"]),_.value.length>1e4?(i(),r("div",ut,"分段答案最多支持10000个字符")):p("",!0)])])],64)):(i(),r("div",dt,[e[20]||(e[20]=t("div",{class:"form-label required"},"分段内容：",-1)),t("div",vt,[n(B,{style:{height:"150px"},value:g.value,"onUpdate:value":e[6]||(e[6]=s=>g.value=s),placeholder:"请输入分段内容"},null,8,["value"]),g.value.length>1e4?(i(),r("div",ct,"分段内容最多支持10000个字符")):p("",!0)])])),t("div",pt,[t("div",mt,[t("div",_t,[n(me,{activeKey:P.value,"onUpdate:activeKey":e[7]||(e[7]=s=>P.value=s),size:"small"},{default:u(()=>[n(pe,{key:"1"},{tab:u(()=>[t("span",null,[n(F,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),e[21]||(e[21]=x(" 答案附图 ",-1)),w.value.length?(i(),r("span",ft,"("+b(w.value.length)+")",1)):p("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Ue,{value:w.value,"onUpdate:value":e[8]||(e[8]=s=>w.value=s)},null,8,["value"])])])]),d.value?(i(),r("div",gt,[t("div",yt,[e[23]||(e[23]=t("div",{class:"form-label"},"相似问法",-1)),t("div",{class:"ai-generate",onClick:ie},[n(F,{name:"ai-generate",style:{"font-size":"14px"}}),e[22]||(e[22]=t("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),t("div",bt,[n(B,{placeholder:"请输入相似问法",value:f.value,"onUpdate:value":e[9]||(e[9]=s=>f.value=s),style:{height:"100px"},onBlur:X},null,8,["value"]),e[24]||(e[24]=t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])])):p("",!0)],512),[[Z,!v.value]]),J(t("div",xt,[t("div",kt,[t("div",ht,[t("div",wt,[t("div",qt,[e[25]||(e[25]=t("div",{class:"form-label required"},"相似问法模型：",-1)),t("div",It,[n(Ee,{modelType:"LLM",modeName:m.use_model,"onUpdate:modeName":e[10]||(e[10]=s=>m.use_model=s),modeId:m.model_config_id,"onUpdate:modeId":e[11]||(e[11]=s=>m.model_config_id=s)},null,8,["modeName","modeId"])])]),t("div",St,[t("div",Lt,[t("div",Ct,[e[27]||(e[27]=t("div",{class:"form-label required"},"问题个数：",-1)),t("div",Ut,[n(_e,{value:m.count,"onUpdate:value":e[12]||(e[12]=s=>m.count=s),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),e[26]||(e[26]=x("个 ",-1))])])])])]),t("div",Mt,[t("div",Et,[e[28]||(e[28]=t("div",{class:"problem"},"问题",-1)),t("div",Nt,b(y.value),1)]),t("div",zt,[e[29]||(e[29]=t("div",{class:"problem"},"答案",-1)),t("div",At,b(_.value),1)])]),t("div",Bt,[n(o,{onClick:re,loading:q.value,class:"generate-btn"},{default:u(()=>[n(F,{name:"ai-generate-white",style:{"font-size":"16px"}}),e[30]||(e[30]=x(" 开始生成 ",-1))]),_:1},8,["loading"])])]),t("div",{class:Ce(["ai-generate-wrapper-right",{"show-result":I.value}])},[t("div",Ft,[n(F,{name:"generate-icon",style:{"font-size":"14px"}}),q.value?(i(),r("span",Ot,"相似问法生成中...")):(i(),r("div",Gt,"相似问法生成完毕"))]),!S.content&&q.value&&!se.value?(i(),r("div",Tt,[...e[31]||(e[31]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)])])):p("",!0),t("div",jt,[t("div",{class:"dialog-content",innerHTML:H.value},null,8,Dt)]),t("div",$t,[n(o,{class:"result-footer-btn",type:"primary",onClick:ue},{default:u(()=>[...e[32]||(e[32]=[x("保存相似问法",-1)])]),_:1})])],2)])],512),[[Z,v.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Jt=ge(Kt,[["__scopeId","data-v-a5c9da59"]]);export{Jt as E,Pe as c};
