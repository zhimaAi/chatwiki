{"version":3,"file":"index-DGcZEdtU.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/database/database-list/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"library-page\">\r\n    <PageTabs class=\"mb-16\" :tabs=\"pageTabs\" active=\"/database/list\"></PageTabs>\r\n    <page-alert style=\"margin-bottom: 16px\" :title=\"t('usage_guide.title')\">\r\n      <div>\r\n        <p>{{ t('usage_guide.point_1') }}</p>\r\n        <p>{{ t('usage_guide.point_2') }}</p>\r\n      </div>\r\n    </page-alert>\r\n\r\n    <div class=\"library-page-body\">\r\n      <div class=\"list-toolbar\">\r\n        <div class=\"toolbar-box\">\r\n          <h3 class=\"list-total\">{{ t('list.all') }} ({{ list.length }})</h3>\r\n        </div>\r\n\r\n        <div class=\"toolbar-box\">\r\n          <a-button type=\"primary\" @click=\"toAdd()\" v-if=\"formCreate\">\r\n            <template #icon>\r\n              <PlusOutlined />\r\n            </template>\r\n            {{ t('list.create_btn') }}\r\n          </a-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"list-box\">\r\n        <div class=\"list-item-wrapper\" v-for=\"item in list\" :key=\"item.id\">\r\n          <div class=\"list-item\" @click.stop=\"toEdit(item)\">\r\n            <div class=\"library-info\">\r\n              <img class=\"library-icon\" src=\"@/assets/img/database/base-icon.svg\" alt=\"\" />\r\n              <div class=\"library-info-content\">\r\n                <div class=\"library-title\">{{ item.name }}</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"item-body\">\r\n              <div class=\"library-desc\">{{ item.description }}</div>\r\n            </div>\r\n\r\n            <div class=\"item-footer\">\r\n              <div class=\"library-size\">\r\n                <span class=\"text-item\">{{ t('item.data_count') }}{{ item.entry_count }}{{ t('item.count_unit') }}</span>\r\n                <span class=\"text-item\">{{ t('item.related_apps') }}{{ item.robot_nums || 0 }}</span>\r\n              </div>\r\n\r\n              <div class=\"action-box\" @click.stop>\r\n                <a-dropdown>\r\n                  <div class=\"action-item\" @click.stop>\r\n                    <svg-icon class=\"action-icon\" name=\"point-h\"></svg-icon>\r\n                  </div>\r\n                  <template #overlay>\r\n                    <a-menu>\r\n                      <a-menu-item>\r\n                        <a href=\"javascript:;\" @click.stop=\"toAdd(item)\">{{ t('item.edit') }}</a>\r\n                      </a-menu-item>\r\n                      <a-menu-item>\r\n                        <a class=\"delete-text-color\" href=\"javascript:;\" @click=\"handleDelete(item)\"\r\n                          >{{ t('item.delete') }}</a\r\n                        >\r\n                      </a-menu-item>\r\n                    </a-menu>\r\n                  </template>\r\n                </a-dropdown>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <AddDataSheet @ok=\"getList\" ref=\"addDataSheetRef\"></AddDataSheet>\r\n</template>\r\n\r\n<script setup>\r\nimport { usePermissionStore } from '@/stores/modules/permission'\r\nimport { ref, createVNode, computed } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { Modal, message } from 'ant-design-vue'\r\nimport { PlusOutlined, ExclamationCircleOutlined } from '@ant-design/icons-vue'\r\nimport { getFormList, delForm } from '@/api/database'\r\nimport AddDataSheet from './components/add-data-sheet.vue'\r\nimport PageTabs from '@/components/cu-tabs/page-tabs.vue'\r\nimport PageAlert from '@/components/page-alert/page-alert.vue'\r\nimport { getDatabasePermission } from '@/utils/permission'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.database.database-list.index')\r\nconst router = useRouter()\r\n\r\nconst pageTabs = computed(() => [\r\n  {\r\n    title: t('page_tabs.library'),\r\n    path: '/library/list'\r\n  },\r\n  {\r\n    title: t('page_tabs.database'),\r\n    path: '/database/list'\r\n  },\r\n  {\r\n    title: t('page_tabs.document_extract_faq'),\r\n    path: '/ai-extract-faq/list'\r\n  },\r\n  {\r\n    title: t('page_tabs.trigger_statistics'),\r\n    path: '/trigger-statics/list'\r\n  },\r\n])\r\n\r\nconst permissionStore = usePermissionStore()\r\nlet { role_permission, role_type } = permissionStore\r\nconst formCreate = computed(() => role_type == 1 || role_permission.includes('FormCreate'))\r\n\r\nconst list = ref([])\r\n\r\nconst getList = () => {\r\n  getFormList({}).then((res) => {\r\n    list.value = res.data || []\r\n  })\r\n}\r\n\r\ngetList()\r\n\r\nconst addDataSheetRef = ref(null)\r\nconst toAdd = (data = {}) => {\r\n  console.log(data)\r\n  if (data.id) {\r\n    let key = getDatabasePermission(data.id)\r\n    if (!(key == 4 || key == 2)) {\r\n      return message.error(t('message.no_edit_permission'))\r\n    }\r\n  }\r\n  addDataSheetRef.value.show(data)\r\n}\r\n\r\nconst toEdit = (data) => {\r\n  // router.push({\r\n  //   path: '/database/details',\r\n  //   query: {\r\n  //     form_id: data.id,\r\n  //     name: data.name\r\n  //   }\r\n  // })\r\n  window.open(`/#/database/details?form_id=${data.id}&name=${data.name}`, \"_blank\", \"noopener\") // 建议添加 noopener 防止安全漏洞\r\n}\r\n\r\nconst handleDelete = (data) => {\r\n  let key = getDatabasePermission(data.id)\r\n  if (key != 4) {\r\n    return message.error(t('message.no_delete_permission'))\r\n  }\r\n  let secondsToGo = 3\r\n\r\n  let modal = Modal.confirm({\r\n    title: t('delete_confirm.title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('delete_confirm.content', { name: data.name }),\r\n    okText: secondsToGo + ' ' + t('delete_confirm.confirm_btn'),\r\n    okType: 'danger',\r\n    okButtonProps: {\r\n      disabled: true\r\n    },\r\n    cancelText: t('delete_confirm.cancel_btn'),\r\n    onOk() {\r\n      onDelete(data)\r\n    },\r\n    onCancel() {}\r\n  })\r\n\r\n  let interval = setInterval(() => {\r\n    if (secondsToGo == 1) {\r\n      modal.update({\r\n        okText: t('delete_confirm.confirm_btn'),\r\n        okButtonProps: {\r\n          disabled: false\r\n        }\r\n      })\r\n\r\n      clearInterval(interval)\r\n      interval = undefined\r\n    } else {\r\n      secondsToGo -= 1\r\n\r\n      modal.update({\r\n        okText: secondsToGo + ' ' + t('delete_confirm.confirm_btn'),\r\n        okButtonProps: {\r\n          disabled: true\r\n        }\r\n      })\r\n    }\r\n  }, 1000)\r\n}\r\n\r\nconst onDelete = ({ id }) => {\r\n  delForm({ id }).then(() => {\r\n    message.success(t('message.delete_success'))\r\n    getList()\r\n  })\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.library-page {\r\n  .list-toolbar {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  .list-total {\r\n    line-height: 24px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #262626;\r\n  }\r\n  .list-box {\r\n    display: flex;\r\n    flex-flow: row wrap;\r\n    margin: 0 -8px;\r\n  }\r\n  .list-item-wrapper {\r\n    padding: 8px;\r\n    width: 25%;\r\n  }\r\n  .list-item {\r\n    position: relative;\r\n    width: 100%;\r\n    padding: 24px;\r\n    border: 1px solid #e4e6eb;\r\n    border-radius: 12px;\r\n    background-color: #fff;\r\n    transition: all 0.25s;\r\n    cursor: pointer;\r\n\r\n    &:hover {\r\n      box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.12);\r\n    }\r\n\r\n    .library-info {\r\n      position: relative;\r\n      display: flex;\r\n      align-items: center;\r\n      .item-action {\r\n        .menu-btn {\r\n          position: absolute;\r\n          right: 0;\r\n          top: 0;\r\n          width: 22px;\r\n          height: 22px;\r\n          text-align: center;\r\n          line-height: 22px;\r\n          font-size: 16px;\r\n          cursor: pointer;\r\n          &:hover {\r\n            color: #2475fc;\r\n          }\r\n        }\r\n      }\r\n      .library-icon {\r\n        width: 52px;\r\n        height: 52px;\r\n        border-radius: 14px;\r\n        overflow: hidden;\r\n      }\r\n      .library-info-content {\r\n        margin-left: 12px;\r\n        flex: 1;\r\n        overflow: hidden;\r\n      }\r\n      .library-title {\r\n        height: 24px;\r\n        line-height: 24px;\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: #262626;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n    }\r\n    .item-body {\r\n      margin-top: 12px;\r\n    }\r\n    .library-desc {\r\n      height: 44px;\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: rgb(89, 89, 89);\r\n      // 超出2行显示省略号\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      display: -webkit-box;\r\n      -webkit-line-clamp: 2;\r\n      line-clamp: 2;\r\n      -webkit-box-orient: vertical;\r\n    }\r\n\r\n    .item-footer {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      margin-top: 14px;\r\n      color: #7a8699;\r\n    }\r\n    .library-size {\r\n      display: flex;\r\n      line-height: 20px;\r\n      font-size: 12px;\r\n      font-weight: 400;\r\n      color: #7a8699;\r\n\r\n      .text-item {\r\n        margin-right: 12px;\r\n        &:last-child {\r\n          margin-right: 0;\r\n        }\r\n      }\r\n    }\r\n\r\n    .action-box {\r\n      font-size: 14px;\r\n      height: 24px;\r\n      color: #2475fc;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      .action-item {\r\n        display: flex;\r\n        align-items: center;\r\n        height: 100%;\r\n        padding: 4px;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        color: #595959;\r\n        transition: all 0.2s;\r\n      }\r\n      .action-item:hover {\r\n        background: #e4e6eb;\r\n      }\r\n\r\n      .action-icon {\r\n        font-size: 16px;\r\n      }\r\n    }\r\n  }\r\n}\r\n// 大于1920px\r\n@media screen and (min-width: 1920px) {\r\n  .library-page {\r\n    .list-box {\r\n      .list-item-wrapper {\r\n        width: 20%;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["t","useI18n","useRouter","pageTabs","computed","permissionStore","usePermissionStore","role_permission","role_type","formCreate","list","ref","getList","getFormList","res","addDataSheetRef","toAdd","data","key","getDatabasePermission","message","toEdit","handleDelete","secondsToGo","modal","Modal","createVNode","ExclamationCircleOutlined","onDelete","interval","id","delForm","_createElementVNode","_hoisted_1","_createVNode","PageTabs","PageAlert","_unref","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","_createBlock","_component_a_button","PlusOutlined","_createTextVNode","_hoisted_7","_createElementBlock","_Fragment","_renderList","item","_withModifiers","$event","_hoisted_9","_imports_0","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_component_a_dropdown","_component_a_menu","_component_a_menu_item","_hoisted_18","_hoisted_19","_component_svg_icon","AddDataSheet"],"mappings":"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"}