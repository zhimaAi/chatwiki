import{_ as $e}from"./empty-CzGZrENG.js";import{b as ee,ay as Ie,d as re,bj as Ce,b6 as Pe,bk as te}from"../../index-OnalErht.js";import{Y as _,_ as i,a5 as t,f as x,r as Y,e as me,w as se,k as o,a2 as l,ad as N,G as d,ae as h,y as ce,F as S,a9 as J,a1 as F,a7 as $,n as ae,u as M,A as ue,J as pe,q as ze,a4 as oe}from"./vue-chunks-Ci-XTWEs.js";import{M as _e}from"./model-select-BWi4a3Y6.js";import{C as Se}from"./index-BbXKX7WL.js";import{M as Ue}from"./index-BMSQkwth.js";import{k as Le,O as ve,B as fe,M as ke,a as ge,F as ie,v as je,u as De,I as he,E as Ne,p as ye,ab as W,X as Fe,Q as be,R as Me,q as Oe,$ as Te,H as Ae,x as Ee,e as Ve,Y as Re,Z as Be}from"./ui-antd-BgeWxFcI.js";import{U as Qe}from"./index-DIhX1V7E.js";const Ge={},He={class:"empty-box"};function Ke(Q,L){return i(),_("div",He,L[0]||(L[0]=[t("img",{src:$e,alt:""},null,-1),t("div",{class:"title"},"暂无分段",-1),t("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)]))}const dn=ee(Ge,[["render",Ke],["__scopeId","data-v-5569d09d"]]),Je={class:"ai-generate-wrapper"},Xe={class:"ai-generate-wrapper-left"},Ye={class:"form-box-wrapper-options"},Ze={class:"form-item flex1"},We={class:"form-content"},et={class:"form-item flex1"},tt={class:"form-content dual-inputs"},st={class:"input-group"},nt={class:"form-label-input-box"},ot={class:"form-item generate-btn-box"},lt={class:"result-nav"},at={key:0,class:"tip"},it={key:1,class:"result-nav-text"},rt={key:0,class:"container"},dt={class:"result-container"},ut=["innerHTML"],_t={class:"result-footer"},mt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(Q,{expose:L,emit:E}){const p=Ie(),I=x(!1),c=x(!1),s=x(!1),u=x(!1),v=Y({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),X=new Ue({html:!0,linkify:!0,typographer:!0}),O=x(""),C=Y({content:""}),z=me(()=>p.initDocumentFragmentList);se(()=>C.content,()=>{O.value=X.render(C.content)});const j=E,G=x(""),D=["azure","ollama","xinference","openaiAgent"],m=x(!1),H=()=>{c.value=!1,u.value=!1,m.value=!0},b=()=>{ge.success("操作成功"),c.value=!1,u.value=!1,m.value=!1,j("handleEdit",w.value)},w=x("");function T(f,r){let a="",e=0;for(const q of f){if(e>=r)break;const k=q.content.trim()||"",g=r-e;if(k.length<=g)a+=k,e+=k.length;else{a+=k.slice(0,g),e=r;break}}return a}const K=async()=>{C.content="",w.value="",s.value=!0,u.value=!0;try{const f=await T(z.value,v.count);let r={ai_prompt_model_config_id:v.model_config_id,ai_prompt_model:v.use_model,ai_prompt_question:f};const a=await Ce(r);w.value=a.data,C.content=`<div class="dialog-message">${a.data}</div>`,c.value=!0}finally{s.value=!1}},V=f=>{v.use_model=D.includes(f.rawData.model_define)&&f.rawData.deployment_name?f.rawData.deployment_name:f.rawData.name,v.use_model_icon=f.icon,v.use_model_name=f.use_model_name,v.model_config_id=f.rawData.id,G.value=f.rawData.model_define},P=x([]),R=f=>{P.value=f,ce(()=>{(!v.ai_chunk_model||!Number(v.ai_chunk_model_config_id))&&y()})},y=()=>{if(P.value.length>0){let f=null,r=null;for(let a of P.value)if(a.model_define==="tongyi"){f=a;for(let e of f.children)if(e.name==="qwen-max"){r=e;break}break}f||(f=P.value[0],r=f.children[0]),f&&r&&(v.use_model=r.name,v.model_config_id=r.model_config_id,v.ai_chunk_model=r.name,v.ai_chunk_model_config_id=r.model_config_id)}};return L({showModal:H}),(f,r)=>{const a=Le,e=ve,q=re,k=fe,g=ke;return i(),_("div",null,[o(g,{open:m.value,"onUpdate:open":r[2]||(r[2]=U=>m.value=U),onOk:b,maskClosable:!1,width:u.value?"944px":"472px","ok-button-props":{style:{display:"none"}}},{title:l(()=>r[3]||(r[3]=[t("div",{class:"custom-modal-header"},[t("span",null,"AI生成提示词")],-1)])),footer:l(()=>r[10]||(r[10]=[])),default:l(()=>[t("div",Je,[t("div",{class:N(["form-box-wrapper ai-generate-wrapper-box",{"show-generate":u.value}])},[t("div",Xe,[o(a,{class:"alert-box",message:"根据导入的文档的内容生成AI分段的提示词，支持设置导入文档的字数。",type:"info"}),t("div",Ye,[t("div",Ze,[r[4]||(r[4]=t("div",{class:"form-label required"},"选择模型：",-1)),t("div",We,[o(Se,{modelValue:v.use_model,"onUpdate:modelValue":r[0]||(r[0]=U=>v.use_model=U),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":v.model_config_id,onChange:V,onLoaded:R},null,8,["modelValue","model-config-id"])])]),t("div",et,[t("div",tt,[t("div",st,[r[6]||(r[6]=t("div",{class:"form-label required"},"根据文档内容前：",-1)),t("div",nt,[o(e,{value:v.count,"onUpdate:value":r[1]||(r[1]=U=>v.count=U),min:1,max:1e4,style:{width:"137px"}},null,8,["value"]),r[5]||(r[5]=d("个字，自动生成提示词 "))])])])])]),t("div",ot,[o(k,{onClick:K,loading:s.value,class:"generate-btn"},{default:l(()=>[o(q,{name:"ai-generate-white",style:{"font-size":"16px"}}),r[7]||(r[7]=d(" 开始生成 "))]),_:1,__:[7]},8,["loading"])])]),t("div",{class:N(["ai-generate-wrapper-right",{"show-result":u.value}])},[t("div",lt,[o(q,{name:"generate-icon",style:{"font-size":"14px"}}),s.value?(i(),_("span",at,"提示词生成中...")):(i(),_("div",it,"提示词生成完毕"))]),!C.content&&s.value&&!I.value?(i(),_("div",rt,r[8]||(r[8]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)]))):h("",!0),t("div",dt,[t("div",{class:"dialog-content",innerHTML:O.value},null,8,ut)]),t("div",_t,[o(k,{class:"result-footer-btn",disabled:w.value=="",type:"primary",onClick:b},{default:l(()=>r[9]||(r[9]=[d("使用该提示词")])),_:1,__:[9]},8,["disabled"])])],2)],2)])]),_:1},8,["open","width"])])}}},ct=ee(mt,[["__scopeId","data-v-dea4b79a"]]),pt={class:"segmentation-setting"},vt={class:"setting-items"},ft={class:"setting-item intelligent-setting active"},kt={class:"setting-item-body"},gt={key:0,class:"custom-setting-form excel-qa-form"},ht={class:"form-item"},yt={class:"form-item-box"},bt={class:"form-item-body"},xt={class:"form-item-box"},wt={class:"form-item-body"},qt={class:"form-item-box"},$t={class:"form-item-body"},It={class:"indexing-methods-box"},Ct={class:"list-title-block"},Pt={class:"list-title-block"},zt={class:"btn-box-block"},St={key:1,class:"custom-setting-form excel-qa-form"},Ut={class:"form-item"},Lt={class:"form-item-box"},jt={class:"form-item-body"},Dt={class:"form-item-box"},Nt={class:"form-item-body"},Ft={class:"form-item-box"},Mt={class:"form-item-body"},Ot={class:"indexing-methods-box"},Tt={class:"list-title-block"},At={class:"list-title-block"},Et={class:"btn-box-block"},Vt={key:0,class:"custom-setting-form subsection-form"},Rt={class:"form-item"},Bt={key:0,class:"form-item-title"},Qt={class:"form-item-body"},Gt={class:"select-card-box"},Ht={class:"card-title"},Kt={class:"card-title"},Jt={class:"card-title"},Xt={class:"card-title"},Yt={class:"form-item",style:{"margin-bottom":"18px"}},Zt={class:"form-item-body"},Wt={class:"form-item"},es={class:"form-item-body"},ts={class:"form-item"},ss={class:"form-item-body"},ns={class:"form-item"},os={class:"form-item-body"},ls={class:"form-item",style:{"margin-bottom":"16px"}},as={class:"form-item-body"},is={class:"form-item",style:{"margin-bottom":"16px"}},rs={class:"form-item-label"},ds={class:"form-item-body"},us={class:"form-item"},_s={class:"form-item-body"},ms={class:"form-item"},cs={class:"form-item-body"},ps={class:"form-item",style:{"margin-bottom":"16px"}},vs={class:"form-item-body"},fs={class:"form-item",style:{"margin-bottom":"16px"}},ks={class:"form-item-body"},gs={class:"form-item",style:{"margin-bottom":"16px"}},hs={class:"form-item-label"},ys={class:"form-item-body form-item-inptu-numbner-box"},bs={class:"form-item"},xs={class:"form-item-body"},ws={key:0,class:"form-item"},qs={class:"form-item-body"},$s={key:1,class:"form-item"},Is={class:"form-item-body"},Cs={class:"form-item"},Ps={class:"form-item-body"},zs={class:"form-item"},Ss={class:"form-item-body"},Us={class:"btn-box-block"},Ls={class:"btn-box-block"},le="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",js={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1},status:{type:String,default:""}},emits:["change","validate","save","changeChunkType"],setup(Q,{expose:L,emit:E}){const p=ie.useForm,I=E,c=Q;me(()=>c.libFileInfo.doc_type=="1"&&(c.libFileInfo.file_ext=="docx"||c.libFileInfo.file_ext=="html")),se(c,a=>{let e=a.libFileInfo;s.separators_no=te(e.separators_no,[12,11]),s.chunk_size=+e.chunk_size||512,s.not_merged_text=e.not_merged_text=="true",s.ai_chunk_size=+e.ai_chunk_size||5e3,s.chunk_overlap=+e.chunk_overlap||50,s.question_lable=e.question_lable,s.similar_label=e.similar_label,s.answer_lable=e.answer_lable,s.question_column=e.question_column||void 0,s.answer_column=e.answer_column||void 0,s.similar_column=e.similar_column||void 0,s.qa_index_type=+e.qa_index_type,s.enable_extract_image=e.enable_extract_image=="true",s.chunk_type=+e.chunk_type,s.semantic_chunk_size=+e.semantic_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_threshold||90,s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.ai_chunk_prumpt=e.ai_chunk_prumpt||le,s.ai_chunk_model=e.ai_chunk_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:"",s.ai_chunk_model_config_id=e.ai_chunk_model_config_id>0?e.ai_chunk_model_config_id:"",s.father_chunk_paragraph_type=+e.father_chunk_paragraph_type||2,s.father_chunk_separators_no=te(e.father_chunk_separators_no,[12,11]),s.father_chunk_chunk_size=+e.father_chunk_chunk_size||1024,s.son_chunk_separators_no=te(e.son_chunk_separators_no,[8,10]),s.son_chunk_chunk_size=+e.son_chunk_chunk_size||512,setTimeout(()=>{s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:""},200),e.chunk_type==0&&(s.separators_no=te(e.normal_chunk_default_separators_no,[12,11]),s.chunk_size=+e.normal_chunk_default_chunk_size||512,s.not_merged_text=e.normal_chunk_default_not_merged_text=="true",s.chunk_overlap=+e.normal_chunk_default_chunk_overlap||50,s.chunk_type=+e.default_chunk_type,s.semantic_chunk_size=+e.semantic_chunk_default_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_default_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_default_threshold||90,setTimeout(()=>{s.semantic_chunk_use_model=e.default_use_model,s.semantic_chunk_model_config_id=e.default_model_config_id>0?e.default_model_config_id:""},100)),s.is_qa_doc=c.library_type==2?1:0});const s=Y({separators_no:[],not_merged_text:!1,chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:le,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512});let u={};setTimeout(()=>{u=JSON.parse(JSON.stringify(s))},500);const v=x([]),X=x(null),O=a=>{v.value=a,ce(()=>{(!s.ai_chunk_model||!Number(s.ai_chunk_model_config_id))&&C()})},C=()=>{if(v.value.length>0){let a=null,e=null;for(let q of v.value)if(q.model_define==="tongyi"){a=q;for(let k of a.children)if(k.name==="qwen-max"){e=k;break}break}a||(a=v.value[0],e=a.children[0]),a&&e&&(s.ai_chunk_model=e.name,s.ai_chunk_model_config_id=e.model_config_id)}},z=()=>{Object.assign(s,u)},j=()=>{I("save")},G=Y({question_lable:[{message:"请输入问题开始标识符",validator:async(a,e)=>s.is_qa_doc==1&&c.mode==0?e?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(a,e)=>s.is_qa_doc==0&&s.chunk_type==2?e?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],ai_chunk_model_config_id:[{message:"请选择AI大模型",validator:async(a,e)=>s.is_qa_doc==0&&s.chunk_type==3?e?Promise.resolve():Promise.reject("请选择AI大模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(a,e)=>s.is_qa_doc==1&&c.mode==0?e?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(a,e)=>c.mode!=1&&s.is_qa_doc==0&&e.length==0&&s.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(a,e)=>{if(c.mode!=1&&s.chunk_type==1)if(e){if(e>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");else if(s.chunk_type==3&&!e)return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],ai_chunk_size:[{validator:async(a,e)=>s.chunk_type==3&&!e?Promise.reject("请输入分段最大长度"):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(a,e)=>!s.ai_chunk_prumpt&&!e?Promise.reject("请输入提示词"):Promise.resolve()}],chunk_overlap:[{validator:async(a,e)=>c.mode!=1&&s.chunk_type==1&&e>parseInt(s.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(a,e)=>c.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(a,e)=>c.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:D,validate:m,validateInfos:H}=p(s,G),b=x(!1),w=x(!1),T=()=>{b.value=!0,s.chunk_type!=3&&(w.value=!0),K()},K=(a=!0)=>{let e=pe(s);m().then(()=>{I("change",{...e}),I("validate","")}).catch(q=>{const{errorFields:k}=q;if(k.length>0){a&&k[0].name,ge.error(k[0].errors[0]),I("validate",k[0].errors[0]),b.value=!1,w.value=!1;return}I("validate",""),I("change",{...e})})};let V=null;const P=()=>{V&&(clearTimeout(V),V=null),V=setTimeout(()=>{K()},500)},R=x([]);(()=>{Pe().then(a=>{R.value=a.data||[]})})();const f=a=>{a!=s.qa_index_type&&(s.qa_index_type=a,K())},r=a=>{s.ai_chunk_prumpt=a};return se(()=>s.chunk_type,a=>{I("changeChunkType",a)}),se(()=>b.value,a=>{}),L({formState:s,reLoading:b,saveLoading:w,reChange:T}),(a,e)=>{const q=je,k=De,g=re,U=fe,ne=he,B=ve,A=Ne,Z=ye,xe=Fe,we=be,de=Me,qe=Oe;return i(),_("div",pt,[t("div",vt,[t("div",ft,[t("div",kt,[h("",!0),s.is_qa_doc==1?(i(),_(S,{key:1},[e[54]||(e[54]=t("div",{class:"sub-setting-item-name"},"文件切分",-1)),c.mode==1?(i(),_("div",gt,[t("div",ht,[t("div",yt,[e[34]||(e[34]=t("div",{class:"form-item-label"},"问题所在列：",-1)),t("div",bt,[o(k,{value:s.question_column,"onUpdate:value":e[2]||(e[2]=n=>s.question_column=n),onChange:P,placeholder:"请选择列名",style:{width:"100%"}},{default:l(()=>[(i(!0),_(S,null,J(c.excellQaLists,n=>(i(),F(q,{value:n.value,key:n.value},{default:l(()=>[d($(n.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",xt,[e[35]||(e[35]=t("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),t("div",wt,[o(k,{allowClear:"",value:s.similar_column,"onUpdate:value":e[3]||(e[3]=n=>s.similar_column=n),onChange:P,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:l(()=>[(i(!0),_(S,null,J(c.excellQaLists,n=>(i(),F(q,{value:n.value,key:n.value},{default:l(()=>[d($(n.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",qt,[e[36]||(e[36]=t("div",{class:"form-item-label"},"答案所在列：",-1)),t("div",$t,[o(k,{value:s.answer_column,"onUpdate:value":e[4]||(e[4]=n=>s.answer_column=n),onChange:P,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:l(()=>[(i(!0),_(S,null,J(c.excellQaLists,n=>(i(),F(q,{value:n.value,key:n.value},{default:l(()=>[d($(n.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),e[43]||(e[43]=t("div",{class:"sub-setting-item-name"},"索引方式",-1)),t("div",It,[t("div",{class:N(["list-item",{active:s.qa_index_type==1}]),onClick:e[5]||(e[5]=n=>f(1))},[o(g,{class:"check-icon",name:"check-arrow-filled"}),t("div",Ct,[o(g,{name:"file-search"}),e[37]||(e[37]=d(" 问题与答案一起生成索引 "))]),e[38]||(e[38]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),t("div",{class:N(["list-item",{active:s.qa_index_type==2}]),onClick:e[6]||(e[6]=n=>f(2))},[o(g,{class:"check-icon",name:"check-arrow-filled"}),t("div",Pt,[o(g,{name:"comment-search"}),e[39]||(e[39]=d(" 仅对问题生成索引 "))]),e[40]||(e[40]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2),e[42]||(e[42]=t("div",{class:"btn-box-block"},null,-1)),t("div",zt,[o(U,{type:"primary",block:"",onClick:j},{default:l(()=>e[41]||(e[41]=[d("保存")])),_:1,__:[41]})])])])):(i(),_("div",St,[t("div",Ut,[t("div",Lt,[e[44]||(e[44]=t("div",{class:"form-item-label"},"问题开始标识符：",-1)),t("div",jt,[o(ne,{placeholder:"请输入标识符",value:s.question_lable,"onUpdate:value":e[7]||(e[7]=n=>s.question_lable=n),onChange:P},null,8,["value"])])]),t("div",Dt,[e[45]||(e[45]=t("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),t("div",Nt,[o(ne,{placeholder:"请输入标识符",value:s.similar_label,"onUpdate:value":e[8]||(e[8]=n=>s.similar_label=n),onChange:P},null,8,["value"])])]),t("div",Ft,[e[46]||(e[46]=t("div",{class:"form-item-label"},"答案开始标识符：",-1)),t("div",Mt,[o(ne,{placeholder:"请输入标识符",value:s.answer_lable,"onUpdate:value":e[9]||(e[9]=n=>s.answer_lable=n),onChange:P},null,8,["value"])])])]),e[53]||(e[53]=t("div",{class:"sub-setting-item-name"},"索引方式",-1)),t("div",Ot,[t("div",{class:N(["list-item",{active:s.qa_index_type==1}]),onClick:e[10]||(e[10]=n=>f(1))},[o(g,{class:"check-icon",name:"check-arrow-filled"}),t("div",Tt,[o(g,{name:"file-search"}),e[47]||(e[47]=d(" 问题与答案一起生成索引 "))]),e[48]||(e[48]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),t("div",{class:N(["list-item",{active:s.qa_index_type==2}]),onClick:e[11]||(e[11]=n=>f(2))},[o(g,{class:"check-icon",name:"check-arrow-filled"}),t("div",At,[o(g,{name:"comment-search"}),e[49]||(e[49]=d(" 仅对问题生成索引 "))]),e[50]||(e[50]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2),e[52]||(e[52]=t("div",{class:"btn-box-block"},null,-1)),t("div",Et,[o(U,{type:"primary",block:"",onClick:j},{default:l(()=>e[51]||(e[51]=[d("保存")])),_:1,__:[51]})])])]))],64)):(i(),_(S,{key:2},[c.mode!=1?(i(),_("div",Vt,[t("div",Rt,[Q.status==="paragraphsSegmented"?(i(),_("div",Bt,"分段及清洗规则")):h("",!0),e[64]||(e[64]=t("div",{class:"form-item-label"},"分段方式：",-1)),t("div",Qt,[e[63]||(e[63]=t("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),t("div",Gt,[t("div",{class:N(["select-card-item",{active:s.chunk_type==1}]),onClick:e[12]||(e[12]=n=>s.chunk_type=1)},[o(g,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Ht,[o(g,{name:"ordinary-segmentation",class:"title-icon"}),e[55]||(e[55]=d(" 普通分段 "))]),e[56]||(e[56]=t("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),t("div",{class:N(["select-card-item",{active:s.chunk_type==2}]),onClick:e[13]||(e[13]=n=>s.chunk_type=2)},[o(g,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Kt,[o(g,{name:"semantic-segmentation",class:"title-icon"}),e[57]||(e[57]=d(" 语义分段 "))]),e[58]||(e[58]=t("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),c.library_type==0?(i(),_("div",{key:0,class:N(["select-card-item",{active:s.chunk_type==4}]),onClick:e[14]||(e[14]=n=>s.chunk_type=4)},[o(g,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Jt,[o(g,{name:"semantic-segmentation",class:"title-icon"}),e[59]||(e[59]=d(" 父子分段 "))]),e[60]||(e[60]=t("div",{class:"card-desc"}," 基于文章中句号等符号进行分段，不会消耗模型token。父分段会拆分为若干子分段，子块用于检索，父块用作上下文 ",-1))],2)):h("",!0),t("div",{class:N(["select-card-item",{active:s.chunk_type==3}]),onClick:e[15]||(e[15]=n=>s.chunk_type=3)},[o(g,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Xt,[o(g,{name:"semantic-segmentation",class:"title-icon"}),e[61]||(e[61]=d(" AI分段 "))]),e[62]||(e[62]=t("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])])]),s.chunk_type==1?(i(),_(S,{key:0},[t("div",Yt,[e[65]||(e[65]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",Zt,[o(k,{placeholder:"请选择",style:{width:"100%"},mode:"tags",value:s.separators_no,"onUpdate:value":e[16]||(e[16]=n=>s.separators_no=n)},{default:l(()=>[(i(!0),_(S,null,J(R.value,n=>(i(),F(q,{value:n.no,key:n.no},{default:l(()=>[d($(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),o(A,{gap:16},{default:l(()=>[t("div",Wt,[e[67]||(e[67]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",es,[o(A,{align:"center",gap:8},{default:l(()=>[o(B,{style:{flex:"1"},value:s.chunk_size,"onUpdate:value":e[17]||(e[17]=n=>s.chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[66]||(e[66]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[66]})])]),t("div",ts,[e[69]||(e[69]=t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),t("div",ss,[o(A,{align:"center",gap:8},{default:l(()=>[o(B,{style:{flex:"1"},value:s.chunk_overlap,"onUpdate:value":e[18]||(e[18]=n=>s.chunk_overlap=n),placeholder:"分段重叠长度",min:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[68]||(e[68]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[68]})])])]),_:1}),t("div",ns,[t("div",os,[o(A,{align:"center"},{default:l(()=>[t("div",null,[e[70]||(e[70]=d("自动合并较小分段 ")),o(Z,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:l(()=>[o(M(W))]),_:1}),e[71]||(e[71]=d(" ："))]),o(xe,{checkedValue:!1,unCheckedValue:!0,checked:s.not_merged_text,"onUpdate:checked":e[19]||(e[19]=n=>s.not_merged_text=n),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})])])],64)):h("",!0),ae(t("div",null,[t("div",ls,[e[72]||(e[72]=t("div",{class:"form-item-label"},"嵌入模型：",-1)),t("div",as,[o(_e,{modelType:"TEXT EMBEDDING",modeName:s.semantic_chunk_use_model,"onUpdate:modeName":e[20]||(e[20]=n=>s.semantic_chunk_use_model=n),modeId:s.semantic_chunk_model_config_id,"onUpdate:modeId":e[21]||(e[21]=n=>s.semantic_chunk_model_config_id=n),style:{width:"100%"},onLoaded:O},null,8,["modeName","modeId"])])]),t("div",is,[t("div",rs,[e[74]||(e[74]=d(" 分段阈值 ")),o(Z,null,{title:l(()=>e[73]||(e[73]=[d("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")])),default:l(()=>[o(M(W),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),e[75]||(e[75]=d("： "))]),t("div",ds,[o(B,{style:{width:"100%"},value:s.semantic_chunk_threshold,"onUpdate:value":e[22]||(e[22]=n=>s.semantic_chunk_threshold=n),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),o(A,{gap:16},{default:l(()=>[t("div",us,[e[77]||(e[77]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",_s,[o(A,{align:"center",gap:8},{default:l(()=>[o(B,{style:{flex:"1"},value:s.semantic_chunk_size,"onUpdate:value":e[23]||(e[23]=n=>s.semantic_chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[76]||(e[76]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[76]})])]),t("div",ms,[e[79]||(e[79]=t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),t("div",cs,[o(A,{align:"center",gap:8},{default:l(()=>[o(B,{style:{flex:"1"},value:s.semantic_chunk_overlap,"onUpdate:value":e[24]||(e[24]=n=>s.semantic_chunk_overlap=n),placeholder:"分段重叠长度",min:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[78]||(e[78]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[78]})])])]),_:1})],512),[[ue,s.chunk_type==2]]),ae(t("div",null,[t("div",ps,[e[80]||(e[80]=t("div",{class:"form-item-label"},"AI大模型：",-1)),t("div",vs,[o(_e,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:s.ai_chunk_model,"onUpdate:modeName":e[25]||(e[25]=n=>s.ai_chunk_model=n),modeId:s.ai_chunk_model_config_id,"onUpdate:modeId":e[26]||(e[26]=n=>s.ai_chunk_model_config_id=n),style:{width:"100%"},onLoaded:O},null,8,["modeName","modeId"])])]),t("div",fs,[e[81]||(e[81]=t("div",{class:"form-item-label-box"},[t("div",{class:"form-item-label"},"提示词设置：")],-1)),t("div",ks,[o(we,{maxLength:500,style:{height:"80px"},value:s.ai_chunk_prumpt,"onUpdate:value":e[27]||(e[27]=n=>s.ai_chunk_prumpt=n),placeholder:le},null,8,["value"])])]),t("div",gs,[t("div",hs,[e[83]||(e[83]=d(" 单次最大字符数 ")),o(Z,null,{title:l(()=>e[82]||(e[82]=[d("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")])),default:l(()=>[o(M(W),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),e[84]||(e[84]=d("： "))]),t("div",ys,[o(B,{class:"form-item-inptu-numbner",value:s.ai_chunk_size,"onUpdate:value":e[28]||(e[28]=n=>s.ai_chunk_size=n),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[85]||(e[85]=d(" 字符 "))])])],512),[[ue,s.chunk_type==3]]),s.chunk_type==4&&c.library_type==0?(i(),_(S,{key:1},[e[95]||(e[95]=t("div",{class:"main-title-block"},"父块（用作上下文）",-1)),t("div",bs,[e[88]||(e[88]=t("div",{class:"form-item-label"},"分段类型：",-1)),t("div",xs,[o(qe,{value:s.father_chunk_paragraph_type,"onUpdate:value":e[29]||(e[29]=n=>s.father_chunk_paragraph_type=n)},{default:l(()=>[o(de,{value:1},{default:l(()=>[e[86]||(e[86]=d("全文 ")),o(Z,{title:"整个文档用作父块并直接检索。请注意，出于性能原因，超过 10000 个标记的文本将被自动截断。"},{default:l(()=>[o(M(W))]),_:1})]),_:1,__:[86]}),o(de,{value:2},{default:l(()=>[e[87]||(e[87]=d("段落 ")),o(Z,{title:"此模式根据分隔符和最大块长度将文本拆分为段落，使用拆分文本作为检索的父块"},{default:l(()=>[o(M(W))]),_:1})]),_:1,__:[87]})]),_:1},8,["value"])])]),s.father_chunk_paragraph_type==2?(i(),_("div",ws,[e[89]||(e[89]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",qs,[o(k,{placeholder:"请选择",style:{width:"100%"},mode:"tags",value:s.father_chunk_separators_no,"onUpdate:value":e[30]||(e[30]=n=>s.father_chunk_separators_no=n)},{default:l(()=>[(i(!0),_(S,null,J(R.value,n=>(i(),F(q,{value:n.no,key:n.no},{default:l(()=>[d($(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])):h("",!0),s.father_chunk_paragraph_type==2?(i(),_("div",$s,[e[91]||(e[91]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",Is,[o(A,{align:"center",gap:8},{default:l(()=>[o(B,{style:{flex:"1"},value:s.father_chunk_chunk_size,"onUpdate:value":e[31]||(e[31]=n=>s.father_chunk_chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[90]||(e[90]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[90]})])])):h("",!0),e[96]||(e[96]=t("div",{class:"main-title-block"},"子块（用于检索）",-1)),t("div",Cs,[e[92]||(e[92]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",Ps,[o(k,{placeholder:"请选择",style:{width:"100%"},mode:"tags",value:s.son_chunk_separators_no,"onUpdate:value":e[32]||(e[32]=n=>s.son_chunk_separators_no=n)},{default:l(()=>[(i(!0),_(S,null,J(R.value,n=>(i(),F(q,{value:n.no,key:n.no},{default:l(()=>[d($(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",zs,[e[94]||(e[94]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",Ss,[o(A,{align:"center",gap:8},{default:l(()=>[o(B,{style:{flex:"1"},value:s.son_chunk_chunk_size,"onUpdate:value":e[33]||(e[33]=n=>s.son_chunk_chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[93]||(e[93]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[93]})])])],64)):h("",!0),t("div",Us,[o(U,{onClick:z,style:{flex:"1"}},{default:l(()=>e[97]||(e[97]=[d("重置")])),_:1,__:[97]}),o(U,{onClick:T,loading:b.value,style:{flex:"1"},type:"primary",ghost:""},{default:l(()=>e[98]||(e[98]=[d("生成分段预览")])),_:1,__:[98]},8,["loading"])]),t("div",Ls,[c.hideSave?h("",!0):(i(),F(U,{key:0,type:"primary",block:"",disabled:w.value,onClick:j},{default:l(()=>e[99]||(e[99]=[d("保存")])),_:1,__:[99]},8,["disabled"]))])])):h("",!0)],64))])])]),o(ct,{ref_key:"aiGenerateRef",ref:X,onHandleEdit:r},null,512)])}}},un=ee(js,[["__scopeId","data-v-0bcd9342"]]),Ds={class:"document-fragment"},Ns={class:"fragment-header"},Fs={class:"fragment-info"},Ms={class:"fragment-number"},Os={key:0},Ts={key:0,class:"fragment-title"},As={class:"fragment-content-lenght"},Es={key:1,class:"fragment-content-status"},Vs={class:"cfb363f"},Rs={class:"fragment-action"},Bs={class:"fragment-content"},Qs={key:0,class:"fragment-content"},Gs={key:1,class:"fragment-content"},Hs={key:2,class:"fragment-content"},Ks={class:"fragment-img"},Js=["src"],Xs={__name:"document-fragment",props:{number:{type:[Number,String]},father_chunk_paragraph_number:{type:[Number,String]},chunk_type:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]},status:{type:String,default:""},currentData:{type:Object,default:()=>{}}},emits:["edit","delete"],setup(Q,{emit:L}){const E=L,p=Q,I=()=>{E("edit")},c=()=>{E("delete")};return(s,u)=>{var C,z,j;const v=ye,X=Ee,O=ze("viewer");return i(),_("div",Ds,[t("div",Ns,[t("div",Fs,[t("span",Ms,[u[0]||(u[0]=d("#")),p.chunk_type==4?(i(),_("span",Os,$(p.father_chunk_paragraph_number)+"-",1)):h("",!0),d($(p.number),1)]),p.title?(i(),_("span",Ts,$(p.title),1)):h("",!0),t("span",As,"共"+$(p.total)+"个字符",1),p.status==="paragraphsSegmented"?(i(),_("span",Es,[d($(((C=p.currentData)==null?void 0:C.status_text)||"-"),1),((z=p.currentData)==null?void 0:z.status)==3?(i(),F(M(Te),{key:0})):h("",!0),((j=p.currentData)==null?void 0:j.status)==2&&p.currentData.errmsg?(i(),F(v,{key:1,title:p.currentData.errmsg},{default:l(()=>[t("strong",Vs,[u[1]||(u[1]=d("原因")),o(M(Ae),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):h("",!0)])):h("",!0)]),t("div",Rs,[t("a",{onClick:I},"编辑"),o(X,{type:"vertical"}),t("a",{onClick:c},"删除")])]),t("div",Bs,$(p.content),1),p.question?(i(),_("div",Qs,"Q："+$(p.question),1)):h("",!0),p.similar_question_list&&p.similar_question_list.join("")?(i(),_("div",Gs," 相似问法："+$(p.similar_question_list.join("/")),1)):h("",!0),p.answer?(i(),_("div",Hs,"A："+$(p.answer),1)):h("",!0),ae((i(),_("div",Ks,[(i(!0),_(S,null,J(p.images,(G,D)=>(i(),_("img",{key:D,src:G,alt:""},null,8,Js))),128))])),[[O]])])}}},_n=ee(Xs,[["__scopeId","data-v-214ada31"]]),Ys={class:"upload-box-wrapper"},Zs={key:0},Ws={__name:"edit-fragment-alert",emits:["ok"],setup(Q,{expose:L,emit:E}){const p=E,I=x("1"),c=ie.useForm,s=x(!1),u=Y({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),v=Y({content:[{message:"请输入分段内容",validator:async(D,m)=>z.value||m?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(D,m)=>z.value?m?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(D,m)=>z.value?m?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:X,validate:O,validateInfos:C}=c(u,v),z=x(!1),j=({title:D,content:m,question:H,answer:b,images:w,similar_question_list:T})=>{u.title=D,u.content=m,u.question=H,u.answer=b,u.images=w||[],u.similar_question_list=T?T.join(`
`):"",z.value=H!="",s.value=!0},G=()=>{O().then(()=>{s.value=!1,p("ok",pe(u))})};return L({open:j}),(D,m)=>{const H=he,b=Ve,w=be,T=re,K=Be,V=Re,P=ie,R=ke;return i(),_("div",null,[o(R,{open:s.value,"onUpdate:open":m[7]||(m[7]=y=>s.value=y),title:"编辑分段",onOk:G,width:"746px"},{default:l(()=>[o(P,{layout:"vertical"},{default:l(()=>[o(b,{label:"分段标题："},{default:l(()=>[o(H,{type:"text",placeholder:"请输入分段标题",value:u.title,"onUpdate:value":m[0]||(m[0]=y=>u.title=y)},null,8,["value"])]),_:1}),z.value?(i(),_(S,{key:0},[o(b,oe({label:"分段问题："},M(C).question),{default:l(()=>[o(w,{placeholder:"请输入分段问题",value:u.question,"onUpdate:value":m[1]||(m[1]=y=>u.question=y),style:{height:"100px"}},null,8,["value"])]),_:1},16),o(b,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:l(()=>[o(w,{placeholder:"请输入相似问法",value:u.similar_question_list,"onUpdate:value":m[2]||(m[2]=y=>u.similar_question_list=y),style:{height:"100px"}},null,8,["value"])]),_:1}),o(b,oe({label:"分段答案："},M(C).answer),{default:l(()=>[o(w,{placeholder:"请输入分段答案",value:u.answer,"onUpdate:value":m[3]||(m[3]=y=>u.answer=y),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(i(),F(b,oe({key:1,label:"分段内容："},M(C).content),{default:l(()=>[o(w,{placeholder:"请输入分段内容",value:u.content,"onUpdate:value":m[4]||(m[4]=y=>u.content=y),style:{height:"150px"}},null,8,["value"])]),_:1},16)),o(b,{label:"附件"},{default:l(()=>[t("div",Ys,[o(V,{activeKey:I.value,"onUpdate:activeKey":m[5]||(m[5]=y=>I.value=y),size:"small"},{default:l(()=>[o(K,{key:"1"},{tab:l(()=>[t("span",null,[o(T,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),m[8]||(m[8]=d(" 图片 ")),u.images.length?(i(),_("span",Zs,"("+$(u.images.length)+")",1)):h("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(Qe,{value:u.images,"onUpdate:value":m[6]||(m[6]=y=>u.images=y)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},mn=ee(Ws,[["__scopeId","data-v-24be9e8e"]]);export{_n as D,mn as E,un as S,dn as a};
