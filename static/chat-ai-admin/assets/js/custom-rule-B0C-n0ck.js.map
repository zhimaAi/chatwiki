{"version":3,"file":"custom-rule-B0C-n0ck.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/explore/ai-comment-management/custom-rule.vue"],"sourcesContent":["<template>\r\n  <div class=\"custom-rule-page\">\r\n    <div class=\"toolbar\">\r\n      <a-button type=\"primary\" @click=\"goCreate\">{{ t('btn_add_rule') }}</a-button>\r\n      <a-input-search\r\n        v-model:value=\"searchKey\"\r\n        allowClear\r\n        :placeholder=\"t('search_rule_name_placeholder')\"\r\n        style=\"width: 300px\"\r\n        @search=\"search\"\r\n        @pressEnter=\"search\"\r\n      />\r\n    </div>\r\n\r\n    <div class=\"table-box\">\r\n      <a-table\r\n        :columns=\"columns\"\r\n        :data-source=\"ruleList\"\r\n        :loading=\"loading\"\r\n        row-key=\"id\"\r\n        :pagination=\"{ current: pager.page, pageSize: pager.size, total: pager.total, showSizeChanger: true, pageSizeOptions: ['10','20','50','100'] }\"\r\n        @change=\"onTableChange\"\r\n      >\r\n        <template #headerCell=\"{ column }\">\r\n          <span v-if=\"typeof column.title === 'string'\">{{ column.title }}</span>\r\n        </template>\r\n        <template #bodyCell=\"{ column, record }\">\r\n          <template v-if=\"column.key==='delete_comment_switch'\">\r\n            <a-switch :checked=\"Number(record.delete_comment_switch) === 1\" @change=\"(checked) => onToggle(record, 'delete_comment_switch', checked)\" />\r\n          </template>\r\n          <template v-else-if=\"column.key==='reply_comment_switch'\">\r\n            <a-switch :checked=\"Number(record.reply_comment_switch) === 1\" @change=\"(checked) => onToggle(record, 'reply_comment_switch', checked)\" />\r\n          </template>\r\n          <template v-else-if=\"column.key==='elect_comment_switch'\">\r\n            <a-switch :checked=\"Number(record.elect_comment_switch) === 1\" @change=\"(checked) => onToggle(record, 'elect_comment_switch', checked)\" />\r\n          </template>\r\n          <template v-else-if=\"column.key==='switch'\">\r\n            <a-switch :checked=\"Number(record.switch) === 1\" @change=\"(checked) => onToggle(record, 'switch', checked)\" />\r\n          </template>\r\n          <template v-else-if=\"column.key==='task_info'\">\r\n            <span v-if=\"(record.task_info || []).length === 0\">-</span>\r\n            <template v-else>\r\n              <span>{{ (record.task_info || []).slice(0, 2).map(it => it.task_name).join(', ') }}</span>\r\n              <a-popover v-if=\"(record.task_info || []).length > 2\" trigger=\"hover\" placement=\"top\">\r\n                <template #content>\r\n                  <div style=\"max-width: 360px; white-space: normal;\">\r\n                    {{ (record.task_info || []).map(it => it.task_name).join(', ') }}\r\n                  </div>\r\n                </template>\r\n                <a style=\"margin-left: 4px\">+{{ (record.task_info || []).length - 2 }}</a>\r\n              </a-popover>\r\n            </template>\r\n          </template>\r\n          <template v-else-if=\"column.key==='create_time'\">\r\n            <span>{{ formatDate(record.create_time) }}</span>\r\n          </template>\r\n          <template v-else-if=\"column.key==='actions'\">\r\n            <a-space>\r\n              <a @click=\"editRule(record)\">{{ t('action_edit') }}</a>\r\n              <span v-if=\"record.is_default == '1'\" class=\"actions-disabled\">{{ t('action_delete') }}</span>\r\n              <a v-else @click=\"delRule(record)\">{{ t('action_delete') }}</a>\r\n              <a @click=\"copyRule(record)\">{{ t('action_copy') }}</a>\r\n            </a-space>\r\n          </template>\r\n        </template>\r\n      </a-table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { createVNode, ref, reactive, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { message, Modal } from 'ant-design-vue'\r\nimport { ExclamationCircleOutlined } from '@ant-design/icons-vue'\r\nimport { getCommentRuleList, deleteCommentRule, changeCommentRuleStatus } from '@/api/robot'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst router = useRouter()\r\nconst { t } = useI18n('views.explore.ai-comment-management.custom-rule')\r\n\r\nconst searchKey = ref('')\r\nconst ruleList = ref([])\r\nconst loading = ref(false)\r\nconst pager = reactive({ page: 1, size: 10, total: 0 })\r\n\r\nconst columns = [\r\n  { title: t('column_rule_name'), dataIndex: 'rule_name', key: 'rule_name' },\r\n  { title: t('column_delete_comment'), dataIndex: 'delete_comment_switch', key: 'delete_comment_switch' },\r\n  { title: t('column_reply_comment'), dataIndex: 'reply_comment_switch', key: 'reply_comment_switch' },\r\n  { title: t('column_elect_comment'), dataIndex: 'elect_comment_switch', key: 'elect_comment_switch' },\r\n  { title: t('column_task_info'), dataIndex: 'task_info', key: 'task_info' },\r\n  { title: t('column_switch'), dataIndex: 'switch', key: 'switch' },\r\n  { title: t('column_create_time'), dataIndex: 'create_time', key: 'create_time' },\r\n  { title: t('column_actions'), dataIndex: 'actions', key: 'actions' },\r\n]\r\n\r\nconst loadList = () => {\r\n  loading.value = true\r\n  getCommentRuleList({ page: pager.page, size: pager.size, rule_name: searchKey.value, is_default: 0 }).then((res) => {\r\n    const data = res?.data || { list: [], total: 0 }\r\n    ruleList.value = data.list || []\r\n    pager.total = +data.total || 0\r\n  }).finally(() => { loading.value = false })\r\n}\r\n\r\nconst search = () => { pager.page = 1; loadList() }\r\nconst onTableChange = (pagination) => {\r\n  pager.page = pagination.current\r\n  pager.size = pagination.pageSize\r\n  loadList()\r\n}\r\n\r\nconst switchMap = {\r\n  delete_comment_switch: t('switch_delete_comment'),\r\n  reply_comment_switch: t('switch_reply_comment'),\r\n  elect_comment_switch: t('switch_elect_comment'),\r\n  switch: t('switch_rule_enable'),\r\n}\r\n\r\nconst onToggle = async (record, field, checked) => {\r\n  if (!checked) {\r\n    Modal.confirm({\r\n      title: t('confirm_modal_title'),\r\n      content: t('confirm_close_switch', { rule_name: record.rule_name, switch_name: switchMap[field] }),\r\n      icon: createVNode(ExclamationCircleOutlined),\r\n      onOk: async () => {\r\n        const val = checked ? 1 : 0\r\n        await changeCommentRuleStatus({ id: record.id, change_fields: field, switch_status: val })\r\n        record[field] = String(val)\r\n        message.success(t('message_operation_success'))\r\n      }\r\n    })\r\n    return\r\n  }\r\n  const val = checked ? 1 : 0\r\n  await changeCommentRuleStatus({ id: record.id, change_fields: field, switch_status: val })\r\n  record[field] = String(val)\r\n  message.success(t('message_operation_success'))\r\n}\r\n\r\nconst editRule = (record) => {\r\n  router.push({ path: '/explore/index/ai-comment-management/create-custom-rule', query: { id: record.id } })\r\n}\r\nconst copyRule = (record) => {\r\n  router.push({ path: '/explore/index/ai-comment-management/create-custom-rule', query: { id: record.id, copy: 1 } })\r\n}\r\nconst delRule = (record) => {\r\n  Modal.confirm({\r\n    title: t('confirm_delete_rule_title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    onOk: async () => {\r\n      await deleteCommentRule({ id: record.id })\r\n      message.success(t('message_delete_success'))\r\n      loadList()\r\n    },\r\n    content: t('confirm_delete_rule_content'),\r\n  })\r\n}\r\n\r\nconst goCreate = () => { router.push({ path: '/explore/index/ai-comment-management/create-custom-rule' }) }\r\n\r\nconst formatDate = (ts) => {\r\n  try {\r\n    const d = new Date(Number(ts) * 1000)\r\n    const y = d.getFullYear()\r\n    const m = String(d.getMonth() + 1).padStart(2, '0')\r\n    const dd = String(d.getDate()).padStart(2, '0')\r\n    return `${y}-${m}-${dd}`\r\n  } catch (e) { return '' }\r\n}\r\n\r\nonMounted(() => { loadList() })\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.custom-rule-page {\r\n  ::v-deep .ant-table-thead >tr>th {\r\n    color: #262626;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 22px;\r\n  }\r\n\r\n  ::v-deep .ant-table-row {\r\n    color: #595959;\r\n  }\r\n}\r\n.toolbar { display: flex; align-items: center; gap: 12px; }\r\n.table-box { margin-top: 16px; }\r\n.actions-disabled {\r\n  color: #8c8c8c;\r\n  cursor: not-allowed;\r\n}\r\n</style>\r\n"],"names":["router","useRouter","t","useI18n","searchKey","ref","ruleList","loading","pager","reactive","columns","loadList","getCommentRuleList","res","data","search","onTableChange","pagination","switchMap","onToggle","record","field","checked","Modal","createVNode","ExclamationCircleOutlined","val","changeCommentRuleStatus","message","editRule","copyRule","delRule","deleteCommentRule","goCreate","formatDate","ts","d","y","m","dd","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_a_button","_unref","_component_a_input_search","$event","_hoisted_3","_component_a_table","_withCtx","column","_hoisted_4","_toDisplayString","_createBlock","_component_a_switch","_Fragment","it","_component_a_popover","_hoisted_6","_hoisted_7","_hoisted_8","_component_a_space","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12"],"mappings":"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"}