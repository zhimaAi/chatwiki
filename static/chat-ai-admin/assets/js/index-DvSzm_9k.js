import{i as Q,L as U}from"./charts-9PO4lPBa.js";import{u as q,bg as rt,aA as it}from"../../index-DSFcP5NQ.js";import{d as z}from"./utils-CvB22N-W.js";import{T as ct,r as _t,P as dt,b as ut,u as X,v as Z,B as tt,J as et,ac as E,q as at,Z as pt,$ as ht}from"./ui-antd-Dl1wwwCD.js";import{r as M,E as L,j as P,w as O,a as I,b as v,p as t,y as l,t as i,F as V,l as j,u as a,e as W,_ as A,v as n,o as st,ah as ot,ag as yt,q as J}from"./vue-chunks-BdaA73Wf.js";import{_ as R}from"./emoji-mart-BBMRoEa3.js";import{u as mt}from"./chat-BLPxWtxf.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";import"./index-BuDcjXHQ.js";import"./index-Cg7-0swo.js";import"./useEventBus--I0IFnMo.js";import"./useIM-DZUieDUI.js";import"./index-B_UHbFfL.js";const ft={class:"zm-date"},bt={class:"date-btn"},vt={class:"date-content"},lt={__name:"date",props:{datekey:{type:String,default:"1"}},emits:["dateChange"],setup(T,{emit:u}){const{t:e}=q("views.robot.robot-config.statistical-analysis.components.date"),y=T,d=M(1),s=u;let b=L([{label:e("label_last_7_days"),value:!0,key:2,start_date:z().subtract(6,"day"),end_date:z().subtract(0,"day")},{label:e("label_last_14_days"),value:!1,key:3,start_date:z().subtract(13,"day"),end_date:z().subtract(0,"day")},{label:e("label_last_30_days"),value:!1,key:4,start_date:z().subtract(29,"day"),end_date:z().subtract(0,"day")}]);const p=M(null),r=M(null),c=M([]),k=g=>g>=z().subtract(0,"day"),S=()=>{let g=d.value,m=null;b.forEach($=>{$.key==g&&(m=$)}),c.value=[m.start_date,m.end_date],p.value=m.start_date.format("YYYY-MM-DD"),r.value=m.end_date.format("YYYY-MM-DD"),F()},B=(g,m)=>{const $=z(g[0]);z(g[1]).diff($,"days")>29?(c.value[0]=g[0],c.value[1]=$.add(29,"days"),p.value=c.value[0].format("YYYY-MM-DD"),r.value=c.value[1].format("YYYY-MM-DD"),ut.error(e("error_max_30_days"))):(c.value=g,p.value=m[0],r.value=m[1]),d.value=1,F()},F=()=>{s("dateChange",{start_date:p.value,end_date:r.value})};return P(()=>{d.value=parseInt(y.datekey),S()}),O(()=>y.datekey,(g,m)=>{d.value=parseInt(y.datekey.split("-")[0]),S()}),(g,m)=>{const $=ct,N=_t,h=dt;return v(),I("div",ft,[t("div",bt,[l(N,{value:d.value,"onUpdate:value":m[0]||(m[0]=o=>d.value=o),onChange:S},{default:i(()=>[(v(!0),I(V,null,j(a(b),o=>(v(),W($,{class:"date-btn-button",value:o.key,key:o.key},{default:i(()=>[A(n(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),t("div",vt,[l(h,{value:c.value,"onUpdate:value":m[1]||(m[1]=o=>c.value=o),onChange:B,format:"YYYY-MM-DD",disabledDate:k,allowClear:!1},null,8,["value"])])])}}},gt={class:"container-echart"},Dt=["id"],xt={__name:"echarts",props:{xDataArray:{type:Array,default:function(){return["12-01","11-29","12-02","12-03","12-04","12-05","12-06"]}},yDataArray:{type:Array,default:function(){return[{name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new U(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}]}}},setup(T){const u=T;let e;const y=M(Math.floor(new Date().getTime()*Math.random())),d=()=>{const s={title:{textStyle:{color:"#262626",textAlign:"center",fontFamily:"PingFang SC",fontSize:"14px",fontStyle:"normal",fontWeight:"600"},left:"7%"},legend:{show:!1,right:"1%",textStyle:{color:"#262626",fontSize:"14px"},itemHeight:6,itemWidth:6,type:"scroll",orient:"horizontal",align:"auto",icon:"circle"},grid:{right:"5%",left:"10%",top:"10%",bottom:"25%"},tooltip:{trigger:"axis"},xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#D9D9D9"}},boundaryGap:!1,nameLocation:"end",data:u.xDataArray,axisLabel:{show:!0,fontSize:10,interval:0,rotate:60},axisLine:{show:!1}},yAxis:{type:"value",nameLocation:"end",min:0},series:u.yDataArray};e.setOption(s,{notMerge:!0})};return O(()=>u.xDataArray,()=>{setTimeout(()=>{d()},500)},{deep:!0}),O(()=>u.yDataArray,()=>{setTimeout(()=>{d()},500)},{deep:!0}),P(()=>{setTimeout(()=>{const s=document.getElementById(`echart${y.value}`);e=Q(s),d()},500),window.addEventListener("resize",()=>{e.resize()})}),st(()=>{window.removeEventListener("resize",()=>{e.resize()})}),(s,b)=>(v(),I("div",gt,[t("div",{id:"echart"+y.value,class:"interface-echart"},null,8,Dt)]))}},K=R(xt,[["__scopeId","data-v-417dcb38"]]),At={class:"team-members-pages"},wt={class:"set-model"},kt={class:"label set-model-label"},St={class:"set-model-body"},$t={class:"set-date"},Ct={class:"label set-date-label"},Mt={class:"set-date-body"},Yt={class:"set-reset"},zt={class:"list-box"},It={class:"list-item"},Tt={class:"item-top"},Lt={class:"item-top-left"},Et={class:"item-top-title"},Wt={class:"item-top-right"},Ft={class:"list-item"},Nt={class:"item-top"},Bt={class:"item-top-left"},Ot={class:"item-top-title"},qt={class:"item-top-right"},Pt={class:"list-item"},Rt={class:"item-top"},Kt={class:"item-top-left"},Ut={class:"item-top-title"},Vt={class:"item-top-right"},jt={class:"list-item"},Ht={class:"item-top"},Jt={class:"item-top-left"},Gt={class:"item-top-title"},Qt={class:"item-top-right"},Xt={__name:"statistical_analysis",setup(T){const u=ot(),{t:e}=q("views.robot.robot-config.statistical-analysis.statistical-analysis"),y=[1,2,3,4],d=L({res1:null,res2:null,res3:null,res4:null}),s=L({res1:null,res2:null,res3:null,res4:null}),b=M([{key:"all",id:"all",label:e("ph_all_channels"),title:e("ph_all_channels")},{key:"yun_h5",id:"yun_h5",label:"WebAPP",title:"WebAPP"},{key:"yun_pc",id:"yun_pc",label:e("channel_embedded_website"),title:e("channel_embedded_website")}]),p=M("2"),r=L({channel:"all",start_date:"",end_date:""}),c=h=>{r.start_date=h.start_date,r.end_date=h.end_date,S()},k=()=>{r.channel="all",p.value="2-"+Math.random()},S=()=>{for(let h=0;h<y.length;h++){const o=y[h];$(o)}},B=L({name:e("label_daily_active_users"),type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new U(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}),F=h=>{const o=[];return h.map(_=>o.push(_.date.slice(5,_.date.length))),o},g=h=>(h/1e3).toFixed(2),m=(h,o)=>{const _=JSON.parse(JSON.stringify(B)),C=[];let D="日活用户数（人）";switch(o){case"1":D=e("label_daily_active_users");break;case"2":D=e("label_daily_new_users");break;case"3":D=e("label_total_messages");break;case"4":D=e("label_token_consumption");break}return h.map(Y=>C.push(o=="4"?g(Y.amount):Y.amount)),_.name=D,_.data=C,[_]},$=h=>{let o={type:h,start_date:r.start_date,end_date:r.end_date,robot_id:u.query.id};r.channel!="all"&&(o.channel=r.channel),rt(o).then(_=>{_.data.length>0&&(d["res"+_.data[0].type]=F(_.data),s["res"+_.data[0].type]=m(_.data,_.data[0].type))})},N=h=>{r.channel=h,S()};return P(()=>{}),(h,o)=>{const _=Z,C=X,D=tt,Y=et,w=at;return v(),I("div",At,[l(Y,{justify:"flex-start"},{default:i(()=>[t("div",wt,[t("div",kt,n(a(e)("label_channel")),1),t("div",St,[l(C,{value:r.channel,"onUpdate:value":o[0]||(o[0]=x=>r.channel=x),placeholder:a(e)("ph_all_channels"),onChange:N,style:{width:"200px"}},{default:i(()=>[(v(!0),I(V,null,j(b.value,x=>(v(),W(_,{key:x.key,value:x.id},{default:i(()=>[t("span",null,n(x.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),t("div",$t,[t("div",Ct,[t("span",null,n(a(e)("label_date")),1)]),t("div",Mt,[l(lt,{onDateChange:c,datekey:p.value},null,8,["datekey"])])]),t("div",Yt,[l(D,{onClick:k},{default:i(()=>[A(n(a(e)("btn_reset")),1)]),_:1})])]),_:1}),t("div",zt,[t("div",It,[t("div",Tt,[t("div",Lt,[t("div",Et,n(a(e)("title_daily_active_users")),1),l(w,{placement:"top"},{title:i(()=>[A(n(a(e)("tooltip_daily_active_users")),1)]),default:i(()=>[l(a(E))]),_:1})]),t("div",Wt,n(a(e)("unit_people")),1)]),l(K,{xDataArray:d.res1,yDataArray:s.res1},null,8,["xDataArray","yDataArray"])]),t("div",Ft,[t("div",Nt,[t("div",Bt,[t("div",Ot,n(a(e)("title_daily_new_users")),1),l(w,{placement:"top"},{title:i(()=>[A(n(a(e)("tooltip_daily_new_users")),1)]),default:i(()=>[l(a(E))]),_:1})]),t("div",qt,n(a(e)("unit_people")),1)]),l(K,{xDataArray:d.res2,yDataArray:s.res2},null,8,["xDataArray","yDataArray"])]),t("div",Pt,[t("div",Rt,[t("div",Kt,[t("div",Ut,n(a(e)("title_total_messages")),1),l(w,{placement:"top"},{title:i(()=>[A(n(a(e)("tooltip_total_messages")),1)]),default:i(()=>[l(a(E))]),_:1})]),t("div",Vt,n(a(e)("unit_messages")),1)]),l(K,{xDataArray:d.res3,yDataArray:s.res3},null,8,["xDataArray","yDataArray"])]),t("div",jt,[t("div",Ht,[t("div",Jt,[t("div",Gt,n(a(e)("title_token_consumption")),1),l(w,{placement:"top"},{title:i(()=>[A(n(a(e)("tooltip_token_consumption")),1)]),default:i(()=>[l(a(E))]),_:1})]),t("div",Qt,n(a(e)("unit_thousands")),1)]),l(K,{xDataArray:d.res4,yDataArray:s.res4},null,8,["xDataArray","yDataArray"])])])])}}},Zt=R(Xt,[["__scopeId","data-v-7b5d2c5f"]]),te={class:"container-echart"},ee=["id"],ae={__name:"hit-line-charts",props:{xDataArray:{type:Array,default:function(){return["12-01","11-29","12-02","12-03","12-04","12-05","12-06"]}},yDataArray:{type:Array,default:function(){return[{name:"label_daily_active_users",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new U(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}]}},grid:{type:Object,default:function(){return{right:"5%",left:"0%",top:"0%",bottom:"35%"}}}},setup(T){const{t:u}=q("views.robot.robot-config.statistical-analysis.components.hit-line-charts"),e=T;let y;const d=M(Math.floor(new Date().getTime()*Math.random())),s=()=>{const b={tooltip:{trigger:"axis",formatter:function(p){let r=p[0].axisValue+"<br>";return p.forEach(c=>{let k=c.value,S=c.seriesName.startsWith("label_")||c.seriesName.startsWith("legend_")?u(c.seriesName):c.seriesName;S===u("legend_hit_rate")&&(k+="%"),r+=`
              <span style="display:inline-block;margin-right:5px;border-radius:10px;
              width:9px;height:9px;background-color:${c.color};"></span>
              ${S}: ${k}<br>
            `}),r}},grid:{right:"7%",left:"4%",top:"10%",bottom:"10%"},legend:{data:[u("legend_total_messages"),u("legend_hit_messages"),u("legend_miss_messages"),u("legend_hit_rate")],bottom:0},xAxis:{type:"category",data:e.xDataArray},yAxis:[{type:"value",name:u("yaxis_label_count")},{type:"value",name:u("yaxis_label_percentage"),axisLabel:{formatter:"{value}%"}}],series:e.yDataArray.map((p,r)=>{const c=p.name.startsWith("label_")||p.name.startsWith("legend_")?u(p.name):p.name;return c===u("legend_hit_rate")?{...p,name:c,yAxisIndex:1}:{...p,name:c}})};y.setOption(b,{notMerge:!0})};return O(()=>e.xDataArray,()=>{setTimeout(()=>{s()},500)},{deep:!0}),O(()=>e.yDataArray,()=>{setTimeout(()=>{s()},500)},{deep:!0}),P(()=>{setTimeout(()=>{const b=document.getElementById(`echart${d.value}`);y=Q(b),s()},500),window.addEventListener("resize",()=>{y.resize()})}),st(()=>{window.removeEventListener("resize",()=>{y.resize()})}),(b,p)=>(v(),I("div",te,[t("div",{id:"echart"+d.value,class:"interface-echart"},null,8,ee)]))}},se=R(ae,[["__scopeId","data-v-67b7d829"]]),oe={class:"team-members-pages"},le={class:"search-item"},ne={class:"search-label"},re={class:"search-content"},ie={class:"search-item"},ce={class:"search-label"},_e={class:"search-content"},de={class:"search-item"},ue={class:"statics-header"},pe={class:"statics-item"},he={class:"title"},ye={class:"num"},me={class:"statics-item"},fe={class:"title"},be={class:"num"},ve={class:"statics-item"},ge={class:"title"},De={class:"num"},xe={class:"statics-item"},Ae={class:"title"},we={class:"num"},ke={__name:"hit-statics",setup(T){const u=yt(),e=mt(),{getChannelList:y}=e,d=ot(),{t:s}=q("views.robot.robot-config.statistical-analysis.hit-statics"),b=M([]),p=M("2"),r=L({robot_id:d.query.id,start_date:"",end_date:"",channel:""}),c=L({library_hit_rate:0,library_hit_total:0,library_miss_total:0,message_total:0}),k=L({xAxis:[],series:[]}),S=async()=>{const o=await y({robot_id:d.query.id});b.value=[{app_type:"",app_name:s("ph_all_channels"),app_id:""},...o.data]},B=o=>{r.start_date=o.start_date,r.end_date=o.end_date,g()},F=()=>{r.channel="",p.value="2-"+Math.random()},g=()=>{m()},m=async()=>{it({...r}).then(o=>{Object.assign(c,o.data.header);let _=o.data.chart_list||[],C=[],D=[];C=_.map(Y=>z(Y.date).format("MM-DD")),D=$(_),k.xAxis=C,k.series=D})},$=o=>{const _=[],C=o.map(f=>f.library_hit_rate),D=o.map(f=>f.library_hit_total),Y=o.map(f=>f.library_miss_total),w=o.map(f=>f.message_total),x=(f,nt,H)=>({name:f,type:"line",showSymbol:!1,symbol:"circle",symbolSize:6,itemStyle:{color:H,borderColor:"#fff",borderWidth:2},lineStyle:{width:2,color:H},smooth:!0,data:nt});return _.push(x(s("series_total_messages"),w,"#0079FE"),x(s("series_hit_messages"),D,"#00C292"),x(s("series_miss_messages"),Y,"#FF6B6B"),x(s("series_hit_rate"),C,"#333")),_},N=(o,_)=>{r.app_type=_.data.app_type,r.app_id=_.data.app_id,g()},h=()=>{localStorage.setItem("/robot/config/unknown_issue/activeKey",1),u.push({path:"/robot/config/unknown_issue",query:{id:d.query.id,robot_key:d.query.robot_key,start_date:r.start_date,end_date:r.end_date}})};return P(()=>{S()}),(o,_)=>{const C=Z,D=X,Y=tt,w=et,x=at;return v(),I("div",oe,[l(w,{justify:"flex-start",gap:16},{default:i(()=>[t("div",le,[t("div",ne,n(a(s)("label_channel")),1),t("div",re,[l(D,{value:r.channel,"onUpdate:value":_[0]||(_[0]=f=>r.channel=f),placeholder:a(s)("ph_all_channels"),onChange:N,style:{width:"200px"}},{default:i(()=>[(v(!0),I(V,null,j(b.value,f=>(v(),W(C,{data:f,key:f.app_id+f.app_type,value:f.app_id+f.app_type},{default:i(()=>[t("span",null,n(f.app_name),1)]),_:2},1032,["data","value"]))),128))]),_:1},8,["value","placeholder"])])]),t("div",ie,[t("div",ce,[t("span",null,n(a(s)("label_date")),1)]),t("div",_e,[l(lt,{onDateChange:B,datekey:p.value,disabledValue:"2025-01-01"},null,8,["datekey"])])]),t("div",de,[l(Y,{onClick:F},{default:i(()=>[A(n(a(s)("btn_reset")),1)]),_:1})])]),_:1}),t("div",ue,[t("div",pe,[t("div",he,[l(w,{align:"center",gap:4},{default:i(()=>[A(n(a(s)("title_knowledge_hit_rate"))+" ",1),l(x,null,{title:i(()=>[A(n(a(s)("tooltip_knowledge_hit_rate")),1)]),default:i(()=>[l(a(E))]),_:1})]),_:1})]),t("div",ye,n(c.library_hit_rate)+"%",1)]),t("div",me,[t("div",fe,[l(w,{align:"center",gap:4},{default:i(()=>[A(n(a(s)("title_total_messages"))+" ",1),l(x,null,{title:i(()=>[A(n(a(s)("tooltip_total_messages")),1)]),default:i(()=>[l(a(E))]),_:1})]),_:1})]),t("div",be,n(c.message_total),1)]),t("div",ve,[t("div",ge,[l(w,{align:"center",gap:4},{default:i(()=>[A(n(a(s)("title_knowledge_hit_messages"))+" ",1),l(x,null,{title:i(()=>[A(n(a(s)("tooltip_knowledge_hit_messages")),1)]),default:i(()=>[l(a(E))]),_:1})]),_:1})]),t("div",De,n(c.library_hit_total),1)]),t("div",xe,[t("div",Ae,[l(w,{align:"center",gap:4},{default:i(()=>[A(n(a(s)("title_knowledge_miss_messages")),1)]),_:1}),t("a",{onClick:h},n(a(s)("btn_details")),1)]),t("div",we,n(c.library_miss_total),1)])]),t("div",null,[l(se,{ref:"hitLineChartRef",xDataArray:k.xAxis,yDataArray:k.series},null,8,["xDataArray","yDataArray"])])])}}},Se=R(ke,[["__scopeId","data-v-70df3928"]]),$e={class:"user-model-page"},Ce={class:"list-wrapper"},G="/robot/config/statistical_analysis/activeKey",Me={__name:"index",setup(T){const{t:u}=q("views.robot.robot-config.statistical-analysis.index"),e=M(+localStorage.getItem(G)||1),y=()=>{localStorage.setItem(G,e.value)};return(d,s)=>{const b=ht,p=pt;return v(),I("div",$e,[l(p,{class:"tab-wrapper",onChange:y,activeKey:e.value,"onUpdate:activeKey":s[0]||(s[0]=r=>e.value=r)},{default:i(()=>[(v(),W(b,{key:1,tab:a(u)("tab_basic_statistics")},null,8,["tab"])),(v(),W(b,{key:3,tab:a(u)("tab_hit_statistics")},null,8,["tab"]))]),_:1},8,["activeKey"]),t("div",Ce,[e.value===1?(v(),W(Zt,{key:0})):J("",!0),e.value===3?(v(),W(Se,{key:1})):J("",!0)])])}}},je=R(Me,[["__scopeId","data-v-aed8edcc"]]);export{je as default};
//# sourceMappingURL=index-DvSzm_9k.js.map
