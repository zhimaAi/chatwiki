import{ab as J,e as T,l as a,f as D,o as ee,b as oe,Y as A,_ as w,k as q,a2 as L,F as ne,a9 as te,a1 as O,G as se,a7 as ie,u as ae,af as $,d as re,a5 as Y,ae as ce,ag as le,aa as ue}from"./vue-chunks-Ci-XTWEs.js";import{u as B}from"./robot-DHvU2P3E.js";import{b as Q,d as r,ag as X}from"../../index-OnalErht.js";import{g as fe}from"./index-DFuA_ofI.js";import{c as be,b as pe}from"./ui-antd-BgeWxFcI.js";import{T as de}from"./top-header-BKMNjfID.js";import"./index-DGyn5jM5.js";import"./utils-ChQO-_r6.js";import"./add-group-DBCwDjxp.js";import"./index-DXDs1xHg.js";const ye={class:"left-menu-box"},_e={__name:"left-menu",props:{robotInfo:{type:Object,default:()=>{}}},emits:["changeMenu"],setup(b,{emit:R}){const c=J(),l=B(),p=b,s=c.query,h=T(()=>{const n=C.value.find(o=>o.id==="auto-reply");if(c.path.split("/")[3]==="auto-reply"&&!n)return["function-center"];const t=C.value.find(o=>o.id==="subscribe-reply");return c.path.split("/")[3]==="subscribe-reply"&&!t?["function-center"]:[c.path.split("/")[3]]}),v=[{key:"workflow",id:"workflow",icon:()=>a(r,{name:"workflow",class:"menu-icon"}),label:"工作流编排",title:"工作流编排",path:"/robot/config/workflow",menuIn:["1"]},{key:"basic-config",id:"basic-config",icon:()=>a(r,{name:"jichupeizhi",class:"menu-icon"}),label:"基础配置",title:"基础配置",path:"/robot/config/basic-config",menuIn:["0"]},{key:"library-config",id:"library-config",icon:()=>a(r,{name:"guanlianzhishiku",class:"menu-icon"}),label:"知识库",title:"知识库",path:"/robot/config/library-config",menuIn:["0"]},{key:"skill-config",id:"skill-config",icon:()=>a(r,{name:"skii",class:"menu-icon"}),label:"工作流",title:"工作流",path:"/robot/config/skill-config",menuIn:["0"]},{key:"function-center",id:"function-center",icon:()=>a(r,{name:"function-center",class:"menu-icon"}),label:"功能中心",title:"功能中心",path:"/robot/config/function-center",menuIn:["0","1"]},{key:"external-services",id:"external-services",icon:()=>a(r,{name:"duiwaifuwu",class:"menu-icon"}),label:"对外服务",title:"对外服务",path:"/robot/config/external-services",menuIn:["0","1"]},{key:"test",id:"test",icon:()=>a(r,{name:"liaotianceshi",class:"menu-icon"}),label:"聊天测试",title:"聊天测试",path:"/robot/test",query:{robot_key:p.robotInfo.robot_key,id:p.robotInfo.id},target:"_blank",menuIn:["0","1"]},{key:"qa-feedbacks",id:"qa-feedbacks",icon:()=>a(r,{name:"qa-feedback",class:"menu-icon"}),label:"问答反馈",title:"问答反馈",path:"/robot/config/qa-feedbacks",menuIn:["0","1"]},{key:"session-record",id:"session-record",icon:()=>a(r,{name:"session-record",class:"menu-icon"}),label:"会话记录",title:"会话记录",path:"/robot/config/session-record",query:{robot_key:p.robotInfo.robot_key,id:p.robotInfo.id},menuIn:["0","1"]},{key:"api-key-manage",id:"api-key-manage",icon:()=>a(r,{name:"duiwaifuwu",class:"menu-icon"}),label:"API Key管理",title:"API Key管理",path:"/robot/config/api-key-manage",menuIn:["0","1"]},{key:"unknown_issue",id:"unknown_issue",icon:()=>a(r,{name:"unknown-issue",class:"menu-icon"}),label:"未知问题",title:"未知问题",path:"/robot/config/unknown_issue",menuIn:["0","1"]},{key:"statistical_analysis",id:"statistical_analysis",icon:()=>a(r,{name:"statistical-analysis",class:"menu-icon"}),label:"统计分析",title:"统计分析",path:"/robot/config/statistical_analysis",menuIn:["0","1"]},{key:"export-record",id:"export-record",icon:()=>a(r,{name:"export-record",class:"menu-icon"}),label:"导出记录",title:"导出记录",path:"/robot/config/export-record",menuIn:["0","1"]},{key:"invoke-logs",id:"invoke-logs",icon:()=>a(r,{name:"doc-file",class:"menu-icon"}),label:"调用日志",title:"调用日志",path:"/robot/config/invoke-logs",menuIn:["1"]}],_=D(null),g=D(null);async function E(){var n,t,o,d,k,y,H,N,P,U,V,j,z,G,W;try{const I=((n=p.robotInfo)==null?void 0:n.id)||s.id;if(!I)return;const K=await fe({robot_id:I}),M=(K==null?void 0:K.data)||[],u=(M||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_auto_reply");if(u){const e=((t=u==null?void 0:u.robot_config)==null?void 0:t.switch_status)??((o=u==null?void 0:u.user_config)==null?void 0:o.switch_status)??"0",m=((d=u==null?void 0:u.robot_config)==null?void 0:d.ai_reply_status)??((k=u==null?void 0:u.user_config)==null?void 0:k.ai_reply_status)??"0";l.setKeywordReplySwitchStatus(String(e)),l.setKeywordReplyAiReplyStatus(String(m))}else l.setKeywordReplySwitchStatus("0"),l.setKeywordReplyAiReplyStatus("0");const i=(M||[]).find(e=>{var m,S;return(e==null?void 0:e.ability_type)==="robot_auto_reply"&&((m=e==null?void 0:e.robot_config)==null?void 0:m.fixed_menu)==="1"&&((S=e==null?void 0:e.robot_config)==null?void 0:S.switch_status)==="1"});i?_.value={key:"auto-reply",id:"auto-reply",icon:()=>a(r,{name:"auto-reply",class:"menu-icon"}),label:(y=i==null?void 0:i.menu)==null?void 0:y.name,title:(H=i==null?void 0:i.menu)==null?void 0:H.name,path:((N=i==null?void 0:i.menu)==null?void 0:N.path)||"/robot/ability/auto-reply",menuIn:["0","1"]}:_.value=null;const f=(M||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_subscribe_reply");if(f){const e=((P=f==null?void 0:f.robot_config)==null?void 0:P.switch_status)??((U=f==null?void 0:f.user_config)==null?void 0:U.switch_status)??"0",m=((V=f==null?void 0:f.robot_config)==null?void 0:V.ai_reply_status)??((j=f==null?void 0:f.user_config)==null?void 0:j.ai_reply_status)??"0";l.setSubscribeReplySwitchStatus(String(e)),l.setSubscribeReplyAiReplyStatus(String(m))}else l.setSubscribeReplySwitchStatus("0"),l.setSubscribeReplyAiReplyStatus("0");const x=(M||[]).find(e=>{var m,S;return(e==null?void 0:e.ability_type)==="robot_subscribe_reply"&&((m=e==null?void 0:e.robot_config)==null?void 0:m.fixed_menu)==="1"&&((S=e==null?void 0:e.robot_config)==null?void 0:S.switch_status)==="1"});x?g.value={key:"subscribe-reply",id:"subscribe-reply",icon:()=>a(r,{name:"subscribe-reply",class:"menu-icon"}),label:(z=i==null?void 0:i.menu)==null?void 0:z.name,title:(G=i==null?void 0:i.menu)==null?void 0:G.name,path:((W=x==null?void 0:x.menu)==null?void 0:W.path)||"/robot/ability/subscribe-reply",menuIn:["0","1"]}:g.value=null}catch(I){console.warn("refreshAbilityMenu failed",I)}}function F(n){var d,k;const t=((d=p.robotInfo)==null?void 0:d.id)||s.id,o=(k=n==null?void 0:n.detail)==null?void 0:k.robotId;!o||!t||String(o)!==String(t)||E()}ee(()=>{E(),window.addEventListener("robotAbilityUpdated",F)}),oe(()=>{window.removeEventListener("robotAbilityUpdated",F)});const C=T(()=>{let n=v;if(X(s.id)==1?n=n.filter(t=>t.id=="external-services"):n=n.filter(t=>{var o;return t.menuIn.includes((o=p.robotInfo)==null?void 0:o.application_type)}),_.value){const t=n.findIndex(d=>d.id==="function-center"),o=[...n];return t>=0?(o.splice(t+1,0,_.value),o):(o.push(_.value),o)}if(g.value){const t=n.findIndex(d=>d.id==="function-center"),o=[...n];return t>=0?(o.splice(t+1,0,g.value),o):(o.push(g.value),o)}return n}),Z=({item:n})=>{h.value.includes(n.id)};return(n,t)=>{const o=be,d=$("router-link"),k=pe;return w(),A("div",ye,[q(k,{class:"left-menu",selectedKeys:h.value,onClick:Z},{default:L(()=>[(w(!0),A(ne,null,te(C.value,y=>(w(),O(d,{class:"default-color",target:y.target||"_self",to:{path:y.path,query:y.query||ae(s)},key:y.key},{default:L(()=>[(w(),O(o,{icon:y.icon,path:y.path,key:y.key},{default:L(()=>[se(ie(y.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["target","to"]))),128))]),_:1},8,["selectedKeys"])])}}},me=Q(_e,[["__scopeId","data-v-ff258d5a"]]),ge=re({name:"robotPage",components:{leftMenu:me,TopHeader:de},async beforeRouteEnter(b,R,c){const l=B(),{getRobot:p,robotInfo:s,getRobotLists:h,getGroupList:v}=l;await p(b.query.id),h(),v();let _=X(b.query.id);if(_==0){c("/no-permission");return}if(_==1){window.location.href=`${s.h5_domain}/#/chat/pc?robot_key=${s.robot_key}`,c("/robot/list");return}let g=["basicConfig","libraryConfig","skillConfig"];if(s.application_type==1&&g.includes(b.name)){c(`/robot/config/workflow?id=${s.id}&robot_key=${s.robot_key}`);return}if(s.application_type==0&&b.name=="robotWorkflow"){c(`/robot/config/basic-config?id=${s.id}&robot_key=${s.robot_key}`);return}c()},setup(){const b=ue(),R=B(),{robotInfo:c}=le(R),l=T(()=>J().name!="robotWorkflow");return{robotInfo:c,changeMenu:s=>{b.push({path:s.path,query:{robot_key:c.value.robot_key,id:c.value.id}})},isShowLeft:l}}}),ke={class:"robot-main-container"},he={class:"robot-page-layout"},we={key:0,class:"layout-left"},ve={class:"layout-body"};function Se(b,R,c,l,p,s){const h=$("TopHeader"),v=$("leftMenu"),_=$("router-view");return w(),A("div",ke,[Y("div",he,[b.isShowLeft?(w(),A("div",we,[q(h),q(v,{onChangeMenu:b.changeMenu,robotInfo:b.robotInfo},null,8,["onChangeMenu","robotInfo"])])):ce("",!0),Y("div",ve,[q(_)])])])}const Te=Q(ge,[["render",Se],["__scopeId","data-v-f64f13e3"]]);export{Te as default};
