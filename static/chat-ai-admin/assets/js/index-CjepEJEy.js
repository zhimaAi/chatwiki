import{b as K,d as ee,ac as te}from"../../index-CPkdGIiL.js";import{aa as se,f as h,o as Q,Y as n,_ as t,a1 as T,k as d,F as D,a9 as B,a5 as e,a7 as c,G as U,ae as L,B as N,r as ne,e as ae,a2 as k,u as Y,l as oe,ab as ke,ad as W}from"./vue-chunks-Ci-XTWEs.js";import{E as le}from"./empty-box-fCJmmPRK.js";import{c as $e,b as ie,s as H,a as ce,r as de,t as be,u as Ce,d as Z,e as xe,o as Pe,f as we}from"./index-DNepwrz3.js";import{L as ue}from"./loading-box-B8yVBXxh.js";import{U as _e}from"./update-modal-jnPLYoyk.js";import{x as re,au as pe,a8 as ve,B as fe,z as De,ao as he,aw as ge,k as Re,F as Oe,e as Ie,I as me,M as G,a as E,X as Se,T as Ae}from"./ui-antd-Bw8cEW5z.js";import{_ as Te}from"./tool-icon-IWVrYlVb.js";import{_ as Me}from"./no-permission-DtJ3NYHG.js";import{_ as qe}from"./main-tab-CrJi-O-9.js";import"./utils-ChQO-_r6.js";import"./empty-BFmzY9bl.js";/* empty css                                                                     */import"./list-tabs-Bu_nGTVN.js";const ze={class:"_plugin-box"},Be={key:1,class:"plugin-list"},Ue=["onClick"],je={class:"type-tag"},Le={class:"base-info"},Ne=["src"],Ee={class:"info"},Fe={class:"head"},Ve={class:"name zm-line1"},Je={class:"source"},Ge={class:"desc zm-line1"},Ke={class:"version"},Xe={class:"action-box"},Ye={class:"left"},He={class:"right"},Qe=["href"],We=["onClick"],Ze={key:1},et=["onClick"],tt={__name:"remotePlugins",props:{filterData:{type:Object,default:null}},emits:["installReport"],setup(V,{expose:M,emit:q}){const y=q,_=V,g=se(),C=h(null),w=h(!0),x=h([]),l=h({});Q(()=>{R()});function v(){x.value=[],R()}async function R(){w.value=!0,await z(),$e(_.filterData).then(r=>{let $=(r==null?void 0:r.data)||[];$.forEach(u=>{var s;let{local:O,has_update:o}=((s=l.value)==null?void 0:s[u.name])||{};u.local=O,u.has_update=o}),x.value=$}).finally(()=>{w.value=!1})}async function z(){await ie().then(r=>{let $=(r==null?void 0:r.data)||[];y("installReport",$.length);let u={};$.forEach(O=>{u[O.local.name]={local:O.local,has_update:O.remote.latest_version!=O.local.version}}),l.value=u})}function f(r){g.push({path:"/plugins/detail",query:{name:r.name}})}function m(r){C.value.show(r,r.latest_version_detail,r.local||null)}return M({search:v}),(r,$)=>{const u=ee,O=re;return t(),n("div",ze,[w.value?(t(),T(ue,{key:0})):x.value.length?(t(),n("div",Be,[(t(!0),n(D,null,B(x.value,o=>(t(),n("div",{onClick:s=>f(o),key:o.name,class:"plugin-item"},[e("div",je,c(o.filter_type_title),1),e("div",Le,[e("img",{class:"avatar",src:o.icon},null,8,Ne),e("div",Ee,[e("div",Fe,[e("span",Ve,c(o.title),1)]),e("div",Je,c(o.author),1)])]),e("div",Ge,c(o.description),1),e("div",Ke,"版本：v"+c(o.latest_version),1),e("div",Xe,[e("div",Ye,[d(u,{name:"download"}),U(" "+c(o.installed_count||0),1)]),e("div",He,[o.help_url?(t(),n(D,{key:0},[e("a",{onClick:$[0]||($[0]=N(()=>{},["stop"])),class:"c595959",href:o.help_url,target:"_blank"},"使用说明",8,Qe),d(O,{type:"vertical"})],64)):L("",!0),o.local?(t(),n(D,{key:1},[o.has_update?(t(),n("a",{key:0,onClick:N(s=>m(o),["stop"])},"更新",8,We)):(t(),n("span",Ze,"已安装"))],64)):(t(),n("a",{key:2,onClick:N(s=>m(o),["stop"])},"安装",8,et))])])],8,Ue))),128))])):(t(),T(le,{key:2,title:"暂无可用插件"})),d(_e,{ref_key:"updateRef",ref:C,onOk:R},null,512)])}}},st=K(tt,[["__scopeId","data-v-eb3d4766"]]),nt={class:"head-box"},at={class:"base-info-box"},ot=["src"],lt={class:"info-box"},it={class:"left"},ct={class:"name zm-line1"},dt={class:"right"},ut={class:"link"},_t={class:"tools-box"},rt={class:"info"},pt={class:"tit zm-line1"},vt={class:"btns"},ft=["onClick"],ht=["onClick"],gt={class:"body-box"},mt={key:0,class:"no-auth-box"},yt={key:1,class:"action-box"},kt={class:"tit"},$t={class:"desc"},bt={class:"params"},Ct={class:"params-box"},xt={class:"field"},Pt={class:"name"},wt={class:"type"},Dt={key:0,class:"required"},Rt={class:"desc"},Ot={__name:"feishu-config-box",emits:["del","edit","auth"],setup(V,{expose:M,emit:q}){const y=h(!1),_=h({}),g=h({}),C=h({}),w=h(!1),x=h(!1),l=ne({}),v=ae(()=>Object.keys(g.value).length);function R(o){_.value=o,f(),m(),y.value=!0}function z(){y.value=!1}function f(){ce({name:_.value.name}).then(o=>{g.value=te(o==null?void 0:o.data,{})})}function m(){de({name:_.value.name,action:"default/get-schema",params:{}}).then(o=>{let s=(o==null?void 0:o.data)||{};for(let I in s)s[I].type!="node"&&delete s[I];C.value=s})}function r(){Object.assign(l,{name:"",appid:"",app_secret:"",is_default:!1}),(!g.value||!Object.keys(g.value).length)&&(l.is_default=!0),w.value=!0}function $(o,s){for(let I in g.value)g.value[I].is_default=I==s;H({name:_.value.name,data:JSON.stringify(g.value)}).then(I=>{f()})}function u(o,s){G.confirm({title:"提示",content:"确认删除该配置？",onOk:()=>{delete g.value[s],H({name:_.value.name,data:JSON.stringify(g.value)}).then(I=>{f(),E.success("已删除")})}})}function O(){try{if(x.value=!0,!l.name)throw"请输入凭证名称";if(g.value[l.name])throw"凭证名称已存在";if(!l.appid)throw"请输入APP ID";if(!l.app_secret)throw"请输入APP Secret";H({name:_.value.name,data:JSON.stringify({...g.value,[l.name]:l})}).then(o=>{w.value=!1,f(),E.success("已保存")}).finally(()=>{x.value=!1})}catch(o){x.value=!1,E.error(o)}}return M({show:R,hide:z}),(o,s)=>{const I=he,a=fe,i=ve,P=ge,S=Re,A=me,p=Ie,j=Oe,ye=G;return t(),n("div",null,[d(P,{open:y.value,"onUpdate:open":s[1]||(s[1]=b=>y.value=b),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:k(()=>[e("div",nt,[e("div",at,[e("img",{class:"avatar",src:_.value.icon},null,8,ot),e("div",lt,[e("div",it,[e("div",ct,c(_.value.title),1),e("div",null,c(_.value.author),1)]),e("div",dt,[d(Y(pe),{onClick:s[0]||(s[0]=b=>y.value=!1),class:"icon"})])])]),e("div",ut,c(_.value.description),1),v.value>0?(t(),T(i,{key:0,placement:"bottom"},{content:k(()=>[e("div",_t,[(t(!0),n(D,null,B(g.value,(b,J)=>(t(),n("div",{key:J,class:"tool-item"},[s[7]||(s[7]=e("img",{class:"cover",src:Te},null,-1)),e("div",rt,[e("div",pt,c(b.name),1),e("div",vt,[b.is_default?(t(),T(I,{key:0,color:"#f50"},{default:k(()=>s[6]||(s[6]=[U("默认")])),_:1,__:[6]})):(t(),n("a",{key:1,onClick:F=>$(b,J)},"设为默认",8,ft)),e("a",{onClick:F=>u(b,J)},"删除",8,ht)])])]))),128))])]),default:k(()=>[d(a,{type:"primary",icon:oe(Y(De)),class:"auth-btn",onClick:r},{default:k(()=>[U(" 已授权"+c(v.value)+"个凭证 ",1)]),_:1},8,["icon"])]),_:1})):(t(),T(a,{key:1,type:"primary",class:"auth-btn",onClick:r},{default:k(()=>s[8]||(s[8]=[U("立即授权")])),_:1,__:[8]}))]),e("div",gt,[v.value?(t(),n("div",yt,[(t(!0),n(D,null,B(C.value,(b,J)=>(t(),n("div",{key:J,class:"action-item"},[e("div",kt,c(b.title),1),e("div",$t,c(b.desc),1),e("div",bt,[(t(!0),n(D,null,B(Object.keys(b.params).slice(0,3),(F,X)=>(t(),T(I,{key:X,bordered:!1},{default:k(()=>[U(c(F),1)]),_:2},1024))),128)),d(i,{placement:"right"},{content:k(()=>[e("div",Ct,[(t(!0),n(D,null,B(b.params,(F,X)=>(t(),n("div",{key:X,class:"param-item"},[e("div",xt,[e("span",Pt,c(X),1),e("span",wt,c(F.type),1),F.required?(t(),n("span",Dt,"必填")):L("",!0)]),e("div",Rt,c(F.desc),1)]))),128))])]),default:k(()=>[s[12]||(s[12]=e("a",null,"参数",-1))]),_:2,__:[12]},1024)])]))),128))])):(t(),n("div",mt,[s[9]||(s[9]=e("img",{src:Me},null,-1)),s[10]||(s[10]=e("div",{class:"tit"},"需要授权",-1)),s[11]||(s[11]=e("div",{class:"desc"},"授权后，配置将显示在这里",-1)),e("a",{class:"link",onClick:r},"立即授权")]))])]),_:1},8,["open"]),d(ye,{open:w.value,"onUpdate:open":s[5]||(s[5]=b=>w.value=b),"confirm-loading":x.value,title:"API Key授权配置",width:"620px",onOk:O},{default:k(()=>[d(S,{type:"info","show-icon":"",message:"配置凭据后，工作流可直接调用此插件"}),d(j,{class:"mt16",model:l,"label-col":{span:4},"wrapper-col":{span:20}},{default:k(()=>[d(p,{label:"凭证名称",name:"name",rules:[{required:!0,message:"请输入凭证名称!"}]},{default:k(()=>[d(A,{value:l.name,"onUpdate:value":s[2]||(s[2]=b=>l.name=b),valueModifiers:{trim:!0},maxlength:16,placeholder:"请输入凭证名称"},null,8,["value"]),s[13]||(s[13]=e("div",{class:"tip-desc"},"仅用于区分多个授权配置的名称，不用于接口调用",-1))]),_:1,__:[13]}),d(p,{label:"APP ID",name:"appid",rules:[{required:!0,message:"请输入APP ID!"}]},{default:k(()=>[d(A,{value:l.appid,"onUpdate:value":s[3]||(s[3]=b=>l.appid=b),valueModifiers:{trim:!0},placeholder:"请输入APP ID"},null,8,["value"])]),_:1}),d(p,{label:"APP Secret",name:"app_secret",rules:[{required:!0,message:"请输入APP Secret!"}]},{default:k(()=>[d(A,{value:l.app_secret,"onUpdate:value":s[4]||(s[4]=b=>l.app_secret=b),valueModifiers:{trim:!0},placeholder:"请输入APP Secret"},null,8,["value"]),s[14]||(s[14]=e("div",{class:"tip-desc"},"如何获取APP ID和APP Secret",-1))]),_:1,__:[14]})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},It=K(Ot,[["__scopeId","data-v-25612f86"]]),St={class:"head-box"},At={class:"base-info-box"},Tt=["src"],Mt={class:"info-box"},qt={class:"left"},zt={class:"name zm-line1"},Bt={class:"right"},Ut={class:"link"},jt={class:"body-box"},Lt={class:"action-box"},Nt={class:"tit"},Et={class:"desc"},Ft={class:"params"},Vt={class:"params-box"},Jt={class:"field"},Gt={class:"name"},Kt={class:"type"},Xt={key:0,class:"required"},Yt={class:"desc"},Ht={__name:"config-box",emits:["del","edit","auth"],setup(V,{expose:M,emit:q}){const y=h(!1),_=h({}),g=h({});function C(l){_.value=l,x(),y.value=!0}function w(){y.value=!1}function x(){de({name:_.value.name,action:"default/get-schema",params:{}}).then(l=>{let v=(l==null?void 0:l.data)||{};for(let R in v)v[R].type!="node"&&delete v[R];g.value=v})}return M({show:C,hide:w}),(l,v)=>{const R=he,z=ve,f=ge;return t(),n("div",null,[d(f,{open:y.value,"onUpdate:open":v[1]||(v[1]=m=>y.value=m),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:k(()=>[e("div",St,[e("div",At,[e("img",{class:"avatar",src:_.value.icon},null,8,Tt),e("div",Mt,[e("div",qt,[e("div",zt,c(_.value.title),1),e("div",null,c(_.value.author),1)]),e("div",Bt,[d(Y(pe),{onClick:v[0]||(v[0]=m=>y.value=!1),class:"icon"})])])]),e("div",Ut,c(_.value.description),1)]),e("div",jt,[e("div",Lt,[(t(!0),n(D,null,B(g.value,(m,r)=>(t(),n("div",{key:r,class:"action-item"},[e("div",Nt,c(m.title),1),e("div",Et,c(m.desc),1),e("div",Ft,[(t(!0),n(D,null,B(Object.keys(m.params).slice(0,3),($,u)=>(t(),T(R,{key:u,bordered:!1},{default:k(()=>[U(c($),1)]),_:2},1024))),128)),d(z,{placement:"right"},{content:k(()=>[e("div",Vt,[(t(!0),n(D,null,B(m.params,($,u)=>(t(),n("div",{key:u,class:"param-item"},[e("div",Jt,[e("span",Gt,c(u),1),e("span",Kt,c($.type),1),$.required?(t(),n("span",Xt,"必填")):L("",!0)]),e("div",Yt,c($.desc),1)]))),128))])]),default:k(()=>[v[2]||(v[2]=e("a",null,"参数",-1))]),_:2,__:[2]},1024)])]))),128))])])]),_:1},8,["open"])])}}},Qt=K(Ht,[["__scopeId","data-v-13aca134"]]),Wt={class:"_plugin-box"},Zt={key:1,class:"plugin-list"},es=["onClick"],ts={class:"type-tag"},ss={class:"base-info"},ns=["src"],as={class:"info"},os={class:"head"},ls={class:"name zm-line1"},is={class:"source"},cs={class:"desc zm-line1"},ds={class:"version"},us={key:0,class:"tag"},_s={class:"action-box"},rs={class:"right"},ps=["onClick"],vs=["href"],fs=["onClick"],hs=["onClick"],gs={class:"text-center mt24"},ms={__name:"installPlugins",props:{filterData:{type:Object,default:null}},emits:["installReport","tabChange"],setup(V,{expose:M,emit:q}){const y=q,_=V,g=se(),C=h(null),w=h(null),x=h(null),l=h(!0),v=h([]),R=["feishu_bitable","official_account_profile"];Q(()=>{r()});function z(){v.value=[],r()}const f=h([]),m=ae(()=>_.filterData.filter_type==0||_.filterData.filter_type==5?[...f.value,...v.value]:v.value);function r(){be(_.filterData).then(a=>{let i=(a==null?void 0:a.data)||[];i=i.map(P=>{var S,A;return{...P.remote,local:P.local,has_update:((S=P.remote)==null?void 0:S.latest_version)!=((A=P.local)==null?void 0:A.version),installing:!1}}),f.value=i}),l.value=!0,ie(_.filterData).then(a=>{let i=(a==null?void 0:a.data)||[];y("installReport",i.length),i=i.map(P=>{var S,A;return{...P.remote,local:P.local,has_update:((S=P.remote)==null?void 0:S.latest_version)!=((A=P.local)==null?void 0:A.version),installing:!1}}),v.value=i}).finally(()=>{l.value=!1})}async function $(a){const i=()=>a.local.has_loaded=!a.local.has_loaded;if(!a.local.has_loaded)G.confirm({title:"确认关闭该插件？",content:"关闭后，其他应用的位置都不可使用！确认关闭？",okText:"确定",cancelText:"取消",onOk:()=>{a.local.type=="trigger"?Z({id:a.trigger_config_id,switch_status:0}).then(()=>{E.success("已关闭")}).catch(i):xe({name:a.name}).then(()=>{E.success("已关闭")}).catch(i)},onCancel(){i()}});else{if(a.local.type=="trigger"){Z({id:a.trigger_config_id,switch_status:1}).then(()=>{E.success("已开启")});return}if(a.name=="feishu_bitable"){let{data:P}=await ce({name:a.name});if(P=te(P,{}),!Object.keys(P).length)return i(),G.confirm({title:"授权飞书应用接口权限",content:oe("div",{style:{color:" red"}},"请先完成信息配置，获取接口权限"),okText:"确定",cancelText:"取消",onOk:()=>{u(a)}})}Pe({name:a.name}).then(()=>{E.success("已开启")}).catch(i)}}function u(a){w.value.show(a)}function O(a){G.confirm({title:"确认删除该插件？",content:"删除后，其他应用的位置都不可使用！确认删除？",okText:"确定",cancelText:"取消",onOk:()=>{Ce({name:a.name}).then(()=>{E.success("已删除"),r()})}})}function o(a){a.local.type!="trigger"&&g.push({path:"/plugins/detail",query:{name:a.name}})}function s(a){a.name==="feishu_bitable"?u(a):x.value.show(a)}function I(a){C.value.show(a,a.latest_version_detail,a.local)}return M({search:z}),(a,i)=>{const P=Se,S=re,A=fe;return t(),n("div",Wt,[l.value?(t(),T(ue,{key:0})):m.value.length?(t(),n("div",Zt,[(t(!0),n(D,null,B(m.value,p=>(t(),n("div",{onClick:j=>o(p),key:p.name,class:"plugin-item"},[e("div",ts,c(p.filter_type_title),1),e("div",ss,[e("img",{class:"avatar",src:p.icon},null,8,ns),e("div",as,[e("div",os,[e("span",ls,c(p.title),1)]),e("div",is,c(p.author),1)])]),e("div",cs,c(p.description),1),e("div",ds,[U("版本：v"+c(p.local.version)+" ",1),p.has_update?(t(),n("span",us,"有更新")):L("",!0)]),e("div",_s,[e("div",{class:"left",onClick:i[0]||(i[0]=N(()=>{},["stop"]))},[d(P,{checked:p.local.has_loaded,"onUpdate:checked":j=>p.local.has_loaded=j,onChange:j=>$(p)},null,8,["checked","onUpdate:checked","onChange"])]),e("div",rs,[p.local.type!="trigger"?(t(),n("span",{key:0,class:"zm-link-pointer",onClick:N(j=>O(p),["stop"])},"删除",8,ps)):L("",!0),p.help_url?(t(),n(D,{key:1},[d(S,{type:"vertical"}),e("a",{onClick:i[1]||(i[1]=N(()=>{},["stop"])),class:"c595959",href:p.help_url,target:"_blank"},"使用说明",8,vs)],64)):L("",!0),R.includes(p.name)?(t(),n(D,{key:2},[d(S,{type:"vertical"}),e("a",{onClick:N(j=>s(p),["stop"])},"配置",8,fs)],64)):L("",!0),p.has_update?(t(),n(D,{key:3},[d(S,{type:"vertical"}),e("a",{onClick:N(j=>I(p),["stop"])},"更新",8,hs)],64)):L("",!0)])])],8,es))),128))])):(t(),T(le,{key:2,title:"暂未安装插件"},{desc:k(()=>[e("div",null,[i[4]||(i[4]=U("更多功能可到 ")),e("a",{onClick:i[2]||(i[2]=p=>y("tabChange",3))},"探索>插件广场"),i[5]||(i[5]=U(" 中去添加"))]),e("div",gs,[d(A,{class:"btn",type:"primary",onClick:i[3]||(i[3]=p=>y("tabChange",3))},{default:k(()=>i[6]||(i[6]=[U("去添加")])),_:1,__:[6]})])]),_:1})),d(_e,{ref_key:"updateRef",ref:C,onOk:r},null,512),d(It,{ref_key:"feishuRef",ref:w},null,512),d(Qt,{ref_key:"configRef",ref:x},null,512)])}}},ys=K(ms,[["__scopeId","data-v-fe965bb5"]]),ks={class:"_container"},$s={class:"header"},bs={class:"main-tab-box"},Cs={class:"content"},xs={class:"filter-box"},Ps={class:"radio-tabs"},ws=["onClick"],Ds=["src"],Rs={__name:"index",setup(V){const M=ke(),q=h(null),y=h(null),_=h(localStorage.getItem("zm:explore:active")||"2"),g=h([]),C=ne({title:"",filter_type:0});Q(()=>{M.query.active>1&&q.value.change(M.query.active),w()});function w(){we().then(f=>{g.value=(f==null?void 0:f.data)||[]})}function x(){y.value.search()}function l(f){C.filter_type=f,x()}function v(f){f>1&&(_.value=f)}function R(f){q.value.change(f)}function z(){q.value.update()}return(f,m)=>{const r=ee,$=me;return t(),n("div",ks,[e("div",$s,[e("div",bs,[d(qe,{ref_key:"tabRef",ref:q,onChange:v},null,512)])]),e("div",Cs,[e("div",xs,[e("div",Ps,[e("div",{onClick:m[0]||(m[0]=u=>l(0)),class:W(["radio-tab",{active:C.filter_type==0}])},[d(r,{name:"icon-all"}),m[2]||(m[2]=e("span",null,"全部",-1))],2),(t(!0),n(D,null,B(g.value,u=>(t(),n("div",{onClick:O=>l(u.id),key:u.id,class:W(["radio-tab",{active:u.id==C.filter_type}])},[e("img",{class:"icon",src:u.id==C.filter_type?u.icon_active_path:u.icon_path},null,8,Ds),e("span",null,c(u.type_title),1)],10,ws))),128))]),d($,{value:C.title,"onUpdate:value":m[1]||(m[1]=u=>C.title=u),valueModifiers:{trim:!0},onChange:x,style:{width:"360px"},allowClear:"",placeholder:"搜索插件"},{suffix:k(()=>[d(Y(Ae))]),_:1},8,["value"])]),_.value==3?(t(),T(st,{key:0,onInstallReport:z,filterData:C,ref_key:"pluginRef",ref:y},null,8,["filterData"])):(t(),T(ys,{key:1,onTabChange:R,onInstallReport:z,filterData:C,ref_key:"pluginRef",ref:y},null,8,["filterData"]))])])}}},Fs=K(Rs,[["__scopeId","data-v-b0f3d353"]]);export{Fs as default};
