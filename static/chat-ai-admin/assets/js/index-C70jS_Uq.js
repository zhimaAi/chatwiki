import{X as _e,Y as i,_ as t,k as M,a5 as o,a6 as ue,a3 as te,G as F,a7 as h,ag as W,f as $,w as se,o as oe,y as J,b as ie,a1 as z,u as C,ae as w,F as N,a9 as D,ad as V,q as ae,a2 as H,n as ne,H as le,J as K,aa as he}from"./vue-chunks-CXJTX1FC.js";import{u as re}from"./useEventBus-BwH2zX88.js";import{g as pe}from"./index-DvPlhmYy.js";import{aa as Q,ah as Z,b1 as ee,h as me,b as P,d as X}from"../../index-0TFHdij1.js";import{u as ve}from"./useIM-Dr3RMCY8.js";import{B as U,M as fe,S as ge,P as ye}from"./pull-up.esm-D94Swpvl.js";import{O as ke}from"./observe-dom.esm-CyCedSm-.js";import{ah as be,au as Le,aw as Te,v as we,u as Se,I as xe}from"./ui-antd-D3ZAJ1Vq.js";import{_ as Ce}from"./index-qYVIM3-2.js";import{h as $e}from"./index-CzO53uhx.js";import"./utils-yZpnICoG.js";import"./index-BAHM4xhG.js";const Re=(d={})=>Q.get({url:"/manage/getReceiverList",params:d}),Me=(d={})=>Q.post({url:"/chat/message",data:d}),Ie=(d={})=>Q.post({url:"/manage/setReceiverRead",data:d}),Y=_e("chatMonitor",{state:()=>({im:null,selectedRobotId:"",robotList:[],selectedReceiverId:"",receiverList:[],receiverListPage:{page:0,size:10},activeChat:null,chatMessagePageSize:10,messageList:[],messageListScrollTop:0,chatMessageLoadCompleted:!1,messageListLoading:!1}),getters:{},actions:{async init(){this.selectedRobotId="",this.selectedReceiverId="",this.robotList=[],this.receiverList=[],this.messageList=[],this.receiverListPage={page:0,size:10},this.messageListScrollTop=0,this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.activeChat=null,await this.getRobotList(),await this.getReceiverList(),this.receiverList.length>0&&await this.switchChat(this.receiverList[0]),this.initIM()},closeIM(){this.im&&this.im.close()},initIM(){const d=ve(),r=me();this.im=d,d.connect(r.user_id),d.on("message",s=>{!s.data||s.msg_type!=="receiver_notify"||((s.change=="create"||s.change=="update")&&this.onAddReceiver(s),s.change=="delete"&&this.onDeleteReceiver(s),(s.change=="c_message"||s.change=="ai_message")&&this.onAddMessage(s))})},onAddMessage(d){if(!this.activeChat)return;const r=re();let s=d.data;if(this.activeChat.session_id==s.session_id){if(s.displayName=s.name||s.nickname,s.dispayTime=ee(s.create_time),s.uid=Z(32),s.loading=!1,s.menu_json&&typeof s.menu_json=="string"&&(s.menu_json=JSON.parse(s.menu_json)),s.quote_file&&typeof s.quote_file=="string"&&(s.quote_file=JSON.parse(s.quote_file)),s.reply_content_list&&typeof s.reply_content_list=="string")try{s.reply_content_list=JSON.parse(s.reply_content_list)}catch{s.reply_content_list=[]}this.messageList.push(s),r.emit("onAddMessage",s)}},onAddReceiver(d){let r=d.data;r.displayName=r.name||r.nickname,r.come_from=JSON.parse(r.come_from);let s=this.receiverList.findIndex(n=>n.session_id==r.session_id);s!==-1?this.receiverList.splice(s,1,r):(this.selectedRobotId==""||this.selectedRobotId==r.robot_id)&&this.receiverList.unshift(r)},onDeleteReceiver(d){let r=d.data,s=this.receiverList.findIndex(n=>n.id==r);s!=-1&&(this.activeChat&&this.activeChat.id==r&&(this.activeChat=null),this.receiverList.splice(s,1))},async getRobotList(d){try{const r=await pe(d);return this.robotList=r.data||[],r}catch(r){throw console.error("Failed to get robot list:",r),r}},async getReceiverList(d){d!=null&&d.page?this.receiverListPage.page=d.page:this.receiverListPage.page++;const r={...this.receiverListPage,robot_id:this.selectedRobotId,...d};try{const s=await Re(r);let n=s.data.list||[];for(let e=0;e<n.length;e++)if(n[e].displayName=n[e].name||n[e].nickname,n[e].come_from)try{n[e].come_from=JSON.parse(n[e].come_from)}catch(u){console.error("Failed to parse come_from:",u)}return this.receiverListPage.page===1?this.receiverList=n:this.receiverList=this.receiverList.concat(n),s}catch(s){throw console.error("Failed to get receiver list:",s),this.receiverListPage.page>1&&this.receiverListPage.page--,s}},changeRobot(d){this.activeChat=null,this.resetReceiverList(d)},resetReceiverList(d){return this.receiverListPage.page=0,this.receiverList=[],this.getReceiverList(d)},async getChatMessage(){if(this.messageListLoading)return;this.messageListLoading=!0;let d=0,r=this.messageList.filter(n=>!n.isWelcome);r.length>0&&(d=r[0].id);let s={robot_key:this.activeChat.robot_key,openid:this.activeChat.openid,min_id:d,size:this.chatMessagePageSize,rel_user_id:this.activeChat.rel_user_id};return Me(s).then(n=>{var L,g;this.messageListLoading=!1;let e=n.data.list||[];const u=((L=n==null?void 0:n.data)==null?void 0:L.customer)||{},v=((g=n==null?void 0:n.data)==null?void 0:g.robot)||{};e.sort((a,f)=>a.id-f.id);for(let a=0;a<e.length;a++){if(e[a].displayName=e[a].name||e[a].nickname,e[a].is_customer==1?(e[a].displayName=e[a].displayName||u.name,e[a].avatar=e[a].avatar||u.avatar):(e[a].displayName=e[a].displayName||v.robot_name,e[a].avatar=e[a].avatar||v.robot_avatar),e[a].uid=Z(32),e[a].menu_json&&typeof e[a].menu_json=="string"&&(e[a].menu_json=JSON.parse(e[a].menu_json)),e[a].quote_file&&typeof e[a].quote_file=="string"&&(e[a].quote_file=JSON.parse(e[a].quote_file)),e[a].reply_content_list&&typeof e[a].reply_content_list=="string")try{e[a].reply_content_list=JSON.parse(e[a].reply_content_list)}catch{e[a].reply_content_list=[]}e[a].dispayTime=ee(e[a].create_time)}return this.messageList=[...e,...this.messageList],e.length<this.chatMessagePageSize&&(this.chatMessageLoadCompleted=!0),n}).catch(n=>{this.messageListLoading=!1})},claerUnread(){return Ie({id:this.selectedReceiverId})},async switchChat(d){this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.messageList=[],this.messageListScrollTop=0,this.selectedReceiverId=d.id,this.activeChat=d,this.claerUnread(),await this.getChatMessage()}}}),Ne={class:"no-data"},Be={class:"no-data-text"},De={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(d){const r=d;return(s,n)=>{const e=X;return t(),i("div",Ne,[M(e,{name:"empty",style:ue({"font-size":`${r.size}px`})},null,8,["style"]),o("div",Be,[te(s.$slots,"default",{},()=>[F(h(r.text),1)],!0)])])}}},ce=P(De,[["__scopeId","data-v-9f7736f0"]]),Oe={key:1,class:"chat-list"},Ae=["onClick"],qe={class:"avatar"},He=["src","alt"],Pe={class:"chat-info"},ze={class:"nickname"},je={class:"last-message"},Ue={class:"webapp-source"},Fe={key:0,class:"loading-wrapper"},Je={key:1,class:"finished-text"},Ee={__name:"chat-list ",emits:["switchChat"],setup(d,{expose:r,emit:s}){U.use(fe),U.use(ge),U.use(ke),U.use(ye);const n=s,e=Y(),{getReceiverList:u}=e,{receiverList:v,selectedReceiverId:L}=W(e),g=$(null);let a=null;const f=$(!1),S=$(!1),I=()=>{a=new U(g.value,{scrollY:!0,click:!0,observeDOM:!0,mouseWheel:!0,bounce:!1,scrollbar:{fade:!0,interactive:!0},pullUpLoad:!0}),a.on("pullingUp",()=>{y()})},y=async(k={})=>{if(f.value||S.value){a.finishPullUp();return}f.value=!0;try{(await u(k)).data.list.length===0&&!k.keyword&&(S.value=!0)}catch(x){console.error("加载更多数据失败:",x)}finally{f.value=!1,a.finishPullUp()}},m=k=>{n("switchChat",k)};return se(v,k=>{k.length>0&&J(()=>{a&&a.refresh()})}),oe(()=>{J(()=>{I()})}),ie(()=>{a&&a.destroy()}),r({getData:y}),(k,x)=>{const b=be;return t(),i("div",{class:"scroll-wrapper",ref_key:"scrollRef",ref:g},[C(v).length==0?(t(),z(ce,{key:0,size:"140",text:"暂无机器人接待中会话"})):(t(),i("div",Oe,[(t(!0),i(N,null,D(C(v),l=>(t(),i("div",{key:l.id,class:V(["chat-item",{active:l.id===C(L)}]),onClick:B=>m(l)},[o("div",qe,[o("img",{src:l.avatar,alt:l.displayName},null,8,He),l.unread>0?(t(),i("span",{key:0,class:V(["dot",{plus:l.unread>9}])},h(l.unread),3)):w("",!0)]),o("div",Pe,[o("div",ze,h(l.displayName),1),o("div",je,h(l.last_chat_message),1),o("div",Ue,"来自："+h(l.come_from.app_name),1)])],10,Ae))),128)),f.value?(t(),i("div",Fe,[M(b,{size:"small"}),x[0]||(x[0]=o("span",{class:"loading-text"},"加载中...",-1))])):w("",!0),S.value?(t(),i("div",Je,"没有更多了")):w("",!0)]))],512)}}},Ve=P(Ee,[["__scopeId","data-v-22be0114"]]),We={__name:"chat-message-scroll",props:{topTriggerDistance:{type:Number,default:10},bottomTriggerDistance:{type:Number,default:40},isLoading:{type:Boolean,default:!1},scrollTop:{type:Number,default:0}},emits:["scroll-top","scroll-bottom","scroll"],setup(d,{expose:r,emit:s}){const n=d,e=s,u=$(null),v=$({scrollTop:0,scrollHeight:0,clientHeight:0,scrollDirection:"down",scrollStartDiff:n.topTriggerDistance,scrollEndDiff:n.bottomTriggerDistance}),L=$(null),g=m=>{const{scrollTop:k}=m,x=v.value.scrollTop-k;v.value.scrollDirection=x>0?"up":"down",Object.assign(v.value,{scrollTop:k,scrollHeight:m.scrollHeight,clientHeight:m.clientHeight})},a=()=>{const{scrollTop:m,scrollHeight:k,clientHeight:x,scrollStartDiff:b,scrollEndDiff:l,scrollDirection:B}=v.value;e("scroll",{...v.value}),n.isLoading||(Math.abs(m)<=b&&B==="up"&&e("scroll-top",{...v.value}),Math.abs(k-m-x)<=l&&B==="down"&&e("scroll-bottom",{...v.value}))},f=m=>{g(m.target),L.value&&(clearTimeout(L.value),L.value=null),L.value=setTimeout(()=>{a()},100)};function S(){u.value&&(u.value.scrollTop=0)}function I(){u.value&&(u.value.scrollTop=u.value.scrollHeight)}function y(){return u.value&&Object.assign(v.value,{scrollTop:u.value.scrollTop,scrollHeight:u.value.scrollHeight,clientHeight:u.value.clientHeight}),JSON.parse(JSON.stringify(v.value))}return se(()=>n.scrollTop,m=>{u.value&&(u.value.scrollTop=m)}),r({scrollToTop:S,scrollToBottom:I,getState:y}),(m,k)=>(t(),i("div",{class:"chat-message-scroll",ref_key:"scrollContainer",ref:u,onScroll:f},[te(m.$slots,"default",{},void 0,!0)],544))}},Ye=P(We,[["__scopeId","data-v-3e3a1c2e"]]),Ge={class:"chat-message-warpper"},Qe={class:"chat-message-content"},Xe={key:0,class:"is-loaded"},Ke={class:"avatar"},Ze=["src","alt"],et={class:"message-content"},tt={class:"message-info"},st={class:"nickname"},ot={class:"time"},it={key:0,class:"reply-list"},at={key:0,class:"reply-item reply-text"},nt=["innerHTML"],lt={key:1,class:"reply-item reply-image"},rt={class:"message-content"},ct=["src"],dt={key:2,class:"reply-item reply-url"},_t={class:"url-row"},ut=["href"],ht={key:3,class:"reply-item reply-card"},pt={class:"card-row"},mt=["src"],vt={class:"card-title-box"},ft={class:"card-title"},gt={key:4,class:"reply-item reply-imageText"},yt=["href"],kt=["src"],bt={class:"imageText-text"},Lt={class:"imageText-title"},Tt={class:"imageText-desc"},wt={key:5,class:"reply-item reply-smartMenu"},St={class:"smart-menu-box"},xt={key:0,class:"card-title"},Ct={class:"card-text"},$t={key:0,class:"line-text"},Rt={key:1,class:"empty-line"},Mt=["innerHTML"],It={key:3,href:"javascript:;",class:"link"},Nt={key:0},Bt={key:1,class:"message-bubble"},Dt={key:0,class:"text-content"},Ot={key:1},At={key:1,class:"image-content"},qt=["src"],Ht={key:2,class:"image-content"},Pt=["src"],zt={key:3,class:"menu-content"},jt={class:"menus-label"},Ut={key:0,class:"menu-items"},Ft=["onClick"],Jt={key:4,class:"answer-reference-box"},Et=["onClick"],Vt={__name:"chat-message",emits:["openLibrary"],setup(d,{expose:r,emit:s}){const n=s,e=$(null),u=Y(),{getChatMessage:v}=u,{messageList:L,messageListScrollTop:g,messageListLoading:a,chatMessageLoadCompleted:f,activeChat:S}=W(u),I=()=>{};function y(T,p,R){let q=K(T);p.robot_key=S.value.robot_key,p.robot_id=S.value.robot_id,q.forEach(c=>{c.message_id=R.id,c.openid=R.openid,c.robot_key=S.value.robot_key,c.robot_id=S.value.robot_id}),n("openLibrary",q,K(p))}function m(T){const p=[];return(Array.isArray(T)?T:[]).forEach(R=>{const q=String((R==null?void 0:R.menu_type)||""),c=String((R==null?void 0:R.content)||"");if(q==="0")if(c==="")p.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(c)){const G=/href\s*=\s*['"]\s*#\s*['"]/i.test(c)?c.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):c.replace(/href=/ig,'target="_blank" href=');p.push({kind:"html",html:G})}else p.push({kind:"text",text:c});else q==="1"&&p.push({kind:"keyword",text:c,serial_no:(R==null?void 0:R.serial_no)||""})}),p.slice(0,20)}const k=T=>{const{scrollTop:p}=T;g.value=p},x=async()=>{if(f.value)return;let T=e.value.getState();await v(),J(()=>{let p=e.value.getState();p.scrollDirection=="up"&&(g.value=p.scrollHeight-T.scrollHeight)})},b=async()=>{},l=()=>{e.value.scrollToBottom()},B=()=>{e.value.scrollToTop()};function A(T){try{return T?Array.isArray(T)?T:typeof T=="string"?JSON.parse(T||"[]"):[]:[]}catch{return[]}}return r({scrollToTop:B,scrollToBottom:l}),(T,p)=>{const R=X,q=ae("viewer");return t(),i("div",Ge,[M(Ye,{ref_key:"scrollViewRef",ref:e,scrollTop:C(g),"onUpdate:scrollTop":p[0]||(p[0]=c=>le(g)?g.value=c:null),"is-loading":C(a),onScroll:k,onScrollTop:x,onScrollBottom:b},{default:H(()=>[o("div",Qe,[C(f)?(t(),i("div",Xe,"没用更多聊天记录了")):w("",!0),(t(!0),i(N,null,D(C(L),(c,G)=>(t(),i("div",{key:G,class:V(["message-item",c.is_customer==0?"right":""])},[o("div",Ke,[o("img",{src:c.avatar,alt:c.displayName},null,8,Ze)]),o("div",et,[o("div",tt,[o("span",st,h(c.displayName),1),p[1]||(p[1]=o("i",{class:"gap"},null,-1)),o("span",ot,h(c.dispayTime),1)]),A(c.reply_content_list).length?(t(),i("div",it,[(t(!0),i(N,null,D(A(c.reply_content_list),(_,j)=>{var E;return t(),i(N,{key:j},[(_.reply_type||_.type)==="text"?(t(),i("div",at,[o("div",{class:"message-content",innerHTML:_.description},null,8,nt)])):(_.reply_type||_.type)==="image"?(t(),i("div",lt,[o("div",rt,[ne(o("img",{class:"msg-img",src:_.pic||_.thumb_url},null,8,ct),[[q]])])])):(_.reply_type||_.type)==="url"?(t(),i("div",dt,[o("div",_t,[o("a",{class:"url-link",href:_.url,target:"_blank"},h(_.url),9,ut)])])):(_.reply_type||_.type)==="card"?(t(),i("div",ht,[o("div",pt,[_.thumb_url?(t(),i("img",{key:0,src:_.thumb_url,class:"card-thumb"},null,8,mt)):w("",!0),o("div",vt,[M(R,{class:"think-icon",name:"applet"}),o("span",ft,h(_.title),1)])])])):(_.reply_type||_.type)==="imageText"?(t(),i("div",gt,[o("a",{class:"imageText-row",href:_.url,target:"_blank"},[_.thumb_url?(t(),i("img",{key:0,src:_.thumb_url,class:"imageText-thumb"},null,8,kt)):w("",!0),o("div",bt,[o("div",Lt,h(_.title),1),o("div",Tt,h(_.description),1)])],8,yt)])):(_.reply_type||_.type)==="smartMenu"?(t(),i("div",wt,[o("div",St,[_.smart_menu&&_.smart_menu.menu_description?(t(),i("div",xt,h(_.smart_menu.menu_description),1)):w("",!0),o("div",Ct,[(t(!0),i(N,null,D(m(((E=_.smart_menu)==null?void 0:E.menu_content)||[]),(O,de)=>(t(),i("div",{key:de,class:"reply-line"},[O.kind==="text"?(t(),i("span",$t,h(O.text),1)):O.kind==="newline"?(t(),i("div",Rt)):O.kind==="html"?(t(),i("span",{key:2,innerHTML:O.html},null,8,Mt)):O.kind==="keyword"?(t(),i("a",It,[O.serial_no?(t(),i("div",Nt,h(O.serial_no),1)):w("",!0),F(" "+h(O.text),1)])):w("",!0)]))),128))])])])):w("",!0)],64)}),128))])):w("",!0),c.msg_type==1&&c.content==""?w("",!0):(t(),i("div",Bt,[c.msg_type==1?(t(),i("div",Dt,[c.is_customer==0?(t(),z(Ce,{key:0,content:c.content},null,8,["content"])):(t(),i("div",Ot,h(c.content),1))])):c.received_message_type=="image"&&c.media_id_to_oss_url?(t(),i("div",At,[o("img",{src:c.media_id_to_oss_url,alt:"image"},null,8,qt)])):c.msg_type==3?(t(),i("div",Ht,[o("img",{src:c.content,alt:"image"},null,8,Pt)])):c.msg_type==2?(t(),i("div",zt,[o("div",jt,h(c.menu_json.content),1),c.menu_json.question&&c.menu_json.question.length>0?(t(),i("div",Ut,[(t(!0),i(N,null,D(c.menu_json.question,(_,j)=>(t(),i("div",{key:j,class:"menu-item",onClick:E=>I(_)},h(_),9,Ft))),128))])):w("",!0)])):w("",!0),c.quote_file&&c.quote_file.length?(t(),i("div",Jt,[p[2]||(p[2]=o("div",{class:"answer-reference-label"},"回答参考",-1)),o("div",null,[(t(!0),i(N,null,D(c.quote_file,(_,j)=>(t(),i("div",{class:"list-item",key:j},[M(R,{name:"attachment"}),o("span",{onClick:E=>y(c.quote_file,_,c)},h(_.file_name),9,Et)]))),128))])])):w("",!0)]))])],2))),128))])]),_:1},8,["scrollTop","is-loading"])])}}},Wt=P(Vt,[["__scopeId","data-v-402b3185"]]),Yt={class:"library-info-content"},Gt={class:"file-list"},Qt=["onClick"],Xt={class:"document-items"},Kt={class:"document-item-header"},Zt={class:"left-box"},es={class:"document-title"},ts={key:0,class:"document-title"},ss={class:"document-size"},os={class:"document-item-body"},is={class:"document-similarity"},as={key:0,class:"document-content"},ns={key:1,class:"document-content"},ls={class:"document-content"},rs={class:"fragment-img"},cs=["src"],ds={__name:"library-info-alert",setup(d,{expose:r}){const s=he(),n=$(!1),e=$([]),u=$(null),v=()=>{e.value=[],u.value=null},L=(y,m)=>{v(),e.value=y,u.value=m.id,n.value=!0,f(m)},g=y=>{y.id!=u.value&&(u.value=y.id,f(y))},a=$([]),f=y=>{$e({message_id:y.message_id,file_id:y.id,robot_key:y.robot_key,openid:y.openid}).then(m=>{a.value=m.data||[]})},S=()=>{s.push("/library/preview?id="+u.value)},I=()=>{n.value=!1};return r({open:L}),(y,m)=>{const k=X,x=Te,b=ae("viewer");return t(),z(x,{class:"library-info-alert",open:n.value,"onUpdate:open":m[0]||(m[0]=l=>n.value=l),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:H(()=>[o("span",{class:"close-btn",onClick:I},[M(C(Le))])]),default:H(()=>[o("div",Yt,[o("div",Gt,[(t(!0),i(N,null,D(e.value,l=>(t(),i("div",{class:V(["file-item",{active:u.value==l.id}]),key:l.id,onClick:B=>g(l)},h(l.file_name),11,Qt))),128))]),o("div",Xt,[(t(!0),i(N,null,D(a.value,l=>(t(),i("div",{class:"document-item",key:l.id},[o("div",Kt,[o("div",Zt,[o("span",es,"id："+h(l.id),1),l.title?(t(),i("span",ts,h(l.title),1)):w("",!0),o("span",ss," 共"+h(l.word_total)+"个字符 ",1)]),o("div",{class:"right-box"},[o("a",{onClick:S},"查看源文档>")])]),o("div",os,[o("div",is,[m[1]||(m[1]=F(" 相似度： ")),M(k,{name:"similarity",style:{"font-size":"16px"}}),F(h(l.similarity),1)]),l.question?(t(),i("div",as,"Q："+h(l.question),1)):w("",!0),l.answer?(t(),i("div",ns,"A："+h(l.answer),1)):w("",!0),o("div",ls,h(l.content),1),ne((t(),i("div",rs,[(t(!0),i(N,null,D(l.images,(B,A)=>(t(),i("img",{key:A,src:B,alt:""},null,8,cs))),128))])),[[b]])])]))),128))])])]),_:1},8,["open"])}}},_s=P(ds,[["__scopeId","data-v-3e30a1b1"]]),us={key:0,class:"chat-box-warpper"},hs={class:"chat-box-header"},ps={class:"nickname"},ms={class:"chat-source"},vs={class:"chat-box-content"},fs={key:1},gs={__name:"chat-box",setup(d,{expose:r}){const s=Y(),{activeChat:n}=W(s),e=$(null),u=()=>{e.value.scrollToBottom()},v=()=>{e.value.scrollToTop()},L=$(null),g=(a,f)=>{L.value.open(a,f)};return r({scrollToTop:v,scrollToBottom:u}),(a,f)=>(t(),i(N,null,[C(n)?(t(),i("div",us,[o("div",hs,[o("div",ps,h(C(n).name||C(n).nickname),1),o("div",ms," 来自："+h(C(n).come_from.robot_name)+" - "+h(C(n).come_from.app_name),1)]),o("div",vs,[M(Wt,{ref_key:"chatMessageRef",ref:e,onOpenLibrary:g},null,512)])])):(t(),i("div",fs)),M(_s,{ref_key:"libraryInfoAlertRef",ref:L},null,512)],64))}},ys=P(gs,[["__scopeId","data-v-1d47d849"]]),ks={class:"chat-monitor-page"},bs={class:"page-left"},Ls={class:"app-list-box"},Ts={class:"search-box"},ws={class:"chat-list-wrapper"},Ss={class:"page-body"},xs={__name:"index",setup(d){const r=re(),s=Y(),{init:n,changeRobot:e,switchChat:u,closeIM:v}=s,{robotList:L,selectedRobotId:g,activeChat:a}=W(s),f=$(null),S=$(null),I=$(""),y=()=>{const b={keyword:I.value,page:1};e(b)},m=async b=>{var l;await u(b),(l=S.value)==null||l.scrollToBottom()},k=()=>{J(()=>{var b;(b=S.value)==null||b.scrollToBottom()})},x=()=>{const b={keyword:I.value,page:1};f.value&&f.value.getData(b)};return oe(async()=>{await n(),J(()=>{var b;(b=S.value)==null||b.scrollToBottom()}),r.on("onAddMessage",k)}),ie(()=>{r.off("onAddMessage",k),v()}),(b,l)=>{const B=we,A=Se,T=xe;return t(),i("div",ks,[o("div",bs,[o("div",Ls,[M(A,{value:C(g),"onUpdate:value":l[0]||(l[0]=p=>le(g)?g.value=p:null),style:{width:"100%"},onChange:y},{default:H(()=>[M(B,{value:""},{default:H(()=>l[2]||(l[2]=[F("全部应用")])),_:1,__:[2]}),(t(!0),i(N,null,D(C(L),p=>(t(),z(B,{value:p.id,key:p.id},{default:H(()=>[o("span",null,h(p.robot_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),o("div",Ts,[M(T,{value:I.value,"onUpdate:value":l[1]||(l[1]=p=>I.value=p),placeholder:"搜索客户昵称或openld，按enter搜索","enter-button":"",style:{width:"100%"},onSearch:x,allowClear:"",onPressEnter:x},null,8,["value"])]),o("div",ws,[M(Ve,{ref_key:"chatListRef",ref:f,onSwitchChat:m},null,512)])]),o("div",Ss,[C(a)?(t(),z(ys,{key:0,ref_key:"chatBoxRef",ref:S},null,512)):(t(),z(ce,{key:1,style:{background:"#F2F4F7"},size:"250"},{default:H(()=>l[3]||(l[3]=[o("div",null,[o("p",null,"请在左侧列表先选择会话"),o("p",null,"通过本功能，可以实时查看机器人接待中的会话消息，监控机器人回复效果")],-1)])),_:1,__:[3]}))])])}}},Ps=P(xs,[["__scopeId","data-v-c690c066"]]);export{Ps as default};
