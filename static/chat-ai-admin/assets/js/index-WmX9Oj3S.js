import{f as p,e as K,w as X,o as Y,j as z,Y as s,_ as d,a5 as g,n as U,F as T,ae as h,G as x,a7 as y,A as Q,a9 as C,B as b}from"./vue-chunks-BSjLwu6d.js";import{b as Z,ag as j,ah as ee}from"../../index-0SFcfYGN.js";import{h as le}from"./index-B3eanVnA.js";const oe={class:"selected-item"},ne=["src"],te={key:0},ae={key:1,class:"placeholder"},se={key:0,class:"option-group"},de=["src"],ie=["onClick"],ce={__name:"index",props:{modelValue:[String,Number],modelType:{type:String,validator:a=>["TEXT EMBEDDING","RERAN","LLM"].includes(a),required:!0},isOffline:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择模型"},groupLabelKey:{type:String,default:"groupLabel"},groupIconKey:{type:String,default:"groupIcon"},iconKey:{type:String,default:"icon"},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},showValue:{type:Boolean,default:!0},modelConfigId:{type:String,default:""}},emits:["update:modelValue","change","loaded"],setup(a,{emit:R}){const m=a,k=R,f=p(!1),M=p(m.placeholder),I=p([]),w=["azure","ollama","xinference","openaiAgent","doubao"],A=["doubao"],D=K(()=>I.value.map(e=>({groupLabel:e.name,groupIcon:e.icon,children:e.children.map(o=>({icon:o.icon,use_model_name:o.use_model_name,show_model_name:o.show_model_name,value:o.show_model_name?o.show_model_name:w.includes(o.model_define)&&o.deployment_name?o.deployment_name:o.name,rawData:o}))}))),r=K(()=>{const{modelConfigId:e,modelValue:o}=m;let n={};if(!(!e&&!o))return $.value.find(l=>{const{rawData:t}=l;w.includes(t.model_define)&&t.deployment_name?(t.deployment_name===o||t.id===e)&&(n=l):t.name===o&&t.id===e&&(n=l)}),n}),$=K(()=>D.value.reduce((e,o)=>e.concat(o.children||[]),[]));function G(e,o,n){const l=new Set(e.map(t=>t.model_define));return o.filter(t=>{let i=t[n];l.has(i)&&e.filter(c=>{if(c.model_define==i)return c.children=ee(c.children,t.children),!1})}),e}const u=p(0),H=p(!1),P=e=>{const o=e.currentTarget,n=e.deltaY,l=o.scrollHeight-o.clientHeight,t=u.value+n<=0,i=u.value+n>=l;e.stopPropagation(),!t&&!i?(o.scrollTop+=n,e.preventDefault()):u.value===0&&n<0||u.value===l&&n>0?H.value=!1:(o.scrollTop=Math.max(0,Math.min(l,u.value+n)),e.preventDefault()),u.value=o.scrollTop},q=()=>{f.value=!f.value},F=e=>{k("update:modelValue",e[m.valueKey]),k("change",e),f.value=!1},E=e=>{e.target.closest(".custom-select")||(f.value=!1)};let S={};const N=()=>{le({model_type:m.modelType,is_offline:m.isOffline}).then(e=>{let n=(e.data||[]).map(l=>{let{model_define:t,deployment_name:i,id:c}=l.model_config;S={...S,...l.choosable_thinking};let J=`${t}-${i||""}-${c}`,_=[],O=[];m.modelType=="TEXT EMBEDDING"?_=l.model_info.vector_model_list:m.modelType=="RERANK"?_=l.model_info.rerank_model_list:m.modelType=="LLM"&&(_=l.model_info.llm_model_list);for(let L=0;L<_.length;L++){let v=_[L],B=v,W=c+"-"+v;w.indexOf(l.model_config.model_define)>-1&&l.model_config.deployment_name&&(B=l.model_config.deployment_name);let V="";A.includes(l.model_config.model_define)&&(V=l.model_config.show_model_name),O.push({key:c+"_"+v,label:B,name:v,deployment_name:i,model_config_id:c,model_define:t,value:W,id:l.model_config.id,show_model_name:V,icon:l.model_info.model_icon_url,use_model_name:l.model_info.model_name})}return{key:J,model_define:t,children:O,model_config_id:c,deployment_name:i,name:l.model_info.model_name,icon:l.model_info.model_icon_url}});n=G(j(n,"model_define"),n,"model_define"),n.length===0&&(M.value="无可用模型"),I.value=[...n],k("loaded",JSON.parse(JSON.stringify(n)),S)})};return X(()=>m.isOffline,()=>{N()}),Y(()=>{N(),document.addEventListener("click",E)}),z(()=>{document.removeEventListener("click",E)}),(e,o)=>(d(),s("div",{class:"custom-select",onClick:b(q,["stop"])},[g("div",oe,[r.value?(d(),s(T,{key:0},[r.value[a.iconKey]?(d(),s("img",{key:0,src:r.value[a.iconKey],class:"model-icon"},null,8,ne)):h("",!0),g("span",null,[x(y(r.value[a.labelKey])+" ",1),a.showValue&&r.value[a.valueKey]?(d(),s("span",te,y(r.value[a.valueKey]),1)):h("",!0)])],64)):(d(),s("span",ae,y(M.value),1))]),U(g("div",{class:"custom-options",onWheel:b(P,["prevent"])},[(d(!0),s(T,null,C(D.value,(n,l)=>(d(),s("div",{key:l},[n.groupLabel?(d(),s("div",se,[n[a.groupIconKey]?(d(),s("img",{key:0,src:n[a.groupIconKey],class:"model-icon"},null,8,de)):h("",!0),x(" "+y(n[a.groupLabelKey]),1)])):h("",!0),(d(!0),s(T,null,C(n.children,(t,i)=>(d(),s("div",{key:i,class:"option-item",onClick:b(c=>F(t),["stop"])},[g("span",null,y(t[a.valueKey]),1)],8,ie))),128))]))),128))],544),[[Q,f.value]])]))}},fe=Z(ce,[["__scopeId","data-v-2590d315"]]);export{fe as C};
