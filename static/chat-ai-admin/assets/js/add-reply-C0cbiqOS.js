import{u as ae,au as re,_ as _e}from"../../index-DSFcP5NQ.js";import{r as C,ah as ne,c as se,E as le,w as S,j as oe,a as U,y as s,p as v,t as l,ag as ie,b as k,v as i,u as n,_ as p,e as x,q as R,F as ue,l as pe}from"./vue-chunks-BdaA73Wf.js";import{M as de}from"./multi-reply-Ck3cS9Gg.js";import{r as ye,t as me}from"./index-C67uUbSa.js";import{d as Y}from"./utils-CvB22N-W.js";import{_ as ce}from"./emoji-mart-BBMRoEa3.js";import{b as h,j as ge,F as ve,k as fe,c as ke,H as be,q as we,ac as he,r as Ae,s as xe,u as Re,v as Ye,P as Me,aW as Ce,G as De,E as Se,B as Ue,a1 as Pe}from"./ui-antd-Dl1wwwCD.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";import"./index-B_UHbFfL.js";import"./index-Cg7-0swo.js";const Ne={class:"subManage-edit"},Be=["href"],qe={class:"main"},Ie={class:"ml4"},Te={class:"item-box"},Oe={class:"tip-box"},je={class:"tip-box",style:{color:"red"}},Ee={class:"flex-center"},$e={class:"ml4"},Fe={key:4,style:{"margin-left":"98px"}},He={class:"nav-box",style:{"margin-top":"24px"}},Ve={class:"item-box"},ze={class:"radio-container"},Le={class:"btn-container"},We={__name:"add-reply",setup(Ge){const{t:a}=ae("views.robot.robot-config.auto-reply.add-reply"),P=C([]),f=ne().query,M=C(+f.rule_id||+f["rule-id"]||0),c=C(f.rule_type||"receive_reply_duration"),I=ie(),T=se(()=>`/#/robot/ability/auto-reply?id=${f.id}&robot_key=${f.robot_key}&active_key=received&rule_type=${c.value}`),N=C(null),e=le({duration_type:"day",reply_period:[],priority_num:null,week_day:["1"],week_duration:["1"],date_range:[],start_day:"",end_day:"",reply_num:"0",message_type:"0",message_type_list:[],reply_interval:0,switch_status:!0}),O={name:[{required:!0,message:a("msg_input_rule_name"),trigger:"blur"}]},j=re();function E(o,_){return e.duration_type!=="time_range"||Array.isArray(_)&&_.length===2&&_[0]&&_[1]?Promise.resolve():Promise.reject(a("msg_select_date_range"))}function $(o,_){return e.duration_type!=="week"||Array.isArray(_)&&_.length>0?Promise.resolve():Promise.reject(a("msg_select_at_least_one_week"))}S(()=>e.duration_type,o=>{o==="week"?((!Array.isArray(e.week_day)||e.week_day.length===0)&&(e.week_day=["1"]),e.week_duration=Array.isArray(e.week_day)?e.week_day:[e.week_day]):o==="time_range"&&Array.isArray(e.date_range)&&e.date_range.length===2&&e.date_range[0]&&e.date_range[1]?(e.start_day=Y(e.date_range[0]).format("YYYY-MM-DD"),e.end_day=Y(e.date_range[1]).format("YYYY-MM-DD")):(e.start_day="",e.end_day="")}),S(()=>e.week_day,o=>{e.duration_type==="week"&&(e.week_duration=Array.isArray(o)?o:[o])}),S(()=>e.date_range,o=>{e.duration_type==="time_range"&&Array.isArray(o)&&o.length===2&&o[0]&&o[1]&&(e.start_day=Y(o[0]).format("YYYY-MM-DD"),e.end_day=Y(o[1]).format("YYYY-MM-DD"))});const y=C([{type:"text",description:""}]),F=()=>{if(y.value.length>=5){h.warning(a("msg_max_reply_content"));return}y.value.push({type:"text",description:""})},H=o=>{const{reply_index:_,...d}=o;_>=0&&_<y.value.length&&(y.value[_]=d)},V=o=>{y.value.splice(o,1)},z=()=>{};function L(o){return(o||[]).map(_=>({..._,status:"1"}))}function W(o){const _={text:"2",image:"4",card:"3",imageText:"1",url:"5",smartMenu:"6"};return o.map(d=>_[d.type]||"").filter(Boolean)}const G=()=>{var o;(o=N.value)==null||o.validate().then(async()=>{if(!y.value.length){h.warning(a("msg_at_least_one_reply"));return}if(c.value==="receive_reply_duration"){if(!e.reply_period||e.reply_period.length!==2){h.warning(a("msg_select_reply_period_warning"));return}const t=Number(e.priority_num);if(!Number.isInteger(t)||t<1||t>100){h.warning(a("msg_priority_range"));return}if(e.duration_type==="time_range"&&!(Array.isArray(e.date_range)&&e.date_range.length===2&&e.date_range[0]&&e.date_range[1])){h.warning(a("msg_select_custom_date_range"));return}}if(c.value==="receive_reply_message_type"&&e.message_type==="1"&&(!Array.isArray(e.message_type_list)||e.message_type_list.length===0)){h.warning(a("msg_select_message_type"));return}for(const t of P.value)if(t&&t.validate&&!await t.validate())return;const _={robot_id:f.id,switch_status:e.switch_status?"1":"0",rule_type:c.value,reply_interval:Number(e.reply_interval)||0,reply_content:JSON.stringify(L(y.value)),reply_type:W(y.value),reply_num:e.reply_num};let d={};c.value==="receive_reply_message_type"?d={message_type:e.message_type,specify_message_type:Array.isArray(e.message_type_list)?e.message_type_list.join(","):""}:d={duration_type:e.duration_type,start_day:e.start_day,end_day:e.end_day,week_duration:e.week_duration,priority_num:Number(e.priority_num)||0,start_duration:Array.isArray(e.reply_period)&&e.reply_period[0].toString()||"",end_duration:Array.isArray(e.reply_period)&&e.reply_period[1].toString()||""};const w={..._,...d};M.value&&(w.id=M.value);try{const t=await me(w);t&&t.res==0&&(h.success(a("msg_save_success")),I.push({path:"/robot/ability/auto-reply",query:{id:f.id,robot_key:f.robot_key,active_key:"received",rule_type:c.value}}))}catch{}})};return oe(async()=>{const o=+(f.copy_id||0),_=async d=>{const w=await ye({id:d,robot_id:f.id}),t=(w==null?void 0:w.data)||{};if(c.value=(t==null?void 0:t.rule_type)||c.value,e.switch_status=String((t==null?void 0:t.switch_status)||"0")==="1",e.duration_type=(t==null?void 0:t.duration_type)||e.duration_type,e.duration_type==="week"){const r=Array.isArray(t==null?void 0:t.week_duration)?t.week_duration.map(g=>String(g)):[];e.week_day=r.length?r:["1"],e.week_duration=[...e.week_day]}if(e.duration_type==="time_range"||e.duration_type==="day"){const r=(t==null?void 0:t.start_day)||"",g=(t==null?void 0:t.end_day)||"";r&&g&&(e.date_range=[Y(r),Y(g)])}const A=(t==null?void 0:t.start_duration)||"",m=(t==null?void 0:t.end_duration)||"";e.reply_period=[A,m].filter(Boolean).length===2?[A,m]:[],e.start_duration=A,e.end_duration=m,e.priority_num=Number((t==null?void 0:t.priority_num)||e.priority_num||0),e.message_type=String((t==null?void 0:t.message_type)??e.message_type),e.message_type_list=Array.isArray(t==null?void 0:t.specify_message_type)?t.specify_message_type:[],e.reply_interval=Number((t==null?void 0:t.reply_interval)||0);const b=Array.isArray(t==null?void 0:t.reply_content)?t.reply_content:[];y.value=b.map(r=>({type:(r==null?void 0:r.type)||(r==null?void 0:r.reply_type)||"text",description:(r==null?void 0:r.description)||"",thumb_url:(r==null?void 0:r.thumb_url)||(r==null?void 0:r.pic)||"",title:(r==null?void 0:r.title)||"",url:(r==null?void 0:r.url)||"",appid:(r==null?void 0:r.appid)||"",page_path:(r==null?void 0:r.page_path)||"",smart_menu_id:(r==null?void 0:r.smart_menu_id)||"",smart_menu:(r==null?void 0:r.smart_menu)||{}})),e.reply_num=String((t==null?void 0:t.reply_num)??e.reply_num)};try{if(!M.value&&o){await _(o);return}if(!M.value)return;await _(M.value)}catch{h.error(a("msg_load_failed"))}}),(o,_)=>{const d=fe,w=ge,t=we,A=be,m=ke,b=xe,r=Ae,g=Ye,J=Re,Q=Me,K=Ce,B=De,X=Se,Z=_e,q=Ue,ee=ve;return k(),U("div",Ne,[s(w,{class:"subManage-breadcrumb"},{default:l(()=>[s(d,null,{default:l(()=>[v("a",{href:T.value},i(n(a)("breadcrumb_received_reply")),9,Be)]),_:1}),s(d,null,{default:l(()=>[p(i(c.value==="receive_reply_message_type"?n(a)("breadcrumb_add_reply"):n(a)("breadcrumb_add_time_reply")),1)]),_:1})]),_:1}),v("div",qe,[s(ee,{ref_key:"formRef",ref:N,model:e,rules:O},{default:l(()=>[s(m,{name:"switch_status",rules:[{required:!0,message:n(a)("msg_input_rule_name")}]},{label:l(()=>[p(i(n(a)("label_enable"))+" ",1),s(t,null,{title:l(()=>[p(i(n(a)("tip_enable")),1)]),default:l(()=>[v("span",Ie,[s(n(he))])]),_:1})]),default:l(()=>[s(A,{checked:e.switch_status,"onUpdate:checked":_[0]||(_[0]=u=>e.switch_status=u),"checked-children":n(a)("switch_on"),"un-checked-children":n(a)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1},8,["rules"]),c.value==="receive_reply_duration"?(k(),x(m,{key:0,name:"duration_type",label:n(a)("label_select_reply_time")},{default:l(()=>[v("div",Te,[s(m,{name:"duration_type",rules:[{required:!0,message:n(a)("msg_select_reply_time_type")}]},{default:l(()=>[s(r,{value:e.duration_type,"onUpdate:value":_[1]||(_[1]=u=>e.duration_type=u)},{default:l(()=>[s(b,{value:"week"},{default:l(()=>[p(i(n(a)("radio_every_week")),1)]),_:1}),s(b,{value:"day"},{default:l(()=>[p(i(n(a)("radio_every_day")),1)]),_:1}),s(b,{value:"time_range"},{default:l(()=>[p(i(n(a)("radio_custom_time")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["rules"]),e.duration_type==="week"?(k(),x(m,{key:0,name:"week_day",rules:[{validator:$}]},{default:l(()=>[s(J,{value:e.week_day,"onUpdate:value":_[2]||(_[2]=u=>e.week_day=u),mode:"multiple",style:{width:"200px"},allowClear:""},{default:l(()=>[s(g,{value:"1"},{default:l(()=>[p(i(n(a)("week_monday")),1)]),_:1}),s(g,{value:"2"},{default:l(()=>[p(i(n(a)("week_tuesday")),1)]),_:1}),s(g,{value:"3"},{default:l(()=>[p(i(n(a)("week_wednesday")),1)]),_:1}),s(g,{value:"4"},{default:l(()=>[p(i(n(a)("week_thursday")),1)]),_:1}),s(g,{value:"5"},{default:l(()=>[p(i(n(a)("week_friday")),1)]),_:1}),s(g,{value:"6"},{default:l(()=>[p(i(n(a)("week_saturday")),1)]),_:1}),s(g,{value:"7"},{default:l(()=>[p(i(n(a)("week_sunday")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["rules"])):R("",!0),e.duration_type==="time_range"?(k(),x(m,{key:1,name:"date_range",rules:[{validator:E}]},{default:l(()=>[s(Q,{value:e.date_range,"onUpdate:value":_[3]||(_[3]=u=>e.date_range=u),format:"YYYY-MM-DD"},null,8,["value"])]),_:1},8,["rules"])):R("",!0)])]),_:1},8,["label"])):R("",!0),c.value==="receive_reply_duration"?(k(),x(m,{key:1,name:"reply_period",label:n(a)("label_reply_period"),rules:[{required:!0,message:n(a)("msg_select_reply_period")}]},{default:l(()=>[s(K,{value:e.reply_period,"onUpdate:value":_[4]||(_[4]=u=>e.reply_period=u),valueFormat:"HH:mm",format:"HH:mm",allowClear:!1},null,8,["value"]),v("div",Oe,i(n(a)("tip_cross_day")),1)]),_:1},8,["label","rules"])):R("",!0),c.value==="receive_reply_duration"?(k(),x(m,{key:2,name:"priority_num",label:n(a)("label_priority"),rules:[{required:!0,message:n(a)("msg_input_priority")}]},{default:l(()=>[s(B,{value:e.priority_num,"onUpdate:value":_[5]||(_[5]=u=>e.priority_num=u),style:{width:"200px"},min:1,max:100},null,8,["value"]),v("div",je,i(n(a)("tip_priority")),1)]),_:1},8,["label","rules"])):R("",!0),s(m,{class:"interval-item",name:"reply_interval",label:n(a)("label_reply_interval")},{default:l(()=>[v("div",Ee,[s(B,{value:e.reply_interval,"onUpdate:value":_[6]||(_[6]=u=>e.reply_interval=u),style:{width:"60px"}},null,8,["value"]),v("span",$e,i(n(a)("tip_reply_interval")),1)])]),_:1},8,["label"]),c.value==="receive_reply_message_type"?(k(),x(m,{key:3,class:"message-type-item",name:"message_type",label:n(a)("label_message_type")},{default:l(()=>[s(r,{value:e.message_type,"onUpdate:value":_[7]||(_[7]=u=>e.message_type=u)},{default:l(()=>[s(b,{value:"0"},{default:l(()=>[p(i(n(a)("radio_all_messages")),1)]),_:1}),s(b,{value:"1"},{default:l(()=>[p(i(n(a)("radio_specify_messages")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])):R("",!0),e.message_type==="1"?(k(),U("div",Fe,[s(X,{value:e.message_type_list,"onUpdate:value":_[8]||(_[8]=u=>e.message_type_list=u),options:n(j)},null,8,["value","options"])])):R("",!0),v("div",He,[s(Z,{name:"reply-content",style:{"font-size":"16px"}}),p(" "+i(n(a)("title_reply_content")),1)]),v("div",Ve,[(k(!0),U(ue,null,pe(y.value,(u,D)=>(k(),x(de,{key:D,ref_for:!0,ref_key:"replyRefs",ref:P,value:y.value[D],"onUpdate:value":te=>y.value[D]=te,reply_index:D,onChange:H,onDel:V},null,8,["value","onUpdate:value","reply_index"]))),128)),s(q,{type:"dashed",style:{width:"694px"},disabled:y.value.length>=5,onClick:F},{icon:l(()=>[s(n(Pe))]),default:l(()=>[p(" "+i(n(a)("btn_add_reply_content"))+"("+i(y.value.length)+"/5) ",1)]),_:1},8,["disabled"])]),s(m,{name:"reply_num",label:n(a)("label_reply_method"),style:{"margin-top":"24px"}},{default:l(()=>[v("div",ze,[s(r,{value:e.reply_num,"onUpdate:value":_[9]||(_[9]=u=>e.reply_num=u),onChange:z},{default:l(()=>[s(b,{value:"0"},{default:l(()=>[p(i(n(a)("reply_all")),1)]),_:1}),s(b,{value:"1"},{default:l(()=>[p(i(n(a)("reply_random")),1)]),_:1})]),_:1},8,["value"])])]),_:1},8,["label"]),v("div",Le,[s(q,{type:"primary",onClick:G},{default:l(()=>[p(i(n(a)("btn_save")),1)]),_:1})])]),_:1},8,["model"])])])}}},it=ce(We,[["__scopeId","data-v-f5585c25"]]);export{it as default};
//# sourceMappingURL=add-reply-C0cbiqOS.js.map
