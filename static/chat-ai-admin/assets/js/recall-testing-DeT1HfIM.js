import{b as V,d as E,bu as P}from"../../index-CPkdGIiL.js";import{_ as X}from"./cu-scroll-5W3_kglT.js";import{_ as Y}from"./empty-DkpCLaix.js";import{ab as F,f as p,r as j,e as J,Y as i,_ as n,a5 as e,ae as m,k as l,a2 as r,G as c,a1 as k,u as x,F as R,a9 as C,ad as W,a7 as d,aa as Z}from"./vue-chunks-Ci-XTWEs.js";import{_ as ee}from"./recommendation-AQ4_FPQ9.js";import{h as se}from"./index-BxiNNyyE.js";import{Q as te,B as oe,g as ne,ar as le,ab as B,p as ae,aB as ie,O as re,X as de,aC as _e,v as ce,E as ue,u as me,a as T,ah as pe,bx as ve}from"./ui-antd-Bw8cEW5z.js";import"./utils-ChQO-_r6.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const fe={class:"recall-settings-box"},ke={class:"form-box"},ye={class:"form-item"},ge={class:"form-item-body"},be={class:"form-item"},he={class:"form-item"},xe={class:"form-item-label"},$e={class:"form-item-body"},we={class:"retrieval-mode-items"},Re=["onClick"],Ce={class:"retrieval-mode-title"},qe={class:"title-text"},Le={key:0,style:{width:"32px"},src:ee,alt:""},ze={class:"retrieval-mode-desc"},Ne={class:"form-item"},Te={class:"form-item-label"},Me={class:"form-item-body"},Oe={class:"number-box"},Se={class:"number-slider-box"},Ue={class:"number-input-box"},Be={key:0,class:"form-item"},Ve={class:"form-item-label"},Ee={class:"form-item-body"},Fe={class:"number-box"},He={class:"number-slider-box"},Qe={class:"number-input-box"},Ae={class:"form-item"},De={class:"form-item-label"},Ge={class:"form-item-body"},Ie=["src"],Ke={__name:"recall-testing-form",emits:["save","load"],setup(H,{expose:q,emit:y}){const g=F(),b=p(!1),h=y,v=p(!0),u=p([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=j({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:g.query.id}),$=J(()=>v.value?u.value.filter(_=>_.value==s.search_type):u.value),L=(_,t)=>{s.rerank_model_config_id=t.rerank_model_config_id},z=_=>{s.search_type=_},a=()=>{if(!s.similarity)return T.error("请输入相似度");if(!s.size)return T.error("请输入分段数");if(!s.question)return T.error("请输入测试问题");let _={id:s.id,question:s.question,size:s.size,similarity:s.similarity,search_type:s.search_type};s.rerank_status==1&&(_.rerank_model_config_id=s.rerank_model_config_id,_.rerank_use_model=s.rerank_use_model),b.value=!0,h("load"),P(_).then(t=>{h("save",t.data)}).catch(()=>{h("save",[])}).finally(()=>{b.value=!1})},N=p([]);return(()=>{se({model_type:"RERANK"}).then(_=>{let t=_.data||[];N.value=t.map(f=>({id:f.model_config.id,name:f.model_info.model_name,icon:f.model_info.model_icon_url,children:f.model_info.rerank_model_list}))})})(),q({open}),(_,t)=>{const f=te,Q=oe,M=E,O=ae,S=ie,U=re,A=de,D=ue,G=ce,I=_e,K=me;return n(),i("div",fe,[t[16]||(t[16]=e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),e("div",ke,[e("div",ye,[e("div",ge,[l(f,{style:{height:"76px"},value:s.question,"onUpdate:value":t[0]||(t[0]=o=>s.question=o),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",be,[l(Q,{loading:b.value,onClick:a,type:"primary",block:""},{default:r(()=>t[8]||(t[8]=[c("测试")])),_:1,__:[8]},8,["loading"])]),e("div",he,[e("div",xe,[e("div",{class:"hover-label",onClick:t[1]||(t[1]=o=>v.value=!v.value)},[t[9]||(t[9]=c(" 检索模式 ")),v.value?(n(),k(x(ne),{key:0})):(n(),k(x(le),{key:1}))])]),e("div",$e,[e("div",we,[(n(!0),i(R,null,C($.value,o=>(n(),i("div",{class:W(["retrieval-mode-item",{active:s.search_type==o.value}]),key:o.value,onClick:w=>z(o.value)},[s.search_type==o.value?(n(),k(M,{key:0,class:"check-arrow",name:"check-arrow-filled"})):m("",!0),e("div",Ce,[l(M,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",qe,d(o.title),1),o.isRecommendation?(n(),i("img",Le)):m("",!0)]),e("div",ze,d(o.desc),1)],10,Re))),128))])])]),e("div",Ne,[e("div",Te,[t[11]||(t[11]=e("span",null,"Top K ",-1)),l(O,null,{title:r(()=>t[10]||(t[10]=[c("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:r(()=>[l(x(B),{class:"question-icon"})]),_:1})]),e("div",Me,[e("div",Oe,[e("div",Se,[l(S,{class:"custom-slider",value:s.size,"onUpdate:value":t[2]||(t[2]=o=>s.size=o),min:1,max:10},null,8,["value"])]),e("div",Ue,[l(U,{value:s.size,"onUpdate:value":t[3]||(t[3]=o=>s.size=o),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(n(),i("div",Be,[e("div",Ve,[t[13]||(t[13]=e("span",null,"相似度阈值 ",-1)),l(O,null,{title:r(()=>t[12]||(t[12]=[c("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:r(()=>[l(x(B),{class:"question-icon"})]),_:1})]),e("div",Ee,[e("div",Fe,[e("div",He,[l(S,{class:"custom-slider",value:s.similarity,"onUpdate:value":t[4]||(t[4]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",Qe,[l(U,{value:s.similarity,"onUpdate:value":t[5]||(t[5]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):m("",!0),e("div",Ae,[e("div",De,[t[14]||(t[14]=e("span",null,"Rerank模型",-1)),t[15]||(t[15]=c("   ")),l(A,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":t[6]||(t[6]=o=>s.rerank_status=o)},null,8,["checked"])]),e("div",Ge,[l(K,{value:s.rerank_use_model,"onUpdate:value":t[7]||(t[7]=o=>s.rerank_use_model=o),placeholder:"请选择Rerank模型",onChange:L,style:{width:"320px"}},{default:r(()=>[(n(!0),i(R,null,C(N.value,o=>(n(),k(I,{key:o.id},{label:r(()=>[l(D,{align:"center",gap:8},{default:r(()=>[e("img",{class:"model-icon",src:o.icon,alt:""},null,8,Ie),c(d(o.name),1)]),_:2},1024)]),default:r(()=>[(n(!0),i(R,null,C(o.children,w=>(n(),k(G,{value:w,rerank_model_config_id:o.id,key:w},{default:r(()=>[e("span",null,d(w),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},Pe=V(Ke,[["__scopeId","data-v-86c4388e"]]),Xe={class:"recall-testing-box"},Ye={class:"recall-from-box"},je={class:"content-list-box"},Je={key:0,class:"empty-box"},We={class:"top-block"},Ze={class:"title"},es={key:0,class:"ml4"},ss={class:"info-block"},ts=["onClick"],os={key:0},ns={class:"gray-text"},ls={key:0,class:"content-box"},as={key:1,class:"content-box"},is=["innerHTML"],rs={key:2,class:"loading-box"},ds={__name:"recall-testing",setup(H){F(),Z();const q=p(!1),y=p(!1),g=p([]),b=u=>{y.value=!1,g.value=u||[]},h=()=>{y.value=!0},v=u=>{if(!u.file_name){window.open(`/#/library/details/categary-manage?id=${u.library_id}`);return}window.open(`/#/library/preview?id=${u.file_id}`)};return(u,s)=>{const $=X,L=E,z=pe;return n(),i("div",Xe,[e("div",Ye,[l($,null,{default:r(()=>[l(Pe,{onLoad:h,onSave:b})]),_:1})]),e("div",je,[q.value||g.value.length===0?(n(),i("div",Je,s[0]||(s[0]=[e("img",{src:Y,alt:""},null,-1),e("div",{class:"title"},"暂无结果，请重试",-1)]))):(n(),k($,{key:1},{default:r(()=>[(n(!0),i(R,null,C(g.value,a=>(n(),i("div",{class:"list-item",key:a.id},[e("div",We,[e("div",Ze,[c(" id："+d(a.id)+" ",1),a.title?(n(),i("div",es,d(a.title),1)):m("",!0),e("span",null,"共"+d(a.word_total)+"个字符",1)])]),e("div",ss,[s[2]||(s[2]=e("span",{class:"gray-text"},"来自：",-1)),e("div",{class:"link-text",onClick:N=>v(a)},[l(x(ve)),c(" "+d(a.file_name)+" ",1),a.file_name?m("",!0):(n(),i("span",os,d(a.library_name)+"-精选",1))],8,ts),s[3]||(s[3]=e("span",{class:"v-line"},null,-1)),e("span",ns,[s[1]||(s[1]=c("相似度： ")),l(L,{name:"similarity",style:{"font-size":"16px"}}),c(" "+d(a.similarity),1)])]),a.question?(n(),i("div",ls,"Q："+d(a.question),1)):m("",!0),a.answer?(n(),i("div",as,"A："+d(a.answer),1)):m("",!0),e("div",{class:"content-box",innerHTML:a.content},null,8,is)]))),128))]),_:1})),y.value?(n(),i("div",rs,[l(z)])):m("",!0)])])}}},hs=V(ds,[["__scopeId","data-v-be7f9c8e"]]);export{hs as default};
