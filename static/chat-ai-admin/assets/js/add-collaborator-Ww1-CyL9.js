import{u as Q,f as W,_ as Y,B as Z}from"../../index-DSFcP5NQ.js";import{c as ee,e as te}from"./index-o_l8g-wS.js";import{_ as ae}from"./emoji-mart-BBMRoEa3.js";import{F,c as oe,r as se,s as ne,X as le,U as re,E as ie,N as _e,M as ce,b as N}from"./ui-antd-Dl1wwwCD.js";import{c as de,r as v,E as A,a as p,b as _,y as n,t as s,p as d,q as y,u as i,_ as m,v as c,F as B,l as M,e as x}from"./vue-chunks-BdaA73Wf.js";const ue={class:"form-box"},pe={key:0,class:"form-tip"},ve={key:0,class:"list-box"},me=["onClick"],fe={class:"user-block"},ye={class:"name-box"},be={class:"name"},ge={class:"remark-text"},he={key:1,class:"checkbox-list"},ke={class:"checklist-item"},xe={__name:"add-collaborator",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(Ce,{expose:O,emit:S}){const{t:l}=Q("components.add-collaborator.add-collaborator"),C=de(()=>W().role_permission||[]),q=S,E=F.useForm,b=v(!1),r=A({identity_type:"1",operate_rights:"4"}),u=v([]),f=v([]),I=a=>{a.role_type!=1&&(u.value.includes(a.id)?u.value=u.value.filter(t=>t!=a.id):u.value.push(a.id))},V=A({}),{resetFields:Le,validate:we,validateInfos:Ue}=E(r,V);let g=[],h=[];const z=(a,t)=>{R(),u.value=[],f.value=[],h=[],a.forEach(o=>{o.identity_type==1&&h.push(o.identity_id),o.identity_type==2&&f.value.push(o.identity_id)}),P(),r.operate_rights="4",r.identity_type="1",g=t,b.value=!0},k=v(!1),D=()=>{g=g.map(o=>({object_id:+o.object_id,object_type:+o.object_type,operate_rights:+r.operate_rights}));let a=[];if(r.identity_type==1?a=u.value:a=f.value,a.length==0){N.error(l("msg_select_member_or_org"));return}let t={identity_type:r.identity_type,object_array:JSON.stringify(g),identity_ids:a.join(",")};k.value=!0,te(t).then(o=>{N.success(l("msg_save_success")),b.value=!1,q("ok")}).finally(()=>{k.value=!1})},L=v([]),P=()=>{Z({page:1,size:200}).then(a=>{L.value=a.data.list.filter(t=>!h.includes(t.id))})},w=v([]),R=()=>{ee().then(a=>{let t=a.data||[];w.value=t})},T=()=>{window.open("/#/user/manage")};return O({show:z}),(a,t)=>{const o=ne,U=se,j=oe,$=le,J=Y,X=_e,G=ie,H=F,K=ce;return _(),p("div",null,[n(K,{open:b.value,"onUpdate:open":t[3]||(t[3]=e=>b.value=e),title:i(l)("title_add_collaborator"),onOk:D,width:746,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"500px","overflow-y":"auto"},confirmLoading:k.value},{default:s(()=>[d("div",ue,[n(H,{layout:"vertical"},{default:s(()=>[n(j,{label:i(l)("label_collaboration_permission"),required:""},{default:s(()=>[n(U,{value:r.operate_rights,"onUpdate:value":t[0]||(t[0]=e=>r.operate_rights=e)},{default:s(()=>[n(o,{value:"4"},{default:s(()=>[m(c(i(l)("btn_manage")),1)]),_:1}),n(o,{value:"2"},{default:s(()=>[m(c(i(l)("btn_edit")),1)]),_:1}),n(o,{value:"1"},{default:s(()=>[m(c(i(l)("btn_view")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),n(j,{label:i(l)("label_collaborator"),required:""},{default:s(()=>[n(U,{value:r.identity_type,"onUpdate:value":t[1]||(t[1]=e=>r.identity_type=e)},{default:s(()=>[n(o,{value:"1"},{default:s(()=>[m(c(i(l)("btn_select_by_member")),1)]),_:1}),n(o,{value:"2"},{default:s(()=>[m(c(i(l)("btn_select_by_org")),1)]),_:1})]),_:1},8,["value"]),C.value&&C.value.includes("TeamManage")?(_(),p("div",pe,[m(c(i(l)("msg_no_account_tip"))+" ",1),d("a",{onClick:T},c(i(l)("btn_go_to_add")),1)])):y("",!0)]),_:1},8,["label"]),r.identity_type==1?(_(),p("div",ve,[(_(!0),p(B,null,M(L.value,e=>(_(),p("div",{class:"type-item",key:e.value,onClick:je=>I(e)},[d("div",fe,[n($,{shape:"square",src:e.avatar,size:40},{icon:s(()=>[e.avatar?y("",!0):(_(),x(i(re),{key:0}))]),_:2},1032,["src"]),d("div",ye,[d("div",be,c(e.user_name),1),d("div",ge,c(e.nick_name),1)])]),u.value.includes(e.id)?(_(),x(J,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):y("",!0)],8,me))),128))])):y("",!0),r.identity_type==2?(_(),p("div",he,[n(G,{value:f.value,"onUpdate:value":t[2]||(t[2]=e=>f.value=e),style:{width:"100%"}},{default:s(()=>[d("div",ke,[(_(!0),p(B,null,M(w.value,e=>(_(),x(X,{key:e.id,value:e.id},{default:s(()=>[d("div",null,c(e.department_name),1)]),_:2},1032,["value"]))),128))])]),_:1},8,["value"])])):y("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},Oe=ae(xe,[["__scopeId","data-v-2767eef3"]]);export{Oe as A};
//# sourceMappingURL=add-collaborator-Ww1-CyL9.js.map
