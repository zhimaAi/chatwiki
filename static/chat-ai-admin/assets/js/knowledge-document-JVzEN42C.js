import{_ as mo}from"./cu-scroll-RG6yxhtf.js";import{y as _e,W as Wo,Z as De,L as jo,x as Fe,F as oo,I as Ao,b as be,a3 as Vo,d5 as Ko,k as H,M as le,d6 as vo,E as We,d7 as fo,d8 as Yo,d9 as rt,da as Qo,d as Rt,B as It,db as Xo,bM as Ut,dc as go,dd as Jo,de as Zo,df as en,dg as tn,h as yo,dh as _t,di as on,bV as nn,e as sn,$ as an,a6 as wt,bq as at,dj as ln,bA as un,n as no,bW as dn,d3 as rn,dk as _n,dl as cn,dm as pn,dn as mn,dp as vn}from"../../index-M_xDbIir.js";import{e as so,d as m,j as t,z as ae,ag as ho,N as l,O as s,U as n,X as e,H as dt,S as B,a6 as v,u as R,_ as C,F as V,a1 as ue,Z as y,a0 as se,a2 as Mt,a3 as je,b as ve,q as qt,Y as ko,a5 as re,W as fn,G as Ot,D as gn,I as ao}from"./vue-chunks-BRsu9_To.js";import{S as yn,a as hn,E as kn}from"./edit-subsection-BWy4wHrv.js";import{E as bn}from"./EditOutlined-Cg8Bo7WJ.js";import{D as wn}from"./index-BSroSjtu.js";import{_ as xn,a as bo,b as Cn}from"./index-Bg1_T7h9.js";import{_ as Dt}from"./index-B0RyY99D.js";import{_ as Ft}from"./index-RSdO8Qbf.js";import{P as Te}from"./PlusOutlined-DQ91YM1E.js";import{S as Be}from"./SearchOutlined-KUcJKUZw.js";import"./index-UA7y0weg.js";import{I as Pe}from"./Input-Bx6Hhp2b.js";import"./index-D7wU2qJF.js";import{D as wo}from"./dropdown-DCrM-GKY.js";import{E as ct,M as xo,_ as Co}from"./index-B3CPYV6x.js";import{S as Ae,a as Ve}from"./index-khLftDou.js";import{R as $n}from"./index-CYQ0SJ7O.js";import{_ as Tt}from"./index-CSIZCO5e.js";import{U as $o}from"./upload-input-DiBWYXWn.js";import{t as lo}from"./validate-8MtiUsxW.js";import{F as pt,_ as Pt}from"./index-V0sRhm34.js";import"./index-Dob-Z8xa.js";import{_ as Sn,R as Ln}from"./RadioButton-Bb2kU0Fd.js";import{M as io}from"./model-select-Cwu3Of2q.js";import{O as qn}from"./open-grapg-modal-MJ6u7Aov.js";import{D as On}from"./DownOutlined-CI2wWtcJ.js";import{U as Rn}from"./UpOutlined-DzDRcb4z.js";import{_ as In}from"./index-BF4PinvW.js";import{R as Un}from"./rename-modal-D_boHqP7.js";import{_ as Mn}from"./page-alert-CXP-BgUu.js";import{C as Dn}from"./index-Bn-th77D.js";import{g as Fn,c as uo,d as Tn,r as Pn,a as En}from"./index-Cs0K2ZaB.js";import{u as ro}from"./FormItemContext-DRzYyKbC.js";import{d as Gn}from"./vuedraggable.umd-CIIT_a56.js";import{C as zn}from"./CopyOutlined-B27aORPl.js";import{_ as Nn}from"./index-CsySi7_q.js";import{S as Hn}from"./index-D_6sH2t0.js";import{C as xt}from"./ClockCircleFilled-2GdWXrdd.js";import{_ as Bn}from"./index-z217UQIH.js";import{S as Wn}from"./SyncOutlined-Ddoh8W5Z.js";import{M as jn}from"./MoreOutlined-CBDR9Xb3.js";import{_ as An}from"./index-pt58wSpn.js";import{_ as Vn}from"./TextArea-C57yjED6.js";const Ct=()=>({format:String,showNow:De(),showHour:De(),showMinute:De(),showSecond:De(),use12Hours:De(),hourStep:Number,minuteStep:Number,secondStep:Number,hideDisabledOptions:De(),popupClassName:String,status:Wo()});function Kn(G){const U=Fn(G,_e(_e({},Ct()),{order:{type:Boolean,default:!0}})),{TimePicker:W,RangePicker:M}=U,g=so({name:"ATimePicker",inheritAttrs:!1,props:_e(_e(_e(_e({},uo()),Tn()),Ct()),{addon:{type:Function}}),slots:Object,setup(S,z){let{slots:k,expose:b,emit:h,attrs:L}=z;const d=S,P=ro();jo(!(k.addon||d.addon),"TimePicker","`addon` is deprecated. Please use `v-slot:renderExtraFooter` instead.");const u=m();b({focus:()=>{var f;(f=u.value)===null||f===void 0||f.focus()},blur:()=>{var f;(f=u.value)===null||f===void 0||f.blur()}});const q=(f,T)=>{h("update:value",f),h("change",f,T),P.onFieldChange()},Y=f=>{h("update:open",f),h("openChange",f)},I=f=>{h("focus",f)},F=f=>{h("blur",f),P.onFieldBlur()},X=f=>{h("ok",f)};return()=>{const{id:f=P.id.value}=d;return t(W,Fe(Fe(Fe({},L),oo(d,["onUpdate:value","onUpdate:open"])),{},{id:f,dropdownClassName:d.popupClassName,mode:void 0,ref:u,renderExtraFooter:d.addon||k.addon||d.renderExtraFooter||k.renderExtraFooter,onChange:q,onOpenChange:Y,onFocus:I,onBlur:F,onOk:X}),k)}}}),A=so({name:"ATimeRangePicker",inheritAttrs:!1,props:_e(_e(_e(_e({},uo()),Pn()),Ct()),{order:{type:Boolean,default:!0}}),slots:Object,setup(S,z){let{slots:k,expose:b,emit:h,attrs:L}=z;const d=S,P=m(),u=ro();b({focus:()=>{var _;(_=P.value)===null||_===void 0||_.focus()},blur:()=>{var _;(_=P.value)===null||_===void 0||_.blur()}});const q=(_,r)=>{h("update:value",_),h("change",_,r),u.onFieldChange()},Y=_=>{h("update:open",_),h("openChange",_)},I=_=>{h("focus",_)},F=_=>{h("blur",_),u.onFieldBlur()},X=(_,r)=>{h("panelChange",_,r)},f=_=>{h("ok",_)},T=(_,r,D)=>{h("calendarChange",_,r,D)};return()=>{const{id:_=u.id.value}=d;return t(M,Fe(Fe(Fe({},L),oo(d,["onUpdate:open","onUpdate:value"])),{},{id:_,dropdownClassName:d.popupClassName,picker:"time",mode:void 0,ref:P,onChange:q,onOpenChange:Y,onFocus:I,onBlur:F,onPanelChange:X,onOk:f,onCalendarChange:T}),k)}}});return{TimePicker:g,TimeRangePicker:A}}const{TimePicker:lt,TimeRangePicker:$t}=Kn(En),So=_e(lt,{TimePicker:lt,TimeRangePicker:$t,install:G=>(G.component(lt.name,lt),G.component($t.name,$t),G)});var Yn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M742 318V184h86c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H196c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h86v134c0 81.5 42.4 153.2 106.4 194-64 40.8-106.4 112.5-106.4 194v134h-86c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h632c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-86V706c0-81.5-42.4-153.2-106.4-194 64-40.8 106.4-112.5 106.4-194z"}}]},name:"hourglass",theme:"filled"};function _o(G){for(var U=1;U<arguments.length;U++){var W=arguments[U]!=null?Object(arguments[U]):{},M=Object.keys(W);typeof Object.getOwnPropertySymbols=="function"&&(M=M.concat(Object.getOwnPropertySymbols(W).filter(function(g){return Object.getOwnPropertyDescriptor(W,g).enumerable}))),M.forEach(function(g){Qn(G,g,W[g])})}return G}function Qn(G,U,W){return U in G?Object.defineProperty(G,U,{value:W,enumerable:!0,configurable:!0,writable:!0}):G[U]=W,G}var Et=function(U,W){var M=_o({},U,W.attrs);return t(Ao,_o({},M,{icon:Yn}),null)};Et.displayName="HourglassFilled";Et.inheritAttrs=!1;const Xn={class:"subsection-box"},Jn=["onDblclick"],Zn={class:"list-item"},es={class:"list-content"},ts={class:"status-error"},os=["onClick","innerHTML"],ns={class:"similar-question-list"},ss={class:"list-item list-item-answer"},as=["innerHTML"],ls={class:"fragment-img"},is=["src"],us={class:"right-opration"},ds=["onClick"],rs=["onClick"],_s=["onClick"],cs=["onClick"],ps={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(G,{expose:U,emit:W}){const M=W,g=G,A=ae({selectedRowKeys:[]}),S=u=>{A.selectedRowKeys=u},z=()=>{A.selectedRowKeys=[]},k=u=>{M("openEditSubscription",u)},b=u=>{le.confirm({title:"提示",icon:t(We),content:"确认是否删除该问答?",onOk(){return new Promise((q,Y)=>{vo({id:u}).then(I=>{H.success("删除成功"),M("handleDelParagraph",u),q()}).catch(()=>{q()})})},onCancel(){}})},h=(u,q)=>{Ko({id:u.id,category_id:q}).then(Y=>{H.success("设置成功"),M("getList")})},L=(u,q,Y)=>{let I=Y.field,F=Y.order;F?F=F==="ascend"?"asc":"desc":I="",M("handleSort",{sort_field:I,sort_type:F})};function d(u,q,Y={}){if(!q||!u)return u;const{highlightClass:I="highlight",caseSensitive:F=!1,wholeWord:X=!1}=Y,f=F?"g":"gi";let T;return X?T=new RegExp(`\\b${P(q)}\\b`,f):T=new RegExp(P(q),f),u.replace(T,_=>`<span class="${I}">${_}</span>`)}function P(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return U({handleOpenEditModal:k,state:A,resetSelect:z}),(u,q)=>{const Y=Dt,I=Ft,F=xn,X=bo,f=ho("viewer");return s(),l("div",Xn,[t(X,{"data-source":G.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:A.selectedRowKeys,onChange:S},pagination:!1,loading:g.isLoading,onChange:L},{default:n(()=>[t(F,{key:"id","data-index":"id",width:1148},{title:n(()=>[y("问答（共"+C(g.total)+"个）",1)]),default:n(({record:T})=>[e("div",{class:"qa-list-box",onDblclick:_=>k(T)},[e("div",Zn,[q[0]||(q[0]=e("div",{class:"list-label"},"问题",-1)),e("div",es,[T.status==2?(s(),B(Y,{key:0,placement:"top"},{title:n(()=>[e("span",null,C(T.errmsg),1)]),default:n(()=>[e("span",null,[e("span",ts,[t(R(Vo))])])]),_:2},1024)):v("",!0),e("span",{onClick:_=>k(T),innerHTML:d(T.question,g.search),class:"question-text"},null,8,os),T.similar_questions&&T.similar_questions.length?(s(),B(I,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:n(()=>[e("div",ns,[(s(!0),l(V,null,ue(T.similar_questions,(_,r)=>(s(),l("div",{class:"similar-question-list-item",key:r},C(_),1))),128))])]),title:n(()=>[e("span",null,"共 "+C(T.similar_questions.length)+" 个相似问法",1)]),default:n(()=>[e("a",null,"（"+C(T.similar_questions.length)+"）",1)]),_:2},1024)):v("",!0)])]),e("div",ss,[q[1]||(q[1]=e("div",{class:"list-label"},"答案",-1)),e("div",{class:"list-content",innerHTML:d(T.answer,g.search)},null,8,as)]),dt((s(),l("div",ls,[(s(!0),l(V,null,ue(T.images,(_,r)=>(s(),l("img",{key:r,src:_,alt:""},null,8,is))),128))])),[[f]])],40,Jn)]),_:1}),t(F,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),t(F,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),t(F,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),t(F,{title:"操作",key:"action","data-index":"action",width:120},{default:n(({record:T,index:_})=>[e("div",us,[T.category_id>0?(s(),l("div",{key:0,class:"hover-btn-box",onClick:r=>h(T,0)},[t(R(yn),{style:{color:"#F59A23"}})],8,ds)):(s(),l("div",{key:1,class:"hover-btn-box",onClick:r=>h(T,4)},[t(R(hn))],8,rs)),e("div",{class:"hover-btn-box",onClick:se(r=>k(T),["stop"])},[t(R(bn))],8,_s),e("div",{class:"hover-btn-box",onClick:se(r=>b(T.id),["stop"])},[t(R(wn))],8,cs)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},ms=be(ps,[["__scopeId","data-v-d61f7351"]]),vs={class:"alert-box"},fs={class:"upload-file-box"},gs={key:0,class:"hight-set"},ys={key:0,class:"set-box"},hs={class:"form-item"},ks={class:"form-item-body"},bs={class:"form-item"},ws={class:"form-item-body"},xs={class:"form-item"},Cs={class:"form-item-body"},$s={key:1,class:"set-box"},Ss={class:"form-item"},Ls={class:"form-item-body"},qs={class:"form-item"},Os={class:"form-item-body"},Rs={class:"form-item"},Is={class:"form-item-body"},Us={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(G,{expose:U,emit:W}){const M=fo(),{qa_index_type:g}=M;Mt();const S=je().query,z=m(!1),k=m(!1),b=m([]),h=W,L=m([]),d=G,P=ve(()=>d.library_id||S.id),u=ae({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),q=m(!0),Y=_=>{u.group_id=void 0,_>=0&&(u.group_id=_),z.value=!0},I=()=>{let _=new FormData;b.value.forEach(r=>{_.append("library_files",r)}),Yo(_).then(r=>{let D=[];for(let N in r.data)D.push({lable:r.data[N],value:N});L.value=D})},F=()=>{if(b.value.length==0){H.error("请选择文件");return}k.value=!0;let _=new FormData;_.append("library_id",P.value);let r=!1;if(b.value.forEach(D=>{(D.name.includes(".xlsx")||D.name.includes(".csv"))&&(r=!0),_.append("library_files",D)}),r){if(!u.question_column)return k.value=!1,H.error("请选择问题所在列");if(!u.answer_column)return k.value=!1,H.error("请选择答案所在列");_.append("question_column",u.question_column),_.append("answer_column",u.answer_column),u.similar_column&&_.append("similar_column",u.similar_column)}else _.append("question_lable",u.question_lable),_.append("answer_lable",u.answer_lable),_.append("similar_label",u.similar_label);_.append("group_id",u.group_id>=0?u.group_id:0),_.append("is_qa_doc",1),_.append("qa_index_type",g),rt(_).then(D=>{h("ok"),z.value=!1,b.value=[],k.value=!1}).catch(()=>{k.value=!1})},X=()=>{b.value=[]},f=m(1),T=_=>{u.question_column=void 0,u.answer_column=void 0,u.similar_column=void 0,u.question_lable="问题：",u.answer_lable="答案：",u.similar_label="相似问法：",b.value=_,_&&_.length>0&&(_[0].type.includes(".document")?f.value=2:(f.value=1,I()))};return U({show:Y}),(_,r)=>{const D=In,N=Ve,de=Ae,Z=Tt,K=Pe,we=le;return s(),l("div",null,[t(we,{width:680,open:z.value,"onUpdate:open":r[9]||(r[9]=$=>z.value=$),"confirm-loading":k.value,maskClosable:!1,title:"上传文档",onOk:F,onCancel:X},{default:n(()=>[e("div",vs,[t(D,{"show-icon":""},{message:n(()=>r[10]||(r[10]=[e("div",null,[y(" 通过word或者Excel形式导入问答，建议您参考"),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),y("  "),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),y("创建导入文档 ")],-1),e("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),e("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])),_:1})]),t(Z,{align:"center",style:{margin:"16px 0"}},{default:n(()=>[r[11]||(r[11]=e("div",null,"所属分组：",-1)),t(de,{value:u.group_id,"onUpdate:value":r[0]||(r[0]=$=>u.group_id=$),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(s(!0),l(V,null,ue(d.groupLists.filter($=>$.id>=0),$=>(s(),B(N,{value:$.id},{default:n(()=>[y(C($.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1,__:[11]}),e("div",fs,[t($o,{type:2,value:b.value,"onUpdate:value":r[1]||(r[1]=$=>b.value=$),onChange:T},null,8,["value"])]),b.value.length>0?(s(),l("div",gs,[e("a",{onClick:r[2]||(r[2]=$=>q.value=!q.value)},[r[12]||(r[12]=y("高级设置： ")),q.value?(s(),B(R(Rn),{key:1})):(s(),B(R(On),{key:0}))]),q.value?(s(),l(V,{key:0},[f.value==1?(s(),l("div",ys,[e("div",hs,[r[13]||(r[13]=e("div",{class:"form-item-label required"},"问题所在列：",-1)),e("div",ks,[t(de,{value:u.question_column,"onUpdate:value":r[3]||(r[3]=$=>u.question_column=$),placeholder:"请选择列名",style:{width:"100%"}},{default:n(()=>[(s(!0),l(V,null,ue(L.value,$=>(s(),B(N,{value:$.value,key:$.value},{default:n(()=>[y(C($.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",bs,[r[14]||(r[14]=e("div",{class:"form-item-label"},"相似问法所在列：",-1)),e("div",ws,[t(de,{value:u.similar_column,"onUpdate:value":r[4]||(r[4]=$=>u.similar_column=$),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:n(()=>[(s(!0),l(V,null,ue(L.value,$=>(s(),B(N,{value:$.value,key:$.value},{default:n(()=>[y(C($.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",xs,[r[15]||(r[15]=e("div",{class:"form-item-label required"},"答案所在列：",-1)),e("div",Cs,[t(de,{value:u.answer_column,"onUpdate:value":r[5]||(r[5]=$=>u.answer_column=$),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:n(()=>[(s(!0),l(V,null,ue(L.value,$=>(s(),B(N,{value:$.value,key:$.value},{default:n(()=>[y(C($.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):v("",!0),f.value==2?(s(),l("div",$s,[e("div",Ss,[r[16]||(r[16]=e("div",{class:"form-item-label"},"问题开始标识符：",-1)),e("div",Ls,[t(K,{placeholder:"请输入标识符",value:u.question_lable,"onUpdate:value":r[6]||(r[6]=$=>u.question_lable=$)},null,8,["value"])])]),e("div",qs,[r[17]||(r[17]=e("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),e("div",Os,[t(K,{placeholder:"请输入标识符",value:u.similar_label,"onUpdate:value":r[7]||(r[7]=$=>u.similar_label=$)},null,8,["value"])])]),e("div",Rs,[r[18]||(r[18]=e("div",{class:"form-item-label"},"答案开始标识符：",-1)),e("div",Is,[t(K,{placeholder:"请输入标识符",value:u.answer_lable,"onUpdate:value":r[8]||(r[8]=$=>u.answer_lable=$)},null,8,["value"])])])])):v("",!0)],64)):v("",!0)])):v("",!0)]),_:1},8,["open","confirm-loading"])])}}},Lo=be(Us,[["__scopeId","data-v-c8302bd6"]]),Ms={class:"form-item"},Ds={class:"form-content"},Fs={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(G,{expose:U,emit:W}){const M=je().query,g=m(!1),A=W,S=m("新建分组"),z=G,k=ae({group_name:"",id:"",library_id:M.id}),b=L=>{k.group_name=L.group_name||"",k.id=L.id||"",S.value=L.id?"编辑分组":"新建分组",k.library_id=L.library_id,g.value=!0},h=()=>{if(!k.group_name)return H.error("请输入分组名称");Qo({...k,group_type:z.group_type}).then(L=>{H.success(`${S.value}成功`),g.value=!1,A("ok")})};return U({show:b}),(L,d)=>{const P=Pe,u=le;return s(),l("div",null,[t(u,{open:g.value,"onUpdate:open":d[1]||(d[1]=q=>g.value=q),title:S.value,onOk:h},{default:n(()=>[e("div",Ms,[d[2]||(d[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",Ds,[t(P,{maxLength:15,value:k.group_name,"onUpdate:value":d[0]||(d[0]=q=>k.group_name=q),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},qo=be(Fs,[["__scopeId","data-v-853bcd54"]]),Ts={class:"qa-list-wrapper"},Ps={class:"group-head-box"},Es={class:"head-title"},Gs={class:"flex-between-box"},zs={class:"search-box"},Ns={class:"classify-box"},Hs=["onClick"],Bs={class:"classify-title"},Ws={class:"right-content"},js={key:0,class:"btn-box"},As={class:"hover-btn-wrap"},Vs=["onClick"],Ks=["onClick"],Ys={class:"main-content-box"},Qs={class:"head-content"},Xs={class:"title"},Js={class:"pover-group-content-box"},Zs={class:"group-head-box"},ea={class:"head-title"},ta={class:"flex-between-box"},oa={class:"search-box"},na={class:"classify-box classify-scroll-box"},sa=["onClick"],aa={class:"classify-title"},la={class:"right-content"},ia={key:0,class:"btn-box"},ua={class:"hover-btn-wrap"},da=["onClick"],ra=["onClick"],_a={class:"btn-right-box"},ca={class:"des-content-block"},pa={key:0,class:"alert-icon-box"},ma={class:"content-block"},va={class:"pagination-box"},co="qa_document_group_box_width",it=180,St=256,fa={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(G){const U=m(null),M=je().query,g=m(""),A=m([]),S=m(-1),z=ve(()=>A.value.find(O=>O.id==S.value)||{}),k=ve(()=>A.value.filter(O=>O.group_name.includes(g.value))),b=G,h=ve(()=>b.library_id||M.id),L=m([]),d=m(localStorage.getItem("qa_document_group_hide_key")==1),P=m(0),u=m(0),q={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},Y=m({is_qa_doc:"1",library_id:h.value}),I=m({page:1,size:100}),F=ae({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:h.value,search:""}),X=O=>{F.sort_field=O.sort_field,F.sort_type=O.sort_type,f()},f=()=>{I.value.page=1,Z()},T=(O,c)=>{I.value.page=O,I.value.size=c,Z()},_=()=>{d.value=!d.value,localStorage.setItem("qa_document_group_hide_key",d.value?1:2)},r=()=>{Zo({id:h.value}).then(()=>{H.success("操作完成"),Z()})},D=m(null),N=O=>{O.group_id||S.value>=0&&(O.group_id=S.value),D.value.showModal(JSON.parse(JSON.stringify(O)))},de=m(!1),Z=()=>{de.value=!0,Xo({...I.value,...F,group_id:S.value}).then(O=>{de.value=!1;let c=O.data,pe=c.list||[];pe.forEach(E=>{E.status_text=q[E.status],E.similar_questions&&(E.similar_questions=JSON.parse(E.similar_questions))}),L.value=pe,P.value=c.total,u.value=c.exception_total,U.value&&U.value.resetSelect()})};Z();const K=()=>{Ut({library_id:h.value}).then(O=>{let pe=(O.data||[]).reduce((E,ye)=>E+ +ye.total,0);A.value=[{group_name:"全部分组",id:-1,total:pe},...O.data]})};K();const we=m(null),$=O=>{we.value.show({...O,library_id:h.value})},xe=()=>{K(),Z()},Ee=O=>{S.value=O.id,f()},Ce=O=>{le.confirm({title:`确认删除分组${O.group_name}`,icon:t(We),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){go({id:O.id}).then(()=>{H.success("删除成功"),K(),S.value==O.id&&(S.value=-1,f())})}})},fe=m(null),Q=()=>{fe.value.show(S.value)},qe=m(!1),ce=ae({group_id:void 0,ids:""}),Ke=()=>{if(U.value.state.selectedRowKeys.length==0)return H.error("请选择你要移动的问答");ce.ids=U.value.state.selectedRowKeys.join(","),ce.group_id=void 0,qe.value=!0},mt=()=>{if(U.value.state.selectedRowKeys.length==0)return H.error("请选择你要删除的问答");le.confirm({title:"提示",icon:t(We),content:"确认是否删除所选问答?",onOk(){vo({id:U.value.state.selectedRowKeys.join(",")}).then(O=>{H.success("删除成功"),Z()})},onCancel(){}})},vt=()=>{if(!ce.group_id)return H.error("请选择分组");tn({...ce}).then(()=>{qe.value=!1,H.success("移动成功"),xe()})},ie=m(it),Oe=m(!1);qt(()=>{const O=parseInt(localStorage.getItem(co));O&&O>=it&&O<=St&&(ie.value=O)});let Re=!1,ge=0,ee=0;const $e=O=>{d.value||(Re=!0,Oe.value=!0,ge=O.clientX,ee=ie.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Ye),document.addEventListener("mouseup",Ge))},Ye=O=>{if(!Re)return;let c=ee+(O.clientX-ge);c=Math.max(it,Math.min(St,c)),ie.value=c},Ge=()=>{Re&&(Re=!1,Oe.value=!1,localStorage.setItem(co,ie.value),document.body.style.cursor="",document.removeEventListener("mousemove",Ye),document.removeEventListener("mouseup",Ge))},Ie=m(!1),j=()=>{let O="";U.value.state.selectedRowKeys.length>0&&(O=U.value.state.selectedRowKeys.join(",")),Jo({library_id:M.id,export_type:2,group_id:S.value,data_ids:O}).then(c=>{Ie.value=!0})},ft=()=>{en.push({path:"/library/details/export-record",query:M})};return(O,c)=>{const pe=Rt,E=Dt,ye=Pe,Se=Co,Qe=xo,Xe=wo,Je=mo,gt=Ft,me=It,yt=Cn,ht=Ve,Ze=Ae,kt=Tt,et=le,bt=$n;return s(),l(V,null,[e("div",Ts,[e("div",{class:re(["group-content-box",[{collapsed:d.value},{"no-transition":Oe.value}]]),style:ko(d.value?{}:{width:ie.value+"px",minWidth:it+"px",maxWidth:St+"px"})},[e("div",Ps,[e("div",Es,[t(E,{title:"收起问答分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:_},[t(pe,{name:"put-away"})])]),_:1}),e("div",Gs,[c[16]||(c[16]=e("div",null,"问答分组",-1)),t(E,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:c[0]||(c[0]=x=>$({}))},[t(R(Te))])]),_:1})])]),e("div",zs,[t(ye,{value:g.value,"onUpdate:value":c[2]||(c[2]=x=>g.value=x),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[t(R(Be),{onClick:c[1]||(c[1]=se(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",Ns,[t(Je,{style:{"padding-right":"24px"}},{default:n(()=>[(s(!0),l(V,null,ue(k.value,x=>(s(),l("div",{class:re(["classify-item",{active:x.id==S.value}]),onClick:he=>Ee(x),key:x.id},[e("div",Bs,C(x.group_name),1),e("div",Ws,[e("div",{class:re(["num",{"num-block":x.id<=0}])},C(x.total),3),x.id>0?(s(),l("div",js,[t(Xe,{placement:"bottomRight"},{overlay:n(()=>[t(Qe,null,{default:n(()=>[t(Se,null,{default:n(()=>[e("div",{onClick:se(he=>$(x),["stop"])},"重命名",8,Vs)]),_:2},1024),t(Se,null,{default:n(()=>[e("div",{onClick:se(he=>Ce(x),["stop"])},"删 除",8,Ks)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",As,[t(R(ct))])]),_:2},1024)])):v("",!0)])],10,Hs))),128))]),_:1})]),d.value?v("",!0):(s(),l("div",{key:0,class:"resize-bar",onMousedown:$e},null,32))],6),e("div",Ys,[t(Je,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:n(()=>[e("div",Qs,[e("div",Xs,[d.value?(s(),B(gt,{key:0,title:null,placement:"bottom"},{content:n(()=>[e("div",Js,[e("div",Zs,[e("div",ea,[e("div",ta,[c[17]||(c[17]=e("div",null,"问答分组",-1)),t(E,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:c[3]||(c[3]=x=>$({}))},[t(R(Te))])]),_:1})])]),e("div",oa,[t(ye,{allowClear:"",value:g.value,"onUpdate:value":c[5]||(c[5]=x=>g.value=x),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[t(R(Be),{onClick:c[4]||(c[4]=se(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",na,[(s(!0),l(V,null,ue(k.value,x=>(s(),l("div",{class:re(["classify-item",{active:x.id==S.value}]),onClick:he=>Ee(x),key:x.id},[e("div",aa,C(x.group_name),1),e("div",la,[e("div",{class:re(["num",{"num-block":x.id<=0}])},C(x.total),3),x.id>0?(s(),l("div",ia,[t(Xe,{placement:"bottomRight"},{overlay:n(()=>[t(Qe,null,{default:n(()=>[t(Se,null,{default:n(()=>[e("div",{onClick:se(he=>$(x),["stop"])},"重命名",8,da)]),_:2},1024),t(Se,null,{default:n(()=>[e("div",{onClick:se(he=>Ce(x),["stop"])},"删 除",8,ra)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",ua,[t(R(ct))])]),_:2},1024)])):v("",!0)])],10,sa))),128))])])]),default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:_},[t(pe,{name:"expand"})])]),_:1})):v("",!0),e("div",null,C(z.value.group_name),1),e("div",_a,[e("div",null,[t(ye,{onChange:f,value:F.search,"onUpdate:value":c[6]||(c[6]=x=>F.search=x),placeholder:"搜索问答"},{suffix:n(()=>[t(R(Be))]),_:1},8,["value"])]),t(me,{onClick:mt},{default:n(()=>c[18]||(c[18]=[y("批量删除")])),_:1,__:[18]}),t(me,{onClick:Ke},{default:n(()=>c[19]||(c[19]=[y("批量移动")])),_:1,__:[19]}),t(me,{onClick:c[7]||(c[7]=x=>Q())},{default:n(()=>c[20]||(c[20]=[y("批量导入")])),_:1,__:[20]}),t(me,{onClick:c[8]||(c[8]=x=>j())},{default:n(()=>c[21]||(c[21]=[y("批量导出")])),_:1,__:[21]}),t(me,{onClick:c[9]||(c[9]=x=>N({})),type:"primary",icon:t(R(Te))},{default:n(()=>c[22]||(c[22]=[y("问答")])),_:1,__:[22]},8,["icon"])])]),e("div",ca,[u.value>0?(s(),l("div",pa,[t(pe,{name:"alert-icon"}),e("div",null,C(u.value)+"个问答学习失败",1),e("a",{onClick:r},"重新学习")])):v("",!0)])]),e("div",ma,[t(ms,{ref_key:"subsectionBoxRef",ref:U,total:P.value,isLoading:de.value,paragraphLists:L.value,search:F.search,onOpenEditSubscription:N,onHandleDelParagraph:xe,onGetList:Z,onHandleSort:X},null,8,["total","isLoading","paragraphLists","search"]),e("div",va,[t(yt,{current:I.value.page,"onUpdate:current":c[10]||(c[10]=x=>I.value.page=x),"page-size":I.value.size,"onUpdate:pageSize":c[11]||(c[11]=x=>I.value.size=x),total:P.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:T},null,8,["current","page-size","total"])])])]),_:1})])]),t(kn,{detailsInfo:Y.value,onHandleEdit:xe,ref_key:"editSubscriptionRef",ref:D},null,8,["detailsInfo"]),t(qo,{ref_key:"addGroupRef",ref:we,onOk:xe},null,512),t(Lo,{groupLists:A.value,library_id:G.library_id,onOk:xe,ref_key:"qaUploadModalRef",ref:fe},null,8,["groupLists","library_id"]),t(et,{open:qe.value,"onUpdate:open":c[13]||(c[13]=x=>qe.value=x),title:"批量移动分组",onOk:vt},{default:n(()=>[t(kt,{align:"center",style:{margin:"24px 0"}},{default:n(()=>[c[23]||(c[23]=e("div",null,"移动到分组：",-1)),t(Ze,{value:ce.group_id,"onUpdate:value":c[12]||(c[12]=x=>ce.group_id=x),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(s(!0),l(V,null,ue(A.value.filter(x=>x.id>=0),x=>(s(),B(ht,{value:x.id},{default:n(()=>[y(C(x.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1,__:[23]})]),_:1},8,["open"]),t(et,{open:Ie.value,"onUpdate:open":c[15]||(c[15]=x=>Ie.value=x),title:null,footer:null,width:640},{default:n(()=>[t(bt,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:n(()=>[t(me,{style:{"margin-right":"16px"},onClick:c[14]||(c[14]=x=>Ie.value=!1)},{default:n(()=>c[24]||(c[24]=[y("知道了")])),_:1,__:[24]}),t(me,{onClick:ft,type:"primary"},{default:n(()=>c[25]||(c[25]=[y("去下载")])),_:1,__:[25]})]),_:1})]),_:1},8,["open"])],64)}}},Mu=be(fa,[["__scopeId","data-v-8df4223f"]]),ga={class:"form-box"},ya={class:"upload-document-type-box"},ha=["onClick"],ka={class:"right-block"},ba={class:"title-block"},wa={class:"title-text"},xa={class:"desc"},Ca={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(G,{expose:U,emit:W}){const M=Mt(),g=je(),A=pt.useForm,S=m(!1),z=m("添加自定义文档"),k=G,b=ae({library_id:g.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),h=m([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),L=X=>{b.qa_index_type=X},d=ae({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:P,validate:u,validateInfos:q}=A(b,d),Y=()=>{S.value=!0,P(),b.file_name="",b.is_qa_doc=0,b.qa_index_type=1,b.library_id=k.libraryInfo.id||g.query.id,k.libraryInfo.type==2&&(b.is_qa_doc=1)},I=m(!1),F=()=>{u().then(()=>{let X={...Ot(b),group_id:k.group_id};I.value=!0,rt(X).then(f=>{H.success(`${z.value}成功`),S.value=!1,M.push("/library/preview?id="+f.data.file_ids[0])}).finally(()=>{I.value=!1})})};return U({add:Y}),(X,f)=>{const T=Pe,_=Pt,r=Ln,D=Sn,N=Rt,de=pt,Z=le;return s(),l("div",null,[t(Z,{open:S.value,"onUpdate:open":f[2]||(f[2]=K=>S.value=K),title:z.value,onOk:F,width:"472px",confirmLoading:I.value},{default:n(()=>[e("div",ga,[t(de,{layout:"vertical"},{default:n(()=>[t(_,fn({label:"文档名称"},R(q).file_name),{default:n(()=>[t(T,{type:"text",placeholder:"请输入文档名称",value:b.file_name,"onUpdate:value":f[0]||(f[0]=K=>b.file_name=K)},null,8,["value"])]),_:1},16),v("",!0),b.is_qa_doc==1?(s(),B(_,{key:1,label:"索引方式",required:""},{default:n(()=>[e("div",ya,[(s(!0),l(V,null,ue(h.value,K=>(s(),l("div",{class:re(["type-item",{active:b.qa_index_type==K.value}]),key:K.value,onClick:we=>L(K.value)},[e("div",ka,[e("div",ba,[t(N,{name:b.qa_index_type==K.value?K.iconNameActive:K.iconName},null,8,["name"]),e("div",wa,C(K.title),1)]),e("div",xa,C(K.desc),1)]),b.qa_index_type==K.value?(s(),B(N,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],10,ha))),128))])]),_:1})):v("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},$a=be(Ca,[["__scopeId","data-v-a4f74280"]]),Sa="/assets/img/guide-image-DSu20zRj.png",La={class:"container"},qa={class:"guide-content"},Oa={class:"content-box"},Ra={__name:"guide-learning-tips",setup(G,{expose:U}){const W=yo(),M=m(!1),g=m(!1),A=m(""),S=()=>{setTimeout(()=>{M.value=!0},500)},z=()=>{W.setGuideLearningTips(g.value),M.value=!1},k=()=>{W.setGuideLearningTips(g.value),M.value=!1};return U({show:S}),(b,h)=>{const L=Dn,d=It,P=le;return s(),l("div",La,[t(P,{open:M.value,"onUpdate:open":h[1]||(h[1]=u=>M.value=u),title:A.value,onOk:z,onCancel:k,width:"472px"},{footer:n(()=>[t(d,{type:"primary",onClick:z},{default:n(()=>h[5]||(h[5]=[y("我知道了")])),_:1,__:[5]})]),default:n(()=>[e("div",qa,[h[4]||(h[4]=e("img",{src:Sa,alt:"操作引导",class:"guide-image"},null,-1)),e("div",Oa,[h[3]||(h[3]=e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),t(L,{checked:g.value,"onUpdate:checked":h[0]||(h[0]=u=>g.value=u)},{default:n(()=>h[2]||(h[2]=[e("div",{class:"content-check"},"不再显示此提示",-1)])),_:1,__:[2]},8,["checked"])])])]),_:1},8,["open","title"])])}}},Ia=be(Ra,[["__scopeId","data-v-33a87814"]]),Ua={__name:"edit-online-doc",emits:["ok"],setup(G,{expose:U,emit:W}){const M=W,g=ae({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),A=m({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),S=m(!1),z=L=>{L=JSON.parse(JSON.stringify(L)),g.id=L.id||"",g.file_name=L.file_name||"",g.doc_auto_renew_frequency=+L.doc_auto_renew_frequency||1,L.doc_auto_renew_minute>0&&(g.doc_auto_renew_minute=_t(L.doc_auto_renew_minute)),S.value=!0},k=m(!1),b=m(null),h=()=>{b.value.validate().then(()=>{k.value=!0,on({...g,doc_auto_renew_minute:g.doc_auto_renew_minute?_t(g.doc_auto_renew_minute):0}).then(()=>{S.value=!1,k.value=!1,M("ok")})}).catch(()=>{k.value=!1})};return U({show:z}),(L,d)=>{const P=Pe,u=Pt,q=Ve,Y=Ae,I=So,F=pt,X=le;return s(),l("div",null,[t(X,{open:S.value,"onUpdate:open":d[3]||(d[3]=f=>S.value=f),"confirm-loading":k.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:h},{default:n(()=>[t(F,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:b,model:g,rules:A.value},{default:n(()=>[t(u,{name:"file_name",label:"文件名称"},{default:n(()=>[t(P,{value:g.file_name,"onUpdate:value":d[0]||(d[0]=f=>g.file_name=f),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:n(()=>[t(Y,{value:g.doc_auto_renew_frequency,"onUpdate:value":d[1]||(d[1]=f=>g.doc_auto_renew_frequency=f),style:{width:"100%"}},{default:n(()=>[t(q,{value:1},{default:n(()=>d[4]||(d[4]=[y("不自动更新")])),_:1,__:[4]}),t(q,{value:2},{default:n(()=>d[5]||(d[5]=[y("每天")])),_:1,__:[5]}),t(q,{value:3},{default:n(()=>d[6]||(d[6]=[y("每3天")])),_:1,__:[6]}),t(q,{value:4},{default:n(()=>d[7]||(d[7]=[y("每7天")])),_:1,__:[7]}),t(q,{value:5},{default:n(()=>d[8]||(d[8]=[y("每30天")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),g.doc_auto_renew_frequency>1?(s(),B(u,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:n(()=>[t(I,{valueFormat:"HH:mm",value:g.doc_auto_renew_minute,"onUpdate:value":d[2]||(d[2]=f=>g.doc_auto_renew_minute=f),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},Ma={class:"form-item"},Da={class:"form-content"},Fa={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(G,{expose:U,emit:W}){const M=m(!1),g=W,A=m("修改分组"),S=G,z=ae({group_id:"",file_id:""}),k=m([]),b=d=>{z.group_id=d.group_id||"0",z.file_id=d.id||"",L(),M.value=!0},h=()=>{if(!z.group_id)return H.error("请选择分组");nn({...z,library_id:S.libraryId,sense:S.sense}).then(d=>{H.success(`${A.value}成功`),M.value=!1,g("ok")})},L=()=>{Ut({library_id:S.libraryId,group_type:1}).then(d=>{k.value=d.data||[]})};return U({show:b}),(d,P)=>{const u=Ve,q=Ae,Y=le;return s(),l("div",null,[t(Y,{open:M.value,"onUpdate:open":P[1]||(P[1]=I=>M.value=I),title:A.value,onOk:h},{default:n(()=>[e("div",Ma,[P[2]||(P[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",Da,[t(q,{value:z.group_id,"onUpdate:value":P[0]||(P[0]=I=>z.group_id=I),style:{width:"100%"},placeholder:"请选择分组"},{default:n(()=>[(s(!0),l(V,null,ue(k.value,I=>(s(),B(u,{value:I.id},{default:n(()=>[y(C(I.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},Ta=be(Fa,[["__scopeId","data-v-40485b34"]]),Pa={class:"details-library-page"},Ea={class:"group-head-box"},Ga={class:"head-title"},za={class:"flex-between-box"},Na={class:"classify-box",style:{"margin-top":"16px"}},Ha=["onClick"],Ba={key:0,class:"drag-btn"},Wa={key:1,style:{width:"20px"}},ja={class:"classify-title"},Aa={class:"right-content"},Va={key:0,class:"btn-box"},Ka={class:"hover-btn-wrap"},Ya=["onClick"],Qa=["onClick"],Xa={class:"main-content-box"},Ja={class:"group-header-title"},Za={class:"pover-group-content-box"},el={class:"group-head-box"},tl={class:"head-title"},ol={class:"flex-between-box"},nl={class:"search-box"},sl={class:"classify-box classify-scroll-box"},al=["onClick"],ll={class:"classify-title"},il={class:"right-content"},ul={key:0,class:"btn-box"},dl={class:"hover-btn-wrap"},rl=["onClick"],_l=["onClick"],cl={class:"title"},pl={class:"list-tools"},ml={class:"tools-items"},vl={class:"right-box"},fl={key:0,class:"status-box"},gl={class:"status-item"},yl={class:"status-content"},hl={class:"status-item"},kl={class:"status-content content-tip"},bl={class:"status-item"},wl={class:"status-content content-tip"},xl={key:1,class:"status-select-box"},Cl={class:"tool-item"},$l={class:"tool-item"},Sl={class:"dropdown-btn-menu"},Ll={key:0,class:"desc"},ql={key:1,class:"desc"},Ol={class:"dropdown-btn-menu"},Rl={class:"dropdown-btn-menu"},Il={class:"list-content"},Ul={key:0,class:"doc-name-td"},Ml=["href"],Dl=["onClick"],Fl={key:0},Tl={key:1},Pl=["onClick"],El={key:0},Gl={key:1},zl={key:2,class:"url-remark"},Nl=["onClick"],Hl={key:0,class:"pdf-progress-box"},Bl={class:"progress-title"},Wl={class:"status-box"},jl=["onClick"],Al={class:"progress-bar"},Vl={class:"num-box"},Kl={key:0,class:"status-tag running"},Yl={key:2,class:"status-tag running"},Ql={key:3,class:"status-tag complete"},Xl={class:"status-tag status-error"},Jl=["onClick"],Zl={class:"status-tag status-error"},ei={class:"status-tag"},ti=["onClick"],oi={key:7,class:"status-tag"},ni={key:8,class:"status-tag running"},si={class:"status-tag error"},ai={key:10,class:"status-tag cancel"},li={key:11,class:"status-tag subning"},ii={class:"status-tag"},ui=["onClick"],di={key:1,class:"status-tag running"},ri={key:2,class:"status-tag complete"},_i={class:"status-tag error"},ci=["onClick"],pi={class:"zm-line1 reason-text"},mi={key:4,class:"status-tag running"},vi={class:"status-tag warning"},fi={class:"reason-text"},gi=["onClick"],yi={key:0},hi={key:1},ki={key:0,class:"text-block"},bi={class:"time-content-box"},wi={key:0},xi={key:1},Ci={key:2},$i={key:3},Si={key:4},Li={key:5,class:"ml4"},qi={key:6},Oi=["onClick"],Ri={key:1},Ii={key:0},Ui={key:1},Mi=["onClick"],Di=["onClick"],Fi={class:"upload-file-box"},Ti={class:"select-card-box"},Pi=["onClick"],Ei={class:"card-title"},Gi={key:0,class:"card-switch-box"},zi={class:"card-desc"},Ni={key:0,class:"card-switch"},po="qa_document_group_box_width",ut=180,Lt=256,Hi={__name:"knowledge-document",props:{library_id:{type:[Number,String],default:()=>""}},setup(G){const{setStorage:U}=rn("localStorage"),W=fo(),{changeGraphSwitch:M}=W,g=sn(),A=ve(()=>{var a;return((a=g.companyInfo)==null?void 0:a.neo4j_status)=="true"}),S=ve(()=>{var a;return((a=g.companyInfo)==null?void 0:a.ali_ocr_switch)=="1"}),z=G,k=ve(()=>z.library_id||X.id),b=m(localStorage.getItem("document_group_hide_key")==1),h=m(""),L=m([]),d=m(-1),P=ve(()=>L.value.find(a=>a.id==d.value)||{}),u=ve(()=>L.value.filter(a=>a.group_name.includes(h.value))),q=yo(),Y=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],I=je(),F=Mt(),X=I.query,f=m(!1),T=m(null),_=m(null),r=m(!1),D=m({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});ae({selectedRowKeys:[]});const N=ae({use_model:"",model_config_id:""}),de=(a,o)=>{let w=o.modelName,J=o.modelId;Ce.value.length>0?le.confirm({title:`确定切换模型为${w}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){N.use_model=w,N.model_config_id=J,Z()},onCancel(){}}):(N.use_model=w,N.model_config_id=J,Z())},Z=(a=!0,o=null)=>{vn({...Ot(D.value),use_model:N.use_model,model_config_id:N.model_config_id}).then(()=>{D.value.use_model=N.use_model,D.value.model_config_id=N.model_config_id,typeof o=="function"&&o(),a&&H.success("保存成功")})},K=m([]),we=a=>{K.value=a},$=m([]),xe=a=>{$.value=a,Ee()},Ee=()=>{if(!D.value.id){setTimeout(()=>{Ee()},100);return}if($.value.length>0&&!D.value.use_model){let a=null,o=null;for(let w of $.value)if(w.model_define==="chatwiki"){a=w;for(let J of a.children)if(J.name==="text-embedding-v2"){o=J;break}break}a||(a=$.value[0],o=a.children[0]),a&&(N.use_model=o.name,N.model_config_id=o.model_config_id,Z(!1))}},Ce=m([]),fe=ae({learned_err_count:0,learned_count:0,learned_wait_count:0}),Q=ae({library_id:k.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),qe=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],ce=m([]),Ke=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"更新频率/时间",dataIndex:"doc_auto_renew_frequency",key:"doc_auto_renew_frequency",width:260},{title:"合计",dataIndex:"total_hits",key:"total_hits",width:150,sorter:!0},{title:"昨日",dataIndex:"yesterday_hits",key:"yesterday_hits",width:150,sorter:!0},{title:"今日",dataIndex:"today_hits",key:"today_hits",width:150,sorter:!0},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],mt=a=>{ie()},vt=(a,o,w)=>{Q.page=a.current,Q.size=a.pageSize,Q.sort_field="",Q.sort_type="",w.order&&w.field&&(Q.sort_field=w.field,Q.sort_type=w.order=="ascend"?"asc":"desc"),ee()},ie=()=>{Q.page=1,ee(),Ue()};let Oe=!1;const Re=({id:a})=>{Ce.value.length==1&&(Oe=!0),mn({id:a}).then(()=>{Oe&&Q.page>1&&Q.page--,ee(),Ue(),H.success("删除成功")})},ge=(a,o={})=>{let w=I.name;if(a.status=="4"){if(w=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+a.id+"&page="+Q.page);return}return F.push({path:"/library/document-segmentation",query:{document_id:a.id,page:Q.page}})}if(a.status=="3"&&D.value.type!=2)return H.error("学习失败,不可预览");if(a.status=="0")return H.error("转换中,稍候可预览");if(a.status=="1")return H.error("学习中,不可预览");if(a.status=="6")return H.error("获取中,不可预览");if(a.status=="7")return H.error("获取失败,不可预览");if(a.status=="10")return H.error("正在分段,不可预览");if(w=="libraryConfig"){window.open("/#/library/preview?id="+a.id);return}F.push({name:"libraryPreview",query:{id:a.id,...o}})},ee=()=>{let a=Ot(Q);a.status==0&&(a.status=""),a.group_id=d.value,f.value=!0,ln(a).then(o=>{let w=o.data.info;!N.use_model&&N.use_model!=w.use_model&&(N.use_model=w.use_model,N.model_config_id=w.model_config_id),D.value={...w},r.value=w.graph_switch==1,w.graph_switch=="0"||!A.value?ce.value=Ke.filter(ne=>!["graph_status","graph_entity_count"].includes(ne.key)):ce.value=Ke;let J=o.data.list||[],ke=o.data.count_data||{};Q.total=o.data.total,fe.learned_count=ke.learned_count,fe.learned_err_count=ke.learned_err_count,fe.learned_wait_count=ke.learned_wait_count;let te=!1;Ce.value=J.map(ne=>(["1","6","0","5"].includes(ne.status)&&(te=!0),ne.file_size_str=un(ne.file_size),ne.update_time=no(ne.update_time*1e3).format("YYYY-MM-DD HH:mm"),ne.doc_last_renew_time_desc=ne.doc_last_renew_time>0?no(ne.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",ne)),te&&Ye(),!te&&clearInterval($e.value)}).finally(()=>{f.value=!1})},$e=m(null),Ye=()=>{clearInterval($e.value),$e.value=setInterval(()=>{ee()},1e3*5)},Ge=m(null),Ie=a=>{if($.value.length==0){le.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){F.push({path:"/user/model"})}});return}let{key:o}=a;o==1&&Qe(),o==2&&ft(),o==3&&Ge.value.add()},j=ae({open:!1,urls:"",library_id:k.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(a,o)=>lo(o)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),ft=()=>{j.open=!0,j.confirmLoading=!1,j.urls="",j.doc_auto_renew_minute="02:00",j.doc_auto_renew_frequency=1},O=m(null),c=()=>{O.value.validate().then(()=>{j.confirmLoading=!0,rt({library_id:j.library_id,urls:JSON.stringify(lo(j.urls)),doc_auto_renew_frequency:j.doc_auto_renew_frequency,doc_auto_renew_minute:_t(j.doc_auto_renew_minute),doc_type:2,group_id:d.value}).then(()=>{j.open=!1,j.confirmLoading=!1,ie()})}).catch(()=>{j.confirmLoading=!1})},pe=()=>{j.open=!1},E=ae({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ye=ve(()=>E.fileList.filter(a=>a.type==="application/pdf").length>0),Se=m(null),Qe=()=>{if(D.value.type==2){Se.value.show();return}E.fileList=[],E.open=!0},Xe=()=>{E.fileList=[]},Je=a=>{E.fileList=a},gt=()=>{if(T.value&&!q.getGuideLearningTips&&E.fileList.length>1&&T.value.show(),E.fileList.length==0){H.error("请选择文件");return}E.confirmLoading=!0;let a=new FormData;a.append("library_id",Q.library_id),a.append("group_id",d.value||0);let o=!1;E.fileList.forEach(w=>{(w.name.includes(".xlsx")||w.name.includes(".csv"))&&(o=!0),a.append("library_files",w)}),ye.value&&a.append("pdf_parse_type",E.pdf_parse_type),rt(a).then(w=>{ee(),E.open=!1,E.fileList=[],E.confirmLoading=!1,o&&w.data.file_ids.length==1&&F.push("/library/document-segmentation?document_id="+w.data.file_ids[0])}).catch(()=>{E.confirmLoading=!1})},me=m(null),yt=a=>{me.value.show(a)},ht=a=>{F.push({path:"/library/document-segmentation",query:{document_id:a.id}})},Ze=a=>{cn({id:a.id}).then(()=>{ee()})},kt=()=>{if(r.value){r.value=!1;let a={graph_model_config_id:D.value.graph_model_config_id,graph_use_model:D.value.graph_use_model};if((!a.graph_model_config_id||!a.graph_use_model)&&K.value.length>0){let w=K.value[0].children[0];a.graph_use_model=w.name,a.graph_model_config_id=w.model_config_id}_.value.show(a)}else D.value.graph_switch=0,Z(!1,()=>{ee(),M(0)})},et=a=>{r.value=!0,D.value.graph_switch=1,D.value.graph_model_config_id=a.graph_model_config_id,D.value.graph_use_model=a.graph_use_model,Z(!1,()=>{ee(),M(1)})},bt=a=>{if(a.key==4&&!S.value)return!1;E.pdf_parse_type=a.key},x=()=>{window.open("#/user/aliocr")},he=m(null),Gt=a=>{he.value.show({...a})},Oo=a=>{pn({id:a.id}).then(o=>{H.success("更新成功"),ee()})},Ro=a=>{le.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){_n({id:a.id}).then(o=>{H.success("取消成功"),ee()})}})},Io=a=>{U("graph:autoOpenFileId",a.id),F.push({path:"/library/details/knowledge-graph",query:{id:k.value}})},Uo=a=>{let o=`/manage/downloadLibraryFile?id=${a.id}&token=${q.getToken}`;var w=document.createElement("a");w.href=o,w.style.display="none",w.click()},zt=()=>{b.value=!b.value,localStorage.setItem("document_group_hide_key",b.value?1:2)},Ue=()=>{Ut({library_id:k.value,group_type:1}).then(a=>{let w=(a.data||[]).reduce((J,ke)=>J+ +ke.total,0);L.value=[{group_name:"全部分组",id:-1,total:w},...a.data]})};Ue();const Nt=m(null),tt=a=>{Nt.value.show({...a,library_id:k.value})},Ht=m(null),Mo=a=>{Ht.value.show({...a,sense:1})},Bt=()=>{Ue(),ee()},Wt=a=>{d.value=a.id,ie()},jt=a=>{le.confirm({title:`确认删除分组${a.group_name}`,icon:t(We),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){go({id:a.id,sense:1}).then(()=>{H.success("删除成功"),Ue(),d.value==a.id&&(d.value=-1,ie())})}})},ze=m(ut),ot=m(!1);qt(()=>{const a=parseInt(localStorage.getItem(po));a&&a>=ut&&a<=Lt&&(ze.value=a)});let nt=!1,At=0,Vt=0;const Do=a=>{b.value||(nt=!0,ot.value=!0,At=a.clientX,Vt=ze.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Kt),document.addEventListener("mouseup",Yt))},Kt=a=>{if(!nt)return;let o=Vt+(a.clientX-At);o=Math.max(ut,Math.min(Lt,o)),ze.value=o},Yt=()=>{nt&&(nt=!1,ot.value=!1,localStorage.setItem(po,ze.value),document.body.style.cursor="",document.removeEventListener("mousemove",Kt),document.removeEventListener("mouseup",Yt))},Fo=a=>a.draggedContext.element.id>0&&a.relatedContext.element.id>0,To=async()=>{try{const a=L.value.filter(o=>o.id>0).map((o,w)=>({id:o.id,sort:L.value.length-w}));await dn({library_id:k.value,sense:1,sort_group:JSON.stringify(a)}),H.success("排序已保存")}catch(a){console.error("排序保存失败:",a),Ue()}};return qt(()=>{X.page&&(Q.page=+X.page),ee()}),gn(()=>{$e.value&&clearInterval($e.value)}),(a,o)=>{const w=Rt,J=Dt,ke=Pe,te=Co,ne=xo,st=wo,Qt=mo,Xt=Ft,Le=Tt,Me=Ve,Jt=Ae,Po=An,Eo=It,Go=Nn,Ne=Hn,Zt=Bn,zo=bo,He=Pt,eo=pt,to=le,No=Vn,Ho=So,Bo=ho("copy");return s(),l("div",Pa,[e("div",{class:re(["group-content-box",[{collapsed:b.value},{"no-transition":ot.value}]]),style:ko(b.value?{}:{width:ze.value+"px",minWidth:ut+"px",maxWidth:Lt+"px"})},[e("div",Ea,[e("div",Ga,[t(J,{title:"收起问答分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:zt},[t(w,{name:"put-away"})])]),_:1}),e("div",za,[o[17]||(o[17]=e("div",null,"知识分组",-1)),t(J,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=p=>tt({}))},[t(R(Te))])]),_:1})])]),v("",!0)]),e("div",Na,[t(Qt,{style:{"padding-right":"24px"}},{default:n(()=>[t(R(Gn),{modelValue:L.value,"onUpdate:modelValue":o[3]||(o[3]=p=>L.value=p),"item-key":"id",disabled:ot.value,onEnd:To,move:Fo,handle:".drag-btn"},{item:n(({element:p})=>[e("div",{class:re(["classify-item",{active:p.id==d.value}]),onClick:i=>Wt(p)},[p.id>0?(s(),l("span",Ba,[t(w,{name:"drag"})])):(s(),l("span",Wa)),e("div",ja,C(p.group_name),1),e("div",Aa,[e("div",{class:re(["num",{"num-block":p.id<=0}])},C(p.total),3),p.id>0?(s(),l("div",Va,[t(st,{placement:"bottomRight"},{overlay:n(()=>[t(ne,null,{default:n(()=>[t(te,null,{default:n(()=>[e("div",{onClick:se(i=>tt(p),["stop"])},"重命名",8,Ya)]),_:2},1024),t(te,null,{default:n(()=>[e("div",{onClick:se(i=>jt(p),["stop"])},"删 除",8,Qa)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",Ka,[t(R(ct))])]),_:2},1024)])):v("",!0)])],10,Ha)]),_:1},8,["modelValue","disabled"])]),_:1})]),b.value?v("",!0):(s(),l("div",{key:0,class:"resize-bar",onMousedown:Do},null,32))],6),e("div",Xa,[t(Qt,{scrollbar:!1},{default:n(()=>[e("div",Ja,[b.value?(s(),B(Xt,{key:0,title:null,placement:"bottom"},{content:n(()=>[e("div",Za,[e("div",el,[e("div",tl,[e("div",ol,[o[18]||(o[18]=e("div",null,"问答分组",-1)),t(J,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:o[4]||(o[4]=p=>tt({}))},[t(R(Te))])]),_:1})])]),e("div",nl,[t(ke,{allowClear:"",value:h.value,"onUpdate:value":o[6]||(o[6]=p=>h.value=p),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[t(R(Be),{onClick:o[5]||(o[5]=se(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",sl,[(s(!0),l(V,null,ue(u.value,p=>(s(),l("div",{class:re(["classify-item",{active:p.id==d.value}]),onClick:i=>Wt(p),key:p.id},[e("div",ll,C(p.group_name),1),e("div",il,[e("div",{class:re(["num",{"num-block":p.id<=0}])},C(p.total),3),p.id>0?(s(),l("div",ul,[t(st,{placement:"bottomRight"},{overlay:n(()=>[t(ne,null,{default:n(()=>[t(te,null,{default:n(()=>[e("div",{onClick:se(i=>tt(p),["stop"])},"重命名",8,rl)]),_:2},1024),t(te,null,{default:n(()=>[e("div",{onClick:se(i=>jt(p),["stop"])},"删 除",8,_l)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",dl,[t(R(ct))])]),_:2},1024)])):v("",!0)])],10,al))),128))])])]),default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:zt},[t(w,{name:"expand"})])]),_:1})):v("",!0),e("div",cl,C(P.value.group_name),1)]),e("div",pl,[e("div",ml,[dt(t(Le,{align:"center",class:"tool-item custom-select-box"},{default:n(()=>[o[19]||(o[19]=e("span",null,"嵌入模型：",-1)),t(io,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:N.use_model,modeId:N.model_config_id,style:{width:"240px"},onChange:de,onLoaded:xe},null,8,["modeName","modeId"])]),_:1,__:[19]},512),[[ao,!1]])]),e("div",vl,[D.value.type==0?(s(),l("div",fl,[e("div",gl,[o[20]||(o[20]=e("div",{class:"status-label"},"已学习：",-1)),e("div",yl,C(fe.learned_count),1)]),e("div",hl,[o[21]||(o[21]=e("div",{class:"status-label"},"，未学习：",-1)),e("div",kl,C(fe.learned_wait_count),1)]),e("div",bl,[o[22]||(o[22]=e("div",{class:"status-label"},"，学习失败：",-1)),e("div",wl,C(fe.learned_err_count),1)])])):v("",!0),D.value.type==0?(s(),l("div",xl,[t(Jt,{value:Q.status,"onUpdate:value":o[7]||(o[7]=p=>Q.status=p),style:{width:"150px"},placeholder:"请选择",onChange:mt},{default:n(()=>[(s(),l(V,null,ue(qe,p=>t(Me,{key:p.id,value:p.id},{default:n(()=>[y(C(p.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):v("",!0),e("div",Cl,[t(ke,{style:{width:"140px"},value:Q.file_name,"onUpdate:value":o[8]||(o[8]=p=>Q.file_name=p),placeholder:"文档名称搜索",onChange:ie},{suffix:n(()=>[t(R(Be),{onClick:ie,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),A.value?(s(),B(Le,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:n(()=>[dt(t(io,{modelType:"LLM",onLoaded:we},null,512),[[ao,!1]]),o[23]||(o[23]=e("span",null,"生成知识图谱：",-1)),t(Po,{checked:r.value,"onUpdate:checked":o[9]||(o[9]=p=>r.value=p),onChange:kt,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[23]})):v("",!0),e("div",$l,[t(st,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:n(()=>[t(ne,{onClick:Ie},{default:n(()=>[(s(),B(te,{key:1},{default:n(()=>[e("div",Sl,[t(Le,{class:"title-block",gap:4},{default:n(()=>[t(w,{name:"doc-icon"}),o[24]||(o[24]=e("div",{class:"title"},"本地文档",-1))]),_:1,__:[24]}),D.value.type==2?(s(),l("div",Ll," 上传本地 docx/csv/xlsx 等格式文件 ")):(s(),l("div",ql," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),D.value.type!=2?(s(),B(te,{key:2},{default:n(()=>[e("div",Ol,[t(Le,{class:"title-block",gap:4},{default:n(()=>[t(w,{name:"link-icon"}),o[25]||(o[25]=e("div",{class:"title"},"在线数据",-1))]),_:1,__:[25]}),o[26]||(o[26]=e("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):v("",!0),(s(),B(te,{key:3},{default:n(()=>[e("div",Rl,[t(Le,{class:"title-block",gap:4},{default:n(()=>[t(w,{name:"cu-doc-icon"}),o[27]||(o[27]=e("div",{class:"title"},"自定义文档",-1))]),_:1,__:[27]}),o[28]||(o[28]=e("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1}))]),_:1})]),default:n(()=>[t(Eo,{type:"primary"},{icon:n(()=>[t(R(Te))]),default:n(()=>[o[29]||(o[29]=e("span",null,"添加内容",-1))]),_:1,__:[29]})]),_:1})])])]),D.value.type==0?(s(),B(Mn,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:n(()=>o[30]||(o[30]=[e("div",null,[e("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),e("p",null,"2、未学习的文档数据不会被检索到。")],-1)])),_:1,__:[30]})):v("",!0),e("div",Il,[t(zo,{columns:ce.value,"data-source":Ce.value,scroll:{x:1e3},"row-key":"id",pagination:{current:Q.page,total:Q.total,pageSize:Q.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:vt},{bodyCell:n(({column:p,record:i})=>[p.key==="file_name"?(s(),l("div",Ul,[i.doc_type==2?(s(),B(Xt,{key:0,title:null},{content:n(()=>[o[31]||(o[31]=y(" 原链接：")),e("a",{href:i.doc_url,target:"_blank"},C(i.doc_url),9,Ml),dt(t(R(zn),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Bo,`${i.doc_url}`]])]),default:n(()=>[e("a",{onClick:oe=>ge(i)},[["5","6","7"].includes(i.status)?(s(),l("span",Fl,C(i.doc_url),1)):(s(),l("span",Tl,C(i.file_name),1))],8,Dl)]),_:2},1024)):(s(),l("a",{key:1,onClick:oe=>ge(i)},[["5","6","7"].includes(i.status)?(s(),l("span",El,C(i.doc_url),1)):(s(),l("span",Gl,C(i.file_name),1))],8,Pl)),i.doc_type==2&&i.remark?(s(),l("div",zl," 备注："+C(i.remark),1)):v("",!0)])):v("",!0),p.key==="graph_entity_count"?(s(),l("a",{key:1,onClick:oe=>Io(i)},C(i.graph_entity_count),9,Nl)):v("",!0),p.key==="status"?(s(),l(V,{key:2},[i.file_ext=="pdf"&&i.pdf_parse_type>=2?(s(),l(V,{key:0},[i.status==0?(s(),l("div",Hl,[e("div",Bl,[e("span",Wl,[t(R(an)),o[32]||(o[32]=y("文档解析中"))]),e("a",{onClick:oe=>Ro(i)},"取消",8,jl)]),e("div",Al,[t(Go,{size:"small",class:"progress-bar-box",percent:parseInt(i.ocr_pdf_index/i.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),e("div",Vl,C(i.ocr_pdf_index)+" / "+C(i.ocr_pdf_total),1)])])):v("",!0)],64)):(s(),l(V,{key:1},[i.status==0?(s(),l("span",Kl,[t(Ne,{size:"small"}),o[33]||(o[33]=y(" 转换中"))])):v("",!0)],64)),i.status==1?(s(),l("span",Yl,[t(Ne,{size:"small"}),o[34]||(o[34]=y(" 学习中"))])):v("",!0),i.status==2?(s(),l("span",Ql,[t(R(wt)),o[35]||(o[35]=y(" 学习完成"))])):v("",!0),i.status==3?(s(),B(J,{key:4,placement:"top"},{title:n(()=>[e("span",null,C(i.errmsg),1)]),default:n(()=>[e("span",null,[e("span",Xl,[t(R(at)),o[36]||(o[36]=y(" 转换失败"))]),D.value.type==2?(s(),l("a",{key:0,class:"ml8",onClick:oe=>ge(i)},"学习",8,Jl)):v("",!0)])]),_:2},1024)):v("",!0),i.status==8?(s(),B(J,{key:5,placement:"top"},{title:n(()=>[e("span",null,C(i.errmsg),1)]),default:n(()=>[e("span",null,[e("span",Zl,[t(R(at)),o[37]||(o[37]=y(" 转化异常"))])])]),_:2},1024)):v("",!0),i.status==4?(s(),l(V,{key:6},[e("span",ei,[t(R(xt)),o[38]||(o[38]=y(" 待学习"))]),e("a",{class:"ml8",onClick:oe=>ge(i)},"学习",8,ti)],64)):v("",!0),i.status==5?(s(),l("span",oi,[t(R(xt)),o[39]||(o[39]=y(" 待获取"))])):v("",!0),i.status==6?(s(),l("span",ni,[t(Ne,{size:"small"}),o[40]||(o[40]=y(" 获取中"))])):v("",!0),i.status==7?(s(),B(J,{key:9,placement:"top"},{title:n(()=>[e("span",null,C(i.errmsg),1)]),default:n(()=>[e("span",si,[t(R(at)),o[41]||(o[41]=y(" 获取失败"))])]),_:2},1024)):v("",!0),i.status==9?(s(),l("span",ai,[t(R(We)),o[42]||(o[42]=y(" 取消解析"))])):v("",!0),i.status==10?(s(),l("span",li,[t(Ne,{size:"small"}),o[43]||(o[43]=y(" 正在分段 "))])):v("",!0)],64)):v("",!0),p.key==="graph_status"?(s(),l(V,{key:3},[i.graph_status==0?(s(),l(V,{key:0},[e("span",ii,[t(R(xt)),o[44]||(o[44]=y(" 待生成"))]),e("a",{class:"ml8",onClick:oe=>Ze(i)},"生成",8,ui)],64)):i.graph_status==1?(s(),l("span",di,[t(R(Et)),o[45]||(o[45]=y(" 排队中"))])):i.graph_status==2?(s(),l("span",ri,[t(R(wt)),o[46]||(o[46]=y(" 生成完成"))])):i.graph_status==3?(s(),l(V,{key:3},[e("span",_i,[t(R(at)),o[47]||(o[47]=y(" 生成失败"))]),e("a",{class:"ml8",onClick:oe=>Ze(i)},"生成",8,ci),i.graph_err_msg?(s(),B(J,{key:0,title:i.graph_err_msg},{default:n(()=>[e("div",pi,"原因："+C(i.graph_err_msg),1)]),_:2},1032,["title"])):v("",!0)],64)):i.graph_status==4?(s(),l("span",mi,[t(Ne,{size:"small"}),o[48]||(o[48]=y(" 生成中"))])):i.graph_status==5?(s(),l(V,{key:5},[e("span",vi,[t(R(wt)),o[49]||(o[49]=y(" 部分成功"))]),e("div",fi,[y(" 失败数："+C(i.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:oe=>ge(i,{graph_status:3})},"详情",8,gi)])],64)):v("",!0)],64)):v("",!0),p.key==="file_size"?(s(),l(V,{key:4},[i.doc_type==3?(s(),l("span",yi,"-")):(s(),l("span",hi,C(i.file_size_str),1))],64)):v("",!0),p.key==="doc_auto_renew_frequency"?(s(),l(V,{key:5},[i.doc_type==2?(s(),l("div",ki,[e("div",bi,[i.doc_auto_renew_frequency==1?(s(),l("span",wi,"不自动更新")):v("",!0),i.doc_auto_renew_frequency==2?(s(),l("span",xi,"每天")):v("",!0),i.doc_auto_renew_frequency==3?(s(),l("span",Ci,"每3天")):v("",!0),i.doc_auto_renew_frequency==4?(s(),l("span",$i,"每7天")):v("",!0),i.doc_auto_renew_frequency==5?(s(),l("span",Si,"每30天")):v("",!0),i.doc_auto_renew_frequency>1&&i.doc_auto_renew_minute>0?(s(),l("span",Li,C(R(_t)(i.doc_auto_renew_minute)),1)):v("",!0),i.doc_auto_renew_frequency>1?(s(),l("span",qi,"更新")):v("",!0),e("a",{class:"ml4 btn-hover-block",onClick:oe=>Gt(i)},"修改",8,Oi)]),t(Le,{align:"center"},{default:n(()=>[y(" 最近更新: "+C(i.doc_last_renew_time_desc)+" ",1),t(Zt,{title:"确认更新?",onConfirm:oe=>Oo(i)},{default:n(()=>o[50]||(o[50]=[e("a",{class:"ml4 btn-hover-block"},"更新",-1)])),_:2,__:[50]},1032,["onConfirm"])]),_:2},1024)])):(s(),l("div",Ri,"--"))],64)):v("",!0),p.key==="paragraph_count"?(s(),l(V,{key:6},[i.status==0||i.status==1?(s(),l("span",Ii,"-")):(s(),l("span",Ui,C(i.paragraph_count),1))],64)):v("",!0),p.key==="action"?(s(),B(Le,{key:7,gap:8},{default:n(()=>[t(J,null,{title:n(()=>o[51]||(o[51]=[y("重新分段")])),default:n(()=>[t(R(Wn),{class:"btn-hover-block",onClick:oe=>ht(i)},null,8,["onClick"])]),_:2},1024),t(st,null,{overlay:n(()=>[t(ne,null,{default:n(()=>[i.doc_type==2?(s(),B(te,{key:0},{default:n(()=>[e("div",{onClick:oe=>Gt(i)},"编辑",8,Mi)]),_:2},1024)):v("",!0),t(te,{disabled:i.status==6||i.status==7||i.status==0},{default:n(()=>[e("div",{onClick:oe=>ge(i)},"预览",8,Di)]),_:2},1032,["disabled"]),t(te,{onClick:oe=>yt(i)},{default:n(()=>o[52]||(o[52]=[e("div",null,"重命名",-1)])),_:2,__:[52]},1032,["onClick"]),t(Zt,{title:"确定要删除吗?",onConfirm:oe=>Re(i)},{default:n(()=>[t(te,null,{default:n(()=>o[53]||(o[53]=[e("span",null,"删除",-1)])),_:1,__:[53]})]),_:2},1032,["onConfirm"]),t(te,{onClick:oe=>Mo(i)},{default:n(()=>o[54]||(o[54]=[e("div",null,"修改分组",-1)])),_:2,__:[54]},1032,["onClick"]),t(te,{onClick:oe=>Uo(i)},{default:n(()=>o[55]||(o[55]=[e("div",null,"下载文档",-1)])),_:2,__:[55]},1032,["onClick"])]),_:2},1024)]),default:n(()=>[e("div",{class:"table-btn",onClick:o[10]||(o[10]=se(()=>{},["prevent"]))},[t(R(jn),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1})]),t(to,{open:E.open,"onUpdate:open":o[12]||(o[12]=p=>E.open=p),"confirm-loading":E.confirmLoading,maskClosable:!1,title:"上传文档",onOk:gt,onCancel:Xe,width:"740px"},{default:n(()=>[t(eo,{class:"mt24"},{default:n(()=>[t(He,{required:"",label:""},{default:n(()=>[e("div",Fi,[t($o,{type:D.value.type,maxCount:20,value:E.fileList,"onUpdate:value":o[11]||(o[11]=p=>E.fileList=p),onChange:Je},null,8,["type","value"])])]),_:1}),ye.value?(s(),B(He,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:n(()=>[e("div",Ti,[(s(),l(V,null,ue(Y,p=>e("div",{key:p.key,class:re(["select-card-item",{active:E.pdf_parse_type==p.key},{disabled:p.key==4&&!S.value}]),onClick:se(i=>bt(p),["stop"])},[t(w,{class:"check-arrow",name:"check-arrow-filled"}),e("div",Ei,[t(w,{name:p.icon,style:{"font-size":"16px"}},null,8,["name"]),y(" "+C(p.title)+" ",1),p.key==4&&!S.value?(s(),l("div",Gi,"未开启")):v("",!0)]),e("div",zi,C(p.desc),1),p.key==4&&!S.value?(s(),l("div",Ni,[o[56]||(o[56]=y(" 未开启阿里云OCR ")),e("div",{class:"card-switch-btn",onClick:se(x,["stop"])},"去开启")])):v("",!0)],10,Pi)),64))])]),_:1})):v("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),t(Lo,{onOk:ee,ref_key:"qaUploadModalRef",ref:Se},null,512),t(to,{open:j.open,"onUpdate:open":o[16]||(o[16]=p=>j.open=p),"confirm-loading":j.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:c,onCancel:pe},{default:n(()=>[t(eo,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:O,model:j,rules:j.rules},{default:n(()=>[t(He,{name:"urls",label:"网页链接"},{default:n(()=>[t(No,{style:{height:"120px"},value:j.urls,"onUpdate:value":o[13]||(o[13]=p=>j.urls=p),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),t(He,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:n(()=>[t(Jt,{value:j.doc_auto_renew_frequency,"onUpdate:value":o[14]||(o[14]=p=>j.doc_auto_renew_frequency=p),style:{width:"100%"}},{default:n(()=>[t(Me,{value:1},{default:n(()=>o[57]||(o[57]=[y("不自动更新")])),_:1,__:[57]}),t(Me,{value:2},{default:n(()=>o[58]||(o[58]=[y("每天")])),_:1,__:[58]}),t(Me,{value:3},{default:n(()=>o[59]||(o[59]=[y("每3天")])),_:1,__:[59]}),t(Me,{value:4},{default:n(()=>o[60]||(o[60]=[y("每7天")])),_:1,__:[60]}),t(Me,{value:5},{default:n(()=>o[61]||(o[61]=[y("每30天")])),_:1,__:[61]})]),_:1},8,["value"])]),_:1}),j.doc_auto_renew_frequency>1?(s(),B(He,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:n(()=>[t(Ho,{valueFormat:"HH:mm",value:j.doc_auto_renew_minute,"onUpdate:value":o[15]||(o[15]=p=>j.doc_auto_renew_minute=p),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),t($a,{libraryInfo:D.value,group_id:d.value,onOk:ie,ref_key:"addCustomDocumentRef",ref:Ge},null,8,["libraryInfo","group_id"]),t(Un,{onOk:ie,ref_key:"renameModalRef",ref:me},null,512),t(qn,{onOk:et,ref_key:"openGrapgModalRef",ref:_},null,512),t(Ia,{ref_key:"guideLearningTipsRef",ref:T},null,512),t(Ua,{onOk:ee,ref_key:"editOnlineDocRef",ref:he},null,512),t(qo,{group_type:"1",ref_key:"addGroupRef",ref:Nt,onOk:Bt},null,512),t(Ta,{libraryId:k.value,sense:1,ref_key:"editGroupRef",ref:Ht,onOk:Bt},null,8,["libraryId"])])}}},Du=be(Hi,[["__scopeId","data-v-a6cc0e2e"]]);export{Du as K,Mu as Q};
