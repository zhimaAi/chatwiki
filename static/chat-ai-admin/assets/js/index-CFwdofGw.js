import{_ as De}from"./empty-CzGZrENG.js";import{r as g,ah as ae,w as Ue,E as te,a as C,b as p,y as t,t as l,F as W,l as Z,e as J,u as a,p as d,v as o,_ as k,z as _e,m as Se,D as ce,q as ee,am as Te,c as Ee}from"./vue-chunks-BdaA73Wf.js";import{u as le,_ as Re,d as Ne,l as he,bS as Ve}from"../../index-DSFcP5NQ.js";import{i as Ae,j as Le,k as Pe,l as Ye,m as ze,n as Je,o as Be,p as Ke,q as be,r as je,a as He,s as Qe,t as Ge,v as We}from"./index-p9HhDhmV.js";import{_ as ne}from"./emoji-mart-BBMRoEa3.js";import{F as re,c as me,H as ke,G as Xe,I as xe,J as we,q as fe,ac as $e,M as G,b as K,r as Ce,s as Fe,P as Ze,b9 as et,u as tt,v as at,bc as lt,B as ve,z as Oe,O as pe,m as nt,as as ot,ar as st,aX as rt,aQ as dt,ag as it,a1 as ge,aA as ut,i as _t,D as ct,f as pt,g as mt,$ as ft,ah as vt,Z as ht,w as gt,x as yt}from"./ui-antd-Dl1wwwCD.js";import{a as ye}from"./validate-8MtiUsxW.js";import{u as bt}from"./database-BsbmdMVu.js";import{d as kt}from"./utils-CvB22N-W.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";const xt={class:"add-data-sheet"},wt={class:"field-name"},$t={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(j,{expose:f,emit:R}){const{t:e}=le("views.database.database-detail.database-manage.components.add-data-modal"),z=g(e("modal_title_add")),T=ae().query,y=R,$=j;Ue(()=>$.column,M=>{r()});const O=g([]),r=()=>{let M=[];$.column.forEach(m=>{b[m.name]="",m.rules=[],m.required=="true"&&m.rules.push({required:!0,message:e("validator_required",{name:m.name})}),m.type=="number"&&m.rules.push({type:"number",message:e("validator_number",{name:m.name})}),m.type=="integer"&&m.rules.push({asyncValidator:P}),m.type=="boolean"&&(b[m.name]="false"),M.push({...m}),O.value=M})},P=(M,m)=>new Promise((v,_)=>m==""||Number.isInteger(+m)?v():_(e("validator_integer"))),Y=g(!1),b=te({form_id:T.form_id}),E=M=>{Y.value=!0,q.value&&q.value.resetFields(),r(),b.id="",Object.assign(b,V(M)),b.id?z.value=e("modal_title_edit"):z.value=e("modal_title_add")},q=g(null),U=()=>{q.value.validate().then(M=>{Ae({...b}).then(m=>{let v=b.id?e("msg_edit_success"):e("msg_add_success");K.success(v),Y.value=!1,y("ok")})})};function V(M){const m={};for(let v in M)if(M.hasOwnProperty(v)){const _=M[v];!isNaN(Number(_))&&typeof _=="string"&&_!=""?m[v]=Number(_):m[v]=_}return m}return f({show:E}),(M,m)=>{const v=fe,_=we,L=ke,c=Xe,x=xe,D=me,i=re,n=G;return p(),C("div",xt,[t(n,{open:Y.value,"onUpdate:open":m[0]||(m[0]=s=>Y.value=s),title:z.value,onOk:U,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:l(()=>[t(i,{style:{"margin-top":"16px"},model:b,ref_key:"formRef",ref:q,layout:"vertical"},{default:l(()=>[(p(!0),C(W,null,Z(O.value,s=>(p(),J(D,{name:s.name,key:s.id,rules:s.rules},{label:l(()=>[t(_,{gap:4,style:{width:"100%"}},{default:l(()=>[d("div",wt,o(s.name),1),t(v,null,{title:l(()=>[k(o(s.description),1)]),default:l(()=>[t(a($e))]),_:2},1024)]),_:2},1024)]),default:l(()=>[s.type=="boolean"?(p(),J(L,{key:0,checked:b[s.name],"onUpdate:checked":u=>b[s.name]=u,"checked-children":a(e)("switch_on"),"un-checked-children":a(e)("switch_off"),checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked","checked-children","un-checked-children"])):s.type=="number"||s.type=="integer"?(p(),J(c,{key:1,style:{width:"100%"},value:b[s.name],"onUpdate:value":u=>b[s.name]=u,valueModifiers:{number:!0},placeholder:a(e)("ph_input_content")},null,8,["value","onUpdate:value","placeholder"])):(p(),J(x,{key:2,value:b[s.name],"onUpdate:value":u=>b[s.name]=u,placeholder:a(e)("ph_input_content")},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Ct=ne($t,[["__scopeId","data-v-6f08c1a9"]]),Ft={__name:"export-modal",setup(j,{expose:f}){const{t:R}=le("views.database.database-detail.database-manage.components.export-modal"),z=ae().query,N=g(R("modal_title")),T=g(!1),y=te({dates:[],type:1}),$=()=>{T.value=!0,y.type=1,y.dates=[]},O=te({dates:[{validator:async(q,U)=>y.type==2&&!U.length?Promise.reject(R("validator_date_required")):Promise.resolve()}]}),r=re.useForm,{resetFields:P,validate:Y,validateInfos:b}=r(y,O),E=()=>{Y().then(()=>{let q={form_id:z.form_id};y.type==2&&(q.start_date=y.dates[0],q.end_date=y.dates[1]),Le(q),T.value=!1})};return f({show:$}),(q,U)=>{const V=Fe,M=Ce,m=me,v=Ze,_=re,L=G;return p(),C("div",null,[t(L,{open:T.value,"onUpdate:open":U[2]||(U[2]=c=>T.value=c),title:N.value,onOk:E,width:450},{default:l(()=>[t(_,{class:"mt16",layout:"vertical"},{default:l(()=>[t(m,{label:""},{default:l(()=>[t(M,{value:y.type,"onUpdate:value":U[0]||(U[0]=c=>y.type=c),name:"radioGroup"},{default:l(()=>[t(V,{value:1},{default:l(()=>[k(o(a(R)("radio_all_data")),1)]),_:1}),t(V,{value:2},{default:l(()=>[k(o(a(R)("radio_custom_date")),1)]),_:1})]),_:1},8,["value"])]),_:1}),_e(t(m,Se({required:"",label:a(R)("label_select_date")},a(b).dates),{default:l(()=>[t(v,{style:{width:"100%"},value:y.dates,"onUpdate:value":U[1]||(U[1]=c=>y.dates=c),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16,["label"]),[[ce,y.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},Ot=ne(Ft,[["__scopeId","data-v-ec0e8a88"]]),qt={class:"add-data-sheet"},Mt={class:"form-required-item"},It={class:"filter-list-box"},Dt={style:{"margin-left":"48px"}},Ut={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:f,emit:R}){const{t:e}=le("views.database.database-detail.database-manage.components.add-filter-modal"),z=g(e("modal_title_add")),T=ae().query,y=R,$=j;g([]);const O=g(!1),r=te({form_id:T.form_id,name:"",condition:[],type:"1",id:""}),P=()=>{let i=[{form_field_id:$.column[0].id,form_filed_type:$.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];r.condition=i},Y=i=>{r.condition.splice(i,1)},b=(i,n)=>{i.rule=void 0,i.rule_value1="",i.rule_value2="",i.form_filed_type=$.column.filter(s=>s.id==i.form_field_id)[0].type},E=(i,n)=>n.form_field_id==i.id?!1:r.condition.map(u=>u.form_field_id).includes(i.id),q=()=>{let i=r.condition.map(s=>s.form_field_id),n=$.column.filter(s=>!i.includes(s.id));if(!n.length){K.error(e("msg_field_all_added"));return}r.condition.push({form_field_id:n[0].id,form_filed_type:n[0].type,rule:void 0,rule_value1:"",rule_value2:""})},U=i=>!i.rule||i.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(i.rule),V=i=>!i.rule||i.form_filed_type=="boolean"?!1:["between"].includes(i.rule),M=(i,n,s)=>new Promise((u,S)=>U(s)?n?s.form_filed_type=="integer"?Number.isInteger(+n)?u():S(e("validator_integer")):s.form_filed_type=="number"?ye(n)?u():S(e("validator_number")):u():S(e("validator_input_required")):u()),m=(i,n,s)=>new Promise((u,S)=>V(s)?n?s.form_filed_type=="integer"?Number.isInteger(+n)?+n<+s.rule_value1?S(e("validator_value2_greater")):u():S(e("validator_integer")):s.form_filed_type=="number"?ye(n)?+n<+s.rule_value1?S(e("validator_value2_greater")):u():S(e("validator_number")):u():S(e("validator_input_required")):u()),v=()=>{O.value=!0,z.value=e("modal_title_add"),P(),r.name="",r.type="1",r.id=""},_=i=>{O.value=!0,z.value=e("modal_title_edit"),Pe({form_id:T.form_id,id:i.id}).then(n=>{let s=n.data.conditions||"[]";s=JSON.parse(s),s=s.map(u=>({form_field_id:u.form_field_id+"",form_filed_type:$.column.filter(S=>S.id==u.form_field_id)[0].type,rule:L(u.rule),rule_value1:u.rule_value1,rule_value2:u.rule_value2})),r.condition=s,r.name=n.data.name,r.type=n.data.type,r.id=n.data.id})};function L(i){const n=["string_","integer_","number_","boolean_"];for(const s of n)if(i.startsWith(s))return i.slice(s.length);return i}const c=g(null),x=()=>{c.value.validate().then(i=>{let n=r.condition.map(h=>({form_field_id:+h.form_field_id,rule:h.form_filed_type+"_"+h.rule,rule_value1:h.rule_value1,rule_value2:h.rule_value2})),s={...r,condition:JSON.stringify(n)},u=Ye,S=e("msg_add_success");r.id&&(u=ze,S=e("msg_edit_success")),u(s).then(h=>{K.success(S),O.value=!1,y("ok")})}).catch(i=>{})},D=g({string:[{label:e("rule_eq"),value:"eq"},{label:e("rule_neq"),value:"neq"},{label:e("rule_contain"),value:"contain"},{label:e("rule_not_contain"),value:"not_contain"},{label:e("rule_empty"),value:"empty"},{label:e("rule_not_empty"),value:"not_empty"}],integer:[{label:e("rule_gt"),value:"gt"},{label:e("rule_lt"),value:"lt"},{label:e("rule_gte"),value:"gte"},{label:e("rule_lte"),value:"lte"},{label:e("rule_eq"),value:"eq"},{label:e("rule_between"),value:"between"}],number:[{label:e("rule_gt"),value:"gt"},{label:e("rule_lt"),value:"lt"},{label:e("rule_gte"),value:"gte"},{label:e("rule_lte"),value:"lte"},{label:e("rule_eq"),value:"eq"},{label:e("rule_between"),value:"between"}],boolean:[{label:e("rule_true"),value:"true"},{label:e("rule_false"),value:"false"}]});return f({show:v,edit:_}),(i,n)=>{const s=xe,u=me,S=at,h=tt,A=et,H=ve,Q=Fe,se=Ce,de=re,ie=G;return p(),C("div",qt,[t(ie,{open:O.value,"onUpdate:open":n[2]||(n[2]=I=>O.value=I),title:z.value,onOk:x,width:790},{default:l(()=>[t(de,{class:"form-box",style:{"margin-top":"16px"},model:r,ref_key:"filterFormRef",ref:c,layout:"vertical"},{default:l(()=>[t(u,{label:a(e)("label_category_name"),name:"name",rules:[{required:!0,message:a(e)("validator_category_name_required")}]},{default:l(()=>[t(s,{maxLength:64,value:r.name,"onUpdate:value":n[0]||(n[0]=I=>r.name=I),placeholder:a(e)("ph_category_name")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),d("div",Mt,o(a(e)("label_filter_condition")),1),d("div",It,[(p(!0),C(W,null,Z(r.condition,(I,B)=>(p(),J(A,{key:B,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:l(()=>[d("div",null,o(a(e)("condition_label",{index:B+1})),1),t(u,null,{default:l(()=>[t(h,{value:I.form_field_id,"onUpdate:value":w=>I.form_field_id=w,style:{width:"150px"},placeholder:a(e)("ph_select"),onChange:w=>b(I,B)},{default:l(()=>[(p(!0),C(W,null,Z($.column,w=>(p(),J(S,{disabled:E(w,I),key:w.id,value:w.id},{default:l(()=>[k(o(w.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder","onChange"])]),_:2},1024),t(u,{name:["condition",B,"rule"],rules:{required:!0,message:a(e)("validator_rule_required")}},{default:l(()=>[t(h,{value:I.rule,"onUpdate:value":w=>I.rule=w,style:{width:"120px"},placeholder:a(e)("validator_rule_required")},{default:l(()=>[(p(!0),C(W,null,Z(D.value[I.form_filed_type],w=>(p(),J(S,{key:w.value,value:w.value},{default:l(()=>[k(o(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","rules"]),_e(t(u,{name:["condition",B,"rule_value1"],rules:{asyncValidator:(w,oe)=>M(w,oe,I)}},{default:l(()=>[t(s,{value:I.rule_value1,"onUpdate:value":w=>I.rule_value1=w,placeholder:a(e)("ph_input")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","rules"]),[[ce,U(I)]]),_e(t(u,{name:["condition",B,"rule_value2"],rules:{asyncValidator:(w,oe)=>m(w,oe,I),trigger:"blur"}},{default:l(()=>[t(s,{value:I.rule_value2,"onUpdate:value":w=>I.rule_value2=w,placeholder:a(e)("ph_input")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","rules"]),[[ce,V(I)]]),r.condition.length>1?(p(),J(a(lt),{key:0,onClick:w=>Y(B)},null,8,["onClick"])):ee("",!0)]),_:2},1024))),128)),d("div",Dt,[t(H,{onClick:q},{default:l(()=>[k(o(a(e)("btn_add_condition")),1)]),_:1})])]),t(u,{label:a(e)("label_condition_relation"),required:""},{default:l(()=>[t(se,{value:r.type,"onUpdate:value":n[1]||(n[1]=I=>r.type=I)},{default:l(()=>[t(Q,{value:"1"},{default:l(()=>[k(o(a(e)("radio_and")),1)]),_:1}),t(Q,{value:"2"},{default:l(()=>[k(o(a(e)("radio_or")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},qe=ne(Ut,[["__scopeId","data-v-0796fc52"]]),St={class:"custom-table"},Tt={class:"t-head"},Et={class:"td"},Rt={class:"td"},Nt={class:"td"},Vt={class:"td flex-none",style:{width:"120px"}},At={class:"t-body"},Lt={class:"t-row"},Pt={class:"t-item"},Yt={class:"t-item"},zt={class:"t-item"},Jt={class:"t-item"},Bt={class:"drag-btn"},Kt={key:0},jt={key:1},Ht={class:"t-item"},Qt={class:"t-item"},Gt={class:"t-item flex-none",style:{width:"120px"}},Wt=["onClick"],Xt=["onClick"],Zt={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(j,{expose:f,emit:R}){const{t:e}=le("views.database.database-detail.database-manage.components.filter-manage-modal"),N=ae().query,T=R,y=g(e("modal_title")),$=g(!1),O=j,r=()=>{be({form_id:N.form_id}).then(v=>{E.value=v.data.map(_=>({..._}))})},P=()=>{r(),T("ok"),T("change")},Y=()=>{r(),$.value=!0},b=()=>{$.value=!1},E=g(),q=()=>{let v=[];E.value.reverse().forEach((_,L)=>{v.push({id:+_.id,sort:+L+1})}),Je({form_id:N.form_id,filter_sort:JSON.stringify(v)}).then(_=>{K.success(e("msg_sort_success")),r(),T("change")})},U=v=>{Be({form_id:N.form_id,id:v.id,enabled:v.enabled=="true"?"false":"true"}).then(_=>{K.success(e("msg_set_success")),r(),T("change")})},V=(v,_)=>{G.confirm({title:e("modal_delete_title"),icon:t(pe),content:e("modal_delete_content"),okText:e("modal_delete_ok"),okType:"danger",cancelText:e("modal_delete_cancel"),onOk(){Ke({id:v.id,form_id:N.form_id}).then(L=>{K.success(e("msg_delete_success")),E.value.splice(_,1),T("change")})},onCancel(){}})},M=g(null),m=v=>{M.value.edit(v)};return f({show:Y}),(v,_)=>{const L=ke,c=Re,x=fe,D=Oe,i=G;return p(),C("div",null,[t(i,{open:$.value,"onUpdate:open":_[1]||(_[1]=n=>$.value=n),title:y.value,onCancel:b,footer:null,width:760},{default:l(()=>[d("div",St,[d("div",Tt,[d("div",Et,[_[2]||(_[2]=d("div",{style:{width:"24px"}},null,-1)),k(" "+o(a(e)("column_category_name")),1)]),d("div",Rt,o(a(e)("column_type")),1),d("div",Nt,o(a(e)("column_enabled")),1),d("div",Vt,o(a(e)("column_action")),1)]),d("div",At,[d("div",Lt,[d("div",Pt,[_[3]||(_[3]=d("div",{style:{width:"24px"}},null,-1)),k(" "+o(a(e)("text_all")),1)]),d("div",Yt,o(a(e)("type_system")),1),d("div",zt,[t(L,{checked:!0,disabled:"","checked-children":a(e)("switch_on"),"un-checked-children":a(e)("switch_off")},null,8,["checked-children","un-checked-children"])]),_[4]||(_[4]=d("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1))]),t(a(Te),{modelValue:E.value,"onUpdate:modelValue":_[0]||(_[0]=n=>E.value=n),"item-key":"id",onEnd:q,group:"table-rows",handle:".drag-btn"},{item:l(({element:n,index:s})=>[(p(),C("div",{key:n.id,class:"t-row"},[d("div",Jt,[d("span",Bt,[t(c,{name:"drag"})]),n.name.length>10?(p(),C("span",Kt,[t(x,null,{title:l(()=>[k(o(n.name),1)]),default:l(()=>[k(" "+o(n.name.slice(0,10)+"..."),1)]),_:2},1024)])):(p(),C("span",jt,o(n.name),1))]),d("div",Ht,o(a(e)("type_custom")),1),d("div",Qt,[t(L,{onChange:u=>U(n),checked:n.enabled,"checked-children":a(e)("switch_on"),"un-checked-children":a(e)("switch_off"),checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked","checked-children","un-checked-children"])]),d("div",Gt,[d("a",{onClick:u=>m(n)},o(a(e)("action_edit")),9,Wt),t(D,{type:"vertical"}),d("a",{onClick:u=>V(n,s)},o(a(e)("action_delete")),9,Xt)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),t(qe,{onOk:P,column:O.column,ref_key:"addFilrerModalRef",ref:M},null,8,["column"])])}}},ea=ne(Zt,[["__scopeId","data-v-7a896732"]]),ta={class:"upload-box"},aa={class:"ant-upload-drag-icon"},la={class:"ant-upload-text"},na={class:"ant-upload-hint"},oa={key:0,class:"progress-box"},sa={class:"tip"},ra={key:0},da={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:f,emit:R}){const{t:e}=le("views.database.database-detail.database-manage.components.import-data-modal"),z=Ne(),N=R,T=ae().query,y=j,$=g(!1),O=g(!1),r=te({total:0,success:0,err_data:[]}),P=g([]),Y=c=>{const x=c.file.status;if(x==="done")if(c.file.response.res==0){let D=c.file.response.data.task_id;q(D)}else return P.value=[],K.error(c.file.response.msg);else x==="error"&&(P.value=[],K.error(e("msg_upload_failed",{name:c.file.name})))};function b(c){}let E=null;const q=c=>{E&&clearInterval(E),$.value=!1,v.value=!0,_.value=10,r.total=0,r.success=0,r.err_data=[],E=setInterval(()=>{je({task_id:c}).then(x=>{let D=x.data;_.value=(D.processed/D.total).toFixed(),D.finish&&(N("ok"),clearInterval(E),_.value=100),D.total>0&&(r.total=D.total,r.success=D.success,r.err_data=D.err_data)}).catch(()=>{clearInterval(E)})},2e3)},U=()=>{let c;c=y.column.map(x=>x.name),c="id,"+c.join(",")+`
`,he(c,[],[],e("template_name_excel"))},V=()=>{let c={id:""};y.column.forEach(x=>{c[x.name]=""}),Ve([c],e("template_name_json"))},M=()=>{P.value=[],$.value=!0},m=()=>{},v=g(!1),_=g(10),L=()=>{let c="id,",x=["id"];for(let n in r.err_data[0])n!="id"&&n!="err_msg"&&(c+=n+",",x.push(n));c=c+`err_msg
`,x.push("err_msg");let D=r.err_data,i=e("fail_data_name")+kt().format("YYYY/MM/DD HH:mm")+".xlsx";he(c,D,x,i)};return f({show:M}),(c,x)=>{const D=nt,i=ot,n=G,s=rt,u=ve,S=dt;return p(),C("div",null,[t(n,{open:$.value,"onUpdate:open":x[1]||(x[1]=h=>$.value=h),title:a(e)("modal_title"),"confirm-loading":O.value,onOk:m,footer:null,width:746},{default:l(()=>[t(D,{"show-icon":"",class:"alert-box"},{message:l(()=>[d("div",null,[k(o(a(e)("alert_support"))+" ",1),d("a",{onClick:U,class:"mr8"},o(a(e)("link_excel_template")),1),d("a",{onClick:V},o(a(e)("link_json_template")),1)]),d("div",null,o(a(e)("alert_instruction")),1)]),_:1}),d("div",ta,[t(i,{fileList:P.value,"onUpdate:fileList":x[0]||(x[0]=h=>P.value=h),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:a(z).getToken},data:{form_id:a(T).form_id},action:"/manage/uploadFormFile",onChange:Y,onDrop:b},{default:l(()=>[d("p",aa,[t(a(st))]),d("p",la,o(a(e)("upload_text")),1),d("p",na,o(a(e)("upload_hint")),1)]),_:1},8,["fileList","headers","data"])])]),_:1},8,["open","title","confirm-loading"]),t(n,{open:v.value,"onUpdate:open":x[2]||(x[2]=h=>v.value=h),title:a(e)("modal_title"),footer:null,width:746},{default:l(()=>[_.value<100?(p(),C("div",oa,[t(s,{type:"circle",percent:_.value},null,8,["percent"]),d("div",sa,o(a(e)("progress_tip")),1)])):(p(),J(S,{key:1,status:"success",title:a(e)("result_title")},{subTitle:l(()=>[k(o(a(e)("result_subtitle",{success:r.success,fail:r.total-r.success}))+" ",1),r.total-r.success>0?(p(),C("span",ra,o(a(e)("result_subtitle_tip")),1)):ee("",!0)]),extra:l(()=>[r.total-r.success>0?(p(),J(u,{key:0,onClick:L,type:"primary"},{default:l(()=>[k(o(a(e)("btn_download_fail")),1)]),_:1})):ee("",!0)]),_:1},8,["title"]))]),_:1},8,["open","title"])])}}},ia=ne(da,[["__scopeId","data-v-2de33903"]]),ua={key:0,class:"loading-box"},_a={key:1,class:"empty-box"},ca={key:2,class:"field-manage-page"},pa={class:"page-title"},ma={key:0},fa={key:1},va={class:"table-wrapper customize-scroll-style"},ha={key:0},ga={key:1},ya={key:0},ba={key:1},ka=["onClick"],xa=["onClick"],wa={__name:"index",setup(j){const{t:f}=le("views.database.database-detail.database-manage.index"),R=bt(),e=Ee(()=>R.databaseInfo.entry_count),N=ae().query,T=g([]),y=g([]),$=g(!0),O=te({form_id:N.form_id,page:1,size:10,total:0}),r=g(!1),P=h=>{O.page=h.current,O.size=h.pageSize,b()},Y=()=>{O.page=1,b()},b=()=>{r.value=!0,Qe({...O,filter_id:q.value}).then(h=>{T.value=h.data.list||[],O.total=+h.data.total||0,R.getDatabaseInfo({id:N.form_id})}).finally(()=>{r.value=!1})};He({form_id:N.form_id}).then(h=>{y.value=h.data,$.value=!1,b()});const E=g([]),q=g(""),U=()=>{be({form_id:N.form_id}).then(h=>{let A=h.data||[];if(E.value=A.filter(H=>H.enabled=="true"),q.value){let H=A.filter(Q=>Q.id==q.value);(H.length&&H[0].enabled=="false"||!H.length)&&(q.value="",b())}})};U();const V=()=>{U(),b()},M=()=>{O.page=1,b()},m=g(null),v=(h,A)=>{A==="add"&&m.value.show()},_=h=>{G.confirm({title:f("modal_delete_title"),icon:t(pe),content:f("modal_delete_content"),okText:f("modal_delete_ok"),okType:"danger",cancelText:f("modal_delete_cancel"),onOk(){We({id:h.id}).then(A=>{K.success(f("msg_delete_success")),V()})},onCancel(){}})},L=()=>{G.confirm({title:f("modal_clear_title"),icon:t(pe),content:f("modal_clear_content"),okText:f("modal_clear_ok"),okType:"danger",cancelText:f("modal_clear_cancel"),onOk(){Ge({form_id:N.form_id}).then(h=>{K.success(f("msg_clear_success")),V()})},onCancel(){}})},c=g(null),x=(h={})=>{c.value.show(JSON.parse(JSON.stringify(h)))},D=g(null),i=(h={})=>{D.value.show()},n=g(null),s=()=>{n.value.show()},u=g(null),S=()=>{u.value.show()};return(h,A)=>{const H=it,Q=ve,se=mt,de=pt,ie=_t,I=we,B=ft,w=fe,oe=ht,ue=gt,Me=Oe,Ie=yt;return p(),C(W,null,[$.value?(p(),C("div",ua,[t(H)])):ee("",!0),!$.value&&!y.value.length?(p(),C("div",_a,[A[3]||(A[3]=d("img",{src:De,alt:""},null,-1)),d("div",null,o(a(f)("empty_no_fields")),1)])):ee("",!0),!$.value&&y.value.length?(p(),C("div",ca,[d("div",pa,[k(o(a(f)("title"))+" ",1),t(I,{gap:16},{default:l(()=>[t(Q,{type:"primary",onClick:A[0]||(A[0]=F=>x())},{icon:l(()=>[t(a(ge))]),default:l(()=>[k(" "+o(a(f)("btn_add_data")),1)]),_:1}),t(Q,{onClick:A[1]||(A[1]=F=>i())},{icon:l(()=>[t(a(ut))]),default:l(()=>[k(" "+o(a(f)("btn_import_data")),1)]),_:1}),t(ie,null,{overlay:l(()=>[t(de,null,{default:l(()=>[t(se,{key:"1"},{default:l(()=>[d("div",{onClick:s},o(a(f)("menu_export_data")),1)]),_:1}),t(se,{key:"2"},{default:l(()=>[d("div",{onClick:L},o(a(f)("menu_clear_data")),1)]),_:1})]),_:1})]),default:l(()=>[t(Q,null,{default:l(()=>[k(o(a(f)("btn_more_actions"))+" ",1),t(a(ct))]),_:1})]),_:1})]),_:1})]),t(oe,{class:"tabs-wrapper",activeKey:q.value,"onUpdate:activeKey":A[2]||(A[2]=F=>q.value=F),type:"editable-card",onEdit:v,onChange:M},{addIcon:l(()=>[t(a(ge)),k(" "+o(a(f)("tab_add_category")),1)]),rightExtra:l(()=>[d("span",{class:"setting-btn",onClick:S},[t(a(vt)),k(" "+o(a(f)("btn_manage_category")),1)])]),default:l(()=>[t(B,{key:"",closable:!1},{tab:l(()=>[k(o(a(f)("tab_all",{count:e.value})),1)]),_:1}),(p(!0),C(W,null,Z(E.value,F=>(p(),J(B,{key:F.id,closable:!1},{tab:l(()=>[F.name.length>8?(p(),C("span",ma,[t(w,null,{title:l(()=>[k(o(F.name),1)]),default:l(()=>[k(" "+o(F.name.slice(0,8)+"..."),1)]),_:2},1024)])):(p(),C("span",fa,o(F.name),1)),k(" ("+o(F.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),d("div",va,[t(Ie,{sticky:"","data-source":T.value,loading:r.value,scroll:{x:1e3},pagination:{current:O.page,total:O.total,pageSize:O.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:P},{default:l(()=>[t(ue,{key:"id","data-index":"id",title:a(f)("column_id_title"),width:60},null,8,["title"]),(p(!0),C(W,null,Z(y.value,F=>(p(),J(ue,{key:F.name,"data-index":F.name,width:165},{title:l(()=>[F.name.length>12?(p(),C("span",ha,[t(w,null,{title:l(()=>[k(o(F.name),1)]),default:l(()=>[k(" "+o(F.name.slice(0,12)+"..."),1)]),_:2},1024)])):(p(),C("span",ga,o(F.name),1)),t(w,null,{title:l(()=>[k(o(F.description),1)]),default:l(()=>[t(a($e),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:l(({record:X})=>[X[F.name].length>10?(p(),C("span",ya,[t(w,null,{title:l(()=>[k(o(X[F.name]),1)]),default:l(()=>[k(" "+o(X[F.name].slice(0,9)+"..."),1)]),_:2},1024)])):(p(),C("span",ba,o(X[F.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),t(ue,{key:"action",title:a(f)("column_action_title"),width:120,fixed:"right"},{default:l(({record:F})=>[d("span",null,[d("a",{onClick:X=>x(F)},o(a(f)("action_edit")),9,ka),t(Me,{type:"vertical"}),d("a",{onClick:X=>_(F)},o(a(f)("action_delete")),9,xa)])]),_:1},8,["title"])]),_:1},8,["data-source","loading","pagination"])]),t(Ct,{onOk:V,column:y.value,ref_key:"addDataModalRef",ref:c},null,8,["column"]),t(qe,{onOk:V,column:y.value,ref_key:"addFilrerModalRef",ref:m},null,8,["column"]),t(Ot,{ref_key:"exportModalRef",ref:n},null,512),t(ea,{onOk:b,onChange:U,column:y.value,ref_key:"filterManageModalRef",ref:u},null,8,["column"]),t(ia,{onOk:Y,column:y.value,ref_key:"importDataModalRef",ref:D},null,8,["column"])])):ee("",!0)],64)}}},Va=ne(wa,[["__scopeId","data-v-512a724b"]]);export{Va as default};
//# sourceMappingURL=index-CFwdofGw.js.map
