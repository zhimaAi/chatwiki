import{_ as I,b as N,ad as K,ac as Q,d as X,bV as Z,ay as M,bs as z,bm as ee,bW as ae,f as te,A as oe,ax as ne,br as le}from"../../index-DxV-PNCd.js";import{ac as L,F as se,ax as re,ad as k,as as t,at as i,k as l,ar as d,u as n,B as $,e as O,f as A,r as S,o as ie,ae as _e,af as T,av as ce,az as de,G as pe}from"./vue-chunks-CGLjTDrY.js";import{v as ue,h as me,i as fe,k as be,b as q,F,e as ye,I as ve,$ as he,M as E,B as ge,a6 as xe,W as ke}from"./ui-antd-AfNpv4wx.js";import{t as we}from"./validate-8MtiUsxW.js";import{A as Ce}from"./avatar-input-aujoXAeD.js";import{_ as Le}from"./page-alert-CTw-f32X.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";const $e={class:"list-box"},Ae=["onClick"],De={class:"library-info"},Be=["src"],Oe={class:"library-info-content"},qe={class:"library-title"},Ie={class:"item-body"},Ne={class:"item-footer"},Re={class:"library-size"},Se={class:"text-item"},Te={class:"text-item"},Fe=["onClick"],Me=["onClick"],ze={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup(D,{emit:r}){const{t:s}=N("views.public-library.list"),h=r,w=D,y=p=>{h("edit",p)},m=p=>{h("delete",p)};return(p,u)=>{const g=ue,C=X,b=fe,_=me,e=be;return k(),L("div",$e,[(k(!0),L(se,null,re(w.list,o=>(k(),L("div",{class:"list-item-wrapper",key:o.id},[t("div",{class:"list-item",onClick:$(f=>y(o),["stop"])},[t("div",De,[t("img",{class:"library-icon",src:o.avatar,alt:""},null,8,Be),t("div",Oe,[t("div",qe,i(o.library_name),1)])]),t("div",Ie,[l(g,{title:n(Q)(o.library_intro,o,14,2,0),placement:"top"},{default:d(()=>[t("div",{class:"library-desc",ref_for:!0,ref:f=>n(K)(f,o)},i(o.library_intro),513)]),_:2},1032,["title"])]),t("div",Ne,[t("div",Re,[t("span",Se,i(n(s)("document_label"))+i(o.file_total),1),t("span",Te,i(n(s)("size_label"))+i(o.file_size_str),1)]),t("div",{class:"action-box",onClick:u[1]||(u[1]=$(()=>{},["stop"]))},[l(e,null,{overlay:d(()=>[l(_,null,{default:d(()=>[l(b,null,{default:d(()=>[t("a",{href:"javascript:;",onClick:$(f=>y(o),["stop"])},i(n(s)("manage_action")),9,Fe)]),_:2},1024),l(b,null,{default:d(()=>[t("a",{class:"delete-text-color",href:"javascript:;",onClick:f=>m(o)},i(n(s)("delete_action")),9,Me)]),_:2},1024)]),_:2},1024)]),default:d(()=>[t("div",{class:"action-item",onClick:u[0]||(u[0]=$(()=>{},["stop"]))},[l(C,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,Ae)]))),128))])}}},Ee=I(ze,[["__scopeId","data-v-fa5432b3"]]),Pe={class:"form-box"},Ve={class:"form-item-tip"},Ue={__name:"add-library-model",setup(D,{expose:r}){const{t:s}=N("views.public-library.add.add-library-model"),h=Z(),w=O(()=>h.getCurrentLocale.lang==="zh-CN"?5:24);q.config({duration:2});const y=ce(),m=A(!1),p=O(()=>1);let u="",g="";const C=F.useForm,b=A(!1),_=p.value==0?M:z,e=S({type:p.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:_,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:p.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),o=S({library_name:[{required:!0,message:s("library_name_required"),trigger:"change"}]}),{validate:f,validateInfos:R}=C(e,o),P=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file},V=()=>{m.value=!1},U=()=>{f().then(()=>{J()}).catch(a=>{})},J=()=>{let a=new FormData,c=JSON.parse(JSON.stringify(e));a.append("type",e.type),a.append("access_rights",e.access_rights),a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",c.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar_file?e.avatar_file:""),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(we(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),a.append("is_default",2),b.value=!0,ee(a).then(x=>{q.success(s("create_success")),g=x.data.id,u=x.data.library_key,j(x.data.id)}).catch(()=>{b.value=!1})},W=async()=>{let a=s("untitled_document"),c={library_key:u,doc_id:"",doc_type:"4",pid:0,title:a,content:s("untitled_document_heading"),sort:0};return await ae(c)},j=()=>{W().then(a=>{let c=a.data.doc_id;y.replace({path:"/public-library/editor",query:{library_id:g,library_key:u,doc_id:c}})})};return r({show:()=>{m.value=!0}}),ie(()=>{}),(a,c)=>{const x=ve,B=ye,G=he,Y=F,H=E;return k(),_e(H,{open:m.value,"onUpdate:open":c[3]||(c[3]=v=>m.value=v),title:n(s)("modal_title"),onOk:U,confirmLoading:b.value,onCancel:V,width:"640px"},{default:d(()=>[t("div",Pe,[l(Y,{"label-col":{span:w.value}},{default:d(()=>[l(B,T({ref:"name",label:n(s)("library_name_label")},n(R).library_name),{default:d(()=>[l(x,{value:e.library_name,"onUpdate:value":c[0]||(c[0]=v=>e.library_name=v),type:"text",placeholder:n(s)("library_name_placeholder"),maxlength:20},null,8,["value","placeholder"])]),_:1},16,["label"]),l(B,{label:n(s)("library_intro_label")},{default:d(()=>[l(G,{maxlength:1e3,value:e.library_intro,"onUpdate:value":c[1]||(c[1]=v=>e.library_intro=v),placeholder:n(s)("library_intro_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(B,T({ref:"name",label:n(s)("library_cover_label")},n(R).avatar),{default:d(()=>[l(Ce,{value:e.avatar,"onUpdate:value":c[2]||(c[2]=v=>e.avatar=v),onChange:P},null,8,["value"]),t("div",Ve,i(n(s)("library_cover_tip")),1)]),_:1},16,["label"])]),_:1},8,["label-col"])])]),_:1},8,["open","title","confirmLoading"])}}},Je=I(Ue,[["__scopeId","data-v-9ef62fa7"]]),We={"bg-color":"#f5f9ff",class:"library-page"},je={class:"page-title"},Ge={class:"library-page-body"},Ye={class:"list-toolbar"},He={class:"toolbar-box"},Ke={class:"list-total"},Qe={key:0,class:"toolbar-box"},Xe={__name:"index",setup(D){const{t:r}=N("views.public-library.list");let{role_permission:s,role_type:h}=te();const w=O(()=>h==1||s.includes("CreateOpenLibDoc")),y=A(null),m=A([]),p=()=>{oe({type:1}).then(_=>{let e=_.data||[];e.forEach(o=>{o.file_size_str=ne(o.file_size),o.avatar||(o.avatar=o.type==0?M:z)}),m.value=e})};p();const u=()=>{y.value.show()},g=_=>{window.open(`/#/public-library/home?library_id=${_.id}&library_key=${_.library_key}`,"_blank","noopener")},C=_=>{let e=3,o=E.confirm({title:r("delete_title",{library_name:_.library_name}),icon:l(ke),content:r("delete_confirm"),okText:e+" "+r("confirm"),okType:"danger",okButtonProps:{disabled:!0},cancelText:r("cancel"),onOk(){b(_)},onCancel(){}}),f=setInterval(()=>{e==1?(o.update({okText:r("confirm"),okButtonProps:{disabled:!1}}),clearInterval(f),f=void 0):(e-=1,o.update({okText:e+" "+r("confirm"),okButtonProps:{disabled:!0}}))},1e3)},b=({id:_})=>{le({id:_}).then(()=>{q.success(r("delete_success")),p()})};return(_,e)=>{const o=ge;return k(),L("div",We,[t("div",je,i(n(r)("page_title")),1),l(Le,{style:{"margin-bottom":"16px"},title:n(r)("usage_instruction")},{default:d(()=>[t("div",null,[t("p",null,i(n(r)("usage_instruction_1")),1),t("p",null,i(n(r)("usage_instruction_2")),1)])]),_:1},8,["title"]),t("div",Ge,[t("div",Ye,[t("div",He,[t("h3",Ke,i(n(r)("all"))+" ("+i(m.value.length)+")",1)]),w.value?(k(),L("div",Qe,[l(o,{type:"primary",onClick:e[0]||(e[0]=f=>u())},{icon:d(()=>[l(n(xe))]),default:d(()=>[pe(" "+i(n(r)("new_document")),1)]),_:1})])):de("",!0)]),t("div",null,[l(Ee,{list:m.value,onAdd:u,onEdit:g,onDelete:C},null,8,["list"])])]),l(Je,{ref_key:"addLibraryModelRef",ref:y},null,512)])}}},_a=I(Xe,[["__scopeId","data-v-8ca049ec"]]);export{_a as default};
