import{aa as ce,f as i,o as J,b as ue,y as j,Y as r,_ as l,a1 as V,a5 as n,F as z,a9 as O,k as q,a7 as b,a2 as W,ae as K,B as pe,r as de,ab as fe,ad as G,u as ve}from"./vue-chunks-yZ4gwLzA.js";import{E as _e}from"./empty-box-BtBuqm69.js";import{aa as Q,b as Z}from"../../index-CuFGOJXl.js";import{L as he}from"./loading-box-Bi7OKboQ.js";import{p as ye,X as me,I as ge}from"./ui-antd-BKjlZQNA.js";import{_ as ke}from"./main-tab-Bc5qv-6k.js";import"./empty-BFmzY9bl.js";import"./utils-smNh_pj2.js";import"./list-tabs-BFnVvZDT.js";import"./index-DhTdak07.js";const be="/assets/img/default-mcp-5uSmehjD.png";function Ce(C={}){return Q.get({url:"/manage/getMcpSquareTypeList",params:C})}function we(C={}){return Q.get({url:"/manage/getMcpSquareList",params:C})}const Re={class:"_plugin-box"},xe={key:1,class:"plugin-list"},Me=["onClick"],Se={class:"base-info"},Be=["src"],Ee={key:1,class:"avatar",src:be},Te={class:"info"},$e={class:"head"},qe={class:"name zm-line1"},Ae=["href"],De={class:"source"},Ie={class:"popover-type-box"},Le={__name:"square",props:{filterData:{type:Object,default:null},scrollRoot:{type:Object,default:null}},setup(C,{expose:A}){const w=C;ce();const m=i(!0),p=i([]),g=i({}),k=i({}),d=i({}),R=i(1),M=i(50),x=i(!0),S=i(!1),B=i(null);let o=null,u=0;J(()=>{D(),window.addEventListener("resize",P),ne()}),ue(()=>{window.removeEventListener("resize",P),o&&(o.disconnect(),o=null)});function N(a,e){if(!a)return null;const t=document.createElement("canvas").getContext("2d");t.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const v=t.measureText(a).width,c=(e==null?void 0:e.title_width)||120;return v>c?a:null}function f(){p.value=[],R.value=1,x.value=!0,D(!0)}async function D(a=!1){m.value=!0;const e={...w.filterData||{},page:R.value,size:M.value};we(e).then(s=>{var v;let t=((v=s==null?void 0:s.data)==null?void 0:v.data)||[];a||R.value===1?p.value=t:p.value=[...p.value,...t],x.value=Array.isArray(t)&&t.length>=M.value,j(()=>{U()})}).finally(()=>{m.value=!1,S.value=!1})}function ee(a){window.open(a.source_url,"_blank")}function te(a,e){const s=d.value[e];return Array.isArray(s)?s:a.filter_type_list}function ae(a,e){if(typeof a>"u")return;const s=g.value[a];e?s!==e&&(g.value[a]=e,U()):s&&delete g.value[a]}function se(){Object.keys(g.value).forEach(e=>{const s=g.value[e],t=p.value[Number(e)];if(!s||!t)return;const v=s.clientWidth,H=getComputedStyle(s).gap||"0px",E=parseFloat(H.split(" ")[0])||0,h=document.createElement("div");h.style.position="absolute",h.style.visibility="hidden",h.style.display="flex",h.style.flexWrap="nowrap",h.style.gap=H,s.appendChild(h);const I=[];t.filter_type_list.forEach(y=>{const _=document.createElement("div");_.className="type-tag",_.style.whiteSpace="nowrap",_.textContent=y.type_title,h.appendChild(_),I.push(_.getBoundingClientRect().width+E)});const T=document.createElement("div");T.className="type-tag type-more",T.style.whiteSpace="nowrap",T.textContent="更多",h.appendChild(T);const oe=T.getBoundingClientRect().width+E;s.removeChild(h);const ie=I.reduce((y,_,F)=>y+_+(F>0?E:0),0),L=d.value[e],X=!!k.value[e];if(ie<=v){(X||!Array.isArray(L)||L.length!==t.filter_type_list.length)&&(d.value[e]=t.filter_type_list,k.value[e]=!1);return}let Y=0,$=0;for(let y=0;y<I.length;y++){const _=($>0?E:0)+I[y],F=($>0?E:0)+oe;if(Y+_+F<=v)Y+=_,$++;else break}const re=Array.isArray(L)?L.length:0;(!X||re!==$)&&(d.value[e]=t.filter_type_list.slice(0,$),k.value[e]=!0)})}function P(){j(()=>U())}function ne(){o=new IntersectionObserver(a=>{a.forEach(e=>{e.isIntersecting&&!m.value&&!S.value&&x.value&&p.value.length>0&&(S.value=!0,R.value+=1,D())})},{root:w.scrollRoot||null,threshold:.1}),j(()=>{B.value&&o.observe(B.value)})}function U(){u&&(cancelAnimationFrame(u),u=0),u=requestAnimationFrame(()=>{u=0,se()})}function le(a,e){a&&e&&(e.title_width=a.offsetWidth)}return A({search:f}),(a,e)=>{const s=ye;return l(),r("div",Re,[m.value?(l(),V(he,{key:0})):p.value.length?(l(),r("div",xe,[(l(!0),r(z,null,O(p.value,(t,v)=>(l(),r("div",{key:t.name,onClick:c=>ee(t),class:"plugin-item"},[n("div",Se,[t.icon?(l(),r("img",{key:0,class:"avatar",src:t.icon},null,8,Be)):(l(),r("img",Ee)),n("div",Te,[n("div",$e,[n("span",qe,b(t.title),1),n("a",{class:"source",href:t.source_url,target:"_blank"},b(t.source),9,Ae)]),n("div",De,b(t.author),1)])]),q(s,{title:N(t.description,t),placement:"top"},{default:W(()=>[n("div",{class:"desc zm-line1",ref_for:!0,ref:c=>le(c,t)},b(t.description),513)]),_:2},1032,["title"]),n("div",{class:"type-box",ref_for:!0,ref:c=>ae(v,c)},[(l(!0),r(z,null,O(te(t,v),c=>(l(),r("div",{key:c,class:"type-tag"},b(c.type_title),1))),128)),k.value[v]?(l(),V(s,{key:0,placement:"top"},{title:W(()=>[n("div",Ie,[(l(!0),r(z,null,O(t.filter_type_list,c=>(l(),r("div",{key:c,class:"type-tag"},b(c.type_title),1))),128))])]),default:W(()=>[n("div",{class:"type-tag type-more",onClick:e[0]||(e[0]=pe(()=>{},["stop"]))},"更多")]),_:2},1024)):K("",!0)],512)],8,Me))),128)),n("div",{ref_key:"loadMoreRef",ref:B,class:"load-more-sentinel"},null,512)])):(l(),V(_e,{key:2,title:"暂无可用MCP"}))])}}},ze=Z(Le,[["__scopeId","data-v-518ac499"]]),Oe={class:"_container"},We={class:"header"},Ne={class:"main-tab-box"},Ue={class:"filter-box"},Fe={class:"radio-tabs"},je=["onClick"],Ve=["src"],Pe={__name:"index",setup(C){const A=fe(),w=i(null),m=i(null),p=i(null),g=i(localStorage.getItem("zm:explore:active")||"5"),k=i([]),d=de({title:"",filter_type:0});J(()=>{A.query.active>1&&w.value.change(A.query.active),R()});function R(){Ce().then(o=>{k.value=(o==null?void 0:o.data)||[]})}function M(){m.value.search()}function x(o){d.filter_type=o,M()}function S(o){o>1&&(g.value=o)}function B(){w.value.update()}return(o,u)=>{const N=ge;return l(),r("div",Oe,[n("div",We,[n("div",Ne,[q(ke,{ref_key:"tabRef",ref:w,onChange:S},null,512)])]),n("div",{class:"content",ref_key:"contentRef",ref:p},[n("div",Ue,[n("div",Fe,[n("div",{onClick:u[0]||(u[0]=f=>x(0)),class:G(["radio-tab",{active:d.filter_type==0}])},[...u[2]||(u[2]=[n("span",null,"全部",-1)])],2),(l(!0),r(z,null,O(k.value,f=>(l(),r("div",{onClick:D=>x(f.id),key:f.id,class:G(["radio-tab",{active:f.id==d.filter_type}])},[f.icon_path?(l(),r("img",{key:0,class:"icon",src:f.icon_path},null,8,Ve)):K("",!0),n("span",null,b(f.type_title),1)],10,je))),128))]),q(N,{value:d.title,"onUpdate:value":u[1]||(u[1]=f=>d.title=f),valueModifiers:{trim:!0},onChange:M,style:{width:"360px"},allowClear:"",placeholder:"搜索MCP"},{suffix:W(()=>[q(ve(me))]),_:1},8,["value"])]),q(ze,{onInstallReport:B,filterData:d,scrollRoot:p.value,ref_key:"pluginRef",ref:m},null,8,["filterData","scrollRoot"])],512)])}}},st=Z(Pe,[["__scopeId","data-v-90f0782d"]]);export{st as default};
