import{av as ue,f as i,o as Y,b as pe,y as j,ac as r,ad as n,ae as I,as as o,F as L,ax as N,k as q,at as C,ar as O,az as Z,B as de,r as fe,aw as ve,u as Q,ai as X}from"./vue-chunks-CGLjTDrY.js";import{E as _e}from"./empty-box-C6xHnjvN.js";import{a5 as ee,_ as te}from"../../index-DxV-PNCd.js";import{L as he}from"./loading-box-BFrpPJwN.js";import{v as ye,a0 as me,I as ge}from"./ui-antd-AfNpv4wx.js";import{_ as ke}from"./main-tab-Oe1gk5RM.js";import{P as be}from"./public-network-check-CwdAqxDb.js";import{u as Ce}from"./usePublicNetworkCheck-Gk3eB7lo.js";import"./empty-BFmzY9bl.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./list-tabs-DJ9IUgC9.js";import"./index-IIUHUqQG.js";const we="/assets/img/default-mcp-5uSmehjD.png";function Re(w={}){return ee.get({url:"/manage/getMcpSquareTypeList",params:w})}function xe(w={}){return ee.get({url:"/manage/getMcpSquareList",params:w})}const Me={class:"_plugin-box"},Se={key:1,class:"plugin-list"},Be=["onClick"],Ee={class:"base-info"},Te=["src"],$e={key:1,class:"avatar",src:we},qe={class:"info"},Ae={class:"head"},De={class:"name zm-line1"},ze=["href"],Ie={class:"source"},Le={class:"popover-type-box"},Ne={__name:"square",props:{filterData:{type:Object,default:null},scrollRoot:{type:Object,default:null}},setup(w,{expose:W}){const S=w;ue();const h=i(!0),p=i([]),y=i({}),R=i({}),k=i({}),d=i(1),A=i(50),x=i(!0),M=i(!1),B=i(null);let b=null,l=0;Y(()=>{c(),window.addEventListener("resize",H),oe()}),pe(()=>{window.removeEventListener("resize",H),b&&(b.disconnect(),b=null)});function m(a,e){if(!a)return null;const t=document.createElement("canvas").getContext("2d");t.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const f=t.measureText(a).width,u=(e==null?void 0:e.title_width)||120;return f>u?a:null}function U(){p.value=[],d.value=1,x.value=!0,c(!0)}async function c(a=!1){h.value=!0;const e={...S.filterData||{},page:d.value,size:A.value};xe(e).then(s=>{var f;let t=((f=s==null?void 0:s.data)==null?void 0:f.data)||[];a||d.value===1?p.value=t:p.value=[...p.value,...t],x.value=Array.isArray(t)&&t.length>=A.value,j(()=>{F()})}).finally(()=>{h.value=!1,M.value=!1})}function V(a){window.open(a.source_url,"_blank")}function ae(a,e){const s=k.value[e];return Array.isArray(s)?s:a.filter_type_list}function se(a,e){if(typeof a>"u")return;const s=y.value[a];e?s!==e&&(y.value[a]=e,F()):s&&delete y.value[a]}function ne(){Object.keys(y.value).forEach(e=>{const s=y.value[e],t=p.value[Number(e)];if(!s||!t)return;const f=s.clientWidth,G=getComputedStyle(s).gap||"0px",E=parseFloat(G.split(" ")[0])||0,_=document.createElement("div");_.style.position="absolute",_.style.visibility="hidden",_.style.display="flex",_.style.flexWrap="nowrap",_.style.gap=G,s.appendChild(_);const D=[];t.filter_type_list.forEach(g=>{const v=document.createElement("div");v.className="type-tag",v.style.whiteSpace="nowrap",v.textContent=g.type_title,_.appendChild(v),D.push(v.getBoundingClientRect().width+E)});const T=document.createElement("div");T.className="type-tag type-more",T.style.whiteSpace="nowrap",T.textContent="更多",_.appendChild(T);const ie=T.getBoundingClientRect().width+E;s.removeChild(_);const re=D.reduce((g,v,P)=>g+v+(P>0?E:0),0),z=k.value[e],J=!!R.value[e];if(re<=f){(J||!Array.isArray(z)||z.length!==t.filter_type_list.length)&&(k.value[e]=t.filter_type_list,R.value[e]=!1);return}let K=0,$=0;for(let g=0;g<D.length;g++){const v=($>0?E:0)+D[g],P=($>0?E:0)+ie;if(K+v+P<=f)K+=v,$++;else break}const ce=Array.isArray(z)?z.length:0;(!J||ce!==$)&&(k.value[e]=t.filter_type_list.slice(0,$),R.value[e]=!0)})}function H(){j(()=>F())}function oe(){b=new IntersectionObserver(a=>{a.forEach(e=>{e.isIntersecting&&!h.value&&!M.value&&x.value&&p.value.length>0&&(M.value=!0,d.value+=1,c())})},{root:S.scrollRoot||null,threshold:.1}),j(()=>{B.value&&b.observe(B.value)})}function F(){l&&(cancelAnimationFrame(l),l=0),l=requestAnimationFrame(()=>{l=0,ne()})}function le(a,e){a&&e&&(e.title_width=a.offsetWidth)}return W({search:U}),(a,e)=>{const s=ye;return n(),r("div",Me,[h.value?(n(),I(he,{key:0})):p.value.length?(n(),r("div",Se,[(n(!0),r(L,null,N(p.value,(t,f)=>(n(),r("div",{key:t.name,onClick:u=>V(t),class:"plugin-item"},[o("div",Ee,[t.icon?(n(),r("img",{key:0,class:"avatar",src:t.icon},null,8,Te)):(n(),r("img",$e)),o("div",qe,[o("div",Ae,[o("span",De,C(t.title),1),o("a",{class:"source",href:t.source_url,target:"_blank"},C(t.source),9,ze)]),o("div",Ie,C(t.author),1)])]),q(s,{title:m(t.description,t),placement:"top"},{default:O(()=>[o("div",{class:"desc zm-line1",ref_for:!0,ref:u=>le(u,t)},C(t.description),513)]),_:2},1032,["title"]),o("div",{class:"type-box",ref_for:!0,ref:u=>se(f,u)},[(n(!0),r(L,null,N(ae(t,f),u=>(n(),r("div",{key:u,class:"type-tag"},C(u.type_title),1))),128)),R.value[f]?(n(),I(s,{key:0,placement:"top"},{title:O(()=>[o("div",Le,[(n(!0),r(L,null,N(t.filter_type_list,u=>(n(),r("div",{key:u,class:"type-tag"},C(u.type_title),1))),128))])]),default:O(()=>[o("div",{class:"type-tag type-more",onClick:e[0]||(e[0]=de(()=>{},["stop"]))},"更多")]),_:2},1024)):Z("",!0)],512)],8,Be))),128)),o("div",{ref_key:"loadMoreRef",ref:B,class:"load-more-sentinel"},null,512)])):(n(),I(_e,{key:2,title:"暂无可用MCP"}))])}}},Oe=te(Ne,[["__scopeId","data-v-43305d23"]]),We={class:"_container"},Ue={class:"header"},Fe={class:"main-tab-box"},Pe={class:"filter-box"},je={class:"radio-tabs"},Ve=["onClick"],He=["src"],Ge={__name:"index",setup(w){const{isPublicNetwork:W}=Ce(),S=ve(),h=i(null),p=i(null),y=i(null),R=i(localStorage.getItem("zm:explore:active")||"5"),k=i([]),d=fe({title:"",filter_type:0});Y(()=>{S.query.active>1&&h.value.change(S.query.active),A()});function A(){Re().then(l=>{k.value=(l==null?void 0:l.data)||[]})}function x(){p.value.search()}function M(l){d.filter_type=l,x()}function B(l){l>1&&(R.value=l)}function b(){h.value.update()}return(l,m)=>{const U=ge;return n(),r("div",We,[o("div",Ue,[o("div",Fe,[q(ke,{ref_key:"tabRef",ref:h,onChange:B},null,512)])]),Q(W)?(n(),r("div",{key:1,class:"content",ref_key:"contentRef",ref:y},[o("div",Pe,[o("div",je,[o("div",{onClick:m[0]||(m[0]=c=>M(0)),class:X(["radio-tab",{active:d.filter_type==0}])},[...m[2]||(m[2]=[o("span",null,"全部",-1)])],2),(n(!0),r(L,null,N(k.value,c=>(n(),r("div",{onClick:V=>M(c.id),key:c.id,class:X(["radio-tab",{active:c.id==d.filter_type}])},[c.icon_path?(n(),r("img",{key:0,class:"icon",src:c.icon_path},null,8,He)):Z("",!0),o("span",null,C(c.type_title),1)],10,Ve))),128))]),q(U,{value:d.title,"onUpdate:value":m[1]||(m[1]=c=>d.title=c),valueModifiers:{trim:!0},onChange:x,style:{width:"360px"},allowClear:"",placeholder:"搜索MCP"},{suffix:O(()=>[q(Q(me))]),_:1},8,["value"])]),q(Oe,{onInstallReport:b,filterData:d,scrollRoot:y.value,ref_key:"pluginRef",ref:p},null,8,["filterData","scrollRoot"])],512)):(n(),I(be,{key:0}))])}}},ct=te(Ge,[["__scopeId","data-v-c8f42892"]]);export{ct as default};
