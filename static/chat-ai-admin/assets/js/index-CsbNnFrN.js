var Pm=Object.defineProperty;var Lm=(n,e,t)=>e in n?Pm(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ci=(n,e,t)=>Lm(n,typeof e!="symbol"?e+"":e,t);import{am as Jv,f as X,e as We,aw as Ms,o as at,ac as R,ad as w,az as ne,as as u,k as m,ar as x,G as U,at as H,F as se,ax as ge,ai as xt,av as Bm,n as ri,aG as Im,B as Ct,A as Si,ae as Q,u as K,w as ct,j as Wn,ak as bi,c as Ve,aA as Pt,ah as Fn,E as Kv,r as Je,y as Tt,J as Xn,l as St,ag as Pu,s as Lp,aC as Zv,p as Gi,aH as jm,m as Fm,d as Qv,aj as Vm,au as rr,aB as Va,b as Hc,aI as Hm}from"./vue-chunks-CGLjTDrY.js";import{a5 as Uc,A as Ha,_ as Ne,d as On,a7 as Fo,ah as Um,a4 as Ts,aa as Ht,ai as ls,aj as zc,a3 as zm,ak as qm,c as e_,al as Gm,am as Ki,an as Xm,ao as id}from"../../index-CB2DywzJ.js";import{g as Wm,A as Ym,l as Il,m as t_,B as Jm,e as Ir,C as Km,D as Zm,E as n_,F as Qm,G as ey,H as ty,I as ny,J as oy,K as iy,L as ry,M as Ld,N as o_,O as Bp,P as sy,Q as _r}from"./index-CoChppVN.js";import{u as Vn}from"./robot-BQqgDPGj.js";import{v as Zt,aa as qc,D as xo,R as No,ae as jr,a6 as Mt,B as Xt,aK as ai,aL as ay,I as en,h as Fr,i as Vr,k as Hr,ay as i_,ah as ft,M as _n,F as xn,e as Cn,y as $t,z as Lt,Q as Fi,$ as Vi,b as mt,av as Ua,w as io,x as ro,aJ as In,aI as $s,O as Mn,Y as li,T as ko,aH as ly,aM as po,G as Ur,a0 as r_,o as sr,az as uy,al as ho,V as s_,at as Ut,am as Gc,aD as Bn,as as Ai,aN as dy,aO as Po,aB as a_,aC as l_,af as Dr,aP as Xc,ad as Wc,a9 as Yc,X as cy,d as yo,ai as za,aQ as py,aR as Lu,aS as Bu,H as Jc,aj as fy,ak as hy,ao as vy,aT as _y,aU as pn,aV as Dt,aW as cs,aX as qa,aY as rd,aZ as ns,a_ as Vt,a$ as ar,b0 as si,b1 as Tr,b2 as ps,b3 as eo,s as gy,b4 as my,b5 as ma,b6 as Bd,b7 as yy,b8 as u_,b9 as by,ba as xy,a as Ga,bb as Ip,bc as wy,bd as Id,be as d_,bf as Cy,bg as c_,bh as nl,bi as ky,bj as Sy,bk as tr,bl as Ey,bm as Ay,bn as Dy,bo as Oy,bp as Ny,ar as My,aA as Ty}from"./ui-antd-BHaxN-GS.js";import{u as $y}from"./global-CNyN0DwS.js";import{a as Ry,_ as p_,M as Py}from"./meta-filter-box-BegWyvZa.js";import{_ as ya}from"./empty-BFmzY9bl.js";import{c as jd,a as Ly,b as By,d as Iy,e as jy,f as Fy,h as Us,i as Vy,p as ba,j as Hy,_ as Uy,k as zy,l as qy,m as Gy,n as Xy,o as Wy,q as Yy,r as Jy,s as Ky,t as Zy,u as Qy,v as e1,w as t1,x as n1,y as o1,z as i1,A as r1,B as s1,C as a1,D as l1,E as u1,F as d1,G as c1,H as p1,I as f1,J as h1,K as v1,L as _1,M as g1,N as m1,O as y1,P as b1,Q as x1,R as w1,S as C1,T as k1,U as S1,V as E1,W as A1,X as D1,Y as O1,Z as N1,$ as M1,a0 as T1,a1 as $1,a2 as R1,a3 as P1,a4 as L1,a5 as B1,a6 as I1,a7 as j1,a8 as F1,a9 as V1,aa as H1,ab as U1,ac as z1,ad as q1,ae as G1,af as X1,ag as W1,ah as Y1,ai as J1,aj as K1,ak as Z1,al as Q1,am as e0,an as t0,ao as n0,ap as o0,aq as i0,ar as r0,as as s0,at as a0,au as l0,av as u0,aw as d0,ax as c0,ay as p0,az as f0,aA as h0,aB as v0,aC as _0,aD as g0,aE as m0,aF as y0,aG as b0,aH as x0,aI as w0,aJ as C0,aK as k0,aL as S0,aM as E0,aN as A0,aO as D0,aP as O0,aQ as N0,aR as M0,aS as T0,aT as $0,aU as R0,aV as P0,aW as L0,aX as B0,aY as I0,aZ as j0,a_ as F0,a$ as V0,b0 as H0,b1 as U0,b2 as z0,b3 as q0,b4 as G0,b5 as X0,b6 as W0,b7 as Y0,b8 as J0,b9 as K0,ba as Z0,bb as Q0,bc as eb,bd as tb,be as nb,bf as ob,bg as ib,bh as rb,bi as sb,bj as ab,bk as lb,bl as ub,bm as db,bn as cb,bo as pb,bp as fb,bq as hb,br as vb,bs as _b,bt as gb,bu as mb,bv as yb,bw as bb,bx as xb,by as wb,bz as Cb,bA as kb,bB as Sb,bC as Eb,bD as Ab,bE as Db,bF as Ob,bG as Nb,bH as Mb,bI as Tb,bJ as $b,bK as Rb,bL as Pb,bM as Lb,bN as Bb,bO as Ib,bP as jb,bQ as Fb,bR as Vb,bS as Hb,bT as Ub,bU as zb,bV as qb,bW as Gb,bX as Xb,bY as Wb,bZ as Yb,b_ as Jb,b$ as Kb,c0 as Zb,c1 as Qb,c2 as e2,c3 as t2,c4 as n2,c5 as o2,c6 as i2,c7 as r2,c8 as s2,c9 as a2,ca as l2,cb as u2,cc as d2,cd as c2,ce as p2,cf as f2,cg as h2,ch as v2,ci as _2,cj as g2,ck as m2,cl as y2,cm as b2,cn as x2,co as w2,cp as C2,cq as k2,cr as S2,cs as E2,ct as A2,cu as D2,cv as O2,cw as N2,cx as M2,cy as T2,cz as $2,cA as R2,cB as P2,cC as L2,cD as B2,cE as I2,cF as j2,cG as F2,cH as V2,cI as H2,cJ as U2,cK as z2,cL as q2,cM as G2,cN as X2,cO as W2,cP as Y2,cQ as J2,cR as K2,cS as Z2,cT as Q2,cU as ex,cV as tx,cW as nx,cX as ox,cY as ix,cZ as rx,c_ as sx,c$ as ax,d0 as lx,d1 as ux,d2 as dx,d3 as cx,d4 as px,d5 as fx,d6 as hx,d7 as vx,d8 as _x,d9 as gx,da as mx,db as yx,dc as bx,dd as xx,de as wx,df as Cx,dg as kx,dh as Sx,di as Ex,dj as Ax,dk as Dx,dl as Ox,dm as Nx,dn as Mx,dp as Tx,dq as $x,dr as Rx,ds as Px,dt as Lx,du as Bx,dv as Ix,dw as jx,dx as Fx,dy as Vx,dz as Hx,dA as Ux,dB as zx,dC as qx,dD as Gx,dE as Xx,dF as Wx,dG as Yx,dH as Jx,dI as Kx,dJ as Zx,dK as Qx,dL as ew,dM as tw,dN as nw,dO as ow,dP as iw,dQ as rw,dR as sw,dS as aw,dT as lw,dU as uw,dV as dw,dW as cw,dX as pw,dY as fw,dZ as hw,d_ as vw,d$ as _w,e0 as gw,e1 as mw,e2 as yw,e3 as bw,e4 as xw,e5 as ww,e6 as Cw,e7 as kw,e8 as Sw,e9 as Ew,ea as Aw,eb as Dw,ec as Ow,ed as Nw,ee as Mw,ef as Tw,eg as $w,eh as Rw,ei as Pw,ej as Lw,ek as Bw,el as Iw,em as jw,en as Fw,eo as Vw,ep as Hw,eq as Uw,er as zw,es as qw,et as Gw,eu as Xw,ev as Ww,ew as Yw,ex as Jw,ey as Kw,ez as Lo,eA as vo,eB as f_,eC as Di,eD as h_,eE as Kc,eF as xa,g as Zw,eG as v_,eH as fs,eI as Qw,eJ as eC,eK as jp,eL as tC}from"./util-Clo-g1ua.js";import{g as nC,_ as Vo,S as oC,P as iC,p as rC}from"./subs-key-DRQN5duh.js";import{u as sC}from"./usePublicNetworkCheck-DbFEI2kk.js";import{P as aC}from"./public-network-check-B9AakSUh.js";import{M as lr,a as lC,u as __,b as g_}from"./model-select-h2ELC74y.js";import{_ as Xa}from"./empty-CzGZrENG.js";import{a as uC,g as dC}from"./index-D_MN-GJN.js";import{_ as cC}from"./cu-scroll-D9utH_KS.js";import{W as pC}from"./index-BWRAgLeG.js";import{a as m_}from"./index-CtAQivSJ.js";import{r as y_,R as fC}from"./editor-code-BsT961tw.js";import{P as Bo}from"./styles-B3AMWjFt.js";import{d as b_}from"./vuedraggable.umd-B2hsG2dX.js";import{g as x_}from"./thirdMcp-9tndvGRi.js";import{r as Ho,g as w_,o as hC,d as vC}from"./index-CjfwMgww.js";import{F as _C,P as gC,u as mC}from"./useOfficialArticleLogin-eQTr_6SY.js";import{i as Fd}from"./validate-8MtiUsxW.js";import{u as hs}from"./useEventBus-CB_rGuu7.js";import{Z as Mo}from"./zm-radio-group-BWQ8BMA2.js";import{T as yC,E as bC}from"./wange-ditor-Dfk_SQJx.js";import{S as xC}from"./select-wechat-app-C2zWoXl9.js";import{r as wC}from"./elkjs-B7YRHeWD.js";import{T as CC}from"./top-header-CeZAsNnB.js";import{a as kC}from"./add-group-C_PffL7b.js";import{j as SC}from"./index-BcMVDew1.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";import"./empty-box-B-T70UNv.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-Bj6uRJ-9.js";import"./loading-box-CNnW6NDo.js";function EC(n={}){return Uc.get({url:"/manage/getTriggerConfigList",params:n})}function AC(n={}){return Uc.get({url:"/manage/getTriggerOfficialMessage",params:n})}const Rs=Jv("workflow",()=>{const n=X([]),e=X([]),t=X([]),o=X([]);return{triggerList:n,getTriggerList:async(a,l)=>{try{if(n.value.length===0||l){const d=await EC({robot_key:a});n.value=d.data.map(c=>(c.subMenus=[],c.expend=!1,c.trigger_type==4&&(c.subMenus=[{title:"私信消息",value:"message"},{title:"关注/取消关注事件",value:"subscribe_unsubscribe"},{title:"扫描带参数二维码事件",value:"qrcode_scan"},{title:"自定义菜单事件",value:"menu_click"}]),c))}return n.value}catch(d){}},officialList:e,getTriggerOfficialMsg:a=>{AC({robot_key:a}).then(l=>{t.value=l.data.messages||[],e.value=l.data.apps||[]})},triggerOfficialList:t,getAllLibraryList:()=>{Ha().then(a=>{o.value=a.data})},libraryLists:o}}),DC={key:0,class:"sidebar-handle-wrapper"},OC={class:"sidebar-container"},NC={class:"sidebar-menus"},MC=["onClick"],TC={class:"menu-name"},$C={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(n){const e=$y(),t=Bm(),o=Ms(),i=We(()=>o.path.split("/")[3]),r=X(!0),s=X(!0);function a(){r.value=!r.value,s.value=!1,e.setHideLayoutTopAndBottom(r.value)}const l=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],d=c=>{if(c.isNewWindowOpen){window.open(`/#${c.path}?robot_key=${o.query.robot_key}&id=${o.query.id}`);return}t.push({path:c.path,query:o.query})};return at(()=>{setTimeout(()=>{s.value=!1},3e3)}),(c,p)=>{const f=Zt,h=On;return w(),R("div",{class:xt(["sidebar-wrapper",{"is-hide":r.value}])},[n.showSidebarBtn?(w(),R("div",DC,[m(f,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:s.value,"onUpdate:open":p[0]||(p[0]=v=>s.value=v),arrow:!1},{title:x(()=>[U(H(r.value?"展开":"收起"),1)]),default:x(()=>[u("span",{class:"sidebar-handle",onClick:a},[...p[1]||(p[1]=[u("span",{class:"handle-line handle-line01"},null,-1),u("span",{class:"handle-line handle-line02"},null,-1)])])]),_:1},8,["open"])])):ne("",!0),u("div",OC,[u("div",NC,[(w(),R(se,null,ge(l,v=>m(Ry,{key:v.value,disabled:!r.value,title:v.label,placement:"bottom"},{default:x(()=>[u("div",{class:xt(["sidebar-menu",{active:i.value==v.value}]),onClick:y=>d(v)},[m(h,{name:v.iconName,class:"menu-icon",size:"16"},null,8,["name"]),u("span",TC,H(v.label),1)],10,MC)]),_:2},1032,["disabled","title"])),64))])])],2)}}},RC=Ne($C,[["__scopeId","data-v-0f7c78c6"]]),PC={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(n){n!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${n}%`,this.previousValue=n)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.$emit("update:modelValue",n.value),this.$emit("zoom-change",n.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleFitView(){this.isShowMenu=!1,this.$emit("fitView")},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const n=this.currentValue.replace("%","").trim(),e=parseInt(n.replace(/[^\d]/g,""),10);if(!n){this.currentValue=`${this.previousValue}%`;return}if(isNaN(e)){this.currentValue=`${this.previousValue}%`;return}let t=e;t>800&&(t=800),t<1&&(t=1),this.currentValue=`${t}%`,this.previousValue=t,this.$emit("update:modelValue",t),this.$emit("zoom-change",t)},300)},handleBlur(){clearTimeout(this.debounceTimer);const n=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(n)&&n>=1&&n<=800?(this.$emit("update:modelValue",n),this.$emit("zoom-change",n),this.currentValue=`${n}%`,this.previousValue=n):this.currentValue=`${this.previousValue}%`},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(n.target)&&n.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},LC={class:"zoom-select"},BC={class:"zoom-select-options"},IC=["onClick"];function jC(n,e,t,o,i,r){return w(),R("div",LC,[u("div",{class:"zoom-select-label",onClick:e[4]||(e[4]=Ct(()=>{},["stop"]))},[ri(u("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i.currentValue=s),onInput:e[1]||(e[1]=(...s)=>r.handleInput&&r.handleInput(...s)),onFocus:e[2]||(e[2]=(...s)=>r.showMenu&&r.showMenu(...s)),onBlur:e[3]||(e[3]=(...s)=>r.handleBlur&&r.handleBlur(...s))},null,544),[[Im,i.currentValue]])]),ri(u("div",BC,[(w(!0),R(se,null,ge(i.menus,s=>(w(),R("div",{class:"zoom-select-option",key:s.value,onClick:a=>r.handleMenu(s)},H(s.label),9,IC))),128)),e[6]||(e[6]=u("div",{class:"option-line"},null,-1)),u("div",{class:"zoom-select-option",onClick:e[5]||(e[5]=s=>r.handleFitView())},"全览")],512),[[Si,i.isShowMenu]])])}const FC=Ne(PC,[["render",jC],["__scopeId","data-v-c34f40df"]]),VC={class:"trigger-list-box"},HC={key:0,class:"trigger-list"},UC=["onClick"],zC={class:"trigger-info"},qC=["src"],GC={class:"info"},XC={class:"name"},WC={key:0,class:"right-icon"},YC={key:0,class:"sub-menu-list"},JC=["onClick"],KC={key:1,class:"empty-box"},ZC={href:"/#/plugins/index?active=2",target:"_blank"},QC={__name:"trigger-list",emits:["add"],setup(n,{emit:e}){const t=e,o=Rs(),i=We(()=>o.triggerOfficialList),r=X(""),s=We(()=>{let d=o.triggerList;return r.value?d.filter(c=>c.trigger_name.includes(r.value)):d}),a=d=>{if(d.subMenus&&d.subMenus.length){d.expend=!d.expend;return}let c=jd(d);t("add",c)},l=(d,c)=>{d.trigger_type==4&&(d.trigger_official_config.msg_type=c.value,i.value,d.outputs=i.value.find(f=>f.msg_type==c.value).fields);let p=jd(d);t("add",p)};return(d,c)=>{const p=qc;return w(),R("div",VC,[u("div",{class:"search-box",onClick:c[1]||(c[1]=Ct(()=>{},["stop"]))},[m(p,{value:r.value,"onUpdate:value":c[0]||(c[0]=f=>r.value=f),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value.length?(w(),R("div",HC,[(w(!0),R(se,null,ge(s.value,f=>(w(),R("div",{class:"trigger-item",onClick:h=>a(f),key:f.type},[u("div",zC,[u("img",{class:"avatar",src:f.trigger_icon},null,8,qC),u("div",GC,[u("span",XC,H(f.trigger_name),1)]),f.subMenus&&f.subMenus.length?(w(),R("div",WC,[f.expend?(w(),Q(K(xo),{key:0})):(w(),Q(K(No),{key:1}))])):ne("",!0)]),f.expend&&f.subMenus&&f.subMenus.length?(w(),R("div",YC,[(w(!0),R(se,null,ge(f.subMenus,h=>(w(),R("div",{class:"sub-item",onClick:Ct(v=>l(f,h),["stop"]),key:h.value},H(h.title),9,JC))),128))])):ne("",!0)],8,UC))),128))])):(w(),R("div",KC,[c[3]||(c[3]=u("img",{style:{height:"200px"},src:ya},null,-1)),c[4]||(c[4]=u("div",null,"暂无可用插件",-1)),u("a",ZC,[c[2]||(c[2]=U("去添加 ",-1)),m(K(No))])]))])}}},ek=Ne(QC,[["__scopeId","data-v-fbea2d6f"]]),tk={class:"trigger-list-box"},nk={key:0,class:"trigger-list"},ok=["onClick"],ik={class:"trigger-info"},rk=["src"],sk={class:"info"},ak={class:"name"},lk={key:1,class:"empty-box"},uk={href:"/#/robot/list?active=1",target:"_blank"},dk={__name:"workflow-list",emits:["add"],setup(n,{emit:e}){const t=e,o=X([]),i=X("");at(()=>{r()});function r(){Wm({application_type:1}).then(l=>{let d=l.data||[];o.value=d.filter(c=>c.has_published==1)})}const s=We(()=>i.value?o.value.filter(l=>l.robot_name.includes(i.value)):o.value),a=l=>{let d=Ly(l);t("add",d)};return(l,d)=>{const c=qc;return w(),R("div",tk,[u("div",{class:"search-box",onClick:d[1]||(d[1]=Ct(()=>{},["stop"]))},[m(c,{value:i.value,"onUpdate:value":d[0]||(d[0]=p=>i.value=p),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value.length?(w(),R("div",nk,[(w(!0),R(se,null,ge(s.value,p=>(w(),R("div",{class:"trigger-item",onClick:f=>a(p),key:p.id},[u("div",ik,[u("img",{class:"avatar",src:p.robot_avatar},null,8,rk),u("div",sk,[u("span",ak,H(p.robot_name),1)])])],8,ok))),128))])):(w(),R("div",lk,[d[3]||(d[3]=u("img",{style:{height:"200px"},src:ya},null,-1)),d[4]||(d[4]=u("div",null,"暂无可用工作流",-1)),u("a",uk,[d[2]||(d[2]=U("去添加 ",-1)),m(K(No))])]))])}}},ck=Ne(dk,[["__scopeId","data-v-7f279786"]]),pk={class:"http-tool-list-box"},fk={key:0,class:"node-list"},hk={class:"node-info-pop"},vk={class:"info"},_k=["src"],gk={class:"name"},mk={class:"extra"},yk=["onClick"],bk=["src"],xk={class:"info"},wk={class:"name"},Ck={class:"total"},kk={class:"node-tools"},Sk={class:"params-box"},Ek={class:"param-item"},Ak={class:"field"},Dk={class:"name"},Ok={class:"desc"},Nk={class:"param-item"},Mk={class:"field"},Tk={class:"name"},$k={class:"type"},Rk={key:0,class:"param-item"},Pk={class:"desc"},Lk={key:1,class:"param-item"},Bk={class:"desc"},Ik={key:2,class:"param-item"},jk={class:"desc"},Fk=["onClick"],Vk={key:1,class:"empty-box"},Hk={__name:"http-tool-list",props:{keyword:{type:String,default:""}},emits:["add"],setup(n,{emit:e}){const t=e,o=n,i=X([]);at(()=>{r()});function r(){nC({page:1,size:9999,with_nodes:1}).then(p=>{var h;const f=((h=p==null?void 0:p.data)==null?void 0:h.list)||[];f.forEach(v=>v.expand=!1),i.value=f})}const s=We(()=>{if(o.keyword){const p=o.keyword;return i.value.filter(f=>{let h=(f.description||"")+(f.name||"");return Array.isArray(f.nodes)&&f.nodes.forEach(v=>{var g,_;h+=(v.node_name||"")+(v.node_description||"");const y=((_=(g=v==null?void 0:v.node_params)==null?void 0:g.curl)==null?void 0:_.rawurl)||"";h+=y}),h.indexOf(p)>-1})}return i.value}),a=(p,f)=>{var y;const h=((y=f==null?void 0:f.node_params)==null?void 0:y.curl)||{},v=By({name:(f==null?void 0:f.node_name)||(p==null?void 0:p.name),avatar:(f==null?void 0:f.http_tool_avatar)||(p==null?void 0:p.avatar),method:h==null?void 0:h.method,url:h==null?void 0:h.rawurl,headers:Array.isArray(h==null?void 0:h.headers)?h.headers:[],params:Array.isArray(h==null?void 0:h.params)?h.params:[],body:Array.isArray(h==null?void 0:h.body)?h.body:[],timeout:(h==null?void 0:h.timeout)||60,output:Array.isArray(h==null?void 0:h.output)?h.output:[],http_auth:Array.isArray(h==null?void 0:h.http_auth)?h.http_auth:[],http_tool_info:(f==null?void 0:f.http_tool_info)||{http_tool_name:(p==null?void 0:p.name)||"",http_tool_key:(p==null?void 0:p.tool_key)||"",http_tool_avatar:(p==null?void 0:p.avatar)||"",http_tool_description:(p==null?void 0:p.description)||"",http_tool_node_key:(f==null?void 0:f.node_key)||"",http_tool_node_name:(f==null?void 0:f.node_name)||"",http_tool_node_description:(f==null?void 0:f.node_description)||""}});t("add",v)};function l(){window.open("/#/robot/list?active=6","_blank")}function d(p){return String(p||"").toUpperCase()||"GET"}function c(p){return String(p||"").replace(/[`"]/g,"").trim()}return(p,f)=>{const h=jr;return w(),R("div",pk,[s.value.length?(w(),R("div",fk,[(w(!0),R(se,null,ge(s.value,(v,y)=>(w(),R("div",{key:y,class:"node-item"},[m(h,{placement:"right"},{content:x(()=>[u("div",hk,[u("div",vk,[u("img",{class:"avatar",src:v.avatar||"/src/assets/img/workflow/node-service.svg"},null,8,_k),u("div",gk,H(v.name),1)]),u("div",mk,"节点数量："+H((v.nodes||[]).length),1),u("div",null,H(v.description),1)])]),default:x(()=>[u("div",{class:"node-info",onClick:g=>v.expand=!v.expand},[u("img",{class:"avatar",src:v.avatar||"/src/assets/img/workflow/node-service.svg"},null,8,bk),u("div",xk,[u("span",wk,H(v.name),1),u("span",Ck,[U(H((v.nodes||[]).length)+" ",1),v.expand?(w(),Q(K(xo),{key:0})):(w(),Q(K(No),{key:1}))])])],8,yk)]),_:2},1024),ri(u("div",kk,[(w(!0),R(se,null,ge(v.nodes||[],(g,_)=>(w(),Q(h,{key:_,placement:"right"},{content:x(()=>{var b,C,T,M,S,k,A,$,B,O;return[u("div",Sk,[u("div",Ek,[u("div",Ak,[u("span",Dk,H(g.node_name),1)]),u("div",Ok,H(g.node_description),1)]),u("div",Nk,[u("div",Mk,[u("span",Tk,H(d((C=(b=g==null?void 0:g.node_params)==null?void 0:b.curl)==null?void 0:C.method)),1),u("span",$k,H(c((M=(T=g==null?void 0:g.node_params)==null?void 0:T.curl)==null?void 0:M.rawurl)),1)])]),Array.isArray((k=(S=g==null?void 0:g.node_params)==null?void 0:S.curl)==null?void 0:k.params)&&g.node_params.curl.params.length?(w(),R("div",Rk,[f[0]||(f[0]=u("div",{class:"field"},[u("span",{class:"name"},"查询参数")],-1)),u("div",Pk,H(g.node_params.curl.params.map(P=>P.key).filter(Boolean).join(", ")),1)])):ne("",!0),Array.isArray(($=(A=g==null?void 0:g.node_params)==null?void 0:A.curl)==null?void 0:$.headers)&&g.node_params.curl.headers.length?(w(),R("div",Lk,[f[1]||(f[1]=u("div",{class:"field"},[u("span",{class:"name"},"请求头")],-1)),u("div",Bk,H(g.node_params.curl.headers.map(P=>P.key).filter(Boolean).join(", ")),1)])):ne("",!0),Array.isArray((O=(B=g==null?void 0:g.node_params)==null?void 0:B.curl)==null?void 0:O.output)&&g.node_params.curl.output.length?(w(),R("div",Ik,[f[2]||(f[2]=u("div",{class:"field"},[u("span",{class:"name"},"输出字段")],-1)),u("div",jk,H(g.node_params.curl.output.map(P=>P.key).filter(Boolean).join(", ")),1)])):ne("",!0)])]}),default:x(()=>[u("div",{class:"node-tool-item",onClick:b=>a(v,g)},H(g.node_name),9,Fk)]),_:2},1024))),128))],512),[[Si,v.expand]])]))),128))])):(w(),R("div",Vk,[f[4]||(f[4]=u("img",{style:{height:"200px"},src:ya},null,-1)),f[5]||(f[5]=u("div",null,"暂无可添加HTTP工具",-1)),u("a",{onClick:l},[f[3]||(f[3]=U("去添加",-1)),m(K(No))])]))])}}},Uk=Ne(Hk,[["__scopeId","data-v-60a3309c"]]),zk={class:"node-list-popup"},qk={class:"tabs-box"},Gk={class:"node-list-popup-content"},Xk={key:0,class:"node-list"},Wk={class:"node-type"},Yk={class:"node-flex-box"},Jk=["onMousedown"],Kk=["src","alt"],Zk={class:"node-name"},Qk={key:1,class:"node-box"},eS={class:"sub-tabs"},tS={class:"search-box"},nS={class:"node-list"},oS={class:"node-info-pop"},iS={class:"info"},rS=["src"],sS={class:"name"},aS={class:"extra"},lS=["onClick"],uS=["src"],dS={class:"info"},cS={class:"name"},pS={class:"total"},fS={class:"node-tools"},hS={class:"params-box"},vS={class:"param-item"},_S={class:"field"},gS={class:"name"},mS={class:"desc"},yS={class:"field"},bS={class:"name"},xS={class:"type"},wS={key:0,class:"required"},CS={class:"desc"},kS=["onMousedown"],SS={key:1,class:"empty-box"},ES={class:"node-list",style:{flex:"1","overflow-y":"auto"}},AS={class:"more-link",href:"/#/robot/list?active=6",target:"_blank"},DS={key:1,class:"node-box"},OS={class:"node-list"},NS=["onClick"],MS={class:"node-info"},TS=["src"],$S={class:"info"},RS={class:"name"},PS={key:0,class:"node-item"},LS={class:"node-info-pop"},BS={class:"info"},IS=["src"],jS={class:"name"},FS={class:"extra"},VS=["onClick"],HS=["src"],US={class:"info"},zS={class:"name"},qS={class:"total"},GS={class:"node-tools"},XS={class:"params-box"},WS={class:"param-item"},YS={class:"field"},JS={class:"name"},KS={class:"desc"},ZS={class:"field"},QS={class:"name"},eE={class:"type"},tE={key:0,class:"required"},nE={class:"desc"},oE=["onMousedown"],iE=["onClick"],rE={class:"node-info"},sE=["src"],aE={class:"info"},lE={class:"name"},uE={class:"more-link",href:"/#/plugins/index?active=2",target:"_blank"},dE={key:1,class:"empty-box"},cE={href:"/#/plugins/index?active=2",target:"_blank"},pE={key:3,class:"node-box"},fE={key:4,class:"node-box"},hE={__name:"index",props:{type:{type:String,default:""},active:{type:Number,default:1},excludedNodeTypes:{type:Array,default:()=>[]}},emits:["addNode","addTrigger","mouseMove","update:active"],setup(n,{emit:e}){const t=e,o=n,{isPublicNetwork:i}=sC(),r=X(o.active),s=X("MCP");ct(()=>o.active,S=>{r.value=S});const a=X([]),l=X([]),d=X([]),c=X("");ct(()=>o.excludedNodeTypes,()=>{a.value=Iy({excludedNodeTypes:o.excludedNodeTypes})},{immediate:!0}),at(()=>{jy().then(S=>{d.value=S}),Fy().then(S=>{l.value=S})});const p=We(()=>c.value?d.value.filter(S=>(S.description+S.name).indexOf(c.value)>-1):d.value),f=(S,k)=>{S.preventDefault();let A=!1;const $=S.clientX,B=S.clientY,O=JSON.parse(JSON.stringify(k)),P=document.createElement("div");P.classList.add("node-item-ghost"),P.innerHTML=S.currentTarget.innerHTML,document.body.appendChild(P);const E=F=>{P.style.left=`${F.clientX+5}px`,P.style.top=`${F.clientY+5}px`};E(S);const D=F=>{!A&&(Math.abs(F.clientX-$)>5||Math.abs(F.clientY-B)>5)&&(A=!0),E(F),t("mouseMove")},N=F=>{document.body.removeChild(P),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",N),A?t("addNode",{node:O,event:F}):h(O)};window.addEventListener("mousemove",D),window.addEventListener("mouseup",N,{once:!0})},h=S=>{S=JSON.parse(JSON.stringify(S)),t("addNode",{node:S})},v=(S,k,A)=>{let $=Vy(k,A);f(S,$)},y=S=>{t("addNode",{node:S,isTriggerNode:!0})},g=S=>{t("addNode",{node:S})},_=(S,k,A,$)=>{k=Hy(k,A,$),S?f(S,k):t("addNode",{node:k})};function b(S){r.value=S,t("update:active",S)}function C(){window.open("/#/robot/list?active=3&mcp=2","_blank")}function T(S){var A,$,B;let k=Fo((A=S==null?void 0:S.properties)==null?void 0:A.node_params,{});return ba(($=k==null?void 0:k.plugin)==null?void 0:$.name)||((B=k==null?void 0:k.plugin)==null?void 0:B.multiNode)}function M(S){t("addNode",{node:S})}return(S,k)=>{const A=On,$=qc,B=jr;return w(),R("div",zk,[u("div",qk,[u("div",{class:xt(["tab-item",{active:r.value==1}]),onClick:k[0]||(k[0]=O=>b(1))},[m(A,{name:"base-node-type"}),k[8]||(k[8]=U()),k[9]||(k[9]=u("span",null,"基础功能",-1))],2),u("div",{class:xt(["tab-item",{active:r.value==3}]),onClick:k[1]||(k[1]=O=>b(3))},[m(A,{name:"plugin-node-type"}),k[10]||(k[10]=U()),k[11]||(k[11]=u("span",null,"插件",-1))],2),u("div",{class:xt(["tab-item",{active:r.value==2}]),onClick:k[2]||(k[2]=O=>b(2))},[m(A,{name:"mcp-node-type"}),k[12]||(k[12]=U()),k[13]||(k[13]=u("span",null,"工具",-1))],2),o.type=="float-btn"?(w(),R("div",{key:0,class:xt(["tab-item",{active:o.active==4}]),onClick:k[3]||(k[3]=O=>b(4))},[m(A,{name:"mcp-node-type"}),k[14]||(k[14]=U()),k[15]||(k[15]=u("span",null,"触发器",-1))],2)):ne("",!0),u("div",{class:xt(["tab-item",{active:r.value==5}]),onClick:k[4]||(k[4]=O=>b(5))},[m(A,{name:"workflow"}),k[16]||(k[16]=U()),k[17]||(k[17]=u("span",null,"工作流",-1))],2)]),u("div",Gk,[r.value==1?(w(!0),R(se,{key:0},ge(a.value,O=>(w(),R(se,{key:O.key},[O.hidden?ne("",!0):(w(),R("div",Xk,[u("div",Wk,H(O.name),1),u("div",Yk,[(w(!0),R(se,null,ge(O.nodes,P=>(w(),R(se,{key:P.type},[P.hidden?ne("",!0):(w(),R("div",{key:0,class:"node-item",onMousedown:E=>f(E,P)},[u("img",{src:P.properties.node_icon,alt:P.properties.node_name},null,8,Kk),u("div",Zk,H(P.properties.node_name),1)],40,Jk))],64))),128))])]))],64))),128)):r.value==2?(w(),R("div",Qk,[u("div",eS,[u("div",{class:xt(["sub-tab-item",{active:s.value=="MCP"}]),onClick:k[5]||(k[5]=O=>s.value="MCP")},"MCP",2),u("div",{class:xt(["sub-tab-item",{active:s.value=="HTTP"}]),onClick:k[6]||(k[6]=O=>s.value="HTTP")},"HTTP",2)]),u("div",tS,[m($,{value:c.value,"onUpdate:value":k[7]||(k[7]=O=>c.value=O),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value=="MCP"&&p.value.length?(w(),R(se,{key:0},[u("div",nS,[(w(!0),R(se,null,ge(p.value,(O,P)=>(w(),R("div",{key:P,class:"node-item"},[m(B,{placement:"right"},{content:x(()=>[u("div",oS,[u("div",iS,[u("img",{class:"avatar",src:O.avatar},null,8,rS),u("div",sS,H(O.name),1)]),u("div",null,H(O.url),1),u("div",aS,"可用工具："+H(O.tools.length),1)])]),default:x(()=>[u("div",{class:"node-info",onClick:E=>O.expand=!O.expand},[u("img",{class:"avatar",src:O.avatar},null,8,uS),u("div",dS,[u("span",cS,H(O.name),1),u("span",pS,[U(H(O.tools.length)+" ",1),O.expand?(w(),Q(K(xo),{key:0})):(w(),Q(K(No),{key:1}))])])],8,lS)]),_:2},1024),ri(u("div",fS,[(w(!0),R(se,null,ge(O.tools,(E,D)=>(w(),Q(B,{key:D,placement:"right"},{content:x(()=>[u("div",hS,[u("div",vS,[u("div",_S,[u("span",gS,H(E.name),1)]),u("div",mS,H(E.description),1)]),(w(!0),R(se,null,ge(E.inputSchema.properties,(N,F)=>(w(),R("div",{key:F,class:"param-item"},[u("div",yS,[u("span",bS,H(F),1),u("span",xS,H(N.type),1),E.inputSchema.required&&E.inputSchema.required.includes(F)?(w(),R("span",wS,"必填")):ne("",!0)]),u("div",CS,H(N.description),1)]))),128))])]),default:x(()=>[u("div",{class:"node-tool-item",onMousedown:N=>v(N,O,E)},H(E.name),41,kS)]),_:2},1024))),128))],512),[[Si,O.expand]])]))),128))]),u("a",{class:"more-link",onClick:C},[k[18]||(k[18]=U("更多MCP插件 ",-1)),m(K(No))])],64)):s.value=="MCP"?(w(),R("div",SS,[k[20]||(k[20]=u("img",{style:{height:"200px"},src:ya},null,-1)),k[21]||(k[21]=u("div",null,"暂无可用MCP插件",-1)),u("a",{onClick:C},[k[19]||(k[19]=U("去添加",-1)),m(K(No))])])):s.value=="HTTP"?(w(),R(se,{key:2},[u("div",ES,[m(Uk,{keyword:c.value,onAdd:M},null,8,["keyword"])]),u("a",AS,[k[22]||(k[22]=U("更多HTTP工具 ",-1)),m(K(No))])],64)):ne("",!0)])):r.value==3?(w(),R(se,{key:2},[K(i)?(w(),R("div",DS,[l.value.length?(w(),R(se,{key:0},[u("div",OS,[(w(!0),R(se,null,ge(l.value,O=>(w(),R(se,{key:O.type},[T(O)?(w(),R(se,{key:1},[K(Us)(O.plugin_name).length>1?(w(),R("div",PS,[m(B,{placement:"right"},{content:x(()=>[u("div",LS,[u("div",BS,[u("img",{class:"avatar",src:O.properties.node_icon},null,8,IS),u("div",jS,H(O.properties.node_name),1)]),u("div",null,H(O.properties.node_desc),1),u("div",FS,"可用工具："+H(K(Us)(O.plugin_name).length),1)])]),default:x(()=>[u("div",{class:"node-info",onClick:P=>O.expand=!O.expand},[u("img",{class:"avatar",src:O.properties.node_icon},null,8,HS),u("div",US,[u("span",zS,H(O.properties.node_name),1),u("span",qS,[U(H(K(Us)(O.plugin_name).length)+" ",1),O.expand?(w(),Q(K(xo),{key:0})):(w(),Q(K(No),{key:1}))])])],8,VS)]),_:2},1024),ri(u("div",GS,[(w(!0),R(se,null,ge(K(Us)(O.plugin_name),P=>(w(),Q(B,{key:P.name,placement:"right"},{content:x(()=>[u("div",XS,[u("div",WS,[u("div",YS,[u("span",JS,H(P.title),1)]),u("div",KS,H(P.desc),1)]),(w(!0),R(se,null,ge(P.params,(E,D)=>(w(),R("div",{key:D,class:"param-item"},[u("div",ZS,[u("span",QS,H(D),1),u("span",eE,H(E.type),1),E.required?(w(),R("span",tE,"必填")):ne("",!0)]),u("div",nE,H(E.desc),1)]))),128))])]),default:x(()=>[u("div",{class:"node-tool-item",onMousedown:E=>_(E,O,P,P.name)},H(P.title),41,oE)]),_:2},1024))),128))],512),[[Si,O.expand]])])):(w(!0),R(se,{key:1},ge(K(Us)(O.plugin_name),P=>(w(),R("div",{onClick:E=>_(null,O,P,P.name),class:"node-item"},[u("div",rE,[u("img",{class:"avatar",src:O.properties.node_icon},null,8,sE),u("div",aE,[u("span",lE,H(O.properties.node_name),1)])])],8,iE))),256))],64)):(w(),R("div",{key:0,onClick:P=>h(O),class:"node-item"},[u("div",MS,[u("img",{class:"avatar",src:O.properties.node_icon},null,8,TS),u("div",$S,[u("span",RS,H(O.properties.node_name),1)])])],8,NS))],64))),128))]),u("a",uE,[k[23]||(k[23]=U("更多插件 ",-1)),m(K(No))])],64)):(w(),R("div",dE,[k[25]||(k[25]=u("img",{style:{height:"200px"},src:ya},null,-1)),k[26]||(k[26]=u("div",null,"暂无可用插件",-1)),u("a",cE,[k[24]||(k[24]=U("去添加",-1)),m(K(No))])]))])):(w(),Q(aC,{key:0,style:{margin:"0"}}))],64)):r.value==4?(w(),R("div",pE,[m(ek,{onAdd:y})])):r.value==5?(w(),R("div",fE,[m(ck,{onAdd:g})])):ne("",!0)])])}}},Iu=Ne(hE,[["__scopeId","data-v-414b0398"]]),vE={class:"custom-control-warpper"},_E={class:"custom-control-body"},gE={class:"custom-control"},mE={class:"control-item zoom-control"},yE={class:"control-item"},bE={class:"control-item"},xE={class:"control-item"},wE={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoomChange","autoLayout"],setup(n,{emit:e}){const t=e,o=n,i=X(["terminate-node"]),{eventCenter:r}=o.lf.graphModel,s=X(100),a=()=>{o.lf.fitView()},l=()=>{let k=s.value/100;o.lf.zoom(k),t("zoomChange",k)},d=k=>{s.value=k,l()},c=()=>{let k=s.value-10;k<1&&(k=1),s.value=k,l()},p=()=>{let k=s.value+10;k>800&&(k=800),s.value=k,l()},f=k=>{let A=Math.floor(k.transform.SCALE_X*100);s.value=A},h=X(!1),v=X(null),y=X(1),g=()=>{y.value=1,h.value=!0},_=()=>{t("runTest")},b=()=>{t("autoLayout")},C=k=>{h.value&&(v.value.contains(k.target)||(h.value=!1))},T=()=>{h.value&&(h.value=!1)},M=k=>{t("addNode",k),h.value=!1},S=()=>{y.value=4,h.value=!0};return at(()=>{document.addEventListener("click",C),r.on("graph:transform",f),r.on("custom:showTriggerLit",S)}),Wn(()=>{document.removeEventListener("click",C),r.off("graph:transform",f),r.off("custom:showTriggerLit",S)}),(k,A)=>{const $=On,B=Xt;return w(),R("div",vE,[u("div",_E,[u("div",gE,[u("div",mE,[u("div",{class:"action-btn zoom-btn",onClick:c},[m($,{name:"minus",size:"16"})]),m(FC,{modelValue:s.value,"onUpdate:modelValue":A[0]||(A[0]=O=>s.value=O),onZoomChange:d,onFitView:a},null,8,["modelValue"]),u("div",{class:"action-btn zoom-btn",onClick:p},[m($,{name:"plus",size:"16"})])]),A[5]||(A[5]=u("i",{class:"control-line"},null,-1)),u("div",yE,[m(B,{type:"primary",onClick:Ct(g,["stop"])},{icon:x(()=>[m(K(Mt))]),default:x(()=>[A[2]||(A[2]=u("span",null,"新建节点",-1))]),_:1})]),u("div",bE,[m(B,{onClick:_,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[m(K(ai)),A[3]||(A[3]=u("span",null,"运行测试",-1))]),_:1})]),u("div",xE,[m(B,{onClick:b,type:"default"},{default:x(()=>[m(K(ay)),A[4]||(A[4]=u("span",null,"整理画布",-1))]),_:1})])]),ri(u("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:v},[m(Iu,{excludedNodeTypes:i.value,onAddNode:M,type:"float-btn",onMouseMove:T,active:y.value,"onUpdate:active":A[1]||(A[1]=O=>y.value=O)},null,8,["excludedNodeTypes","active"])],512),[[Si,h.value]])])])}}},CE=Ne(wE,[["__scopeId","data-v-ff04cf1b"]]),kE={},SE={class:"node-form-layout"},EE={class:"layout-header"},AE={class:"layout-body"};function DE(n,e){return w(),R("div",SE,[u("div",EE,[bi(n.$slots,"header",{},void 0,!0)]),u("div",AE,[bi(n.$slots,"default",{},void 0,!0)])])}const tn=Ne(kE,[["render",DE],["__scopeId","data-v-a5d11f7a"]]),OE={class:"node-form-header"},NE={class:"node-title"},ME={class:"title-left"},TE=["src"],$E=["src"],RE={class:"title-conttent"},PE={class:"title-right"},LE={class:"node-desc"},BE={__name:"node-form-header",props:{iconName:{type:String,default:""},iconUrl:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},emits:["changeTitle","deleteNode","close"],setup(n,{emit:e}){const t=Ve("changeTitle"),o=Ve("deleteNode"),i=Ve("close"),r=e,s=n;let a=null;const l=v=>new URL(Object.assign({"../../../../assets/svg/accomplish-icon.svg":Kw,"../../../../assets/svg/accounts-icon.svg":Jw,"../../../../assets/svg/ai-dialogue-node.svg":Yw,"../../../../assets/svg/ai-generate-white.svg":Ww,"../../../../assets/svg/ai-generate.svg":Xw,"../../../../assets/svg/ai-mark.svg":Gw,"../../../../assets/svg/ai.svg":qw,"../../../../assets/svg/alarm-clock.svg":zw,"../../../../assets/svg/alert-icon.svg":Uw,"../../../../assets/svg/ali-ocr.svg":Hw,"../../../../assets/svg/analysis.svg":Vw,"../../../../assets/svg/anthrop.svg":Fw,"../../../../assets/svg/applet.svg":jw,"../../../../assets/svg/arrow-down.svg":Iw,"../../../../assets/svg/arrow-left.svg":Bw,"../../../../assets/svg/arrow-right.svg":Lw,"../../../../assets/svg/attachment.svg":Pw,"../../../../assets/svg/auth.svg":Rw,"../../../../assets/svg/auto-reply.svg":$w,"../../../../assets/svg/azure.svg":Tw,"../../../../assets/svg/back.svg":Mw,"../../../../assets/svg/baichuan.svg":Nw,"../../../../assets/svg/base-data-icon.svg":Ow,"../../../../assets/svg/base-node-type.svg":Dw,"../../../../assets/svg/batch-group-node.svg":Aw,"../../../../assets/svg/book.svg":Ew,"../../../../assets/svg/categary-manage-active-icon.svg":Sw,"../../../../assets/svg/categary-manage-icon.svg":kw,"../../../../assets/svg/chat-cache.svg":Cw,"../../../../assets/svg/chat-mode.svg":ww,"../../../../assets/svg/chat-robot-icon.svg":xw,"../../../../assets/svg/chat.svg":bw,"../../../../assets/svg/check-arrow-filled.svg":yw,"../../../../assets/svg/circular-needle2.svg":mw,"../../../../assets/svg/circularNeedle.svg":gw,"../../../../assets/svg/client.svg":_w,"../../../../assets/svg/close-circle.svg":vw,"../../../../assets/svg/cmd.svg":hw,"../../../../assets/svg/code-run-node.svg":fw,"../../../../assets/svg/cohere.svg":pw,"../../../../assets/svg/collaborator.svg":cw,"../../../../assets/svg/collapse-close.svg":dw,"../../../../assets/svg/collapse-open.svg":uw,"../../../../assets/svg/colour-edit.svg":lw,"../../../../assets/svg/comment-delete.svg":aw,"../../../../assets/svg/comment-reply.svg":sw,"../../../../assets/svg/comment-search.svg":rw,"../../../../assets/svg/comment-selected.svg":iw,"../../../../assets/svg/comment.svg":ow,"../../../../assets/svg/common-quession.svg":nw,"../../../../assets/svg/create_library.svg":tw,"../../../../assets/svg/create_robot.svg":ew,"../../../../assets/svg/csv.svg":Qx,"../../../../assets/svg/cu-doc-active.svg":Zx,"../../../../assets/svg/cu-doc-icon.svg":Kx,"../../../../assets/svg/custom-group-node.svg":Jx,"../../../../assets/svg/data-node.svg":Yx,"../../../../assets/svg/data-security.svg":Wx,"../../../../assets/svg/database-menu-icon.svg":Xx,"../../../../assets/svg/deepseek.svg":Gx,"../../../../assets/svg/delete-line.svg":qx,"../../../../assets/svg/delete.svg":zx,"../../../../assets/svg/ding-group-node.svg":Ux,"../../../../assets/svg/direct-connection.svg":Hx,"../../../../assets/svg/dislike-active.svg":Vx,"../../../../assets/svg/dislike.svg":Fx,"../../../../assets/svg/doc-active-menu-icon.svg":jx,"../../../../assets/svg/doc-directory.svg":Ix,"../../../../assets/svg/doc-draft.svg":Bx,"../../../../assets/svg/doc-file.svg":Lx,"../../../../assets/svg/doc-file2.svg":Px,"../../../../assets/svg/doc-icon-active.svg":Rx,"../../../../assets/svg/doc-icon.svg":$x,"../../../../assets/svg/doc-menu-icon.svg":Tx,"../../../../assets/svg/document-icon.svg":Mx,"../../../../assets/svg/document.svg":Nx,"../../../../assets/svg/docx.svg":Ox,"../../../../assets/svg/down-file.svg":Dx,"../../../../assets/svg/download.svg":Ax,"../../../../assets/svg/drag.svg":Ex,"../../../../assets/svg/dragv2.svg":Sx,"../../../../assets/svg/duiwaifuwu.svg":kx,"../../../../assets/svg/economic-active.svg":Cx,"../../../../assets/svg/economic.svg":wx,"../../../../assets/svg/edit-02.svg":xx,"../../../../assets/svg/edit.svg":bx,"../../../../assets/svg/empty-document.svg":yx,"../../../../assets/svg/empty.svg":mx,"../../../../assets/svg/end-node.svg":gx,"../../../../assets/svg/enterprise-active.svg":_x,"../../../../assets/svg/enterprise.svg":vx,"../../../../assets/svg/enterprise2.svg":hx,"../../../../assets/svg/excel.svg":fx,"../../../../assets/svg/execute.svg":px,"../../../../assets/svg/execute_array.svg":cx,"../../../../assets/svg/expand.svg":dx,"../../../../assets/svg/explain-node.svg":ux,"../../../../assets/svg/export-record-active-icon.svg":lx,"../../../../assets/svg/export-record-icon.svg":ax,"../../../../assets/svg/export-record.svg":sx,"../../../../assets/svg/eye-open.svg":rx,"../../../../assets/svg/fail-icon.svg":ix,"../../../../assets/svg/faq-icon.svg":ox,"../../../../assets/svg/feishu-doc.svg":nx,"../../../../assets/svg/field-menu-icon.svg":tx,"../../../../assets/svg/file-icon.svg":ex,"../../../../assets/svg/file-search.svg":Q2,"../../../../assets/svg/file_ext.svg":Z2,"../../../../assets/svg/finance.svg":K2,"../../../../assets/svg/folder-icon-active.svg":J2,"../../../../assets/svg/folder-icon.svg":Y2,"../../../../assets/svg/forbid-update-icon.svg":W2,"../../../../assets/svg/function-center.svg":X2,"../../../../assets/svg/gemini.svg":G2,"../../../../assets/svg/generate-icon.svg":q2,"../../../../assets/svg/gou.svg":z2,"../../../../assets/svg/government.svg":U2,"../../../../assets/svg/graph-icon.svg":H2,"../../../../assets/svg/group-default-icon.svg":V2,"../../../../assets/svg/group-icon.svg":F2,"../../../../assets/svg/group-send.svg":j2,"../../../../assets/svg/guanlianzhishiku.svg":I2,"../../../../assets/svg/guide.svg":B2,"../../../../assets/svg/high-active.svg":L2,"../../../../assets/svg/high.svg":P2,"../../../../assets/svg/html.svg":R2,"../../../../assets/svg/http-node.svg":$2,"../../../../assets/svg/huanyingyu.svg":T2,"../../../../assets/svg/huoshanyinqin.svg":M2,"../../../../assets/svg/icon-all.svg":N2,"../../../../assets/svg/icon-rocket.svg":O2,"../../../../assets/svg/image-generation-node.svg":D2,"../../../../assets/svg/img-icon.svg":A2,"../../../../assets/svg/import-record-active-icon.svg":E2,"../../../../assets/svg/import-record-icon.svg":S2,"../../../../assets/svg/input.svg":k2,"../../../../assets/svg/jibenpeizhi.svg":C2,"../../../../assets/svg/jichupeizhi.svg":w2,"../../../../assets/svg/jina.svg":x2,"../../../../assets/svg/json-node.svg":b2,"../../../../assets/svg/json-reverse-node.svg":y2,"../../../../assets/svg/judge-node.svg":m2,"../../../../assets/svg/knowledge-base-node.svg":g2,"../../../../assets/svg/knowledge-config-active-icon.svg":_2,"../../../../assets/svg/knowledge-config-icon.svg":v2,"../../../../assets/svg/knowledge-document-active-icon.svg":h2,"../../../../assets/svg/knowledge-document-icon.svg":f2,"../../../../assets/svg/knowledge-graph-active-icon.svg":p2,"../../../../assets/svg/knowledge-graph-icon.svg":c2,"../../../../assets/svg/lang.svg":d2,"../../../../assets/svg/law.svg":u2,"../../../../assets/svg/liaotianceshi.svg":l2,"../../../../assets/svg/library_ability_official_account.svg":a2,"../../../../assets/svg/like-active.svg":s2,"../../../../assets/svg/like-icon.svg":r2,"../../../../assets/svg/like.svg":i2,"../../../../assets/svg/lingyiwanwu.svg":o2,"../../../../assets/svg/link-icon-active.svg":n2,"../../../../assets/svg/link-icon.svg":t2,"../../../../assets/svg/link-left.svg":e2,"../../../../assets/svg/lock-icon.svg":Qb,"../../../../assets/svg/login-success.svg":Zb,"../../../../assets/svg/logout.svg":Kb,"../../../../assets/svg/loop-2.svg":Jb,"../../../../assets/svg/loop-3.svg":Yb,"../../../../assets/svg/loop-icon.svg":Wb,"../../../../assets/svg/manufacture.svg":Xb,"../../../../assets/svg/mcp-node-type.svg":Gb,"../../../../assets/svg/mcp-node.svg":qb,"../../../../assets/svg/md.svg":zb,"../../../../assets/svg/medical-treatment.svg":Ub,"../../../../assets/svg/menu-expand.svg":Hb,"../../../../assets/svg/message.svg":Vb,"../../../../assets/svg/minus.svg":Fb,"../../../../assets/svg/mix-icon.svg":jb,"../../../../assets/svg/more-compatible.svg":Ib,"../../../../assets/svg/more-cycle.svg":Bb,"../../../../assets/svg/moxingshezhi.svg":Lb,"../../../../assets/svg/multimode-box.svg":Pb,"../../../../assets/svg/nav-chat.svg":Rb,"../../../../assets/svg/nav-doc.svg":$b,"../../../../assets/svg/nav-explore.svg":Tb,"../../../../assets/svg/nav-find.svg":Mb,"../../../../assets/svg/nav-library.svg":Nb,"../../../../assets/svg/nav-robot.svg":Ob,"../../../../assets/svg/nav-search.svg":Db,"../../../../assets/svg/network.svg":Ab,"../../../../assets/svg/ofd.svg":Eb,"../../../../assets/svg/official-trigger-node.svg":Sb,"../../../../assets/svg/official_account_ai_comment.svg":kb,"../../../../assets/svg/official_account_batch_send.svg":Cb,"../../../../assets/svg/official_custom_menu.svg":wb,"../../../../assets/svg/open-ai.svg":xb,"../../../../assets/svg/ordinary-icon.svg":bb,"../../../../assets/svg/ordinary-segmentation.svg":yb,"../../../../assets/svg/out-the-box.svg":mb,"../../../../assets/svg/output.svg":gb,"../../../../assets/svg/paper-airplane-new.svg":_b,"../../../../assets/svg/paper-airplane.svg":vb,"../../../../assets/svg/parameter-extraction-node.svg":hb,"../../../../assets/svg/payment.svg":fb,"../../../../assets/svg/pc.svg":pb,"../../../../assets/svg/pdf-img.svg":cb,"../../../../assets/svg/pdf-ocr.svg":db,"../../../../assets/svg/pdf-text.svg":ub,"../../../../assets/svg/pdf.svg":lb,"../../../../assets/svg/phone.svg":ab,"../../../../assets/svg/plugin-node-type.svg":sb,"../../../../assets/svg/plus.svg":rb,"../../../../assets/svg/point-h.svg":ib,"../../../../assets/svg/ppt.svg":ob,"../../../../assets/svg/preview-icon.svg":nb,"../../../../assets/svg/problem-optimization-node.svg":tb,"../../../../assets/svg/problem-optimization.svg":eb,"../../../../assets/svg/prompt-icon.svg":Q0,"../../../../assets/svg/put-away.svg":Z0,"../../../../assets/svg/qa-feedback.svg":K0,"../../../../assets/svg/question-node.svg":J0,"../../../../assets/svg/quick-Instruction.svg":Y0,"../../../../assets/svg/quote-file.svg":W0,"../../../../assets/svg/quotes.svg":X0,"../../../../assets/svg/recall-testing-active-icon.svg":G0,"../../../../assets/svg/recall-testing-icon.svg":q0,"../../../../assets/svg/recommendation.svg":z0,"../../../../assets/svg/recycle-bin-record-active-icon.svg":U0,"../../../../assets/svg/recycle-bin-record-icon.svg":H0,"../../../../assets/svg/related-robots-active-icon.svg":V0,"../../../../assets/svg/related-robots-icon.svg":F0,"../../../../assets/svg/relevance-icon.svg":j0,"../../../../assets/svg/reply-content-image-text.svg":I0,"../../../../assets/svg/reply-content-image.svg":B0,"../../../../assets/svg/reply-content-link.svg":L0,"../../../../assets/svg/reply-content-smart.svg":P0,"../../../../assets/svg/reply-content-text.svg":R0,"../../../../assets/svg/reply-content.svg":$0,"../../../../assets/svg/reply-settings.svg":T0,"../../../../assets/svg/retail.svg":M0,"../../../../assets/svg/reward-points.svg":N0,"../../../../assets/svg/right-fork-icon.svg":O0,"../../../../assets/svg/robot_auto_reply.svg":D0,"../../../../assets/svg/robot_payment.svg":A0,"../../../../assets/svg/robot_smart_menu.svg":E0,"../../../../assets/svg/robot_subscribe_reply.svg":S0,"../../../../assets/svg/save-draft.svg":k0,"../../../../assets/svg/sdk.svg":C0,"../../../../assets/svg/search-check-icon.svg":w0,"../../../../assets/svg/search-right.svg":x0,"../../../../assets/svg/search-tip.svg":b0,"../../../../assets/svg/search.svg":y0,"../../../../assets/svg/segmentation-down.svg":m0,"../../../../assets/svg/segmentation-icon.svg":g0,"../../../../assets/svg/segmentation-up.svg":_0,"../../../../assets/svg/segmentation.svg":v0,"../../../../assets/svg/select-disabled.svg":h0,"../../../../assets/svg/semantic-segmentation.svg":f0,"../../../../assets/svg/sensitive-icon.svg":p0,"../../../../assets/svg/seo-gray.svg":c0,"../../../../assets/svg/seo-highlight.svg":d0,"../../../../assets/svg/seo-light.svg":u0,"../../../../assets/svg/session-record.svg":l0,"../../../../assets/svg/session-trigger-node.svg":a0,"../../../../assets/svg/session.svg":s0,"../../../../assets/svg/set-keywords.svg":r0,"../../../../assets/svg/set_model.svg":i0,"../../../../assets/svg/setting.svg":o0,"../../../../assets/svg/share.svg":n0,"../../../../assets/svg/similarity.svg":t0,"../../../../assets/svg/skii.svg":e0,"../../../../assets/svg/smart-add.svg":Q1,"../../../../assets/svg/smart-delete.svg":Z1,"../../../../assets/svg/smart-menu.svg":K1,"../../../../assets/svg/sort-down-icon.svg":J1,"../../../../assets/svg/sort-icon.svg":Y1,"../../../../assets/svg/sort-top-icon.svg":W1,"../../../../assets/svg/source-energy.svg":X1,"../../../../assets/svg/specify-reply-node.svg":G1,"../../../../assets/svg/start-node.svg":q1,"../../../../assets/svg/statistical-analysis.svg":z1,"../../../../assets/svg/status-fail.svg":U1,"../../../../assets/svg/status-sending.svg":H1,"../../../../assets/svg/status-success.svg":V1,"../../../../assets/svg/steps-success-icon.svg":F1,"../../../../assets/svg/storage-icon.svg":j1,"../../../../assets/svg/subscribe-reply.svg":I1,"../../../../assets/svg/success.svg":B1,"../../../../assets/svg/suggested-issues.svg":L1,"../../../../assets/svg/support.svg":P1,"../../../../assets/svg/switch-mobile.svg":R1,"../../../../assets/svg/system-setting.svg":$1,"../../../../assets/svg/table-expand.svg":T1,"../../../../assets/svg/table-hide.svg":M1,"../../../../assets/svg/team-manage-active.svg":N1,"../../../../assets/svg/team-manage.svg":O1,"../../../../assets/svg/team-manage2.svg":D1,"../../../../assets/svg/tengxunhunyuan.svg":A1,"../../../../assets/svg/test-active-menu-icon.svg":E1,"../../../../assets/svg/test-menu-icon.svg":S1,"../../../../assets/svg/test_robot.svg":k1,"../../../../assets/svg/think.svg":C1,"../../../../assets/svg/thumbnail-icon-active.svg":w1,"../../../../assets/svg/thumbnail-icon.svg":x1,"../../../../assets/svg/time-default-icon.svg":b1,"../../../../assets/svg/time-icon.svg":y1,"../../../../assets/svg/time-line-icon.svg":m1,"../../../../assets/svg/timing-trigger-node.svg":g1,"../../../../assets/svg/tip-icon-two.svg":_1,"../../../../assets/svg/tip-icon.svg":v1,"../../../../assets/svg/tongyiqianwen.svg":h1,"../../../../assets/svg/txt.svg":f1,"../../../../assets/svg/unit.svg":p1,"../../../../assets/svg/unknown-issue.svg":c1,"../../../../assets/svg/unknown-prompt.svg":d1,"../../../../assets/svg/update-icon.svg":u1,"../../../../assets/svg/use-token-active.svg":l1,"../../../../assets/svg/use-token.svg":a1,"../../../../assets/svg/user-icon.svg":s1,"../../../../assets/svg/variable-assignment-node.svg":r1,"../../../../assets/svg/variable-icon.svg":i1,"../../../../assets/svg/vector-icon.svg":o1,"../../../../assets/svg/voice-clone-node.svg":n1,"../../../../assets/svg/voice-synthesis-node.svg":t1,"../../../../assets/svg/webhook-trigger-node.svg":e1,"../../../../assets/svg/wenxinyiyan.svg":Qy,"../../../../assets/svg/workflow-robot-icon.svg":Zy,"../../../../assets/svg/workflow.svg":Ky,"../../../../assets/svg/wx-app-icon.svg":Jy,"../../../../assets/svg/xitongtishici.svg":Yy,"../../../../assets/svg/xlsx.svg":Wy,"../../../../assets/svg/xunfeixinghuo.svg":Xy,"../../../../assets/svg/yuezhianmian.svg":Gy,"../../../../assets/svg/zhipuai.svg":qy,"../../../../assets/svg/zm-plugins-node.svg":zy,"../../../../assets/svg/zm-workflow-node.svg":Uy})[`../../../../assets/svg/${v}.svg`],import.meta.url).href,d=We(()=>l(s.iconName)),c=X(s.title),p=()=>{a&&clearTimeout(a),a=setTimeout(()=>{t(c.value),r("changeTitle")},250)},f=()=>{o(),r("deleteNode")},h=()=>{i()};return(v,y)=>{const g=en,_=On,b=Vr,C=Fr,T=Hr;return w(),R("div",OE,[u("div",NE,[u("div",ME,[bi(v.$slots,"node-icon",{},()=>[n.iconUrl?(w(),R("img",{key:0,class:"node-icon",src:n.iconUrl},null,8,TE)):d.value?(w(),R("img",{key:1,class:"node-icon",src:d.value},null,8,$E)):ne("",!0)],!0)]),u("div",RE,[m(g,{class:"node-name-input",value:c.value,"onUpdate:value":y[0]||(y[0]=M=>c.value=M),placeholder:"请输入节点名称",onChange:Ct(p,["stop"])},null,8,["value"])]),u("div",PE,[bi(v.$slots,"runBtn",{},void 0,!0),n.hideMenus?ne("",!0):(w(),Q(T,{key:0},{overlay:x(()=>[m(C,{style:{width:"100px"}},{default:x(()=>[m(b,{onClick:y[2]||(y[2]=M=>f())},{default:x(()=>[...y[3]||(y[3]=[u("a",{href:"javascript:;"},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[u("div",{class:"action-btn delete-btn",onClick:y[1]||(y[1]=Ct(()=>{},["prevent"]))},[m(_,{name:"point-h",class:"btn-icon"})])]),_:1})),u("div",{class:"action-btn close-btn",onClick:h},[m(K(i_),{class:"btn-icon",style:{"font-size":"12px"}})])])]),u("div",LE,[bi(v.$slots,"desc",{},()=>[U(H(s.desc),1)],!0)])])}}},nn=Ne(BE,[["__scopeId","data-v-e2917a25"]]),IE="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",jE=Rs(),FE=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}],VE={emits:["close","update-node"],inject:["getGraph"],components:{NodeFormLayout:tn,NodeFormHeader:nn,QuestionCircleOutlined:ft,PlusOutlined:Mt},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1,typOptions:[...FE],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let n=JSON.parse(this.node.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.trigger_list=n.start.trigger_list},methods:{update(){let n=JSON.parse(this.node.node_params);n.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(n)};this.$emit("update-node",e)},handleAddTrigger(){jE.getTriggerList(this.$route.query.robot_key,!0),this.getGraph().eventCenter.emit("custom:showTriggerLit")},getTriggerVariables(){let n={};return this.trigger_list.forEach(e=>{(e.outputs||[]).forEach(o=>{n[o.variable]={...o}})}),n},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(n,e){this.formState={...n},this.editIndex=e,this.show=!0},handleDel(n){this.getTriggerVariables();let e=this.getTriggerVariables(),t=this.diy_global[n];if(e["global."+t.key])return mt.error("该变量被触发器关联，请先解除关联");this.diy_global.splice(n,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},HE={class:"start-node-form"},UE={class:"add-trigger-box"},zE={class:"node-form-content"},qE={class:"start-node"},GE={class:"start-node-options"},XE={class:"options-title"},WE={class:"options-item-body"},YE={class:"option-label"},JE={class:"option-type"},KE={class:"option-desc"},ZE={class:"item-actions-box"},QE={class:"action-items-box"};function e3(n,e,t,o,i,r){const s=Pt("NodeFormHeader"),a=Pt("PlusOutlined"),l=Xt,d=Pt("QuestionCircleOutlined"),c=Zt,p=On,f=en,h=Cn,v=Lt,y=$t,g=Fi,_=Vi,b=xn,C=_n,T=Pt("NodeFormLayout");return w(),Q(T,null,{header:x(()=>[m(s,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:x(()=>[...e[5]||(e[5]=[u("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",HE,[u("div",UE,[m(l,{type:"primary",ghost:"",onClick:Ct(r.handleAddTrigger,["stop"])},{icon:x(()=>[m(a)]),default:x(()=>[e[6]||(e[6]=u("span",null,"添加触发器",-1))]),_:1},8,["onClick"]),e[7]||(e[7]=u("div",{class:"add-trigger-desc"},"添加触发器后支持定时或者外部事件触发工作流",-1))]),u("div",zE,[u("div",qE,[u("div",GE,[u("div",XE,[e[9]||(e[9]=u("div",null,[u("img",{src:IE,alt:"",class:"title-icon"}),u("span",null,"自定义全局变量")],-1)),u("div",null,[m(c,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:x(()=>[...e[8]||(e[8]=[u("div",null,[U(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),u("br"),U(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),u("br"),U(" 2、通过api访问时，可以再API中传递参数值"),u("br"),U(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])]),default:x(()=>[m(d,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(w(!0),R(se,null,ge(i.diy_global,(M,S)=>(w(),R("div",{class:xt(["options-item diy-options-item",{"is-required":M.required}]),key:M.key},[u("div",WE,[u("div",YE,H(M.key),1),u("div",JE,H(M.typ),1),m(c,{title:M.desc},{default:x(()=>[u("div",KE,H(M.desc),1)]),_:2},1032,["title"])]),u("div",ZE,[m(p,{class:"action-btn",name:"edit-02",onClick:k=>r.handleEdit(M,S)},null,8,["onClick"]),m(p,{class:"action-btn",name:"close-circle",onClick:k=>r.handleDel(S)},null,8,["onClick"])])],2))),128)),u("div",QE,[m(l,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:r.handleAdd},{icon:x(()=>[m(a)]),default:x(()=>[e[10]||(e[10]=U(" 添加全局变量 ",-1))]),_:1},8,["onClick"])])]),m(C,{open:i.show,"onUpdate:open":e[4]||(e[4]=M=>i.show=M),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:r.handleOk},{default:x(()=>[m(b,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:x(()=>[m(h,{label:"变量名",name:"key"},{default:x(()=>[m(f,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=M=>i.formState.key=M),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),m(h,{label:"类型",name:"typ"},{default:x(()=>[m(y,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=M=>i.formState.typ=M)},{default:x(()=>[(w(!0),R(se,null,ge(i.typOptions,M=>(w(),Q(v,{value:M.value,key:M.value},{default:x(()=>[u("span",null,H(M.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),m(h,{label:"必填",name:"required"},{default:x(()=>[m(g,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=M=>i.formState.required=M)},null,8,["checked"])]),_:1}),m(h,{label:"描述",name:"desc"},{default:x(()=>[m(_,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=M=>i.formState.desc=M),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const t3=Ne(VE,[["render",e3],["__scopeId","data-v-d067fbdc"]]),n3={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(n){n&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(n){const e=[],t=[],o=(i,r)=>{if(!i||i.length===0)return!1;for(let s=0;s<i.length;s++){const a=i[s],l=a[this.valueKey];if(l===n)return e[r]=a,t[r]=l,!0;if(a[this.childrenKey]&&a[this.childrenKey].length>0){if(e[r]=a,t[r]=l,o(a[this.childrenKey],r+1))return!0;e[r]=null,t[r]=null}}return!1};o(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(n){if(!n||n.length===0)return;const e=[];let t=this.options;for(let o=0;o<n.length;o++){const i=n[o],r=t.find(s=>s[this.valueKey]===i);if(r)e.push(r),t=r[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let n=0;n<this.selectedPath.length;n++){const e=this.selectedPath[n];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:n+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(n,e,t){this.hasChildren(n)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(n),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(n[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(n)&&this.activePath.push({title:n[this.labelKey],options:n[this.childrenKey],level:e+1}),this.$emit("select",n,this.selectedPath,e),(this.checkAnyLevel&&!this.isClickRight&&e>0||!this.hasChildren(n))&&(this.$emit("change",n[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:n[this.valueKey])),this.isClickRight=!1},isActive(n,e){return!this.selectedPath||this.selectedPath.length<=e?!1:n[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(n){return n[this.childrenKey]&&n[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const n=this.$el;if(!n)return;const e=n.getBoundingClientRect(),t=window.innerWidth,o=180;e.right+o>t&&e.left>o?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",o)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",o))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},o3={class:"cascade-panel"},i3={class:"cascade-panel-body"},r3=["onClick"],s3={class:"item-content"},a3={class:"item-label"},l3={key:0,class:"cascade-panel-empty"};function u3(n,e,t,o,i,r){return w(),R("div",o3,[u("div",{class:xt(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(w(!0),R(se,null,ge(i.activePath,(s,a)=>(w(),R("div",{class:"cascade-panel-list",key:a},[u("div",i3,[(w(!0),R(se,null,ge(s.options,l=>(w(),R("div",{class:xt(["cascade-panel-item",{active:r.isActive(l,a)}]),key:l.value,onClick:d=>r.handleSelect(l,a,d)},[u("div",s3,[u("span",a3,H(l.label),1),r.hasChildren(l)?(w(),R("span",{key:0,class:"item-icon",onClick:e[0]||(e[0]=(...d)=>r.handleRightClick&&r.handleRightClick(...d))},[...e[1]||(e[1]=[u("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[u("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):ne("",!0)])],10,r3))),128)),s.options&&s.options.length===0?(w(),R("div",l3," 暂无数据 ")):ne("",!0)])]))),128))],2)])}const C_=Ne(n3,[["render",u3],["__scopeId","data-v-e9d3b944"]]),k_=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...k_(t.children)):e.push(t)}),e},d3={name:"JMention",components:{CascadePanel:C_},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1},bordered:{type:Boolean,default:!0}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(n){n.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(n){n.target.closest(".dropdown-list")&&n.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(n){this.$emit("open",n)},getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(o=>{let i="";this.type==="textarea"?o.nodeName==="BR"?i=`
`:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:i=o.textContent:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:o.nodeName==="BR"?i="":i=o.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){const n=this.$refs.JMention;if(!n)return;let e=n.innerHTML,t=this.getText(e);this.localValue=t;let o={};this.selectedList.forEach(r=>{!o[r.value]&&t.indexOf(r.value)!==-1&&(o[r.value]=r)});let i=Object.values(o);this.$emit("change",t.trim(),i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],o=k_(this.options),i=[...t,...o].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const r=new Set;i.forEach(s=>{const a=new RegExp(`(${s.value})`,"g");if(a.test(this.defaultValue)&&!r.has(s.value)){let l=s.node_name+"."+s.text;l=l.replace(/\./g,"/"),e=e.replace(a,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${l}</span>`),r.add(s.value),this.selectOption(s,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),o=t.startOffset,i=t.startContainer;let r="";if(i.nodeType===Node.TEXT_NODE)r=i.textContent.slice(0,o);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?r+=l.textContent.slice(0,o):r+=l.textContent)}}return r.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,o=e.startContainer;let i="";if(o.nodeType===Node.TEXT_NODE)i=o.textContent.slice(0,t);else if(o.nodeType===Node.ELEMENT_NODE){const s=o.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?i+=l.textContent.slice(0,t):i+=l.textContent)}}const r=i.lastIndexOf("/");return r===-1?"":i.slice(r+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),o=await this.getDropdownListSize(),i=window.innerWidth,r=window.innerHeight;let s=t.bottom,a=t.left;return s+o.height>r&&(s=t.top-o.height),a+o.width>i&&(a=t.right-o.width),s<0&&(s=0),a<0&&(a=0),{top:s,left:a}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let o=t.dataset.value;const i=this.options.find(r=>r.value==o);this.selectedList.push(i),this.selectedIdSet.add(o)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(n){this.handleDropdownLogic(n),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(n){const e=this.getLastChar();if(n.inputType==="deleteContentBackward"&&!this.atText)e!="/"&&(this.showDropdown=!1);else if(e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const r=this.checkStartWith(i);i&&(this.showDropdown=r)}if(!this.showDropdown)return;const{top:t,left:o}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${o}px; top:${t}px;`},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const r=i.getRangeAt(0),s=r.startOffset,a=r.startContainer;let l=s-t,d=a;if(l<0){let c=a.previousSibling;for(;c;){if(c.nodeType===Node.TEXT_NODE){l=c.textContent.length-t,d=c;break}c=c.previousSibling}}if(d.nodeType===Node.TEXT_NODE){d.replaceData(l,t,"");const c=document.createElement("span");c.contentEditable="false",c.classList.add("j-mention-at"),c.style=this.atTextStyle,c.textContent=`${n}`;for(const f in e)c.dataset[f]=e[f];const p=document.createRange();p.setStart(d,l),p.insertNode(c),r.setStartAfter(c),r.setEndAfter(c),i.removeAllRanges(),i.addRange(r)}},onSelectOption(n,e,t){let o=t[t.length-1];delete o.children,this.selectOption(o)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const o={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,o),this.initShowOptionList(),this.updateValue())},handleDirectionChange(n,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),o=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!o)return;const i=parseFloat(t[1]),r=parseFloat(o[1]);let s;n==="left"?s=i-e:s=i+e,this.positionStyle=`left:${s}px; top:${r}px;`}}},c3={style:{width:"100%",position:"relative"}},p3=["placeholder"],f3={key:0,class:"placeholder"};function h3(n,e,t,o,i,r){const s=Pt("CascadePanel");return w(),R("div",c3,[e[4]||(e[4]=u("div",null,null,-1)),(w(),Q(Kv,{to:"body"},[i.showDropdown?(w(),R("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:Fn(i.positionStyle)},[m(s,{options:i.showOptions,checkAnyLevel:t.checkAnyLevel,onChange:r.onSelectOption,onDirectionChange:r.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):ne("",!0)])),u("div",{class:xt(["mention-input-warpper",{"no-border":!t.bordered}]),ref:"JMentionContainer"},[u("div",{ref:"JMention",style:Fn([t.inputStyle]),class:xt(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onFocus:e[0]||(e[0]=(...a)=>r.onFocus&&r.onFocus(...a)),onInput:e[1]||(e[1]=(...a)=>r.debouncedUpdate&&r.debouncedUpdate(...a)),onClick:e[2]||(e[2]=(...a)=>r.clickJMention&&r.clickJMention(...a)),onBlur:e[3]||(e[3]=(...a)=>r.handleBlur&&r.handleBlur(...a))},null,46,p3),i.localValue.length==0?(w(),R("span",f3,H(t.placeholder),1)):ne("",!0)],2)])}const tt=Ne(d3,[["render",h3],["__scopeId","data-v-e4774840"]]),v3={class:"problem-optimization-form"},_3={class:"gray-block"},g3={class:"flex-block-item"},m3={class:"number-box"},y3={class:"number-slider-box"},b3={class:"number-input-box"},x3={class:"number-box"},w3={class:"number-slider-box"},C3={class:"number-input-box"},k3={class:"number-box"},S3={class:"number-box"},E3={class:"number-slider-box"},A3={class:"number-input-box"},D3={class:"field-list-item"},O3={class:"field-label"},N3={class:"field-type"},M3={class:"diy-form-item"},T3={class:"form-content"},$3={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Vn(),r=X(null),s=We(()=>i.modelList),a=X([]),l=X([]),d=X(!1),c=()=>{d.value=!d.value},p=(P,E)=>{_.prompt=P,_.prompt_tags=E};function f(){const P=o.lf.getNodeModelById(o.nodeId);if(P){let E=P.getAllParentVariable();l.value=h(E)}}function h(P){return P.forEach(E=>{E.typ=="node"?E.node_type==1?E.value="global":E.value=E.node_id:E.value=E.key,E.children&&E.children.length>0&&(E.children=h(E.children))}),P}const v=()=>{const P=o.lf.getNodeModelById(o.nodeId);if(P){let E=P.getAllParentVariable();a.value=E}};function y(P){if(P){let E=P.split("."),D=E[0],N=E.filter((F,Y)=>Y>0).join(".");return[D,N]}return["global","question"]}const g=X(),_=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,role:1}),b=()=>{_.use_model&&_.use_model.toLowerCase().includes("deepseek-r1")?_.role=2:_.role=1},C=()=>{const P=o.node.dataRaw||o.node.node_params||"{}",E=JSON.stringify({question_optimize:JSON.parse(P).question_optimize||{}}),D=JSON.stringify({question_optimize:{..._,question_value:_.question_value.join("."),model_config_id:_.model_config_id?+_.model_config_id:_.model_config_id}});E!=D&&t("update-node",{...o.node,..._,node_params:D})},T=()=>{try{let P=o.node.dataRaw||o.node.node_params||"{}",E=JSON.parse(P).question_optimize||{};E=JSON.parse(JSON.stringify(E));let{model_config_id:D,use_model:N,context_pair:F,temperature:Y,max_token:L,prompt:j,prompt_tags:le,question_value:z,enable_thinking:V,role:J}=E;v(),f(),_.model_config_id=D,_.use_model=N,_.context_pair=F||0,_.temperature=Y,_.max_token=L,_.prompt=j,_.enable_thinking=V,_.prompt_tags=le||[],_.question_value=y(z),!_.model_config_id&&s.value.length>0&&(_.model_config_id=s.value[0].id,_.use_model=s.value[0].children[0].name),_.role=+J||1}catch(P){}};ct(()=>_,()=>{C()},{deep:!0});const M=X(null),S=P=>{_.prompt="",P.prompt_type==1?_.prompt=P.markdown:_.prompt=P.prompt,Tt(()=>{r.value.initData()})},k=P=>{P||f()},A=X({}),$=(P,E)=>{A.value=E},B=We(()=>{if(!_.model_config_id)return!1;let P=_.model_config_id+"#"+_.use_model;return A.value[P]}),O=()=>{t("close")};return at(()=>{T()}),(P,E)=>{const D=Xt,N=Cn,F=Zt,Y=ro,L=io,j=$s,le=In,z=Mn,V=Fi,J=li,oe=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:O},null,8,["title","iconName"])]),default:x(()=>[u("div",v3,[u("div",{class:"node-form-content",onMousedown:E[12]||(E[12]=Ct(()=>{},["stop"]))},[m(oe,{ref_key:"formRef",ref:g,layout:"vertical",model:_},{default:x(()=>[u("div",_3,[E[29]||(E[29]=u("div",{class:"gray-block-title"},"输入",-1)),m(N,{label:"LLM模型",name:"use_model"},{default:x(()=>[u("div",g3,[m(lr,{modelType:"LLM",modeName:_.use_model,"onUpdate:modeName":E[0]||(E[0]=W=>_.use_model=W),modeId:_.model_config_id,"onUpdate:modeId":E[1]||(E[1]=W=>_.model_config_id=W),onLoaded:$,onChange:b,style:{width:"348px"}},null,8,["modeName","modeId"]),m(D,{onClick:c},{default:x(()=>[E[13]||(E[13]=U("高级设置 ",-1)),d.value?(w(),Q(K(xo),{key:0})):(w(),Q(K(Ua),{key:1}))]),_:1})])]),_:1}),d.value?(w(),Q(N,{key:0,name:"role"},{label:x(()=>[E[15]||(E[15]=u("span",null,"提示词所属角色 ",-1)),m(F,null,{title:x(()=>[...E[14]||(E[14]=[u("div",null,[U(" 对接大模型时，会将设置中的提示词拼接在对应的role角色下。 "),u("div",null,"系统角色效果示例："),u("div",null,'{"role": "system", "content": "自定义提示词"}')],-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[m(L,{value:_.role,"onUpdate:value":E[2]||(E[2]=W=>_.role=W)},{default:x(()=>[m(Y,{value:1},{default:x(()=>[...E[16]||(E[16]=[U("系统角色（System）",-1)])]),_:1}),m(Y,{value:2},{default:x(()=>[...E[17]||(E[17]=[U("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):ne("",!0),d.value?(w(),Q(N,{key:1,name:"temperature"},{label:x(()=>[E[19]||(E[19]=u("span",null,"温度 ",-1)),m(F,null,{title:x(()=>[...E[18]||(E[18]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",m3,[u("div",y3,[m(le,null,{default:x(()=>[m(j,{class:"custom-slider",value:_.temperature,"onUpdate:value":E[3]||(E[3]=W=>_.temperature=W),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),u("div",b3,[m(z,{value:_.temperature,"onUpdate:value":E[4]||(E[4]=W=>_.temperature=W),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ne("",!0),d.value?(w(),Q(N,{key:2,name:"max_token"},{label:x(()=>[E[21]||(E[21]=u("span",null,"最大token ",-1)),m(F,null,{title:x(()=>[...E[20]||(E[20]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",x3,[u("div",w3,[m(le,null,{default:x(()=>[m(j,{class:"custom-slider",value:_.max_token,"onUpdate:value":E[5]||(E[5]=W=>_.max_token=W),min:0,max:100*1024},null,8,["value"])]),_:1})]),u("div",C3,[m(z,{value:_.max_token,"onUpdate:value":E[6]||(E[6]=W=>_.max_token=W),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ne("",!0),d.value&&B.value?(w(),Q(N,{key:3,name:"enable_thinking"},{label:x(()=>[E[23]||(E[23]=u("span",null,"深度思考 ",-1)),m(F,null,{title:x(()=>[...E[22]||(E[22]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",k3,[m(V,{checked:_.enable_thinking,"onUpdate:checked":E[7]||(E[7]=W=>_.enable_thinking=W)},null,8,["checked"])])]),_:1})):ne("",!0),m(N,{name:"context_pair"},{label:x(()=>[E[25]||(E[25]=u("span",null,"上下文数量 ",-1)),m(F,null,{title:x(()=>[...E[24]||(E[24]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",S3,[u("div",E3,[m(le,null,{default:x(()=>[m(j,{class:"custom-slider",value:_.context_pair,"onUpdate:value":E[8]||(E[8]=W=>_.context_pair=W),min:0,max:50},null,8,["value"])]),_:1})]),u("div",A3,[m(z,{value:_.context_pair,"onUpdate:value":E[9]||(E[9]=W=>_.context_pair=W),min:0,max:50},null,8,["value"])])])]),_:1}),m(N,{name:"prompt",class:"width-100"},{label:x(()=>[...E[26]||(E[26]=[u("div",{class:"space-between-box"},[u("div",null,"对话背景")],-1)])]),default:x(()=>[m(tt,{type:"textarea",inputStyle:"height: 100px;",options:a.value,defaultSelectedList:_.prompt_tags,defaultValue:_.prompt,ref_key:"atInputRef",ref:r,onOpen:v,onChange:E[10]||(E[10]=(W,q)=>p(W,q)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:x(({label:W,payload:q})=>[u("div",D3,[u("div",O3,H(W),1),u("div",N3,H(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),E[27]||(E[27]=u("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),u("div",M3,[E[28]||(E[28]=u("div",{class:"form-label"},"用户问题",-1)),u("div",T3,[m(J,{value:_.question_value,"onUpdate:value":E[11]||(E[11]=W=>_.question_value=W),onDropdownVisibleChange:k,style:{width:"220px"},options:l.value,allowClear:!1,displayRender:({labels:W})=>W.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),E[30]||(E[30]=u("div",{class:"gray-block mt16"},[u("div",{class:"gray-block-title"},"输出"),u("div",{class:"options-item"},[u("div",{class:"option-label"},"问题优化结果"),u("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"]),m(p_,{onOk:S,ref_key:"importPromptRef",ref:M},null,512)],32)])]),_:1})}}},R3=Ne($3,[["__scopeId","data-v-6b58350a"]]),P3={class:"input-box"},L3={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(n,{expose:e,emit:t}){const o=X(!1),i=t;ct(()=>o.value,p=>{p||i("ok")});const r=n,s=X(null),a=()=>{o.value=!0,Tt(()=>{s.value.refresh()})},l=p=>{i("open",p)},d=(p,f)=>{i("change",p,f)},c=()=>{o.value=!1};return e({show:a}),(p,f)=>{const h=Xt,v=_n;return w(),R("div",null,[m(v,{open:o.value,"onUpdate:open":f[1]||(f[1]=y=>o.value=y),title:"字段详情",width:746},{footer:x(()=>[m(h,{type:"primary",onClick:c},{default:x(()=>[...f[2]||(f[2]=[U("确定",-1)])]),_:1})]),default:x(()=>[u("div",P3,[m(tt,{inputStyle:"height: 550px;",options:r.options,defaultSelectedList:r.defaultSelectedList,defaultValue:r.defaultValue,placeholder:r.placeholder,type:r.type,ref_key:"atInputRef",ref:s,onOpen:l,onChange:f[0]||(f[0]=(y,g)=>d(y,g))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},Hi=Ne(L3,[["__scopeId","data-v-62373f0f"]]),B3={class:"problem-optimization-form"},I3={class:"gray-block"},j3={class:"flex-block-item"},F3={class:"number-box"},V3={class:"number-slider-box"},H3={class:"number-input-box"},U3={class:"number-box"},z3={class:"number-slider-box"},q3={class:"number-input-box"},G3={class:"number-box"},X3={class:"number-box"},W3={class:"number-slider-box"},Y3={class:"number-input-box"},J3={class:"space-between-box"},K3={class:"field-list-item"},Z3={class:"field-label"},Q3={class:"field-type"},eA={class:"diy-form-item mt12"},tA={class:"form-content"},nA={class:"gray-block mt16"},oA={class:"diy-form-item question-value-item"},iA={class:"form-content"},rA={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Vn(),s=X(null),a=We(()=>r.modelList),l=X([]),d=X([]),c=X(!1),p=X(),f=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0,role:1}),h=()=>{f.use_model&&f.use_model.toLowerCase().includes("deepseek-r1")?f.role=2:f.role=1},v=()=>{c.value=!c.value},y=(L,j)=>{f.prompt=L,f.prompt_tags=j};function g(){let L=i().getAllParentVariable();d.value=b(L)}const _=We(()=>d.value.filter(j=>j.node_type==5));function b(L){return L.forEach(j=>{j.typ=="node"?j.node_type==1?j.value="global":j.value=j.node_id:j.value=j.key,j.children&&j.children.length>0&&(j.children=b(j.children))}),L}const C=()=>{let L=i().getAllParentVariable();l.value=L};function T(L){if(L){let j=L.split("."),le=j[0],z=j.filter((V,J)=>J>0).join(".");return[le,z]}return["global","question"]}const M=X(null),S=()=>{M.value.show()},k=L=>{f.prompt="",L.prompt_type==1?f.prompt=L.markdown:f.prompt=L.prompt,Tt(()=>{s.value.initData()})},A=X(null),$=()=>{A.value.show()},B=()=>{s.value.refresh()},O=()=>{const L=JSON.stringify({llm:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t("update-node",{...o.node,...f,node_params:L})},P=()=>{try{let L=o.node.dataRaw||o.node.node_params||"{}",j=JSON.parse(L).llm||{};j=JSON.parse(JSON.stringify(j));let{model_config_id:le,use_model:z,context_pair:V,temperature:J,max_token:oe,prompt:W,prompt_tags:q,question_value:re,enable_thinking:ue,libs_node_key:xe,role:Te}=j;C(),g(),f.model_config_id=le,f.use_model=z,f.context_pair=V||0,f.temperature=J,f.max_token=oe,f.prompt=W,f.enable_thinking=ue,f.prompt_tags=q||[],f.libs_node_key=xe,f.question_value=T(re),!f.model_config_id&&a.value.length>0&&(f.model_config_id=a.value[0].id,f.use_model=a.value[0].children[0].name),f.role=+Te||1}catch(L){}};ct(()=>f,()=>{O()},{deep:!0});const E=L=>{L||g()},D=X({}),N=(L,j)=>{D.value=j},F=We(()=>{if(!f.model_config_id)return!1;let L=f.model_config_id+"#"+f.use_model;return D.value[L]}),Y=()=>{t("close")};return at(()=>{P()}),(L,j)=>{const le=Xt,z=Cn,V=Zt,J=ro,oe=io,W=$s,q=In,re=Mn,ue=Fi,xe=ko,Te=Lt,me=$t,pe=li,Ge=xn,Le=p_;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:Y},null,8,["title","iconName"])]),default:x(()=>[u("div",B3,[u("div",{class:"node-form-content",onMousedown:j[13]||(j[13]=Ct(()=>{},["stop"]))},[m(Ge,{ref_key:"formRef",ref:p,layout:"vertical",model:f},{default:x(()=>[u("div",I3,[j[32]||(j[32]=u("div",{class:"gray-block-title"},"大模型设置",-1)),m(z,{label:"LLM模型",name:"use_model"},{default:x(()=>[u("div",j3,[m(lr,{modelType:"LLM",modeName:f.use_model,"onUpdate:modeName":j[0]||(j[0]=_e=>f.use_model=_e),modeId:f.model_config_id,"onUpdate:modeId":j[1]||(j[1]=_e=>f.model_config_id=_e),onLoaded:N,onChange:h,style:{width:"348px"}},null,8,["modeName","modeId"]),m(le,{onClick:v},{default:x(()=>[j[15]||(j[15]=U("高级设置 ",-1)),c.value?(w(),Q(K(xo),{key:0})):(w(),Q(K(Ua),{key:1}))]),_:1})])]),_:1}),c.value?(w(),Q(z,{key:0,name:"role"},{label:x(()=>[j[17]||(j[17]=u("span",null,"提示词所属角色 ",-1)),m(V,null,{title:x(()=>[...j[16]||(j[16]=[u("div",null,[U(" 对接大模型时，会将设置中的提示词拼接在对应的role角色下。 "),u("div",null,"系统角色效果示例："),u("div",null,'{"role": "system", "content": "自定义提示词"}')],-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[m(oe,{value:f.role,"onUpdate:value":j[2]||(j[2]=_e=>f.role=_e)},{default:x(()=>[m(J,{value:1},{default:x(()=>[...j[18]||(j[18]=[U("系统角色（System）",-1)])]),_:1}),m(J,{value:2},{default:x(()=>[...j[19]||(j[19]=[U("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):ne("",!0),c.value?(w(),Q(z,{key:1,name:"temperature"},{label:x(()=>[j[21]||(j[21]=u("span",null,"温度 ",-1)),m(V,null,{title:x(()=>[...j[20]||(j[20]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",F3,[u("div",V3,[m(q,null,{default:x(()=>[m(W,{class:"custom-slider",value:f.temperature,"onUpdate:value":j[3]||(j[3]=_e=>f.temperature=_e),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),u("div",H3,[m(re,{value:f.temperature,"onUpdate:value":j[4]||(j[4]=_e=>f.temperature=_e),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ne("",!0),c.value?(w(),Q(z,{key:2,name:"max_token"},{label:x(()=>[j[23]||(j[23]=u("span",null,"最大token ",-1)),m(V,null,{title:x(()=>[...j[22]||(j[22]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",U3,[u("div",z3,[m(q,null,{default:x(()=>[m(W,{class:"custom-slider",value:f.max_token,"onUpdate:value":j[5]||(j[5]=_e=>f.max_token=_e),min:0,max:100*1024},null,8,["value"])]),_:1})]),u("div",q3,[m(re,{value:f.max_token,"onUpdate:value":j[6]||(j[6]=_e=>f.max_token=_e),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ne("",!0),c.value&&F.value?(w(),Q(z,{key:3,name:"enable_thinking"},{label:x(()=>[j[25]||(j[25]=u("span",null,"深度思考 ",-1)),m(V,null,{title:x(()=>[...j[24]||(j[24]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",G3,[m(ue,{checked:f.enable_thinking,"onUpdate:checked":j[7]||(j[7]=_e=>f.enable_thinking=_e)},null,8,["checked"])])]),_:1})):ne("",!0),m(z,{name:"context_pair"},{label:x(()=>[j[27]||(j[27]=u("span",null,"上下文数量 ",-1)),m(V,null,{title:x(()=>[...j[26]||(j[26]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",X3,[u("div",W3,[m(q,null,{default:x(()=>[m(W,{class:"custom-slider",value:f.context_pair,"onUpdate:value":j[8]||(j[8]=_e=>f.context_pair=_e),min:0,max:50},null,8,["value"])]),_:1})]),u("div",Y3,[m(re,{value:f.context_pair,"onUpdate:value":j[9]||(j[9]=_e=>f.context_pair=_e),min:0,max:50},null,8,["value"])])])]),_:1}),m(z,{name:"prompt",class:"width-100"},{label:x(()=>[u("div",J3,[j[29]||(j[29]=u("div",null,"提示词",-1)),m(xe,{gap:8},{default:x(()=>[u("div",{class:"btn-hover-wrap",onClick:S},[m(K(ly)),j[28]||(j[28]=U("从提示词库导入 ",-1))]),u("div",{class:"btn-hover-wrap",onClick:$},[m(K(po))])]),_:1})])]),default:x(()=>[m(tt,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:f.prompt_tags,defaultValue:f.prompt,ref_key:"atInputRef",ref:s,onOpen:C,onChange:j[10]||(j[10]=(_e,he)=>y(_e,he)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:x(({label:_e,payload:he})=>[u("div",K3,[u("div",Z3,H(_e),1),u("div",Q3,H(he.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),j[30]||(j[30]=u("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),u("div",eA,[j[31]||(j[31]=u("div",{class:"form-label"},"知识库引用",-1)),u("div",tA,[m(me,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:E,value:f.libs_node_key,"onUpdate:value":j[11]||(j[11]=_e=>f.libs_node_key=_e),style:{width:"220px"}},{default:x(()=>[(w(!0),R(se,null,ge(_.value,_e=>(w(),Q(Te,{value:_e.node_id,key:_e.node_id},{default:x(()=>[U(H(_e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),u("div",nA,[j[34]||(j[34]=u("div",{class:"gray-block-title"},"输入",-1)),u("div",oA,[j[33]||(j[33]=u("div",{class:"form-label"},"输入",-1)),u("div",iA,[m(pe,{value:f.question_value,"onUpdate:value":j[12]||(j[12]=_e=>f.question_value=_e),onDropdownVisibleChange:E,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),j[35]||(j[35]=u("div",{class:"gray-block mt16"},[u("div",{class:"gray-block-title"},"输出"),u("div",{class:"options-item"},[u("div",{class:"option-label"},"AI回复内容"),u("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"])],32),m(Le,{onOk:k,ref_key:"importPromptRef",ref:M},null,512),m(Hi,{options:l.value,defaultSelectedList:f.prompt_tags,defaultValue:f.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:C,onChange:j[14]||(j[14]=(_e,he)=>y(_e,he)),onOk:B,ref_key:"fullAtInputRef",ref:A},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},sA=Ne(rA,[["__scopeId","data-v-b0f8f31c"]]),Yn="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ur=Jv("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(n=>{this.formListQueue.push(n)});this.formListLoading=!0;try{const n=await dC();this.formList=n.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(n){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:n}){if(this.formFieldListMap[n]&&this.formFieldListMap[n].length>0)return[...this.formFieldListMap[n]];if(this.formFieldListLoadingMap[n])return new Promise(e=>{this.formFieldListQueueMap[n]||(this.formFieldListQueueMap[n]=[]),this.formFieldListQueueMap[n].push(e)});this.formFieldListLoadingMap[n]=!0;try{const e=await uC({form_id:n});this.formFieldListMap[n]=e.data||[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(o=>o(t)),this.formFieldListQueueMap[n]=[]),t}catch(e){this.formFieldListMap[n]=[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(o=>o(t)),this.formFieldListQueueMap[n]=[]),t}finally{this.formFieldListLoadingMap[n]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:n}){return this.formFieldListMap[n]=[],this.formFieldListLoadingMap[n]=!1,this.formFieldListQueueMap[n]=[],await this.getFormFieldList({form_id:n})}}}),aA={class:"field-select-box"},lA={key:0,class:"field-list-box"},uA={key:1,class:"empty-box"},dA={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=ur(),r=Je({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),s=X([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),a=X([]),l=(v,y)=>{r.selectedRowKeys=v,r.selectedRows=y},d=({formId:v,selectedRowKeys:y,selectedRows:g})=>{r.formId=v,r.selectedRowKeys=y,r.selectedRows=g,h(),r.show=!0},c=()=>{window.open("/#/database/details/field-manage?form_id="+r.formId)},p=()=>{o("ok",r.selectedRowKeys,r.selectedRows),r.show=!1},f=X(!1),h=()=>{f.value=!0,i.getFormFieldList({form_id:r.formId}).then(v=>{f.value=!1,v.forEach(y=>{y.value="",y.id=y.id*1}),a.value=v}).catch(()=>{f.value=!1})};return e({open:d}),(v,y)=>{const g=Ur,_=_n;return w(),Q(_,{width:"746px",open:r.show,"onUpdate:open":y[0]||(y[0]=b=>r.show=b),title:"关联数据表",onOk:p,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[u("div",aA,[a.value.length?(w(),R("div",lA,[m(g,{rowKey:"name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:l},dataSource:a.value,columns:s.value,loading:f.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):ne("",!0),a.value.length?ne("",!0):(w(),R("div",uA,[y[2]||(y[2]=u("img",{src:Xa,alt:""},null,-1)),u("div",null,[y[1]||(y[1]=U(" 暂无字段, 请先去数据表添加 ",-1)),u("a",{onClick:c}," 去添加")])]))])]),_:1},8,["open"])}}},cA=Ne(dA,[["__scopeId","data-v-226c889a"]]),pA={class:"field-list"},fA={class:"field-list-row"},hA={key:0,class:"field-list-col field-list-col-head field-value-head"},vA={key:1,class:"field-list-col field-list-col-head field-del-head"},_A={key:0,class:"field-list-row"},gA={class:"field-list-col field-value-col"},mA={class:"field-list-col field-name-col"},yA={class:"field-list-col field-type-col"},bA={key:0,class:"field-list-col field-value-col"},xA={key:1,class:"field-list-col field-del-col"},wA=["onClick"],CA={key:0,class:"add-btn-box"},kA={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Je({list:o.list});ct(()=>o.list,y=>{r.list=y});const s=X([]),a=()=>{let y=i().getAllParentVariable();s.value=y||[]},l=()=>{a()},d=(y,g,_,b)=>{r.list[b].value=y,r.list[b].atTags=g,f()},c=(y,g)=>{r.list=[...g],f()},p=y=>{r.list.splice(y,1),f()},f=()=>{t("change",[...r.list])},h=X(),v=()=>{h.value.open({formId:o.formId,selectedRows:o.list,selectedRowKeys:o.list.map(y=>y.name)})};return at(()=>{a()}),(y,g)=>{const _=en,b=Zt,C=On,T=Xt;return w(),R("div",null,[u("div",pA,[u("div",fA,[g[0]||(g[0]=u("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),g[1]||(g[1]=u("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),R("div",hA,"字段值")):ne("",!0),o.showDelete?(w(),R("div",vA)):ne("",!0)]),n.showEmptyFieldRow?(w(),R("div",_A,[g[2]||(g[2]=u("div",{class:"field-list-col field-name-col"},"--",-1)),g[3]||(g[3]=u("div",{class:"field-list-col field-type-col"},"--",-1)),u("div",gA,[m(b,{title:"请先选择数据库"},{default:x(()=>[m(_,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ne("",!0),(w(!0),R(se,null,ge(r.list,(M,S)=>(w(),R("div",{class:"field-list-row",key:M.name},[u("div",mA,H(M.name),1),u("div",yA,H(M.type),1),n.showInput?(w(),R("div",bA,[m(tt,{options:s.value,defaultValue:M.value,defaultSelectedList:M.atTags,onOpen:l,onChange:(k,A)=>d(k,A,M,S),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):ne("",!0),o.showDelete?(w(),R("div",xA,[u("span",{class:"del-btn",onClick:k=>p(S)},[m(C,{class:"del-icon",name:"close-circle"})],8,wA)])):ne("",!0)]))),128))]),o.showAdd?(w(),R("div",CA,[m(T,{class:"add-btn",type:"dashed",block:"",onClick:v},{default:x(()=>[m(K(Mt)),g[4]||(g[4]=U(" 添加更新字段",-1))]),_:1})])):ne("",!0),m(cA,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:h,onOk:c},null,8,["formId"])])}}},Zc=Ne(kA,[["__scopeId","data-v-8972aaa9"]]),SA={class:"library-checkbox-box"},EA={class:"list-box",ref:"scrollContainer"},AA={class:"library-name"},DA={class:"library-desc"},OA={key:1,class:"empty-box"},NA={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(),s=X(!1),a=p=>{r.value=p,s.value=!0},l=()=>{s.value=!1,d()},d=()=>{let p=i.options.filter(f=>f.id===r.value);o("ok",r.value,JSON.parse(JSON.stringify(p[0])))},c=()=>{window.open("/#/database/list")};return e({open:a}),(p,f)=>{const h=ro,v=io,y=_n;return w(),Q(y,{width:"746px",open:s.value,"onUpdate:open":f[1]||(f[1]=g=>s.value=g),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:l},{default:x(()=>[u("div",SA,[n.options.length?(w(),Q(v,{key:0,value:r.value,"onUpdate:value":f[0]||(f[0]=g=>r.value=g),style:{width:"100%"}},{default:x(()=>[u("div",EA,[(w(!0),R(se,null,ge(i.options,g=>(w(),R("div",{class:"list-item-wraapper",key:g.id},[m(h,{class:"list-item",value:g.id},{default:x(()=>[u("div",AA,H(g.name),1),u("div",DA,H(g.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):ne("",!0),n.options.length?ne("",!0):(w(),R("div",OA,[f[3]||(f[3]=u("img",{src:Xa,alt:""},null,-1)),u("div",null,[f[2]||(f[2]=U(" 暂无数据表, 请先去添加数据表 ",-1)),u("a",{onClick:c}," 去添加")])]))])]),_:1},8,["open"])}}},MA=Ne(NA,[["__scopeId","data-v-51756847"]]),TA={class:""},$A={key:0,class:"data-table-info"},RA={class:"data-table-name"},PA={class:"data-table-desc"},LA={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:e}){const t=e,o=n,i=X(null),r=We(()=>{let d=o.options.filter(c=>c.id===o.value);return d.length?d[0]:null}),s=()=>{i.value.open()},a=(d,c)=>{t("update:value",d),t("change",d,c)},l=()=>{t("update:value",""),t("change","")};return(d,c)=>{const p=On,f=Xt;return w(),R("div",TA,[o.value?(w(),R("div",$A,[u("div",RA,H(r.value?r.value.name:o.title),1),u("div",PA,H(r.value?r.value.description:o.description),1),m(p,{class:"del-btn",name:"close-circle",onClick:l})])):(w(),Q(f,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:s},{default:x(()=>[m(K(Mt)),c[0]||(c[0]=U(" 选择数据表",-1))]),_:1})),m(MA,{ref_key:"tableSelectAlertRef",ref:i,onOk:a,options:n.options},null,8,["options"])])}}},ju=Ne(LA,[["__scopeId","data-v-618f643f"]]),BA={class:"add-data-form"},IA={class:"node-box-content"},jA={class:"setting-box"},FA={class:"setting-box"},VA={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=ur();let r={};const s=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),a=(h,v)=>{v?(s.formData.form_name=v.name,s.formData.form_description=v.description,f(v.id)):(s.formData.form_name="",s.formData.form_description="",s.formData.datas=[]),c()},l=h=>{s.formData.datas=h,c()},d=()=>{let h=o.node.dataRaw||o.node.node_params||"{}";r=JSON.parse(h),s.formData=r.form_insert,c()},c=()=>{r.form_insert=Xn(s.formData),t("update-node",{...o.node,node_params:JSON.stringify(r)})},p=async()=>{const h=await i.getFormList();s.tableList=h},f=async h=>{i.getFormFieldList({form_id:h}).then(v=>{v.forEach(y=>{y.id=y.id*1}),s.formData.datas=v,c()}).catch(()=>{})};return at(()=>{p(),d()}),(h,v)=>(w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...v[1]||(v[1]=[u("span",null,[U("在指定数据表中插入数据，可以在数据库中维护数据表 "),u("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",BA,[u("div",IA,[v[2]||(v[2]=u("div",{class:"node-box-title"},[u("img",{class:"input-icon",src:Yn,alt:""}),u("span",{class:"text"},"输入")],-1)),v[3]||(v[3]=u("div",{class:"setting-label"},[u("span",null,"数据表")],-1)),u("div",jA,[m(ju,{options:s.tableList,title:s.formData.form_name,description:s.formData.form_description,value:s.formData.form_id,"onUpdate:value":v[0]||(v[0]=y=>s.formData.form_id=y),onChange:a},null,8,["options","title","description","value"])]),v[4]||(v[4]=u("div",{class:"setting-label"},[u("span",null,"插入数据"),u("span",{class:"tip"},"（不填写字段值则为空）")],-1)),u("div",FA,[m(Zc,{"form-id":s.formData.form_id,showEmptyFieldRow:s.formData.form_id=="",list:s.formData.datas,showAdd:!1,showDelete:!1,onChange:l},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},HA=Ne(VA,[["__scopeId","data-v-9c25c5a9"]]),UA={class:"library-checkbox-box"},zA={class:"list-group-box"},qA={class:"group-list-box"},GA={style:{"margin-bottom":"16px"}},XA={class:"classify-box"},WA=["onClick"],YA={class:"classify-title"},JA={class:"right-content"},KA={class:"list-item-box"},ZA={class:"alert-box"},QA={class:"btn-box"},eD=["onClick"],tD={class:"avatar-box"},nD=["src"],oD={class:"info-content-box"},iD={class:"title-info-block"},rD={key:0,class:"type-tag"},sD={key:1,class:"type-tag"},aD={key:2,class:"type-tag"},lD={key:3,class:"type-tag"},uD={class:"desc-info-block"},dD={class:"check-block"},cD={class:"footer-box"},pD={__name:"library-select-alert",props:{showWxType:{type:Boolean,default:!1},select_type:{type:String,default:"checkbox"}},emits:["change"],setup(n,{expose:e,emit:t}){const o=Vn(),{robotInfo:i}=o,r=t,s=n,a=Je({indeterminate:!1,checkAll:!1,checkedList:[]}),l=X(""),d=X([]),c=()=>{Um().then($=>{let B=$.data||[],O=0;B.forEach(P=>{O+=+P.total}),d.value=[{group_name:"全部",total:O,id:""},...B]})},p=$=>{l.value=$.id,T()},f=X(!1),h=$=>{l.value="",T(),c(),a.checkedList=$,f.value=!0},v=()=>{f.value=!1,C()},y=X(""),g=()=>{T()},_=X([]),b=We(()=>s.showWxType?_.value:_.value.filter($=>$.type!=3)),C=()=>{r("change",[...a.checkedList])},T=async()=>{S.value=!0;const $=await Ha({library_name:y.value,type:"",show_open_docs:1});if(S.value=!1,$){let B=$.data||[];l.value!=""&&(B=B.filter(O=>O.group_id==l.value)),_.value=B}},M=$=>{let B=$.id;a.checkedList.includes(B)?a.checkedList=a.checkedList.filter(O=>O!=B):s.select_type=="radio"&&a.checkedList.length>0?a.checkedList=[B]:a.checkedList.push(B)},S=X(!1),k=async()=>{S.value=!0,await T(),S.value=!1,mt.success("刷新完成")},A=()=>{window.open("/#/library/list")};return e({open:h}),($,B)=>{const O=en,P=cC,E=sr,D=Xt,N=s_,F=ho,Y=_n;return w(),Q(Y,{width:916,open:f.value,"onUpdate:open":B[2]||(B[2]=L=>f.value=L),wrapClassName:"correlation-library-modal",title:null,footer:null},{default:x(()=>[u("div",UA,[u("div",zA,[u("div",qA,[B[3]||(B[3]=u("div",{class:"main-title-block"},"关联知识库",-1)),u("div",GA,[m(O,{style:{width:"216px"},value:y.value,"onUpdate:value":B[0]||(B[0]=L=>y.value=L),placeholder:"请输入知识库名称搜索",onChange:g},{suffix:x(()=>[m(K(r_),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),m(P,{style:{"padding-right":"16px",height:"480px"}},{default:x(()=>[u("div",XA,[(w(!0),R(se,null,ge(d.value,L=>(w(),R("div",{class:xt(["classify-item",{active:L.id==l.value}]),onClick:j=>p(L),key:L.id},[u("div",YA,H(L.group_name),1),u("div",JA,[u("div",{class:xt(["num",{"num-block":L.id<=0}])},H(L.total),3)])],10,WA))),128))])]),_:1})]),u("div",KA,[u("div",ZA,[m(E,{class:"zm-alert-info",message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"})]),u("div",QA,[m(D,{onClick:k},{default:x(()=>[m(K(uy)),B[4]||(B[4]=U(" 刷新 ",-1))]),_:1}),m(D,{type:"primary",ghost:"",onClick:A},{default:x(()=>[...B[5]||(B[5]=[U("新建知识库",-1)])]),_:1})]),m(F,{spinning:S.value,delay:100},{default:x(()=>[m(P,{style:{padding:"0 16px",height:"414px"}},{default:x(()=>[(w(!0),R(se,null,ge(b.value,L=>(w(),R("div",{class:"library-list-item",onClick:j=>M(L),key:L.id},[u("div",tD,[u("img",{src:L.avatar,alt:""},null,8,nD)]),u("div",oD,[u("div",iD,[U(H(L.library_name)+" ",1),u("span",{class:xt(["type-tag",{"gray-tag":L.graph_switch==0}])},"Graph",2),L.type==0?(w(),R("span",rD,"普通知识库")):ne("",!0),L.type==1?(w(),R("span",sD,"对外知识库")):ne("",!0),L.type==2?(w(),R("span",aD,"问答知识库")):ne("",!0),L.type==3?(w(),R("span",lD,"公众号知识库")):ne("",!0)]),u("div",uD,H(L.library_intro),1)]),u("div",dD,[m(N,{checked:a.checkedList.includes(L.id)},null,8,["checked"])])],8,eD))),128))]),_:1})]),_:1},8,["spinning"]),u("div",cD,[m(D,{onClick:B[1]||(B[1]=L=>f.value=!1)},{default:x(()=>[...B[6]||(B[6]=[U("取消",-1)])]),_:1}),m(D,{type:"primary",onClick:v},{default:x(()=>[U(" ("+H(a.checkedList.length)+") 确定",1)]),_:1})])])])])]),_:1},8,["open"])}}},S_=Ne(pD,[["__scopeId","data-v-fa77edc8"]]),fD={class:"recall-settings-box"},hD={class:"form-box"},vD={class:"form-item is-required"},_D={class:"form-item-body"},gD={class:"retrieval-mode-items"},mD=["onClick"],yD={class:"retrieval-mode-title"},bD={class:"title-text"},xD={class:"retrieval-mode-desc"},wD={key:0,class:"form-item"},CD={class:"form-item"},kD={class:"form-item-label"},SD={class:"form-item-body"},ED={class:"number-box"},AD={class:"number-slider-box"},DD={class:"number-input-box"},OD={class:"form-item"},ND={class:"form-item-label"},MD={class:"form-item-body"},TD={class:"number-box"},$D={class:"number-slider-box"},RD={class:"number-input-box"},PD={class:"form-item"},LD={class:"form-item-label"},BD={class:"form-item-body"},ID={class:"segment-controls"},jD={class:"segment-input"},FD={class:"segment-input"},VD={class:"form-item"},HD={class:"form-item-label"},UD={class:"form-item-body"},zD={class:"form-item"},qD={class:"form-item-label"},GD={key:0,class:"form-item-body"},XD={__name:"recall-settings-alert",emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=X([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),r=Je({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),s=X(!1),a=X([]);X([]),X({});const l=h=>{r.rerank_status=h.rerank_status||0,r.rerank_use_model=h.rerank_use_model||void 0,r.rerank_model_config_id=h.rerank_model_config_id||"",r.top_k=h.top_k,r.similarity=h.similarity,r.search_type=h.search_type,r.meta_search_switch=Number(h.meta_search_switch),r.meta_search_type=Number(h.meta_search_type),r.meta_search_condition_list=h.meta_search_condition_list,r.rrf_weight=h.rrf_weight,r.recall_neighbor_switch=h.recall_neighbor_switch,r.recall_neighbor_before_num=h.recall_neighbor_before_num,r.recall_neighbor_after_num=h.recall_neighbor_after_num,s.value=!0},d=h=>{r.search_type=h},c=()=>r.rerank_status==1&&!r.rerank_model_config_id,p=()=>{if(c())return mt.error("请选择Rerank模型");s.value=!1,f()},f=()=>{o("change",Xn(r))};return e({open:l}),(h,v)=>{const y=On,g=Zt,_=$s,b=Mn,C=Fi,T=Lt,M=$t,S=_n;return w(),Q(S,{width:"600px",open:s.value,"onUpdate:open":v[14]||(v[14]=k=>s.value=k),title:"召回设置",onOk:p,okText:"确定",cancelText:"取消"},{default:x(()=>[u("div",fD,[u("div",hD,[u("div",vD,[v[15]||(v[15]=u("div",{class:"form-item-label"},[u("span",null,"检索模式")],-1)),u("div",_D,[u("div",gD,[(w(!0),R(se,null,ge(i.value,k=>(w(),R("div",{class:xt(["retrieval-mode-item",{active:r.search_type==k.value}]),key:k.value,onClick:A=>d(k.value)},[r.search_type==k.value?(w(),Q(y,{key:0,class:"check-arrow",name:"check-arrow-filled"})):ne("",!0),u("div",yD,[m(y,{name:k.iconName,class:"title-icon"},null,8,["name"]),u("span",bD,H(k.title),1),k.isRecommendation?(w(),Q(y,{key:0,class:"recommendation-icon",name:"recommendation"})):ne("",!0)]),u("div",xD,H(k.desc),1)],10,mD))),128))])])]),r.search_type==1?(w(),R("div",wD,[m(pC,{rrf_weight:r.rrf_weight,"onUpdate:rrf_weight":v[0]||(v[0]=k=>r.rrf_weight=k)},null,8,["rrf_weight"])])):ne("",!0),u("div",CD,[u("div",kD,[v[17]||(v[17]=u("span",null,"Top K ",-1)),m(g,null,{title:x(()=>[...v[16]||(v[16]=[U("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),u("div",SD,[u("div",ED,[u("div",AD,[m(_,{class:"custom-slider",value:r.top_k,"onUpdate:value":v[1]||(v[1]=k=>r.top_k=k),min:1,max:500},null,8,["value"])]),u("div",DD,[m(b,{value:r.top_k,"onUpdate:value":v[2]||(v[2]=k=>r.top_k=k),min:1,max:500},null,8,["value"])])])])]),u("div",OD,[u("div",ND,[v[19]||(v[19]=u("span",null,"相似度阈值 ",-1)),m(g,null,{title:x(()=>[...v[18]||(v[18]=[U("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),u("div",MD,[u("div",TD,[u("div",$D,[m(_,{class:"custom-slider",value:r.similarity,"onUpdate:value":v[3]||(v[3]=k=>r.similarity=k),min:0,max:1,step:.01},null,8,["value"])]),u("div",RD,[m(b,{value:r.similarity,"onUpdate:value":v[4]||(v[4]=k=>r.similarity=k),min:0,max:1,step:.01},null,8,["value"])])])])]),u("div",PD,[u("div",LD,[v[21]||(v[21]=u("span",{class:"setting-title"},"召回相邻分段 ",-1)),m(g,{overlayStyle:{maxWidth:"350px"}},{title:x(()=>[...v[20]||(v[20]=[u("div",{style:{"font-size":"13px"}},[u("p",null,"当在知识库检索到相关分段时，会根据配置拼接相关联的上下文。作为最终内容返回给大模型。"),u("p",null,"开启后，注意分段时不要设置分段重叠长度，否则可能影响最终效果。"),u("p",null,"父子分段类型的知识库，或者分段字数超过3000字时，不会做任何处理。")],-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1}),v[22]||(v[22]=U("   ",-1)),m(C,{checked:r.recall_neighbor_switch,"onUpdate:checked":v[5]||(v[5]=k=>r.recall_neighbor_switch=k)},null,8,["checked"])]),u("div",BD,[u("div",ID,[u("div",jD,[v[23]||(v[23]=u("span",null,"拼接分段前",-1)),v[24]||(v[24]=U("  ",-1)),m(M,{value:r.recall_neighbor_before_num,"onUpdate:value":v[6]||(v[6]=k=>r.recall_neighbor_before_num=k),style:{width:"80px"}},{default:x(()=>[(w(),R(se,null,ge(6,k=>m(T,{value:k-1,key:k},{default:x(()=>[U(H(k-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),u("div",FD,[v[25]||(v[25]=u("span",null,"后",-1)),v[26]||(v[26]=U("  ",-1)),m(M,{value:r.recall_neighbor_after_num,"onUpdate:value":v[7]||(v[7]=k=>r.recall_neighbor_after_num=k),style:{width:"80px"}},{default:x(()=>[(w(),R(se,null,ge(6,k=>m(T,{value:k-1,key:k},{default:x(()=>[U(H(k-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),v[27]||(v[27]=u("div",{class:"segment-text"},"个分段内容",-1))])])]),u("div",VD,[u("div",HD,[v[28]||(v[28]=u("span",null,"Rerank模型",-1)),v[29]||(v[29]=U("   ",-1)),m(C,{checkedValue:1,unCheckedValue:0,checked:r.rerank_status,"onUpdate:checked":v[8]||(v[8]=k=>r.rerank_status=k)},null,8,["checked"])]),u("div",UD,[m(lr,{modelType:"RERANK",modeName:r.rerank_use_model,"onUpdate:modeName":v[9]||(v[9]=k=>r.rerank_use_model=k),modeId:r.rerank_model_config_id,"onUpdate:modeId":v[10]||(v[10]=k=>r.rerank_model_config_id=k),style:{width:"320px"}},null,8,["modeName","modeId"])])]),u("div",zD,[u("div",qD,[m(g,{title:"元数据过滤是使用元数据属性（例如分组，知识创建时间等）来细化和控制系統内相关信息的检索过程。召回时仅会召回满足要求的知识。"},{default:x(()=>[u("span",null,[v[30]||(v[30]=U("元数据过滤 ",-1)),m(K(ft))])]),_:1}),v[31]||(v[31]=U("   ",-1)),m(C,{checkedValue:1,unCheckedValue:0,checked:r.meta_search_switch,"onUpdate:checked":v[11]||(v[11]=k=>r.meta_search_switch=k)},null,8,["checked"])]),r.meta_search_switch==1?(w(),R("div",GD,[m(Py,{rule:r.meta_search_condition_list,"onUpdate:rule":v[12]||(v[12]=k=>r.meta_search_condition_list=k),type:r.meta_search_type,"onUpdate:type":v[13]||(v[13]=k=>r.meta_search_type=k),ref:"metaFilterRef",class:"meta-box","meta-data":a.value},null,8,["rule","type","meta-data"])])):ne("",!0)])])])]),_:1},8,["open"])}}},WD=Ne(XD,[["__scopeId","data-v-938dbf7a"]]),YD={class:"problem-optimization-form"},JD={class:"node-form-content"},KD={class:"gray-block"},ZD={class:"avatar-box"},QD=["src"],eO={class:"content-box"},tO={class:"list-name"},nO={class:"list-intro"},oO=["onClick"],iO={class:"btn-block"},rO={class:"diy-form-item"},sO={class:"form-content"},aO={class:"form-content"},lO={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=Vn(),o=We(()=>t.robotInfo.rrf_weight?JSON.parse(t.robotInfo.rrf_weight):{vector:0,search:0,graph:0}),i=e,r=n,s=X([]);function a(){const O=r.lf.getNodeModelById(r.nodeId);if(O){let P=O.getAllParentVariable();s.value=l(P)}}function l(O){return O.forEach(P=>{P.typ=="node"?P.node_type==1?P.value="global":P.value=P.node_id:P.value=P.key,P.children&&P.children.length>0&&(P.children=l(P.children))}),O}function d(O){if(O){let P=O.split("."),E=P[0],D=P.filter((N,F)=>F>0).join(".");return[E,D]}return["global","question"]}const c=X(),p=X(null),f=Je({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",question_value:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),h=()=>{const O=JSON.stringify({libs:{...f,rerank_model_config_id:f.rerank_model_config_id?+f.rerank_model_config_id:void 0,question_value:f.question_value.join("."),library_ids:f.library_ids.join(","),rrf_weight:JSON.stringify(f.rrf_weight),recall_neighbor_switch:f.recall_neighbor_switch,recall_neighbor_before_num:f.recall_neighbor_before_num,recall_neighbor_after_num:f.recall_neighbor_before_num}});i("update-node",{...r.node,node_params:O})},v=()=>{try{let O=r.node.dataRaw||r.node.node_params||"{}",P=JSON.parse(O).libs||{};a(),P=JSON.parse(JSON.stringify(P));for(let E in P)E=="library_ids"?f[E]=P[E]?P[E].split(","):[]:E=="question_value"?f.question_value=d(P.question_value):E=="rrf_weight"?f.rrf_weight=P[E]?JSON.parse(P[E]):P[E]:f[E]=P[E];(!f.rrf_weight||Object.keys(f.rrf_weight).length==0)&&(f.rrf_weight=o.value),m_({ability_type:"library_ability_official_account"}).then(E=>{var N;let D=(E==null?void 0:E.data)||{};((N=D==null?void 0:D.user_config)==null?void 0:N.switch_status)==1&&(p.value=D)})}catch(O){}},y=X([]),g=X(null),_=We(()=>y.value.filter(O=>p.value?f.library_ids.includes(O.id):f.library_ids.includes(O.id)&&O.type!=3)),b=O=>{let P=f.library_ids.indexOf(O.id);f.library_ids.splice(P,1)},C=O=>{A(),f.library_ids=[...O]},T=()=>{g.value.open([...f.library_ids])},M=X(null),S=()=>{M.value.open(Xn(f),null,f.library_ids)},k=O=>{f.rerank_status=O.rerank_status,f.rerank_use_model=O.rerank_use_model,f.rerank_model_config_id=O.rerank_model_config_id,f.top_k=O.top_k,f.similarity=O.similarity,f.search_type=O.search_type,f.meta_search_switch=Number(O.meta_search_switch),f.meta_search_type=Number(O.meta_search_type),f.meta_search_condition_list=O.meta_search_condition_list,f.rrf_weight=O.rrf_weight,f.recall_neighbor_switch=O.recall_neighbor_switch,f.recall_neighbor_before_num=O.recall_neighbor_before_num,f.recall_neighbor_after_num=O.recall_neighbor_after_num},A=async()=>{const O=await Ha({type:""});O&&(y.value=O.data||[])};ct(()=>f,()=>{h()},{deep:!0});const $=O=>{O||a()},B=()=>{i("close")};return at(()=>{v(),A()}),(O,P)=>{const E=Xt,D=Cn,N=li,F=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:B},null,8,["title","iconName"])]),default:x(()=>[u("div",YD,[u("div",JD,[m(F,{ref_key:"formRef",ref:c,layout:"vertical",model:f},{default:x(()=>[u("div",KD,[P[4]||(P[4]=u("div",{class:"gray-block-title"},"输入",-1)),m(D,{label:"关联知识库"},{default:x(()=>[(w(!0),R(se,null,ge(_.value,Y=>(w(),R("div",{class:"konwledge-list-item",key:Y.id},[u("div",ZD,[u("img",{src:Y.avatar,alt:""},null,8,QD)]),u("div",eO,[u("div",tO,H(Y.library_name),1),u("div",nO,H(Y.library_intro),1)]),u("div",{class:"btn-hover-wrap",onClick:L=>b(Y)},[m(K(Ut))],8,oO)]))),128)),u("div",iO,[u("div",null,[m(E,{onClick:T,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...P[1]||(P[1]=[U("添加知识库",-1)])]),_:1},8,["icon"])]),u("div",null,[m(E,{onClick:S,icon:St(K(Gc)),block:"",type:"dashed"},{default:x(()=>[...P[2]||(P[2]=[U("召回设置",-1)])]),_:1},8,["icon"])])])]),_:1}),u("div",rO,[P[3]||(P[3]=u("div",{class:"form-label"},"用户问题",-1)),u("div",sO,[u("div",aO,[m(N,{value:f.question_value,"onUpdate:value":P[0]||(P[0]=Y=>f.question_value=Y),onDropdownVisibleChange:$,style:{width:"220px"},options:s.value,allowClear:!1,displayRender:({labels:Y})=>Y.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),P[5]||(P[5]=u("div",{class:"gray-block mt16"},[u("div",{class:"gray-block-title"},"输出"),u("div",{class:"options-item"},[u("div",{class:"option-label"},"知识库引用"),u("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"]),m(S_,{ref_key:"librarySelectAlertRef",ref:g,showWxType:!!p.value,onClose:A,onChange:C},null,8,["showWxType"]),m(WD,{ref_key:"recallSettingsAlertRef",ref:M,onChange:k},null,512)])])]),_:1})}}},uO=Ne(lO,[["__scopeId","data-v-3f675bf2"]]),dO={class:"sub-field-item"},cO=["onClick"],pO=["onClick"],fO={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=We(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=We(()=>e.level==2?"180px":"146px"),i=(l,d)=>{d[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,d)=>{d.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,d)=>{const c=en,p=Lt,f=$t,h=Pt("SubsKey",!0);return w(!0),R(se,null,ge(e.data,(v,y)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[u("div",dO,[d[0]||(d[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(c,{class:"mr12",style:Fn({width:o.value}),value:v.key,"onUpdate:value":g=>v.key=g,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(f,{class:"mr12",onChange:g=>s(v),value:v.typ,"onUpdate:value":g=>v.typ=g,placeholder:"请选择",style:Fn({width:o.value})},{default:x(()=>[(w(!0),R(se,null,ge(t.value,g=>(w(),Q(p,{value:g.value},{default:x(()=>[U(H(g.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:g=>i(y,e.data)},[m(K(Bn))],8,cO)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:g=>r(y,e.data)},[m(K(Ut))],8,pO)]),v.subs&&v.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ne("",!0)],2))),128)}}},hO=Ne(fO,[["__scopeId","data-v-01969e8c"]]);var Fp={exports:{}},Vp;function vO(){return Vp||(Vp=1,(function(n,e){(function(t){t(y_())})(function(t){t.defineMode("javascript",function(o,i){var r=o.indentUnit,s=i.statementIndent,a=i.jsonld,l=i.json||a,d=i.trackScope!==!1,c=i.typescript,p=i.wordCharacters||/[\w$\xa1-\uffff]/,f=(function(){function I(vt){return{type:vt,style:"keyword"}}var Z=I("keyword a"),ye=I("keyword b"),Me=I("keyword c"),st=I("keyword d"),He=I("operator"),nt={type:"atom",style:"atom"};return{if:I("if"),while:Z,with:Z,else:ye,do:ye,try:ye,finally:ye,return:st,break:st,continue:st,new:I("new"),delete:Me,void:Me,throw:Me,debugger:I("debugger"),var:I("var"),const:I("var"),let:I("var"),function:I("function"),catch:I("catch"),for:I("for"),switch:I("switch"),case:I("case"),default:I("default"),in:He,typeof:He,instanceof:He,true:nt,false:nt,null:nt,undefined:nt,NaN:nt,Infinity:nt,this:I("this"),class:I("class"),super:I("atom"),yield:Me,export:I("export"),import:I("import"),extends:Me,await:Me}})(),h=/[+\-*&%=<>!?|~^@]/,v=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function y(I){for(var Z=!1,ye,Me=!1;(ye=I.next())!=null;){if(!Z){if(ye=="/"&&!Me)return;ye=="["?Me=!0:Me&&ye=="]"&&(Me=!1)}Z=!Z&&ye=="\\"}}var g,_;function b(I,Z,ye){return g=I,_=ye,Z}function C(I,Z){var ye=I.next();if(ye=='"'||ye=="'")return Z.tokenize=T(ye),Z.tokenize(I,Z);if(ye=="."&&I.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return b("number","number");if(ye=="."&&I.match(".."))return b("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(ye))return b(ye);if(ye=="="&&I.eat(">"))return b("=>","operator");if(ye=="0"&&I.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return b("number","number");if(/\d/.test(ye))return I.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),b("number","number");if(ye=="/")return I.eat("*")?(Z.tokenize=M,M(I,Z)):I.eat("/")?(I.skipToEnd(),b("comment","comment")):te(I,Z,1)?(y(I),I.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),b("regexp","string-2")):(I.eat("="),b("operator","operator",I.current()));if(ye=="`")return Z.tokenize=S,S(I,Z);if(ye=="#"&&I.peek()=="!")return I.skipToEnd(),b("meta","meta");if(ye=="#"&&I.eatWhile(p))return b("variable","property");if(ye=="<"&&I.match("!--")||ye=="-"&&I.match("->")&&!/\S/.test(I.string.slice(0,I.start)))return I.skipToEnd(),b("comment","comment");if(h.test(ye))return(ye!=">"||!Z.lexical||Z.lexical.type!=">")&&(I.eat("=")?(ye=="!"||ye=="=")&&I.eat("="):/[<>*+\-|&?]/.test(ye)&&(I.eat(ye),ye==">"&&I.eat(ye))),ye=="?"&&I.eat(".")?b("."):b("operator","operator",I.current());if(p.test(ye)){I.eatWhile(p);var Me=I.current();if(Z.lastType!="."){if(f.propertyIsEnumerable(Me)){var st=f[Me];return b(st.type,st.style,Me)}if(Me=="async"&&I.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return b("async","keyword",Me)}return b("variable","variable",Me)}}function T(I){return function(Z,ye){var Me=!1,st;if(a&&Z.peek()=="@"&&Z.match(v))return ye.tokenize=C,b("jsonld-keyword","meta");for(;(st=Z.next())!=null&&!(st==I&&!Me);)Me=!Me&&st=="\\";return Me||(ye.tokenize=C),b("string","string")}}function M(I,Z){for(var ye=!1,Me;Me=I.next();){if(Me=="/"&&ye){Z.tokenize=C;break}ye=Me=="*"}return b("comment","comment")}function S(I,Z){for(var ye=!1,Me;(Me=I.next())!=null;){if(!ye&&(Me=="`"||Me=="$"&&I.eat("{"))){Z.tokenize=C;break}ye=!ye&&Me=="\\"}return b("quasi","string-2",I.current())}var k="([{}])";function A(I,Z){Z.fatArrowAt&&(Z.fatArrowAt=null);var ye=I.string.indexOf("=>",I.start);if(!(ye<0)){if(c){var Me=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(I.string.slice(I.start,ye));Me&&(ye=Me.index)}for(var st=0,He=!1,nt=ye-1;nt>=0;--nt){var vt=I.string.charAt(nt),Nt=k.indexOf(vt);if(Nt>=0&&Nt<3){if(!st){++nt;break}if(--st==0){vt=="("&&(He=!0);break}}else if(Nt>=3&&Nt<6)++st;else if(p.test(vt))He=!0;else if(/["'\/`]/.test(vt))for(;;--nt){if(nt==0)return;var Hn=I.string.charAt(nt-1);if(Hn==vt&&I.string.charAt(nt-2)!="\\"){nt--;break}}else if(He&&!st){++nt;break}}He&&!st&&(Z.fatArrowAt=nt)}}var $={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function B(I,Z,ye,Me,st,He){this.indented=I,this.column=Z,this.type=ye,this.prev=st,this.info=He,Me!=null&&(this.align=Me)}function O(I,Z){if(!d)return!1;for(var ye=I.localVars;ye;ye=ye.next)if(ye.name==Z)return!0;for(var Me=I.context;Me;Me=Me.prev)for(var ye=Me.vars;ye;ye=ye.next)if(ye.name==Z)return!0}function P(I,Z,ye,Me,st){var He=I.cc;for(E.state=I,E.stream=st,E.marked=null,E.cc=He,E.style=Z,I.lexical.hasOwnProperty("align")||(I.lexical.align=!0);;){var nt=He.length?He.pop():l?me:xe;if(nt(ye,Me)){for(;He.length&&He[He.length-1].lex;)He.pop()();return E.marked?E.marked:ye=="variable"&&O(I,Me)?"variable-2":Z}}}var E={state:null,marked:null,cc:null};function D(){for(var I=arguments.length-1;I>=0;I--)E.cc.push(arguments[I])}function N(){return D.apply(null,arguments),!0}function F(I,Z){for(var ye=Z;ye;ye=ye.next)if(ye.name==I)return!0;return!1}function Y(I){var Z=E.state;if(E.marked="def",!!d){if(Z.context){if(Z.lexical.info=="var"&&Z.context&&Z.context.block){var ye=L(I,Z.context);if(ye!=null){Z.context=ye;return}}else if(!F(I,Z.localVars)){Z.localVars=new z(I,Z.localVars);return}}i.globalVars&&!F(I,Z.globalVars)&&(Z.globalVars=new z(I,Z.globalVars))}}function L(I,Z){if(Z)if(Z.block){var ye=L(I,Z.prev);return ye?ye==Z.prev?Z:new le(ye,Z.vars,!0):null}else return F(I,Z.vars)?Z:new le(Z.prev,new z(I,Z.vars),!1);else return null}function j(I){return I=="public"||I=="private"||I=="protected"||I=="abstract"||I=="readonly"}function le(I,Z,ye){this.prev=I,this.vars=Z,this.block=ye}function z(I,Z){this.name=I,this.next=Z}var V=new z("this",new z("arguments",null));function J(){E.state.context=new le(E.state.context,E.state.localVars,!1),E.state.localVars=V}function oe(){E.state.context=new le(E.state.context,E.state.localVars,!0),E.state.localVars=null}J.lex=oe.lex=!0;function W(){E.state.localVars=E.state.context.vars,E.state.context=E.state.context.prev}W.lex=!0;function q(I,Z){var ye=function(){var Me=E.state,st=Me.indented;if(Me.lexical.type=="stat")st=Me.lexical.indented;else for(var He=Me.lexical;He&&He.type==")"&&He.align;He=He.prev)st=He.indented;Me.lexical=new B(st,E.stream.column(),I,null,Me.lexical,Z)};return ye.lex=!0,ye}function re(){var I=E.state;I.lexical.prev&&(I.lexical.type==")"&&(I.indented=I.lexical.indented),I.lexical=I.lexical.prev)}re.lex=!0;function ue(I){function Z(ye){return ye==I?N():I==";"||ye=="}"||ye==")"||ye=="]"?D():N(Z)}return Z}function xe(I,Z){return I=="var"?N(q("vardef",Z),Be,ue(";"),re):I=="keyword a"?N(q("form"),Ge,xe,re):I=="keyword b"?N(q("form"),xe,re):I=="keyword d"?E.stream.match(/^\s*$/,!1)?N():N(q("stat"),_e,ue(";"),re):I=="debugger"?N(ue(";")):I=="{"?N(q("}"),oe,ve,re,W):I==";"?N():I=="if"?(E.state.lexical.info=="else"&&E.state.cc[E.state.cc.length-1]==re&&E.state.cc.pop()(),N(q("form"),Ge,xe,re,un)):I=="function"?N(Tn):I=="for"?N(q("form"),oe,kn,xe,W,re):I=="class"||c&&Z=="interface"?(E.marked="keyword",N(q("form",I=="class"?I:Z),Ti,re)):I=="variable"?c&&Z=="declare"?(E.marked="keyword",N(xe)):c&&(Z=="module"||Z=="enum"||Z=="type")&&E.stream.match(/^\s*\w/,!1)?(E.marked="keyword",Z=="enum"?N(Ot):Z=="type"?N(Mi,ue("operator"),Xe,ue(";")):N(q("form"),Qe,ue("{"),q("}"),ve,re,re)):c&&Z=="namespace"?(E.marked="keyword",N(q("form"),me,xe,re)):c&&Z=="abstract"?(E.marked="keyword",N(xe)):N(q("stat"),je):I=="switch"?N(q("form"),Ge,ue("{"),q("}","switch"),oe,ve,re,re,W):I=="case"?N(me,ue(":")):I=="default"?N(ue(":")):I=="catch"?N(q("form"),J,Te,xe,re,W):I=="export"?N(q("stat"),$i,re):I=="import"?N(q("stat"),vr,re):I=="async"?N(xe):Z=="@"?N(me,xe):D(q("stat"),me,ue(";"),re)}function Te(I){if(I=="(")return N(Et,ue(")"))}function me(I,Z){return Le(I,Z,!1)}function pe(I,Z){return Le(I,Z,!0)}function Ge(I){return I!="("?D():N(q(")"),_e,ue(")"),re)}function Le(I,Z,ye){if(E.state.fatArrowAt==E.stream.start){var Me=ye?ae:ie;if(I=="(")return N(J,q(")"),dt(Et,")"),re,ue("=>"),Me,W);if(I=="variable")return D(J,Qe,ue("=>"),Me,W)}var st=ye?be:he;return $.hasOwnProperty(I)?N(st):I=="function"?N(Tn,st):I=="class"||c&&Z=="interface"?(E.marked="keyword",N(q("form"),zi,re)):I=="keyword c"||I=="async"?N(ye?pe:me):I=="("?N(q(")"),_e,ue(")"),re,st):I=="operator"||I=="spread"?N(ye?pe:me):I=="["?N(q("]"),pt,re,st):I=="{"?ce(ot,"}",null,st):I=="quasi"?D(De,st):I=="new"?N(Ae(ye)):N()}function _e(I){return I.match(/[;\}\)\],]/)?D():D(me)}function he(I,Z){return I==","?N(_e):be(I,Z,!1)}function be(I,Z,ye){var Me=ye==!1?he:be,st=ye==!1?me:pe;if(I=="=>")return N(J,ye?ae:ie,W);if(I=="operator")return/\+\+|--/.test(Z)||c&&Z=="!"?N(Me):c&&Z=="<"&&E.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?N(q(">"),dt(Xe,">"),re,Me):Z=="?"?N(me,ue(":"),st):N(st);if(I=="quasi")return D(De,Me);if(I!=";"){if(I=="(")return ce(pe,")","call",Me);if(I==".")return N(Ue,Me);if(I=="[")return N(q("]"),_e,ue("]"),re,Me);if(c&&Z=="as")return E.marked="keyword",N(Xe,Me);if(I=="regexp")return E.state.lastType=E.marked="operator",E.stream.backUp(E.stream.pos-E.stream.start-1),N(st)}}function De(I,Z){return I!="quasi"?D():Z.slice(Z.length-2)!="${"?N(De):N(_e,G)}function G(I){if(I=="}")return E.marked="string-2",E.state.tokenize=S,N(De)}function ie(I){return A(E.stream,E.state),D(I=="{"?xe:me)}function ae(I){return A(E.stream,E.state),D(I=="{"?xe:pe)}function Ae(I){return function(Z){return Z=="."?N(I?Ie:fe):Z=="variable"&&c?N(Ee,I?be:he):D(I?pe:me)}}function fe(I,Z){if(Z=="target")return E.marked="keyword",N(he)}function Ie(I,Z){if(Z=="target")return E.marked="keyword",N(be)}function je(I){return I==":"?N(re,xe):D(he,ue(";"),re)}function Ue(I){if(I=="variable")return E.marked="property",N()}function ot(I,Z){if(I=="async")return E.marked="property",N(ot);if(I=="variable"||E.style=="keyword"){if(E.marked="property",Z=="get"||Z=="set")return N(it);var ye;return c&&E.state.fatArrowAt==E.stream.start&&(ye=E.stream.match(/^\s*:\s*/,!1))&&(E.state.fatArrowAt=E.stream.pos+ye[0].length),N(Ke)}else{if(I=="number"||I=="string")return E.marked=a?"property":E.style+" property",N(Ke);if(I=="jsonld-keyword")return N(Ke);if(c&&j(Z))return E.marked="keyword",N(ot);if(I=="[")return N(me,Ce,ue("]"),Ke);if(I=="spread")return N(pe,Ke);if(Z=="*")return E.marked="keyword",N(ot);if(I==":")return D(Ke)}}function it(I){return I!="variable"?D(Ke):(E.marked="property",N(Tn))}function Ke(I){if(I==":")return N(pe);if(I=="(")return D(Tn)}function dt(I,Z,ye){function Me(st,He){if(ye?ye.indexOf(st)>-1:st==","){var nt=E.state.lexical;return nt.info=="call"&&(nt.pos=(nt.pos||0)+1),N(function(vt,Nt){return vt==Z||Nt==Z?D():D(I)},Me)}return st==Z||He==Z?N():ye&&ye.indexOf(";")>-1?D(I):N(ue(Z))}return function(st,He){return st==Z||He==Z?N():D(I,Me)}}function ce(I,Z,ye){for(var Me=3;Me<arguments.length;Me++)E.cc.push(arguments[Me]);return N(q(Z,ye),dt(I,Z),re)}function ve(I){return I=="}"?N():D(xe,ve)}function Ce(I,Z){if(c){if(I==":")return N(Xe);if(Z=="?")return N(Ce)}}function Se(I,Z){if(c&&(I==":"||Z=="in"))return N(Xe)}function Fe(I){if(c&&I==":")return E.stream.match(/^\s*\w+\s+is\b/,!1)?N(me,ze,Xe):N(Xe)}function ze(I,Z){if(Z=="is")return E.marked="keyword",N()}function Xe(I,Z){if(Z=="keyof"||Z=="typeof"||Z=="infer"||Z=="readonly")return E.marked="keyword",N(Z=="typeof"?pe:Xe);if(I=="variable"||Z=="void")return E.marked="type",N(jt);if(Z=="|"||Z=="&")return N(Xe);if(I=="string"||I=="number"||I=="atom")return N(jt);if(I=="[")return N(q("]"),dt(Xe,"]",","),re,jt);if(I=="{")return N(q("}"),wt,re,jt);if(I=="(")return N(dt(yn,")"),lt,jt);if(I=="<")return N(dt(Xe,">"),Xe);if(I=="quasi")return D(zt,jt)}function lt(I){if(I=="=>")return N(Xe)}function wt(I){return I.match(/[\}\)\]]/)?N():I==","||I==";"?N(wt):D(Yt,wt)}function Yt(I,Z){if(I=="variable"||E.style=="keyword")return E.marked="property",N(Yt);if(Z=="?"||I=="number"||I=="string")return N(Yt);if(I==":")return N(Xe);if(I=="[")return N(ue("variable"),Se,ue("]"),Yt);if(I=="(")return D(So,Yt);if(!I.match(/[;\}\)\],]/))return N()}function zt(I,Z){return I!="quasi"?D():Z.slice(Z.length-2)!="${"?N(zt):N(Xe,gn)}function gn(I){if(I=="}")return E.marked="string-2",E.state.tokenize=S,N(zt)}function yn(I,Z){return I=="variable"&&E.stream.match(/^\s*[?:]/,!1)||Z=="?"?N(yn):I==":"?N(Xe):I=="spread"?N(yn):D(Xe)}function jt(I,Z){if(Z=="<")return N(q(">"),dt(Xe,">"),re,jt);if(Z=="|"||I=="."||Z=="&")return N(Xe);if(I=="[")return N(Xe,ue("]"),jt);if(Z=="extends"||Z=="implements")return E.marked="keyword",N(Xe);if(Z=="?")return N(Xe,ue(":"),Xe)}function Ee(I,Z){if(Z=="<")return N(q(">"),dt(Xe,">"),re,jt)}function Ze(){return D(Xe,we)}function we(I,Z){if(Z=="=")return N(Xe)}function Be(I,Z){return Z=="enum"?(E.marked="keyword",N(Ot)):D(Qe,Ce,ut,an)}function Qe(I,Z){if(c&&j(Z))return E.marked="keyword",N(Qe);if(I=="variable")return Y(Z),N();if(I=="spread")return N(Qe);if(I=="[")return ce(ht,"]");if(I=="{")return ce(qe,"}")}function qe(I,Z){return I=="variable"&&!E.stream.match(/^\s*:/,!1)?(Y(Z),N(ut)):(I=="variable"&&(E.marked="property"),I=="spread"?N(Qe):I=="}"?D():I=="["?N(me,ue("]"),ue(":"),qe):N(ue(":"),Qe,ut))}function ht(){return D(Qe,ut)}function ut(I,Z){if(Z=="=")return N(pe)}function an(I){if(I==",")return N(Be)}function un(I,Z){if(I=="keyword b"&&Z=="else")return N(q("form","else"),xe,re)}function kn(I,Z){if(Z=="await")return N(kn);if(I=="(")return N(q(")"),Bt,re)}function Bt(I){return I=="var"?N(Be,Rn):I=="variable"?N(Rn):D(Rn)}function Rn(I,Z){return I==")"?N():I==";"?N(Rn):Z=="in"||Z=="of"?(E.marked="keyword",N(me,Rn)):D(me,Rn)}function Tn(I,Z){if(Z=="*")return E.marked="keyword",N(Tn);if(I=="variable")return Y(Z),N(Tn);if(I=="(")return N(J,q(")"),dt(Et,")"),re,Fe,xe,W);if(c&&Z=="<")return N(q(">"),dt(Ze,">"),re,Tn)}function So(I,Z){if(Z=="*")return E.marked="keyword",N(So);if(I=="variable")return Y(Z),N(So);if(I=="(")return N(J,q(")"),dt(Et,")"),re,Fe,W);if(c&&Z=="<")return N(q(">"),dt(Ze,">"),re,So)}function Mi(I,Z){if(I=="keyword"||I=="variable")return E.marked="type",N(Mi);if(Z=="<")return N(q(">"),dt(Ze,">"),re)}function Et(I,Z){return Z=="@"&&N(me,Et),I=="spread"?N(Et):c&&j(Z)?(E.marked="keyword",N(Et)):c&&I=="this"?N(Ce,ut):D(Qe,Ce,ut)}function zi(I,Z){return I=="variable"?Ti(I,Z):Eo(I,Z)}function Ti(I,Z){if(I=="variable")return Y(Z),N(Eo)}function Eo(I,Z){if(Z=="<")return N(q(">"),dt(Ze,">"),re,Eo);if(Z=="extends"||Z=="implements"||c&&I==",")return Z=="implements"&&(E.marked="keyword"),N(c?Xe:me,Eo);if(I=="{")return N(q("}"),lo,re)}function lo(I,Z){if(I=="async"||I=="variable"&&(Z=="static"||Z=="get"||Z=="set"||c&&j(Z))&&E.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return E.marked="keyword",N(lo);if(I=="variable"||E.style=="keyword")return E.marked="property",N(uo,lo);if(I=="number"||I=="string")return N(uo,lo);if(I=="[")return N(me,Ce,ue("]"),uo,lo);if(Z=="*")return E.marked="keyword",N(lo);if(c&&I=="(")return D(So,lo);if(I==";"||I==",")return N(lo);if(I=="}")return N();if(Z=="@")return N(me,lo)}function uo(I,Z){if(Z=="!"||Z=="?")return N(uo);if(I==":")return N(Xe,ut);if(Z=="=")return N(pe);var ye=E.state.lexical.prev,Me=ye&&ye.info=="interface";return D(Me?So:Tn)}function $i(I,Z){return Z=="*"?(E.marked="keyword",N(Ye,ue(";"))):Z=="default"?(E.marked="keyword",N(me,ue(";"))):I=="{"?N(dt(qi,"}"),Ye,ue(";")):D(xe)}function qi(I,Z){if(Z=="as")return E.marked="keyword",N(ue("variable"));if(I=="variable")return D(pe,qi)}function vr(I){return I=="string"?N():I=="("?D(me):I=="."?D(he):D(qo,ee,Ye)}function qo(I,Z){return I=="{"?ce(qo,"}"):(I=="variable"&&Y(Z),Z=="*"&&(E.marked="keyword"),N(ke))}function ee(I){if(I==",")return N(qo,ee)}function ke(I,Z){if(Z=="as")return E.marked="keyword",N(qo)}function Ye(I,Z){if(Z=="from")return E.marked="keyword",N(me)}function pt(I){return I=="]"?N():D(dt(pe,"]"))}function Ot(){return D(q("form"),Qe,ue("{"),q("}"),dt(Qt,"}"),re,re)}function Qt(){return D(Qe,ut)}function An(I,Z){return I.lastType=="operator"||I.lastType==","||h.test(Z.charAt(0))||/[,.]/.test(Z.charAt(0))}function te(I,Z,ye){return Z.tokenize==C&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(Z.lastType)||Z.lastType=="quasi"&&/\{\s*$/.test(I.string.slice(0,I.pos-(ye||0)))}return{startState:function(I){var Z={tokenize:C,lastType:"sof",cc:[],lexical:new B((I||0)-r,0,"block",!1),localVars:i.localVars,context:i.localVars&&new le(null,null,!1),indented:I||0};return i.globalVars&&typeof i.globalVars=="object"&&(Z.globalVars=i.globalVars),Z},token:function(I,Z){if(I.sol()&&(Z.lexical.hasOwnProperty("align")||(Z.lexical.align=!1),Z.indented=I.indentation(),A(I,Z)),Z.tokenize!=M&&I.eatSpace())return null;var ye=Z.tokenize(I,Z);return g=="comment"?ye:(Z.lastType=g=="operator"&&(_=="++"||_=="--")?"incdec":g,P(Z,ye,g,_,I))},indent:function(I,Z){if(I.tokenize==M||I.tokenize==S)return t.Pass;if(I.tokenize!=C)return 0;var ye=Z&&Z.charAt(0),Me=I.lexical,st;if(!/^\s*else\b/.test(Z))for(var He=I.cc.length-1;He>=0;--He){var nt=I.cc[He];if(nt==re)Me=Me.prev;else if(nt!=un&&nt!=W)break}for(;(Me.type=="stat"||Me.type=="form")&&(ye=="}"||(st=I.cc[I.cc.length-1])&&(st==he||st==be)&&!/^[,\.=+\-*:?[\(]/.test(Z));)Me=Me.prev;s&&Me.type==")"&&Me.prev.type=="stat"&&(Me=Me.prev);var vt=Me.type,Nt=ye==vt;return vt=="vardef"?Me.indented+(I.lastType=="operator"||I.lastType==","?Me.info.length+1:0):vt=="form"&&ye=="{"?Me.indented:vt=="form"?Me.indented+r:vt=="stat"?Me.indented+(An(I,Z)?s||r:0):Me.info=="switch"&&!Nt&&i.doubleIndentSwitch!=!1?Me.indented+(/^(?:case|default)\b/.test(Z)?r:2*r):Me.align?Me.column+(Nt?0:1):Me.indented+(Nt?0:r)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:te,skipExpression:function(I){P(I,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})})()),Fp.exports}vO();const Hp={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(n,{expose:e,emit:t}){const o=t,i=X(""),r=n;ct(()=>r.value,f=>{i.value=f},{immediate:!0});const s={mode:"text/javascript",theme:"dracula"},a=X(null),l=f=>{o("update:value",f)},d=()=>{a.value.refresh()},c=()=>{},p=()=>{};return e({handleRefresh:d}),(f,h)=>(w(),R("div",null,[m(K(fC),{onWheel:h[0]||(h[0]=Ct(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":h[1]||(h[1]=v=>i.value=v),options:s,ref_key:"cmRef",ref:a,height:r.height,width:r.width,onChange:l,onInput:p,onReady:c},null,8,["value","height","width"])]))}},_O={class:"flex-content-box"},gO={class:"test-model-box"},mO=["onClick"],yO={key:2,class:"input-list-box"},bO={class:"add-btn-box"},xO={class:"save-btn-box"},wO={class:"preview-box"},CO={class:"preview-content-block"},kO={class:"title-block"},SO={class:"preview-code-box"},EO={class:"preview-content-block"},AO={class:"error-box",style:{"margin-top":"12px"}},DO={key:0,style:{color:"#f50"}},OO={__name:"run-test",props:{variableOptions:{type:Array,default:()=>[]}},emits:["save"],setup(n,{expose:e,emit:t}){const o=n,i=X(!1),r=X(!1);let s=!1;const a=Je({language:"javaScript",main_func:"",test_params:[]});function l(E){if(typeof E!="string")return null;const D=/<([^<>]+)>/,N=E.match(D);return N?N[1]:null}function d(E){var D;if(E&&E.length==2){let N=o.variableOptions.filter(F=>F.value==E[0]);if(N.length>0){let F=((D=N[0].children.filter(Y=>Y.value==E[1])[0])==null?void 0:D.typ)||"string";return F.includes("array")&&s?l(F):F}}return"string"}let c=[];const p=async E=>{g.value="",a.main_func=E.main_func;let D=localStorage.getItem("code_run_node_test_modal_data")||"{}";c=JSON.parse(D).test_params||[];let N=E.params.filter(F=>F.field&&F.variable&&F.variable.length>0);a.test_params=N.map(F=>{let Y=d(F.variable);return{key:Math.random()*1e3,field:F.field,typ:Y,value:f(Y,F)}}),i.value=!0};function f(E,D){let N=c.filter(F=>F.field==D.field);return E.includes("array")?N.length&&typeof N[0].value=="object"?N[0].value:[{value:"",key:Math.random()*1e4}]:N.length&&typeof N[0].value=="string"?N[0].value:""}const h=(E,D)=>{E.splice(D,1)},v=E=>{E.push({value:"",key:Math.random()*1e4})},y=X(null),g=X(""),_=X(!1),b=X(""),C=()=>{y.value.validate().then(()=>{let E={...a},D=JSON.parse(JSON.stringify(a.test_params)),N={};D.forEach(F=>{N[F.field]=F.value,F.typ.includes("array")&&(N[F.field]=F.value.map(Y=>(Y.value=Y.value.trim(),T(Y.value)?JSON.parse(Y.value):Y.value)),N[F.field]=N[F.field].filter(Y=>Y)),F.typ==="object"&&T(F.value)&&(N[F.field]=JSON.parse(F.value))}),E.params=JSON.stringify(N),delete E.test_params,localStorage.setItem("code_run_node_test_modal_data",JSON.stringify(a)),r.value=!0,_.value=!1,Ym({...E}).then(F=>{mt.success("测试结果生成完成"),g.value=JSON.parse(F.data)}).catch(F=>{_.value=!0,b.value=F.msg}).finally(()=>{r.value=!1})})};function T(E){if(typeof E!="string")return!1;const D=E.trim();if(!(D.startsWith("{")&&D.endsWith("}")||D.startsWith("[")&&D.endsWith("]")))return!1;try{const F=JSON.parse(D);return typeof F=="object"&&F!==null}catch{return!1}}const M=()=>{Ts(JSON.stringify(g.value)),mt.success("复制成功")},S=(E,D)=>{_.value=!1,s=D,p(E)},k=X(!1),A=X(!1),$=X(null),B=X(""),O=E=>{$.value=E,A.value=!1,k.value=!0},P=()=>{if(T(B.value)){let E=JSON.parse(B.value).map(F=>({value:typeof F=="string"?F:JSON.stringify(F)})),D=a.test_params[$.value],N={...D,value:[...D.value.filter(F=>F.value!=""),...E]};a.test_params.splice($.value,1,N),k.value=!1}else A.value=!0};return e({open:S}),(E,D)=>{const N=Ai,F=ko,Y=en,L=Mn,j=In,le=Xt,z=Cn,V=xn,J=sr,oe=_n,W=Vi;return w(),R("div",null,[m(oe,{open:i.value,"onUpdate:open":D[0]||(D[0]=q=>i.value=q),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal"},{default:x(()=>[u("div",_O,[u("div",gO,[u("div",{class:"top-title",onClick:O},"运行参数"),m(V,{model:a,ref_key:"formRef",ref:y,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),R(se,null,ge(a.test_params,(q,re)=>(w(),Q(z,{key:q.key,name:["test_params",re,"value"],rules:[{required:!0,message:`请输入${q.field}`}]},{label:x(()=>[m(F,{gap:8},{default:x(()=>[U(H(q.field),1),m(N,{style:{margin:"0"}},{default:x(()=>[U(H(q.typ),1)]),_:2},1024),q.typ.includes("array")?(w(),R("a",{key:0,onClick:ue=>O(re)},[m(K(dy)),D[3]||(D[3]=U(" 一键导入 ",-1))],8,mO)):ne("",!0)]),_:2},1024)]),default:x(()=>[q.typ!="number"&&!q.typ.includes("array")?(w(),Q(Y,{key:0,placeholder:"请输入",value:q.value,"onUpdate:value":ue=>q.value=ue},null,8,["value","onUpdate:value"])):ne("",!0),q.typ=="number"?(w(),Q(L,{key:1,style:{width:"100%"},placeholder:"请输入",value:q.value,"onUpdate:value":ue=>q.value=ue},null,8,["value","onUpdate:value"])):ne("",!0),q.typ.includes("array")?(w(),R("div",yO,[(w(!0),R(se,null,ge(q.value,(ue,xe)=>(w(),R("div",{class:"input-list-item",key:xe},[m(j,null,{default:x(()=>[m(Y,{placeholder:"请输入",value:ue.value,"onUpdate:value":Te=>ue.value=Te},null,8,["value","onUpdate:value"])]),_:2},1024),q.value.length>1?(w(),Q(K(Ut),{key:0,onClick:Te=>h(q.value,xe)},null,8,["onClick"])):ne("",!0)]))),128)),u("div",bO,[m(le,{onClick:ue=>v(q.value),block:"",type:"dashed"},{default:x(()=>[...D[4]||(D[4]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ne("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),u("div",xO,[m(le,{loading:r.value,onClick:C,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[m(K(ai)),D[5]||(D[5]=U("运行测试",-1))]),_:1},8,["loading"])])]),u("div",wO,[g.value?(w(),R(se,{key:0},[D[7]||(D[7]=u("div",{class:"preview-title"},[u("div",{class:"title-text"},"日志详情")],-1)),u("div",CO,[u("div",kO,[D[6]||(D[6]=U("运行日志",-1)),m(K(Po),{onClick:M})]),u("div",SO,[m(K(Bo),{data:g.value},null,8,["data"])])])],64)):ne("",!0),_.value?(w(),R(se,{key:1},[D[9]||(D[9]=u("div",{class:"preview-title"},[u("div",{class:"title-text"},"日志详情")],-1)),u("div",EO,[D[8]||(D[8]=u("div",{class:"title-block"},"错误日志",-1)),u("div",AO,[m(J,{message:b.value,type:"error"},null,8,["message"])])])],64)):ne("",!0)])])]),_:1},8,["open"]),m(oe,{open:k.value,"onUpdate:open":D[2]||(D[2]=q=>k.value=q),width:820,title:"批量导入字段值",onOk:P},{default:x(()=>[m(W,{value:B.value,"onUpdate:value":D[1]||(D[1]=q=>B.value=q),valueModifiers:{trim:!0},placeholder:"请输入JSON字符串",style:{"min-height":"200px"}},null,8,["value"]),A.value?(w(),R("div",DO,' json格式错误 请输入正确的json字符串 列如 [{"xxx":"11","id":48985},{"brand":"aaa","id":48986}] ')):ne("",!0)]),_:1},8,["open"])])}}},NO=Ne(OO,[["__scopeId","data-v-c0680a8c"]]),MO={class:"problem-optimization-form"},TO={class:"node-form-content"},$O={class:"gray-block"},RO={class:"array-form-box"},PO={class:"flex-block-item"},LO=["onClick"],BO={class:"code-edit-box"},IO={class:"title-block"},jO={class:"code-box"},FO={class:"flex-block-item"},VO={class:"gray-block mt16"},HO={class:"output-box"},UO={class:"flex-block-item",style:{gap:"12px"}},zO=["onClick"],qO=["onClick"],GO={key:0,class:"sub-field-box"},XO={style:{margin:"40px 0 24px 0"}},Up=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,WO={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]);function r(){const E=o.lf.getNodeModelById(o.nodeId);if(E){let D=E.getAllParentVariable();i.value=s(D)}i.value}function s(E){return E.forEach(D=>{D.typ=="node"?D.node_type==1?D.value="global":D.value=D.node_id:D.value=D.key,D.children&&D.children.length>0&&(D.children=s(D.children))}),E}const a=X(),l=Je({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),d=()=>{_n.confirm({title:"确认还原为模板？",content:"还原后即被覆盖，不能撤销",okText:"确认",cancelText:"取消",onOk:()=>{l.main_func=Up}})};function c(E){return E.forEach(D=>{D.cu_key=Math.random()*1e4,D.subs&&D.subs.length?c(D.subs):D.subs=[]}),E}const p=()=>{const E=JSON.stringify({code_run:{...l,params:f()}});t("update-node",{...o.node,...l,node_params:E})};function f(){let E=[];return l.params.forEach(D=>{E.push({field:D.field,variable:D.variable&&D.variable.length>0?D.variable.join("."):""})}),E}const h=()=>{try{let E=o.node.dataRaw||o.node.node_params||"{}",D=JSON.parse(E).code_run||{};D=JSON.parse(JSON.stringify(D)),r();for(let N in D){if(N=="params"){D[N]&&D[N].length>0?l[N]=D[N].map(F=>({...F,cu_key:Math.random()*1e4})):l[N]=[];continue}if(N=="output"){l.output=c(D[N]);continue}l[N]=D[N]}l.main_func=l.main_func||Up,l.params=l.params.map(N=>{let F="";for(let Y=0;Y<Lo.length;Y++)if(N.variable.indexOf(Lo[Y])>-1){F=Lo[Y];break}if(F!=""){let Y=N.variable.split(".");N.variable=[Y[0],F]}else N.variable=N.variable.split(".");return{...N,key:Math.random()*1e4}})}catch(E){}};ct(()=>l,()=>{p()},{deep:!0});const v=()=>{l.params.push({key:"",value:"",cu_key:Math.random()*1e4})},y=E=>{l.params.splice(E,1)},g=()=>{l.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},_=E=>{l.output.splice(E,1)},b=E=>{E.subs=[]},C=E=>{l.output[E].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},T=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],M=E=>{E||r()},S=X(!1),k=X(null),A=()=>{S.value=!0,k.value&&k.value.handleRefresh()},$=()=>{S.value=!1},B=()=>{t("close")},O=X(null),P=()=>{O.value.open(JSON.parse(JSON.stringify(l)),o.node.loop_parent_key!="")};return at(()=>{h()}),(E,D)=>{const N=Zt,F=en,Y=In,L=li,j=Cn,le=Xt,z=ko,V=Mn,J=Lt,oe=$t,W=_n,q=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:B},{runBtn:x(()=>[m(N,null,{title:x(()=>[...D[5]||(D[5]=[U("运行测试",-1)])]),default:x(()=>[u("div",{class:"action-btn",onClick:P},[m(K(ai),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",MO,[u("div",TO,[m(q,{ref_key:"formRef",ref:a,layout:"vertical",model:l},{default:x(()=>[u("div",$O,[D[11]||(D[11]=u("div",{class:"gray-block-title"},"输入",-1)),u("div",RO,[D[7]||(D[7]=u("div",{class:"form-item-label"},"自定义输入参数",-1)),(w(!0),R(se,null,ge(l.params,(re,ue)=>(w(),R("div",{class:"form-item-list",key:ue},[m(j,{label:null,name:["params",ue,"variable"]},{default:x(()=>[u("div",PO,[m(Y,null,{default:x(()=>[m(F,{style:{width:"190px"},value:re.field,"onUpdate:value":xe=>re.field=xe,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),m(L,{value:re.variable,"onUpdate:value":xe=>re.variable=xe,onDropdownVisibleChange:M,style:{width:"400px","max-width":"calc(100% - 190px)"},options:i.value,allowClear:!1,displayRender:({labels:xe})=>xe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),u("div",{class:"btn-hover-wrap",onClick:xe=>y(ue)},[m(K(Ut))],8,LO)])]),_:2},1032,["name"])]))),128)),m(le,{onClick:v,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...D[6]||(D[6]=[U("添加参数",-1)])]),_:1},8,["icon"])]),u("div",BO,[u("div",IO,[D[8]||(D[8]=u("div",null,"JavaScript 代码",-1)),m(z,{gap:16,align:"center"},{default:x(()=>[u("a",{onClick:d},"还原为模板"),u("div",{class:"btn-hover-wrap",onClick:A},[m(K(po))])]),_:1})]),u("div",jO,[m(Hp,{value:l.main_func,"onUpdate:value":D[0]||(D[0]=re=>l.main_func=re),width:410,height:170},null,8,["value"])])]),m(j,{name:"timeout",class:"mt16"},{label:x(()=>[m(z,{gap:2},{default:x(()=>[...D[9]||(D[9]=[U("超时时长",-1)])]),_:1})]),default:x(()=>[u("div",FO,[m(V,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:l.timeout,"onUpdate:value":D[1]||(D[1]=re=>l.timeout=re),min:0,max:3e3},null,8,["value"]),D[10]||(D[10]=U(" 秒 ",-1))])]),_:1})]),u("div",VO,[D[14]||(D[14]=u("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),u("div",HO,[D[13]||(D[13]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型")],-1)),u("div",{class:"array-form-box",onMousedown:D[2]||(D[2]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(l.output,(re,ue)=>(w(),R("div",{class:"form-item-list",key:ue},[m(j,{label:null,name:["output",ue,"key"]},{default:x(()=>[u("div",UO,[m(F,{style:{width:"214px"},value:re.key,"onUpdate:value":xe=>re.key=xe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(Y,null,{default:x(()=>[m(oe,{onChange:xe=>b(re),value:re.typ,"onUpdate:value":xe=>re.typ=xe,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(se,null,ge(T,xe=>m(J,{value:xe.value,key:xe.value},{default:x(()=>[U(H(xe.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),re.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:xe=>C(ue)},[m(K(Bn))],8,zO)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:xe=>_(ue)},[m(K(Ut))],8,qO)]),re.subs&&re.subs.length>0?(w(),R("div",GO,[m(Y,null,{default:x(()=>[m(hO,{data:re.subs,level:2,typOptions:T},null,8,["data"])]),_:2},1024)])):ne("",!0)]),_:2},1032,["name"])]))),128)),m(le,{onClick:g,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...D[12]||(D[12]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])]),D[16]||(D[16]=u("div",{class:"gray-block mt16"},[u("div",{class:"gray-block-title"},"异常处理"),u("div",null,"运行代码报错时执行该分支")],-1)),m(W,{open:S.value,"onUpdate:open":D[4]||(D[4]=re=>S.value=re),title:"编辑代码",width:746},{footer:x(()=>[m(le,{type:"primary",onClick:$},{default:x(()=>[...D[15]||(D[15]=[U("确定",-1)])]),_:1})]),default:x(()=>[u("div",XO,[m(Hp,{ref_key:"codeEditBoxRef",ref:k,value:l.main_func,"onUpdate:value":D[3]||(D[3]=re=>l.main_func=re),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1},8,["model"])])]),m(NO,{variableOptions:i.value,ref_key:"runTestRef",ref:O},null,8,["variableOptions"])]),_:1})}}},YO=Ne(WO,[["__scopeId","data-v-20da36a3"]]),JO={class:"mt24"},KO={class:"add-btn-block"},ZO={class:"list-box"},QO={__name:"add-authentication-modal",emits:["ok"],setup(n,{expose:e,emit:t}){const o=X(!1),i=X([]),r=t,s=[{title:"Key",dataIndex:"auth_key"},{title:"Value",dataIndex:"auth_value"},{title:"Add To",dataIndex:"auth_value_addto"},{title:"备注",dataIndex:"auth_remark"},{title:"操作",dataIndex:"action",width:80}],a=Je({selectedRowKeys:[]}),l=g=>{a.selectedRowKeys=g},d=()=>{o.value=!0,a.selectedRowKeys=[],f()},c=()=>{if(i.value.length>=100)return mt.error("最多添加100条");i.value.push({auth_key:"",auth_value:"",auth_value_addto:"HEADERS",auth_remark:"",uni_key:Ht(16)})},p=g=>{i.value=i.value.filter(_=>_.uni_key!==g.uni_key)},f=()=>{t_().then(g=>{let _=g.data||[];i.value=_.map(b=>({...b,uni_key:Ht(16)}))})};function h(){let g=[],_=[];return i.value.forEach((b,C)=>{_.push({auth_key:b.auth_key,auth_value:b.auth_value,auth_value_addto:b.auth_value_addto,auth_remark:b.auth_remark}),(b.auth_key==""||b.auth_value=="")&&g.push(C+1)}),g.length>0?(mt.error(`请填写第${g.join(",")}行参数`),!1):_.length==0?(mt.error("请添加参数"),!1):_}const v=()=>{let g=h();if(g==!1)return;let _=[];a.selectedRowKeys.forEach(b=>{_.push(i.value.find(C=>C.uni_key==b))}),r("ok",_),Il({http_auth_config_list:JSON.stringify(g)}).then(b=>{mt.success("保存成功")}).finally(()=>{a.selectedRowKeys=[],o.value=!1})},y=()=>{let g=h();g!=!1&&Il({http_auth_config_list:JSON.stringify(g)}).then(_=>{mt.success("保存成功")})};return e({show:d}),(g,_)=>{const b=sr,C=Xt,T=en,M=Lt,S=$t,k=a_,A=Ur,$=_n;return w(),R("div",null,[m($,{open:o.value,"onUpdate:open":_[1]||(_[1]=B=>o.value=B),title:"鉴权参数",width:700},{footer:x(()=>[m(C,{onClick:_[0]||(_[0]=B=>o.value=!1)},{default:x(()=>[..._[7]||(_[7]=[U("取消",-1)])]),_:1}),m(C,{onClick:y},{default:x(()=>[..._[8]||(_[8]=[U("仅保存参数",-1)])]),_:1}),m(C,{type:"primary",onClick:v},{default:x(()=>[..._[9]||(_[9]=[U("保存并添加",-1)])]),_:1})]),default:x(()=>[u("div",JO,[m(b,{class:"zm-alert-info",message:"选择的参数会自动填充到http节点，鉴权参数在导出CSL或上架模板时会自动清空",type:"info"})]),u("div",KO,[m(C,{type:"primary",icon:St(K(Mt)),ghost:"",onClick:c},{default:x(()=>[..._[2]||(_[2]=[U("添加参数",-1)])]),_:1},8,["icon"])]),u("div",ZO,[m(A,{"row-selection":{selectedRowKeys:a.selectedRowKeys,onChange:l},columns:s,pagination:!1,"data-source":i.value,"row-key":"uni_key",scroll:{y:550}},{bodyCell:x(({column:B,record:O})=>[B.dataIndex==="auth_key"?(w(),Q(T,{key:0,value:O.auth_key,"onUpdate:value":P=>O.auth_key=P,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="auth_value"?(w(),Q(T,{key:1,value:O.auth_value,"onUpdate:value":P=>O.auth_value=P,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="auth_value_addto"?(w(),Q(S,{key:2,value:O.auth_value_addto,"onUpdate:value":P=>O.auth_value_addto=P,style:{width:"100%"}},{default:x(()=>[m(M,{value:"HEADERS"},{default:x(()=>[..._[3]||(_[3]=[U("HEADERS",-1)])]),_:1}),m(M,{value:"PARAMS"},{default:x(()=>[..._[4]||(_[4]=[U("PARAMS",-1)])]),_:1}),m(M,{value:"BODY"},{default:x(()=>[..._[5]||(_[5]=[U("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="auth_remark"?(w(),Q(T,{key:3,maxLength:10,value:O.auth_remark,"onUpdate:value":P=>O.auth_remark=P,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="action"?(w(),Q(k,{key:4,title:"确认删除该字段?","ok-text":"确定","cancel-text":"取消",onConfirm:P=>p(O)},{default:x(()=>[..._[6]||(_[6]=[u("a",null,"删除",-1)])]),_:1},8,["onConfirm"])):ne("",!0)]),_:1},8,["row-selection","data-source"])])]),_:1},8,["open"])])}}},eN=Ne(QO,[["__scopeId","data-v-678c7a6b"]]),tN={class:"flex-content-box"},nN={class:"test-model-box"},oN={class:"auto-extract-tip"},iN={key:2,class:"input-list-box"},rN={class:"add-btn-box"},sN={class:"save-btn-box"},aN={key:0},lN={key:1},uN={class:"preview-box"},dN={class:"preview-content-block"},cN={class:"title-block"},pN={class:"preview-code-box"},fN={class:"preview-content-block"},hN={class:"title-block"},vN={class:"preview-code-box"},_N={__name:"run-test",props:{node_key:{type:String,default:""}},emits:["save","autoExtract"],setup(n,{expose:e,emit:t}){const o=n,i=t,r=Vn(),s=We(()=>r.robotInfo.isLockedByOther),a=X(!1),l=X([]),d=X({fields:[],output:{},result:{}}),c=X(!1),p=X(""),f=Je({is_draft:!0,robot_key:r.robotInfo.robot_key}),h=async M=>{if(s.value){mt.warning("当前已有其他用户在编辑中，无法运行测试");return}d.value={fields:[],output:{},result:{}},p.value="",l.value=M,a.value=!0,l.value.forEach(S=>{S.field.typ.includes("array")&&y(S.field.Vals)})},v=(M,S)=>{M.splice(S,1)},y=M=>{M.push({value:"",key:ls(16)})},g=X(null),_=()=>{g.value.validate().then(()=>{const M={...f,curl_node_key:o.node_key},S=JSON.parse(JSON.stringify(l.value));S.forEach(k=>{k.field.typ.includes("array")&&(k.field.Vals=k.field.Vals.map(A=>A.value))}),M.test_params=JSON.stringify(S),c.value=!0,p.value="loading",Jm({...M}).then(k=>{mt.success("测试结果生成完成"),d.value=k.data,p.value="success"}).catch(k=>{mt.error("测试结果生成失败"),p.value="error"}).finally(()=>{c.value=!1})})},b=M=>{Ts(JSON.stringify(d.value[M])),mt.success("复制成功")},C=()=>{i("autoExtract",JSON.parse(JSON.stringify(d.value.fields)))};return e({open:M=>{h(M)}}),(M,S)=>{const k=sr,A=Ai,$=ko,B=en,O=Mn,P=In,E=Xt,D=Cn,N=xn,F=_n;return w(),R("div",null,[m(F,{open:a.value,"onUpdate:open":S[2]||(S[2]=Y=>a.value=Y),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[...S[3]||(S[3]=[u("div",{class:"modal-title-block"},[u("span",null,"运行测试")],-1)])]),default:x(()=>[u("div",tN,[u("div",nN,[u("div",oN,[m(k,{message:"运行测试成功后，支持自动填充输出参数",type:"info","show-icon":""})]),m(N,{model:f,ref_key:"formRef",ref:g,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),R(se,null,ge(l.value,Y=>(w(),Q(D,{key:Y.node_key,rules:[{required:Y.field.required,message:`请输入${Y.field.label}`}]},{label:x(()=>[m($,{gap:4},{default:x(()=>[u("span",null,H(Y.field.label),1),m(A,{style:{margin:"0"}},{default:x(()=>[U(H(Y.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[Y.field.typ=="string"?(w(),Q(B,{key:0,placeholder:"请输入",value:Y.field.Vals,"onUpdate:value":L=>Y.field.Vals=L},null,8,["value","onUpdate:value"])):ne("",!0),Y.field.typ=="number"?(w(),Q(O,{key:1,style:{width:"100%"},placeholder:"请输入",value:Y.field.Vals,"onUpdate:value":L=>Y.field.Vals=L},null,8,["value","onUpdate:value"])):ne("",!0),Y.field.typ.includes("array")?(w(),R("div",iN,[(w(!0),R(se,null,ge(Y.field.Vals,(L,j)=>(w(),R("div",{class:"input-list-item",key:j},[m(P,null,{default:x(()=>[m(B,{placeholder:"请输入",value:L.value,"onUpdate:value":le=>L.value=le},null,8,["value","onUpdate:value"])]),_:2},1024),Y.field.Vals.length>1?(w(),Q(K(Ut),{key:0,onClick:le=>v(Y.field.Vals,j)},null,8,["onClick"])):ne("",!0)]))),128)),u("div",rN,[m(E,{onClick:L=>y(Y.field.Vals),block:"",type:"dashed"},{default:x(()=>[...S[4]||(S[4]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ne("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),u("div",sN,[m(E,{loading:c.value,onClick:_,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[c.value?ne("",!0):(w(),R("span",aN,[m(K(ai)),S[5]||(S[5]=U("运行测试",-1))])),c.value?(w(),R("span",lN,"测试结果生成中...")):ne("",!0)]),_:1},8,["loading"]),p.value==="success"?(w(),Q(E,{key:0,style:{"margin-left":"16px"},type:"primary",onClick:C},{default:x(()=>[...S[6]||(S[6]=[U("自动提取输出参数",-1)])]),_:1})):ne("",!0)])]),u("div",uN,[p.value==="success"?(w(),R(se,{key:0},[S[9]||(S[9]=u("div",{class:"preview-title"},[u("div",{class:"title-text"},"日志详情")],-1)),u("div",dN,[u("div",cN,[S[7]||(S[7]=U("原始输出",-1)),m(K(Po),{onClick:S[0]||(S[0]=Y=>b("result"))})]),u("div",pN,[m(K(Bo),{data:d.value.result},null,8,["data"])])]),u("div",fN,[u("div",hN,[S[8]||(S[8]=U("运行日志",-1)),m(K(Po),{onClick:S[1]||(S[1]=Y=>b("output"))})]),u("div",vN,[m(K(Bo),{data:d.value.output},null,8,["data"])])])],64)):ne("",!0)])])]),_:1},8,["open"])])}}},gN=Ne(_N,[["__scopeId","data-v-221804ef"]]),mN={class:"problem-optimization-form"},yN={class:"node-form-content"},bN={class:"gray-block"},xN={class:"gray-block-title export-curl-title"},wN={class:"flex-block-item"},CN={class:"array-form-box"},kN={class:"flex-block-item"},SN={class:"at-input-flex1"},EN={class:"field-list-item"},AN={class:"field-label"},DN={class:"field-type"},ON=["onClick"],NN={class:"array-form-box"},MN={class:"flex-block-item"},TN={class:"at-input-flex1"},$N={class:"field-list-item"},RN={class:"field-label"},PN={class:"field-type"},LN=["onClick"],BN={key:0},IN={key:0,class:"array-form-box"},jN={class:"flex-block-item"},FN={class:"at-input-flex1"},VN={class:"field-list-item"},HN={class:"field-label"},UN={class:"field-type"},zN=["onClick"],qN={class:"field-list-item"},GN={class:"field-label"},XN={class:"field-type"},WN={class:"flex-block-item"},YN={class:"gray-block mt16"},JN={class:"gray-block-title"},KN={class:"output-box"},ZN={class:"flex-block-item",style:{gap:"12px"}},QN=["onClick"],e8={class:"gray-block mt16"},t8={class:"output-box"},n8={class:"flex-block-item",style:{gap:"12px"}},o8=["onClick"],i8=["onClick"],r8={key:0,class:"sub-field-box"},s8={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Ve("handleAutoSaveDraft"),r=X([]),s=Je({}),a=X(null),l=X(),d=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[],http_auth:[]}),c=X(),p=()=>{c.value.show()},f=V=>{let J=[{key:"",value:""}],oe=[{key:"",value:""}],W=[],q="",re=!1;d.method=V.method,d.rawurl=V.url;function ue(xe){return typeof xe=="string"?xe:JSON.stringify(xe)}V.header&&typeof V.header=="object"&&(J=Object.keys(V.header).map(xe=>(xe.toLowerCase()=="content-type"&&V.header[xe].indexOf("application/json")!==-1&&(re=!0),{key:xe,value:ue(V.header[xe]),cu_key:Ht(16)})),J=J.filter(xe=>xe.key.toLowerCase()!=="content-type")),V.data&&typeof V.data=="object"&&(W=Object.keys(V.data).map(xe=>({key:xe,value:ue(V.data[xe]),cu_key:Ht(16)})),q=JSON.stringify(V.data)),V.params&&typeof V.params=="object"&&(oe=Object.keys(V.params).map(xe=>({key:xe,value:ue(V.params[xe]),cu_key:Ht(16)}))),re?(d.type=2,d.body_raw=q):(d.type=1,d.body=W),d.headers=J,d.params=oe};function h(V){return V.forEach(J=>{J.cu_key=Ht(16),J.subs&&J.subs.length?h(J.subs):J.subs=[]}),V}function v(V){return V.typ.includes("array")?[]:null}const y=async()=>{var oe;let V=JSON.parse(JSON.stringify(d));await i();let J=[];V.headers.forEach(W=>{W.tags&&W.tags.length&&(J=J.concat(W.tags))}),V.params.forEach(W=>{W.tags&&W.tags.length&&(J=J.concat(W.tags))}),d.type==1?V.body.forEach(W=>{W.tags&&W.tags.length&&(J=J.concat(W.tags))}):d.type==2&&V.body_raw_tags.length&&(J=J.concat(V.body_raw_tags)),J=J.map(W=>({node_key:W.node_id,field:{key:W.original_value,label:W.label,typ:W.typ,Vals:v(W),required:!1,sys:!1}})),(oe=a.value)==null||oe.open(J)},g=V=>{d.output=V,mt.success("自动提取成功")},_=(V,J,oe)=>{if(V){let W=`at_input_${J}_${oe}`;s[W]=V}},b=(V,J,oe,W)=>{V=="body_raw"?(d.body_raw=J,d.body_raw_tags=oe):(W.tags=oe,W.value=J)},C=()=>{const V=o.lf.getNodeModelById(o.nodeId);if(V){let J=V.getAllParentVariable();J.forEach(oe=>{oe.tags=oe.tags||[]}),r.value=J}},T=()=>{const V=JSON.stringify({curl:{...d}});t("update-node",{...o.node,...d,node_params:V})},M=()=>{try{let V=o.node.dataRaw||o.node.node_params||"{}",J=JSON.parse(V).curl||{};J=JSON.parse(JSON.stringify(J)),C();for(let oe in J){if(oe=="headers"||oe=="params"||oe=="body"){J[oe]&&J[oe].length>0?d[oe]=J[oe].map(W=>({...W,cu_key:Ht(16)})):d[oe]=[];continue}if(oe=="output"){d.output=h(J[oe]);continue}d[oe]=J[oe]}d.http_auth=J.http_auth||[]}catch(V){}};ct(()=>d,()=>{T()},{deep:!0});const S=()=>{d.headers.push({key:"",value:"",cu_key:Ht(16)})},k=V=>{d.headers.splice(V,1)},A=()=>{d.params.push({key:"",value:"",cu_key:Ht(16)})},$=V=>{d.params.splice(V,1)},B=()=>{d.body.push({key:"",value:"",cu_key:Ht(16)})},O=V=>{d.body.splice(V,1)},P=()=>{d.output.push({key:"",typ:"string",subs:[],cu_key:Ht(16)})},E=V=>{d.output.splice(V,1)},D=V=>{V.subs=[]},N=V=>{(!d.output[V].subs||!Array.isArray(d.output[V].subs))&&(d.output[V].subs=[]),d.output[V].subs.push({key:"",value:"",subs:[],cu_key:Ht(16)})},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],Y=X(null),L=()=>{Y.value.show()},j=V=>{let J=V.map(oe=>({key:oe.auth_key,value:oe.auth_value,add_to:oe.auth_value_addto}));d.http_auth=[...d.http_auth,...J]},le=V=>{d.http_auth.splice(V,1)},z=()=>{t("close")};return at(()=>{M()}),(V,J)=>{const oe=Zt,W=Xt,q=Lt,re=$t,ue=In,xe=en,Te=Cn,me=ro,pe=io,Ge=ko,Le=Mn,_e=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:z},{runBtn:x(()=>[m(oe,null,{title:x(()=>[...J[8]||(J[8]=[U("运行测试",-1)])]),default:x(()=>[u("div",{class:"run-test-btn",onClick:y},[m(K(ai),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",mN,[u("div",yN,[m(_e,{ref_key:"formRef",ref:l,layout:"vertical",model:d},{default:x(()=>[u("div",bN,[u("div",xN,[J[10]||(J[10]=u("span",null," 输入",-1)),m(W,{ghost:"",type:"primary",size:"small",onClick:p},{default:x(()=>[m(K(l_)),J[9]||(J[9]=U(" 导入cURL ",-1))]),_:1})]),m(Te,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:x(()=>[u("div",wN,[m(ue,null,{default:x(()=>[m(re,{value:d.method,"onUpdate:value":J[0]||(J[0]=he=>d.method=he),style:{width:"120px"}},{default:x(()=>[m(q,{value:"POST"},{default:x(()=>[...J[11]||(J[11]=[U("POST",-1)])]),_:1}),m(q,{value:"GET"},{default:x(()=>[...J[12]||(J[12]=[U("GET",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),m(xe,{class:"flex1",value:d.rawurl,"onUpdate:value":J[1]||(J[1]=he=>d.rawurl=he),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),u("div",CN,[J[14]||(J[14]=u("div",{class:"form-item-label"},"HEADERS",-1)),(w(!0),R(se,null,ge(d.headers,(he,be)=>(w(),R("div",{class:"form-item-list",key:be},[m(Te,{label:null,name:["headers",be,"value"]},{default:x(()=>[u("div",kN,[m(ue,null,{default:x(()=>[m(xe,{style:{width:"120px"},value:he.key,"onUpdate:value":De=>he.key=De,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",SN,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:De=>_(De,"headers",be),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(De,G)=>b("headers",De,G,he,be),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:De,payload:G})=>[u("div",EN,[u("div",AN,H(De),1),u("div",DN,H(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",{class:"btn-hover-wrap",onClick:De=>k(be)},[m(K(Ut))],8,ON)])]),_:2},1032,["name"])]))),128)),m(W,{onClick:S,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...J[13]||(J[13]=[U("添加参数",-1)])]),_:1},8,["icon"])]),u("div",NN,[J[16]||(J[16]=u("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),R(se,null,ge(d.params,(he,be)=>(w(),R("div",{class:"form-item-list",key:be},[m(Te,{label:null,name:["params",be,"value"]},{default:x(()=>[u("div",MN,[m(ue,null,{default:x(()=>[m(xe,{style:{width:"120px"},value:he.key,"onUpdate:value":De=>he.key=De,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",TN,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:De=>_(De,"params",be),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(De,G)=>b("params",De,G,he,be),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:De,payload:G})=>[u("div",$N,[u("div",RN,H(De),1),u("div",PN,H(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",{class:"btn-hover-wrap",onClick:De=>$(be)},[m(K(Ut))],8,LN)])]),_:2},1032,["name"])]))),128)),m(W,{onClick:A,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...J[15]||(J[15]=[U("添加参数",-1)])]),_:1},8,["icon"])]),d.method=="POST"?(w(),R("div",BN,[m(Te,{label:"BODY",name:"type",class:"line-height-22"},{default:x(()=>[m(pe,{value:d.type,"onUpdate:value":J[2]||(J[2]=he=>d.type=he)},{default:x(()=>[m(me,{value:0},{default:x(()=>[...J[17]||(J[17]=[U("none",-1)])]),_:1}),m(me,{value:1},{default:x(()=>[...J[18]||(J[18]=[U("x-www-form-urlencoded",-1)])]),_:1}),m(me,{value:2},{default:x(()=>[...J[19]||(J[19]=[U("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),d.type==1?(w(),R("div",IN,[(w(!0),R(se,null,ge(d.body,(he,be)=>(w(),R("div",{class:"form-item-list",key:be},[m(Te,{label:null,name:["body",be,"value"],rules:{required:!0}},{default:x(()=>[u("div",jN,[m(ue,null,{default:x(()=>[m(xe,{style:{width:"120px"},value:he.key,"onUpdate:value":De=>he.key=De,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",FN,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:De=>_(De,"body",be),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(De,G)=>b("body",De,G,he,be),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:De,payload:G})=>[u("div",VN,[u("div",HN,H(De),1),u("div",UN,H(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",{class:"btn-hover-wrap",onClick:De=>O(be)},[m(K(Ut))],8,zN)])]),_:2},1032,["name"])]))),128)),m(W,{onClick:B,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...J[20]||(J[20]=[U("添加参数",-1)])]),_:1},8,["icon"])])):ne("",!0),d.type==2?(w(),Q(Te,{key:1,label:null,name:"body_raw"},{default:x(()=>[m(tt,{type:"textarea",options:r.value,defaultSelectedList:d.body_raw_tags,defaultValue:d.body_raw,ref:he=>_(he,"body","body_raw"),onOpen:C,onChange:J[3]||(J[3]=(he,be)=>b("body_raw",he,be)),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:he,payload:be})=>[u("div",qN,[u("div",GN,H(he),1),u("div",XN,H(be.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):ne("",!0)])):ne("",!0),m(Te,{name:"timeout"},{label:x(()=>[m(Ge,{gap:2},{default:x(()=>[...J[21]||(J[21]=[U("超时时长",-1)])]),_:1})]),default:x(()=>[u("div",WN,[m(Le,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:d.timeout,"onUpdate:value":J[4]||(J[4]=he=>d.timeout=he),min:0,max:3e3},null,8,["value"]),J[22]||(J[22]=U(" 秒 ",-1))])]),_:1})]),u("div",YN,[u("div",JN,[J[24]||(J[24]=U("鉴权 ",-1)),m(oe,null,{title:x(()=>[...J[23]||(J[23]=[U("鉴权参数：导出模板CSL文件，或者上架模板时，自动清空参数值",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",KN,[J[29]||(J[29]=u("div",{class:"output-block"},[u("div",{class:"output-item",style:{width:"124px"}},"Key"),u("div",{class:"output-item",style:{width:"124px"}},"Value"),u("div",{class:"output-item",style:{width:"124px"}},"Add To")],-1)),u("div",{class:"array-form-box",onMousedown:J[5]||(J[5]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(d.http_auth,(he,be)=>(w(),R("div",{class:"form-item-list",key:be},[m(Te,{label:null},{default:x(()=>[u("div",ZN,[m(xe,{style:{width:"124px"},value:he.key,"onUpdate:value":De=>he.key=De,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(ue,null,{default:x(()=>[m(xe,{style:{width:"124px"},value:he.value,"onUpdate:value":De=>he.value=De,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(re,{value:he.add_to,"onUpdate:value":De=>he.add_to=De,style:{width:"124px"}},{default:x(()=>[m(q,{value:"HEADERS"},{default:x(()=>[...J[25]||(J[25]=[U("HEADERS",-1)])]),_:1}),m(q,{value:"PARAMS"},{default:x(()=>[...J[26]||(J[26]=[U("PARAMS",-1)])]),_:1}),m(q,{value:"BODY"},{default:x(()=>[...J[27]||(J[27]=[U("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),u("div",{class:"btn-hover-wrap",onClick:De=>le(be)},[m(K(Ut))],8,QN)])]),_:2},1024)]))),128)),m(W,{onClick:L,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...J[28]||(J[28]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])]),u("div",e8,[u("div",{class:"gray-block-title output-title",onClick:J[6]||(J[6]=(...he)=>V.test&&V.test(...he))},[J[31]||(J[31]=u("span",null,"输出 (输出字段提取)",-1)),m(W,{type:"primary",size:"small",onClick:y},{default:x(()=>[...J[30]||(J[30]=[U("自动提取输出参数",-1)])]),_:1})]),u("div",t8,[J[33]||(J[33]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型")],-1)),u("div",{class:"array-form-box",onMousedown:J[7]||(J[7]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(d.output,(he,be)=>(w(),R("div",{class:"form-item-list",key:be},[m(Te,{label:null,name:["output",be,"key"]},{default:x(()=>[u("div",n8,[m(xe,{style:{width:"214px"},value:he.key,"onUpdate:value":De=>he.key=De,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(ue,null,{default:x(()=>[m(re,{onChange:De=>D(he),value:he.typ,"onUpdate:value":De=>he.typ=De,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(se,null,ge(F,De=>m(q,{value:De.value,key:De.value},{default:x(()=>[U(H(De.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),he.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:De=>N(be)},[m(K(Bn))],8,o8)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:De=>E(be)},[m(K(Ut))],8,i8)]),he.subs&&he.subs.length>0?(w(),R("div",r8,[m(ue,null,{default:x(()=>[m(oC,{data:he.subs,level:2,typOptions:F},null,8,["data"])]),_:2},1024)])):ne("",!0)]),_:2},1032,["name"])]))),128)),m(W,{onClick:P,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...J[32]||(J[32]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])])]),_:1},8,["model"])])]),m(iC,{ref_key:"parseCurlModalRef",ref:c,onParse:f},null,512),m(eN,{onOk:j,ref_key:"addAuthenticationModalRef",ref:Y},null,512),m(gN,{ref_key:"runTestRef",ref:a,node_key:n.nodeId,onAutoExtract:g},null,8,["node_key"])]),_:1})}}},a8=Ne(s8,[["__scopeId","data-v-7d51f7da"]]),l8={class:"sub-field-item"},u8=["onClick"],d8=["onClick"],c8={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=We(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=We(()=>e.level==2?"180px":"146px"),i=(l,d)=>{d[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,d)=>{d.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,d)=>{const c=en,p=Lt,f=$t,h=Pt("SubsKey",!0);return w(!0),R(se,null,ge(e.data,(v,y)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[u("div",l8,[d[0]||(d[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(c,{class:"mr12",style:Fn({width:o.value}),value:v.key,"onUpdate:value":g=>v.key=g,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(f,{class:"mr12",onChange:g=>s(v),value:v.typ,"onUpdate:value":g=>v.typ=g,placeholder:"请选择",style:Fn({width:o.value})},{default:x(()=>[(w(!0),R(se,null,ge(t.value,g=>(w(),Q(p,{value:g.value},{default:x(()=>[U(H(g.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:g=>i(y,e.data)},[m(K(Bn))],8,u8)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:g=>r(y,e.data)},[m(K(Ut))],8,d8)]),v.subs&&v.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ne("",!0)],2))),128)}}},p8=Ne(c8,[["__scopeId","data-v-4d84ed5c"]]),f8={class:"parse-curl-modal"},h8={key:0,class:"parse-error"},v8={__name:"parse-curl-modal",emits:["parse","close"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=X(!1),s=X(""),a=X(""),l=X(`请粘贴 cURL 命令，例如：curl -X POST https://api.example.com/data -H 'Content-Type: application/json' -d '{"key":"value"}'`),d=()=>{i.value=!0,s.value="",a.value="",r.value=!1},c=()=>{i.value=!1,s.value="",a.value="",o("close")},p=()=>{i.value=!1},f=async()=>{if(!s.value.trim()){a.value="请输入 cURL 命令";return}a.value="";try{let h=s.value.trim();const v="__SINGLE_QUOTE_PLACEHOLDER__";let y=h.replace(/'\\''/g,v);y=y.replace(/\\\n/g," ").replace(/\\/g,"");let g=rC(decodeURIComponent(y));if(g.params){const _={};for(const[b,C]of Object.entries(g.params)){const T=decodeURIComponent(b),M=typeof C=="string"?decodeURIComponent(C):C;_[T]=M}g.params=_}if(g.data&&(g.header&&g.header["Content-Type"]?g.header["Content-Type"].toLowerCase():"").includes("application/x-www-form-urlencoded")&&typeof g.data=="object"){const C={};for(const[T,M]of Object.entries(g.data)){const S=decodeURIComponent(T),k=typeof M=="string"?decodeURIComponent(M):M;C[S]=k}g.data=C}if(g=JSON.stringify(g).split(v).join("'"),g=JSON.parse(g),g.method!=="GET"&&g.method!=="POST"){a.value="只支持 GET、POST 请求";return}o("parse",g)}catch(h){a.value=h.message}};return e({show:d,hide:p,handleClose:c}),(h,v)=>{const y=sr,g=Vi,_=Cn,b=_n;return w(),Q(b,{open:i.value,"onUpdate:open":v[2]||(v[2]=C=>i.value=C),title:"解析 cURL",width:680,"confirm-loading":r.value,onOk:f,onCancel:c,okText:"解析",cancelText:"取消"},{default:x(()=>[u("div",f8,[m(y,{message:"请粘贴 cURL 命令，系统将自动解析并填充到 HTTP 请求配置中。只支持 GET、POST 请求。",type:"info","show-icon":"",class:"mb16"}),m(_,{label:""},{default:x(()=>[m(g,{class:"curl-textarea",value:s.value,"onUpdate:value":v[0]||(v[0]=C=>s.value=C),placeholder:l.value,"auto-size":{minRows:8,maxRows:8},maxlength:5e4,"show-count":""},null,8,["value","placeholder"])]),_:1}),a.value?(w(),R("div",h8,[m(y,{message:a.value,type:"error","show-icon":"",closable:"",onClose:v[1]||(v[1]=C=>a.value="")},null,8,["message"])])):ne("",!0)])]),_:1},8,["open","confirm-loading"])}}},_8=Ne(v8,[["__scopeId","data-v-1ba3c2b7"]]),g8={class:"mt24"},m8={class:"add-btn-block"},y8={class:"list-box"},b8={__name:"add-authentication-modal",emits:["ok"],setup(n,{expose:e,emit:t}){const o=X(!1),i=X([]),r=t,s=[{title:"Key",dataIndex:"auth_key"},{title:"Value",dataIndex:"auth_value"},{title:"Add To",dataIndex:"auth_value_addto"},{title:"备注",dataIndex:"auth_remark"},{title:"操作",dataIndex:"action",width:80}],a=Je({selectedRowKeys:[]}),l=g=>{a.selectedRowKeys=g},d=()=>{o.value=!0,a.selectedRowKeys=[],f()},c=()=>{if(i.value.length>=100)return mt.error("最多添加100条");i.value.push({auth_key:"",auth_value:"",auth_value_addto:"HEADERS",auth_remark:"",uni_key:Ht(16)})},p=g=>{i.value=i.value.filter(_=>_.uni_key!==g.uni_key)},f=()=>{t_().then(g=>{let _=g.data||[];i.value=_.map(b=>({...b,uni_key:Ht(16)}))})};function h(){let g=[],_=[];return i.value.forEach((b,C)=>{_.push({auth_key:b.auth_key,auth_value:b.auth_value,auth_value_addto:b.auth_value_addto,auth_remark:b.auth_remark}),(b.auth_key==""||b.auth_value=="")&&g.push(C+1)}),g.length>0?(mt.error(`请填写第${g.join(",")}行参数`),!1):_.length==0?(mt.error("请添加参数"),!1):_}const v=()=>{let g=h();if(g==!1)return;let _=[];a.selectedRowKeys.forEach(b=>{_.push(i.value.find(C=>C.uni_key==b))}),r("ok",_),Il({http_auth_config_list:JSON.stringify(g)}).then(b=>{mt.success("保存成功")}).finally(()=>{a.selectedRowKeys=[],o.value=!1})},y=()=>{let g=h();g!=!1&&Il({http_auth_config_list:JSON.stringify(g)}).then(_=>{mt.success("保存成功")})};return e({show:d}),(g,_)=>{const b=sr,C=Xt,T=en,M=Lt,S=$t,k=a_,A=Ur,$=_n;return w(),R("div",null,[m($,{open:o.value,"onUpdate:open":_[1]||(_[1]=B=>o.value=B),title:"鉴权参数",width:700},{footer:x(()=>[m(C,{onClick:_[0]||(_[0]=B=>o.value=!1)},{default:x(()=>[..._[7]||(_[7]=[U("取消",-1)])]),_:1}),m(C,{onClick:y},{default:x(()=>[..._[8]||(_[8]=[U("仅保存参数",-1)])]),_:1}),m(C,{type:"primary",onClick:v},{default:x(()=>[..._[9]||(_[9]=[U("保存并添加",-1)])]),_:1})]),default:x(()=>[u("div",g8,[m(b,{class:"zm-alert-info",message:"选择的参数会自动填充到http节点，鉴权参数在导出CSL或上架模板时会自动清空",type:"info"})]),u("div",m8,[m(C,{type:"primary",icon:St(K(Mt)),ghost:"",onClick:c},{default:x(()=>[..._[2]||(_[2]=[U("添加参数",-1)])]),_:1},8,["icon"])]),u("div",y8,[m(A,{"row-selection":{selectedRowKeys:a.selectedRowKeys,onChange:l},columns:s,pagination:!1,"data-source":i.value,"row-key":"uni_key",scroll:{y:550}},{bodyCell:x(({column:B,record:O})=>[B.dataIndex==="auth_key"?(w(),Q(T,{key:0,value:O.auth_key,"onUpdate:value":P=>O.auth_key=P,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="auth_value"?(w(),Q(T,{key:1,value:O.auth_value,"onUpdate:value":P=>O.auth_value=P,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="auth_value_addto"?(w(),Q(S,{key:2,value:O.auth_value_addto,"onUpdate:value":P=>O.auth_value_addto=P,style:{width:"100%"}},{default:x(()=>[m(M,{value:"HEADERS"},{default:x(()=>[..._[3]||(_[3]=[U("HEADERS",-1)])]),_:1}),m(M,{value:"PARAMS"},{default:x(()=>[..._[4]||(_[4]=[U("PARAMS",-1)])]),_:1}),m(M,{value:"BODY"},{default:x(()=>[..._[5]||(_[5]=[U("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="auth_remark"?(w(),Q(T,{key:3,maxLength:10,value:O.auth_remark,"onUpdate:value":P=>O.auth_remark=P,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ne("",!0),B.dataIndex==="action"?(w(),Q(k,{key:4,title:"确认删除该字段?","ok-text":"确定","cancel-text":"取消",onConfirm:P=>p(O)},{default:x(()=>[..._[6]||(_[6]=[u("a",null,"删除",-1)])]),_:1},8,["onConfirm"])):ne("",!0)]),_:1},8,["row-selection","data-source"])])]),_:1},8,["open"])])}}},x8=Ne(b8,[["__scopeId","data-v-3de1dca2"]]),w8={class:"problem-optimization-form"},C8={class:"node-form-content"},k8={class:"gray-block"},S8={class:"gray-block-title export-curl-title"},E8={class:"flex-block-item"},A8={class:"array-form-box"},D8={class:"flex-block-item"},O8={class:"at-input-flex1"},N8={class:"field-list-item"},M8={class:"field-label"},T8={class:"field-type"},$8=["onClick"],R8={class:"array-form-box"},P8={class:"flex-block-item"},L8={class:"at-input-flex1"},B8={class:"field-list-item"},I8={class:"field-label"},j8={class:"field-type"},F8=["onClick"],V8={key:0},H8={key:0,class:"array-form-box"},U8={class:"flex-block-item"},z8={class:"at-input-flex1"},q8={class:"field-list-item"},G8={class:"field-label"},X8={class:"field-type"},W8=["onClick"],Y8={class:"field-list-item"},J8={class:"field-label"},K8={class:"field-type"},Z8={class:"flex-block-item"},Q8={class:"gray-block mt16"},e4={class:"gray-block-title"},t4={class:"output-box"},n4={class:"flex-block-item",style:{gap:"12px"}},o4=["onClick"],i4={class:"gray-block mt16"},r4={class:"output-box"},s4={class:"flex-block-item",style:{gap:"12px"}},a4=["onClick"],l4=["onClick"],u4={key:0,class:"sub-field-box"},d4={__name:"http-tool-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]),r=Je({}),s=(L,j,le)=>{if(L){let z=`at_input_${j}_${le}`;r[z]=L}},a=(L,j,le,z)=>{L=="body_raw"?(c.body_raw=j,c.body_raw_tags=le):(z.tags=le,z.value=j)},l=()=>{const L=o.lf.getNodeModelById(o.nodeId);if(L){let j=L.getAllParentVariable();j.forEach(le=>{le.tags=le.tags||[]}),i.value=j}},d=X(),c=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}],http_auth:[]}),p=X(),f=X({}),h=()=>{p.value.show()},v=L=>{let j=[{key:"",value:""}],le=[{key:"",value:""}],z=[],V="",J=!1;c.method=L.method,c.rawurl=L.url;function oe(W){return typeof W=="string"?W:JSON.stringify(W)}L.header&&typeof L.header=="object"&&(j=Object.keys(L.header).map(W=>(W.toLowerCase()=="content-type"&&L.header[W].indexOf("application/json")!==-1&&(J=!0),{key:W,value:oe(L.header[W]),cu_key:Ht(16)})),j=j.filter(W=>W.key.toLowerCase()!=="content-type")),L.data&&typeof L.data=="object"&&(z=Object.keys(L.data).map(W=>({key:W,value:oe(L.data[W]),cu_key:Ht(16)})),V=JSON.stringify(L.data)),L.params&&typeof L.params=="object"&&(le=Object.keys(L.params).map(W=>({key:W,value:oe(L.params[W]),cu_key:Ht(16)}))),J?(c.type=2,c.body_raw=V):(c.type=1,c.body=z),c.headers=j,c.params=le,p.value&&p.value.hide()};function y(L){return L.forEach(j=>{j.cu_key=Ht(16),j.subs&&j.subs.length?y(j.subs):j.subs=[]}),L}const g=()=>{const L={...c};(!Array.isArray(L.http_auth)||L.http_auth.length===0)&&delete L.http_auth;const j=f.value||{};j&&Object.keys(j).length>0&&(L.http_tool_info=j);const le=JSON.stringify({curl:L});t("update-node",{...o.node,...c,node_params:le})},_=()=>{try{let L=o.node.dataRaw||o.node.node_params||"{}",j=JSON.parse(L).curl||{};j=JSON.parse(JSON.stringify(j)),f.value=j.http_tool_info||{},l();for(let le in j){if(le=="headers"||le=="params"||le=="body"){j[le]&&j[le].length>0?c[le]=j[le].map(z=>({...z,cu_key:Ht(16)})):c[le]=[];continue}if(le=="output"){c.output=y(j[le]);continue}c[le]=j[le]}c.http_auth=j.http_auth||[]}catch(L){}};ct(()=>c,()=>{g()},{deep:!0});const b=()=>{c.headers.push({key:"",value:"",cu_key:Ht(16)})},C=L=>{c.headers.splice(L,1)},T=()=>{c.params.push({key:"",value:"",cu_key:Ht(16)})},M=L=>{c.params.splice(L,1)},S=()=>{c.body.push({key:"",value:"",cu_key:Ht(16)})},k=L=>{c.body.splice(L,1)},A=()=>{c.output.push({key:"",typ:"string",subs:[],cu_key:Ht(16)})},$=L=>{c.output.splice(L,1)},B=L=>{L.subs=[]},O=L=>{c.output[L].subs.push({key:"",value:"",subs:[],cu_key:Ht(16)})},P=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],E=X(null),D=()=>{E.value.show()},N=L=>{let j=L.map(le=>({key:le.auth_key,value:le.auth_value,add_to:le.auth_value_addto}));c.http_auth=[...c.http_auth,...j]},F=L=>{c.http_auth.splice(L,1)},Y=()=>{t("close")};return at(()=>{_()}),(L,j)=>{const le=Xt,z=Lt,V=$t,J=In,oe=en,W=Cn,q=ro,re=io,ue=ko,xe=Mn,Te=Zt,me=xn;return w(),Q(tn,null,{header:x(()=>{var pe,Ge;return[m(nn,{title:n.node.node_name,iconUrl:n.node.node_icon,desc:((Ge=(pe=JSON.parse(n.node.node_params).curl)==null?void 0:pe.http_tool_info)==null?void 0:Ge.http_tool_node_description)||"",onClose:Y},null,8,["title","iconUrl","desc"])]}),default:x(()=>[u("div",w8,[u("div",C8,[m(me,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:x(()=>[u("div",k8,[u("div",S8,[j[9]||(j[9]=u("span",null," 输入",-1)),m(le,{ghost:"",type:"primary",size:"small",onClick:h},{default:x(()=>[m(K(l_)),j[8]||(j[8]=U(" 导入cURL ",-1))]),_:1})]),m(W,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:x(()=>[u("div",E8,[m(J,null,{default:x(()=>[m(V,{value:c.method,"onUpdate:value":j[0]||(j[0]=pe=>c.method=pe),style:{width:"120px"}},{default:x(()=>[m(z,{value:"POST"},{default:x(()=>[...j[10]||(j[10]=[U("POST",-1)])]),_:1}),m(z,{value:"GET"},{default:x(()=>[...j[11]||(j[11]=[U("GET",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),m(oe,{class:"flex1",value:c.rawurl,"onUpdate:value":j[1]||(j[1]=pe=>c.rawurl=pe),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),u("div",A8,[j[13]||(j[13]=u("div",{class:"form-item-label"},"HEADERS",-1)),(w(!0),R(se,null,ge(c.headers,(pe,Ge)=>(w(),R("div",{class:"form-item-list",key:Ge},[m(W,{label:null,name:["headers",Ge,"value"]},{default:x(()=>[u("div",D8,[m(J,null,{default:x(()=>[m(oe,{style:{width:"120px"},value:pe.key,"onUpdate:value":Le=>pe.key=Le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",O8,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Le=>s(Le,"headers",Ge),options:i.value,defaultSelectedList:pe.tags,defaultValue:pe.value,onOpen:l,onChange:(Le,_e)=>a("headers",Le,_e,pe,Ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Le,payload:_e})=>[u("div",N8,[u("div",M8,H(Le),1),u("div",T8,H(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",{class:"btn-hover-wrap",onClick:Le=>C(Ge)},[m(K(Ut))],8,$8)])]),_:2},1032,["name"])]))),128)),m(le,{onClick:b,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[12]||(j[12]=[U("添加参数",-1)])]),_:1},8,["icon"])]),u("div",R8,[j[15]||(j[15]=u("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),R(se,null,ge(c.params,(pe,Ge)=>(w(),R("div",{class:"form-item-list",key:Ge},[m(W,{label:null,name:["params",Ge,"value"]},{default:x(()=>[u("div",P8,[m(J,null,{default:x(()=>[m(oe,{style:{width:"120px"},value:pe.key,"onUpdate:value":Le=>pe.key=Le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",L8,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Le=>s(Le,"params",Ge),options:i.value,defaultSelectedList:pe.tags,defaultValue:pe.value,onOpen:l,onChange:(Le,_e)=>a("params",Le,_e,pe,Ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Le,payload:_e})=>[u("div",B8,[u("div",I8,H(Le),1),u("div",j8,H(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",{class:"btn-hover-wrap",onClick:Le=>M(Ge)},[m(K(Ut))],8,F8)])]),_:2},1032,["name"])]))),128)),m(le,{onClick:T,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[14]||(j[14]=[U("添加参数",-1)])]),_:1},8,["icon"])]),c.method=="POST"?(w(),R("div",V8,[m(W,{label:"BODY",name:"type",class:"line-height-22"},{default:x(()=>[m(re,{value:c.type,"onUpdate:value":j[2]||(j[2]=pe=>c.type=pe)},{default:x(()=>[m(q,{value:0},{default:x(()=>[...j[16]||(j[16]=[U("none",-1)])]),_:1}),m(q,{value:1},{default:x(()=>[...j[17]||(j[17]=[U("x-www-form-urlencoded",-1)])]),_:1}),m(q,{value:2},{default:x(()=>[...j[18]||(j[18]=[U("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),c.type==1?(w(),R("div",H8,[(w(!0),R(se,null,ge(c.body,(pe,Ge)=>(w(),R("div",{class:"form-item-list",key:Ge},[m(W,{label:null,name:["body",Ge,"value"],rules:{required:!0}},{default:x(()=>[u("div",U8,[m(J,null,{default:x(()=>[m(oe,{style:{width:"120px"},value:pe.key,"onUpdate:value":Le=>pe.key=Le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",z8,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Le=>s(Le,"body",Ge),options:i.value,defaultSelectedList:pe.tags,defaultValue:pe.value,onOpen:l,onChange:(Le,_e)=>a("body",Le,_e,pe,Ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Le,payload:_e})=>[u("div",q8,[u("div",G8,H(Le),1),u("div",X8,H(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",{class:"btn-hover-wrap",onClick:Le=>k(Ge)},[m(K(Ut))],8,W8)])]),_:2},1032,["name"])]))),128)),m(le,{onClick:S,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[19]||(j[19]=[U("添加参数",-1)])]),_:1},8,["icon"])])):ne("",!0),c.type==2?(w(),Q(W,{key:1,label:null,name:"body_raw"},{default:x(()=>[m(tt,{type:"textarea",options:i.value,defaultSelectedList:c.body_raw_tags,defaultValue:c.body_raw,ref:pe=>s(pe,"body","body_raw"),onOpen:l,onChange:j[3]||(j[3]=(pe,Ge)=>a("body_raw",pe,Ge)),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:pe,payload:Ge})=>[u("div",Y8,[u("div",J8,H(pe),1),u("div",K8,H(Ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):ne("",!0)])):ne("",!0),m(W,{name:"timeout"},{label:x(()=>[m(ue,{gap:2},{default:x(()=>[...j[20]||(j[20]=[U("超时时长",-1)])]),_:1})]),default:x(()=>[u("div",Z8,[m(xe,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:c.timeout,"onUpdate:value":j[4]||(j[4]=pe=>c.timeout=pe),min:0,max:3e3},null,8,["value"]),j[21]||(j[21]=U(" 秒 ",-1))])]),_:1})]),u("div",Q8,[u("div",e4,[j[23]||(j[23]=U("鉴权 ",-1)),m(Te,null,{title:x(()=>[...j[22]||(j[22]=[U("鉴权参数：导出模板CSL文件，或者上架模板时，自动清空参数值",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",t4,[j[28]||(j[28]=u("div",{class:"output-block"},[u("div",{class:"output-item",style:{width:"124px"}},"Key"),u("div",{class:"output-item",style:{width:"124px"}},"Value"),u("div",{class:"output-item",style:{width:"124px"}},"Add To")],-1)),u("div",{class:"array-form-box",onMousedown:j[5]||(j[5]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(c.http_auth,(pe,Ge)=>(w(),R("div",{class:"form-item-list",key:Ge},[m(W,{label:null},{default:x(()=>[u("div",n4,[m(oe,{style:{width:"124px"},value:pe.key,"onUpdate:value":Le=>pe.key=Le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(J,null,{default:x(()=>[m(oe,{style:{width:"124px"},value:pe.value,"onUpdate:value":Le=>pe.value=Le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(V,{value:pe.add_to,"onUpdate:value":Le=>pe.add_to=Le,style:{width:"124px"}},{default:x(()=>[m(z,{value:"HEADERS"},{default:x(()=>[...j[24]||(j[24]=[U("HEADERS",-1)])]),_:1}),m(z,{value:"PARAMS"},{default:x(()=>[...j[25]||(j[25]=[U("PARAMS",-1)])]),_:1}),m(z,{value:"BODY"},{default:x(()=>[...j[26]||(j[26]=[U("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),u("div",{class:"btn-hover-wrap",onClick:Le=>F(Ge)},[m(K(Ut))],8,o4)])]),_:2},1024)]))),128)),m(le,{onClick:D,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[27]||(j[27]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])]),u("div",i4,[u("div",{class:"gray-block-title",onClick:j[6]||(j[6]=(...pe)=>L.test&&L.test(...pe))},"输出 (输出字段提取)"),u("div",r4,[j[30]||(j[30]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型")],-1)),u("div",{class:"array-form-box",onMousedown:j[7]||(j[7]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(c.output,(pe,Ge)=>(w(),R("div",{class:"form-item-list",key:Ge},[m(W,{label:null,name:["output",Ge,"key"]},{default:x(()=>[u("div",s4,[m(oe,{style:{width:"214px"},value:pe.key,"onUpdate:value":Le=>pe.key=Le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(J,null,{default:x(()=>[m(V,{onChange:Le=>B(pe),value:pe.typ,"onUpdate:value":Le=>pe.typ=Le,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(se,null,ge(P,Le=>m(z,{value:Le.value,key:Le.value},{default:x(()=>[U(H(Le.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),pe.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:Le=>O(Ge)},[m(K(Bn))],8,a4)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:Le=>$(Ge)},[m(K(Ut))],8,l4)]),pe.subs&&pe.subs.length>0?(w(),R("div",u4,[m(J,null,{default:x(()=>[m(p8,{data:pe.subs,level:2,typOptions:P},null,8,["data"])]),_:2},1024)])):ne("",!0)]),_:2},1032,["name"])]))),128)),m(le,{onClick:A,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[29]||(j[29]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])])]),_:1},8,["model"])])]),m(_8,{ref_key:"parseCurlModalRef",ref:p,onParse:v},null,512),m(x8,{onOk:N,ref_key:"addAuthenticationModalRef",ref:E},null,512)]),_:1})}}},c4=Ne(d4,[["__scopeId","data-v-e6eddfb2"]]),$n={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},E_={string:[$n.EQUALITY.IS,$n.EQUALITY.IS_NOT,$n.TEXT.CONTAIN,$n.TEXT.NOT_CONTAIN,$n.NULLABILITY.EMPTY,$n.NULLABILITY.NOT_EMPTY],integer:[$n.COMPARISON.GT,$n.COMPARISON.LT,$n.COMPARISON.GTE,$n.COMPARISON.LTE,$n.EQUALITY.EQ,$n.COMPARISON.BETWEEN],number:[$n.COMPARISON.GT,$n.COMPARISON.LT,$n.COMPARISON.GTE,$n.COMPARISON.LTE,$n.EQUALITY.EQ,$n.COMPARISON.BETWEEN],boolean:[$n.BOOLEAN.TRUE,$n.BOOLEAN.FALSE]},A_=n=>E_[n]||[],Qc=(n,e)=>{const o=A_(e).find(i=>i.value===n);return(o==null?void 0:o.label)||n},p4={class:"query-condition-filter"},f4={class:"condition-select-box"},h4={class:"select-wrapper"},v4={class:"field-items"},_4={class:"field-select-box"},g4={class:"operator-select-box"},m4={class:"field-value-box"},y4={key:0,class:"site-input-group-wrapper"},b4={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},x4={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},w4=["onClick"],C4={class:"add-btn-box"},k4={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Je({list:o.where,type:o.type});ct(()=>o.where,C=>{r.list=C}),ct(()=>o.type,C=>{r.type=C});const s=We(()=>o.where.length>1),a=We(()=>E_),l=X([]),d=()=>{let C=i().getAllParentVariable();l.value=C||[]},c=()=>{d()},p=()=>{let C={type:r.type,list:r.list};t("change",C)},f=(C,T,M,S)=>{r.list[S].rule_value1=C,r.list[S].atTags=T,p()},h=(C,T,M,S)=>{r.list[S].rule_value2=C,r.list[S].atTags2=T,p()},v=()=>{let C={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list.push(C),p()},y=C=>{r.list.splice(C,1),p()},g=(C,T)=>{let M=A_(T.type),S={form_field_id:T.value,field_name:T.name,field_type:T.type,rule:M[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list[C]=S,p()},_=(C,T)=>{let M=r.list[C];M.rule=T.value,M.rule_value1="",M.rule_value2="",M.atTags=[],M.atTags2=[],p()},b=({key:C})=>{r.type=C,t("changeType",C),p()};return at(()=>{d()}),(C,T)=>{const M=Vr,S=Fr,k=Hr,A=Lt,$=$t,B=en,O=On,P=Xt,E=Zt;return w(),R("div",{class:xt(["query-condition-filter-warpper",{"is-multiple":s.value}])},[u("div",p4,[T[5]||(T[5]=u("div",{class:"auxiliary-line"},null,-1)),u("div",f4,[u("div",h4,[m(k,null,{overlay:x(()=>[m(S,{style:{width:"100px"},onClick:b},{default:x(()=>[(w(),Q(M,{key:1},{default:x(()=>[...T[1]||(T[1]=[u("a",{href:"javascript:;"},"且",-1)])]),_:1})),(w(),Q(M,{key:2},{default:x(()=>[...T[2]||(T[2]=[u("a",{href:"javascript:;"},"或",-1)])]),_:1}))]),_:1})]),default:x(()=>[u("a",{class:"ant-dropdown-link",onClick:T[0]||(T[0]=Ct(()=>{},["prevent"]))},[U(H(r.type==1?"且":"或")+" ",1),m(K(xo))])]),_:1})])]),u("div",v4,[(w(!0),R(se,null,ge(r.list,(D,N)=>(w(),R("div",{class:"field-item",key:D.field},[u("div",_4,[m($,{style:{width:"100px"},value:D.form_field_id,"onUpdate:value":F=>D.form_field_id=F,onChange:(F,Y)=>g(N,Y)},{default:x(()=>[m(A,{value:0,type:"integer",name:"ID",key:"id"},{default:x(()=>[...T[3]||(T[3]=[U("ID",-1)])]),_:1}),(w(!0),R(se,null,ge(o.fieldOptions,F=>(w(),Q(A,{value:F.id,type:F.type,name:F.name,key:F.id},{default:x(()=>[U(H(F.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),u("div",g4,[m($,{value:D.rule,"onUpdate:value":F=>D.rule=F,style:{width:"100px"},onChange:(F,Y)=>_(N,Y)},{default:x(()=>[(w(!0),R(se,null,ge(a.value[D.field_type],F=>(w(),Q(A,{value:F.value,key:F.value},{default:x(()=>[U(H(F.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),u("div",m4,[D.rule==="between"?(w(),R("div",y4,[u("div",b4,[m(tt,{options:l.value,defaultValue:D.rule_value1,defaultSelectedList:D.atTags,onOpen:c,onChange:(F,Y)=>f(F,Y,D,N),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),T[4]||(T[4]=u("span",{class:"site-input-split"},"~",-1)),u("div",x4,[m(tt,{options:l.value,defaultValue:D.rule_value2,defaultSelectedList:D.atTags2,onOpen:c,onChange:(F,Y)=>h(F,Y,D,N),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(D.field_type)?(w(),Q(B,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(D.field_type)?(w(),Q(tt,{key:2,options:l.value,defaultValue:D.rule_value1,defaultSelectedList:D.atTags,onOpen:c,onChange:(F,Y)=>f(F,Y,D,N),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(w(),Q(tt,{key:3,options:l.value,defaultValue:D.rule_value1,defaultSelectedList:D.atTags,onOpen:c,onChange:(F,Y)=>f(F,Y,D,N),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),u("span",{class:"field-del-btn",onClick:F=>y(N)},[m(O,{class:"del-icon",name:"close-circle"})],8,w4)]))),128))])]),u("div",C4,[n.disabled?(w(),Q(E,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[u("span",null,[m(P,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[m(K(Mt)),T[6]||(T[6]=U(" 添加条件 ",-1))]),_:1})])]),_:1})):(w(),Q(P,{key:1,class:"add-btn",type:"dashed",block:"",onClick:v},{default:x(()=>[m(K(Mt)),T[7]||(T[7]=U(" 添加条件 ",-1))]),_:1}))])],2)}}},ep=Ne(k4,[["__scopeId","data-v-c3ccab04"]]),S4={class:"delete-data-form"},E4={class:"node-box-content"},A4={class:"setting-box"},D4={class:"setting-box"},O4={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=Ve("setData"),o=ur();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),s=({type:v,list:y})=>{r.formData.typ=v,r.formData.where=y,d()},a=(v,y)=>{y?(r.formData.form_name=y.name,r.formData.form_description=y.description,h(y.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.where=[]),d()},l=()=>{let v=e.node.dataRaw||"{}";i=JSON.parse(v);let y=c(i.form_delete.where||[]);i.form_delete.where=y,r.formData=i.form_delete,r.formData.form_id&&h(r.formData.form_id),d()},d=()=>{let v={...Xn(r.formData)};v.where=p(v.where),i.form_delete=v,t({...e.node,node_params:JSON.stringify(i)})},c=v=>{let y=[];return v.forEach(g=>{let _=JSON.parse(JSON.stringify(g)),b=_.rule.split("_");_.form_field_id=_.form_field_id*1,_.field_type=b[0],b.shift(),_.rule=b.join("_"),y.push(_)}),y},p=v=>{let y=[];return v.forEach(g=>{let _=JSON.parse(JSON.stringify(g));_.form_field_id=_.form_field_id*1,_.rule=g.field_type+"_"+g.rule,y.push(_)}),y},f=async()=>{const v=await o.getFormList();v&&(r.tableList=v)},h=async v=>{o.getFormFieldList({form_id:v}).then(y=>{y.forEach(g=>{g.id=g.id*1}),r.fieldList=y}).catch(()=>{})};return at(()=>{f(),l()}),(v,y)=>(w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...y[1]||(y[1]=[u("span",null,[U("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),u("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",S4,[u("div",E4,[y[2]||(y[2]=u("div",{class:"node-box-title"},[u("img",{class:"input-icon",src:Yn,alt:""}),u("span",{class:"text"},"输入")],-1)),y[3]||(y[3]=u("div",{class:"setting-label"},[u("span",null,"数据表")],-1)),u("div",A4,[m(ju,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":y[0]||(y[0]=g=>r.formData.form_id=g),onChange:a},null,8,["options","title","description","value"])]),y[4]||(y[4]=u("div",{class:"setting-label"},[u("span",null,"删除条件")],-1)),u("div",D4,[m(ep,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},N4=Ne(O4,[["__scopeId","data-v-35e370b4"]]),M4={class:"variable-node"},T4={class:"node-form-content"},$4={class:"gray-block"},R4={class:"field-items"},P4={class:"field-name-box"},L4={class:"field-value-box"},B4={class:"field-value-option"},I4={class:"option-label"},j4={class:"option-type"},F4={class:"field-actions"},V4={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]),r=X([]);function s(){const _=o.lf.getNodeModelById(o.nodeId);if(_){let b=_.properties.loop_parent_key;if(b){const M=o.lf.getNodeModelById(b);if(M){let S=M.properties.dataRaw||M.properties.node_params||"{}",k=JSON.parse(S).loop||{};r.value=k.intermediate_params.map(A=>({label:A.key,value:b+"."+A.key}));return}}let T=_.getGlobalVariable().diy_global||[];T.forEach(M=>{M.label=M.key,M.value="global."+M.key}),r.value=T||[]}}function a(){const _=o.lf.getNodeModelById(o.nodeId);if(_){let b=_.getAllParentVariable();i.value=b}}const l=X([]),d=()=>{let _=JSON.parse(o.node.node_params);_.assign=[...l.value],t("update-node",{...o.node,node_params:JSON.stringify(_)})},c=()=>{try{let _=o.node.dataRaw||o.node.node_params||"{}",b=JSON.parse(_).assign||[];b=JSON.parse(JSON.stringify(b)),b.forEach(C=>{C.tags=C.tags||[]}),l.value=b,s()}catch(_){}},p=_=>{_&&a()},f=(_,b,C)=>{C.tags=b,C.value=_,d()},h=()=>{l.value.push({variable:void 0,value:""}),d()},v=_=>{l.value.splice(_,1),d()},y=_=>{_&&s()},g=()=>{t("close")};return at(()=>{c()}),(_,b)=>{const C=Lt,T=$t,M=Xt;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:g},null,8,["title","iconName"])]),default:x(()=>[u("div",M4,[u("div",T4,[u("div",$4,[u("div",R4,[(w(!0),R(se,null,ge(l.value,(S,k)=>(w(),R("div",{class:"field-item",key:k},[u("div",P4,[m(T,{style:{width:"100%"},placeholder:"请输入选择变量",value:S.variable,"onUpdate:value":A=>S.variable=A,onDropdownVisibleChange:y,onChange:d},{default:x(()=>[(w(!0),R(se,null,ge(r.value,A=>(w(),Q(C,{value:A.value,key:A.key},{default:x(()=>[u("span",null,H(A.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])]),u("div",L4,[m(tt,{ref_for:!0,ref:"atInput"+k,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:S.tags,defaultValue:S.value,onOpen:p,onChange:(A,$)=>f(A,$,S,k),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:A,payload:$})=>[u("div",B4,[u("div",I4,H(A),1),u("div",j4,H($.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",F4,[m(K(Ut),{class:"action-btn",onClick:A=>v(k)},null,8,["onClick"])])]))),128))]),u("div",null,[m(M,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:h},{icon:x(()=>[m(K(Mt))]),default:x(()=>[b[0]||(b[0]=U(" 添加赋值变量 ",-1))]),_:1})])])])])]),_:1})}}},H4=Ne(V4,[["__scopeId","data-v-c70b3834"]]),U4={class:"update-data-form"},z4={class:"node-box-content"},q4={class:"setting-box"},G4={class:"setting-box"},X4={class:"setting-box"},W4={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=ur();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),s=({type:y,list:g})=>{r.formData.typ=y,r.formData.where=g,c()},a=(y,g)=>{g?(r.formData.form_name=g.name,r.formData.form_description=g.description,v(g.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.datas=[],r.formData.where=[],r.formData.typ=1),c()},l=y=>{r.formData.datas=y,c()},d=()=>{let y=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(y);let g=p(i.form_update.where||[]);i.form_update.where=g,r.formData=i.form_update,r.formData.form_id&&v(r.formData.form_id),c()},c=()=>{let y={...Xn(r.formData)};y.where=f(y.where),i.form_update=y,t({...e.node,node_params:JSON.stringify(i)})},p=y=>{let g=[];return y.forEach(_=>{let b=JSON.parse(JSON.stringify(_)),C=b.rule.split("_");b.form_field_id=b.form_field_id*1,b.field_type=C[0],C.shift(),b.rule=C.join("_"),g.push(b)}),g},f=y=>{let g=[];return y.forEach(_=>{let b=JSON.parse(JSON.stringify(_));b.form_field_id=b.form_field_id*1,b.rule=_.field_type+"_"+_.rule,g.push(b)}),g},h=async()=>{const y=await o.getFormList();y&&(r.tableList=y)},v=async y=>{o.getFormFieldList({form_id:y}).then(g=>{g.forEach(_=>{_.id=_.id*1}),r.fieldList=g}).catch(()=>{})};return at(()=>{h(),d()}),(y,g)=>(w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...g[1]||(g[1]=[u("span",null,[U("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),u("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",U4,[u("div",z4,[g[2]||(g[2]=u("div",{class:"node-box-title"},[u("img",{class:"input-icon",src:Yn,alt:""}),u("span",{class:"text"},"输入")],-1)),g[3]||(g[3]=u("div",{class:"setting-label"},[u("span",null,"数据表")],-1)),u("div",q4,[m(ju,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":g[0]||(g[0]=_=>r.formData.form_id=_),onChange:a},null,8,["options","title","description","value"])]),g[4]||(g[4]=u("div",{class:"setting-label"},[u("span",null,"更新条件")],-1)),u("div",G4,[m(ep,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])]),g[5]||(g[5]=u("div",{class:"setting-label"},[u("span",null,"更新数据")],-1)),u("div",X4,[m(Zc,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showEmptyFieldRow:r.formData.form_id=="",list:r.formData.datas,onChange:l},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},Y4=Ne(W4,[["__scopeId","data-v-60a76ec1"]]),D_={__name:"add-params-modal",emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=X("新增参数");let s="add";const a=(_,b)=>b?/^[a-zA-Z_]+$/.test(b)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let l=0;const d=Je({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),c=()=>{i.value=!0},p=()=>{Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="add",r.value="新增参数",i.value=!0},f=_=>{l=_,Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="addSub",r.value="新增参数",i.value=!0},h=(_,b)=>{l=b,Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(d,{..._}),s="edit",r.value="编辑参数",i.value=!0},v=X(null),y=()=>{v.value.validate().then(()=>{s=="add"&&o("add",{...d}),s=="addSub"&&o("addSub",{...d},l),s=="edit"&&o("edit",{...d},l),i.value=!1})},g=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:c,add:p,edit:h,addSub:f}),(_,b)=>{const C=en,T=Cn,M=Lt,S=$t,k=Fi,A=Vi,$=xn,B=_n;return w(),R("div",null,[m(B,{open:i.value,"onUpdate:open":b[5]||(b[5]=O=>i.value=O),title:r.value,onOk:y,width:472,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[m($,{ref_key:"formRef",ref:v,layout:"vertical",model:d,style:{margin:"24px 0"}},{default:x(()=>[m(T,{label:"参数key",name:"key",rules:[{required:!0,validator:(O,P)=>a(O,P)}]},{default:x(()=>[m(C,{value:d.key,"onUpdate:value":b[0]||(b[0]=O=>d.key=O),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),m(T,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:x(()=>[m(S,{value:d.typ,"onUpdate:value":b[1]||(b[1]=O=>d.typ=O),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(),R(se,null,ge(g,O=>m(M,{value:O.value},{default:x(()=>[U(H(O.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),m(T,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:x(()=>[m(k,{checked:d.required,"onUpdate:checked":b[2]||(b[2]=O=>d.required=O)},null,8,["checked"])]),_:1}),m(T,{label:"默认值",name:"default",rules:[{required:d.required,message:"请输入默认值"}]},{default:x(()=>[m(C,{value:d.default,"onUpdate:value":b[3]||(b[3]=O=>d.default=O),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),m(T,{label:"枚举值",name:"enum"},{default:x(()=>[m(A,{style:{height:"80px"},value:d.enum,"onUpdate:value":b[4]||(b[4]=O=>d.enum=O),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},J4={class:"sub-field-item"},K4=["onClick"],Z4=["onClick"],Q4=["onClick"],eM={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=We(()=>e.level>2?e.typOptions.filter(h=>h.value!="object"):e.typOptions),o=We(()=>e.level==2?"180px":"146px");let i=0;const r=(h,v)=>{v.splice(h,1)},s=h=>{h.subs=[]},a=X(null),l=h=>{i=h,a.value.add()},d=(h,v)=>{a.value.edit(h,v)},c=h=>{e.data[i].subs.push(h)},p=(h,v)=>{e.data.splice(v,1,h)},f=h=>h.typ=="object"&&e.level<=2;return(h,v)=>{const y=en,g=Lt,_=$t,b=Pt("SubsKey",!0);return w(),R(se,null,[(w(!0),R(se,null,ge(e.data,(C,T)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:C.cu_key},[u("div",J4,[v[0]||(v[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(y,{class:"mr12",style:Fn({width:o.value}),value:C.key,"onUpdate:value":M=>C.key=M,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),v[1]||(v[1]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(_,{class:"mr12",onChange:M=>s(C),value:C.typ,"onUpdate:value":M=>C.typ=M,placeholder:"请选择",style:Fn({width:o.value})},{default:x(()=>[(w(!0),R(se,null,ge(t.value,M=>(w(),Q(g,{value:M.value},{default:x(()=>[U(H(M.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),f(C)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:M=>l(T,e.data)},[m(K(Bn))],8,K4)):ne("",!0),u("div",{class:"btn-hover-wrap mr12",onClick:M=>d(C,T)},[m(K(Dr))],8,Z4),u("div",{class:"btn-hover-wrap",onClick:M=>r(T,e.data)},[m(K(Ut))],8,Q4)]),C.subs&&C.subs.length>0?(w(),Q(b,{key:0,level:e.level+1,typOptions:e.typOptions,data:C.subs},null,8,["level","typOptions","data"])):ne("",!0)],2))),128)),m(D_,{onAdd:c,onEdit:p,ref_key:"addParamsModalRef",ref:a},null,512)],64)}}},tM=Ne(eM,[["__scopeId","data-v-f6bf59d5"]]),nM={class:"problem-optimization-form"},oM={class:"node-form-content"},iM={class:"gray-block"},rM={class:"flex-block-item"},sM={class:"number-box"},aM={class:"number-slider-box"},lM={class:"number-input-box"},uM={class:"number-box"},dM={class:"number-slider-box"},cM={class:"number-input-box"},pM={class:"number-box"},fM={class:"number-box"},hM={class:"number-slider-box"},vM={class:"number-input-box"},_M={class:"field-list-item"},gM={class:"field-label"},mM={class:"field-type"},yM={class:"diy-form-item"},bM={class:"form-content"},xM={class:"gray-block mt16"},wM={class:"output-box"},CM={class:"array-form-box"},kM={class:"flex-block-item",style:{gap:"12px"}},SM=["onClick"],EM=["onClick"],AM=["onClick"],DM={key:0,class:"sub-field-box"},OM={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Vn(),r=X(null),s=We(()=>i.modelList),a=X([]),l=X([]),d=X(!1),c=()=>{d.value=!d.value},p=(z,V)=>{_.prompt=z,_.prompt_tags=V};function f(){const z=o.lf.getNodeModelById(o.nodeId);if(z){let V=z.getAllParentVariable();l.value=h(V)}}function h(z){return z.forEach(V=>{V.typ=="node"?V.node_type==1?V.value="global":V.value=V.node_id:V.value=V.key,V.children&&V.children.length>0&&(V.children=h(V.children))}),z}const v=()=>{const z=o.lf.getNodeModelById(o.nodeId);if(z){let V=z.getAllParentVariable();a.value=V}};function y(z){if(z){let V=z.split("."),J=V[0],oe=V.filter((W,q)=>q>0).join(".");return[J,oe]}return["global","question"]}const g=X(),_=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[],role:1}),b=()=>{_.use_model&&_.use_model.toLowerCase().includes("deepseek-r1")?_.role=2:_.role=1},C=()=>{const z=JSON.stringify({params_extractor:{..._,question_value:_.question_value.join("."),model_config_id:_.model_config_id?+_.model_config_id:_.model_config_id}});t("update-node",{...o.node,..._,node_params:z})},T=()=>{try{let z=o.node.dataRaw||o.node.node_params||"{}",V=JSON.parse(z).params_extractor||{};V=JSON.parse(JSON.stringify(V)),v(),f();for(let J in V){if(J=="output"){_.output=M(V[J]);continue}if(J=="question_value"){_.question_value=y(V[J]);continue}_[J]=V[J]}_.role=+V.role||1,!_.model_config_id&&s.value.length>0&&(_.model_config_id=s.value[0].id,_.use_model=s.value[0].children[0].name)}catch(z){}};ct(()=>_,()=>{C()},{deep:!0});function M(z){return z.forEach(V=>{V.cu_key=Math.random()*1e4,V.subs&&V.subs.length?M(V.subs):V.subs=[]}),z}const S=X(null),k=()=>{S.value.add()},A=(z,V)=>{S.value.edit(z,V)},$=z=>{_.output.push(z)},B=(z,V)=>{_.output.splice(V,1,z)},O=z=>{_.output.splice(z,1)},P=z=>{z.subs=[]},E=z=>{S.value.addSub(z)},D=(z,V)=>{_.output[V].subs.push(z)},N=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],F=z=>{z||f()},Y=X({}),L=(z,V)=>{Y.value=V},j=We(()=>{if(!_.model_config_id)return!1;let z=_.model_config_id+"#"+_.use_model;return Y.value[z]}),le=()=>{t("close")};return at(()=>{T()}),(z,V)=>{const J=Xt,oe=Cn,W=Zt,q=ro,re=io,ue=$s,xe=In,Te=Mn,me=Fi,pe=li,Ge=en,Le=Lt,_e=$t,he=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:le},null,8,["title","iconName"])]),default:x(()=>[u("div",nM,[u("div",oM,[m(he,{ref_key:"formRef",ref:g,layout:"vertical",model:_},{default:x(()=>[u("div",iM,[V[29]||(V[29]=u("div",{class:"gray-block-title"},"输入",-1)),m(oe,{label:"LLM模型",name:"use_model"},{default:x(()=>[u("div",rM,[m(lr,{modelType:"LLM",modeName:_.use_model,"onUpdate:modeName":V[0]||(V[0]=be=>_.use_model=be),modeId:_.model_config_id,"onUpdate:modeId":V[1]||(V[1]=be=>_.model_config_id=be),onLoaded:L,onChange:b,style:{width:"348px"}},null,8,["modeName","modeId"]),m(J,{onClick:c},{default:x(()=>[V[13]||(V[13]=U("高级设置 ",-1)),d.value?(w(),Q(K(xo),{key:0})):(w(),Q(K(Ua),{key:1}))]),_:1})])]),_:1}),d.value?(w(),Q(oe,{key:0,name:"role"},{label:x(()=>[V[15]||(V[15]=u("span",null,"提示词所属角色 ",-1)),m(W,null,{title:x(()=>[...V[14]||(V[14]=[u("div",null,[U(" 对接大模型时，会将设置中的提示词拼接在对应的role角色下。 "),u("div",null,"系统角色效果示例："),u("div",null,'{"role": "system", "content": "自定义提示词"}')],-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[m(re,{value:_.role,"onUpdate:value":V[2]||(V[2]=be=>_.role=be)},{default:x(()=>[m(q,{value:1},{default:x(()=>[...V[16]||(V[16]=[U("系统角色（System）",-1)])]),_:1}),m(q,{value:2},{default:x(()=>[...V[17]||(V[17]=[U("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):ne("",!0),d.value?(w(),Q(oe,{key:1,name:"temperature"},{label:x(()=>[V[19]||(V[19]=u("span",null,"温度 ",-1)),m(W,null,{title:x(()=>[...V[18]||(V[18]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",sM,[u("div",aM,[m(xe,null,{default:x(()=>[m(ue,{class:"custom-slider",value:_.temperature,"onUpdate:value":V[3]||(V[3]=be=>_.temperature=be),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),u("div",lM,[m(Te,{value:_.temperature,"onUpdate:value":V[4]||(V[4]=be=>_.temperature=be),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ne("",!0),d.value?(w(),Q(oe,{key:2,name:"max_token"},{label:x(()=>[V[21]||(V[21]=u("span",null,"最大token ",-1)),m(W,null,{title:x(()=>[...V[20]||(V[20]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",uM,[u("div",dM,[m(xe,null,{default:x(()=>[m(ue,{class:"custom-slider",value:_.max_token,"onUpdate:value":V[5]||(V[5]=be=>_.max_token=be),min:0,max:100*1024},null,8,["value"])]),_:1})]),u("div",cM,[m(Te,{value:_.max_token,"onUpdate:value":V[6]||(V[6]=be=>_.max_token=be),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ne("",!0),d.value&&j.value?(w(),Q(oe,{key:3,name:"enable_thinking"},{label:x(()=>[V[23]||(V[23]=u("span",null,"深度思考 ",-1)),m(W,null,{title:x(()=>[...V[22]||(V[22]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",pM,[m(me,{checked:_.enable_thinking,"onUpdate:checked":V[7]||(V[7]=be=>_.enable_thinking=be)},null,8,["checked"])])]),_:1})):ne("",!0),m(oe,{name:"context_pair"},{label:x(()=>[V[25]||(V[25]=u("span",null,"上下文数量 ",-1)),m(W,null,{title:x(()=>[...V[24]||(V[24]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",fM,[u("div",hM,[m(xe,null,{default:x(()=>[m(ue,{class:"custom-slider",value:_.context_pair,"onUpdate:value":V[8]||(V[8]=be=>_.context_pair=be),min:0,max:50},null,8,["value"])]),_:1})]),u("div",vM,[m(Te,{value:_.context_pair,"onUpdate:value":V[9]||(V[9]=be=>_.context_pair=be),min:0,max:50},null,8,["value"])])])]),_:1}),m(oe,{name:"prompt",class:"width-100"},{label:x(()=>[...V[26]||(V[26]=[u("div",{class:"space-between-box"},[u("div",null,"提示词")],-1)])]),default:x(()=>[m(tt,{type:"textarea",inputStyle:"height: 100px;",options:a.value,defaultSelectedList:_.prompt_tags,defaultValue:_.prompt,ref_key:"atInputRef",ref:r,onOpen:v,onChange:V[10]||(V[10]=(be,De)=>p(be,De)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:x(({label:be,payload:De})=>[u("div",_M,[u("div",gM,H(be),1),u("div",mM,H(De.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),V[27]||(V[27]=u("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),u("div",yM,[V[28]||(V[28]=u("div",{class:"form-label"},"用户问题",-1)),u("div",bM,[m(pe,{value:_.question_value,"onUpdate:value":V[11]||(V[11]=be=>_.question_value=be),onDropdownVisibleChange:F,style:{width:"220px"},options:l.value,allowClear:!1,displayRender:({labels:be})=>be.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),u("div",xM,[u("div",{class:"gray-block-title",onClick:V[12]||(V[12]=(...be)=>z.test&&z.test(...be))},"输出 (输出字段提取)"),u("div",wM,[V[31]||(V[31]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型")],-1)),u("div",CM,[(w(!0),R(se,null,ge(_.output,(be,De)=>(w(),R("div",{class:"form-item-list",key:De},[m(oe,{label:null,name:["output",De,"key"]},{default:x(()=>[u("div",kM,[m(Ge,{style:{width:"214px"},value:be.key,"onUpdate:value":G=>be.key=G,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(xe,null,{default:x(()=>[m(_e,{onChange:G=>P(be),value:be.typ,"onUpdate:value":G=>be.typ=G,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(se,null,ge(N,G=>m(Le,{value:G.value,key:G.value},{default:x(()=>[U(H(G.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),be.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:G=>E(De)},[m(K(Bn))],8,SM)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:G=>A(be,De)},[m(K(Dr))],8,EM),u("div",{class:"btn-hover-wrap",onClick:G=>O(De)},[m(K(Ut))],8,AM)]),be.subs&&be.subs.length>0?(w(),R("div",DM,[m(xe,null,{default:x(()=>[m(tM,{data:be.subs,level:2,typOptions:N},null,8,["data"])]),_:2},1024)])):ne("",!0)]),_:2},1032,["name"])]))),128)),m(J,{onClick:k,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...V[30]||(V[30]=[U("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])]),m(D_,{onAdd:$,onEdit:B,onAddSub:D,ref_key:"addParamsModalRef",ref:S},null,512)])]),_:1})}}},NM=Ne(OM,[["__scopeId","data-v-1662c409"]]),to="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",MM={class:"collapse-panel-warpper"},TM={class:"collapse-panel-header"},$M={class:"title-text"},RM={class:"collapse-panel-body"},PM={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(n){const t=X(n.defaultCollapsed),o=()=>{t.value=!t.value};return(i,r)=>{const s=On;return w(),R("div",MM,[u("div",TM,[u("div",{class:"collapse-panel-title",onClick:Ct(o,["stop"])},[u("span",$M,[U(H(n.title)+" ",1),n.count?(w(),R(se,{key:0},[U("（"+H(n.count)+"）",1)],64)):ne("",!0)]),m(s,{name:"arrow-down",class:xt(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])]),u("div",null,[bi(i.$slots,"extra",{},void 0,!0)])]),ri(u("div",RM,[bi(i.$slots,"default",{},void 0,!0)],512),[[Si,!t.value]])])}}},us=Ne(PM,[["__scopeId","data-v-1e5a3402"]]),LM={class:"field-select-box"},BM={key:0,class:"field-list-box"},IM={key:1,class:"empty-box"},jM={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=Je({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),r=X([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),s=X([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),a=(c,p)=>{i.selectedRowKeys=c,i.selectedRows=p},l=({formId:c,selectedRowKeys:p,selectedRows:f})=>{i.formId=c,i.selectedRowKeys=p,i.selectedRows=f,i.show=!0},d=()=>{o("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:l}),(c,p)=>{const f=Ur,h=_n;return w(),Q(h,{width:"746px",open:i.show,"onUpdate:open":p[1]||(p[1]=v=>i.show=v),title:"关联数据表",onOk:d,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[u("div",LM,[s.value.length?(w(),R("div",BM,[m(f,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:a},dataSource:s.value,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):ne("",!0),s.value.length?ne("",!0):(w(),R("div",IM,[p[3]||(p[3]=u("img",{src:Xa,alt:""},null,-1)),u("div",null,[p[2]||(p[2]=U(" 暂无字段, 请先去数据表添加 ",-1)),u("a",{onClick:p[0]||(p[0]=(...v)=>c.openAddLibrary&&c.openAddLibrary(...v))}," 去添加")])]))])]),_:1},8,["open"])}}},FM=Ne(jM,[["__scopeId","data-v-e0fc750c"]]),VM={class:"field-list"},HM={class:"field-list-col field-drag-col"},UM={class:"drag-btn"},zM={class:"field-list-col field-name-col"},qM={class:"field-name-box"},GM={class:"field-name"},XM={class:"field-type-tag"},WM={class:"field-list-col field-value-col"},YM={key:0,class:"field-list-col field-del-col"},JM={class:"add-btn-box"},KM={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],r=X([]);ct(()=>o.list,f=>{r.value=f.map(h=>({...h,is_asc:h.is_asc?1:0}))});const s=f=>{r.value.splice(f,1),d()},a=(f,h)=>{r.value=h.map(v=>({...v})),d()},l=()=>{d()},d=()=>{let f=r.value.map(h=>({...h,is_asc:h.is_asc==1}));t("change",f)},c=X(),p=()=>{c.value.open({formId:o.formId,selectedRows:o.list,selectedRowKeys:o.list.map(f=>f.name)})};return(f,h)=>{const v=Lt,y=$t,g=On,_=Xt,b=Zt;return w(),R("div",null,[u("div",VM,[(w(!0),R(se,null,ge(r.value,C=>(w(),R("div",{class:"field-list-row",key:C.name},[u("div",HM,[u("span",UM,[m(K(Xc))])]),u("div",zM,[u("div",qM,[u("span",GM,H(C.name),1),u("span",XM,H(C.type),1)])]),u("div",WM,[m(y,{value:C.is_asc,"onUpdate:value":T=>C.is_asc=T,style:{width:"100%"},onChange:l},{default:x(()=>[(w(),R(se,null,ge(i,T=>m(v,{value:T.value,key:T.key},{default:x(()=>[U(H(T.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),o.showDelete?(w(),R("div",YM,[u("span",{class:"del-btn",onClick:h[0]||(h[0]=T=>s(f.index))},[m(g,{class:"del-icon",name:"close-circle"})])])):ne("",!0)]))),128))]),u("div",JM,[n.disabled?(w(),Q(b,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[u("span",null,[m(_,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[m(K(Mt)),h[1]||(h[1]=U(" 添加排序字段 ",-1))]),_:1})])]),_:1})):(w(),Q(_,{key:1,class:"add-btn",type:"dashed",block:"",onClick:p},{default:x(()=>[m(K(Mt)),h[2]||(h[2]=U(" 添加排序字段 ",-1))]),_:1}))]),m(FM,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:c,onOk:a},null,8,["formId"])])}}},ZM=Ne(KM,[["__scopeId","data-v-fbdcd109"]]),QM={class:"field-item"},eT={class:"field-name"},tT={class:"field-type"},nT={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=X([]);return(o,i)=>{const r=On,s=Wc;return w(),R("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=Ct(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=Ct(()=>{},["stop"]))},[m(s,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=a=>t.value=a),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:x(({switcherCls:a})=>[u("span",{class:xt(a)},[m(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:a})=>[u("div",QM,[u("span",eT,H(a.title),1),u("span",tT,H(a.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},oT=Ne(nT,[["__scopeId","data-v-2c5047db"]]),iT={class:"select-data-form"},rT={class:"node-box-content"},sT={class:"setting-box"},aT={class:"setting-box"},lT={class:"node-box-content"},uT={class:"setting-box"},dT={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=n,t=Ve("setData"),o=ur();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),s=We(()=>[{title:"output_list",key:"output_list",type:"array<object>",children:r.formData.fields.map(C=>({title:C.name,key:C.name,type:C.type}))},{title:"row_num",key:"row_num",type:"integer"}]),a=({type:b,list:C})=>{r.formData.typ=b,r.formData.where=C,h()},l=b=>{r.formData.order=[...b],h()},d=(b,C)=>{C?(r.formData.form_name=C.name,r.formData.form_description=C.description,_(C.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.typ=1,r.formData.fields=[],r.formData.where=[],r.formData.order=[],r.formData.limit=100),h()},c=b=>{r.formData.fields=b,h()},p=()=>{h()},f=()=>{let b=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(b);let C=v(i.form_select.where||[]);i.form_select.where=C,r.formData=i.form_select,r.formData.form_id&&_(r.formData.form_id),h()},h=()=>{let b={...Xn(r.formData)};b.where=y(b.where),i.form_select=b,t({...e.node,node_params:JSON.stringify(i)})},v=b=>{let C=[];return b.forEach(T=>{let M=JSON.parse(JSON.stringify(T)),S=M.rule.split("_");M.form_field_id=M.form_field_id*1,M.field_type=S[0],S.shift(),M.rule=S.join("_"),C.push(M)}),C},y=b=>{let C=[];return b.forEach(T=>{let M=JSON.parse(JSON.stringify(T));M.form_field_id=M.form_field_id*1,M.rule=T.field_type+"_"+T.rule,C.push(M)}),C},g=async()=>{const b=await o.getFormList();b&&(r.tableList=b)},_=async b=>{o.getFormFieldList({form_id:b}).then(C=>{C.forEach(T=>{T.id=T.id*1}),r.fieldList=C}).catch(()=>{})};return at(()=>{g(),f()}),(b,C)=>{const T=Mn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...C[8]||(C[8]=[u("span",null,[U("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),u("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",iT,[u("div",rT,[C[9]||(C[9]=u("div",{class:"node-box-title"},[u("img",{class:"input-icon",src:Yn,alt:""}),u("span",{class:"text"},"输入")],-1)),C[10]||(C[10]=u("div",{class:"setting-label"},[u("span",null,"数据表")],-1)),u("div",sT,[m(ju,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":C[0]||(C[0]=M=>r.formData.form_id=M),onChange:d},null,8,["options","title","description","value"])]),u("div",aT,[m(us,{title:"查询条件",count:r.formData.where.length},{default:x(()=>[m(ep,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),u("div",{class:"setting-box",onWheel:C[1]||(C[1]=Ct(()=>{},["stop"])),onTouchmove:C[2]||(C[2]=Ct(()=>{},["stop"]))},[m(us,{title:"查询字段",count:r.formData.fields.length},{default:x(()=>[m(Zc,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showInput:!1,showEmptyFieldRow:r.formData.form_id=="",list:r.formData.fields,onChange:c},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),u("div",{class:"setting-box",onWheel:C[3]||(C[3]=Ct(()=>{},["stop"])),onTouchmove:C[4]||(C[4]=Ct(()=>{},["stop"]))},[m(us,{title:"排序",count:r.formData.order.length},{default:x(()=>[m(ZM,{"form-id":r.formData.form_id,disabled:!r.formData.form_id,list:r.formData.order,onChange:l},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),C[11]||(C[11]=u("div",{class:"setting-label"},[u("span",null,"查询数量")],-1)),u("div",{class:"setting-box",onWheel:C[6]||(C[6]=Ct(()=>{},["stop"])),onTouchmove:C[7]||(C[7]=Ct(()=>{},["stop"]))},[m(T,{min:1,max:1e3,value:r.formData.limit,"onUpdate:value":C[5]||(C[5]=M=>r.formData.limit=M),disabled:!r.formData.form_id,style:{width:"205px"},onChange:p},null,8,["value","disabled"])],32)]),u("div",lT,[C[12]||(C[12]=u("div",{class:"node-box-title"},[u("img",{class:"input-icon",src:to,alt:""}),u("span",{class:"text"},"输出")],-1)),u("div",uT,[m(oT,{treeData:s.value},null,8,["treeData"])])])])]),_:1})}}},cT=Ne(dT,[["__scopeId","data-v-2499b36b"]]),pT={class:"problem-optimization-form"},fT={class:"gray-block"},hT={class:"flex-block-item"},vT={class:"number-box"},_T={class:"number-slider-box"},gT={class:"number-input-box"},mT={class:"number-box"},yT={class:"number-slider-box"},bT={class:"number-input-box"},xT={class:"number-box"},wT={class:"number-box"},CT={class:"number-slider-box"},kT={class:"number-input-box"},ST={class:"diy-form-item"},ET={class:"form-content"},AT={class:"gray-block mt16"},DT={class:"array-form-box"},OT={class:"flex-block-item"},NT=["onClick"],MT={class:"form-item-list"},TT={class:"flex-block-item"},$T={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Vn(),s=We(()=>r.modelList),a=X(!1),l=()=>{a.value=!a.value},d=X(),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,categorys:[],role:1}),p=()=>{c.use_model&&c.use_model.toLowerCase().includes("deepseek-r1")?c.role=2:c.role=1},f=X([]);function h(){let B=i().getAllParentVariable();f.value=v(B)}function v(B){return B.forEach(O=>{O.typ=="node"?O.node_type==1?O.value="global":O.value=O.node_id:O.value=O.key,O.children&&O.children.length>0&&(O.children=v(O.children))}),B}const y=B=>{B||h()};function g(B){if(B){let O=B.split("."),P=O[0],E=O.filter((D,N)=>N>0).join(".");return[P,E]}return["global","question"]}const _=()=>{const B=c.model_config_id?+c.model_config_id:c.model_config_id,O=JSON.stringify({cate:{...c,question_value:c.question_value.join("."),model_config_id:B}});t("update-node",{...o.node,...c,node_params:O})},b=()=>{h();try{let B=o.node.dataRaw||o.node.node_params||"{}",O=JSON.parse(B).cate||{};O=JSON.parse(JSON.stringify(O));for(let P in O)if(P==="question_value")c.question_value=g(O.question_value);else if(P=="categorys")if(O.categorys&&O.categorys.length>0){let E=O.categorys.map(D=>({...D}));c[P]=E}else c[P]=[{category:"",next_node_key:"",key:Ht(16)}];else c[P]=O[P];c.role=+O.role||1,!c.model_config_id&&s.value.length>0&&(c.model_config_id=s.value[0].id,c.use_model=s.value[0].children[0].name)}catch(B){}};ct(()=>c,()=>{_()},{deep:!0});const C=()=>{c.categorys.push({category:"",next_node_key:"",key:Ht(16)})},T=B=>{c.categorys.splice(B,1)},M=()=>Promise.resolve(),S=X({}),k=(B,O)=>{S.value=O},A=We(()=>{if(!c.model_config_id)return!1;let B=c.model_config_id+"#"+c.use_model;return S.value[B]}),$=()=>{t("close")};return at(()=>{b()}),(B,O)=>{const P=Xt,E=Cn,D=Zt,N=ro,F=io,Y=$s,L=In,j=Mn,le=Fi,z=li,V=en,J=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:$},null,8,["title","iconName"])]),default:x(()=>[u("div",pT,[u("div",{class:"node-form-content",onMousedown:O[11]||(O[11]=Ct(()=>{},["stop"]))},[m(J,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:x(()=>[u("div",fT,[O[26]||(O[26]=u("div",{class:"gray-block-title"},"输入",-1)),m(E,{label:"LLM模型",name:"use_model"},{default:x(()=>[u("div",hT,[m(lr,{modelType:"LLM",modeName:c.use_model,"onUpdate:modeName":O[0]||(O[0]=oe=>c.use_model=oe),modeId:c.model_config_id,"onUpdate:modeId":O[1]||(O[1]=oe=>c.model_config_id=oe),onLoaded:k,onChange:p,style:{width:"348px"}},null,8,["modeName","modeId"]),m(P,{onClick:l},{default:x(()=>[O[12]||(O[12]=U("高级设置 ",-1)),a.value?(w(),Q(K(xo),{key:0})):(w(),Q(K(Ua),{key:1}))]),_:1})])]),_:1}),a.value?(w(),Q(E,{key:0,name:"role"},{label:x(()=>[O[14]||(O[14]=u("span",null,"提示词所属角色 ",-1)),m(D,null,{title:x(()=>[...O[13]||(O[13]=[u("div",null,[U(" 对接大模型时，会将设置中的提示词拼接在对应的role角色下。 "),u("div",null,"系统角色效果示例："),u("div",null,'{"role": "system", "content": "自定义提示词"}')],-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[m(F,{value:c.role,"onUpdate:value":O[2]||(O[2]=oe=>c.role=oe)},{default:x(()=>[m(N,{value:1},{default:x(()=>[...O[15]||(O[15]=[U("系统角色（System）",-1)])]),_:1}),m(N,{value:2},{default:x(()=>[...O[16]||(O[16]=[U("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):ne("",!0),a.value?(w(),Q(E,{key:1,name:"temperature"},{label:x(()=>[O[18]||(O[18]=u("span",null,"温度 ",-1)),m(D,null,{title:x(()=>[...O[17]||(O[17]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",vT,[u("div",_T,[m(L,null,{default:x(()=>[m(Y,{class:"custom-slider",value:c.temperature,"onUpdate:value":O[3]||(O[3]=oe=>c.temperature=oe),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),u("div",gT,[m(j,{value:c.temperature,"onUpdate:value":O[4]||(O[4]=oe=>c.temperature=oe),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ne("",!0),a.value?(w(),Q(E,{key:2,name:"max_token"},{label:x(()=>[O[20]||(O[20]=u("span",null,"最大token ",-1)),m(D,null,{title:x(()=>[...O[19]||(O[19]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",mT,[u("div",yT,[m(L,null,{default:x(()=>[m(Y,{class:"custom-slider",value:c.max_token,"onUpdate:value":O[5]||(O[5]=oe=>c.max_token=oe),min:0,max:100*1024},null,8,["value"])]),_:1})]),u("div",bT,[m(j,{value:c.max_token,"onUpdate:value":O[6]||(O[6]=oe=>c.max_token=oe),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ne("",!0),a.value&&A.value?(w(),Q(E,{key:3,name:"enable_thinking"},{label:x(()=>[O[22]||(O[22]=u("span",null,"深度思考 ",-1)),m(D,null,{title:x(()=>[...O[21]||(O[21]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",xT,[m(le,{checked:c.enable_thinking,"onUpdate:checked":O[7]||(O[7]=oe=>c.enable_thinking=oe)},null,8,["checked"])])]),_:1})):ne("",!0),m(E,{name:"context_pair"},{label:x(()=>[O[24]||(O[24]=u("span",null,"上下文数量 ",-1)),m(D,null,{title:x(()=>[...O[23]||(O[23]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[m(K(ft),{class:"question-icon"})]),_:1})]),default:x(()=>[u("div",wT,[u("div",CT,[m(L,null,{default:x(()=>[m(Y,{class:"custom-slider",value:c.context_pair,"onUpdate:value":O[8]||(O[8]=oe=>c.context_pair=oe),min:0,max:50},null,8,["value"])]),_:1})]),u("div",kT,[m(j,{value:c.context_pair,"onUpdate:value":O[9]||(O[9]=oe=>c.context_pair=oe),min:0,max:50},null,8,["value"])])])]),_:1}),u("div",ST,[O[25]||(O[25]=u("div",{class:"form-label"},"用户问题",-1)),u("div",ET,[m(z,{value:c.question_value,"onUpdate:value":O[10]||(O[10]=oe=>c.question_value=oe),onDropdownVisibleChange:y,style:{width:"220px"},options:f.value,allowClear:!1,displayRender:({labels:oe})=>oe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),u("div",AT,[O[28]||(O[28]=u("div",{class:"gray-block-title"},"问题分类设置",-1)),u("div",DT,[(w(!0),R(se,null,ge(c.categorys,(oe,W)=>(w(),R("div",{class:"form-item-list",key:oe.key},[m(E,{label:null,name:["categorys",W,"category"],rules:{required:!0,validator:(q,re)=>M(q,re)}},{default:x(()=>[u("div",OT,[m(V,{class:"flex1",value:oe.category,"onUpdate:value":q=>oe.category=q,placeholder:"请输入"},null,8,["value","onUpdate:value"]),u("div",{class:"btn-hover-wrap",onClick:q=>T(W)},[m(K(Ut))],8,NT)])]),_:2},1032,["name","rules"])]))),128)),u("div",MT,[m(E,{label:null},{default:x(()=>[u("div",TT,[m(V,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),m(P,{onClick:C,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...O[27]||(O[27]=[U("添加问题分类",-1)])]),_:1},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},RT=Ne($T,[["__scopeId","data-v-5140c78f"]]),PT={class:"judge-node-form"},LT={class:"gray-block-title"},BT=["onClick"],IT={class:"condition-list-box"},jT={class:"left-select-box"},FT={class:"condition-body"},VT=["onClick"],HT={class:"btn-wrap"},UT={class:"add-btn-block"},zT={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})},nodeId:{type:String,default:""},lf:{type:Object,default:null}},setup(n){const e=n,t=Ve("getNode"),o=Ve("setData"),i=X(),r=Je({term:[]}),s=X([]);function a(){let S=t().getAllParentVariable(),A=e.lf.getNodeModelById(e.nodeId).properties.loop_parent_key,$=l(S);if(A){S=S.filter(O=>O.node_type!="25"),$=l(S);const B=e.lf.getNodeModelById(A);if(B){let O=B.properties.dataRaw||B.properties.node_params||"{}",P=JSON.parse(O).loop||{};const E=d(P.intermediate_params,B),D=$.find(N=>(N.node_id||N.value)==B.id);if(D){const N=[],F=new Set;[...D.children||[],...E].forEach(Y=>{const L=Y.original_value||Y.value||Y.key;F.has(L)||(F.add(L),N.push(Y))}),D.children=N}else $.push({label:B.properties.node_name,node_id:B.id,node_type:B.properties.node_type,typ:"node",value:B.id,children:E})}}s.value=$}function l(S){return S.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=l(k.children))}),S}function d(S,k){let A=[];return S&&S.length&&S.forEach($=>{$.key&&A.push({id:k.id,key:$.key,value:$.key,label:$.key,node_id:k.id,node_name:k.properties.node_name,node_type:k.properties.node_type,original_value:k.id+"."+$.key,text:$.key,typ:$.typ})}),A}const c=S=>{S||a()},p=()=>{try{let S=JSON.parse(e.node.node_params).term||[];S=S.map(k=>{let A=k.terms.map($=>{let B="";for(let O=0;O<Lo.length;O++)if($.variable.indexOf(Lo[O])>-1){B=Lo[O];break}if(B!=""){let O=$.variable.split(".");$.variable=[O[0],B]}else $.variable=$.variable.split(".");return{...$,type:$.type>0?$.type:1,key:Math.random()*1e4}});return{...k,is_or:k.is_or?1:0,terms:A,key:Math.random()*1e4}}),r.term=S,f()}catch(S){}},f=()=>{let S=JSON.parse(JSON.stringify(r.term));S=S.map(k=>({is_or:k.is_or==1,next_node_key:k.next_node_key,terms:k.terms.map(A=>({variable:A.variable.join("."),is_mult:A.is_mult,type:A.type,value:A.value}))})),o({...e.node,term:S,node_params:JSON.stringify({term:S})})},h=S=>{r.term[S].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},v=(S,k)=>{r.term[S].terms.splice(k,1)},y=()=>{r.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},g=S=>{r.term.splice(S,1)},_=S=>{let k=T(S);S.is_mult=k.includes("array"),S.type=void 0};let b=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],C=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function T(S){let k="";if(S.variable&&S.variable.length>0){let A=s.value.filter($=>$.key==S.variable[0]);A&&A.length&&(k=A[0].typ),k=="object"&&(A[0]&&A[0].children&&(A=A[0].subs.filter($=>$.key==S.variable[1])),A&&A.length&&(k=A[0].typ),k=="object"&&(A[0]&&A[0].children&&(A=A[0].subs.filter($=>$.key==S.variable[2])),A&&A.length&&(k=A[0].typ)))}return k}function M(S){if(!S.variable)return[];let k=T(S);return k==""?S.is_mult?C:b:k=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:k.includes("array")?C:b}return ct(()=>r,()=>{f()},{deep:!0}),at(()=>{a(),p()}),(S,k)=>{const A=ko,$=Lt,B=$t,O=li,P=en,E=Xt,D=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...k[2]||(k[2]=[u("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",PT,[u("div",{class:"form-block",onMousedown:k[1]||(k[1]=Ct(()=>{},["stop"]))},[m(D,{ref_key:"formRef",ref:i,layout:"vertical",model:r},{default:x(()=>[m(K(b_),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:r.term,"onUpdate:modelValue":k[0]||(k[0]=N=>r.term=N),"item-key":"key"},{item:x(({element:N,index:F})=>[(w(),R("div",{class:"gray-block",key:N.key},[u("div",LT,[m(A,{gap:8},{default:x(()=>[m(K(Xc),{class:"icon drag-btn"}),U(H(F==0?"if":"else if"),1)]),_:2},1024),r.term.length>1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:Y=>g(F)},[m(K(Ut))],8,BT)):ne("",!0)]),u("div",IT,[u("div",jT,[m(B,{size:"small",value:N.is_or,"onUpdate:value":Y=>N.is_or=Y,bordered:!1,style:{width:"64px"}},{default:x(()=>[m($,{value:0},{default:x(()=>[...k[3]||(k[3]=[U("and",-1)])]),_:1}),m($,{value:1},{default:x(()=>[...k[4]||(k[4]=[U("or",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),u("div",FT,[(w(!0),R(se,null,ge(N.terms,(Y,L)=>(w(),R("div",{class:"condition-item",key:Y.key},[m(O,{value:Y.variable,"onUpdate:value":j=>Y.variable=j,onChange:j=>_(Y),onDropdownVisibleChange:c,style:{width:"160px"},options:s.value,allowClear:!1,displayRender:({labels:j})=>j.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),m(B,{value:Y.type,"onUpdate:value":j=>Y.type=j,style:{width:"120px"},placeholder:"请选择"},{default:x(()=>[(w(!0),R(se,null,ge(M(Y),j=>(w(),Q($,{value:j.value,key:j.value},{default:x(()=>[U(H(j.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),Y.type!=5&&Y.type!=6?(w(),Q(P,{key:0,placeholder:"请输入",value:Y.value,"onUpdate:value":j=>Y.value=j,style:{width:"150px"}},null,8,["value","onUpdate:value"])):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:j=>v(F,L)},[m(K(Ut))],8,VT)]))),128))])]),u("div",HT,[m(E,{onClick:Y=>h(F),icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...k[5]||(k[5]=[U("添加条件",-1)])]),_:1},8,["onClick","icon"])])]))]),_:1},8,["modelValue"]),u("div",UT,[m(E,{onClick:y,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...k[6]||(k[6]=[U("添加分支",-1)])]),_:1},8,["icon"])]),k[7]||(k[7]=u("div",{class:"gray-block mt8"},[u("div",{class:"gray-block-title"},"else"),u("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1},8,["model"])],32)])]),_:1})}}},qT=Ne(zT,[["__scopeId","data-v-3ed4ca9c"]]),GT={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:nn,AtInput:tt,FullscreenOutlined:po,FullAtInput:Hi,NodeFormLayout:tn},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const o=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){this.$refs.atInputRef&&vo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},XT={class:"specify-reply-form"},WT={class:"node-content"},YT={class:"form-item-label"},JT={class:"flex-between-box"},KT={class:"form-item-body"};function ZT(n,e,t,o,i,r){const s=Pt("NodeFormHeader"),a=Pt("FullscreenOutlined"),l=Pt("AtInput"),d=Pt("FullAtInput"),c=Pt("NodeFormLayout");return w(),Q(c,null,{header:x(()=>[m(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:x(()=>[u("div",XT,[u("div",WT,[e[5]||(e[5]=u("div",{class:"form-label"},"输出",-1)),u("div",{class:"form-item",onMousedown:e[2]||(e[2]=Ct(()=>{},["stop"]))},[u("div",YT,[u("div",JT,[e[4]||(e[4]=u("div",null,"消息内容",-1)),u("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...p)=>r.handleOpenFullAtModal&&r.handleOpenFullAtModal(...p))},[m(a)])])]),u("div",KT,[m(l,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:r.showAtList,onChange:e[1]||(e[1]=(p,f)=>r.changeValue(p,f))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),m(d,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:r.showAtList,onChange:e[3]||(e[3]=(p,f)=>r.changeValue(p,f)),onOk:r.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const QT=Ne(GT,[["render",ZT],["__scopeId","data-v-fe3648b9"]]),e6={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:nn,AtInput:tt,FullscreenOutlined:po,FullAtInput:Hi,NodeFormLayout:tn},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const o=JSON.parse(e).immediately_reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){this.$refs.atInputRef&&vo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.immediately_reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},t6={class:"specify-reply-form"},n6={class:"node-content"},o6={class:"form-item-label"},i6={class:"flex-between-box"},r6={class:"form-item-body"};function s6(n,e,t,o,i,r){const s=Pt("NodeFormHeader"),a=Pt("FullscreenOutlined"),l=Pt("AtInput"),d=Pt("FullAtInput"),c=Pt("NodeFormLayout");return w(),Q(c,null,{header:x(()=>[m(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将立即给用户回复一条固定消息"},null,8,["title","iconName"])]),default:x(()=>[u("div",t6,[u("div",n6,[e[5]||(e[5]=u("div",{class:"form-label"},"输出",-1)),u("div",{class:"form-item",onMousedown:e[2]||(e[2]=Ct(()=>{},["stop"]))},[u("div",o6,[u("div",i6,[e[4]||(e[4]=u("div",null,"消息内容",-1)),u("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...p)=>r.handleOpenFullAtModal&&r.handleOpenFullAtModal(...p))},[m(a)])])]),u("div",r6,[m(l,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:r.showAtList,onChange:e[1]||(e[1]=(p,f)=>r.changeValue(p,f))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),m(d,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:r.showAtList,onChange:e[3]||(e[3]=(p,f)=>r.changeValue(p,f)),onOk:r.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const a6=Ne(e6,[["render",s6],["__scopeId","data-v-805b62b1"]]),l6=["src"],u6={class:"mcp-form"},d6={class:"node-options"},c6={class:"options-item-tit"},p6={class:"option-label"},f6={class:"option-type"},h6={class:"field-list-item"},v6={class:"field-label"},_6={class:"field-type"},g6={class:"desc"},m6={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=Ve("getNode"),t=Ve("setData"),o=n,i=Je({mcpInfo:{},toolInfo:{}}),r=Je({params:{}}),s=X([]),a=Je({mcp:{}});function l(){d();const h=JSON.parse(o.node.node_params);Object.assign(a,h),f()}function d(){s.value=e().getAllParentVariable()}function c(h,v,y){h.value=v,h.tags=y,p()}function p(){let h={arguments:{},tag_map:{}};for(let v in r.params){let y=r.params[v].value,g=i.toolInfo.inputSchema.properties[v]||{};g.type=="string"?y=String(y):["number","integer"].includes(g.type)&&(y=Number(y)),h.arguments[v]=y,h.tag_map[v]=r.params[v].tags}a.mcp.arguments=h.arguments,a.mcp.tag_map=h.tag_map||[],t({...o.node,node_params:JSON.stringify(a)})}const f=()=>{x_({provider_id:a.mcp.provider_id}).then(h=>{var b;i.mcpInfo=(h==null?void 0:h.data)||{};let v=Fo((b=i.mcpInfo)==null?void 0:b.tools,[]);i.toolInfo=v.find(C=>C.name==a.mcp.tool_name);let y=i.toolInfo.inputSchema||{},g=(y==null?void 0:y.properties)||{},_=(y==null?void 0:y.required)||[];g=JSON.parse(JSON.stringify(g));for(let C in g)g[C].value=String(a.mcp.arguments[C]||""),g[C].tags=a.mcp.tag_map?a.mcp.tag_map[C]:[],g[C].required=_.includes(C);r.params=g})};return at(()=>{l()}),(h,v)=>(w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name},{"node-icon":x(()=>[u("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,l6)]),desc:x(()=>[u("span",null,H(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",u6,[u("div",d6,[v[0]||(v[0]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),(w(!0),R(se,null,ge(r.params,(y,g)=>(w(),R("div",{key:g,class:xt(["options-item",{"is-required":y.required}])},[u("div",c6,[u("div",p6,H(g),1),u("div",f6,H(y.type),1)]),u("div",null,[m(tt,{type:"textarea",inputStyle:"min-height: 32px;",options:s.value,defaultSelectedList:y.tags,defaultValue:y.value,ref_for:!0,ref:"atInputRef",onOpen:d,onChange:(_,b)=>c(y,_,b),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:_,payload:b})=>[u("div",h6,[u("div",v6,H(_),1),u("div",_6,H(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",g6,H(y.description),1)],2))),128))]),v[1]||(v[1]=u("div",{class:"node-options"},[u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])]),u("div",{class:"options-item"},[u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"输出")]),u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"text"),u("div",{class:"option-type"},"string")]),u("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},y6=Ne(m6,[["__scopeId","data-v-28a17d8f"]]),b6="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%2331gmof37u__clip0_10933_119689)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M4.33325%2011.6719H2.33325V13.6719'/%3e%3cpath%20d='M13.6667%2013.6719H11.6667V11.6719'/%3e%3cpath%20d='M11.6667%204.32813H13.6667V2.32812'/%3e%3cpath%20d='M2.33325%202.32812H4.33325V4.32813'/%3e%3cpath%20d='M4.33325%202.42969C2.52585%203.62217%201.33325%205.67097%201.33325%207.99834C1.33325%208.3382%201.35869%208.67214%201.40775%208.99834'/%3e%3cpath%20d='M9.00005%2014.5974C8.67385%2014.6464%208.33991%2014.6719%208.00005%2014.6719C5.67268%2014.6719%203.62388%2013.4793%202.4314%2011.6719'/%3e%3cpath%20d='M14.5922%207C14.6413%207.3262%2014.6667%207.66013%2014.6667%208C14.6667%2010.3274%2013.4741%2012.3762%2011.6667%2013.5687'/%3e%3cpath%20d='M7%201.40262C7.3262%201.35356%207.66013%201.32812%208%201.32812C10.3274%201.32812%2012.3762%202.52072%2013.5687%204.32813'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='31gmof37u__clip0_10933_119689'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",x6="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_12353_121923)'%3e%3cpath%20d='M3.99992%201.33594H1.33325V4.0026H3.99992V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%2012H12V14.6667H14.6667V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M3.99992%2012H1.33325V14.6667H3.99992V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%201.33594H12V4.0026H14.6667V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M2.66675%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M13.3333%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%202.66406H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%2013.3359H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.33325%205.33594H8.53325V7.46927H10.6666V10.6693H7.46659V8.53594H5.33325V5.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_12353_121923'%3e%3crect%20width='16'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",w6="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2010.3307H12.6667V1.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.99992%207H3.33325V14.3333'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%203.66406L12.6667%201.66406L10.6667%203.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.33325%2012.3359L3.33325%2014.3359L1.33325%2012.3359'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Fu="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",C6={class:"problem-optimization-form"},k6={class:"node-form-content"},S6={class:"gray-block"},E6={class:"gray-block-title"},A6={class:"flex-form-item"},D6={key:0,class:"gray-block"},O6={class:"gray-block-title"},N6={class:"output-box"},M6={class:"array-form-box"},T6={class:"flex-block-item",style:{gap:"12px"}};const $6={class:"gray-block"},R6={class:"gray-block-title"},P6={class:"output-box"},L6={class:"array-form-box"},B6={class:"flex-block-item",style:{gap:"12px"}},I6={style:{width:"40%"}},j6={class:"field-list-item"},F6={class:"field-label"},V6={class:"field-type"},H6=["onClick"],U6={class:"gray-block"},z6={class:"gray-block-title"},q6={class:"output-box"},G6={class:"array-form-box"},X6={class:"flex-block-item",style:{gap:"12px"}},W6=["onClick"],Y6={__name:"custom-group-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=X([]),s=X([]);X([]);const a=Je({}),l=(L,j,le)=>{if(L){let z=`at_input_${j}_${le}`;a[z]=L}},d=(L,j,le)=>{le.tags=j,le.value=L};function c(L){return L.forEach(j=>{j.typ=="node"?j.node_type==1?j.value="global":j.value=j.node_id:j.value=j.key,j.children&&j.children.length>0&&(j.children=c(j.children))}),L}const p=()=>{let L=i().getAllParentVariable();L.forEach(j=>{j.tags=j.tags||[]}),L=L.filter(j=>j.group_node_key!=j.loop_parent_key).filter(j=>j.node_id!=j.group_node_key),r.value=L};function f(){let L=i().getAllParentVariable();L=c(L),L=L.filter(j=>j.group_node_key!=j.loop_parent_key).filter(j=>j.node_id!=j.group_node_key),s.value=h(L)}function h(L){const j=le=>!le||le.length===0?[]:le.map(z=>{const V=j(z.children);return z.typ.includes("array")||V&&V.length>0?{...z,children:V}:null}).filter(Boolean);return j(L)}const v=L=>{L||f()},y=X(),g={key:"",typ:"",value:"",cu_key:Math.random()*1e4},_={key:"",typ:"",value:"",cu_key:Math.random()*1e4},b={key:"",typ:"",value:"",cu_key:Math.random()*1e4},C=Je({loop_type:"array",loop_number:"",loop_arrays:[],intermediate_params:[],output:[]}),T=We(()=>{let L=C.intermediate_params,j=[];return L.forEach(le=>{le.key&&j.push({children:[],id:o.nodeId,key:le.key,label:le.key,node_id:o.nodeId,node_name:o.node.node_name,node_type:"25",original_value:o.nodeId+"."+le.key,text:le.key,typ:le.typ,value:le.key})}),j.length>0?[{label:o.node.node_name,node_id:o.nodeId,node_type:"25",typ:"node",value:o.nodeId,children:j}]:[]}),M=()=>{const L=JSON.stringify({loop:{...C,loop_arrays:C.loop_arrays.map(j=>({...j,value:j.value?j.value.join("."):""})),output:C.output.map(j=>({...j,value:j.value?j.value.join("."):""}))}});t("update-node",{...o.node,...C,node_params:L})};function S(L){if(L){let j=L.split("."),le=j[0],z=j.filter((V,J)=>J>0).join(".");return[le,z]}return[]}const k=()=>{try{let L=o.node.dataRaw||o.node.node_params||"{}",j=JSON.parse(L).loop||{};j=JSON.parse(JSON.stringify(j)),p(),f(),C.loop_type=j.loop_type,C.loop_number=j.loop_number,C.loop_arrays=j.loop_arrays.map(le=>({...le,value:S(le.value)})),C.intermediate_params=j.intermediate_params.map(le=>({...le})),C.output=j.output.map(le=>({...le,value:S(le.value)})),C.loop_arrays.length==0&&(C.loop_arrays=[g]),C.intermediate_params.length==0&&(C.intermediate_params=[_]),C.output.length==0&&(C.output=[b])}catch(L){}};ct(()=>C,()=>{M()},{deep:!0});const A=()=>{C.loop_arrays.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},$=L=>{C.loop_arrays.splice(L,1)},B=(L,j,le)=>{le?j.typ=le[le.length-1].typ:j.typ=""},O=()=>{C.intermediate_params.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},P=L=>{C.intermediate_params.splice(L,1)},E=()=>{C.output.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},D=L=>{C.output.splice(L,1)},N=(L,j)=>{if(L&&L.length){let le=T.value.filter(z=>z.value==L[0])[0].children;le&&le.length&&(j.typ=le.filter(z=>z.value==L[1])[0].typ)}else j.typ=""},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],Y=()=>{t("close")};return at(()=>{k()}),(L,j)=>{const le=Zt,z=Lt,V=$t,J=Mn,oe=en,W=li,q=In,re=Cn,ue=Xt,xe=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于通过设定循环次数和逻辑，重复执行一系列任务",onClose:Y},null,8,["title","iconName"])]),default:x(()=>[u("div",C6,[u("div",k6,[m(xe,{ref_key:"formRef",ref:y,layout:"vertical",model:C},{default:x(()=>[u("div",S6,[u("div",E6,[j[3]||(j[3]=u("img",{src:b6,alt:""},null,-1)),j[4]||(j[4]=U(" 循环设置 ",-1)),m(le,null,{title:x(()=>[...j[2]||(j[2]=[U("如果引用数组，循环次数为数组的长度；如果指定次数，循环次数为指定的次数；",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",A6,[j[7]||(j[7]=u("div",{class:"form-label"},"循环类型",-1)),m(V,{value:C.loop_type,"onUpdate:value":j[0]||(j[0]=Te=>C.loop_type=Te),style:{width:"170px"}},{default:x(()=>[m(z,{value:"array"},{default:x(()=>[...j[5]||(j[5]=[U("使用数组循环",-1)])]),_:1}),m(z,{value:"number"},{default:x(()=>[...j[6]||(j[6]=[U("指定循环次数",-1)])]),_:1})]),_:1},8,["value"]),C.loop_type=="number"?(w(),Q(J,{key:0,placeholder:"请输入",style:{flex:"1"},value:C.loop_number,"onUpdate:value":j[1]||(j[1]=Te=>C.loop_number=Te),min:1,max:100},null,8,["value"])):ne("",!0)])]),C.loop_type=="array"?(w(),R("div",D6,[u("div",O6,[j[9]||(j[9]=u("img",{src:x6,alt:""},null,-1)),j[10]||(j[10]=U(" 循环数组 ",-1)),m(le,null,{title:x(()=>[...j[8]||(j[8]=[U("仅支持引用数组，循环次数为数组的长度",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",N6,[j[12]||(j[12]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型"),u("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),u("div",M6,[(w(!0),R(se,null,ge(C.loop_arrays,(Te,me)=>(w(),R("div",{class:"form-item-list",key:Te.cu_key},[m(re,{label:null},{default:x(()=>[u("div",T6,[m(oe,{style:{width:"25%"},value:Te.key,"onUpdate:value":pe=>Te.key=pe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(q,null,{default:x(()=>[m(oe,{style:{width:"25%"},value:Te.typ,"onUpdate:value":pe=>Te.typ=pe,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),m(W,{value:Te.value,"onUpdate:value":pe=>Te.value=pe,onChange:(pe,Ge)=>B(pe,Te,Ge),onDropdownVisibleChange:v,style:{width:"50%"},options:s.value,allowClear:!1,displayRender:({labels:pe})=>pe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"])]),_:2},1024),ne("",!0)])]),_:2},1024)]))),128)),C.loop_arrays.length==0?(w(),Q(ue,{key:0,onClick:A,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[11]||(j[11]=[U("添加参数",-1)])]),_:1},8,["icon"])):ne("",!0)])])])):ne("",!0),u("div",$6,[u("div",R6,[j[14]||(j[14]=u("img",{src:w6,alt:""},null,-1)),j[15]||(j[15]=U(" 中间变量 ",-1)),m(le,null,{title:x(()=>[...j[13]||(j[13]=[U("变量可在多次循环中实现共享，可用于在多次循环中传递变量",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",P6,[j[17]||(j[17]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),u("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),u("div",L6,[(w(!0),R(se,null,ge(C.intermediate_params,(Te,me)=>(w(),R("div",{class:"form-item-list",key:Te.cu_key},[m(re,{label:null},{default:x(()=>[u("div",B6,[m(oe,{style:{width:"25%"},value:Te.key,"onUpdate:value":pe=>Te.key=pe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(q,null,{default:x(()=>[m(V,{value:Te.typ,"onUpdate:value":pe=>Te.typ=pe,placeholder:"请选择",style:{width:"25%"}},{default:x(()=>[(w(),R(se,null,ge(F,pe=>m(z,{value:pe.value,key:pe.value},{default:x(()=>[U(H(pe.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"]),u("div",I6,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:pe=>l(pe,"intermediate_params",me),options:r.value,defaultSelectedList:Te.tags,defaultValue:Te.value,onOpen:p,onChange:(pe,Ge)=>d(pe,Ge,Te,me),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:pe,payload:Ge})=>[u("div",j6,[u("div",F6,H(pe),1),u("div",V6,H(Ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])])]),_:2},1024),u("div",{class:"btn-hover-wrap",onClick:pe=>P(me)},[m(K(Ut))],8,H6)])]),_:2},1024)]))),128)),m(ue,{onClick:O,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[16]||(j[16]=[U("添加参数",-1)])]),_:1},8,["icon"])])])]),u("div",U6,[u("div",z6,[j[19]||(j[19]=u("img",{src:Fu,alt:""},null,-1)),j[20]||(j[20]=U(" 输出 ",-1)),m(le,null,{title:x(()=>[...j[18]||(j[18]=[U("循环完成后输出的内容，仅支持引用循环体中节点的输出变量",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",q6,[j[22]||(j[22]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),u("div",{class:"output-item",style:{width:"38%"}},"参数值")],-1)),u("div",G6,[(w(!0),R(se,null,ge(C.output,(Te,me)=>(w(),R("div",{class:"form-item-list",key:Te.cu_key},[m(re,{label:null},{default:x(()=>[u("div",X6,[m(oe,{style:{width:"25%"},value:Te.key,"onUpdate:value":pe=>Te.key=pe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(q,null,{default:x(()=>[m(oe,{style:{width:"25%"},value:Te.typ,"onUpdate:value":pe=>Te.typ=pe,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),m(W,{onChange:pe=>N(pe,Te),value:Te.value,"onUpdate:value":pe=>Te.value=pe,onDropdownVisibleChange:v,style:{width:"40%"},options:T.value,allowClear:!1,displayRender:({labels:pe})=>pe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),u("div",{class:"btn-hover-wrap",onClick:pe=>D(me)},[m(K(Ut))],8,W6)])]),_:2},1024)]))),128)),m(ue,{onClick:Ct(E,["stop"]),icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...j[21]||(j[21]=[U("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])])])]),_:1})}}},J6=Ne(Y6,[["__scopeId","data-v-1f51a256"]]),K6={class:"field-select-box"},Z6={key:0,class:"field-list-box"},Q6={key:1,class:"empty-box"},e$={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=Je({show:!1,selectedRowKeys:[],selectedRows:[]}),s=X([{title:"字段名称",dataIndex:"field_name"},{title:"数据类型",dataIndex:"ui_type"}]);X([]);const a=(c,p)=>{r.selectedRowKeys=c,r.selectedRows=p},l=({selectedRowKeys:c,selectedRows:p})=>{r.selectedRowKeys=c,r.selectedRows=p,r.show=!0},d=()=>{o("ok",r.selectedRowKeys,r.selectedRows),r.show=!1};return e({open:l}),(c,p)=>{const f=Ur,h=_n;return w(),Q(h,{width:"746px",open:r.show,"onUpdate:open":p[0]||(p[0]=v=>r.show=v),title:"关联数据表",onOk:d,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[u("div",K6,[n.fields.length?(w(),R("div",Z6,[m(f,{rowKey:"field_name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:a},dataSource:n.fields,columns:s.value,loading:i.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):ne("",!0),n.fields.length?ne("",!0):(w(),R("div",Q6,[...p[1]||(p[1]=[u("img",{src:Xa,alt:""},null,-1),u("div",null,"暂无字段, 请先去数据表添加",-1)])]))])]),_:1},8,["open"])}}},t$=Ne(e$,[["__scopeId","data-v-f2480ca0"]]),n$={class:"field-list"},o$={class:"field-list-row"},i$={key:0,class:"field-list-col field-list-col-head field-value-head"},r$={key:1,class:"field-list-col field-list-col-head field-del-head"},s$={key:0,class:"field-list-row"},a$={class:"field-list-col field-value-col"},l$={class:"field-list-col field-name-col"},u$={class:"field-list-col field-type-col"},d$={key:0,class:"field-list-col field-value-col"},c$={key:1,class:"field-list-col field-del-col"},p$=["onClick"],f$={key:0,class:"add-btn-box"},h$={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Je({list:[],keys:[]}),s=We(()=>Object.fromEntries(o.fields.map(_=>[_.field_name,_])));ct(()=>o.list,_=>{r.list=_,r.keys=_.map(b=>b.field_name)},{immediate:!0});const a=X([]),l=()=>{let _=i().getAllParentVariable();a.value=_||[]},d=()=>{l()},c=(_,b,C,T)=>{r.list[T].value=_,r.list[T].atTags=b,h()},p=(_,b)=>{r.list=[...b],r.keys=[..._],h()},f=_=>{r.list.splice(_,1),h()},h=()=>{t("change",[...r.list],[...r.keys])},v=X(),y=()=>{v.value.open({selectedRows:o.list,selectedRowKeys:o.list.map(_=>_.field_name)})},g=_=>{switch(_.ui_type){case"Checkbox":return"请输入true或false，键入“/”插入变量";case"MultiSelect":return"多个选项“,”分割，键入“/”插入变量"}return"请输入参数值，键入“/”插入变量"};return at(()=>{l()}),(_,b)=>{const C=en,T=Zt,M=On,S=Xt;return w(),R("div",null,[u("div",n$,[u("div",o$,[b[0]||(b[0]=u("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),b[1]||(b[1]=u("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),R("div",i$,"字段值")):ne("",!0),o.showDelete?(w(),R("div",r$)):ne("",!0)]),n.showEmptyFieldRow?(w(),R("div",s$,[b[2]||(b[2]=u("div",{class:"field-list-col field-name-col"},"--",-1)),b[3]||(b[3]=u("div",{class:"field-list-col field-type-col"},"--",-1)),u("div",a$,[m(T,{title:"请先选择数据库"},{default:x(()=>[m(C,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ne("",!0),(w(!0),R(se,null,ge(r.list,(k,A)=>{var $;return w(),R("div",{class:"field-list-row",key:k.field_name},[u("div",l$,H(k.field_name),1),u("div",u$,H(k.ui_type||(($=s.value[k.field_name])==null?void 0:$.ui_type)),1),n.showInput?(w(),R("div",d$,[m(tt,{options:a.value,defaultValue:k.value,defaultSelectedList:k.atTags,onOpen:d,onChange:(B,O)=>c(B,O,k,A),placeholder:g(k)},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])])):ne("",!0),o.showDelete?(w(),R("div",c$,[u("span",{class:"del-btn",onClick:B=>f(A)},[m(M,{class:"del-icon",name:"close-circle"})],8,p$)])):ne("",!0)])}),128))]),o.showAdd?(w(),R("div",f$,[m(S,{class:"add-btn",type:"dashed",block:"",onClick:y},{default:x(()=>[m(K(Mt)),b[4]||(b[4]=U(" 添加字段 ",-1))]),_:1})])):ne("",!0),m(t$,{ref_key:"fieldSelectAlertRef",ref:v,fields:n.fields,onOk:p},null,8,["fields"])])}}},tp=Ne(h$,[["__scopeId","data-v-925c2376"]]),v$={class:"field-list-item"},_$={class:"field-label"},g$={class:"field-type"},O_={__name:"at-full-input",props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1}},emits:["open","change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(null),s=X(null),a=X(i.defaultValue),l=X(i.defaultSelectedList);ct(()=>i.defaultValue,f=>{a.value=f}),ct(()=>i.defaultSelectedList,f=>{l.value=f});function d(f,h){a.value=f,l.value=h,o("change",f,h)}function c(){r.value.refresh()}function p(){s.value.show()}return e({showFull:p}),(f,h)=>(w(),R("div",null,[m(tt,{type:n.type,inputStyle:n.inputStyle,options:n.options,defaultValue:a.value,defaultSelectedList:l.value,placeholder:n.placeholder,canRepeat:n.canRepeat,isContain:n.isContain,checkAnyLevel:n.checkAnyLevel,ref_key:"atInputRef",ref:r,onOpen:h[0]||(h[0]=v=>o("open")),onChange:d},{option:x(({label:v,payload:y})=>[u("div",v$,[u("div",_$,H(v),1),u("div",g$,H(y.typ),1)])]),_:1},8,["type","inputStyle","options","defaultValue","defaultSelectedList","placeholder","canRepeat","isContain","checkAnyLevel"]),m(Hi,{options:n.options,defaultValue:a.value,defaultSelectedList:l.value,placeholder:"请输入内容，键入“/”可以插入变量",type:n.type,onOpen:h[1]||(h[1]=v=>o("open")),onChange:d,onOk:c,ref_key:"fullAtInputRef",ref:s},null,8,["options","defaultValue","defaultSelectedList","type"])]))}},m$={class:"add-data-form"},y$={class:"node-box-content"},b$={class:"flex-between"},x$={class:"flex-between"},w$={class:"setting-box mt8"},C$={__name:"feishu-insert-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]},variableOptions:{type:Array}},emits:["update"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X({}),s=Je({fields:[],fields_json:"",input_type_map:{fields:1},tag_map:{fields:[]}});function a(f=null){var h,v;if(s.fields=[],f){let{fields:y,input_type_map:g,tag_map:_}=((v=(h=f==null?void 0:f.plugin)==null?void 0:h.params)==null?void 0:v.arguments)||{};if(y.map(b=>{b.value=b.value?b.value.toString():""}),s.fields=y,s.tag_map=_||{},g){s.input_type_map=g;for(let b in g)if(g[b]==2&&!s[`${b}_json`]){let C=JSON.stringify(s[b]);s[`${b}_json`]=C}}}s.fields.length||i.fields.map(y=>{s.fields.push({value:"",atTags:[],...y})}),p()}const l=f=>{s.fields=f,p()};function d(f){var h;(h=r.value[f])==null||h.showFull()}function c(f,h,v){s[f]=h,s.tag_map[f]=v,p()}const p=()=>{o("update",{...s})};return e({init:a,clear(){p()}}),(f,h)=>{var g;const v=Lt,y=$t;return w(),R("div",m$,[u("div",y$,[u("div",b$,[h[6]||(h[6]=u("div",{class:"setting-label is-required"},[u("span",null,"插入数据"),u("span",{class:"tip"},"（不填写字段值则为空）")],-1)),u("div",x$,[s.input_type_map.fields==2?(w(),Q(K(po),{key:0,class:"zm-pointer",onClick:h[0]||(h[0]=_=>d("fields"))})):ne("",!0),m(y,{value:s.input_type_map.fields,"onUpdate:value":h[1]||(h[1]=_=>s.input_type_map.fields=_),style:{width:"130px"},onChange:p},{default:x(()=>[m(v,{value:1},{default:x(()=>[...h[4]||(h[4]=[U("选择添加数据",-1)])]),_:1}),m(v,{value:2},{default:x(()=>[...h[5]||(h[5]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),u("div",w$,[s.input_type_map.fields==1?(w(),Q(tp,{key:0,showEmptyFieldRow:!n.tableId,list:s.fields,fields:n.fields,showAdd:!1,showDelete:!1,onChange:l},null,8,["showEmptyFieldRow","list","fields"])):(w(),R(se,{key:1},[m(O_,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((g=s.tag_map)==null?void 0:g.fields_json)||[],defaultValue:s.fields_json,ref:_=>r.value.fields=_,onOpen:h[2]||(h[2]=_=>o("updateVar")),onChange:h[3]||(h[3]=(_,b)=>c("fields_json",_,b)),placeholder:"请输入内容，键入“/”可以插入变量"},null,8,["options","defaultSelectedList","defaultValue"]),h[7]||(h[7]=u("div",{class:"desc"},'内容示例：[{"field_name":"文本","ui_type":"Text","value":"001"},{"field_name":"日期","ui_type":"DateTime","value":1769077135214},{"field_name":"数字","ui_type":"Number","value":99},{"field_name":"单选","ui_type":"SingleSelect","value":"选项1"},{"field_name":"多选","ui_type":"MultiSelect","value":["类别A","类别B"]},{"field_name":"复选框","ui_type":"Checkbox","value":true}]',-1))],64))])])])}}},k$=Ne(C$,[["__scopeId","data-v-8b01950d"]]),S$={class:"add-data-form"},E$={class:"node-box-content"},A$={class:"options-item is-required"},D$={class:"field-list-item"},O$={class:"field-label"},N$={class:"field-type"},M$={class:"options-item is-required"},T$={class:"flex-between"},$$={class:"flex-between"},R$={class:"setting-box"},P$={__name:"feishu-update-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X({}),r=Je({record_id:"",record_tags:[],fields:[],fields_json:"",input_type_map:{fields:1},tag_map:{fields:[]}});function s(p=null){var f,h,v,y,g;if(r.fields=[],p){let{fields:_,input_type_map:b,tag_map:C}=((h=(f=p==null?void 0:p.plugin)==null?void 0:f.params)==null?void 0:h.arguments)||{};if(_.map(T=>{T.value=T.value?T.value.toString():""}),r.fields=_,r.tag_map=C||{},b){r.input_type_map=b;for(let T in b)if(b[T]==2&&!r[`${T}_json`]){let M=JSON.stringify(r[T]);r[`${T}_json`]=M}}}p&&((g=(y=(v=p==null?void 0:p.plugin)==null?void 0:v.params)==null?void 0:y.arguments)!=null&&g.record_id)&&(r.record_id=p.plugin.params.arguments.record_id,r.record_tags=p.plugin.params.arguments.record_tags||[]),c()}const a=p=>{r.fields=p,c()};function l(p,f,h){r[p]=f,p=="record_id"?r.record_tags=h:r.tag_map[p]=h,c()}function d(p){var f;(f=i.value[p])==null||f.showFull()}const c=()=>{o("update",{...r})};return e({init:s}),(p,f)=>{var y;const h=Lt,v=$t;return w(),R("div",S$,[u("div",E$,[u("div",A$,[f[6]||(f[6]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"record_id"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:r.record_tags,defaultValue:r.record_id,ref:g=>i.value.record_id=g,onOpen:f[0]||(f[0]=g=>o("updateVar")),onChange:f[1]||(f[1]=(g,_)=>l("record_id",g,_)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:g,payload:_})=>[u("div",D$,[u("div",O$,H(g),1),u("div",N$,H(_.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[7]||(f[7]=u("div",{class:"desc"},'待更新的记录ID；示例值："reCWNXZPQv"',-1))]),u("div",M$,[u("div",T$,[f[10]||(f[10]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"更新数据")],-1)),u("div",$$,[r.input_type_map.fields==2?(w(),Q(K(po),{key:0,class:"zm-pointer",onClick:f[2]||(f[2]=g=>d("fields"))})):ne("",!0),m(v,{value:r.input_type_map.fields,"onUpdate:value":f[3]||(f[3]=g=>r.input_type_map.fields=g),style:{width:"130px"},onChange:c},{default:x(()=>[m(h,{value:1},{default:x(()=>[...f[8]||(f[8]=[U("选择更新数据",-1)])]),_:1}),m(h,{value:2},{default:x(()=>[...f[9]||(f[9]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),u("div",R$,[r.input_type_map.fields==1?(w(),Q(tp,{key:0,showEmptyFieldRow:!n.tableId,list:r.fields,fields:n.fields,showAdd:!0,showDelete:!0,onChange:a},null,8,["showEmptyFieldRow","list","fields"])):(w(),R(se,{key:1},[m(O_,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((y=r.tag_map)==null?void 0:y.fields_json)||[],defaultValue:r.fields_json,ref:g=>i.value.fields=g,onOpen:f[4]||(f[4]=g=>o("updateVar")),onChange:f[5]||(f[5]=(g,_)=>l("fields_json",g,_)),placeholder:"请输入内容，键入“/”可以插入变量"},null,8,["options","defaultSelectedList","defaultValue"]),f[11]||(f[11]=u("div",{class:"desc"},'内容示例：[{"field_name":"文本","ui_type":"Text","value":"001"},{"field_name":"日期","ui_type":"DateTime","value":1769077135214},{"field_name":"数字","ui_type":"Number","value":99},{"field_name":"单选","ui_type":"SingleSelect","value":"选项1"},{"field_name":"多选","ui_type":"MultiSelect","value":["类别A","类别B"]},{"field_name":"复选框","ui_type":"Checkbox","value":true}]',-1))],64))])])])])}}},L$=Ne(P$,[["__scopeId","data-v-98e2df61"]]),B$={class:"options-item is-required"},I$={class:"field-list-item"},j$={class:"field-label"},F$={class:"field-type"},V$={__name:"feishu-del-data",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({tags:[],value:""});function r(a=null){var l,d,c;a&&((c=(d=(l=a==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:d.arguments)!=null&&c.record_id)&&(i.value=a.plugin.params.arguments.record_id,i.tags=a.plugin.params.arguments.record_tags||[])}function s(a,l){i.value=a,i.tags=l,o("update",{record_id:a,record_tags:l})}return e({init:r}),(a,l)=>(w(),R("div",B$,[l[1]||(l[1]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"record_id"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:i.tags,defaultValue:i.value,ref:"atInputRef",onOpen:l[0]||(l[0]=d=>o("updateVar")),onChange:s,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:d,payload:c})=>[u("div",I$,[u("div",j$,H(d),1),u("div",F$,H(c.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),l[2]||(l[2]=u("div",{class:"desc"},'待删除的记录ID；示例值："reCWNXZPQv"',-1))]))}},H$=Ne(V$,[["__scopeId","data-v-06518fa2"]]),N_=[{key:"is",label:"是"},{key:"isNot",label:"不是"},{key:"contains",label:"包含"},{key:"doesNotContain",label:"不包含"},{key:"isEmpty",label:"为空"},{key:"isNotEmpty",label:"不为空"},{key:"isGreater",label:"大于"},{key:"isGreaterEqual",label:"大于等于"},{key:"isLess",label:"小于"},{key:"isLessEqual",label:"小于等于"}];function M_(){let n={};for(let e of N_)n[e.key]=e;return n}const U$=["Text","SingleSelect","MultiSelect","DateTime","Number","Checkbox"],z$={Text:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],Number:["is","isNot","isEmpty","isNotEmpty","isGreater","isGreaterEqual","isLess","isLessEqual"],SingleSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],MultiSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],DateTime:["is","isEmpty","isNotEmpty","isGreater","isLess"],Checkbox:["is"]};function q$(n){let e=z$[n]||[];return N_.filter(t=>e.includes(t.key))}const Vd=["batch_create_record","batch_delete_record","batch_get_record","batch_update_record"];function T_(n){const e=["app_id","app_secret","app_token","table_id"],t={};for(let o in n)!e.includes(o)&&n[o].required&&(t[o]=JSON.parse(JSON.stringify(n[o])));return t}const G$={class:"query-condition-filter"},X$={class:"condition-select-box"},W$={class:"select-wrapper"},Y$={class:"field-items"},J$={class:"field-select-box"},K$={class:"operator-select-box"},Z$={class:"field-value-box"},Q$=["onClick"],eR={class:"add-btn-box"},tR={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},conjunction:{type:String,default:"and"}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Je({list:[],conjunction:"and"});ct(()=>o.where,_=>{r.list=_},{immediate:!0}),ct(()=>o.conjunction,_=>{r.conjunction=_},{immediate:!0});const s=We(()=>o.where.length>1),a=X([]),l=()=>{let _=i().getAllParentVariable();a.value=_||[]},d=()=>{l()},c=()=>{let _={conjunction:r.conjunction,list:r.list};t("change",_)},p=(_,b,C,T)=>{r.list[T].value=_,r.list[T].atTags=b,c()},f=(_,b)=>{r.list[b].value="",c()},h=()=>{let _={field_id:"",field_name:"",field_type:"",operator:void 0,value:"",atTags:[]};r.list.push(_),c()},v=_=>{r.list.splice(_,1),c()},y=(_,b)=>{let C={field_id:b.key,field_name:b.value,field_type:b.type,operator:void 0,value:"",atTags:[]};r.list[_]=C,c()},g=({key:_})=>{r.conjunction=_,c()};return at(()=>{l()}),(_,b)=>{const C=Vr,T=Fr,M=Hr,S=Lt,k=$t,A=en,$=On,B=Xt,O=Zt;return w(),R("div",{class:xt(["query-condition-filter-warpper",{"is-multiple":s.value}])},[u("div",G$,[b[3]||(b[3]=u("div",{class:"auxiliary-line"},null,-1)),u("div",X$,[u("div",W$,[m(M,null,{overlay:x(()=>[m(T,{style:{width:"100px"},onClick:g},{default:x(()=>[m(C,{key:"and"},{default:x(()=>[...b[1]||(b[1]=[u("a",{href:"javascript:;"},"且",-1)])]),_:1}),m(C,{key:"or"},{default:x(()=>[...b[2]||(b[2]=[u("a",{href:"javascript:;"},"或",-1)])]),_:1})]),_:1})]),default:x(()=>[u("a",{class:"ant-dropdown-link",onClick:b[0]||(b[0]=Ct(()=>{},["prevent"]))},[U(H(r.conjunction=="and"?"且":"或")+" ",1),m(K(xo))])]),_:1})])]),u("div",Y$,[(w(!0),R(se,null,ge(r.list,(P,E)=>(w(),R("div",{class:"field-item",key:P.field},[u("div",J$,[m(k,{style:{width:"100px"},value:P.field_name,"onUpdate:value":D=>P.field_name=D,onChange:(D,N)=>y(E,N)},{default:x(()=>[(w(!0),R(se,null,ge(o.fieldOptions,D=>(w(),Q(S,{value:D.field_name,type:D.ui_type,key:D.field_id},{default:x(()=>[U(H(D.field_name),1)]),_:2},1032,["value","type"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),u("div",K$,[m(k,{value:P.operator,"onUpdate:value":D=>P.operator=D,style:{width:"100px"},onChange:()=>f(P,E)},{default:x(()=>[(w(!0),R(se,null,ge(K(q$)(P.field_type),D=>(w(),Q(S,{value:D.key,key:D.key},{default:x(()=>[U(H(D.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),u("div",Z$,[["isEmpty","isNotEmpty"].includes(P.operator)?(w(),Q(A,{key:0,placeholder:"无需输入值",disabled:""})):(w(),Q(tt,{key:1,options:a.value,defaultValue:P.value,defaultSelectedList:P.atTags,onOpen:d,onChange:(D,N)=>p(D,N,P,E),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),u("span",{class:"field-del-btn",onClick:D=>v(E)},[m($,{class:"del-icon",name:"close-circle"})],8,Q$)]))),128))])]),u("div",eR,[n.disabled?(w(),Q(O,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[u("span",null,[m(B,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[m(K(Mt)),b[4]||(b[4]=U(" 添加条件 ",-1))]),_:1})])]),_:1})):(w(),Q(B,{key:1,class:"add-btn",type:"dashed",block:"",onClick:h},{default:x(()=>[m(K(Mt)),b[5]||(b[5]=U(" 添加条件 ",-1))]),_:1}))])],2)}}},nR=Ne(tR,[["__scopeId","data-v-dbda544a"]]),oR={class:"field-select-box"},iR={key:0,class:"field-list-box"},rR={key:1,class:"empty-box"},sR={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=Je({show:!1,selectedRowKeys:[],selectedRows:[]}),r=X([{title:"字段名称",dataIndex:"field_name"},{title:"数据类型",dataIndex:"ui_type"}]),s=(d,c)=>{i.selectedRowKeys=d,i.selectedRows=c},a=({selectedRowKeys:d,selectedRows:c})=>{i.selectedRowKeys=d,i.selectedRows=c,i.show=!0},l=()=>{o("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:a}),(d,c)=>{const p=Ur,f=_n;return w(),Q(f,{width:"746px",open:i.show,"onUpdate:open":c[0]||(c[0]=h=>i.show=h),title:"关联数据表",onOk:l,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[u("div",oR,[n.fields.length?(w(),R("div",iR,[m(p,{rowKey:"field_name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:s},dataSource:n.fields,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):ne("",!0),n.fields.length?ne("",!0):(w(),R("div",rR,[...c[1]||(c[1]=[u("img",{src:Xa,alt:""},null,-1),u("div",null,"暂无字段, 请先去数据表添加",-1)])]))])]),_:1},8,["open"])}}},aR=Ne(sR,[["__scopeId","data-v-519d2fc8"]]),lR={class:"field-list"},uR={class:"field-list-col field-drag-col"},dR={class:"drag-btn"},cR={class:"field-list-col field-name-col"},pR={class:"field-name-box"},fR={class:"field-name"},hR={class:"field-type-tag"},vR={class:"field-list-col field-value-col"},_R={key:0,class:"field-list-col field-del-col"},gR={class:"add-btn-box"},mR={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],r=X(),s=X([]);ct(()=>o.list,f=>{s.value=f.map(h=>({...h,is_asc:h.is_asc?1:0}))});const a=f=>{s.value.splice(f,1),c()},l=(f,h)=>{s.value=h.map(v=>({...v})),c()},d=()=>{c()},c=()=>{let f=s.value.map(h=>({...h,is_asc:h.is_asc==1}));t("change",f)},p=()=>{r.value.open({selectedRows:o.list,selectedRowKeys:o.list.map(f=>f.field_name)})};return(f,h)=>{const v=Lt,y=$t,g=On,_=Xt,b=Zt;return w(),R("div",null,[u("div",lR,[(w(!0),R(se,null,ge(s.value,C=>(w(),R("div",{class:"field-list-row",key:C.name},[u("div",uR,[u("span",dR,[m(K(Xc))])]),u("div",cR,[u("div",pR,[u("span",fR,H(C.field_name),1),u("span",hR,H(C.ui_type),1)])]),u("div",vR,[m(y,{value:C.is_asc,"onUpdate:value":T=>C.is_asc=T,style:{width:"100%"},onChange:d},{default:x(()=>[(w(),R(se,null,ge(i,T=>m(v,{value:T.value,key:T.key},{default:x(()=>[U(H(T.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),o.showDelete?(w(),R("div",_R,[u("span",{class:"del-btn",onClick:h[0]||(h[0]=T=>a(f.index))},[m(g,{class:"del-icon",name:"close-circle"})])])):ne("",!0)]))),128))]),u("div",gR,[n.disabled?(w(),Q(b,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[u("span",null,[m(_,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[m(K(Mt)),h[1]||(h[1]=U(" 添加排序字段 ",-1))]),_:1})])]),_:1})):(w(),Q(_,{key:1,class:"add-btn",type:"dashed",block:"",onClick:p},{default:x(()=>[m(K(Mt)),h[2]||(h[2]=U(" 添加排序字段 ",-1))]),_:1}))]),m(aR,{fields:n.fields,ref_key:"fieldSelectAlertRef",ref:r,onOk:l},null,8,["fields"])])}}},yR=Ne(mR,[["__scopeId","data-v-b86645fb"]]),bR={class:"select-data-form"},xR={class:"node-box-content"},wR={class:"setting-box"},CR={class:"flex-between"},kR={class:"field-list-item"},SR={class:"field-label"},ER={class:"field-type"},AR={class:"flex-between"},DR={class:"field-list-item"},OR={class:"field-label"},NR={class:"field-type"},MR={class:"flex-between"},TR={class:"field-list-item"},$R={class:"field-label"},RR={class:"field-type"},PR={__name:"feishu-search-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r={field_names:[],filter:{conjunction:"and",conditions:[]},sort:[],page_size:100,field_names_json:"",filter_json:"",sort_json:"",input_type_map:{field_names:1,filter:1,sort:1},tag_map:{}},s=Je(JSON.parse(JSON.stringify(r))),a=X(null),l=X({}),d=X(""),c=X(""),p=X([]);function f(M=null){var S,k,A,$;if(!M)Object.assign(s,JSON.parse(JSON.stringify(r)));else{let{field_names:B,filter:O,sort:P,page_size:E,input_type_map:D,tag_map:N}=((k=(S=M==null?void 0:M.plugin)==null?void 0:S.params)==null?void 0:k.arguments)||{};if(Array.isArray(O.conditions)&&O.conditions.length){for(let F of O.conditions)F.field_type==="DateTime"&&(F.value=F.value.replace(/\D/g,""));s.filter=O}else s.filter={conjunction:"and",conditions:[]};Array.isArray(B)&&(D==null?void 0:D.field_names)!=2?B.map(F=>{let Y=i.fields.find(L=>L.field_name==F);Y&&s.field_names.push(Y)}):s.field_names=Array.isArray(B)?B:[],Array.isArray(P)&&(D==null?void 0:D.sort)!=2?s.sort=P.map(F=>({...i.fields.find(L=>L.field_name==F.field_name),is_asc:F.desc?0:1})):s.sort=Array.isArray(P)?P:[],D&&(s.input_type_map=D);for(let F in D)if(D[F]==2){let Y=JSON.stringify(s[F]);Array.isArray(s[F])?s[F].length||(Y=""):($=(A=s[F])==null?void 0:A.conditions)!=null&&$.length||(Y=""),s[`${F}_json`]=Y}s.tag_map=N||{},s.page_size=E||100}}const h=({conjunction:M,list:S})=>{s.filter.conjunction=M,s.filter.conditions=S,C()},v=M=>{s.sort=[...M],C()},y=M=>{s.field_names=M,C()};function g(M,S,k){s[M]=S,s.tag_map[M]=k,C()}function _(M,S){const k=d.value;k&&(s[k]=M,s.tag_map[k]=S,C())}function b(M){var S;d.value=M,c.value=s[M]||"",p.value=((S=s.tag_map)==null?void 0:S[M])||[],a.value.show()}function C(){o("update",JSON.parse(JSON.stringify(s)))}function T(){var k;const M=d.value,S=(k=l.value)==null?void 0:k[M];S&&S.refresh&&S.refresh()}return e({init:f,clearSelections(){var M,S,k;((M=s.input_type_map)==null?void 0:M.filter)==1&&(s.filter.conditions=[]),((S=s.input_type_map)==null?void 0:S.field_names)==1&&(s.field_names=[]),((k=s.input_type_map)==null?void 0:k.sort)==1&&(s.sort=[]),C()}}),(M,S)=>{const k=Lt,A=$t,$=Mn;return w(),R("div",bR,[u("div",xR,[u("div",wR,[m(us,{title:"查询条件",count:s.filter.conditions.length},{extra:x(()=>[u("div",CR,[s.input_type_map.filter!=1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:S[0]||(S[0]=B=>b("filter_json"))},[m(K(po))])):ne("",!0),m(A,{value:s.input_type_map.filter,"onUpdate:value":S[1]||(S[1]=B=>s.input_type_map.filter=B),style:{width:"130px"},onChange:C},{default:x(()=>[m(k,{value:1},{default:x(()=>[...S[21]||(S[21]=[U("选择查询条件",-1)])]),_:1}),m(k,{value:2},{default:x(()=>[...S[22]||(S[22]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),default:x(()=>{var B;return[s.input_type_map.filter!=1?(w(),R(se,{key:0},[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((B=s.tag_map)==null?void 0:B.filter_json)||[],defaultValue:s.filter_json,ref:O=>l.value.filter_json=O,onOpen:S[2]||(S[2]=O=>o("updateVar")),onChange:S[3]||(S[3]=(O,P)=>g("filter_json",O,P)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:O,payload:P})=>[u("div",kR,[u("div",SR,H(O),1),u("div",ER,H(P.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),S[23]||(S[23]=u("div",{class:"desc"},'内容示例：{"conditions":[{"field_name":"文章ID","operator":"is","value":"123"}],"conjunction":"and"}',-1))],64)):(w(),Q(nR,{key:1,disabled:!n.tableId,where:s.filter.conditions,"field-options":n.fields,conjunction:s.filter.conjunction,onChange:h},null,8,["disabled","where","field-options","conjunction"]))]}),_:1},8,["count"])]),u("div",{class:"setting-box",onWheel:S[8]||(S[8]=Ct(()=>{},["stop"])),onTouchmove:S[9]||(S[9]=Ct(()=>{},["stop"]))},[m(us,{title:"查询字段",count:s.field_names.length},{extra:x(()=>[u("div",AR,[s.input_type_map.field_names!=1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:S[4]||(S[4]=B=>b("field_names_json"))},[m(K(po))])):ne("",!0),m(A,{value:s.input_type_map.field_names,"onUpdate:value":S[5]||(S[5]=B=>s.input_type_map.field_names=B),style:{width:"130px"},onChange:C},{default:x(()=>[m(k,{value:1},{default:x(()=>[...S[24]||(S[24]=[U("选择查询字段",-1)])]),_:1}),m(k,{value:2},{default:x(()=>[...S[25]||(S[25]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),default:x(()=>{var B;return[s.input_type_map.field_names!=1?(w(),R(se,{key:0},[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((B=s.tag_map)==null?void 0:B.field_names_json)||[],defaultValue:s.field_names_json,ref:O=>l.value.field_names_json=O,onOpen:S[6]||(S[6]=O=>o("updateVar")),onChange:S[7]||(S[7]=(O,P)=>g("field_names_json",O,P)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:O,payload:P})=>[u("div",DR,[u("div",OR,H(O),1),u("div",NR,H(P.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),S[26]||(S[26]=u("div",{class:"desc"},'内容示例：["文章ID","封面图","创建时间","介绍"]',-1))],64)):(w(),Q(tp,{key:1,showAdd:!!n.tableId,showInput:!1,showEmptyFieldRow:!n.tableId,list:s.field_names,fields:n.fields,onChange:y},null,8,["showAdd","showEmptyFieldRow","list","fields"]))]}),_:1},8,["count"])],32),u("div",{class:"setting-box",onWheel:S[14]||(S[14]=Ct(()=>{},["stop"])),onTouchmove:S[15]||(S[15]=Ct(()=>{},["stop"]))},[m(us,{title:"排序",count:s.sort.length},{extra:x(()=>[u("div",MR,[s.input_type_map.sort!=1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:S[10]||(S[10]=B=>b("sort_json"))},[m(K(po))])):ne("",!0),m(A,{value:s.input_type_map.sort,"onUpdate:value":S[11]||(S[11]=B=>s.input_type_map.sort=B),style:{width:"130px"},onChange:C},{default:x(()=>[m(k,{value:1},{default:x(()=>[...S[27]||(S[27]=[U("选择排序",-1)])]),_:1}),m(k,{value:2},{default:x(()=>[...S[28]||(S[28]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),default:x(()=>{var B;return[s.input_type_map.sort!=1?(w(),R(se,{key:0},[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((B=s.tag_map)==null?void 0:B.sort_json)||[],defaultValue:s.sort_json,ref:O=>l.value.sort_json=O,onOpen:S[12]||(S[12]=O=>o("updateVar")),onChange:S[13]||(S[13]=(O,P)=>g("sort_json",O,P)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:O,payload:P})=>[u("div",TR,[u("div",$R,H(O),1),u("div",RR,H(P.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),S[29]||(S[29]=u("div",{class:"desc"},'内容示例：[{"desc":false,"field_name":"文章ID"},{"desc":true,"field_name":"更新时间"}]',-1))],64)):(w(),Q(yR,{key:1,disabled:!n.tableId,list:s.sort,fields:n.fields,onChange:v},null,8,["disabled","list","fields"]))]}),_:1},8,["count"])],32),S[30]||(S[30]=u("div",{class:"setting-label"},[u("span",null,"查询数量")],-1)),u("div",{class:"setting-box",onWheel:S[17]||(S[17]=Ct(()=>{},["stop"])),onTouchmove:S[18]||(S[18]=Ct(()=>{},["stop"]))},[m($,{value:s.page_size,"onUpdate:value":S[16]||(S[16]=B=>s.page_size=B),disabled:!n.tableId,min:20,max:500,style:{width:"205px"},onChange:C},null,8,["value","disabled"])],32)]),m(Hi,{options:n.variableOptions,defaultSelectedList:p.value,defaultValue:c.value,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:S[19]||(S[19]=B=>o("updateVar")),onChange:S[20]||(S[20]=(B,O)=>_(B,O)),onOk:T,ref_key:"fullAtInputRef",ref:a},null,8,["options","defaultSelectedList","defaultValue"])])}}},LR=Ne(PR,[["__scopeId","data-v-ea76d158"]]),BR={class:"field-item"},IR={class:"field-key"},jR={class:"tip-content"},FR={class:"field-type"},VR={class:"field-name"},HR={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=X([]);return(o,i)=>{const r=On,s=Zt,a=Wc;return w(),R("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=Ct(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=Ct(()=>{},["stop"]))},[m(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:x(({switcherCls:l})=>[u("span",{class:xt(l)},[m(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:l})=>[u("div",BR,[u("span",IR,H(l.key),1),l.tip?(w(),Q(s,{key:0,overlayStyle:{maxWidth:"800px"}},{title:x(()=>[u("div",jR,H(l.tip),1)]),default:x(()=>[m(K(ft),{style:{"margin-left":"4px"}})]),_:2},1024)):ne("",!0),u("span",FR,H(l.typ),1),u("span",VR,H(l.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},Oi=Ne(HR,[["__scopeId","data-v-9b9c09b2"]]),UR={class:"add-data-form"},zR={class:"node-box-content"},qR={class:"options-item-tit"},GR={class:"flex-between"},XR={class:"option-label"},WR={class:"option-type"},YR=["onClick"],JR={class:"field-list-item"},KR={class:"field-label"},ZR={class:"field-type"},QR={class:"desc"},eP={__name:"feishu-batch-box",props:{actionName:{type:String},action:{type:Object},variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Je({}),s=X(null),a=X([]),l=X(""),d=X(-1),c=X(""),p=X([]);at(()=>{h()});function f(b,C){l.value=b,d.value=C;const T=r[b]||{};c.value=T.value||"",p.value=T.tags||[],s.value.show()}function h(b=null){var T,M,S;const C=T_(((T=i.action)==null?void 0:T.params)||{});for(let k in C){const A=r[k]||{};r[k]={...C[k],value:A.value??C[k].value??"",tags:A.tags??C[k].tags??[]}}if(b){let k=((S=(M=b==null?void 0:b.plugin)==null?void 0:M.params)==null?void 0:S.arguments)||{},A=(k==null?void 0:k.tag_map)||{};for(let $ in r){const B=r[$]||{};!!String(B.value||"").length||Array.isArray(B.tags)&&B.tags.length>0||(r[$].value=k[$]??B.value??"",r[$].tags=A[$]??B.tags??[])}}}function v(b,C,T){b.value=C,b.tags=T,g()}function y(b,C){const T=l.value;if(!T)return;const M=r[T];M&&(M.value=b,M.tags=C,g())}const g=()=>{let b={tag_map:{}};for(let C in r)b[C]=r[C].value,b.tag_map[C]=r[C].tags;o("update",b)};function _(){const b=d.value;if(b!=null&&b>-1){const C=a.value||[],T=Array.isArray(C)?C[b]:C;T&&T.refresh&&T.refresh()}}return e({init:h}),(b,C)=>(w(),R("div",UR,[u("div",zR,[(w(!0),R(se,null,ge(r,(T,M,S)=>(w(),R("div",{key:M,class:"options-item is-required"},[u("div",qR,[u("div",GR,[u("div",XR,H(T.name||M),1),u("div",WR,H(T.type),1)]),u("div",{class:"btn-hover-wrap",onClick:k=>f(M,S)},[m(K(po))],8,YR)]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:T.tags,defaultValue:T.value,ref_for:!0,ref_key:"atInputRef",ref:a,onOpen:C[0]||(C[0]=k=>o("updateVar")),onChange:(k,A)=>v(T,k,A),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:k,payload:A})=>[u("div",JR,[u("div",KR,H(k),1),u("div",ZR,H(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",QR,H(T.desc),1)]))),128))]),m(Hi,{options:n.variableOptions,defaultSelectedList:p.value,defaultValue:c.value,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:C[1]||(C[1]=T=>o("updateVar")),onChange:C[2]||(C[2]=(T,M)=>y(T,M)),onOk:_,ref_key:"fullAtInputRef",ref:s},null,8,["options","defaultSelectedList","defaultValue"])]))}},tP=Ne(eP,[["__scopeId","data-v-1dcb9756"]]),nP={class:"options-item is-required"},oP={class:"min-input"},iP={class:"field-list-item"},rP={class:"field-label"},sP={class:"field-type"},aP={__name:"feishu-create-bitable",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({tag_map:{},name:""});function r(l=null){var d,c,p;l&&((p=(c=(d=l==null?void 0:l.plugin)==null?void 0:d.params)==null?void 0:c.arguments)!=null&&p.name)&&(i.name=l.plugin.params.arguments.name,i.tag_map=l.plugin.params.arguments.tag_map||{})}function s(l,d){i.name=l,i.tag_map.name=d,a()}function a(){o("update",JSON.parse(JSON.stringify(i)))}return e({init:r,update:a}),(l,d)=>(w(),R("div",nP,[d[1]||(d[1]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"多维表格名称"),u("div",{class:"option-type"},"string")],-1)),u("div",oP,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:i.tag_map.name||[],defaultValue:i.name,ref:"atInputRef",onOpen:d[0]||(d[0]=c=>o("updateVar")),onChange:s,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:c,payload:p})=>[u("div",iP,[u("div",rP,H(c),1),u("div",sP,H(p.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),d[2]||(d[2]=u("div",{class:"desc"},'多维表格 App 名称。最长为 255 个字符。 示例值："一篇新的多维表格"',-1))]))}},lP=Ne(aP,[["__scopeId","data-v-0b72ab0c"]]),uP={class:"options-item is-required"},dP={class:"min-input"},cP={class:"field-list-item"},pP={class:"field-label"},fP={class:"field-type"},hP={class:"options-item"},vP={class:"min-input"},_P={class:"field-list-item"},gP={class:"field-label"},mP={class:"field-type"},yP={class:"options-item"},bP={class:"options-item-tit flex-between"},xP={class:"field-list-item"},wP={class:"field-label"},CP={class:"field-type"},kP={__name:"feishu-create-table",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X(null),r=X(null),s=Je({name:"",default_view_name:"",fields:"",tag_map:{}});function a(f=null){var h,v,y,g,_,b;f&&((v=(h=f==null?void 0:f.plugin)==null?void 0:h.params)!=null&&v.arguments)&&(s.name=((y=f.plugin.params.arguments)==null?void 0:y.name)||"",s.default_view_name=((g=f.plugin.params.arguments)==null?void 0:g.default_view_name)||"",s.fields=((_=f.plugin.params.arguments)==null?void 0:_.fields)||"",s.tag_map=((b=f.plugin.params.arguments)==null?void 0:b.tag_map)||{})}function l(f,h,v){s[f]=h,s.tag_map[f]=v,p()}function d(){i.value.show()}function c(){r.value.refresh()}function p(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a,update:p}),(f,h)=>{var v,y,g,_;return w(),R("div",null,[u("div",uP,[h[8]||(h[8]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"数据表名称"),u("div",{class:"option-type"},"string")],-1)),u("div",dP,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((v=s==null?void 0:s.tag_map)==null?void 0:v.name)||[],defaultValue:s.name,ref_key:"atInputRef",ref:r,onOpen:h[0]||(h[0]=b=>o("updateVar")),onChange:h[1]||(h[1]=(b,C)=>l("name",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[u("div",cP,[u("div",pP,H(b),1),u("div",fP,H(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[9]||(h[9]=u("div",{class:"desc"},'数据表名称；名称中的首尾空格将会被默认去除，不可以包含 / \\\\ ? * : [ ] 等特殊字符"；1 字符 ～ 100 字符 ',-1))]),u("div",hP,[h[10]||(h[10]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"表格视图的名称"),u("div",{class:"option-type"},"string")],-1)),u("div",vP,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((y=s==null?void 0:s.tag_map)==null?void 0:y.default_view_name)||[],defaultValue:s.default_view_name,ref_key:"atInputRef",ref:r,onOpen:h[2]||(h[2]=b=>o("updateVar")),onChange:h[3]||(h[3]=(b,C)=>l("default_view_name",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[u("div",_P,[u("div",gP,H(b),1),u("div",mP,H(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[11]||(h[11]=u("div",{class:"desc"},"表格视图的名称；名称中的首尾空格将会被默认去除，名称中不允许包含 [ ] 两个字符",-1))]),u("div",yP,[u("div",bP,[h[12]||(h[12]=u("div",{class:"flex-between"},[u("div",{class:"option-label"},"数据表的初始字段"),u("div",{class:"option-type"},"jsonString")],-1)),u("div",{class:"btn-hover-wrap",onClick:d},[m(K(po))])]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((g=s==null?void 0:s.tag_map)==null?void 0:g.fields)||[],defaultValue:s.fields,ref_key:"atInputRef",ref:r,onOpen:h[4]||(h[4]=b=>o("updateVar")),onChange:h[5]||(h[5]=(b,C)=>l("fields",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[u("div",xP,[u("div",wP,H(b),1),u("div",CP,H(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[13]||(h[13]=u("div",{class:"desc"},'如果传入了 表格视图的名称，则必须传入 数据表的初始字段。示例：[{"field_name":"索引字段","type":1},{"field_name":"单选","type":3,"ui_type":"SingleSelect","property":{"options":[{"name":"Enabled"},{"name":"Disabled"}]}}] ',-1))]),m(Hi,{options:n.variableOptions,defaultSelectedList:((_=s==null?void 0:s.tag_map)==null?void 0:_.fields)||[],defaultValue:s.fields,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:h[6]||(h[6]=b=>o("updateVar")),onChange:h[7]||(h[7]=(b,C)=>l("fields",b,C)),onOk:c,ref_key:"fullAtInputRef",ref:i},null,8,["options","defaultSelectedList","defaultValue"])])}}},SP=Ne(kP,[["__scopeId","data-v-e75ca588"]]),EP={class:"options-item is-required"},AP={class:"min-input"},DP={class:"field-list-item"},OP={class:"field-label"},NP={class:"field-type"},MP={class:"options-item"},TP={class:"min-input"},$P={__name:"feishu-create-view",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({view_name:"",view_type:"grid",tag_map:{}}),r=[{label:"表格视图",value:"grid"},{label:"看板视图",value:"kanban"},{label:"画册视图",value:"gallery"},{label:"甘特视图",value:"gantt"},{label:"表单视图",value:"form"}];function s(d=null){var c,p,f,h,v;d&&((p=(c=d==null?void 0:d.plugin)==null?void 0:c.params)!=null&&p.arguments)&&(i.name=((f=d.plugin.params.arguments)==null?void 0:f.name)||"",i.view_name=((h=d.plugin.params.arguments)==null?void 0:h.view_name)||"",i.tag_map=((v=d.plugin.params.arguments)==null?void 0:v.tag_map)||{})}function a(d,c,p){i[d]=c,i.tag_map[d]=p,l()}function l(){o("update",JSON.parse(JSON.stringify(i)))}return e({init:s,update:l}),(d,c)=>{var f;const p=$t;return w(),R("div",null,[u("div",EP,[c[3]||(c[3]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"视图名称"),u("div",{class:"option-type"},"string")],-1)),u("div",AP,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((f=i==null?void 0:i.tag_map)==null?void 0:f.view_name)||[],defaultValue:i.view_name,ref:"atInputRef",onOpen:c[0]||(c[0]=h=>o("updateVar")),onChange:c[1]||(c[1]=(h,v)=>a("view_name",h,v)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:h,payload:v})=>[u("div",DP,[u("div",OP,H(h),1),u("div",NP,H(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),c[4]||(c[4]=u("div",{class:"desc"},"视图名称。名称不能包含特殊字符；不可以包含 [ ] 等特殊字符；1 字符 ～ 100 字符",-1))]),u("div",MP,[c[5]||(c[5]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"视图类型"),u("div",{class:"option-type"},"string")],-1)),u("div",TP,[m(p,{value:i.view_type,"onUpdate:value":c[2]||(c[2]=h=>i.view_type=h),options:r,placeholder:"选择视图",style:{width:"100%"}},null,8,["value"])]),c[6]||(c[6]=u("div",{class:"desc"},"视图类型，默认为表格视图。",-1))])])}}},RP=Ne($P,[["__scopeId","data-v-e8b3ac59"]]),PP={class:"options-item is-required"},LP={class:"min-input"},BP={class:"field-list-item"},IP={class:"field-label"},jP={class:"field-type"},FP={class:"options-item is-required"},VP={class:"min-input"},HP={class:"options-item is-required"},UP={class:"min-input"},zP={class:"field-list-item"},qP={class:"field-label"},GP={class:"field-type"},XP={__name:"feishu-add-members",props:{config:{type:Object,default:()=>({app_id:"",app_secret:"",app_token:""})},variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=["user_id"],r=X(null);X([]);const s=Je({member_id:"",role_id:void 0,role_name:"",member_id_type:"user_id",tag_map:{}});function a(c=null){var p,f;c&&((f=(p=c==null?void 0:c.plugin)==null?void 0:p.params)!=null&&f.arguments)&&Object.assign(s,c.plugin.params.arguments)}function l(c,p,f){s[c]=p,s.tag_map[c]=f,d()}function d(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a,update:d}),(c,p)=>{var v,y;const f=Lt,h=$t;return w(),R("div",null,[u("div",PP,[p[5]||(p[5]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"选择角色"),u("div",{class:"option-type"},"string")],-1)),u("div",LP,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((v=s==null?void 0:s.tag_map)==null?void 0:v.role_id)||[],defaultValue:s.role_id,ref_key:"atInputRef",ref:r,onOpen:p[0]||(p[0]=g=>o("updateVar")),onChange:p[1]||(p[1]=(g,_)=>l("role_id",g,_)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:g,payload:_})=>[u("div",BP,[u("div",IP,H(g),1),u("div",jP,H(_.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),u("div",FP,[p[6]||(p[6]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"协作者ID的类型"),u("div",{class:"option-type"},"string")],-1)),u("div",VP,[m(h,{value:s.member_id_type,"onUpdate:value":p[2]||(p[2]=g=>s.member_id_type=g),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(),R(se,null,ge(i,g=>m(f,{key:g},{default:x(()=>[U(H(g),1)]),_:2},1024)),64))]),_:1},8,["value"])]),p[7]||(p[7]=u("div",{class:"desc"},"协作者ID的类型，仅支持 user_id",-1))]),u("div",HP,[p[8]||(p[8]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"协作者ID"),u("div",{class:"option-type"},"string")],-1)),u("div",UP,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((y=s==null?void 0:s.tag_map)==null?void 0:y.member_id)||[],defaultValue:s.member_id,ref_key:"atInputRef",ref:r,onOpen:p[3]||(p[3]=g=>o("updateVar")),onChange:p[4]||(p[4]=(g,_)=>l("member_id",g,_)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:g,payload:_})=>[u("div",zP,[u("div",qP,H(g),1),u("div",GP,H(_.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),p[9]||(p[9]=u("div",{class:"desc"},[U("协作者ID，"),u("a",{href:"https://open.feishu.cn/document/platform-overveiw/basic-concepts/user-identity-introduction/open-id",target:"_blank"},"如何获取协作者ID")],-1))])])}}},WP=Ne(XP,[["__scopeId","data-v-127e6c85"]]),YP={class:"options-item is-required"},JP={class:"min-input"},KP={class:"field-list-item"},ZP={class:"field-label"},QP={class:"field-type"},e5={class:"options-item is-required"},t5={class:"flex-between"},n5={class:"min-input"},o5={__name:"feishu-update-advanced",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X(null),r=Je({name:"",is_advanced:"0",tag_map:{}});function s(c=null){var p,f;c&&((f=(p=c==null?void 0:c.plugin)==null?void 0:p.params)!=null&&f.arguments)&&Object.assign(r,c.plugin.params.arguments)}function a(c,p,f){r[c]=p,r.tag_map[c]=f,d()}function l(c){r.is_advanced=c?"1":"0",d()}function d(){o("update",JSON.parse(JSON.stringify(r)))}return e({init:s,update:d}),(c,p)=>{var y;const f=Fi,h=ro,v=io;return w(),R("div",null,[u("div",YP,[p[3]||(p[3]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"多维表格的名称"),u("div",{class:"option-type"},"string")],-1)),u("div",JP,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((y=r==null?void 0:r.tag_map)==null?void 0:y.name)||[],defaultValue:r.name,ref_key:"atInputRef",ref:i,onOpen:p[0]||(p[0]=g=>o("updateVar")),onChange:p[1]||(p[1]=(g,_)=>a("name",g,_)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:g,payload:_})=>[u("div",KP,[u("div",ZP,H(g),1),u("div",QP,H(_.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),p[4]||(p[4]=u("div",{class:"desc"},"更新多维表格的名称",-1))]),u("div",e5,[u("div",t5,[p[5]||(p[5]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"开启高级权限"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(f,{checked:r.is_advanced>0,onChange:l},null,8,["checked"])])]),u("div",n5,[m(v,{value:r.is_advanced,"onUpdate:value":p[2]||(p[2]=g=>r.is_advanced=g),disabled:r.is_advanced<1,onChange:d},{default:x(()=>[m(h,{value:"1"},{default:x(()=>[...p[6]||(p[6]=[U("开启",-1)])]),_:1}),m(h,{value:"2"},{default:x(()=>[...p[7]||(p[7]=[U("关闭",-1)])]),_:1})]),_:1},8,["value","disabled"])]),p[8]||(p[8]=u("div",{class:"desc"},"多维表格是否已开启高级权限，开关关闭则不更新设置",-1))])])}}},i5=Ne(o5,[["__scopeId","data-v-870e11fb"]]),r5={class:"main-box"},s5={key:0,class:"loading-box"},a5={class:"node-options"},l5={class:"options-title"},u5={class:"options-item is-required"},d5={class:"min-input"},c5={class:"field-list-item"},p5={class:"field-label"},f5={class:"field-type"},h5={key:0,class:"options-item is-required"},v5={class:"flex-center min-input"},_5={class:"field-list-item"},g5={class:"field-label"},m5={class:"field-type"},y5={class:"node-options"},b5={class:"options-item"},zp="feishu_bitable",x5={__name:"feishu-bittable-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=Ve("setData"),r={search_records:LR,create_record:k$,update_record:L$,delete_record:H$,create_bitable:lP,create_tables:SP,create_views:RP,table_add_members:WP,update_advanced:i5},s=X(null),a=X(null),l=X({}),d=X(null),c=Je({app_token:"",table_id:void 0,tag_map:{},table_set_type:"1"}),p=X(!1),f=X(!1),h=X({}),v=X([]),y=X([]),g=We(()=>{var Y;return((Y=l.value)==null?void 0:Y[d.value])||{}}),_=X([]);at(()=>{b()});async function b(){await T(),A(),F()}function C(){a.value.show(l.value)}async function T(Y=!1){await f_(zp,Y).then(L=>{l.value=L||{};for(let j in l.value)if(l.value[j].is_default){d.value=j;break}d.value||(d.value=Object.keys(l.value)[0])})}function M(){var Y;return p.value=!0,h.value={},v.value=[],!Fd(c.app_token)||Array.isArray((Y=c.tag_map)==null?void 0:Y.app_token)&&c.tag_map.app_token.length?(p.value=!1,Promise.resolve(null)):Ho({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_tables",arguments:{app_id:g.value.appid,app_secret:g.value.app_secret,app_token:c.app_token}})}).then(L=>(h.value=(L==null?void 0:L.data)||{},v.value=h.value.items||[],!c.table_id&&v.value.length==1&&(c.table_id=v.value[0].table_id,E()),L)).catch(()=>(h.value={},v.value=[],c.table_set_type==1&&(c.table_id=void 0),y.value=[],null)).finally(()=>{p.value=!1})}function S(){var Y,L;return f.value=!0,!Fd(c.app_token)||!c.table_id||(L=(Y=c.tag_map)==null?void 0:Y.table_id)!=null&&L.length?(f.value=!1,Promise.resolve(null)):Ho({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_table_fields",arguments:{app_id:g.value.appid,app_secret:g.value.app_secret,app_token:c.app_token,table_id:c.table_id}})}).then(j=>{var z;let le=((z=j==null?void 0:j.data)==null?void 0:z.items)||[];return y.value=le.filter(V=>U$.includes(V.ui_type)),j}).finally(()=>{f.value=!1})}function k(Y){var L,j,le;if(!Y)return h_(zp,o.actionName);Y=JSON.parse(JSON.stringify(Y));for(let z in Y)switch(z){case"filter":if(Array.isArray(Y.filter.conditions)&&Y.filter.conditions.length)for(let V of Y.filter.conditions)V.field_type==="DateTime"&&V.value&&(V.value<1e11&&(V.value*=1e3),V.value=["ExactDate",V.value].join(","));break;case"fields":for(let V of Y.fields)if(!((L=V==null?void 0:V.atTags)!=null&&L.length)){if(V.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(V.ui_type)&&(V.value=Number(V.value)),V.ui_type==="Currency"&&(V.value=V.value.toFixed(2))),V.ui_type==="Checkbox"&&(V.value=V.value=="true"),V.ui_type==="MultiSelect"&&!Array.isArray(V.value))if(typeof V.value=="string"){const J=V.value.trim();V.value=J?J.replace(/，/g,",").split(","):[]}else V.value=[];V.ui_type==="DateTime"&&V.value<1e11&&(V.value*=1e3)}break;case"field_names":Y.field_names=Y.field_names.map(V=>V.field_name);break;case"sort":Y.sort=Y.sort.map(V=>({field_name:V.field_name,desc:V.is_asc!=1}));break;case"input_type_map":for(let V in Y[z])Y[z][V]==2&&(Y[V]=Fo(Y[`${V}_json`],V=="filter"?{}:[]));break}return Y.tag_map&&(c.tag_map={...Y.tag_map,app_token:((j=c==null?void 0:c.tag_map)==null?void 0:j.app_token)||[],table_id:((le=c==null?void 0:c.tag_map)==null?void 0:le.table_id)||[]}),delete Y.field_names_json,delete Y.filter_json,delete Y.sort_json,delete Y.fields_json,Y}function A(){var j,le;let Y=JSON.parse(o.node.node_params),L=((le=(j=Y==null?void 0:Y.plugin)==null?void 0:j.params)==null?void 0:le.arguments)||{};if(L.table_set_type&&(c.table_set_type=L.table_set_type),L.tag_map&&(c.tag_map=L.tag_map),L.app_token&&(c.app_token=L.app_token),L.table_id&&(c.table_id=L.table_id),L.app_id&&L.app_secret)for(let z in l.value){let V=l.value[z];V.appid==L.app_id&&V.app_secret==L.app_secret&&(d.value=z)}D(Y),c.app_token&&!["table_add_members","update_advanced"].includes(o.actionName)&&M(),c.table_id&&S().then(()=>D(Y))}function $(){var Y,L;c.table_set_type==1?(c.table_id=((L=(Y=v.value)==null?void 0:Y[0])==null?void 0:L.table_id)||void 0,c.tag_map.table_id=[],y.value=[],S().then(()=>D())):(c.table_id="",y.value=[],o.actionName==="create_record"?D({plugin:{params:{arguments:{fields:[]}}}}):D()),N({fields:[]})}function B(Y,L,j){c[Y]=L,c.tag_map[Y]=j,Y==="app_token"?P():Y==="table_id"?E():N()}function O(){c.app_token?M().then(()=>D()):D(),c.table_id&&S().then(()=>D()),N()}function P(){const Y=c.table_id;y.value=[],M().then(()=>{var j,le,z,V;const L=v.value.find(J=>J.table_id==Y);c.table_set_type==2?(c.table_id=Y,o.actionName==="create_record"&&typeof((j=s.value)==null?void 0:j.clear)=="function"&&s.value.clear(),o.actionName==="search_records"&&typeof((le=s.value)==null?void 0:le.clearSelections)=="function"&&s.value.clearSelections(),D()):L?(c.table_id=Y,S().then(()=>{var J,oe;o.actionName==="create_record"?typeof((J=s.value)==null?void 0:J.clear)=="function"&&s.value.clear():o.actionName!=="create_tables"&&o.actionName!=="create_views"&&o.actionName!=="create_bitable"?D({plugin:{params:{arguments:{fields:[]}}}}):D(),o.actionName==="search_records"&&typeof((oe=s.value)==null?void 0:oe.clearSelections)=="function"&&s.value.clearSelections()})):(c.table_id=void 0,o.actionName==="create_record"?typeof((z=s.value)==null?void 0:z.clear)=="function"&&s.value.clear():o.actionName!=="create_tables"&&o.actionName!=="create_views"&&o.actionName!=="create_bitable"?D({plugin:{params:{arguments:{fields:[]}}}}):D(),o.actionName==="search_records"&&typeof((V=s.value)==null?void 0:V.clearSelections)=="function"&&s.value.clearSelections())}).catch(()=>{var L,j,le;v.value=[],y.value=[],c.table_set_type==1?(c.table_id=void 0,o.actionName==="create_record"?typeof((L=s.value)==null?void 0:L.clear)=="function"&&s.value.clear():o.actionName!=="create_tables"&&o.actionName!=="create_views"&&o.actionName!=="create_bitable"?D({plugin:{params:{arguments:{fields:[]}}}}):D()):o.actionName==="create_record"?typeof((j=s.value)==null?void 0:j.clear)=="function"&&s.value.clear():D(),o.actionName==="search_records"&&typeof((le=s.value)==null?void 0:le.clearSelections)=="function"&&s.value.clearSelections()}),N()}function E(){y.value=[],S().then(()=>{N({fields:[]}),D()})}function D(Y=null){Tt(()=>{var j;const L=Y??JSON.parse(o.node.node_params);typeof((j=s.value)==null?void 0:j.init)=="function"&&s.value.init(L)})}function N(Y=null){var oe,W;let L=JSON.parse(o.node.node_params),j=v.value.find(q=>q.table_id==c.table_id);const le=((W=(oe=L==null?void 0:L.plugin)==null?void 0:oe.params)==null?void 0:W.arguments)||{},z=Y?k(Y):{},V={...(le==null?void 0:le.tag_map)||{},...(z==null?void 0:z.tag_map)||{},...(c==null?void 0:c.tag_map)||{}},J={...le,...z,...c,tag_map:V,app_id:g.value.appid,app_secret:g.value.app_secret};L.plugin.output_obj=_.value,L.plugin.params=L.plugin.params||{},L.plugin.params.config_name=d.value,L.plugin.params.table_name=(j==null?void 0:j.name)||"",L.plugin.params.arguments=J,i({...o.node,node_params:JSON.stringify(L)})}function F(){_.value=Di(o.action.output)}return(Y,L)=>{var J,oe;const j=ho,le=Lt,z=$t,V=Xt;return w(),R("div",r5,[f.value||p.value?(w(),R("div",s5,[m(j)])):ne("",!0),u("div",a5,[u("div",l5,[L[11]||(L[11]=u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")],-1)),Object.keys(l.value).length?(w(),Q(z,{key:0,value:d.value,"onUpdate:value":L[0]||(L[0]=W=>d.value=W),onChange:O},{default:x(()=>[(w(!0),R(se,null,ge(l.value,W=>(w(),Q(le,{key:W.name,value:W.name},{default:x(()=>[U(H(W.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Q(V,{key:1,onClick:C},{default:x(()=>[L[10]||(L[10]=U("未授权 ",-1)),m(K(xo))]),_:1}))]),n.actionName!="create_bitable"?(w(),R(se,{key:0},[u("div",u5,[L[12]||(L[12]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"多维表")],-1)),u("div",d5,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((J=c.tag_map)==null?void 0:J.app_token)||[],defaultValue:c.app_token,ref:"atInputRef",onOpen:L[1]||(L[1]=W=>t("updateVar")),onChange:L[2]||(L[2]=(W,q)=>B("app_token",W,q)),placeholder:"请输入文档url，键入“/”可以插入变量"},{option:x(({label:W,payload:q})=>[u("div",c5,[u("div",p5,H(W),1),u("div",f5,H(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),L[13]||(L[13]=u("div",{class:"desc"},"多维表格的唯一标识符，支持输入文档 url",-1))]),["table_add_members","update_advanced","roles_list","create_tables"].includes(n.actionName)?ne("",!0):(w(),R("div",h5,[L[16]||(L[16]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"选择数据表")],-1)),u("div",v5,[m(z,{value:c.table_set_type,"onUpdate:value":L[3]||(L[3]=W=>c.table_set_type=W),onChange:$,style:{width:"112px","flex-shrink":"0"}},{default:x(()=>[m(le,{value:"1"},{default:x(()=>[...L[14]||(L[14]=[U("选择数据表",-1)])]),_:1}),m(le,{value:"2"},{default:x(()=>[...L[15]||(L[15]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value"]),c.table_set_type==1?(w(),Q(z,{key:0,value:c.table_id,"onUpdate:value":L[4]||(L[4]=W=>c.table_id=W),onChange:E,placeholder:c.app_token?"请选择数据表":"请先输入多维表文档url",style:{width:"100%"}},{default:x(()=>[(w(!0),R(se,null,ge(v.value,W=>(w(),Q(le,{key:W.table_id,value:W.table_id},{default:x(()=>[U(H(W.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(w(),Q(tt,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((oe=c.tag_map)==null?void 0:oe.table_id)||[],defaultValue:c.table_id,ref:"atInputRef",onOpen:L[5]||(L[5]=W=>t("updateVar")),onChange:L[6]||(L[6]=(W,q)=>B("table_id",W,q)),placeholder:"请输入表格id，键入“/”可以插入变量"},{option:x(({label:W,payload:q})=>[u("div",_5,[u("div",g5,H(W),1),u("div",m5,H(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))]),L[17]||(L[17]=u("div",{class:"desc"},"输入表格id，table_id 例如：tblz2wmlWiB1JGxS",-1))]))],64)):ne("",!0),K(Vd).includes(n.actionName)?(w(),Q(tP,{key:1,ref_key:"childRef",ref:s,variableOptions:n.variableOptions,actionName:n.actionName,action:n.action,onUpdateVar:L[7]||(L[7]=W=>t("updateVar")),onUpdate:N},null,8,["variableOptions","actionName","action"])):(w(),Q(Pu(r[n.actionName]),{key:2,ref_key:"childRef",ref:s,tableId:c.table_id,fields:y.value,variableOptions:n.variableOptions,config:{...g.value,...c},onUpdate:N,onUpdateVar:L[8]||(L[8]=W=>t("updateVar"))},null,40,["tableId","fields","variableOptions","config"]))]),u("div",y5,[L[18]||(L[18]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",b5,[m(Oi,{"tree-data":_.value},null,8,["tree-data"])])]),m(_C,{ref_key:"configModalRef",ref:a,onChange:L[9]||(L[9]=W=>T(!0))},null,512)])}}},w5=Ne(x5,[["__scopeId","data-v-8fd4c7eb"]]),C5={class:"node-options"},k5={class:"options-title"},S5={class:"options-item-tit"},E5={class:"option-label"},A5={class:"option-type"},D5={class:"field-list-item"},O5={class:"field-label"},N5={class:"field-type"},M5={class:"desc"},T5={key:0,class:"desc",style:{color:"#FB363F"}},$5={class:"node-options"},R5={class:"options-item"},Vu={__name:"pluginFormRender",props:{node:{type:Object,default:()=>({})},params:{type:Object},output:{type:Object},variableOptions:{type:Array},keepFormatField:{type:Array,default:()=>[]}},emits:["updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Ve("setData"),s=Je({}),a=X([]),l=JSON.parse(i.node.node_params),d={url:{label:(g,_)=>(g==null?void 0:g.name)||_,placeholder:"键入/选择参数，或者输入文本，以https:/开头",validate:g=>{if(Array.isArray(g.tags)&&g.tags.length>0)return g.__error=null,!0;const C=String(g.value||"").trim().startsWith("https:/");return g.__error=C?null:"请输入以https:/开头的网址",C}}};ct(s,g=>{v()},{deep:!0}),ct(()=>i.params,g=>{var C,T,M;Object.assign(s,JSON.parse(JSON.stringify(g||"{}")));let _=((T=(C=l==null?void 0:l.plugin)==null?void 0:C.params)==null?void 0:T.arguments)||{},b;for(let S in s)b=_[S]||"",!b&&Object.hasOwn(s[S],"default")&&(b=s[S].default),i.keepFormatField.includes(S)||(b=String(b)),b==="null"&&(b=null),s[S].value=b,s[S].tags=((M=_==null?void 0:_.tag_map)==null?void 0:M[S])||[]},{deep:!0,immediate:!0}),ct(()=>i.output,g=>{a.value=Di(JSON.parse(JSON.stringify(i.output||"{}")))},{deep:!0,immediate:!0});function c(g,_,b,C){g.value=_,g.tags=b,h(C,g),v()}function p(g,_){const b=d[_];return b&&b.label?b.label(g,_):(g==null?void 0:g.name)||_}function f(g){const _=d[g];return _&&_.placeholder?_.placeholder:"请输入内容，键入“/”可以插入变量"}function h(g,_){const b=d[g];return b&&b.validate?b.validate(_):(_.__error=null,!0)}function v(){var C,T;let g=JSON.parse(i.node.node_params);g.plugin.output_obj=a.value;let _={tag_map:{}},b;for(let M in s)b=s[M].value,(T=(C=s[M])==null?void 0:C.tags)!=null&&T.length||(s[M].type=="string"?b=String(b):["number","integer"].includes(s[M].type)&&(b=Number(b))),_[M]=b,_.tag_map[M]=s[M].tags;Object.assign(g.plugin.params,{arguments:{..._}}),r({...i.node,node_params:JSON.stringify(g)})}function y(g={}){Object.assign(s,g),v()}return e({setState:y}),(g,_)=>(w(),R("div",null,[u("div",C5,[u("div",k5,[_[1]||(_[1]=u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")],-1)),bi(g.$slots,"input-title-extra")]),(w(!0),R(se,null,ge(s,(b,C)=>(w(),R(se,{key:C},[g.$slots[C]?bi(g.$slots,C,{key:0,state:s,item:b,keyName:C}):(w(),R("div",{key:1,class:xt(["options-item",{"is-required":b.required}])},[u("div",S5,[u("div",E5,H(p(b,C)),1),u("div",A5,H(b.type),1)]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:b.tags,defaultValue:b.value,ref_for:!0,ref:"atInputRef",onOpen:_[0]||(_[0]=T=>o("updateVar")),onChange:(T,M)=>c(b,T,M,C),placeholder:f(C)},{option:x(({label:T,payload:M})=>[u("div",D5,[u("div",O5,H(T),1),u("div",N5,H(M.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),u("div",M5,H(b.desc),1),b.__error?(w(),R("div",T5,H(b.__error),1)):ne("",!0)],2))],64))),128))]),u("div",$5,[_[2]||(_[2]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",R5,[m(Oi,{"tree-data":a.value},null,8,["tree-data"])])])]))}},P5={class:"options-item is-required"},L5={class:"options-item is-required"},B5={class:"options-item-tit"},I5={class:"tag-box"},j5={class:"field-list-item"},F5={class:"field-label"},V5={class:"field-type"},H5={__name:"official-account-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=X([]),r=X([]),s=X({}),a=X(!1),l=X({app_id:"",app_secret:""});at(()=>{var b,C,T;if(c(),d(),o.actionName==="getTagFans"){let M=Fo((b=o.node)==null?void 0:b.node_params);if(M){let S=((T=(C=M==null?void 0:M.plugin)==null?void 0:C.params)==null?void 0:T.arguments)||{};const{app_id:k,app_secret:A}=S;k&&A&&(l.value={app_id:k,app_secret:A},f())}}});function d(){const b={...o.action.params,app_id:{...o.action.params.app_id,default:null},app_name:{desc:"公众号名称",type:"string"}};o.actionName==="getTagFans"?(Object.assign(b,{tagid:{...o.action.params.tagid,default:null},tag_name:{desc:"标签名称",type:"string"},tag_type:{desc:"标签类型",type:"number",default:1}}),s.value=zc(b,["app_id","tagid"])):s.value=b}function c(){Ir({app_type:"official_account"}).then(b=>{i.value=(b==null?void 0:b.data)||[]})}function p(){if(!l.value.app_secret||!l.value.app_id)return mt.warning("请先选择公众号");a.value||(a.value=!0,f().then(()=>{mt.success("同步完成")}).finally(()=>{a.value=!1}))}function f(){return Ho({name:"official_account_profile",action:"default/exec",params:JSON.stringify({business:"getTags",arguments:l.value})}).then(b=>{var C;return r.value=((C=b==null?void 0:b.data)==null?void 0:C.tags)||[],b})}function h(b,C){b.app_secret.value=C.secret,b.app_name.value=C.name,o.actionName==="getTagFans"&&(l.value={app_id:C.key,app_secret:C.secret},f())}function v(b){b.tag_name.value="",b.tag_type.value==1?b.tagid.value=null:b.tagid.value=""}function y(b,C,T){b.tag_name.value=T.name}function g(b,C,T){b.value=C,b.tags=T}const _=(b,C)=>C.name.toLowerCase().indexOf(b.toLowerCase())>=0;return(b,C)=>{const T=Lt,M=$t,S=ho,k=Zt;return w(),Q(Vu,{node:n.node,params:s.value,output:n.action.output,variableOptions:n.variableOptions,keepFormatField:["tagid","tag_type"],onUpdateVar:C[1]||(C[1]=A=>t("updateVar"))},{tag_name:x(()=>[...C[2]||(C[2]=[])]),tag_type:x(()=>[...C[3]||(C[3]=[])]),app_name:x(()=>[...C[4]||(C[4]=[])]),app_secret:x(()=>[...C[5]||(C[5]=[])]),app_id:x(({state:A,item:$,keyName:B})=>[u("div",P5,[C[6]||(C[6]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"公众号")],-1)),u("div",null,[m(M,{value:$.value,"onUpdate:value":O=>$.value=O,placeholder:"请选择公众号",style:{width:"100%"},onChange:(O,P)=>h(A,P)},{default:x(()=>[(w(!0),R(se,null,ge(i.value,O=>(w(),Q(T,{key:O.app_id,value:O.app_id,name:O.app_name,secret:O.app_secret},{default:x(()=>[U(H(O.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])])])]),tagid:x(({state:A,item:$,keyName:B})=>[u("div",L5,[u("div",B5,[C[8]||(C[8]=u("div",{class:"option-label"},"公众号标签",-1)),m(k,{title:"同步最新的公众号标签"},{default:x(()=>[u("a",{onClick:p},[C[7]||(C[7]=U("同步 ",-1)),a.value?(w(),Q(S,{key:0,size:"small"})):ne("",!0)])]),_:1})]),u("div",I5,[m(M,{value:A.tag_type.value,"onUpdate:value":O=>A.tag_type.value=O,onChange:O=>v(A),style:{width:"120px"}},{default:x(()=>[m(T,{value:1},{default:x(()=>[...C[9]||(C[9]=[U("选择标签",-1)])]),_:1}),m(T,{value:2},{default:x(()=>[...C[10]||(C[10]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value","onUpdate:value","onChange"]),A.tag_type.value==1?(w(),Q(M,{key:0,value:$.value,"onUpdate:value":O=>$.value=O,placeholder:"请选择标签","show-search":"","filter-option":_,style:{width:"100%"},onChange:(O,P)=>y(A,O,P)},{default:x(()=>[(w(!0),R(se,null,ge(r.value,O=>(w(),Q(T,{key:O.id,value:O.id,name:O.name},{default:x(()=>[U(H(O.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):(w(),Q(tt,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:$.tags||[],defaultValue:$.value,ref:"atInputRef",onOpen:C[0]||(C[0]=O=>t("updateVar")),onChange:(O,P)=>g($,O,P),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:O,payload:P})=>[u("div",j5,[u("div",F5,H(O),1),u("div",V5,H(P.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]))])])]),_:1},8,["node","params","output","variableOptions"])}}},U5=Ne(H5,[["__scopeId","data-v-3fb4ac5a"]]),z5={class:"tpl-container"},q5={class:"node-options"},G5={class:"options-item is-required"},X5={class:"options-item is-required"},W5={class:"options-item-tit"},Y5={class:"options-item is-required"},J5={class:"field-list-item"},K5={class:"field-label"},Z5={class:"field-type"},Q5={class:"options-item-tit"},eL={class:"option-label"},tL={class:"field-list-item"},nL={class:"field-label"},oL={class:"field-type"},iL={class:"options-item is-required"},rL={key:0,class:"options-item is-required"},sL={class:"field-list-item"},aL={class:"field-label"},lL={class:"field-type"},uL={class:"options-item is-required"},dL={class:"field-list-item"},cL={class:"field-label"},pL={class:"field-type"},fL={class:"options-item is-required"},hL={class:"field-list-item"},vL={class:"field-label"},_L={class:"field-type"},gL={class:"node-options"},mL={class:"options-item"},yL="official_send_template_message",bL={__name:"official-template-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=Ve("setData"),r=X([]),s=X([]),a=X(!1),l=X([]),d=Je({app_id:void 0,template_id:void 0,app_secret:"",touser:"",url:"",data:{},miniprogram:{appid:{value:"",tags:[]},pagepath:{value:"",tags:[]}},link_type:0,tag_map:{}}),c={thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:"20个以内字符,可汉字、数字、字母或符号组合"},short_thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,5}$/,txt:"5个以内字符,可汉字、数字、字母或符号组合"},number:{reg:/^\d{1,32}(.\d{1,2})?$/,txt:"32位以内数字,只能数字，可带小数"},const:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:"20位以内字符，超过无法下发注"},letter:{reg:/^[a-zA-Z]{1,32}$/,txt:"32位以内字母，只能字母"},symbol:{reg:/^[\W_]{1,5}$/,txt:"5位以内符号，只能符号"},character_string:{reg:/^[a-zA-Z0-9\W_]{1,32}$/,txt:"32位以内数字、字母或符号，可数字、字母或符号组合"},time:{reg:/^\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:"24小时制时间格式（支持+年月日），支持填时间段，两个时间点之间用“~”符号连接 例如：2019年10月1日 15:01~2019年10月1日 18:01"},date:{reg:/^\d{4}年\d{1,2}月\d{1,2}日(\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:"年月日格式（支持+24小时制时间），支持填时间段，两个时间点之间用“~”符号连接 例如：2019年10月1日 15:01~2019年10月1日 18:01"},amount:{reg:/^[$¥]?\d{1,10}(.\d{1,2})?[元]?$/,txt:"金额，1个币种符号+10位以内纯数字，可带小数，结尾可带“元”	可带小数 例如：¥200元、$200"},phone_number:{reg:/^[0-9-+*# ]{5,17}$/,txt:"电话，17位以内，数字、符号"},car_number:{reg:/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[a-zA-Z0-9]{6,7}[\u4e00-\u9fa5]{0,1}$/,txt:"车牌，8位以内，第一位与最后一位可为汉字，其余为字母或数字"},name:{reg:/^(?:[\u4e00-\u9fa5]{1,10}|[a-zA-Z\p{P}]{1,20})$/,txt:"10个以内纯汉字或20个以内纯字母或符号"},phrase:{reg:/^[\u4e00-\u9fa5]{1,5}$/,txt:"汉字，5个以内汉字"}};at(()=>{p()}),ct(()=>o.action,()=>{var A;r.value=Di(JSON.parse(JSON.stringify(((A=o.action)==null?void 0:A.output)||"{}")))},{deep:!0,immediate:!0});function p(){f(),h()}function f(){Ir({app_type:"official_account"}).then(A=>{s.value=(A==null?void 0:A.data)||[]})}function h(){var B,O;let A=JSON.parse(o.node.node_params),$=((O=(B=A==null?void 0:A.plugin)==null?void 0:B.params)==null?void 0:O.arguments)||{};Object.assign(d,$),d.template_id&&_()}function v(A,$){const{key:B,secret:O,name:P}=$;d.app_secret=O,d.app_name=P,_()}function y(A,$){const{name:B,content:O}=$;d.template_name=B,d.data=S(O)}function g(){if(!d.app_secret||!d.app_id)return mt.warning("请先选择公众号");a.value||(a.value=!0,_().then(()=>{mt.success("同步完成")}).finally(()=>{a.value=!1}))}function _(){return Ho({name:yL,action:"default/exec",params:JSON.stringify({business:"getAllTemplates",arguments:{app_id:d.app_id,app_secret:d.app_secret}})}).then(A=>{var $;l.value=(($=A==null?void 0:A.data)==null?void 0:$.template_list)||[]})}function b(A,$,B,O=null){A.value=$,A.tags=B,O&&(B.length?A.format_err=!1:k(O,A)),M()}function C(A,$,B){d[A]=$,d.tag_map[A]=B,M()}function T(){switch(d.link_type){case 0:d.miniprogram.appid={value:"",tags:[]},d.miniprogram.pagepath={value:"",tags:[]},d.url="";break;case 1:d.miniprogram.appid={value:"",tags:[]},d.miniprogram.pagepath={value:"",tags:[]};break;case 2:d.url="";break}M()}function M(){let A=JSON.parse(o.node.node_params);A.plugin.output_obj=r.value,Object.assign(A.plugin.params,{arguments:{...d}}),i({...o.node,node_params:JSON.stringify(A)})}function S(A){var O;const $={},B=A.split(`
`).map(P=>P.trim()).filter(Boolean);for(const P of B){let E=P.match(/^(.*?):\s*\{\{([\w]+)\.DATA\}\}$/);if(E){let D=E[2].replace(/\d/g,"");$[E[2]]={title:E[1],value:"",tags:[],desc:((O=c[D])==null?void 0:O.txt)||"",format_err:!1};continue}if(E=P.match(/^\{\{([\w]+)\.DATA\}\}$/),E){$[E[1]]={title:E[1],value:"",tags:[]};continue}}return $}function k(A,$){let B=A.replace(/\d/g,"");c[B]&&!c[B].reg.test($.value)?$.format_err=!0:$.format_err=!1}return(A,$)=>{var F,Y;const B=Lt,O=$t,P=ho,E=Zt,D=ro,N=io;return w(),R("div",z5,[u("div",q5,[$[25]||($[25]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),u("div",G5,[$[12]||($[12]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"公众号")],-1)),u("div",null,[m(O,{value:d.app_id,"onUpdate:value":$[0]||($[0]=L=>d.app_id=L),placeholder:"请选择公众号",style:{width:"100%"},onChange:v},{default:x(()=>[(w(!0),R(se,null,ge(s.value,L=>(w(),Q(B,{key:L.app_id,name:L.app_name,secret:L.app_secret},{default:x(()=>[U(H(L.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),u("div",X5,[u("div",W5,[$[14]||($[14]=u("div",{class:"option-label"},"公众号模板",-1)),m(E,{title:"同步最新的公众号模板"},{default:x(()=>[u("a",{onClick:g},[$[13]||($[13]=U("同步 ",-1)),a.value?(w(),Q(P,{key:0,size:"small"})):ne("",!0)])]),_:1})]),u("div",null,[m(O,{value:d.template_id,"onUpdate:value":$[1]||($[1]=L=>d.template_id=L),placeholder:"请选择模板",style:{width:"100%"},onChange:y},{default:x(()=>[(w(!0),R(se,null,ge(l.value,L=>(w(),Q(B,{key:L.template_id,name:L.title,content:L.content},{default:x(()=>[U(H(L.title),1)]),_:2},1032,["name","content"]))),128))]),_:1},8,["value"])])]),u("div",Y5,[$[15]||($[15]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"接收者（用户）openid"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",options:n.variableOptions,defaultSelectedList:((F=d.tag_map)==null?void 0:F.touser)||[],defaultValue:d.touser,ref:"atInputRef",onOpen:$[2]||($[2]=L=>t("updateVar")),onChange:$[3]||($[3]=(L,j)=>C("touser",L,j)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:L,payload:j})=>[u("div",J5,[u("div",K5,H(L),1),u("div",Z5,H(j.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),$[16]||($[16]=u("div",{class:"desc"},"普通用户的标识，对当前公众号唯一",-1))]),(w(!0),R(se,null,ge(d.data,(L,j)=>(w(),R("div",{class:"options-item is-required",key:j},[u("div",Q5,[u("div",eL,H(L.title),1)]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:L.tags,defaultValue:L.value,ref_for:!0,ref:"atInputRef",onOpen:$[4]||($[4]=le=>t("updateVar")),onChange:(le,z)=>b(L,le,z,j),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:le,payload:z})=>[u("div",tL,[u("div",nL,H(le),1),u("div",oL,H(z.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),L.desc?(w(),R("div",{key:0,class:xt(["desc",{error:L.format_err}])},H(L.desc),3)):ne("",!0)]))),128)),u("div",iL,[$[20]||($[20]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"跳转方式")],-1)),u("div",null,[m(N,{value:d.link_type,"onUpdate:value":$[5]||($[5]=L=>d.link_type=L),onChange:T},{default:x(()=>[m(D,{value:0},{default:x(()=>[...$[17]||($[17]=[U("不跳转",-1)])]),_:1}),m(D,{value:1},{default:x(()=>[...$[18]||($[18]=[U("链接",-1)])]),_:1}),m(D,{value:2},{default:x(()=>[...$[19]||($[19]=[U("小程序",-1)])]),_:1})]),_:1},8,["value"])])]),d.link_type==1?(w(),R("div",rL,[$[21]||($[21]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"链接")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((Y=d.tag_map)==null?void 0:Y.url)||[],defaultValue:d.url,ref:"atInputRef",onOpen:$[6]||($[6]=L=>t("updateVar")),onChange:$[7]||($[7]=(L,j)=>C("url",L,j)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:L,payload:j})=>[u("div",sL,[u("div",aL,H(L),1),u("div",lL,H(j.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])])):d.link_type==2?(w(),R(se,{key:1},[u("div",uL,[$[22]||($[22]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"小程序APPID")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultValue:d.miniprogram.appid.value,defaultSelectedList:d.miniprogram.appid.tags,ref:"atInputRef",onOpen:$[8]||($[8]=L=>t("updateVar")),onChange:$[9]||($[9]=(L,j)=>b(d.miniprogram.appid,L,j)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:L,payload:j})=>[u("div",dL,[u("div",cL,H(L),1),u("div",pL,H(j.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList"])]),$[23]||($[23]=u("div",{class:"desc"},"小程序appid必须与发模板消息的公众号是关联关系",-1))]),u("div",fL,[$[24]||($[24]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"小程序路径")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultValue:d.miniprogram.pagepath.value,defaultSelectedList:d.miniprogram.pagepath.tags,ref:"atInputRef",onOpen:$[10]||($[10]=L=>t("updateVar")),onChange:$[11]||($[11]=(L,j)=>b(d.miniprogram.pagepath,L,j)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:L,payload:j})=>[u("div",hL,[u("div",vL,H(L),1),u("div",_L,H(j.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList"])])])],64)):ne("",!0)]),u("div",gL,[$[26]||($[26]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",mL,[m(Oi,{"tree-data":r.value},null,8,["tree-data"])])])])}}},xL=Ne(bL,[["__scopeId","data-v-13e1d9be"]]),wL={class:"tag-container"},CL={class:"node-options"},kL={class:"options-item is-required"},SL={class:"options-item is-required"},EL={class:"options-item-tit"},AL={class:"tag-box"},DL={class:"field-list-item"},OL={class:"field-label"},NL={class:"field-type"},ML={class:"options-item is-required"},TL={class:"field-list-item"},$L={class:"field-label"},RL={class:"field-type"},PL={class:"node-options"},LL={class:"options-item"},BL="official_batch_tag",IL={__name:"official-tag-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=Ve("setData"),r=X([]),s=X([]),a=X([]),l=Je({app_id:void 0,app_secret:"",openid_list:"",tagid:"",tag_type:1,tag_name:1,tag_map:{}}),d=X(!1);at(()=>{c()}),ct(()=>o.action,()=>{var M;r.value=Di(JSON.parse(JSON.stringify(((M=o.action)==null?void 0:M.output)||"{}")))},{deep:!0,immediate:!0});function c(){p(),f()}function p(){Ir({app_type:"official_account"}).then(M=>{s.value=(M==null?void 0:M.data)||[]})}function f(){var k,A;let M=JSON.parse(o.node.node_params),S=((A=(k=M==null?void 0:M.plugin)==null?void 0:k.params)==null?void 0:A.arguments)||{};Object.assign(l,S),l.tagid&&(l.tagid>0?l.tag_type=1:l.tag_type=2,y())}function h(M,S){const{key:k,secret:A,name:$}=S;l.app_secret=A,l.app_name=$,y()}function v(){if(!l.app_secret||!l.app_id)return mt.warning("请先选择公众号");d.value||(d.value=!0,y().then(()=>{mt.success("同步完成")}).finally(()=>{d.value=!1}))}function y(){return Ho({name:BL,action:"default/exec",params:JSON.stringify({business:"getTags",arguments:{app_id:l.app_id,app_secret:l.app_secret}})}).then(M=>{var S;return a.value=((S=M==null?void 0:M.data)==null?void 0:S.tags)||[],M})}function g(M,S,k){M==="openid_list"&&(S=S.trim(),S=S.replace(/，/g,",")),l[M]=S,l.tag_map[M]=k,C()}function _(M,S){l.tag_name=S.name,C()}function b(){l.tag_name="",l.tag_type==1?l.tagid=null:l.tagid=""}function C(){let M=JSON.parse(o.node.node_params);M.plugin.output_obj=r.value,Object.assign(M.plugin.params,{arguments:{...l}}),i({...o.node,node_params:JSON.stringify(M)})}const T=(M,S)=>S.name.toLowerCase().indexOf(M.toLowerCase())>=0;return(M,S)=>{var O,P;const k=Lt,A=$t,$=ho,B=Zt;return w(),R("div",wL,[u("div",CL,[S[14]||(S[14]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),u("div",kL,[S[7]||(S[7]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"公众号")],-1)),u("div",null,[m(A,{value:l.app_id,"onUpdate:value":S[0]||(S[0]=E=>l.app_id=E),placeholder:"请选择公众号",style:{width:"100%"},onChange:h},{default:x(()=>[(w(!0),R(se,null,ge(s.value,E=>(w(),Q(k,{key:E.app_id,name:E.app_name,secret:E.app_secret},{default:x(()=>[U(H(E.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),u("div",SL,[u("div",EL,[S[9]||(S[9]=u("div",{class:"option-label"},"公众号标签",-1)),m(B,{title:"同步最新的公众号标签"},{default:x(()=>[u("a",{onClick:v},[S[8]||(S[8]=U("同步 ",-1)),d.value?(w(),Q($,{key:0,size:"small"})):ne("",!0)])]),_:1})]),u("div",AL,[m(A,{value:l.tag_type,"onUpdate:value":S[1]||(S[1]=E=>l.tag_type=E),onChange:b,style:{width:"120px"}},{default:x(()=>[m(k,{value:1},{default:x(()=>[...S[10]||(S[10]=[U("选择标签",-1)])]),_:1}),m(k,{value:2},{default:x(()=>[...S[11]||(S[11]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value"]),l.tag_type==1?(w(),Q(A,{key:0,value:l.tagid,"onUpdate:value":S[2]||(S[2]=E=>l.tagid=E),placeholder:"请选择标签",style:{width:"100%"},onChange:_,"show-search":"","filter-option":T},{default:x(()=>[(w(!0),R(se,null,ge(a.value,E=>(w(),Q(k,{key:E.id,value:E.id,name:E.name},{default:x(()=>[U(H(E.name),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["value"])):(w(),Q(tt,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((O=l.tag_map)==null?void 0:O.tagid)||[],defaultValue:l.tagid,ref:"atInputRef",onOpen:S[3]||(S[3]=E=>t("updateVar")),onChange:S[4]||(S[4]=(E,D)=>g("tagid",E,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:E,payload:D})=>[u("div",DL,[u("div",OL,H(E),1),u("div",NL,H(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))])]),u("div",ML,[S[12]||(S[12]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"粉丝openid列表"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((P=l.tag_map)==null?void 0:P.openid_list)||[],defaultValue:l.openid_list,ref:"atInputRef",onOpen:S[5]||(S[5]=E=>t("updateVar")),onChange:S[6]||(S[6]=(E,D)=>g("openid_list",E,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:E,payload:D})=>[u("div",TL,[u("div",$L,H(E),1),u("div",RL,H(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),S[13]||(S[13]=u("div",{class:"desc"},"粉丝openid列表，最多50个，逗号分割",-1))])]),u("div",PL,[S[15]||(S[15]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",LL,[m(Oi,{"tree-data":r.value},null,8,["tree-data"])])])])}}},jL=Ne(IL,[["__scopeId","data-v-90b0cfa9"]]),FL={class:"field-list-row"},VL={key:0,class:"field-list-col field-list-col-head field-value-head"},HL={key:1,class:"field-list-col field-list-col-head field-del-head"},UL={key:0,class:"field-list-row"},zL={class:"field-list-col field-value-col"},qL={class:"field-list-col field-name-col"},GL={key:0,style:{color:"#FB363F","margin-right":"2px"}},XL={class:"field-list-col field-type-col"},WL={key:0,class:"field-list-col field-value-col"},YL={key:0,class:"field-value-inline"},JL={class:"inline-input"},KL={key:2,style:{color:"#FB363F","margin-top":"4px"}},ZL={key:1,class:"field-list-col field-del-col"},QL=["onClick"],eB={__name:"index",props:{showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},msgtype:{type:String,default:""}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Ve("getNode"),s=Je({list:[],keys:[]}),a=We(()=>s.list.some(k=>b(k)));function l(){const k=String(i.msgtype||"").toLowerCase();return k==="link"?"imageText":k==="miniprogrampage"?"card":["text","image","url"].includes(k)?k:"text"}const d={imageText:{url:{required:!0,validator:k=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(k||""))?!0:/^https?:\/\//.test(String(k||"")),validationTip:"链接需以http或https开头",functionalTip:"跳转到外链，支持插入变量，链接需以http或https开头。"},title:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入标题",functionalTip:"展示在链接卡片的标题位置"},description:{required:!0,validator:k=>String(k||"").trim().length>0&&String(k||"").length<=300,validationTip:"请输入描述，最多300字",functionalTip:"展示在链接卡片的描述位置"},thumb_url:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请上传链接图片",functionalTip:"支持png/jpg/jpeg，建议≤2M"}},text:{content:{required:!0,validator:k=>String(k||"").trim().length>0&&String(k||"").length<=300,validationTip:"请输入文本内容，最多300字",functionalTip:"支持插入变量，最多300字"}},image:{thumb_url:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请上传图片",functionalTip:"支持png/jpg/jpeg，建议≤2M"}},url:{title:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入标题",functionalTip:"展示在卡片标题位置"},url:{required:!0,validator:k=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(k||""))?!0:/^https?:\/\//.test(String(k||"")),validationTip:"链接需以http或https开头",functionalTip:"点击后跳转的链接，链接需以http或https开头。"}},card:{title:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入小程序标题",functionalTip:"展示在卡片标题位置"},appid:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入小程序appID",functionalTip:"小程序右上角>名字>更多资料>AppID；公众号需与小程序关联"},page_path:{required:!0,validator:k=>/^\//.test(String(k||"")),validationTip:"请输入以/开头的小程序路径",functionalTip:"向开发者获取路径，如/pages/index/index"},thumb_url:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请上传小程序封面",functionalTip:"支持png/jpg/jpeg，建议≤2M"}}};function c(){const k=l(),A=d[k]||{};s.list.forEach(($,B)=>{var F;const O=($.field_name||"").toLowerCase(),P=A[O]||{};let E={};(typeof $.description<"u"||typeof $.desc<"u"||typeof $.required<"u")&&(E={functionalTip:$.description||$.desc,required:$.required});let D={};if(b($)){const Y=(F=$.properties)==null?void 0:F[$.current_properties_key];Y&&(typeof Y.description<"u"||typeof Y.desc<"u"||typeof Y.required<"u")&&(D={functionalTip:Y.description||Y.desc,required:Y.required})}const N={functionalTip:D.functionalTip??E.functionalTip??P.functionalTip??"",required:!!(D.required??E.required??P.required??$.required)};s.list[B].__functionalTip=N.functionalTip,s.list[B].__required=!!N.required,s.list[B].__error=null})}function p(k){var D,N,F,Y,L;const A=l(),$=d[A]||{},B=(k.field_name||"").toLowerCase();let O=$[B];if(!O&&b(k)){const j=(D=k.properties)==null?void 0:D[k.current_properties_key];j&&(O={required:!!j.required})}const P=b(k)?((F=(N=k.properties)==null?void 0:N[k.current_properties_key])==null?void 0:F.value)??"":k.value;if(!O)return k.__error=null,!0;const E=b(k)?((L=(Y=k.properties)==null?void 0:Y[k.current_properties_key])==null?void 0:L.atTags)??[]:k.atTags;return O.required&&!String(P||"").trim()&&(!Array.isArray(E)||E.length===0)||O.validator&&!O.validator(P)?(k.__error=O.validationTip,!1):(k.__error=null,!0)}ct(()=>i.list,k=>{s.list=k,s.keys=k.map(A=>A.field_name),s.list.forEach(T),c()},{immediate:!0});const f=X([]),h=()=>{let k=r().getAllParentVariable();f.value=k||[]},v=()=>{h()},y=(k,A,$,B)=>{if(b($)){const O=$.current_properties_key;$.properties[O]||($.properties[O]={}),$.properties[O].value=k,$.properties[O].atTags=A}else s.list[B].value=k,s.list[B].atTags=A;_()},g=k=>{s.list.splice(k,1),_()},_=()=>{s.keys=s.list.map(k=>k.field_name),o("change",[...s.list],[...s.keys])};at(()=>{h()});function b(k){return k.media_component}function C(k,A){var B;const $=(B=k.properties)==null?void 0:B[A];k.current_properties_key=A,k.ui_type=M($==null?void 0:$.type),k.__functionalTip=($==null?void 0:$.desc)||"",k.__required=!!($!=null&&$.required),k.properties[A]||(k.properties[A]={}),k.properties[A].value=k.properties[A].value??"",k.properties[A].atTags=k.properties[A].atTags??[],_()}function T(k){if(!b(k))return;const A=Object.keys(k.properties);if(!k.current_properties_key){const $=A[0];C(k,$)}}function M(k){switch((k||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return k||"Text"}}function S(){let k=!0;const A=[];return s.list.forEach($=>{var B;if(!p($)){k=!1;const O=b($)?((B=$.properties)==null?void 0:B[$.current_properties_key])||{}:null;A.push({field_name:(O==null?void 0:O.name)||$.name||$.field_name,message:(O==null?void 0:O.error)||$.__error,functionalTip:(O==null?void 0:O.desc)||$.__functionalTip})}}),{ok:k,errors:A}}return e({validateAll:S}),(k,A)=>{const $=en,B=Zt,O=Lt,P=$t,E=On;return w(),R("div",null,[u("div",{class:xt(["field-list",{"wide-value-col":a.value}])},[u("div",FL,[A[0]||(A[0]=u("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),A[1]||(A[1]=u("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),R("div",VL,"字段值")):ne("",!0),i.showDelete?(w(),R("div",HL)):ne("",!0)]),n.showEmptyFieldRow?(w(),R("div",UL,[A[2]||(A[2]=u("div",{class:"field-list-col field-name-col"},"--",-1)),A[3]||(A[3]=u("div",{class:"field-list-col field-type-col"},"--",-1)),u("div",zL,[m(B,{title:"请先选择数据库"},{default:x(()=>[m($,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ne("",!0),(w(!0),R(se,null,ge(s.list,(D,N)=>{var F,Y,L,j,le,z;return w(),R("div",{class:"field-list-row",key:D.field_name},[u("div",qL,[D.__required?(w(),R("span",GL,"*")):ne("",!0),U(" "+H(((Y=(F=D.properties)==null?void 0:F[D.current_properties_key])==null?void 0:Y.name)||D.name)+" ",1),D.__functionalTip?(w(),Q(B,{key:1,title:D.__functionalTip},{default:x(()=>[m(K(ft),{style:{cursor:"pointer"}})]),_:1},8,["title"])):ne("",!0)]),u("div",XL,H(D.ui_type),1),n.showInput?(w(),R("div",WL,[b(D)?(w(),R("div",YL,[m(P,{value:D.current_properties_key,"onUpdate:value":V=>D.current_properties_key=V,onChange:V=>C(D,V)},{default:x(()=>[(w(!0),R(se,null,ge(D.properties||{},(V,J)=>(w(),Q(O,{key:J,value:J},{default:x(()=>[U(H(V.name||J),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"]),u("div",JL,[m(tt,{options:f.value,defaultValue:((j=(L=D.properties)==null?void 0:L[D.current_properties_key])==null?void 0:j.value)??"",defaultSelectedList:((z=(le=D.properties)==null?void 0:le[D.current_properties_key])==null?void 0:z.atTags)??[],onOpen:v,onChange:(V,J)=>y(V,J,D,N),placeholder:'请输入参数，键入"/"插入变量'},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):(w(),Q(tt,{key:1,options:f.value,defaultValue:D.value,defaultSelectedList:D.atTags,onOpen:v,onChange:(V,J)=>y(V,J,D,N),placeholder:'请输入参数，键入"/"插入变量'},null,8,["options","defaultValue","defaultSelectedList","onChange"])),D.__error?(w(),R("div",KL,H(D.__error),1)):ne("",!0)])):ne("",!0),i.showDelete?(w(),R("div",ZL,[u("span",{class:"del-btn",onClick:V=>g(N)},[m(E,{class:"del-icon",name:"close-circle"})],8,QL)])):ne("",!0)])}),128))],2)])}}},tB=Ne(eB,[["__scopeId","data-v-f8a681e7"]]),nB={class:"add-data-form"},oB={class:"node-box-content"},iB={class:"setting-box"},rB={__name:"reply-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X([]),s=X(null);function a(p=null){var f,h,v;r.value=[],Array.isArray((v=(h=(f=p==null?void 0:p.plugin)==null?void 0:f.params)==null?void 0:h.arguments)==null?void 0:v.fields)&&p.plugin.params.arguments.fields.length?(p.plugin.params.arguments.fields.map(y=>{y.value=y.value.toString()}),r.value=p.plugin.params.arguments.fields):i.fields.map(y=>{r.value.push({value:"",atTags:[],...y})})}const l=p=>{r.value=p,d()},d=()=>{o("update",{fields:Xn(r.value)})};function c(){var p,f;return(f=(p=s.value)==null?void 0:p.validateAll)==null?void 0:f.call(p)}return e({init:a,validateAll:c}),(p,f)=>(w(),R("div",nB,[u("div",oB,[f[0]||(f[0]=u("div",{class:"setting-label"},[u("span",null,"回复内容"),u("span",{class:"tip"},"（不填写字段值则为空）")],-1)),u("div",iB,[m(tB,{ref_key:"fieldRef",ref:s,showEmptyFieldRow:!n.tableId,list:r.value,fields:n.fields,msgtype:n.tableId,showAdd:!1,showDelete:!1,onChange:l},null,8,["showEmptyFieldRow","list","fields","msgtype"])])])]))}},sB=Ne(rB,[["__scopeId","data-v-8c782d57"]]),aB={class:"main-box"},lB={key:0,class:"loading-box"},uB={class:"node-options"},dB={class:"options-item is-required"},cB={class:"options-item is-required"},pB={class:"options-item-tit"},fB={class:"option-label"},hB={class:"field-list-item"},vB={class:"field-label"},_B={class:"field-type"},gB={class:"options-item is-required"},mB={class:"node-options"},yB={class:"options-item"},qp="official_send_message",bB={__name:"official-send-message-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=Ve("setData"),r=X(null),s=Je({app_id:null,msgtype:void 0,receiver:"",receiver_tags:[],app_secret:"",app_name:""}),a=X(!1),l=X(!1),d=X({}),c=X([]),p=X([]),f=X([]),h=X([]);at(()=>{v(),hs({name:"workflow:validate",callback:A})});async function v(){await y(),T(),O()}function y(){return Ir({app_type:"official_account"}).then(P=>{c.value=(P==null?void 0:P.data)||[]})}function g(){return a.value=!0,Ho({name:qp,action:"default/exec",params:JSON.stringify({business:"getMsgType",arguments:{app_id:s.app_id}})}).then(P=>(d.value=(P==null?void 0:P.data)||{},p.value=d.value.items||[],!s.msgtype&&p.value.length==1&&(s.msgtype=p.value[0].msgtype,S()),P)).finally(()=>{a.value=!1})}function _(){return l.value=!0,Ho({name:qp,action:"default/exec",params:JSON.stringify({business:"getMsgInput",arguments:{app_id:s.app_id,app_secret:s.app_secret,msgtype:s.msgtype}})}).then(P=>{var D;let E=((D=P==null?void 0:P.data)==null?void 0:D.items)||[];return f.value=E.map(N=>({field_name:N.field||N.name,ui_type:b(N.type),name:N.name,description:N.desc,required:!!N.required,media_component:!!N.media_component,properties:N.properties||null})),P}).finally(()=>{l.value=!1})}function b(P){switch((P||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return P||"Text"}}function C(P){if(!P)return h_(o.actionName);P=JSON.parse(JSON.stringify(P));for(let E in P)switch(E){case"filter":if(Array.isArray(P.filter.conditions)&&P.filter.conditions.length)for(let D of P.filter.conditions)D.field_type==="DateTime"&&D.value&&(D.value<1e11&&(D.value*=1e3),D.value=["ExactDate",D.value].join(","));break;case"fields":for(let D of P.fields)D.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(D.ui_type)&&(D.value=Number(D.value)),D.ui_type==="Currency"&&(D.value=D.value.toFixed(2))),D.ui_type==="Checkbox"&&(D.value=D.value=="true"),D.ui_type==="MultiSelect"&&(D.value=D.value.replace(/，/g,",").split(",")),D.ui_type==="DateTime"&&D.value<1e11&&(D.value*=1e3);break;case"field_names":P.field_names=P.field_names.map(D=>D.field_name);break;case"sort":P.sort=P.sort.map(D=>({field_name:D.field_name,desc:D.is_asc!=1}));break}return P}function T(){var D,N;let P=JSON.parse(o.node.node_params),E=((N=(D=P==null?void 0:P.plugin)==null?void 0:D.params)==null?void 0:N.arguments)||{};E.app_id&&(s.app_id=E.app_id),E.msgtype&&(s.msgtype=E.msgtype),E.receiver&&(s.receiver=String(E.receiver)),E.openid&&(s.receiver=String(E.openid)),E.touser&&(s.receiver=String(E.touser)),E.tag_map&&E.tag_map.receiver&&(s.receiver_tags=E.tag_map.receiver),E.app_secret&&(s.app_secret=String(E.app_secret)),E.app_name&&(s.app_name=String(E.app_name)),s.app_id&&g(),s.msgtype&&_().then(()=>k(P))}function M(P,E){d.value={},p.value=[],f.value=[],s.msgtype=void 0,E&&E.app_secret&&(s.app_secret=E.app_secret),E&&E.name&&(s.app_name=E.name),s.app_id?g().then(()=>k()):k(),$()}function S(){f.value=[],_().then(()=>k()),$()}function k(P=null){Tt(()=>{r.value&&typeof r.value.init=="function"&&r.value.init(P)})}function A(){const P=hs();if(r.value&&typeof r.value.validateAll=="function"){const E=r.value.validateAll(),D=p.value.find(N=>N.msgtype==s.msgtype);E&&E.ok===!1&&P.emit&&P.emit("workflow:validate:error",{component:"公众号发送消息",type:s.msgtype,typeDisplay:(D==null?void 0:D.name)||s.msgtype,message:"请完善发送消息的必填项",errors:E.errors||[]})}}function $(P=null){let E=JSON.parse(o.node.node_params),D=p.value.find(N=>N.msgtype==s.msgtype);E.plugin.output_obj=h.value,Object.assign(E.plugin.params,{arguments:{app_id:String(s.app_id||""),app_secret:String(s.app_secret||""),msgtype:String(s.msgtype||""),touser:String(s.receiver||""),fields:(C(P)||{}).fields||[],app_name:String(s.app_name||""),msg_type_name:String((D==null?void 0:D.name)||"")}}),i({...o.node,node_params:JSON.stringify(E)})}function B(P,E){s.receiver=P,s.receiver_tags=E,$()}function O(){h.value=Di(o.action.output)}return(P,E)=>{const D=ho,N=Lt,F=$t,Y=Zt;return w(),R("div",aB,[l.value||a.value?(w(),R("div",lB,[m(D)])):ne("",!0),u("div",uB,[E[9]||(E[9]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),u("div",dB,[E[6]||(E[6]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"公众号")],-1)),u("div",null,[m(F,{value:s.app_id,"onUpdate:value":E[0]||(E[0]=L=>s.app_id=L),placeholder:"请选择公众号",style:{width:"100%"},onChange:E[1]||(E[1]=(L,j)=>M(L,j))},{default:x(()=>[(w(!0),R(se,null,ge(c.value,L=>(w(),Q(N,{key:L.app_id,value:L.app_id,name:L.app_name,app_secret:L.app_secret},{default:x(()=>[U(H(L.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value"])])]),u("div",cB,[u("div",pB,[u("div",fB,[E[7]||(E[7]=U(" 接收人 ",-1)),m(Y,{title:"用户的openid"},{default:x(()=>[m(K(ft))]),_:1})])]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:s.receiver_tags,defaultValue:s.receiver,onOpen:E[2]||(E[2]=L=>t("updateVar")),onChange:E[3]||(E[3]=(L,j)=>B(L,j)),placeholder:"请输入接收人，键入“/”可以插入变量"},{option:x(({label:L,payload:j})=>[u("div",hB,[u("div",vB,H(L),1),u("div",_B,H(j.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),u("div",gB,[E[8]||(E[8]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"消息类型")],-1)),u("div",null,[m(F,{value:s.msgtype,"onUpdate:value":E[4]||(E[4]=L=>s.msgtype=L),onChange:S,placeholder:s.app_id?"请选择消息类型":"请先选择公众号",style:{width:"100%"}},{default:x(()=>[(w(!0),R(se,null,ge(p.value,L=>(w(),Q(N,{key:L.msgtype,value:L.msgtype},{default:x(()=>[U(H(L.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),m(sB,{ref_key:"childRef",ref:r,tableId:s.msgtype,fields:f.value,variableOptions:n.variableOptions,onUpdate:$,onUpdateVar:E[5]||(E[5]=L=>t("updateVar"))},null,8,["tableId","fields","variableOptions"])]),u("div",mB,[E[10]||(E[10]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",yB,[m(Oi,{"tree-data":h.value},null,8,["tree-data"])])])])}}},xB=Ne(bB,[["__scopeId","data-v-1df0f292"]]),$_="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.0946%2014.4079C4.97757%2014.0753%203.98327%2013.4579%203.19596%2012.6398C3.48967%2012.2917%203.66667%2011.8419%203.66667%2011.3508C3.66667%2010.2462%202.77124%209.35078%201.66667%209.35078C1.59985%209.35078%201.5338%209.35408%201.46867%209.36048C1.37993%208.92665%201.33334%208.47752%201.33334%208.01745C1.33334%207.32058%201.44026%206.64868%201.6386%206.01725C1.64794%206.01738%201.6573%206.01745%201.66667%206.01745C2.77124%206.01745%203.66667%205.12202%203.66667%204.01745C3.66667%203.70035%203.59287%203.40052%203.46154%203.13412C4.2325%202.41725%205.1735%201.88076%206.21737%201.5918C6.54814%202.24015%207.22224%202.68413%208%202.68413C8.77777%202.68413%209.45187%202.24015%209.78264%201.5918C10.8265%201.88076%2011.7675%202.41725%2012.5385%203.13412C12.4071%203.40052%2012.3333%203.70035%2012.3333%204.01745C12.3333%205.12202%2013.2288%206.01745%2014.3333%206.01745C14.3427%206.01745%2014.3521%206.01738%2014.3614%206.01725C14.5597%206.64868%2014.6667%207.32058%2014.6667%208.01745C14.6667%208.47752%2014.6201%208.92665%2014.5313%209.36048C14.4662%209.35408%2014.4002%209.35078%2014.3333%209.35078C13.2288%209.35078%2012.3333%2010.2462%2012.3333%2011.3508C12.3333%2011.8419%2012.5103%2012.2917%2012.804%2012.6398C12.0167%2013.4579%2011.0224%2014.0753%209.9054%2014.4079C9.6476%2013.6014%208.892%2013.0175%208%2013.0175C7.108%2013.0175%206.3524%2013.6014%206.0946%2014.4079Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M8%2010.3503C9.28866%2010.3503%2010.3333%209.30559%2010.3333%208.01693C10.3333%206.72826%209.28866%205.68359%208%205.68359C6.71133%205.68359%205.66666%206.72826%205.66666%208.01693C5.66666%209.30559%206.71133%2010.3503%208%2010.3503Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e";/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function Gp(n){return Object.prototype.toString.call(n)==="[object Object]"}function Kn(n){var e,t;return Gp(n)===!1?!1:(e=n.constructor,e===void 0?!0:(t=e.prototype,!(Gp(t)===!1||t.hasOwnProperty("isPrototypeOf")===!1)))}function Zo(n){for(var e=arguments.length,t=Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map((function(i){return"'"+i+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function $r(n){return!!n&&!!n[wo]}function Rr(n){var e;return!!n&&((function(t){if(!t||typeof t!="object")return!1;var o=Object.getPrototypeOf(t);if(o===null)return!0;var i=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===OB})(n)||Array.isArray(n)||!!n[ef]||!!(!((e=n.constructor)===null||e===void 0)&&e[ef])||np(n)||op(n))}function wa(n,e,t){t===void 0&&(t=!1),Ps(n)===0?(t?Object.keys:lp)(n).forEach((function(o){t&&typeof o=="symbol"||e(o,n[o],n)})):n.forEach((function(o,i){return e(i,o,n)}))}function Ps(n){var e=n[wo];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:np(n)?2:op(n)?3:0}function Hd(n,e){return Ps(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function wB(n,e){return Ps(n)===2?n.get(e):n[e]}function R_(n,e,t){var o=Ps(n);o===2?n.set(e,t):o===3?n.add(t):n[e]=t}function CB(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function np(n){return AB&&n instanceof Map}function op(n){return DB&&n instanceof Set}function br(n){return n.o||n.t}function ip(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=NB(n);delete e[wo];for(var t=lp(e),o=0;o<t.length;o++){var i=t[o],r=e[i];r.writable===!1&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(e[i]={configurable:!0,writable:!0,enumerable:r.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function rp(n,e){return e===void 0&&(e=!1),sp(n)||$r(n)||!Rr(n)||(Ps(n)>1&&(n.set=n.add=n.clear=n.delete=kB),Object.freeze(n),e&&wa(n,(function(t,o){return rp(o,!0)}),!0)),n}function kB(){Zo(2)}function sp(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function xi(n){var e=MB[n];return e||Zo(18,n),e}function Xp(){return Ca}function sd(n,e){e&&(xi("Patches"),n.u=[],n.s=[],n.v=e)}function jl(n){Ud(n),n.p.forEach(SB),n.p=null}function Ud(n){n===Ca&&(Ca=n.l)}function Wp(n){return Ca={p:[],l:Ca,h:n,m:!0,_:0}}function SB(n){var e=n[wo];e.i===0||e.i===1?e.j():e.g=!0}function ad(n,e){e._=e.p.length;var t=e.p[0],o=n!==void 0&&n!==t;return e.h.O||xi("ES5").S(e,n,o),o?(t[wo].P&&(jl(e),Zo(4)),Rr(n)&&(n=Fl(e,n),e.l||Vl(e,n)),e.u&&xi("Patches").M(t[wo].t,n,e.u,e.s)):n=Fl(e,t,[]),jl(e),e.u&&e.v(e.u,e.s),n!==P_?n:void 0}function Fl(n,e,t){if(sp(e))return e;var o=e[wo];if(!o)return wa(e,(function(a,l){return Yp(n,o,e,a,l,t)}),!0),e;if(o.A!==n)return e;if(!o.P)return Vl(n,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var i=o.i===4||o.i===5?o.o=ip(o.k):o.o,r=i,s=!1;o.i===3&&(r=new Set(i),i.clear(),s=!0),wa(r,(function(a,l){return Yp(n,o,i,a,l,t,s)})),Vl(n,i,!1),t&&n.u&&xi("Patches").N(o,t,n.u,n.s)}return o.o}function Yp(n,e,t,o,i,r,s){if($r(i)){var a=Fl(n,i,r&&e&&e.i!==3&&!Hd(e.R,o)?r.concat(o):void 0);if(R_(t,o,a),!$r(a))return;n.m=!1}else s&&t.add(i);if(Rr(i)&&!sp(i)){if(!n.h.D&&n._<1)return;Fl(n,i),e&&e.A.l||Vl(n,i)}}function Vl(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&rp(e,t)}function ld(n,e){var t=n[wo];return(t?br(t):n)[e]}function Jp(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var o=Object.getOwnPropertyDescriptor(t,e);if(o)return o;t=Object.getPrototypeOf(t)}}function zd(n){n.P||(n.P=!0,n.l&&zd(n.l))}function ud(n){n.o||(n.o=ip(n.t))}function qd(n,e,t){var o=np(e)?xi("MapSet").F(e,t):op(e)?xi("MapSet").T(e,t):n.O?(function(i,r){var s=Array.isArray(i),a={i:s?1:0,A:r?r.A:Xp(),P:!1,I:!1,R:{},l:r,t:i,k:null,o:null,j:null,C:!1},l=a,d=Gd;s&&(l=[a],d=Js);var c=Proxy.revocable(l,d),p=c.revoke,f=c.proxy;return a.k=f,a.j=p,f})(e,t):xi("ES5").J(e,t);return(t?t.A:Xp()).p.push(o),o}function EB(n){return $r(n)||Zo(22,n),(function e(t){if(!Rr(t))return t;var o,i=t[wo],r=Ps(t);if(i){if(!i.P&&(i.i<4||!xi("ES5").K(i)))return i.t;i.I=!0,o=Kp(t,r),i.I=!1}else o=Kp(t,r);return wa(o,(function(s,a){i&&wB(i.t,s)===a||R_(o,s,e(a))})),r===3?new Set(o):o})(n)}function Kp(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return ip(n)}var Zp,Ca,ap=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",AB=typeof Map<"u",DB=typeof Set<"u",Qp=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",P_=ap?Symbol.for("immer-nothing"):((Zp={})["immer-nothing"]=!0,Zp),ef=ap?Symbol.for("immer-draftable"):"__$immer_draftable",wo=ap?Symbol.for("immer-state"):"__$immer_state",OB=""+Object.prototype.constructor,lp=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,NB=Object.getOwnPropertyDescriptors||function(n){var e={};return lp(n).forEach((function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)})),e},MB={},Gd={get:function(n,e){if(e===wo)return n;var t=br(n);if(!Hd(t,e))return(function(i,r,s){var a,l=Jp(r,s);return l?"value"in l?l.value:(a=l.get)===null||a===void 0?void 0:a.call(i.k):void 0})(n,t,e);var o=t[e];return n.I||!Rr(o)?o:o===ld(n.t,e)?(ud(n),n.o[e]=qd(n.A.h,o,n)):o},has:function(n,e){return e in br(n)},ownKeys:function(n){return Reflect.ownKeys(br(n))},set:function(n,e,t){var o=Jp(br(n),e);if(o!=null&&o.set)return o.set.call(n.k,t),!0;if(!n.P){var i=ld(br(n),e),r=i==null?void 0:i[wo];if(r&&r.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(CB(t,i)&&(t!==void 0||Hd(n.t,e)))return!0;ud(n),zd(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return ld(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,ud(n),zd(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=br(n),o=Reflect.getOwnPropertyDescriptor(t,e);return o&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:o.enumerable,value:t[e]}},defineProperty:function(){Zo(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){Zo(12)}},Js={};wa(Gd,(function(n,e){Js[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),Js.deleteProperty=function(n,e){return Js.set.call(this,n,e,void 0)},Js.set=function(n,e,t){return Gd.set.call(this,n[0],e,t,n[0])};var TB=(function(){function n(t){var o=this;this.O=Qp,this.D=!0,this.produce=function(i,r,s){if(typeof i=="function"&&typeof r!="function"){var a=r;r=i;var l=o;return function(y){var g=this;y===void 0&&(y=a);for(var _=arguments.length,b=Array(_>1?_-1:0),C=1;C<_;C++)b[C-1]=arguments[C];return l.produce(y,(function(T){var M;return(M=r).call.apply(M,[g,T].concat(b))}))}}var d;if(typeof r!="function"&&Zo(6),s!==void 0&&typeof s!="function"&&Zo(7),Rr(i)){var c=Wp(o),p=qd(o,i,void 0),f=!0;try{d=r(p),f=!1}finally{f?jl(c):Ud(c)}return typeof Promise<"u"&&d instanceof Promise?d.then((function(y){return sd(c,s),ad(y,c)}),(function(y){throw jl(c),y})):(sd(c,s),ad(d,c))}if(!i||typeof i!="object"){if((d=r(i))===void 0&&(d=i),d===P_&&(d=void 0),o.D&&rp(d,!0),s){var h=[],v=[];xi("Patches").M(i,d,h,v),s(h,v)}return d}Zo(21,i)},this.produceWithPatches=function(i,r){if(typeof i=="function")return function(d){for(var c=arguments.length,p=Array(c>1?c-1:0),f=1;f<c;f++)p[f-1]=arguments[f];return o.produceWithPatches(d,(function(h){return i.apply(void 0,[h].concat(p))}))};var s,a,l=o.produce(i,r,(function(d,c){s=d,a=c}));return typeof Promise<"u"&&l instanceof Promise?l.then((function(d){return[d,s,a]})):[l,s,a]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){Rr(t)||Zo(8),$r(t)&&(t=EB(t));var o=Wp(this),i=qd(this,t,void 0);return i[wo].C=!0,Ud(o),i},e.finishDraft=function(t,o){var i=t&&t[wo],r=i.A;return sd(r,o),ad(void 0,r)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!Qp&&Zo(20),this.O=t},e.applyPatches=function(t,o){var i;for(i=o.length-1;i>=0;i--){var r=o[i];if(r.path.length===0&&r.op==="replace"){t=r.value;break}}i>-1&&(o=o.slice(i+1));var s=xi("Patches").$;return $r(t)?s(t,o):this.produce(t,(function(a){return s(a,o)}))},n})(),Co=new TB,Hu=Co.produce;Co.produceWithPatches.bind(Co);Co.setAutoFreeze.bind(Co);Co.setUseProxies.bind(Co);Co.applyPatches.bind(Co);var tf=Co.createDraft.bind(Co),nf=Co.finishDraft.bind(Co);function Ui(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var of=new WeakMap,rf=new WeakMap,sf=new WeakMap,af=new WeakMap,lf=new WeakMap,uf=new WeakMap;function $B(n,e){if(n==null)return{};var t={},o=Object.keys(n),i,r;for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function ji(n,e){if(n==null)return{};var t=$B(n,e),o,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(n,o)&&(t[o]=n[o])}return t}var up=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=!t,i=t?jB(e):e,r=Ft.None,s=Ft.None,a=0,l=null,d=null;for(var c of i){var p=c.codePointAt(0);if(!p)break;var f=KB(c,p);if([r,s]=o?[s,f]:[f,r],os(r,Ft.ZWJ)&&os(s,Ft.ExtPict)&&(o?l=df(e.substring(0,a)):l=df(e.substring(0,e.length-a)),!l)||os(r,Ft.RI)&&os(s,Ft.RI)&&(d!==null?d=!d:o?d=!0:d=n7(e.substring(0,e.length-a)),!d)||r!==Ft.None&&s!==Ft.None&&QB(r,s))break;a+=c.length}return a||1},RB=/\s/,PB=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,LB=/['\u2018\u2019]/,BB=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=0,i=!1;e.length>0;){var r=up(e,t),[s,a]=dp(e,r,t);if(IB(s,a,t))i=!0,o+=r;else if(!i)o+=r;else break;e=a}return o},dp=(n,e,t)=>{if(t){var o=n.length-e;return[n.slice(o,n.length),n.slice(0,o)]}return[n.slice(0,e),n.slice(e)]},IB=function n(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(RB.test(e))return!1;if(LB.test(e)){var i=up(t,o),[r,s]=dp(t,i,o);if(n(r,s,o))return!0}return!PB.test(e)},jB=function*(e){for(var t=e.length-1,o=0;o<e.length;o++){var i=e.charAt(t-o);if(VB(i.charCodeAt(0))){var r=e.charAt(t-o-1);if(FB(r.charCodeAt(0))){yield r+i,o++;continue}}yield i}},FB=n=>n>=55296&&n<=56319,VB=n=>n>=56320&&n<=57343,Ft;(function(n){n[n.None=0]="None",n[n.Extend=1]="Extend",n[n.ZWJ=2]="ZWJ",n[n.RI=4]="RI",n[n.Prepend=8]="Prepend",n[n.SpacingMark=16]="SpacingMark",n[n.L=32]="L",n[n.V=64]="V",n[n.T=128]="T",n[n.LV=256]="LV",n[n.LVT=512]="LVT",n[n.ExtPict=1024]="ExtPict",n[n.Any=2048]="Any"})(Ft||(Ft={}));var HB=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])$/,UB=/^(?:[\u0600-\u0605\u06DD\u070F\u0890\u0891\u08E2\u0D4E]|\uD804[\uDCBD\uDCCD\uDDC2\uDDC3]|\uD806[\uDD3F\uDD41\uDE3A\uDE84-\uDE89]|\uD807\uDD46)$/,zB=/^(?:[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BF\u09C0\u09C7\u09C8\u09CB\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0\u0CC1\u0CC3\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0D02\u0D03\u0D3F\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82\u0D83\u0DD0\u0DD1\u0DD8-\u0DDE\u0DF2\u0DF3\u0E33\u0EB3\u0F3E\u0F3F\u0F7F\u1031\u103B\u103C\u1056\u1057\u1084\u1715\u1734\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1A19\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF7\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BE-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD45\uDD46\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0\uDDCE\uDE2C-\uDE2E\uDE32\uDE33\uDE35\uDEE0-\uDEE2\uDF02\uDF03\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF62\uDF63]|\uD805[\uDC35-\uDC37\uDC40\uDC41\uDC45\uDCB1\uDCB2\uDCB9\uDCBB\uDCBC\uDCBE\uDCC1\uDDB0\uDDB1\uDDB8-\uDDBB\uDDBE\uDE30-\uDE32\uDE3B\uDE3C\uDE3E\uDEAC\uDEAE\uDEAF\uDEB6\uDF26]|\uD806[\uDC2C-\uDC2E\uDC38\uDD31-\uDD35\uDD37\uDD38\uDD3D\uDD40\uDD42\uDDD1-\uDDD3\uDDDC-\uDDDF\uDDE4\uDE39\uDE57\uDE58\uDE97]|\uD807[\uDC2F\uDC3E\uDCA9\uDCB1\uDCB4\uDD8A-\uDD8E\uDD93\uDD94\uDD96\uDEF5\uDEF6]|\uD81B[\uDF51-\uDF87\uDFF0\uDFF1]|\uD834[\uDD66\uDD6D])$/,qB=/^[\u1100-\u115F\uA960-\uA97C]$/,GB=/^[\u1160-\u11A7\uD7B0-\uD7C6]$/,XB=/^[\u11A8-\u11FF\uD7CB-\uD7FB]$/,WB=/^[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]$/,YB=/^[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]$/,JB=/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])$/,KB=(n,e)=>{var t=Ft.Any;return n.search(HB)!==-1&&(t|=Ft.Extend),e===8205&&(t|=Ft.ZWJ),e>=127462&&e<=127487&&(t|=Ft.RI),n.search(UB)!==-1&&(t|=Ft.Prepend),n.search(zB)!==-1&&(t|=Ft.SpacingMark),n.search(qB)!==-1&&(t|=Ft.L),n.search(GB)!==-1&&(t|=Ft.V),n.search(XB)!==-1&&(t|=Ft.T),n.search(WB)!==-1&&(t|=Ft.LV),n.search(YB)!==-1&&(t|=Ft.LVT),n.search(JB)!==-1&&(t|=Ft.ExtPict),t};function os(n,e){return(n&e)!==0}var ZB=[[Ft.L,Ft.L|Ft.V|Ft.LV|Ft.LVT],[Ft.LV|Ft.V,Ft.V|Ft.T],[Ft.LVT|Ft.T,Ft.T],[Ft.Any,Ft.Extend|Ft.ZWJ],[Ft.Any,Ft.SpacingMark],[Ft.Prepend,Ft.Any],[Ft.ZWJ,Ft.ExtPict],[Ft.RI,Ft.RI]];function QB(n,e){return ZB.findIndex(t=>os(n,t[0])&&os(e,t[1]))===-1}var e7=/(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])*\u200D$/,df=n=>n.search(e7)!==-1,t7=/(?:\uD83C[\uDDE6-\uDDFF])+$/g,n7=n=>{var e=n.match(t7);if(e===null)return!1;var t=e[0].length/2;return t%2===1},cf=n=>Kn(n)&&yt.isNodeList(n.children)&&!de.isEditor(n),Dn={isAncestor(n){return Kn(n)&&yt.isNodeList(n.children)},isElement:cf,isElementList(n){return Array.isArray(n)&&n.every(e=>Dn.isElement(e))},isElementProps(n){return n.children!==void 0},isElementType:function(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";return cf(e)&&e[o]===t},matches(n,e){for(var t in e)if(t!=="children"&&n[t]!==e[t])return!1;return!0}},o7=["text"],i7=["text"];function pf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function zr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var ff=new WeakMap,de={above(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{voids:t=!1,mode:o="lowest",at:i=n.selection,match:r}=e;if(i){var s=de.path(n,i),a=o==="lowest";for(var[l,d]of de.levels(n,{at:s,voids:t,match:r,reverse:a}))if(!qt.isText(l)&&!Oe.equals(s,d))return[l,d]}},addMark(n,e,t){n.addMark(e,t)},after(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=de.point(n,e,{edge:"end"}),i=de.end(n,[]),r={anchor:o,focus:i},{distance:s=1}=t,a=0,l;for(var d of de.positions(n,zr(zr({},t),{},{at:r}))){if(a>s)break;a!==0&&(l=d),a++}return l},before(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=de.start(n,[]),i=de.point(n,e,{edge:"start"}),r={anchor:o,focus:i},{distance:s=1}=t,a=0,l;for(var d of de.positions(n,zr(zr({},t),{},{at:r,reverse:!0}))){if(a>s)break;a!==0&&(l=d),a++}return l},deleteBackward(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:t="character"}=e;n.deleteBackward(t)},deleteForward(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:t="character"}=e;n.deleteForward(t)},deleteFragment(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:t="forward"}=e;n.deleteFragment(t)},edges(n,e){return[de.start(n,e),de.end(n,e)]},end(n,e){return de.point(n,e,{edge:"end"})},first(n,e){var t=de.path(n,e,{edge:"start"});return de.node(n,t)},fragment(n,e){var t=de.range(n,e),o=yt.fragment(n,t);return o},hasBlocks(n,e){return e.children.some(t=>de.isBlock(n,t))},hasInlines(n,e){return e.children.some(t=>qt.isText(t)||de.isInline(n,t))},hasTexts(n,e){return e.children.every(t=>qt.isText(t))},insertBreak(n){n.insertBreak()},insertFragment(n,e){n.insertFragment(e)},insertNode(n,e){n.insertNode(e)},insertText(n,e){n.insertText(e)},isBlock(n,e){return Dn.isElement(e)&&!n.isInline(e)},isEditor(n){if(!Kn(n))return!1;var e=ff.get(n);if(e!==void 0)return e;var t=typeof n.addMark=="function"&&typeof n.apply=="function"&&typeof n.deleteBackward=="function"&&typeof n.deleteForward=="function"&&typeof n.deleteFragment=="function"&&typeof n.insertBreak=="function"&&typeof n.insertFragment=="function"&&typeof n.insertNode=="function"&&typeof n.insertText=="function"&&typeof n.isInline=="function"&&typeof n.isVoid=="function"&&typeof n.normalizeNode=="function"&&typeof n.onChange=="function"&&typeof n.removeMark=="function"&&(n.marks===null||Kn(n.marks))&&(n.selection===null||rt.isRange(n.selection))&&yt.isNodeList(n.children)&&Ks.isOperationList(n.operations);return ff.set(n,t),t},isEnd(n,e,t){var o=de.end(n,t);return fn.equals(e,o)},isEdge(n,e,t){return de.isStart(n,e,t)||de.isEnd(n,e,t)},isEmpty(n,e){var{children:t}=e,[o]=t;return t.length===0||t.length===1&&qt.isText(o)&&o.text===""&&!n.isVoid(e)},isInline(n,e){return Dn.isElement(e)&&n.isInline(e)},isNormalizing(n){var e=sf.get(n);return e===void 0?!0:e},isStart(n,e,t){if(e.offset!==0)return!1;var o=de.start(n,t);return fn.equals(e,o)},isVoid(n,e){return Dn.isElement(e)&&n.isVoid(e)},last(n,e){var t=de.path(n,e,{edge:"end"});return de.node(n,t)},leaf(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=de.path(n,e,t),i=yt.leaf(n,o);return[i,o]},*levels(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,reverse:o=!1,voids:i=!1}=e,{match:r}=e;if(r==null&&(r=()=>!0),!!t){var s=[],a=de.path(n,t);for(var[l,d]of yt.levels(n,a))if(r(l,d)&&(s.push([l,d]),!i&&de.isVoid(n,l)))break;o&&s.reverse(),yield*s}},marks(n){var{marks:e,selection:t}=n;if(!t)return null;if(e)return e;if(rt.isExpanded(t)){var[o]=de.nodes(n,{match:qt.isText});if(o){var[i]=o,r=ji(i,o7);return r}else return{}}var{anchor:s}=t,{path:a}=s,[l]=de.leaf(n,a);if(s.offset===0){var d=de.previous(n,{at:a,match:qt.isText}),c=de.above(n,{match:y=>de.isBlock(n,y)});if(d&&c){var[p,f]=d,[,h]=c;Oe.isAncestor(h,f)&&(l=p)}}var v=ji(l,i7);return v},next(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection}=e;if(r){var s=de.after(n,r,{voids:o});if(s){var[,a]=de.last(n,[]),l=[s.path,a];if(Oe.isPath(r)&&r.length===0)throw new Error("Cannot get the next node from the root node!");if(i==null)if(Oe.isPath(r)){var[d]=de.parent(n,r);i=p=>d.children.includes(p)}else i=()=>!0;var[c]=de.nodes(n,{at:l,match:i,mode:t,voids:o});return c}}},node(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=de.path(n,e,t),i=yt.get(n,o);return[i,o]},*nodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,mode:o="all",universal:i=!1,reverse:r=!1,voids:s=!1}=e,{match:a}=e;if(a||(a=()=>!0),!!t){var l,d;if(r7.isSpan(t))l=t[0],d=t[1];else{var c=de.path(n,t,{edge:"start"}),p=de.path(n,t,{edge:"end"});l=r?p:c,d=r?c:p}var f=yt.nodes(n,{reverse:r,from:l,to:d,pass:C=>{var[T]=C;return s?!1:de.isVoid(n,T)}}),h=[],v;for(var[y,g]of f){var _=v&&Oe.compare(g,v[1])===0;if(!(o==="highest"&&_)){if(!a(y,g)){if(i&&!_&&qt.isText(y))return;continue}if(o==="lowest"&&_){v=[y,g];continue}var b=o==="lowest"?v:[y,g];b&&(i?h.push(b):yield b),v=[y,g]}}o==="lowest"&&v&&(i?h.push(v):yield v),i&&(yield*h)}},normalize(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{force:t=!1}=e,o=l=>of.get(l)||[],i=l=>rf.get(l)||new Set,r=l=>{var d=o(l).pop(),c=d.join(",");return i(l).delete(c),d};if(de.isNormalizing(n)){if(t){var s=Array.from(yt.nodes(n),l=>{var[,d]=l;return d}),a=new Set(s.map(l=>l.join(",")));of.set(n,s),rf.set(n,a)}o(n).length!==0&&de.withoutNormalizing(n,()=>{for(var l of o(n))if(yt.has(n,l)){var d=de.node(n,l),[c,p]=d;Dn.isElement(c)&&c.children.length===0&&n.normalizeNode(d)}for(var f=o(n).length*42,h=0;o(n).length!==0;){if(h>f)throw new Error(`
            Could not completely normalize the editor after `.concat(f,` iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.
          `));var v=r(n);if(yt.has(n,v)){var y=de.node(n,v);n.normalizeNode(y)}h++}})}},parent(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=de.path(n,e,t),i=Oe.parent(o),r=de.node(n,i);return r},path(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{depth:o,edge:i}=t;if(Oe.isPath(e)){if(i==="start"){var[,r]=yt.first(n,e);e=r}else if(i==="end"){var[,s]=yt.last(n,e);e=s}}return rt.isRange(e)&&(i==="start"?e=rt.start(e):i==="end"?e=rt.end(e):e=Oe.common(e.anchor.path,e.focus.path)),fn.isPoint(e)&&(e=e.path),o!=null&&(e=e.slice(0,o)),e},hasPath(n,e){return yt.has(n,e)},pathRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=de.pathRefs(n);return a.delete(i),i.current=null,s}},r=de.pathRefs(n);return r.add(i),i},pathRefs(n){var e=af.get(n);return e||(e=new Set,af.set(n,e)),e},point(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{edge:o="start"}=t;if(Oe.isPath(e)){var i;if(o==="end"){var[,r]=yt.last(n,e);i=r}else{var[,s]=yt.first(n,e);i=s}var a=yt.get(n,i);if(!qt.isText(a))throw new Error("Cannot get the ".concat(o," point in the node at path [").concat(e,"] because it has no ").concat(o," text node."));return{path:i,offset:o==="end"?a.text.length:0}}if(rt.isRange(e)){var[l,d]=rt.edges(e);return o==="start"?l:d}return e},pointRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=de.pointRefs(n);return a.delete(i),i.current=null,s}},r=de.pointRefs(n);return r.add(i),i},pointRefs(n){var e=lf.get(n);return e||(e=new Set,lf.set(n,e)),e},*positions(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,unit:o="offset",reverse:i=!1,voids:r=!1}=e;if(!t)return;var s=de.range(n,t),[a,l]=rt.edges(s),d=i?l:a,c=!1,p="",f=0,h=0,v=0;for(var[y,g]of de.nodes(n,{at:t,reverse:i,voids:r})){if(Dn.isElement(y)){if(!r&&n.isVoid(y)){yield de.start(n,g);continue}if(n.isInline(y))continue;if(de.hasInlines(n,y)){var _=Oe.isAncestor(g,l.path)?l:de.end(n,g),b=Oe.isAncestor(g,a.path)?a:de.start(n,g);p=de.string(n,{anchor:b,focus:_},{voids:r}),c=!0}}if(qt.isText(y)){var C=Oe.equals(g,d.path);for(C?(h=i?d.offset:y.text.length-d.offset,v=d.offset):(h=y.text.length,v=i?h:0),(C||c||o==="offset")&&(yield{path:g,offset:v},c=!1);;){if(f===0){if(p==="")break;f=T(p,o,i),p=dp(p,f,i)[1]}if(v=i?v-f:v+f,h=h-f,h<0){f=-h;break}f=0,yield{path:g,offset:v}}}}function T(M,S,k){return S==="character"?up(M,k):S==="word"?BB(M,k):S==="line"||S==="block"?M.length:1}},previous(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection}=e;if(r){var s=de.before(n,r,{voids:o});if(s){var[,a]=de.first(n,[]),l=[s.path,a];if(Oe.isPath(r)&&r.length===0)throw new Error("Cannot get the previous node from the root node!");if(i==null)if(Oe.isPath(r)){var[d]=de.parent(n,r);i=p=>d.children.includes(p)}else i=()=>!0;var[c]=de.nodes(n,{reverse:!0,at:l,match:i,mode:t,voids:o});return c}}},range(n,e,t){if(rt.isRange(e)&&!t)return e;var o=de.start(n,e),i=de.end(n,t||e);return{anchor:o,focus:i}},rangeRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=de.rangeRefs(n);return a.delete(i),i.current=null,s}},r=de.rangeRefs(n);return r.add(i),i},rangeRefs(n){var e=uf.get(n);return e||(e=new Set,uf.set(n,e)),e},removeMark(n,e){n.removeMark(e)},setNormalizing(n,e){sf.set(n,e)},start(n,e){return de.point(n,e,{edge:"start"})},string(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:o=!1}=t,i=de.range(n,e),[r,s]=rt.edges(i),a="";for(var[l,d]of de.nodes(n,{at:i,match:qt.isText,voids:o})){var c=l.text;Oe.equals(d,s.path)&&(c=c.slice(0,s.offset)),Oe.equals(d,r.path)&&(c=c.slice(r.offset)),a+=c}return a},unhangRange(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:o=!1}=t,[i,r]=rt.edges(e);if(i.offset!==0||r.offset!==0||rt.isCollapsed(e))return e;var s=de.above(n,{at:r,match:h=>de.isBlock(n,h)}),a=s?s[1]:[],l=de.start(n,i),d={anchor:l,focus:r},c=!0;for(var[p,f]of de.nodes(n,{at:d,match:qt.isText,reverse:!0,voids:o})){if(c){c=!1;continue}if(p.text!==""||Oe.isBefore(f,a)){r={path:f,offset:p.text.length};break}}return{anchor:i,focus:r}},void(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return de.above(n,zr(zr({},e),{},{match:t=>de.isVoid(n,t)}))},withoutNormalizing(n,e){var t=de.isNormalizing(n);de.setNormalizing(n,!1);try{e()}finally{de.setNormalizing(n,t)}de.normalize(n)}},r7={isSpan(n){return Array.isArray(n)&&n.length===2&&n.every(Oe.isPath)}},s7=["children"],a7=["text"],hf=new WeakMap,yt={ancestor(n,e){var t=yt.get(n,e);if(qt.isText(t))throw new Error("Cannot get the ancestor node at path [".concat(e,"] because it refers to a text node instead: ").concat(t));return t},*ancestors(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var o of Oe.ancestors(e,t)){var i=yt.ancestor(n,o),r=[i,o];yield r}},child(n,e){if(qt.isText(n))throw new Error("Cannot get the child of a text node: ".concat(JSON.stringify(n)));var t=n.children[e];if(t==null)throw new Error("Cannot get child at index `".concat(e,"` in node: ").concat(JSON.stringify(n)));return t},*children(n,e){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{reverse:o=!1}=t,i=yt.ancestor(n,e),{children:r}=i,s=o?r.length-1:0;o?s>=0:s<r.length;){var a=yt.child(i,s),l=e.concat(s);yield[a,l],s=o?s-1:s+1}},common(n,e,t){var o=Oe.common(e,t),i=yt.get(n,o);return[i,o]},descendant(n,e){var t=yt.get(n,e);if(de.isEditor(t))throw new Error("Cannot get the descendant node at path [".concat(e,"] because it refers to the root editor node instead: ").concat(t));return t},*descendants(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of yt.nodes(n,e))o.length!==0&&(yield[t,o])},*elements(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of yt.nodes(n,e))Dn.isElement(t)&&(yield[t,o])},extractProps(n){if(Dn.isAncestor(n)){var e=ji(n,s7);return e}else{var e=ji(n,a7);return e}},first(n,e){for(var t=e.slice(),o=yt.get(n,t);o&&!(qt.isText(o)||o.children.length===0);)o=o.children[0],t.push(0);return[o,t]},fragment(n,e){if(qt.isText(n))throw new Error("Cannot get a fragment starting from a root text node: ".concat(JSON.stringify(n)));var t=Hu({children:n.children},o=>{var[i,r]=rt.edges(e),s=yt.nodes(o,{reverse:!0,pass:f=>{var[,h]=f;return!rt.includes(e,h)}});for(var[,a]of s){if(!rt.includes(e,a)){var l=yt.parent(o,a),d=a[a.length-1];l.children.splice(d,1)}if(Oe.equals(a,r.path)){var c=yt.leaf(o,a);c.text=c.text.slice(0,r.offset)}if(Oe.equals(a,i.path)){var p=yt.leaf(o,a);p.text=p.text.slice(i.offset)}}de.isEditor(o)&&(o.selection=null)});return t.children},get(n,e){for(var t=n,o=0;o<e.length;o++){var i=e[o];if(qt.isText(t)||!t.children[i])throw new Error("Cannot find a descendant at path [".concat(e,"] in node: ").concat(JSON.stringify(n)));t=t.children[i]}return t},has(n,e){for(var t=n,o=0;o<e.length;o++){var i=e[o];if(qt.isText(t)||!t.children[i])return!1;t=t.children[i]}return!0},isNode(n){return qt.isText(n)||Dn.isElement(n)||de.isEditor(n)},isNodeList(n){if(!Array.isArray(n))return!1;var e=hf.get(n);if(e!==void 0)return e;var t=n.every(o=>yt.isNode(o));return hf.set(n,t),t},last(n,e){for(var t=e.slice(),o=yt.get(n,t);o&&!(qt.isText(o)||o.children.length===0);){var i=o.children.length-1;o=o.children[i],t.push(i)}return[o,t]},leaf(n,e){var t=yt.get(n,e);if(!qt.isText(t))throw new Error("Cannot get the leaf node at path [".concat(e,"] because it refers to a non-leaf node: ").concat(t));return t},*levels(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var o of Oe.levels(e,t)){var i=yt.get(n,o);yield[i,o]}},matches(n,e){return Dn.isElement(n)&&Dn.isElementProps(e)&&Dn.matches(n,e)||qt.isText(n)&&qt.isTextProps(e)&&qt.matches(n,e)},*nodes(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{pass:t,reverse:o=!1}=e,{from:i=[],to:r}=e,s=new Set,a=[],l=n;!(r&&(o?Oe.isBefore(a,r):Oe.isAfter(a,r)));){if(s.has(l)||(yield[l,a]),!s.has(l)&&!qt.isText(l)&&l.children.length!==0&&(t==null||t([l,a])===!1)){s.add(l);var d=o?l.children.length-1:0;Oe.isAncestor(a,i)&&(d=i[a.length]),a=a.concat(d),l=yt.get(n,a);continue}if(a.length===0)break;if(!o){var c=Oe.next(a);if(yt.has(n,c)){a=c,l=yt.get(n,a);continue}}if(o&&a[a.length-1]!==0){var p=Oe.previous(a);a=p,l=yt.get(n,a);continue}a=Oe.parent(a),l=yt.get(n,a),s.add(l)}},parent(n,e){var t=Oe.parent(e),o=yt.get(n,t);if(qt.isText(o))throw new Error("Cannot get the parent of path [".concat(e,"] because it does not exist in the root."));return o},string(n){return qt.isText(n)?n.text:n.children.map(yt.string).join("")},*texts(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of yt.nodes(n,e))qt.isText(t)&&(yield[t,o])}};function vf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Sn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var Ks={isNodeOperation(n){return Ks.isOperation(n)&&n.type.endsWith("_node")},isOperation(n){if(!Kn(n))return!1;switch(n.type){case"insert_node":return Oe.isPath(n.path)&&yt.isNode(n.node);case"insert_text":return typeof n.offset=="number"&&typeof n.text=="string"&&Oe.isPath(n.path);case"merge_node":return typeof n.position=="number"&&Oe.isPath(n.path)&&Kn(n.properties);case"move_node":return Oe.isPath(n.path)&&Oe.isPath(n.newPath);case"remove_node":return Oe.isPath(n.path)&&yt.isNode(n.node);case"remove_text":return typeof n.offset=="number"&&typeof n.text=="string"&&Oe.isPath(n.path);case"set_node":return Oe.isPath(n.path)&&Kn(n.properties)&&Kn(n.newProperties);case"set_selection":return n.properties===null&&rt.isRange(n.newProperties)||n.newProperties===null&&rt.isRange(n.properties)||Kn(n.properties)&&Kn(n.newProperties);case"split_node":return Oe.isPath(n.path)&&typeof n.position=="number"&&Kn(n.properties);default:return!1}},isOperationList(n){return Array.isArray(n)&&n.every(e=>Ks.isOperation(e))},isSelectionOperation(n){return Ks.isOperation(n)&&n.type.endsWith("_selection")},isTextOperation(n){return Ks.isOperation(n)&&n.type.endsWith("_text")},inverse(n){switch(n.type){case"insert_node":return Sn(Sn({},n),{},{type:"remove_node"});case"insert_text":return Sn(Sn({},n),{},{type:"remove_text"});case"merge_node":return Sn(Sn({},n),{},{type:"split_node",path:Oe.previous(n.path)});case"move_node":{var{newPath:e,path:t}=n;if(Oe.equals(e,t))return n;if(Oe.isSibling(t,e))return Sn(Sn({},n),{},{path:e,newPath:t});var o=Oe.transform(t,n),i=Oe.transform(Oe.next(t),n);return Sn(Sn({},n),{},{path:o,newPath:i})}case"remove_node":return Sn(Sn({},n),{},{type:"insert_node"});case"remove_text":return Sn(Sn({},n),{},{type:"insert_text"});case"set_node":{var{properties:r,newProperties:s}=n;return Sn(Sn({},n),{},{properties:s,newProperties:r})}case"set_selection":{var{properties:a,newProperties:l}=n;return a==null?Sn(Sn({},n),{},{properties:l,newProperties:null}):l==null?Sn(Sn({},n),{},{properties:null,newProperties:a}):Sn(Sn({},n),{},{properties:l,newProperties:a})}case"split_node":return Sn(Sn({},n),{},{type:"merge_node",path:Oe.next(n.path)})}}},Oe={ancestors(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,o=Oe.levels(n,e);return t?o=o.slice(1):o=o.slice(0,-1),o},common(n,e){for(var t=[],o=0;o<n.length&&o<e.length;o++){var i=n[o],r=e[o];if(i!==r)break;t.push(i)}return t},compare(n,e){for(var t=Math.min(n.length,e.length),o=0;o<t;o++){if(n[o]<e[o])return-1;if(n[o]>e[o])return 1}return 0},endsAfter(n,e){var t=n.length-1,o=n.slice(0,t),i=e.slice(0,t),r=n[t],s=e[t];return Oe.equals(o,i)&&r>s},endsAt(n,e){var t=n.length,o=n.slice(0,t),i=e.slice(0,t);return Oe.equals(o,i)},endsBefore(n,e){var t=n.length-1,o=n.slice(0,t),i=e.slice(0,t),r=n[t],s=e[t];return Oe.equals(o,i)&&r<s},equals(n,e){return n.length===e.length&&n.every((t,o)=>t===e[o])},hasPrevious(n){return n[n.length-1]>0},isAfter(n,e){return Oe.compare(n,e)===1},isAncestor(n,e){return n.length<e.length&&Oe.compare(n,e)===0},isBefore(n,e){return Oe.compare(n,e)===-1},isChild(n,e){return n.length===e.length+1&&Oe.compare(n,e)===0},isCommon(n,e){return n.length<=e.length&&Oe.compare(n,e)===0},isDescendant(n,e){return n.length>e.length&&Oe.compare(n,e)===0},isParent(n,e){return n.length+1===e.length&&Oe.compare(n,e)===0},isPath(n){return Array.isArray(n)&&(n.length===0||typeof n[0]=="number")},isSibling(n,e){if(n.length!==e.length)return!1;var t=n.slice(0,-1),o=e.slice(0,-1),i=n[n.length-1],r=e[e.length-1];return i!==r&&Oe.equals(t,o)},levels(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,o=[],i=0;i<=n.length;i++)o.push(n.slice(0,i));return t&&o.reverse(),o},next(n){if(n.length===0)throw new Error("Cannot get the next path of a root path [".concat(n,"], because it has no next index."));var e=n[n.length-1];return n.slice(0,-1).concat(e+1)},operationCanTransformPath(n){switch(n.type){case"insert_node":case"remove_node":case"merge_node":case"split_node":case"move_node":return!0;default:return!1}},parent(n){if(n.length===0)throw new Error("Cannot get the parent path of the root path [".concat(n,"]."));return n.slice(0,-1)},previous(n){if(n.length===0)throw new Error("Cannot get the previous path of a root path [".concat(n,"], because it has no previous index."));var e=n[n.length-1];if(e<=0)throw new Error("Cannot get the previous path of a first child path [".concat(n,"] because it would result in a negative index."));return n.slice(0,-1).concat(e-1)},relative(n,e){if(!Oe.isAncestor(e,n)&&!Oe.equals(n,e))throw new Error("Cannot get the relative path of [".concat(n,"] inside ancestor [").concat(e,"], because it is not above or equal to the path."));return n.slice(e.length)},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Hu(n,o=>{var{affinity:i="forward"}=t;if(!(!n||(n==null?void 0:n.length)===0)){if(o===null)return null;switch(e.type){case"insert_node":{var{path:r}=e;(Oe.equals(r,o)||Oe.endsBefore(r,o)||Oe.isAncestor(r,o))&&(o[r.length-1]+=1);break}case"remove_node":{var{path:s}=e;if(Oe.equals(s,o)||Oe.isAncestor(s,o))return null;Oe.endsBefore(s,o)&&(o[s.length-1]-=1);break}case"merge_node":{var{path:a,position:l}=e;Oe.equals(a,o)||Oe.endsBefore(a,o)?o[a.length-1]-=1:Oe.isAncestor(a,o)&&(o[a.length-1]-=1,o[a.length]+=l);break}case"split_node":{var{path:d,position:c}=e;if(Oe.equals(d,o)){if(i==="forward")o[o.length-1]+=1;else if(i!=="backward")return null}else Oe.endsBefore(d,o)?o[d.length-1]+=1:Oe.isAncestor(d,o)&&n[d.length]>=c&&(o[d.length-1]+=1,o[d.length]-=c);break}case"move_node":{var{path:p,newPath:f}=e;if(Oe.equals(p,f))return;if(Oe.isAncestor(p,o)||Oe.equals(p,o)){var h=f.slice();return Oe.endsBefore(p,f)&&p.length<f.length&&(h[p.length-1]-=1),h.concat(o.slice(p.length))}else Oe.isSibling(p,f)&&(Oe.isAncestor(f,o)||Oe.equals(f,o))?Oe.endsBefore(p,o)?o[p.length-1]-=1:o[p.length-1]+=1:Oe.endsBefore(f,o)||Oe.equals(f,o)||Oe.isAncestor(f,o)?(Oe.endsBefore(p,o)&&(o[p.length-1]-=1),o[f.length-1]+=1):Oe.endsBefore(p,o)&&(Oe.equals(f,o)&&(o[f.length-1]+=1),o[p.length-1]-=1);break}}}})}};function _f(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function gf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_f(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_f(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var fn={compare(n,e){var t=Oe.compare(n.path,e.path);return t===0?n.offset<e.offset?-1:n.offset>e.offset?1:0:t},isAfter(n,e){return fn.compare(n,e)===1},isBefore(n,e){return fn.compare(n,e)===-1},equals(n,e){return n.offset===e.offset&&Oe.equals(n.path,e.path)},isPoint(n){return Kn(n)&&typeof n.offset=="number"&&Oe.isPath(n.path)},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Hu(n,o=>{if(o===null)return null;var{affinity:i="forward"}=t,{path:r,offset:s}=o;switch(e.type){case"insert_node":case"move_node":{o.path=Oe.transform(r,e,t);break}case"insert_text":{Oe.equals(e.path,r)&&e.offset<=s&&(o.offset+=e.text.length);break}case"merge_node":{Oe.equals(e.path,r)&&(o.offset+=e.position),o.path=Oe.transform(r,e,t);break}case"remove_text":{Oe.equals(e.path,r)&&e.offset<=s&&(o.offset-=Math.min(s-e.offset,e.text.length));break}case"remove_node":{if(Oe.equals(e.path,r)||Oe.isAncestor(e.path,r))return null;o.path=Oe.transform(r,e,t);break}case"split_node":{if(Oe.equals(e.path,r)){if(e.position===s&&i==null)return null;(e.position<s||e.position===s&&i==="forward")&&(o.offset-=e.position,o.path=Oe.transform(r,e,gf(gf({},t),{},{affinity:"forward"})))}else o.path=Oe.transform(r,e,t);break}}})}},l7=["anchor","focus"];function mf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function u7(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var rt={edges(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,{anchor:o,focus:i}=n;return rt.isBackward(n)===t?[o,i]:[i,o]},end(n){var[,e]=rt.edges(n);return e},equals(n,e){return fn.equals(n.anchor,e.anchor)&&fn.equals(n.focus,e.focus)},includes(n,e){if(rt.isRange(e)){if(rt.includes(n,e.anchor)||rt.includes(n,e.focus))return!0;var[t,o]=rt.edges(n),[i,r]=rt.edges(e);return fn.isBefore(t,i)&&fn.isAfter(o,r)}var[s,a]=rt.edges(n),l=!1,d=!1;return fn.isPoint(e)?(l=fn.compare(e,s)>=0,d=fn.compare(e,a)<=0):(l=Oe.compare(e,s.path)>=0,d=Oe.compare(e,a.path)<=0),l&&d},intersection(n,e){var t=ji(n,l7),[o,i]=rt.edges(n),[r,s]=rt.edges(e),a=fn.isBefore(o,r)?r:o,l=fn.isBefore(i,s)?i:s;return fn.isBefore(l,a)?null:u7({anchor:a,focus:l},t)},isBackward(n){var{anchor:e,focus:t}=n;return fn.isAfter(e,t)},isCollapsed(n){var{anchor:e,focus:t}=n;return fn.equals(e,t)},isExpanded(n){return!rt.isCollapsed(n)},isForward(n){return!rt.isBackward(n)},isRange(n){return Kn(n)&&fn.isPoint(n.anchor)&&fn.isPoint(n.focus)},*points(n){yield[n.anchor,"anchor"],yield[n.focus,"focus"]},start(n){var[e]=rt.edges(n);return e},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Hu(n,o=>{if(o===null)return null;var{affinity:i="inward"}=t,r,s;if(i==="inward"){var a=rt.isCollapsed(o);rt.isForward(o)?(r="forward",s=a?r:"backward"):(r="backward",s=a?r:"forward")}else i==="outward"?rt.isForward(o)?(r="backward",s="forward"):(r="forward",s="backward"):(r=i,s=i);var l=fn.transform(o.anchor,e,{affinity:r}),d=fn.transform(o.focus,e,{affinity:s});if(!l||!d)return null;o.anchor=l,o.focus=d})}},L_=(n,e)=>{for(var t in n){var o=n[t],i=e[t];if(Kn(o)&&Kn(i)){if(!L_(o,i))return!1}else if(Array.isArray(o)&&Array.isArray(i)){if(o.length!==i.length)return!1;for(var r=0;r<o.length;r++)if(o[r]!==i[r])return!1}else if(o!==i)return!1}for(var s in e)if(n[s]===void 0&&e[s]!==void 0)return!1;return!0},d7=["text"],c7=["anchor","focus"];function yf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Ri(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):yf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var qt={equals(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{loose:o=!1}=t;function i(r){var s=ji(r,d7);return s}return L_(o?i(n):n,o?i(e):e)},isText(n){return Kn(n)&&typeof n.text=="string"},isTextList(n){return Array.isArray(n)&&n.every(e=>qt.isText(e))},isTextProps(n){return n.text!==void 0},matches(n,e){for(var t in e)if(t!=="text"&&(!n.hasOwnProperty(t)||n[t]!==e[t]))return!1;return!0},decorations(n,e){var t=[Ri({},n)];for(var o of e){var i=ji(o,c7),[r,s]=rt.edges(o),a=[],l=0;for(var d of t){var{length:c}=d.text,p=l;if(l+=c,r.offset<=p&&s.offset>=l){Object.assign(d,i),a.push(d);continue}if(r.offset!==s.offset&&(r.offset===l||s.offset===p)||r.offset>l||s.offset<p||s.offset===p&&p!==0){a.push(d);continue}var f=d,h=void 0,v=void 0;if(s.offset<l){var y=s.offset-p;v=Ri(Ri({},f),{},{text:f.text.slice(y)}),f=Ri(Ri({},f),{},{text:f.text.slice(0,y)})}if(r.offset>p){var g=r.offset-p;h=Ri(Ri({},f),{},{text:f.text.slice(0,g)}),f=Ri(Ri({},f),{},{text:f.text.slice(g)})}Object.assign(f,i),h&&a.push(h),a.push(f),v&&a.push(v)}t=a}return t}};function bf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function zs(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var p7=(n,e,t)=>{switch(t.type){case"insert_node":{var{path:o,node:i}=t,r=yt.parent(n,o),s=o[o.length-1];if(s>r.children.length)throw new Error('Cannot apply an "insert_node" operation at path ['.concat(o,"] because the destination is past the end of the node."));if(r.children.splice(s,0,i),e)for(var[a,l]of rt.points(e))e[l]=fn.transform(a,t);break}case"insert_text":{var{path:d,offset:c,text:p}=t;if(p.length===0)break;var f=yt.leaf(n,d),h=f.text.slice(0,c),v=f.text.slice(c);if(f.text=h+p+v,e)for(var[y,g]of rt.points(e))e[g]=fn.transform(y,t);break}case"merge_node":{var{path:_}=t,b=yt.get(n,_),C=Oe.previous(_),T=yt.get(n,C),M=yt.parent(n,_),S=_[_.length-1];if(qt.isText(b)&&qt.isText(T))T.text+=b.text;else if(!qt.isText(b)&&!qt.isText(T))T.children.push(...b.children);else throw new Error('Cannot apply a "merge_node" operation at path ['.concat(_,"] to nodes of different interfaces: ").concat(b," ").concat(T));if(M.children.splice(S,1),e)for(var[k,A]of rt.points(e))e[A]=fn.transform(k,t);break}case"move_node":{var{path:$,newPath:B}=t;if(Oe.isAncestor($,B))throw new Error("Cannot move a path [".concat($,"] to new path [").concat(B,"] because the destination is inside itself."));var O=yt.get(n,$),P=yt.parent(n,$),E=$[$.length-1];P.children.splice(E,1);var D=Oe.transform($,t),N=yt.get(n,Oe.parent(D)),F=D[D.length-1];if(N.children.splice(F,0,O),e)for(var[Y,L]of rt.points(e))e[L]=fn.transform(Y,t);break}case"remove_node":{var{path:j}=t,le=j[j.length-1],z=yt.parent(n,j);if(z.children.splice(le,1),e)for(var[V,J]of rt.points(e)){var oe=fn.transform(V,t);if(e!=null&&oe!=null)e[J]=oe;else{var W=void 0,q=void 0;for(var[re,ue]of yt.texts(n))if(Oe.compare(ue,j)===-1)W=[re,ue];else{q=[re,ue];break}var xe=!1;W&&q&&(Oe.equals(q[1],j)?xe=!Oe.hasPrevious(q[1]):xe=Oe.common(W[1],j).length<Oe.common(q[1],j).length),W&&!xe?(V.path=W[1],V.offset=W[0].text.length):q?(V.path=q[1],V.offset=0):e=null}}break}case"remove_text":{var{path:Te,offset:me,text:pe}=t;if(pe.length===0)break;var Ge=yt.leaf(n,Te),Le=Ge.text.slice(0,me),_e=Ge.text.slice(me+pe.length);if(Ge.text=Le+_e,e)for(var[he,be]of rt.points(e))e[be]=fn.transform(he,t);break}case"set_node":{var{path:De,properties:G,newProperties:ie}=t;if(De.length===0)throw new Error("Cannot set properties on the root node!");var ae=yt.get(n,De);for(var Ae in ie){if(Ae==="children"||Ae==="text")throw new Error('Cannot set the "'.concat(Ae,'" property of nodes!'));var fe=ie[Ae];fe==null?delete ae[Ae]:ae[Ae]=fe}for(var Ie in G)ie.hasOwnProperty(Ie)||delete ae[Ie];break}case"set_selection":{var{newProperties:je}=t;if(je==null)e=je;else{if(e==null){if(!rt.isRange(je))throw new Error('Cannot apply an incomplete "set_selection" operation properties '.concat(JSON.stringify(je)," when there is no current selection."));e=zs({},je)}for(var Ue in je){var ot=je[Ue];if(ot==null){if(Ue==="anchor"||Ue==="focus")throw new Error('Cannot remove the "'.concat(Ue,'" selection property'));delete e[Ue]}else e[Ue]=ot}}break}case"split_node":{var{path:it,position:Ke,properties:dt}=t;if(it.length===0)throw new Error('Cannot apply a "split_node" operation at path ['.concat(it,"] because the root node cannot be split."));var ce=yt.get(n,it),ve=yt.parent(n,it),Ce=it[it.length-1],Se;if(qt.isText(ce)){var Fe=ce.text.slice(0,Ke),ze=ce.text.slice(Ke);ce.text=Fe,Se=zs(zs({},dt),{},{text:ze})}else{var Xe=ce.children.slice(0,Ke),lt=ce.children.slice(Ke);ce.children=Xe,Se=zs(zs({},dt),{},{children:lt})}if(ve.children.splice(Ce+1,0,Se),e)for(var[wt,Yt]of rt.points(e))e[Yt]=fn.transform(wt,t);break}}return e},f7={transform(n,e){n.children=tf(n.children);var t=n.selection&&tf(n.selection);try{t=p7(n,t,e)}finally{n.children=nf(n.children),t?n.selection=$r(t)?nf(t):t:n.selection=null}}},h7=["text"],v7=["children"];function xf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function wf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?xf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):xf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var _7={insertNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};de.withoutNormalizing(n,()=>{var{hanging:o=!1,voids:i=!1,mode:r="lowest"}=t,{at:s,match:a,select:l}=t;if(yt.isNode(e)&&(e=[e]),e.length!==0){var[d]=e;if(s||(n.selection?s=n.selection:n.children.length>0?s=de.end(n,[]):s=[0],l=!0),l==null&&(l=!1),rt.isRange(s))if(o||(s=de.unhangRange(n,s)),rt.isCollapsed(s))s=s.anchor;else{var[,c]=rt.edges(s),p=de.pointRef(n,c);It.delete(n,{at:s}),s=p.unref()}if(fn.isPoint(s)){a==null&&(qt.isText(d)?a=S=>qt.isText(S):n.isInline(d)?a=S=>qt.isText(S)||de.isInline(n,S):a=S=>de.isBlock(n,S));var[f]=de.nodes(n,{at:s.path,match:a,mode:r,voids:i});if(f){var[,h]=f,v=de.pathRef(n,h),y=de.isEnd(n,s,h);It.splitNodes(n,{at:s,match:a,mode:r,voids:i});var g=v.unref();s=y?Oe.next(g):g}else return}var _=Oe.parent(s),b=s[s.length-1];if(!(!i&&de.void(n,{at:_}))){for(var C of e){var T=_.concat(b);b++,n.apply({type:"insert_node",path:T,node:C}),s=Oe.next(s)}if(s=Oe.previous(s),l){var M=de.end(n,s);M&&It.select(n,M)}}}})},liftNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};de.withoutNormalizing(n,()=>{var{at:t=n.selection,mode:o="lowest",voids:i=!1}=e,{match:r}=e;if(r==null&&(r=Oe.isPath(t)?qr(n,t):C=>de.isBlock(n,C)),!!t){var s=de.nodes(n,{at:t,match:r,mode:o,voids:i}),a=Array.from(s,C=>{var[,T]=C;return de.pathRef(n,T)});for(var l of a){var d=l.unref();if(d.length<2)throw new Error("Cannot lift node at a path [".concat(d,"] because it has a depth of less than `2`."));var c=de.node(n,Oe.parent(d)),[p,f]=c,h=d[d.length-1],{length:v}=p.children;if(v===1){var y=Oe.next(f);It.moveNodes(n,{at:d,to:y,voids:i}),It.removeNodes(n,{at:f,voids:i})}else if(h===0)It.moveNodes(n,{at:d,to:f,voids:i});else if(h===v-1){var g=Oe.next(f);It.moveNodes(n,{at:d,to:g,voids:i})}else{var _=Oe.next(d),b=Oe.next(f);It.splitNodes(n,{at:_,voids:i}),It.moveNodes(n,{at:d,to:b,voids:i})}}}})},mergeNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};de.withoutNormalizing(n,()=>{var{match:t,at:o=n.selection}=e,{hanging:i=!1,voids:r=!1,mode:s="lowest"}=e;if(o){if(t==null)if(Oe.isPath(o)){var[a]=de.parent(n,o);t=$=>a.children.includes($)}else t=$=>de.isBlock(n,$);if(!i&&rt.isRange(o)&&(o=de.unhangRange(n,o)),rt.isRange(o))if(rt.isCollapsed(o))o=o.anchor;else{var[,l]=rt.edges(o),d=de.pointRef(n,l);It.delete(n,{at:o}),o=d.unref(),e.at==null&&It.select(n,o)}var[c]=de.nodes(n,{at:o,match:t,voids:r,mode:s}),p=de.previous(n,{at:o,match:t,voids:r,mode:s});if(!(!c||!p)){var[f,h]=c,[v,y]=p;if(!(h.length===0||y.length===0)){var g=Oe.next(y),_=Oe.common(h,y),b=Oe.isSibling(h,y),C=Array.from(de.levels(n,{at:h}),$=>{var[B]=$;return B}).slice(_.length).slice(0,-1),T=de.above(n,{at:h,mode:"highest",match:$=>C.includes($)&&B_(n,$)}),M=T&&de.pathRef(n,T[1]),S,k;if(qt.isText(f)&&qt.isText(v)){var A=ji(f,h7);k=v.text.length,S=A}else if(Dn.isElement(f)&&Dn.isElement(v)){var A=ji(f,v7);k=v.children.length,S=A}else throw new Error("Cannot merge the node at path [".concat(h,"] with the previous sibling because it is not the same kind: ").concat(JSON.stringify(f)," ").concat(JSON.stringify(v)));b||It.moveNodes(n,{at:h,to:g,voids:r}),M&&It.removeNodes(n,{at:M.current,voids:r}),Dn.isElement(v)&&de.isEmpty(n,v)||qt.isText(v)&&v.text===""&&y[y.length-1]!==0?It.removeNodes(n,{at:y,voids:r}):n.apply({type:"merge_node",path:g,position:k,properties:S}),M&&M.unref()}}}})},moveNodes(n,e){de.withoutNormalizing(n,()=>{var{to:t,at:o=n.selection,mode:i="lowest",voids:r=!1}=e,{match:s}=e;if(o){s==null&&(s=Oe.isPath(o)?qr(n,o):h=>de.isBlock(n,h));var a=de.pathRef(n,t),l=de.nodes(n,{at:o,match:s,mode:i,voids:r}),d=Array.from(l,h=>{var[,v]=h;return de.pathRef(n,v)});for(var c of d){var p=c.unref(),f=a.current;p.length!==0&&n.apply({type:"move_node",path:p,newPath:f}),a.current&&Oe.isSibling(f,p)&&Oe.isAfter(f,p)&&(a.current=Oe.next(a.current))}a.unref()}})},removeNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};de.withoutNormalizing(n,()=>{var{hanging:t=!1,voids:o=!1,mode:i="lowest"}=e,{at:r=n.selection,match:s}=e;if(r){s==null&&(s=Oe.isPath(r)?qr(n,r):f=>de.isBlock(n,f)),!t&&rt.isRange(r)&&(r=de.unhangRange(n,r));var a=de.nodes(n,{at:r,match:s,mode:i,voids:o}),l=Array.from(a,f=>{var[,h]=f;return de.pathRef(n,h)});for(var d of l){var c=d.unref();if(c){var[p]=de.node(n,c);n.apply({type:"remove_node",path:c,node:p})}}}})},setNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};de.withoutNormalizing(n,()=>{var{match:o,at:i=n.selection}=t,{hanging:r=!1,mode:s="lowest",split:a=!1,voids:l=!1}=t;if(i){if(o==null&&(o=Oe.isPath(i)?qr(n,i):M=>de.isBlock(n,M)),!r&&rt.isRange(i)&&(i=de.unhangRange(n,i)),a&&rt.isRange(i)){if(rt.isCollapsed(i)&&de.leaf(n,i.anchor)[0].text.length>0)return;var d=de.rangeRef(n,i,{affinity:"inward"}),[c,p]=rt.edges(i),f=s==="lowest"?"lowest":"highest",h=de.isEnd(n,p,p.path);It.splitNodes(n,{at:p,match:o,mode:f,voids:l,always:!h});var v=de.isStart(n,c,c.path);It.splitNodes(n,{at:c,match:o,mode:f,voids:l,always:!v}),i=d.unref(),t.at==null&&It.select(n,i)}for(var[y,g]of de.nodes(n,{at:i,match:o,mode:s,voids:l})){var _={},b={};if(g.length!==0){var C=!1;for(var T in e)T==="children"||T==="text"||e[T]!==y[T]&&(C=!0,y.hasOwnProperty(T)&&(_[T]=y[T]),e[T]!=null&&(b[T]=e[T]));C&&n.apply({type:"set_node",path:g,properties:_,newProperties:b})}}}})},splitNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};de.withoutNormalizing(n,()=>{var{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection,height:s=0,always:a=!1}=e;if(i==null&&(i=Y=>de.isBlock(n,Y)),rt.isRange(r)&&(r=g7(n,r)),Oe.isPath(r)){var l=r,d=de.point(n,l),[c]=de.parent(n,l);i=Y=>Y===c,s=d.path.length-l.length+1,r=d,a=!0}if(r){var p=de.pointRef(n,r,{affinity:"backward"}),[f]=de.nodes(n,{at:r,match:i,mode:t,voids:o});if(f){var h=de.void(n,{at:r,mode:"highest"}),v=0;if(!o&&h){var[y,g]=h;if(Dn.isElement(y)&&n.isInline(y)){var _=de.after(n,g);if(!_){var b={text:""},C=Oe.next(g);It.insertNodes(n,b,{at:C,voids:o}),_=de.point(n,C)}r=_,a=!0}var T=r.path.length-g.length;s=T+1,a=!0}var M=de.pointRef(n,r),S=r.path.length-s,[,k]=f,A=r.path.slice(0,S),$=s===0?r.offset:r.path[S]+v;for(var[B,O]of de.levels(n,{at:A,reverse:!0,voids:o})){var P=!1;if(O.length<k.length||O.length===0||!o&&de.isVoid(n,B))break;var E=p.current,D=de.isEnd(n,E,O);if(a||!p||!de.isEdge(n,E,O)){P=!0;var N=yt.extractProps(B);n.apply({type:"split_node",path:O,position:$,properties:N})}$=O[O.length-1]+(P||D?1:0)}if(e.at==null){var F=M.current||de.end(n,[]);It.select(n,F)}p.unref(),M.unref()}}})},unsetNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Array.isArray(e)||(e=[e]);var o={};for(var i of e)o[i]=null;It.setNodes(n,o,t)},unwrapNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};de.withoutNormalizing(n,()=>{var{mode:t="lowest",split:o=!1,voids:i=!1}=e,{at:r=n.selection,match:s}=e;if(r){s==null&&(s=Oe.isPath(r)?qr(n,r):f=>de.isBlock(n,f)),Oe.isPath(r)&&(r=de.range(n,r));var a=rt.isRange(r)?de.rangeRef(n,r):null,l=de.nodes(n,{at:r,match:s,mode:t,voids:i}),d=Array.from(l,f=>{var[,h]=f;return de.pathRef(n,h)}).reverse(),c=function(h){var v=h.unref(),[y]=de.node(n,v),g=de.range(n,v);o&&a&&(g=rt.intersection(a.current,g)),It.liftNodes(n,{at:g,match:_=>Dn.isAncestor(y)&&y.children.includes(_),voids:i})};for(var p of d)c(p);a&&a.unref()}})},wrapNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};de.withoutNormalizing(n,()=>{var{mode:o="lowest",split:i=!1,voids:r=!1}=t,{match:s,at:a=n.selection}=t;if(a){if(s==null&&(Oe.isPath(a)?s=qr(n,a):n.isInline(e)?s=g=>de.isInline(n,g)||qt.isText(g):s=g=>de.isBlock(n,g)),i&&rt.isRange(a)){var[l,d]=rt.edges(a),c=de.rangeRef(n,a,{affinity:"inward"});It.splitNodes(n,{at:d,match:s,voids:r}),It.splitNodes(n,{at:l,match:s,voids:r}),a=c.unref(),t.at==null&&It.select(n,a)}var p=Array.from(de.nodes(n,{at:a,match:n.isInline(e)?g=>de.isBlock(n,g):g=>de.isEditor(g),mode:"lowest",voids:r}));for(var[,f]of p){var h=rt.isRange(a)?rt.intersection(a,de.range(n,f)):a;if(h){var v=Array.from(de.nodes(n,{at:h,match:s,mode:o,voids:r}));if(v.length>0){var y=(function(){var[g]=v,_=v[v.length-1],[,b]=g,[,C]=_;if(b.length===0&&C.length===0)return"continue";var T=Oe.equals(b,C)?Oe.parent(b):Oe.common(b,C),M=de.range(n,b,C),S=de.node(n,T),[k]=S,A=T.length+1,$=Oe.next(C.slice(0,A)),B=wf(wf({},e),{},{children:[]});It.insertNodes(n,B,{at:$,voids:r}),It.moveNodes(n,{at:M,match:O=>Dn.isAncestor(k)&&k.children.includes(O),to:$.concat(0),voids:r})})();if(y==="continue")continue}}}}})}},B_=(n,e)=>{if(Dn.isElement(e)){var t=e;return de.isVoid(n,e)?!0:t.children.length===1?B_(n,t.children[0]):!1}else return!de.isEditor(e)},g7=(n,e)=>{if(rt.isCollapsed(e))return e.anchor;var[,t]=rt.edges(e),o=de.pointRef(n,t);return It.delete(n,{at:e}),o.unref()},qr=(n,e)=>{var[t]=de.node(n,e);return o=>o===t};function Cf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function kf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Cf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var m7={collapse(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{edge:t="anchor"}=e,{selection:o}=n;if(o){if(t==="anchor")It.select(n,o.anchor);else if(t==="focus")It.select(n,o.focus);else if(t==="start"){var[i]=rt.edges(o);It.select(n,i)}else if(t==="end"){var[,r]=rt.edges(o);It.select(n,r)}}else return},deselect(n){var{selection:e}=n;e&&n.apply({type:"set_selection",properties:e,newProperties:null})},move(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{selection:t}=n,{distance:o=1,unit:i="character",reverse:r=!1}=e,{edge:s=null}=e;if(t){s==="start"&&(s=rt.isBackward(t)?"focus":"anchor"),s==="end"&&(s=rt.isBackward(t)?"anchor":"focus");var{anchor:a,focus:l}=t,d={distance:o,unit:i},c={};if(s==null||s==="anchor"){var p=r?de.before(n,a,d):de.after(n,a,d);p&&(c.anchor=p)}if(s==null||s==="focus"){var f=r?de.before(n,l,d):de.after(n,l,d);f&&(c.focus=f)}It.setSelection(n,c)}},select(n,e){var{selection:t}=n;if(e=de.range(n,e),t){It.setSelection(n,e);return}if(!rt.isRange(e))throw new Error("When setting the selection and the current selection is `null` you must provide at least an `anchor` and `focus`, but you passed: ".concat(JSON.stringify(e)));n.apply({type:"set_selection",properties:t,newProperties:e})},setPoint(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{selection:o}=n,{edge:i="both"}=t;if(o){i==="start"&&(i=rt.isBackward(o)?"focus":"anchor"),i==="end"&&(i=rt.isBackward(o)?"anchor":"focus");var{anchor:r,focus:s}=o,a=i==="anchor"?r:s;It.setSelection(n,{[i==="anchor"?"anchor":"focus"]:kf(kf({},a),e)})}},setSelection(n,e){var{selection:t}=n,o={},i={};if(t){for(var r in e)(r==="anchor"&&e.anchor!=null&&!fn.equals(e.anchor,t.anchor)||r==="focus"&&e.focus!=null&&!fn.equals(e.focus,t.focus)||r!=="anchor"&&r!=="focus"&&e[r]!==t[r])&&(o[r]=t[r],i[r]=e[r]);Object.keys(o).length>0&&n.apply({type:"set_selection",properties:o,newProperties:i})}}},y7={delete(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};de.withoutNormalizing(n,()=>{var{reverse:t=!1,unit:o="character",distance:i=1,voids:r=!1}=e,{at:s=n.selection,hanging:a=!1}=e;if(s){if(rt.isRange(s)&&rt.isCollapsed(s)&&(s=s.anchor),fn.isPoint(s)){var l=de.void(n,{at:s,mode:"highest"});if(!r&&l){var[,d]=l;s=d}else{var c={unit:o,distance:i},p=t?de.before(n,s,c)||de.start(n,[]):de.after(n,s,c)||de.end(n,[]);s={anchor:s,focus:p},a=!0}}if(Oe.isPath(s)){It.removeNodes(n,{at:s,voids:r});return}if(!rt.isCollapsed(s)){if(!a){var[,f]=rt.edges(s),h=de.end(n,[]);fn.equals(f,h)||(s=de.unhangRange(n,s,{voids:r}))}var[v,y]=rt.edges(s),g=de.above(n,{match:xe=>de.isBlock(n,xe),at:v,voids:r}),_=de.above(n,{match:xe=>de.isBlock(n,xe),at:y,voids:r}),b=g&&_&&!Oe.equals(g[1],_[1]),C=Oe.equals(v.path,y.path),T=r?null:de.void(n,{at:v,mode:"highest"}),M=r?null:de.void(n,{at:y,mode:"highest"});if(T){var S=de.before(n,v);S&&g&&Oe.isAncestor(g[1],S.path)&&(v=S)}if(M){var k=de.after(n,y);k&&_&&Oe.isAncestor(_[1],k.path)&&(y=k)}var A=[],$;for(var B of de.nodes(n,{at:s,voids:r})){var[O,P]=B;$&&Oe.compare(P,$)===0||(!r&&de.isVoid(n,O)||!Oe.isCommon(P,v.path)&&!Oe.isCommon(P,y.path))&&(A.push(B),$=P)}var E=Array.from(A,xe=>{var[,Te]=xe;return de.pathRef(n,Te)}),D=de.pointRef(n,v),N=de.pointRef(n,y);if(!C&&!T){var F=D.current,[Y]=de.leaf(n,F),{path:L}=F,{offset:j}=v,le=Y.text.slice(j);le.length>0&&n.apply({type:"remove_text",path:L,offset:j,text:le})}for(var z of E){var V=z.unref();It.removeNodes(n,{at:V,voids:r})}if(!M){var J=N.current,[oe]=de.leaf(n,J),{path:W}=J,q=C?v.offset:0,re=oe.text.slice(q,y.offset);re.length>0&&n.apply({type:"remove_text",path:W,offset:q,text:re})}!C&&b&&N.current&&D.current&&It.mergeNodes(n,{at:N.current,hanging:!0,voids:r});var ue=t?D.unref()||N.unref():N.unref()||D.unref();e.at==null&&ue&&It.select(n,ue)}}})},insertFragment(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};de.withoutNormalizing(n,()=>{var{hanging:o=!1,voids:i=!1}=t,{at:r=n.selection}=t;if(e.length){if(r)if(rt.isRange(r))if(o||(r=de.unhangRange(n,r)),rt.isCollapsed(r))r=r.anchor;else{var[,s]=rt.edges(r);if(!i&&de.void(n,{at:s}))return;var a=de.pointRef(n,s);It.delete(n,{at:r}),r=a.unref()}else Oe.isPath(r)&&(r=de.start(n,r));else return;if(!(!i&&de.void(n,{at:r}))){var l=de.above(n,{at:r,match:oe=>de.isInline(n,oe),mode:"highest",voids:i});if(l){var[,d]=l;if(de.isEnd(n,r,d)){var c=de.after(n,d);r=c}else if(de.isStart(n,r,d)){var p=de.before(n,d);r=p}}var f=de.above(n,{match:oe=>de.isBlock(n,oe),at:r,voids:i}),[,h]=f,v=de.isStart(n,r,h),y=de.isEnd(n,r,h),g=v&&y,_=!v||v&&y,b=!y,[,C]=yt.first({children:e},[]),[,T]=yt.last({children:e},[]),M=[],S=oe=>{var[W,q]=oe,re=q.length===0;return re?!1:g?!0:!(_&&Oe.isAncestor(q,C)&&Dn.isElement(W)&&!n.isVoid(W)&&!n.isInline(W)||b&&Oe.isAncestor(q,T)&&Dn.isElement(W)&&!n.isVoid(W)&&!n.isInline(W))};for(var k of yt.nodes({children:e},{pass:S}))S(k)&&M.push(k);var A=[],$=[],B=[],O=!0,P=!1;for(var[E]of M)Dn.isElement(E)&&!n.isInline(E)?(O=!1,P=!0,$.push(E)):O?A.push(E):B.push(E);var[D]=de.nodes(n,{at:r,match:oe=>qt.isText(oe)||de.isInline(n,oe),mode:"highest",voids:i}),[,N]=D,F=de.isStart(n,r,N),Y=de.isEnd(n,r,N),L=de.pathRef(n,y?Oe.next(h):h),j=de.pathRef(n,Y?Oe.next(N):N),le=de.pathRef(n,h);It.splitNodes(n,{at:r,match:oe=>P?de.isBlock(n,oe):qt.isText(oe)||de.isInline(n,oe),mode:P?"lowest":"highest",voids:i});var z=de.pathRef(n,!F||F&&Y?Oe.next(N):N);if(It.insertNodes(n,A,{at:z.current,match:oe=>qt.isText(oe)||de.isInline(n,oe),mode:"highest",voids:i}),g&&$.length&&It.delete(n,{at:le.unref(),voids:i}),It.insertNodes(n,$,{at:L.current,match:oe=>de.isBlock(n,oe),mode:"lowest",voids:i}),It.insertNodes(n,B,{at:j.current,match:oe=>qt.isText(oe)||de.isInline(n,oe),mode:"highest",voids:i}),!t.at){var V;B.length>0?V=Oe.previous(j.current):$.length>0?V=Oe.previous(L.current):V=Oe.previous(z.current);var J=de.end(n,V);It.select(n,J)}z.unref(),L.unref(),j.unref()}}})},insertText(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};de.withoutNormalizing(n,()=>{var{voids:o=!1}=t,{at:i=n.selection}=t;if(i){if(Oe.isPath(i)&&(i=de.range(n,i)),rt.isRange(i))if(rt.isCollapsed(i))i=i.anchor;else{var r=rt.end(i);if(!o&&de.void(n,{at:r}))return;var s=rt.start(i),a=de.pointRef(n,s);It.delete(n,{at:i,voids:o}),i=a.unref(),It.setSelection(n,{anchor:i,focus:i})}if(!(!o&&de.void(n,{at:i}))){var{path:l,offset:d}=i;e.length>0&&n.apply({type:"insert_text",path:l,offset:d,text:e})}}})}};function Sf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function ol(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sf(Object(t),!0).forEach(function(o){Ui(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Sf(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var It=ol(ol(ol(ol({},f7),_7),m7),y7);const b7={class:"editor-box"},x7={class:"field-list-item"},w7={class:"field-label"},C7={class:"field-type"},k7={__name:"draft-news-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(!1),s=Lp(),a=Lp(null),l=X("default"),d=X(""),c=X({excludeKeys:["insertTable","codeBlock","uploadVideo","group-video"]}),p={placeholder:"请输入内容，键入“/”可以插入变量",MENU_CONF:{uploadImage:{async customUpload(D,N){var L;const F=await zm(D),Y=await Ho({name:"official_draft",action:"default/exec",params:JSON.stringify({business:"upload_image",arguments:{...i.appData,media:F}})});N((L=Y==null?void 0:Y.data)==null?void 0:L.url)}}}},f=X(!1),h=X({});X([]);const v=X([]),y=X([]),g=X(new Set);Wn(()=>{const D=s.value;D!=null&&D.destroy()});function _(D="",N=[]){b(D,N),r.value=!0}function b(D,N){let F=qm(i.variableOptions);y.value=N,v.value=[...N,...F].filter(L=>L&&L.value&&L.value!=""&&L.typ!=="node");const Y=new Set;for(let L of v.value)D=C(D,L,Y);d.value=D}function C(D,N,F){const Y=new RegExp(`(${N.value})`,"g");if(!F.has(N.value)&&Y.test(D)){let L=N.node_name+"."+N.text;L=L.replace(/\./g,"/"),D=D.replace(Y,`<a href="zm-variable:${N.value}" target="_blank"><strong>${L}</strong></a>`),F.add(N.value)}return D}function T(D){s.value=D}function M(D){const{selection:N}=D;if(!N||!rt.isCollapsed(N)){f.value=!1;return}const F=N.focus.path,Y=N.focus.offset;de.string(D,F)[Y-1]==="/"?(a.value=D,f.value=!0,k()):f.value=!1}function S(){const D=window.getSelection();if(!D||D.rangeCount===0)return null;const N=D.getRangeAt(0);if(!N.collapsed)return null;let F=N.getClientRects()[0];if(F)return F;const Y=document.createElement("span");return Y.textContent="​",Y.style.display="inline-block",N.insertNode(Y),F=Y.getBoundingClientRect(),Y.remove(),F}function k(D){const N=S();if(!N)return;const F=N.left+window.scrollX,Y=N.bottom+window.scrollY+6;h.value=`left:${F}px; top:${Y}px;`}function A(D,N,F){let Y=F[F.length-1];delete Y.children,$(Y)}function $(D,N=!1){if(!D)return;f.value=!1;let F=D.node_name+"."+D.text;F=F.replace(/\./g,"/");const Y={id:D.id,label:D.label,value:D.value,text:D.text,index:y.value.length};y.value.push(D);const L=new Set(g.value);L.add(D.value),g.value=L,N||B(F,Y)}function B(D,N){const F=a.value,{selection:Y}=F;Y&&(rt.isCollapsed(Y)||de.deleteFragment(F),de.deleteBackward(F,"character"),de.insertNode(F,{type:"link",url:`zm-variable:${N.value}`,children:[{text:D,bold:!0}]}),de.insertText(F," "))}function O(D,N){const F=h.value.match(/left:\s*(-?\d+\.?\d*)px/),Y=h.value.match(/top:\s*(-?\d+\.?\d*)px/);if(!F||!Y)return;const L=parseFloat(F[1]),j=parseFloat(Y[1]);let le;D==="left"?le=L-N:le=L+N,h.value=`left:${le}px; top:${j}px;`}function P(D){if(typeof D!="string")return"";const N=D.match(/^<div[^>]*class=["'][^"']*\bzm-editor-root\b[^"']*["'][^>]*>([\s\S]*)<\/div>$/);return N?N[1]:D}function E(){let D=Xn(d.value),N={};y.value.forEach(Y=>{!N[Y.value]&&D.indexOf(Y.value)>-1&&(N[Y.value]=Y)});let F=Object.values(N);D=P(D),D=D.replace(/<a[^>]*href="zm-variable:([^"]+)"[^>]*>[\s\S]*?<\/a>/g,"$1"),o("change",D,Xn(F)),r.value=!1}return e({show:_}),(D,N)=>{const F=sr,Y=_n;return w(),Q(Y,{title:"正文内容",width:"880px",open:r.value,"onUpdate:open":N[1]||(N[1]=L=>r.value=L),onOk:E},{default:x(()=>[m(F,{type:"info",class:"zm-alert-info"},{message:x(()=>[...N[2]||(N[2]=[U(' 图文消息的具体内容，支持HTML标签，必须少于2万字符，小于1M，且此处会去除JS,涉及图片url必须来源 "上传图文消息内的图片获取URL"接口获取。外部图片url将被过滤。 图片消息则仅支持纯文本和部分特殊功能标签如商品，商品个数不可超过50个 ',-1)])]),_:1}),u("div",b7,[m(K(yC),{style:{"border-bottom":"1px solid #ccc"},editor:s.value,defaultConfig:c.value,mode:l.value},null,8,["editor","defaultConfig","mode"]),m(K(bC),{style:{height:"480px","overflow-y":"hidden"},modelValue:d.value,"onUpdate:modelValue":N[0]||(N[0]=L=>d.value=L),defaultConfig:p,mode:l.value,onOnCreated:T,onOnChange:M},null,8,["modelValue","mode"])]),f.value?(w(),R("div",{key:0,style:Fn(h.value),class:"dropdown-list",ref:"dropdownList"},[m(C_,{options:n.variableOptions,onChange:A,onDirectionChange:O},{option:x(({label:L,payload:j})=>[u("div",x7,[u("div",w7,H(L),1),u("div",C7,H(j.typ),1)])]),_:1},8,["options"])],4)):ne("",!0)]),_:1},8,["open"])}}},S7=Ne(k7,[["__scopeId","data-v-1306ac74"]]),E7={class:"field-list-item"},A7={class:"field-label"},D7={class:"field-type"},O7={__name:"draft-newspic-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=X(""),s=X([]);function a(c="",p=[]){r.value=c,s.value=p,i.value=!0}function l(c,p){r.value=c,s.value=p}function d(){o("change",Xn(r.value),Xn(s.value)),i.value=!1}return e({show:a}),(c,p)=>{const f=sr,h=_n;return w(),Q(h,{title:"正文内容",width:"880px",open:i.value,"onUpdate:open":p[1]||(p[1]=v=>i.value=v),onOk:d},{default:x(()=>[m(f,{type:"info",class:"zm-alert-info"},{message:x(()=>[...p[2]||(p[2]=[U(' 图文消息的具体内容，支持HTML标签，必须少于2万字符，小于1M，且此处会去除JS,涉及图片url必须来源 "上传图文消息内的图片获取URL"接口获取。外部图片url将被过滤。 图片消息则仅支持纯文本和部分特殊功能标签如商品，商品个数不可超过50个 ',-1)])]),_:1}),m(tt,{style:{"margin-top":"16px"},type:"textarea",inputStyle:"height: 420px;",options:n.variableOptions,defaultSelectedList:s.value||[],defaultValue:r.value,ref:"atInputRef",onOpen:p[0]||(p[0]=v=>o("updateVar")),onChange:l,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:v,payload:y})=>[u("div",E7,[u("div",A7,H(v),1),u("div",D7,H(y.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1},8,["open"])}}},N7={class:"article-container"},M7={class:"node-options"},T7={class:"options-item is-required"},$7={class:"options-item is-required"},R7={class:"node-options article-form-box"},P7={key:0,class:"options-item"},L7={class:"news-tabs"},B7=["onClick"],I7={class:"options-item baseline is-required"},j7={style:{width:"100%"}},F7={class:"field-list-item"},V7={class:"field-label"},H7={class:"field-type"},U7={class:"options-item baseline is-required"},z7={class:"field-list-item"},q7={class:"field-label"},G7={class:"field-type"},X7={class:"options-item is-required"},W7={class:"field-list-item"},Y7={class:"field-label"},J7={class:"field-type"},K7={class:"options-item"},Z7={class:"field-list-item"},Q7={class:"field-label"},eI={class:"field-type"},tI={class:"options-item"},nI={class:"field-list-item"},oI={class:"field-label"},iI={class:"field-type"},rI={class:"options-item is-required"},sI={class:"cont-box"},aI={class:"field-list-item"},lI={class:"field-label"},uI={class:"field-type"},dI={class:"options-item"},cI={class:"field-list-item"},pI={class:"field-label"},fI={class:"field-type"},hI={class:"options-item is-required baseline"},vI={style:{flex:"1"}},_I={class:"field-list-item"},gI={class:"field-label"},mI={class:"field-type"},yI={class:"options-item"},bI={class:"options-item"},xI={class:"options-item is-required baseline"},wI={class:"img-box"},CI={class:"field-list-item"},kI={class:"field-label"},SI={class:"field-type"},EI={class:"options-item baseline"},AI={class:"img-box"},DI={class:"field-list-item"},OI={class:"field-label"},NI={class:"field-type"},MI={class:"node-options"},TI={class:"options-item"},$I={__name:"official-draft-store",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=Ve("setData"),r=X(null),s=X([]),a=X([]),l={title:"",article_type:"",author:"",digest:"",content:"",content_source_url:"",need_open_comment:0,only_fans_can_comment:0,pic_crop_235_1:"",pic_crop_1_1:"",thumb_type:1,thumb_media_id:"",image_info:[{value:"",tags:[]}],product_info:[{value:"",tags:[]}],cover_info:[{value:"",tags:[]}],tag_map:{}},d=Je({app_id:void 0,app_secret:"",app_name:"",article_type:"news",articles:[],media_id:"",index:0,tag_map:{}}),c=X(0),p=We(()=>d.articles[c.value]||l),f=[{label:"素材url",value:1},{label:"素材MedialD",value:2}],h=[{label:"关闭",value:0},{label:"打开",value:1}],v=[{label:"所有人可评论",value:0},{label:"粉丝才可评论",value:1}];at(()=>{y()}),ct(()=>o.action,()=>{var N;s.value=Di(JSON.parse(JSON.stringify(((N=o.action)==null?void 0:N.output)||"{}")))},{deep:!0,immediate:!0});function y(){g(),B(),_()}function g(){Ir({app_type:"official_account"}).then(N=>{a.value=(N==null?void 0:N.data)||[]})}function _(){var Y,L;let N=JSON.parse(o.node.node_params),F=((L=(Y=N==null?void 0:N.plugin)==null?void 0:Y.params)==null?void 0:L.arguments)||{};if(o.actionName==="update_draft"&&F.articles&&Object.keys(F.articles).length&&(F.articles=[F.articles]),Object.assign(d,F),!d.app_id){let j=Fo(window.localStorage.getItem("zm:ai:draft:last:app"));j&&(Object.assign(d,j),D())}}function b(N,F){const{key:Y,secret:L,name:j}=F;d.app_secret=L,d.app_name=j,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:Y,app_secret:L,app_name:j})),D()}function C(){d.articles=[],B()}function T(N,F){c.value=F}function M(N,F,Y){d[N]=F,d.tag_map[N]=Y,D()}function S(N,F,Y){p.value[N]=F,p.value.tag_map[N]=Y,D()}function k(N,F,Y){N.value=F,N.tags=Y,D()}function A(){r.value.show(p.value.content,p.value.tag_map.content||[])}function $(N,F){p.value.content=N,p.value.tag_map.content=F||[],D()}function B(){let N=JSON.parse(JSON.stringify(l));N.article_type=d.article_type,d.articles.push(N)}function O(N){d.articles.splice(N,1),D()}function P(N){d.articles[c.value][N].push({value:"",tags:[]})}function E(N,F){d.articles[c.value][N].splice(F,1)}function D(){Tt(()=>{let N=JSON.parse(o.node.node_params);N.plugin.output_obj=s.value;let F={...d};o.actionName==="update_draft"&&(F.articles=F.articles[0]),Object.assign(N.plugin.params,{arguments:{...F}}),i({...o.node,node_params:JSON.stringify(N)})})}return(N,F)=>{var J,oe,W,q,re,ue,xe,Te;const Y=Lt,L=$t,j=ro,le=io,z=Zt,V=Xt;return w(),R("div",N7,[u("div",M7,[F[29]||(F[29]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:$_,class:"title-icon"}),U(" 基础信息")])],-1)),u("div",T7,[F[25]||(F[25]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"公众号")],-1)),u("div",null,[m(L,{value:d.app_id,"onUpdate:value":F[0]||(F[0]=me=>d.app_id=me),placeholder:"请选择公众号",style:{width:"100%"},onChange:b},{default:x(()=>[(w(!0),R(se,null,ge(a.value,me=>(w(),Q(Y,{key:me.app_id,name:me.app_name,secret:me.app_secret},{default:x(()=>[U(H(me.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),u("div",$7,[F[28]||(F[28]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"文章类型")],-1)),u("div",null,[m(le,{value:d.article_type,"onUpdate:value":F[1]||(F[1]=me=>d.article_type=me),onChange:C},{default:x(()=>[m(j,{value:"news"},{default:x(()=>[...F[26]||(F[26]=[U("图文消息",-1)])]),_:1}),m(j,{value:"newspic"},{default:x(()=>[...F[27]||(F[27]=[U("图片消息",-1)])]),_:1})]),_:1},8,["value"])])])]),u("div",R7,[F[46]||(F[46]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")]),u("a",{href:"https://developers.weixin.qq.com/doc/subscription/api/draftbox/draftmanage/api_draft_add.html",style:{"font-weight":"400"},target:"_blank"},"查看帮助文档")],-1)),n.actionName==="add_draft"?(w(),R("div",P7,[u("div",L7,[(w(!0),R(se,null,ge(d.articles,(me,pe)=>(w(),R("div",{key:pe,class:xt(["news-item",{active:pe==c.value}]),onClick:Ge=>T(me,pe)},[U(H(pe==0?"主图文":`副图文${pe}`)+" ",1),d.articles.length>1?(w(),Q(K(i_),{key:0,class:"del-icon",onClick:Ct(Ge=>O(pe),["stop"])},null,8,["onClick"])):ne("",!0)],10,B7))),128)),d.articles.length<8?(w(),R("div",{key:0,class:"news-item",onClick:B},[m(K(Mt))])):ne("",!0)])])):(w(),R(se,{key:1},[u("div",I7,[F[31]||(F[31]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"文章ID")],-1)),u("div",j7,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((J=d.tag_map)==null?void 0:J.media_id)||[],defaultValue:d.media_id,ref:"atInputRef",onOpen:F[2]||(F[2]=me=>t("updateVar")),onChange:F[3]||(F[3]=(me,pe)=>M("media_id",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",F7,[u("div",V7,H(me),1),u("div",H7,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),F[30]||(F[30]=u("div",{class:"desc"},"文章media_id",-1))])]),u("div",U7,[F[33]||(F[33]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"文章位置")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((oe=d.tag_map)==null?void 0:oe.index)||[],defaultValue:d.index,ref:"atInputRef",onOpen:F[4]||(F[4]=me=>t("updateVar")),onChange:F[5]||(F[5]=(me,pe)=>M("index",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",z7,[u("div",q7,H(me),1),u("div",G7,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),F[32]||(F[32]=u("div",{class:"desc"},"要更新的文章在图文消息中的位置（多图文消息时，此字段才有意义），第一篇为0（输入0~7的正整数）",-1))])])],64)),u("div",X7,[F[34]||(F[34]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"标题")],-1)),m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((W=p.value.tag_map)==null?void 0:W.title)||[],defaultValue:p.value.title,ref:"atInputRef",onOpen:F[6]||(F[6]=me=>t("updateVar")),onChange:F[7]||(F[7]=(me,pe)=>S("title",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",W7,[u("div",Y7,H(me),1),u("div",J7,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),p.value.article_type==="news"?(w(),R(se,{key:2},[u("div",K7,[F[35]||(F[35]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"作者")],-1)),m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((q=p.value.tag_map)==null?void 0:q.author)||[],defaultValue:p.value.author,ref:"atInputRef",onOpen:F[8]||(F[8]=me=>t("updateVar")),onChange:F[9]||(F[9]=(me,pe)=>S("author",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",Z7,[u("div",Q7,H(me),1),u("div",eI,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),u("div",tI,[F[36]||(F[36]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"摘要")],-1)),m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((re=p.value.tag_map)==null?void 0:re.digest)||[],defaultValue:p.value.digest,ref:"atInputRef",onOpen:F[10]||(F[10]=me=>t("updateVar")),onChange:F[11]||(F[11]=(me,pe)=>S("digest",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",nI,[u("div",oI,H(me),1),u("div",iI,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])],64)):ne("",!0),u("div",rI,[F[37]||(F[37]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"正文内容")],-1)),u("div",sI,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ue=p.value.tag_map)==null?void 0:ue.content)||[],defaultValue:p.value.content,ref:"atInputRef",onOpen:F[12]||(F[12]=me=>t("updateVar")),onChange:F[13]||(F[13]=(me,pe)=>S("content",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",aI,[u("div",lI,H(me),1),u("div",uI,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),m(z,{title:"编辑窗口"},{default:x(()=>[m(K(po),{class:"edit-icon",onClick:A})]),_:1})])]),p.value.article_type==="news"?(w(),R(se,{key:3},[u("div",dI,[F[38]||(F[38]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"原文地址")],-1)),m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((xe=p.value.tag_map)==null?void 0:xe.content_source_url)||[],defaultValue:p.value.content_source_url,ref:"atInputRef",onOpen:F[14]||(F[14]=me=>t("updateVar")),onChange:F[15]||(F[15]=(me,pe)=>S("content_source_url",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",cI,[u("div",pI,H(me),1),u("div",fI,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),u("div",hI,[F[39]||(F[39]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"封面素材")],-1)),u("div",vI,[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Te=p.value.tag_map)==null?void 0:Te.thumb_media_id)||[],defaultValue:p.value.thumb_media_id,ref:"atInputRef",onOpen:F[16]||(F[16]=me=>t("updateVar")),onChange:F[17]||(F[17]=(me,pe)=>S("thumb_media_id",me,pe)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:me,payload:pe})=>[u("div",_I,[u("div",gI,H(me),1),u("div",mI,H(pe.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),m(Mo,{class:"mt4",value:p.value.thumb_type,"onUpdate:value":F[18]||(F[18]=me=>p.value.thumb_type=me),options:f,onChange:D},null,8,["value"])])])],64)):ne("",!0),u("div",yI,[F[40]||(F[40]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"文章评论")],-1)),m(Mo,{value:p.value.need_open_comment,"onUpdate:value":F[19]||(F[19]=me=>p.value.need_open_comment=me),options:h,onChange:D},null,8,["value"])]),u("div",bI,[F[41]||(F[41]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"评论人群")],-1)),m(Mo,{value:p.value.only_fans_can_comment,"onUpdate:value":F[20]||(F[20]=me=>p.value.only_fans_can_comment=me),options:v,onChange:D},null,8,["value"])]),p.value.article_type==="news"?(w(),R(se,{key:4},[],64)):(w(),R(se,{key:5},[u("div",xI,[F[43]||(F[43]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"图片")],-1)),u("div",wI,[(w(!0),R(se,null,ge(p.value.image_info,(me,pe)=>(w(),R("div",{key:pe,class:"img-item"},[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:me.tags||[],defaultValue:me.value,ref_for:!0,ref:"atInputRef",onOpen:F[21]||(F[21]=Ge=>t("updateVar")),onChange:(Ge,Le)=>k(me,Ge,Le),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:Ge,payload:Le})=>[u("div",CI,[u("div",kI,H(Ge),1),u("div",SI,H(Le.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),m(K(Ut),{onClick:Ge=>E("image_info",pe)},null,8,["onClick"])]))),128)),p.value.image_info.length<20?(w(),Q(V,{key:0,type:"dashed",icon:St(K(Mt)),onClick:F[22]||(F[22]=me=>P("image_info"))},{default:x(()=>[...F[42]||(F[42]=[U("新增图片 ",-1)])]),_:1},8,["icon"])):ne("",!0)])]),u("div",EI,[F[45]||(F[45]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"封面信息")],-1)),u("div",AI,[(w(!0),R(se,null,ge(p.value.cover_info,(me,pe)=>(w(),R("div",{key:pe,class:"img-item"},[m(tt,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:me.tags||[],defaultValue:me.value,ref_for:!0,ref:"atInputRef",onOpen:F[23]||(F[23]=Ge=>t("updateVar")),onChange:(Ge,Le)=>k(me,Ge,Le),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:Ge,payload:Le})=>[u("div",DI,[u("div",OI,H(Ge),1),u("div",NI,H(Le.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),m(K(Ut),{onClick:Ge=>E("cover_info",pe)},null,8,["onClick"])]))),128)),p.value.cover_info.length<5?(w(),Q(V,{key:0,type:"dashed",icon:St(K(Mt)),onClick:F[24]||(F[24]=me=>P("cover_info"))},{default:x(()=>[...F[44]||(F[44]=[U("新增封面 ",-1)])]),_:1},8,["icon"])):ne("",!0)])])],64))]),u("div",MI,[F[47]||(F[47]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",TI,[m(Oi,{"tree-data":s.value},null,8,["tree-data"])])]),d.article_type==="news"?(w(),Q(S7,{key:0,ref_key:"newsContRef",ref:r,"variable-options":n.variableOptions,appData:{app_id:d.app_id,app_secret:d.app_secret},onChange:$},null,8,["variable-options","appData"])):(w(),Q(O7,{key:1,ref_key:"newsContRef",ref:r,"variable-options":n.variableOptions,onChange:$},null,8,["variable-options"]))])}}},Ef=Ne($I,[["__scopeId","data-v-a576d9ae"]]),RI={class:"options-item is-required"},PI={key:0,class:"desc"},LI={class:"options-item is-required"},qs={__name:"official-draft-operate",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=X({}),r=X([]);at(()=>{a(),s()});function s(){const d={...o.action.params,app_id:{...o.action.params.app_id,default:null},app_name:{desc:"公众号名称",type:"string"}};let c=Fo(window.localStorage.getItem("zm:ai:draft:last:app"));c&&(d.app_id.default=c.app_id,d.app_name.default=c.app_name,d.app_secret.default=c.app_secret),o.actionName==="preview_message"?(d.type={...o.action.params.type,default:"touser"},i.value=zc(d,["app_id","media_id","type","account"])):i.value=d}function a(){Ir({app_type:"official_account"}).then(d=>{r.value=(d==null?void 0:d.data)||[]})}function l(d,c){const{key:p,secret:f,name:h}=c;d.app_secret.value=f,d.app_name.value=h,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:p,app_secret:f,app_name:h}))}return(d,c)=>{const p=Lt,f=$t,h=ro,v=io;return w(),Q(Vu,{node:n.node,params:i.value,output:n.action.output,variableOptions:n.variableOptions,onUpdateVar:c[0]||(c[0]=y=>t("updateVar"))},Zv({app_name:x(()=>[]),app_secret:x(()=>[]),app_id:x(({state:y,item:g,keyName:_})=>[u("div",RI,[c[2]||(c[2]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"公众号")],-1)),u("div",null,[m(f,{value:g.value,"onUpdate:value":b=>g.value=b,placeholder:"请选择公众号",style:{width:"100%"},onChange:(b,C)=>l(y,C)},{default:x(()=>[(w(!0),R(se,null,ge(r.value,b=>(w(),Q(p,{key:b.app_id,value:b.app_id,name:b.app_name,secret:b.app_secret},{default:x(()=>[U(H(b.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),["publish_draft","preview_message"].includes(n.actionName)?(w(),R("div",PI,[m(K(Yc)),c[1]||(c[1]=U(" 暂不支持未认证公众号、服务号 ",-1))])):ne("",!0)])]),_:2},[n.actionName==="preview_message"?{name:"type",fn:x(({state:y,item:g})=>[u("div",LI,[c[5]||(c[5]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"接受消息用户类型")],-1)),u("div",null,[m(v,{value:g.value,"onUpdate:value":_=>g.value=_},{default:x(()=>[m(h,{value:"touser"},{default:x(()=>[...c[3]||(c[3]=[U("公众号用户openid",-1)])]),_:1}),m(h,{value:"towxname"},{default:x(()=>[...c[4]||(c[4]=[U("用户微信号（每日最高100次）",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])])])]),key:"0"}:void 0]),1032,["node","params","output","variableOptions"])}}},BI={__name:"official-draft-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t={add_draft:Ef,update_draft:Ef,delete_draft:qs,publish_draft:qs,preview_message:qs,get_draft:qs},o=e,i=n,r=We(()=>t[i.actionName]||qs);return(s,a)=>(w(),Q(Pu(r.value),{action:n.action,actionName:n.actionName,variableOptions:n.variableOptions,node:n.node,onUpdateVar:a[0]||(a[0]=l=>o("updateVar"))},null,40,["action","actionName","variableOptions","node"]))}},II={class:"field-item"},jI={class:"field-key"},FI={class:"tip-content"},VI={class:"field-type"},HI={class:"field-name"},UI={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=X([]);return(o,i)=>{const r=On,s=Zt,a=Wc;return w(),R("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=Ct(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=Ct(()=>{},["stop"]))},[m(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:x(({switcherCls:l})=>[u("span",{class:xt(l)},[m(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:l})=>[u("div",II,[u("span",jI,H(l.key),1),l.tip?(w(),Q(s,{key:0,overlayStyle:{maxWidth:"800px"}},{title:x(()=>[u("div",FI,H(l.tip),1)]),default:x(()=>[m(K(ft),{style:{"margin-left":"4px"}})]),_:2},1024)):ne("",!0),u("span",VI,H(l.typ),1),u("span",HI,H(l.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},zI=Ne(UI,[["__scopeId","data-v-d58d8a03"]]),qI={class:"options-item-tit"},GI={class:"option-label"},XI=["onClick"],WI={class:"tip-content"},YI={class:"option-type"},JI={key:1,style:{"margin-left":"auto","margin-bottom":"4px"}},KI={key:0},ZI={class:"desc"},QI={key:0,class:"desc",style:{color:"#FB363F"}},e9={key:1},t9={class:"desc"},n9={key:0,class:"desc",style:{color:"#FB363F"}},o9={key:2},i9={class:"desc"},r9={key:0,class:"desc",style:{color:"#FB363F"}},s9={key:3},a9={class:"desc"},l9={key:0,class:"desc",style:{color:"#FB363F"}},u9={key:4},d9={class:"tag-box"},c9={class:"field-list-item"},p9={class:"field-label"},f9={class:"field-type"},h9={class:"field-list-item"},v9={class:"field-label"},_9={class:"field-type"},g9={class:"desc"},m9={key:0,class:"desc",style:{color:"#FB363F"}},y9={key:5},b9={class:"tag-box"},x9={class:"field-list-item"},w9={class:"field-label"},C9={class:"field-type"},k9={class:"desc"},S9={key:0,class:"desc",style:{color:"#FB363F"}},E9={key:6},A9={class:"field-list-item"},D9={class:"field-label"},O9={class:"field-type"},N9={class:"desc"},M9={key:0,class:"desc",style:{color:"#FB363F"}},T9={__name:"field-list",props:{items:{type:Array,default:()=>[]},formState:{type:Object,default:()=>({})},errors:{type:Object,default:()=>({})},apps:{type:Array,default:()=>[]},variableOptions:{type:Array,default:()=>[]},tagTypes:{type:Object,default:()=>({})},tagLists:{type:Object,default:()=>({})},showTagComponents:{type:Boolean,default:!1},sortedEnum:{type:Function},appChange:{type:Function},update:{type:Function},onFieldChange:{type:Function},onChangeDynamic:{type:Function},filterOption:{type:Function},tagTypeChange:{type:Function},tagChange:{type:Function},syncFieldTags:{type:Function},syncingTags:{type:Object,default:()=>({})},dateRangeTypes:{type:Object,default:()=>({})},dateRangeTypeChange:{type:Function},getRangeValue:{type:Function},onDateRangeCalendarChange:{type:Function},onDateRangeChange:{type:Function},getDisabledDateForRange:{type:Function},onOpenVar:{type:Function},onToggleAdvanced:{type:Function}},setup(n){const e=[{label:"开启",value:"true"},{label:"关闭",value:"false"}];return(t,o)=>{const i=ho,r=Zt,s=Lt,a=$t,l=ro,d=io,c=cy;return w(!0),R(se,null,ge(n.items,p=>{var f,h,v,y,g,_,b,C,T,M,S,k,A,$,B,O,P,E,D,N,F,Y,L,j,le,z,V,J,oe;return w(),R("div",{key:p.key,class:xt(["options-item",{"is-required":(f=p.meta)==null?void 0:f.required}])},[u("div",qI,[u("div",GI,[U(H(((h=p.meta)==null?void 0:h.name)||p.key)+" ",1),(v=p.meta)!=null&&v.tag_component?(w(),Q(r,{key:0,title:"同步最新的标签",overlayStyle:{maxWidth:"600px"},placement:"top"},{default:x(()=>[u("a",{onClick:W=>n.syncFieldTags&&n.syncFieldTags(p.key,p.meta)},[o[6]||(o[6]=U(" 同步 ",-1)),n.syncingTags&&n.syncingTags[p.key]?(w(),Q(i,{key:0,size:"small"})):ne("",!0)],8,XI)]),_:2},1024)):ne("",!0),(y=p.meta)!=null&&y.tip?(w(),Q(r,{key:1,overlayStyle:{maxWidth:"600px"},placement:"top"},{title:x(()=>{var W;return[u("div",WI,H((W=p.meta)==null?void 0:W.tip),1)]}),default:x(()=>[m(K(ft))]),_:2},1024)):ne("",!0)]),u("div",YI,H(((g=p.meta)==null?void 0:g.type)||"string"),1),(_=p.meta)!=null&&_.switch_component?(w(),Q(Mo,{key:0,style:{"margin-left":"8px"},value:String(n.formState[p.key]||"").toLowerCase()==="true"?"true":"false",options:e,onChange:W=>{n.onFieldChange&&n.onFieldChange(p.key,W),n.update&&n.update()}},null,8,["value","onChange"])):ne("",!0),(b=p.meta)!=null&&b.show_advanced_settings_icon?(w(),R("div",JI,[m(r,{title:"高级设置"},{default:x(()=>[u("span",{onClick:o[0]||(o[0]=W=>n.onToggleAdvanced&&n.onToggleAdvanced()),style:{color:"#2475FC",padding:"4px 8px",borderRadius:"24px",border:"1px solid #D9D9D9",background:"#E5EFFF",cursor:"pointer"}},[m(K(Gc))])]),_:1})])):ne("",!0)]),(C=p.meta)!=null&&C.select_official_component?(w(),R("div",KI,[m(a,{value:n.formState.app_id,placeholder:"请选择公众号",style:{width:"100%"},onChange:o[1]||(o[1]=(W,q)=>{n.onFieldChange&&n.onFieldChange("app_id",W),n.appChange&&n.appChange(W,q)})},{default:x(()=>[(w(!0),R(se,null,ge(n.apps,W=>(w(),Q(s,{key:W.app_id,value:W.app_id,name:W.app_name,app_secret:W.app_secret},{default:x(()=>[U(H(W.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value"]),u("div",ZI,H((T=p.meta)==null?void 0:T.desc),1),n.errors[p.key]?(w(),R("div",QI,H(n.errors[p.key]),1)):ne("",!0)])):(M=p.meta)!=null&&M.enum_component?(w(),R("div",e9,[m(a,{value:n.formState[p.key],placeholder:(S=p.meta)!=null&&S.required?"请选择":"请选择（非必填）",style:{width:"100%"},onChange:W=>{n.onFieldChange&&n.onFieldChange(p.key,W),n.update&&n.update()}},{default:x(()=>{var W,q;return[(w(!0),R(se,null,ge(n.sortedEnum?n.sortedEnum((W=p.meta)==null?void 0:W.enum):((q=p.meta)==null?void 0:q.enum)||[],re=>(w(),Q(s,{key:re.value,value:re.value},{default:x(()=>[U(H(re.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","placeholder","onChange"]),u("div",t9,H((k=p.meta)==null?void 0:k.desc),1),n.errors[p.key]?(w(),R("div",n9,H(n.errors[p.key]),1)):ne("",!0)])):(A=p.meta)!=null&&A.radio_component?(w(),R("div",o9,[m(d,{value:n.formState[p.key],onChange:W=>{var re;const q=((re=W==null?void 0:W.target)==null?void 0:re.value)??W;n.onFieldChange&&n.onFieldChange(p.key,q),n.update&&n.update()}},{default:x(()=>{var W,q;return[(w(!0),R(se,null,ge(n.sortedEnum?n.sortedEnum((W=p.meta)==null?void 0:W.enum):((q=p.meta)==null?void 0:q.enum)||[],re=>(w(),Q(l,{key:re.value,value:re.value},{default:x(()=>[U(H(re.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","onChange"]),u("div",i9,H(($=p.meta)==null?void 0:$.desc),1),n.errors[p.key]?(w(),R("div",r9,H(n.errors[p.key]),1)):ne("",!0)])):(B=p.meta)!=null&&B.switch_component?(w(),R("div",s9,[u("div",a9,H((O=p.meta)==null?void 0:O.desc),1),n.errors[p.key]?(w(),R("div",l9,H(n.errors[p.key]),1)):ne("",!0)])):(P=p.meta)!=null&&P.date_range_begin_component?(w(),R("div",u9,[u("div",d9,[m(a,{value:n.dateRangeTypes[(E=p.meta)==null?void 0:E.begin_date_key],onChange:W=>n.dateRangeTypeChange&&n.dateRangeTypeChange(p.meta,W),style:{width:"120px","padding-right":"4px"}},{default:x(()=>[m(s,{value:1},{default:x(()=>[...o[7]||(o[7]=[U("选择日期",-1)])]),_:1}),m(s,{value:2},{default:x(()=>[...o[8]||(o[8]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value","onChange"]),n.dateRangeTypes[(D=p.meta)==null?void 0:D.begin_date_key]==1?(w(),Q(c,{key:0,value:n.getRangeValue?n.getRangeValue(p.meta):null,format:"YYYY-MM-DD",style:{width:"100%"},onCalendarChange:W=>n.onDateRangeCalendarChange&&n.onDateRangeCalendarChange(p.meta,W),onChange:(W,q)=>n.onDateRangeChange&&n.onDateRangeChange(p.meta,W,q),"disabled-date":W=>n.getDisabledDateForRange?n.getDisabledDateForRange(p.meta,W):!1},null,8,["value","onCalendarChange","onChange","disabled-date"])):(w(),R(se,{key:1},[m(tt,{inputStyle:"height: 33px; width: 214px;",options:n.variableOptions,defaultSelectedList:n.formState[(((N=p.meta)==null?void 0:N.begin_date_key)||"")+"_tags"]||[],defaultValue:n.formState[(F=p.meta)==null?void 0:F.begin_date_key]||"",onOpen:o[2]||(o[2]=W=>n.onOpenVar&&n.onOpenVar()),onChange:(W,q)=>{var re;return n.onChangeDynamic&&n.onChangeDynamic((re=p.meta)==null?void 0:re.begin_date_key,W,q)},placeholder:"请输入开始日期，键入“/”可以插入变量"},{option:x(({label:W,payload:q})=>[u("div",c9,[u("div",p9,H(W),1),u("div",f9,H(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),o[9]||(o[9]=u("div",{class:"date-range-separator"},"-",-1)),m(tt,{inputStyle:"height: 33px; width: 214px;",options:n.variableOptions,defaultSelectedList:n.formState[(((Y=p.meta)==null?void 0:Y.end_date_key)||"")+"_tags"]||[],defaultValue:n.formState[(L=p.meta)==null?void 0:L.end_date_key]||"",onOpen:o[3]||(o[3]=W=>n.onOpenVar&&n.onOpenVar()),onChange:(W,q)=>{var re;return n.onChangeDynamic&&n.onChangeDynamic((re=p.meta)==null?void 0:re.end_date_key,W,q)},placeholder:"请输入结束日期，键入“/”可以插入变量"},{option:x(({label:W,payload:q})=>[u("div",h9,[u("div",v9,H(W),1),u("div",_9,H(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])],64))]),u("div",g9,H((j=p.meta)==null?void 0:j.desc),1),n.errors[p.key]?(w(),R("div",m9,H(n.errors[p.key]),1)):ne("",!0)])):(le=p.meta)!=null&&le.tag_component&&n.showTagComponents?(w(),R("div",y9,[u("div",b9,[m(a,{value:n.tagTypes[p.key],onChange:W=>n.tagTypeChange&&n.tagTypeChange(p.key,W,p.meta),style:{width:"120px"}},{default:x(()=>[m(s,{value:1},{default:x(()=>[...o[10]||(o[10]=[U("选择标签",-1)])]),_:1}),m(s,{value:2},{default:x(()=>[...o[11]||(o[11]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value","onChange"]),n.tagTypes[p.key]==1?(w(),Q(a,{key:0,value:n.formState[p.key],placeholder:"请选择标签",style:{width:"100%"},onChange:(W,q)=>n.tagChange&&n.tagChange(p.key,W,q),"show-search":"","filter-option":n.filterOption},{default:x(()=>[(w(!0),R(se,null,ge(n.tagLists[p.key]||[],W=>(w(),Q(s,{key:W.id,value:W.id,name:W.name},{default:x(()=>[U(H(W.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onChange","filter-option"])):(w(),Q(tt,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:n.formState[p.key+"_tags"]||[],defaultValue:n.formState[p.key]||"",onOpen:o[4]||(o[4]=W=>n.onOpenVar&&n.onOpenVar()),onChange:(W,q)=>n.onChangeDynamic&&n.onChangeDynamic(p.key,W,q),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:W,payload:q})=>[u("div",x9,[u("div",w9,H(W),1),u("div",C9,H(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]))]),u("div",k9,H((z=p.meta)==null?void 0:z.desc),1),n.errors[p.key]?(w(),R("div",S9,H(n.errors[p.key]),1)):ne("",!0)])):(w(),R("div",E9,[m(tt,{type:((V=p.meta)==null?void 0:V.in)==="body"?"textarea":void 0,inputStyle:((J=p.meta)==null?void 0:J.in)==="body"?"height: 64px;":void 0,options:n.variableOptions,defaultSelectedList:n.formState[p.key+"_tags"]||[],defaultValue:n.formState[p.key]||"",onOpen:o[5]||(o[5]=W=>n.onOpenVar&&n.onOpenVar()),onChange:(W,q)=>n.onChangeDynamic&&n.onChangeDynamic(p.key,W,q),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:W,payload:q})=>[u("div",A9,[u("div",D9,H(W),1),u("div",O9,H(q.typ),1)])]),_:1},8,["type","inputStyle","options","defaultSelectedList","defaultValue","onChange"]),u("div",N9,H((oe=p.meta)==null?void 0:oe.desc),1),n.errors[p.key]?(w(),R("div",M9,H(n.errors[p.key]),1)):ne("",!0)]))],2)}),128)}}},dd=Ne(T9,[["__scopeId","data-v-266a6761"]]),$9={class:"main-box"},R9={key:0,class:"loading-box"},P9={key:1,class:"node-options"},L9={class:"options-title"},B9={key:0,class:"acton-box"},I9=["href"],j9={class:"node-options"},F9={class:"options-title"},V9={class:"node-options"},H9={class:"options-item"},U9={__name:"dynamic-api-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=Ve("setData"),r=Ms();let s="";const a=We(()=>(f.value||[]).some(ce=>{var Ce;const ve=(Ce=ce.meta)==null?void 0:Ce.setting_cache_component;return ve===!0||ve===1||ve==="true"||ve==="1"})),l=We(()=>String(v.click_url||"").trim()),d=We(()=>String(v.click_title||"").trim()),c=We(()=>{var ce;return((ce=o.action)==null?void 0:ce.params)||{}}),p=We(()=>!!(c.value.app_id&&c.value.app_secret)),f=We(()=>Object.entries(c.value||{}).map(([ve,Ce])=>({key:ve,meta:Ce})).filter(ve=>{var Ce;return!((Ce=ve.meta)!=null&&Ce.hide_official_component)}).sort((ve,Ce)=>{var Se,Fe;return+(((Se=ve.meta)==null?void 0:Se.sort_num)||0)-+(((Fe=Ce.meta)==null?void 0:Fe.sort_num)||0)}));function h(ce){return(ce||[]).slice().sort((ve,Ce)=>+(ve.sort_num||0)-+(Ce.sort_num||0))}const v=Je({app_id:"",app_secret:"",app_name:""}),y=X(!1),g=X(!1),_=X([]),b=Je({}),C=X([]),T=Je({}),M=Je({}),S=Je({}),k=Je({}),A=Je({}),$=X(null),B=X({}),O=X(null),P=X(!1),E=We(()=>f.value.some(ve=>{var Ce;return(Ce=ve.meta)==null?void 0:Ce.tag_component})?f.value.some(ve=>{const Ce=ve.meta||{},Se=Array.isArray(Ce.enum)?Ce.enum:[];if(!(Ce.enum_component||Ce.radio_component||Ce.switch_component)||Se.length===0)return!1;const Fe=String(v[ve.key]??""),ze=Se.find(lt=>String(lt==null?void 0:lt.value)===Fe),Xe=ze==null?void 0:ze.related_tags;return Xe===!0||Xe===1||Xe==="true"||Xe==="1"}):!1),D=We(()=>(f.value||[]).some(ce=>{var Ce;const ve=(Ce=ce.meta)==null?void 0:Ce.plugin_config_component;return ve===!0||ve===1||ve==="true"||ve==="1"})),N=We(()=>{var Ce;const ce=(Ce=o.action)==null?void 0:Ce.use_advanced_settings,ve=(f.value||[]).some(Se=>{var ze;const Fe=(ze=Se.meta)==null?void 0:ze.advanced_settings;return Fe===!0||Fe===1||Fe==="true"||Fe==="1"});return ce===!0||ce===1||ce==="true"||ce==="1"||ve}),F=We(()=>{const ce=ve=>{const Ce=ve==null?void 0:ve.setting_cache_component;return Ce===!0||Ce===1||Ce==="true"||Ce==="1"};return(f.value||[]).filter(ve=>{var Ce;return!((Ce=ve.meta)!=null&&Ce.tag_component&&!E.value)}).filter(ve=>{var Ce;return!((Ce=ve.meta)!=null&&Ce.plugin_config_component)}).filter(ve=>{var Fe;const Ce=(Fe=ve.meta)==null?void 0:Fe.advanced_settings;return!(Ce===!0||Ce===1||Ce==="true"||Ce==="1")}).filter(ve=>!ce(ve.meta))}),Y=We(()=>(f.value||[]).filter(ce=>{var Ce;const ve=(Ce=ce.meta)==null?void 0:Ce.setting_cache_component;return ve===!0||ve===1||ve==="true"||ve==="1"})),L=We(()=>(f.value||[]).filter(ce=>{var ze,Xe;const ve=(ze=ce.meta)==null?void 0:ze.advanced_settings,Ce=ve===!0||ve===1||ve==="true"||ve==="1",Se=(Xe=ce.meta)==null?void 0:Xe.plugin_config_component;return Ce&&!(Se===!0||Se===1||Se==="true"||Se==="1")}));ct(E,ce=>{if(!ce){let ve=!1;f.value.forEach(Ce=>{var Se;(Se=Ce.meta)!=null&&Se.tag_component&&(v[Ce.key]&&(v[Ce.key]="",ve=!0),Array.isArray(v[Ce.key+"_tags"])&&v[Ce.key+"_tags"].length&&(v[Ce.key+"_tags"]=[],ve=!0))}),ve&&oe()}}),at(()=>{j(),hs({name:"workflow:validate",callback:J})});async function j(){p.value&&await le(),z(),D.value&&await Ue(),f.value.forEach(async ce=>{var Ce,Se,Fe,ze,Xe,lt;const ve=String(((Ce=ce.meta)==null?void 0:Ce.enum_default)||"").trim();((Se=ce.meta)!=null&&Se.radio_component||(Fe=ce.meta)!=null&&Fe.enum_component||(ze=ce.meta)!=null&&ze.switch_component)&&!String(v[ce.key]||"").trim()&&ve&&(v[ce.key]=ve),(Xe=ce.meta)!=null&&Xe.tag_component&&(M[ce.key]=typeof M[ce.key]=="number"?M[ce.key]:1,await De(ce.key,(lt=ce.meta)==null?void 0:lt.query_tag_service))}),xe(),Le()}function le(){return Ir({app_type:"official_account"}).then(ce=>{_.value=(ce==null?void 0:ce.data)||[]})}function z(){var Ce,Se,Fe;let ce=JSON.parse(o.node.node_params);s=((Ce=ce==null?void 0:ce.plugin)==null?void 0:Ce.name)||"";let ve=((Fe=(Se=ce==null?void 0:ce.plugin)==null?void 0:Se.params)==null?void 0:Fe.arguments)||{};f.value.forEach(ze=>{var lt,wt,Yt,zt,gn,yn;v[ze.key]=ze.key!=="app_id"?String(ve[ze.key]||"").trim():ve[ze.key];const Xe=(ve==null?void 0:ve.tag_map)||{};if(v[ze.key+"_tags"]=Array.isArray(Xe[ze.key])?Xe[ze.key]:[],(lt=ze.meta)!=null&&lt.date_range_begin_component){const jt=(wt=ze.meta)==null?void 0:wt.end_date_key,Ee=(Yt=ze.meta)==null?void 0:Yt.date_type_key;v[jt]=String(ve[jt]||"").trim(),v[jt+"_tags"]=Array.isArray(Xe[jt])?Xe[jt]:[];const Ze=ve[Ee];k[(zt=ze.meta)==null?void 0:zt.begin_date_key]=typeof k[(gn=ze.meta)==null?void 0:gn.begin_date_key]=="number"?k[(yn=ze.meta)==null?void 0:yn.begin_date_key]:Ze==null?1:Number(Ze)||1}}),ve.app_secret&&(v.app_secret=String(ve.app_secret)),ve.app_name&&(v.app_name=String(ve.app_name))}function V(ce,ve){ve&&ve.app_secret&&(v.app_secret=ve.app_secret),ve&&ve.name&&(v.app_name=ve.name),oe(),f.value.forEach(async Ce=>{var Se,Fe;(Se=Ce.meta)!=null&&Se.tag_component&&await De(Ce.key,(Fe=Ce.meta)==null?void 0:Fe.query_tag_service)})}function J(){const ce=hs(),ve=_e();ve&&ve.ok===!1&&ce.emit&&ce.emit("workflow:validate:error",{component:"公众号智能API",type:"",typeDisplay:"",message:"请完善字段后再继续",errors:ve.errors||[]})}function oe(ce=null){let ve=JSON.parse(o.node.node_params);ve.plugin.output_obj=C.value;const Ce=Ge();dt(Ce),Object.assign(ve.plugin.params,{arguments:{...Ce,tag_map:{...pe()}},rendering:me()}),D.value&&(ve.plugin.params.config_name=O.value||""),ve.plugin.params.use_plugin_config=!!D.value,i({...o.node,node_params:JSON.stringify(ve)}),Te()}function W(ce,ve,Ce){v[ce]=ve,v[ce+"_tags"]=Ce,oe()}function q(ce,ve){v[ce]=ve,oe()}function re(ce){return String(ce||"").replace(/`/g,"").trim()}function ue(ce){return`${String(r.query.id||"")}:${s}:${ce}`}function xe(){var Ce,Se,Fe;if(!a.value)return;let ce="",ve="";for(const ze of f.value||[]){const Xe=(Ce=ze.meta)==null?void 0:Ce.setting_cache_component;if(!(Xe===!0||Xe===1||Xe==="true"||Xe==="1"))continue;if(!ce){const zt=re((Se=ze.meta)==null?void 0:Se.click_url),gn=re((Fe=ze.meta)==null?void 0:Fe.click_title);zt&&(ce=zt,ve=gn)}const wt=ze.key;if(!String(v[wt]==null?"":v[wt]).trim()){const zt=localStorage.getItem(ue(wt));zt!=null&&(v[wt]=ze.key==="app_id"?zt:String(zt))}}ce&&(v.click_url=ce),ve&&(v.click_title=ve)}function Te(){a.value&&f.value.forEach(ce=>{var ze;const ve=(ze=ce.meta)==null?void 0:ze.setting_cache_component;if(!(ve===!0||ve===1||ve==="true"||ve==="1"))return;const Se=ce.key,Fe=String(v[Se]==null?"":v[Se]);localStorage.setItem(ue(Se),Fe)})}function me(){return f.value.filter(ce=>{var Se,Fe,ze,Xe;if((Se=ce.meta)!=null&&Se.tag_component&&!E.value)return!1;const ve=(Fe=ce.meta)==null?void 0:Fe.setting_cache_component;return!(ve===!0||ve===1||ve==="true"||ve==="1"||(ze=ce.meta)!=null&&ze.plugin_config_component||(Xe=ce.meta)!=null&&Xe.advanced_settings)}).map(ce=>{var Fe,ze,Xe,lt,wt,Yt,zt,gn,yn;let ve=((Fe=ce.meta)==null?void 0:Fe.name)||ce.key,Ce=String(v[ce.key]??"");const Se=Array.isArray(v[ce.key+"_tags"])?v[ce.key+"_tags"]:[];if(ce.key==="app_id"&&(ve="公众号名称",Ce=String(v.app_name??"")),(ze=ce.meta)!=null&&ze.enum_component||(Xe=ce.meta)!=null&&Xe.radio_component||(lt=ce.meta)!=null&&lt.switch_component){const jt=(((wt=ce.meta)==null?void 0:wt.enum)||[]).find(Ee=>String(Ee==null?void 0:Ee.value)===Ce);jt&&jt.name&&(Ce=String(jt.name))}if((Yt=ce.meta)!=null&&Yt.tag_component&&M[ce.key]==1){const jt=(T[ce.key]||[]).find(Ee=>String(Ee.id)===String(Ce));jt&&jt.name&&(Ce=String(jt.name))}if((zt=ce.meta)!=null&&zt.date_range_begin_component){const jt=(gn=ce.meta)==null?void 0:gn.begin_date_key,Ee=(yn=ce.meta)==null?void 0:yn.end_date_key,Ze=String(v[jt]||""),we=String(v[Ee]||""),Be=Array.isArray(v[jt+"_tags"])?v[jt+"_tags"]:[],Qe=Array.isArray(v[Ee+"_tags"])?v[Ee+"_tags"]:[];Ce=[Ze,we].filter(Boolean).join(" ~ ");const qe=[...Be,...Qe];return{label:ve,value:Ce,key:ce.key,tags:qe}}return{label:ve,value:Ce,key:ce.key,tags:Se}})}function pe(){const ce={};return f.value.forEach(ve=>{var Se,Fe,ze,Xe;if((Se=ve.meta)!=null&&Se.plugin_config_component||(Fe=ve.meta)!=null&&Fe.tag_component&&!E.value)return;const Ce=Array.isArray(v[ve.key+"_tags"])?v[ve.key+"_tags"]:[];if(Ce.length&&(ce[ve.key]=Ce),(ze=ve.meta)!=null&&ze.date_range_begin_component){const lt=(Xe=ve.meta)==null?void 0:Xe.end_date_key,wt=Array.isArray(v[lt+"_tags"])?v[lt+"_tags"]:[];wt.length&&(ce[lt]=wt)}}),ce}function Ge(){const ce={};return f.value.forEach(ve=>{var Ce,Se,Fe,ze,Xe,lt;if(!((Ce=ve.meta)!=null&&Ce.plugin_config_component)&&!((Se=ve.meta)!=null&&Se.tag_component&&!E.value)&&(ce[ve.key]=String(v[ve.key]||""),(Fe=ve.meta)!=null&&Fe.date_range_begin_component)){const wt=(ze=ve.meta)==null?void 0:ze.end_date_key,Yt=(Xe=ve.meta)==null?void 0:Xe.date_type_key;ce[wt]=String(v[wt]||"");const zt=k[(lt=ve.meta)==null?void 0:lt.begin_date_key]||1;ce[Yt]=String(zt)}}),v.app_secret&&(ce.app_secret=String(v.app_secret||"")),v.app_name&&(ce.app_name=String(v.app_name||"")),ce}function Le(){C.value=Di(o.action.output),oe()}function _e(){Object.keys(b).forEach(ve=>{b[ve]=""});const ce={ok:!0,errors:[]};return f.value.forEach(ve=>{const Ce=ve.key,Se=ve.meta||{},Fe=v[Ce],ze=String(Fe??"").trim(),Xe=Array.isArray(v[Ce+"_tags"])?v[Ce+"_tags"]:[];if(!Se.plugin_config_component){if(Se.select_official_component){if(Se.required&&!ze){const lt=Se.error||"请选择公众号";b[Ce]=lt,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:lt})}return}if(Se.enum_component||Se.radio_component||Se.switch_component){const lt=(Se.enum||[]).map(wt=>String(wt.value));if(Se.required&&!ze){const wt=Se.error||"请选择";b[Ce]=wt,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:wt})}else if(ze&&lt.length&&!lt.includes(ze)){const wt=Se.error||"选择不合法";b[Ce]=wt,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:wt})}return}if(Se.date_range_begin_component){const lt=Se.begin_date_key,wt=Se.end_date_key,Yt=String(v[lt]||"").trim(),zt=String(v[wt]||"").trim(),gn=Array.isArray(v[lt+"_tags"])?v[lt+"_tags"]:[],yn=Array.isArray(v[wt+"_tags"])?v[wt+"_tags"]:[];if(Se.required&&(!Yt&&gn.length===0||!zt&&yn.length===0)){const Ee=Se.error||"请选择起止时间";b[Ce]=Ee,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:Ee});return}if(k[lt]===2){const Ee=Ze=>/^\d{4}-\d{2}-\d{2}$/.test(Ze)?yo(Ze).isValid():!1;if(Yt&&gn.length===0&&!Ee(Yt)){const Ze=Se.error||"开始日期格式需为YYYY-MM-DD";b[Ce]=Ze,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:Ze});return}if(zt&&yn.length===0&&!Ee(zt)){const Ze=Se.error||"结束日期格式需为YYYY-MM-DD";b[Ce]=Ze,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:Ze});return}}if(Yt&&zt){const Ee=yo(Yt),Ze=yo(zt);if(Ze.isBefore(Ee)){const Qe=Se.error||"结束时间不能早于开始时间";b[Ce]=Qe,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:Qe});return}const we=Ze.diff(Ee,"day"),Be=Number(Se.date_range_max_interval||0);if(Be>0&&we+1>Be){const Qe=Se.error||`时间跨度不能超过${Be}天`;b[Ce]=Qe,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:Qe});return}}return}if(Se.required&&!ze&&(!Array.isArray(Xe)||Xe.length===0)){const lt=Se.error||"请输入内容";b[Ce]=lt,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:lt})}else if(Ce.toLowerCase().includes("url")&&ze&&(!Array.isArray(Xe)||Xe.length===0)&&!(/^https?:\/\//.test(ze)||Fd(ze))){const wt=Se.error||"请输入正确的URL";b[Ce]=wt,ce.ok=!1,ce.errors.push({field_name:Se.name||Ce,message:wt})}}}),ce}function he(ce,ve,Ce){M[ce]=ve,ve==1&&De(ce,Ce==null?void 0:Ce.query_tag_service)}function be(ce,ve,Ce){v[ce]=ve,v[ce+"_name"]=(Ce==null?void 0:Ce.name)||"",oe()}function De(ce,ve){var Fe;const Ce=JSON.parse(o.node.node_params),Se=(Fe=Ce==null?void 0:Ce.plugin)==null?void 0:Fe.name;return!Se||!ve?(T[ce]=[],Promise.resolve([])):!v.app_id||!v.app_secret?(T[ce]=[],Promise.resolve([])):Ho({name:Se,action:"default/exec",params:JSON.stringify({business:ve,arguments:{app_id:v.app_id,app_secret:v.app_secret}})}).then(ze=>{var Xe;return T[ce]=((Xe=ze==null?void 0:ze.data)==null?void 0:Xe.tags)||[],ze})}function G(ce,ve){if(!v.app_id||!v.app_secret)return mt.warning("请先选择公众号");S[ce]||(S[ce]=!0,De(ce,ve==null?void 0:ve.query_tag_service).then(()=>{mt.success("同步完成")}).finally(()=>{S[ce]=!1}))}const ie=(ce,ve)=>ve.name.toLowerCase().indexOf(ce.toLowerCase())>=0;function ae(ce,ve){k[ce.begin_date_key]=ve;const Ce=ce==null?void 0:ce.date_type_key;Ce&&(v[Ce]=String(ve));const Se=ce.begin_date_key,Fe=ce.end_date_key;ve===1?(v[Se]="",v[Fe]="",v[Se+"_tags"]=[],v[Fe+"_tags"]=[],A[Se]=null):ve===2&&(v[Se]="",v[Fe]="",A[Se]=null),oe()}function Ae(ce){const ve=v[ce.begin_date_key],Ce=v[ce.end_date_key];return[ve?yo(ve):null,Ce?yo(Ce):null]}function fe(ce,ve){const Ce=ce.begin_date_key;Array.isArray(ve)&&ve[0]?A[Ce]=ve[0]:A[Ce]=null}function Ie(ce,ve,Ce){v[ce.begin_date_key]=Ce[0]||"",v[ce.end_date_key]=Ce[1]||"",!Ce[0]&&!Ce[1]&&(A[ce.begin_date_key]=null),oe()}function je(ce,ve){if(!ve)return!1;const Ce=ce.end_date_max?yo(ce.end_date_max):null;if(Ce&&ve.isAfter(Ce,"day"))return!0;const Se=A[ce.begin_date_key],Fe=Number(ce.date_range_max_interval||0);if(Se&&Fe>0){const ze=yo(Se).add(Fe-1,"day");return ve.isAfter(ze,"day")}return!1}function Ue(ce=!1){return f_(s,ce).then(ve=>{var ze,Xe;B.value=ve||{};const Ce=Object.keys(B.value),Se=Ce.find(lt=>{var wt;return(wt=B.value[lt])==null?void 0:wt.is_default});let Fe=null;try{const lt=JSON.parse(o.node.node_params);Fe=((Xe=(ze=lt==null?void 0:lt.plugin)==null?void 0:ze.params)==null?void 0:Xe.config_name)||""}catch{}Fe&&Ce.includes(Fe)?O.value=Fe:O.value=Se||Ce[0]||null})}function ot(){const ce={[o.actionName||"default"]:o.action||{}};$.value&&$.value.show(B.value,s,ce)}function it(){oe()}function Ke(){P.value=!P.value}function dt(ce){var ve;try{const Ce=O.value||"",Se=Ce?((ve=B.value)==null?void 0:ve[Ce])||{}:{};if(!Se||Object.keys(Se).length===0)return;f.value.forEach(Fe=>{const ze=Fe.meta||{};if(!(ze.plugin_config_component===!0||ze.plugin_config_component===1||ze.plugin_config_component==="true"||ze.plugin_config_component==="1"))return;const lt=Fe.key,wt=Se[lt];wt!=null&&(ce[lt]=re(wt))})}catch{}}return(ce,ve)=>{const Ce=ho,Se=Lt,Fe=$t,ze=Xt;return w(),R("div",$9,[g.value||y.value?(w(),R("div",R9,[m(Ce)])):ne("",!0),a.value?(w(),R("div",P9,[u("div",L9,[ve[2]||(ve[2]=u("div",null,[u("img",{src:$_,class:"title-icon"}),U("设置")],-1)),l.value?(w(),R("div",B9,[u("a",{href:l.value,target:"_blank",rel:"noopener noreferrer"},H(d.value||l.value),9,I9)])):ne("",!0)]),m(dd,{items:Y.value,formState:v,errors:b,apps:_.value,variableOptions:n.variableOptions,tagTypes:M,tagLists:T,showTagComponents:E.value,sortedEnum:h,appChange:V,onFieldChange:q,update:oe,onChangeDynamic:W,filterOption:ie,tagTypeChange:he,tagChange:be,syncFieldTags:G,syncingTags:S,dateRangeTypes:k,dateRangeTypeChange:ae,getRangeValue:Ae,onDateRangeCalendarChange:fe,onDateRangeChange:Ie,getDisabledDateForRange:je,onToggleAdvanced:Ke,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])])):ne("",!0),u("div",j9,[u("div",F9,[ve[4]||(ve[4]=u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")],-1)),D.value?(w(),R(se,{key:0},[Object.keys(B.value).length?(w(),Q(Fe,{key:0,value:O.value,"onUpdate:value":ve[0]||(ve[0]=Xe=>O.value=Xe),onChange:it,style:{"min-width":"160px"}},{default:x(()=>[(w(!0),R(se,null,ge(B.value,(Xe,lt)=>(w(),Q(Se,{key:lt,value:lt},{default:x(()=>[U(H(Xe.name||lt),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Q(ze,{key:1,onClick:ot},{default:x(()=>[ve[3]||(ve[3]=U("未授权 ",-1)),m(K(xo))]),_:1}))],64)):ne("",!0)]),m(dd,{items:F.value,formState:v,errors:b,apps:_.value,variableOptions:n.variableOptions,tagTypes:M,tagLists:T,showTagComponents:E.value,sortedEnum:h,appChange:V,onFieldChange:q,update:oe,onChangeDynamic:W,filterOption:ie,tagTypeChange:he,tagChange:be,syncFieldTags:G,syncingTags:S,dateRangeTypes:k,dateRangeTypeChange:ae,getRangeValue:Ae,onDateRangeCalendarChange:fe,onDateRangeChange:Ie,getDisabledDateForRange:je,onToggleAdvanced:Ke,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"]),N.value&&P.value?(w(),Q(dd,{key:0,items:L.value,formState:v,errors:b,apps:_.value,variableOptions:n.variableOptions,tagTypes:M,tagLists:T,showTagComponents:E.value,sortedEnum:h,appChange:V,onFieldChange:q,update:oe,onChangeDynamic:W,filterOption:ie,tagTypeChange:he,tagChange:be,syncFieldTags:G,syncingTags:S,dateRangeTypes:k,dateRangeTypeChange:ae,getRangeValue:Ae,onDateRangeCalendarChange:fe,onDateRangeChange:Ie,getDisabledDateForRange:je,onToggleAdvanced:Ke,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])):ne("",!0)]),u("div",V9,[ve[5]||(ve[5]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",H9,[m(zI,{"tree-data":C.value},null,8,["tree-data"])])]),m(gC,{ref_key:"configModalRef",ref:$,onChange:ve[1]||(ve[1]=Xe=>Ue(!0))},null,512)])}}},z9=Ne(U9,[["__scopeId","data-v-2ce2e4f9"]]),q9=["src"],G9={class:"node-options"},X9={class:"options-item"},W9={class:"kv"},Y9={class:"v"},J9={class:"kv"},K9={class:"v"},Z9={key:0,class:"kv"},Q9={class:"v"},ej={key:1,class:"kv"},tj={class:"v"},nj={key:2,class:"kv"},oj={class:"v"},ij={class:"node-options"},rj={class:"options-item"},sj={__name:"http-tool-box",props:{node:{type:Object,default:()=>({})}},setup(n){Ve("setData");const e=n,t=X([]),o=X({method:"",url:"",query:"",headers:"",body:""}),i=We(()=>`${o.value.method||""} ${o.value.url||""}`.trim());function r(){var l,d,c;const s=JSON.parse(e.node.node_params||"{}"),a=((d=(l=s==null?void 0:s.plugin)==null?void 0:l.params)==null?void 0:d.arguments)||{};o.value.method=a.method||"",o.value.url=a.url||"",o.value.query=a.query||"",o.value.headers=a.headers||"",o.value.body=a.body||"",t.value=((c=s==null?void 0:s.plugin)==null?void 0:c.output_obj)||[]}return at(()=>{r()}),(s,a)=>{const l=ho;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,desc:i.value},{"node-icon":x(()=>{var d;return[(d=n.node.properties)!=null&&d.node_icon?(w(),R("img",{key:0,class:"node-icon",src:n.node.properties.node_icon},null,8,q9)):(w(),Q(l,{key:1,size:"small"}))]}),_:1},8,["title","desc"])]),default:x(()=>[u("div",null,[u("div",G9,[a[5]||(a[5]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),u("div",X9,[u("div",W9,[a[0]||(a[0]=u("div",{class:"k"},"请求方法",-1)),u("div",Y9,H(o.value.method),1)]),u("div",J9,[a[1]||(a[1]=u("div",{class:"k"},"请求地址",-1)),u("div",K9,H(o.value.url),1)]),o.value.query?(w(),R("div",Z9,[a[2]||(a[2]=u("div",{class:"k"},"查询参数",-1)),u("div",Q9,H(o.value.query),1)])):ne("",!0),o.value.headers?(w(),R("div",ej,[a[3]||(a[3]=u("div",{class:"k"},"请求头",-1)),u("div",tj,H(o.value.headers),1)])):ne("",!0),o.value.body?(w(),R("div",nj,[a[4]||(a[4]=u("div",{class:"k"},"请求体",-1)),u("div",oj,H(o.value.body),1)])):ne("",!0)])]),u("div",ij,[a[6]||(a[6]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",rj,[m(Oi,{"tree-data":t.value},null,8,["tree-data"])])])])]),_:1})}}},aj=Ne(sj,[["__scopeId","data-v-5b731d5b"]]),lj={__name:"qrcode-box",setup(n,{expose:e}){const t=X(!1);function o(){t.value=!0}return e({show:o}),(i,r)=>{const s=_n;return w(),Q(s,{open:t.value,"onUpdate:open":r[0]||(r[0]=a=>t.value=a),footer:null,wrapClassName:"qrcode-wrap",width:"380px"},{default:x(()=>[...r[1]||(r[1]=[u("div",{class:"qrcode-box"},[u("div",{class:"title"},"扫码登录"),u("div",{class:"content"},[u("div",{class:"tip"},"请使用微信扫描下方二维码登员"),u("img",{class:"qrcode",src:"https://xiaokefu.com.cn/static/home/img/zhima.jpg"}),u("div",{class:"desc"},"二妞码有效期为5分钟，请尽快扫描")])],-1)])]),_:1},8,["open"])}}},uj=Ne(lj,[["__scopeId","data-v-e13b70ff"]]),dj={class:"_main-box"},cj={key:0,class:"login-info-box"},pj={class:"desc"},fj={class:"official-info"},hj=["src"],vj={__name:"official-article-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,{loginInfo:o,loginStatus:i,loading:r,refresh:s,goLogin:a}=mC();e_();const l=X(null),d=X("admin");return at(()=>{l.value.setState({username:{value:d.value,tags:[]}})}),(c,p)=>{const f=Xt;return w(),R("div",dj,[K(i)?ne("",!0):(w(),R("div",cj,[p[4]||(p[4]=u("div",{class:"tit"},"请先完成登录",-1)),m(f,{type:"primary",class:"link",onClick:K(a)},{default:x(()=>[...p[1]||(p[1]=[U("去登录",-1)])]),_:1},8,["onClick"]),u("div",pj,[p[3]||(p[3]=U("已登录？ ",-1)),m(f,{type:"link",onClick:K(s),loading:K(r)},{default:x(()=>[...p[2]||(p[2]=[U("点击刷新",-1)])]),_:1},8,["onClick","loading"])])])),m(Vu,{ref_key:"formRef",ref:l,node:n.node,params:n.action.params,output:n.action.output,variableOptions:n.variableOptions,onUpdateVar:p[0]||(p[0]=h=>t("updateVar"))},Zv({username:x(({state:h,keyName:v,item:y})=>[]),_:2},[K(i)?{name:"input-title-extra",fn:x(()=>{var h,v;return[u("div",fj,[u("img",{class:"avatar",src:(h=K(o))==null?void 0:h.headimgurl},null,8,hj),u("span",null,H((v=K(o))==null?void 0:v.nickname),1),m(K(za),{class:"icon"})])]}),key:"0"}:void 0]),1032,["node","params","output","variableOptions"]),m(uj)])}}},_j=Ne(vj,[["__scopeId","data-v-ddd236de"]]),gj=["src"],mj={key:2,class:"node-options"},yj={class:"options-item-tit"},bj={class:"option-label"},xj={class:"option-type"},wj={class:"field-list-item"},Cj={class:"field-label"},kj={class:"field-type"},Sj={class:"desc"},Ej={__name:"zm-plugins-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=Ve("getNode"),t=Ve("setData"),o=n,i={feishu_bitable:w5,official_account_profile:U5,official_batch_tag:jL,official_send_template_message:xL,official_send_message:xB,official_draft:BI,http_tool:aj,official_article:_j},r={"official_article:get_official_article":["url","number"]},s=Je({}),a=X({}),l=X(null),d=X([]),c=X(!1),p=X({}),f=We(()=>l.value?l.value.desc:a.value.description);let h={};async function v(){_(),h=JSON.parse(o.node.node_params),await y(),await g()}function y(){var T;return w_({name:(T=h==null?void 0:h.plugin)==null?void 0:T.name}).then(M=>{var k;let S=(M==null?void 0:M.data)||{};p.value=S.remote,c.value=((k=S==null?void 0:S.local)==null?void 0:k.multiNode)||!1})}function g(){var T;return Ho({name:((T=h==null?void 0:h.plugin)==null?void 0:T.name)||"",action:"default/get-schema",params:{}}).then(M=>{var A,$,B;let S=(M==null?void 0:M.data)||{};a.value=p.value;const k=(A=h==null?void 0:h.plugin)==null?void 0:A.name;if(ba(k)||c.value){const O=h.plugin.params.business;l.value=S[O];let P=r[`${k}:${O}`];Array.isArray(P)&&(l.value.params=zc(l.value.params,P))}else{Object.assign(s,S);for(let O in s)s[O].value=String((h==null?void 0:h.plugin.params[O])||""),s[O].tags=((B=($=h==null?void 0:h.plugin)==null?void 0:$.tag_map)==null?void 0:B[O])||[]}})}function _(){d.value=e().getAllParentVariable()}function b(T,M,S){T.value=M,T.tags=S,C()}function C(){let T={params:{},tag_map:{}};for(let M in s){let S=s[M].value;s[M].type=="string"?S=String(S):["number","integer"].includes(s[M].type)&&(S=Number(S)),T.params[M]=S,T.tag_map[M]=s[M].tags}h.plugin.params=T.params,h.plugin.tag_map=T.tag_map,t({...o.node,node_params:JSON.stringify(h)})}return at(()=>{v()}),(T,M)=>{const S=ho;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,desc:f.value},{"node-icon":x(()=>[a.value.icon?(w(),R("img",{key:0,class:"node-icon",src:a.value.icon},null,8,gj)):(w(),Q(S,{key:1,size:"small"}))]),_:1},8,["title","desc"])]),default:x(()=>{var k,A,$;return[(k=l.value)!=null&&k.common_template?(w(),Q(z9,{key:0,node:n.node,action:l.value,actionName:K(h).plugin.params.business,variableOptions:d.value,onUpdateVar:_},null,8,["node","action","actionName","variableOptions"])):K(ba)(($=(A=K(h))==null?void 0:A.plugin)==null?void 0:$.name)?(w(),R(se,{key:1},[i[K(h).plugin.name]?(w(),Q(Pu(i[K(h).plugin.name]),{key:0,node:n.node,action:l.value,actionName:K(h).plugin.params.business,variableOptions:d.value,onUpdateVar:_},null,40,["node","action","actionName","variableOptions"])):(w(),Q(Vu,{key:1,node:n.node,params:l.value.params,output:l.value.output,variableOptions:d.value,onUpdateVar:_},null,8,["node","params","output","variableOptions"]))],64)):(w(),R("div",mj,[M[0]||(M[0]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),(w(!0),R(se,null,ge(s,(B,O)=>(w(),R("div",{key:O,class:xt(["options-item",{"is-required":B.required}])},[u("div",yj,[u("div",bj,H(O),1),u("div",xj,H(B.type),1)]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:d.value,defaultSelectedList:B.tags,defaultValue:B.value,ref_for:!0,ref:"atInputRef",onOpen:_,onChange:(P,E)=>b(B,P,E),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:P,payload:E})=>[u("div",wj,[u("div",Cj,H(P),1),u("div",kj,H(E.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",Sj,H(B.description),1)],2))),128))]))]}),_:1})}}},Aj=Ne(Ej,[["__scopeId","data-v-492b81d1"]]),Dj={class:"variable-node"},Oj={class:"node-form-content"},Nj={class:"gray-block multi-modal-box"},Mj={class:"output-label"},Tj={class:"multi-modal-input"},$j={style:{color:"#8c8c8c"}},Rj={class:"gray-block"},Pj={class:"field-items"},Lj={class:"field-name-box"},Bj={class:"field-name"},Ij={class:"field-value-box"},jj={__name:"session-trigger-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=Ve("getGraph"),s=X([]),a=X([]),l=Je({question_multiple_switch:!1}),d=We(()=>s.value.map(_=>_.variable)),c=_=>{y()};function p(){const _=i();if(_){let C=_.getGlobalVariable().diy_global||[];C.forEach(T=>{T.label=T.key,T.value="global."+T.key}),a.value=C||[]}}function f(_){_&&p()}const h=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...o.node})},10)},v=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},y=()=>{let _=JSON.parse(o.node.node_params);_.trigger.outputs=[...s.value],_.trigger.chat_config={...l};let b={...o.node,node_params:JSON.stringify(_)};t("update-node",b),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",b)},10)},g=()=>{p();try{let _=o.node.dataRaw||o.node.node_params||"{}";_=JSON.parse(_);const b=_.trigger||{outputs:[],chat_config:{question_multiple_switch:!1}};l.question_multiple_switch=b.chat_config.question_multiple_switch,s.value=b.outputs.map(C=>(C.tags=C.tags||[],C))}catch(_){}};return at(()=>{g()}),(_,b)=>{const C=Fi,T=Zt,M=Lt,S=$t;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:h,onDeleteNode:v,desc:"chatwiki对外服务，用户发起会话时触发工作流"},null,8,["title","iconName"])]),default:x(()=>[u("div",Dj,[u("div",Oj,[u("div",Nj,[u("div",Mj,[b[1]||(b[1]=u("img",{src:to,alt:"",class:"output-label-icon"},null,-1)),b[2]||(b[2]=u("span",{class:"output-label-text"},"多模态输入",-1)),b[3]||(b[3]=U("    ",-1)),m(C,{checked:l.question_multiple_switch,"onUpdate:checked":b[0]||(b[0]=k=>l.question_multiple_switch=k),onChange:c},null,8,["checked"])]),u("div",Tj,[u("div",$j,[b[5]||(b[5]=U("开启后，支持用户输入文字+图片消息。用户输入的文字消息依然会作为question变量输出，还会额外增加一个变量question_multiple ",-1)),m(T,{placement:"left"},{title:x(()=>[...b[4]||(b[4]=[u("div",null,"question_multiple是一个对象数组，包含用户输入的文字和图片消息示例如下：",-1),u("pre",null,[u("code",null,`"question_multiple":[
  {
    "type":"text",
    "text":"这是什么"
  },{
    "type":"image_url",
    "image_url":{
      "url":"这里是图片的ur"
    }
  }
]
              `)],-1)])]),default:x(()=>[m(K(ft))]),_:1})])])]),u("div",Rj,[b[6]||(b[6]=u("div",{class:"output-label"},[u("img",{src:to,alt:"",class:"output-label-icon"}),u("span",{class:"output-label-text"},"输出"),u("span",{class:"output-desc"},"（输出参数已自动映射到开始节点）")],-1)),u("div",Pj,[(w(!0),R(se,null,ge(s.value,(k,A)=>(w(),R("div",{class:"field-item",key:A},[u("div",Lj,[u("span",Bj,H(k.key),1),m(T,null,{title:x(()=>[U(H(k.desc),1)]),default:x(()=>[m(K(ft))]),_:2},1024)]),u("div",Ij,[m(S,{style:{width:"200px"},placeholder:"请输入选择变量",value:k.variable,"onUpdate:value":$=>k.variable=$,allowClear:"",onDropdownVisibleChange:f,onChange:y},{default:x(()=>[(w(!0),R(se,null,ge(a.value,$=>(w(),Q(M,{disabled:d.value.includes($.value),value:$.value,key:$.key},{default:x(()=>[u("span",null,H($.label),1)]),_:2},1032,["disabled","value"]))),128))]),_:1},8,["value","onUpdate:value"])])]))),128))])])])])]),_:1})}}},Fj=Ne(jj,[["__scopeId","data-v-ed0fada3"]]),Vj="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23hp676wcw9__clip0_12661_41280)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'%3e%3cpath%20d='M7.99993%2014.7779C11.375%2014.7779%2014.1111%2012.0418%2014.1111%208.66678C14.1111%205.29171%2011.375%202.55566%207.99993%202.55566C4.62487%202.55566%201.88883%205.29171%201.88883%208.66678C1.88883%2012.0418%204.62487%2014.7779%207.99993%2014.7779Z'/%3e%3cpath%20d='M7.9198%205.11768L7.9194%208.78728L10.5102%2011.378'%20stroke-linecap='round'/%3e%3cpath%20d='M1.33334%203.00016L3.66667%201.3335'%20stroke-linecap='round'/%3e%3cpath%20d='M14.6667%203.00016L12.3333%201.3335'%20stroke-linecap='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='hp676wcw9__clip0_12661_41280'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";var Af={exports:{}},Df;function Hj(){return Df||(Df=1,(function(n,e){(function(t){t(y_())})(function(t){t.defineMode("shell",function(){var o={};function i(v,y){for(var g=0;g<y.length;g++)o[y[g]]=v}var r=["true","false"],s=["if","then","do","else","elif","while","until","for","in","esac","fi","fin","fil","done","exit","set","unset","export","function"],a=["ab","awk","bash","beep","cat","cc","cd","chown","chmod","chroot","clear","cp","curl","cut","diff","echo","find","gawk","gcc","get","git","grep","hg","kill","killall","ln","ls","make","mkdir","openssl","mv","nc","nl","node","npm","ping","ps","restart","rm","rmdir","sed","service","sh","shopt","shred","source","sort","sleep","ssh","start","stop","su","sudo","svn","tee","telnet","top","touch","vi","vim","wall","wc","wget","who","write","yes","zsh"];t.registerHelper("hintWords","shell",r.concat(s,a)),i("atom",r),i("keyword",s),i("builtin",a);function l(v,y){if(v.eatSpace())return null;var g=v.sol(),_=v.next();if(_==="\\")return v.next(),null;if(_==="'"||_==='"'||_==="`")return y.tokens.unshift(d(_,_==="`"?"quote":"string")),h(v,y);if(_==="#")return g&&v.eat("!")?(v.skipToEnd(),"meta"):(v.skipToEnd(),"comment");if(_==="$")return y.tokens.unshift(p),h(v,y);if(_==="+"||_==="=")return"operator";if(_==="-")return v.eat("-"),v.eatWhile(/\w/),"attribute";if(_=="<"){if(v.match("<<"))return"operator";var b=v.match(/^<-?\s*['"]?([^'"]*)['"]?/);if(b)return y.tokens.unshift(f(b[1])),"string-2"}if(/\d/.test(_)&&(v.eatWhile(/\d/),v.eol()||!/\w/.test(v.peek())))return"number";v.eatWhile(/[\w-]/);var C=v.current();return v.peek()==="="&&/\w+/.test(C)?"def":o.hasOwnProperty(C)?o[C]:null}function d(v,y){var g=v=="("?")":v=="{"?"}":v;return function(_,b){for(var C,T=!1;(C=_.next())!=null;){if(C===g&&!T){b.tokens.shift();break}else if(C==="$"&&!T&&v!=="'"&&_.peek()!=g){T=!0,_.backUp(1),b.tokens.unshift(p);break}else{if(!T&&v!==g&&C===v)return b.tokens.unshift(d(v,y)),h(_,b);if(!T&&/['"]/.test(C)&&!/['"]/.test(v)){b.tokens.unshift(c(C,"string")),_.backUp(1);break}}T=!T&&C==="\\"}return y}}function c(v,y){return function(g,_){return _.tokens[0]=d(v,y),g.next(),h(g,_)}}var p=function(v,y){y.tokens.length>1&&v.eat("$");var g=v.next();return/['"({]/.test(g)?(y.tokens[0]=d(g,g=="("?"quote":g=="{"?"def":"string"),h(v,y)):(/\d/.test(g)||v.eatWhile(/\w/),y.tokens.shift(),"def")};function f(v){return function(y,g){return y.sol()&&y.string==v&&g.tokens.shift(),y.skipToEnd(),"string-2"}}function h(v,y){return(y.tokens[0]||l)(v,y)}return{startState:function(){return{tokens:[]}},token:function(v,y){return h(v,y)},closeBrackets:"()[]{}''\"\"``",lineComment:"#",fold:"brace"}}),t.defineMIME("text/x-sh","shell"),t.defineMIME("application/x-sh","shell")})})()),Af.exports}Hj();const Uj={class:"variable-node"},zj={class:"node-form-content"},qj={class:"gray-block"},Gj={class:"form-item"},Xj={key:0,class:"form-item"},Wj={key:1,class:"form-item custom-textarea"},Yj={__name:"timing-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n;function i(){let f=[];for(let h=0;h<31;h++)f.push({label:h+1+"号",value:h+1+""});return f}const r=[{value:"day",label:"每天执行"},{value:"week",label:"每周执行",children:[{value:"0",label:"星期日"},{value:"1",label:"星期一"},{value:"2",label:"星期二"},{value:"3",label:"星期三"},{value:"4",label:"星期四"},{value:"5",label:"星期五"},{value:"6",label:"星期六"}]},{value:"month",label:"每月执行",children:i()}],s=Je({type:"select_time",time_value:[],every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""});ct(()=>s,()=>{c()},{deep:!0}),Ve("getNode");const a=Ve("getGraph"),l=()=>{setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",{...o.node})},10)},d=()=>{setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",null)},10)},c=()=>{let f=JSON.parse(o.node.node_params),h="",v="",y="";s.time_value&&s.time_value.length&&(h=s.time_value[0],s.time_value[0]=="week"&&(v=s.time_value[1]),s.time_value[0]=="month"&&(y=s.time_value[1])),f.trigger.cron_config={...s,every_type:h,week_number:v,month_day:y};let g={...o.node,node_params:JSON.stringify(f)};t("update-node",g),setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",g)},10)},p=()=>{try{let f=o.node.dataRaw||o.node.node_params||"{}";f=JSON.parse(f);let h=f.trigger.cron_config;s.type=h.type,s.linux_crontab=h.linux_crontab,s.every_type=h.every_type,s.week_number=h.week_number,s.month_day=h.month_day,s.hour_minute=h.hour_minute;let v=h.every_type;v=="day"&&(s.time_value=["day"]),v=="week"&&(s.time_value=["week",h.week_number]),v=="month"&&(s.time_value=["month",h.month_day])}catch(f){}};return at(()=>{p()}),(f,h)=>{const v=ro,y=io,g=li,_=py,b=ko,C=Vi;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:l,onDeleteNode:d,desc:"在设定的时间点，自动执行工作流"},null,8,["title","iconName"])]),default:x(()=>[u("div",Uj,[u("div",zj,[u("div",qj,[h[6]||(h[6]=u("div",{class:"output-label"},[u("img",{src:Vj,alt:"",class:"output-label-icon"}),u("span",{class:"output-label-text"},"触发时间")],-1)),u("div",Gj,[m(y,{value:s.type,"onUpdate:value":h[0]||(h[0]=T=>s.type=T)},{default:x(()=>[m(v,{value:"select_time"},{default:x(()=>[...h[4]||(h[4]=[U("选择触发时间",-1)])]),_:1}),m(v,{value:"linux_crontab"},{default:x(()=>[...h[5]||(h[5]=[U("Linux Crontab 代码",-1)])]),_:1})]),_:1},8,["value"])]),s.type==="select_time"?(w(),R("div",Xj,[m(b,{gap:8},{default:x(()=>[m(g,{value:s.time_value,"onUpdate:value":h[1]||(h[1]=T=>s.time_value=T),options:r,placeholder:"请选择",style:{width:"194px"}},null,8,["value"]),m(_,{allowClear:!1,value:s.hour_minute,"onUpdate:value":h[2]||(h[2]=T=>s.hour_minute=T),valueFormat:"HH:mm",format:"HH:mm",style:{width:"124px"}},null,8,["value"])]),_:1})])):(w(),R("div",Wj,[m(C,{value:s.linux_crontab,"onUpdate:value":h[3]||(h[3]=T=>s.linux_crontab=T),placeholder:"请输入代码",style:{"min-height":"142px",background:"#262626",color:"#bfbfbf"}},null,8,["value"])]))])])])]),_:1})}}},Jj=Ne(Yj,[["__scopeId","data-v-8b46e137"]]),Kj="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1763712774665'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='300'%20height='300'%3e%3cpath%20d='M692.352%20335.04c11.712%200.128%2023.36%200.96%2034.944%202.432-31.232-156.8-186.88-273.152-365.184-273.152C163.008%2064.32%200%20210.048%200%20394.88c0%20106.944%2054.336%20194.688%20144.768%20262.784l-36.096%20117.12%20126.592-68.224c41.536%2011.2%2084.032%2017.728%20126.848%2019.584h33.856a312%20312%200%200%201-11.136-81.6%20306.88%20306.88%200%200%201%20307.84-308.032l-0.32-1.536z%20m-194.56-105.408a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312c-27.328%202.176-51.328-19.328-54.4-48.64%202.88-29.312%2027.008-50.816%2054.4-48.512z%20m-253.44%2097.152c-27.456%202.304-51.648-19.2-54.656-48.64%203.008-29.312%2027.2-50.88%2054.656-48.512a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312z'%20fill='currentColor'%20p-id='1850'%3e%3c/path%3e%3cpath%20d='M1024%20638.464c0-155.52-145.92-283.52-308.608-283.52-172.416%200-308.096%20126.784-308.096%20282.304%200%20155.52%20135.68%20282.368%20308.096%20282.368a426.176%20426.176%200%200%200%20109.44-18.304L924.16%20960l-28.416-97.216C968.832%20803.84%201024%20726.208%201024%20638.464z%20m-408.448-48.832c-19.968%200-36.16-17.408-36.16-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.56%2042.56%2014.72%2045.184%2038.784-2.624%2024.064-22.784%2041.344-45.184%2038.848z%20m199.04%200c-19.84%200-36.096-17.408-36.096-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.368%2042.432%2014.848%2045.248%2038.784-2.688%2024.064-22.848%2041.344-45.248%2038.848z'%20fill='currentColor'%20p-id='1851'%3e%3c/path%3e%3c/svg%3e",Zj={class:"variable-node"},Qj={class:"node-form-content"},eF={class:"gray-block"},tF={class:"app-item-list"},nF=["onClick"],oF={class:"form-item"},iF={class:"form-item-content"},rF={class:"gray-block"},sF={class:"field-items"},aF={class:"field-name-box"},lF={class:"field-name"},uF={class:"field-value-box"},dF={__name:"official-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=Rs(),o=We(()=>t.officialList),i=We(()=>t.triggerOfficialList),r=e,s=n,a=Ve("getNode"),l=Ve("getGraph"),d=X([{label:"私信消息",value:"message"},{label:"关注/取消关注事件",value:"subscribe_unsubscribe"},{label:"扫描带参数二维码事件",value:"qrcode_scan"},{label:"自定义菜单事件",value:"menu_click"}]),c=Je({msg_type:"",app_ids:[]}),p=We(()=>c.app_ids.map(A=>o.value.find($=>$.app_id==A)).filter(Boolean)),f=X([]),h=X([]);We(()=>f.value.map(A=>A.variable));function v(){const A=a();if(A){let B=A.getGlobalVariable().diy_global||[];B.forEach(O=>{O.label=O.key,O.value="global."+O.key}),h.value=B||[]}}function y(A){A&&v()}const g=()=>{setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",{...s.node})},10)},_=()=>{setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",null)},10)},b=()=>{let A=JSON.parse(s.node.node_params);A.trigger.outputs=[...f.value],A.trigger.trigger_official_config={msg_type:c.msg_type,app_ids:c.app_ids.join(",")};let $={...s.node,node_params:JSON.stringify(A)};r("update-node",$),setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",$)},10)},C=()=>{v();try{let A=s.node.dataRaw||s.node.node_params||"{}";A=JSON.parse(A);const $=A.trigger||{outputs:[]};let B=$.trigger_official_config;c.msg_type=B.msg_type,c.app_ids=B.app_ids?B.app_ids.split(","):[];let O=$.outputs;O||(O=i.value.find(P=>P.msg_type==B.msg_type).fields),f.value=O.map(P=>(P.tags=P.tags||[],P))}catch(A){}},T=()=>{M.value.open({},JSON.parse(JSON.stringify(c.app_ids)))},M=X(null),S=A=>{c.app_ids=A||[],M.value.close(),b()},k=A=>{c.app_ids=c.app_ids.filter($=>$!=A.app_id),b()};return at(()=>{C()}),(A,$)=>{const B=Xt,O=$t,P=Zt,E=Lt;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:g,onDeleteNode:_,desc:"当对接的公众号触发相关事件时，自动触发流程"},null,8,["title","iconName"])]),default:x(()=>[u("div",Zj,[u("div",Qj,[u("div",eF,[$[3]||($[3]=u("div",{class:"output-label"},[u("img",{src:Kj,alt:"",class:"output-label-icon"}),u("span",{class:"output-label-text"},"公众号")],-1)),u("div",null,[m(B,{onClick:T,type:"dashed"},{default:x(()=>[m(K(Mt)),$[1]||($[1]=U("添加公众号",-1))]),_:1}),u("div",tF,[(w(!0),R(se,null,ge(p.value,D=>(w(),R("div",{class:"app-item",key:D.app_id},[U(H(D.app_name)+" ",1),u("span",{onClick:N=>k(D),class:"close-icon"},[m(K(Lu))],8,nF)]))),128))])]),u("div",oF,[$[2]||($[2]=u("div",{class:"form-item-label"},"触发事件",-1)),u("div",iF,[m(O,{options:d.value,value:c.msg_type,"onUpdate:value":$[0]||($[0]=D=>c.msg_type=D),style:{width:"100%"},showArrow:!1,disabled:""},null,8,["options","value"])])])]),u("div",rF,[$[4]||($[4]=u("div",{class:"output-label"},[u("img",{src:Fu,alt:"",class:"output-label-icon"}),u("span",{class:"output-label-text"},"输出"),u("a",{class:"ml8",href:"https://developers.weixin.qq.com/doc/subscription/guide/product/message/Receiving_standard_messages.html",target:"_blank"},"查看官方接口文档")],-1)),u("div",sF,[(w(!0),R(se,null,ge(f.value,(D,N)=>(w(),R("div",{class:"field-item",key:N},[u("div",aF,[u("span",lF,H(D.key),1),m(P,null,{title:x(()=>[U(H(D.desc),1)]),default:x(()=>[m(K(ft))]),_:2},1024)]),u("div",uF,[m(O,{style:{width:"200px"},placeholder:"请输入选择变量",value:D.variable,"onUpdate:value":F=>D.variable=F,allowClear:"",onDropdownVisibleChange:y,onChange:b},{default:x(()=>[(w(!0),R(se,null,ge(h.value,F=>(w(),Q(E,{value:F.value,key:F.key},{default:x(()=>[u("span",null,H(F.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])])]))),128))])])]),m(xC,{ref_key:"wxAppRef",ref:M,title:"添加公众号",onOk:S},null,512)])]),_:1})}}},cF=Ne(dF,[["__scopeId","data-v-78ddcd5e"]]),pF="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%234f9846fr4__clip0_12833_126304)'%20stroke='%23262626'%20stroke-width='1.33333'%3e%3cpath%20d='M4%203.30905V2.33337C4%201.78109%204.4477%201.33337%205%201.33337H13.6667C14.219%201.33337%2014.6667%201.78109%2014.6667%202.33337V11C14.6667%2011.5523%2014.219%2012%2013.6667%2012H12.6725'/%3e%3cpath%20d='M11.6667%203.33337H2.33337C1.78109%203.33337%201.33337%203.78109%201.33337%204.33337V13.6667C1.33337%2014.219%201.78109%2014.6667%202.33337%2014.6667H11.6667C12.219%2014.6667%2012.6667%2014.219%2012.6667%2013.6667V4.33337C12.6667%203.78109%2012.219%203.33337%2011.6667%203.33337Z'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%209L10%209'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%206L10%209L7%2012'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='4f9846fr4__clip0_12833_126304'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",fF="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M8%201.66663H2V12.3333H8V1.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%203.66663H8V14.3333H14V3.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4.33337%205.66663L5.66671%206.92979L4.44447%208.33329'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.3334%207.66663L11.6667%208.92979L10.4445%2010.3333'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",hF={class:"modal-title-block"},vF={key:0,class:"run-detail"},_F={class:"flex-content-box"},gF={class:"test-model-box"},mF={key:2,class:"input-list-box"},yF={class:"add-btn-box"},bF={key:0,class:"result-list-box loading-box"},xF={key:1,class:"result-list-box"},wF=["onClick"],CF={class:"status-block"},kF={class:"icon-name-box"},SF=["src"],EF={class:"node-name"},AF={key:0,class:"time-tag"},DF={class:"right-active-icon"},OF={class:"save-btn-box"},NF={class:"preview-box"},MF={class:"preview-title"},TF={class:"icon-name-box"},$F=["src"],RF={class:"node-name"},PF={key:0,class:"time-tag"},LF={class:"preview-content-block"},BF={class:"title-block"},IF={class:"preview-code-box"},jF={class:"preview-content-block"},FF={class:"title-block"},VF={class:"preview-code-box"},HF={class:"preview-content-block"},UF={class:"title-block"},zF={class:"preview-code-box"},qF={__name:"run-test",props:{batch_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const o=Vn(),i=We(()=>o.robotInfo.isLockedByOther),r=n;We(()=>[]);const s=X(!1),a=X(""),l=X([]),d=We(()=>a.value?l.value.filter(E=>E.node_key==a.value)[0]:null),c=X(!1),p=Je({is_draft:!0,robot_key:o.robotInfo.robot_key,question:"",openid:""}),f=async()=>{if(i.value){mt.warning("当前已有其他用户在编辑中，无法运行测试");return}o.robotInfo.loop_save_canvas_status++,await Tt();let E=localStorage.getItem("workflow_batch_run_test_data")||"{}";E=JSON.parse(E),p.question=E.question||"",p.openid=E.openid||"",p.global=E.global||"",l.value=[],a.value="",setTimeout(()=>{g()},1e3),s.value=!0},h=X([]),v=X(!1),y=X(!1),g=()=>{Zm({robot_key:p.robot_key,batch_node_key:r.batch_node_key}).then(E=>{v.value=E.data.is_need_question,y.value=E.data.is_need_openid,v.value||(p.question=""),h.value=E.data.loop_test_params.map(D=>({...D,field:{...D.field,Vals:_(D.field)}}))})};function _(E){return E.typ=="string"||E.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const b=(E,D)=>{E.splice(D,1)},C=E=>{E.push({value:"",key:Math.random()*1e4})},T=X(null),M=X(0),S=X(0),k=()=>{T.value.validate().then(()=>{let E={...p,batch_node_key:r.batch_node_key},D=JSON.parse(JSON.stringify(h.value));D.forEach(N=>{N.field.typ.includes("array")&&(N.field.Vals=N.field.Vals.map(F=>F.value))}),E.batch_test_params=JSON.stringify(D),c.value=!0,l.value=[],localStorage.setItem("workflow_batch_run_test_data",JSON.stringify({...E})),Km({...E}).then(N=>{mt.success("测试结果生成完成");let F=N.data.node_logs||[];M.value=N.data.use_token,S.value=N.data.use_mills,A(F)}).catch(N=>{l.value=[];let F=N.data.node_logs||[];F&&F.length&&A(F)}).finally(()=>{c.value=!1})})},A=E=>{var D;l.value=E.map(N=>({...N,is_success:N.error_msg==="<nil>",node_icon:xa(N.node_type)})),a.value=(D=l.value[0])==null?void 0:D.node_key},$=E=>{a.value=E.node_key},B=E=>{Ts(JSON.stringify(d.value[E])),mt.success("复制成功")};function O(E){return E.field.key.replace(E.node_key+".","")}return e({open:()=>{f()}}),(E,D)=>{const N=Ai,F=ko,Y=en,L=Cn,j=Mn,le=In,z=Xt,V=xn,J=ho,oe=_n;return w(),R("div",null,[m(oe,{open:s.value,"onUpdate:open":D[5]||(D[5]=W=>s.value=W),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[u("div",hF,[D[6]||(D[6]=U("运行测试 ",-1)),l.value.length?(w(),R("div",vF,[u("span",null,"总耗时："+H(K(Kc)(S.value)),1),u("span",null,"token消耗："+H(M.value)+" Tokens",1)])):ne("",!0)])]),default:x(()=>[u("div",_F,[u("div",gF,[D[13]||(D[13]=u("div",{class:"top-title"},"开始节点参数",-1)),m(V,{model:p,ref_key:"formRef",ref:T,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[v.value?(w(),Q(L,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:x(()=>[m(F,{gap:4},{default:x(()=>[D[8]||(D[8]=U("question ",-1)),m(N,{style:{margin:"0"}},{default:x(()=>[...D[7]||(D[7]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[m(Y,{placeholder:"请输入",value:p.question,"onUpdate:value":D[0]||(D[0]=W=>p.question=W)},null,8,["value"])]),_:1})):ne("",!0),y.value?(w(),Q(L,{key:1,name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:x(()=>[m(F,{gap:4},{default:x(()=>[D[10]||(D[10]=U("openid ",-1)),m(N,{style:{margin:"0"}},{default:x(()=>[...D[9]||(D[9]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[m(Y,{placeholder:"请输入",value:p.openid,"onUpdate:value":D[1]||(D[1]=W=>p.openid=W)},null,8,["value"])]),_:1})):ne("",!0),(w(!0),R(se,null,ge(h.value,W=>(w(),Q(L,{key:W.node_key,rules:[{required:W.field.required,message:`请输入${W.node_name}`}]},{label:x(()=>[m(F,{gap:4},{default:x(()=>[U(H(W.node_name)+" "+H(O(W)),1),m(N,{style:{margin:"0"}},{default:x(()=>[U(H(W.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[W.field.typ=="string"?(w(),Q(Y,{key:0,placeholder:"请输入",value:W.field.Vals,"onUpdate:value":q=>W.field.Vals=q},null,8,["value","onUpdate:value"])):ne("",!0),W.field.typ=="number"?(w(),Q(j,{key:1,style:{width:"100%"},placeholder:"请输入",value:W.field.Vals,"onUpdate:value":q=>W.field.Vals=q},null,8,["value","onUpdate:value"])):ne("",!0),W.field.typ.includes("array")?(w(),R("div",mF,[(w(!0),R(se,null,ge(W.field.Vals,(q,re)=>(w(),R("div",{class:"input-list-item",key:re},[m(le,null,{default:x(()=>[m(Y,{placeholder:"请输入",value:q.value,"onUpdate:value":ue=>q.value=ue},null,8,["value","onUpdate:value"])]),_:2},1024),W.field.Vals.length>1?(w(),Q(K(Ut),{key:0,onClick:ue=>b(W.field.Vals,re)},null,8,["onClick"])):ne("",!0)]))),128)),u("div",yF,[m(z,{onClick:q=>C(W.field.Vals),block:"",type:"dashed"},{default:x(()=>[...D[11]||(D[11]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ne("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),c.value?(w(),R("div",bF,[c.value?(w(),Q(J,{key:0,tip:"测试结果生成中..."})):ne("",!0)])):ne("",!0),l.value.length>0?(w(),R("div",xF,[(w(!0),R(se,null,ge(l.value,(W,q)=>(w(),R("div",{class:xt(["list-item-block",{active:a.value==W.node_key}]),onClick:re=>$(W),key:q},[u("div",CF,[W.is_success?(w(),Q(K(za),{key:0,style:{color:"#138b1b"}})):(w(),Q(K(Lu),{key:1,style:{color:"#d81e06"}}))]),u("div",kF,[u("img",{src:W.node_icon,alt:""},null,8,SF),u("div",EF,H(W.node_name),1)]),W.is_success?(w(),R("div",AF,H(W.use_time)+"ms",1)):ne("",!0),u("div",DF,[m(K(Bu))])],10,wF))),128))])):ne("",!0),u("div",OF,[m(z,{loading:c.value,onClick:k,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[m(K(ai)),D[12]||(D[12]=U("运行测试",-1))]),_:1},8,["loading"])])]),u("div",NF,[d.value?(w(),R(se,{key:0},[u("div",MF,[D[14]||(D[14]=u("div",{class:"title-text"},"日志详情",-1)),u("div",TF,[u("img",{src:d.value.node_icon,alt:""},null,8,$F),u("div",RF,H(d.value.node_name),1)]),d.value.is_success?(w(),R("div",PF,H(d.value.use_time)+"ms",1)):ne("",!0)]),u("div",LF,[u("div",BF,[D[15]||(D[15]=U("输入",-1)),m(K(Po),{onClick:D[2]||(D[2]=W=>B("input"))})]),u("div",IF,[m(K(Bo),{data:d.value.input},null,8,["data"])])]),u("div",jF,[u("div",FF,[D[16]||(D[16]=U("输出",-1)),m(K(Po),{onClick:D[3]||(D[3]=W=>B("node_output"))})]),u("div",VF,[m(K(Bo),{data:d.value.node_output},null,8,["data"])])]),u("div",HF,[u("div",UF,[D[17]||(D[17]=U("运行日志",-1)),m(K(Po),{onClick:D[4]||(D[4]=W=>B("output"))})]),u("div",zF,[m(K(Bo),{data:d.value.output},null,8,["data"])])])],64)):ne("",!0)])])]),_:1},8,["open"])])}}},I_=Ne(qF,[["__scopeId","data-v-1a9300dc"]]),GF={class:"problem-optimization-form"},XF={class:"node-form-content"},WF={class:"gray-block"},YF={class:"row-form-item"},JF={class:"form-label"},KF={class:"row-form-item"},ZF={class:"form-label"},QF={class:"gray-block"},eV={class:"gray-block-title"},tV={class:"output-box"},nV={class:"array-form-box"},oV={class:"flex-block-item",style:{gap:"12px"}},iV={class:"gray-block"},rV={class:"gray-block-title"},sV={class:"output-box"},aV={class:"array-form-box"},lV={class:"flex-block-item",style:{gap:"12px"}},uV=["onClick"],dV={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Ve("getNode"),r=X([]),s=X([]),a=X(null);function l(O){return O.forEach(P=>{P.typ=="node"?P.node_type==1?P.value="global":P.value=P.node_id:P.value=P.key,P.children&&P.children.length>0&&(P.children=l(P.children))}),O}function d(){let O=i().getAllParentVariable();O=l(O),O=O.filter(P=>P.group_node_key!=P.loop_parent_key).filter(P=>P.node_id!=P.group_node_key),r.value=c(O)}function c(O){const P=E=>!E||E.length===0?[]:E.map(D=>{const N=P(D.children);return D.typ.includes("array")||N&&N.length>0?{...D,children:N}:null}).filter(Boolean);return P(O)}const p=()=>{let O=i().getAllParentVariable();O.forEach(P=>{P.tags=P.tags||[]}),O=O.filter(P=>P.group_node_key==P.loop_parent_key),s.value=l(O)},f=O=>{O||p()},h=X(),v={key:"",typ:"",value:"",_id:ls(16)},y={key:"",typ:"",value:"",_id:ls(16)},g=Je({chan_number:10,max_run_number:500,batch_arrays:[],output:[]});function _(O){if(O){let P=O.split("."),E=P[0],D=P.filter((N,F)=>F>0).join(".");return[E,D]}return[]}const b=O=>{O&&d()},C=(O,P,E)=>{E?P.typ=E[E.length-1].typ:P.typ=""},T=()=>{g.output.push({key:"",typ:"",value:"",_id:ls(16)})},M=O=>{g.output.splice(O,1)},S=(O,P)=>{if(O&&O.length){let E=s.value.filter(D=>D.value==O[0])[0].children;if(E&&E.length){let D=E.filter(N=>N.value==O[1])[0].typ;P.typ=P.typ=D.startsWith("array")?D:`array<${D}>`}}else P.typ=""},k=()=>{t("close")},A=()=>{var P;let O=g.batch_arrays[0];O&&O.key&&O.typ&&O.value?(P=a.value)==null||P.open():mt.error("请填写执行数组")},$=()=>{try{let O=o.node.dataRaw||o.node.node_params||"{}",P=JSON.parse(O).batch||{};d(),p(),g.chan_number=P.chan_number,g.max_run_number=P.max_run_number,g.batch_arrays=P.batch_arrays.map(E=>({...E,value:_(E.value)})),g.output=P.output.map(E=>({...E,value:_(E.value)})),g.batch_arrays.length==0&&(g.batch_arrays=[v]),g.output.length==0&&(g.output=[y])}catch(O){}},B=()=>{const O=JSON.stringify({batch:{...g,batch_arrays:g.batch_arrays.map(P=>({...P,value:P.value?P.value.join("."):""})),chan_number:g.chan_number,max_run_number:g.max_run_number,output:g.output.map(P=>{let E=P.value?P.value.join("."):"";return{...P,value:E}})}});t("update-node",{...o.node,node_params:O})};return ct(()=>g,()=>{B()},{deep:!0}),at(()=>{$()}),(O,P)=>{const E=Zt,D=Mn,N=en,F=li,Y=In,L=Cn,j=Xt,le=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过设定批量运行次数和逻辑，运行批处理体内的任务",onClose:k},{runBtn:x(()=>[m(E,null,{title:x(()=>[...P[2]||(P[2]=[U("运行测试",-1)])]),default:x(()=>[u("div",{class:"action-btn",onClick:A},[m(K(ai),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[u("div",GF,[u("div",XF,[m(le,{ref_key:"formRef",ref:h,layout:"vertical",model:g},{default:x(()=>[u("div",WF,[P[7]||(P[7]=u("div",{class:"gray-block-title"},[u("img",{src:pF,alt:""}),u("span",null,"执行设置")],-1)),u("div",YF,[u("div",JF,[P[4]||(P[4]=u("span",null,"并行运行数量",-1)),m(E,null,{title:x(()=>[...P[3]||(P[3]=[U("并行运行数量，最大一次执行10个",-1)])]),default:x(()=>[m(K(ft),{class:"tip-icon"})]),_:1})]),u("div",null,[m(D,{style:{width:"300px"},max:10,min:1,precision:0,step:1,placeholder:"请输入",value:g.chan_number,"onUpdate:value":P[0]||(P[0]=z=>g.chan_number=z)},null,8,["value"])])]),u("div",KF,[u("div",ZF,[P[6]||(P[6]=u("span",null,"最大执行次数",-1)),m(E,null,{title:x(()=>[...P[5]||(P[5]=[U("批量执行运行总次数不超过该上限，超过时会直接进入下一个节点",-1)])]),default:x(()=>[m(K(ft),{class:"tip-icon"})]),_:1})]),u("div",null,[m(D,{style:{width:"300px"},max:500,min:1,precision:0,step:1,placeholder:"请输入",value:g.max_run_number,"onUpdate:value":P[1]||(P[1]=z=>g.max_run_number=z)},null,8,["value"])])])]),u("div",QF,[u("div",eV,[P[9]||(P[9]=u("img",{src:fF,alt:""},null,-1)),P[10]||(P[10]=U(" 执行数组 ",-1)),m(E,null,{title:x(()=>[...P[8]||(P[8]=[U("批处理体中节点要使用的变量，仅支持引用数组，循环次数为数组的长度，执行时会按顺序输出单个数组",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",tV,[P[11]||(P[11]=u("div",{class:"output-block"},[u("div",{class:"output-item",style:{width:"25%"}},"参数Key"),u("div",{class:"output-item",style:{width:"30%"}},"类型"),u("div",{class:"output-item",style:{width:"45%"}},"参数值")],-1)),u("div",nV,[(w(!0),R(se,null,ge(g.batch_arrays,(z,V)=>(w(),R("div",{class:"form-item-list",key:z._id},[m(L,{label:null},{default:x(()=>[u("div",oV,[m(N,{style:{width:"25%"},value:z.key,"onUpdate:value":J=>z.key=J,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(Y,null,{default:x(()=>[m(N,{style:{width:"30%"},value:z.typ,"onUpdate:value":J=>z.typ=J,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),m(F,{onChange:(J,oe)=>C(J,z,oe),value:z.value,"onUpdate:value":J=>z.value=J,onDropdownVisibleChange:b,style:{width:"45%"},options:r.value,allowClear:!1,displayRender:({labels:J})=>J.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024)])]),_:2},1024)]))),128))])])]),u("div",iV,[u("div",rV,[P[13]||(P[13]=u("img",{src:Fu,alt:""},null,-1)),P[14]||(P[14]=U(" 输出 ",-1)),m(E,null,{title:x(()=>[...P[12]||(P[12]=[U("循环完成后输出的内容，仅支持引用循环体中节点的输出变量，输出的内容会自动组装为数组类型",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",sV,[P[16]||(P[16]=u("div",{class:"output-block"},[u("div",{class:"output-item",style:{width:"23%"}},"参数Key"),u("div",{class:"output-item",style:{width:"27%"}},"类型"),u("div",{class:"output-item",style:{width:"45%"}},"参数值")],-1)),u("div",aV,[(w(!0),R(se,null,ge(g.output,(z,V)=>(w(),R("div",{class:"form-item-list",key:z._id},[m(L,{label:null},{default:x(()=>[u("div",lV,[m(N,{style:{width:"25%"},value:z.key,"onUpdate:value":J=>z.key=J,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(Y,null,{default:x(()=>[m(N,{style:{width:"30%"},value:z.typ,"onUpdate:value":J=>z.typ=J,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),m(F,{onChange:J=>S(J,z),value:z.value,"onUpdate:value":J=>z.value=J,onDropdownVisibleChange:f,style:{width:"45%"},options:s.value,allowClear:!1,displayRender:({labels:J})=>J.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),u("div",{class:"btn-hover-wrap",onClick:J=>M(V)},[m(K(Ut))],8,uV)])]),_:2},1024)]))),128)),m(j,{onClick:Ct(T,["stop"]),icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...P[15]||(P[15]=[U("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])])]),m(I_,{batch_node_key:n.nodeId,ref_key:"runTestRef",ref:a},null,8,["batch_node_key"])]),_:1})}}},cV=Ne(dV,[["__scopeId","data-v-5120569a"]]),pV={class:"sub-field-item"},fV={style:{width:"200px"}},hV={class:"field-list-item"},vV={class:"field-label"},_V={class:"field-type"},gV=["onClick"],mV={key:1,class:"btn-hover-wrap",style:{opacity:"0"}},yV=["onClick"],bV={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array},variableOptions:{type:Array,default:()=>[]}},setup(n){const e=n,t=We(()=>e.level>2?e.typOptions.filter(d=>d.value!="object"):e.typOptions),o=We(()=>e.level==2?"165px":"130px"),i=(d,c)=>{c[d].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(d,c)=>{c.splice(d,1)},s=d=>{d.subs=[]},a=d=>d.typ=="object"&&e.level<=2,l=(d,c,p)=>{p.tags=c,p.desc=d};return(d,c)=>{const p=en,f=ko,h=Lt,v=$t,y=Pt("SubsKey",!0);return w(!0),R(se,null,ge(e.data,(g,_)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:g.cu_key},[u("div",pV,[m(f,null,{default:x(()=>[c[0]||(c[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(p,{style:Fn({width:o.value}),value:g.key,"onUpdate:value":b=>g.key=b,placeholder:"请输入"},null,8,["style","value","onUpdate:value"])]),_:2},1024),m(v,{onChange:b=>s(g),value:g.typ,"onUpdate:value":b=>g.typ=b,placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(!0),R(se,null,ge(t.value,b=>(w(),Q(h,{value:b.value},{default:x(()=>[U(H(b.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value"]),u("div",fV,[g.typ!="object"?(w(),Q(tt,{key:0,options:n.variableOptions,defaultSelectedList:g.tags,defaultValue:g.desc,onChange:(b,C)=>l(b,C,g),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:b,payload:C})=>[u("div",hV,[u("div",vV,H(b),1),u("div",_V,H(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])):ne("",!0)]),a(g)?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:b=>i(_,e.data)},[m(K(Bn))],8,gV)):(w(),R("div",mV,[m(K(Bn))])),u("div",{class:"btn-hover-wrap",onClick:b=>r(_,e.data)},[m(K(Ut))],8,yV)]),g.subs&&g.subs.length>0?(w(),Q(y,{key:0,level:e.level+1,typOptions:e.typOptions,variableOptions:e.variableOptions,data:g.subs},null,8,["level","typOptions","variableOptions","data"])):ne("",!0)],2))),128)}}},xV=Ne(bV,[["__scopeId","data-v-a1254e93"]]),wV={class:"problem-optimization-form"},CV={class:"node-form-content"},kV={class:"gray-block"},SV={key:0,class:"gray-block",style:{"margin-top":"12px"}},EV={class:"array-form-box"},AV={class:"form-item-list"},DV={class:"flex-block-item",style:{gap:"8px"}},OV={class:"flex-block-item",style:{gap:"8px"}},NV={style:{width:"200px"}},MV={class:"field-list-item"},TV={class:"field-label"},$V={class:"field-type"},RV=["onClick"],PV=["onClick"],LV={key:0,class:"sub-field-box"},BV={class:"gray-block",style:{"margin-top":"12px"}},IV={class:"array-form-box"},jV={class:"input-block-item"},FV={class:"input-header"},VV={key:0},HV={key:1},UV={key:2},zV=["onClick"],qV={class:"field-list-item"},GV={class:"field-label"},XV={class:"field-type"},WV={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i={text:"请输入文本消息内容，键入/可以插入变量",image:"请输入图片消息的url（系统发送时会自动转成图片发送），键入/可插入变量",voice:"请输入语音的url（系统发送时会自动转成语音发送），键入/可插入变量"},r=[{label:"返回消息",value:"message"},{label:"返回消息和变量",value:"variable"}],s=X([]),a=Je({}),l=($,B)=>{if($){let O=`at_input_${B}`;a[O]=$}},d=($,B,O)=>{O.tags=B,O.content=$},c=($,B,O)=>{O.tags=B,O.desc=$},p=()=>{const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();B.forEach(O=>{O.tags=O.tags||[]}),s.value=B}};function f($){return $.typ?h(s.value,$.typ):s.value}function h($,B){function O(P){const E=[];for(const D of P)if(D.children&&D.children.length>0){const N=O(D.children);if(N.length>0){const F={...D,children:N};E.push(F)}}else D.typ&&D.typ===B&&E.push({...D});return E}return O($)}const v=Je({out_type:"message",messages:[{key:Ht(16),type:"text",content:""}],outputs:[{key:"",typ:"",subs:[]}]}),y=()=>{const $=JSON.stringify({finish:{...v}});t("update-node",{...o.node,node_params:$})},g=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).finish||{};B=JSON.parse(JSON.stringify(B)),p(),v.out_type=B.out_type||"message",v.messages=B.messages||[],v.messages.length==0&&(v.messages=[{key:Ht(16),type:"text",content:""}]),v.outputs=B.outputs||[]}catch($){}};ct(()=>v,()=>{y()},{deep:!0});const _=$=>{if(v.messages.length>=5)return mt.warning("最多添加5条消息");v.messages.push({key:Ht(16),type:$,content:""})},b=$=>{if(v.messages.length<=1)return mt.warning("最少添加1条消息");v.messages.splice($,1)},C=()=>{t("close")},T=()=>{v.outputs.push({key:"",typ:"string",subs:[],cu_key:Ht(16)})},M=$=>{v.outputs.splice($,1)},S=$=>{$.subs=[],$.desc=void 0,$.tags=[]},k=$=>{v.outputs[$].subs.push({key:"",value:"",subs:[],cu_key:Ht(16)})},A=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return at(()=>{g()}),($,B)=>{const O=Jc,P=en,E=Lt,D=$t,N=In,F=Cn,Y=Xt,L=Vr,j=Fr,le=Hr,z=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"工作流完结的节点，在此节点可以定义工作流返回的信息",onClose:C},null,8,["title","iconName"])]),default:x(()=>[u("div",wV,[u("div",CV,[m(z,{ref:"formRef",layout:"vertical",model:v},{default:x(()=>[u("div",kV,[B[4]||(B[4]=u("div",{class:"gray-block-title"},"输出类型",-1)),m(O,{class:"customer-segmented",value:v.out_type,"onUpdate:value":B[0]||(B[0]=V=>v.out_type=V),options:r},null,8,["value"])]),v.out_type=="variable"?(w(),R("div",SV,[B[8]||(B[8]=u("div",{class:"gray-block-title"},"输出变量",-1)),u("div",EV,[B[7]||(B[7]=u("div",{class:"field-key-title"},[u("div",{class:"field-key",style:{width:"200px"}},"参数key"),u("div",{class:"field-key",style:{width:"114px"}},"类型"),u("div",{class:"field-key",style:{flex:"1"}},"参数值")],-1)),u("div",AV,[m(F,{label:null},{default:x(()=>[u("div",DV,[m(P,{style:{width:"200px"},disabled:"",value:"content",placeholder:"请输入"}),m(N,null,{default:x(()=>[m(D,{value:"string",disabled:"",placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(),R(se,null,ge(A,V=>m(E,{value:V.value,key:V.value},{default:x(()=>[U(H(V.value),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1}),u("div",null,[m(K(Yc),{style:{color:"#faad14"}}),B[5]||(B[5]=U(" content的返回值请在下方消息中设置 ",-1))])])]),_:1})]),(w(!0),R(se,null,ge(v.outputs,(V,J)=>(w(),R("div",{class:"form-item-list",key:J},[m(F,{label:null},{default:x(()=>[u("div",OV,[m(P,{style:{width:"200px"},value:V.key,"onUpdate:value":oe=>V.key=oe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(N,null,{default:x(()=>[m(D,{onChange:oe=>S(V),value:V.typ,"onUpdate:value":oe=>V.typ=oe,placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(),R(se,null,ge(A,oe=>m(E,{value:oe.value,key:oe.value},{default:x(()=>[U(H(oe.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),u("div",NV,[V.typ!="object"?(w(),Q(tt,{key:0,options:f(V),defaultSelectedList:V.tags,defaultValue:V.desc,onOpen:p,onChange:(oe,W)=>c(oe,W,V,J),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:oe,payload:W})=>[u("div",MV,[u("div",TV,H(oe),1),u("div",$V,H(W.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])):ne("",!0)]),V.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:oe=>k(J)},[m(K(Bn))],8,RV)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:oe=>M(J)},[m(K(Ut))],8,PV)]),V.subs&&V.subs.length>0?(w(),R("div",LV,[m(N,null,{default:x(()=>[m(xV,{data:V.subs,level:2,typOptions:A,variableOptions:s.value},null,8,["data","variableOptions"])]),_:2},1024)])):ne("",!0)]),_:2},1024)]))),128)),m(Y,{onClick:T,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...B[6]||(B[6]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ne("",!0),u("div",BV,[B[13]||(B[13]=u("div",{class:"gray-block-title"},"自定义消息",-1)),u("div",IV,[B[12]||(B[12]=u("div",{class:"form-item-label",style:{"margin-bottom":"8px"}}," 未自定义消息内容，系统默认将结束节点的上一级大模型节点的输出或者指 定回复节点的输出作为消息返回。最多添加5条消息。 ",-1)),(w(!0),R(se,null,ge(v.messages,(V,J)=>(w(),R("div",{class:"form-item-list",key:J},[m(F,{label:null},{default:x(()=>[u("div",jV,[u("div",FV,[u("div",null,[U(H(J+1)+"、 ",1),V.type=="text"?(w(),R("span",VV,"文本消息")):ne("",!0),V.type=="image"?(w(),R("span",HV,"图片消息")):ne("",!0),V.type=="voice"?(w(),R("span",UV,"语音消息")):ne("",!0)]),u("div",{class:"btn-hover-wrap",onClick:oe=>b(J)},[m(K(Ut))],8,zV)]),m(tt,{inputStyle:"height: 100px;",ref_for:!0,ref:oe=>l(oe,J),options:s.value,defaultSelectedList:V.tags,defaultValue:V.content,onOpen:p,type:"textarea",onChange:(oe,W)=>d(oe,W,V,J),placeholder:i[V.type]},{option:x(({label:oe,payload:W})=>[u("div",qV,[u("div",GV,H(oe),1),u("div",XV,H(W.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])])]),_:2},1024)]))),128)),m(le,null,{overlay:x(()=>[m(j,null,{default:x(()=>[m(L,{onClick:B[1]||(B[1]=V=>_("text"))},{default:x(()=>[...B[9]||(B[9]=[u("a",null,"文本",-1)])]),_:1}),m(L,{onClick:B[2]||(B[2]=V=>_("image"))},{default:x(()=>[...B[10]||(B[10]=[u("a",null,"图片",-1)])]),_:1}),m(L,{onClick:B[3]||(B[3]=V=>_("voice"))},{default:x(()=>[...B[11]||(B[11]=[u("a",null,"语音",-1)])]),_:1})]),_:1})]),default:x(()=>[u("div",null,[m(Y,{type:"dashed",block:""},{default:x(()=>[m(K(Mt)),U("添加消息 （"+H(v.messages.length)+" / 5）",1)]),_:1})])]),_:1})])])]),_:1},8,["model"])])])]),_:1})}}},YV=Ne(WV,[["__scopeId","data-v-45bb4bd1"]]),Ar=[{label:"关闭",value:!1},{label:"开启",value:!0}],il=[{label:"男生",value:"male-qn-jingying"},{label:"女生",value:"female-chengshu"},{label:"男童",value:"clever_boy"},{label:"女童",value:"lovely_girl"}],JV={happy:"高兴",sad:"悲伤",angry:"愤怒",fearful:"害怕",disgusted:"厌恶",surprised:"惊讶",calm:"中性",fluent:"生动",whisper:"低语"},KV=[8e3,16e3,22050,24e3,32e3,44100],ZV=[32e3,64e3,128e3,256e3],QV=["mp3","pcm","flac","wav"],eH=[{label:"单声道",value:1},{label:"双声道",value:2}],tH={url:"url",hex:"hex"},nH={spacious_echo:"空旷回音",auditorium_echo:"礼堂广播",lofi_telephone:"电话失真",robotic:"电音"},j_={auto:"自动检测",Chinese:"中文",Yue:"粤语",English:"英语",Arabic:"阿拉伯语",Russian:"俄语",Spanish:"西班牙语",French:"法语",Portuguese:"葡萄牙语",German:"德语",Turkish:"土耳其语",Dutch:"荷兰语",Ukrainian:"乌克兰语",Vietnamese:"越南语",Indonesian:"印度尼西亚语",Japanese:"日语",Italian:"意大利语",Korean:"韩语",Thai:"泰语",Polish:"波兰语",Romanian:"罗马尼亚语",Greek:"希腊语",Czech:"捷克语",Finnish:"芬兰语",Hindi:"印地语",Bulgarian:"保加利亚语",Danish:"丹麦语",Hebrew:"希伯来语",Malay:"马来语",Persian:"波斯语",Slovak:"斯洛伐克语",Swedish:"瑞典语",Croatian:"克罗地亚语",Filipino:"菲律宾语",Hungarian:"匈牙利语",Norwegian:"挪威语",Slovenian:"斯洛文尼亚语",Catalan:"加泰罗尼亚语",Nynorsk:"新挪威语",Tamil:"泰米尔语",Afrikaans:"南非荷兰语"},pi={speed:{ui_type:"slider",key:"voice_setting.speed",label:"语速",type:"number",required:!0,tooltip:"合成音频的语速，取值范围 [0.5, 2]，默认值为 1.0",default:1,min:.5,max:2,step:.1,marks:{.5:"0.5",2:"2"}},vol:{ui_type:"slider",key:"voice_setting.vol",label:"音量",type:"number",required:!0,tooltip:"合成音频的音量，取值越大，音量越高。取值范围 (0,10]，默认值为 1",default:1,min:0,max:10,step:1,marks:{0:"0",10:"10"}},pitch:{ui_type:"slider",key:"voice_setting.pitch",label:"音高",type:"number",required:!0,tooltip:"合成音频的语调，取值范围 [-12,12]，默认值为 0，其中 0 为原音色输出",default:0,min:-12,max:12,step:1,marks:{"-12":"-12",12:"12"}}},fi={pitch:{ui_type:"slider",key:"voice_modify.pitch",label:"音高",type:"number",tooltip:"音高调整（低沉/明亮），范围 [-100,100]，数值接近 -100，声音更低沉；接近 100，声音更明亮",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},intensity:{ui_type:"slider",key:"voice_modify.intensity",label:"强度",type:"number",tooltip:"强度调整（力量感/柔和），范围 [-100,100]，数值接近 -100，声音更刚劲；接近 100，声音更轻柔",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},timbre:{ui_type:"slider",key:"voice_modify.timbre",label:"音色",type:"number",tooltip:"音色调整（磁性/清脆），范围 [-100,100]，数值接近 -100，声音更浑厚；数值接近 100，声音更清脆",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}}},oH={data:{desc:"音频合成结果",type:"object",properties:{audio:{desc:"音频数据（hex 编码）",type:"string"},status:{desc:"音频合成状态",type:"number"}}},extra_info:{desc:"音频附加信息",type:"object",properties:{audio_length:{desc:"音频时长（毫秒）",type:"number"},audio_sample_rate:{desc:"音频采样率",type:"number"},audio_size:{desc:"音频大小（字节）",type:"number"},bitrate:{desc:"音频码率",type:"number"},word_count:{desc:"文本字数",type:"number"},invisible_character_ratio:{desc:"不可见字符比例",type:"number"},usage_characters:{desc:"实际消耗字符数",type:"number"},audio_format:{desc:"音频格式",type:"string"},audio_channel:{desc:"音频声道数",type:"number"}}},trace_id:{desc:"请求追踪 ID",type:"string"},base_resp:{desc:"基础响应信息",type:"object",properties:{status_code:{desc:"状态码，0 表示成功",type:"number"},status_msg:{desc:"状态描述",type:"string"}}}},iH={input_sensitive:{desc:"输入内容是否命中敏感信息",type:"boolean"},input_sensitive_type:{desc:"敏感类型标识（0 表示无敏感）",type:"number"},demo_audio:{desc:"示例音频数据",type:"string"},base_resp:{desc:"基础响应信息",type:"object",properties:{status_code:{desc:"状态码，0 表示成功",type:"number"},status_msg:{desc:"状态描述",type:"string"}}}},rH={class:"node-options"},sH={class:"options-item is-required"},aH={class:"field-list-item"},lH={class:"field-label"},uH={class:"field-type"},dH={class:"options-item is-required"},cH={class:"field-list-item"},pH={class:"field-label"},fH={class:"field-type"},hH={class:"options-item"},vH={class:"options-item-tit flex-between"},_H={class:"options-item"},gH={class:"form-box"},mH={class:"form-item"},yH={class:"form-tit"},bH={class:"form-cont"},xH={class:"field-list-item"},wH={class:"field-label"},CH={class:"field-type"},kH={class:"form-item"},SH={class:"form-tit"},EH={class:"form-cont"},AH={class:"field-list-item"},DH={class:"field-label"},OH={class:"field-type"},NH={class:"options-item"},MH={class:"form-box"},TH={class:"form-item"},$H={class:"form-tit"},RH={class:"form-cont"},PH={class:"field-list-item"},LH={class:"field-label"},BH={class:"field-type"},IH={class:"form-item"},jH={class:"form-tit"},FH={class:"form-cont"},VH={class:"options-item"},HH={class:"form-box"},UH={class:"form-item"},zH={class:"form-tit c262626"},qH={class:"form-cont"},GH={class:"options-item"},XH={class:"form-box"},WH={class:"form-item"},YH={class:"form-tit"},JH={class:"form-cont"},KH={class:"form-item"},ZH={class:"form-tit"},QH={class:"form-cont"},eU={class:"form-item"},tU={class:"form-tit"},nU={class:"form-cont"},oU={class:"node-options"},iU={class:"options-item"},rU={__name:"voice-clone-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=Ve("getNode"),o=Ve("setData");X(null);const i=X([]),r=X([]);X([]);const s=Je({model_id:0,model:"",model_config_id:0,file_url:"",voice_id:"",clone_prompt:{prompt_audio_url:"",prompt_text:"",tag_map:{}},text:"",language_boost:"auto",need_noise_reduction:!1,need_volume_normalization:!1,aigc_watermark:!1,tag_map:{}}),a=X(!1);at(()=>{l()});function l(){c(),r.value=Di(iH),d()}function d(){var g;let v=JSON.parse(e.node.node_params),y=((g=v==null?void 0:v.voice_clone)==null?void 0:g.arguments)||{};y.tag_map=y.tag_map?y.tag_map:{},Object.assign(s,y)}function c(){i.value=t().getAllParentVariable()}function p(v,y,g,_=null){_=_||s,_[v]=y,s.tag_map[v]=g,h()}function f(){a.value=!a.value}function h(){let v=JSON.parse(e.node.node_params);s.model_id=Number(s.model_id||0),Object.assign(v.voice_clone,{model_config_id:s.model_config_id,arguments:s,output:r.value}),o({...e.node,node_params:JSON.stringify(v)})}return(v,y)=>{const g=Zt,_=Lt,b=$t;return w(),Q(tn,null,{default:x(()=>{var C,T,M,S,k;return[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"支持音色快速复制"},null,8,["title","iconName"]),u("div",rH,[y[27]||(y[27]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),u("div",sH,[y[12]||(y[12]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"复刻音频文件"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((C=s.tag_map)==null?void 0:C.file_url)||[],defaultValue:s.file_url,ref:"atInputRef",placeholder:"输入文件的url，键入/插入变量",onOpen:c,onChange:y[0]||(y[0]=(A,$)=>p("file_url",A,$))},{option:x(({label:A,payload:$})=>[u("div",aH,[u("div",lH,H(A),1),u("div",uH,H($.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),y[13]||(y[13]=u("div",{class:"desc"},"待复刻音频",-1))]),u("div",dH,[y[14]||(y[14]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"音频ID"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((T=s.tag_map)==null?void 0:T.voice_id)||[],defaultValue:s.voice_id,ref:"atInputRef",placeholder:"请输入参数值，键入/插入变量",onOpen:c,onChange:y[1]||(y[1]=(A,$)=>p("voice_id",A,$))},{option:x(({label:A,payload:$})=>[u("div",cH,[u("div",pH,H(A),1),u("div",fH,H($.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),y[15]||(y[15]=u("div",{class:"desc"},'克隆音色的 voice_id，正确示例：“MiniMax001"”，长度范围［8,256］，首字符必须为英文字母允许数字、字母、_未位字符不可为-._，不可与已有id 重复',-1))]),u("div",hH,[u("div",vH,[y[17]||(y[17]=u("div",{class:"option-label"},"复刻示例音频",-1)),u("a",{onClick:f},[y[16]||(y[16]=U("高级设置 ",-1)),a.value?(w(),Q(K(Ua),{key:1})):(w(),Q(K(xo),{key:0}))])])]),a.value?(w(),R(se,{key:0},[u("div",_H,[u("div",gH,[u("div",mH,[u("div",yH,[m(g,{title:"音色复刻示例音频，提供本参数将有助于增强语音合成的音色相似度和稳定性"},{default:x(()=>[y[18]||(y[18]=U(" 音频文件 ",-1)),m(K(ft))]),_:1})]),u("div",bH,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((M=s.tag_map)==null?void 0:M.prompt_audio_url)||[],defaultValue:s.clone_prompt.prompt_audio_url,ref:"atInputRef",placeholder:"输入文件的url，键入/插入变量",onOpen:c,onChange:y[2]||(y[2]=(A,$)=>p("prompt_audio_url",A,$,s.clone_prompt))},{option:x(({label:A,payload:$})=>[u("div",xH,[u("div",wH,H(A),1),u("div",CH,H($.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),u("div",kH,[u("div",SH,[m(g,{title:"示例音频的对应文本，需确保和音频内容一致，句末需有标点符号做结尾"},{default:x(()=>[y[19]||(y[19]=U(" 文本 ",-1)),m(K(ft))]),_:1})]),u("div",EH,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((S=s.tag_map)==null?void 0:S.prompt_text)||[],defaultValue:s.clone_prompt.prompt_text,ref:"atInputRef",placeholder:"输入示例音频的对应文本，键入/插入变量",onOpen:c,onChange:y[3]||(y[3]=(A,$)=>p("prompt_text",A,$,s.clone_prompt))},{option:x(({label:A,payload:$})=>[u("div",AH,[u("div",DH,H(A),1),u("div",OH,H($.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])])])]),u("div",NH,[y[22]||(y[22]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"复刻试听参数")],-1)),u("div",MH,[u("div",TH,[u("div",$H,[m(g,{title:"复刻试听参数，限制 1000 字符以内。模型将使用复刻后的音色朗读本段文本内容，并返回试听音频链接。"},{default:x(()=>[y[20]||(y[20]=U(" 文本 ",-1)),m(K(ft))]),_:1})]),u("div",RH,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((k=s.tag_map)==null?void 0:k.text)||[],defaultValue:s.text,ref:"atInputRef",placeholder:"输入复刻试听的文本，键入/插入变量",onOpen:c,onChange:y[4]||(y[4]=(A,$)=>p("text",A,$))},{option:x(({label:A,payload:$})=>[u("div",PH,[u("div",LH,H(A),1),u("div",BH,H($.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),u("div",IH,[u("div",jH,[m(g,{title:"是否增强对指定的小语种和方言的识别能力。默认值为 null，可设置为 auto 让模型自主判断。"},{default:x(()=>[y[21]||(y[21]=U(" 小语种识别能力 ",-1)),m(K(ft))]),_:1})]),u("div",FH,[m(b,{value:s.language_boost,"onUpdate:value":y[5]||(y[5]=A=>s.language_boost=A),placeholder:"请选择",onChange:h},{default:x(()=>[(w(!0),R(se,null,ge(K(j_),(A,$)=>(w(),Q(_,{key:$,value:$},{default:x(()=>[U(H(A),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),u("div",VH,[u("div",HH,[u("div",UH,[u("div",zH,[m(g,{title:"指定合成试听音频使用的语音模型，提供 text(文本) 字段时必传此字段"},{default:x(()=>[y[23]||(y[23]=U(" 试听音频语音模型 ",-1)),m(K(ft))]),_:1})]),u("div",qH,[m(lr,{style:{width:"276px"},"model-type":"TTS",modeName:s.model,"onUpdate:modeName":y[6]||(y[6]=A=>s.model=A),modeId:s.model_id,"onUpdate:modeId":y[7]||(y[7]=A=>s.model_id=A),useConfigId:s.model_config_id,"onUpdate:useConfigId":y[8]||(y[8]=A=>s.model_config_id=A),onChange:h},null,8,["modeName","modeId","useConfigId"])])])])]),u("div",GH,[u("div",XH,[u("div",WH,[u("div",YH,[m(g,{title:"音频复刻参数，表示是否开启降噪"},{default:x(()=>[y[24]||(y[24]=U(" 降噪 ",-1)),m(K(ft))]),_:1})]),u("div",JH,[m(Mo,{value:s.need_noise_reduction,"onUpdate:value":y[9]||(y[9]=A=>s.need_noise_reduction=A),options:K(Ar),onChange:h},null,8,["value","options"])])]),u("div",KH,[u("div",ZH,[m(g,{title:"音频复刻参数，是否开启音量归一化"},{default:x(()=>[y[25]||(y[25]=U(" 音量归一化 ",-1)),m(K(ft))]),_:1})]),u("div",QH,[m(Mo,{value:s.need_volume_normalization,"onUpdate:value":y[10]||(y[10]=A=>s.need_volume_normalization=A),options:K(Ar),onChange:h},null,8,["value","options"])])]),u("div",eU,[u("div",tU,[m(g,{title:"是否在合成试听音频的末尾添加音频节奏标识"},{default:x(()=>[y[26]||(y[26]=U(" 音频节奏标识 ",-1)),m(K(ft))]),_:1})]),u("div",nU,[m(Mo,{value:s.aigc_watermark,"onUpdate:value":y[11]||(y[11]=A=>s.aigc_watermark=A),options:K(Ar),onChange:h},null,8,["value","options"])])])])])],64)):ne("",!0)]),u("div",oU,[y[28]||(y[28]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",iU,[m(Oi,{"tree-data":r.value},null,8,["tree-data"])])])]}),_:1})}}},sU=Ne(rU,[["__scopeId","data-v-5f428456"]]);function aU(n={}){return Uc.get({url:"/manage/getMiniMaxVoiceList",params:n})}const lU={class:"zm-line2"},uU={__name:"select-voice-modal",props:{modelConfigId:{type:[Number,String]},voiceType:{type:String,default:"all"}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(!1),s=X(!1),a=X(""),l=X([]),d=X([]),c=X([]),p=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"名称",dataIndex:"voice_name",width:120},{title:"ID",dataIndex:"voice_id",width:80},{title:"描述",dataIndex:"description",width:200}],f=We(()=>a.value?l.value.filter(_=>_.voice_name.indexOf(a.value)>-1||_.voice_id==a.value):l.value);function h(_=[]){d.value=_,v(),r.value=!0}function v(){s.value=!0,aU({model_config_id:i.modelConfigId,voice_type:i.voiceType}).then(_=>{l.value=(_==null?void 0:_.data)||[],l.value.forEach((b,C)=>{var T;b.index=C+1,b.description=((T=b==null?void 0:b.description)==null?void 0:T[0])||""}),c.value=l.value.filter(b=>d.value.includes(b.voice_id))}).finally(()=>{s.value=!1})}function y(_,b){d.value=_,c.value=b}function g(){o("change",Xn(d.value),Xn(c.value)),r.value=!1}return e({show:h}),(_,b)=>{const C=en,T=Zt,M=Ur,S=_n;return w(),Q(S,{open:r.value,"onUpdate:open":b[1]||(b[1]=k=>r.value=k),title:"选择音色",width:"670px",onOk:g},{default:x(()=>[m(C,{value:a.value,"onUpdate:value":b[0]||(b[0]=k=>a.value=k),valueModifiers:{trim:!0},placeholder:"请输入音色名称/ID搜索","allow-clear":"",style:{width:"240px"}},{suffix:x(()=>[m(K(r_))]),_:1},8,["value"]),m(M,{class:"mt16",loading:s.value,columns:p,"data-source":f.value,pagination:!1,"row-key":"voice_id","row-selection":{type:"radio",selectedRowKeys:d.value,onChange:y},scroll:{y:500}},{bodyCell:x(({column:k,record:A})=>[k.dataIndex==="description"?(w(),Q(T,{key:0,title:A.description},{default:x(()=>[u("div",lU,H(A.description),1)]),_:2},1032,["title"])):ne("",!0)]),_:1},8,["loading","data-source","row-selection"])]),_:1},8,["open"])}}},dU=Ne(uU,[["__scopeId","data-v-fe60fd78"]]),cU={class:"node-options"},pU={class:"options-item is-required"},fU={class:"options-item is-required"},hU={class:"field-list-item"},vU={class:"field-label"},_U={class:"field-type"},gU={class:"options-item is-required"},mU={class:"flex-between"},yU={class:"options-item is-required"},bU={class:"flex-between"},xU={class:"field-list-item"},wU={class:"field-label"},CU={class:"field-type"},kU={class:"options-item"},SU={class:"form-box"},EU={class:"option-type"},AU={class:"form-cont"},DU={class:"form-item"},OU={class:"form-tit required"},NU={class:"form-cont"},MU={class:"form-item"},TU={class:"form-tit required"},$U={class:"form-cont"},RU={class:"options-item"},PU={class:"form-box"},LU={class:"form-item"},BU={class:"form-tit"},IU={class:"form-cont"},jU={class:"form-item"},FU={class:"form-tit"},VU={class:"form-cont"},HU={class:"form-item"},UU={class:"form-tit"},zU={class:"form-cont"},qU={class:"form-item"},GU={class:"form-tit"},XU={class:"form-cont"},WU={class:"options-item"},YU={class:"form-box"},JU={class:"option-type"},KU={class:"form-cont"},ZU={class:"form-item"},QU={class:"form-tit"},ez={class:"form-cont"},tz={class:"options-item"},nz={class:"form-box"},oz={class:"form-item"},iz={class:"form-tit"},rz={class:"form-cont"},sz={class:"form-item"},az={class:"form-tit"},lz={class:"form-cont"},uz={class:"form-item"},dz={class:"form-tit"},cz={class:"form-cont"},pz={class:"form-item"},fz={class:"form-tit"},hz={class:"form-cont"},vz={class:"form-item"},_z={class:"form-tit"},gz={class:"form-cont"},mz={class:"node-options"},yz={class:"options-item"},bz={__name:"voice-synthesis-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=Ve("getNode"),o=Ve("setData"),i=X(null),r=X([]),s=X([]),a=X([]),l=Je({model_id:0,use_model:"",model_config_id:0,text:"",voice_set_type:1,voice_setting:{voice_id:"male-qn-jingying",voice_name:"",speed:1,vol:1,pitch:0,emotion:"happy",text_normalization:!1},audio_setting:{sample_rate:32e3,bitrate:128e3,format:"mp3",channel:1,force_cbr:!1},voice_modify:{pitch:0,intensity:0,timbre:0,sound_effects:""},language_boost:"auto",output_format:"url",subtitle_enable:!1,aigc_watermark:!1,tag_map:{}}),d=X(!1),c=We(()=>{var B,O;const k=l.voice_setting.voice_id,$=il.some(P=>P.value==k)?"-1":((O=(B=a.value)==null?void 0:B[0])==null?void 0:O.voice_id)??k;return[...il,{label:"自定义",value:$}]}),p=We(()=>[...il,...a.value.map(k=>({label:k.voice_name,value:k.voice_id}))]);at(()=>{f()});function f(){v(),s.value=Di(oH),h()}function h(){var $,B;let k=JSON.parse(e.node.node_params),A=(($=k==null?void 0:k.text_to_audio)==null?void 0:$.arguments)||{};if(A.tag_map=A.tag_map?A.tag_map:{},Object.assign(l,A),(B=l.voice_setting)!=null&&B.voice_id&&il.findIndex(O=>{var P;return O.value==((P=l.voice_setting)==null?void 0:P.voice_id)})<0){const{voice_id:O,voice_name:P}=l.voice_setting;a.value=[{voice_id:O,voice_name:P}]}}function v(){r.value=t().getAllParentVariable()}function y(k,A,$){l[k]=A,l.tag_map[k]=$,S()}function g(k,A){l.voice_setting.voice_id=k,l.tag_map.voice_setting_voice_id=A,S()}function _(){if(!l.model_config_id)return mt.warning("请先选择语音模型");i.value.show([l.voice_setting.voice_id])}function b(){l.voice_setting.voice_id="male-qn-jingying",S()}function C(){S()}function T(k,A){l.voice_setting.voice_id=k[0],l.voice_setting.voice_name=A[0].voice_name,a.value=A,S()}function M(){d.value=!d.value}function S(){let k=JSON.parse(e.node.node_params);l.model_id=Number(l.model_id||0),Object.assign(k.text_to_audio,{voice_type:"all",model_config_id:l.model_config_id,arguments:l,output:s.value}),o({...e.node,node_params:JSON.stringify(k)})}return(k,A)=>{const $=Zt,B=Lt,O=$t,P=$s,E=hy,D=Mn,N=fy;return w(),Q(tn,null,{default:x(()=>{var F,Y;return[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。"},null,8,["title","iconName"]),u("div",cU,[A[50]||(A[50]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),u("div",pU,[A[19]||(A[19]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"语音模型")],-1)),m(lr,{"model-type":"TTS",modeName:l.use_model,"onUpdate:modeName":A[0]||(A[0]=L=>l.use_model=L),modeId:l.model_id,"onUpdate:modeId":A[1]||(A[1]=L=>l.model_id=L),useConfigId:l.model_config_id,"onUpdate:useConfigId":A[2]||(A[2]=L=>l.model_config_id=L),onChange:b},null,8,["modeName","modeId","useConfigId"])]),u("div",fU,[A[20]||(A[20]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"文本"),u("div",{class:"option-type"},"string")],-1)),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:((F=l.tag_map)==null?void 0:F.text)||[],defaultValue:l.text,ref:"atInputRef",onOpen:v,onChange:A[3]||(A[3]=(L,j)=>y("text",L,j))},{option:x(({label:L,payload:j})=>[u("div",hU,[u("div",vU,H(L),1),u("div",_U,H(j.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),A[21]||(A[21]=u("div",{class:"desc"},"需要合成语音的文本，长度限制小于 10000字符；文本长度尽量不要超过3000字，否则生成速度较慢",-1))]),u("div",gU,[A[22]||(A[22]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"选择音色")],-1)),u("div",mU,[m(Mo,{value:l.voice_setting.voice_id,"onUpdate:value":A[4]||(A[4]=L=>l.voice_setting.voice_id=L),options:c.value,onChange:S},null,8,["value","options"]),m($,{title:"高级设置"},{default:x(()=>[u("span",{class:"setting-icon",onClick:M},[m(K(Gc))])]),_:1})])]),u("div",yU,[A[26]||(A[26]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"音色设置"),u("div",{class:"option-type"},"string")],-1)),u("div",bU,[m(O,{value:l.voice_set_type,"onUpdate:value":A[5]||(A[5]=L=>l.voice_set_type=L),onChange:C},{default:x(()=>[m(B,{value:1},{default:x(()=>[...A[23]||(A[23]=[U("选择音色",-1)])]),_:1}),m(B,{value:2},{default:x(()=>[...A[24]||(A[24]=[U("设置音色",-1)])]),_:1})]),_:1},8,["value"]),l.voice_set_type==1?(w(),Q(O,{key:0,value:l.voice_setting.voice_id,"onUpdate:value":A[6]||(A[6]=L=>l.voice_setting.voice_id=L),open:!1,onDropdownVisibleChange:_,style:{width:"100%"}},{default:x(()=>[m(B,{value:"-1"},{default:x(()=>[...A[25]||(A[25]=[U("请选择",-1)])]),_:1}),(w(!0),R(se,null,ge(p.value,L=>(w(),Q(B,{value:L.value,key:L.item},{default:x(()=>[U(H(L.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Q(tt,{key:1,type:"textarea",inputStyle:"height: 33px",options:r.value,defaultSelectedList:((Y=l.tag_map)==null?void 0:Y.voice_setting_voice_id)||[],defaultValue:l.voice_setting.voice_id,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:v,onChange:g},{option:x(({label:L,payload:j})=>[u("div",xU,[u("div",wU,H(L),1),u("div",CU,H(j.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))])]),d.value?(w(),R(se,{key:0},[u("div",kU,[A[30]||(A[30]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"声音设置")],-1)),u("div",SU,[(w(),R(se,null,ge(["speed","vol","pitch"],L=>u("div",{key:L,class:"form-item"},[u("div",{class:xt(["form-tit",{required:K(pi)[L]}.required])},[m($,{title:K(pi)[L].tooltip},{default:x(()=>[U(H(K(pi)[L].label)+" ",1),m(K(ft)),u("span",EU,H(K(pi)[L].type),1)]),_:2},1032,["title"])],2),u("div",AU,[m(N,null,{default:x(()=>[m(E,{span:15},{default:x(()=>[m(P,{value:l.voice_setting[L],"onUpdate:value":j=>l.voice_setting[L]=j,step:K(pi)[L].step,min:K(pi)[L].min,max:K(pi)[L].max,marks:K(pi)[L].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),m(E,{span:7},{default:x(()=>[m(D,{value:l.voice_setting[L],"onUpdate:value":j=>l.voice_setting[L]=j,placeholder:"请输入",min:K(pi)[L].min,max:K(pi)[L].max,class:"ml16"},null,8,["value","onUpdate:value","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),u("div",DU,[u("div",OU,[m($,{title:"控制合成语音的情绪，模型会根据输入文本自动匹配合适的情绪，一般无需手动指定；该参数仅对 speech-2.6-hd, speech-2.6-turbo, speech-02-hd, speech-02-turbo, speech-01-hd, speech-01-turbo 模型生效"},{default:x(()=>[A[27]||(A[27]=U(" 情绪 ",-1)),m(K(ft)),A[28]||(A[28]=u("span",{class:"option-type"},"string",-1))]),_:1})]),u("div",NU,[m(O,{value:l.voice_setting.emotion,"onUpdate:value":A[7]||(A[7]=L=>l.voice_setting.emotion=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(JV),(L,j)=>(w(),Q(B,{key:j},{default:x(()=>[U(H(L),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),u("div",MU,[u("div",TU,[m($,{title:"是否启用中文、英语文本规范化，开启后可提升数字阅读场景的性能，但会略微增加延迟，默认值为 false"},{default:x(()=>[A[29]||(A[29]=U(" 中/英文本规范化 ",-1)),m(K(ft))]),_:1})]),u("div",$U,[m(Mo,{value:l.voice_setting.text_normalization,"onUpdate:value":A[8]||(A[8]=L=>l.voice_setting.text_normalization=L),options:K(Ar),onChange:S},null,8,["value","options"])])])])]),u("div",RU,[A[39]||(A[39]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"音频设置")],-1)),u("div",PU,[u("div",LU,[u("div",BU,[m($,{title:"生成音频的采样率。可选范围[8000，16000，22050，24000，32000，44100]，默认为 32000"},{default:x(()=>[A[31]||(A[31]=U(" 采样率 ",-1)),m(K(ft))]),_:1}),A[32]||(A[32]=u("span",{class:"option-type"},"Number",-1))]),u("div",IU,[m(O,{value:l.audio_setting.sample_rate,"onUpdate:value":A[9]||(A[9]=L=>l.audio_setting.sample_rate=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(KV),L=>(w(),Q(B,{key:L},{default:x(()=>[U(H(L),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),u("div",jU,[u("div",FU,[m($,{title:"生成音频的比特率。可选范围[32000，64000，128000，256000]，默认值为 128000。该参数仅对 mp3 格式的音频生效"},{default:x(()=>[A[33]||(A[33]=U(" 比特率 ",-1)),m(K(ft))]),_:1}),A[34]||(A[34]=u("span",{class:"option-type"},"Number",-1))]),u("div",VU,[m(O,{value:l.audio_setting.bitrate,"onUpdate:value":A[10]||(A[10]=L=>l.audio_setting.bitrate=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(ZV),L=>(w(),Q(B,{key:L},{default:x(()=>[U(H(L),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),u("div",HU,[u("div",UU,[m($,{title:"生成音频的格式，wav 仅在非流式输出下支持"},{default:x(()=>[A[35]||(A[35]=U(" 格式 ",-1)),m(K(ft))]),_:1}),A[36]||(A[36]=u("span",{class:"option-type"},"string",-1))]),u("div",zU,[m(O,{value:l.audio_setting.format,"onUpdate:value":A[11]||(A[11]=L=>l.audio_setting.format=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(QV),L=>(w(),Q(B,{key:L},{default:x(()=>[U(H(L),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),u("div",qU,[u("div",GU,[m($,{title:"生成音频的声道数"},{default:x(()=>[A[37]||(A[37]=U(" 声道数 ",-1)),m(K(ft))]),_:1}),A[38]||(A[38]=u("span",{class:"option-type"},"Number",-1))]),u("div",XU,[m(O,{value:l.audio_setting.channel,"onUpdate:value":A[12]||(A[12]=L=>l.audio_setting.channel=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(eH),L=>(w(),Q(B,{key:L.value,value:L.value},{default:x(()=>[U(H(L.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),u("div",WU,[A[43]||(A[43]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"声音效果器设置")],-1)),u("div",YU,[(w(),R(se,null,ge(["pitch","intensity","timbre"],L=>u("div",{key:L,class:"form-item"},[u("div",{class:xt(["form-tit",{required:K(fi)[L]}.required])},[m($,{title:K(fi)[L].tooltip},{default:x(()=>[U(H(K(fi)[L].label)+" ",1),m(K(ft)),u("span",JU,H(K(fi)[L].type),1)]),_:2},1032,["title"])],2),u("div",KU,[m(N,null,{default:x(()=>[m(E,{span:15},{default:x(()=>[m(P,{value:l.voice_modify[L],"onUpdate:value":j=>l.voice_modify[L]=j,step:K(fi)[L].step,min:K(fi)[L].min,max:K(fi)[L].max,marks:K(fi)[L].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),m(E,{span:7},{default:x(()=>[m(D,{value:l.voice_modify[L],"onUpdate:value":j=>l.voice_modify[L]=j,placeholder:"请输入",min:K(fi)[L].min,max:K(fi)[L].max,class:"ml16"},null,8,["value","onUpdate:value","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),u("div",ZU,[u("div",QU,[m($,{title:"音效设置，单次仅能选择一种，可选"},{default:x(()=>[A[40]||(A[40]=U(" 音效 ",-1)),m(K(ft)),A[41]||(A[41]=u("span",{class:"option-type"},"string",-1))]),_:1})]),u("div",ez,[m(O,{value:l.voice_modify.sound_effects,"onUpdate:value":A[13]||(A[13]=L=>l.voice_modify.sound_effects=L),placeholder:"请选择",onChange:S},{default:x(()=>[m(B,{value:""},{default:x(()=>[...A[42]||(A[42]=[U("无",-1)])]),_:1}),(w(!0),R(se,null,ge(K(nH),(L,j)=>(w(),Q(B,{key:j,value:j},{default:x(()=>[U(H(L),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),u("div",tz,[A[49]||(A[49]=u("div",{class:"options-item-tit"},[u("div",{class:"option-label"},"其他设置")],-1)),u("div",nz,[u("div",oz,[u("div",iz,[m($,{title:"是否增强对指定的小语种和方言的识别能力"},{default:x(()=>[A[44]||(A[44]=U(" 小语种识别能力 ",-1)),m(K(ft))]),_:1})]),u("div",rz,[m(O,{value:l.language_boost,"onUpdate:value":A[14]||(A[14]=L=>l.language_boost=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(j_),(L,j)=>(w(),Q(B,{key:j,value:j},{default:x(()=>[U(H(L),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),u("div",sz,[u("div",az,[m($,{title:"控制输出结果形式的参数，可选值范围为[url, hex]。该参数仅在非流式场景生效，流式场景仅支持返回 hex 形式。返回的 url 有效期为 24 小时"},{default:x(()=>[A[45]||(A[45]=U(" 输出结果形式 ",-1)),m(K(ft))]),_:1})]),u("div",lz,[m(O,{value:l.output_format,"onUpdate:value":A[15]||(A[15]=L=>l.output_format=L),placeholder:"请选择",onChange:S},{default:x(()=>[(w(!0),R(se,null,ge(K(tH),(L,j)=>(w(),Q(B,{key:j,value:j},{default:x(()=>[U(H(L),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),u("div",uz,[u("div",dz,[m($,{title:"对于音频恒定比特率（cbr）控制，可选 false、 true。当此参数设置为 true，将以恒定比特率方式进行音频编码。注意：本参数仅当音频设置为流式输出，且音频格式为 mp3 时生效。"},{default:x(()=>[A[46]||(A[46]=U(" 恒定比特率控制 ",-1)),m(K(ft))]),_:1})]),u("div",cz,[m(Mo,{value:l.audio_setting.force_cbr,"onUpdate:value":A[16]||(A[16]=L=>l.audio_setting.force_cbr=L),options:K(Ar),onChange:S},null,8,["value","options"])])]),u("div",pz,[u("div",fz,[m($,{title:"控制是否开启字幕服务，默认值为 false。此参数仅在非流式输出场景下有效，且仅对 speech-2.6-hd speech-2.6-turbo speech-02-turbo speech-02-hd speech-01-turbo speech-01-hd 模型有效"},{default:x(()=>[A[47]||(A[47]=U(" 开启字幕服务 ",-1)),m(K(ft))]),_:1})]),u("div",hz,[m(Mo,{value:l.subtitle_enable,"onUpdate:value":A[17]||(A[17]=L=>l.subtitle_enable=L),options:K(Ar),onChange:S},null,8,["value","options"])])]),u("div",vz,[u("div",_z,[m($,{title:"控制在合成音频的末尾添加音频节奏标识，默认值为 False。该参数仅对非流式合成生效"},{default:x(()=>[A[48]||(A[48]=U(" 合成音频的末尾添加音频节奏标识 ",-1)),m(K(ft))]),_:1})]),u("div",gz,[m(Mo,{value:l.aigc_watermark,"onUpdate:value":A[18]||(A[18]=L=>l.aigc_watermark=L),options:K(Ar),onChange:S},null,8,["value","options"])])])])])],64)):ne("",!0)]),u("div",mz,[A[51]||(A[51]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",yz,[m(Oi,{"tree-data":s.value},null,8,["tree-data"])])]),m(dU,{ref_key:"voiceModalRef",ref:i,modelConfigId:l.model_config_id,onChange:T},null,8,["modelConfigId"])]}),_:1})}}},xz=Ne(bz,[["__scopeId","data-v-1efe69ee"]]),wz="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.09452%2014.4098C4.97749%2014.0772%203.98319%2013.4598%203.19588%2012.6417C3.48959%2012.2936%203.66659%2011.8438%203.66659%2011.3527C3.66659%2010.2482%202.77116%209.35274%201.66659%209.35274C1.59977%209.35274%201.53372%209.35604%201.46858%209.36244C1.37985%208.9286%201.33325%208.47947%201.33325%208.0194C1.33325%207.32254%201.44018%206.65064%201.63852%206.0192C1.64786%206.01934%201.65721%206.0194%201.66659%206.0194C2.77116%206.0194%203.66659%205.12397%203.66659%204.0194C3.66659%203.7023%203.59279%203.40247%203.46145%203.13607C4.23242%202.4192%205.17342%201.88271%206.21729%201.59375C6.54805%202.2421%207.22215%202.68608%207.99992%202.68608C8.77769%202.68608%209.45179%202.2421%209.78255%201.59375C10.8264%201.88271%2011.7674%202.4192%2012.5384%203.13607C12.4071%203.40247%2012.3333%203.7023%2012.3333%204.0194C12.3333%205.12397%2013.2287%206.0194%2014.3333%206.0194C14.3426%206.0194%2014.352%206.01934%2014.3613%206.0192C14.5597%206.65064%2014.6666%207.32254%2014.6666%208.0194C14.6666%208.47947%2014.62%208.9286%2014.5313%209.36244C14.4661%209.35604%2014.4001%209.35274%2014.3333%209.35274C13.2287%209.35274%2012.3333%2010.2482%2012.3333%2011.3527C12.3333%2011.8438%2012.5103%2012.2936%2012.804%2012.6417C12.0167%2013.4598%2011.0224%2014.0772%209.90532%2014.4098C9.64752%2013.6034%208.89192%2013.0194%207.99992%2013.0194C7.10792%2013.0194%206.35232%2013.6034%206.09452%2014.4098Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.99984%2010.3542C9.2885%2010.3542%2010.3332%209.3095%2010.3332%208.02083C10.3332%206.73217%209.2885%205.6875%207.99984%205.6875C6.71117%205.6875%205.6665%206.73217%205.6665%208.02083C5.6665%209.3095%206.71117%2010.3542%207.99984%2010.3542Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e",Cz="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",kz={class:"problem-optimization-form"},Sz={class:"node-form-content"},Ez={class:"gray-block"},Az={class:"model-setting-form"},Dz={class:"model-content"},Oz={class:"model-setting-form"},Nz={class:"model-content"},Mz={class:"model-setting-form"},Tz={class:"model-label"},$z={class:"model-content"},Rz={key:0,class:"model-setting-form"},Pz={class:"model-content"},Lz={key:1,class:"model-setting-form"},Bz={class:"model-content"},Iz={key:0,class:"gray-block mt16"},jz={style:{width:"409px"},class:"flex-between-box"},Fz={class:"array-form-box"},Vz={class:"flex-block-item"},Hz={class:"field-list-item"},Uz={class:"field-label"},zz={class:"field-type"},qz=["onClick"],Gz={class:"gray-block mt16"},Xz={class:"key-label"},Wz={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"显示",value:"1"},{label:"不显示",value:"0"}],r=[{label:"开启",value:"1"},{label:"关闭",value:"0"}],s=X([]),a=Ve("getNode"),l=Je({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[{value:"",key:Ht(16)}],image_watermark:"1",image_optimize_prompt:"1"}),d=X(null),c=X(null),p=()=>{d.value.refresh()},f=()=>{c.value.show()},h=We(()=>{let le=[];if(l.image_num>0)for(let z=0;z<+l.image_num;z++){let V=String.fromCharCode(97+z);le.push(`picture_url_${V}`)}return le}),v=()=>{l.size=void 0,l.image_num="1",l.input_images=[{value:"",key:Ht(16)}]},y=We(()=>lC(l.model_config_id,l.use_model,"IMAGE")||{}),g=We(()=>y.value.image_generation?JSON.parse(y.value.image_generation):{}),_=Zw(),b=We(()=>g.value.image_sizes?g.value.image_sizes.split(",").map(le=>_.find(z=>z.value==le)):[]),C=We(()=>+g.value.image_max||1),T=We(()=>g.value.image_optimize_prompt=="1"),M=We(()=>g.value.image_watermark=="1"),S=We(()=>+g.value.image_inputs_image_max||1),k=()=>{let le=[{key:"msg",typ:"string"}];h.value.forEach(V=>{le.push({key:V,typ:"string"})});const z=JSON.stringify({image_generation:{...l,image_num:l.image_num>0?l.image_num+"":"1",input_images:l.input_images.map(V=>V.value).filter(Boolean),output:le}});t("update-node",{...o.node,node_params:z})},A=()=>{try{let le=o.node.dataRaw||o.node.node_params||"{}",z=JSON.parse(le).image_generation||{};O(),E(),z=JSON.parse(JSON.stringify(z)),l.model_config_id=z.model_config_id,l.use_model=z.use_model,l.size=z.size,l.image_num=z.image_num,l.prompt=z.prompt,l.prompt_tags=z.prompt_tags,l.input_images=z.input_images.map(V=>({value:V,key:Ht(16)})),l.image_watermark=z.image_watermark,l.image_optimize_prompt=z.image_optimize_prompt}catch(le){}},$=X([]),B=le=>{le&&O()},O=()=>{let le=a().getAllParentVariable();$.value=le||[]},P=(le,z)=>{l.prompt_tags=z,l.prompt=le},E=()=>{const le=o.lf.getNodeModelById(o.nodeId);if(le){let z=le.getAllParentVariable();z.forEach(V=>{V.tags=V.tags||[]}),s.value=z}},D=Je({}),N=(le,z,V)=>{if(le){let J=`at_input_${z}_${V}`;D[J]=le}},F=(le,z,V)=>{V.tags=z,V.value=le},Y=()=>{if(l.input_images.length>=S.value)return mt.error("最多添加"+S.value+"张参考图");l.input_images.push({value:"",key:Ht(16)})},L=le=>{l.input_images.splice(le,1)};ct(()=>l,()=>{k()},{deep:!0});const j=()=>{t("close")};return at(()=>{A()}),(le,z)=>{const V=Lt,J=$t,oe=Zt,W=Mn,q=Jc,re=Cn,ue=Xt,xe=In,Te=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过文字描述/添加参考图片生成图片",onClose:j},null,8,["title","iconName"])]),default:x(()=>[u("div",kz,[u("div",Sz,[m(Te,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[u("div",Ez,[z[14]||(z[14]=u("div",{class:"gray-block-title"},[u("img",{src:wz,alt:""}),U("模型设置 ")],-1)),u("div",Az,[z[8]||(z[8]=u("div",{class:"model-label"},"模型",-1)),u("div",Dz,[m(lr,{modelType:"IMAGE",modeName:l.use_model,"onUpdate:modeName":z[0]||(z[0]=me=>l.use_model=me),modeId:l.model_config_id,"onUpdate:modeId":z[1]||(z[1]=me=>l.model_config_id=me),onChange:v},null,8,["modeName","modeId"])])]),u("div",Oz,[z[9]||(z[9]=u("div",{class:"model-label"},"比例",-1)),u("div",Nz,[m(J,{placeholder:"请选择",value:l.size,"onUpdate:value":z[2]||(z[2]=me=>l.size=me),style:{width:"100%"}},{default:x(()=>[(w(!0),R(se,null,ge(b.value,me=>(w(),Q(V,{value:me.value,key:me.value},{default:x(()=>[U(H(me.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),u("div",Mz,[u("div",Tz,[z[11]||(z[11]=U(" 最大生成数量 ",-1)),m(oe,null,{title:x(()=>[...z[10]||(z[10]=[U("最多生成几张图片，实际生成图片数量请在提示词里面指定（比如：请生成4张图片），但是不会超过最大数量。",-1)])]),default:x(()=>[m(K(ft))]),_:1})]),u("div",$z,[m(W,{placeholder:"请输入",style:{width:"100%"},value:l.image_num,"onUpdate:value":z[3]||(z[3]=me=>l.image_num=me),min:1,max:C.value},null,8,["value","max"])])]),M.value?(w(),R("div",Rz,[z[12]||(z[12]=u("div",{class:"model-label"},"右下水印",-1)),u("div",Pz,[m(q,{class:"customer-segmented",value:l.image_watermark,"onUpdate:value":z[4]||(z[4]=me=>l.image_watermark=me),options:i},null,8,["value"])])])):ne("",!0),T.value?(w(),R("div",Lz,[z[13]||(z[13]=u("div",{class:"model-label"},"优化提示词",-1)),u("div",Bz,[m(q,{class:"customer-segmented",value:l.image_optimize_prompt,"onUpdate:value":z[5]||(z[5]=me=>l.image_optimize_prompt=me),options:r},null,8,["value"])])])):ne("",!0)]),y.value.input_image==1||y.value.input_text==1?(w(),R("div",Iz,[z[17]||(z[17]=u("div",{class:"gray-block-title"},[u("img",{src:Cz,alt:""}),U("输入")],-1)),y.value.input_text==1?(w(),Q(re,{key:0,name:"use_model"},{label:x(()=>[u("div",jz,[z[15]||(z[15]=u("div",null,"提示词",-1)),u("div",{class:"btn-hover-wrap",onClick:f},[m(K(po))])])]),default:x(()=>[m(tt,{options:$.value,defaultSelectedList:l.prompt_tags,defaultValue:l.prompt,ref_key:"promptInputRef",ref:d,placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 76px",type:"textarea",onOpen:B,onChange:z[6]||(z[6]=(me,pe)=>P(me,pe))},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):ne("",!0),y.value.input_image==1?(w(),Q(re,{key:1,label:"参考图URL",name:"use_model"},{default:x(()=>[m(xe,null,{default:x(()=>[u("div",Fz,[(w(!0),R(se,null,ge(l.input_images,(me,pe)=>(w(),R("div",{class:"form-item-list",key:me.key},[u("div",Vz,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Ge=>N(Ge,"input_images",pe),options:s.value,defaultSelectedList:me.tags,defaultValue:me.value,onOpen:E,onChange:(Ge,Le)=>F(Ge,Le,me),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Ge,payload:Le})=>[u("div",Hz,[u("div",Uz,H(Ge),1),u("div",zz,H(Le.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),u("div",{class:"btn-hover-wrap",onClick:Ge=>L(pe)},[m(K(Ut))],8,qz)])]))),128)),m(ue,{onClick:Y,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...z[16]||(z[16]=[U("新增参考图",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1})):ne("",!0)])):ne("",!0),u("div",Gz,[z[19]||(z[19]=u("div",{class:"gray-block-title"},[u("img",{src:Fu,alt:""}),U("输出")],-1)),z[20]||(z[20]=u("div",{class:"output-item"},[u("div",{class:"key-label"},"msg"),u("div",{class:"key-value"},"string")],-1)),(w(!0),R(se,null,ge(h.value,me=>(w(),R("div",{class:"output-item",key:me},[u("div",Xz,H(me),1),z[18]||(z[18]=u("div",{class:"key-value"},"string",-1))]))),128))])]),_:1},8,["model"])])]),m(Hi,{options:$.value,defaultSelectedList:l.prompt_tags,defaultValue:l.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 76px",type:"textarea",onOpen:B,onChange:z[7]||(z[7]=(me,pe)=>P(me,pe)),onOk:p,ref_key:"fullAtInputRef",ref:c},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})}}},Yz=Ne(Wz,[["__scopeId","data-v-d7a9900e"]]),Jz={class:"problem-optimization-form"},Kz={class:"node-form-content"},Zz={class:"gray-block"},Qz={class:"model-setting-form"},eq={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Je({content:""}),r=()=>{const l=JSON.stringify({...i});t("update-node",{...o.node,node_params:l})},s=()=>{try{let l=o.node.dataRaw||o.node.node_params||"{}",d=JSON.parse(l);i.content=d.content}catch(l){}};ct(()=>i,()=>{r()},{deep:!0});const a=()=>{t("close")};return at(()=>{s()}),(l,d)=>{const c=Vi,p=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"",onClose:a},null,8,["title","iconName"])]),default:x(()=>[u("div",Jz,[u("div",Kz,[m(p,{ref:"formRef",layout:"vertical",model:i},{default:x(()=>[u("div",Zz,[d[1]||(d[1]=u("div",{class:"gray-block-title"},null,-1)),u("div",Qz,[m(c,{style:{"min-height":"300px"},value:i.content,"onUpdate:value":d[0]||(d[0]=f=>i.content=f),valueModifiers:{trim:!0},"auto-size":"",placeholder:"请输入注释"},null,8,["value"])])])]),_:1},8,["model"])])])]),_:1})}}},tq=Ne(eq,[["__scopeId","data-v-e8093fb2"]]),F_={__name:"add-key-modal",props:{request_content_type:{type:String,default:""},level:{type:Number,default:1}},emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=We(()=>{if(i.request_content_type=="multipart/form-data")return[{lable:"string",value:"string"},{lable:"file",value:"file"}];if(i.request_content_type=="application/x-www-form-urlencoded")return[{lable:"string",value:"string"}];if(i.request_content_type=="application/json"){let b=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return i.level>=2?b.filter(C=>C.value!="object"):b}return[{lable:"string",value:"string"}]}),s=X(!1),a=X("新增参数");let l="add";const d=(b,C)=>C?/^[a-zA-Z_]+$/.test(C)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let c=0;const p=Je({key:"",typ:"string",cu_key:"",desc:void 0,subs:[]}),f=()=>{p.typ="string",s.value=!0},h=()=>{Object.assign(p,{key:"",typ:"string",cu_key:Ht(16),subs:[]}),l="add",a.value="新增参数",s.value=!0},v=b=>{c=b,Object.assign(p,{key:"",typ:"string",cu_key:Ht(16),subs:[]}),l="addSub",a.value="新增参数",s.value=!0},y=(b,C)=>{c=C,Object.assign(p,{key:"",typ:"string",cu_key:Ht(16),subs:[]}),Object.assign(p,{...b}),l="edit",a.value="编辑参数",s.value=!0},g=X(null),_=()=>{g.value.validate().then(()=>{l=="add"&&o("add",{...p}),l=="addSub"&&o("addSub",{...p},c),l=="edit"&&o("edit",{...p},c),s.value=!1})};return e({show:f,add:h,edit:y,addSub:v}),(b,C)=>{const T=en,M=Cn,S=Lt,k=$t,A=xn,$=_n;return w(),R("div",null,[m($,{open:s.value,"onUpdate:open":C[2]||(C[2]=B=>s.value=B),title:a.value,onOk:_,width:472,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[m(A,{ref_key:"formRef",ref:g,layout:"vertical",model:p,style:{margin:"24px 0"}},{default:x(()=>[m(M,{label:"参数key",name:"key",rules:[{required:!0,validator:(B,O)=>d(B,O)}]},{default:x(()=>[m(T,{value:p.key,"onUpdate:value":C[0]||(C[0]=B=>p.key=B),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),m(M,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:x(()=>[m(k,{value:p.typ,"onUpdate:value":C[1]||(C[1]=B=>p.typ=B),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(!0),R(se,null,ge(r.value,B=>(w(),Q(S,{value:B.value},{default:x(()=>[U(H(B.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},nq={class:"sub-field-item"},oq={class:"key-title-item"},iq={class:"typ-title-item"},rq={class:"value-title-item"},sq=["onClick"],aq=["onClick"],lq=["onClick"],uq={__name:"subs-key",props:{data:{},level:{type:Number},globalOptions:{type:Array},request_content_type:{type:String,default:""}},setup(n){const e=n;We(()=>e.level>2?p.filter(f=>f.value!="object"):p);let t=0;const o=(f,h)=>{h.splice(f,1)},i=X(null),r=f=>{t=f,i.value.add()},s=(f,h)=>{i.value.edit(f,h)},a=f=>{e.data[t].subs.push(f)},l=(f,h)=>{e.data[h].typ!=f.typ&&(f.desc=void 0),e.data.splice(h,1,f)},d=f=>f.typ=="object"&&e.level<=2,c=f=>{let h=f.typ;return h=="file"&&(h="string"),h?e.globalOptions.filter(v=>v.typ==h):e.globalOptions};let p=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return(f,h)=>{const v=Lt,y=$t,g=Pt("SubsKey",!0);return w(),R(se,null,[(w(!0),R(se,null,ge(e.data,(_,b)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:_.cu_key},[u("div",nq,[h[0]||(h[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),u("div",oq,H(_.key),1),u("div",iq,H(_.typ),1),u("div",rq,[_.typ!="object"?(w(),Q(y,{key:0,placeholder:"请输入选择变量",value:_.desc,"onUpdate:value":C=>_.desc=C,style:{width:"90%"}},{default:x(()=>[(w(!0),R(se,null,ge(c(_),C=>(w(),Q(v,{value:C.value,key:C.key},{default:x(()=>[u("span",null,H(C.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):ne("",!0)]),d(_)?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:C=>r(b,e.data)},[m(K(Bn))],8,sq)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:C=>s(_,b)},[m(K(Dr))],8,aq),u("div",{class:"btn-hover-wrap",onClick:C=>o(b,e.data)},[m(K(Ut))],8,lq)]),_.subs&&_.subs.length>0?(w(),Q(g,{key:0,request_content_type:e.request_content_type,level:e.level+1,data:_.subs,globalOptions:e.globalOptions},null,8,["request_content_type","level","data","globalOptions"])):ne("",!0)],2))),128)),m(F_,{onAdd:a,level:e.level,request_content_type:e.request_content_type,onEdit:l,ref_key:"addParamsModalRef",ref:i},null,8,["level","request_content_type"])],64)}}},Of=Ne(uq,[["__scopeId","data-v-9e0ee61d"]]),dq={class:"variable-node"},cq={class:"node-form-content"},pq={class:"gray-block"},fq={class:"mt8"},hq={class:"array-form-box"},vq={class:"flex-block-item"},_q={class:"at-input-flex1"},gq=["onClick"],mq={key:0,class:"array-form-box"},yq={class:"array-form-box"},bq={class:"key-block-item"},xq={class:"key-item",style:{width:"180px"}},wq={class:"key-item",style:{width:"90px"}},Cq={class:"key-item",style:{width:"160px"}},kq={class:"key-item btn-block",style:{flex:"1"}},Sq=["onClick"],Eq=["onClick"],Aq=["onClick"],Dq={key:0,class:"sub-field-box"},Oq={class:"mt8"},Nq={key:1,class:"array-form-box"},Mq={class:"array-form-box"},Tq={class:"key-block-item"},$q={class:"key-item",style:{width:"180px"}},Rq={class:"key-item",style:{width:"90px"}},Pq={class:"key-item",style:{width:"160px"}},Lq={class:"key-item btn-block",style:{flex:"1"}},Bq=["onClick"],Iq=["onClick"],jq={class:"mt8"},Fq={key:2,class:"array-form-box"},Vq={class:"array-form-box"},Hq={class:"key-block-item"},Uq={class:"key-item",style:{width:"180px"}},zq={class:"key-item",style:{width:"90px"}},qq={class:"key-item",style:{width:"160px"}},Gq={class:"key-item btn-block",style:{flex:"1"}},Xq=["onClick"],Wq=["onClick"],Yq=["onClick"],Jq={key:0,class:"sub-field-box"},Kq={class:"mt8"},Zq={class:"gray-block mt16"},Qq={key:0,class:"mt8"},eG={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Je({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""});ct(()=>i,()=>{l()},{deep:!0}),Ve("getNode");const r=Ve("getGraph"),s=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...o.node})},10)},a=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},l=()=>{let B=JSON.parse(o.node.node_params);B.trigger.trigger_web_hook_config={...i};let O={...o.node,node_params:JSON.stringify(B)};t("update-node",O),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",O)},10)},d=()=>{try{let B=o.node.dataRaw||o.node.node_params||"{}";B=JSON.parse(B),p();let O=B.trigger.trigger_web_hook_config;i.url=O.url,i.method=O.method||"GET",i.switch_verify=O.switch_verify||"1",i.switch_allow_ip=O.switch_allow_ip||"0",i.allow_ips=O.allow_ips?O.allow_ips.split(",").join(`
`):"",i.params=O.params||[],i.form=O.form||[],i.x_form=O.x_form||[],i.json=O.json||[],i.request_content_type=O.request_content_type||"none",i.response_type=O.response_type||"now",i.response_now=O.response_now||""}catch(B){}},c=X([]);function p(){const B=o.lf.getNodeModelById(o.nodeId);if(B){let P=B.getGlobalVariable().diy_global||[];P.forEach(E=>{E.label=E.key,E.value="global."+E.key}),c.value=P||[]}c.value}const f=We(()=>c.value.filter(B=>B.typ=="string")),h=B=>{B&&p()},v=B=>{let O=B.typ;return O=="file"&&(O="string"),O?c.value.filter(P=>P.typ==O):c.value},y=()=>{i.params.push({key:"",typ:"string",desc:void 0})},g=B=>{i.params.splice(B,1)},_=(B,O)=>{i[O].splice(B,1)},b=X(null),C=()=>{b.value.add()},T=B=>{b.value.addSub(B)},M=(B,O)=>{b.value.edit(B,O)},S=B=>{i.request_content_type=="multipart/form-data"&&i.form.push(B),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.push(B),i.request_content_type=="application/json"&&i.json.push(B)},k=(B,O)=>{i.request_content_type=="multipart/form-data"&&i.form.splice(O,1,B),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.splice(O,1,B),i.request_content_type=="application/json"&&i.json.splice(O,1,B)},A=(B,O)=>{i.request_content_type=="multipart/form-data"&&(i.form[O].subs||(i.form[O].subs=[]),i.form[O].subs.push(B)),i.request_content_type=="application/x-www-form-urlencoded"&&(i.x_form[O].subs||(i.x_form[O].subs=[]),i.x_form[O].subs.push(B)),i.request_content_type=="application/json"&&(i.json[O].subs||(i.json[O].subs=[]),i.json[O].subs.push(B))},$=()=>{Ts(i.url),mt.success("复制成功")};return at(()=>{d()}),(B,O)=>{const P=Lt,E=$t,D=en,N=Xt,F=vy,Y=Cn,L=ro,j=io,le=Vi,z=In,V=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:s,onDeleteNode:a,desc:"向服务器发送请求，触发工作流。"},null,8,["title","iconName"])]),default:x(()=>[u("div",dq,[u("div",cq,[m(V,{ref:"formRef",layout:"vertical",model:i},{default:x(()=>[u("div",pq,[m(Y,{label:"请求地址"},{default:x(()=>[m(F,{compact:""},{default:x(()=>[m(E,{value:i.method,"onUpdate:value":O[0]||(O[0]=J=>i.method=J),style:{width:"20%"}},{default:x(()=>[m(P,{value:"POST"},{default:x(()=>[...O[9]||(O[9]=[U("POST",-1)])]),_:1}),m(P,{value:"GET"},{default:x(()=>[...O[10]||(O[10]=[U("GET",-1)])]),_:1})]),_:1},8,["value"]),m(D,{readonly:"",value:i.url,"onUpdate:value":O[1]||(O[1]=J=>i.url=J),style:{width:"65%"}},null,8,["value"]),m(N,{onClick:O[2]||(O[2]=J=>$()),style:{width:"15%"},type:"primary"},{default:x(()=>[...O[11]||(O[11]=[U("复制",-1)])]),_:1})]),_:1})]),_:1}),m(Y,{label:"鉴权"},{default:x(()=>[m(j,{value:i.switch_verify,"onUpdate:value":O[3]||(O[3]=J=>i.switch_verify=J)},{default:x(()=>[m(L,{value:"1"},{default:x(()=>[...O[12]||(O[12]=[U("需要鉴权",-1)])]),_:1}),m(L,{value:"0"},{default:x(()=>[...O[13]||(O[13]=[U("无需鉴权",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),m(Y,{label:"IP白名单"},{default:x(()=>[m(j,{value:i.switch_allow_ip,"onUpdate:value":O[4]||(O[4]=J=>i.switch_allow_ip=J)},{default:x(()=>[m(L,{value:"0"},{default:x(()=>[...O[14]||(O[14]=[U("不启用",-1)])]),_:1}),m(L,{value:"1"},{default:x(()=>[...O[15]||(O[15]=[U("启用",-1)])]),_:1})]),_:1},8,["value"]),u("div",fq,[m(le,{value:i.allow_ips,"onUpdate:value":O[5]||(O[5]=J=>i.allow_ips=J),style:{"min-height":"74px"},placeholder:"请输入ip，一行一个"},null,8,["value"])])]),_:1}),u("div",hq,[O[17]||(O[17]=u("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),R(se,null,ge(i.params,(J,oe)=>(w(),R("div",{class:"form-item-list",key:oe},[m(Y,{label:null},{default:x(()=>[u("div",vq,[m(z,null,{default:x(()=>[m(D,{style:{width:"120px"},value:J.key,"onUpdate:value":W=>J.key=W,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),u("div",_q,[m(E,{style:{width:"100%"},placeholder:"请输入选择变量",value:J.desc,"onUpdate:value":W=>J.desc=W,onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(se,null,ge(f.value,W=>(w(),Q(P,{value:W.value,key:W.key},{default:x(()=>[u("span",null,H(W.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])]),u("div",{class:"btn-hover-wrap",onClick:W=>g(oe)},[m(K(Ut))],8,gq)])]),_:2},1024)]))),128)),m(N,{onClick:y,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...O[16]||(O[16]=[U("添加参数",-1)])]),_:1},8,["icon"])]),i.method=="POST"?(w(),R(se,{key:0},[m(Y,{label:"BODY"},{default:x(()=>[m(j,{value:i.request_content_type,"onUpdate:value":O[6]||(O[6]=J=>i.request_content_type=J)},{default:x(()=>[m(L,{value:"none"},{default:x(()=>[...O[18]||(O[18]=[U("none",-1)])]),_:1}),m(L,{value:"multipart/form-data"},{default:x(()=>[...O[19]||(O[19]=[U("form-data",-1)])]),_:1}),m(L,{value:"application/x-www-form-urlencoded"},{default:x(()=>[...O[20]||(O[20]=[U("x-www-form-urlencoded",-1)])]),_:1}),m(L,{value:"application/json"},{default:x(()=>[...O[21]||(O[21]=[U("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),i.request_content_type=="multipart/form-data"?(w(),R("div",mq,[u("div",yq,[O[22]||(O[22]=u("div",{class:"th-header-block"},[u("div",{class:"td-title",style:{width:"180px"}},"key"),u("div",{class:"td-title",style:{width:"90px"}},"类型"),u("div",{class:"td-title",style:{width:"160px"}},"全部变量"),u("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),R(se,null,ge(i.form,(J,oe)=>(w(),R("div",{class:"form-item-list",key:oe},[m(Y,{label:null},{default:x(()=>[u("div",bq,[u("div",xq,H(J.key),1),u("div",wq,H(J.typ),1),u("div",Cq,[m(E,{placeholder:"请输入选择变量",value:J.desc,"onUpdate:value":W=>J.desc=W,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(se,null,ge(v(J),W=>(w(),Q(P,{value:W.value,key:W.key},{default:x(()=>[u("span",null,H(W.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),u("div",kq,[J.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:W=>T(oe)},[m(K(Bn))],8,Sq)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:W=>M(J,oe)},[m(K(Dr))],8,Eq),u("div",{class:"btn-hover-wrap",onClick:W=>_(oe,"form")},[m(K(Ut))],8,Aq)])]),J.subs&&J.subs.length>0?(w(),R("div",Dq,[m(z,null,{default:x(()=>[m(Of,{data:J.subs,request_content_type:i.request_content_type,level:2,globalOptions:c.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):ne("",!0)]),_:2},1024)]))),128))]),u("div",Oq,[m(N,{onClick:C,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...O[23]||(O[23]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ne("",!0),i.request_content_type=="application/x-www-form-urlencoded"?(w(),R("div",Nq,[u("div",Mq,[O[24]||(O[24]=u("div",{class:"th-header-block"},[u("div",{class:"td-title",style:{width:"180px"}},"key"),u("div",{class:"td-title",style:{width:"90px"}},"类型"),u("div",{class:"td-title",style:{width:"160px"}},"全部变量"),u("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),R(se,null,ge(i.x_form,(J,oe)=>(w(),R("div",{class:"form-item-list",key:oe},[m(Y,{label:null},{default:x(()=>[u("div",Tq,[u("div",$q,H(J.key),1),u("div",Rq,H(J.typ),1),u("div",Pq,[m(E,{placeholder:"请输入选择变量",value:J.desc,"onUpdate:value":W=>J.desc=W,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(se,null,ge(v(J),W=>(w(),Q(P,{value:W.value,key:W.key},{default:x(()=>[u("span",null,H(W.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),u("div",Lq,[u("div",{class:"btn-hover-wrap",onClick:W=>M(J,oe)},[m(K(Dr))],8,Bq),u("div",{class:"btn-hover-wrap",onClick:W=>_(oe,"x_form")},[m(K(Ut))],8,Iq)])])]),_:2},1024)]))),128))]),u("div",jq,[m(N,{onClick:C,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...O[25]||(O[25]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ne("",!0),i.request_content_type=="application/json"?(w(),R("div",Fq,[u("div",Vq,[O[26]||(O[26]=u("div",{class:"th-header-block"},[u("div",{class:"td-title",style:{width:"180px"}},"key"),u("div",{class:"td-title",style:{width:"90px"}},"类型"),u("div",{class:"td-title",style:{width:"160px"}},"全部变量"),u("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),R(se,null,ge(i.json,(J,oe)=>(w(),R("div",{class:"form-item-list",key:oe},[m(Y,{label:null},{default:x(()=>[u("div",Hq,[u("div",Uq,H(J.key),1),u("div",zq,H(J.typ),1),u("div",qq,[J.typ!="object"?(w(),Q(E,{key:0,placeholder:"请输入选择变量",value:J.desc,"onUpdate:value":W=>J.desc=W,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(se,null,ge(v(J),W=>(w(),Q(P,{value:W.value,key:W.key},{default:x(()=>[u("span",null,H(W.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):ne("",!0)]),u("div",Gq,[J.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:W=>T(oe)},[m(K(Bn))],8,Xq)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:W=>M(J,oe)},[m(K(Dr))],8,Wq),u("div",{class:"btn-hover-wrap",onClick:W=>_(oe,"json")},[m(K(Ut))],8,Yq)])]),J.subs&&J.subs.length>0?(w(),R("div",Jq,[m(z,null,{default:x(()=>[m(Of,{data:J.subs,request_content_type:i.request_content_type,level:2,globalOptions:c.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):ne("",!0)]),_:2},1024)]))),128))]),u("div",Kq,[m(N,{onClick:C,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...O[27]||(O[27]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ne("",!0)],64)):ne("",!0)]),u("div",Zq,[m(Y,{label:"RESPONSE"},{default:x(()=>[m(j,{value:i.response_type,"onUpdate:value":O[7]||(O[7]=J=>i.response_type=J)},{default:x(()=>[m(L,{value:"message_variable"},{default:x(()=>[...O[28]||(O[28]=[U("工作流执行结束返回",-1)])]),_:1}),m(L,{value:"now"},{default:x(()=>[...O[29]||(O[29]=[U("立即返回",-1)])]),_:1})]),_:1},8,["value"]),i.response_type=="now"?(w(),R("div",Qq,[m(le,{value:i.response_now,"onUpdate:value":O[8]||(O[8]=J=>i.response_now=J),style:{"min-height":"74px"},placeholder:"请在这里输入返回的json"},null,8,["value"])])):ne("",!0)]),_:1})])]),_:1},8,["model"]),m(F_,{request_content_type:i.request_content_type,onAdd:S,onEdit:k,onAddSub:A,ref_key:"addKeyModalRef",ref:b},null,8,["request_content_type"])])])]),_:1})}}},tG=Ne(eG,[["__scopeId","data-v-d0f74a3d"]]),nG={class:"problem-optimization-form"},oG={class:"node-form-content"},iG={class:"gray-block"},rG={class:"gray-block-title"},sG={class:"avatar-box"},aG=["src"],lG={class:"content-box"},uG={class:"list-name"},dG={class:"list-intro"},cG=["onClick"],pG={class:"btn-block"},fG={class:"gray-block mt16"},hG={class:"gray-block-title"},vG={key:0,class:"flex-block-item"},_G={class:"form-content-box flex1"},gG={class:"field-list-item"},mG={class:"field-label"},yG={class:"field-type"},bG={key:1,class:"flex-block-item"},xG={class:"form-content-box flex1"},wG={class:"field-list-item"},CG={class:"field-label"},kG={class:"field-type"},SG={key:2,class:"flex-block-item"},EG={class:"form-content-box flex1"},AG={class:"field-list-item"},DG={class:"field-label"},OG={class:"field-type"},NG={class:"flex-block-item"},MG={class:"form-content-box flex1"},TG={class:"field-list-item"},$G={class:"field-label"},RG={class:"field-type"},PG={class:"flex-block-item"},LG={class:"form-content-box flex1"},BG={class:"field-list-item"},IG={class:"field-label"},jG={class:"field-type"},FG={class:"flex-block-item"},VG={class:"form-item-label"},HG={class:"form-content-box flex1"},UG={class:"field-list-item"},zG={class:"field-label"},qG={class:"field-type"},GG={class:"flex-block-item"},XG={class:"form-item-label"},WG={class:"form-content-box flex1"},YG={class:"field-list-item"},JG={class:"field-label"},KG={class:"field-type"},ZG={class:"gray-block mt16"},QG={class:"gray-block-title"},eX={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"导入文档内容",value:"content"},{label:"导入url",value:"url"}],r=[{label:"依然导入",value:"import"},{label:"不导入",value:"not import"},{label:"更新内容",value:"update"}],s=X({}),a=X([]),l=X([]),d=()=>{const O=o.lf.getNodeModelById(o.nodeId);if(O){let P=O.getAllParentVariable();P.forEach(E=>{E.tags=E.tags||[]}),a.value=P,l.value=c(P)}};function c(O){function P(E){const D=[];for(const N of E)if(N.children&&N.children.length>0){const F=P(N.children);if(F.length>0){const Y={...N,children:F};D.push(Y)}}else N.typ&&N.typ==="array<string>"&&D.push({...N});return D}return P(O)}const p=X(null),f=Je({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),h=()=>{const O=JSON.stringify({library_import:{...f,library_id:f.library_id.join(",")}});t("update-node",{...o.node,node_params:O})},v=()=>{try{let O=o.node.dataRaw||o.node.node_params||"{}",P=JSON.parse(O).library_import||{};d(),P=JSON.parse(JSON.stringify(P));for(let E in P)E=="library_id"?f.library_id=P[E]?P[E].split(","):[]:f[E]=P[E];m_({ability_type:"library_ability_official_account"}).then(E=>{var N;let D=(E==null?void 0:E.data)||{};((N=D==null?void 0:D.user_config)==null?void 0:N.switch_status)==1&&(p.value=D)}),setTimeout(()=>{A()},300)}catch(O){}},y=We(()=>{let O=f.library_id[0],P=[{group_name:"未分组",id:"0"}];return O&&s.value[O]||P}),g=X([]),_=X(null),b=We(()=>g.value.filter(O=>p.value?f.library_id.includes(O.id):f.library_id.includes(O.id)&&O.type!=3)),C=We(()=>b.value&&b.value.length?b.value[0].type:-1),T=O=>{let P=f.library_id.indexOf(O.id);f.library_id.splice(P,1)},M=O=>{k(),f.library_id=[...O],f.library_group_id="0",Tt(()=>{A()})},S=()=>{_.value.open([...f.library_id])},k=async()=>{const O=await Ha({type:""});O&&(g.value=O.data||[])},A=()=>{Tt(()=>{f.library_id.length!=0&&Gm({group_type:C.value==0?1:0,library_id:f.library_id[0]}).then(O=>{s.value={...s.value,[f.library_id[0]]:O.data}})})},$=(O,P,E)=>{f[E]=O};ct(()=>f,()=>{h()},{deep:!0}),ct(()=>f.library_id,()=>{A()},{deep:!0});const B=()=>{t("close")};return at(()=>{v(),k()}),(O,P)=>{const E=On,D=Xt,N=Cn,F=Lt,Y=$t,L=Jc,j=Zt,le=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"将相关内容导入到对应知识库",onClose:B},null,8,["title","iconName"])]),default:x(()=>[u("div",nG,[u("div",oG,[m(le,{ref:"formRef",layout:"vertical",model:f},{default:x(()=>[u("div",iG,[u("div",rG,[m(E,{name:"nav-library",style:{"font-size":"14px",color:"#333"}}),P[11]||(P[11]=U(" 知识库 ",-1))]),m(N,{label:null},{default:x(()=>[(w(!0),R(se,null,ge(b.value,z=>(w(),R("div",{class:"konwledge-list-item",key:z.id},[u("div",sG,[u("img",{src:z.avatar,alt:""},null,8,aG)]),u("div",lG,[u("div",uG,H(z.library_name),1),u("div",dG,H(z.library_intro),1)]),u("div",{class:"btn-hover-wrap",onClick:V=>T(z)},[m(K(Ut))],8,cG)]))),128)),u("div",pG,[u("div",null,[m(D,{onClick:S,icon:St(K(Mt)),block:"",type:"dashed"},{default:x(()=>[...P[12]||(P[12]=[U("添加知识库",-1)])]),_:1},8,["icon"])])])]),_:1}),m(N,{label:"知识分组"},{default:x(()=>[m(Y,{value:f.library_group_id,"onUpdate:value":P[0]||(P[0]=z=>f.library_group_id=z),style:{width:"100%"},placeholder:"请选择"},{default:x(()=>[(w(!0),R(se,null,ge(y.value,z=>(w(),Q(F,{value:z.id,key:z.id},{default:x(()=>[U(H(z.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),C.value!=2&&C.value>=0?(w(),Q(N,{key:0,label:"导入类型"},{default:x(()=>[m(L,{class:"customer-segmented",value:f.import_type,"onUpdate:value":P[1]||(P[1]=z=>f.import_type=z),options:i},null,8,["value"])]),_:1})):ne("",!0),C.value==2?(w(),Q(N,{key:1,label:"分段问题重复"},{default:x(()=>[m(L,{class:"customer-segmented",value:f.qa_repeat_op,"onUpdate:value":P[2]||(P[2]=z=>f.qa_repeat_op=z),options:r},null,8,["value"])]),_:1})):ne("",!0),C.value!=2&&C.value>=0&&f.import_type=="url"?(w(),Q(N,{key:2,label:"文档URL重复"},{default:x(()=>[m(L,{class:"customer-segmented",value:f.normal_url_repeat_op,"onUpdate:value":P[3]||(P[3]=z=>f.normal_url_repeat_op=z),options:r},null,8,["value"])]),_:1})):ne("",!0)]),u("div",fG,[u("div",hG,[m(E,{name:"input",style:{"font-size":"14px",color:"#333"}}),P[13]||(P[13]=U(" 输入 ",-1))]),C.value!=2&&C.value>=0?(w(),R(se,{key:0},[f.import_type=="content"?(w(),R("div",vG,[P[14]||(P[14]=u("div",{class:"form-item-label required"},"文档标题",-1)),u("div",_G,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:f.normal_title,onOpen:d,onChange:P[4]||(P[4]=(z,V)=>$(z,V,"normal_title")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",gG,[u("div",mG,H(z),1),u("div",yG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])])):ne("",!0),f.import_type=="content"?(w(),R("div",bG,[P[15]||(P[15]=u("div",{class:"form-item-label required"},"文档内容",-1)),u("div",xG,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:f.normal_content,onOpen:d,onChange:P[5]||(P[5]=(z,V)=>$(z,V,"normal_content")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",wG,[u("div",CG,H(z),1),u("div",kG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])])):ne("",!0),f.import_type=="url"?(w(),R("div",SG,[P[16]||(P[16]=u("div",{class:"form-item-label"},"文档URL",-1)),u("div",EG,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:f.normal_url,onOpen:d,onChange:P[6]||(P[6]=(z,V)=>$(z,V,"normal_url")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",AG,[u("div",DG,H(z),1),u("div",OG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])])):ne("",!0)],64)):ne("",!0),C.value==2?(w(),R(se,{key:1},[u("div",NG,[P[17]||(P[17]=u("div",{class:"form-item-label required"},"分段问题",-1)),u("div",MG,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:f.qa_question,onOpen:d,onChange:P[7]||(P[7]=(z,V)=>$(z,V,"qa_question")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",TG,[u("div",$G,H(z),1),u("div",RG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])]),u("div",PG,[P[18]||(P[18]=u("div",{class:"form-item-label required"},"分段答案",-1)),u("div",LG,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:f.qa_answer,onOpen:d,onChange:P[8]||(P[8]=(z,V)=>$(z,V,"qa_answer")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",BG,[u("div",IG,H(z),1),u("div",jG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])]),u("div",FG,[u("div",VG,[P[19]||(P[19]=U(" 答案附图 ",-1)),m(j,{title:"图片url，<array string>格式，支持传入多个"},{default:x(()=>[m(K(ft))]),_:1})]),u("div",HG,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:l.value,defaultValue:f.qa_images_variable,onOpen:d,onChange:P[9]||(P[9]=(z,V)=>$(z,V,"qa_images_variable")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",UG,[u("div",zG,H(z),1),u("div",qG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])]),u("div",GG,[u("div",XG,[P[20]||(P[20]=U(" 相似问法 ",-1)),m(j,{title:"<array string>格式，支持传入多个"},{default:x(()=>[m(K(ft))]),_:1})]),u("div",WG,[m(tt,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:l.value,defaultValue:f.qa_similar_question_variable,onOpen:d,onChange:P[10]||(P[10]=(z,V)=>$(z,V,"qa_similar_question_variable")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:z,payload:V})=>[u("div",YG,[u("div",JG,H(z),1),u("div",KG,H(V.typ),1)])]),_:1},8,["options","defaultValue"])])])],64)):ne("",!0)]),u("div",ZG,[u("div",QG,[m(E,{name:"output",style:{"font-size":"14px",color:"#333"}}),P[21]||(P[21]=U(" 输出 ",-1))]),P[22]||(P[22]=u("div",{class:"options-item"},[u("div",{class:"option-label"},"msg"),u("div",{class:"desc"},"ok表示成功，其他输出为报错日志")],-1))])]),_:1},8,["model"]),m(S_,{ref_key:"librarySelectAlertRef",ref:_,showWxType:!!p.value,select_type:"radio",onChange:M},null,8,["showWxType"])])])]),_:1})}}},tX=Ne(eX,[["__scopeId","data-v-0a068430"]]),nX={class:"sub-field-item"},oX=["onClick"],iX=["onClick"],rX={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=We(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=We(()=>e.level==2?"180px":"146px"),i=(l,d)=>{d[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,d)=>{d.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,d)=>{const c=en,p=Lt,f=$t,h=Pt("SubsKey",!0);return w(!0),R(se,null,ge(e.data,(v,y)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[u("div",nX,[d[0]||(d[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(c,{class:"mr12",style:Fn({width:o.value}),value:v.key,"onUpdate:value":g=>v.key=g,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(f,{class:"mr12",onChange:g=>s(v),value:v.typ,"onUpdate:value":g=>v.typ=g,placeholder:"请选择",style:Fn({width:o.value})},{default:x(()=>[(w(!0),R(se,null,ge(t.value,g=>(w(),Q(p,{value:g.value},{default:x(()=>[U(H(g.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:g=>i(y,e.data)},[m(K(Bn))],8,oX)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:g=>r(y,e.data)},[m(K(Ut))],8,iX)]),v.subs&&v.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ne("",!0)],2))),128)}}},sX=Ne(rX,[["__scopeId","data-v-2ed06465"]]),aX={class:"problem-optimization-form"},lX={class:"node-form-content"},uX={class:"gray-block"},dX={class:"array-form-box"},cX={class:"gray-block mt16"},pX={class:"output-box"},fX={class:"flex-block-item",style:{gap:"12px"}},hX=["onClick"],vX={key:0,class:"sub-field-box"},_X={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]);function r(){const g=o.lf.getNodeModelById(o.nodeId);if(g){let _=g.getAllParentVariable();i.value=s(_)}}function s(g){function _(b){const C=[];for(const T of b)if(T.children&&T.children.length>0){const M=_(T.children);if(M.length>0){const S={...T,children:M};C.push(S)}}else T.typ&&(T.typ.startsWith("array<")||T.typ==="object")&&C.push({...T});return C}return _(g)}const a=g=>{g&&r()},l=Je({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),d=()=>{const g=JSON.stringify({json_encode:{...l}});t("update-node",{...o.node,node_params:g})},c=(g,_)=>{l.input_tags=_,l.input_variable=g},p=()=>{try{let g=o.node.dataRaw||o.node.node_params||"{}",_=JSON.parse(g).json_encode||{};_=JSON.parse(JSON.stringify(_)),r(),l.input_variable=_.input_variable,_.output.length>0&&(l.output=_.output)}catch(g){}};ct(()=>l,()=>{d()},{deep:!0});const f=g=>{g.subs=[]},h=g=>{l.output[g].subs.push({key:"",value:"",subs:[],cu_key:Ht(16)})},v=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],y=()=>{t("close")};return at(()=>{p()}),(g,_)=>{const b=en,C=Lt,T=$t,M=In,S=Cn,k=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于把变量转化为JSON字符串",onClose:y},null,8,["title","iconName"])]),default:x(()=>[u("div",aX,[u("div",lX,[m(k,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[u("div",uX,[_[2]||(_[2]=u("div",{class:"gray-block-title"},"输入",-1)),u("div",dX,[m(tt,{options:i.value,defaultSelectedList:l.input_tags,defaultValue:l.input_variable,checkAnyLevel:!0,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量",onOpen:a,onChange:_[0]||(_[0]=(A,$)=>c(A,$))},null,8,["options","defaultSelectedList","defaultValue"])])]),u("div",cX,[_[4]||(_[4]=u("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),u("div",pX,[_[3]||(_[3]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型")],-1)),u("div",{class:"array-form-box",onMousedown:_[1]||(_[1]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(l.output,(A,$)=>(w(),R("div",{class:"form-item-list",key:$},[m(S,{label:null,name:["output",$,"key"]},{default:x(()=>[u("div",fX,[m(b,{style:{width:"214px"},value:A.key,"onUpdate:value":B=>A.key=B,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(M,null,{default:x(()=>[m(T,{onChange:B=>f(A),value:A.typ,"onUpdate:value":B=>A.typ=B,placeholder:"请选择",showArrow:!1,disabled:"",style:{width:"214px"}},{default:x(()=>[(w(),R(se,null,ge(v,B=>m(C,{value:B.value,key:B.value},{default:x(()=>[U(H(B.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),A.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:B=>h($)},[m(K(Bn))],8,hX)):ne("",!0)]),A.subs&&A.subs.length>0?(w(),R("div",vX,[m(M,null,{default:x(()=>[m(sX,{data:A.subs,level:2,typOptions:v},null,8,["data"])]),_:2},1024)])):ne("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},gX=Ne(_X,[["__scopeId","data-v-e7427d24"]]),mX={class:"sub-field-item"},yX=["onClick"],bX=["onClick"],xX={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=We(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=We(()=>e.level==2?"180px":"146px"),i=(l,d)=>{d[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,d)=>{d.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,d)=>{const c=en,p=Lt,f=$t,h=Pt("SubsKey",!0);return w(!0),R(se,null,ge(e.data,(v,y)=>(w(),R("div",{class:xt(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[u("div",mX,[d[0]||(d[0]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(c,{class:"mr12",style:Fn({width:o.value}),value:v.key,"onUpdate:value":g=>v.key=g,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=u("img",{class:"fork-icon",src:Vo,alt:""},null,-1)),m(f,{class:"mr12",onChange:g=>s(v),value:v.typ,"onUpdate:value":g=>v.typ=g,placeholder:"请选择",style:Fn({width:o.value})},{default:x(()=>[(w(!0),R(se,null,ge(t.value,g=>(w(),Q(p,{value:g.value},{default:x(()=>[U(H(g.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:g=>i(y,e.data)},[m(K(Bn))],8,yX)):ne("",!0),u("div",{class:"btn-hover-wrap",onClick:g=>r(y,e.data)},[m(K(Ut))],8,bX)]),v.subs&&v.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ne("",!0)],2))),128)}}},wX=Ne(xX,[["__scopeId","data-v-eff9a42d"]]),CX={class:"problem-optimization-form"},kX={class:"node-form-content"},SX={class:"gray-block"},EX={class:"array-form-box"},AX={class:"gray-block mt16"},DX={class:"output-box"},OX={class:"flex-block-item",style:{gap:"12px"}},NX=["onClick"],MX={key:0,class:"sub-field-box"},TX={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]);function r(){const g=o.lf.getNodeModelById(o.nodeId);if(g){let _=g.getAllParentVariable();i.value=s(a(_)),i.value}}function s(g){return g.forEach(_=>{_.typ=="node"?_.node_type==1?_.value="global":_.value=_.node_id:_.value=_.key,_.children&&_.children.length>0&&(_.children=s(_.children))}),g}function a(g){function _(b){const C=[];for(const T of b)if(o.node,T.children&&T.children.length>0){const M=_(T.children);if(M.length>0){const S={...T,children:M};C.push(S)}}else T.typ&&(o.node.loop_parent_key&&(T.node_type==25||T.node_type==30)?(T.typ==="object"||T.typ=="string"||T.typ=="array<object>")&&C.push({...T}):(T.typ==="object"||T.typ=="string")&&C.push({...T}));return C}return _(g)}const l=Je({input_variable:[],input_tags:[],output:[{key:"",typ:"object",subs:[]}]}),d=()=>{const g=JSON.stringify({json_decode:{...l,input_variable:l.input_variable?l.input_variable.join("."):""}});t("update-node",{...o.node,node_params:g})},c=()=>{try{let g=o.node.dataRaw||o.node.node_params||"{}",_=JSON.parse(g).json_decode||{};_=JSON.parse(JSON.stringify(_)),r(),l.input_variable=v_(_.input_variable),_.output.length>0&&(l.output=_.output)}catch(g){}};ct(()=>l,()=>{d()},{deep:!0});const p=g=>{g.subs=[]},f=g=>{l.output[g].subs.push({key:"",value:"",subs:[],cu_key:Ht(16)})},h=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],v=g=>{g||r()},y=()=>{t("close")};return at(()=>{c()}),(g,_)=>{const b=li,C=en,T=Lt,M=$t,S=In,k=Cn,A=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于把JSON字符串转化为变量",onClose:y},null,8,["title","iconName"])]),default:x(()=>[u("div",CX,[u("div",kX,[m(A,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[u("div",SX,[_[2]||(_[2]=u("div",{class:"gray-block-title"},"输入 (string格式数据)",-1)),u("div",EX,[m(b,{value:l.input_variable,"onUpdate:value":_[0]||(_[0]=$=>l.input_variable=$),onDropdownVisibleChange:v,style:{width:"400px"},options:i.value,"change-on-select":"",allowClear:!1,displayRender:({labels:$})=>$.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),u("div",AX,[_[4]||(_[4]=u("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),u("div",DX,[_[3]||(_[3]=u("div",{class:"output-block"},[u("div",{class:"output-item"},"参数Key"),u("div",{class:"output-item"},"类型")],-1)),u("div",{class:"array-form-box",onMousedown:_[1]||(_[1]=Ct(()=>{},["stop"]))},[(w(!0),R(se,null,ge(l.output,($,B)=>(w(),R("div",{class:"form-item-list",key:B},[m(k,{label:null,name:["output",B,"key"]},{default:x(()=>[u("div",OX,[m(C,{style:{width:"214px"},value:$.key,"onUpdate:value":O=>$.key=O,placeholder:"请输入"},null,8,["value","onUpdate:value"]),m(S,null,{default:x(()=>[m(M,{onChange:O=>p($),value:$.typ,"onUpdate:value":O=>$.typ=O,placeholder:"请选择",showArrow:!1,disabled:"",style:{width:"214px"}},{default:x(()=>[(w(),R(se,null,ge(h,O=>m(T,{value:O.value,key:O.value},{default:x(()=>[U(H(O.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),$.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:O=>f(B)},[m(K(Bn))],8,NX)):ne("",!0)]),$.subs&&$.subs.length>0?(w(),R("div",MX,[m(S,null,{default:x(()=>[m(wX,{data:$.subs,level:2,typOptions:h},null,8,["data"])]),_:2},1024)])):ne("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},$X=Ne(TX,[["__scopeId","data-v-c1b75305"]]),RX="/assets/img/menu-guide-CcoPw7QZ.png",PX={class:"problem-optimization-form"},LX={class:"node-form-content"},BX={class:"gray-block"},IX={class:"array-form-box"},jX={key:0,class:"menu-list-box"},FX={class:"menu-border-box"},VX={class:"drag-btn"},HX={class:"index-number"},UX={class:"input-box"},zX={class:"action-btn"},qX={class:"gray-block mt16"},GX={class:"options-item"},XX=`
用户输入的文字和图片消息示例如下：
"question_multiple": [
{
"type": "text",
"text": "这是什么",
},{
"type": "image",
"image_url": "https://url"
}]"
`,WX={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X(null),r=X(null),s=X([]);function a(){const M=o.lf.getNodeModelById(o.nodeId);if(M){let S=M.getAllParentVariable();s.value=S}}const l=M=>{M&&a()},d=X({menu_type:"-1",serial_no:"-1",content:"其他未点击智能菜单的情况（用户不可见）"}),c=Je({answer_text:"",answer_type:"text",menu_content:[{menu_type:"1",serial_no:"1",content:"",key:Ht(16)},{menu_type:"1",serial_no:"2",content:"",key:Ht(16)}],outputs:[{key:"question",typ:"string",subs:[]},{key:"question_multiple",typ:"array<object>",subs:[]}]}),p=()=>{let M=c.menu_content.map((A,$)=>({...A,serial_no:($+1).toString()}));M.push(d.value);const k=JSON.stringify({question:{...c,reply_content_list:[{reply_type:"smartMenu",smart_menu:{menu_content:M}}]}});t("update-node",{...o.node,node_params:k})},f=(M,S)=>{c.answer_text=M},h=(M,S,k)=>{k.content=M},v=()=>{var M;try{let S=o.node.dataRaw||o.node.node_params||"{}",k=JSON.parse(S).question||{};k=JSON.parse(JSON.stringify(k)),c.answer_text=k.answer_text||"",c.answer_type=k.answer_type||"text";let A=k.reply_content_list||[];if(A.length>0){let $=((M=A[0].smart_menu)==null?void 0:M.menu_content)||[];if($.length>0){let B=$.find(O=>O.menu_type=="-1");B&&(d.value=B),c.menu_content=$.filter(O=>O.menu_type!="-1").map(O=>({...O,key:Ht(16)}))}}a()}catch(S){}};ct(()=>c,()=>{p()},{deep:!0});const y=()=>{i.value.refresh()},g=()=>{r.value.show()},_=()=>{t("close")},b=()=>{},C=M=>{if(c.menu_content.length<=1)return mt.warning("最少添加1条菜单");c.menu_content.splice(M,1)},T=()=>{c.menu_content.push({menu_type:"1",serial_no:(c.menu_content.length+1).toString(),content:"",key:Ht(16)})};return at(()=>{v()}),(M,S)=>{const k=ko,A=ro,$=jr,B=io,O=Cn,P=On,E=Xt,D=Zt,N=xn;return w(),Q(tn,null,{header:x(()=>[m(nn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"支持中间向用户提问问题，支持预置选项提问和开放式问题提问两种方式",onClose:_},null,8,["title","iconName"])]),default:x(()=>[u("div",PX,[u("div",LX,[m(N,{ref:"formRef",layout:"vertical",model:c},{default:x(()=>[u("div",BX,[m(k,{justify:"space-between"},{default:x(()=>[S[5]||(S[5]=u("div",{class:"gray-block-title"},"提问内容",-1)),u("div",{class:"btn-hover-wrap",onClick:g},[m(K(po))])]),_:1}),u("div",IX,[m(tt,{inputStyle:"height: 100px;",options:s.value,defaultValue:c.answer_text,ref_key:"atInputRef",ref:i,placeholder:"请输入消息内容，键入“/”插入变量","input-style":"height: 130px",type:"textarea",onOpen:l,onChange:S[0]||(S[0]=(F,Y)=>f(F,Y))},null,8,["options","defaultValue"])]),m(O,{label:"回答类型"},{default:x(()=>[m(B,{value:c.answer_type,"onUpdate:value":S[1]||(S[1]=F=>c.answer_type=F)},{default:x(()=>[m(A,{value:"text"},{default:x(()=>[...S[6]||(S[6]=[U("直接回答",-1)])]),_:1}),m(A,{value:"menu"},{default:x(()=>[S[8]||(S[8]=U("智能菜单回答 ",-1)),m($,{title:null},{content:x(()=>[...S[7]||(S[7]=[u("div",null,[u("img",{style:{width:"330px"},src:RX,alt:""})],-1)])]),default:x(()=>[m(K(ft))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),c.answer_type=="menu"?(w(),R("div",jX,[m(K(b_),{modelValue:c.menu_content,"onUpdate:modelValue":S[2]||(S[2]=F=>c.menu_content=F),"item-key":"key",onEnd:b,group:"table-rows",handle:".drag-btn"},{item:x(({element:F,index:Y})=>[(w(),R("div",{key:F.id,class:"menu-item"},[u("div",FX,[u("span",VX,[m(P,{name:"drag"})]),u("span",HX,H(Y+1),1),u("div",UX,[m(tt,{inputStyle:"height: 22px;",bordered:!1,options:s.value,defaultValue:F.content,placeholder:"请输入消息内容，键入“/”插入变量",onOpen:l,onChange:(L,j)=>h(L,j,F)},null,8,["options","defaultValue","onChange"])])]),u("span",zX,[m(K(Ut),{onClick:L=>C(Y)},null,8,["onClick"])])]))]),_:1},8,["modelValue"]),u("div",null,[m(E,{onClick:S[3]||(S[3]=F=>T()),type:"dashed",block:""},{default:x(()=>[m(K(Mt)),S[9]||(S[9]=U("添加菜单",-1))]),_:1})])])):ne("",!0)]),u("div",qX,[S[12]||(S[12]=u("div",{class:"gray-block-title"},"输出",-1)),S[13]||(S[13]=u("div",{class:"options-item"},[u("div",{class:"option-label"},"question"),u("div",{class:"option-type"},"string")],-1)),u("div",GX,[S[10]||(S[10]=u("div",{class:"option-label"},"question_multiple",-1)),S[11]||(S[11]=u("div",{class:"option-type",textContent:"array<object>"},null,-1)),m(D,null,{title:x(()=>[u("pre",null,"                    "+H(XX)+`
                  `)]),default:x(()=>[m(K(ft))]),_:1})])])]),_:1},8,["model"])]),m(Hi,{options:s.value,defaultValue:c.answer_text,placeholder:"请输入消息内容，键入'/'可以插入变量",type:"textarea",onOpen:l,onChange:S[4]||(S[4]=(F,Y)=>f(F,Y)),onOk:y,ref_key:"fullAtInputRef",ref:r},null,8,["options","defaultValue"])])]),_:1})}}},YX=Ne(WX,[["__scopeId","data-v-34b44369"]]),JX=["src"],KX={class:"workflow-form"},ZX={class:"node-options"},QX={class:"options-item-tit"},eW={class:"option-label"},tW={class:"option-type"},nW={class:"field-list-item"},oW={class:"field-label"},iW={class:"field-type"},rW={class:"desc"},sW={class:"node-options"},aW={class:"options-item"},lW={__name:"zm-workflow-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=Ve("getNode"),t=Ve("setData"),o=n,i=X([]),r=X([]),s=X({}),a=X([]);let l={};async function d(){var v,y;p(),l=JSON.parse(o.node.node_params),a.value=((v=l==null?void 0:l.workflow)==null?void 0:v.output)||[],s.value=((y=l==null?void 0:l.workflow)==null?void 0:y.robot_info)||{},c()}function c(){var v;n_({robot_id:(v=l==null?void 0:l.workflow)==null?void 0:v.robot_id}).then(y=>{var b,C,T;let g=Fo((b=y==null?void 0:y.data)==null?void 0:b.node_params),_=((C=l==null?void 0:l.workflow)==null?void 0:C.params)||[];i.value=((T=g==null?void 0:g.start)==null?void 0:T.diy_global)||[];for(let M of i.value){let S=_.find(k=>M.key==k.key);M.variable=(S==null?void 0:S.variable)||"",M.tags=Array.isArray(S==null?void 0:S.tags)?S.tags:[]}})}function p(){r.value=e().getAllParentVariable()}function f(v,y,g){v.variable=y,v.tags=g,h()}function h(){let v=JSON.parse(JSON.stringify(i.value));for(let y of v)y.variable=String(y.variable);l.workflow.params=v,t({...o.node,node_params:JSON.stringify(l)})}return at(()=>{d()}),(v,y)=>{const g=ho;return w(),Q(tn,null,{header:x(()=>{var _;return[m(nn,{title:n.node.node_name,desc:(_=s.value)==null?void 0:_.robot_intro},{"node-icon":x(()=>[s.value.robot_avatar?(w(),R("img",{key:0,class:"node-icon",src:s.value.robot_avatar},null,8,JX)):(w(),Q(g,{key:1,size:"small"}))]),_:1},8,["title","desc"])]}),default:x(()=>[u("div",KX,[u("div",ZX,[y[0]||(y[0]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:Yn,class:"title-icon"}),U("输入")])],-1)),(w(!0),R(se,null,ge(i.value,_=>(w(),R("div",{key:_.key,class:xt(["options-item",{"is-required":_.required}])},[u("div",QX,[u("div",eW,H(_.name||_.key),1),u("div",tW,H(_.typ),1)]),u("div",null,[m(tt,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:_.tags,defaultValue:_.variable,ref_for:!0,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:p,onChange:(b,C)=>f(_,b,C)},{option:x(({label:b,payload:C})=>[u("div",nW,[u("div",oW,H(b),1),u("div",iW,H(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),u("div",rW,H(_.desc),1)],2))),128))]),u("div",sW,[y[1]||(y[1]=u("div",{class:"options-title"},[u("div",null,[u("img",{src:to,class:"title-icon"}),U("输出")])],-1)),u("div",aW,[m(Oi,{"tree-data":a.value},null,8,["tree-data"])])])])]),_:1})}}},uW=Ne(lW,[["__scopeId","data-v-d0944414"]]),dW=["width"],cW={class:"node-form-drawer-body"},pW=["node-key"],fW={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(n,{expose:e,emit:t}){const o={"start-node":t3,"problem-optimization-node":R3,"ai-dialogue-node":sA,"add-data-node":HA,"knowledge-base-node":uO,"code-run-node":YO,"http-node":a8,"http-tool-node":c4,"delete-data-node":N4,"variable-assignment-node":H4,"update-data-node":Y4,"parameter-extraction-node":NM,"select-data-node":cT,"question-node":RT,"judge-node":qT,"specify-reply-node":QT,"immediately-reply-node":a6,"mcp-node":y6,"custom-group":J6,"batch-group":cV,"zm-plugins-node":Aj,"session-trigger-node":Fj,"timing-trigger-node":Jj,"end-node":YV,"official-trigger-node":cF,"image-generation-node":Yz,"voice-clone-node":sU,"voice-synthesis-node":xz,"explain-node":tq,"webhook-trigger-node":tG,"import-library-node":tX,"json-node":gX,"json-reverse-node":$X,"qa-node":YX,"zm-workflow-node":uW},i=t,r=n,s=We({get:()=>r.open,set:_=>i("update:open",_)}),a=()=>{s.value=!1},l=We(()=>{var T,M,S;let _=Fo((T=r.node)==null?void 0:T.node_params);return((M=_==null?void 0:_.plugin)==null?void 0:M.name)=="feishu_bitable"||((S=_==null?void 0:_.plugin)==null?void 0:S.name)=="official_send_message"?600:(()=>{var B;const k=(B=_==null?void 0:_.plugin)==null?void 0:B.params;if(!k)return!1;const A=k==null?void 0:k.params;if(A&&typeof A=="object")for(const O in A){const P=A[O];if(P&&P.date_range_begin_component)return!0}const $=k==null?void 0:k.arguments;if($&&typeof $=="object"){const O=Object.keys($||{});if(O.includes("date_type")||O.includes("begin_date")&&O.includes("end_date"))return!0}return!1})()?640:{"delete-data-node":600,"update-data-node":600,"select-data-node":600,"judge-node":600,"custom-group":640,"timing-trigger-node":420,"batch-group":640,"webhook-trigger-node":620,"end-node":650}[r.nodeType]||480}),d=()=>r.lf.getNodeModelById(r.nodeId),c=()=>r.lf.graphModel,p=_=>{y(_)},f=_=>{i("change-title",_)},h=()=>{s.value=!1;let _=d();c().eventCenter.emit("custom:node:delete",_)};Gi("lf",r.lf),Gi("getNode",d),Gi("getGraph",c),Gi("setData",p),Gi("changeTitle",f),Gi("deleteNode",h),Gi("close",a);const v=We(()=>{const _=`${r.nodeType}`;return o[_]||null}),y=_=>{_.dataRaw=_.node_params,i("update-node",_)},g=()=>{s.value=!1};return e({open}),(_,b)=>{const C=Xt,T=_y;return w(),Q(Fm,{name:"slide-right",appear:""},{default:x(()=>[s.value?(w(),R("div",{key:0,width:l.value,style:Fn({width:l.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:jm(g,["esc"])},[u("div",cW,[u("div",{class:"drawer-form","node-key":r.nodeType},[v.value?(w(),Q(Pu(v.value),{lf:r.lf,"node-id":r.nodeId,"node-type":r.nodeType,node:r.node,key:r.nodeId,onClose:g,onUpdateNode:y},null,40,["lf","node-id","node-type","node"])):(w(),Q(T,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:x(()=>[m(C,{type:"primary",onClick:g},{default:x(()=>[...b[0]||(b[0]=[U("关闭",-1)])]),_:1})]),_:1}))],8,pW)])],44,dW)):ne("",!0)]),_:1})}}},hW=Ne(fW,[["__scopeId","data-v-cee4cfb6"]]);var Uu,Wt,V_,xr,Nf,H_,U_,z_,cp,Xd,Wd,ka={},q_=[],vW=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Wa=Array.isArray;function Bi(n,e){for(var t in e)n[t]=e[t];return n}function pp(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function et(n,e,t){var o,i,r,s={};for(r in e)r=="key"?o=e[r]:r=="ref"?i=e[r]:s[r]=e[r];if(arguments.length>2&&(s.children=arguments.length>3?Uu.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)s[r]===void 0&&(s[r]=n.defaultProps[r]);return Nl(n,s,o,i,null)}function Nl(n,e,t,o,i){var r={type:n,props:e,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++V_,__i:-1,__u:0};return i==null&&Wt.vnode!=null&&Wt.vnode(r),r}function zu(){return{current:null}}function vs(n){return n.children}function Kt(n,e){this.props=n,this.context=e}function _s(n,e){if(e==null)return n.__?_s(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?_s(n):null}function G_(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return G_(n)}}function Mf(n){(!n.__d&&(n.__d=!0)&&xr.push(n)&&!Hl.__r++||Nf!=Wt.debounceRendering)&&((Nf=Wt.debounceRendering)||H_)(Hl)}function Hl(){for(var n,e,t,o,i,r,s,a=1;xr.length;)xr.length>a&&xr.sort(U_),n=xr.shift(),a=xr.length,n.__d&&(t=void 0,o=void 0,i=(o=(e=n).__v).__e,r=[],s=[],e.__P&&((t=Bi({},o)).__v=o.__v+1,Wt.vnode&&Wt.vnode(t),fp(e.__P,t,o,e.__n,e.__P.namespaceURI,32&o.__u?[i]:null,r,i??_s(o),!!(32&o.__u),s),t.__v=o.__v,t.__.__k[t.__i]=t,Y_(r,t,s),o.__e=o.__=null,t.__e!=i&&G_(t)));Hl.__r=0}function X_(n,e,t,o,i,r,s,a,l,d,c){var p,f,h,v,y,g,_,b=o&&o.__k||q_,C=e.length;for(l=_W(t,e,b,l,C),p=0;p<C;p++)(h=t.__k[p])!=null&&(f=h.__i==-1?ka:b[h.__i]||ka,h.__i=p,g=fp(n,h,f,i,r,s,a,l,d,c),v=h.__e,h.ref&&f.ref!=h.ref&&(f.ref&&hp(f.ref,null,h),c.push(h.ref,h.__c||v,h)),y==null&&v!=null&&(y=v),(_=!!(4&h.__u))||f.__k===h.__k?l=W_(h,l,n,_):typeof h.type=="function"&&g!==void 0?l=g:v&&(l=v.nextSibling),h.__u&=-7);return t.__e=y,l}function _W(n,e,t,o,i){var r,s,a,l,d,c=t.length,p=c,f=0;for(n.__k=new Array(i),r=0;r<i;r++)(s=e[r])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=n.__k[r]=Nl(null,s,null,null,null):Wa(s)?s=n.__k[r]=Nl(vs,{children:s},null,null,null):s.constructor==null&&s.__b>0?s=n.__k[r]=Nl(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):n.__k[r]=s,l=r+f,s.__=n,s.__b=n.__b+1,(d=s.__i=gW(s,t,l,p))!=-1&&(p--,(a=t[d])&&(a.__u|=2)),a==null||a.__v==null?(d==-1&&(i>c?f--:i<c&&f++),typeof s.type!="function"&&(s.__u|=4)):d!=l&&(d==l-1?f--:d==l+1?f++:(d>l?f--:f++,s.__u|=4))):n.__k[r]=null;if(p)for(r=0;r<c;r++)(a=t[r])!=null&&(2&a.__u)==0&&(a.__e==o&&(o=_s(a)),K_(a,a));return o}function W_(n,e,t,o){var i,r;if(typeof n.type=="function"){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,e=W_(i[r],e,t,o));return e}n.__e!=e&&(o&&(e&&n.type&&!e.parentNode&&(e=_s(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ul(n,e){return e=e||[],n==null||typeof n=="boolean"||(Wa(n)?n.some(function(t){Ul(t,e)}):e.push(n)),e}function gW(n,e,t,o){var i,r,s,a=n.key,l=n.type,d=e[t],c=d!=null&&(2&d.__u)==0;if(d===null&&a==null||c&&a==d.key&&l==d.type)return t;if(o>(c?1:0)){for(i=t-1,r=t+1;i>=0||r<e.length;)if((d=e[s=i>=0?i--:r++])!=null&&(2&d.__u)==0&&a==d.key&&l==d.type)return s}return-1}function Tf(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||vW.test(e)?t:t+"px"}function rl(n,e,t,o,i){var r,s;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof o=="string"&&(n.style.cssText=o=""),o)for(e in o)t&&e in t||Tf(n.style,e,"");if(t)for(e in t)o&&t[e]==o[e]||Tf(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(z_,"$1")),s=e.toLowerCase(),e=s in n||e=="onFocusOut"||e=="onFocusIn"?s.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?o?t.u=o.u:(t.u=cp,n.addEventListener(e,r?Wd:Xd,r)):n.removeEventListener(e,r?Wd:Xd,r);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function $f(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=cp++;else if(e.t<t.u)return;return t(Wt.event?Wt.event(e):e)}}}function fp(n,e,t,o,i,r,s,a,l,d){var c,p,f,h,v,y,g,_,b,C,T,M,S,k,A,$,B,O=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(c=Wt.__b)&&c(e);e:if(typeof O=="function")try{if(_=e.props,b="prototype"in O&&O.prototype.render,C=(c=O.contextType)&&o[c.__c],T=c?C?C.props.value:c.__:o,t.__c?g=(p=e.__c=t.__c).__=p.__E:(b?e.__c=p=new O(_,T):(e.__c=p=new Kt(_,T),p.constructor=O,p.render=yW),C&&C.sub(p),p.state||(p.state={}),p.__n=o,f=p.__d=!0,p.__h=[],p._sb=[]),b&&p.__s==null&&(p.__s=p.state),b&&O.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=Bi({},p.__s)),Bi(p.__s,O.getDerivedStateFromProps(_,p.__s))),h=p.props,v=p.state,p.__v=e,f)b&&O.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),b&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(b&&O.getDerivedStateFromProps==null&&_!==h&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(_,T),e.__v==t.__v||!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(_,p.__s,T)===!1){for(e.__v!=t.__v&&(p.props=_,p.state=p.__s,p.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(P){P&&(P.__=e)}),M=0;M<p._sb.length;M++)p.__h.push(p._sb[M]);p._sb=[],p.__h.length&&s.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(_,p.__s,T),b&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(h,v,y)})}if(p.context=T,p.props=_,p.__P=n,p.__e=!1,S=Wt.__r,k=0,b){for(p.state=p.__s,p.__d=!1,S&&S(e),c=p.render(p.props,p.state,p.context),A=0;A<p._sb.length;A++)p.__h.push(p._sb[A]);p._sb=[]}else do p.__d=!1,S&&S(e),c=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++k<25);p.state=p.__s,p.getChildContext!=null&&(o=Bi(Bi({},o),p.getChildContext())),b&&!f&&p.getSnapshotBeforeUpdate!=null&&(y=p.getSnapshotBeforeUpdate(h,v)),$=c,c!=null&&c.type===vs&&c.key==null&&($=J_(c.props.children)),a=X_(n,Wa($)?$:[$],e,t,o,i,r,s,a,l,d),p.base=e.__e,e.__u&=-161,p.__h.length&&s.push(p),g&&(p.__E=p.__=null)}catch(P){if(e.__v=null,l||r!=null)if(P.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else{for(B=r.length;B--;)pp(r[B]);Yd(e)}else e.__e=t.__e,e.__k=t.__k,P.then||Yd(e);Wt.__e(P,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=mW(t.__e,e,t,o,i,r,s,l,d);return(c=Wt.diffed)&&c(e),128&e.__u?void 0:a}function Yd(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Yd)}function Y_(n,e,t){for(var o=0;o<t.length;o++)hp(t[o],t[++o],t[++o]);Wt.__c&&Wt.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(r){r.call(i)})}catch(r){Wt.__e(r,i.__v)}})}function J_(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:Wa(n)?n.map(J_):Bi({},n)}function mW(n,e,t,o,i,r,s,a,l){var d,c,p,f,h,v,y,g=t.props||ka,_=e.props,b=e.type;if(b=="svg"?i="http://www.w3.org/2000/svg":b=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(d=0;d<r.length;d++)if((h=r[d])&&"setAttribute"in h==!!b&&(b?h.localName==b:h.nodeType==3)){n=h,r[d]=null;break}}if(n==null){if(b==null)return document.createTextNode(_);n=document.createElementNS(i,b,_.is&&_),a&&(Wt.__m&&Wt.__m(e,r),a=!1),r=null}if(b==null)g===_||a&&n.data==_||(n.data=_);else{if(r=r&&Uu.call(n.childNodes),!a&&r!=null)for(g={},d=0;d<n.attributes.length;d++)g[(h=n.attributes[d]).name]=h.value;for(d in g)if(h=g[d],d!="children"){if(d=="dangerouslySetInnerHTML")p=h;else if(!(d in _)){if(d=="value"&&"defaultValue"in _||d=="checked"&&"defaultChecked"in _)continue;rl(n,d,null,h,i)}}for(d in _)h=_[d],d=="children"?f=h:d=="dangerouslySetInnerHTML"?c=h:d=="value"?v=h:d=="checked"?y=h:a&&typeof h!="function"||g[d]===h||rl(n,d,h,g[d],i);if(c)a||p&&(c.__html==p.__html||c.__html==n.innerHTML)||(n.innerHTML=c.__html),e.__k=[];else if(p&&(n.innerHTML=""),X_(e.type=="template"?n.content:n,Wa(f)?f:[f],e,t,o,b=="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,s,r?r[0]:t.__k&&_s(t,0),a,l),r!=null)for(d=r.length;d--;)pp(r[d]);a||(d="value",b=="progress"&&v==null?n.removeAttribute("value"):v!=null&&(v!==n[d]||b=="progress"&&!v||b=="option"&&v!=g[d])&&rl(n,d,v,g[d],i),d="checked",y!=null&&y!=n[d]&&rl(n,d,y,g[d],i))}return n}function hp(n,e,t){try{if(typeof n=="function"){var o=typeof n.__u=="function";o&&n.__u(),o&&e==null||(n.__u=n(e))}else n.current=e}catch(i){Wt.__e(i,t)}}function K_(n,e,t){var o,i;if(Wt.unmount&&Wt.unmount(n),(o=n.ref)&&(o.current&&o.current!=n.__e||hp(o,null,e)),(o=n.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(r){Wt.__e(r,e)}o.base=o.__P=null}if(o=n.__k)for(i=0;i<o.length;i++)o[i]&&K_(o[i],e,t||typeof n.type!="function");t||pp(n.__e),n.__c=n.__=n.__e=void 0}function yW(n,e,t){return this.constructor(n,t)}function bW(n,e,t){var o,i,r,s;e==document&&(e=document.documentElement),Wt.__&&Wt.__(n,e),i=(o=!1)?null:e.__k,r=[],s=[],fp(e,n=e.__k=et(vs,null,[n]),i||ka,ka,e.namespaceURI,i?null:e.firstChild?Uu.call(e.childNodes):null,r,i?i.__e:e.firstChild,o,s),Y_(r,n,s)}Uu=q_.slice,Wt={__e:function(n,e,t,o){for(var i,r,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(n)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,o||{}),s=i.__d),s)return i.__E=i}catch(a){n=a}throw n}},V_=0,Kt.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Bi({},this.state),typeof n=="function"&&(n=n(Bi({},t),this.props)),n&&Bi(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Mf(this))},Kt.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Mf(this))},Kt.prototype.render=vs,xr=[],H_=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,U_=function(n,e){return n.__v.__b-e.__v.__b},Hl.__r=0,z_=/(PointerCapture)$|Capture$/i,cp=0,Xd=$f(!1),Wd=$f(!0);var xW="An invariant failed, however the error is obfuscated because this is a production build.",zl=[];Object.freeze(zl);var vp={};Object.freeze(vp);function fo(){return++bt.mobxGuid}function hn(n){throw Or(!1,n),"X"}function Or(n,e){if(!n)throw new Error("[mobx] "+(e||xW))}function Z_(n){var e=!1;return function(){if(!e)return e=!0,n.apply(this,arguments)}}var sl=function(){};function wW(n){var e=[];return n.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function _p(n){return n!==null&&typeof n=="object"}function Ls(n){if(n===null||typeof n!="object")return!1;var e=Object.getPrototypeOf(n);return e===Object.prototype||e===null}function CW(n){if(Is(n)||_o(n))return n;if(Array.isArray(n))return new Map(n);if(Ls(n)){var e=new Map;for(var t in n)e.set(t,n[t]);return e}else return hn("Cannot convert to map from '"+n+"'")}function Bs(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function kW(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function SW(n,e){var t=Object.getOwnPropertyDescriptor(n,e);return!t||t.configurable!==!1&&t.writable!==!1}function dr(n,e){var t="isMobX"+n;return e.prototype[t]=!0,function(o){return _p(o)&&o[t]===!0}}function Is(n){return n instanceof Map}function Ya(n){return n instanceof Set}function Q_(n){var e=new Set;for(var t in n)e.add(t);return Object.getOwnPropertySymbols(n).forEach(function(o){Object.getOwnPropertyDescriptor(n,o).enumerable&&e.add(o)}),Array.from(e)}function Zi(n){return n&&n.toString?n.toString():new String(n).toString()}function eg(n){return n===null?null:typeof n=="object"?""+n:n}var EW=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Rt=Symbol("mobx administration"),js=(function(){function n(e){e===void 0&&(e="Atom@"+fo()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=mn.NOT_TRACKING}return n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.reportObserved=function(){return cg(this)},n.prototype.reportChanged=function(){ti(),WW(this),ni()},n.prototype.toString=function(){return this.name},n})(),gp=dr("Atom",js);function mp(n,e,t){e===void 0&&(e=sl),t===void 0&&(t=sl);var o=new js(n);return e!==sl&&aY(o,e),t!==sl&&gg(o,t),o}function AW(n,e){return Ag(n,e)}function DW(n,e){return Object.is(n,e)}var gs={structural:AW,default:DW};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Jd=function(n,e){return Jd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])},Jd(n,e)};function OW(n,e){Jd(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ql=function(){return ql=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++){t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ql.apply(this,arguments)};function yi(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],t=0;return e?e.call(n):{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}function is(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r}function yp(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(is(arguments[e]));return n}var Gl=Symbol("mobx did run lazy initializers"),Zs=Symbol("mobx pending decorators"),NW={},MW={};function TW(n,e){var t=e?NW:MW;return t[n]||(t[n]={configurable:!0,enumerable:e,get:function(){return Pr(this),this[n]},set:function(o){Pr(this),this[n]=o}})}function Pr(n){var e,t;if(n[Gl]!==!0){var o=n[Zs];if(o){Bs(n,Gl,!0);var i=yp(Object.getOwnPropertySymbols(o),Object.keys(o));try{for(var r=yi(i),s=r.next();!s.done;s=r.next()){var a=s.value,l=o[a];l.propertyCreator(n,l.prop,l.descriptor,l.decoratorTarget,l.decoratorArguments)}}catch(d){e={error:d}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}}}function tg(n,e){return function(){var o,i=function(s,a,l,d){if(d===!0)return e(s,a,l,s,o),null;if(!Object.prototype.hasOwnProperty.call(s,Zs)){var c=s[Zs];Bs(s,Zs,ql({},c))}return s[Zs][a]={prop:a,propertyCreator:e,descriptor:l,decoratorTarget:s,decoratorArguments:o},TW(a,n)};return $W(arguments)?(o=zl,i.apply(null,arguments)):(o=Array.prototype.slice.call(arguments),i)}}function $W(n){return(n.length===2||n.length===3)&&(typeof n[1]=="string"||typeof n[1]=="symbol")||n.length===4&&n[3]===!0}function Ja(n,e,t){return xs(n)?n:Array.isArray(n)?Re.array(n,{name:t}):Ls(n)?Re.object(n,void 0,{name:t}):Is(n)?Re.map(n,{name:t}):Ya(n)?Re.set(n,{name:t}):n}function RW(n,e,t){return n==null||ui(n)||Ni(n)||_o(n)||Uo(n)?n:Array.isArray(n)?Re.array(n,{name:t,deep:!1}):Ls(n)?Re.object(n,void 0,{name:t,deep:!1}):Is(n)?Re.map(n,{name:t,deep:!1}):Ya(n)?Re.set(n,{name:t,deep:!1}):hn(!1)}function qu(n){return n}function PW(n,e,t){return Ag(n,e)?e:n}function Gu(n){Or(n);var e=tg(!0,function(o,i,r,s,a){var l=r?r.initializer?r.initializer.call(o):r.value:void 0;kp(o).addObservableProp(i,l,n)}),t=e;return t.enhancer=n,t}var ng={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(ng);function ts(n){return n==null?ng:typeof n=="string"?{name:n,deep:!0,proxy:!0}:n}var bp=Gu(Ja),LW=Gu(RW),og=Gu(qu),BW=Gu(PW);function al(n){return n.defaultDecorator?n.defaultDecorator.enhancer:n.deep===!1?qu:Ja}function IW(n,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return bp.apply(null,arguments);if(xs(n))return n;var o=Ls(n)?Re.object(n,e,t):Array.isArray(n)?Re.array(n,e):Is(n)?Re.map(n,e):Ya(n)?Re.set(n,e):n;if(o!==n)return o;hn(!1)}var Rf={box:function(n,e){arguments.length>2&&Gs("box");var t=ts(e);return new Mr(n,al(t),t.name,!0,t.equals)},array:function(n,e){arguments.length>2&&Gs("array");var t=ts(e);return wY(n,al(t),t.name)},map:function(n,e){arguments.length>2&&Gs("map");var t=ts(e);return new Cp(n,al(t),t.name)},set:function(n,e){arguments.length>2&&Gs("set");var t=ts(e);return new Sg(n,al(t),t.name)},object:function(n,e,t){typeof arguments[1]=="string"&&Gs("object");var o=ts(t);if(o.proxy===!1)return nc({},n,e,o);var i=yg(o),r=nc({},void 0,void 0,o),s=yY(r);return bg(s,n,e,i),s},ref:og,shallow:LW,deep:bp,struct:BW},Re=IW;Object.keys(Rf).forEach(function(n){return Re[n]=Rf[n]});function Gs(n){hn("Expected one or two arguments to observable."+n+". Did you accidentally try to use observable."+n+" as decorator?")}var Xl=tg(!1,function(n,e,t,o,i){var r=t.get,s=t.set,a=i[0]||{};kp(n).addComputedProp(n,e,ql({get:r,set:s,context:n},a))}),jW=Xl({equals:gs.structural}),bn=function(e,t,o){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return Xl.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new ys(i)};bn.struct=jW;var mn;(function(n){n[n.NOT_TRACKING=-1]="NOT_TRACKING",n[n.UP_TO_DATE=0]="UP_TO_DATE",n[n.POSSIBLY_STALE=1]="POSSIBLY_STALE",n[n.STALE=2]="STALE"})(mn||(mn={}));var wi;(function(n){n[n.NONE=0]="NONE",n[n.LOG=1]="LOG",n[n.BREAK=2]="BREAK"})(wi||(wi={}));var Wl=(function(){function n(e){this.cause=e}return n})();function Qs(n){return n instanceof Wl}function Kd(n){switch(n.dependenciesState){case mn.UP_TO_DATE:return!1;case mn.NOT_TRACKING:case mn.STALE:return!0;case mn.POSSIBLY_STALE:{for(var e=xp(!0),t=Fs(),o=n.observing,i=o.length,r=0;r<i;r++){var s=o[r];if(bs(s)){if(bt.disableErrorBoundaries)s.get();else try{s.get()}catch{return nr(t),na(e),!0}if(n.dependenciesState===mn.STALE)return nr(t),na(e),!0}}return sg(n),nr(t),na(e),!1}}}function ms(n){var e=n.observers.size>0;bt.computationDepth>0&&e&&hn(!1),!bt.allowStateChanges&&(e||bt.enforceActions==="strict")&&hn(!1)}function ig(n,e,t){var o=xp(!0);sg(n),n.newObserving=new Array(n.observing.length+100),n.unboundDepsCount=0,n.runId=++bt.runId;var i=bt.trackingDerivation;bt.trackingDerivation=n;var r;if(bt.disableErrorBoundaries===!0)r=e.call(t);else try{r=e.call(t)}catch(s){r=new Wl(s)}return bt.trackingDerivation=i,FW(n),na(o),r}function FW(n){for(var e=n.observing,t=n.observing=n.newObserving,o=mn.UP_TO_DATE,i=0,r=n.unboundDepsCount,s=0;s<r;s++){var a=t[s];a.diffValue===0&&(a.diffValue=1,i!==s&&(t[i]=a),i++),a.dependenciesState>o&&(o=a.dependenciesState)}for(t.length=i,n.newObserving=null,r=e.length;r--;){var a=e[r];a.diffValue===0&&ug(a,n),a.diffValue=0}for(;i--;){var a=t[i];a.diffValue===1&&(a.diffValue=0,XW(a,n))}o!==mn.UP_TO_DATE&&(n.dependenciesState=o,n.onBecomeStale())}function Zd(n){var e=n.observing;n.observing=[];for(var t=e.length;t--;)ug(e[t],n);n.dependenciesState=mn.NOT_TRACKING}function rg(n){var e=Fs();try{return n()}finally{nr(e)}}function Fs(){var n=bt.trackingDerivation;return bt.trackingDerivation=null,n}function nr(n){bt.trackingDerivation=n}function xp(n){var e=bt.allowStateReads;return bt.allowStateReads=n,e}function na(n){bt.allowStateReads=n}function sg(n){if(n.dependenciesState!==mn.UP_TO_DATE){n.dependenciesState=mn.UP_TO_DATE;for(var e=n.observing,t=e.length;t--;)e[t].lowestObserverState=mn.UP_TO_DATE}}var Yl=0,VW=1,Pf=Object.getOwnPropertyDescriptor(function(){},"name");Pf&&Pf.configurable;function Nr(n,e,t){var o=function(){return ag(n,e,t||this,arguments)};return o.isMobxAction=!0,o}function ag(n,e,t,o){var i=HW();try{return e.apply(t,o)}catch(r){throw i.error=r,r}finally{UW(i)}}function HW(n,e,t){var o=Io(),i=0,r=Fs();ti();var s=Xu(!0),a=xp(!0),l={prevDerivation:r,prevAllowStateChanges:s,prevAllowStateReads:a,notifySpy:o,startTime:i,actionId:VW++,parentActionId:Yl};return Yl=l.actionId,l}function UW(n){Yl!==n.actionId&&hn("invalid action stack. did you forget to finish an action?"),Yl=n.parentActionId,n.error!==void 0&&(bt.suppressReactionErrors=!0),Wu(n.prevAllowStateChanges),na(n.prevAllowStateReads),ni(),nr(n.prevDerivation),n.notifySpy,bt.suppressReactionErrors=!1}function Xu(n){var e=bt.allowStateChanges;return bt.allowStateChanges=n,e}function Wu(n){bt.allowStateChanges=n}var Mr=(function(n){OW(e,n);function e(t,o,i,r,s){i===void 0&&(i="ObservableValue@"+fo()),s===void 0&&(s=gs.default);var a=n.call(this,i)||this;return a.enhancer=o,a.name=i,a.equals=s,a.hasUnreportedChange=!1,a.value=o(t,void 0,i),a}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==bt.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(ms(this),Ci(this)){var o=ki(this,{object:this,type:"update",newValue:t});if(!o)return bt.UNCHANGED;t=o.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?bt.UNCHANGED:t},e.prototype.setNewValue=function(t){var o=this.value;this.value=t,this.reportChanged(),oi(this)&&ii(this,{type:"update",object:this,newValue:t,oldValue:o})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return Ka(this,t)},e.prototype.observe=function(t,o){return o&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),Za(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return eg(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e})(js),zW=dr("ObservableValue",Mr),ys=(function(){function n(e){this.dependenciesState=mn.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=mn.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+fo(),this.value=new Wl(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=wi.NONE,Or(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+fo(),e.set&&(this.setter=Nr(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?gs.structural:gs.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return n.prototype.onBecomeStale=function(){JW(this)},n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.get=function(){this.isComputing&&hn("Cycle detected in computation "+this.name+": "+this.derivation),bt.inBatch===0&&this.observers.size===0&&!this.keepAlive?Kd(this)&&(this.warnAboutUntrackedRead(),ti(),this.value=this.computeValue(!1),ni()):(cg(this),Kd(this)&&this.trackAndCompute()&&YW(this));var e=this.value;if(Qs(e))throw e.cause;return e},n.prototype.peek=function(){var e=this.computeValue(!1);if(Qs(e))throw e.cause;return e},n.prototype.set=function(e){if(this.setter){Or(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else Or(!1,!1)},n.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===mn.NOT_TRACKING,o=this.computeValue(!0),i=t||Qs(e)||Qs(o)||!this.equals(e,o);return i&&(this.value=o),i},n.prototype.computeValue=function(e){this.isComputing=!0,bt.computationDepth++;var t;if(e)t=ig(this,this.derivation,this.scope);else if(bt.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(o){t=new Wl(o)}return bt.computationDepth--,this.isComputing=!1,t},n.prototype.suspend=function(){this.keepAlive||(Zd(this),this.value=void 0)},n.prototype.observe=function(e,t){var o=this,i=!0,r=void 0;return iY(function(){var s=o.get();if(!i||t){var a=Fs();e({type:"update",object:o,newValue:s,oldValue:r}),nr(a)}i=!1,r=s})},n.prototype.warnAboutUntrackedRead=function(){},n.prototype.toJSON=function(){return this.get()},n.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},n.prototype.valueOf=function(){return eg(this.get())},n.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},n})(),bs=dr("ComputedValue",ys),Ml=(function(){function n(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return n})(),qW={};function Qd(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:qW}var Tl=!0,lg=!1,bt=(function(){var n=Qd();return n.__mobxInstanceCount>0&&!n.__mobxGlobals&&(Tl=!1),n.__mobxGlobals&&n.__mobxGlobals.version!==new Ml().version&&(Tl=!1),Tl?n.__mobxGlobals?(n.__mobxInstanceCount+=1,n.__mobxGlobals.UNCHANGED||(n.__mobxGlobals.UNCHANGED={}),n.__mobxGlobals):(n.__mobxInstanceCount=1,n.__mobxGlobals=new Ml):(setTimeout(function(){lg||hn("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new Ml)})();function GW(){(bt.pendingReactions.length||bt.inBatch||bt.isRunningReactions)&&hn("isolateGlobalState should be called before MobX is running any reactions"),lg=!0,Tl&&(--Qd().__mobxInstanceCount===0&&(Qd().__mobxGlobals=void 0),bt=new Ml)}function ec(){return bt}function XW(n,e){n.observers.add(e),n.lowestObserverState>e.dependenciesState&&(n.lowestObserverState=e.dependenciesState)}function ug(n,e){n.observers.delete(e),n.observers.size===0&&dg(n)}function dg(n){n.isPendingUnobservation===!1&&(n.isPendingUnobservation=!0,bt.pendingUnobservations.push(n))}function ti(){bt.inBatch++}function ni(){if(--bt.inBatch===0){hg();for(var n=bt.pendingUnobservations,e=0;e<n.length;e++){var t=n[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof ys&&t.suspend())}bt.pendingUnobservations=[]}}function cg(n){var e=bt.trackingDerivation;return e!==null?(e.runId!==n.lastAccessedBy&&(n.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=n,n.isBeingObserved||(n.isBeingObserved=!0,n.onBecomeObserved())),!0):(n.observers.size===0&&bt.inBatch>0&&dg(n),!1)}function WW(n){n.lowestObserverState!==mn.STALE&&(n.lowestObserverState=mn.STALE,n.observers.forEach(function(e){e.dependenciesState===mn.UP_TO_DATE&&(e.isTracing!==wi.NONE&&pg(e,n),e.onBecomeStale()),e.dependenciesState=mn.STALE}))}function YW(n){n.lowestObserverState!==mn.STALE&&(n.lowestObserverState=mn.STALE,n.observers.forEach(function(e){e.dependenciesState===mn.POSSIBLY_STALE?e.dependenciesState=mn.STALE:e.dependenciesState===mn.UP_TO_DATE&&(n.lowestObserverState=mn.UP_TO_DATE)}))}function JW(n){n.lowestObserverState===mn.UP_TO_DATE&&(n.lowestObserverState=mn.POSSIBLY_STALE,n.observers.forEach(function(e){e.dependenciesState===mn.UP_TO_DATE&&(e.dependenciesState=mn.POSSIBLY_STALE,e.isTracing!==wi.NONE&&pg(e,n),e.onBecomeStale())}))}function pg(n,e){if(""+n.name+e.name,n.isTracing===wi.BREAK){var t=[];fg(uY(n),t,1),new Function(`debugger;
/*
Tracing '`+n.name+`'

You are entering this break point because derivation '`+n.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(n instanceof ys?n.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function fg(n,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+n.name),n.dependencies&&n.dependencies.forEach(function(o){return fg(o,e,t+1)})}var Sa=(function(){function n(e,t,o,i){e===void 0&&(e="Reaction@"+fo()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=o,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=mn.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+fo(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=wi.NONE}return n.prototype.onBecomeStale=function(){this.schedule()},n.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,bt.pendingReactions.push(this),hg())},n.prototype.isScheduled=function(){return this._isScheduled},n.prototype.runReaction=function(){if(!this.isDisposed){if(ti(),this._isScheduled=!1,Kd(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&Io()}catch(e){this.reportExceptionInDerivation(e)}}ni()}},n.prototype.track=function(e){if(!this.isDisposed){ti(),this._isRunning=!0;var t=ig(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&Zd(this),Qs(t)&&this.reportExceptionInDerivation(t.cause),ni()}},n.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(bt.disableErrorBoundaries)throw e;var o="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";bt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(o,e),bt.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(ti(),Zd(this),ni()))},n.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[Rt]=this,e},n.prototype.toString=function(){return"Reaction["+this.name+"]"},n.prototype.trace=function(e){e===void 0&&(e=!1),_Y(this,e)},n})(),Lf=100,tc=function(n){return n()};function hg(){bt.inBatch>0||bt.isRunningReactions||tc(KW)}function KW(){bt.isRunningReactions=!0;for(var n=bt.pendingReactions,e=0;n.length>0;){++e===Lf&&(console.error("Reaction doesn't converge to a stable state after "+Lf+" iterations."+(" Probably there is a cycle in the reactive function: "+n[0])),n.splice(0));for(var t=n.splice(0),o=0,i=t.length;o<i;o++)t[o].runReaction()}bt.isRunningReactions=!1}var Jl=dr("Reaction",Sa);function ZW(n){var e=tc;tc=function(t){return n(function(){return e(t)})}}function Io(){return!1}function QW(n){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function eY(){hn(!1)}function Bf(n){return function(e,t,o){if(o){if(o.value)return{value:Nr(n,o.value),enumerable:!1,configurable:!0,writable:!0};var i=o.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return Nr(n,i.call(this))}}}return tY(n).apply(this,arguments)}}function tY(n){return function(e,t,o){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){Bs(this,t,$e(n,i))}})}}function nY(n,e,t,o){return o===!0?(cd(n,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return cd(this,e,t.value||t.initializer.call(this)),this[e]},set:eY}:{enumerable:!1,configurable:!0,set:function(i){cd(this,e,i)},get:function(){}}}var $e=function(e,t,o,i){if(arguments.length===1&&typeof e=="function")return Nr(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return Nr(e,t);if(arguments.length===1&&typeof e=="string")return Bf(e);if(i===!0)Bs(e,t,Nr(e.name||t,o.value,this));else return Bf(t).apply(null,arguments)};$e.bound=nY;function oY(n,e){var t=typeof n=="string"?n:n.name||"<unnamed action>",o=typeof n=="function"?n:e;return ag(t,o,this,void 0)}function cd(n,e,t){Bs(n,e,Nr(e,t.bind(n)))}function iY(n,e){e===void 0&&(e=vp);var t=e&&e.name||n.name||"Autorun@"+fo(),o=!e.scheduler&&!e.delay,i;if(o)i=new Sa(t,function(){this.track(a)},e.onError,e.requiresObservable);else{var r=vg(e),s=!1;i=new Sa(t,function(){s||(s=!0,r(function(){s=!1,i.isDisposed||i.track(a)}))},e.onError,e.requiresObservable)}function a(){n(i)}return i.schedule(),i.getDisposer()}var rY=function(n){return n()};function vg(n){return n.scheduler?n.scheduler:n.delay?function(e){return setTimeout(e,n.delay)}:rY}function _g(n,e,t){t===void 0&&(t=vp);var o=t.name||"Reaction@"+fo(),i=$e(o,t.onError?sY(t.onError,e):e),r=!t.scheduler&&!t.delay,s=vg(t),a=!0,l=!1,d,c=t.compareStructural?gs.structural:t.equals||gs.default,p=new Sa(o,function(){a||r?f():l||(l=!0,s(f))},t.onError,t.requiresObservable);function f(){if(l=!1,!p.isDisposed){var h=!1;p.track(function(){var v=n(p);h=a||!c(d,v),d=v}),a&&t.fireImmediately&&i(d,p),!a&&h===!0&&i(d,p),a&&(a=!1)}}return p.schedule(),p.getDisposer()}function sY(n,e){return function(){try{return e.apply(this,arguments)}catch(t){n.call(this,t)}}}function aY(n,e,t){return mg("onBecomeObserved",n,e)}function gg(n,e,t){return mg("onBecomeUnobserved",n,e)}function mg(n,e,t,o){var i=ir(e),r=t,s=n+"Listeners";i[s]?i[s].add(r):i[s]=new Set([r]);var a=i[n];return typeof a!="function"?hn(!1):function(){var l=i[s];l&&(l.delete(r),l.size===0&&delete i[s])}}function lY(n){var e=n.enforceActions,t=n.computedRequiresReaction,o=n.computedConfigurable,i=n.disableErrorBoundaries,r=n.reactionScheduler,s=n.reactionRequiresObservable,a=n.observableRequiresReaction;if(GW(),e!==void 0){var l=void 0;switch(e){case!0:case"observed":l=!0;break;case!1:case"never":l=!1;break;case"strict":case"always":l="strict";break;default:hn("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}bt.enforceActions=l,bt.allowStateChanges=!(l===!0||l==="strict")}t!==void 0&&(bt.computedRequiresReaction=!!t),s!==void 0&&(bt.reactionRequiresObservable=!!s),a!==void 0&&(bt.observableRequiresReaction=!!a,bt.allowStateReads=!bt.observableRequiresReaction),o!==void 0&&(bt.computedConfigurable=!!o),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),bt.disableErrorBoundaries=!!i),r&&ZW(r)}function nc(n,e,t,o){o=ts(o);var i=yg(o);return Pr(n),kp(n,o.name,i.enhancer),e&&bg(n,e,t,i),n}function yg(n){return n.defaultDecorator||(n.deep===!1?og:bp)}function bg(n,e,t,o){var i,r,s,a,l,d;ti();try{var s=EW(e);try{for(var c=yi(s),p=c.next();!p.done;p=c.next()){var d=p.value,f=Object.getOwnPropertyDescriptor(e,d),h=t&&d in t?t[d]:f.get?Xl:o,v=h(n,d,f,!0);v&&Object.defineProperty(n,d,v)}}catch(g){i={error:g}}finally{try{p&&!p.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}}finally{ni()}}function uY(n,e){return xg(ir(n,e))}function xg(n){var e={name:n.name};return n.observing&&n.observing.length>0&&(e.dependencies=wW(n.observing).map(xg)),e}function wg(n,e){if(n==null)return!1;if(e!==void 0){if(ui(n)===!1||!n[Rt].values.has(e))return!1;var t=ir(n,e);return bs(t)}return bs(n)}function dY(n){return arguments.length>1?hn(!1):wg(n)}function If(n,e){return typeof e!="string"?hn(!1):wg(n,e)}function cY(n,e){return n==null?!1:ui(n)||!!n[Rt]||gp(n)||Jl(n)||bs(n)}function xs(n){return arguments.length!==1&&hn(!1),cY(n)}function ws(n){return ui(n)?n[Rt].getKeys():_o(n)||Uo(n)?Array.from(n.keys()):Ni(n)?n.map(function(e,t){return t}):hn(!1)}function pY(n){return ui(n)?ws(n).map(function(e){return n[e]}):_o(n)?ws(n).map(function(e){return n.get(e)}):Uo(n)?Array.from(n.values()):Ni(n)?n.slice():hn(!1)}function fY(n){return ui(n)?ws(n).map(function(e){return[e,n[e]]}):_o(n)?ws(n).map(function(e){return[e,n.get(e)]}):Uo(n)?Array.from(n.entries()):Ni(n)?n.map(function(e,t){return[t,e]}):hn(!1)}function wp(n,e,t){if(arguments.length===2&&!Uo(n)){ti();var o=e;try{for(var i in o)wp(n,i,o[i])}finally{ni()}return}if(ui(n)){var r=n[Rt],s=r.values.get(e);s?r.write(e,t):r.addObservableProp(e,t,r.defaultEnhancer)}else if(_o(n))n.set(e,t);else if(Uo(n))n.add(e);else if(Ni(n))typeof e!="number"&&(e=parseInt(e,10)),Or(e>=0,"Not a valid index: '"+e+"'"),ti(),e>=n.length&&(n.length=e+1),n[e]=t,ni();else return hn(!1)}function Cg(n,e,t,o){return hY(n,e,t)}function hY(n,e,t){return Yu(n).observe(e,t)}var vY={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function Gr(n,e,t,o){return o.detectCycles&&n.set(e,t),t}function Xi(n,e,t){if(!e.recurseEverything&&!xs(n)||typeof n!="object")return n;if(n===null)return null;if(n instanceof Date)return n;if(zW(n))return Xi(n.get(),e,t);xs(n)&&ws(n);var o=e.detectCycles===!0;if(o&&n!==null&&t.has(n))return t.get(n);if(Ni(n)||Array.isArray(n)){var i=Gr(t,n,[],e),r=n.map(function(h){return Xi(h,e,t)});i.length=r.length;for(var s=0,a=r.length;s<a;s++)i[s]=r[s];return i}if(Uo(n)||Object.getPrototypeOf(n)===Set.prototype)if(e.exportMapsAsObjects===!1){var l=Gr(t,n,new Set,e);return n.forEach(function(h){l.add(Xi(h,e,t))}),l}else{var d=Gr(t,n,[],e);return n.forEach(function(h){d.push(Xi(h,e,t))}),d}if(_o(n)||Object.getPrototypeOf(n)===Map.prototype)if(e.exportMapsAsObjects===!1){var c=Gr(t,n,new Map,e);return n.forEach(function(h,v){c.set(v,Xi(h,e,t))}),c}else{var p=Gr(t,n,{},e);return n.forEach(function(h,v){p[v]=Xi(h,e,t)}),p}var f=Gr(t,n,{},e);return Q_(n).forEach(function(h){f[h]=Xi(n[h],e,t)}),f}function Jo(n,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=vY),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),Xi(n,e,t)}function _Y(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=!1;typeof n[n.length-1]=="boolean"&&(t=n.pop());var o=gY(n);if(!o)return hn(!1);o.isTracing===wi.NONE&&""+o.name,o.isTracing=t?wi.BREAK:wi.LOG}function gY(n){switch(n.length){case 0:return bt.trackingDerivation;case 1:return ir(n[0]);case 2:return ir(n[0],n[1])}}function Qo(n,e){e===void 0&&(e=void 0),ti();try{return n.apply(e)}finally{ni()}}function ll(n){return n[Rt]}function ul(n){return typeof n=="string"||typeof n=="number"||typeof n=="symbol"}var mY={has:function(n,e){if(e===Rt||e==="constructor"||e===Gl)return!0;var t=ll(n);return ul(e)?t.has(e):e in n},get:function(n,e){if(e===Rt||e==="constructor"||e===Gl)return n[e];var t=ll(n),o=t.values.get(e);if(o instanceof js){var i=o.get();return i===void 0&&t.has(e),i}return ul(e)&&t.has(e),n[e]},set:function(n,e,t){return ul(e)?(wp(n,e,t),!0):!1},deleteProperty:function(n,e){if(!ul(e))return!1;var t=ll(n);return t.remove(e),!0},ownKeys:function(n){var e=ll(n);return e.keysAtom.reportObserved(),Reflect.ownKeys(n)},preventExtensions:function(n){return hn("Dynamic observable objects cannot be frozen"),!1}};function yY(n){var e=new Proxy(n,mY);return n[Rt].proxy=e,e}function Ci(n){return n.interceptors!==void 0&&n.interceptors.length>0}function Ka(n,e){var t=n.interceptors||(n.interceptors=[]);return t.push(e),Z_(function(){var o=t.indexOf(e);o!==-1&&t.splice(o,1)})}function ki(n,e){var t=Fs();try{for(var o=yp(n.interceptors||[]),i=0,r=o.length;i<r&&(e=o[i](e),Or(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{nr(t)}}function oi(n){return n.changeListeners!==void 0&&n.changeListeners.length>0}function Za(n,e){var t=n.changeListeners||(n.changeListeners=[]);return t.push(e),Z_(function(){var o=t.indexOf(e);o!==-1&&t.splice(o,1)})}function ii(n,e){var t=Fs(),o=n.changeListeners;if(o){o=o.slice();for(var i=0,r=o.length;i<r;i++)o[i](e);nr(t)}}var bY=1e4,xY={get:function(n,e){return e===Rt?n[Rt]:e==="length"?n[Rt].getArrayLength():typeof e=="number"?Li.get.call(n,e):typeof e=="string"&&!isNaN(e)?Li.get.call(n,parseInt(e)):Li.hasOwnProperty(e)?Li[e]:n[e]},set:function(n,e,t){return e==="length"&&n[Rt].setArrayLength(t),typeof e=="number"&&Li.set.call(n,e,t),typeof e=="symbol"||isNaN(e)?n[e]=t:Li.set.call(n,parseInt(e),t),!0},preventExtensions:function(n){return hn("Observable arrays cannot be frozen"),!1}};function wY(n,e,t,o){t===void 0&&(t="ObservableArray@"+fo()),o===void 0&&(o=!1);var i=new kg(t,e,o);kW(i.values,Rt,i);var r=new Proxy(i.values,xY);if(i.proxy=r,n&&n.length){var s=Xu(!0);i.spliceWithArray(0,0,n),Wu(s)}return r}var kg=(function(){function n(e,t,o){this.owned=o,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new js(e||"ObservableArray@"+fo()),this.enhancer=function(i,r){return t(i,r,e+"[..]")}}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},n.prototype.intercept=function(e){return Ka(this,e)},n.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),Za(this,e)},n.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},n.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var o=new Array(e-t),i=0;i<e-t;i++)o[i]=void 0;this.spliceWithArray(t,0,o)}else this.spliceWithArray(e,t-e)},n.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},n.prototype.spliceWithArray=function(e,t,o){var i=this;ms(this.atom);var r=this.values.length;if(e===void 0?e=0:e>r?e=r:e<0&&(e=Math.max(0,r+e)),arguments.length===1?t=r-e:t==null?t=0:t=Math.max(0,Math.min(t,r-e)),o===void 0&&(o=zl),Ci(this)){var s=ki(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:o});if(!s)return zl;t=s.removedCount,o=s.added}o=o.length===0?o:o.map(function(l){return i.enhancer(l,void 0)});var a=this.spliceItemsIntoValues(e,t,o);return(t!==0||o.length!==0)&&this.notifyArraySplice(e,o,a),this.dehanceValues(a)},n.prototype.spliceItemsIntoValues=function(e,t,o){var i;if(o.length<bY)return(i=this.values).splice.apply(i,yp([e,t],o));var r=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(o,this.values.slice(e+t)),r},n.prototype.notifyArrayChildUpdate=function(e,t,o){var i=!this.owned&&Io(),r=oi(this),s=r||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:o}:null;this.atom.reportChanged(),r&&ii(this,s)},n.prototype.notifyArraySplice=function(e,t,o){var i=!this.owned&&Io(),r=oi(this),s=r||i?{object:this.proxy,type:"splice",index:e,removed:o,added:t,removedCount:o.length,addedCount:t.length}:null;this.atom.reportChanged(),r&&ii(this,s)},n})(),Li={intercept:function(n){return this[Rt].intercept(n)},observe:function(n,e){e===void 0&&(e=!1);var t=this[Rt];return t.observe(n,e)},clear:function(){return this.splice(0)},replace:function(n){var e=this[Rt];return e.spliceWithArray(0,e.values.length,n)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(n,e){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var i=this[Rt];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(n);case 2:return i.spliceWithArray(n,e)}return i.spliceWithArray(n,e,t)},spliceWithArray:function(n,e,t){var o=this[Rt];return o.spliceWithArray(n,e,t)},push:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[Rt];return t.spliceWithArray(t.values.length,0,n),t.values.length},pop:function(){return this.splice(Math.max(this[Rt].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[Rt];return t.spliceWithArray(0,0,n),t.values.length},reverse:function(){var n=this.slice();return n.reverse.apply(n,arguments)},sort:function(n){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(n){var e=this[Rt],t=e.dehanceValues(e.values).indexOf(n);return t>-1?(this.splice(t,1),!0):!1},get:function(n){var e=this[Rt];if(e){if(n<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[n]);console.warn("[mobx.array] Attempt to read an array index ("+n+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(n,e){var t=this[Rt],o=t.values;if(n<o.length){ms(t.atom);var i=o[n];if(Ci(t)){var r=ki(t,{type:"update",object:t.proxy,index:n,newValue:e});if(!r)return;e=r.newValue}e=t.enhancer(e,i);var s=e!==i;s&&(o[n]=e,t.notifyArrayChildUpdate(n,e,i))}else if(n===o.length)t.spliceWithArray(n,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+n+" is larger than "+o.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(n){typeof Array.prototype[n]=="function"&&(Li[n]=function(){var e=this[Rt];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[n].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(n){typeof Array.prototype[n]=="function"&&(Li[n]=function(e,t){var o=this,i=this[Rt];i.atom.reportObserved();var r=i.dehanceValues(i.values);return r[n](function(s,a){return e.call(t,s,a,o)},t)})});["reduce","reduceRight"].forEach(function(n){Li[n]=function(){var e=this,t=this[Rt];t.atom.reportObserved();var o=arguments[0];return arguments[0]=function(i,r,s){return r=t.dehanceValue(r),o(i,r,s,e)},t.values[n].apply(t.values,arguments)}});var CY=dr("ObservableArrayAdministration",kg);function Ni(n){return _p(n)&&CY(n[Rt])}var jf,kY={},Cp=(function(){function n(e,t,o){if(t===void 0&&(t=Ja),o===void 0&&(o="ObservableMap@"+fo()),this.enhancer=t,this.name=o,this[jf]=kY,this._keysAtom=mp(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return n.prototype._has=function(e){return this._data.has(e)},n.prototype.has=function(e){var t=this;if(!bt.trackingDerivation)return this._has(e);var o=this._hasMap.get(e);if(!o){var i=o=new Mr(this._has(e),qu,this.name+"."+Zi(e)+"?",!1);this._hasMap.set(e,i),gg(i,function(){return t._hasMap.delete(e)})}return o.get()},n.prototype.set=function(e,t){var o=this._has(e);if(Ci(this)){var i=ki(this,{type:o?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return o?this._updateValue(e,t):this._addValue(e,t),this},n.prototype.delete=function(e){var t=this;if(ms(this._keysAtom),Ci(this)){var o=ki(this,{type:"delete",object:this,name:e});if(!o)return!1}if(this._has(e)){var i=Io(),r=oi(this),o=r||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return Qo(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var a=t._data.get(e);a.setNewValue(void 0),t._data.delete(e)}),r&&ii(this,o),!0}return!1},n.prototype._updateHasMapEntry=function(e,t){var o=this._hasMap.get(e);o&&o.setNewValue(t)},n.prototype._updateValue=function(e,t){var o=this._data.get(e);if(t=o.prepareNewValue(t),t!==bt.UNCHANGED){var i=Io(),r=oi(this),s=r||i?{type:"update",object:this,oldValue:o.value,name:e,newValue:t}:null;o.setNewValue(t),r&&ii(this,s)}},n.prototype._addValue=function(e,t){var o=this;ms(this._keysAtom),Qo(function(){var a=new Mr(t,o.enhancer,o.name+"."+Zi(e),!1);o._data.set(e,a),t=a.value,o._updateHasMapEntry(e,!0),o._keysAtom.reportChanged()});var i=Io(),r=oi(this),s=r||i?{type:"add",object:this,name:e,newValue:t}:null;r&&ii(this,s)},n.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},n.prototype.values=function(){var e=this,t=this.keys();return Kl({next:function(){var o=t.next(),i=o.done,r=o.value;return{done:i,value:i?void 0:e.get(r)}}})},n.prototype.entries=function(){var e=this,t=this.keys();return Kl({next:function(){var o=t.next(),i=o.done,r=o.value;return{done:i,value:i?void 0:[r,e.get(r)]}}})},n.prototype[jf=Rt,Symbol.iterator]=function(){return this.entries()},n.prototype.forEach=function(e,t){var o,i;try{for(var r=yi(this),s=r.next();!s.done;s=r.next()){var a=is(s.value,2),l=a[0],d=a[1];e.call(t,d,l,this)}}catch(c){o={error:c}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}},n.prototype.merge=function(e){var t=this;return _o(e)&&(e=e.toJS()),Qo(function(){var o=Xu(!0);try{Ls(e)?Q_(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var r=is(i,2),s=r[0],a=r[1];return t.set(s,a)}):Is(e)?(e.constructor!==Map&&hn("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,r){return t.set(r,i)})):e!=null&&hn("Cannot initialize map from "+e)}finally{Wu(o)}}),this},n.prototype.clear=function(){var e=this;Qo(function(){rg(function(){var t,o;try{for(var i=yi(e.keys()),r=i.next();!r.done;r=i.next()){var s=r.value;e.delete(s)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}})})},n.prototype.replace=function(e){var t=this;return Qo(function(){var o,i,r,s,a=CW(e),l=new Map,d=!1;try{for(var c=yi(t._data.keys()),p=c.next();!p.done;p=c.next()){var f=p.value;if(!a.has(f)){var h=t.delete(f);if(h)d=!0;else{var v=t._data.get(f);l.set(f,v)}}}}catch(A){o={error:A}}finally{try{p&&!p.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}try{for(var y=yi(a.entries()),g=y.next();!g.done;g=y.next()){var _=is(g.value,2),f=_[0],v=_[1],b=t._data.has(f);if(t.set(f,v),t._data.has(f)){var C=t._data.get(f);l.set(f,C),b||(d=!0)}}}catch(A){r={error:A}}finally{try{g&&!g.done&&(s=y.return)&&s.call(y)}finally{if(r)throw r.error}}if(!d)if(t._data.size!==l.size)t._keysAtom.reportChanged();else for(var T=t._data.keys(),M=l.keys(),S=T.next(),k=M.next();!S.done;){if(S.value!==k.value){t._keysAtom.reportChanged();break}S=T.next(),k=M.next()}t._data=l}),this},Object.defineProperty(n.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.toPOJO=function(){var e,t,o={};try{for(var i=yi(this),r=i.next();!r.done;r=i.next()){var s=is(r.value,2),a=s[0],l=s[1];o[typeof a=="symbol"?a:Zi(a)]=l}}catch(d){e={error:d}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},n.prototype.toJS=function(){return new Map(this)},n.prototype.toJSON=function(){return this.toPOJO()},n.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return Zi(t)+": "+(""+e.get(t))}).join(", ")+" }]"},n.prototype.observe=function(e,t){return Za(this,e)},n.prototype.intercept=function(e){return Ka(this,e)},n})(),_o=dr("ObservableMap",Cp),Ff,SY={},Sg=(function(){function n(e,t,o){if(t===void 0&&(t=Ja),o===void 0&&(o="ObservableSet@"+fo()),this.name=o,this[Ff]=SY,this._data=new Set,this._atom=mp(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,r){return t(i,r,o)},e&&this.replace(e)}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.clear=function(){var e=this;Qo(function(){rg(function(){var t,o;try{for(var i=yi(e._data.values()),r=i.next();!r.done;r=i.next()){var s=r.value;e.delete(s)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}})})},n.prototype.forEach=function(e,t){var o,i;try{for(var r=yi(this),s=r.next();!s.done;s=r.next()){var a=s.value;e.call(t,a,a,this)}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}},Object.defineProperty(n.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.add=function(e){var t=this;if(ms(this._atom),Ci(this)){var o=ki(this,{type:"add",object:this,newValue:e});if(!o)return this}if(!this.has(e)){Qo(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=Io(),r=oi(this),o=r||i?{type:"add",object:this,newValue:e}:null;r&&ii(this,o)}return this},n.prototype.delete=function(e){var t=this;if(Ci(this)){var o=ki(this,{type:"delete",object:this,oldValue:e});if(!o)return!1}if(this.has(e)){var i=Io(),r=oi(this),o=r||i?{type:"delete",object:this,oldValue:e}:null;return Qo(function(){t._atom.reportChanged(),t._data.delete(e)}),r&&ii(this,o),!0}return!1},n.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},n.prototype.entries=function(){var e=0,t=Array.from(this.keys()),o=Array.from(this.values());return Kl({next:function(){var i=e;return e+=1,i<o.length?{value:[t[i],o[i]],done:!1}:{done:!0}}})},n.prototype.keys=function(){return this.values()},n.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,o=Array.from(this._data.values());return Kl({next:function(){return t<o.length?{value:e.dehanceValue(o[t++]),done:!1}:{done:!0}}})},n.prototype.replace=function(e){var t=this;return Uo(e)&&(e=e.toJS()),Qo(function(){var o=Xu(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):Ya(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&hn("Cannot initialize set from "+e)}finally{Wu(o)}}),this},n.prototype.observe=function(e,t){return Za(this,e)},n.prototype.intercept=function(e){return Ka(this,e)},n.prototype.toJS=function(){return new Set(this)},n.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},n.prototype[Ff=Rt,Symbol.iterator]=function(){return this.values()},n})(),Uo=dr("ObservableSet",Sg),Eg=(function(){function n(e,t,o,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=o,this.defaultEnhancer=i,this.keysAtom=new js(o+".keys")}return n.prototype.read=function(e){return this.values.get(e).get()},n.prototype.write=function(e,t){var o=this.target,i=this.values.get(e);if(i instanceof ys){i.set(t);return}if(Ci(this)){var r=ki(this,{type:"update",object:this.proxy||o,name:e,newValue:t});if(!r)return;t=r.newValue}if(t=i.prepareNewValue(t),t!==bt.UNCHANGED){var s=oi(this),a=Io(),r=s||a?{type:"update",object:this.proxy||o,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),s&&ii(this,r)}},n.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),o=t.get(e);if(o)return o.get();var i=!!this.values.get(e);return o=new Mr(i,qu,this.name+"."+Zi(e)+"?",!1),t.set(e,o),o.get()},n.prototype.addObservableProp=function(e,t,o){o===void 0&&(o=this.defaultEnhancer);var i=this.target;if(Ci(this)){var r=ki(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!r)return;t=r.newValue}var s=new Mr(t,o,this.name+"."+Zi(e),!1);this.values.set(e,s),t=s.value,Object.defineProperty(i,e,EY(e)),this.notifyPropertyAddition(e,t)},n.prototype.addComputedProp=function(e,t,o){var i=this.target;o.name=o.name||this.name+"."+Zi(t),this.values.set(t,new ys(o)),(e===i||SW(e,t))&&Object.defineProperty(e,t,AY(t))},n.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(Ci(this)){var o=ki(this,{object:this.proxy||t,name:e,type:"remove"});if(!o)return}try{ti();var i=oi(this),r=Io(),s=this.values.get(e),a=s&&s.get();if(s&&s.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var l=this.pendingKeys.get(e);l&&l.set(!1)}delete this.target[e];var o=i||r?{type:"remove",object:this.proxy||t,oldValue:a,name:e}:null;i&&ii(this,o)}finally{ni()}}},n.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},n.prototype.observe=function(e,t){return Za(this,e)},n.prototype.intercept=function(e){return Ka(this,e)},n.prototype.notifyPropertyAddition=function(e,t){var o=oi(this),i=Io(),r=o||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(o&&ii(this,r),this.pendingKeys){var s=this.pendingKeys.get(e);s&&s.set(!0)}this.keysAtom.reportChanged()},n.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var o=[];try{for(var i=yi(this.values),r=i.next();!r.done;r=i.next()){var s=is(r.value,2),a=s[0],l=s[1];l instanceof Mr&&o.push(a)}}catch(d){e={error:d}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},n})();function kp(n,e,t){if(e===void 0&&(e=""),t===void 0&&(t=Ja),Object.prototype.hasOwnProperty.call(n,Rt))return n[Rt];Ls(n)||(e=(n.constructor.name||"ObservableObject")+"@"+fo()),e||(e="ObservableObject@"+fo());var o=new Eg(n,new Map,Zi(e),t);return Bs(n,Rt,o),o}var Vf=Object.create(null),Hf=Object.create(null);function EY(n){return Vf[n]||(Vf[n]={configurable:!0,enumerable:!0,get:function(){return this[Rt].read(n)},set:function(e){this[Rt].write(n,e)}})}function Uf(n){var e=n[Rt];return e||(Pr(n),n[Rt])}function AY(n){return Hf[n]||(Hf[n]={configurable:bt.computedConfigurable,enumerable:!1,get:function(){return Uf(this).read(n)},set:function(e){Uf(this).write(n,e)}})}var DY=dr("ObservableObjectAdministration",Eg);function ui(n){return _p(n)?(Pr(n),DY(n[Rt])):!1}function ir(n,e){if(typeof n=="object"&&n!==null){if(Ni(n))return e!==void 0&&hn(!1),n[Rt].atom;if(Uo(n))return n[Rt];if(_o(n)){var t=n;if(e===void 0)return t._keysAtom;var o=t._data.get(e)||t._hasMap.get(e);return o||hn(!1),o}if(Pr(n),e&&!n[Rt]&&n[e],ui(n)){if(!e)return hn(!1);var o=n[Rt].values.get(e);return o||hn(!1),o}if(gp(n)||bs(n)||Jl(n))return n}else if(typeof n=="function"&&Jl(n[Rt]))return n[Rt];return hn(!1)}function Yu(n,e){if(n||hn("Expecting some object"),e!==void 0)return Yu(ir(n,e));if(gp(n)||bs(n)||Jl(n)||_o(n)||Uo(n))return n;if(Pr(n),n[Rt])return n[Rt];hn(!1)}function OY(n,e){var t;return e!==void 0?t=ir(n,e):ui(n)||_o(n)||Uo(n)?t=Yu(n):t=ir(n),t.name}var zf=Object.prototype.toString;function Ag(n,e,t){return t===void 0&&(t=-1),oc(n,e,t)}function oc(n,e,t,o,i){if(n===e)return n!==0||1/n===1/e;if(n==null||e==null)return!1;if(n!==n)return e!==e;var r=typeof n;if(r!=="function"&&r!=="object"&&typeof e!="object")return!1;var s=zf.call(n);if(s!==zf.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+n==""+e;case"[object Number]":return+n!=+n?+e!=+e:+n==0?1/+n===1/e:+n==+e;case"[object Date]":case"[object Boolean]":return+n==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(n)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}n=qf(n),e=qf(e);var a=s==="[object Array]";if(!a){if(typeof n!="object"||typeof e!="object")return!1;var l=n.constructor,d=e.constructor;if(l!==d&&!(typeof l=="function"&&l instanceof l&&typeof d=="function"&&d instanceof d)&&"constructor"in n&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),o=o||[],i=i||[];for(var c=o.length;c--;)if(o[c]===n)return i[c]===e;if(o.push(n),i.push(e),a){if(c=n.length,c!==e.length)return!1;for(;c--;)if(!oc(n[c],e[c],t-1,o,i))return!1}else{var p=Object.keys(n),f=void 0;if(c=p.length,Object.keys(e).length!==c)return!1;for(;c--;)if(f=p[c],!(NY(e,f)&&oc(n[f],e[f],t-1,o,i)))return!1}return o.pop(),i.pop(),!0}function qf(n){return Ni(n)?n.slice():Is(n)||_o(n)||Ya(n)||Uo(n)?Array.from(n.entries()):n}function NY(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Kl(n){return n[Symbol.iterator]=MY,n}function MY(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:QW,extras:{getDebugName:OY},$mobx:Rt});function TY(n){return!(n.prototype&&n.prototype.render)&&!Kt.isPrototypeOf(n)}function Dg(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,o=t===void 0?"":t,i=e.suffix,r=i===void 0?"":i,s=n.displayName||n.name||n.constructor&&n.constructor.name||"<component>";return o+s+r}var Gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Og=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},Ng=(function(){function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}})(),Mg=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},Tg=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},Xf=console;function $Y(n){var e=ec().allowStateChanges;return ec().allowStateChanges=n,e}function RY(n){ec().allowStateChanges=n}function PY(n,e,t,o,i){var r=$Y(n),s=void 0;try{s=e(t,o,i)}finally{RY(r)}return s}function Wf(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=n[e],i=$g[e],r=o?t===!0?function(){i.apply(this,arguments),o.apply(this,arguments)}:function(){o.apply(this,arguments),i.apply(this,arguments)}:i;n[e]=r}function Yf(n,e){if(n==null||e==null||(typeof n>"u"?"undefined":Gf(n))!=="object"||(typeof e>"u"?"undefined":Gf(e))!=="object")return n!==e;var t=Object.keys(n);if(t.length!==Object.keys(e).length)return!0;for(var o=void 0,i=t.length-1;o=t[i];i--)if(e[o]!==n[o])return!0;return!1}var $g={componentWillMount:function(){var e=this,t=Dg(this),o=!1,i=!1;function r(p){var f=this[p],h=mp("reactive "+p);Object.defineProperty(this,p,{configurable:!0,enumerable:!0,get:function(){return h.reportObserved(),f},set:function(y){!i&&Yf(f,y)?(f=y,o=!0,h.reportChanged(),o=!1):f=y}})}r.call(this,"props"),r.call(this,"state");var s=this.render.bind(this),a=null,l=!1,d=function(){return a=new Sa(t+".render()",function(){if(!l&&(l=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var f=!0;try{i=!0,o||Kt.prototype.forceUpdate.call(e),f=!1}finally{i=!1,f&&a.dispose()}}}),a.reactComponent=e,c.$mobx=a,e.render=c,c(e.props,e.state,e.context)},c=function(f,h,v){l=!1;var y=void 0,g=void 0;if(a.track(function(){try{g=PY(!1,s,f,h,v)}catch(_){y=_}}),y)throw y;return g};this.render=d},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:Yf(this.props,e)}};function Sp(n){if(arguments.length>1&&Xf.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),n.isMobxInjector===!0&&Xf.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),TY(n)){var e,t;return Sp((t=e=(function(i){Mg(r,i);function r(){return Og(this,r),Tg(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return Ng(r,[{key:"render",value:function(){return n.call(this,this.props,this.context)}}]),r})(Kt),e.displayName=Dg(n),t))}if(!n)throw new Error("Please pass a valid component to 'observer'");var o=n.prototype||n;return LY(o),n.isMobXReactObserver=!0,n}function LY(n){Wf(n,"componentWillMount",!0),Wf(n,"componentDidMount"),n.shouldComponentUpdate||(n.shouldComponentUpdate=$g.shouldComponentUpdate)}var BY=Sp(function(n){var e=n.children;return e[0]()});BY.displayName="Observer";var IY=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jY(n,e){return e={exports:{}},n(e,e.exports),e.exports}jY(function(n,e){(function(t,o){n.exports=o()})(IY,(function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,r=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,a=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,d=l&&l(Object);return function c(p,f,h){if(typeof f!="string"){if(d){var v=l(f);v&&v!==d&&c(p,v,h)}var y=r(f);s&&(y=y.concat(s(f)));for(var g=0;g<y.length;++g){var _=y[g];if(!t[_]&&!o[_]&&(!h||!h[_])){var b=a(f,_);try{i(p,_,b)}catch{}}}return p}return p}}))});var Jf={children:!0,key:!0,ref:!0},Kf=console;(function(n){Mg(e,n);function e(){return Og(this,e),Tg(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ng(e,[{key:"render",value:function(o){var i=o.children;return i.length>1?et("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var o={},i=this.context.mobxStores;if(i)for(var r in i)o[r]=i[r];for(var s in this.props)!Jf[s]&&s!=="suppressChangedStoreWarning"&&(o[s]=this.props[s]);return{mobxStores:o}}},{key:"componentWillReceiveProps",value:function(o){if(Object.keys(o).length!==Object.keys(this.props).length&&Kf.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!o.suppressChangedStoreWarning)for(var i in o)!Jf[i]&&this.props[i]!==o[i]&&Kf.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Kt);if(!Kt)throw new Error("mobx-preact requires Preact to be available");var gi,pd,Zf,Rg=[],qn=Wt,Qf=qn.__b,eh=qn.__r,th=qn.diffed,nh=qn.__c,oh=qn.unmount,ih=qn.__;function FY(){for(var n;n=Rg.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach($l),n.__H.__h.forEach(ic),n.__H.__h=[]}catch(e){n.__H.__h=[],qn.__e(e,n.__v)}}qn.__b=function(n){gi=null,Qf&&Qf(n)},qn.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),ih&&ih(n,e)},qn.__r=function(n){eh&&eh(n);var e=(gi=n.__c).__H;e&&(pd===gi?(e.__h=[],gi.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach($l),e.__h.forEach(ic),e.__h=[])),pd=gi},qn.diffed=function(n){th&&th(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(Rg.push(e)!==1&&Zf===qn.requestAnimationFrame||((Zf=qn.requestAnimationFrame)||VY)(FY)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),pd=gi=null},qn.__c=function(n,e){e.some(function(t){try{t.__h.forEach($l),t.__h=t.__h.filter(function(o){return!o.__||ic(o)})}catch(o){e.some(function(i){i.__h&&(i.__h=[])}),e=[],qn.__e(o,t.__v)}}),nh&&nh(n,e)},qn.unmount=function(n){oh&&oh(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(o){try{$l(o)}catch(i){e=i}}),t.__H=void 0,e&&qn.__e(e,t.__v))};var rh=typeof requestAnimationFrame=="function";function VY(n){var e,t=function(){clearTimeout(o),rh&&cancelAnimationFrame(e),setTimeout(n)},o=setTimeout(t,35);rh&&(e=requestAnimationFrame(t))}function $l(n){var e=gi,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),gi=e}function ic(n){var e=gi;n.__c=n.__(),gi=e}function HY(n,e){for(var t in e)n[t]=e[t];return n}function sh(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var o in e)if(o!=="__source"&&n[o]!==e[o])return!0;return!1}function ah(n,e){this.props=n,this.context=e}(ah.prototype=new Kt).isPureReactComponent=!0,ah.prototype.shouldComponentUpdate=function(n,e){return sh(this.props,n)||sh(this.state,e)};var lh=Wt.__b;Wt.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),lh&&lh(n)};var UY=Wt.__e;Wt.__e=function(n,e,t,o){if(n.then){for(var i,r=e;r=r.__;)if((i=r.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(n,e)}UY(n,e,t,o)};var uh=Wt.unmount;function Pg(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(o){typeof o.__c=="function"&&o.__c()}),n.__c.__H=null),(n=HY({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c.__e=!0,n.__c=null),n.__k=n.__k&&n.__k.map(function(o){return Pg(o,e,t)})),n}function Lg(n,e,t){return n&&t&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(o){return Lg(o,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=t)),n}function fd(){this.__u=0,this.o=null,this.__b=null}function Bg(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function dl(){this.i=null,this.l=null}Wt.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&32&n.__u&&(n.type=null),uh&&uh(n)},(fd.prototype=new Kt).__c=function(n,e){var t=e.__c,o=this;o.o==null&&(o.o=[]),o.o.push(t);var i=Bg(o.__v),r=!1,s=function(){r||(r=!0,t.__R=null,i?i(a):a())};t.__R=s;var a=function(){if(!--o.__u){if(o.state.__a){var l=o.state.__a;o.__v.__k[0]=Lg(l,l.__c.__P,l.__c.__O)}var d;for(o.setState({__a:o.__b=null});d=o.o.pop();)d.forceUpdate()}};o.__u++||32&e.__u||o.setState({__a:o.__b=o.__v.__k[0]}),n.then(s,s)},fd.prototype.componentWillUnmount=function(){this.o=[]},fd.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),o=this.__v.__k[0].__c;this.__v.__k[0]=Pg(this.__b,t,o.__O=o.__P)}this.__b=null}var i=e.__a&&et(vs,null,n.fallback);return i&&(i.__u&=-33),[et(vs,null,e.__a?null:n.children),i]};var dh=function(n,e,t){if(++t[1]===t[0]&&n.l.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(t=n.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.i=t=t[2]}};(dl.prototype=new Kt).__a=function(n){var e=this,t=Bg(e.__v),o=e.l.get(n);return o[0]++,function(i){var r=function(){e.props.revealOrder?(o.push(i),dh(e,n,o)):i()};t?t(r):r()}},dl.prototype.render=function(n){this.i=null,this.l=new Map;var e=Ul(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return n.children},dl.prototype.componentDidUpdate=dl.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(e,t){dh(n,t,e)})};var zY=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,qY=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,GY=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,XY=/[A-Z0-9]/g,WY=typeof document<"u",YY=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};function ch(n,e,t){return e.__k==null&&(e.textContent=""),bW(n,e),typeof t=="function"&&t(),n?n.__c:null}Kt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Kt.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var ph=Wt.event;function JY(){}function KY(){return this.cancelBubble}function ZY(){return this.defaultPrevented}Wt.event=function(n){return ph&&(n=ph(n)),n.persist=JY,n.isPropagationStopped=KY,n.isDefaultPrevented=ZY,n.nativeEvent=n};var QY={enumerable:!1,configurable:!0,get:function(){return this.class}},fh=Wt.vnode;Wt.vnode=function(n){typeof n.type=="string"&&(function(e){var t=e.props,o=e.type,i={},r=o.indexOf("-")===-1;for(var s in t){var a=t[s];if(!(s==="value"&&"defaultValue"in t&&a==null||WY&&s==="children"&&o==="noscript"||s==="class"||s==="className")){var l=s.toLowerCase();s==="defaultValue"&&"value"in t&&t.value==null?s="value":s==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?s="ondblclick":l!=="onchange"||o!=="input"&&o!=="textarea"||YY(t.type)?l==="onfocus"?s="onfocusin":l==="onblur"?s="onfocusout":GY.test(s)&&(s=l):l=s="oninput":r&&qY.test(s)?s=s.replace(XY,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&i[s=l]&&(s="oninputCapture"),i[s]=a}}o=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=Ul(t.children).forEach(function(d){d.props.selected=i.value.indexOf(d.props.value)!=-1})),o=="select"&&i.defaultValue!=null&&(i.value=Ul(t.children).forEach(function(d){d.props.selected=i.multiple?i.defaultValue.indexOf(d.props.value)!=-1:i.defaultValue==d.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",QY)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i})(n),n.$$typeof=zY,fh&&fh(n)};var hh=Wt.__r;Wt.__r=function(n){hh&&hh(n),n.__c};var vh=Wt.diffed;Wt.diffed=function(n){vh&&vh(n);var e=n.props,t=n.__e;t!=null&&n.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var eJ=0;function Pe(n,e,t,o,i,r){e||(e={});var s,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?s=e[a]:l[a]=e[a];var d={type:n,props:l,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--eJ,__i:-1,__u:0,__source:i,__self:r};if(typeof n=="function"&&(s=n.defaultProps))for(a in s)l[a]===void 0&&(l[a]=s[a]);return Wt.vnode&&Wt.vnode(d),d}var tJ=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Ea;(function(n){function e(t){var o=tJ(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return pn({},n.defaults,o)}n.get=e})(Ea||(Ea={}));(function(n){n.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(Ea||(Ea={}));var _h={node:!1,edge:!1},nJ={node:!0,edge:!0},oJ=function(n){return!n||typeof n=="boolean"?n===!0?Dt(nJ):Dt(_h):cs(Dt(_h),n)},iJ=function(){return qa(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function Qn(n){try{return JSON.parse(JSON.stringify(n))}catch{return n}}var cl=200,rJ=9999,sJ=10,ln;(function(n){n[n.DEFAULT=1]="DEFAULT",n[n.TEXT_EDIT=2]="TEXT_EDIT",n[n.SHOW_MENU=3]="SHOW_MENU",n[n.ALLOW_CONNECT=4]="ALLOW_CONNECT",n[n.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(ln||(ln={}));var En;(function(n){n.NODE="node",n.EDGE="edge",n.GRAPH="graph"})(En||(En={}));var Gt;(function(n){n.NODE="node",n.CIRCLE_NODE="circle-node",n.POLYGON_NODE="polygon-node",n.RECT_NODE="rect-node",n.TEXT_NODE="text-node",n.ELLIPSE_NODE="ellipse-node",n.DIAMOND_NODE="diamond-node",n.HTML_NODE="html-node",n.CUSTOM_HTML_NODE="custom-html-node",n.EDGE="edge",n.LINE_EDGE="line-edge",n.POLYLINE_EDGE="polyline-edge",n.BEZIER_EDGE="bezier-edge",n.GRAPH="graph"})(Gt||(Gt={}));var _t;(function(n){n.ELEMENT_CLICK="element:click",n.NODE_ADD="node:add",n.NODE_DELETE="node:delete",n.NODE_CLICK="node:click",n.NODE_DBCLICK="node:dbclick",n.NODE_GROUP_COPY="node:group-copy-add",n.NODE_DND_ADD="node:dnd-add",n.NODE_DND_DRAG="node:dnd-drag",n.NODE_MOUSEDOWN="node:mousedown",n.NODE_DRAGSTART="node:dragstart",n.NODE_DRAG="node:drag",n.NODE_DROP="node:drop",n.NODE_MOUSEUP="node:mouseup",n.NODE_MOUSEMOVE="node:mousemove",n.NODE_MOUSEENTER="node:mouseenter",n.NODE_MOUSELEAVE="node:mouseleave",n.NODE_CONTEXTMENU="node:contextmenu",n.NODE_ROTATE="node:rotate",n.NODE_RESIZE="node:resize",n.NODE_FOCUS="node:focus",n.NODE_BLUR="node:blur",n.NODE_PROPERTIES_CHANGE="node:properties-change",n.NODE_PROPERTIES_DELETE="node:properties-delete",n.EDGE_ADD="edge:add",n.EDGE_DELETE="edge:delete",n.EDGE_CLICK="edge:click",n.EDGE_DBCLICK="edge:dbclick",n.EDGE_FOCUS="edge:focus",n.EDGE_BLUR="edge:blur",n.EDGE_MOUSEENTER="edge:mouseenter",n.EDGE_MOUSELEAVE="edge:mouseleave",n.EDGE_CONTEXTMENU="edge:contextmenu",n.EDGE_ADJUST="edge:adjust",n.EDGE_EXCHANGE_NODE="edge:exchange-node",n.ANCHOR_CLICK="anchor:click",n.ANCHOR_MOUSEDOWN="anchor:mousedown",n.ANCHOR_DRAGSTART="anchor:dragstart",n.ANCHOR_DRAG="anchor:drag",n.ANCHOR_DROP="anchor:drop",n.ANCHOR_DRAGEND="anchor:dragend",n.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",n.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",n.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",n.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",n.ADJUST_POINT_DRAG="adjustPoint:drag",n.ADJUST_POINT_DROP="adjustPoint:drop",n.ADJUST_POINT_DRAGEND="adjustPoint:dragend",n.BLANK_MOUSEDOWN="blank:mousedown",n.BLANK_DRAGSTART="blank:dragstart",n.BLANK_DRAG="blank:drag",n.BLANK_DROP="blank:drop",n.BLANK_MOUSEMOVE="blank:mousemove",n.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",n.BLANK_MOUSEUP="blank:mouseup",n.BLANK_CLICK="blank:click",n.BLANK_CONTEXTMENU="blank:contextmenu",n.SELECTION_MOUSEDOWN="selection:mousedown",n.SELECTION_DRAGSTART="selection:dragstart",n.SELECTION_DRAG="selection:drag",n.SELECTION_DROP="selection:drop",n.SELECTION_MOUSEMOVE="selection:mousemove",n.SELECTION_MOUSEUP="selection:mouseup",n.SELECTION_CONTEXTMENU="selection:contextmenu",n.CONNECTION_NOT_ALLOWED="connection:not-allowed",n.TEXT_MOUSEDOWN="text:mousedown",n.TEXT_DRAGSTART="text:dragstart",n.TEXT_DRAG="text:drag",n.TEXT_DROP="text:drop",n.TEXT_CLICK="text:click",n.TEXT_DBCLICK="text:dbclick",n.TEXT_BLUR="text:blur",n.TEXT_MOUSEMOVE="text:mousemove",n.TEXT_MOUSEUP="text:mouseup",n.TEXT_FOCUS="text:focus",n.TEXT_ADD="text:add",n.TEXT_UPDATE="text:update",n.TEXT_CLEAR="text:clear",n.LABEL_MOUSEDOWN="label:mousedown",n.LABEL_DRAGSTART="label:dragstart",n.LABEL_DRAG="label:drag",n.LABEL_DROP="label:drop",n.LABEL_CLICK="label:click",n.LABEL_DBCLICK="label:dbclick",n.LABEL_BLUR="label:blur",n.LABEL_MOUSEMOVE="label:mousemove",n.LABEL_MOUSEUP="label:mouseup",n.LABEL_FOCUS="label:focus",n.LABEL_ADD="label:add",n.LABEL_UPDATE="label:update",n.LABEL_CLEAR="label:clear",n.LABEL_DELETE="label:delete",n.LABEL_SHOULD_ADD="label:should-add",n.LABEL_BATCH_ADD="label:batch-add",n.LABEL_SHOULD_UPDATE="label:should-update",n.LABEL_SHOULD_DELETE="label:should-delete",n.LABEL_BATCH_DELETE="label:batch-delete",n.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",n.HISTORY_CHANGE="history:change",n.GRAPH_TRANSFORM="graph:transform",n.GRAPH_RENDERED="graph:rendered",n.GRAPH_UPDATED="graph:updated",n.EDIT_CONFIG_CHANGED="editConfig:changed"})(_t||(_t={}));var jn;(function(n){n[n.STATIC=-1]="STATIC",n[n.DEFAULT=0]="DEFAULT",n[n.INCREASE=1]="INCREASE",n[n.EDGE_TOP=2]="EDGE_TOP"})(jn||(jn={}));var wn;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(wn||(wn={}));var jo;(function(n){n.TEXT="text",n.LABEL="label"})(jo||(jo={}));var aJ=0,zo=(function(){function n(e){var t=e.onDragStart,o=t===void 0?rd:t,i=e.onDragging,r=i===void 0?rd:i,s=e.onDragEnd,a=s===void 0?rd:s,l=e.eventType,d=l===void 0?"":l,c=e.eventCenter,p=e.step,f=p===void 0?1:p,h=e.isStopPropagation,v=h===void 0?!0:h,y=e.model,g=e.data,_=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(b){var C,T,M=window==null?void 0:window.document;if(b.button===aJ){_.isStopPropagation&&b.stopPropagation(),b.preventDefault(),_.isStartDragging=!0,_.startX=b.clientX,_.startY=b.clientY,M.addEventListener("pointermove",_.handleMouseMove,!1),M.addEventListener("pointerup",_.handleMouseUp,!1);var S=(C=_.model)===null||C===void 0?void 0:C.getData();(T=_.eventCenter)===null||T===void 0||T.emit(_t["".concat(_.eventType,"_MOUSEDOWN")],{e:b,data:_.data||S}),_.startTime=new Date().getTime()}},this.handleMouseMove=function(b){var C,T;if(_.isStopPropagation&&b.stopPropagation(),b.preventDefault(),!!_.isStartDragging&&(_.sumDeltaX+=b.clientX-_.startX,_.sumDeltaY+=b.clientY-_.startY,_.startX=b.clientX,_.startY=b.clientY,_.step<=1||Math.abs(_.sumDeltaX)>_.step||Math.abs(_.sumDeltaY)>_.step)){var M=_.sumDeltaX%_.step,S=_.sumDeltaY%_.step,k=_.sumDeltaX-M,A=_.sumDeltaY-S;_.sumDeltaX=M,_.sumDeltaY=S;var $=(C=_.model)===null||C===void 0?void 0:C.getData();_.isDragging||((T=_.eventCenter)===null||T===void 0||T.emit(_t["".concat(_.eventType,"_DRAGSTART")],{e:b,data:_.data||$}),_.onDragStart({event:b})),_.isDragging=!0,Promise.resolve().then(function(){var B,O;_.onDragging({deltaX:k,deltaY:A,event:b}),(B=_.eventCenter)===null||B===void 0||B.emit(_t["".concat(_.eventType,"_MOUSEMOVE")],{deltaX:k,deltaY:A,e:b,data:_.data||$}),(O=_.eventCenter)===null||O===void 0||O.emit(_t["".concat(_.eventType,"_DRAG")],{e:b,data:_.data||$})})}},this.handleMouseUp=function(b){var C=window.document;_.isStartDragging=!1,_.isStopPropagation&&b.stopPropagation();var T=b.target;T&&typeof T.releasePointerCapture=="function"&&T.releasePointerCapture(b.pointerId),Promise.resolve().then(function(){var M,S,k;C.removeEventListener("pointermove",_.handleMouseMove,!1),C.removeEventListener("pointerup",_.handleMouseUp,!1);var A=(M=_.model)===null||M===void 0?void 0:M.getData();(S=_.eventCenter)===null||S===void 0||S.emit(_t["".concat(_.eventType,"_MOUSEUP")],{e:b,data:_.data||A}),_.isDragging&&(_.isDragging=!1,_.onDragEnd({event:b}),(k=_.eventCenter)===null||k===void 0||k.emit(_t["".concat(_.eventType,"_DROP")],{e:b,data:_.data||A}))})},this.cancelDrag=function(){var b=window==null?void 0:window.document;b.removeEventListener("pointermove",_.handleMouseMove,!1),b.removeEventListener("pointerup",_.handleMouseUp,!1),_.onDragEnd({event:void 0}),_.isDragging=!1},this.destroy=function(){_.isStartDragging&&_.cancelDrag()},this.onDragStart=o,this.onDragging=r,this.onDragEnd=a,this.step=f,this.isStopPropagation=v,this.eventType=d,this.eventCenter=c,this.model=y,this.data=g}return n.prototype.setStep=function(e){this.step=e},n.prototype.setModel=function(e){this.model=e},n})(),lJ=function(n){var e=n.x,t=n.y,o=n.width,i=n.height;return{x:e-o/2,y:t-i/2,x1:e+o/2,y1:t+i/2}},uJ=function(n){var e=n.startPoint,t=n.endPoint,o=(e.x+t.x)/2,i=(e.y+t.y)/2,r=Math.abs(e.x-t.x)+10,s=Math.abs(e.y-t.y)+10;return{x:o-r/2,y:i-s/2,x1:o+r/2,y1:i+s/2}},dJ=function(n){var e=n.points,t=Lr(e),o=Oa(t,8),i=o.x,r=o.y,s=o.width,a=o.height;return{x:i-s/2,y:r-a/2,x1:i+s/2,y1:r+a/2}},cJ=function(n){var e=n.path,t=Ep(e),o=Oa(t,8),i=o.x,r=o.y,s=o.width,a=o.height;return{x:i-s/2,y:r-a/2,x1:i+s/2,y1:r+a/2}},pJ=function(n){if(n.modelType===Gt.LINE_EDGE)return uJ(n);if(n.modelType===Gt.POLYLINE_EDGE)return dJ(n);if(n.modelType===Gt.BEZIER_EDGE)return cJ(n)},fJ=function(n,e,t,o){var i=(e.y-n.y)*(o.x-t.x)-(n.x-e.x)*(t.y-o.y);if(i===0)return!1;var r=((e.x-n.x)*(o.x-t.x)*(t.y-n.y)+(e.y-n.y)*(o.x-t.x)*n.x-(o.y-t.y)*(e.x-n.x)*t.x)/i,s=-((e.y-n.y)*(o.y-t.y)*(t.x-n.x)+(e.x-n.x)*(o.y-t.y)*n.y-(o.x-t.x)*(e.y-n.y)*t.y)/i;return(r-n.x)*(r-e.x)<=0&&(s-n.y)*(s-e.y)<=0&&(r-t.x)*(r-o.x)<=0&&(s-t.y)*(s-o.y)<=0?{x:r,y:s}:!1},Aa=function(n,e,t){var o=n.x,i=n.y,r=e.x,s=e.y,a=t.x,l=t.y,d=(l-s)/(a-r),c=s-d*r;return(o>=r&&o<=a||o<=r&&o>=a)&&(i>=s&&i<=l||i<=s&&i>=l)&&Math.abs(i-d*o-c)<Number.EPSILON},Da=function(n){var e=n.start,t=n.end,o=n.offset,i=n.verticalLength,r=n.type,s={leftX:0,leftY:0,rightX:0,rightY:0},a=Math.atan((t.y-e.y)/(t.x-e.x)),l=Math.atan(o/i),d=Math.sqrt(i*i+o*o);return r==="start"?t.x>=e.x?(s.leftX=e.x+d*Math.sin(a+l),s.leftY=e.y-d*Math.cos(a+l),s.rightX=e.x-d*Math.sin(a-l),s.rightY=e.y+d*Math.cos(a-l)):(s.leftX=e.x-d*Math.sin(a+l),s.leftY=e.y+d*Math.cos(a+l),s.rightX=e.x+d*Math.sin(a-l),s.rightY=e.y-d*Math.cos(a-l)):r==="end"&&(t.x>=e.x?(s.leftX=t.x+d*Math.sin(a-l),s.leftY=t.y-d*Math.cos(a-l),s.rightX=t.x-d*Math.sin(a+l),s.rightY=t.y+d*Math.cos(a+l)):(s.leftX=t.x-d*Math.sin(a-l),s.leftY=t.y+d*Math.cos(a-l),s.rightX=t.x+d*Math.sin(a+l),s.rightY=t.y-d*Math.cos(a+l))),s},rs=function(){return rs=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},rs.apply(this,arguments)},$o=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Qi=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},hJ=function(n,e){return Math.abs(n.centerX-e.centerX)*2<n.width+e.width&&Math.abs(n.centerY-e.centerY)*2<n.height+e.height},rc=function(n){var e=[],t={};return n.forEach(function(o){var i="".concat(o.x,"-").concat(o.y);o.id=i,t[i]=o}),Object.keys(t).forEach(function(o){e.push(t[o])}),e},Zl=function(n,e){return n.width===0&&n.height===0?n:{x:n.x,y:n.y,centerX:n.centerX,centerY:n.centerY,minX:n.minX-e,minY:n.minY-e,maxX:n.maxX+e,maxY:n.maxY+e,height:n.height+2*e,width:n.width+2*e}},vJ=function(n,e){var t=Math.abs(n.x-e.centerX),o=Math.abs(n.y-e.centerY);return t/e.width>o/e.height?wn.HORIZONTAL:wn.VERTICAL},Ql=function(n,e,t){var o=vJ(t,e);return o===wn.HORIZONTAL?{x:t.x>n.centerX?n.maxX:n.minX,y:t.y}:{x:t.x,y:t.y>n.centerY?n.maxY:n.minY}},gh=function(n,e){var t=Math.min(n.minX,e.minX),o=Math.min(n.minY,e.minY),i=Math.max(n.maxX,e.maxX),r=Math.max(n.maxY,e.maxY);return{x:(t+i)/2,y:(o+r)/2,centerX:(t+i)/2,centerY:(o+r)/2,minX:t,minY:o,maxX:i,maxY:r,height:r-o,width:i-t}},Oa=function(n,e){n===void 0&&(n=[]);var t=[],o=[];n.forEach(function(c){t.push(c.x),o.push(c.y)});var i=Math.min.apply(Math,Qi([],$o(t),!1)),r=Math.max.apply(Math,Qi([],$o(t),!1)),s=Math.min.apply(Math,Qi([],$o(o),!1)),a=Math.max.apply(Math,Qi([],$o(o),!1)),l=r-i,d=a-s;return e&&(l+=e,d+=e),{centerX:(i+r)/2,centerY:(s+a)/2,maxX:r,maxY:a,minX:i,minY:s,x:(i+r)/2,y:(s+a)/2,height:d,width:l}},eu=function(n){var e=n.minX,t=n.minY,o=n.maxX,i=n.maxY;return[{x:e,y:t},{x:o,y:t},{x:o,y:i},{x:e,y:i}]},pl=function(n,e){var t=n.x,o=n.y;return t<e.minX||t>e.maxX||o<e.minY||o>e.maxY},_J=function(n,e){return e<n.minX||e>n.maxX?[]:[{x:e,y:n.minY},{x:e,y:n.maxY}]},gJ=function(n,e){return e<n.minY||e>n.maxY?[]:[{x:n.minX,y:e},{x:n.maxX,y:e}]},mJ=function(n,e){return Qi(Qi([],$o(_J(n,e.x)),!1),$o(gJ(n,e.y)),!1)},sc=function(n,e){return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},yJ=function(n,e){var t=-2,o=0;return e.forEach(function(i){i&&(n.x===i.x&&(o+=t),n.y===i.y&&(o+=t))}),o},mh=function(n,e,t,o,i){return sc(n,e)+sc(n,t)+yJ(n,[e,t,o,i])},Ig=function(n,e,t,o,i){i||(i=0),n.unshift(e[o]),t[o]&&t[o]!==o&&i<=100&&Ig(n,e,t,t[o],i+1)},bJ=function(n,e){var t=n.indexOf(e);t>-1&&n.splice(t,1)},ea=function(n,e,t,o){var i=e.x-n.x,r=e.y-n.y,s=o.x-t.x,a=o.y-t.y,l=(-r*(n.x-t.x)+i*(n.y-t.y))/(-s*r+i*a),d=(s*(n.y-t.y)-a*(n.x-t.x))/(-s*r+i*a);return l>=0&&l<=1&&d>=0&&d<=1},yh=function(n,e,t){if(t.width===0&&t.height===0)return!1;var o=$o(eu(t),4),i=o[0],r=o[1],s=o[2],a=o[3];return ea(n,e,i,r)||ea(n,e,i,a)||ea(n,e,r,s)||ea(n,e,s,a)},xJ=function(n,e,t,o){var i=[];return n.forEach(function(r){r!==e&&(r.x===e.x||r.y===e.y)&&!yh(r,e,t)&&!yh(r,e,o)&&i.push(r)}),rc(i)},wJ=function(n,e,t,o,i,r,s){var a=[],l=[e],d={},c={},p={};e.id&&(c[e.id]=0,p[e.id]=mh(e,t,e));var f={};n.forEach(function(y){y.id&&(f[y.id]=y)});for(var h=function(){var y,g=1/0;if(l.forEach(function(b){b.id&&p[b.id]<g&&(g=p[b.id],y=b)}),y===t&&t.id){var _=[];return Ig(_,f,d,t.id),{value:_}}if(!y)return{value:[e,t]};bJ(l,y),a.push(y),xJ(n,y,o,i).forEach(function(b){if(a.indexOf(b)===-1&&(l.indexOf(b)===-1&&l.push(b),y!=null&&y.id&&(b!=null&&b.id))){var C=p[y.id]+sc(y,b);if(c[b.id]&&C>=c[b.id])return;d[b.id]=y.id,c[b.id]=C,p[b.id]=c[b.id]+mh(b,t,e,r,s)}})};l.length;){var v=h();if(typeof v=="object")return v.value}return[e,t]},bh=function(n){return bo(n)},jg=function(n){for(var e=1;e<n.length-1;){var t=n[e-1],o=n[e],i=n[e+1];t.x===o.x&&o.x===i.x||t.y===o.y&&o.y===i.y?n.splice(e,1):e++}return n},xh=function(n,e,t,o,i){var r=bh(t),s=bh(o),a=Zl(r,i),l=Zl(s,i),d=Ql(a,r,n),c=Ql(l,s,e);if(hJ(a,l)){var p=kJ(n,e,d,c);return Qi(Qi([n,d],$o(p),!1),[c,e],!1)}var f=Oa([d,c]),h=gh(a,f),v=gh(l,f),y=[];y=y.concat(eu(h)),y=y.concat(eu(v));var g={x:(n.x+e.x)/2,y:(n.y+e.y)/2};[f,h,v].forEach(function(b){y=y.concat(mJ(b,g).filter(function(C){return pl(C,a)&&pl(C,l)}))}),[{x:d.x,y:c.y},{x:c.x,y:d.y}].forEach(function(b){pl(b,a)&&pl(b,l)&&y.push(b)}),y.unshift(d),y.push(c),y=rc(y);var _=wJ(y,d,c,r,s,n,e);return _.unshift(n),_.push(e),_.length>2&&(_=jg(_)),rc(_)},CJ=function(n){if(n.length===1){var e=$o(n,1),t=e[0];return[t,t]}else{for(var o=n[0],i=n[1],r=ei(o.x,o.y,i.x,i.y),s=1;s<n.length-1;s++){var a=n[s],l=n[s+1],d=ei(a.x,a.y,l.x,l.y);d>r&&(r=d,o=a,i=l)}return[o,i]}},wh=function(n,e,t){var o=Ii(n,t),i=Ii(e,t);return o&&i},Ch=function(n,e,t){var o=Ii(n,t),i=Ii(e,t),r=o&&i,s=o||i;return!r&&s},kh=function(n,e,t){for(var o=void 0,i=bo(t),r=eu(i),s=0;s<r.length;s++){var a=ea(n,e,r[s],r[(s+1)%r.length]);a&&(o=[r[s],r[(s+1)%r.length]])}if(o)return fJ(n,e,o[0],o[1])},tu=function(n,e){var t=void 0;return n.x===e.x?t=wn.VERTICAL:n.y===e.y&&(t=wn.HORIZONTAL),t},Lr=function(n){var e=n.split(" "),t=[];return e&&e.forEach(function(o){var i=$o(o.split(","),2),r=i[0],s=i[1];t.push({x:Number(r),y:Number(s)})}),t},kJ=function(n,e,t,o){var i=[],r=tu(n,t),s=tu(e,o);if(r===s)n.y===t.y?(i.push({x:t.x,y:(t.y+o.y)/2}),i.push({x:o.x,y:(t.y+o.y)/2})):(i.push({x:(t.x+o.x)/2,y:t.y}),i.push({x:(t.x+o.x)/2,y:o.y}));else{var a={x:t.x,y:o.y},l=Aa(a,n,t),d=Aa(a,e,o);if(l||d)a={x:o.x,y:t.y};else{var c=Sh(a,n,t),p=Sh(a,e,o);c&&p&&(a={x:o.x,y:t.y})}i.push(a)}return i},Sh=function(n,e,t){return n.x===e.x&&n.x===t.x||n.y===e.y&&n.y===t.y},Fg=function(n){if(!n)return 0;for(var e=0,t=0;t<n.length;t++){var o=n.charCodeAt(t);n.match(/[A-Z]/)?e+=1.5:o>=1&&o<=126||o>=65376&&o<=65439?e+=1:e+=2}return e},SJ=function(n){var e=n.start,t=n.end,o;if(e.x===t.x&&e.y===t.y)o="";else{var i={start:e,end:t,offset:10,verticalLength:5},r=Da(rs(rs({},i),{type:"start"})),s=Da(rs(rs({},i),{type:"end"}));o="M".concat(r.leftX," ").concat(r.leftY,`
    L`).concat(r.rightX," ").concat(r.rightY,`
    L`).concat(s.rightX," ").concat(s.rightY,`
    L`).concat(s.leftX," ").concat(s.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},Eh=function(n){var e=n.start,t=n.end,o=n.sourceNode,i=n.targetNode,r=n.offset,s=bo(o),a=bo(i),l=Zl(s,r),d=Zl(a,r),c=Ql(l,s,e),p=Ql(d,a,t);return{sNext:c,ePre:p}},Ep=function(n){var e=n.replace(/M/g,"").replace(/C/g,",").split(","),t=fl(e[0]),o=fl(e[1]),i=fl(e[2]),r=fl(e[3]);return[t,o,i,r]},fl=function(n){var e=$o(n.replace(/(^\s*)/g,"").split(" "),2),t=e[0],o=e[1];return{x:+t,y:+o}},Ah=function(n,e){var t=$o(n,4),o=t[0],i=t[1],r=t[2],s=t[3],a=vK(o,i,r,s,e);return[a,n[3]]},Vg=function(n,e){for(var t=n.x,o=n.y,i=Lr(e),r=Number.MAX_SAFE_INTEGER,s,a=[],l=0;l<i.length;l++)a.push({start:i[l],end:i[(l+1)%i.length]});if(a.forEach(function(f){var h=f.start,v=f.end;if(h.x===v.x){var y={x:h.x,y:o},g=Aa(y,h,v);if(g){var _=Math.abs(h.x-t);_<r&&(r=_,s=y)}}else if(h.y===v.y){var y={x:t,y:h.y},g=Aa(y,h,v);if(g){var _=Math.abs(h.y-o);_<r&&(r=_,s=y)}}}),!s){var d=a[0],c=d.start,p=d.end;s={x:c.x+(p.x-c.x)/2,y:c.y+(p.y-c.y)/2}}return s},EJ=function(n){return ns(n,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},Dh=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))};function AJ(n,e){return typeof e!="function"?function(t,o,i){return Object.assign({type:n.edgeType},i)}:function(t,o,i){var r=e(t,o,i);return r?typeof r=="string"?Object.assign({},i,{type:r}):Object.assign({type:r},i):{type:n.edgeType}}}var DJ=function(n){var e=n.rows,t=n.rowsLength,o=n.fontSize,i=0;return Vt(e,function(r){var s=Fg(r);i=s>i?s:i}),{width:Math.ceil(i/2)*o+o/4,height:t*(o+2)+o/4}},Xr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},hl=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))};function Cs(n,e,t){return t&&e*Math.round(n/e)||n}function OJ(n,e,t){if(!n)return[];var o=Math.min.apply(Math,hl([],Xr(n.map(function(y){return y[0]})),!1)),i=Math.max.apply(Math,hl([],Xr(n.map(function(y){return y[0]})),!1)),r=Math.min.apply(Math,hl([],Xr(n.map(function(y){return y[1]})),!1)),s=Math.max.apply(Math,hl([],Xr(n.map(function(y){return y[1]})),!1)),a=-o,l=-r,d=n.map(function(y){var g=Xr(y,2),_=g[0],b=g[1];return[_+a,b+l]}),c=i-o,p=s-r,f=e?e/c:1,h=t?t/p:1,v=Math.min(f,h);return d.map(function(y){var g=Xr(y,2),_=g[0],b=g[1];return[_*v,b*v]})}var hd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},vd=function(n,e,t){var o=hd(n,2),i=o[0],r=o[1],s=hd(e,2),a=s[0],l=s[1],d=hd(t,2),c=d[0],p=d[1];return i>a&&i<c&&r>l&&r<p},Hg=function(n,e){var t=e.multipleSelectKey,o=!1;switch(t){case"meta":o=n.metaKey;break;case"alt":o=n.altKey;break;case"shift":o=n.shiftKey;break;case"ctrl":o=n.ctrlKey;break;default:o=!1;break}return o},Ap=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();function Oh(n,e){return n instanceof Gn&&e instanceof Gn}var Ug=(function(n){Ap(e,n);function e(t,o,i){var r=n.call(this,3)||this;return r[0]=t,r[1]=o,r[2]=i,r.x=t,r.y=o,r.z=i,Object.setPrototypeOf(r,e.prototype),r}return e.prototype.add=function(t){if(Oh(this,t))return new Gn(this.x+t.x,this.y+t.y);var o=this.z+t.z;return new ac((this.x+t.x)/o,(this.y+t.y)/o)},e.prototype.subtract=function(t){if(Oh(this,t))return new Gn(this.x-t.x,this.y-t.y);var o=this.z-t.z;return o===0?new Gn(this.x-t.x,this.y-t.y):new ac((this.x-t.x)/o,(this.y-t.y)/o)},e})(Array),Gn=(function(n){Ap(e,n);function e(t,o,i){var r=n.call(this,t,o,i??0)||this;return Object.setPrototypeOf(r,e.prototype),r}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var o=this;return t.reduce(function(i,r,s){return i+r*o[s]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var o=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return o>=0?i:-i},e})(Ug),ac=(function(n){Ap(e,n);function e(t,o){var i=n.call(this,t,o,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e})(Ug),Ju=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Wr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},_d=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Qa=(function(n){Ju(e,n);function e(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var i=n.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(r,s){i[s]=r}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return _d([],Wr(this.map(function(o){return o[t]})),!1)},e.prototype.transpose=function(){for(var t=[],o=0;o<this.columns;o++)t.push(this.getColumn(o));return new(e.bind.apply(e,_d([void 0],Wr(t),!1)))},e.prototype.cross=function(t){var o=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var r=this.getRow(i),s=function(l){var d=t.getColumn(l);o[i][l]=r.reduce(function(c,p,f){return c+p*d[f]},0)},a=0;a<t.columns;a++)s(a);return new(e.bind.apply(e,_d([void 0],Wr(o),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new ac(t[0],t[1])})},e.prototype.toString=function(){var t=Wr(this[0],2),o=t[0],i=t[1],r=Wr(this[1],2),s=r[0],a=r[1],l=Wr(this[2],2),d=l[0],c=l[1];return"matrix(".concat(o," ").concat(i," ").concat(s," ").concat(a," ").concat(d," ").concat(c,")")},e.prototype.translate=function(t,o){return this.cross(new nu(t,o))},e.prototype.rotate=function(t){return this.cross(new NJ(t))},e.prototype.scale=function(t,o){return this.cross(new MJ(t,o))},e})(Array),NJ=(function(n){Ju(e,n);function e(t){var o=n.call(this,new Gn(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new Gn(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new Gn(0,0,1))||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return this.transpose()},e})(Qa),MJ=(function(n){Ju(e,n);function e(t,o){var i=n.call(this,new Gn(t,0,0),new Gn(0,o,0),new Gn(0,0,1))||this;return i.sx=t,i.sy=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e})(Qa),nu=(function(n){Ju(e,n);function e(t,o){var i=n.call(this,new Gn(1,0,0),new Gn(0,1,0),new Gn(t,o,1))||this;return i.tx=t,i.ty=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e})(Qa);lY({});var ou=function(){return ou=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ou.apply(this,arguments)},TJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},lc=function(n){var e=n.anchors;return e},iu=function(n,e){for(var t=e.nodes,o,i=t.length-1;i>=0;i--){var r=t[i],s=PJ(n,r);if(s){var a=r.getTargetAnchor(n);if(a){var l={node:r,anchorIndex:a.index,anchor:a.anchor};(!o||$J(r,o.node,e))&&(o=l)}}}return o},$J=function(n,e,t){return n.zIndex>e.zIndex?!0:t.nodesMap[n.id].index>t.nodesMap[e.id].index},RJ=function(n,e){for(var t=lc(e),o,i=Number.MAX_SAFE_INTEGER,r=0;r<t.length;r++){var s=ei(n.x,n.y,t[r].x,t[r].y);s<i&&(i=s,o={index:r,anchor:ou(ou({},t[r]),{x:t[r].x,y:t[r].y,id:t[r].id})})}return o},ei=function(n,e,t,o){return Math.hypot(n-t,e-o)},Ii=function(n,e,t){t===void 0&&(t=0);var o=!1,i=bo(e),r=TJ(new Qa([n.x,n.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),s=r[0],a=r[1],l={x:s,y:a};return l.x>=i.minX-t&&l.x<=i.maxX+t&&l.y>=i.minY-t&&l.y<=i.maxY+t&&(o=!0),o},PJ=function(n,e){return Ii(n,e,5)},bo=function(n){var e=n.x,t=n.y,o=n.width,i=n.height;return{minX:e-o/2,minY:t-i/2,maxX:e+o/2,maxY:t+i/2,x:e,y:t,width:o,height:i,centerX:e,centerY:t}},LJ=function(n){var e=n,t=e.x,o=e.y,i=e.width,r=e.height,s=e.radius;return[{x:t-i/2+s,y:o-r/2+s,r:s},{x:t+i/2-s,y:o-r/2+s,r:s},{x:t-i/2+s,y:o+r/2-s,r:s},{x:t+i/2-s,y:o+r/2-s,r:s}]},Nh=function(n,e,t){var o=LJ(t),i,r=Number.MAX_SAFE_INTEGER;return o.forEach(function(s){var a=ei(n.x,n.y,s.x,s.y);a<r&&(r=a,i=s)}),uc(n,e,i)},uc=function(n,e,t){var o,i=t.x,r=t.y,s=t.r;if(e===wn.HORIZONTAL){var a=i-Math.sqrt(s*s-(n.y-r)*(n.y-r)),l=i+Math.sqrt(s*s-(n.y-r)*(n.y-r)),d=Math.abs(a-n.x)<Math.abs(l-n.x)?a:l;o={x:d,y:n.y}}else if(e===wn.VERTICAL){var c=r-Math.sqrt(s*s-(n.x-i)*(n.x-i)),p=r+Math.sqrt(s*s-(n.x-i)*(n.x-i)),f=Math.abs(c-n.y)<Math.abs(p-n.y)?c:p;o={x:n.x,y:f}}return o},Mh=function(n,e){var t=e,o=!1,i=t.x,r=t.y,s=t.width,a=t.height,l=t.radius,d={minX:i-s/2+l,maxX:i+s/2-l,minY:r-a/2+l,maxY:r+a/2-l};return n.y===r+a/2||n.y===r-a/2?o=n.x>d.minX&&n.x<d.maxX:(n.x===i+s/2||n.x===i-s/2)&&(o=n.y>d.minY&&n.y<d.maxY),o},Th=function(n,e,t){var o,i=t,r=i.x,s=i.y,a=i.rx,l=i.ry;if(e===wn.HORIZONTAL){var d=r-Math.sqrt(a*a-(n.y-s)*(n.y-s)*a*a/(l*l)),c=r+Math.sqrt(a*a-(n.y-s)*(n.y-s)*a*a/(l*l)),p=Math.abs(d-n.x)<Math.abs(c-n.x)?d:c;o={x:p,y:n.y}}else if(e===wn.VERTICAL){var f=s-Math.sqrt(l*l-(n.x-r)*(n.x-r)*l*l/(a*a)),h=s+Math.sqrt(l*l-(n.x-r)*(n.x-r)*l*l/(a*a)),v=Math.abs(f-n.y)<Math.abs(h-n.y)?f:h;o={x:n.x,y:v}}return o},vl=function(n,e,t){for(var o=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,r,s=[],a=0;a<o.length;a++)s.push({start:o[a],end:o[(a+1)%o.length]});return s.forEach(function(l){var d=l.start,c=l.end,p=d,f=c;d.x>c.x&&(p=c,f=d);var h={x:n.x,y:n.y};if(p.x===f.x&&e===wn.HORIZONTAL&&(h={x:p.x,y:n.y}),p.y===f.y&&e===wn.VERTICAL&&(h={x:n.x,y:p.y}),p.x!==f.x&&p.y!==f.y){var v=(f.y-p.y)/(f.x-p.x),y=(p.x*f.y-f.x*p.y)/(p.x-f.x);e===wn.HORIZONTAL?h={x:(n.y-y)/v,y:n.y}:e===wn.VERTICAL&&(h={x:n.x,y:v*n.x+y})}var g=Aa(h,d,c);if(g){var _=ei(h.x,h.y,n.x,n.y);_<i&&(i=_,r=h)}}),r},BJ=function(n){var e=ns(n,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},$h=function(n,e,t,o){var i=n.x,r=n.y;return e.x>n.x?i=n.x+t/2:e.x<n.x&&(i=n.x-t/2),e.y>n.y?r=n.y+o/2:e.y<n.y&&(r=n.y-o/2),{x:i,y:r}},zg=function(n){var e=n.rows,t=n.style,o=n.rowsLength,i=n.className,r=document.createElement("div");r.className=i,r.style.fontSize="".concat(t.fontSize),r.style.width="".concat(t.width),r.style.lineHeight="".concat(t.lineHeight),r.style.padding="".concat(t.padding),t.fontFamily&&(r.style.fontFamily="".concat(t.fontFamily)),o>1?e.forEach(function(a){var l=document.createElement("div");l.textContent=a,r.appendChild(l)}):r.textContent=e[0],document.body.appendChild(r);var s=r.clientHeight;return document.body.removeChild(r),s},Rh=function(n){var e=n.rows,t=n.rowsLength,o=n.fontSize,i=0;return e&&e.forEach(function(r){var s=Fg(r);i=s>i?s:i}),{width:Math.ceil(i/2)*o+o/4,height:t*(o+2)+o/4}},ru=function(n){return typeof n!="object"?{isAllPass:!!n,msg:n?"":"不允许连接"}:n};let _l;const IJ=new Uint8Array(16);function jJ(){if(!_l&&(_l=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_l))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _l(IJ)}const zn=[];for(let n=0;n<256;++n)zn.push((n+256).toString(16).slice(1));function FJ(n,e=0){return zn[n[e+0]]+zn[n[e+1]]+zn[n[e+2]]+zn[n[e+3]]+"-"+zn[n[e+4]]+zn[n[e+5]]+"-"+zn[n[e+6]]+zn[n[e+7]]+"-"+zn[n[e+8]]+zn[n[e+9]]+"-"+zn[n[e+10]]+zn[n[e+11]]+zn[n[e+12]]+zn[n[e+13]]+zn[n[e+14]]+zn[n[e+15]]}const VJ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ph={randomUUID:VJ};function HJ(n,e,t){if(Ph.randomUUID&&!n)return Ph.randomUUID();n=n||{};const o=n.random||(n.rng||jJ)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,FJ(o)}var or=function(){return HJ()},oa=new Map,qg=function(n){var e=or();function t(){n();var i=oa.get(e);if(i){var r=window.requestAnimationFrame(t);oa.set(e,r)}}var o=window.requestAnimationFrame(t);return oa.set(e,o),e},su=function(n){var e=oa.get(n);e&&(window.cancelAnimationFrame(e),oa.delete(n))},Na=function(){return Na=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Na.apply(this,arguments)},UJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Gg(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.value,s=n.fontSize,a=s===void 0?12:s,l=n.fill,d=l===void 0?"currentColor":l,c=n.overflowMode,p=c===void 0?"default":c,f=n.textWidth,h=f===void 0?void 0:f,v=n.model,y={x:t,y:i,fill:d,fontSize:a,textAnchor:"middle",dominantBaseline:"central"};if(Vt(ar(n),function(M){var S=UJ(M,2),k=S[0],A=S[1];typeof A!="object"&&(y[k]=A)}),r){var g=String(r).split(/[\r\n]/g),_=g.length;if(p!=="default"){var b=v.BaseType,C=v.modelType;if(b===En.NODE&&C!==Gt.TEXT_NODE||b===En.EDGE&&h)return zJ(n)}if(_>1){var T=g.map(function(M,S){var k=a+2,A=(S-(_-1)/2)*k;return Pe("tspan",{className:"lf-text-tspan",x:t,y:i+A,children:M})});return Pe("text",Na({},y,{children:T}))}return Pe("text",Na({},y,{children:r}))}return null}function zJ(n){var e=n.x,t=n.y,o=n.value,i=n.model,r=n.textWidth,s=n.fontSize,a=s===void 0?12:s,l=n.lineHeight,d=n.fontFamily,c=d===void 0?"":d,p=n.wrapPadding,f=p===void 0?"0, 0":p,h=n.overflowMode,v=i.width,y=i.height,g=i.textHeight,_=r||v,b=String(o).split(/[\r\n]/g),C=b.length,T=zg({rows:b,style:{fontSize:"".concat(a,"px"),width:"".concat(_,"px"),fontFamily:c,lineHeight:l,padding:f},rowsLength:C,className:"lf-get-text-height"}),M=y>T?y:T;g&&(M=g);var S=h==="ellipsis";return S&&(M=a+2),Pe("g",{children:Pe("foreignObject",{width:_,height:M,x:e-_/2,y:t-M/2,style:{overflow:"visible",textAlign:"left"},children:Pe("div",{className:"lf-node-text-auto-wrap",style:{minHeight:M,width:_,padding:f},children:Pe("div",{className:S?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:S?b.join(""):"",style:Na({},n),children:b.map(function(k){return Pe("div",{className:"lf-node-text--auto-wrap-inner",children:k})})})})})})}var dc=function(){return dc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},dc.apply(this,arguments)},qJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function ks(n){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return Vt(ar(n),function(t){var o=qJ(t,2),i=o[0],r=o[1];(i==="style"||typeof r!="object")&&(e[i]=r)}),Pe("line",dc({},e))}var cc=function(){return cc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},cc.apply(this,arguments)},GJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Ro(n){var e=n.x,t=n.y,o=n.width,i=n.height,r=n.className,s=n.strokeWidth,a=n.radius,l=a===void 0?0:a,d=e-o/2,c=t-i/2,p={};return p["stroke-width"]=s,Vt(ar(n),function(f){var h=GJ(f,2),v=h[0],y=h[1];typeof y!="object"&&(p[v]=y)}),r?p.className="lf-basic-shape ".concat(r):p.className="lf-basic-shape",l&&(p.rx=l,p.ry=l),p.x=d,p.y=c,Pe("rect",cc({},p))}var pc=function(){return pc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pc.apply(this,arguments)},XJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Ma(n){var e={d:""};return Vt(ar(n),function(t){var o=XJ(t,2),i=o[0],r=o[1];(i==="style"||typeof r!="object")&&(e[i]=r)}),Pe("path",pc({},e))}var fc=function(){return fc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},fc.apply(this,arguments)},WJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Ss(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.r,s=r===void 0?4:r,a=n.className,l={cx:t,cy:i,r:s,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return Vt(ar(n),function(d){var c=WJ(d,2),p=c[0],f=c[1];typeof f!="object"&&(l[p]=f)}),a?l.className="lf-basic-shape ".concat(a):l.className="lf-basic-shape",Pe("circle",fc({},l))}var hc=function(){return hc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},hc.apply(this,arguments)},YJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function JJ(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.rx,s=r===void 0?4:r,a=n.ry,l=a===void 0?4:a,d=n.className,c={cx:t,cy:i,rx:s,ry:l,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return Vt(ar(n),function(p){var f=YJ(p,2),h=f[0],v=f[1];typeof v!="object"&&(c[h]=v)}),d?c.className="lf-basic-shape ".concat(d):c.className="lf-basic-shape",Pe("ellipse",hc({},c))}var au=function(){return au=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},au.apply(this,arguments)},KJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function ZJ(n,e){var t=n.map(function(b){return{x:b[0],y:b[1]}}),o=t.length;if(o<3)return"";for(var i=Math.abs(e),r="",s=0;s<o;s++){var a=t[(s-1+o)%o],l=t[s],d=t[(s+1)%o],c={x:l.x-a.x,y:l.y-a.y},p={x:d.x-l.x,y:d.y-l.y},f=Math.hypot(c.x,c.y),h=Math.hypot(p.x,p.y),v={x:c.x/f,y:c.y/f},y={x:p.x/h,y:p.y/h},g={x:l.x-v.x*i,y:l.y-v.y*i},_={x:l.x+y.x*i,y:l.y+y.y*i};s===0?r+="M ".concat(g.x," ").concat(g.y," "):r+="L ".concat(g.x," ").concat(g.y," "),r+="Q ".concat(l.x," ").concat(l.y," ").concat(_.x," ").concat(_.y," ")}return r+="Z",r}function Dp(n){var e=n.points,t=e===void 0?[]:e,o=n.className,i=n.radius,r={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(Vt(ar(n),function(a){var l=KJ(a,2),d=l[0],c=l[1];typeof c!="object"&&(r[d]=c)}),o?r.classNmae="lf-basic-shape ".concat(o):r.className="lf-basic-shape",i){var s=ZJ(t,i);return r.d=s,Pe("path",au({},r))}else return r.points=t.map(function(a){return a.join(",")}).join(" "),Pe("polygon",au({},r))}var vc=function(){return vc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vc.apply(this,arguments)},QJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function eK(n){var e=n.className,t={points:"",fill:"none"};return Vt(ar(n),function(o){var i=QJ(o,2),r=i[0],s=i[1];(r==="style"||typeof s!="object")&&(t[r]=s)}),e&&(t.className="".concat(e)),Pe("polyline",vc({},t))}var Xg=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ta=function(){return Ta=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ta.apply(this,arguments)},tK=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},nK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},cn;(function(n){n[n.LEFT_TOP=0]="LEFT_TOP",n[n.RIGHT_TOP=1]="RIGHT_TOP",n[n.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",n[n.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(cn||(cn={}));var oK=(function(n){Xg(e,n);function e(t){var o=n.call(this)||this;o.isShiftPressed=!1,o.bindKeyboardEvents=function(){document.addEventListener("keydown",o.handleKeyDown),document.addEventListener("keyup",o.handleKeyUp)},o.handleKeyDown=function(a){a.key==="Shift"&&(o.isShiftPressed=!0)},o.handleKeyUp=function(a){a.key==="Shift"&&(o.isShiftPressed=!1)},o.updateEdgePointByAnchors=function(){var a=o.nodeModel,l=a.id,d=a.anchors,c=o.graphModel.getNodeEdges(l);Vt(c,function(p){if(p.sourceNodeId===l){var f=Tr(d,function(h){return h.id===p.sourceAnchorId});f&&p.updateStartPoint({x:f.x,y:f.y})}else if(p.targetNodeId===l){var f=Tr(d,function(v){return v.id===p.targetAnchorId});f&&p.updateEndPoint({x:f.x,y:f.y})}})},o.triggerResizeEvent=function(a,l,d,c,p,f){o.graphModel.eventCenter.emit(_t.NODE_RESIZE,{preData:a,data:l,deltaX:d,deltaY:c,index:p,model:f})},o.recalcResizeInfo=function(a,l,d,c,p){d===void 0&&(d=1),c===void 0&&(c=!1),p===void 0&&(p=!1);var f=Dt(l),h=f.deltaX,v=f.deltaY,y=f.width,g=f.height,_=f.PCTResizeInfo;if(_){var b=4,C=0,T=0;switch(a){case cn.LEFT_TOP:T=(h*-1-v)/b;break;case cn.RIGHT_TOP:T=(h-v)/b;break;case cn.RIGHT_BOTTOM:T=(h+v)/b;break;case cn.LEFT_BOTTOM:T=(h*-1+v)/b;break}T!==0&&(C=Math.round(T/_.ResizeBasis.basisHeight*1e5)/1e3),_.ResizePCT.widthPCT=Math.max(Math.min(_.ResizePCT.widthPCT+C,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit),_.ResizePCT.heightPCT=Math.max(Math.min(_.ResizePCT.heightPCT+C,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit);var M=Math.round(_.ResizePCT.widthPCT*_.ResizeBasis.basisWidth/100),S=Math.round(_.ResizePCT.heightPCT*_.ResizeBasis.basisHeight/100);switch(a){case cn.LEFT_TOP:h=y-M,v=g-S;break;case cn.RIGHT_TOP:h=M-y,v=g-S;break;case cn.RIGHT_BOTTOM:h=M-y,v=S-g;break;case cn.LEFT_BOTTOM:h=y-M,v=S-g;break}return f}switch(a){case cn.LEFT_TOP:f.width=c?y:y-h*d,f.height=p?g:g-v*d;break;case cn.RIGHT_TOP:f.width=c?y:y+h*d,f.height=p?g:g-v*d;break;case cn.RIGHT_BOTTOM:f.width=c?y:y+h*d,f.height=p?g:g+v*d;break;case cn.LEFT_BOTTOM:f.width=c?y:y-h*d,f.height=p?g:g+v*d;break}return f},o.resizeNode=function(a){var l=a.deltaX,d=a.deltaY,c=o.index,p=o.props,f=p.model,h=p.graphModel,v=p.x,y=p.y;Wg({x:v,y,deltaX:l,deltaY:d,index:c,nodeModel:f,graphModel:h,forceProportional:o.isShiftPressed,cancelCallback:function(){o.dragHandler.cancelDrag()}})},o.onDragStart=function(){o.graphModel.selectNodeById(o.nodeModel.id)},o.onDragging=function(a){var l=a.deltaX,d=a.deltaY,c=o.graphModel.transformModel,p=nK(c.fixDeltaXY(l,d),2),f=p[0],h=p[1];o.resizeNode({deltaX:f,deltaY:h})},o.onDragEnd=function(){var a=o.nodeModel.x,l=o.nodeModel.y;o.nodeModel.moveTo(a,l),o.updateEdgePointByAnchors()};var i=t.index,r=t.model,s=t.graphModel;return o.index=i,o.nodeModel=r,o.graphModel=s,o.dragHandler=new zo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:s.gridSize}),o.bindKeyboardEvents(),o}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.direction,s=t.model,a=s.getResizeControlStyle(),l=a.width,d=a.height,c=tK(a,["width","height"]);return Pe("g",{className:"lf-resize-control lf-resize-control-".concat(r),children:[Pe(Ro,Ta({className:"lf-resize-control-content",x:o,y:i,width:l??7,height:d??7},c)),Pe(Ro,{className:"lf-resize-control-content",x:o,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onPointerDown:this.dragHandler.handleMouseDown})]})},e})(Kt),iK=(function(n){Xg(e,n);function e(){return n.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=bo(o),s=r.minX,a=r.minY,l=r.maxX,d=r.maxY,c=[{index:cn.LEFT_TOP,direction:"nw",x:s,y:a},{index:cn.RIGHT_TOP,direction:"ne",x:l,y:a},{index:cn.RIGHT_BOTTOM,direction:"se",x:l,y:d},{index:cn.LEFT_BOTTOM,direction:"sw",x:s,y:d}];return si(c,function(p){return Pe(oK,Ta({},p,{model:o,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getResizeOutlineStyle();return Pe(Ro,Ta({},a,{x:o,y:i,width:r,height:s}))},e.prototype.render=function(){return Pe("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e})(Kt);function rK(n,e){var t=n.x,o=n.y,i=e.x,r=e.y,s={x:t+(i-t)/2,y:o+(r-o)/2};return s}function ta(n,e,t){var o=sK(t),i=n.x-e.x,r=n.y-e.y,s=i*Math.cos(o)-r*Math.sin(o)+e.x,a=i*Math.sin(o)+r*Math.cos(o)+e.y;return{x:s,y:a}}function sK(n){return n*Math.PI/180}function aK(n){return n/Math.PI*180}function lK(n,e,t,o,i,r,s,a){i===void 0&&(i=!1),r===void 0&&(r=!1);var l={x:t.x-(n.x-t.x),y:t.y-(n.y-t.y)},d=rK(l,e),c=ta(e,d,-o),p=ta(l,d,-o);if(i){var f=Math.abs(c.x-p.x),h=f-s;d.x>c.x?d.x=d.x+h/2:d.x=d.x-h/2}if(r){var v=Math.abs(c.y-p.y),y=v-a;d.y>c.y?d.y=d.y+y/2:d.y=d.y-y/2}if(i||r){var g=ta(p,d,o),_=g.x-l.x,b=g.y-l.y;d.x=d.x-_,d.y=d.y-b,p=ta(l,d,-o),c={x:d.x-(p.x-d.x),y:d.y-(p.y-d.y)}}var C=Math.abs(c.x-p.x),T=Math.abs(c.y-p.y);return i&&(C=s),r&&(T=a),{width:C,height:T,center:d}}function uK(n,e,t,o,i,r,s,a,l){a===void 0&&(a=!1),l===void 0&&(l=!1);var d=e.deltaX,c=e.deltaY,p=e.width,f=e.height,h=aK(t),v={x:o,y:i},y={x:r,y:s},g=ta(v,y,h),_={x:g.x+d,y:g.y+c},b=lK(g,_,y,h,a,l,p,f),C=b.width,T=b.height,M=b.center;return e.width=C*n,e.height=T*n,e.deltaX=(M.x-y.x)*2,e.deltaY=(M.y-y.y)*2,e}var dK=function(n,e,t,o,i,r,s,a,l,d,c){t===void 0&&(t=1),o===void 0&&(o=!1),i===void 0&&(i=!1),r===void 0&&(r=0),c===void 0&&(c=!1);var p=Dt(e),f=p.deltaX,h=p.deltaY,v=p.width,y=p.height,g=p.PCTResizeInfo;if(g){var _=4,b=0,C=0;switch(n){case cn.LEFT_TOP:C=(f*-1-h)/_;break;case cn.RIGHT_TOP:C=(f-h)/_;break;case cn.RIGHT_BOTTOM:C=(f+h)/_;break;case cn.LEFT_BOTTOM:C=(f*-1+h)/_;break}C!==0&&(b=Math.round(C/g.ResizeBasis.basisHeight*1e5)/1e3),g.ResizePCT.widthPCT=Math.max(Math.min(g.ResizePCT.widthPCT+b,g.ScaleLimit.maxScaleLimit),g.ScaleLimit.minScaleLimit),g.ResizePCT.heightPCT=Math.max(Math.min(g.ResizePCT.heightPCT+b,g.ScaleLimit.maxScaleLimit),g.ScaleLimit.minScaleLimit);var T=Math.round(g.ResizePCT.widthPCT*g.ResizeBasis.basisWidth/100),M=Math.round(g.ResizePCT.heightPCT*g.ResizeBasis.basisHeight/100);switch(n){case cn.LEFT_TOP:f=v-T,h=y-M;break;case cn.RIGHT_TOP:f=T-v,h=y-M;break;case cn.RIGHT_BOTTOM:f=T-v,h=M-y;break;case cn.LEFT_BOTTOM:f=v-T,h=M-y;break}return p}if(r%(2*Math.PI)!==0&&s!==void 0&&a!==void 0)return uK(t,p,r,s,a,l,d,o,i);if(c){var S=v/y,k=0,A=v,$=y;switch(n){case cn.LEFT_TOP:k=Math.abs(f)>Math.abs(h)?-f:-h,S>=1?(A=v+k,$=A/S):($=y+k,A=$*S),p.width=A,p.height=$,p.deltaX=v-A,p.deltaY=y-$;break;case cn.RIGHT_TOP:k=Math.abs(f)>Math.abs(h)?f:-h,S>=1?(A=v+k,$=A/S):($=y-k,A=$*S),p.width=A,p.height=$,p.deltaX=A-v,p.deltaY=y-$;break;case cn.RIGHT_BOTTOM:k=Math.abs(f)>Math.abs(h)?f:h,S>=1?(A=v+k,$=A/S):($=y+k,A=$*S),p.width=A,p.height=$,p.deltaX=A-v,p.deltaY=$-y;break;case cn.LEFT_BOTTOM:k=Math.abs(f)>Math.abs(h)?-f:h,S>=1?(A=v-k,$=A/S):($=y+k,A=$*S),p.width=A,p.height=$,p.deltaX=v-A,p.deltaY=$-y;break}return p}switch(n){case cn.LEFT_TOP:p.width=o?v:v-f*t,p.height=i?y:y-h*t;break;case cn.RIGHT_TOP:p.width=o?v:v+f*t,p.height=i?y:y-h*t;break;case cn.RIGHT_BOTTOM:p.width=o?v:v+f*t,p.height=i?y:y+h*t;break;case cn.LEFT_BOTTOM:p.width=o?v:v-f*t,p.height=i?y:y+h*t;break}return p},cK=function(n,e){var t=n.id,o=n.anchors,i=e.getNodeEdges(t);Vt(i,function(r){if(r.sourceNodeId===t){var s=Tr(o,function(a){return a.id===r.sourceAnchorId});s&&r.updateStartPoint({x:s.x,y:s.y})}else if(r.targetNodeId===t){var s=Tr(o,function(l){return l.id===r.targetAnchorId});s&&r.updateEndPoint({x:s.x,y:s.y})}})},pK=function(n,e,t,o,i,r,s){s.eventCenter.emit(_t.NODE_RESIZE,{preData:n,data:e,deltaX:t,deltaY:o,index:i,model:r})},Wg=function(n){var e=n.x,t=n.y,o=n.deltaX,i=n.deltaY,r=n.index,s=n.nodeModel,a=n.graphModel,l=n.cancelCallback,d=n.forceProportional,c=d===void 0?!1:d,p=s.r,f=s.rx,h=s.ry,v=s.width,y=s.height,g=s.PCTResizeInfo,_=s.minWidth,b=s.minHeight,C=s.maxWidth,T=s.maxHeight,M=s.rotate,S=s.x,k=s.y,A=_===C,$=b===T,B={width:p||f||v,height:p||h||y,deltaX:o,deltaY:i,PCTResizeInfo:g},O=p||f&&h?1/2:1,P=e,E=t,D=dK(r,B,O,A,$,M,P,E,S,k,c);if(D.width<_||D.width>C||D.height<b||D.height>T){l==null||l();return}(M%(2*Math.PI)==0||g||P===void 0||E===void 0)&&(D.deltaX=A?0:D.deltaX,D.deltaY=$?0:D.deltaY);var N=s.getData(),F=s.resize(D);N.x===F.x&&N.y===F.y||(cK(s,a),pK(N,F,o,i,r,s,a))},fK=100,hK={x:1,y:0};function vK(n,e,t,o,i){for(var r=function(h){if(h<0||h>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:n.x*Math.pow(1-h,3)+3*e.x*h*Math.pow(1-h,2)+3*t.x*Math.pow(h,2)*(1-h)+o.x*Math.pow(h,3),y:n.y*Math.pow(1-h,3)+3*e.y*h*Math.pow(1-h,2)+3*t.y*Math.pow(h,2)*(1-h)+o.y*Math.pow(h,3)}},s=0,a=2,l=o.x,d=o.y,c=o;s<i&&a<50;){c=r(1-a/fK);var p=c.x,f=c.y;s=ei(l,d,p,f),a++}return c}function _K(n,e){return n.x*e.y-n.y*e.x}function gK(n,e){var t=[n.x,n.y,n.z],o=[e.x,e.y,e.z];return o.reduce(function(i,r,s){return i+r*t[s]})}function mK(n,e){var t=_K(n,e),o=Math.acos(gK(Lh(n),Lh(e)));return t>=0?o:-o}function Lh(n){var e=Math.hypot(n.x,n.y);return{x:n.x/e,y:n.y/e,z:0}}function yK(n){return mK(hK,n)}function bK(n){return n*(180/Math.PI)}var Yg={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},xK={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},wK={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},CK={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},$a={colorful:CK,dark:wK,radius:xK,default:Yg},kK={background:"#23272e"},SK={background:"#fefeff"},_c={background:"#ffffff"},Ra={colorful:SK,dark:kK,radius:_c,default:_c},EK={color:"#66676a",thickness:1},AK={color:"#dadada",thickness:1},gc={color:"#acacac",thickness:1},Pa={colorful:AK,dark:EK,radius:gc,default:gc},Jg=function(n,e){var t=Dt(Yg);return e&&(t=cs(t,$a[e])),n&&(t=cs(t,n)),t},DK=function(n,e){if($a[n]){console.warn("theme mode ".concat(n," already exists"));return}$a[n]=e,Ra[n]=e.background||_c,Pa[n]=e.grid||gc},OK=function(n){delete $a[n],delete Ra[n],delete Pa[n]},Bh=function(){var n={colorful:{},dark:{},radius:{},default:{}};pn($a,n),pn(Ra,n),pn(Pa,n)},NK=Jg,MK=1e3,TK=999,La=function(){return++MK},$K=function(){return--TK},Nn=function(){return Nn=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nn.apply(this,arguments)},kt=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Ku=(function(){function n(e,t){var o;this.BaseType=En.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=jo.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=ln.DEFAULT,this.modelType=Gt.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(o=e.properties)!==null&&o!==void 0?o:{},this.initEdgeData(e),this.setAttributes()}return n.prototype.initEdgeData=function(e){var t=this;if(e.properties||(e.properties={}),!e.id){var o=this.graphModel.idGenerator,i=o&&o(e.type),r=this.createId();e.id=r||i||or()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var s=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=s,pn(this,EJ(e));var a=this.graphModel,l=a.overlapMode,d=a.eventCenter;this.updateZIndexByOverlap(l,e.zIndex||La()),this.setAnchors(),this.initPoints(),this.formatText(e),d.on("overlap:change",function(c){var p=c.overlapMode;t.updateZIndexByOverlap(p,t.zIndex||La())})},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.getEdgeStyle=function(){return Nn(Nn({},this.graphModel.theme.baseEdge),this.style)},n.prototype.getAdjustPointStyle=function(){return Nn({},this.graphModel.theme.edgeAdjust)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return Dt(e)},n.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return Dt(e)},n.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),o=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return Nn(Nn(Nn({},e),{fill:i,stroke:i}),o)},n.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return Dt(t)},n.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(n.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),n.prototype.getBeginAnchor=function(e,t,o){var i,r,s=lc(e);if(o){if(i=Tr(s,function(a){return a.id===o}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(o,"，已使用默认锚点作为起点"))}return s.forEach(function(a){var l=Dh(a,t);(r===void 0||l<r)&&(r=l,i=a)}),i},n.prototype.getEndAnchor=function(e,t){var o=this,i,r,s=lc(e);if(t){if(i=Tr(s,function(a){return a.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return s.forEach(function(a){if(o.startPoint){var l=Dh(a,o.startPoint);(r===void 0||l<r)&&(r=l,i=a)}}),i},n.prototype.getProperties=function(){return Jo(this.properties)},n.prototype.getData=function(){var e=this.properties;xs(e)&&(e=Jo(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:pn({},this.startPoint),endPoint:pn({},this.endPoint)};[jn.INCREASE,jn.STATIC].includes(this.graphModel.overlapMode)&&(t.zIndex=this.zIndex);var o=this.text,i=o.x,r=o.y,s=o.value;return s&&(t.text={x:i,y:r,value:s}),t},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.setProperty=function(e,t){wp(this.properties,e,Qn(t)),this.setAttributes()},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setProperties=function(e){this.properties=Nn(Nn({},Jo(this.properties)),Qn(e)),this.setAttributes()},n.prototype.changeEdgeId=function(e){var t=this.arrowConfig,o=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),o&&o==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},n.prototype.setStyle=function(e,t){var o;this.style=Nn(Nn({},this.style),(o={},o[e]=Qn(t),o))},n.prototype.setStyles=function(e){this.style=Nn(Nn({},this.style),Qn(e))},n.prototype.updateStyles=function(e){this.style=Nn({},Qn(e))},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,o,i,r=this.graphModel.editConfigModel,s=r.edgeTextDraggable,a=r.edgeTextEdit,l=this.textPosition,d=l.x,c=l.y,p=e.text,f={value:"",x:d,y:c,draggable:s,editable:a};p&&(typeof p=="string"?f=Nn(Nn({},f),{value:p}):(f=Nn(Nn({},f),{x:(t=p.x)!==null&&t!==void 0?t:d,y:(o=p.y)!==null&&o!==void 0?o:c,value:(i=p.value)!==null&&i!==void 0?i:""}),ps(p.draggable)||(f.draggable=p.draggable),ps(p.editable)||(f.editable=p.editable))),this.text=f},n.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,o=e.y;this.text.x=t,this.text.y=o},n.prototype.moveText=function(e,t){var o=this.text,i=o.x,r=o.y,s=o.value,a=o.draggable,l=o.editable;this.text={value:s,editable:l,draggable:a,x:i+e,y:r+t}},n.prototype.setText=function(e){e&&pn(this.text,e)},n.prototype.updateText=function(e){this.text=Nn(Nn({},Jo(this.text)),{value:e})},n.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.openEdgeAnimation=function(){this.isAnimation=!0},n.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateStartPoint=function(e){this.startPoint=e},n.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},n.prototype.updateEndPoint=function(e){this.endPoint=e},n.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},n.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},n.prototype.initPoints=function(){},n.prototype.updateAttributes=function(e){pn(this,e)},n.prototype.getAdjustStart=function(){return this.startPoint},n.prototype.getAdjustEnd=function(){return this.endPoint},n.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,o=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:o.x,y:o.y})},n.prototype.updateZIndexByOverlap=function(e,t){switch(e){case jn.DEFAULT:this.zIndex=0;break;case jn.EDGE_TOP:this.zIndex=1;break;case jn.INCREASE:this.zIndex=t;break}},n.BaseType=En.EDGE,kt([Re],n.prototype,"type",void 0),kt([Re],n.prototype,"sourceNodeId",void 0),kt([Re],n.prototype,"targetNodeId",void 0),kt([Re],n.prototype,"startPoint",void 0),kt([Re],n.prototype,"endPoint",void 0),kt([Re],n.prototype,"textMode",void 0),kt([Re],n.prototype,"text",void 0),kt([Re],n.prototype,"properties",void 0),kt([Re],n.prototype,"points",void 0),kt([Re],n.prototype,"pointsList",void 0),kt([Re],n.prototype,"isSelected",void 0),kt([Re],n.prototype,"isHovered",void 0),kt([Re],n.prototype,"isHitable",void 0),kt([Re],n.prototype,"isHittable",void 0),kt([Re],n.prototype,"draggable",void 0),kt([Re],n.prototype,"visible",void 0),kt([Re],n.prototype,"isAnimation",void 0),kt([Re],n.prototype,"isShowAdjustPoint",void 0),kt([Re],n.prototype,"zIndex",void 0),kt([Re],n.prototype,"state",void 0),kt([Re],n.prototype,"style",void 0),kt([Re],n.prototype,"arrowConfig",void 0),kt([bn],n.prototype,"sourceNode",null),kt([bn],n.prototype,"targetNode",null),kt([bn],n.prototype,"textPosition",null),kt([$e],n.prototype,"setProperty",null),kt([$e],n.prototype,"deleteProperty",null),kt([$e],n.prototype,"setProperties",null),kt([$e],n.prototype,"changeEdgeId",null),kt([$e],n.prototype,"setStyle",null),kt([$e],n.prototype,"setStyles",null),kt([$e],n.prototype,"updateStyles",null),kt([$e],n.prototype,"setTextMode",null),kt([$e],n.prototype,"formatText",null),kt([$e],n.prototype,"resetTextPosition",null),kt([$e],n.prototype,"moveText",null),kt([$e],n.prototype,"setText",null),kt([$e],n.prototype,"updateText",null),kt([$e],n.prototype,"setAnchors",null),kt([$e],n.prototype,"setSelected",null),kt([$e],n.prototype,"setHovered",null),kt([$e],n.prototype,"setHitable",null),kt([$e],n.prototype,"setHittable",null),kt([$e],n.prototype,"openEdgeAnimation",null),kt([$e],n.prototype,"closeEdgeAnimation",null),kt([$e],n.prototype,"setElementState",null),kt([$e],n.prototype,"updateStartPoint",null),kt([$e],n.prototype,"moveStartPoint",null),kt([$e],n.prototype,"updateEndPoint",null),kt([$e],n.prototype,"moveEndPoint",null),kt([$e],n.prototype,"setZIndex",null),kt([$e],n.prototype,"initPoints",null),kt([$e],n.prototype,"updateAttributes",null),kt([$e],n.prototype,"getAdjustStart",null),kt([$e],n.prototype,"getAdjustEnd",null),kt([$e],n.prototype,"updateAfterAdjustStartAndEnd",null),kt([$e],n.prototype,"updateZIndexByOverlap",null),n})(),RK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wr=function(){return wr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},wr.apply(this,arguments)},Do=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},gd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},mc=(function(n){RK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=qa(t,"properties.offset",100),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return wr(wr(wr({},o),Dt(t)),Dt(r))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,o=0;return this.pointsList.forEach(function(i){var r=i.x,s=i.y;t+=r,o+=s}),{x:t/this.pointsList.length,y:o/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=n.prototype.getData.call(this),o=this.pointsList.map(function(i){var r=i.x,s=i.y;return{x:r,y:s}});return wr(wr({},t),{pointsList:o})},e.prototype.getControls=function(){var t=this.startPoint,o=this.endPoint,i=Eh({start:t,end:o,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var o=gd(t,4),i=o[0],r=o[1],s=o[2],a=o[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(r.x," ").concat(r.y,`,
    `).concat(s.x," ").concat(s.y,`,
    `).concat(a.x," ").concat(a.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),o=t.sNext,i=t.ePre;this.updatePath(o,i)},e.prototype.updatePath=function(t,o){t=Dt(t),o=Dt(o);var i={x:this.startPoint.x,y:this.startPoint.y},r={x:this.endPoint.x,y:this.endPoint.y};if(!t||!o){var s=this.getControls();t=s.sNext,o=s.ePre}this.pointsList=[i,t,o,r],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,o){this.startPoint.x+=t,this.startPoint.y+=o;var i=gd(this.pointsList,3),r=i[1],s=i[2];r.x+=t,r.y+=o,this.updatePath(r,s)},e.prototype.moveEndPoint=function(t,o){this.endPoint.x+=t,this.endPoint.y+=o;var i=gd(this.pointsList,3),r=i[1],s=i[2];s.x+=t,s.y+=o,this.updatePath(r,s)},e.prototype.updateAdjustAnchor=function(t,o){var i;o==="sNext"?this.pointsList[1]=t:o==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(pn({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var o=t.startPoint,i=t.endPoint,r=t.sourceNode,s=t.targetNode,a=Eh({start:o,end:i,sourceNode:r,targetNode:s,offset:this.offset}),l=a.sNext,d=a.ePre;this.pointsList=[o,l,d,i],this.initPoints()},Do([Re],e.prototype,"offset",void 0),Do([Re],e.prototype,"path",void 0),Do([$e],e.prototype,"initPoints",null),Do([$e],e.prototype,"updatePoints",null),Do([$e],e.prototype,"updateStartPoint",null),Do([$e],e.prototype,"updateEndPoint",null),Do([$e],e.prototype,"moveStartPoint",null),Do([$e],e.prototype,"moveEndPoint",null),Do([$e],e.prototype,"updateAdjustAnchor",null),Do([$e],e.prototype,"getAdjustStart",null),Do([$e],e.prototype,"getAdjustEnd",null),Do([$e],e.prototype,"updateAfterAdjustStartAndEnd",null),e})(Ku),PK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ia=function(){return ia=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ia.apply(this,arguments)},Ih=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},LK=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},jh=(function(n){PK(e,n);function e(){var t=n.apply(this,LK([],Ih(arguments),!1))||this;return t.modelType=Gt.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return ia(ia(ia({},o),Dt(t)),Dt(r))},e.prototype.initEdgeData=function(t){n.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var o=Ih(t,2),i=o[0],r=o[1];return"".concat(i.x,",").concat(i.y," ").concat(r.x,",").concat(r.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e})(Ku),BK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ra=function(){return ra=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ra.apply(this,arguments)},Un=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Fh=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},IK=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Es=(function(n){BK(e,n);function e(){var t=n.apply(this,IK([],Fh(arguments),!1))||this;return t.modelType=Gt.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=qa(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return ra(ra(ra({},o),Dt(t)),Dt(r))},e.prototype.getTextPosition=function(){var t,o=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!o){var i=this.dbClickPosition,r=i.x,s=i.y;return{x:r,y:s}}var a=Lr(this.points),l=Fh(CJ(a),2),d=l[0],c=l[1];return{x:(d.x+c.x)/2,y:(d.y+c.y)/2}},e.prototype.getAfterAnchor=function(t,o,i){var r,s;return i.forEach(function(a){var l;t===wn.HORIZONTAL?l=Math.abs(o.y-a.y):t===wn.VERTICAL&&(l=Math.abs(o.x-a.x)),(!s||s>l)&&(s=l,r=a)}),r},e.prototype.getCrossPoint=function(t,o,i){var r;return t===wn.HORIZONTAL?r={x:i.x,y:o.y}:t===wn.VERTICAL&&(r={x:o.x,y:i.y}),r},e.prototype.removeCrossPoints=function(t,o,i){var r=i.map(function(_){return _});if(t===1){var s=r[t],a=r[o],l=r[t-1],d=wh(l,s,this.sourceNode);if(d){var c=Ch(s,a,this.sourceNode);if(c){var p=kh(s,a,this.sourceNode);p&&(r[t]=p,r.splice(t-1,1),t--,o--)}}else{var f=this.sourceNode.anchors;f.forEach(function(_){if(_.x===l.x&&_.x===s.x||_.y===l.y&&_.y===s.y){var b=ei(_.x,_.y,s.x,s.y),C=ei(l.x,l.y,s.x,s.y);b<C&&(r[t-1]=_)}})}}if(o===i.length-2){var h=r[t],v=r[o],y=r[o+1],g=wh(v,y,this.targetNode);if(g){var c=Ch(h,v,this.targetNode);if(c){var p=kh(h,v,this.targetNode);p&&(r[o]=p,r.splice(o+1,1))}}else{var f=this.targetNode.anchors;f.forEach(function(b){if(b.x===y.x&&b.x===v.x||b.y===y.y&&b.y===v.y){var C=ei(b.x,b.y,v.x,v.y),T=ei(y.x,y.y,v.x,v.y);C<T&&(r[o+1]=b)}})}}return r},e.prototype.getDraggingPoints=function(t,o,i,r,s){var a=s.map(function(c){return c}),l=this.getAfterAnchor(t,i,r),d=this.getCrossPoint(t,i,l);return o==="start"?(a.unshift(d),a.unshift(l)):(a.push(d),a.push(l)),a},e.prototype.updateCrossPoints=function(t){var o=t.map(function(b){return b}),i=t[0],r=t[1],s=t[o.length-2],a=t[o.length-1],l=this,d=l.sourceNode,c=l.targetNode,p=d.modelType,f=c.modelType,h=tu(i,r),v=o[0];switch(p){case Gt.RECT_NODE:if(d.radius!==0){var y=Mh(i,d);y||(v=Nh(i,h,d))}break;case Gt.CIRCLE_NODE:v=uc(i,h,d);break;case Gt.ELLIPSE_NODE:v=Th(i,h,d);break;case Gt.DIAMOND_NODE:v=vl(i,h,d);break;case Gt.POLYGON_NODE:v=vl(i,h,d);break}v&&(o[0]=v);var g=tu(s,a),_=o[o.length-1];switch(f){case Gt.RECT_NODE:if(c.radius!==0){var y=Mh(a,c);y||(_=Nh(a,g,c))}break;case Gt.CIRCLE_NODE:_=uc(a,g,c);break;case Gt.ELLIPSE_NODE:_=Th(a,g,c);break;case Gt.DIAMOND_NODE:_=vl(a,g,c);break;case Gt.POLYGON_NODE:_=vl(a,g,c);break}return _&&(o[o.length-1]=_),o},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=n.prototype.getData.call(this),o=this.pointsList.map(function(i){var r=i.x,s=i.y;return{x:r,y:s}});return Object.assign({},t,{pointsList:o})},e.prototype.getPath=function(t){return t.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=xh({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,o){this.startPoint.x+=t,this.startPoint.y+=o,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,o){this.endPoint.x+=t,this.endPoint.y+=o,this.updatePoints()},e.prototype.updatePointsList=function(t,o){this.pointsList.forEach(function(s){s.x+=t,s.y+=o});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var r=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},r),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,o){var i;this.isDragging=!0;var r=t.start,s=t.end,a=t.startIndex,l=t.endIndex,d=t.direction,c=this.pointsList,p=c;return d===wn.HORIZONTAL?(c[a]={x:r.x,y:r.y+o.y},c[l]={x:s.x,y:s.y+o.y},p=this.pointsList.map(function(f){return f})):d===wn.VERTICAL&&(c[a]={x:r.x+o.x,y:r.y},c[l]={x:s.x+o.x,y:s.y},p=this.pointsList.map(function(f){return f})),this.updatePointsAfterDrag(p),this.draggingPointList=p,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(pn({},this.text,this.textPosition)),{start:pn({},c[a]),end:pn({},c[l]),startIndex:a,endIndex:l,direction:d}},e.prototype.dragAppend=function(t,o){var i;this.isDragging=!0;var r=t.start,s=t.end,a=t.startIndex,l=t.endIndex,d=t.direction,c=this.pointsList;if(d===wn.HORIZONTAL){c[a]={x:r.x,y:r.y+o.y},c[l]={x:s.x,y:s.y+o.y};var p=this.pointsList.map(function(g){return g});if(a!==0&&l!==this.pointsList.length-1&&(p=this.removeCrossPoints(a,l,p)),a===0){var f={x:r.x,y:r.y+o.y},h=Ii(f,this.sourceNode);if(!h){var v=this.sourceNode.anchors;p=this.getDraggingPoints(d,"start",f,v,p)}}if(l===this.pointsList.length-1){var y={x:s.x,y:s.y+o.y},h=Ii(y,this.targetNode);if(!h){var v=this.targetNode.anchors;p=this.getDraggingPoints(d,"end",y,v,p)}}this.updatePointsAfterDrag(p),this.draggingPointList=p}else if(d===wn.VERTICAL){c[a]={x:r.x+o.x,y:r.y},c[l]={x:s.x+o.x,y:s.y};var p=this.pointsList.map(function(_){return _});if(a!==0&&l!==this.pointsList.length-1&&(p=this.removeCrossPoints(a,l,p)),a===0){var f={x:r.x+o.x,y:r.y},h=Ii(f,this.sourceNode);if(!h){var v=this.sourceNode.anchors;p=this.getDraggingPoints(d,"start",f,v,p)}}if(l===this.pointsList.length-1){var y={x:s.x+o.x,y:s.y},h=Ii(y,this.targetNode);if(!h){var v=this.targetNode.anchors;p=this.getDraggingPoints(d,"end",y,v,p)}}this.updatePointsAfterDrag(p),this.draggingPointList=p}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(pn({},this.text,this.textPosition)),{start:pn({},c[a]),end:pn({},c[l]),startIndex:a,endIndex:l,direction:d}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=jg(Lr(this.points));this.pointsList=t.map(function(r){return r}),this.draggingPointList=[];var o=t[0];this.startPoint=pn({},o);var i=t[t.length-1];this.endPoint=pn({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var o=this.updateCrossPoints(t);this.points=o.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var o=t.startPoint,i=t.endPoint,r=t.sourceNode,s=t.targetNode;this.pointsList=xh({x:o.x,y:o.y},{x:i.x,y:i.y},r,s,this.offset||0),this.initPoints()},Un([Re],e.prototype,"offset",void 0),Un([Re],e.prototype,"dbClickPosition",void 0),Un([$e],e.prototype,"initPoints",null),Un([$e],e.prototype,"updatePoints",null),Un([$e],e.prototype,"updateStartPoint",null),Un([$e],e.prototype,"moveStartPoint",null),Un([$e],e.prototype,"updateEndPoint",null),Un([$e],e.prototype,"moveEndPoint",null),Un([$e],e.prototype,"updatePointsList",null),Un([$e],e.prototype,"dragAppendStart",null),Un([$e],e.prototype,"dragAppendSimple",null),Un([$e],e.prototype,"dragAppend",null),Un([$e],e.prototype,"dragAppendEnd",null),Un([$e],e.prototype,"updatePointsAfterDrag",null),Un([$e],e.prototype,"getAdjustStart",null),Un([$e],e.prototype,"getAdjustEnd",null),Un([$e],e.prototype,"updateAfterAdjustStartAndEnd",null),e})(Ku),Ln=function(){return Ln=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ln.apply(this,arguments)},At=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Vh=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},jK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},cr=(function(){function n(e,t){var o;this.BaseType=En.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=jo.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=ln.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=Gt.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(o=e.properties)!==null&&o!==void 0?o:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,o=t.x,i=o===void 0?0:o,r=t.y,s=r===void 0?0:r;this.transform=new nu(-i,-s).rotate(e).translate(i,s).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),n.prototype.initNodeData=function(e){var t=this;if(e.properties||(e.properties={}),!e.id){var o=this.graphModel.idGenerator,i=o&&o(e.type),r=this.createId();e.id=r||i||or()}this.formatText(e),pn(this,BJ(e));var s=this.graphModel,a=s.overlapMode,l=s.eventCenter;this.updateZIndexByOverlap(a,e.zIndex||La()),l.on("overlap:change",function(d){var c=d.overlapMode;t.updateZIndexByOverlap(c,t.zIndex||La())})},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,o,i,r=this.graphModel.editConfigModel,s=r.nodeTextDraggable,a=r.nodeTextEdit,l=e.x,d=e.y,c=e.text,p={value:"",x:l,y:d,draggable:s,editable:a};c&&(typeof c=="string"?p.value=c:(p=Ln(Ln({},p),{x:(t=c.x)!==null&&t!==void 0?t:l,y:(o=c.y)!==null&&o!==void 0?o:d,value:(i=c.value)!==null&&i!==void 0?i:""}),ps(c.draggable)||(p.draggable=c.draggable),ps(c.editable)||(p.editable=c.editable))),e.text=p},n.prototype.resize=function(e){var t=e.width,o=e.height,i=e.deltaX,r=e.deltaY,s=this.isAllowResizeNode(i,r,t,o);return s?(this.move(i/2,r/2),this.width=t,this.height=o,this.setProperties({width:t,height:o}),this.getData()):this.getData()},n.prototype.proportionalResize=function(){},n.prototype.getData=function(){var e=this.text,t=e.x,o=e.y,i=e.value,r=this.properties;xs(r)&&(r=Jo(r)),eo(r.width)&&(r.width=this.width),eo(r.height)&&(r.height=this.height);var s={id:this.id,type:this.type,x:this.x,y:this.y,properties:r};return this.rotate&&(s.rotate=this.rotate),[jn.INCREASE,jn.STATIC].includes(this.graphModel.overlapMode)&&(s.zIndex=this.zIndex),i&&(s.text={x:t,y:o,value:i}),s},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.getProperties=function(){return Jo(this.properties)},n.prototype.getOuterGAttributes=function(){return{className:""}},n.prototype.getNodeStyle=function(){return Ln(Ln({},this.graphModel.theme.baseNode),this.style)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,o=t===void 0?{}:t;return Ln(Ln({},Dt(e)),Dt(o))},n.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return Dt(e)},n.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return Dt(e)},n.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return Dt(e)},n.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return Dt(t)},n.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return Dt(t)},n.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return Dt(e)},n.prototype.isAllowConnectedAsSource=function(e,t,o,i){var r=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var s=!0,a="",l=0;l<r.length;l++){var d=r[l];if(!d.validate.call(this,this,e,t,o,i)){s=!1,a=d.message;break}}return{isAllPass:s,msg:a}},n.prototype.getConnectedSourceRules=function(){return this.sourceRules},n.prototype.isAllowConnectedAsTarget=function(e,t,o,i){var r=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var s=!0,a="",l=0;l<r.length;l++){var d=r[l];if(!d.validate.call(this,e,this,t,o,i)){s=!1,a=d.message;break}}return{isAllPass:s,msg:a}},n.prototype.isAllowMoveNode=function(e,t){var o,i,r=!0,s=!0,a=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var l=Vh(a),d=l.next();!d.done;d=l.next()){var c=d.value,p=c(this,e,t);if(!p)return!1;if(typeof p=="object"){var f=p;if(!f.x&&!f.y)return!1;r=r&&f.x,s=s&&f.y}}}catch(h){o={error:h}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}return{x:r,y:s}},n.prototype.getConnectedTargetRules=function(){return this.targetRules},n.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,o=e.id,i=e.x,r=e.y;return t&&t.length>0?t.map(function(s,a){return s.length?(s=s,{id:"".concat(o,"_").concat(a),x:i+s[0],y:r+s[1]}):(s=s,Ln(Ln({},s),{x:i+s.x,y:r+s.y,id:s.id||"".concat(o,"_").concat(a)}))}):this.getDefaultAnchor()},n.prototype.getDefaultAnchor=function(){return[]},n.prototype.getTargetAnchor=function(e){return RJ(e,this)},n.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(n.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,o=t.x,i=t.y,r=t.rotate;return e.forEach(function(s){var a=s.x,l=s.y,d=jK(new Qa([a,l,1]).translate(-o,-i).rotate(r).translate(o,i)[0],2),c=d[0],p=d[1];s.x=c,s.y=p}),e},enumerable:!1,configurable:!0}),n.prototype.getAnchorInfo=function(e){if(!eo(e))for(var t=0;t<this.anchors.length;t++){var o=this.anchors[t];if(o.id===e)return o}},n.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},n.prototype.isAllowMoveByXORY=function(e,t,o){var i,r;if(o)i=!0,r=!0;else{var s=this.isAllowMoveNode(e,t);typeof s=="boolean"?(i=s,r=s):(i=s.x,r=s.y)}return{isAllowMoveX:i,isAllowMoveY:r}},n.prototype.move=function(e,t,o){o===void 0&&(o=!1);var i=this.isAllowMoveByXORY(e,t,o),r=i.isAllowMoveX,s=i.isAllowMoveY;return r&&(this.x=this.x+e,this.text&&this.moveText(e,0)),s&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(r||s)&&(this.rotate=this._rotate),r||s},n.prototype.getMoveDistance=function(e,t,o){o===void 0&&(o=!1);var i=this.isAllowMoveByXORY(e,t,o),r=i.isAllowMoveX,s=i.isAllowMoveY,a=0,l=0;return r&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),a=e),s&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),l=t),this.transform=new nu(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[a,l]},n.prototype.moveTo=function(e,t,o){o===void 0&&(o=!1);var i=e-this.x,r=t-this.y;return!o&&!this.isAllowMoveNode(i,r)?!1:(this.text&&this.moveText(i,r),this.x=e,this.y=t,!0)},n.prototype.moveText=function(e,t){var o=this.text,i=o.x,r=o.y,s=o.value,a=o.draggable,l=o.editable;this.text={value:s,editable:l,draggable:a,x:i+e,y:r+t}},n.prototype.updateText=function(e){this.text=Ln(Ln({},Jo(this.text)),{value:e})},n.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},n.prototype.isAllowResizeNode=function(e,t,o,i){var r,s,a=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var l=Vh(a),d=l.next();!d.done;d=l.next()){var c=d.value,p=c(this,e,t,o,i);if(!p)return!1}}catch(f){r={error:f}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(r)throw r.error}}return!0},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},n.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},n.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},n.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateProperties=function(e,t){var o=Jo(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(_t.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:o,properties:e})},n.prototype.setProperty=function(e,t){var o=Jo(this.properties),i=Dt(o);gy(i,e,Qn(t)),this.updateProperties(i,[e])},n.prototype.setProperties=function(e){var t=Jo(this.properties),o=Ln(Ln({},t),Qn(e)),i=[];my(e,function(r,s){(ma(t,s)&&t[s]!==r||!ma(t,s))&&i.push(s)}),this.updateProperties(o,i)},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setStyle=function(e,t){var o;this.style=Ln(Ln({},this.style),(o={},o[e]=Qn(t),o))},n.prototype.setStyles=function(e){this.style=Ln(Ln({},this.style),Qn(e))},n.prototype.updateStyles=function(e){this.style=Ln({},Qn(e))},n.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},n.prototype.updateAttributes=function(e){pn(this,e)},n.prototype.updateZIndexByOverlap=function(e,t){switch(e){case jn.DEFAULT:this.zIndex=1;break;case jn.EDGE_TOP:this.zIndex=0;break;case jn.INCREASE:this.zIndex=t;break}},n.BaseType=En.NODE,At([Re],n.prototype,"type",void 0),At([Re],n.prototype,"x",void 0),At([Re],n.prototype,"y",void 0),At([Re],n.prototype,"textMode",void 0),At([Re],n.prototype,"text",void 0),At([Re],n.prototype,"properties",void 0),At([Re],n.prototype,"_width",void 0),At([Re],n.prototype,"_height",void 0),At([Re],n.prototype,"anchorsOffset",void 0),At([Re],n.prototype,"isSelected",void 0),At([Re],n.prototype,"isHovered",void 0),At([Re],n.prototype,"isShowAnchor",void 0),At([Re],n.prototype,"isDragging",void 0),At([Re],n.prototype,"isHitable",void 0),At([Re],n.prototype,"isHittable",void 0),At([Re],n.prototype,"draggable",void 0),At([Re],n.prototype,"visible",void 0),At([Re],n.prototype,"rotatable",void 0),At([Re],n.prototype,"resizable",void 0),At([Re],n.prototype,"zIndex",void 0),At([Re],n.prototype,"state",void 0),At([Re],n.prototype,"autoToFront",void 0),At([Re],n.prototype,"style",void 0),At([Re],n.prototype,"transform",void 0),At([Re],n.prototype,"_rotate",void 0),At([bn],n.prototype,"incoming",null),At([bn],n.prototype,"outgoing",null),At([$e],n.prototype,"setTextMode",null),At([$e],n.prototype,"addNodeMoveRules",null),At([$e],n.prototype,"move",null),At([$e],n.prototype,"getMoveDistance",null),At([$e],n.prototype,"moveTo",null),At([$e],n.prototype,"moveText",null),At([$e],n.prototype,"updateText",null),At([$e],n.prototype,"addNodeResizeRules",null),At([$e],n.prototype,"setSelected",null),At([$e],n.prototype,"setHovered",null),At([$e],n.prototype,"setIsShowAnchor",null),At([$e],n.prototype,"setRotatable",null),At([$e],n.prototype,"setResizable",null),At([$e],n.prototype,"setHitable",null),At([$e],n.prototype,"setHittable",null),At([$e],n.prototype,"setElementState",null),At([$e],n.prototype,"setProperty",null),At([$e],n.prototype,"setProperties",null),At([$e],n.prototype,"deleteProperty",null),At([$e],n.prototype,"setStyle",null),At([$e],n.prototype,"setStyles",null),At([$e],n.prototype,"updateStyles",null),At([$e],n.prototype,"setZIndex",null),At([$e],n.prototype,"updateAttributes",null),At([$e],n.prototype,"updateZIndexByOverlap",null),n})(),FK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),sa=function(){return sa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},sa.apply(this,arguments)},md=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},lu=(function(n){FK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.circle,i=this.properties.style,r=i===void 0?{}:i;return sa(sa(sa({},t),Dt(o)),Dt(r))},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.r;return[{x:o,y:i-r,id:"".concat(this.id,"_0")},{x:o+r,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+r,id:"".concat(this.id,"_2")},{x:o-r,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var o=t.width,i=t.deltaX,r=t.deltaY;return this.move(i/2,r/2),this.r=o,this.setProperties({r:o}),this.getData()},md([Re],e.prototype,"r",void 0),md([bn],e.prototype,"width",null),md([bn],e.prototype,"height",null),e})(cr),VK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),aa=function(){return aa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},aa.apply(this,arguments)},Yr=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},gl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},yc=(function(n){VK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.rx,i=t.ry;o&&(this.rx=o),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.diamond,i=this.properties.style,r=i===void 0?{}:i;return aa(aa(aa({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,o=t.x,i=t.y,r=t.rx,s=t.ry;return[[o,i-s],[o+r,i],[o,i+s],[o-r,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return si(this.points,function(t){var o=gl(t,2),i=o[0],r=o[1];return{x:i,y:r}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return Vt(this.points,function(i){var r=gl(i,1),s=r[0];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return Vt(this.points,function(i){var r=gl(i,2),s=r[1];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return si(this.points,function(o,i){var r=gl(o,2),s=r[0],a=r[1];return{x:s,y:a,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var o=t.width,i=t.height,r=t.deltaX,s=t.deltaY;return this.move(r/2,s/2),this.rx=o,this.ry=i,this.setProperties({rx:o,ry:i}),this.getData()},Yr([Re],e.prototype,"rx",void 0),Yr([Re],e.prototype,"ry",void 0),Yr([bn],e.prototype,"points",null),Yr([bn],e.prototype,"pointsPosition",null),Yr([bn],e.prototype,"width",null),Yr([bn],e.prototype,"height",null),e})(cr),HK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),la=function(){return la=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},la.apply(this,arguments)},ml=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},bc=(function(n){HK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.rx,i=t.ry;o&&(this.rx=o),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.ellipse,i=this.properties.style,r=i===void 0?{}:i;return la(la(la({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.rx,s=t.ry;return[{x:o,y:i-s,id:"".concat(this.id,"_0")},{x:o+r,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s,id:"".concat(this.id,"_2")},{x:o-r,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var o=t.width,i=t.height,r=t.deltaX,s=t.deltaY;return this.move(r/2,s/2),this.rx=o,this.ry=i,this.setProperties({rx:o,ry:i}),this.getData()},ml([Re],e.prototype,"rx",void 0),ml([Re],e.prototype,"ry",void 0),ml([bn],e.prototype,"width",null),ml([bn],e.prototype,"height",null),e})(cr),UK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ua=function(){return ua=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ua.apply(this,arguments)},yl=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},bl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},uu=(function(n){UK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.points,i=t.width,r=t.height,s=o||this.points;this.points=OJ(s,i,r)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.polygon,i=this.properties.style,r=i===void 0?{}:i;return ua(ua(ua({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return this.points.map(function(a){return{x:a[0]+o-r/2,y:a[1]+i-s/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var r=bl(i,1),s=r[0];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var r=bl(i,2),s=r[1];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,o=this,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points;return l.map(function(d,c){var p=bl(d,2),f=p[0],h=p[1];return{x:i+f-s/2,y:r+h-a/2,id:"".concat(t.id,"_").concat(c)}})},e.prototype.resize=function(t){var o=this,i=t.width,r=t.height,s=t.deltaX,a=t.deltaY;this.move(s/2,a/2);var l=si(this.points,function(d){var c=bl(d,2),p=c[0],f=c[1];return[p*i/o.width,f*r/o.height]});return this.points=l,this.properties.points=l,this.getData()},yl([Re],e.prototype,"points",void 0),yl([bn],e.prototype,"pointsPosition",null),yl([bn],e.prototype,"width",null),yl([bn],e.prototype,"height",null),e})(cr),zK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),da=function(){return da=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},da.apply(this,arguments)},qK=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},As=(function(n){zK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.width,i=t.height,r=t.radius,s=this.getNodeStyle().radius;eo(o)||(this.width=o),eo(i)||(this.height=i),eo(r)||(this.radius=r),eo(s)||(this.radius=s)},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return[{x:o,y:i-s/2,id:"".concat(this.id,"_0")},{x:o+r/2,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s/2,id:"".concat(this.id,"_2")},{x:o-r/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.rect,i=this.properties.style,r=i===void 0?{}:i;return da(da(da({},t),Dt(o)),Dt(r))},qK([Re],e.prototype,"radius",void 0),e})(cr),GK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ca=function(){return ca=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ca.apply(this,arguments)},Hh=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},XK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},WK=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Uh=(function(n){GK(e,n);function e(){var t=n.apply(this,WK([],XK(arguments),!1))||this;return t.modelType=Gt.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=n.prototype.getTextStyle.call(this),o=this.graphModel.theme.text,i=this.properties.textStyle;return ca(ca(ca({},t),Dt(o)),Dt(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),o=this.getTextStyle().fontSize,i=Rh({rows:t,fontSize:o,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),o=this.getTextStyle().fontSize,i=Rh({rows:t,fontSize:o,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),Hh([bn],e.prototype,"width",null),Hh([bn],e.prototype,"height",null),e})(cr),YK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ba=(function(n){YK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=Gt.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.width,i=t.height;o&&(this.width=o),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return[{x:o,y:i-s/2,id:"".concat(this.id,"_0")},{x:o+r/2,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s/2,id:"".concat(this.id,"_2")},{x:o-r/2,y:i,id:"".concat(this.id,"_3")}]},e})(cr),dn=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},JK={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},xl=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical","isPinching"],KK=(function(){function n(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.isPinching=!1,this.textMode=jo.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=jo.TEXT,this.edgeTextMode=jo.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",pn(this,this.computeConfig(e))}return n.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);pn(this,t)},n.prototype.computeConfig=function(e){var t=e.isSilentMode,o=e.textDraggable,i=e.textMode,r=e.textEdit,s=e.adjustEdgeStartAndEnd,a={};if(t===!1&&pn(a,this.stagedConfig),t===!0&&t!==this.isSilentMode){var l=ns(JK,xl);this.stagedConfig=ns(this,xl),pn(a,l)}ps(r)||pn(a,{nodeTextEdit:r,edgeTextEdit:r}),ps(o)||pn(a,{nodeTextDraggable:o,edgeTextDraggable:o}),i&&pn(a,{nodeTextMode:i,edgeTextMode:i}),Bd(s)&&pn(a,{adjustEdgeStart:s,adjustEdgeEnd:s});var d=ns(e,xl);return pn(a,d)},n.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},n.prototype.getConfig=function(){return ns(this,xl)},dn([Re],n.prototype,"isSilentMode",void 0),dn([Re],n.prototype,"stopZoomGraph",void 0),dn([Re],n.prototype,"stopMoveGraph",void 0),dn([Re],n.prototype,"stopScrollGraph",void 0),dn([Re],n.prototype,"snapGrid",void 0),dn([Re],n.prototype,"isPinching",void 0),dn([Re],n.prototype,"textMode",void 0),dn([Re],n.prototype,"textEdit",void 0),dn([Re],n.prototype,"textDraggable",void 0),dn([Re],n.prototype,"nodeTextEdit",void 0),dn([Re],n.prototype,"nodeTextDraggable",void 0),dn([Re],n.prototype,"nodeTextMultiple",void 0),dn([Re],n.prototype,"nodeTextVertical",void 0),dn([Re],n.prototype,"nodeTextMode",void 0),dn([Re],n.prototype,"edgeTextMode",void 0),dn([Re],n.prototype,"edgeTextEdit",void 0),dn([Re],n.prototype,"edgeTextDraggable",void 0),dn([Re],n.prototype,"edgeTextMultiple",void 0),dn([Re],n.prototype,"edgeTextVertical",void 0),dn([Re],n.prototype,"hideAnchors",void 0),dn([Re],n.prototype,"allowRotate",void 0),dn([Re],n.prototype,"allowResize",void 0),dn([Re],n.prototype,"hoverOutline",void 0),dn([Re],n.prototype,"nodeSelectedOutline",void 0),dn([Re],n.prototype,"adjustNodePosition",void 0),dn([Re],n.prototype,"autoExpand",void 0),dn([Re],n.prototype,"adjustEdge",void 0),dn([Re],n.prototype,"adjustEdgeMiddle",void 0),dn([Re],n.prototype,"adjustEdgeStartAndEnd",void 0),dn([Re],n.prototype,"adjustEdgeStart",void 0),dn([Re],n.prototype,"adjustEdgeEnd",void 0),dn([Re],n.prototype,"edgeSelectedOutline",void 0),dn([$e],n.prototype,"updateEditConfig",null),dn([$e],n.prototype,"updateTextMode",null),n})(),ZK="*",QK=(function(){function n(){this._events={}}return n.prototype.on=function(e,t,o){var i=this;e==null||e.split(",").forEach(function(r){r=r.trim(),i._events[r]||(i._events[r]=[]),i._events[r].push({callback:t,once:!!o})})},n.prototype.once=function(e,t){var o=this;e==null||e.split(",").forEach(function(i){i=i.trim(),o.on(i,t,!0)})},n.prototype.emit=function(e,t){var o=this;e==null||e.split(",").forEach(function(i){var r=o._events[i]||[],s=o._events[ZK]||[],a=function(l){for(var d=l.length,c=0;c<d;c++)if(l[c]){var p=l[c],f=p.callback,h=p.once;h&&(l.splice(c,1),l.length===0&&delete o._events[i],d--,c--),f.apply(o,[t])}};a(r),a(s)})},n.prototype.off=function(e,t){var o=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete o._events[i];else{for(var r=o._events[i]||[],s=r.length,a=0;a<s;a++)r[a].callback===t&&(r.splice(a,1),s--,a--);r.length===0&&delete o._events[i]}})},n.prototype.getEvents=function(){return this._events},n.prototype.destroy=function(){this._events={}},n})(),eZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),tZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},nZ=(function(n){eZ(e,n);function e(t){var o=n.call(this)||this;o.stepScrollX=0,o.stepScrollY=0,o.pointers=new Map,o.onDragging=function(a){var l=a.deltaX,d=a.deltaY;o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0),o.setState({isDragging:!0});var c=o.props.graphModel,p=c.transformModel,f=c.editConfigModel;f.stopMoveGraph!==!0&&p.translate(l,d)},o.onDragEnd=function(){o.setState({isDragging:!1})},o.zoomHandler=function(a){var l=o.props,d=l.graphModel,c=d.editConfigModel,p=d.transformModel,f=d.gridSize,h=l.graphModel,v=a.deltaX,y=a.deltaY,g=c.stopScrollGraph,_=c.stopZoomGraph;if(!g&&!a.ctrlKey&&!a.metaKey){if(a.preventDefault(),o.stepScrollX+=v,o.stepScrollY+=y,Math.abs(o.stepScrollX)>=f){var b=o.stepScrollX%f,C=o.stepScrollX-b;p.translate(-C*p.SCALE_X,0),o.stepScrollX=b}if(Math.abs(o.stepScrollY)>=f){var T=o.stepScrollY%f,M=o.stepScrollY-T;p.translate(0,-M*p.SCALE_Y),o.stepScrollY=T}return}if(!_){a.preventDefault();var S=h.getPointByClient({x:a.clientX,y:a.clientY}),k=S.canvasOverlayPosition,A=k.x,$=k.y;p.zoom(a.deltaY<0,[A,$])}},o.clickHandler=function(a){var l=a.target;if(l.getAttribute("name")==="canvas-overlay"){var d=o.props.graphModel,c=d.selectElements;c.size>0&&d.clearSelectElements(),d.eventCenter.emit(_t.BLANK_CLICK,{e:a})}},o.handleContextMenu=function(a){var l=a.target;if(l.getAttribute("name")==="canvas-overlay"){a.preventDefault();var d=o.props.graphModel,c=d.getPointByClient({x:a.clientX,y:a.clientY});d.eventCenter.emit(_t.BLANK_CONTEXTMENU,{e:a,position:c})}},o.pointerDownHandler=function(a){var l=o.props.graphModel,d=l.eventCenter,c=l.editConfigModel,p=l.transformModel.SCALE_X,f=l.gridSize;if(o.pointers.set(a.pointerId,{x:a.clientX,y:a.clientY}),o.longPressTimer&&clearTimeout(o.longPressTimer),a.pointerType==="touch"&&(o.longPressTimer=window.setTimeout(function(){o.handleContextMenu(a)},500)),o.pointers.size===2){var h=o.props.graphModel,v=h.transformModel,y=h.editConfigModel,g=Array.from(o.pointers.values()),_=g[0].x-g[1].x,b=g[0].y-g[1].y,C=(g[0].x+g[1].x)/2,T=(g[0].y+g[1].y)/2;o.pinchStartDistance=Math.hypot(_,b),o.pinchStartScale=v.SCALE_X,o.stepDrag.cancelDrag(),o.pinchLastCenterX=C,o.pinchLastCenterY=T,y.updateEditConfig({isPinching:!0});return}var M=c.adjustEdge,S=c.adjustNodePosition,k=c.stopMoveGraph,A=a.target,$=!M&&!S;(A.getAttribute("name")==="canvas-overlay"||$)&&(k!==!0?(o.stepDrag.setStep(f*p),o.stepDrag.handleMouseDown(a)):d.emit(_t.BLANK_MOUSEDOWN,{e:a}),o.clickHandler(a))},o.pointerMoveHandler=function(a){var l;if(o.pointers.set(a.pointerId,{x:a.clientX,y:a.clientY}),o.pinchStartDistance&&o.pointers.size>=2){var d=o.props,c=d.graphModel,p=d.graphModel,f=p.editConfigModel,h=p.transformModel;if(f.stopZoomGraph)return;o.longPressTimer&&clearTimeout(o.longPressTimer);var v=Array.from(o.pointers.values()),y=v[0].x-v[1].x,g=v[0].y-v[1].y,_=Math.hypot(y,g),b=((l=o.pinchStartScale)!==null&&l!==void 0?l:h.SCALE_X)*(_/o.pinchStartDistance),C=(v[0].x+v[1].x)/2,T=(v[0].y+v[1].y)/2,M=c.getPointByClient({x:C,y:T}),S=M.canvasOverlayPosition,k=S.x,A=S.y;if(h.zoom(b,[k,A]),!f.stopMoveGraph||f.isPinching){var $=o.pinchLastCenterX===void 0?0:C-o.pinchLastCenterX,B=o.pinchLastCenterY===void 0?0:T-o.pinchLastCenterY;h.translate($,B),o.pinchLastCenterX=C,o.pinchLastCenterY=T}a.preventDefault()}},o.pointerUpHandler=function(a){if(o.pointers.delete(a.pointerId),o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0),o.pointers.size<2){o.pinchStartDistance=void 0,o.pinchStartScale=void 0,o.pinchLastCenterX=void 0,o.pinchLastCenterY=void 0;var l=o.props.graphModel.editConfigModel;l.updateEditConfig({isPinching:!1})}};var i=t.graphModel,r=i.gridSize,s=i.eventCenter;return o.stepDrag=new zo({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"BLANK",isStopPropagation:!1,eventCenter:s,model:void 0}),o.state={isDragging:!1},o}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,o=t.getTransformStyle().transform,i=this.props.children,r=this.state.isDragging;return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onPointerDown:this.pointerDownHandler,onPointerMove:this.pointerMoveHandler,onPointerUp:this.pointerUpHandler,onPointerCancel:this.pointerUpHandler,onContextMenu:this.handleContextMenu,style:{touchAction:"none",WebkitUserSelect:"none"},className:r?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able",children:Pe("g",{transform:o,children:i})})},e=tZ([no],e),e})(Kt),Kg=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ia=function(){return Ia=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ia.apply(this,arguments)},oZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},iZ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},zh=(function(n){Kg(e,n);function e(){var t=n.call(this)||this;return t.onDragging=function(o){var i=o.event,r=t.props,s=r.graphModel,a=r.bezierModel,l=r.type,d=s.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,c=d.x,p=d.y;a.updateAdjustAnchor({x:c,y:p},l),s.eventCenter.emit(_t.EDGE_ADJUST,{data:a.getData()})},t.onDragEnd=function(){var o=t.props.bezierModel;o.isDragging=!1},t.dragHandler=new zo({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,o=this.props.position,i=o.x,r=o.y,s=this.props.bezierModel,a=s.getEdgeStyle().adjustAnchor;return Pe(Ss,Ia({className:"lf-bezier-adjust-anchor",x:i,y:r},a,{onPointerDown:function(l){t.dragHandler.handleMouseDown(l)}}))},e})(Kt),rZ=(function(n){Kg(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,o){var i=t.path,r=t.id,s=Ep(i),a=iZ(s,4),l=a[0],d=a[1],c=a[2],p=a[3],f=t.getEdgeStyle().adjustLine,h=[];return h.push(Pe(ks,Ia({x1:l.x,y1:l.y,x2:d.x,y2:d.y},f))),h.push(Pe(zh,{position:d,bezierModel:t,graphModel:o,type:"sNext"},"".concat(r,"_ePre"))),h.push(Pe(ks,Ia({x1:p.x,y1:p.y,x2:c.x,y2:c.y},f))),h.push(Pe(zh,{position:c,bezierModel:t,graphModel:o,type:"ePre"},"".concat(r,"_sNext"))),h},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,o=t.edges,i=[],r=0;r<o.length;r++){var s=o[r];s.isSelected&&s.modelType===Gt.BEZIER_EDGE&&s.draggable&&i.push(this.getBezierAdjust(s,t))}return i},e.prototype.render=function(){return Pe("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=oZ([no],e),e})(Kt),sZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),aZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},lZ=(function(n){sZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return Pe("div",{className:"lf-background",children:Pe("div",{style:yy(t)?t:{},className:"lf-background-area"})})},e=aZ([no],e),e})(Kt),uZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),dZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},ds=(function(n){uZ(e,n);function e(t){var o=n.call(this,t)||this;return o.id=or(),o.gridOptions=o.props.graphModel.grid,o}return e.prototype.renderDot=function(){var t=this.gridOptions,o=t.config,i=t.size,r=i===void 0?1:i,s=t.visible,a=o??{},l=a.color,d=a.thickness,c=d===void 0?2:d,p=Math.min(Math.max(2,c),r/4),f=s?1:0;return Pe("g",{fill:l,opacity:f,children:[Pe("circle",{cx:0,cy:0,r:p/2}),Pe("circle",{cx:0,cy:r,r:p/2}),Pe("circle",{cx:r,cy:0,r:p/2}),Pe("circle",{cx:r,cy:r,r:p/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,o=t.config,i=t.size,r=i===void 0?1:i,s=t.visible,a=o??{},l=a.color,d=a.thickness,c=d===void 0?1:d,p=Math.min(Math.max(1,c),r/2),f="M 0 0 H ".concat(r," V ").concat(r," H 0 Z"),h=s?1:0;return Pe("path",{d:f,stroke:l,strokeWidth:p/2,opacity:h,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,o=t.transformModel,i=t.grid;this.gridOptions=i;var r=this.gridOptions,s=r.type,a=r.size,l=a===void 0?1:a,d=o.SCALE_X,c=o.SKEW_Y,p=o.SKEW_X,f=o.SCALE_Y,h=o.TRANSLATE_X,v=o.TRANSLATE_Y,y=[d,c,p,f,h,v].join(","),g="matrix(".concat(y,")");return Pe("div",{className:"lf-grid",children:Pe("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[Pe("defs",{children:Pe("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:g,x:"0",y:"0",width:l,height:l,children:[s==="dot"&&this.renderDot(),s==="mesh"&&this.renderMesh()]})}),Pe("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=dZ([no],e),e})(Kt);(function(n){n.defaultProps={size:sJ,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var o=Dt(n.defaultProps);return typeof t=="number"?pn(o,{size:t}):typeof t=="boolean"?pn(o,{visible:t}):pn(o,t)}n.getGridOptions=e})(ds||(ds={}));var cZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),pZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},fZ=(function(n){cZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,o=t.getTransformStyle().transform,i=this.props.children;return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:Pe("g",{transform:o,children:i})})},e=pZ([no],e),e})(Kt),hZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Wi=function(){return Wi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Wi.apply(this,arguments)},vZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},_Z=(function(n){hZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,o=t.nodes,i=t.editConfigModel,r=i.hoverOutline,s=i.nodeSelectedOutline,a=[];return o.forEach(function(l){if(l.isHovered||l.isSelected){var d=l.isHovered,c=l.isSelected,p=l.x,f=l.y,h=l.width,v=l.height;if(s&&c||r&&d){var y=l.getOutlineStyle(),g={};if(Object.keys(y).forEach(function(b){b!=="hover"&&(g[b]=y[b])}),d){var _=y.hover;g=Wi(Wi({},g),_)}a.push(Pe(Ro,Wi({transform:l.transform,className:"lf-outline-node",x:p,y:f,width:h+10,height:v+10},g)))}}}),a},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,o=t.edges,i=t.editConfigModel,r=i.edgeSelectedOutline,s=i.hoverOutline,a=[],l=0;l<o.length;l++){var d=o[l];(r&&d.isSelected||s&&d.isHovered)&&(d.modelType===Gt.LINE_EDGE?a.push(this.getLineOutline(d)):d.modelType===Gt.POLYLINE_EDGE?a.push(this.getPolylineOutline(d)):d.modelType===Gt.BEZIER_EDGE&&a.push(this.getBezierOutline(d)))}return a},e.prototype.getLineOutline=function(t){var o=t.startPoint,i=t.endPoint,r=(o.x+i.x)/2,s=(o.y+i.y)/2,a=Math.abs(o.x-i.x)+10,l=Math.abs(o.y-i.y)+10,d=t.getOutlineStyle();return Pe(Ro,Wi({className:"lf-outline-edge",x:r,y:s,width:a,height:l},d))},e.prototype.getPolylineOutline=function(t){var o=t.points,i=Lr(o),r=Oa(i,8),s=r.x,a=r.y,l=r.width,d=r.height,c=t.getOutlineStyle();return Pe(Ro,Wi({className:"lf-outline",x:s,y:a,width:l,height:d},c))},e.prototype.getBezierOutline=function(t){var o=t.path,i=Ep(o),r=Oa(i,8),s=r.x,a=r.y,l=r.width,d=r.height,c=t.getOutlineStyle();return Pe(Ro,Wi({className:"lf-outline",x:s,y:a,width:l,height:d},c))},e.prototype.render=function(){return Pe("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=vZ([no],e),e})(Kt),gZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Yi=function(){return Yi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Yi.apply(this,arguments)},mZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},yZ=(function(n){gZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,o=t??{},i=o.position,r=o.isShowHorizontal,s=o.isShowVertical,a=t==null?void 0:t.getStyle(),l=i??{},d=l.x,c=d===void 0?0:d,p=l.y,f=p===void 0?0:p,h=Yi(Yi({x1:-1e5,y1:f,x2:1e5,y2:f},a),{stroke:r?a==null?void 0:a.stroke:"none"}),v=Yi(Yi({x1:c,y1:-1e5,x2:c,y2:1e5},a),{stroke:s?a==null?void 0:a.stroke:"none"});return Pe("g",{className:"lf-snapline",children:[Pe(ks,Yi({},h)),Pe(ks,Yi({},v))]})},e=mZ([no],e),e})(Kt),bZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},wZ=(function(n){bZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,o=t.tool,i=t.graphModel,r=i.textEditElement,s=o.getTools(),a=s.map(function(l){return et(l,{textEditElement:r,graphModel:i,lf:o.instance})});return o.components=a,a},e.prototype.triggerToolRender=function(){var t=this.props,o=t.tool,i=t.graphModel,r=document.querySelector("#ToolOverlay_".concat(i.flowId)),s=o.getInstance();s.components.forEach(function(a){return a(s,r)}),s.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return Pe("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=xZ([no],e),e})(Kt),Go=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Jr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},CZ={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},kZ=(function(){function n(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var o=t.stopMoveGraph,i=o===void 0?!1:o;this.updateTranslateLimits(i)}return n.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},n.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},n.prototype.HtmlPointToCanvasPoint=function(e){var t=Jr(e,2),o=t[0],i=t[1];return[(o-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},n.prototype.CanvasPointToHtmlPoint=function(e){var t=Jr(e,2),o=t[0],i=t[1];return[o*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},n.prototype.moveCanvasPointByHtml=function(e,t,o){var i=Jr(e,2),r=i[0],s=i[1];return[r+t/this.SCALE_X,s+o/this.SCALE_Y]},n.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},n.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},n.prototype.zoom=function(e,t){e===void 0&&(e=!1);var o=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(o=e,i=e):e?(o+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(o-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),o<this.MINI_SCALE_SIZE||o>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(o-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=o,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},n.prototype.emitGraphTransform=function(e){this.eventCenter.emit(_t.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},n.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},n.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},n.prototype.focusOn=function(e,t,o,i){var r=Jr(this.CanvasPointToHtmlPoint([e,t]),2),s=r[0],a=r[1],l=Jr([o/2-s,i/2-a],2),d=l[0],c=l[1];this.TRANSLATE_X+=d,this.TRANSLATE_Y+=c,this.emitGraphTransform("focusOn")},n.prototype.updateTranslateLimits=function(e){var t;t=Jr(Array.isArray(e)&&e.length===4?e:CZ[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},Go([Re],n.prototype,"SCALE_X",void 0),Go([Re],n.prototype,"SKEW_Y",void 0),Go([Re],n.prototype,"SKEW_X",void 0),Go([Re],n.prototype,"SCALE_Y",void 0),Go([Re],n.prototype,"TRANSLATE_X",void 0),Go([Re],n.prototype,"TRANSLATE_Y",void 0),Go([Re],n.prototype,"ZOOM_SIZE",void 0),Go([$e],n.prototype,"zoom",null),Go([$e],n.prototype,"resetZoom",null),Go([$e],n.prototype,"translate",null),Go([$e],n.prototype,"focusOn",null),n})(),SZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),yd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},EZ=(function(n){SZ(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.parentTransform=o.parentTransform,i}return e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,o=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale();t*=i.scaleX,o*=i.scaleY}else t*=this.parentTransform.SCALE_X,o*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:o}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,o=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale(),r=i.scaleX,s=i.scaleY;t=r*t,o=s*o}return{translateX:t,translateY:o}},e.prototype.HtmlPointToCanvasPoint=function(t){var o=yd(t,2),i=o[0],r=o[1],s=this.getCumulativeScale(),a=s.scaleX,l=s.scaleY,d=this.getCumulativeTranslate(),c=d.translateX,p=d.translateY;return[(i-c)/a,(r-p)/l]},e.prototype.CanvasPointToHtmlPoint=function(t){var o=yd(t,2),i=o[0],r=o[1],s=this.getCumulativeScale(),a=s.scaleX,l=s.scaleY,d=this.getCumulativeTranslate(),c=d.translateX,p=d.translateY;return[i*a+c,r*l+p]},e.prototype.moveCanvasPointByHtml=function(t,o,i){var r=yd(t,2),s=r[0],a=r[1],l=this.getCumulativeScale(),d=l.scaleX,c=l.scaleY;return[s+o/d,a+i/c]},e.prototype.fixDeltaXY=function(t,o){var i=this.getCumulativeScale(),r=i.scaleX,s=i.scaleY;return[t/r,o/s]},e})(kZ),Jn=function(){return Jn=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Jn.apply(this,arguments)},gt=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},AZ=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Pn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},mo=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},DZ=(function(){function n(e){var t=this,o,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=jn.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var r=e.container,s=e.partial,a=e.background,l=a===void 0?{}:a,d=e.grid,c=e.idGenerator,p=e.edgeGenerator,f=e.animation,h=e.customTrajectory;this.rootEl=r,this.partial=!!s,this.background=l,typeof d=="object"&&e.snapGrid&&(this.gridSize=d.size||1),this.customStyles=e.style||{},this.grid=ds.getGridOptions(d??!1),this.theme=Jg(e.style,e.themeMode),this.theme.grid=Dt(this.grid),this.theme.background=Dt(this.background),this.edgeType=e.edgeType||"polyline",this.animation=oJ(f),this.overlapMode=e.overlapMode||jn.DEFAULT,this.isMiniMap=e.isMiniMap||!1,this.width=(o=e.width)!==null&&o!==void 0?o:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=eo(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=eo(e.height);var v=new ResizeObserver(u_((function(y){var g,_;try{for(var b=AZ(y),C=b.next();!C.done;C=b.next()){var T=C.value;T.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:T.contentRect}))}}catch(M){g={error:M}}finally{try{C&&!C.done&&(_=b.return)&&_.call(b)}finally{if(g)throw g.error}}}),16));v.observe(this.rootEl),this.waitCleanEffects.push(function(){v.disconnect()}),this.eventCenter=new QK,this.editConfigModel=new KK(e),this.transformModel=new EZ(this.eventCenter,e),this.flowId=or(),this.idGenerator=c,this.edgeGenerator=AJ(this,p),this.customTrajectory=h}return Object.defineProperty(n.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,o){return e[t.id]={index:o,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,o){return e[t.id]={index:o,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelsMap",{get:function(){return mo(mo([],Pn(this.nodes),!1),Pn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortElements",{get:function(){for(var e=function(l){return mo([],Pn(l),!1).sort(function(d,c){return d.zIndex-c.zIndex})},t=e(mo(mo([],Pn(this.nodes),!1),Pn(this.edges),!1)),o=[],i=[-cl,-cl],r=[this.width+cl,this.height+cl],s=0;s<t.length;s++){var a=t[s];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,i,r,!1,!1))&&o.push(a)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(o){return o.state===ln.TEXT_EDIT}),t=this.edges.find(function(o){return o.state===ln.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),n.prototype.getAreaElement=function(e,t,o,i,r){var s=this;o===void 0&&(o=!0),i===void 0&&(i=!0),r===void 0&&(r=!1);var a=[];return Vt(mo(mo([],Pn(this.nodes),!1),Pn(this.edges),!1),function(l){var d=s.isElementInArea(l,e,t,o,i);(!r||l.visible)&&d&&a.push(l)}),a},n.prototype.getModel=function(e){return this.modelMap.get(e)},n.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getPointByClient=function(e){var t=e.x,o=e.y,i=this.rootEl.getBoundingClientRect(),r={x:t-i.left,y:o-i.top},s=Pn(this.transformModel.HtmlPointToCanvasPoint([r.x,r.y]),2),a=s[0],l=s[1],d={x:a,y:l};return{domOverlayPosition:r,canvasOverlayPosition:d}},n.prototype.isElementInArea=function(e,t,o,i,r){var s;if(i===void 0&&(i=!0),r===void 0&&(r=!0),e.BaseType===En.NODE){e=e;for(var a=bo(e),l=a.minX,d=a.minY,c=a.maxX,p=a.maxY,f=[{x:l,y:d},{x:c,y:d},{x:c,y:p},{x:l,y:p}],h=r,v=0;v<f.length;v++){var y=f[v],g=y.x,_=y.y;if(s=Pn(this.transformModel.CanvasPointToHtmlPoint([g,_]),2),g=s[0],_=s[1],vd([g,_],t,o)!==r){h=!r;break}}return h}if(e.BaseType===En.EDGE){e=e;var b=e.startPoint,C=e.endPoint,T=this.transformModel.CanvasPointToHtmlPoint([b.x,b.y]),M=this.transformModel.CanvasPointToHtmlPoint([C.x,C.y]),S=vd(T,t,o),k=vd(M,t,o);return i?S&&k:S||k}return!1},n.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=si(e.nodes,function(i){var r=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(r.id,r),t.nodeModelMap.set(r.id,r),r}):this.nodes=[],e.edges){var o=this.edgeType;this.edges=si(e.edges,function(i){var r,s=t.getModel((r=i.type)!==null&&r!==void 0?r:o);if(!s)throw new Error("找不到".concat(i.type,"对应的边。"));var a=new s(i,t);return t.edgeModelMap.set(a.id,a),t.elementsModelMap.set(a.id,a),a})}else this.edges=[]},n.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(o){var i=o.getData();i&&!o.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(o){var i=o.getData();i&&!o.virtual&&t.push(i)}),{nodes:t,edges:e}},n.prototype.modelToHistoryData=function(){for(var e=!1,t=[],o=0;o<this.nodes.length;o++){var i=this.nodes[o];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var r=!1,s=[],a=0;a<this.edges.length;a++){var l=this.edges[a];if(l.isDragging){r=!0;break}else s.push(l.getHistoryData())}return r?!1:{nodes:t,edges:s}},n.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getElement=function(e){return this.modelsMap[e]},n.prototype.getNodeEdges=function(e){for(var t=[],o=0;o<this.edges.length;o++){var i=this.edges[o],r=i.sourceNodeId===e,s=i.targetNodeId===e;(r||s)&&t.push(i)}return t},n.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,o={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===En.NODE&&o.nodes.push(i.getData()),i.BaseType===En.EDGE){var r=i.getData(),s=t.get(r.sourceNodeId)&&t.get(r.targetNodeId);(e||s)&&o.edges.push(r)}}),o},n.prototype.updateAttributes=function(e,t){var o=this.getElement(e);o==null||o.updateAttributes(t)},n.prototype.changeNodeId=function(e,t){return t||(t=or()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(o){o.sourceNodeId===e&&(o.sourceNodeId=t),o.targetNodeId===e&&(o.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},n.prototype.changeEdgeId=function(e,t){return t||(t=or()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(o){o.id===e&&o.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},n.prototype.getTextModel=function(e){var t=this.editConfigModel,o=t.textMode,i=t.nodeTextMode,r=t.edgeTextMode;if(e.BaseType===En.NODE)return e.textMode||i||o||jo.TEXT;if(e.BaseType===En.EDGE)return e.textMode||r||o||jo.TEXT},n.prototype.setOverlapMode=function(e){this.overlapMode=e,this.eventCenter.emit("overlap:change",{overlapMode:e})},n.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},n.prototype.setFakeNode=function(e){this.fakeNode=e},n.prototype.removeFakeNode=function(){this.fakeNode=null},n.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},n.prototype.toFront=function(e){var t,o,i,r=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((o=this.edgesMap[e])===null||o===void 0?void 0:o.model);if(r){if(this.overlapMode===jn.STATIC)return;if(this.overlapMode===jn.INCREASE){this.setElementZIndex(e,"top");return}(i=this.topElement)===null||i===void 0||i.setZIndex(),r.setZIndex(rJ),this.topElement=r}},n.prototype.setElementZIndex=function(e,t){var o,i,r=((o=this.nodesMap[e])===null||o===void 0?void 0:o.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(r){var s=void 0;typeof t=="number"?s=t:(t==="top"&&(s=La()),t==="bottom"&&(s=$K())),r.setZIndex(s)}},n.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,o=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(_t.NODE_DELETE,{data:o,model:t})},n.prototype.addNode=function(e,t,o){t===void 0&&(t=_t.NODE_ADD);var i=Qn(e),r=i.id;r&&this.nodesMap[r]&&delete i.id;var s=this.getModelAfterSnapToGrid(i);this.nodes.push(s);var a=s.getData(),l={data:a};return o&&(l.e=o),this.eventCenter.emit(t,l),s},n.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),o=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,r=e.y;i&&r&&(e.x=Cs(i,this.gridSize,o),e.y=Cs(r,this.gridSize,o),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-r));var s=new t(e,this);return this.nodeModelMap.set(s.id,s),this.elementsModelMap.set(s.id,s),s},n.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),o=t==null?void 0:t.getData();if(o){o.x+=30,o.y+=30,o.id="",typeof o.text=="object"&&o.text!==null&&(o.text.x+=30,o.text.y+=30);var i=this.addNode(o);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},n.prototype.moveNode=function(e,t,o,i){var r;i===void 0&&(i=!1);var s=this.nodesMap[e];if(!s){console.warn("不存在id为".concat(e,"的节点"));return}var a=s.model;r=Pn(a.getMoveDistance(t,o,i),2),t=r[0],o=r[1],this.moveEdge(e,t,o)},n.prototype.moveNode2Coordinate=function(e,t,o,i){i===void 0&&(i=!1);var r=this.nodesMap[e];if(!r){console.warn("不存在id为".concat(e,"的节点"));return}var s=r.model,a=s.x,l=s.y,d=t-a,c=o-l;this.moveNode(e,d,c,i)},n.prototype.editText=function(e){this.setElementStateById(e,ln.TEXT_EDIT)},n.prototype.addEdge=function(e){var t=Qn(e),o=t.type;o||(o=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var i=this.getModel(o);if(!i)throw new Error("找不到".concat(o,"对应的边，请确认是否已注册此类型边。"));var r=new i(Jn(Jn({},t),{type:o}),this);this.edgeModelMap.set(r.id,r),this.elementsModelMap.set(r.id,r);var s=r.getData();return this.edges.push(r),this.eventCenter.emit(_t.EDGE_ADD,{data:s}),r},n.prototype.moveEdge=function(e,t,o){for(var i=0;i<this.edges.length;i++){var r=this.edges[i],s=r.textPosition,a=s.x,l=s.y,d=this.edges[i].sourceNodeId===e,c=this.edges[i].targetNodeId===e;d&&r.moveStartPoint(t,o),c&&r.moveEndPoint(t,o),(d||c)&&this.handleEdgeTextMove(r,a,l)}},n.prototype.handleEdgeTextMove=function(e,t,o){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===Gt.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var r=e.text,s=Vg(r,e.points);e.moveText(s.x-r.x,s.y-r.y)}var a=e.textPosition,l=a.x,d=a.y;e.moveText(l-t,d-o)},n.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var o=0;o<this.edges.length;o++)if(this.edges[o].sourceNodeId===e&&this.edges[o].targetNodeId===t){var i=this.edges[o].getData();this.edges.splice(o,1),o--,this.eventCenter.emit(_t.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var o=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(o,1),this.eventCenter.emit(_t.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var o=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(_t.EDGE_DELETE,{data:o})}},n.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var o=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(_t.EDGE_DELETE,{data:o})}},n.prototype.setElementStateById=function(e,t,o){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,o):i.setElementState(ln.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,o):i.setElementState(ln.DEFAULT)})},n.prototype.updateText=function(e,t){var o=Tr(mo(mo([],Pn(this.nodes),!1),Pn(this.edges),!1),function(i){return i.id===e});o==null||o.updateText(t)},n.prototype.selectNodeById=function(e,t){var o;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(o=this.nodesMap[e])===null||o===void 0?void 0:o.model;i==null||i.setSelected(!0)},n.prototype.selectEdgeById=function(e,t){var o;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(o=this.edgesMap[e])===null||o===void 0?void 0:o.model;i==null||i.setSelected(!0)},n.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var o=this.getElement(e);o==null||o.setSelected(!0)},n.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},n.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1),t==null||t.setHovered(!1)}),this.selectElements.clear(),[jn.DEFAULT,jn.EDGE_TOP].includes(this.overlapMode)&&((e=this.topElement)===null||e===void 0||e.setZIndex())},n.prototype.moveNodes=function(e,t,o,i){var r,s,a,l=this;i===void 0&&(i=!1);for(var d=e.reduce(function(C,T){var M,S=(M=l.nodesMap[T])===null||M===void 0?void 0:M.model;return S&&(C[T]=S.getMoveDistance(t,o,i)),C},{}),c=0;c<this.edges.length;c++){var p=this.edges[c],f=p.textPosition,h=f.x,v=f.y,y=d[p.sourceNodeId],g=d[p.targetNodeId],_=void 0,b=void 0;y&&g&&p.modelType===Gt.POLYLINE_EDGE?(r=Pn(y,2),_=r[0],b=r[1],p.updatePointsList(_,b)):(y&&(s=Pn(y,2),_=s[0],b=s[1],p.moveStartPoint(_,b)),g&&(a=Pn(g,2),_=a[0],b=a[1],p.moveEndPoint(_,b))),(y||g)&&this.handleEdgeTextMove(p,h,v)}},n.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},n.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},n.prototype.setDefaultEdgeType=function(e){this.edgeType=e},n.prototype.changeNodeType=function(e,t){var o=this.getNodeModelById(e);if(!o){console.warn("找不到id为".concat(e,"的节点"));return}var i=o.getData();i.type=t;var r=this.getModel(t);if(!r)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var s=new r(i,this);this.nodes.splice(this.nodesMap[e].index,1,s);var a=this.getNodeEdges(e);a.forEach(function(l){if(l.sourceNodeId===e){var d=$h(s,l.startPoint,s.width,s.height);l.updateStartPoint(d)}if(l.targetNodeId===e){var d=$h(s,l.endPoint,s.width,s.height);l.updateEndPoint(d)}})},n.prototype.changeEdgeType=function(e,t){var o=this.getEdgeModelById(e);if(!o){console.warn("找不到id为".concat(e,"的边"));return}if(o.type!==t){var i=o.getData();i.type=t;var r=this.getModel(t);if(!r)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var s=new r(i,this);this.edges.splice(this.edgesMap[e].index,1,s)}},n.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.targetNodeId===e&&t.push(o)}),t},n.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.sourceNodeId===e&&t.push(o)}),t},n.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.targetAnchorId===e&&t.push(o)}),t},n.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.sourceAnchorId===e&&t.push(o)}),t},n.prototype.getNodeIncomingNode=function(e){var t=this,o=[];return this.edges.forEach(function(i){var r;i.targetNodeId===e&&o.push((r=t.nodesMap[i.sourceNodeId])===null||r===void 0?void 0:r.model)}),o},n.prototype.getNodeOutgoingNode=function(e){var t=this,o=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&o.push(t.nodesMap[i.targetNodeId].model)}),o},n.prototype.setTheme=function(e,t){var o;if(t&&(Ra[t]&&this.updateBackgroundOptions(Jn(Jn({},typeof this.background=="object"?this.background:{}),Ra[t])),Pa[t]&&this.updateGridOptions(ds.getGridOptions(Jn(Jn({},this.grid),Pa[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=ds.getGridOptions((o=e.grid)!==null&&o!==void 0?o:!1);this.updateGridOptions(i)}this.theme=NK(Jn(Jn({},this.customStyles),e),t),this.customStyles=Jn(Jn({},this.customStyles),e)},n.prototype.getTheme=function(){var e=this,t=e.background,o=e.grid,i=Jn(Jn({},Dt(this.theme)),{background:t,grid:o});return i},n.prototype.updateGridOptions=function(e){cs(this.grid,e)},n.prototype.updateGridSize=function(e){this.gridSize=e},n.prototype.updateBackgroundOptions=function(e){Bd(e)||Bd(this.background)?this.background=e:this.background=Jn(Jn({},this.background),e)},n.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=eo(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=eo(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},n.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},n.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],o=[];e.forEach(function(f){var h=f.x,v=f.y,y=f.width,g=f.height,_=f.getNodeStyle().strokeWidth,b=_===void 0?0:_,C=h+y/2+b,T=h-y/2-b,M=v+g/2+b,S=v-g/2-b;t=t.concat([C,T].filter(function(k){return!Number.isNaN(k)})),o=o.concat([M,S].filter(function(k){return!Number.isNaN(k)}))});var i=Math.min.apply(Math,mo([],Pn(t),!1)),r=Math.max.apply(Math,mo([],Pn(t),!1)),s=Math.min.apply(Math,mo([],Pn(o),!1)),a=Math.max.apply(Math,mo([],Pn(o),!1)),l=r-i||0,d=a-s||0,c=i+l/2,p=s+d/2;return{width:l,height:d,x:c,y:p}},n.prototype.translateCenter=function(){var e=this,t=e.nodes,o=e.width,i=e.height,r=e.rootEl,s=e.transformModel;if(t.length){var a=o||r.clientWidth,l=i||r.clientHeight,d=this.getVirtualRectSize(),c=d.x,p=d.y;s.focusOn(c,p,a,l)}},n.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var o=this,i=o.nodes,r=o.width,s=o.height,a=o.rootEl,l=o.transformModel;if(i.length){var d=r||a.clientWidth,c=s||a.clientHeight,p=this.getVirtualRectSize(),f=p.width,h=p.height,v=p.x,y=p.y,g=(f+t)/d,_=(h+e)/c,b=1/Math.max(g,_),C=[d/2,c/2];l.zoom(b,C),l.focusOn(v,y,d,c)}},n.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},n.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},n.prototype.getPartial=function(){return this.partial},n.prototype.setPartial=function(e){this.partial=e},n.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},gt([Re],n.prototype,"width",void 0),gt([Re],n.prototype,"height",void 0),gt([Re],n.prototype,"theme",void 0),gt([Re],n.prototype,"grid",void 0),gt([Re],n.prototype,"edgeType",void 0),gt([Re],n.prototype,"nodes",void 0),gt([Re],n.prototype,"edges",void 0),gt([Re],n.prototype,"fakeNode",void 0),gt([Re],n.prototype,"overlapMode",void 0),gt([Re],n.prototype,"background",void 0),gt([Re],n.prototype,"gridSize",void 0),gt([Re],n.prototype,"transformModel",void 0),gt([Re],n.prototype,"editConfigModel",void 0),gt([Re],n.prototype,"partial",void 0),gt([bn],n.prototype,"nodesMap",null),gt([bn],n.prototype,"edgesMap",null),gt([bn],n.prototype,"modelsMap",null),gt([bn],n.prototype,"sortElements",null),gt([bn],n.prototype,"textEditElement",null),gt([bn],n.prototype,"selectElements",null),gt([bn],n.prototype,"selectNodes",null),gt([$e],n.prototype,"setOverlapMode",null),gt([$e],n.prototype,"setTextMode",null),gt([$e],n.prototype,"setFakeNode",null),gt([$e],n.prototype,"removeFakeNode",null),gt([$e],n.prototype,"setModel",null),gt([$e],n.prototype,"toFront",null),gt([$e],n.prototype,"setElementZIndex",null),gt([$e],n.prototype,"deleteNode",null),gt([$e],n.prototype,"addNode",null),gt([$e],n.prototype,"cloneNode",null),gt([$e],n.prototype,"moveNode",null),gt([$e],n.prototype,"moveNode2Coordinate",null),gt([$e],n.prototype,"editText",null),gt([$e],n.prototype,"addEdge",null),gt([$e],n.prototype,"moveEdge",null),gt([$e],n.prototype,"deleteEdgeBySourceAndTarget",null),gt([$e],n.prototype,"deleteEdgeById",null),gt([$e],n.prototype,"deleteEdgeBySource",null),gt([$e],n.prototype,"deleteEdgeByTarget",null),gt([$e],n.prototype,"setElementStateById",null),gt([$e],n.prototype,"updateText",null),gt([$e],n.prototype,"selectNodeById",null),gt([$e],n.prototype,"selectEdgeById",null),gt([$e],n.prototype,"selectElementById",null),gt([$e],n.prototype,"deselectElementById",null),gt([$e],n.prototype,"clearSelectElements",null),gt([$e],n.prototype,"moveNodes",null),gt([$e],n.prototype,"setDefaultEdgeType",null),gt([$e],n.prototype,"changeNodeType",null),gt([$e],n.prototype,"changeEdgeType",null),gt([$e],n.prototype,"getNodeIncomingEdge",null),gt([$e],n.prototype,"getNodeOutgoingEdge",null),gt([$e],n.prototype,"getAnchorIncomingEdge",null),gt([$e],n.prototype,"getAnchorOutgoingEdge",null),gt([$e],n.prototype,"getNodeIncomingNode",null),gt([$e],n.prototype,"getNodeOutgoingNode",null),gt([$e],n.prototype,"setTheme",null),gt([$e],n.prototype,"getTheme",null),gt([$e],n.prototype,"resize",null),gt([$e],n.prototype,"clearData",null),gt([$e],n.prototype,"translateCenter",null),gt([$e],n.prototype,"fitView",null),gt([$e],n.prototype,"openEdgeAnimation",null),gt([$e],n.prototype,"closeEdgeAnimation",null),gt([$e],n.prototype,"setPartial",null),n})(),Cr=function(){return Cr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Cr.apply(this,arguments)},Xs=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},OZ=(function(){function n(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return n.prototype.getStyle=function(){return Cr({},this.graphModel.theme.snapline)},n.prototype.getCenterSnapLine=function(e,t){for(var o=e.x,i=e.y,r=!1,s=!1,a=0;a<t.length;a++){var l=t[a];if(l.id!==e.id&&(Xo(o,l.x,this.epsilon)&&(r=!0),Xo(i,l.y,this.epsilon)&&(s=!0),r&&s))break}return{isShowVertical:r,isShowHorizontal:s,position:{x:o,y:i}}},n.prototype.getHorizontalSnapline=function(e,t){var o=!1,i=0,r=e.id,s;if(r){var a=this.graphModel.fakeNode;if(a&&a.id===r)s=bo(a);else{var l=this.graphModel.getNodeModelById(r);l&&(s=bo(l))}}for(var d=0;d<t.length;d++){var c=t[d];if(c.id!==e.id){var p=bo(c);if(Xo(p.minY,s==null?void 0:s.minY,this.epsilon)||Xo(p.maxY,s==null?void 0:s.minY,this.epsilon)){o=!0,i=s.minY;break}if(Xo(p.minY,s==null?void 0:s.maxY,this.epsilon)||Xo(p.maxY,s==null?void 0:s.maxY,this.epsilon)){o=!0,i=s.maxY;break}}}return{isShowHorizontal:o,isShowVertical:this.isShowVertical,position:Cr(Cr({},this.position),{y:i})}},n.prototype.getVerticalSnapline=function(e,t){var o=!1,i=0,r=e.id,s;if(r){var a=this.graphModel.fakeNode;if(a&&a.id===r)s=bo(a);else{var l=this.graphModel.getNodeModelById(r);l&&(s=bo(l))}}for(var d=0;d<t.length;d++){var c=t[d];if(c.id!==e.id){var p=bo(c);if(Xo(p.minX,s==null?void 0:s.minX,this.epsilon)){o=!0,i=s.minX;break}if(Xo(p.minX,s==null?void 0:s.minX,this.epsilon)||Xo(p.maxX,s==null?void 0:s.minX,this.epsilon)){o=!0,i=s.minX;break}if(Xo(p.minX,s==null?void 0:s.maxX,this.epsilon)||Xo(p.maxX,s==null?void 0:s.maxX,this.epsilon)){o=!0,i=s.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:o,position:Cr(Cr({},this.position),{x:i})}},n.prototype.getSnapLinePosition=function(e,t){var o=this.getCenterSnapLine(e,t),i=o.isShowHorizontal,r=o.isShowVertical;if(!i){var s=this.getHorizontalSnapline(e,t);s.isShowHorizontal&&(o.isShowHorizontal=s.isShowHorizontal,o.position.y=s.position.y)}if(!r){var a=this.getVerticalSnapline(e,t);a.isShowVertical&&(o.isShowVertical=a.isShowVertical,o.position.x=a.position.x)}return o},n.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,o=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=o},n.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},n.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,o=this.getSnapLinePosition(e,t);this.setSnaplineInfo(o)},Xs([Re],n.prototype,"isShowHorizontal",void 0),Xs([Re],n.prototype,"isShowVertical",void 0),Xs([Re],n.prototype,"position",void 0),Xs([$e],n.prototype,"clearSnapline",null),Xs([$e],n.prototype,"setNodeSnapLine",null),n})();function Xo(n,e,t){return Math.abs(n-e)<=t}var NZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),MZ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},TZ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},$Z=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},RZ=(function(n){NZ(e,n);function e(){var t=n.apply(this,$Z([],TZ(arguments),!1))||this;return t.handleResize=function(){var o=t.props,i=o.graphModel,r=o.options,s=i.width,a=i.height,l=i.isContainerWidth,d=i.isContainerHeight,c=s,p=a,f=!1;l&&(c=void 0,f=!0),d&&(p=void 0,f=!0),f&&i.resize(c,p),r.width=s,r.height=a},t.throttleResize=by(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(_t.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,o,i){i===void 0&&(i="canvas-overlay");var r=this.props.getView,s=r(t.type);return s?Pe(s,{model:t,graphModel:o,overlay:i},t.id):null},e.prototype.render=function(){var t=this,o=this.props,i=o.graphModel,r=o.tool,s=o.options,a=o.dnd,l=o.snaplineModel,d={};s.width&&(d.width="".concat(i.width,"px")),s.height&&(d.height="".concat(i.height,"px"));var c=i.fakeNode,p=i.editConfigModel,f=i.background,h=p.adjustEdge;return Pe("div",{className:"lf-graph","flow-id":i.flowId,style:d,children:[Pe(nZ,{graphModel:i,dnd:a,children:[Pe("g",{className:"lf-base",children:si(i.sortElements,function(v){return t.getComponent(v,i)})}),c?this.getComponent(c,i):""]}),Pe(fZ,{graphModel:i,children:[Pe(_Z,{graphModel:i}),h?Pe(rZ,{graphModel:i}):"",s.snapline!==!1?Pe(yZ,{snaplineModel:l}):""]}),Pe(wZ,{graphModel:i,tool:r}),f&&Pe(lZ,{background:f}),Pe(ds,{graphModel:i})]})},e=MZ([no],e),e})(Kt),PZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),_i=function(){return _i=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_i.apply(this,arguments)},LZ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},BZ=(function(n){PZ(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(o){var i=o.event,r=t.props,s=r.anchorData,a=r.nodeModel,l=r.graphModel;l.selectNodeById(a.id),a.autoToFront&&l.toFront(a.id),l.eventCenter.emit(_t.ANCHOR_DRAGSTART,{data:s,e:i,nodeModel:a}),t.setState({startX:s.x,startY:s.y,endX:s.x,endY:s.y})},t.onDragging=function(o){var i=o.event,r=t.props,s=r.graphModel,a=r.nodeModel,l=r.anchorData,d=s.transformModel,c=s.eventCenter,p=s.width,f=s.height,h=s.editConfigModel,v=h.autoExpand,y=h.stopMoveGraph;if(i){var g=i.clientX,_=i.clientY,b=s.getPointByClient({x:g,y:_}),C=b.domOverlayPosition,T=C.x,M=C.y,S=b.canvasOverlayPosition,k=S.x,A=S.y;t.t&&su(t.t);var $=[],B=10;T<10?$=[B,0]:T+10>p?$=[-B,0]:M<10?$=[0,B]:M+10>f&&($=[0,-B]),t.setState({endX:k,endY:A,dragging:!0}),t.moveAnchorEnd(k,A,i),$.length>0&&!y&&v&&(t.t=qg(function(){var O=LZ($,2),P=O[0],E=O[1];d.translate(P,E);var D=t.state,N=D.endX,F=D.endY;t.setState({endX:N-P,endY:F-E}),t.moveAnchorEnd(N-P,F-E,i)})),c.emit(_t.ANCHOR_DRAG,{data:l,e:i,nodeModel:a})}},t.onDragEnd=function(o){var i=o.event;t.t&&su(t.t);var r=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var s=t.props,a=s.graphModel,l=s.nodeModel,d=s.anchorData;t.preTargetNode&&(t.preTargetNode.setHovered(!1),t.preTargetNode=void 0),a.eventCenter.emit(_t.ANCHOR_DRAGEND,{data:d,e:i,nodeModel:l,edgeModel:r??void 0})},t.checkEnd=function(o){var i,r=t.props,s=r.graphModel,a=r.nodeModel,l=r.anchorData,d=l.x,c=l.y,p=l.id,f=t.state,h=f.endX,v=f.endY,y=f.dragging,g=iu({x:h,y:v},s);if(t.preTargetNode&&t.preTargetNode.state!==ln.DEFAULT&&t.preTargetNode.setElementState(ln.DEFAULT),!!y&&g&&g.node){var _=g.node,b=g.anchor.id,C="".concat(a.id,"_").concat(_.id,"_").concat(b,"_").concat(p),T=t.sourceRuleResults.get(C)||{},M=T.isAllPass,S=T.msg,k=t.targetRuleResults.get(C)||{},A=k.isAllPass,$=k.msg;if(M&&A){_.setElementState(ln.DEFAULT);var B=s.getNodeModelById(g.node.id),O=(i=s.edgeGenerator)===null||i===void 0?void 0:i.call(s,a.getData(),B==null?void 0:B.getData()),P=s.addEdge(_i(_i({},O),{sourceNodeId:a.id,sourceAnchorId:p,startPoint:{x:d,y:c},targetNodeId:g.node.id,targetAnchorId:g.anchor.id,endPoint:{x:g.anchor.x,y:g.anchor.y}})),E=t.props.anchorData;return s.eventCenter.emit(_t.ANCHOR_DROP,{data:E,e:o,nodeModel:a,edgeModel:P}),P}var D=_.getData();return s.eventCenter.emit(_t.CONNECTION_NOT_ALLOWED,{data:D,msg:$||S||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new zo({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,o=t.anchorData,i=t.style,r=t.node,s=r.getAnchorShape(o);if(s)return s;var a=o.x,l=o.y,d=_i(_i({},i),i==null?void 0:i.hover);return Pe("g",{children:[Pe(Ss,_i({className:"lf-node-anchor-hover"},d,{x:a,y:l})),Pe(Ss,_i({className:"lf-node-anchor"},i,{x:a,y:l}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,o=t.graphModel,i=o.getAnchorIncomingEdge,r=o.getAnchorOutgoingEdge,s=t.anchorData.id;return{incomingEdgeList:i(s),outgoingEdgeList:r(s)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,o,i){var r,s,a=this.props,l=a.graphModel,d=a.nodeModel,c=a.anchorData,p=iu({x:t,y:o},l);if(p){var f=p.node,h=p.anchor.id;if(this.preTargetNode&&this.preTargetNode!==p.node&&this.preTargetNode.setElementState(ln.DEFAULT),c.id===h)return;this.preTargetNode=f;var v="".concat(d.id,"_").concat(f.id,"_").concat(h,"_").concat(c.id);if(!this.targetRuleResults.has(v)){var y=p.anchor,g=d.isAllowConnectedAsSource(f,c,y),_=f.isAllowConnectedAsTarget(d,c,y);this.sourceRuleResults.set(v,ru(g)),this.targetRuleResults.set(v,ru(_))}var b=((r=this.sourceRuleResults.get(v))!==null&&r!==void 0?r:{}).isAllPass,C=((s=this.targetRuleResults.get(v))!==null&&s!==void 0?s:{}).isAllPass;if(b&&C?f.setElementState(ln.ALLOW_CONNECT):f.setElementState(ln.NOT_ALLOW_CONNECT),!f.isHovered){var T=f.getData();i&&l.eventCenter.emit(_t.NODE_MOUSEENTER,{data:T,e:i}),f.setHovered(!0)}}else if(this.preTargetNode&&this.preTargetNode.state!==ln.DEFAULT){this.preTargetNode.setElementState(ln.DEFAULT);var M=this.preTargetNode.getData();i&&l.eventCenter.emit(_t.NODE_MOUSELEAVE,{data:M,e:i}),this.preTargetNode.setHovered(!1),this.preTargetNode=void 0}},e.prototype.isShowLine=function(){var t=this.state,o=t.startX,i=t.startY,r=t.endX,s=t.endY,a=ei(o,i,r,s);return a>10},e.prototype.render=function(){var t=this,o=this.state,i=o.startX,r=o.startY,s=o.endX,a=o.endY,l=this.props,d=l.anchorData,c=l.edgeStyle,p=l.nodeModel,f=l.graphModel,h=d.edgeAddable;return Pe("g",{className:"lf-anchor",children:[Pe("g",{onClick:function(v){v.stopPropagation(),f.eventCenter.emit(_t.ANCHOR_CLICK,{data:d,e:v,nodeModel:p})},onPointerDown:function(v){f.eventCenter.emit(_t.ANCHOR_MOUSEDOWN,{data:d,e:v,nodeModel:p}),h!==!1&&t.dragHandler.handleMouseDown(v)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(_i({sourcePoint:{x:i,y:r},targetPoint:{x:s,y:a}},c)):Pe(ks,_i({x1:i,y1:r,x2:s,y2:a},c,{"pointer-events":"none"})))]})},e})(Kt),IZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xc=function(){return xc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xc.apply(this,arguments)},jZ=(function(n){IZ(e,n);function e(t){var o=n.call(this,t)||this;return o.style={},o.onDragging=function(i){var r,s=i.event,a=o.props,l=a.graphModel,d=a.nodeModel,c=a.eventCenter,p=l.selectNodes,f=d.x,h=d.y,v=s.clientX,y=s.clientY,g=l.getPointByClient({x:v,y}).canvasOverlayPosition,_=g.x,b=g.y,C=new Gn(_-f,b-h),T=((r=o.normal)===null||r===void 0?void 0:r.angle(C))-o.defaultAngle,M=new nu(-f,-h).rotate(T).translate(f,h).toString();d.transform=M,d.rotate=T;var S=si(p,function(A){return A.id});S.indexOf(d.id)===-1&&(S=[d.id]);var k=xy(S,function(A,$){var B=l.getNodeModelById($);return A[$]=B==null?void 0:B.getMoveDistance(0,0,!1),A},{});S.forEach(function(A){var $=l.getNodeEdges(A);$.forEach(function(B){if(k[B.sourceNodeId]){var O=l.getNodeModelById(B.sourceNodeId),P=O.anchors.find(function(E){return E.id===B.sourceAnchorId});B.updateStartPoint(P)}if(k[B.targetNodeId]){var O=l.getNodeModelById(B.targetNodeId),P=O.anchors.find(function(N){return N.id===B.targetAnchorId});B.updateEndPoint(P)}})}),c.emit(_t.NODE_ROTATE,{e:s,model:d,data:d.getData()})},o.style=t.style,o.stepperDrag=new zo({onDragging:o.onDragging}),o}return e.prototype.render=function(){var t=this,o=this.props.nodeModel,i=o.x,r=o.y,s=o.width,a=o.height,l=i+s/2+20,d=r-a/2-20;return this.normal=new Gn(1,0),this.defaultAngle=this.normal.angle(new Gn(l-i,d-r)),o.defaultAngle=this.defaultAngle,Pe("g",{className:"lf-rotate-control",children:Pe("g",{onPointerDown:function(c){t.stepperDrag.handleMouseDown(c)},children:Pe(Ss,xc({},this.style,{cx:l,cy:d}))})})},e})(Kt),bd={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var qh;function FZ(){return qh||(qh=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var r="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(r=i(r,o(a)))}return r}function o(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return t.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var s="";for(var a in r)e.call(r,a)&&r[a]&&(s=i(s,a));return s}function i(r,s){return s?r?r+" "+s:r+s:r}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(bd)),bd.exports}var VZ=FZ();const wc=Ga(VZ);var HZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Cc=function(){return Cc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Cc.apply(this,arguments)},UZ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Zg=(function(n){HZ(e,n);function e(t){var o=n.call(this)||this;o.mouseDownHandler=function(r){var s=o.props,a=s.draggable,l=s.model,d=s.graphModel,c=d.editConfigModel.nodeTextDraggable;(a??c)&&(r.stopPropagation(),o.stepperDrag.model=l,o.stepperDrag.handleMouseDown(r))},o.onDragging=function(r){var s=r.deltaX,a=r.deltaY,l=o.props,d=l.model,c=l.graphModel.transformModel;if(s||a){var p=UZ(c.fixDeltaXY(s,a),2),f=p[0],h=p[1];d.moveText(f,h)}},o.dbClickHandler=function(){var r=o.props,s=r.editable,a=r.graphModel.eventCenter,l=r.model;s&&l.setElementState(ln.TEXT_EDIT),a.emit(_t.TEXT_DBCLICK,{data:l.text,model:l})};var i=t.draggable;return o.stepperDrag=new zo({onDragging:o.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),o}return e.prototype.getShape=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=o.text,a=s.value,l=s.x,d=s.y,c=s.editable,p=s.draggable,f={x:l,y:d,className:"",value:a},h=o.getTextStyle(),v=r.nodeTextDraggable||p;return Pe(Gg,Cc({},f,h,{className:wc({"lf-element-text":c,"lf-text-draggable":!c&&v,"lf-text-disabled":!c&&!v}),model:o}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return Pe("g",{onPointerDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e})(Kt),zZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Wo=function(){return Wo=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Wo.apply(this,arguments)},wl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},qZ=(function(n){zZ(e,n);function e(t){var o=n.call(this,t)||this;return o.setHoverOn=function(){o.setState({isHovered:!0})},o.setHoverOff=function(){o.setState({isHovered:!1})},o.state={isHovered:!1},o}return e.prototype.getBackground=function(){var t=this.state.isHovered,o=this.props.model,i=o.text,r=o.getTextStyle(),s=r.background||{};if(t&&r.hover&&r.hover.background&&(s=Wo(Wo({},s),r.hover.background)),i!=null&&i.value&&(s==null?void 0:s.fill)!=="transparent"){var a=r.fontSize,l=r.textWidth,d=r.lineHeight,c=r.overflowMode,p=s.wrapPadding,f=i==null?void 0:i.value.split(/[\r\n]/g),h=f.length,v=i.x,y=i.y,g={};if(c==="autoWrap"&&l){var _=zg({rows:f,style:{fontSize:"".concat(a,"px"),width:"".concat(l,"px"),lineHeight:d,padding:p},rowsLength:h,className:"lf-get-text-height"});g=Wo(Wo({},s),{x:v,y,width:l,height:_})}else{var b=DJ({rows:f,rowsLength:h,fontSize:a}),C=b.width,T=b.height;if(c==="ellipsis"&&(C=l,T=a+2),typeof s.wrapPadding=="string"){var M=s.wrapPadding.split(",").filter(function(j){return j.trim()}).map(function(j){return parseFloat(j.trim())});if(M.length>0&&M.length<=4){if(M.length===1){var S=wl(M,1),k=S[0];M=[k,k,k,k]}else if(M.length===2){var A=wl(M,2),$=A[0],B=A[1];M=[$,B,$,B]}else if(M.length===3){var O=wl(M,3),P=O[0],B=O[1],E=O[2];M=[P,B,E,B]}var D=wl(M,4),N=D[0],F=D[1],Y=D[2],L=D[3];C+=F+L,T+=N+Y,v=v+(F-L)/2,y=y+(Y-N)/2}}g=Wo(Wo({},s),{x:v-1,y:y-1,width:C,height:T})}return Pe(Ro,Wo({},g))}return null},e.prototype.getShape=function(){var t=this.props.model,o=t.text,i=o.x,r=o.y,s=o.value;if(!s)return null;var a=t.getTextStyle(),l=Wo({x:i,y:r,value:s,model:t,className:"lf-element-text"},a);return Pe("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),Pe(Gg,Wo({},l))]})},e})(Zg),GZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),du=function(){return du=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},du.apply(this,arguments)},XZ=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Cl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},pr=(function(n){GZ(e,n);function e(t){var o=n.call(this)||this;o.onDragStart=function(l){var d=l.event,c=o.props,p=c.model,f=c.graphModel;if(d){var h=f.getPointByClient({x:d.clientX,y:d.clientY}).canvasOverlayPosition,v=h.x,y=h.y;o.moveOffset={dx:p.x-v,dy:p.y-y}}},o.onDragging=function(l){var d,c,p,f,h=l.event,v=o.props,y=v.model,g=v.graphModel,_=g.editConfigModel,b=_.stopMoveGraph,C=_.autoExpand,T=_.snapGrid,M=g.transformModel,S=g.selectNodes,k=g.width,A=g.height,$=g.gridSize;y.isDragging=!0;var B=h,O=B.clientX,P=B.clientY,E=g.getPointByClient({x:O,y:P}).canvasOverlayPosition,D=E.x,N=E.y,F=Cl(M.CanvasPointToHtmlPoint([D,N]),2),Y=F[0],L=F[1];if(D=D+((c=(d=o.moveOffset)===null||d===void 0?void 0:d.dx)!==null&&c!==void 0?c:0),N=N+((f=(p=o.moveOffset)===null||p===void 0?void 0:p.dy)!==null&&f!==void 0?f:0),D=Cs(D,$,T),N=Cs(N,$,T),!k||!A){g.moveNode2Coordinate(y.id,D,N);return}var j=Y<0||L<0||Y>k||L>A;if(!(C&&!b&&j)){var le=Cl(M.CanvasPointToHtmlPoint([D-y.width/2,N-y.height/2]),2),z=le[0],V=le[1],J=Cl(M.CanvasPointToHtmlPoint([D+y.width/2,N+y.height/2]),2),oe=J[0],W=J[1],q=Math.max($,20),re=[];z<0?re=[q,0]:oe>g.width?re=[-q,0]:V<0?re=[0,q]:W>g.height&&(re=[0,-q]),o.t&&su(o.t);var ue=S.map(function(xe){return xe.id});ue.indexOf(y.id)===-1&&(ue=[y.id]),re.length>0&&!b&&C?o.t=qg(function(){var xe=Cl(re,2),Te=xe[0],me=xe[1];M.translate(Te??0,me??0);var pe=-(Te??0)/M.SCALE_X,Ge=-(me??0)/M.SCALE_X;g.moveNodes(ue,pe,Ge)}):g.moveNodes(ue,D-y.x,N-y.y)}},o.onDragEnd=function(){o.t&&su(o.t);var l=o.props.model;l.isDragging=!1},o.onMouseOut=function(l){iJ()&&o.setHoverOff(l)},o.handleMouseUp=function(){var l=o.props.model;o.mouseUpDrag=l.isDragging,o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0)},o.handleClick=function(l){var d=o.mouseUpDrag===!1,c=new Date().getTime();if(o.startTime){var p=c-o.startTime,f=o.props,h=f.model,v=f.graphModel;if(!(!d&&p>100)){d||(o.onDragEnd(),o.handleMouseUp());var y=h.getData(),g=v.getPointByClient({x:l.clientX,y:l.clientY}),_={data:y,e:l,position:g,isSelected:!1,isMultiple:!1},b=l.button===2,C=l.detail===2;if(!b){var T=v.editConfigModel,M=Hg(l,T);_.isMultiple=M,h.isSelected&&!C&&M?(_.isSelected=!1,h.setSelected(!1)):(v.selectNodeById(h.id,M),_.isSelected=!0,T.isSilentMode||o.toFront()),C?(T.nodeTextEdit&&h.text.editable&&T.textMode===jo.TEXT&&(h.setSelected(!1),v.setElementStateById(h.id,ln.TEXT_EDIT)),v.eventCenter.emit(_t.NODE_DBCLICK,_)):(v.eventCenter.emit(_t.ELEMENT_CLICK,_),v.eventCenter.emit(_t.NODE_CLICK,_))}}}},o.handleContextMenu=function(l){l.preventDefault();var d=o.props,c=d.model,p=d.graphModel,f=p.editConfigModel,h=c.getData(),v=p.getPointByClient({x:l.clientX,y:l.clientY});p.setElementStateById(c.id,ln.SHOW_MENU,v.domOverlayPosition),c.isSelected||p.selectNodeById(c.id),p.eventCenter.emit(_t.NODE_CONTEXTMENU,{data:h,e:l,position:v}),f.isSilentMode||o.toFront()},o.handleMouseDown=function(l){var d=o.props,c=d.model,p=d.graphModel;o.startTime=new Date().getTime();var f=p.editConfigModel;f.adjustNodePosition&&c.draggable&&o.stepDrag&&o.stepDrag.handleMouseDown(l),o.longPressTimer&&clearTimeout(o.longPressTimer),l.pointerType==="touch"&&(o.longPressTimer=window.setTimeout(function(){o.props.model.isDragging||o.handleContextMenu(l)},500))},o.handleFocus=function(){var l=o.props,d=l.model,c=l.graphModel;c.eventCenter.emit(_t.NODE_FOCUS,{data:d.getData()})},o.handleBlur=function(){if(o.props){var l=o.props,d=l.model,c=l.graphModel;c.eventCenter.emit(_t.NODE_BLUR,{data:d.getData()})}},o.setHoverOn=function(l){var d=o.props,c=d.model,p=d.graphModel;if(!c.isHovered){var f=c.getData();c.setHovered(!0),p.eventCenter.emit(_t.NODE_MOUSEENTER,{data:f,e:l})}},o.setHoverOff=function(l){var d=o.props,c=d.model,p=d.graphModel,f=c.getData();c.isHovered&&(c.setHovered(!1),p.eventCenter.emit(_t.NODE_MOUSELEAVE,{data:f,e:l}))};var i=t.graphModel,r=i.gridSize,s=i.eventCenter,a=t.model;return o.stepDrag=new zo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"NODE",isStopPropagation:!1,eventCenter:s,model:a}),o.modelDisposer=_g(function(){return o.props},function(l){l&&l.model&&o.stepDrag.setModel(l.model)}),o}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,o=this.props,i=o.model,r=o.graphModel,s=i.isSelected,a=i.isHitable,l=i.isDragging,d=i.isShowAnchor;return a&&(s||d)&&!l?si(i.anchors,function(c,p){var f=i.getAnchorLineStyle(c),h=i.getAnchorStyle(c);return Pe(BZ,{anchorData:c,node:t,style:h,edgeStyle:f,anchorIndex:p,nodeModel:i,graphModel:r,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.isSilentMode,a=r.allowRotate,l=o.isSelected,d=o.isHitable,c=o.rotatable,p=o.isHovered,f=a&&c,h=o.getRotateControlStyle();if(!s&&d&&(l||p)&&f)return Pe(jZ,{graphModel:i,nodeModel:o,eventCenter:i.eventCenter,style:h})},e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.isSilentMode,a=r.allowResize,l=o.isSelected,d=o.isHitable,c=o.resizable,p=o.isHovered,f=a&&c,h=o.getResizeControlStyle();return!s&&d&&(l||p)&&f?Pe(iK,{style:h,model:o,graphModel:i}):null},e.prototype.getText=function(){var t,o=this.props,i=o.model,r=o.graphModel,s=r.editConfigModel;if(s.nodeTextMode!==jo.TEXT||i.state===ln.TEXT_EDIT)return null;if(i.text){var a=!1;return s.nodeTextDraggable&&i.text.draggable&&(a=!0),Pe(Zg,{editable:s.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:r,draggable:a})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,o=t.state,i=t.isDragging,r=t.isSelected,s="lf-node";switch(o){case ln.ALLOW_CONNECT:s+=" lf-node-allow";break;case ln.NOT_ALLOW_CONNECT:s+=" lf-node-not-allow";break;default:s+=" lf-node-default";break}return i&&(s+=" lf-dragging"),r&&(s+=" lf-node-selected"),s},e.prototype.toFront=function(){var t=this.props,o=t.model,i=t.graphModel;o.autoToFront&&i.toFront(o.id)},e.prototype.render=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.hideAnchors,a=r.adjustNodePosition,l=r.allowRotate,d=r.allowResize,c=i.gridSize,p=i.transformModel.SCALE_X,f=o.isHitable,h=o.draggable,v=o.transform,y=o.getOuterGAttributes(),g=y.className,_=g===void 0?"":g,b=XZ(y,["className"]),C=Pe("g",{className:"lf-node-content",children:[Pe("g",{transform:v,children:[this.getShape(),this.getText(),l&&this.getRotateControl(),d&&this.getResizeControl()]}),!s&&this.getAnchors()]}),T;return f?(a&&h&&this.stepDrag.setStep(c*p),T=Pe("g",du({className:"".concat(this.getStateClassName()," ").concat(_),onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},b,{children:C}))):T=Pe("g",du({className:"".concat(this.getStateClassName()," ").concat(_)},b,{children:C})),T},e.isObserved=!1,e})(Kt),WZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),kc=function(){return kc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},kc.apply(this,arguments)},Br=(function(n){WZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Pe(Ro,kc({},o,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e})(pr),YZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Sc=function(){return Sc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Sc.apply(this,arguments)},cu=(function(n){YZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.r,s=t.getNodeStyle();return Pe(Ss,Sc({},s,{x:o,y:i,r}))},e})(pr),JZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),pu=function(){return pu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pu.apply(this,arguments)},fu=(function(n){JZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points,d=t.getNodeStyle(),c={transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(r-a/2,")")};return Pe("g",pu({},c,{children:Pe(Dp,pu({},d,{points:l,x:i,y:r}))}))},e})(pr),KZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ec=function(){return Ec=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ec.apply(this,arguments)},Ac=(function(n){KZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Pe("g",{children:Pe(Dp,Ec({},o,{points:t.points,x:t.x,y:t.y}))})},e})(pr),ZZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Dc=function(){return Dc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Dc.apply(this,arguments)},Oc=(function(n){ZZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Pe(JJ,Dc({},o,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e})(pr),QZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),pa=function(){return pa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pa.apply(this,arguments)},Gh=(function(n){QZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,o=t.getTextStyle(),i=t.width,r=t.height,s=t.x,a=t.y,l=pa(pa({},o.background),{x:s,y:a,width:i,height:r});return Pe(Ro,pa({},l))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return Pe("g",{children:this.getBackground()})},e})(pr),eQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Nc=function(){return Nc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nc.apply(this,arguments)},tQ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},nQ=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},ja=(function(n){eQ(e,n);function e(){var t=n.apply(this,nQ([],tQ(arguments),!1))||this;return t.ref=zu(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.height,s=t.width,a=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),Pe("foreignObject",Nc({},a,{x:o-s/2,y:i-r/2,width:s,height:r,ref:this.ref}))},e})(pr),oQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Yo=function(){return Yo=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Yo.apply(this,arguments)},iQ=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},rQ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},mi;(function(n){n.SOURCE="SOURCE",n.TARGET="TARGET"})(mi||(mi={}));var Xh=(function(n){oQ(e,n);function e(t){var o=n.call(this)||this;o.handleMouseDown=function(l){o.stepDrag&&o.stepDrag.handleMouseDown(l)},o.onDragStart=function(){var l=o.props,d=l.x,c=l.y,p=l.edgeModel,f=p.startPoint,h=p.endPoint,v=p.pointsList;o.oldEdge={startPoint:f,endPoint:h,pointsList:v},o.setState({endX:d,endY:c,dragging:!0})},o.onDragging=function(l){var d=l.deltaX,c=l.deltaY,p=o.state,f=p.endX,h=p.endY,v=o.props,y=v.graphModel,g=v.type,_=y.transformModel,b=y.editConfigModel,C=rQ(_.moveCanvasPointByHtml([f,h],d,c),2),T=C[0],M=C[1];o.setState({endX:T,endY:M,dragging:!0});var S=o.props.edgeModel,k=iu({x:f,y:h},y);if(k&&k.node&&o.isAllowAdjust(k).pass){var A=S.startPoint,$=S.endPoint,B=S.sourceNode,O=S.targetNode,P=g===mi.SOURCE?{startPoint:{x:k.anchor.x,y:k.anchor.y},endPoint:{x:$.x,y:$.y},sourceNode:k.node,targetNode:O}:{startPoint:{x:A.x,y:A.y},endPoint:{x:k.anchor.x,y:k.anchor.y},sourceNode:B,targetNode:k.node};S.updateAfterAdjustStartAndEnd(P)}else g===mi.SOURCE?S.updateStartPoint({x:T,y:M}):S.updateEndPoint({x:T,y:M});S.text.value&&b.adjustEdge&&S.setText(Object.assign({},S.text,S.textPosition))},o.onDragEnd=function(l){var d,c,p,f=l.event;try{o.setState({dragging:!1});var h=o.props,v=h.graphModel,y=h.edgeModel,g=h.type,_=o.state,b=_.endX,C=_.endY,T=_.dragging,M=iu({x:b,y:C},v);if(!T)return;var S=!1,k=void 0;if(M&&M.node){var A=o.isAllowAdjust(M),$=A.pass,B=A.msg,O=A.newTargetNode;if($){var P=y.getData(),E=P.text,D=P.sourceAnchorId,N=D===void 0?"":D,F=P.targetAnchorId,Y=F===void 0?"":F,L=iQ(P,["text","sourceAnchorId","targetAnchorId"]);if(k=Yo(Yo({sourceAnchorId:N,targetAnchorId:Y},L),{text:(E==null?void 0:E.value)||""}),g===mi.SOURCE){var j=v.getNodeModelById(M.node.id),le=v.getNodeModelById(y.targetNodeId),z=(d=v.edgeGenerator)===null||d===void 0?void 0:d.call(v,j==null?void 0:j.getData(),le==null?void 0:le.getData(),k);k=Yo(Yo({},z),{sourceNodeId:M.node.id,sourceAnchorId:M.anchor.id,startPoint:{x:M.anchor.x,y:M.anchor.y},targetNodeId:y.targetNodeId,endPoint:Yo({},y.endPoint)}),y.sourceNodeId===M.node.id&&y.sourceAnchorId===M.anchor.id&&(S=!0)}else if(g===mi.TARGET){var j=v.getNodeModelById(y.sourceNodeId),le=v.getNodeModelById(M.node.id),z=(c=v.edgeGenerator)===null||c===void 0?void 0:c.call(v,j==null?void 0:j.getData(),le==null?void 0:le.getData(),k);k=Yo(Yo({},z),{sourceNodeId:y.sourceNodeId,startPoint:Yo({},y.startPoint),targetNodeId:M.node.id,targetAnchorId:M.anchor.id,endPoint:{x:M.anchor.x,y:M.anchor.y}}),y.targetNodeId===M.node.id&&y.targetAnchorId===M.anchor.id&&(S=!0)}}else{S=!0;var V=O.getData();v.eventCenter.emit(_t.CONNECTION_NOT_ALLOWED,{data:V,msg:B})}}else S=!0;if(S)o.recoveryEdge();else{var J=y.getData();v.deleteEdgeById(y.id);var oe=v.addEdge(Yo({},k));v.eventCenter.emit(_t.EDGE_EXCHANGE_NODE,{data:{newEdge:oe.getData(),oldEdge:J}})}(p=o.preTargetNode)===null||p===void 0||p.setElementState(ln.DEFAULT)}finally{var v=o.props.graphModel;v.eventCenter.emit(_t.ADJUST_POINT_DRAGEND,{e:f,data:o.stepDragData})}},o.recoveryEdge=function(){var l=o.props.edgeModel,d=o.oldEdge,c=d.startPoint,p=d.endPoint,f=d.pointsList;l.updateStartPoint(c),l.updateEndPoint(p),l.modelType!==Gt.LINE_EDGE&&(l.pointsList=f??[],l.initPoints())},o.getAdjustPointStyle=function(){var l=o.props.graphModel.theme,d=l.edgeAdjust;return d},o.state={dragging:!1,endX:0,endY:0},o.targetRuleResults=new Map,o.sourceRuleResults=new Map;var i=t.type,r=t.edgeModel,s=t.graphModel,a=s.eventCenter;return o.stepDragData={type:i,edgeData:r.getData()},o.stepDrag=new zo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:a,data:o.stepDragData}),o}return e.prototype.isAllowAdjust=function(t){var o=this.props,i=o.edgeModel,r=i.id,s=i.sourceNode,a=i.targetNode,l=i.sourceAnchorId,d=i.targetAnchorId,c=o.type,p,f,h,v;if(c===mi.SOURCE?(p=t.node,f=a,h=t.anchor,v=a.getAnchorInfo(d)):(p=s,f=t.node,v=t.anchor,h=s.getAnchorInfo(l)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(ln.DEFAULT),this.preTargetNode=t.node,v.id===h.id)return{pass:!1,msg:"",newTargetNode:f};var y="".concat(p.id,"_").concat(f.id,"_").concat(h.id,"_").concat(v.id);if(!this.targetRuleResults.has(y)){var g=p.isAllowConnectedAsSource(f,h,v,r),_=f.isAllowConnectedAsTarget(p,h,v,r);this.sourceRuleResults.set(y,ru(g)),this.targetRuleResults.set(y,ru(_))}var b=this.sourceRuleResults.get(y),C=b.isAllPass,T=b.msg,M=this.targetRuleResults.get(y),S=M.isAllPass,k=M.msg,A=C&&S?ln.ALLOW_CONNECT:ln.NOT_ALLOW_CONNECT;return c===mi.SOURCE?p.setElementState(A):f.setElementState(A),{pass:C&&S,msg:k||T,newTargetNode:f}},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.getAdjustPointShape,s=t.edgeModel,a=this.state.dragging;return Pe("g",{pointerEvents:a?"none":"",onPointerDown:this.handleMouseDown,children:a?"":r(o,i,s)})},e})(Kt),sQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Mc=function(){return Mc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Mc.apply(this,arguments)};(function(n){sQ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,o=t.arrowInfo,i=t.style,r=o.start,s=o.end,a={start:r,end:s,offset:i.offset,verticalLength:i.verticalLength,type:"end"},l=Da(a),d=l.leftX,c=l.leftY,p=l.rightX,f=l.rightY;return Mc({d:"M".concat(d," ").concat(c," L").concat(s.x," ").concat(s.y," L").concat(p," ").concat(f," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),o=t.d,i=t.strokeWidth,r=t.stroke,s=t.fill;return Pe(Ma,{d:o,fill:s,strokeWidth:i,stroke:r})},e.prototype.render=function(){return Pe("g",{className:"lf-arrow",children:this.getShape()})},e})(Kt);var aQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),fa=function(){return fa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},fa.apply(this,arguments)},lQ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Zu=(function(n){aQ(e,n);function e(){var t=n.call(this)||this;return t.textRef=zu(),t.handleHover=function(o,i){var r=t.props,s=r.model,a=r.graphModel.eventCenter;s.setHovered(o);var l=o?_t.EDGE_MOUSEENTER:_t.EDGE_MOUSELEAVE,d=s.getData();a.emit(l,{data:d,e:i})},t.setHoverOn=function(o){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,o))},t.setHoverOff=function(o){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,o))},t.handleContextMenu=function(o){o.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,r=i.model,s=i.graphModel,a=s.editConfigModel,l=s.getPointByClient({x:o.clientX,y:o.clientY});s.setElementStateById(r.id,ln.SHOW_MENU,l.domOverlayPosition),a.isSilentMode||t.toFront(),r.isSelected||s.selectEdgeById(r.id);var d=r==null?void 0:r.getData();s.eventCenter.emit(_t.EDGE_CONTEXTMENU,{data:d,e:o,position:l})},t.handleMouseDown=function(o){o.stopPropagation(),t.startTime=new Date().getTime(),t.longPressTimer&&clearTimeout(t.longPressTimer),o.pointerType==="touch"&&(t.longPressTimer=window.setTimeout(function(){t.props.model.isDragging||t.handleContextMenu(o)},500))},t.handleMouseUp=function(){var o=t.props.model;t.mouseUpDrag=o.isDragging,t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=void 0)},t.handleClick=function(o){if(t.startTime&&!t.mouseUpDrag){var i=o.button===2;if(!i){var r=o.detail===2,s=t.props,a=s.model,l=s.graphModel,d=a==null?void 0:a.getData(),c=l.getPointByClient({x:o.clientX,y:o.clientY});if(r){var p=l.editConfigModel,f=l.textEditElement,h=a.id,v=a.text,y=a.modelType;if(f&&f.id===h&&l.setElementStateById(h,ln.DEFAULT),p.edgeTextEdit&&v.editable&&(a.setSelected(!1),l.setElementStateById(h,ln.TEXT_EDIT)),y===Gt.POLYLINE_EDGE){var g=a,_=l.getPointByClient({x:o.x,y:o.y}).canvasOverlayPosition,b=_.x,C=_.y;g.dbClickPosition=Vg({x:b,y:C},g.points)}l.eventCenter.emit(_t.EDGE_DBCLICK,{data:d,e:o,position:c})}else l.eventCenter.emit(_t.ELEMENT_CLICK,{data:d,e:o,position:c}),l.eventCenter.emit(_t.EDGE_CLICK,{data:d,e:o,position:c});var T=l.editConfigModel;l.selectEdgeById(a.id,Hg(o,T)),T.isSilentMode||t.toFront()}}},t.handleFocus=function(){var o=t.props,i=o.model,r=o.graphModel;r.eventCenter.emit(_t.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var o=t.props,i=o.model,r=o.graphModel;r.eventCenter.emit(_t.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return Pe("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,o=this.props,i=o.model,r=o.graphModel,s=r.editConfigModel;if(s.edgeTextMode!==jo.TEXT||i.state===ln.TEXT_EDIT)return null;if(i.text){var a=!1;return s.edgeTextDraggable&&i.text.draggable&&(a=!0),Pe(qZ,{ref:this.textRef,editable:s.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:r,draggable:a})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r=t.isSelected,s=this.state.hover;return{start:o,end:i,hover:s,isSelected:r}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint;return[o,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,o=t.id,i=t.getArrowStyle(),r=i.refY,s=r===void 0?0:r,a=i.refX,l=a===void 0?2:a,d=lQ(this.getLastTwoPoints(),2),c=d[0],p=d[1],f="auto";if(c&&p){var h=p.x-c.x,v=p.y-c.y;if(h!==0||v!==0){var y=bK(yK({x:h,y:v}));Number.isFinite(y)&&!Number.isNaN(y)&&(f=y)}}return Pe("g",{children:Pe("defs",{children:[Pe("marker",{id:"marker-start-".concat(o),refX:-l,refY:s,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),Pe("marker",{id:"marker-end-".concat(o),refX:l,refY:s,overflow:"visible",orient:f,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,o){var i=o.stroke,r=o.fill,s=r===void 0?i:r,a=o.strokeWidth,l=o.offset,d=l===void 0?10:l,c=o.verticalLength,p=o.strokeLinecap,f=o.strokeLinejoin,h=o.transform,v="";switch(t){case"solid":v="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(c," L").concat(3*d/4,",-").concat(c," Z");break;case"hollow":v="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(c," L").concat(-d/4,",0 L").concat(3*d/4,",-").concat(c," L").concat(-d/4,",0 Z");break;case"diamond":v="M".concat(-d/2,",0 L0,").concat(c," L").concat(d/2,",0 L0,-").concat(c," L").concat(-d/2,",0 Z");break;case"circle":v="M".concat(-d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(-d/2,",0 Z");break;default:v="";break}return Pe("path",{d:v,stroke:i,fill:s,strokeWidth:a,strokeLinecap:p,strokeLinejoin:f,transform:h})},e.prototype.getStartArrow=function(){var t=this.props.model,o=t.getArrowStyle(),i=o.stroke,r=o.strokeWidth,s=o.offset,a=o.verticalLength,l=o.startArrowType,d=l===void 0?"none":l,c=o.strokeLinecap,p=o.strokeLinejoin;return this.getArrowPath(d,{stroke:i,strokeWidth:r,offset:s,verticalLength:a,strokeLinecap:c,strokeLinejoin:p})},e.prototype.getEndArrow=function(){var t=this.props.model,o=t.getArrowStyle(),i=o.stroke,r=o.strokeWidth,s=o.offset,a=o.verticalLength,l=o.endArrowType,d=l===void 0?"solid":l,c=o.strokeLinecap,p=o.strokeLinejoin;return this.getArrowPath(d,{stroke:i,strokeWidth:r,offset:s,verticalLength:a,strokeLinecap:c,strokeLinejoin:p,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,o,i){var r=i.getAdjustPointStyle();return Pe(Ss,fa({className:"lf-edge-adjust-point"},r,{x:t,y:o}))},e.prototype.getAdjustPoints=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.adjustEdgeStartAndEnd,a=r.adjustEdgeStart,l=r.adjustEdgeEnd,d=o.getAdjustStart(),c=o.getAdjustEnd();return Pe("g",{children:[s&&a&&Pe(Xh,fa({type:mi.SOURCE},d,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:i})),s&&l&&Pe(Xh,fa({type:mi.TARGET},c,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return Pe("g",{})},e.prototype.getAppend=function(){return Pe("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,o=t.graphModel,i=t.model;o.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,o=t.isSelected,i=t.isHitable,r=t.isShowAdjustPoint;return Pe("g",{children:[Pe("g",{className:["lf-edge",!i&&"pointer-none",o&&"lf-edge-selected"].filter(Boolean).join(" "),style:{touchAction:"none",WebkitTouchCallout:"none"},onClick:this.handleClick,onContextMenu:this.handleContextMenu,onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onPointerCancel:this.handleMouseUp,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),r&&o?this.getAdjustPoints():""]})},e.isObserved=!1,e})(Kt),uQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Tc=function(){return Tc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Tc.apply(this,arguments)},dQ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},$c=(function(n){uQ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.getEdgeStyle(),i=t,r=i.path,s=i.isAnimation,a=i.arrowConfig,l=t.getEdgeAnimationStyle(),d=l.strokeDasharray,c=l.stroke,p=l.strokeDashoffset,f=l.animationName,h=l.animationDuration,v=l.animationIterationCount,y=l.animationTimingFunction,g=l.animationDirection;return Pe(Ma,Tc({d:r},o,a,s?{strokeDasharray:d,stroke:c,style:{strokeDashoffset:p,animationName:f,animationDuration:h,animationIterationCount:v,animationTimingFunction:y,animationDirection:g}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return Pe(Ma,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,o=this.state.hover,i=t.isSelected,r=t.getArrowStyle().offset,s=t.pointsList.map(function(p){return{x:p.x,y:p.y}}),a=dQ(Ah(s,r),2),l=a[0],d=a[1],c={start:l,end:d,hover:o,isSelected:i};return c},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.getArrowStyle().offset,i=t.pointsList.map(function(r){return{x:r.x,y:r.y}});return Ah(i,o)},e})(Zu),cQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Rc=function(){return Rc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Rc.apply(this,arguments)},Wh=(function(n){cQ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r=t.isAnimation,s=t.arrowConfig,a=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),d=l.strokeDasharray,c=l.stroke,p=l.strokeDashoffset,f=l.animationName,h=l.animationDuration,v=l.animationIterationCount,y=l.animationTimingFunction,g=l.animationDirection;return Pe(ks,Rc({},a,{x1:o.x,y1:o.y,x2:i.x,y2:i.y},s,r?{strokeDasharray:d,stroke:c,style:{strokeDashoffset:p,animationName:f,animationDuration:h,animationIterationCount:v,animationTimingFunction:y,animationDirection:g}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r={start:o,end:i},s=SJ(r),a=s.d,l=s.strokeWidth,d=s.fill,c=s.strokeDasharray,p=s.stroke;return Pe(Ma,{d:a,fill:d,strokeWidth:l,stroke:p,strokeDasharray:c})},e})(Zu),pQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),kr=function(){return kr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},kr.apply(this,arguments)},fQ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ds=(function(n){pQ(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(){var o=t.props.model;o.dragAppendStart(),t.isShowAdjustPointTemp=o.isShowAdjustPoint,o.isShowAdjustPoint=!1},t.onDragging=function(o){var i=o.deltaX,r=o.deltaY,s=t.props,a=s.model,l=s.graphModel;t.isDragging=!0;var d=l.transformModel,c=l.editConfigModel,p=fQ(d.fixDeltaXY(i,r),2),f=p[0],h=p[1],v=a,y=c.adjustEdgeMiddle;y?t.appendInfo=v.dragAppendSimple(t.appendInfo,{x:f,y:h}):t.appendInfo=v.dragAppend(t.appendInfo,{x:f,y:h})},t.onDragEnd=function(){var o,i=t.props,r=i.model,s=i.graphModel.eventCenter,a=r;a.dragAppendEnd(),t.isDragging=!1,a.isShowAdjustPoint=(o=t.isShowAdjustPointTemp)!==null&&o!==void 0?o:!1,t.appendInfo=void 0,s.emit(_t.EDGE_ADJUST,{data:a.getData()})},t.beforeDragStart=function(o,i){i.draggable&&t.drag.handleMouseDown(o),t.appendInfo=i},t.drag=new zo({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,o=t.points,i=t.isAnimation,r=t.arrowConfig,s=t.getEdgeStyle(),a=t.getEdgeAnimationStyle(),l=a.strokeDasharray,d=a.stroke,c=a.strokeDashoffset,p=a.animationName,f=a.animationDuration,h=a.animationIterationCount,v=a.animationTimingFunction,y=a.animationDirection;return Pe(eK,kr({points:o},s,r,i?{strokeDasharray:l,stroke:d,style:{strokeDashoffset:c,animationName:p,animationDuration:f,animationIterationCount:h,animationTimingFunction:v,animationDirection:y}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,o=t.points,i=t.isSelected,r=this.state.hover,s=Lr(o),a=s[0],l=s[0];return s.length>=2&&(a=s[s.length-2],l=s[s.length-1]),{start:a,end:l,hover:r,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.points,i=Lr(o),r=i[0],s=i[0];return i.length>=2&&(r=i[i.length-2],s=i[i.length-1]),[r,s]},e.prototype.getAppendAttributes=function(t){var o=t.start,i=t.end,r;if(o.x===i.x&&o.y===i.y)r="";else{var s={start:o,end:i,offset:10,verticalLength:5},a=Da(kr(kr({},s),{type:"start"})),l=Da(kr(kr({},s),{type:"end"}));r="M".concat(a.leftX," ").concat(a.leftY,`
      L`).concat(a.rightX," ").concat(a.rightY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(l.leftX," ").concat(l.leftY," z")}return{d:r,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var o=this.getAppendAttributes(t),i=o.d,r=o.strokeWidth,s=o.fill,a=o.strokeDasharray,l=o.stroke;return Pe(Ma,{d:i,fill:s,strokeWidth:r,stroke:l,strokeDasharray:a})},e.prototype.getAppendWidth=function(){for(var t=this,o=this.props,i=o.model,r=o.graphModel,s=i.pointsList,a=i.draggable,l=[],d=s.length,c=function(h){var v="lf-polyline-append",y={start:{x:s[h].x,y:s[h].y},end:{x:s[h+1].x,y:s[h+1].y},startIndex:h,endIndex:h+1,direction:wn.HORIZONTAL,draggable:!0},g=Pe("g",{className:v,children:p.getAppendShape(y)}),_=r.editConfigModel,b=_.adjustEdge,C=_.adjustEdgeMiddle;if(b&&a){var T=y.startIndex,M=y.endIndex,S=C&&(T===0||M===d-1);y.draggable=!S,y.start.x===y.end.x?(y.draggable&&(v+="-ew-resize"),y.direction=wn.VERTICAL):y.start.y===y.end.y&&(y.draggable&&(v+="-ns-resize"),y.direction=wn.HORIZONTAL),g=Pe("g",{className:p.isDragging?"lf-dragging":"lf-drag-able",onPointerDown:function(k){return t.beforeDragStart(k,y)},children:Pe("g",{className:v,children:p.getAppendShape(y)})})}l.push(g)},p=this,f=0;f<d-1;f++)c(f);return Pe("g",{children:l})},e})(Zu),ss=function(){return ss=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ss.apply(this,arguments)},hQ=(function(){function n(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,t.docPointerMove&&window.document.removeEventListener("pointermove",t.docPointerMove),t.docPointerUp&&window.document.removeEventListener("pointerup",t.docPointerUp)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(ss(ss({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(t.lf.graphModel.eventCenter.emit(_t.BLANK_CANVAS_MOUSEMOVE,{e:i}),i.preventDefault(),t.fakeNode){var r=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),s=r.x,a=r.y;t.fakeNode.moveTo(s,a);var l=t.fakeNode.getData();t.lf.setNodeSnapLine(l),t.lf.graphModel.eventCenter.emit(_t.NODE_DND_DRAG,{data:l,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(ss(ss({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),_t.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var o=e.lf;this.lf=o}return n.prototype.clientToLocalPoint=function(e){var t=e.x,o=e.y,i=qa(this.lf.options,["grid","size"]),r=this.lf.graphModel.getPointByClient({x:t,y:o}),s=r.canvasOverlayPosition,a=s.x,l=s.y,d=this.lf.graphModel.editConfigModel.snapGrid;return{x:Cs(a,i,d),y:Cs(l,i,d)}},n.prototype.isInsideCanvas=function(e){var t=this.lf.graphModel.rootEl.querySelector('[name="canvas-overlay"]'),o=window.document.elementFromPoint(e.clientX,e.clientY);return o===t||o!==null&&!!t&&t.contains(o)},n.prototype.startDrag=function(e){var t=this,o=this.lf.graphModel.editConfigModel;o!=null&&o.isSilentMode||(this.nodeConfig=e,this.docPointerMove=function(i){if(t.nodeConfig){if(!t.isInsideCanvas(i)){t.onDragLeave();return}if(!t.fakeNode){t.dragEnter(i);return}t.onDragOver(i)}},this.docPointerUp=function(i){t.nodeConfig&&(t.isInsideCanvas(i)?t.onDrop(i):t.onDragLeave(),i.preventDefault(),i.stopPropagation(),t.stopDrag())},window.document.addEventListener("pointermove",this.docPointerMove),window.document.addEventListener("pointerup",this.docPointerUp))},n})();function vQ(n,e){n.on("node:mousemove",function(t){var o=t.data;e.setNodeSnapLine(o)}),n.on("node:mouseup",function(){e.clearSnapline()})}var _Q=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Pi=function(){return Pi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Pi.apply(this,arguments)},gQ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},mQ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},yQ=(function(n){_Q(e,n);function e(t){var o=n.call(this,t)||this;return o.ref=zu(),o.__prevText={type:"",text:"",id:""},o.keyupHandler=function(i){var r=o.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(r==null||r.setElementState(ln.DEFAULT))},o.inputHandler=function(i){var r=i.target.innerText,s=o.props.graphModel.textEditElement;s&&(o.__prevText={type:s.type,text:r.replace(/(\r\n)+$|(\n)+$/,""),id:s.id})},o.keydownHandler=function(i){i.stopPropagation()},o.state={style:{left:0,top:0}},o}return e.getDerivedStateFromProps=function(t){var o,i=t.textEditElement,r=t.graphModel,s=r.transformModel,a=r.theme,l=a.inputText,d;if(i){if(!(!((o=i.text)===null||o===void 0)&&o.value)&&i.BaseType===En.EDGE){var c=i.text,p=i.textPosition,f=p.x,h=p.y;c.x=f,c.y=h,i.setText(c)}var v={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===En.EDGE){var y=a.edgeText,g=y.overflowMode,_=y.lineHeight,b=y.wrapPadding,C=y.textWidth;C&&g==="autoWrap"&&(d=Pi(Pi({},v),{width:C,minWidth:C,lineHeight:_,padding:b}))}else if(i.BaseType===En.NODE){var T=a.nodeText,g=T.overflowMode,_=T.lineHeight,b=T.wrapPadding,C=T.textWidth,M=i.width,S=i.modelType,k=i.textWidth,A=k||C||M;(S!==Gt.TEXT_NODE&&g==="autoWrap"||S===Gt.TEXT_NODE&&C)&&(d=Pi(Pi({},v),{width:A,minWidth:A,lineHeight:_,padding:b}))}var $=i.text,B=$.x,O=$.y,P=mQ(s.CanvasPointToHtmlPoint([B,O]),2),E=P[0],D=P[1];return{style:Pi(Pi({left:E,top:D},d),l)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var o=this.__prevText,i=o.text,r=o.id;t.updateText(r,i),t.eventCenter.emit(_t.TEXT_UPDATE,{data:Pi({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var o=document.createRange();o.selectNodeContents(t),o.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(o)}},e.prototype.render=function(){var t,o=this.props.graphModel.textEditElement,i=this.state.style;return o?Pe("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=o.text)===null||t===void 0?void 0:t.value},o.id):null},e.toolName="text-edit-tool",e=gQ([no],e),e})(Kt),bQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xQ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},xd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},wQ=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},CQ=(function(n){bQ(e,n);function e(t){var o=n.call(this,t)||this;o.handleMouseDown=function(a){o.stepDrag.handleMouseDown(a)},o.handleWheelEvent=function(a){var l,d;a.preventDefault();var c=a.deltaX,p=a.deltaY,f=a.clientX,h=a.clientY,v=a.ctrlKey,y=new WheelEvent("wheel",{deltaX:c,deltaY:p,clientX:f,clientY:h,ctrlKey:v});(d=(l=o.props.lf.container)===null||l===void 0?void 0:l.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||d===void 0||d.dispatchEvent(y)},o.onDragging=function(a){var l=a.deltaX,d=a.deltaY,c=o.props,p=c.graphModel,f=c.lf,h=f.getTransform(),v=h.SCALE_X,y=h.SCALE_Y,g=p.getSelectElements(!0);p.moveNodes(g.nodes.map(function(_){return _.id}),l/v,d/y)},o.handleContextMenu=function(a){a.preventDefault();var l=o.props,d=l.graphModel,c=l.graphModel,p=c.eventCenter,f=c.selectElements,h=d.getPointByClient({x:a.clientX,y:a.clientY}),v={nodes:[],edges:[]},y=wQ([],xd(f.values()),!1);y.forEach(function(g){g.BaseType===En.NODE&&v.nodes.push(g.getData()),g.BaseType===En.EDGE&&v.edges.push(g.getData())}),p.emit(_t.SELECTION_CONTEXTMENU,{data:v,e:a,position:h})};var i=t.graphModel,r=i.gridSize,s=i.eventCenter;return o.stepDrag=new zo({onDragging:o.onDragging,step:r,eventType:"SELECTION",eventCenter:s}),o}return e.prototype.render=function(){var t,o,i=this.props.graphModel,r=i.selectElements,s=i.transformModel,a=this.props.lf.getTransform(),l=a.SCALE_X,d=a.SCALE_Y;if(!(r.size<=1)){var c=Number.MAX_SAFE_INTEGER,p=Number.MAX_SAFE_INTEGER,f=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;r.forEach(function(y){var g;y.BaseType===En.NODE&&(g=lJ(y)),y.BaseType===En.EDGE&&(g=pJ(y)),g!==void 0&&(c=Math.min(c,g.x),p=Math.min(p,g.y),f=Math.max(f,g.x1),h=Math.max(h,g.y1))}),t=xd(s.CanvasPointToHtmlPoint([c,p]),2),c=t[0],p=t[1],o=xd(s.CanvasPointToHtmlPoint([f,h]),2),f=o[0],h=o[1];var v={left:"".concat(c-20*l/2,"px"),top:"".concat(p-20*d/2,"px"),width:"".concat(f-c+20*l,"px"),height:"".concat(h-p+20*d,"px"),"border-width":"".concat(2*l,"px")};return Pe("div",{className:"lf-multiple-select",style:v,onPointerDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=xQ([no],e),e})(Kt),wd=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},kQ=[yQ,CQ],SQ=(function(){function n(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,Vt(kQ,function(r){t.isDisabled(r.toolName)||t.registerTool(r.toolName,r)});var o=e.graphModel,i=o.eventCenter;i.on("".concat(_t.GRAPH_TRANSFORM,",").concat(_t.NODE_CLICK,",").concat(_t.BLANK_CLICK," "),function(){var r,s=o.textEditElement,a=o.editConfigModel,l=a.edgeTextEdit,d=a.nodeTextEdit;(l||d)&&s&&((r=o.textEditElement)===null||r===void 0||r.setElementState(ln.DEFAULT))})}return n.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},n.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},n.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},n.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},n.prototype.getTools=function(){return Array.from(this.toolMap.values())},n.prototype.getInstance=function(){return this.instance},n.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},wd([Re],n.prototype,"toolMap",void 0),wd([$e],n.prototype,"disableTool",null),wd([$e],n.prototype,"enableTool",null),n})();function EQ(n){throw new Error("[mobx-utils] "+n)}function hu(n,e){e===void 0&&(e="Illegal state"),n||EQ(e)}var Qg=function(n){return n&&n!==Object.prototype&&Object.getOwnPropertyNames(n).concat(Qg(Object.getPrototypeOf(n))||[])},AQ=function(n){var e=Qg(n),t=e.filter(function(o,i){return e.indexOf(o)===i});return t},DQ=function(n){return AQ(n).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},em="pending",vu="fulfilled",Op="rejected";function OQ(n){switch(this.state){case em:return n.pending&&n.pending(this.value);case Op:return n.rejected&&n.rejected(this.value);case vu:return n.fulfilled?n.fulfilled(this.value):this.value}}function Yh(n,e){if(hu(arguments.length<=2,"fromPromise expects up to two arguments"),hu(typeof n=="function"||typeof n=="object"&&n&&typeof n.then=="function","Please pass a promise or function to fromPromise"),n.isPromiseBasedObservable===!0)return n;typeof n=="function"&&(n=new Promise(n));var t=n;n.then($e("observableFromPromise-resolve",function(i){t.value=i,t.state=vu}),$e("observableFromPromise-reject",function(i){t.value=i,t.state=Op})),t.isPromiseBasedObservable=!0,t.case=OQ;var o=e&&e.state===vu?e.value:void 0;return nc(t,{value:o,state:em},{},{deep:!1}),t}(function(n){n.reject=$e("fromPromise.reject",function(t){var o=n(Promise.reject(t));return o.state=Op,o.value=t,o});function e(t){t===void 0&&(t=void 0);var o=n(Promise.resolve(t));return o.state=vu,o.value=t,o}n.resolve=$e("fromPromise.resolve",e)})(Yh||(Yh={}));var kl=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r};(function(){function n(e,t){var o=this;oY(function(){o.current=t,o.subscription=e.subscribe(o)})}return n.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},n.prototype.next=function(e){this.current=e},n.prototype.complete=function(){this.dispose()},n.prototype.error=function(e){this.current=e,this.dispose()},kl([Re.ref],n.prototype,"current",void 0),kl([$e.bound],n.prototype,"next",null),kl([$e.bound],n.prototype,"complete",null),kl([$e.bound],n.prototype,"error",null),n})();var _u=function(){return _u=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_u.apply(this,arguments)},Ws=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},NQ=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function n(e){var t=this;this.model=e,this.localValues=Re.map({}),this.localComputedValues=Re.map({}),this.isPropertyDirty=function(o){return t.localValues.has(o)},hu(ui(e),"createViewModel expects an observable object"),DQ(e).forEach(function(o){if(!(o===Rt||o==="__mobxDidRunLazyInitializers")){if(hu(NQ.indexOf(o)===-1,"The propertyname "+o+" is reserved and cannot be used with viewModels"),If(e,o)){var i=Yu(e,o).derivation;t.localComputedValues.set(o,bn(i.bind(t)))}var r=Object.getOwnPropertyDescriptor(e,o),s=r?{enumerable:r.enumerable}:{};Object.defineProperty(t,o,_u(_u({},s),{configurable:!0,get:function(){return If(e,o)?t.localComputedValues.get(o).get():t.isPropertyDirty(o)?t.localValues.get(o):t.model[o]},set:$e(function(a){a!==t.model[o]?t.localValues.set(o,a):t.localValues.delete(o)})}))}})}return Object.defineProperty(n.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),n.prototype.submit=function(){var e=this;ws(this.localValues).forEach(function(t){var o=e.localValues.get(t),i=e.model[t];Ni(i)?i.replace(o):_o(i)?(i.clear(),i.merge(o)):dY(o)||(e.model[t]=o)}),this.localValues.clear()},n.prototype.reset=function(){this.localValues.clear()},n.prototype.resetProperty=function(e){this.localValues.delete(e)},Ws([bn],n.prototype,"isDirty",null),Ws([bn],n.prototype,"changedValues",null),Ws([$e.bound],n.prototype,"submit",null),Ws([$e.bound],n.prototype,"reset",null),Ws([$e.bound],n.prototype,"resetProperty",null),n})();function Cd(n){if(!n)return"ROOT";for(var e=[];n.parent;)e.push(n.path),n=n.parent;return e.reverse().join("/")}function kd(n){return ui(n)||Ni(n)||_o(n)}function MQ(n,e){var t=new WeakMap;function o(a){var l=t.get(a.object);i(a,l),e(a,Cd(l),n)}function i(a,l){switch(a.type){case"add":r(a.newValue,l,a.name);break;case"update":s(a.oldValue),r(a.newValue,l,a.name||""+a.index);break;case"remove":case"delete":s(a.oldValue);break;case"splice":a.removed.map(s),a.added.forEach(function(p,f){return r(p,l,""+(a.index+f))});for(var d=a.index+a.addedCount;d<a.object.length;d++)if(kd(a.object[d])){var c=t.get(a.object[d]);c&&(c.path=""+d)}break}}function r(a,l,d){if(kd(a)){var c=t.get(a);if(c){if(c.parent!==l||c.path!==d)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Cd(l)+"/"+d+"',")+(" but it already exists at '"+Cd(c.parent)+"/"+c.path+"'"))}else{var p={parent:l,path:d,dispose:Cg(a,o)};t.set(a,p),fY(a).forEach(function(f){var h=f[0],v=f[1];return r(v,p,h)})}}}function s(a){if(kd(a)){var l=t.get(a);if(!l)return;t.delete(a),l.dispose(),pY(a).forEach(s)}}return r(n,void 0,""),function(){s(n)}}var TQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)i.hasOwnProperty(r)&&(o[r]=i[r])},n(e,t)};return function(e,t){n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){TQ(e,n);function e(t,o,i){var r=i===void 0?{}:i,s=r.name,a=s===void 0?"ogm"+(Math.random()*1e3|0):s,l=r.keyToName,d=l===void 0?function(f){return""+f}:l,c=n.call(this)||this;c._keyToName=d,c._groupBy=o,c._ogmInfoKey=Symbol("ogmInfo"+a),c._base=t;for(var p=0;p<t.length;p++)c._addItem(t[p]);return c._disposeBaseObserver=Cg(c._base,function(f){if(f.type==="splice")Qo(function(){for(var h=0,v=f.removed;h<v.length;h++){var y=v[h];c._removeItem(y)}for(var g=0,_=f.added;g<_.length;g++){var b=_[g];c._addItem(b)}});else if(f.type==="update")Qo(function(){c._removeItem(f.oldValue),c._addItem(f.newValue)});else throw new Error("illegal state")}),c}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,o){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var o=this._base[t],i=o[this._ogmInfoKey];i.reaction(),delete o[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var o=n.prototype.get.call(this,t);return o===void 0&&(o=Re([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),n.prototype.set.call(this,t,o)),o},e.prototype._removeFromGroupArr=function(t,o){var i=n.prototype.get.call(this,t);i.length===1?n.prototype.delete.call(this,t):(o===i.length-1||(i[o]=i[i.length-1],i[o][this._ogmInfoKey].groupArrIndex=o),i.length--)},e.prototype._addItem=function(t){var o=this,i=this._groupBy(t),r=this._getGroupArr(i),s={groupByValue:i,groupArrIndex:r.length,reaction:_g(function(){return o._groupBy(t)},function(a,l){var d=t[o._ogmInfoKey];o._removeFromGroupArr(d.groupByValue,d.groupArrIndex);var c=o._getGroupArr(a),p=c.length;c.push(t),d.groupByValue=a,d.groupArrIndex=p})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:s}),r.push(t)},e.prototype._removeItem=function(t){var o=t[this._ogmInfoKey];this._removeFromGroupArr(o.groupByValue,o.groupArrIndex),o.reaction(),delete t[this._ogmInfoKey]},e})(Cp);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var Pc=function(){return Pc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Pc.apply(this,arguments)},$Q=(function(){function n(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return n.prototype.add=function(e){Ip(wy(this.undos),e)||(this.undos.push(e),Ip(this.curData,e)||(this.redos=[]),this.eventCenter.emit(_t.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},n.prototype.undoAble=function(){return this.undos.length>1},n.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=Dt(t),t}},n.prototype.redoAble=function(){return this.redos.length>0},n.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=Dt(e),e}},n.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=MQ(e,u_(function(){var o=e.modelToHistoryData();o&&t.add(Pc({},o))},this.waitTime))},n.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},n})(),Sd={exports:{}},Jh;function RQ(){return Jh||(Jh=1,(function(n){(function(e,t,o){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},a={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},l,d=1;d<20;++d)i[111+d]="f"+d;for(d=0;d<=9;++d)i[d+96]=d.toString();function c(k,A,$){if(k.addEventListener){k.addEventListener(A,$,!1);return}k.attachEvent("on"+A,$)}function p(k){if(k.type=="keypress"){var A=String.fromCharCode(k.which);return k.shiftKey||(A=A.toLowerCase()),A}return i[k.which]?i[k.which]:r[k.which]?r[k.which]:String.fromCharCode(k.which).toLowerCase()}function f(k,A){return k.sort().join(",")===A.sort().join(",")}function h(k){var A=[];return k.shiftKey&&A.push("shift"),k.altKey&&A.push("alt"),k.ctrlKey&&A.push("ctrl"),k.metaKey&&A.push("meta"),A}function v(k){if(k.preventDefault){k.preventDefault();return}k.returnValue=!1}function y(k){if(k.stopPropagation){k.stopPropagation();return}k.cancelBubble=!0}function g(k){return k=="shift"||k=="ctrl"||k=="alt"||k=="meta"}function _(){if(!l){l={};for(var k in i)k>95&&k<112||i.hasOwnProperty(k)&&(l[i[k]]=k)}return l}function b(k,A,$){return $||($=_()[k]?"keydown":"keypress"),$=="keypress"&&A.length&&($="keydown"),$}function C(k){return k==="+"?["+"]:(k=k.replace(/\+{2}/g,"+plus"),k.split("+"))}function T(k,A){var $,B,O,P=[];for($=C(k),O=0;O<$.length;++O)B=$[O],a[B]&&(B=a[B]),A&&A!="keypress"&&s[B]&&(B=s[B],P.push("shift")),g(B)&&P.push(B);return A=b(B,P,A),{key:B,modifiers:P,action:A}}function M(k,A){return k===null||k===t?!1:k===A?!0:M(k.parentNode,A)}function S(k){var A=this;if(k=k||t,!(A instanceof S))return new S(k);A.target=k,A._callbacks={},A._directMap={};var $={},B,O=!1,P=!1,E=!1;function D(z){z=z||{};var V=!1,J;for(J in $){if(z[J]){V=!0;continue}$[J]=0}V||(E=!1)}function N(z,V,J,oe,W,q){var re,ue,xe=[],Te=J.type;if(!A._callbacks[z])return[];for(Te=="keyup"&&g(z)&&(V=[z]),re=0;re<A._callbacks[z].length;++re)if(ue=A._callbacks[z][re],!(!oe&&ue.seq&&$[ue.seq]!=ue.level)&&Te==ue.action&&(Te=="keypress"&&!J.metaKey&&!J.ctrlKey||f(V,ue.modifiers))){var me=!oe&&ue.combo==W,pe=oe&&ue.seq==oe&&ue.level==q;(me||pe)&&A._callbacks[z].splice(re,1),xe.push(ue)}return xe}function F(z,V,J,oe){A.stopCallback(V,V.target||V.srcElement,J,oe)||z(V,J)===!1&&(v(V),y(V))}A._handleKey=function(z,V,J){var oe=N(z,V,J),W,q={},re=0,ue=!1;for(W=0;W<oe.length;++W)oe[W].seq&&(re=Math.max(re,oe[W].level));for(W=0;W<oe.length;++W){if(oe[W].seq){if(oe[W].level!=re)continue;ue=!0,q[oe[W].seq]=1,F(oe[W].callback,J,oe[W].combo,oe[W].seq);continue}ue||F(oe[W].callback,J,oe[W].combo)}var xe=J.type=="keypress"&&P;J.type==E&&!g(z)&&!xe&&D(q),P=ue&&J.type=="keydown"};function Y(z){typeof z.which!="number"&&(z.which=z.keyCode);var V=p(z);if(V){if(z.type=="keyup"&&O===V){O=!1;return}A.handleKey(V,h(z),z)}}function L(){clearTimeout(B),B=setTimeout(D,1e3)}function j(z,V,J,oe){$[z]=0;function W(Te){return function(){E=Te,++$[z],L()}}function q(Te){F(J,Te,z),oe!=="keyup"&&(O=p(Te)),setTimeout(D,10)}for(var re=0;re<V.length;++re){var ue=re+1===V.length,xe=ue?q:W(oe||T(V[re+1]).action);le(V[re],xe,oe,z,re)}}function le(z,V,J,oe,W){A._directMap[z+":"+J]=V,z=z.replace(/\s+/g," ");var q=z.split(" "),re;if(q.length>1){j(z,q,V,J);return}re=T(z,J),A._callbacks[re.key]=A._callbacks[re.key]||[],N(re.key,re.modifiers,{type:re.action},oe,z,W),A._callbacks[re.key][oe?"unshift":"push"]({callback:V,modifiers:re.modifiers,action:re.action,seq:oe,level:W,combo:z})}A._bindMultiple=function(z,V,J){for(var oe=0;oe<z.length;++oe)le(z[oe],V,J)},c(k,"keypress",Y),c(k,"keydown",Y),c(k,"keyup",Y)}S.prototype.bind=function(k,A,$){var B=this;return k=k instanceof Array?k:[k],B._bindMultiple.call(B,k,A,$),B},S.prototype.unbind=function(k,A){var $=this;return $.bind.call($,k,function(){},A)},S.prototype.trigger=function(k,A){var $=this;return $._directMap[k+":"+A]&&$._directMap[k+":"+A]({},k),$},S.prototype.reset=function(){var k=this;return k._callbacks={},k._directMap={},k},S.prototype.stopCallback=function(k,A){var $=this;if((" "+A.className+" ").indexOf(" mousetrap ")>-1||M(A,$.target))return!1;if("composedPath"in k&&typeof k.composedPath=="function"){var B=k.composedPath()[0];B!==k.target&&(A=B)}return A.tagName=="INPUT"||A.tagName=="SELECT"||A.tagName=="TEXTAREA"||A.isContentEditable},S.prototype.handleKey=function(){var k=this;return k._handleKey.apply(k,arguments)},S.addKeycodes=function(k){for(var A in k)k.hasOwnProperty(A)&&(i[A]=k[A]);l=null},S.init=function(){var k=S(t);for(var A in k)A.charAt(0)!=="_"&&(S[A]=(function($){return function(){return k[$].apply(k,arguments)}})(A))},S.init(),e.Mousetrap=S,n.exports&&(n.exports=S)})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(Sd)),Sd.exports}var PQ=RQ();const LQ=Ga(PQ);var er=function(){return er=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},er.apply(this,arguments)},BQ=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},hi=null;function Kh(n,e){var t,o;return n.x+=e,n.y+=e,Id(n.text)||(n.text.x+=e,n.text.y+=e),Id((t=n.properties)===null||t===void 0?void 0:t._label)||(o=n.properties)===null||o===void 0||o._label.forEach(function(i){i.x+=e,i.y+=e}),n}function Zh(n,e){return n.startPoint&&(n.startPoint.x+=e,n.startPoint.y+=e),n.endPoint&&(n.endPoint.x+=e,n.endPoint.y+=e),n.pointsList&&n.pointsList.length>0&&n.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Id(n.text)||(n.text.x+=e,n.text.y+=e),n}function IQ(n,e){var t=n.x,o=n.y,i=n.text,r=i?{x:i.x+e,y:i.y+e,value:i.value}:void 0;return er(er({},n),{id:"",x:t+e,y:o+e,text:r})}function jQ(n,e){var t=n.startPoint,o=n.endPoint,i=n.pointsList,r=n.text,s=BQ(n,["startPoint","endPoint","pointsList","text"]);s.id="";var a={x:t.x+e,y:t.y+e},l={x:o.x+e,y:o.y+e},d=si(i,function(p){return{x:p.x+e,y:p.y+e}}),c=r?er(er({},r),{x:r.x+e,y:r.y+e}):void 0;return er(er({},s),{startPoint:a,endPoint:l,pointsList:d,text:c})}var Kr=40,Sl=40;function FQ(n,e){var t=n.keyboard,o=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(Sl=Kr,!(o!=null&&o.enabled)||e.textEditElement)return!0;var i=n.options.guards,r=e.getSelectElements(!1),s=i&&i.beforeClone?i.beforeClone(r):!0;return!s||r.nodes.length===0&&r.edges.length===0?(hi=null,!0):(hi=r,hi.nodes.forEach(function(a){return Kh(a,Kr)}),hi.edges.forEach(function(a){return Zh(a,Kr)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(o!=null&&o.enabled)||e.textEditElement)return!0;if(hi&&(hi.nodes||hi.edges)){n.clearSelectElements();var i=n.addElements(hi,Sl);if(!i)return!0;i.nodes.forEach(function(r){return n.selectElementById(r.id,!0)}),i.edges.forEach(function(r){return n.selectElementById(r.id,!0)}),hi.nodes.forEach(function(r){return Kh(r,Kr)}),hi.edges.forEach(function(r){return Zh(r,Kr)}),Sl=Sl+Kr}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(o!=null&&o.enabled)||e.textEditElement?!0:(n.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(o!=null&&o.enabled)||e.textEditElement?!0:(n.redo(),!1)}),t.on(["backspace"],function(){if(!(o!=null&&o.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return n.clearSelectElements(),i.edges.forEach(function(r){return r.id&&n.deleteEdge(r.id)}),i.nodes.forEach(function(r){return r.id&&n.deleteNode(r.id)}),!1})}var VQ=(function(){function n(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new LQ(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return n.prototype.initShortcuts=function(){var e=this,t,o=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(o)if(d_(o))o.forEach(function(a){var l=a.keys,d=a.callback,c=a.action;return e.on(l,d,c)});else{var i=o.keys,r=o.callback,s=o.action;this.on(i,r,s)}},n.prototype.on=function(e,t,o){this.mousetrap.bind(this.getKeys(e),t,o)},Object.defineProperty(n.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),n.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},n.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},n.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},n.prototype.destroy=function(){this.mousetrap.reset()},n.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(o){return t.formatKey(o)})},n.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},n})(),Ji=function(){return Ji=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ji.apply(this,arguments)},El=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ed=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Ad=Symbol("plugin registered by Logicflow.use"),Lc=(function(){function n(e){var t=this,o;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(d,c){return t.viewMap.set(d,c)},this.getView=function(d){return t.viewMap.get(d)};var i=Ea.get(e),r=i.container,s=i.width,a=i.height;this.options=i,this.container=this.initContainer(r,s,a),this.graphModel=new DZ(Ji(Ji({},i),{container:this.container})),this.plugins=(o=i.plugins)!==null&&o!==void 0?o:[];var l=this.graphModel.eventCenter;this.tool=new SQ(this),this.dnd=new hQ({lf:this}),this.history=new $Q(l),this.keyboard=new VQ({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new OZ(this.graphModel,i.snaplineEpsilon),vQ(l,this.snaplineModel)),i.isSilentMode||(FQ(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return n.prototype.initContainer=function(e,t,o){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=o?"".concat(o,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return n.toStringTag},enumerable:!1,configurable:!0}),n.prototype.register=function(e,t,o){if(o===void 0&&(o=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:Zu,BaseEdgeModel:Ku,BaseNode:pr,BaseNodeModel:cr,RectNode:Br,RectNodeModel:As,CircleNode:cu,CircleNodeModel:lu,PolygonNode:fu,PolygonNodeModel:uu,TextNode:Gh,TextNodeModel:Uh,LineEdge:Wh,LineEdgeModel:jh,DiamondNode:Ac,DiamondNodeModel:yc,PolylineEdge:Ds,PolylineEdgeModel:Es,BezierEdge:$c,BezierEdgeModel:mc,EllipseNode:Oc,EllipseNodeModel:bc,HtmlNode:ja,HtmlNodeModel:Ba,h:et,type:e};if(this.viewMap.forEach(function(d){var c=d.extendKey;c&&(i[c]=d)}),this.graphModel.modelMap.forEach(function(d){var c=d.extendKey;c&&(i[c]=d)}),t){var r=t(i),s=r.view,a=r.model,l=s;o&&!l.isObserved&&(l.isObserved=!0,l=no(l)),this.setView(e,l),this.graphModel.setModel(e,a)}},n.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=no(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},n.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),Vt(e,function(o){t.registerElement(o)})},n.prototype.defaultRegister=function(){var e=[{type:"rect",view:Br,model:As},{type:"circle",view:cu,model:lu},{type:"polygon",view:fu,model:uu},{type:"text",view:Gh,model:Uh},{type:"ellipse",view:Oc,model:bc},{type:"diamond",view:Ac,model:yc},{type:"html",view:ja,model:Ba},{type:"line",view:Wh,model:jh},{type:"polyline",view:Ds,model:Es},{type:"bezier",view:$c,model:mc}];this.batchRegister(e)},n.prototype.addNode=function(e,t,o){return t===void 0&&(t=_t.NODE_ADD),this.graphModel.addNode(e,t,o)},n.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var o=t.getData(),i=this.options.guards,r=i!=null&&i.beforeDelete?i.beforeDelete(o):!0;return r&&this.graphModel.deleteNode(e),r},n.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),o=t==null?void 0:t.getData();if(o){var i=this.options.guards,r=i!=null&&i.beforeClone?i.beforeClone(o):!0;if(r)return this.graphModel.cloneNode(e)}},n.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},n.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},n.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},n.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},n.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},n.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},n.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},n.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},n.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var o=new t(Ji(Ji({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(o),o},n.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},n.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},n.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},n.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},n.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},n.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},n.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},n.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,o=e.targetNodeId,i=[],r=this.graphModel.edges;return t&&o?Vt(r,function(s){s.sourceNodeId===t&&s.targetNodeId===o&&i.push(s)}):t?Vt(r,function(s){s.sourceNodeId===t&&i.push(s)}):o&&Vt(r,function(s){s.targetNodeId===o&&i.push(s)}),i},n.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},n.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},n.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var o=t.getData(),i=this.options.guards,r=i!=null&&i.beforeDelete?i.beforeDelete(o):!0;return r&&this.graphModel.deleteEdgeById(e),r},n.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,o=e.targetNodeId;t&&o?this.graphModel.deleteEdgeBySourceAndTarget(t,o):t?this.graphModel.deleteEdgeBySource(t):o&&this.graphModel.deleteEdgeByTarget(o)},n.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},n.prototype.addElements=function(e,t){var o=this,i=e.nodes,r=e.edges;t===void 0&&(t=40);var s={},a={nodes:[],edges:[]};return Vt(i,function(l){var d=l.id,c=o.addNode(l);d&&(s[d]=c.id),a.nodes.push(c)}),Vt(r,function(l){var d=l.sourceNodeId,c=l.targetNodeId;s[d]&&(d=s[d]),s[c]&&(c=s[c]);var p=o.graphModel.addEdge(Ji(Ji({},l),{sourceNodeId:d,targetNodeId:c}));a.edges.push(p)}),a},n.prototype.selectElementById=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=!0),this.graphModel.selectElementById(e,t),!t&&o&&this.graphModel.toFront(e)},n.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},n.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},n.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},n.prototype.getModelById=function(e){return this.graphModel.getElement(e)},n.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},n.prototype.deleteElement=function(e){var t,o,i,r=this.getModelById(e);if(!r)return!1;var s=(t={},t[En.NODE]=this.deleteNode,t[En.EDGE]=this.deleteEdge,t);return(i=(o=s[r.BaseType])===null||o===void 0?void 0:o.call(this,e))!==null&&i!==void 0?i:!1},n.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},n.prototype.getAreaElement=function(e,t,o,i,r){return o===void 0&&(o=!0),i===void 0&&(i=!0),r===void 0&&(r=!1),this.graphModel.getAreaElement(e,t,o,i,r).map(function(s){return s.getData()})},n.prototype.setProperties=function(e,t){var o;(o=this.graphModel.getElement(e))===null||o===void 0||o.setProperties(Qn(t))},n.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},n.prototype.deleteProperty=function(e,t){var o;(o=this.graphModel.getElement(e))===null||o===void 0||o.deleteProperty(t)},n.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},n.prototype.editText=function(e){this.graphModel.editText(e)},n.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},n.prototype.updateEditConfig=function(e){var t=this.graphModel,o=t.editConfigModel,i=t.transformModel,r=o.snapGrid;if(o.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!eo(e==null?void 0:e.snapGrid)&&e.snapGrid!==r){var s=this.graphModel.grid.size,a=s===void 0?1:s;this.graphModel.updateGridSize(e.snapGrid?a:1)}this.emit(_t.EDIT_CONFIG_CHANGED,{data:o.getConfig()})},n.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},n.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},n.prototype.getTheme=function(){return this.graphModel.getTheme()},n.prototype.focusByElement=function(e){var t=void 0,o=this.getNodeModelById(e);if(o){var i=o.getData(),r=i.x,s=i.y;t={x:r,y:s}}var a=this.getEdgeModelById(e);if(a){var l=a.textPosition,r=l.x,s=l.y;t={x:r,y:s}}t&&this.focusByCoordinate(t)},n.prototype.focusByCoordinate=function(e){var t=this.graphModel,o=t.transformModel,i=t.width,r=t.height,s=e.x,a=e.y;o.focusOn(s,a,i,r)},n.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,o=e.coordinate;t&&this.focusByElement(t),o&&this.focusByCoordinate(o)}},n.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},n.prototype.toFront=function(e){this.graphModel.toFront(e)},n.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},n.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Ed([o],El(e),!1)):o},n.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},n.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},n.prototype.setOverlapMode=function(e){this.graphModel.setOverlapMode(e)},n.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(Qn(e)),this.options.history!==!1&&this.history.watch(this.graphModel),ch(Pe(RZ,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(_t.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},n.prototype.render=function(e){var t=Dt(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},n.prototype.undo=function(){if(this.history.undoAble()){var e=Qn(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.redo=function(){if(this.history.redoAble()){var e=Qn(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.zoom=function(e,t){var o=this.graphModel.transformModel;return o.zoom(e,t)},n.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},n.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},n.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},n.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,o=e.SCALE_Y,i=e.TRANSLATE_X,r=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:o,TRANSLATE_X:i,TRANSLATE_Y:r}},n.prototype.translate=function(e,t){var o=this.graphModel.transformModel;o.translate(e,t)},n.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,o=e.TRANSLATE_Y;this.translate(-t,-o)},n.prototype.translateCenter=function(){this.graphModel.translateCenter()},n.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},n.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},n.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},n.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},n.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},n.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},n.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},n.use=function(e,t){var o,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(o={},o[Ad]=Ad,o.extension=e,o.props=t,o))},n.addThemeMode=function(e,t){DK(e,t)},n.removeThemeMode=function(e){OK(e)},n.clearThemeMode=function(){Bh()},n.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var o=Array.from(n.extensions,function(r){var s=El(r,2),a=s[1];return a}),i=Ed(Ed([],El(this.plugins),!1),El(o),!1);Vt(i,function(r){var s,a;Ad in r?(s=r.extension,a=r.props):s=r;var l=s==null?void 0:s.pluginName;Cy(e,l)===-1&&t.installPlugin(s,a)})},n.prototype.installPlugin=function(e,t){var o,i;if("pluginName"in e&&"install"in e){var r=e.pluginName,s=e.install,a=e.render;r&&(s&&s.call(e,this,n),a&&this.components.push(a.bind(e)),this.extension[r]=e);return}var l=e,d=l.pluginName,c=new l({lf:this,LogicFlow:n,props:t,options:(i=(o=this.options.pluginsOptions)===null||o===void 0?void 0:o[d])!==null&&i!==void 0?i:{}});c.render&&this.components.push(c.render.bind(c)),this.extension[d]=c},n.prototype.destroy=function(){var e;this.clearData(),ch(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),Bh();for(var t in this.extension){var o=this.extension[t];"destroy"in o&&((e=o.destroy)===null||e===void 0||e.call(o))}},n.extensions=new Map,n})();(function(n){n.toStringTag="LF.".concat(n.name)})(Lc||(Lc={}));const HQ=Lc;function no(n){return Sp(n)}var Qh={width:40,height:40},ev={width:40,height:40},tv={width:40,height:40},nv={width:100,height:80},ov={width:100,height:80},UQ=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),zQ=(globalThis==null?void 0:globalThis._ids)||new UQ;function Vs(){return zQ.next()}var tm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){tm(e,n);function e(t,o){return t.id||(t.id="Event_".concat(Vs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,o)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=n.prototype.getConnectedTargetRules.call(this),o={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(o),t},e.extendKey="StartEventModel",e})(lu);(function(n){tm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(cu);var nm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),gu=function(){return gu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gu.apply(this,arguments)};(function(n){nm(e,n);function e(t,o){return t.id||(t.id="Event_".concat(Vs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,o)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=n.prototype.getConnectedSourceRules.call(this),o={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(o),t},e.extendKey="EndEventModel",e})(lu);(function(n){nm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle(),i=t,r=i.x,s=i.y,a=i.r,l=n.prototype.getShape.call(this);return et("g",{},l,et("circle",gu(gu({},o),{cx:r,cy:s,r:a-5})))},e.extendKey="EndEventView",e})(cu);var om=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){om(e,n);function e(t,o){return t.id||(t.id="Flow_".concat(Vs())),n.call(this,t,o)||this}return e.extendKey="SequenceFlowModel",e})(Es);(function(n){om(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(Ds);var im=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ha=function(){return ha=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ha.apply(this,arguments)};(function(n){im(e,n);function e(t,o){var i=this;return t.id||(t.id="Gateway_".concat(Vs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=n.call(this,t,o)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(uu);(function(n){im(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points,d=t.getNodeStyle();return et("g",{transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(r-a/2,")")},et("polygon",ha(ha({},d),{x:i,y:r,points:l})),et("path",ha({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},d)))},e.extendKey="ExclusiveGatewayNode",e})(fu);var rm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Bc=function(){return Bc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Bc.apply(this,arguments)};(function(n){rm(e,n);function e(t,o){return t.id||(t.id="Activity_".concat(Vs())),n.call(this,t,o)||this}return e.extendKey="ServiceTaskModel",e})(As);(function(n){rm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getNodeStyle();return et("svg",{x:o-r/2+5,y:i-s/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},et("path",{fill:a.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.radius,l=t.getNodeStyle();return et("g",{},[et("rect",Bc({x:o-r/2,y:i-s/2,rx:a,ry:a,width:r,height:s},l)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(Br);var sm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),mu=function(){return mu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},mu.apply(this,arguments)};(function(n){sm(e,n);function e(t,o){return t.id||(t.id="Activity_".concat(Vs())),n.call(this,t,o)||this}return e.extendKey="UserTaskModel",e})(As);(function(n){sm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getNodeStyle();return et("svg",{x:o-r/2+5,y:i-s/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},et("path",{fill:a.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.radius,l=t.getNodeStyle();return et("g",{},[et("rect",mu(mu({},l),{x:o-r/2,y:i-s/2,rx:a,ry:a,width:r,height:s})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(Br);var qQ=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),GQ=(globalThis==null?void 0:globalThis._ids)||new qQ;function iv(){return GQ.next()}function am(n){return Object.prototype.toString.call(n)}function XQ(n){return"  ".repeat(n)}function yu(n){var e=n;return am(n)==="[object Object]"?(e={},Object.keys(n).forEach(function(t){var o=t;t.charAt(0)==="-"&&(o=t.substring(1)),e[o]=yu(n[t])})):Array.isArray(n)&&(e=[],n.forEach(function(t,o){e[o]=yu(t)})),e}function bu(n){return n==null?"":n.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function WQ(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(yu(n)).replace(/"/g,"'")}return bu(String(e))}var gr=`	
`;function Rl(n,e,t){var o=XQ(t);if(n!==0&&n!==!1&&!n)return gr+o+"<".concat(e," />");var i="";if(e==="#text")return gr+o+bu(String(n));if(e==="#cdata-section")return gr+o+"<![CDATA["+n+"]]>";if(e==="#comment")return gr+o+"<!--"+n+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+WQ(n)+'"';if(Array.isArray(n))n.forEach(function(l){i+=Rl(l,e,t+1)});else if(am(n)==="[object Object]"){var r=Object.keys(n),s="",a="";i+=(t===0?"":gr+o)+"<"+e,r.forEach(function(l){l.charAt(0)==="-"?s+=Rl(n[l],l,t+1):a+=Rl(n[l],l,t+1)}),i+=s+(a!==""?">".concat(a).concat(gr+o,"</").concat(e,">"):" />")}else i+=gr+o+"<".concat(e,">").concat(bu(String(n)),"</").concat(e,">");return i}function YQ(n){var e="";for(var t in n)e+=Rl(n[t],t,0);return e}var so=function(){};so.ObjTree=function(){return this};so.ObjTree.VERSION="0.23";so.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;so.ObjTree.prototype.attr_prefix="-";so.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,o=t.parseFromString(n,"application/xml");if(!o)return;e=o.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e)return this.parseDOM(e)};so.ObjTree.prototype.parseHTTP=function(n,e,t){var o={};for(var i in e)o[i]=e[i];if(o.method||(typeof o.postBody>"u"&&typeof o.postbody>"u"&&typeof o.parameters>"u"?o.method="get":o.method="post"),t){o.asynchronous=!0;var r=this,s=t,a=o.onComplete;o.onComplete=function(c){var p;c&&c.responseXML&&c.responseXML.documentElement&&(p=r.parseDOM(c.responseXML.documentElement)),s(p,c),a&&a(c)}}else o.asynchronous=!1;var l;if(typeof HTTP<"u"&&HTTP.Request){o.uri=n;var d=new HTTP.Request(o);d&&(l=d.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var d=new Ajax.Request(n,o);d&&(l=d.transport)}if(t)return l;if(l&&l.responseXML&&l.responseXML.documentElement)return this.parseDOM(l.responseXML.documentElement)};so.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!=11){var o={};o[n.nodeName]=t,t=o}return t}};so.ObjTree.prototype.parseElement=function(n){if(n.nodeType!=7){if(n.nodeType==3||n.nodeType==4||n.nodeType==8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,o={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i].nodeName;if(typeof r=="string"){var s=n.attributes[i].nodeValue;try{s=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=n.attributes[i].nodeValue}s&&(r=this.attr_prefix+r,typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}if(n.childNodes&&n.childNodes.length){var a=!0;t&&(a=!1);for(var i=0;i<n.childNodes.length&&a;i++){var l=n.childNodes[i].nodeType;l==3||l==4||l==8||(a=!1)}if(a){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i].nodeName;if(typeof r=="string"){var s=this.parseElement(n.childNodes[i]);s&&(typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}}else t===null&&(t={});return t}};so.ObjTree.prototype.addNode=function(n,e,t,o){this.__force_array[e]?(t==1&&(n[e]=[]),n[e][n[e].length]=o):t==1?n[e]=o:t==2?n[e]=[n[e],o]:n[e][n[e].length]=o};so.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};so.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],o=[];for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];i.charAt(0)!=this.attr_prefix?typeof r>"u"||r==null?t[t.length]="<"+i+" />":typeof r=="object"&&r.constructor==Array?t[t.length]=this.array_to_xml(i,r):typeof r=="object"?t[t.length]=this.hash_to_xml(i,r):t[t.length]=this.scalar_to_xml(i,r):o[o.length]=" "+i.substring(1)+'="'+this.xml_escape(r)+'"'}var s=o.join(""),a=t.join("");return typeof n>"u"||n==null||(t.length>0?a.match(/\n/)?a="<"+n+s+`>
`+a+"</"+n+`>
`:a="<"+n+s+">"+a+"</"+n+`>
`:a="<"+n+s+` />
`),a};so.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],o=0;o<e.length;o++){var i=e[o];typeof i>"u"||i==null?t[t.length]="<"+n+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};so.ObjTree.prototype.scalar_to_xml=function(n,e){return n=="#text"?this.xml_escape(e):"<"+n+">"+this.xml_escape(e)+"</"+n+`>
`};so.ObjTree.prototype.xml_escape=bu;var JQ=function(n){return new so.ObjTree().parseXML(n)},KQ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ic=function(){return Ic=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ic.apply(this,arguments)},Qu=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ei;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow"})(Ei||(Ei={}));var lm=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],rv=["properties","startPoint","endPoint","pointsList"],um=function(n){return String(n||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};function sv(n){var e=n?rv.concat(n):rv;return function(t){function o(i){var r={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(s){return o(s)}):(Object.entries(i).forEach(function(s){var a=Qu(s,2),l=a[0],d=a[1];typeof d!="object"?l.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(l)?r[l]=d:r["-".concat(l)]=d:e.includes(l)?r["-".concat(l)]=o(d):r[l]=o(d)}),r)}return o(t)}}function xu(n){var e={};return Object.entries(n).forEach(function(t){var o=Qu(t,2),i=o[0],r=o[1];i.indexOf("-")===0?e[i.substring(1)]=yu(r):typeof r=="string"?e[i]=r:Object.prototype.toString.call(r)==="[object Object]"?e[i]=xu(r):Array.isArray(r)?e[i]=r.map(function(s){return xu(s)}):e[i]=r}),e}function ZQ(n,e,t){var o=new Map;e.nodes.forEach(function(r){var s,a={"-id":r.id};if(!((s=r.text)===null||s===void 0)&&s.value&&(a["-name"]=r.text.value),r.properties){var l=sv(t)(r.properties);Object.assign(a,l)}o.set(r.id,a),n[r.type]?Array.isArray(n[r.type])?n[r.type].push(a):n[r.type]=[n[r.type],a]:n[r.type]=a});var i=e.edges.map(function(r){var s,a,l=o.get(r.targetNodeId);l["bpmn:incoming"]?Array.isArray(l["bpmn:incoming"])?l["bpmn:incoming"].push(r.id):l["bpmn:incoming"]=[l["bpmn:incoming"],r.id]:l["bpmn:incoming"]=r.id;var d={"-id":r.id,"-sourceRef":r.sourceNodeId,"-targetRef":r.targetNodeId};if(!((s=r.text)===null||s===void 0)&&s.value&&(d["-name"]=(a=r.text)===null||a===void 0?void 0:a.value),r.properties){var c=sv(t)(r.properties);Object.assign(d,c)}return d});e.edges.forEach(function(r){var s=o.get(r.sourceNodeId);s["bpmn:outgoing"]?Array.isArray(s["bpmn:outgoing"])?s["bpmn:outgoing"].push(r.id):s["bpmn:outgoing"]=[s["bpmn:outgoing"],r.id]:s["bpmn:outgoing"]=r.id}),n[Ei.FLOW]=i}function QQ(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var o,i=t.id,r=t.pointsList.map(function(a){var l=a.x,d=a.y;return{"-x":l,"-y":d}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":r};return!((o=t.text)===null||o===void 0)&&o.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var o,i=t.id,r=100,s=80,a=t.x,l=t.y,d=fr.shapeConfigMap.get(t.type);d&&(r=d.width,s=d.height),a-=r/2,l-=s/2;var c={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":a,"-y":l,"-width":r,"-height":s}};return!((o=t.text)===null||o===void 0)&&o.value&&(c["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),c})}function eee(n){var e=[],t=[],o=n["bpmn:definitions"];if(o){var i=o["bpmn:process"],r=o["bpmndi:BPMNDiagram"],s=r==null?void 0:r["bpmndi:BPMNPlane"];if(!i||!s)return{nodes:e,edges:t};Object.keys(i).forEach(function(a){if(a.indexOf("bpmn:")===0){var l=i[a];if(a===Ei.FLOW){var d=s["bpmndi:BPMNEdge"],c=(Array.isArray(d),d);t=nee(l,c)}else{var p=s["bpmndi:BPMNShape"],f=(Array.isArray(p),p);e=e.concat(tee(l,f,a))}}})}return{nodes:e,edges:t}}function tee(n,e,t){var o=[];if(Array.isArray(n))n.forEach(function(s){var a;Array.isArray(e)?a=e.find(function(d){return d["-bpmnElement"]===s["-id"]}):a=e;var l=av(a,t,s);o.push(l)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===n["-id"]}):i=e;var r=av(i,t,n);o.push(r)}return o}function av(n,e,t){var o=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),r=um(t["-name"]),s=fr.shapeConfigMap.get(e);s&&(o+=s.width/2,i+=s.height/2);var a;Object.entries(t).forEach(function(p){var f=Qu(p,2),h=f[0],v=f[1];lm.indexOf(h)===-1&&(a||(a={}),a[h]=v)}),a&&(a=xu(a));var l;if(r&&(l={x:o,y:i,value:r},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var d=n["bpmndi:BPMNLabel"]["dc:Bounds"];l.x=Number(d["-x"])+Number(d["-width"])/2,l.y=Number(d["-y"])+Number(d["-height"])/2}var c={id:n["-bpmnElement"],type:e,x:o,y:i,properties:a};return l&&(c.text=l),c}function nee(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var r;Array.isArray(e)?r=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):r=e,t.push(lv(r,i))});else{var o=void 0;Array.isArray(e)?o=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):o=e,t.push(lv(o,n))}return t}function lv(n,e){var t,o=e["-name"]?um("".concat(e["-name"])):"";if(o){var i=void 0;n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"]&&(i=n["bpmndi:BPMNLabel"]["dc:Bounds"]);var r=0;if(o.split(`
`).forEach(function(h){r<h.length&&(r=h.length)}),i)t={value:o,x:Number(i["-x"])+r*10/2,y:Number(i["-y"])+7};else{var s=n["di:waypoint"]||[],a=s[0],l=s[s.length-1]||a,d=(Number((a==null?void 0:a["-x"])||0)+Number((l==null?void 0:l["-x"])||0))/2,c=(Number((a==null?void 0:a["-y"])||0)+Number((l==null?void 0:l["-y"])||0))/2;t={value:o,x:d,y:c}}}var p;Object.entries(e).forEach(function(h){var v=Qu(h,2),y=v[0],g=v[1];lm.indexOf(y)===-1&&(p||(p={}),p[y]=g)}),p&&(p=xu(p));var f={id:e["-id"],type:Ei.FLOW,pointsList:n["di:waypoint"].map(function(h){return{x:Number(h["-x"]),y:Number(h["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:p};return t&&(f.text=t),f}var fr=(function(){function n(e){var t=e.lf,o=this;this.adapterOut=function(i,r){var s=Ic({},o.processAttributes);ZQ(s,i,r);var a={"-id":"BPMNPlane_1","-bpmnElement":s["-id"]};QQ(a,i);var l=o.definitionAttributes;l["bpmn:process"]=s,l["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":a};var d={"bpmn:definitions":l};return d},this.adapterIn=function(i){if(i)return eee(i)},t.adapterIn=function(i){return o.adapterIn(i)},t.adapterOut=function(i,r){return o.adapterOut(i,r)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(iv())},this.definitionAttributes={"-id":"Definitions_".concat(iv()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n})();fr.shapeConfigMap.set(Ei.START,{width:Qh.width,height:Qh.height});fr.shapeConfigMap.set(Ei.END,{width:ev.width,height:ev.height});fr.shapeConfigMap.set(Ei.GATEWAY,{width:tv.width,height:tv.height});fr.shapeConfigMap.set(Ei.SYSTEM,{width:nv.width,height:nv.height});fr.shapeConfigMap.set(Ei.USER,{width:ov.width,height:ov.height});(function(n){KQ(e,n);function e(t){var o=n.call(this,t)||this;o.adapterXmlIn=function(r){var s=typeof r=="string"?o.sanitizeNameAttributes(r):r,a=JQ(s);return o.adapterIn(a)},o.adapterXmlOut=function(r,s){var a=o.adapterOut(r,s);return YQ(a)};var i=t.lf;return i.adapterIn=o.adapterXmlIn,i.adapterOut=o.adapterXmlOut,o}return e.prototype.sanitizeNameAttributes=function(t){return t.replace(/name="([^"]*)"/g,function(o,i){var r=i.replace(/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'name="'.concat(r,'"')})},e.pluginName="bpmnXmlAdapter",e})(fr);var oee=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var o=Math.random()*16|0,i=t==="x"?o:o&3|8;return i.toString(16)});return e},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),iee=(globalThis==null?void 0:globalThis._ids)||new oee;function ree(){return iee.next()}et("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),et("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),et("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});et("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});et("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var see=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Sr=function(){return Sr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Sr.apply(this,arguments)},aee=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},lee=zo,uee=(function(n){see(e,n);function e(t){var o=n.call(this)||this;return o.updatePosition=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.x,d=a.y;o.nodeModel.x=l+r/2,o.nodeModel.y=d+s/2,o.nodeModel.moveText(r/2,s/2)},o.getResize=function(i){var r=i.index,s=i.deltaX,a=i.deltaY,l=i.width,d=i.height,c=i.PCTResizeInfo,p=i.pct,f=p===void 0?1:p,h=i.freezeWidth,v=h===void 0?!1:h,y=i.freezeHeight,g=y===void 0?!1:y,_={width:l,height:d,deltaX:s,deltaY:a};if(c){var b=4,C=0,T=0;switch(r){case 0:T=(s*-1-a)/b;break;case 1:T=(s-a)/b;break;case 2:T=(s+a)/b;break;case 3:T=(s*-1+a)/b;break}T!==0&&(C=Math.round(T/c.ResizeBasis.basisHeight*1e5)/1e3),c.ResizePCT.widthPCT=Math.max(Math.min(c.ResizePCT.widthPCT+C,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit),c.ResizePCT.heightPCT=Math.max(Math.min(c.ResizePCT.heightPCT+C,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit);var M=Math.round(c.ResizePCT.widthPCT*c.ResizeBasis.basisWidth/100),S=Math.round(c.ResizePCT.heightPCT*c.ResizeBasis.basisHeight/100);switch(r){case 0:s=l-M,a=d-S;break;case 1:s=M-l,a=d-S;break;case 2:s=M-l,a=S-d;break;case 3:s=l-M,a=S-d;break}return _.width=M,_.height=S,_.deltaX=s/f,_.deltaY=a/f,_}switch(r){case 0:_.width=v?l:l-s*f,_.height=g?d:d-a*f;break;case 1:_.width=v?l:l+s*f,_.height=g?d:d-a*f;break;case 2:_.width=v?l:l+s*f,_.height=g?d:d+a*f;break;case 3:_.width=v?l:l-s*f,_.height=g?d:d+a*f;break}return _},o.updateEdgePointByAnchors=function(){var i=o.nodeModel,r=i.id,s=i.anchors,a=o.getNodeEdges(r);a.sourceEdges.forEach(function(l){var d=s.find(function(c){return c.id===l.sourceAnchorId});d&&l.updateStartPoint({x:d.x,y:d.y})}),a.targetEdges.forEach(function(l){var d=s.find(function(c){return c.id===l.targetAnchorId});d&&l.updateEndPoint({x:d.x,y:d.y})})},o.updateRect=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.x,d=a.y,c=a.width,p=a.height,f=a.radius,h=a.PCTResizeInfo,v=o.nodeModel,y=v.minWidth,g=v.minHeight,_=v.maxWidth,b=v.maxHeight,C=o.index,T=y===_,M=g===b,S=o.getResize({index:C,deltaX:r,deltaY:s,width:c,height:p,PCTResizeInfo:h,pct:1,freezeWidth:T,freezeHeight:M});if(S.width<y||S.width>_||S.height<g||S.height>b){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:T?0:S.deltaX,deltaY:M?0:S.deltaY}),o.nodeModel.width=S.width,o.nodeModel.height=S.height,o.nodeModel.setProperties({nodeSize:{width:S.width,height:S.height}});var k={x:l,y:d,width:c,height:p,radius:f},A={x:o.nodeModel.x,y:o.nodeModel.y,width:o.nodeModel.width,height:o.nodeModel.height,radius:f};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:k,afterNode:A})},o.updateEllipse=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.rx,d=a.ry,c=a.x,p=a.y,f=a.PCTResizeInfo,h=o.index,v=o.nodeModel,y=v.minWidth,g=v.minHeight,_=v.maxWidth,b=v.maxHeight,C=y===_,T=g===b,M=l,S=d,k=o.getResize({index:h,deltaX:r,deltaY:s,width:M,height:S,PCTResizeInfo:f,pct:1/2,freezeWidth:C,freezeHeight:T});if(k.width<y/2||k.width>_/2||k.height<g/2||k.height>b/2){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:C?0:k.deltaX,deltaY:T?0:k.deltaY}),o.nodeModel.rx=k.width,o.nodeModel.ry=k.height,o.nodeModel.setProperties({nodeSize:{rx:k.width,ry:k.height}});var A={x:c,y:p},$={rx:k.width,ry:k.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:Sr(Sr({},A),{rx:l,ry:d}),afterNode:$})},o.updateDiamond=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.rx,d=a.ry,c=a.x,p=a.y,f=a.PCTResizeInfo,h=o.index,v=o.nodeModel,y=v.minWidth,g=v.minHeight,_=v.maxWidth,b=v.maxHeight,C=y===_,T=g===b,M=l,S=d,k=o.getResize({index:h,deltaX:r,deltaY:s,width:M,height:S,PCTResizeInfo:f,pct:1/2,freezeWidth:C,freezeHeight:T});if(k.width<y/2||k.width>_/2||k.height<g/2||k.height>b/2){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:C?0:k.deltaX,deltaY:T?0:k.deltaY}),o.nodeModel.rx=k.width,o.nodeModel.ry=k.height,o.nodeModel.setProperties({nodeSize:{rx:k.width,ry:k.height}});var A={x:c,y:p,rx:l,ry:d},$={rx:k.width,ry:k.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:A,afterNode:$})},o.eventEmit=function(i){var r=i.deltaX,s=i.deltaY,a=i.beforeNode,l=i.afterNode,d=o.nodeModel,c=d.id,p=d.modelType,f=d.type,h=Sr({id:c,modelType:p,type:f},a),v=Sr({id:c,modelType:p,type:f},l);o.graphModel.eventCenter.emit("node:resize",{preData:h,data:v,deltaX:r,deltaY:s,index:o.index,model:o.nodeModel})},o.onDragging=function(i){var r,s=i.deltaX,a=i.deltaY,l=o.graphModel.transformModel,d=o.nodeModel.modelType;r=aee(l.fixDeltaXY(s,a),2),s=r[0],a=r[1],d===Gt.RECT_NODE||d===Gt.HTML_NODE?o.updateRect({deltaX:s,deltaY:a}):d===Gt.ELLIPSE_NODE?o.updateEllipse({deltaX:s,deltaY:a}):d===Gt.DIAMOND_NODE&&o.updateDiamond({deltaX:s,deltaY:a})},o.onDragEnd=function(){var i=o.graphModel.gridSize,r=i===void 0?1:i,s=r*Math.round(o.nodeModel.x/r),a=r*Math.round(o.nodeModel.y/r);o.nodeModel.moveTo(s,a),o.updateEdgePointByAnchors()},o.index=t.index,o.nodeModel=t.model,o.graphModel=t.graphModel,o.dragHandler=new lee({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:1}),o}return e.prototype.getNodeEdges=function(t){for(var o=this.graphModel,i=o.edges,r=[],s=[],a=0;a<i.length;a++){var l=i[a];l.sourceNodeId===t?r.push(l):i[a].targetNodeId===t&&s.push(l)}return{sourceEdges:r,targetEdges:s}},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.index,s=t.model,a=s.getControlPointStyle();return Pe("g",{className:"lf-resize-control-".concat(r),children:Pe(Ro,Sr({className:"lf-node-control",x:o,y:i},a,{onMouseDown:this.dragHandler.handleMouseDown}))})},e})(Kt),dee=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wu=function(){return wu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},wu.apply(this,arguments)},ed=(function(n){dee(e,n);function e(){var t=n.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=o.x,s=o.y,a=o.width,l=o.height,d={minX:r-a/2,minY:s-l/2,maxX:r+a/2,maxY:s+l/2},c=d.minX,p=d.minY,f=d.maxX,h=d.maxY,v=[{x:c,y:p},{x:f,y:p},{x:f,y:h},{x:c,y:h}];return v.map(function(y,g){return Pe(uee,wu({index:g},y,{model:o,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getResizeOutlineStyle();return Pe(Ro,wu({},a,{x:o,y:i,width:r,height:s}))},e.prototype.render=function(){return Pe("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e})(Kt),dm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){dm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.rx=r.rx,i.ry=r.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},r={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(bc);(function(n){dm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Pe(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model,i=t.graphModel.editConfigModel.isSilentMode;return Pe("g",{children:[this.getResizeShape(),o.isSelected&&!i?this.getControlGroup():""]})},e})(Oc);var cm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),jc=function(){return jc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},jc.apply(this,arguments)};(function(n){cm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.rx=r.rx,i.ry=r.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},r={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(yc);(function(n){cm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Pe(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,o=t.points,i=t.getNodeStyle();return Pe("g",{children:Pe(Dp,jc({},i,{points:o}))})},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Pe("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Ac);var pm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){pm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.width=r.width,i.height=r.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},r={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Ba);(function(n){pm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Pe(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Pe("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(ja);var fm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),cee=(function(n){fm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.width=r.width,i.height=r.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},r={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(As),pee=(function(n){fm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Pe(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Pe("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Br),hm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Cu=function(){return Cu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Cu.apply(this,arguments)},mr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},yr=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},uv=500,dv=300,fee=-1e4;(function(n){hm(e,n);function e(){var t=n.apply(this,yr([],mr(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=uv,t.unfoldedHeight=dv,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var o=this;n.prototype.initNodeData.call(this,t);var i=[];d_(t.children)&&(i=t.children),this.children=new Set(i),this.width=uv,this.height=dv,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=fee,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){o.isFolded&&o.foldGroup(o.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var o=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=yr(yr([],mr(this.incoming.edges),!1),mr(this.outgoing.edges),!1);this.children.forEach(function(r){var s=o.graphModel.getElement(r);if(s){var a=s.isFolded;if(s.isGroup&&!s.isFolded&&s.foldGroup(t),s.isGroup&&!t){var l=o.childrenLastFoldStatus[r];l!==void 0&&l!==s.isFolded&&s.foldGroup(l)}o.childrenLastFoldStatus[r]=!!a,s.visible=!t;var d=s.incoming.edges,c=s.outgoing.edges;i=yr(yr(yr([],mr(i),!1),mr(d),!1),mr(c),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var o=n.prototype.getAnchorStyle.call(this,t);return o.stroke="transparent",o.fill="transparent",o.hover.fill="transparent",o.hover.stroke="transparent",o},e.prototype.foldEdge=function(t,o){var i=this;o.forEach(function(r,s){var a=r.id,l=r.sourceNodeId,d=r.targetNodeId,c=r.startPoint,p=r.endPoint,f=r.type,h=r.text,v=r.getProperties(),y={id:"".concat(a,"__").concat(s),sourceNodeId:l,targetNodeId:d,startPoint:c,endPoint:p,type:f,properties:v,text:h==null?void 0:h.value};r.virtual&&i.graphModel.deleteEdgeById(r.id);var g=i.graphModel.group.getNodeGroup(d);g||(g=i.graphModel.getNodeModelById(d));var _=i.graphModel.group.getNodeGroup(l);_||(_=i.graphModel.getNodeModelById(l)),t&&r.visible!==!1&&(i.children.has(l)||i.id===l?(y.startPoint=void 0,y.sourceNodeId=i.id):(y.endPoint=void 0,y.targetNodeId=i.id),(g.id!==i.id||_.id!==i.id)&&i.createVirtualEdge(y),r.visible=!1),!t&&r.visible===!1&&(g&&g.isGroup&&g.isFolded?(y.targetNodeId=g.id,y.endPoint=void 0,i.createVirtualEdge(y)):_&&_.isGroup&&_.isFolded?(y.sourceNodeId=_.id,y.startPoint=void 0,i.createVirtualEdge(y)):r.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var o=this.graphModel.addEdge(t);o.virtual=!0,o.text.editable=!1,o.isFoldedEdge=!0},e.prototype.isInRange=function(t){var o=t.minX,i=t.minY,r=t.maxX,s=t.maxY;return o>=this.x-this.width/2&&r<=this.x+this.width/2&&i>=this.y-this.height/2&&s<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var o=t.minX,i=t.minY,r=t.maxX,s=t.maxY;return{x:o>=this.x-this.width/2&&r<=this.x+this.width/2,y:i>=this.y-this.height/2&&s<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,o=n.prototype.getData.call(this);o.children=[],this.children.forEach(function(r){var s=t.graphModel.getNodeModelById(r);s&&!s.virtual&&o.children.push(r)});var i=o.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,o},e.prototype.getHistoryData=function(){var t=n.prototype.getData.call(this);t.children=yr([],mr(this.children),!1),t.isGroup=!0;var o=t.properties;return o==null||delete o.groupAddable,o!=null&&o.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(cee);(function(n){hm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,o=t.resizable,i=t.properties;return o&&!i.isFolded?n.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,o=t.width,i=t.height,r=t.x,s=t.y,a=t.radius,l=t.properties,d=t.getAddableOutlineStyle;if(!l.groupAddable)return null;var c=this.props.model.getNodeStyle().strokeWidth,p=c===void 0?0:c,f=d(),h=o+p+8,v=i+p+8;return et("rect",Cu(Cu({},f),{width:h,height:v,x:r-h/2,y:s-v/2,rx:a,ry:a}))},e.prototype.getFoldIcon=function(){var t=this.props.model,o=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var r=et("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(o+3,",").concat(i+6," ").concat(o+11,",").concat(i+6," M").concat(o+7,",").concat(i+2," ").concat(o+7,",").concat(i+10):"M ".concat(o+3,",").concat(i+6," ").concat(o+11,",").concat(i+6," ")});return et("g",{},[et("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),r])},e.prototype.getResizeShape=function(){return et("g",{},[this.getAddableShape(),n.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(pee);var cv=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),va=function(){return va=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},va.apply(this,arguments)};function hee(n){var e=(function(o){cv(i,o);function i(r,s){r.id||(r.id="Flow_".concat(ree()));var a=va(va(va({},{}),r.properties),{isDefaultFlow:!1});return r.properties=a,o.call(this,r,s)||this}return i.extendKey="SequenceFlowModel",i})(Es),t=(function(o){cv(i,o);function i(){return o!==null&&o.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var r=this.props.model,s=r.properties.isDefaultFlow;return s?et("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):et("path",{d:""})},i.extendKey="SequenceFlowEdge",i})(Ds);return{type:"bpmn:sequenceFlow",view:t,model:e}}hee();var pv={width:40,height:40},fv={width:40,height:40},hv={width:100,height:80},ku={width:100,height:80},vv={width:100,height:80},_v={width:100,height:80},gv={width:100,height:80},mv={width:100,height:80},yv={width:100,height:80},bv={width:100,height:80},ao=function(){};ao.ObjTree=function(){return this};ao.ObjTree.VERSION="0.23";ao.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;ao.ObjTree.prototype.attr_prefix="-";ao.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,o=t.parseFromString(n,"application/xml");if(!o)return;e=o.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};ao.ObjTree.prototype.parseHTTP=function(n,e,t){var o={};for(var i in e)o[i]=e[i];if(o.method||(typeof o.postBody>"u"&&typeof o.postbody>"u"&&typeof o.parameters>"u"?o.method="get":o.method="post"),t){o.asynchronous=!0;var r=this,s=t,a=o.onComplete;o.onComplete=function(c){var p;c&&c.responseXML&&c.responseXML.documentElement&&(p=r.parseDOM(c.responseXML.documentElement)),s(p,c),a&&a(c)}}else o.asynchronous=!1;var l;if(typeof HTTP<"u"&&HTTP.Request){o.uri=n;var d=new HTTP.Request(o);d&&(l=d.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var d=new Ajax.Request(n,o);d&&(l=d.transport)}if(t)return l;if(l&&l.responseXML&&l.responseXML.documentElement)return this.parseDOM(l.responseXML.documentElement)};ao.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!==11){var o={};o[n.nodeName]=t,t=o}return t}};ao.ObjTree.prototype.parseElement=function(n){if(n.nodeType!==7){if(n.nodeType===3||n.nodeType===4||n.nodeType===8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,o={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i].nodeName;if(typeof r=="string"){var s=n.attributes[i].nodeValue;try{s=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=n.attributes[i].nodeValue}s!=null&&(r=this.attr_prefix+r,typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}if(n.childNodes&&n.childNodes.length){var a=!0;t&&(a=!1);for(var i=0;i<n.childNodes.length&&a;i++){var l=n.childNodes[i].nodeType;l===3||l===4||l===8||(a=!1)}if(a){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i].nodeName;if(typeof r=="string"){var s=this.parseElement(n.childNodes[i]);s&&(typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}}else t===null&&(t={});return t}};ao.ObjTree.prototype.addNode=function(n,e,t,o){this.__force_array[e]?(t===1&&(n[e]=[]),n[e][n[e].length]=o):t===1?n[e]=o:t===2?n[e]=[n[e],o]:n[e][n[e].length]=o};ao.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};ao.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],o=[];for(var i in e)if(ma(e,i)){var r=e[i];i.charAt(0)!==this.attr_prefix?typeof r>"u"||r==null?t[t.length]="<".concat(i," />"):typeof r=="object"&&r.constructor===Array?t[t.length]=this.array_to_xml(i,r):typeof r=="object"?t[t.length]=this.hash_to_xml(i,r):t[t.length]=this.scalar_to_xml(i,r):o[o.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(r),'"')}var s=o.join(""),a=t.join("");return typeof n>"u"||n==null||(t.length>0?a.match(/\n/)?a="<".concat(n).concat(s,`>
`).concat(a,"</").concat(n,`>
`):a="<".concat(n).concat(s,">").concat(a,"</").concat(n,`>
`):a="<".concat(n).concat(s,` />
`)),a};ao.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],o=0;o<e.length;o++){var i=e[o];typeof i>"u"||i==null?t[t.length]="<".concat(n," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};ao.ObjTree.prototype.scalar_to_xml=function(n,e){return n==="#text"?this.xml_escape(e):"<".concat(n,">").concat(this.xml_escape(e),"</").concat(n,`>
`)};ao.ObjTree.prototype.xml_escape=function(n){return n.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var vee=function(n){return new ao.ObjTree().parseXML(n)};function vm(n){return Object.prototype.toString.call(n)}function xv(n){return"  ".repeat(n)}function Su(n){return vm(n)==="[object Object]"?Object.keys(n).reduce(function(e,t){var o=t;return t.charAt(0)==="-"&&(o=t.substring(1)),e[o]=Su(n[t]),e},{}):Array.isArray(n)?n.map(function(e){return Su(e)}):n}function _ee(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(Su(n)).replace(/"/g,"'")}return e}var wv=`	
`;function Pl(n,e,t){var o=xv(t),i="",r=wv+o;if(e==="-json")return"";if(e==="#text")return r+n;if(e==="#cdata-section")return"".concat(r,"<![CDATA[").concat(n,"]]>");if(e==="#comment")return"".concat(r,"<!--").concat(n,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(_ee(n),'"');if(Array.isArray(n))i+=n.map(function(d){return Pl(d,e,t+1)}).join("");else if(vm(n)==="[object Object]"){var s=Object.keys(n),a="",l=n["-json"]?wv+xv(t+1)+n["-json"]:"";i+="".concat(t===0?"":r,"<").concat(e),s.forEach(function(d){d.charAt(0)==="-"?a+=Pl(n[d],d,t+1):l+=Pl(n[d],d,t+1)}),i+=a+(l!==""?">".concat(l).concat(r,"</").concat(e,">"):" />")}else i+="".concat(r,"<").concat(e,">").concat(n.toString(),"</").concat(e,">");return i}function gee(n){var e="";for(var t in n)e+=Pl(n[t],t,0);return e}var mee=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Fc=function(){return Fc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Fc.apply(this,arguments)},Cv=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Np=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ko=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},oo;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",n.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",n.BOUNDARY="bpmn:boundaryEvent",n.PARALLEL_GATEWAY="bpmn:parallelGateway",n.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",n.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow",n.SUBPROCESS="bpmn:subProcess"})(oo||(oo={}));var _m=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],yee=["properties","startPoint","endPoint","pointsList"],Eu={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},gm=function(n,e){var t=Object.keys(e||{});return t.forEach(function(o){if(n[o]){var i=e[o],r=i.in,s=i.out;r&&(n[o].in=r),s&&(n[o].out=s)}else n[o]=e[o]}),n},To={"bpmn:startEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=To[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateCatchEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=To[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateThrowEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=To[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:boundaryEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=To[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:sequenceFlow":{out:function(n){var e=n.properties,t=e.expressionType,o=e.condition;return o?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(o,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(o,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(n){var e=n.properties,t=e.timerType,o=e.timerValue,i=e.definitionId,r=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(o,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&o?">".concat(r(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(n,e){var t,o,i,r,s=n,a=e["-id"],l="",d="";try{for(var c=Np(Object.keys(e)),p=c.next();!p.done;p=c.next()){var f=p.value;f.includes("bpmn:")&&(i=Zn(f.split(":"),2),l=i[1],d=(r=e[f])===null||r===void 0?void 0:r["#text"])}}catch(h){t={error:h}}finally{try{p&&!p.done&&(o=c.return)&&o.call(c)}finally{if(t)throw t.error}}return{"-definitionId":a,"-definitionType":s,"-timerType":l,"-timerValue":d}}},"bpmn:conditionExpression":{in:function(n,e){var t,o="",i="";return e["#cdata-section"]?(i="cdata",o=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",o=e["#text"]),{"-condition":o,"-expressionType":i}}}};function bee(n){var e=n??{},t=e.retainedAttrsFields,o=e.excludeFields,i=e.transformer,r=new Set(Ko(Ko([],Zn(yee),!1),Zn(t||[]),!1)),s={in:new Set(Ko(Ko([],Zn(Eu.in),!1),Zn((o==null?void 0:o.in)||[]),!1)),out:new Set(Ko(Ko([],Zn(Eu.out),!1),Zn((o==null?void 0:o.out)||[]),!1))};return To=gm(To,i),function(a){var l=a.nodes,d=a.edges;function c(p,f){var h,v;if((p==null?void 0:p.flag)!==1){var y;if((y=To[p.type])&&y.out){var g=y.out(p),_=Object.keys(g);_.length>0&&_.forEach(function($){p[$]=g[$]})}p!=null&&p.children&&(p.children=p.children.map(function($){var B=l.find(function(O){return O.id===$})||d.find(function(O){return O.id===$});return B||{}}));var b={};if(typeof p=="string")return p;if(Array.isArray(p))return p.map(function($){return c($,"")}).filter(function($){return $!=null});try{for(var C=Np(Object.entries(p)),T=C.next();!T.done;T=C.next()){var M=Zn(T.value,2),S=M[0],k=M[1];if((k==null?void 0:k.flag)===1)return;var A=[f,S].filter(function($){return $}).join(".");s.out.has(A)||(typeof k!="object"?S.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(S)?b[S]=k:b["-".concat(S)]=k:r.has(A)?b["-".concat(S)]=c(k,A):b[S]=c(k,A))}}catch($){h={error:$}}finally{try{T&&!T.done&&(v=C.return)&&v.call(C)}finally{if(h)throw h.error}}return b}}return c(a,"")}}function Au(n){var e,t,o={};try{for(var i=Np(Object.entries(n)),r=i.next();!r.done;r=i.next()){var s=Zn(r.value,2),a=s[0],l=s[1];a.indexOf("-")===0?o[a.substring(1)]=Su(l):typeof l=="string"?o[a]=l:Object.prototype.toString.call(l)==="[object Object]"?o[a]=Au(l):Array.isArray(l)?o[a]=l.map(function(d){return Au(d)}):o[a]=l}}catch(d){e={error:d}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o}function xee(n,e,t){var o,i=new Map,r=bee(t)(e);r.nodes.forEach(function(a){var l=a["-id"],d=a["-type"],c=a.text,p=a.children,f=Cv(a,["-id","-type","text","children"]),h={"-id":l};c!=null&&c["-value"]&&(h["-name"]=c["-value"]),f["-json"]&&(h["-json"]=f["-json"]),f["-properties"]&&Object.assign(h,f["-properties"]),p&&(h.children=p),n[d]||(n[d]=[]),n[d].push(h),i.set(l,h)});var s=r.edges.map(function(a){var l=a["-id"],d=a["-sourceNodeId"],c=a["-targetNodeId"],p=a.text,f=Cv(a,["-id","-sourceNodeId","-targetNodeId","text"]),h=i.get(c);h["bpmn:incoming"]||(h["bpmn:incoming"]=[]),h["bpmn:incoming"].push(l);var v={"-id":l,"-sourceRef":d,"-targetRef":c};return p!=null&&p["-value"]&&(v["-name"]=p["-value"]),f["-json"]&&(v["-json"]=f["-json"]),f["-properties"]&&Object.assign(v,f["-properties"]),v});return e.edges.forEach(function(a){var l=a.sourceNodeId,d=a.id,c=i.get(l);c["bpmn:outgoing"]||(c["bpmn:outgoing"]=[]),c["bpmn:outgoing"].push(d)}),(o=n["bpmn:subProcess"])===null||o===void 0||o.forEach(function(a){var l={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},d=[];a.children.forEach(function(y){var g,_=i.get(y["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(C){_[C]&&_[C].forEach(function(T){l[C].add(T)})});var b=(g=n[y["-type"]])===null||g===void 0?void 0:g.findIndex(function(C){return C["-id"]===y["-id"]});b>=0&&n[y["-type"]].splice(b,1),i.delete(y["-id"]),a[y["-type"]]||(a[y["-type"]]=[]),a[y["-type"]].push(_)});var c=l["bpmn:incoming"],p=l["bpmn:outgoing"];p.forEach(function(y){c.has(y)&&d.push(y)});for(var f=function(y){var g=s.findIndex(function(_){return _["-id"]===d[y]});g>=0?(a["bpmn:sequenceFlow"]||(a["bpmn:sequenceFlow"]=[]),a["bpmn:sequenceFlow"].push(s[g]),s.splice(g,1)):y++,h=y},h,v=0;v<d.length;)f(v),v=h;delete a.children}),n[oo.FLOW]=s,n}function wee(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var o,i=t.id,r=t.pointsList.map(function(a){var l=a.x,d=a.y;return{"-x":l,"-y":d}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":r};return!((o=t.text)===null||o===void 0)&&o.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var o,i=t.id,r=100,s=80,a=t.x,l=t.y,d=go.shapeConfigMap.get(t.type);d&&(r=d.width,s=d.height),a-=r/2,l-=s/2;var c={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":a,"-y":l,"-width":r,"-height":s}};return!((o=t.text)===null||o===void 0)&&o.value&&(c["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),c})}var Cee=["bpmn:incoming","bpmn:outgoing"];function kee(n,e){var t=[],o=[],i=new Map,r=e??{},s=r.transformer,a=r.excludeFields,l={in:new Set(Ko(Ko([],Zn(Eu.in),!1),Zn((a==null?void 0:a.in)||[]),!1)),out:new Set(Ko(Ko([],Zn(Eu.out),!1),Zn((a==null?void 0:a.out)||[]),!1))};To=gm(To,s);var d=n["bpmn:definitions"];if(d){var c=d["bpmn:process"];(function(f,h){h.forEach(function(v){try{Object.keys(f).forEach(function(y){try{v(y)}catch(g){console.error(g)}})}catch(y){console.error(y)}})})(c,[function(f){function h(y){y["-children"]||(y["-children"]=[]),Object.keys(y).forEach(function(g){var _;g.indexOf("bpmn:")===0&&!Cee.includes(g)&&(c[g]||(c[g]=[]),!Array.isArray(c[g])&&(c[g]=[c[g]]),Array.isArray(y[g])?(_=c[g]).push.apply(_,Ko([],Zn(y[g]),!1)):c[g].push(y[g]),Array.isArray(y[g])?y[g].forEach(function(b){!g.includes("Flow")&&y["-children"].push(b["-id"])}):!g.includes("Flow")&&y["-children"].push(y[g]["-id"]),delete y[g])})}if(f==="bpmn:subProcess"){var v=c[f];Array.isArray(v)?v.forEach(function(y){f==="bpmn:subProcess"&&h(y)}):h(v)}},function(f){var h=function(y){Object.keys(y).forEach(function(g){var _,b;if(g.includes("bpmn:")){var C={};To[g]&&To[g].in?(C=(b=(_=To[g]).in)===null||b===void 0?void 0:b.call(_,g,c_.cloneDeep(y[g])),delete y[g]):v(y[g]);var T=void 0;(T=Reflect.ownKeys(C)).length>0&&T.forEach(function(M){Reflect.set(y,M,C[M])})}})};function v(y){i.set(y["-id"],y),Array.isArray(y)?y.forEach(function(g){v(g)}):typeof y=="object"&&h(y)}v(c[f])},function(f){if(f.indexOf("bpmn:")===0){var h=c[f];if(f==="bpmn:sequenceFlow"){var v=d["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];o=Eee(h,v)}else{var y=d["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(f==="bpmn:boundaryEvent"){var g=c[f],_=function(b){var C=b["-attachedToRef"],T=i.get(C);T["-boundaryEvents"]||(T["-boundaryEvents"]=[]),T["-boundaryEvents"].push(b["-id"])};Array.isArray(g)?g.forEach(function(b){_(b)}):_(g)}t=t.concat(See(h,y,f))}}}])}var p=function(f,h,v){Object.keys(f).forEach(function(y){var g=v?"".concat(v,".").concat(y):y;h.has(g)?delete f[y]:typeof f[y]=="object"&&p(f[y],h,g)})};return t.forEach(function(f){var h,v;if(!((h=e==null?void 0:e.mapping)===null||h===void 0)&&h.in){var y=(v=e==null?void 0:e.mapping)===null||v===void 0?void 0:v.in,g=f.type;y[g]&&(f.type=y[g])}p(f,l.in,"")}),o.forEach(function(f){var h,v;if(!((h=e==null?void 0:e.mapping)===null||h===void 0)&&h.in){var y=(v=e==null?void 0:e.mapping)===null||v===void 0?void 0:v.in,g=f.type;y[g]&&(f.type=y[g])}p(f,l.in,"")}),{nodes:t,edges:o}}function See(n,e,t){var o=[];if(Array.isArray(n))n.forEach(function(s){var a;Array.isArray(e)?a=e.find(function(d){return d["-bpmnElement"]===s["-id"]}):a=e;var l=kv(a,t,s);o.push(l)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===n["-id"]}):i=e;var r=kv(i,t,n);o.push(r)}return o}function kv(n,e,t){var o=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),r=t["-children"],s=t["-name"],a=go.shapeConfigMap.get(e);a&&(o+=a.width/2,i+=a.height/2);var l={};Object.entries(t).forEach(function(f){var h=Zn(f,2),v=h[0],y=h[1];_m.includes(v)||(l[v]=y)}),l=Au(l);var d;if(s&&(d={x:o,y:i,value:s},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var c=n["bpmndi:BPMNLabel"]["dc:Bounds"];d.x=Number(c["-x"])+Number(c["-width"])/2,d.y=Number(c["-y"])+Number(c["-height"])/2}var p={id:n["-bpmnElement"],type:e,x:o,y:i,properties:l};return r&&(p.children=r),d&&(p.text=d),p}function Eee(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var r;Array.isArray(e)?r=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):r=e,t.push(Sv(r,i))});else{var o=void 0;Array.isArray(e)?o=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):o=e,t.push(Sv(o,n))}return t}function Sv(n,e){var t,o=e["-name"]?"".concat(e["-name"]):"";if(o){var i=n["bpmndi:BPMNLabel"]["dc:Bounds"],r=0;o.split(`
`).forEach(function(d){r<d.length&&(r=d.length)}),t={value:o,x:Number(i["-x"])+r*10/2,y:Number(i["-y"])+7}}var s={};Object.entries(e).forEach(function(d){var c=Zn(d,2),p=c[0],f=c[1];_m.includes(p)||(s[p]=f)}),s=Au(s);var a=n["di:waypoint"].map(function(d){return{x:Number(d["-x"]),y:Number(d["-y"])}}),l={id:e["-id"],type:oo.FLOW,pointsList:a,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:s};return t&&(l.text=t),l}var go=(function(){function n(e){var t=e.lf,o=this;this.adapterOut=function(i,r){var s,a,l=Fc({},o.processAttributes);xee(l,i,r);var d={"-id":"BPMNPlane_1","-bpmnElement":l["-id"]};wee(d,i);var c=o.definitionAttributes;c["bpmn:process"]=l,c["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":d};var p={"bpmn:definitions":c};if(!((s=r==null?void 0:r.mapping)===null||s===void 0)&&s.out){var f=(a=r==null?void 0:r.mapping)===null||a===void 0?void 0:a.out,h=function(v){Array.isArray(v)&&v.forEach(function(y){return h(y)}),typeof v=="object"&&Object.keys(v).forEach(function(y){var g;(g=f[y])?(v[g]=c_.cloneDeep(v[y]),delete v[y],h(v[g])):h(v[y])})};h(p)}return p},this.adapterIn=function(i,r){if(i)return kee(i,r)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n})();go.shapeConfigMap.set(oo.START,{width:pv.width,height:pv.height});go.shapeConfigMap.set(oo.END,{width:fv.width,height:fv.height});go.shapeConfigMap.set(oo.INTERMEDIATE_CATCH,{width:ku.width,height:ku.height});go.shapeConfigMap.set(oo.INTERMEDIATE_THROW,{width:ku.width,height:ku.height});go.shapeConfigMap.set(oo.BOUNDARY,{width:hv.width,height:hv.height});go.shapeConfigMap.set(oo.PARALLEL_GATEWAY,{width:vv.width,height:vv.height});go.shapeConfigMap.set(oo.INCLUSIVE_GATEWAY,{width:_v.width,height:_v.height});go.shapeConfigMap.set(oo.EXCLUSIVE_GATEWAY,{width:gv.width,height:gv.height});go.shapeConfigMap.set(oo.SYSTEM,{width:mv.width,height:mv.height});go.shapeConfigMap.set(oo.USER,{width:yv.width,height:yv.height});go.shapeConfigMap.set(oo.SUBPROCESS,{width:bv.width,height:bv.height});(function(n){mee(e,n);function e(t){var o=n.call(this,t)||this;o.adapterXmlIn=function(s){var a=vee(s);return o.adapterIn(a,o.props)},o.adapterXmlOut=function(s){var a=o.adapterOut(s,o.props);return gee(a)};var i=t.lf,r=t.props;return i.adapterIn=o.adapterXmlIn,i.adapterOut=o.adapterXmlOut,o.props=r,o}return e.pluginName="BPMNAdapter",e})(go);function Aee(n,e,t){var o=e.x,i=e.y,r=n.x,s=n.y,a=r-o,l=s-i,d=a*Math.cos(t)-l*Math.sin(t),c=a*Math.sin(t)+l*Math.cos(t),p=d+o,f=c+i;return{x:p,y:f}}var Dee=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Du=function(){return Du=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Du.apply(this,arguments)},Oee=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Nee=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Mee=(function(n){Dee(e,n);function e(){var t=n.apply(this,Nee([],Oee(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(o){var i=o.model,r=t.props,s=r.model,a=r.graphModel,l=s.transformWithContainer,d=s.isRestrict,c=t.childrenPositionMap;if(!(!l||d)&&i.id===s.id){var p={x:s.x,y:s.y};Vt(Array.from(s.children),function(f){var h=a.getNodeModelById(f);if(h){var v={x:h.x,y:h.y};c.has(h.id)?v=c.get(h.id):c.set(h.id,v);var y=i.rotate*(180/Math.PI);y<0&&(y+=360);var g=y*(Math.PI/180),_=Aee(v,p,g);h.moveTo(_.x,_.y),h.rotate=i.rotate}})}},t.onNodeResize=function(o){var i=o.deltaX,r=o.deltaY,s=o.index,a=o.model,l=o.preData,d=t.props,c=d.model,p=d.graphModel,f=c.transformWithContainer,h=c.isRestrict;if(!(!f||h)&&a.id===c.id){var v=l.properties,y=v||{},g=y.width,_=y.height;Vt(Array.from(c.children),function(b){var C=p.getNodeModelById(b);if(C){var T=C.width/g*i,M=C.height/_*r;Wg({deltaX:T,deltaY:M,index:s,nodeModel:C,graphModel:p,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var o=t.props.model;o.isCollapsed&&o.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){n.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,o){var i=this,r=[];return t.isGroup&&Vt(Array.from(t.children),function(s){r.push(s);var a=o.getNodeModelById(s);a!=null&&a.isGroup&&(r=r.concat(i.getNodesInGroup(a,o)))}),r},e.prototype.getResizeControl=function(){var t=this.props.model,o=t.resizable,i=t.isCollapsed,r=o&&!i;return r?n.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,o=t.width,i=t.height,r=t.x,s=t.y,a=t.radius,l=t.groupAddable;if(!l)return null;var d=t.getNodeStyle().strokeWidth,c=d===void 0?0:d,p=t.getAddableOutlineStyle(),f=o+c+8,h=i+c+8;return et("rect",Du(Du({},p),{width:f,height:h,x:r-f/2,y:s-h/2,rx:a,ry:a}))},e.prototype.getCollapseIcon=function(t,o){return"M ".concat(t+3,",").concat(o+6," ").concat(t+11,",").concat(o+6," M").concat(t+7,",").concat(o+2," ").concat(t+7,",").concat(o+10)},e.prototype.getExpandIcon=function(t,o){return"M ".concat(t+3,",").concat(o+6," ").concat(t+11,",").concat(o+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=o-r/2+10,l=i-s/2+10;if(!t.collapsible)return null;var d=t!=null&&t.isCollapsed?this.getCollapseIcon(a,l):this.getExpandIcon(a,l),c=et("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d});return et("g",{},[et("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:a,y:l,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),c])},e.prototype.getShape=function(){return et("g",{},[this.getAppendAreaShape(),n.prototype.getShape.call(this),this.getOperateIcon()])},e})(Br),Tee=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ou=function(){return Ou=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ou.apply(this,arguments)},Dd=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Zr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ys=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},$ee=400,Ree=230,Pee=80,Lee=60,Bee=-1e4,Iee=(function(n){Tee(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var o;n.prototype.initNodeData.call(this,t);var i=(o=t.properties)!==null&&o!==void 0?o:{},r=i.children,s=i.width,a=i.height,l=i.collapsedWidth,d=i.collapsedHeight,c=i.collapsible,p=i.isCollapsed,f=i.zIndex,h=i.isRestrict,v=i.autoResize,y=i.autoToFront,g=i.transformWithContainer;this.children=r?new Set(r):new Set,this.zIndex=f??Bee,this.isCollapsed=p??!1,this.setProperties({isCollapsed:p??!1});var _=s??$ee,b=a??Ree;this.width=_,this.height=b,this.expandWidth=_,this.expandHeight=b,this.collapsedWidth=l??Pee,this.collapsedHeight=d??Lee,this.isRestrict=h??!1,this.transformWithContainer=g??!1,this.autoResize=v??!1,this.collapsible=c??!0,this.autoToFront=y??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,o=n.prototype.getData.call(this),i=[];return Vt(Array.from(this.children),function(r){var s=t.graphModel.getNodeModelById(r);s&&!s.virtual&&i.push(r)}),o.children=i,o.properties&&(o.properties.children=i,o.properties.isCollapsed=this.isCollapsed),o},e.prototype.getNodesInGroup=function(t){var o=[];return t.isGroup&&Vt(Array.from(t.children),function(i){o.push(i)}),o},e.prototype.getMoveDistance=function(t,o,i){i===void 0&&(i=!1);var r=Zr(n.prototype.getMoveDistance.call(this,t,o,i),2),s=r[0],a=r[1],l=this.getNodesInGroup(this);return this.graphModel.moveNodes(l,t,o,i),[s,a]},e.prototype.getHistoryData=function(){var t=n.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var o=this,i=o.x,r=o.y,s=o.collapsedWidth,a=o.collapsedHeight,l=o.expandWidth,d=o.expandHeight,c=o.isCollapsed;return c&&(t.x=i+l/2-s/2,t.y=r+d/2-a/2,t.text&&(t.text.x=t.text.x+l/2-s/2,t.text.y=t.text.y+d/2-a/2)),t},e.prototype.toggleCollapse=function(t){var o=this,i=this.graphModel,r=!!t;this.isCollapsed=r,this.setProperties({isCollapsed:r}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:r,nodeModel:this}),r?this.collapse():this.expand();var s=Ys(Ys([],Zr(this.incoming.edges),!1),Zr(this.outgoing.edges),!1),a=Array.from(this.children);Vt(a,function(l){var d,c,p=o.graphModel.elementsModelMap.get(l);if(p){var f=p.isCollapsed;if(p.isGroup){var h=p;if(h.isCollapsed||h.toggleCollapse(t),!t){var v=(d=o.childrenLastCollapseStateDict)===null||d===void 0?void 0:d.get(l);v!==void 0&&v!==p.isCollapsed&&h.toggleCollapse(v)}}if((c=o.childrenLastCollapseStateDict)===null||c===void 0||c.set(l,!!f),p.visible=!t,p.BaseType===En.NODE){var y=p.incoming.edges,g=p.outgoing.edges;s=Ys(Ys(Ys([],Zr(s),!1),Zr(y),!1),Zr(g),!1)}}}),this.collapseEdge(r,s)},e.prototype.collapse=function(){var t=this,o=t.x,i=t.y,r=t.text,s=t.width,a=t.height,l=t.collapsedWidth,d=t.collapsedHeight;this.x=o-s/2+l/2,this.y=i-a/2+d/2,this.text.x=r.x-s/2+l/2,this.text.y=r.y-a/2+d/2,this.expandWidth=s,this.expandHeight=a,this.width=l,this.height=d},e.prototype.expand=function(){var t=this,o=t.x,i=t.y,r=t.text,s=t.expandWidth,a=t.expandHeight,l=t.collapsedWidth,d=t.collapsedHeight;this.width=s,this.height=a,this.x=o+this.width/2-l/2,this.y=i+this.height/2-d/2,this.text.x=r.x+this.width/2-l/2,this.text.y=r.y+this.height/2-d/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var o=this.graphModel.addEdge(t);o.virtual=!0,o.text.editable=!1,o.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,o){var i=this,r=this.graphModel;Vt(o,function(s,a){var l,d=s.getData(),c=d.targetNodeId,p=d.sourceNodeId,f=Ou(Ou({},d),{id:"".concat(d.id,"__").concat(a),text:(l=d.text)===null||l===void 0?void 0:l.value});s.virtual&&r.deleteEdgeById(s.id);var h=r.dynamicGroup.getGroupByNodeId(c);h||(h=r.getNodeModelById(c));var v=r.dynamicGroup.getGroupByNodeId(p);v||(v=r.getNodeModelById(p)),t&&s.visible&&(i.children.has(p)||i.id===p?(f.startPoint=void 0,f.sourceNodeId=i.id):(f.endPoint=void 0,f.targetNodeId=i.id),(h.id!==i.id||v.id!==i.id)&&i.createVirtualEdge(f),s.visible=!1),!t&&!s.visible&&(h&&h.isGroup&&h.isCollapsed?(f.targetNodeId=h.id,f.endPoint=void 0,i.createVirtualEdge(f)):v&&v.isGroup&&v.isCollapsed?(f.sourceNodeId=v.id,f.startPoint=void 0,i.createVirtualEdge(f)):s.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var o=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:o,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var o=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:o})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=n.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Dd([Re],e.prototype,"isCollapsed",void 0),Dd([Re],e.prototype,"groupAddable",void 0),Dd([Re],e.prototype,"transformWithContainer",void 0),e})(As);function jee(n,e){var t=n.minX,o=n.minY,i=n.maxX,r=n.maxY,s=e.x,a=e.y,l=e.width,d=e.height;return t>=s-l/2&&i<=s+l/2&&o>=a-d/2&&r<=a+d/2}function Fee(n,e,t,o){var i=n.minX,r=n.minY,s=n.maxX,a=n.maxY,l=e.x,d=e.y,c=e.width,p=e.height,f=i+c/2,h=r+p/2,v=s-c/2,y=a-p/2;return{x:l+t>=f&&l+t<=v,y:d+o>=h&&d+o<=y}}var Nu=function(){return Nu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nu.apply(this,arguments)},Qr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},es=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},el={type:"dynamic-group",view:Mee,model:Iee},Vee=-1e3,Al=-1e4,Hee=(function(){function n(e){var t=e.lf,o=e.options,i=this;this.topGroupZIndex=Al,this.nodeGroupMap=new Map,this.onSelectionDrop=function(){var r=i.lf.graphModel.getSelectElements().nodes;r.forEach(function(s){i.addNodeToGroup(s)})},this.onNodeAddOrDrop=function(r){var s=r.data;i.addNodeToGroup(s)},this.addNodeToGroup=function(r){var s=i.nodeGroupMap.get(r.id);if(s){var a=i.lf.getNodeModelById(s);a.removeChild(r.id),i.nodeGroupMap.delete(r.id),a.setAllowAppendChild(!1)}var l=i.lf.getNodeModelById(r.id),d=l==null?void 0:l.getBounds();if(l&&d){if(l.isGroup){var c=l;Vt(Array.from(c.children),function(h){i.nodeGroupMap.set(h,r.id)}),i.calibrateTopGroupZIndex([r]),i.onNodeSelect({data:r,isSelected:!1,isMultiple:!1})}var a=i.getGroupByBounds(d,r);if(a){var p=a.isAllowAppendIn(r);p?(a.addChild(r.id),a.setAllowAppendChild(!1)):i.lf.emit("group:not-allowed",{group:a.getData(),node:r})}}},this.onGroupAddNode=function(r){var s=r.data,a=r.childId;i.nodeGroupMap.set(a,s.id)},this.removeNodeFromGroup=function(r){var s=r.data,a=r.model;a.isGroup&&s.children&&Vt(Array.from(s.children),function(c){i.nodeGroupMap.delete(c),i.lf.deleteNode(c)});var l=i.nodeGroupMap.get(s.id);if(l){var d=i.lf.getNodeModelById(l);d&&d.removeChild(s.id),i.nodeGroupMap.delete(s.id)}},this.onSelectionDrag=function(){var r=i.lf.graphModel.getSelectElements().nodes;r.forEach(function(s){i.setActiveGroup(s)})},this.onNodeDrag=function(r){var s=r.data;i.setActiveGroup(s)},this.setActiveGroup=function(r){var s=i.lf.getNodeModelById(r.id),a=s==null?void 0:s.getBounds();if(s&&a){var l=i.getGroupByBounds(a,r);if(i.activeGroup&&i.activeGroup.setAllowAppendChild(!1),!l||s.isGroup&&l.id===r.id)return;var d=l.isAllowAppendIn(r);if(!d)return;i.activeGroup=l,i.activeGroup.setAllowAppendChild(!0)}},this.onNodeSelect=function(r){var s=r.data,a=r.isMultiple,l=r.isSelected,d=i.lf.getNodeModelById(s.id);if(i.sendNodeToFront(d),i.topGroupZIndex>Vee){var c=i.lf.graphModel.nodes;i.topGroupZIndex=Al;var p=ky(nl(c,function(g){return!!g.isGroup}),"zIndex"),f=0;Vt(p,function(g){g.zIndex!==f&&(i.topGroupZIndex++,f=g.zIndex),g.setZIndex(i.topGroupZIndex)})}if(a&&l)if(d!=null&&d.isGroup){var h=d.children;Vt(Array.from(h),function(g){var _=i.lf.getNodeModelById(g);_==null||_.setSelected(!1)})}else{var v=i.nodeGroupMap.get(s.id);if(v){var y=i.lf.getNodeModelById(v);y!=null&&y.isSelected&&(d==null||d.setSelected(!1))}}},this.onNodeMove=function(r){var s=r.deltaX,a=r.deltaY,l=r.data,d=l.id,c=l.x,p=l.y,f=l.properties;if(f){var h=f.width,v=f.height,y=i.nodeGroupMap.get(d);if(y){var g=i.lf.getNodeModelById(y);if(!(!g||!g.isRestrict||!g.autoResize)){var _=c+s/2,b=p+a/2,C=_-h/2,T=b-v/2,M=_+h/2,S=b+v/2,k=!1,A=g.getBounds(),$=Object.assign({},A);if(C<$.minX&&($.minX=C,k=!0),T<$.minY&&($.minY=T,k=!0),M>$.maxX&&($.maxX=M,k=!0),S>$.maxY&&($.maxY=S,k=!0),!!k){var B=$.minX+($.maxX-$.minX)/2,O=$.minY+($.maxY-$.minY)/2,P=$.maxX-$.minX,E=$.maxY-$.minY;g.moveTo(B,O),g.width=P,g.height=E}}}}},this.onGraphRendered=function(r){var s=r.data;Vt(s.nodes,function(a){a.children&&Vt(a.children,function(l){i.nodeGroupMap.set(l,a.id)})}),i.calibrateTopGroupZIndex(s.nodes)},t.register(el),this.lf=t,pn(this,o),this.init()}return n.prototype.getGroupByNodeId=function(e){var t=this.nodeGroupMap.get(e);if(t)return this.lf.getNodeModelById(t)},n.prototype.getGroupByBounds=function(e,t){var o=this.lf.graphModel.nodes,i=nl(o,function(l){return!!l.isGroup&&jee(e,l)&&l.id!==t.id}),r=i.length;if(r<=1)return i[0];for(var s=i[r-1],a=r-2;a>=0;a--)i[a].zIndex>s.zIndex&&(s=i[a]);return s},n.prototype.sendNodeToFront=function(e){var t=this;if(!(!e||!e.isGroup)&&(this.topGroupZIndex++,e.setZIndex(this.topGroupZIndex),e.children)){var o=e.children;Vt(Array.from(o),function(i){var r=t.lf.getNodeModelById(i);t.sendNodeToFront(r)})}},n.prototype.getMaxZIndex=function(e){var t=this,o=Al;if(e.isGroup&&(o=Math.max(o,e.zIndex)),e.children){var i=e.children;Vt(Array.from(i),function(r){var s=t.lf.getNodeModelById(r);if(s!=null&&s.isGroup){var a=t.getMaxZIndex(s);o=Math.max(o,a)}})}return o},n.prototype.calibrateTopGroupZIndex=function(e){var t=this,o=Al;if(Vt(e,function(a){var l=t.lf.getNodeModelById(a.id);if(l){var d=t.getMaxZIndex(l);d>o&&(o=d)}}),!(this.topGroupZIndex>=o)){var i=this.lf.graphModel.nodes,r=nl(i,function(a){return!!a.isGroup}),s=this.topGroupZIndex;Vt(r,function(a){a.zIndex>s&&(s=a.zIndex)}),this.topGroupZIndex=s}},n.prototype.removeChildrenInGroupNodeData=function(e){var t,o=Dt(e);return delete o.children,!((t=o.properties)===null||t===void 0)&&t.children&&delete o.properties.children,o},n.prototype.initGroupChildNodes=function(e,t,o,i){var r=this,s=[],a=[],l=[];Vt(Array.from(t),function(p){var f=r.lf.getNodeModelById(p);if(f){var h=f.children,v=f.getData(),y=_t.NODE_GROUP_COPY||"node:group-copy-add",g=IQ(r.removeChildrenInGroupNodeData(v),i),_=r.lf.addNode(g,y);if(o.addChild(_.id),e[p]=_.id,s.push(_),l.push.apply(l,es([],Qr(es(es([],Qr(_.incoming.edges),!1),Qr(_.outgoing.edges),!1)),!1)),h instanceof Set){var b=r.initGroupChildNodes(e,h,_,i),C=b.childNodes,T=b.edgesData;s.push.apply(s,es([],Qr(C),!1)),a.push.apply(a,es([],Qr(T),!1))}}});var d=nl(l,function(p){return ma(e,p.sourceNodeId)&&ma(e,p.targetNodeId)}),c=si(d,function(p){return p.getData()});return{childNodes:s,edgesData:a.concat(c)}},n.prototype.createEdge=function(e,t,o){var i,r,s=e.sourceNodeId,a=e.targetNodeId,l=(i=t[s])!==null&&i!==void 0?i:s,d=(r=t[a])!==null&&r!==void 0?r:a,c=Dt(e);return e.id&&typeof e.text=="object"&&e.text!==null&&(c=jQ(e,o)),this.lf.graphModel.addEdge(Nu(Nu({},c),{sourceNodeId:l,targetNodeId:d}))},n.prototype.checkGroupBoundsWithChildren=function(e,t,o,i,r){if(e.children)for(var s=e.children,a=e.x,l=e.y,d=a+t/2,c=l+o/2,p=d-i/2,f=c-r/2,h=d+i/2,v=c+r/2,y=Array.from(s),g=0;g<y.length;g++){var _=y[g],b=this.lf.getNodeModelById(_);if(b){var C=b.getBounds(),T=C.minX,M=C.minY,S=C.maxX,k=C.maxY,A=p<=T&&f<=M&&h>=S&&v>=k;if(!A)return!1}}return!0},n.prototype.init=function(){var e=this,t=this.lf,o=t.graphModel;o.addNodeMoveRules(function(i,r,s){if(i.isGroup)return!0;var a=e.nodeGroupMap.get(i.id),l=e.lf.getNodeModelById(a);if(l&&l.isRestrict){if(l.autoResize)return!0;var d=l.getBounds();return Fee(d,i,r,s)}return!0}),o.addNodeResizeRules(function(i,r,s,a,l){return i.isGroup&&i.isRestrict?e.checkGroupBoundsWithChildren(i,r,s,a,l):!0}),o.dynamicGroup=this,t.on("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),t.on("selection:drop",this.onSelectionDrop),t.on("node:delete",this.removeNodeFromGroup),t.on("node:drag,node:dnd-drag",this.onNodeDrag),t.on("selection:drag",this.onSelectionDrag),t.on("node:click",this.onNodeSelect),t.on("node:mousemove",this.onNodeMove),t.on("graph:rendered",this.onGraphRendered),t.on("group:add-node",this.onGroupAddNode),t.addElements=function(i,r){var s=i.nodes,a=i.edges;r===void 0&&(r=40);var l={},d={nodes:[],edges:[]},c=[];return Vt(s,function(p){var f,h,v=p.id,y=(h=(f=p.properties)===null||f===void 0?void 0:f.children)!==null&&h!==void 0?h:p.children,g=t.addNode(e.removeChildrenInGroupNodeData(p));if(v&&(l[v]=g.id),d.nodes.push(g),g.isGroup){var _=e.initGroupChildNodes(l,y,g,r).edgesData;c.push.apply(c,es([],Qr(_),!1))}}),Vt(c,function(p){e.createEdge(p,l,r)}),Vt(a,function(p){d.edges.push(e.createEdge(p,l,r))}),d},this.render()},n.prototype.render=function(){},n.prototype.destroy=function(){this.lf.off("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),this.lf.off("selection:drop",this.onSelectionDrop),this.lf.off("node:delete",this.removeNodeFromGroup),this.lf.off("node:drag,node:dnd-drag",this.onNodeDrag),this.lf.off("selection:drag",this.onSelectionDrag),this.lf.off("node:click",this.onNodeSelect),this.lf.off("node:mousemove",this.onNodeMove),this.lf.off("graph:rendered",this.onGraphRendered),this.lf.off("group:add-node",this.onGroupAddNode)},n.pluginName="dynamicGroup",n})(),Ev;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(Ev||(Ev={}));var Uee=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),_a=function(){return _a=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_a.apply(this,arguments)},zee=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},qee=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Gee=(function(n){Uee(e,n);function e(t){var o=n.call(this,t)||this;o.textRef=zu(),o.setHoverOn=function(){var l=o.props.element;l.isDragging||o.state.isHovered||(o.setState({isHovered:!0}),l.setHovered(!0))},o.setHoverOff=function(){var l=o.props.element;o.state.isHovered&&(o.setState({isHovered:!1}),l.setHovered(!1))},o.handleMouseDown=function(l){var d,c=o.props,p=c.label,f=c.graphModel,h=f.editConfigModel.nodeTextDraggable;((d=p.draggable)!==null&&d!==void 0?d:h)&&!o.state.isDragging&&!o.state.isEditing&&o.stepDrag.handleMouseDown(l)},o.handleMouseUp=function(l){o.state.isDragging&&o.stepDrag.handleMouseUp(l)},o.handleDragging=function(l){var d=l.deltaX,c=l.deltaY;o.state.isDragging||o.setState({isDragging:!0});var p=o.props,f=p.label,h=p.graphModel,v=h.transformModel,y=qee(v.fixDeltaXY(d,c),2),g=y[0],_=y[1];o.setElementModelLabelInfo({x:f.x+g,y:f.y+_}),h.eventCenter.emit("label:drag",{data:f.getData(),model:f})},o.handleDragEnd=function(){o.setState({isDragging:!1})},o.handleClick=function(l){var d=o.props,c=d.label,p=d.element,f=d.graphModel;p.setSelected(!o.state.isSelected),o.setState({isSelected:!o.state.isSelected}),o.setElementModelLabelInfo({isSelected:!0}),f.eventCenter.emit("label:click",{data:c.getData(),e:l,model:p})},o.handleDbClick=function(l){var d=o.props,c=d.label,p=d.element,f=d.graphModel;if(f.eventCenter.emit("label:dblclick",{data:c.getData(),e:l,model:p}),!c.editable){p.setSelected(!0);return}if(p.setSelected(),p.setElementState(ln.TEXT_EDIT),o.setState({isEditing:!0}),o.textRef.current){o.textRef.current.contentEditable="true",o.textRef.current.focus();var h=document.createRange(),v=window.getSelection();h.selectNodeContents(o.textRef.current),h.collapse(!1),v==null||v.removeAllRanges(),v==null||v.addRange(h)}},o.handleBlur=function(l){var d=o.props,c=d.label,p=d.element,f=d.graphModel.eventCenter;f.emit("label:blur",{e:l,model:p,data:c.getData(),element:o.textRef.current}),o.setState({isDragging:!1,isHovered:!1,isSelected:!1})},o.handleInput=function(l){var d=o.props,c=d.label,p=d.graphModel;p.eventCenter.emit("label:input",{e:l,data:c.getData()})},o.reCalcLabelSize=function(){};var i=t.label,r=t.graphModel,s=r.gridSize,a=r.eventCenter;return o.stepDrag=new zo({onDragging:o.handleDragging,onDragEnd:o.handleDragEnd,step:s,eventType:"LABEL",model:i,eventCenter:a}),o.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},o}return e.prototype.setElementModelLabelInfo=function(t){var o=this.props,i=o.label,r=o.element,s=o.graphModel,a=r.properties._label,l=a,d=Sy(l,function(f){return f.id===i.id}),c=l[d];l[d]=_a(_a({},c),t);var p=s.getElement(r.id);p==null||p.setProperty("_label",l)},e.prototype.componentDidMount=function(){var t=this,o=this.props,i=o.label,r=o.element,s=o.graphModel;s.eventCenter.on("blank:click,node:click,edge:click,label:click",function(a){var l,d,c,p,f=a.data;if(((f==null?void 0:f.type)!=="label"||f.type==="label"&&f.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((f==null?void 0:f.type)!=="label"||f.type=="label"&&f.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var h=(d=(l=t.textRef.current)===null||l===void 0?void 0:l.innerText)!==null&&d!==void 0?d:"",v=(p=(c=t.textRef.current)===null||c===void 0?void 0:c.innerHTML)!==null&&p!==void 0?p:"";t.setElementModelLabelInfo({value:h,content:v,isSelected:!1}),r.setElementState(ln.DEFAULT)}((f==null?void 0:f.type)!=="label"||f.type=="label"&&f.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,o=this.props,i=o.label,r=o.element,s=o.graphModel,a=this.state,l=a.isDragging,d=a.isHovered,c=a.isSelected,p=a.isEditing,f=s.transformModel,h=f.getTransformStyle().transform,v=i.id,y=i.x,g=i.y,_=i.zIndex,b=i.vertical,C=i.style,T=i.rotate,M=i.content,S=i.labelWidth,k=i.textOverflowMode,A=S??(r.BaseType==="node"?r.width-20:80),$={left:"".concat(y-A/2,"px"),top:"".concat(g-10,"px"),width:"".concat(A,"px"),height:"20px",zIndex:_??1,transform:T?"".concat(h," rotate(").concat(T,"deg)"):"".concat(h," rotate(").concat(b?-.25:0,"turn)")};return Pe("div",{id:"element-container-".concat(v),className:wc("lf-label-editor-container"),style:$,onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:Pe("div",{ref:this.textRef,id:"editor-container-".concat(v),className:wc("lf-label-editor",(t={"lf-label-editor-dragging":l,"lf-label-editor-editing":p,"lf-label-editor-hover":!p&&(d||c)},t["lf-label-editor-".concat(k)]=!p,t)),onInput:this.handleInput,style:_a({maxWidth:"".concat(A,"px"),boxSizing:"border-box",display:"inline-block",background:p||r.BaseType==="edge"?"#fff":"transparent"},C),dangerouslySetInnerHTML:{__html:M}})})},e=zee([no],e),e})(Kt),Oo=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Xee=or,Wee=(function(){function n(e,t,o){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=o,this.id=(i=e.id)!==null&&i!==void 0?i:Xee(),this.initLabelData(e)}return n.prototype.initLabelData=function(e){pn(this,e)},n.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:Jo(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},Oo([Re],n.prototype,"x",void 0),Oo([Re],n.prototype,"y",void 0),Oo([Re],n.prototype,"content",void 0),Oo([Re],n.prototype,"value",void 0),Oo([Re],n.prototype,"rotate",void 0),Oo([Re],n.prototype,"style",void 0),Oo([Re],n.prototype,"zIndex",void 0),Oo([Re],n.prototype,"vertical",void 0),Oo([Re],n.prototype,"editable",void 0),Oo([Re],n.prototype,"draggable",void 0),Oo([Re],n.prototype,"labelWidth",void 0),Oo([Re],n.prototype,"textOverflowMode",void 0),n})(),Ll={exports:{}},Od=Ll.exports,Av;function Yee(){return Av||(Av=1,(function(n){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||(function(e){if("Element"in e){var t="classList",o="prototype",i=e.Element[o],r=Object,s=String[o].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[o].indexOf||function(v){for(var y=0,g=this.length;y<g;y++)if(y in this&&this[y]===v)return y;return-1},l=function(v,y){this.name=v,this.code=DOMException[v],this.message=y},d=function(v,y){if(y==="")throw new l("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(y))throw new l("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(v,y)},c=function(v){for(var y=s.call(v.getAttribute("class")||""),g=y?y.split(/\s+/):[],_=0,b=g.length;_<b;_++)this.push(g[_]);this._updateClassName=function(){v.setAttribute("class",this.toString())}},p=c[o]=[],f=function(){return new c(this)};if(l[o]=Error[o],p.item=function(v){return this[v]||null},p.contains=function(v){return v+="",d(this,v)!==-1},p.add=function(){var v=arguments,y=0,g=v.length,_,b=!1;do _=v[y]+"",d(this,_)===-1&&(this.push(_),b=!0);while(++y<g);b&&this._updateClassName()},p.remove=function(){var v=arguments,y=0,g=v.length,_,b=!1,C;do for(_=v[y]+"",C=d(this,_);C!==-1;)this.splice(C,1),b=!0,C=d(this,_);while(++y<g);b&&this._updateClassName()},p.toggle=function(v,y){v+="";var g=this.contains(v),_=g?y!==!0&&"remove":y!==!1&&"add";return _&&this[_](v),y===!0||y===!1?y:!g},p.toString=function(){return this.join(" ")},r.defineProperty){var h={get:f,enumerable:!0,configurable:!0};try{r.defineProperty(i,t,h)}catch(v){v.number===-2146823252&&(h.enumerable=!1,r.defineProperty(i,t,h))}}else r[o].__defineGetter__&&i.__defineGetter__(t,f)}})(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||(function(i){var r=function(k){return Object.prototype.toString.call(k).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},a=function(A,$,B){this.data=A,this.size=A.length,this.type=$,this.encoding=B},l=s.prototype,d=a.prototype,c=i.FileReaderSync,p=function(k){this.code=this[this.name=k]},f="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),h=f.length,v=i.URL||i.webkitURL||i,y=v.createObjectURL,g=v.revokeObjectURL,_=v,b=i.btoa,C=i.atob,T=i.ArrayBuffer,M=i.Uint8Array,S=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(a.fake=d.fake=!0;h--;)p.prototype[f[h]]=h+1;return v.createObjectURL||(_=i.URL=function(k){var A=document.createElementNS("http://www.w3.org/1999/xhtml","a"),$;return A.href=k,"origin"in A||(A.protocol.toLowerCase()==="data:"?A.origin=null:($=k.match(S),A.origin=$&&$[1])),A}),_.createObjectURL=function(k){var A=k.type,$;if(A===null&&(A="application/octet-stream"),k instanceof a)return $="data:"+A,k.encoding==="base64"?$+";base64,"+k.data:k.encoding==="URI"?$+","+decodeURIComponent(k.data):b?$+";base64,"+b(k.data):$+","+encodeURIComponent(k.data);if(y)return y.call(v,k)},_.revokeObjectURL=function(k){k.substring(0,5)!=="data:"&&g&&g.call(v,k)},l.append=function(k){var A=this.data;if(M&&(k instanceof T||k instanceof M)){for(var $="",B=new M(k),O=0,P=B.length;O<P;O++)$+=String.fromCharCode(B[O]);A.push($)}else if(r(k)==="Blob"||r(k)==="File")if(c){var E=new c;A.push(E.readAsBinaryString(k))}else throw new p("NOT_READABLE_ERR");else k instanceof a?k.encoding==="base64"&&C?A.push(C(k.data)):k.encoding==="URI"?A.push(decodeURIComponent(k.data)):k.encoding==="raw"&&A.push(k.data):(typeof k!="string"&&(k+=""),A.push(unescape(encodeURIComponent(k))))},l.getBlob=function(k){return arguments.length||(k=null),new a(this.data.join(""),k,"raw")},l.toString=function(){return"[object BlobBuilder]"},d.slice=function(k,A,$){var B=arguments.length;return B<3&&($=null),new a(this.data.slice(k,B>1?A:this.data.length),$,this.encoding)},d.toString=function(){return"[object Blob]"},d.close=function(){this.size=0,delete this.data},s})(e);e.Blob=function(i,r){var s=r&&r.type||"",a=new t;if(i)for(var l=0,d=i.length;l<d;l++)Uint8Array&&i[l]instanceof Uint8Array?a.append(i[l].buffer):a.append(i[l]);var c=a.getBlob(s);return!c.slice&&c.webkitSlice&&(c.slice=c.webkitSlice),c};var o=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=o(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||Od.content||Od),(function(e,t){var o=typeof process<"u"&&process&&process.versions&&process.versions.electron;o?e.MediumEditor=t:n.exports=t})(Od,(function(){function e(t,o){return this.init(t,o)}return e.extensions={},(function(t){function o(l,d){var c,p=Array.prototype.slice.call(arguments,2);d=d||{};for(var f=0;f<p.length;f++){var h=p[f];if(h)for(c in h)h.hasOwnProperty(c)&&typeof h[c]<"u"&&(l||d.hasOwnProperty(c)===!1)&&(d[c]=h[c])}return d}var i=!1;try{var r=document.createElement("div"),s=document.createTextNode(" ");r.appendChild(s),i=r.contains(s)}catch{}var a={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(l){return!!(a.isMac&&l.metaKey||!a.isMac&&l.ctrlKey)},isKey:function(l,d){var c=a.getKeyCode(l);return Array.isArray(d)===!1?c===d:d.indexOf(c)!==-1},getKeyCode:function(l){var d=l.which;return d===null&&(d=l.charCode!==null?l.charCode:l.keyCode),d},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var d=[!0].concat(Array.prototype.slice.call(arguments));return o.apply(this,d)},defaults:function(){var d=[!1].concat(Array.prototype.slice.call(arguments));return o.apply(this,d)},createLink:function(l,d,c,p){var f=l.createElement("a");return a.moveTextRangeIntoElement(d[0],d[d.length-1],f),f.setAttribute("href",c),p&&(p==="_blank"&&f.setAttribute("rel","noopener noreferrer"),f.setAttribute("target",p)),f},findOrCreateMatchingTextNodes:function(l,d,c){for(var p=l.createTreeWalker(d,NodeFilter.SHOW_ALL,null,!1),f=[],h=0,v=!1,y=null,g=null;(y=p.nextNode())!==null;)if(!(y.nodeType>3))if(y.nodeType===3){if(!v&&c.start<h+y.nodeValue.length&&(v=!0,g=a.splitStartNodeIfNeeded(y,c.start,h)),v&&a.splitEndNodeIfNeeded(y,g,c.end,h),v&&h===c.end)break;if(v&&h>c.end+1)throw new Error("PerformLinking overshot the target!");v&&f.push(g||y),h+=y.nodeValue.length,g!==null&&(h+=g.nodeValue.length,p.nextNode()),g=null}else y.tagName.toLowerCase()==="img"&&(!v&&c.start<=h&&(v=!0),v&&f.push(y));return f},splitStartNodeIfNeeded:function(l,d,c){return d!==c?l.splitText(d-c):null},splitEndNodeIfNeeded:function(l,d,c,p){var f,h;f=p+l.nodeValue.length+(d?d.nodeValue.length:0)-1,h=c-p-(d?l.nodeValue.length:0),f>=c&&p!==f&&h!==0&&(d||l).splitText(h)},splitByBlockElements:function(l){if(l.nodeType!==3&&l.nodeType!==1)return[];var d=[],c=e.util.blockContainerElementNames.join(",");if(l.nodeType===3||l.querySelectorAll(c).length===0)return[l];for(var p=0;p<l.childNodes.length;p++){var f=l.childNodes[p];if(f.nodeType===3)d.push(f);else if(f.nodeType===1){var h=f.querySelectorAll(c);h.length===0?d.push(f):d=d.concat(e.util.splitByBlockElements(f))}}return d},findAdjacentTextNodeWithContent:function(d,c,p){var f=!1,h,v=p.createNodeIterator(d,NodeFilter.SHOW_TEXT,null,!1);for(h=v.nextNode();h;){if(h===c)f=!0;else if(f&&h.nodeType===3&&h.nodeValue&&h.nodeValue.trim().length>0)break;h=v.nextNode()}return h},findPreviousSibling:function(l){if(!l||a.isMediumEditorElement(l))return!1;for(var d=l.previousSibling;!d&&!a.isMediumEditorElement(l.parentNode);)l=l.parentNode,d=l.previousSibling;return d},isDescendant:function(d,c,p){if(!d||!c)return!1;if(d===c)return!!p;if(d.nodeType!==1)return!1;if(i||c.nodeType!==3)return d.contains(c);for(var f=c.parentNode;f!==null;){if(f===d)return!0;f=f.parentNode}return!1},isElement:function(d){return!!(d&&d.nodeType===1)},throttle:function(l,d){var c=50,p,f,h,v=null,y=0,g=function(){y=Date.now(),v=null,h=l.apply(p,f),v||(p=f=null)};return!d&&d!==0&&(d=c),function(){var _=Date.now(),b=d-(_-y);return p=this,f=arguments,b<=0||b>d?(v&&(clearTimeout(v),v=null),y=_,h=l.apply(p,f),v||(p=f=null)):v||(v=setTimeout(g,b)),h}},traverseUp:function(l,d){if(!l)return!1;do{if(l.nodeType===1){if(d(l))return l;if(a.isMediumEditorElement(l))return!1}l=l.parentNode}while(l);return!1},htmlEntities:function(l){return String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(l,d){var c,p,f,h,v,y,g,_=!1,b=["insertHTML",!1,d];if(!e.util.isEdge&&l.queryCommandSupported("insertHTML"))try{return l.execCommand.apply(l,b)}catch{}if(c=l.getSelection(),c.rangeCount){if(p=c.getRangeAt(0),g=p.commonAncestorContainer,a.isMediumEditorElement(g)&&!g.firstChild)p.selectNode(g.appendChild(l.createTextNode("")));else if(g.nodeType===3&&p.startOffset===0&&p.endOffset===g.nodeValue.length||g.nodeType!==3&&g.innerHTML===p.toString()){for(;!a.isMediumEditorElement(g)&&g.parentNode&&g.parentNode.childNodes.length===1&&!a.isMediumEditorElement(g.parentNode);)g=g.parentNode;p.selectNode(g)}for(p.deleteContents(),f=l.createElement("div"),f.innerHTML=d,h=l.createDocumentFragment();f.firstChild;)v=f.firstChild,y=h.appendChild(v);p.insertNode(h),y&&(p=p.cloneRange(),p.setStartAfter(y),p.collapse(!0),e.selection.selectRange(l,p)),_=!0}return l.execCommand.callListeners&&l.execCommand.callListeners(b,_),_},execFormatBlock:function(l,d){var c=a.getTopBlockContainer(e.selection.getSelectionStart(l)),p;if(d==="blockquote"){if(c&&(p=Array.prototype.slice.call(c.childNodes),p.some(function(f){return a.isBlockContainer(f)})))return l.execCommand("outdent",!1,null);if(a.isIE)return l.execCommand("indent",!1,d)}if(c&&d===c.nodeName.toLowerCase()&&(d="p"),a.isIE&&(d="<"+d+">"),c&&c.nodeName.toLowerCase()==="blockquote"){if(a.isIE&&d==="<p>")return l.execCommand("outdent",!1,d);if((a.isFF||a.isEdge)&&d==="p")return p=Array.prototype.slice.call(c.childNodes),p.some(function(f){return!a.isBlockContainer(f)})&&l.execCommand("formatBlock",!1,d),l.execCommand("outdent",!1,d)}return l.execCommand("formatBlock",!1,d)},setTargetBlank:function(l,d){var c,p=d||!1;if(l.nodeName.toLowerCase()==="a")l.target="_blank",l.rel="noopener noreferrer";else for(l=l.getElementsByTagName("a"),c=0;c<l.length;c+=1)(p===!1||p===l[c].attributes.href.value)&&(l[c].target="_blank",l[c].rel="noopener noreferrer")},removeTargetBlank:function(l,d){var c;if(l.nodeName.toLowerCase()==="a")l.removeAttribute("target"),l.removeAttribute("rel");else for(l=l.getElementsByTagName("a"),c=0;c<l.length;c+=1)d===l[c].attributes.href.value&&(l[c].removeAttribute("target"),l[c].removeAttribute("rel"))},addClassToAnchors:function(l,d){var c=d.split(" "),p,f;if(l.nodeName.toLowerCase()==="a")for(f=0;f<c.length;f+=1)l.classList.add(c[f]);else{var h=l.getElementsByTagName("a");if(h.length===0){var v=a.getClosestTag(l,"a");l=v?[v]:[]}else l=h;for(p=0;p<l.length;p+=1)for(f=0;f<c.length;f+=1)l[p].classList.add(c[f])}},isListItem:function(l){if(!l)return!1;if(l.nodeName.toLowerCase()==="li")return!0;for(var d=l.parentNode,c=d.nodeName.toLowerCase();c==="li"||!a.isBlockContainer(d)&&c!=="div";){if(c==="li")return!0;if(d=d.parentNode,d)c=d.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(l,d){if(d.nodeName.toLowerCase()==="li"){var c=d.parentElement;c.parentElement.nodeName.toLowerCase()==="p"&&(a.unwrap(c.parentElement,l),e.selection.moveCursor(l,d.firstChild,d.firstChild.textContent.length))}},splitOffDOMTree:function(l,d,c){for(var p=d,f=null,h=!c;p!==l;){var v=p.parentNode,y=v.cloneNode(!1),g=h?p:v.firstChild,_;for(f&&(h?y.appendChild(f):_=f),f=y;g;){var b=g.nextSibling;g===p?(g.hasChildNodes()?g=g.cloneNode(!1):g.parentNode.removeChild(g),g.textContent&&f.appendChild(g),g=h?b:null):(g.parentNode.removeChild(g),(g.hasChildNodes()||g.textContent)&&f.appendChild(g),g=b)}_&&f.appendChild(_),p=v}return f},moveTextRangeIntoElement:function(l,d,c){if(!l||!d)return!1;var p=a.findCommonRoot(l,d);if(!p)return!1;if(d===l){var f=l.parentNode,h=l.nextSibling;return f.removeChild(l),c.appendChild(l),h?f.insertBefore(c,h):f.appendChild(c),c.hasChildNodes()}for(var v=[],y,g,_,b=0;b<p.childNodes.length;b++)if(_=p.childNodes[b],!y)a.isDescendant(_,l,!0)&&(y=_);else if(a.isDescendant(_,d,!0)){g=_;break}else v.push(_);var C=g.nextSibling,T=p.ownerDocument.createDocumentFragment();return y===l?(y.parentNode.removeChild(y),T.appendChild(y)):T.appendChild(a.splitOffDOMTree(y,l)),v.forEach(function(M){M.parentNode.removeChild(M),T.appendChild(M)}),g===d?(g.parentNode.removeChild(g),T.appendChild(g)):T.appendChild(a.splitOffDOMTree(g,d,!0)),c.appendChild(T),g.parentNode===p?p.insertBefore(c,g):C?p.insertBefore(c,C):p.appendChild(c),c.hasChildNodes()},depthOfNode:function(l){for(var d=0,c=l;c.parentNode!==null;)c=c.parentNode,d++;return d},findCommonRoot:function(l,d){for(var c=a.depthOfNode(l),p=a.depthOfNode(d),f=l,h=d;c!==p;)c>p?(f=f.parentNode,c-=1):(h=h.parentNode,p-=1);for(;f!==h;)f=f.parentNode,h=h.parentNode;return f},isElementAtBeginningOfBlock:function(l){for(var d,c;!a.isBlockContainer(l)&&!a.isMediumEditorElement(l);){for(c=l;c=c.previousSibling;)if(d=c.nodeType===3?c.nodeValue:c.textContent,d.length>0)return!1;l=l.parentNode}return!0},isMediumEditorElement:function(l){return l&&l.getAttribute&&!!l.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(l){return a.traverseUp(l,function(d){return a.isMediumEditorElement(d)})},isBlockContainer:function(l){return l&&l.nodeType!==3&&a.blockContainerElementNames.indexOf(l.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(l){return a.traverseUp(l,function(d){return a.isBlockContainer(d)||a.isMediumEditorElement(d)})},getTopBlockContainer:function(l){var d=a.isBlockContainer(l)?l:!1;return a.traverseUp(l,function(c){return a.isBlockContainer(c)&&(d=c),!d&&a.isMediumEditorElement(c)?(d=c,!0):!1}),d},getFirstSelectableLeafNode:function(l){for(;l&&l.firstChild;)l=l.firstChild;if(l=a.traverseUp(l,function(c){return a.emptyElementNames.indexOf(c.nodeName.toLowerCase())===-1}),l.nodeName.toLowerCase()==="table"){var d=l.querySelector("th, td");d&&(l=d)}return l},getFirstTextNode:function(l){return a.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),a._getFirstTextNode(l)},_getFirstTextNode:function(l){if(l.nodeType===3)return l;for(var d=0;d<l.childNodes.length;d++){var c=a._getFirstTextNode(l.childNodes[d]);if(c!==null)return c}return null},ensureUrlHasProtocol:function(l){return l.indexOf("://")===-1?"http://"+l:l},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(l,d,c){var p=l+" is deprecated, please use "+d+" instead.";c&&(p+=" Will be removed in "+c),a.warn(p)},deprecatedMethod:function(l,d,c,p){a.deprecated(l,d,p),typeof this[d]=="function"&&this[d].apply(this,c)},cleanupAttrs:function(l,d){d.forEach(function(c){l.removeAttribute(c)})},cleanupTags:function(l,d){d.indexOf(l.nodeName.toLowerCase())!==-1&&l.parentNode.removeChild(l)},unwrapTags:function(l,d){d.indexOf(l.nodeName.toLowerCase())!==-1&&e.util.unwrap(l,document)},getClosestTag:function(l,d){return a.traverseUp(l,function(c){return c.nodeName.toLowerCase()===d.toLowerCase()})},unwrap:function(l,d){for(var c=d.createDocumentFragment(),p=Array.prototype.slice.call(l.childNodes),f=0;f<p.length;f++)c.appendChild(p[f]);c.childNodes.length?l.parentNode.replaceChild(c,l):l.parentNode.removeChild(l)},guid:function(){function l(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()}};e.util=a})(window),(function(){var t=function(o){e.util.extend(this,o)};t.extend=function(o){var i=this,r;o&&o.hasOwnProperty("constructor")?r=o.constructor:r=function(){return i.apply(this,arguments)},e.util.extend(r,i);var s=function(){this.constructor=r};return s.prototype=i.prototype,r.prototype=new s,o&&e.util.extend(r.prototype,o),r},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(o){return this.base.options[o]}},["execAction","on","off","subscribe","trigger"].forEach(function(o){t.prototype[o]=function(){return this.base[o].apply(this.base,arguments)}}),e.Extension=t})(),(function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var o={findMatchingSelectionParent:function(i,r){var s=r.getSelection(),a,l;return s.rangeCount===0?!1:(a=s.getRangeAt(0),l=a.commonAncestorContainer,e.util.traverseUp(l,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(r){return e.util.isMediumEditorElement(r)},i)},exportSelection:function(i,r){if(!i)return null;var s=null,a=r.getSelection();if(a.rangeCount>0){var l=a.getRangeAt(0),d=l.cloneRange(),c;d.selectNodeContents(i),d.setEnd(l.startContainer,l.startOffset),c=d.toString().length,s={start:c,end:c+l.toString().length},this.doesRangeStartWithImages(l,r)&&(s.startsWithImage=!0);var p=this.getTrailingImageCount(i,s,l.endContainer,l.endOffset);if(p&&(s.trailingImageCount=p),c!==0){var f=this.getIndexRelativeToAdjacentEmptyBlocks(r,i,l.startContainer,l.startOffset);f!==-1&&(s.emptyBlocksIndex=f)}}return s},importSelection:function(i,r,s,a){if(!(!i||!r)){var l=s.createRange();l.setStart(r,0),l.collapse(!0);var d=r,c=[],p=0,f=!1,h=!1,v=0,y=!1,g,_=!1,b=null;for((a||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(_=!0);!y&&d;){if(d.nodeType>3){d=c.pop();continue}if(d.nodeType===3&&!h)g=p+d.length,!f&&i.start>=p&&i.start<=g&&(_||i.start<g?(l.setStart(d,i.start-p),f=!0):b=d),f&&i.end>=p&&i.end<=g&&(i.trailingImageCount?h=!0:(l.setEnd(d,i.end-p),y=!0)),p=g;else{if(i.trailingImageCount&&h&&(d.nodeName.toLowerCase()==="img"&&v++,v===i.trailingImageCount)){for(var C=0;d.parentNode.childNodes[C]!==d;)C++;l.setEnd(d.parentNode,C+1),y=!0}if(!y&&d.nodeType===1)for(var T=d.childNodes.length-1;T>=0;)c.push(d.childNodes[T]),T-=1}y||(d=c.pop())}!f&&b&&(l.setStart(b,b.length),l.setEnd(b,b.length)),typeof i.emptyBlocksIndex<"u"&&(l=this.importSelectionMoveCursorPastBlocks(s,r,i.emptyBlocksIndex,l)),a&&(l=this.importSelectionMoveCursorPastAnchor(i,l)),this.selectRange(s,l)}},importSelectionMoveCursorPastAnchor:function(i,r){var s=function(p){return p.nodeName.toLowerCase()==="a"};if(i.start===i.end&&r.startContainer.nodeType===3&&r.startOffset===r.startContainer.nodeValue.length&&e.util.traverseUp(r.startContainer,s)){for(var a=r.startContainer,l=r.startContainer.parentNode;l!==null&&l.nodeName.toLowerCase()!=="a";)l.childNodes[l.childNodes.length-1]!==a?l=null:(a=l,l=l.parentNode);if(l!==null&&l.nodeName.toLowerCase()==="a"){for(var d=null,c=0;d===null&&c<l.parentNode.childNodes.length;c++)l.parentNode.childNodes[c]===l&&(d=c);r.setStart(l.parentNode,d+1),r.collapse(!0)}}return r},importSelectionMoveCursorPastBlocks:function(i,r,s,a){var l=i.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),d=a.startContainer,c,p,f=0;for(s=s||1,d.nodeType===3&&e.util.isBlockContainer(d.previousSibling)?c=d.previousSibling:c=e.util.getClosestBlockContainer(d);l.nextNode();)if(!p)c===l.currentNode&&(p=l.currentNode);else if(p=l.currentNode,f++,f===s||p.textContent.length>0)break;return p||(p=c),a.setStart(e.util.getFirstSelectableLeafNode(p),0),a},getIndexRelativeToAdjacentEmptyBlocks:function(i,r,s,a){if(s.textContent.length>0&&a>0)return-1;var l=s;if(l.nodeType!==3&&(l=s.childNodes[a]),l){if(!e.util.isElementAtBeginningOfBlock(l))return-1;var d=e.util.findPreviousSibling(l);if(d){if(d.nodeValue)return-1}else return-1}for(var c=e.util.getClosestBlockContainer(s),p=i.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),f=0;p.nextNode();){var h=p.currentNode.textContent==="";if((h||f>0)&&(f+=1),p.currentNode===c)return f;h||(f=0)}return f},doesRangeStartWithImages:function(i,r){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var s=i.startContainer.querySelector("img");if(!s)return!1;for(var a=r.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);a.nextNode();){var l=a.currentNode;if(l===s)break;if(l.nodeValue)return!1}return!0},getTrailingImageCount:function(i,r,s,a){if(a===0||s.nodeType!==1||s.nodeName.toLowerCase()!=="img"&&!s.querySelector("img"))return 0;for(var l=s.childNodes[a-1];l.hasChildNodes();)l=l.lastChild;for(var d=i,c=[],p=0,f=!1,h=!1,v=!1,y,g=0;!v&&d;){if(d.nodeType>3){d=c.pop();continue}if(d.nodeType===3&&!h)g=0,y=p+d.length,!f&&r.start>=p&&r.start<=y&&(f=!0),f&&r.end>=p&&r.end<=y&&(h=!0),p=y;else if(d.nodeName.toLowerCase()==="img"&&g++,d===l)v=!0;else if(d.nodeType===1)for(var _=d.childNodes.length-1;_>=0;)c.push(d.childNodes[_]),_-=1;v||(d=c.pop())}return g},selectionContainsContent:function(i){var r=i.getSelection();if(!r||r.isCollapsed||!r.rangeCount)return!1;if(r.toString().trim()!=="")return!0;var s=this.getSelectedParentElement(r.getRangeAt(0));return!!(s&&(s.nodeName.toLowerCase()==="img"||s.nodeType===1&&s.querySelector("img")))},selectionInContentEditableFalse:function(i){var r,s=this.findMatchingSelectionParent(function(a){var l=a&&a.getAttribute("contenteditable");return l==="true"&&(r=!0),a.nodeName!=="#text"&&l==="false"},i);return!r&&s},getSelectionHtml:function(r){var s,a="",l=r.getSelection(),d,c;if(l.rangeCount){for(c=r.createElement("div"),s=0,d=l.rangeCount;s<d;s+=1)c.appendChild(l.getRangeAt(s).cloneContents());a=c.innerHTML}return a},getCaretOffsets:function(r,s){var a,l;return s||(s=window.getSelection().getRangeAt(0)),a=s.cloneRange(),l=s.cloneRange(),a.selectNodeContents(r),a.setEnd(s.endContainer,s.endOffset),l.selectNodeContents(r),l.setStart(s.endContainer,s.endOffset),{left:a.toString().length,right:l.toString().length}},rangeSelectsSingleNode:function(i){var r=i.startContainer;return r===i.endContainer&&r.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var r=i.getSelection(),s,a,l;if(!r.rangeCount||r.isCollapsed||!r.getRangeAt(0).commonAncestorContainer)return[];if(s=r.getRangeAt(0),s.commonAncestorContainer.nodeType===3){for(a=[],l=s.commonAncestorContainer;l.parentNode&&l.parentNode.childNodes.length===1;)a.push(l.parentNode),l=l.parentNode;return a}return[].filter.call(s.commonAncestorContainer.getElementsByTagName("*"),function(d){return typeof r.containsNode=="function"?r.containsNode(d,!0):!0})},selectNode:function(i,r){var s=r.createRange();s.selectNodeContents(i),this.selectRange(r,s)},select:function(i,r,s,a,l){var d=i.createRange();return d.setStart(r,s),a?d.setEnd(a,l):d.collapse(!0),this.selectRange(i,d),d},clearSelection:function(i,r){r?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,r,s){this.select(i,r,s)},getSelectionRange:function(i){var r=i.getSelection();return r.rangeCount===0?null:r.getRangeAt(0)},selectRange:function(i,r){var s=i.getSelection();s.removeAllRanges(),s.addRange(r)},getSelectionStart:function(i){var r=i.getSelection().anchorNode,s=r&&r.nodeType===3?r.parentNode:r;return s}};e.selection=o})(),(function(){function t(i,r){return i?i.some(function(s){if(typeof s.getInteractionElements!="function")return!1;var a=s.getInteractionElements();return a?(Array.isArray(a)||(a=[a]),a.some(function(l){return e.util.isDescendant(l,r,!0)})):!1}):!1}var o=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};o.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,r,s,a){var l=this.base.options.contentWindow,d=this.base.options.ownerDocument;i=e.util.isElement(i)||[l,d].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(c){c.addEventListener(r,s,a),this.events.push([c,r,s,a])}).bind(this))},detachDOMEvent:function(i,r,s,a){var l,d,c=this.base.options.contentWindow,p=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[c,p].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(f){l=this.indexOfListener(f,r,s,a),l!==-1&&(d=this.events.splice(l,1)[0],d[0].removeEventListener(d[1],d[2],d[3]))}).bind(this)))},indexOfListener:function(i,r,s,a){var l,d,c;for(l=0,d=this.events.length;l<d;l=l+1)if(c=this.events[l],c[0]===i&&c[1]===r&&c[2]===s&&c[3]===a)return l;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var r=this.events.filter(function(d){return d&&d[0].getAttribute&&d[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),s=0,a=r.length;s<a;s++){var l=r[s];this.detachDOMEvent(l[0],l[1],l[2],l[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(r){this.attachDOMEvent(i,r.name,r.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,r){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(r)},detachCustomEvent:function(i,r){var s=this.indexOfCustomListener(i,r);s!==-1&&this.customEvents[i].splice(s,1)},indexOfCustomListener:function(i,r){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(r)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,r,s){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(a){a(r,s)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var r=i.execCommand.listeners.indexOf(this.execCommandListener);r!==-1&&i.execCommand.listeners.splice(r,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var r=function(a,l){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(d){d({command:a[0],value:a[2],args:a,result:l})})},s=function(){var a=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return a;var l=Array.prototype.slice.call(arguments);return r(l,a),a};s.orig=i.execCommand,s.listeners=[],s.callListeners=r,i.execCommand=s}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(r){this.contentCache[r.getAttribute("medium-editor-index")]=r.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,r){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(s){this.attachDOMEvent(s,i,r.bind(this))},this),this.eventsCache.push({name:i,handler:r})},cleanupElement:function(i){var r=i.getAttribute("medium-editor-index");r&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[r])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,r){var s=this.base.getFocusedElement(),a;s&&r.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(s,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(a=s),a||this.base.elements.some(function(d){return!a&&e.util.isDescendant(d,i,!0)&&(a=d),!!a},this);var l=!e.util.isDescendant(s,i,!0)&&!t(this.base.extensions,i);a!==s&&(s&&l&&(s.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",r,s)),a&&(a.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",r,a))),l&&this.triggerCustomEvent("externalInteraction",r)},updateInput:function(i,r){if(this.contentCache){var s=i.getAttribute("medium-editor-index"),a=i.innerHTML;a!==this.contentCache[s]&&this.triggerCustomEvent("editableInput",r,i),this.contentCache[s]=a}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var r=i.currentTarget.activeElement,s;this.base.elements.some(function(a){return e.util.isDescendant(a,r,!0)?(s=a,!0):!1},this),s&&this.updateInput(s,{target:r,currentTarget:s})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var r={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(r.currentTarget,r)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=o})(),(function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(o){t.isBuiltInButton(o)?e.Extension.call(this,this.defaults[o]):e.Extension.call(this,o)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var o=this.document.createElement("button"),i=this.contentDefault,r=this.getAria(),s=this.getEditorOption("buttonLabels");return o.classList.add("medium-editor-action"),o.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(a){o.classList.add(a)}),o.setAttribute("data-action",this.getAction()),r&&(o.setAttribute("title",r),o.setAttribute("aria-label",r)),this.attrs&&Object.keys(this.attrs).forEach(function(a){o.setAttribute(a,this.attrs[a])},this),s==="fontawesome"&&this.contentFA&&(i=this.contentFA),o.innerHTML=i,o},handleClick:function(o){o.preventDefault(),o.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var o=null;return this.useQueryState&&(o=this.base.queryCommandState(this.getAction())),o},isAlreadyApplied:function(o){var i=!1,r=this.getTagNames(),s,a;return this.knownState===!1||this.knownState===!0?this.knownState:(r&&r.length>0&&(i=r.indexOf(o.nodeName.toLowerCase())!==-1),!i&&this.style&&(s=this.style.value.split("|"),a=this.window.getComputedStyle(o,null).getPropertyValue(this.style.prop),s.forEach(function(l){this.knownState||(i=a.indexOf(l)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(o){return typeof o=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(o)},e.extensions.button=t})(),(function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}})(),(function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var o=this.base.getExtensionByName("toolbar");o&&o.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var o=this.base.getExtensionByName("toolbar");o&&o.hideToolbarDefaultActions()},setToolbarPosition:function(){var o=this.base.getExtensionByName("toolbar");o&&o.setToolbarPosition()}});e.extensions.form=t})(),(function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(o){o.preventDefault(),o.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(o){e.util.isKey(o,e.util.keyCode.K)&&e.util.isMetaCtrlKey(o)&&!o.shiftKey&&this.handleClick(o)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var o=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return o.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),o.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&o.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&o.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),o.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(o){var i=this.getInput(),r=this.getAnchorTargetCheckbox(),s=this.getAnchorButtonCheckbox();if(o=o||{value:""},typeof o=="string"&&(o={value:o}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=o.value,i.focus(),r&&(r.checked=o.target==="_blank"),s){var a=o.buttonClass?o.buttonClass.split(" "):[];s.checked=a.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var o=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),r={value:this.getInput().value.trim()};return this.linkValidation&&(r.value=this.checkLinkFormat(r.value)),r.target="_self",o&&o.checked&&(r.target="_blank"),i&&i.checked&&(r.buttonClass=this.customClassOption),r},doFormSave:function(){var o=this.getFormOpts();this.completeFormSave(o)},completeFormSave:function(o){this.base.restoreSelection(),this.execAction(this.action,o),this.base.checkSelection()},ensureEncodedUri:function(o){return o===decodeURI(o)?encodeURI(o):o},ensureEncodedUriComponent:function(o){return o===decodeURIComponent(o)?encodeURIComponent(o):o},ensureEncodedParam:function(o){var i=o.split("="),r=i[0],s=i[1];return r+(s===void 0?"":"="+this.ensureEncodedUriComponent(s))},ensureEncodedQuery:function(o){return o.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(o){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,r=i.test(o),s="",a=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,l=o.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),d=l[1],c=l[2],p=l[3];if(a.test(o))return"tel:"+o;if(!r){var f=d.split("/")[0];(f.match(/.+(\.|:).+/)||f==="localhost")&&(s="http://")}return s+this.ensureEncodedUri(d)+(c===void 0?"":"?"+this.ensureEncodedQuery(c))+(p===void 0?"":"#"+p)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(o){var i=o.querySelector(".medium-editor-toolbar-close"),r=o.querySelector(".medium-editor-toolbar-save"),s=o.querySelector(".medium-editor-toolbar-input");this.on(o,"click",this.handleFormClick.bind(this)),this.on(s,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(r,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var o=this.document,i=o.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(o){if(o.keyCode===e.util.keyCode.ENTER){o.preventDefault(),this.doFormSave();return}o.keyCode===e.util.keyCode.ESCAPE&&(o.preventDefault(),this.doFormCancel())},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t})(),(function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var o=this.document.createElement("div");return o.id="medium-editor-anchor-preview-"+this.getEditorId(),o.className="medium-editor-anchor-preview",o.innerHTML=this.getTemplate(),this.on(o,"click",this.handleClick.bind(this)),o},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(o){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||o.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=o.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=o.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=o,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(o){o=o||this.activeAnchor;var i=this.window.innerWidth,r=this.anchorPreview.offsetHeight,s=o.getBoundingClientRect(),a=this.diffLeft,l=this.diffTop,d=this.getEditorOption("elementsContainer"),c=["absolute","fixed"].indexOf(window.getComputedStyle(d).getPropertyValue("position"))>-1,p={},f,h,v,y,g;f=this.anchorPreview.offsetWidth/2;var _=this.base.getExtensionByName("toolbar");_&&(a=_.diffLeft,l=_.diffTop),h=a-f,c?(y=d.getBoundingClientRect(),["top","left"].forEach(function(b){p[b]=s[b]-y[b]}),p.width=s.width,p.height=s.height,s=p,i=y.width,g=d.scrollTop):g=this.window.pageYOffset,v=s.left+s.width/2,g+=r+s.top+s.height-l-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(g)+"px",this.anchorPreview.style.right="initial",v<f?(this.anchorPreview.style.left=h+f+"px",this.anchorPreview.style.right="initial"):i-v<f?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=h+v+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(o){var i=this.base.getExtensionByName("anchor"),r=this.activeAnchor;i&&r&&(o.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(r){var s={value:r.attributes.href.value,target:r.getAttribute("target"),buttonClass:r.getAttribute("class")};i.showForm(s),r=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(o){var i=e.util.getClosestTag(o.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var r=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&r&&r.isDisplayed&&r.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(o){(!o.relatedTarget||!/anchor-preview/.test(o.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var o=new Date().getTime()-this.lastOver;o>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t})(),(function(){var t,o,i,r,s;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],o="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+o+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+o+"))",r=new RegExp("^("+o+")$","i"),s=new RegExp(i,"gi");function a(d){return!e.util.getClosestTag(d,"a")}var l=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var d=0,c=0;c<this.window._mediumEditors.length;c++){var p=this.window._mediumEditors[c];p!==null&&p.getExtensionByName("autoLink")!==void 0&&d++}return d===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(d,c){this.performLinking(c)},onKeypress:function(d){this.disableEventHandling||e.util.isKey(d,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var c=this.base.exportSelection();this.performLinking(d.target)&&this.base.importSelection(c,!0)}catch(p){window.console&&window.console.error("Failed to perform linking",p),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(d){var c=e.util.splitByBlockElements(d),p=!1;c.length===0&&(c=[d]);for(var f=0;f<c.length;f++)p=this.removeObsoleteAutoLinkSpans(c[f])||p,p=this.performLinkingWithinElement(c[f])||p;return this.base.events.updateInput(d,{target:d,currentTarget:d}),p},removeObsoleteAutoLinkSpans:function(d){if(!d||d.nodeType===3)return!1;for(var c=d.querySelectorAll('span[data-auto-link="true"]'),p=!1,f=0;f<c.length;f++){var h=c[f].textContent;if(h.indexOf("://")===-1&&(h=e.util.ensureUrlHasProtocol(h)),c[f].getAttribute("data-href")!==h&&a(c[f])){p=!0;var v=h.replace(/\s+$/,"");if(c[f].getAttribute("data-href")===v){var y=h.length-v.length,g=e.util.splitOffDOMTree(c[f],this.splitTextBeforeEnd(c[f],y));c[f].parentNode.insertBefore(g,c[f].nextSibling)}else e.util.unwrap(c[f],this.document)}}return p},splitTextBeforeEnd:function(d,c){for(var p=this.document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null,!1),f=!0;f;)f=p.lastChild()!==null;for(var h,v,y;c>0&&y!==null;)h=p.currentNode,v=h.nodeValue,v.length>c?(y=h.splitText(v.length-c),c=0):(y=p.previousNode(),c-=v.length);return y},performLinkingWithinElement:function(d){for(var c=this.findLinkableText(d),p=!1,f=0;f<c.length;f++){var h=e.util.findOrCreateMatchingTextNodes(this.document,d,c[f]);this.shouldNotLink(h)||this.createAutoLink(h,c[f].href)}return p},shouldNotLink:function(d){for(var c=!1,p=0;p<d.length&&c===!1;p++)c=!!e.util.traverseUp(d[p],function(f){return f.nodeName.toLowerCase()==="a"||f.getAttribute&&f.getAttribute("data-auto-link")==="true"});return c},findLinkableText:function(d){for(var c=d.textContent,p=null,f=[];(p=s.exec(c))!==null;){var h=!0,v=p.index+p[0].length;h=(p.index===0||t.indexOf(c[p.index-1])!==-1)&&(v===c.length||t.indexOf(c[v])!==-1),h=h&&(p[0].indexOf("/")!==-1||r.test(p[0].split(".").pop().split("?").shift())),h&&f.push({href:p[0],start:p.index,end:v})}return f},createAutoLink:function(d,c){c=e.util.ensureUrlHasProtocol(c);var p=e.util.createLink(this.document,d,c,this.getEditorOption("targetBlank")?"_blank":null),f=this.document.createElement("span");for(f.setAttribute("data-auto-link","true"),f.setAttribute("data-href",c),p.insertBefore(f,p.firstChild);p.childNodes.length>1;)f.appendChild(p.childNodes[1])}});e.extensions.autoLink=l})(),(function(){var t="medium-editor-dragover";function o(r){var s=e.util.getContainerEditorElement(r),a=Array.prototype.slice.call(s.parentElement.querySelectorAll("."+t));a.forEach(function(l){l.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(r){r.preventDefault(),r.dataTransfer.dropEffect="copy";var s=r.target.classList?r.target:r.target.parentElement;o(s),r.type==="dragover"&&s.classList.add(t)},handleDrop:function(r){r.preventDefault(),r.stopPropagation(),this.base.selectElement(r.target);var s=this.base.exportSelection();s.start=s.end,this.base.importSelection(s),r.dataTransfer.files&&Array.prototype.slice.call(r.dataTransfer.files).forEach(function(a){this.isAllowedFile(a)&&a.type.match("image")&&this.insertImageFile(a)},this),o(r.target)},isAllowedFile:function(r){return this.allowedTypes.some(function(s){return!!r.type.match(s)})},insertImageFile:function(r){if(typeof FileReader=="function"){var s=new FileReader;s.readAsDataURL(r),s.addEventListener("load",(function(a){var l=this.document.createElement("img");l.src=a.target.result,e.util.insertHTMLCommand(this.document,l.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i})(),(function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(o){var i=o.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(o)},this)},handleKeydown:function(o){var i=e.util.getKeyCode(o);if(this.keys[i]){var r=e.util.isMetaCtrlKey(o),s=!!o.shiftKey,a=!!o.altKey;this.keys[i].forEach(function(l){l.meta===r&&l.shift===s&&(l.alt===a||l.alt===void 0)&&(o.preventDefault(),o.stopPropagation(),typeof l.command=="function"?l.command.apply(this):l.command!==!1&&this.execAction(l.command))},this)}}});e.extensions.keyboardCommands=t})(),(function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(o){if(o.preventDefault(),o.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(o){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=o||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var o=this.document,i=o.createElement("div"),r=o.createElement("select"),s=o.createElement("a"),a=o.createElement("a"),l;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var d=0;d<this.fonts.length;d++)l=o.createElement("option"),l.innerHTML=this.fonts[d],l.value=this.fonts[d],r.appendChild(l);return r.className="medium-editor-toolbar-select",i.appendChild(r),this.on(r,"change",this.handleFontChange.bind(this)),a.setAttribute("href","#"),a.className="medium-editor-toobar-save",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(a),this.on(a,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(o){o.nodeName.toLowerCase()==="font"&&o.hasAttribute("face")&&o.removeAttribute("face")})},handleFontChange:function(){var o=this.getSelect().value;o===""?this.clearFontName():this.execAction("fontName",{value:o})},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t})(),(function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(o){if(o.preventDefault(),o.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(o){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=o||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var o=this.document,i=o.createElement("div"),r=o.createElement("input"),s=o.createElement("a"),a=o.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),r.setAttribute("type","range"),r.setAttribute("min","1"),r.setAttribute("max","7"),r.className="medium-editor-toolbar-input",i.appendChild(r),this.on(r,"change",this.handleSliderChange.bind(this)),a.setAttribute("href","#"),a.className="medium-editor-toobar-save",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(a),this.on(a,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(o){o.nodeName.toLowerCase()==="font"&&o.hasAttribute("size")&&o.removeAttribute("size")})},handleSliderChange:function(){var o=this.getInput().value;o==="4"?this.clearFontSize():this.execAction("fontSize",{value:o})},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t})(),(function(){var t="%ME_PASTEBIN%",o=null,i=null,r=function(d){d.stopPropagation()};function s(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function a(d,c,p){var f=d.clipboardData||c.clipboardData||p.dataTransfer,h={};if(!f)return h;if(f.getData){var v=f.getData("Text");v&&v.length>0&&(h["text/plain"]=v)}if(f.types)for(var y=0;y<f.types.length;y++){var g=f.types[y];h[g]=f.getData(g)}return h}var l=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(d){this.on(d,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(d,c){this.on(c,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(d,c){if(!d.defaultPrevented){var p=a(d,this.window,this.document),f=p["text/html"],h=p["text/plain"];this.window.clipboardData&&d.clipboardData===void 0&&!f&&(f=h),(f||h)&&(d.preventDefault(),this.doPaste(f,h,c))}},doPaste:function(d,c,p){var f,h="",v;if(this.cleanPastedHTML&&d)return this.cleanPaste(d);if(c){if(this.getEditorOption("disableReturn")||p&&p.getAttribute("data-disable-return"))h=e.util.htmlEntities(c);else if(f=c.split(/[\r\n]+/g),f.length>1)for(v=0;v<f.length;v+=1)f[v]!==""&&(h+="<p>"+e.util.htmlEntities(f[v])+"</p>");else h=e.util.htmlEntities(f[0]);e.util.insertHTMLCommand(this.document,h)}},handlePasteBinPaste:function(d){if(d.defaultPrevented){this.removePasteBin();return}var c=a(d,this.window,this.document),p=c["text/html"],f=c["text/plain"],h=i;if(!this.cleanPastedHTML||p){d.preventDefault(),this.removePasteBin(),this.doPaste(p,f,h),this.trigger("editablePaste",{currentTarget:h,target:h},h);return}setTimeout((function(){this.cleanPastedHTML&&(p=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(p,f,h),this.trigger("editablePaste",{currentTarget:h,target:h},h)}).bind(this),0)},handleKeydown:function(d,c){e.util.isKey(d,e.util.keyCode.V)&&e.util.isMetaCtrlKey(d)&&(d.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(c))},createPasteBin:function(d){var c,p=e.selection.getSelectionRange(this.document),f=this.window.pageYOffset;i=d,p&&(c=p.getClientRects(),c.length?f+=c[0].top:p.startContainer.getBoundingClientRect!==void 0?f+=p.startContainer.getBoundingClientRect().top:f+=p.getBoundingClientRect().top),o=p;var h=this.document.createElement("div");h.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),h.setAttribute("style","border: 1px red solid; position: absolute; top: "+f+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),h.setAttribute("contentEditable",!0),h.innerHTML=t,this.document.body.appendChild(h),this.on(h,"focus",r),this.on(h,"focusin",r),this.on(h,"focusout",r),h.focus(),e.selection.selectNode(h,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(h,"paste",this.boundHandlePaste)},removePasteBin:function(){o!==null&&(e.selection.selectRange(this.document,o),o=null),i!==null&&(i=null);var d=this.getPasteBin();d&&d&&(this.off(d,"focus",r),this.off(d,"focusin",r),this.off(d,"focusout",r),this.off(d,"paste",this.boundHandlePaste),d.parentElement.removeChild(d))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var d=this.getPasteBin();if(!d||d.firstChild&&d.firstChild.id==="mcepastebin")return!1;var c=d.innerHTML;return!c||c===t?!1:c},cleanPaste:function(d){var c,p,f,h,v=/<p|<br|<div/.test(d),y=[].concat(this.preCleanReplacements||[],s(),this.cleanReplacements||[]);for(c=0;c<y.length;c+=1)d=d.replace(y[c][0],y[c][1]);if(!v)return this.pasteHTML(d);for(f=this.document.createElement("div"),f.innerHTML="<p>"+d.split("<br><br>").join("</p><p>")+"</p>",p=f.querySelectorAll("a,p,div,br"),c=0;c<p.length;c+=1)switch(h=p[c],h.innerHTML=h.innerHTML.replace(/\n/gi," "),h.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(h);break;case"br":this.filterLineBreak(h);break}this.pasteHTML(f.innerHTML)},pasteHTML:function(d,c){c=e.util.defaults({},c,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var p,f,h,v,y=this.document.createDocumentFragment();for(y.appendChild(this.document.createElement("body")),v=y.querySelector("body"),v.innerHTML=d,this.cleanupSpans(v),p=v.querySelectorAll("*"),h=0;h<p.length;h+=1)f=p[h],f.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(f),e.util.cleanupAttrs(f,c.cleanAttrs),e.util.cleanupTags(f,c.cleanTags),e.util.unwrapTags(f,c.unwrapTags);e.util.insertHTMLCommand(this.document,v.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(d){return d&&(d.nodeName.toLowerCase()==="p"||d.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(d){/^\s*$/.test(d.textContent)&&d.parentNode&&d.parentNode.removeChild(d)},filterLineBreak:function(d){this.isCommonBlock(d.previousElementSibling)?this.removeWithParent(d):this.isCommonBlock(d.parentNode)&&(d.parentNode.firstChild===d||d.parentNode.lastChild===d)?this.removeWithParent(d):d.parentNode&&d.parentNode.childElementCount===1&&d.parentNode.textContent===""&&this.removeWithParent(d)},removeWithParent:function(d){d&&d.parentNode&&(d.parentNode.parentNode&&d.parentNode.childElementCount===1?d.parentNode.parentNode.removeChild(d.parentNode):d.parentNode.removeChild(d))},cleanupSpans:function(d){var c,p,f,h=d.querySelectorAll(".replace-with"),v=function(y){return y&&y.nodeName!=="#text"&&y.getAttribute("contenteditable")==="false"};for(c=0;c<h.length;c+=1)p=h[c],f=this.document.createElement(p.classList.contains("bold")?"b":"i"),p.classList.contains("bold")&&p.classList.contains("italic")?f.innerHTML="<i>"+p.innerHTML+"</i>":f.innerHTML=p.innerHTML,p.parentNode.replaceChild(f,p);for(h=d.querySelectorAll("span"),c=0;c<h.length;c+=1){if(p=h[c],e.util.traverseUp(p,v))return!1;e.util.unwrap(p,this.document)}}});e.extensions.paste=l})(),(function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(o,i){this.initElement(i)},initElement:function(o){o.getAttribute("data-placeholder")||o.setAttribute("data-placeholder",this.text),this.updatePlaceholder(o)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(o,i){this.cleanupElement(i)},cleanupElement:function(o){o.getAttribute("data-placeholder")===this.text&&o.removeAttribute("data-placeholder")},showPlaceholder:function(o){o&&(e.util.isFF&&o.childNodes.length===0?(o.classList.add("medium-editor-placeholder-relative"),o.classList.remove("medium-editor-placeholder")):(o.classList.add("medium-editor-placeholder"),o.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(o){o&&(o.classList.remove("medium-editor-placeholder"),o.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(o,i){if(o.querySelector("img, blockquote, ul, ol, table")||o.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(o);i||this.showPlaceholder(o)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(o,i){var r=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,r)},handleFocus:function(o,i){this.hidePlaceholder(i)},handleBlur:function(o,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t})(),(function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(o,i){return this.base.extensions.forEach(function(r){if(r!==this)return o.apply(i||this,arguments)},this)},createToolbar:function(){var o=this.document.createElement("div");return o.id="medium-editor-toolbar-"+this.getEditorId(),o.className="medium-editor-toolbar",this.static?o.className+=" static-toolbar":this.relativeContainer?o.className+=" medium-editor-relative-toolbar":o.className+=" medium-editor-stalker-toolbar",o.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&o.appendChild(i.getForm())}),this.attachEventHandlers(),o},createToolbarButtons:function(){var o=this.document.createElement("ul"),i,r,s,a,l,d;return o.id="medium-editor-toolbar-actions"+this.getEditorId(),o.className="medium-editor-toolbar-actions",o.style.display="block",this.buttons.forEach(function(c){typeof c=="string"?(l=c,d=null):(l=c.name,d=c),a=this.base.addBuiltInExtension(l,d),a&&typeof a.getButton=="function"&&(r=a.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(r)?i.appendChild(r):i.innerHTML=r,o.appendChild(i))},this),s=o.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),o},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(o){if(o&&o.target&&e.util.isDescendant(this.getToolbarElement(),o.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(o){o.hasForm&&o.isDisplayed()&&o.hideForm()})},multipleBlockElementsSelected:function(){var o=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),r=e.selection.getSelectionHtml(this.document).replace(o,""),s=r.match(i);return!!s&&s.length>1},modifySelection:function(){var o=this.window.getSelection(),i=o.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var r=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(r){for(var s=0;r.nodeValue.substr(s,1).trim().length===0;)s=s+1;i=e.selection.select(this.document,r,s,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var o=e.selection.getSelectionElement(this.window);if(!o||this.getEditorElements().indexOf(o)===-1||o.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(o){typeof o.isActive=="function"&&typeof o.setInactive=="function"&&o.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var o=[],i=null,r=e.selection.getSelectionRange(this.document),s,a=function(l){typeof l.checkState=="function"?l.checkState(s):typeof l.isActive=="function"&&typeof l.isAlreadyApplied=="function"&&typeof l.setActive=="function"&&!l.isActive()&&l.isAlreadyApplied(s)&&l.setActive()};if(r&&(this.forEachExtension(function(l){if(typeof l.queryCommandState=="function"&&(i=l.queryCommandState(),i!==null)){i&&typeof l.setActive=="function"&&l.setActive();return}o.push(l)}),s=e.selection.getSelectedParentElement(r),!!this.getEditorElements().some(function(l){return e.util.isDescendant(l,s,!0)})))for(;s&&(o.forEach(a),!e.util.isMediumEditorElement(s));)s=s.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var o=this.base.getFocusedElement(),i=this.window.getSelection();if(!o)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(o):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(o){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,r=this.window.innerWidth,s=this.getToolbarElement(),a=o.getBoundingClientRect(),l=a.top+i,d=a.left+a.width/2,c=s.offsetHeight,p=s.offsetWidth,f=p/2,h;switch(this.sticky?i>l+o.offsetHeight-c-this.stickyTopOffset?(s.style.top=l+o.offsetHeight-c+"px",s.classList.remove("medium-editor-sticky-toolbar")):i>l-c-this.stickyTopOffset?(s.classList.add("medium-editor-sticky-toolbar"),s.style.top=this.stickyTopOffset+"px"):(s.classList.remove("medium-editor-sticky-toolbar"),s.style.top=l-c+"px"):s.style.top=l-c+"px",this.align){case"left":h=a.left;break;case"right":h=a.right-p;break;case"center":h=d-f;break}h<0?h=0:h+p>r&&(h=r-Math.ceil(p)-1),s.style.left=h+"px"},positionToolbar:function(o){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=o.getRangeAt(0),r=i.getBoundingClientRect();(!r||r.height===0&&r.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?r=i.startContainer.querySelector("img").getBoundingClientRect():r=i.startContainer.getBoundingClientRect());var s=this.window.innerWidth,a=this.getToolbarElement(),l=a.offsetHeight,d=a.offsetWidth,c=d/2,p=50,f=this.diffLeft-c,h=this.getEditorOption("elementsContainer"),v=["absolute","fixed"].indexOf(window.getComputedStyle(h).getPropertyValue("position"))>-1,y={},g={},_,b;v?(b=h.getBoundingClientRect(),["top","left"].forEach(function(C){g[C]=r[C]-b[C]}),g.width=r.width,g.height=r.height,r=g,s=b.width,y.top=h.scrollTop):y.top=this.window.pageYOffset,_=r.left+r.width/2,y.top+=r.top-l,r.top<p?(a.classList.add("medium-toolbar-arrow-over"),a.classList.remove("medium-toolbar-arrow-under"),y.top+=p+r.height-this.diffTop):(a.classList.add("medium-toolbar-arrow-under"),a.classList.remove("medium-toolbar-arrow-over"),y.top+=this.diffTop),_<c?(y.left=f+c,y.right="initial"):s-_<c?(y.left="auto",y.right=0):(y.left=f+_,y.right="initial"),["top","left","right"].forEach(function(C){a.style[C]=y[C]+(isNaN(y[C])?"":"px")})}});e.extensions.toolbar=t})(),(function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){var i="medium-editor-dragover";o.preventDefault(),o.dataTransfer.dropEffect="copy",o.type==="dragover"?o.target.classList.add(i):o.type==="dragleave"&&o.target.classList.remove(i)},handleDrop:function(o){var i="medium-editor-dragover",r;o.preventDefault(),o.stopPropagation(),o.dataTransfer.files&&(r=Array.prototype.slice.call(o.dataTransfer.files,0),r.some((function(s){if(s.type.match("image")){var a,l;a=new FileReader,a.readAsDataURL(s),l="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+l+'" />'),a.onload=(function(){var d=this.document.getElementById(l);d&&(d.removeAttribute("id"),d.removeAttribute("class"),d.src=a.result)}).bind(this)}}).bind(this))),o.target.classList.remove(i)}});e.extensions.imageDragging=t})(),(function(){function t(E){var D=e.selection.getSelectionStart(this.options.ownerDocument),N=D.textContent,F=e.selection.getCaretOffsets(D);(N[F.left-1]===void 0||N[F.left-1].trim()===""||N[F.left]!==void 0&&N[F.left].trim()==="")&&E.preventDefault()}function o(E,D){if(this.options.disableReturn||D.getAttribute("data-disable-return"))E.preventDefault();else if(this.options.disableDoubleReturn||D.getAttribute("data-disable-double-return")){var N=e.selection.getSelectionStart(this.options.ownerDocument);(N&&N.textContent.trim()===""&&N.nodeName.toLowerCase()!=="li"||N.previousElementSibling&&N.previousElementSibling.nodeName.toLowerCase()!=="br"&&N.previousElementSibling.textContent.trim()==="")&&E.preventDefault()}}function i(E){var D=e.selection.getSelectionStart(this.options.ownerDocument),N=D&&D.nodeName.toLowerCase();N==="pre"&&(E.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(D)&&(E.preventDefault(),E.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function r(E){var D,N=e.selection.getSelectionStart(this.options.ownerDocument),F=N.nodeName.toLowerCase(),Y=/^(\s+|<br\/?>)?$/i,L=/h\d/i;e.util.isKey(E,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&N.previousElementSibling&&L.test(F)&&e.selection.getCaretOffsets(N).left===0?e.util.isKey(E,e.util.keyCode.BACKSPACE)&&Y.test(N.previousElementSibling.innerHTML)?(N.previousElementSibling.parentNode.removeChild(N.previousElementSibling),E.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(E,e.util.keyCode.ENTER)&&(D=this.options.ownerDocument.createElement("p"),D.innerHTML="<br>",N.previousElementSibling.parentNode.insertBefore(D,N),E.preventDefault()):e.util.isKey(E,e.util.keyCode.DELETE)&&N.nextElementSibling&&N.previousElementSibling&&!L.test(F)&&Y.test(N.innerHTML)&&L.test(N.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,N.nextElementSibling),N.previousElementSibling.parentNode.removeChild(N),E.preventDefault()):e.util.isKey(E,e.util.keyCode.BACKSPACE)&&F==="li"&&Y.test(N.innerHTML)&&!N.previousElementSibling&&!N.parentElement.previousElementSibling&&N.nextElementSibling&&N.nextElementSibling.nodeName.toLowerCase()==="li"?(D=this.options.ownerDocument.createElement("p"),D.innerHTML="<br>",N.parentElement.parentElement.insertBefore(D,N.parentElement),e.selection.moveCursor(this.options.ownerDocument,D),N.parentElement.removeChild(N),E.preventDefault()):e.util.isKey(E,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(N,"blockquote")!==!1&&e.selection.getCaretOffsets(N).left===0?(E.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(E,e.util.keyCode.ENTER)&&e.util.getClosestTag(N,"blockquote")!==!1&&e.selection.getCaretOffsets(N).right===0?(D=this.options.ownerDocument.createElement("p"),D.innerHTML="<br>",N.parentElement.insertBefore(D,N.nextSibling),e.selection.moveCursor(this.options.ownerDocument,D),E.preventDefault()):e.util.isKey(E,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(N.parentElement)&&!N.previousElementSibling&&N.nextElementSibling&&Y.test(N.innerHTML)&&(E.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,N.nextSibling),N.parentElement.removeChild(N))}function s(E){var D=e.selection.getSelectionStart(this.options.ownerDocument),N;D&&(e.util.isMediumEditorElement(D)&&D.children.length===0&&!e.util.isBlockContainer(D)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(E,e.util.keyCode.ENTER)&&!e.util.isListItem(D)&&!e.util.isBlockContainer(D)&&(N=D.nodeName.toLowerCase(),N==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!E.shiftKey&&!E.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function a(E,D){var N=D.parentNode.querySelector('textarea[medium-editor-textarea-id="'+D.getAttribute("medium-editor-textarea-id")+'"]');N&&(N.value=D.innerHTML.trim())}function l(E){E._mediumEditors||(E._mediumEditors=[null]),this.id||(this.id=E._mediumEditors.length),E._mediumEditors[this.id]=this}function d(E){!E._mediumEditors||!E._mediumEditors[this.id]||(E._mediumEditors[this.id]=null)}function c(E,D,N){var F=[];if(E||(E=[]),typeof E=="string"&&(E=D.querySelectorAll(E)),e.util.isElement(E)&&(E=[E]),N)for(var Y=0;Y<E.length;Y++){var L=E[Y];e.util.isElement(L)&&!L.getAttribute("data-medium-editor-element")&&!L.getAttribute("medium-editor-textarea-id")&&F.push(L)}else F=Array.prototype.slice.apply(E);return F}function p(E){var D=E.parentNode.querySelector('textarea[medium-editor-textarea-id="'+E.getAttribute("medium-editor-textarea-id")+'"]');D&&(D.classList.remove("medium-editor-hidden"),D.removeAttribute("medium-editor-textarea-id")),E.parentNode&&E.parentNode.removeChild(E)}function f(E,D){return Object.keys(D).forEach(function(N){E[N]===void 0&&(E[N]=D[N])}),E}function h(E,D,N){var F={window:N.options.contentWindow,document:N.options.ownerDocument,base:N};return E=f(E,F),typeof E.init=="function"&&E.init(),E.name||(E.name=D),E}function v(){return this.elements.every(function(E){return!!E.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function y(){return v.call(this)?this.options.anchorPreview!==!1:!1}function g(){return this.options.placeholder!==!1}function _(){return this.options.autoLink!==!1}function b(){return this.options.imageDragging!==!1}function C(){return this.options.keyboardCommands!==!1}function T(){return!this.options.extensions.imageDragging}function M(E){for(var D=this.options.ownerDocument.createElement("div"),N=Date.now(),F="medium-editor-"+N,Y=E.attributes;this.options.ownerDocument.getElementById(F);)N++,F="medium-editor-"+N;D.className=E.className,D.id=F,D.innerHTML=E.value,E.setAttribute("medium-editor-textarea-id",F);for(var L=0,j=Y.length;L<j;L++)D.hasAttribute(Y[L].nodeName)||D.setAttribute(Y[L].nodeName,Y[L].value);return E.form&&this.on(E.form,"reset",(function(le){le.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(F))}).bind(this)),E.classList.add("medium-editor-hidden"),E.parentNode.insertBefore(D,E),D}function S(E,D){if(!E.getAttribute("data-medium-editor-element")){E.nodeName.toLowerCase()==="textarea"&&(E=M.call(this,E),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=a.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!E.getAttribute("data-disable-editing")&&(E.setAttribute("contentEditable",!0),E.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(E.getAttribute("data-disable-return")||E.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=o.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!E.getAttribute("data-disable-return")&&this.on(E,"keyup",s.bind(this));var N=e.util.guid();E.setAttribute("data-medium-editor-element",!0),E.classList.add("medium-editor-element"),E.setAttribute("role","textbox"),E.setAttribute("aria-multiline",!0),E.setAttribute("data-medium-editor-editor-index",D),E.setAttribute("medium-editor-index",N),P[N]=E.innerHTML,this.events.attachAllEventsToElement(E)}return E}function k(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",r.bind(this)),this.subscribe("editableKeydownEnter",r.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=o.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function A(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(Y){Y!=="toolbar"&&this.options.extensions[Y]&&this.extensions.push(h(this.options.extensions[Y],Y,this))},this),T.call(this)){var E=this.options.fileDragging;E||(E={},b.call(this)||(E.allowedTypes=[])),this.addBuiltInExtension("fileDragging",E)}var D={paste:!0,"anchor-preview":y.call(this),autoLink:_.call(this),keyboardCommands:C.call(this),placeholder:g.call(this)};Object.keys(D).forEach(function(Y){D[Y]&&this.addBuiltInExtension(Y)},this);var N=this.options.extensions.toolbar;if(!N&&v.call(this)){var F=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});N=new e.extensions.toolbar(F)}N&&this.extensions.push(h(N,"toolbar",this))}function $(E,D){var N=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return D&&N.forEach(function(F){D.hasOwnProperty(F[0])&&D[F[0]]!==void 0&&e.util.deprecated(F[0],F[1],"v6.0.0")}),e.util.defaults({},D,E)}function B(E,D){var N=/^append-(.+)$/gi,F=/justify([A-Za-z]*)$/g,Y,L;if(Y=N.exec(E),Y)return e.util.execFormatBlock(this.options.ownerDocument,Y[1]);if(E==="fontSize")return D.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),L=D.value||D.size,this.options.ownerDocument.execCommand("fontSize",!1,L);if(E==="fontName")return D.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),L=D.value||D.name,this.options.ownerDocument.execCommand("fontName",!1,L);if(E==="createLink")return this.createLink(D);if(E==="image"){var j=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,j)}if(E==="html"){var le=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,le)}if(F.exec(E)){var z=this.options.ownerDocument.execCommand(E,!1,null),V=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return V&&O.call(this,e.util.getTopBlockContainer(V)),z}return L=D&&D.value,this.options.ownerDocument.execCommand(E,!1,L)}function O(E){if(E){var D,N=Array.prototype.slice.call(E.childNodes).filter(function(F){var Y=F.nodeName.toLowerCase()==="div";return Y&&!D&&(D=F.style.textAlign),Y});N.length&&(this.saveSelection(),N.forEach(function(F){if(F.style.textAlign===D){var Y=F.lastChild;if(Y){e.util.unwrap(F,this.options.ownerDocument);var L=this.options.ownerDocument.createElement("BR");Y.parentNode.insertBefore(L,Y.nextSibling)}}},this),E.style.textAlign=D,this.restoreSelection())}}var P={};e.prototype={init:function(E,D){return this.options=$.call(this,this.defaults,D),this.origElements=E,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(l.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,A.call(this),k.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(E){typeof E.destroy=="function"&&E.destroy()},this),this.events.destroy(),this.elements.forEach(function(E){this.options.spellcheck&&(E.innerHTML=E.innerHTML),E.removeAttribute("contentEditable"),E.removeAttribute("spellcheck"),E.removeAttribute("data-medium-editor-element"),E.classList.remove("medium-editor-element"),E.removeAttribute("role"),E.removeAttribute("aria-multiline"),E.removeAttribute("medium-editor-index"),E.removeAttribute("data-medium-editor-editor-index"),E.getAttribute("medium-editor-textarea-id")&&p(E)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,d.call(this,this.options.contentWindow))},on:function(E,D,N,F){return this.events.attachDOMEvent(E,D,N,F),this},off:function(E,D,N,F){return this.events.detachDOMEvent(E,D,N,F),this},subscribe:function(E,D){return this.events.attachCustomEvent(E,D),this},unsubscribe:function(E,D){return this.events.detachCustomEvent(E,D),this},trigger:function(E,D,N){return this.events.triggerCustomEvent(E,D,N),this},delay:function(E){var D=this;return setTimeout(function(){D.isActive&&E()},this.options.delay)},serialize:function(){var E,D,N={},F=this.elements.length;for(E=0;E<F;E+=1)D=this.elements[E].id!==""?this.elements[E].id:"element-"+E,N[D]={value:this.elements[E].innerHTML.trim()};return N},getExtensionByName:function(E){var D;return this.extensions&&this.extensions.length&&this.extensions.some(function(N){return N.name===E?(D=N,!0):!1}),D},addBuiltInExtension:function(E,D){var N=this.getExtensionByName(E),F;if(N)return N;switch(E){case"anchor":F=e.util.extend({},this.options.anchor,D),N=new e.extensions.anchor(F);break;case"anchor-preview":N=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":N=new e.extensions.autoLink;break;case"fileDragging":N=new e.extensions.fileDragging(D);break;case"fontname":N=new e.extensions.fontName(this.options.fontName);break;case"fontsize":N=new e.extensions.fontSize(D);break;case"keyboardCommands":N=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":N=new e.extensions.paste(this.options.paste);break;case"placeholder":N=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(E)&&(D?(F=e.util.defaults({},D,e.extensions.button.prototype.defaults[E]),N=new e.extensions.button(F)):N=new e.extensions.button(E))}return N&&this.extensions.push(h(N,E,this)),N},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var E=this.getExtensionByName("toolbar");return E&&E.checkState(),this},queryCommandState:function(E){var D=/^full-(.+)$/gi,N,F=null;N=D.exec(E),N&&(E=N[1]);try{F=this.options.ownerDocument.queryCommandState(E)}catch{F=null}return F},execAction:function(E,D){var N=/^full-(.+)$/gi,F,Y;return F=N.exec(E),F?(this.saveSelection(),this.selectAllContents(),Y=B.call(this,F[1],D),this.restoreSelection()):Y=B.call(this,E,D),(E==="insertunorderedlist"||E==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),Y},getSelectedParentElement:function(E){return E===void 0&&(E=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(E)},selectAllContents:function(){var E=e.selection.getSelectionElement(this.options.contentWindow);if(E){for(;E.children.length===1;)E=E.children[0];this.selectElement(E)}},selectElement:function(E){e.selection.selectNode(E,this.options.ownerDocument);var D=e.selection.getSelectionElement(this.options.contentWindow);D&&this.events.focusElement(D)},getFocusedElement:function(){var E;return this.elements.some(function(D){return!E&&D.getAttribute("data-medium-focused")&&(E=D),!!E},this),E},exportSelection:function(){var E=e.selection.getSelectionElement(this.options.contentWindow),D=this.elements.indexOf(E),N=null;return D>=0&&(N=e.selection.exportSelection(E,this.options.ownerDocument)),N!==null&&D!==0&&(N.editableElementIndex=D),N},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(E,D){if(E){var N=this.elements[E.editableElementIndex||0];e.selection.importSelection(E,N,this.options.ownerDocument,D)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(E){var D=e.selection.getSelectionElement(this.options.contentWindow),N={},F;if(this.elements.indexOf(D)!==-1){try{if(this.events.disableCustomEvent("editableInput"),E.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),F=E.url||E.value,F&&F.trim().length>0){var Y=this.options.contentWindow.getSelection();if(Y){var L=Y.getRangeAt(0),j=L.commonAncestorContainer,le,z,V,J;if(L.endContainer.nodeType===3&&L.startContainer.nodeType!==3&&L.startOffset===0&&L.startContainer.firstChild===L.endContainer&&(j=L.endContainer),z=e.util.getClosestBlockContainer(L.startContainer),V=e.util.getClosestBlockContainer(L.endContainer),j.nodeType!==3&&j.textContent.length!==0&&z===V){var oe=z||D,W=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),le=this.exportSelection(),W.appendChild(oe.cloneNode(!0)),D===oe?e.selection.select(this.options.ownerDocument,oe.firstChild,0,oe.lastChild,oe.lastChild.nodeType===3?oe.lastChild.nodeValue.length:oe.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,oe,0,oe,oe.childNodes.length);var q=this.exportSelection();J=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,W,{start:le.start-q.start,end:le.end-q.start,editableElementIndex:le.editableElementIndex}),J.length===0&&(W=this.options.ownerDocument.createDocumentFragment(),W.appendChild(j.cloneNode(!0)),J=[W.firstChild.firstChild,W.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,J,F.trim());var re=(W.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,W.firstChild.innerHTML.replace(/^\s+/,"")),le.start-=re,le.end-=re,this.importSelection(le)}else this.options.ownerDocument.execCommand("createLink",!1,F);this.options.targetBlank||E.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),F):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),F),E.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),E.buttonClass)}}if(this.options.targetBlank||E.target==="_blank"||E.buttonClass){N=this.options.ownerDocument.createEvent("HTMLEvents"),N.initEvent("input",!0,!0,this.options.contentWindow);for(var ue=0,xe=this.elements.length;ue<xe;ue+=1)this.elements[ue].dispatchEvent(N)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",N,D)}},cleanPaste:function(E){this.getExtensionByName("paste").cleanPaste(E)},pasteHTML:function(E,D){this.getExtensionByName("paste").pasteHTML(E,D)},setContent:function(E,D){if(D=D||0,this.elements[D]){var N=this.elements[D];N.innerHTML=E,this.checkContentChanged(N)}},getContent:function(E){return E=E||0,this.elements[E]?this.elements[E].innerHTML.trim():null},checkContentChanged:function(E){E=E||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(E,{target:E,currentTarget:E})},resetContent:function(E){if(E){var D=this.elements.indexOf(E);D!==-1&&this.setContent(P[E.getAttribute("medium-editor-index")],D);return}this.elements.forEach(function(N,F){this.setContent(P[N.getAttribute("medium-editor-index")],F)},this)},addElements:function(E){var D=c(E,this.options.ownerDocument,!0);if(D.length===0)return!1;D.forEach(function(N){N=S.call(this,N,this.id),this.elements.push(N),this.trigger("addElement",{target:N,currentTarget:N},N)},this)},removeElements:function(E){var D=c(E,this.options.ownerDocument),N=D.map(function(F){return F.getAttribute("medium-editor-textarea-id")&&F.parentNode?F.parentNode.querySelector('div[medium-editor-textarea-id="'+F.getAttribute("medium-editor-textarea-id")+'"]'):F});this.elements=this.elements.filter(function(F){return N.indexOf(F)!==-1?(this.events.cleanupElement(F),F.getAttribute("medium-editor-textarea-id")&&p(F),this.trigger("removeElement",{target:F,currentTarget:F},F),!1):!0},this)}},e.getEditorFromElement=function(E){var D=E.getAttribute("data-medium-editor-editor-index"),N=E&&E.ownerDocument&&(E.ownerDocument.defaultView||E.ownerDocument.parentWindow);return N&&N._mediumEditors&&N._mediumEditors[D]?N._mediumEditors[D]:null}})(),(function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}})(),e.parseVersionString=function(t){var o=t.split("-"),i=o[0].split("."),r=o.length>1?o[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:r,toString:function(){return[i[0],i[1],i[2]].join(".")+(r?"-"+r:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e})())})(Ll)),Ll.exports}var Jee=Yee();const Mu=Ga(Jee);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var Mp=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},Tp=(function(){function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}})(),Dl=(function(){function n(e,t){var o=[],i=!0,r=!1,s=void 0;try{for(var a=e[Symbol.iterator](),l;!(i=(l=a.next()).done)&&(o.push(l.value),!(t&&o.length===t));i=!0);}catch(d){r=!0,s=d}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return o}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})();String.prototype.startsWith=String.prototype.startsWith||function(n){return this.indexOf(n)===0};String.prototype.padStart=String.prototype.padStart||function(n,e){for(var t=this;t.length<n;)t=e+t;return t};var Kee={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Dv(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?n.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):n.toString();return t||"0"}var Zee=(function(){function n(e,t,o,i){Mp(this,n);var r=this;function s(l){if(l.startsWith("hsl")){var d=l.match(/([\-\d\.e]+)/g).map(Number),c=Dl(d,4),p=c[0],f=c[1],h=c[2],v=c[3];v===void 0&&(v=1),p/=360,f/=100,h/=100,r.hsla=[p,f,h,v]}else if(l.startsWith("rgb")){var y=l.match(/([\-\d\.e]+)/g).map(Number),g=Dl(y,4),_=g[0],b=g[1],C=g[2],T=g[3];T===void 0&&(T=1),r.rgba=[_,b,C,T]}else l.startsWith("#")?r.rgba=n.hexToRgb(l):r.rgba=n.nameToRgb(l)||n.hexToRgb(l)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(o===void 0){var a=e&&""+e;a&&s(a.toLowerCase())}else this.rgba=[e,t,o,i===void 0?1:i]}return Tp(n,[{key:"printRGB",value:function(t){var o=t?this.rgba:this.rgba.slice(0,3),i=o.map(function(r,s){return Dv(r,s===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var o=[360,100,100,1],i=["","%","%",""],r=t?this.hsla:this.hsla.slice(0,3),s=r.map(function(a,l){return Dv(a*o[l],l===3?3:1)+i[l]});return t?"hsla("+s+")":"hsl("+s+")"}},{key:"printHex",value:function(t){var o=this.hex;return t?o:o.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=n.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=n.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,o=t.map(function(i,r){return r<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+o.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=n.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var o=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!o.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=o.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(r){return parseInt(r,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var o=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=Kee[o];return i===void 0?i:n.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var o=Dl(t,4),i=o[0],r=o[1],s=o[2],a=o[3];i/=255,r/=255,s/=255;var l=Math.max(i,r,s),d=Math.min(i,r,s),c=void 0,p=void 0,f=(l+d)/2;if(l===d)c=p=0;else{var h=l-d;switch(p=f>.5?h/(2-l-d):h/(l+d),l){case i:c=(r-s)/h+(r<s?6:0);break;case r:c=(s-i)/h+2;break;case s:c=(i-r)/h+4;break}c/=6}return[c,p,f,a]}},{key:"hslToRgb",value:function(t){var o=Dl(t,4),i=o[0],r=o[1],s=o[2],a=o[3],l=void 0,d=void 0,c=void 0;if(r===0)l=d=c=s;else{var p=function(g,_,b){return b<0&&(b+=1),b>1&&(b-=1),b<.16666666666666666?g+(_-g)*6*b:b<.5?_:b<.6666666666666666?g+(_-g)*(.6666666666666666-b)*6:g},f=s<.5?s*(1+r):s+r-s*r,h=2*s-f;l=p(h,f,i+1/3),d=p(h,f,i),c=p(h,f,i-1/3)}var v=[l*255,d*255,c*255].map(Math.round);return v[3]=a,v}}]),n})(),Qee=(function(){function n(){Mp(this,n),this._events=[]}return Tp(n,[{key:"add",value:function(t,o,i){t.addEventListener(o,i,!1),this._events.push({target:t,type:o,handler:i})}},{key:"remove",value:function(t,o,i){this._events=this._events.filter(function(r){var s=!0;return t&&t!==r.target&&(s=!1),o&&o!==r.type&&(s=!1),i&&i!==r.handler&&(s=!1),s&&n._doRemove(r.target,r.type,r.handler),!s})}},{key:"destroy",value:function(){this._events.forEach(function(t){return n._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,o,i){t.removeEventListener(o,i,!1)}}]),n})();function ete(n){var e=document.createElement("div");return e.innerHTML=n,e.firstElementChild}function Nd(n,e,t){var o=!1;function i(l,d,c){return Math.max(d,Math.min(l,c))}function r(l,d,c){if(c&&(o=!0),!!o){l.preventDefault();var p=e.getBoundingClientRect(),f=p.width,h=p.height,v=d.clientX,y=d.clientY,g=i(v-p.left,0,f),_=i(y-p.top,0,h);t(g/f,_/h)}}function s(l,d){var c=l.buttons===void 0?l.which:l.buttons;c===1?r(l,l,d):o=!1}function a(l,d){l.touches.length===1?r(l,l.touches[0],d):o=!1}n.add(e,"mousedown",function(l){s(l,!0)}),n.add(e,"touchstart",function(l){a(l,!0)}),n.add(window,"mousemove",s),n.add(e,"touchmove",a),n.add(window,"mouseup",function(l){o=!1}),n.add(e,"touchend",function(l){o=!1}),n.add(e,"touchcancel",function(l){o=!1})}var tte=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,nte=360,mm="keydown",Ol="mousedown",Md="focusin";function vi(n,e){return(e||document).querySelector(n)}function ote(n){n.preventDefault(),n.stopPropagation()}function Td(n,e,t,o,i){n.add(e,mm,function(r){t.indexOf(r.key)>=0&&o(r)})}var ym=(function(){function n(e){Mp(this,n),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new Qee,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return Tp(n,[{key:"setOptions",value:function(t){var o=this;if(!t)return;var i=this.settings;function r(d,c,p){for(var f in d)c[f]=d[f]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),r(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var s=t.color||t.colour;s&&this._setColor(s)}var a=i.parent;if(a&&i.popup&&!this._popupInited){var l=function(c){return o.openHandler(c)};this._events.add(a,"click",l),Td(this._events,a,[" ","Spacebar","Enter"],l),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var o=t&&t.type===mm?this._domEdit:this.domElement;setTimeout(function(){return o.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var o=t&&t.type,i=!1;if(!t)i=!0;else if(o===Ol||o===Md){var r=(this.__containedEvent||0)+100;t.timeStamp>r&&(i=!0)}else ote(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",o!==Ol&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,o){this.closeHandler(),this.setOptions(t),o&&this.openHandler()}},{key:"setColor",value:function(t,o){this._setColor(t,{silent:o})}},{key:"_setColor",value:function(t,o){if(typeof t=="string"&&(t=t.trim()),!!t){o=o||{};var i=void 0;try{i=new Zee(t)}catch(s){if(o.failSilently)return;throw s}if(!this.settings.alpha){var r=i.hsla;r[3]=1,i.hsla=r}this.colour=this.color=i,this._setHSLA(null,null,null,null,o)}}},{key:"setColour",value:function(t,o){this.setColor(t,o)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var o=this._toggleDOM(!0);return this._setPosition(),o}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',r=ete(i);return this.domElement=r,this._domH=vi(".picker_hue",r),this._domSL=vi(".picker_sl",r),this._domA=vi(".picker_alpha",r),this._domEdit=vi(".picker_editor input",r),this._domSample=vi(".picker_sample",r),this._domOkay=vi(".picker_done button",r),this._domCancel=vi(".picker_cancel button",r),r.classList.add("layout_"+this.settings.layout),this.settings.alpha||r.classList.add("no_alpha"),this.settings.editor||r.classList.add("no_editor"),this.settings.cancelButton||r.classList.add("no_cancel"),this._ifPopup(function(){return r.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,o=this,i=this.domElement,r=this._events;function s(d,c,p){r.add(d,c,p)}s(i,"click",function(d){return d.preventDefault()}),Nd(r,this._domH,function(d,c){return o._setHSLA(d)}),Nd(r,this._domSL,function(d,c){return o._setHSLA(null,d,1-c)}),this.settings.alpha&&Nd(r,this._domA,function(d,c){return o._setHSLA(null,null,null,1-c)});var a=this._domEdit;s(a,"input",function(d){o._setColor(this.value,{fromEditor:!0,failSilently:!0})}),s(a,"focus",function(d){var c=this;c.selectionStart===c.selectionEnd&&c.select()}),this._ifPopup(function(){var d=function(f){return t.closeHandler(f)};s(window,Ol,d),s(window,Md,d),Td(r,i,["Esc","Escape"],d);var c=function(f){t.__containedEvent=f.timeStamp};s(i,Ol,c),s(i,Md,c),s(t._domCancel,"click",d)});var l=function(c){t._ifPopup(function(){return t.closeHandler(c)}),t.onDone&&t.onDone(t.colour)};s(this._domOkay,"click",l),Td(r,i,["Enter"],l)}},{key:"_setPosition",value:function(){var t=this.settings.parent,o=this.domElement;t!==o.parentNode&&t.appendChild(o),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var r=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(s){s===r?o.classList.add(s):o.classList.remove(s)}),o.classList.add(r)})}},{key:"_setHSLA",value:function(t,o,i,r,s){s=s||{};var a=this.colour,l=a.hsla;[t,o,i,r].forEach(function(d,c){(d||d===0)&&(l[c]=d)}),a.hsla=l,this._updateUI(s),this.onChange&&!s.silent&&this.onChange(a)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var o=this.colour,i=o.hsla,r="hsl("+i[0]*nte+", 100%, 50%)",s=o.hslString,a=o.hslaString,l=this._domH,d=this._domSL,c=this._domA,p=vi(".picker_selector",l),f=vi(".picker_selector",d),h=vi(".picker_selector",c);function v(S,k,A){k.style.left=A*100+"%"}function y(S,k,A){k.style.top=A*100+"%"}v(l,p,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=r,v(d,f,i[1]),y(d,f,1-i[2]),d.style.color=s,y(c,h,1-i[3]);var g=s,_=g.replace("hsl","hsla").replace(")",", 0)"),b="linear-gradient("+[g,_]+")";if(this._domA.style.background=b+", "+tte,!t.fromEditor){var C=this.settings.editorFormat,T=this.settings.alpha,M=void 0;switch(C){case"rgb":M=o.printRGB(T);break;case"hsl":M=o.printHSL(T);break;default:M=o.printHex(T)}this._domEdit.value=M}this._domSample.style.color=a}},{key:"_ifPopup",value:function(t,o){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):o&&o()}},{key:"_toggleDOM",value:function(t){var o=this.domElement;if(!o)return!1;var i=t?"":"none",r=o.style.display!==i;return r&&(o.style.display=i),r}}]),n})();{var $d=document.createElement("style");$d.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild($d),ym.StyleElement=$d}var Rd={exports:{}},Ov;function bm(){return Ov||(Ov=1,(function(n,e){(function(t,o){n.exports=t()})(function(){var t="object",o="function",i="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],l=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(q,re){var ue=typeof q[re];return ue==o||!!(ue==t&&q[re])||ue=="unknown"}function c(q,re){return!!(typeof q[re]==t&&q[re])}function p(q,re){return typeof q[re]!=i}function f(q){return function(re,ue){for(var xe=ue.length;xe--;)if(!q(re,ue[xe]))return!1;return!0}}var h=f(d),v=f(c),y=f(p);function g(q){return q&&h(q,l)&&y(q,a)}function _(q){return c(q,"body")?q.body:q.getElementsByTagName("body")[0]}var b=[].forEach?function(q,re){q.forEach(re)}:function(q,re){for(var ue=0,xe=q.length;ue<xe;++ue)re(q[ue],ue)},C={},T=typeof window!=i&&typeof document!=i,M={isHostMethod:d,isHostObject:c,isHostProperty:p,areHostMethods:h,areHostObjects:v,areHostProperties:y,isTextRange:g,getBody:_,forEach:b},S={version:"1.3.2",initialized:!1,isBrowser:T,supported:!0,util:M,features:{},modules:C,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function k(q){typeof console!=i&&d(console,"log")}function A(q,re){T&&re?alert(q):k(q)}function $(q){S.initialized=!0,S.supported=!1,A("Rangy is not supported in this environment. Reason: "+q,S.config.alertOnFail)}S.fail=$;function B(q){A("Rangy warning: "+q,S.config.alertOnWarn)}S.warn=B;var O;({}).hasOwnProperty?(M.extend=O=function(q,re,ue){var xe,Te;for(var me in re)me==="__proto__"||me==="constructor"||me==="prototype"||re.hasOwnProperty(me)&&(xe=q[me],Te=re[me],ue&&xe!==null&&typeof xe=="object"&&Te!==null&&typeof Te=="object"&&O(xe,Te,!0),q[me]=Te);return re.hasOwnProperty("toString")&&(q.toString=re.toString),q},M.createOptions=function(q,re){var ue={};return O(ue,re),q&&O(ue,q),ue}):$("hasOwnProperty not supported"),T||$("Rangy can only run in a browser"),(function(){var q;if(T){var re=document.createElement("div");re.appendChild(document.createElement("span"));var ue=[].slice;try{ue.call(re.childNodes,0)[0].nodeType==1&&(q=function(xe){return ue.call(xe,0)})}catch{}}q||(q=function(xe){for(var Te=[],me=0,pe=xe.length;me<pe;++me)Te[me]=xe[me];return Te}),M.toArray=q})();var P;T&&(d(document,"addEventListener")?P=function(q,re,ue){q.addEventListener(re,ue,!1)}:d(document,"attachEvent")?P=function(q,re,ue){q.attachEvent("on"+re,ue)}:$("Document does not have required addEventListener or attachEvent method"),M.addListener=P);var E=[];function D(q){return q.message||q.description||String(q)}function N(){if(!(!T||S.initialized)){var q,re=!1,ue=!1;d(document,"createRange")&&(q=document.createRange(),h(q,s)&&y(q,r)&&(re=!0));var xe=_(document);if(!xe||xe.nodeName.toLowerCase()!="body"){$("No body element found");return}if(xe&&d(xe,"createTextRange")&&(q=xe.createTextRange(),g(q)&&(ue=!0)),!re&&!ue){$("Neither Range nor TextRange are available");return}S.initialized=!0,S.features={implementsDomRange:re,implementsTextRange:ue};var Te,me;for(var pe in C)(Te=C[pe])instanceof le&&Te.init(Te,S);for(var Ge=0,Le=E.length;Ge<Le;++Ge)try{E[Ge](S)}catch(_e){me="Rangy init listener threw an exception. Continuing. Detail: "+D(_e),k(me)}}}function F(q,re,ue){ue&&(q+=" in module "+ue.name),S.warn("DEPRECATED: "+q+" is deprecated. Please use "+re+" instead.")}function Y(q,re,ue,xe){q[re]=function(){return F(re,ue,xe),q[ue].apply(q,M.toArray(arguments))}}M.deprecationNotice=F,M.createAliasForDeprecatedMethod=Y,S.init=N,S.addInitListener=function(q){S.initialized?q(S):E.push(q)};var L=[];S.addShimListener=function(q){L.push(q)};function j(q){q=q||window,N();for(var re=0,ue=L.length;re<ue;++re)L[re](q)}T&&(S.shim=S.createMissingNativeApi=j,Y(S,"createMissingNativeApi","shim"));function le(q,re,ue){this.name=q,this.dependencies=re,this.initialized=!1,this.supported=!1,this.initializer=ue}le.prototype={init:function(){for(var q=this.dependencies||[],re=0,ue=q.length,xe,Te;re<ue;++re){if(Te=q[re],xe=C[Te],!xe||!(xe instanceof le))throw new Error("required module '"+Te+"' not found");if(xe.init(),!xe.supported)throw new Error("required module '"+Te+"' not supported")}this.initializer(this)},fail:function(q){throw this.initialized=!0,this.supported=!1,new Error(q)},warn:function(q){S.warn("Module "+this.name+": "+q)},deprecationNotice:function(q,re){S.warn("DEPRECATED: "+q+" in module "+this.name+" is deprecated. Please use "+re+" instead")},createError:function(q){return new Error("Error in Rangy "+this.name+" module: "+q)}};function z(q,re,ue){var xe=new le(q,re,function(Te){if(!Te.initialized){Te.initialized=!0;try{ue(S,Te),Te.supported=!0}catch(pe){var me="Module '"+q+"' failed to load: "+D(pe);k(me),pe.stack&&k(pe.stack)}}});return C[q]=xe,xe}S.createModule=function(q){var re,ue;arguments.length==2?(re=arguments[1],ue=[]):(re=arguments[2],ue=arguments[1]);var xe=z(q,ue,re);S.initialized&&S.supported&&xe.init()},S.createCoreModule=function(q,re,ue){z(q,re,ue)};function V(){}S.RangePrototype=V,S.rangePrototype=new V;function J(){}S.selectionPrototype=new J,S.createCoreModule("DomUtil",[],function(q,re){var ue="undefined",xe=q.util,Te=xe.getBody;xe.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||re.fail("document missing a Node creation method"),xe.isHostMethod(document,"getElementsByTagName")||re.fail("document missing getElementsByTagName method");var me=document.createElement("div");xe.areHostMethods(me,["insertBefore","appendChild","cloneNode"])||re.fail("Incomplete Element implementation"),xe.isHostProperty(me,"innerHTML")||re.fail("Element is missing innerHTML property");var pe=document.createTextNode("test");xe.areHostMethods(pe,["splitText","deleteData","insertData","appendData","cloneNode"])||re.fail("Incomplete Text Node implementation");var Ge=function(Ee,Ze){for(var we=Ee.length;we--;)if(Ee[we]===Ze)return!0;return!1};function Le(Ee){var Ze;return typeof Ee.namespaceURI==ue||(Ze=Ee.namespaceURI)===null||Ze=="http://www.w3.org/1999/xhtml"}function _e(Ee){var Ze=Ee.parentNode;return Ze.nodeType==1?Ze:null}function he(Ee){for(var Ze=0;Ee=Ee.previousSibling;)++Ze;return Ze}function be(Ee){switch(Ee.nodeType){case 7:case 10:return 0;case 3:case 8:return Ee.length;default:return Ee.childNodes.length}}function De(Ee,Ze){var we=[],Be;for(Be=Ee;Be;Be=Be.parentNode)we.push(Be);for(Be=Ze;Be;Be=Be.parentNode)if(Ge(we,Be))return Be;return null}function G(Ee,Ze,we){for(var Be=we?Ze:Ze.parentNode;Be;){if(Be===Ee)return!0;Be=Be.parentNode}return!1}function ie(Ee,Ze){return G(Ee,Ze,!0)}function ae(Ee,Ze,we){for(var Be,Qe=we?Ee:Ee.parentNode;Qe;){if(Be=Qe.parentNode,Be===Ze)return Qe;Qe=Be}return null}function Ae(Ee){var Ze=Ee.nodeType;return Ze==3||Ze==4||Ze==8}function fe(Ee){if(!Ee)return!1;var Ze=Ee.nodeType;return Ze==3||Ze==8}function Ie(Ee,Ze){var we=Ze.nextSibling,Be=Ze.parentNode;return we?Be.insertBefore(Ee,we):Be.appendChild(Ee),Ee}function je(Ee,Ze,we){var Be=Ee.cloneNode(!1);if(Be.deleteData(0,Ze),Ee.deleteData(Ze,Ee.length-Ze),Ie(Be,Ee),we)for(var Qe=0,qe;qe=we[Qe++];)qe.node==Ee&&qe.offset>Ze?(qe.node=Be,qe.offset-=Ze):qe.node==Ee.parentNode&&qe.offset>he(Ee)&&++qe.offset;return Be}function Ue(Ee){if(Ee.nodeType==9)return Ee;if(typeof Ee.ownerDocument!=ue)return Ee.ownerDocument;if(typeof Ee.document!=ue)return Ee.document;if(Ee.parentNode)return Ue(Ee.parentNode);throw re.createError("getDocument: no document found for node")}function ot(Ee){var Ze=Ue(Ee);if(typeof Ze.defaultView!=ue)return Ze.defaultView;if(typeof Ze.parentWindow!=ue)return Ze.parentWindow;throw re.createError("Cannot get a window object for node")}function it(Ee){if(typeof Ee.contentDocument!=ue)return Ee.contentDocument;if(typeof Ee.contentWindow!=ue)return Ee.contentWindow.document;throw re.createError("getIframeDocument: No Document object found for iframe element")}function Ke(Ee){if(typeof Ee.contentWindow!=ue)return Ee.contentWindow;if(typeof Ee.contentDocument!=ue)return Ee.contentDocument.defaultView;throw re.createError("getIframeWindow: No Window object found for iframe element")}function dt(Ee){return Ee&&xe.isHostMethod(Ee,"setTimeout")&&xe.isHostObject(Ee,"document")}function ce(Ee,Ze,we){var Be;if(Ee?xe.isHostProperty(Ee,"nodeType")?Be=Ee.nodeType==1&&Ee.tagName.toLowerCase()=="iframe"?it(Ee):Ue(Ee):dt(Ee)&&(Be=Ee.document):Be=document,!Be)throw Ze.createError(we+"(): Parameter must be a Window object or DOM node");return Be}function ve(Ee){for(var Ze;Ze=Ee.parentNode;)Ee=Ze;return Ee}function Ce(Ee,Ze,we,Be){var Qe,qe,ht,ut,an;if(Ee==we)return Ze===Be?0:Ze<Be?-1:1;if(Qe=ae(we,Ee,!0))return Ze<=he(Qe)?-1:1;if(Qe=ae(Ee,we,!0))return he(Qe)<Be?-1:1;if(qe=De(Ee,we),!qe)throw new Error("comparePoints error: nodes have no common ancestor");if(ht=Ee===qe?qe:ae(Ee,qe,!0),ut=we===qe?qe:ae(we,qe,!0),ht===ut)throw re.createError("comparePoints got to case 4 and childA and childB are the same!");for(an=qe.firstChild;an;){if(an===ht)return-1;if(an===ut)return 1;an=an.nextSibling}}var Se=!1;function Fe(Ee){var Ze;try{return Ze=Ee.parentNode,!1}catch{return!0}}(function(){var Ee=document.createElement("b");Ee.innerHTML="1";var Ze=Ee.firstChild;Ee.innerHTML="<br />",Se=Fe(Ze),q.features.crashyTextNodes=Se})();function ze(Ee){if(!Ee)return"[No node]";if(Se&&Fe(Ee))return"[Broken node]";if(Ae(Ee))return'"'+Ee.data+'"';if(Ee.nodeType==1){var Ze=Ee.id?' id="'+Ee.id+'"':"";return"<"+Ee.nodeName+Ze+">[index:"+he(Ee)+",length:"+Ee.childNodes.length+"]["+(Ee.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return Ee.nodeName}function Xe(Ee){for(var Ze=Ue(Ee).createDocumentFragment(),we;we=Ee.firstChild;)Ze.appendChild(we);return Ze}var lt;typeof window.getComputedStyle!=ue?lt=function(Ee,Ze){return ot(Ee).getComputedStyle(Ee,null)[Ze]}:typeof document.documentElement.currentStyle!=ue?lt=function(Ee,Ze){return Ee.currentStyle?Ee.currentStyle[Ze]:""}:re.fail("No means of obtaining computed style properties found");function wt(Ee,Ze,we){var Be=Te(Ee),Qe=Ee.createElement("div");Qe.contentEditable=""+!!we,Ze&&(Qe.innerHTML=Ze);var qe=Be.firstChild;return qe?Be.insertBefore(Qe,qe):Be.appendChild(Qe),Qe}function Yt(Ee){return Ee.parentNode.removeChild(Ee)}function zt(Ee){this.root=Ee,this._next=Ee}zt.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var Ee=this._current=this._next,Ze,we;if(this._current)if(Ze=Ee.firstChild,Ze)this._next=Ze;else{for(we=null;Ee!==this.root&&!(we=Ee.nextSibling);)Ee=Ee.parentNode;this._next=we}return this._current},detach:function(){this._current=this._next=this.root=null}};function gn(Ee){return new zt(Ee)}function yn(Ee,Ze){this.node=Ee,this.offset=Ze}yn.prototype={equals:function(Ee){return!!Ee&&this.node===Ee.node&&this.offset==Ee.offset},inspect:function(){return"[DomPosition("+ze(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function jt(Ee){this.code=this[Ee],this.codeName=Ee,this.message="DOMException: "+this.codeName}jt.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},jt.prototype.toString=function(){return this.message},q.dom={arrayContains:Ge,isHtmlNamespace:Le,parentElement:_e,getNodeIndex:he,getNodeLength:be,getCommonAncestor:De,isAncestorOf:G,isOrIsAncestorOf:ie,getClosestAncestorIn:ae,isCharacterDataNode:Ae,isTextOrCommentNode:fe,insertAfter:Ie,splitDataNode:je,getDocument:Ue,getWindow:ot,getIframeWindow:Ke,getIframeDocument:it,getBody:Te,isWindow:dt,getContentDocument:ce,getRootContainer:ve,comparePoints:Ce,isBrokenNode:Fe,inspectNode:ze,getComputedStyleProperty:lt,createTestElement:wt,removeNode:Yt,fragmentFromNodeChildren:Xe,createIterator:gn,DomPosition:yn},q.DOMException=jt}),S.createCoreModule("DomRange",["DomUtil"],function(q,re){var ue=q.dom,xe=q.util,Te=ue.DomPosition,me=q.DOMException,pe=ue.isCharacterDataNode,Ge=ue.getNodeIndex,Le=ue.isOrIsAncestorOf,_e=ue.getDocument,he=ue.comparePoints,be=ue.splitDataNode,De=ue.getClosestAncestorIn,G=ue.getNodeLength,ie=ue.arrayContains,ae=ue.getRootContainer,Ae=q.features.crashyTextNodes,fe=ue.removeNode;function Ie(te,I){return te.nodeType!=3&&(Le(te,I.startContainer)||Le(te,I.endContainer))}function je(te){return te.document||_e(te.startContainer)}function Ue(te){return ae(te.startContainer)}function ot(te){return new Te(te.parentNode,Ge(te))}function it(te){return new Te(te.parentNode,Ge(te)+1)}function Ke(te,I,Z){var ye=te.nodeType==11?te.firstChild:te;return pe(I)?Z==I.length?ue.insertAfter(te,I):I.parentNode.insertBefore(te,Z==0?I:be(I,Z)):Z>=I.childNodes.length?I.appendChild(te):I.insertBefore(te,I.childNodes[Z]),ye}function dt(te,I,Z){if(Bt(te),Bt(I),je(I)!=je(te))throw new me("WRONG_DOCUMENT_ERR");var ye=he(te.startContainer,te.startOffset,I.endContainer,I.endOffset),Me=he(te.endContainer,te.endOffset,I.startContainer,I.startOffset);return Z?ye<=0&&Me>=0:ye<0&&Me>0}function ce(te){for(var I,Z,ye=je(te.range).createDocumentFragment(),Me;Z=te.next();){if(I=te.isPartiallySelectedSubtree(),Z=Z.cloneNode(!I),I&&(Me=te.getSubtreeIterator(),Z.appendChild(ce(Me)),Me.detach()),Z.nodeType==10)throw new me("HIERARCHY_REQUEST_ERR");ye.appendChild(Z)}return ye}function ve(te,I,Z){var ye,Me;Z=Z||{stop:!1};for(var st,He;st=te.next();)if(te.isPartiallySelectedSubtree()){if(I(st)===!1){Z.stop=!0;return}else if(He=te.getSubtreeIterator(),ve(He,I,Z),He.detach(),Z.stop)return}else for(ye=ue.createIterator(st);Me=ye.next();)if(I(Me)===!1){Z.stop=!0;return}}function Ce(te){for(var I;te.next();)te.isPartiallySelectedSubtree()?(I=te.getSubtreeIterator(),Ce(I),I.detach()):te.remove()}function Se(te){for(var I,Z=je(te.range).createDocumentFragment(),ye;I=te.next();){if(te.isPartiallySelectedSubtree()?(I=I.cloneNode(!1),ye=te.getSubtreeIterator(),I.appendChild(Se(ye)),ye.detach()):te.remove(),I.nodeType==10)throw new me("HIERARCHY_REQUEST_ERR");Z.appendChild(I)}return Z}function Fe(te,I,Z){var ye=!!(I&&I.length),Me,st=!!Z;ye&&(Me=new RegExp("^("+I.join("|")+")$"));var He=[];return ve(new Xe(te,!1),function(nt){if(!(ye&&!Me.test(nt.nodeType))&&!(st&&!Z(nt))){var vt=te.startContainer;if(!(nt==vt&&pe(vt)&&te.startOffset==vt.length)){var Nt=te.endContainer;nt==Nt&&pe(Nt)&&te.endOffset==0||He.push(nt)}}}),He}function ze(te){var I=typeof te.getName>"u"?"Range":te.getName();return"["+I+"("+ue.inspectNode(te.startContainer)+":"+te.startOffset+", "+ue.inspectNode(te.endContainer)+":"+te.endOffset+")]"}function Xe(te,I){if(this.range=te,this.clonePartiallySelectedTextNodes=I,!te.collapsed){this.sc=te.startContainer,this.so=te.startOffset,this.ec=te.endContainer,this.eo=te.endOffset;var Z=te.commonAncestorContainer;this.sc===this.ec&&pe(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===Z&&!pe(this.sc)?this.sc.childNodes[this.so]:De(this.sc,Z,!0),this._last=this.ec===Z&&!pe(this.ec)?this.ec.childNodes[this.eo-1]:De(this.ec,Z,!0))}}Xe.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var te=this._current=this._next;return te&&(this._next=te!==this._last?te.nextSibling:null,pe(te)&&this.clonePartiallySelectedTextNodes&&(te===this.ec&&(te=te.cloneNode(!0)).deleteData(this.eo,te.length-this.eo),this._current===this.sc&&(te=te.cloneNode(!0)).deleteData(0,this.so))),te},remove:function(){var te=this._current,I,Z;pe(te)&&(te===this.sc||te===this.ec)?(I=te===this.sc?this.so:0,Z=te===this.ec?this.eo:te.length,I!=Z&&te.deleteData(I,Z-I)):te.parentNode&&fe(te)},isPartiallySelectedSubtree:function(){var te=this._current;return Ie(te,this.range)},getSubtreeIterator:function(){var te;if(this.isSingleCharacterDataNode)te=this.range.cloneRange(),te.collapse(!1);else{te=new An(je(this.range));var I=this._current,Z=I,ye=0,Me=I,st=G(I);Le(I,this.sc)&&(Z=this.sc,ye=this.so),Le(I,this.ec)&&(Me=this.ec,st=this.eo),Qt(te,Z,ye,Me,st)}return new Xe(te,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var lt=[1,3,4,5,7,8,10],wt=[2,9,11],Yt=[5,6,10,12],zt=[1,3,4,5,7,8,10,11],gn=[1,3,4,5,7,8];function yn(te){return function(I,Z){for(var ye,Me=Z?I:I.parentNode;Me;){if(ye=Me.nodeType,ie(te,ye))return Me;Me=Me.parentNode}return null}}var jt=yn([9,11]),Ee=yn(Yt),Ze=yn([6,10,12]),we=yn([1]);function Be(te,I){if(Ze(te,I))throw new me("INVALID_NODE_TYPE_ERR")}function Qe(te,I){if(!ie(I,te.nodeType))throw new me("INVALID_NODE_TYPE_ERR")}function qe(te,I){if(I<0||I>(pe(te)?te.length:te.childNodes.length))throw new me("INDEX_SIZE_ERR")}function ht(te,I){if(jt(te,!0)!==jt(I,!0))throw new me("WRONG_DOCUMENT_ERR")}function ut(te){if(Ee(te,!0))throw new me("NO_MODIFICATION_ALLOWED_ERR")}function an(te,I){if(!te)throw new me(I)}function un(te,I){return I<=(pe(te)?te.length:te.childNodes.length)}function kn(te){return!!te.startContainer&&!!te.endContainer&&!(Ae&&(ue.isBrokenNode(te.startContainer)||ue.isBrokenNode(te.endContainer)))&&ae(te.startContainer)==ae(te.endContainer)&&un(te.startContainer,te.startOffset)&&un(te.endContainer,te.endOffset)}function Bt(te){if(!kn(te))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+te.inspect()+")")}var Rn=document.createElement("style"),Tn=!1;try{Rn.innerHTML="<b>x</b>",Tn=Rn.firstChild.nodeType==3}catch{}q.features.htmlParsingConforms=Tn;var So=Tn?function(te){var I=this.startContainer,Z=_e(I);if(!I)throw new me("INVALID_STATE_ERR");var ye=null;return I.nodeType==1?ye=I:pe(I)&&(ye=ue.parentElement(I)),ye===null||ye.nodeName=="HTML"&&ue.isHtmlNamespace(_e(ye).documentElement)&&ue.isHtmlNamespace(ye)?ye=Z.createElement("body"):ye=ye.cloneNode(!1),ye.innerHTML=te,ue.fragmentFromNodeChildren(ye)}:function(te){var I=je(this),Z=I.createElement("body");return Z.innerHTML=te,ue.fragmentFromNodeChildren(Z)};function Mi(te,I){Bt(te);var Z=te.startContainer,ye=te.startOffset,Me=te.endContainer,st=te.endOffset,He=Z===Me;pe(Me)&&st>0&&st<Me.length&&be(Me,st,I),pe(Z)&&ye>0&&ye<Z.length&&(Z=be(Z,ye,I),He?(st-=ye,Me=Z):Me==Z.parentNode&&st>=Ge(Z)&&st++,ye=0),te.setStartAndEnd(Z,ye,Me,st)}function Et(te){Bt(te);var I=te.commonAncestorContainer.parentNode.cloneNode(!1);return I.appendChild(te.cloneContents()),I.innerHTML}var zi=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Ti=0,Eo=1,lo=2,uo=3,$i=0,qi=1,vr=2,qo=3;xe.extend(q.rangePrototype,{compareBoundaryPoints:function(te,I){Bt(this),ht(this.startContainer,I.startContainer);var Z,ye,Me,st,He=te==uo||te==Ti?"start":"end",nt=te==Eo||te==Ti?"start":"end";return Z=this[He+"Container"],ye=this[He+"Offset"],Me=I[nt+"Container"],st=I[nt+"Offset"],he(Z,ye,Me,st)},insertNode:function(te){if(Bt(this),Qe(te,zt),ut(this.startContainer),Le(te,this.startContainer))throw new me("HIERARCHY_REQUEST_ERR");var I=Ke(te,this.startContainer,this.startOffset);this.setStartBefore(I)},cloneContents:function(){Bt(this);var te,I;if(this.collapsed)return je(this).createDocumentFragment();if(this.startContainer===this.endContainer&&pe(this.startContainer))return te=this.startContainer.cloneNode(!0),te.data=te.data.slice(this.startOffset,this.endOffset),I=je(this).createDocumentFragment(),I.appendChild(te),I;var Z=new Xe(this,!0);return te=ce(Z),Z.detach(),te},canSurroundContents:function(){Bt(this),ut(this.startContainer),ut(this.endContainer);var te=new Xe(this,!0),I=te._first&&Ie(te._first,this)||te._last&&Ie(te._last,this);return te.detach(),!I},surroundContents:function(te){if(Qe(te,gn),!this.canSurroundContents())throw new me("INVALID_STATE_ERR");var I=this.extractContents();if(te.hasChildNodes())for(;te.lastChild;)te.removeChild(te.lastChild);Ke(te,this.startContainer,this.startOffset),te.appendChild(I),this.selectNode(te)},cloneRange:function(){Bt(this);for(var te=new An(je(this)),I=zi.length,Z;I--;)Z=zi[I],te[Z]=this[Z];return te},toString:function(){Bt(this);var te=this.startContainer;if(te===this.endContainer&&pe(te))return te.nodeType==3||te.nodeType==4?te.data.slice(this.startOffset,this.endOffset):"";var I=[],Z=new Xe(this,!0);return ve(Z,function(ye){(ye.nodeType==3||ye.nodeType==4)&&I.push(ye.data)}),Z.detach(),I.join("")},compareNode:function(te){Bt(this);var I=te.parentNode,Z=Ge(te);if(!I)throw new me("NOT_FOUND_ERR");var ye=this.comparePoint(I,Z),Me=this.comparePoint(I,Z+1);return ye<0?Me>0?vr:$i:Me>0?qi:qo},comparePoint:function(te,I){return Bt(this),an(te,"HIERARCHY_REQUEST_ERR"),ht(te,this.startContainer),he(te,I,this.startContainer,this.startOffset)<0?-1:he(te,I,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:So,toHtml:function(){return Et(this)},intersectsNode:function(te,I){if(Bt(this),ae(te)!=Ue(this))return!1;var Z=te.parentNode,ye=Ge(te);if(!Z)return!0;var Me=he(Z,ye,this.endContainer,this.endOffset),st=he(Z,ye+1,this.startContainer,this.startOffset);return I?Me<=0&&st>=0:Me<0&&st>0},isPointInRange:function(te,I){return Bt(this),an(te,"HIERARCHY_REQUEST_ERR"),ht(te,this.startContainer),he(te,I,this.startContainer,this.startOffset)>=0&&he(te,I,this.endContainer,this.endOffset)<=0},intersectsRange:function(te){return dt(this,te,!1)},intersectsOrTouchesRange:function(te){return dt(this,te,!0)},intersection:function(te){if(this.intersectsRange(te)){var I=he(this.startContainer,this.startOffset,te.startContainer,te.startOffset),Z=he(this.endContainer,this.endOffset,te.endContainer,te.endOffset),ye=this.cloneRange();return I==-1&&ye.setStart(te.startContainer,te.startOffset),Z==1&&ye.setEnd(te.endContainer,te.endOffset),ye}return null},union:function(te){if(this.intersectsOrTouchesRange(te)){var I=this.cloneRange();return he(te.startContainer,te.startOffset,this.startContainer,this.startOffset)==-1&&I.setStart(te.startContainer,te.startOffset),he(te.endContainer,te.endOffset,this.endContainer,this.endOffset)==1&&I.setEnd(te.endContainer,te.endOffset),I}else throw new me("Ranges do not intersect")},containsNode:function(te,I){return I?this.intersectsNode(te,!1):this.compareNode(te)==qo},containsNodeContents:function(te){return this.comparePoint(te,0)>=0&&this.comparePoint(te,G(te))<=0},containsRange:function(te){var I=this.intersection(te);return I!==null&&te.equals(I)},containsNodeText:function(te){var I=this.cloneRange();I.selectNode(te);var Z=I.getNodes([3]);if(Z.length>0){I.setStart(Z[0],0);var ye=Z.pop();return I.setEnd(ye,ye.length),this.containsRange(I)}else return this.containsNodeContents(te)},getNodes:function(te,I){return Bt(this),Fe(this,te,I)},getDocument:function(){return je(this)},collapseBefore:function(te){this.setEndBefore(te),this.collapse(!1)},collapseAfter:function(te){this.setStartAfter(te),this.collapse(!0)},getBookmark:function(te){var I=je(this),Z=q.createRange(I);te=te||ue.getBody(I),Z.selectNodeContents(te);var ye=this.intersection(Z),Me=0,st=0;return ye&&(Z.setEnd(ye.startContainer,ye.startOffset),Me=Z.toString().length,st=Me+ye.toString().length),{start:Me,end:st,containerNode:te}},moveToBookmark:function(te){var I=te.containerNode,Z=0;this.setStart(I,0),this.collapse(!0);for(var ye=[I],Me,st=!1,He=!1,nt,vt,Nt;!He&&(Me=ye.pop());)if(Me.nodeType==3)nt=Z+Me.length,!st&&te.start>=Z&&te.start<=nt&&(this.setStart(Me,te.start-Z),st=!0),st&&te.end>=Z&&te.end<=nt&&(this.setEnd(Me,te.end-Z),He=!0),Z=nt;else for(Nt=Me.childNodes,vt=Nt.length;vt--;)ye.push(Nt[vt])},getName:function(){return"DomRange"},equals:function(te){return An.rangesEqual(this,te)},isValid:function(){return kn(this)},inspect:function(){return ze(this)},detach:function(){}});function ee(te){te.START_TO_START=Ti,te.START_TO_END=Eo,te.END_TO_END=lo,te.END_TO_START=uo,te.NODE_BEFORE=$i,te.NODE_AFTER=qi,te.NODE_BEFORE_AND_AFTER=vr,te.NODE_INSIDE=qo}function ke(te){ee(te),ee(te.prototype)}function Ye(te,I){return function(){Bt(this);var Z=this.startContainer,ye=this.startOffset,Me=this.commonAncestorContainer,st=new Xe(this,!0),He,nt;Z!==Me&&(He=De(Z,Me,!0),nt=it(He),Z=nt.node,ye=nt.offset),ve(st,ut),st.reset();var vt=te(st);return st.detach(),I(this,Z,ye,Z,ye),vt}}function pt(te,I){function Z(He,nt){return function(vt){Qe(vt,lt),Qe(ae(vt),wt);var Nt=(He?ot:it)(vt);(nt?ye:Me)(this,Nt.node,Nt.offset)}}function ye(He,nt,vt){var Nt=He.endContainer,Hn=He.endOffset;(nt!==He.startContainer||vt!==He.startOffset)&&((ae(nt)!=ae(Nt)||he(nt,vt,Nt,Hn)==1)&&(Nt=nt,Hn=vt),I(He,nt,vt,Nt,Hn))}function Me(He,nt,vt){var Nt=He.startContainer,Hn=He.startOffset;(nt!==He.endContainer||vt!==He.endOffset)&&((ae(nt)!=ae(Nt)||he(nt,vt,Nt,Hn)==-1)&&(Nt=nt,Hn=vt),I(He,Nt,Hn,nt,vt))}var st=function(){};st.prototype=q.rangePrototype,te.prototype=new st,xe.extend(te.prototype,{setStart:function(He,nt){Be(He,!0),qe(He,nt),ye(this,He,nt)},setEnd:function(He,nt){Be(He,!0),qe(He,nt),Me(this,He,nt)},setStartAndEnd:function(){var He=arguments,nt=He[0],vt=He[1],Nt=nt,Hn=vt;switch(He.length){case 3:Hn=He[2];break;case 4:Nt=He[2],Hn=He[3];break}Be(nt,!0),qe(nt,vt),Be(Nt,!0),qe(Nt,Hn),I(this,nt,vt,Nt,Hn)},setBoundary:function(He,nt,vt){this["set"+(vt?"Start":"End")](He,nt)},setStartBefore:Z(!0,!0),setStartAfter:Z(!1,!0),setEndBefore:Z(!0,!1),setEndAfter:Z(!1,!1),collapse:function(He){Bt(this),He?I(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):I(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(He){Be(He,!0),I(this,He,0,He,G(He))},selectNode:function(He){Be(He,!1),Qe(He,lt);var nt=ot(He),vt=it(He);I(this,nt.node,nt.offset,vt.node,vt.offset)},extractContents:Ye(Se,I),deleteContents:Ye(Ce,I),canSurroundContents:function(){Bt(this),ut(this.startContainer),ut(this.endContainer);var He=new Xe(this,!0),nt=He._first&&Ie(He._first,this)||He._last&&Ie(He._last,this);return He.detach(),!nt},splitBoundaries:function(){Mi(this)},splitBoundariesPreservingPositions:function(He){Mi(this,He)},normalizeBoundaries:function(){Bt(this);var He=this.startContainer,nt=this.startOffset,vt=this.endContainer,Nt=this.endOffset,Hn=function(co){var di=co.nextSibling;di&&di.nodeType==co.nodeType&&(vt=co,Nt=co.length,co.appendData(di.data),fe(di))},Rp=function(co){var di=co.previousSibling;if(di&&di.nodeType==co.nodeType){He=co;var Rm=co.length;if(nt=di.length,co.insertData(0,di.data),fe(di),He==vt)Nt+=nt,vt=He;else if(vt==co.parentNode){var Pp=Ge(co);Nt==Pp?(vt=co,Nt=Rm):Nt>Pp&&Nt--}}},td=!0,Ao;if(pe(vt))Nt==vt.length?Hn(vt):Nt==0&&(Ao=vt.previousSibling,Ao&&Ao.nodeType==vt.nodeType&&(Nt=Ao.length,He==vt&&(td=!1),Ao.appendData(vt.data),fe(vt),vt=Ao));else{if(Nt>0){var nd=vt.childNodes[Nt-1];nd&&pe(nd)&&Hn(nd)}td=!this.collapsed}if(td){if(pe(He))nt==0?Rp(He):nt==He.length&&(Ao=He.nextSibling,Ao&&Ao.nodeType==He.nodeType&&(vt==Ao&&(vt=He,Nt+=He.length),He.appendData(Ao.data),fe(Ao)));else if(nt<He.childNodes.length){var od=He.childNodes[nt];od&&pe(od)&&Rp(od)}}else He=vt,nt=Nt;I(this,He,nt,vt,Nt)},collapseToPoint:function(He,nt){Be(He,!0),qe(He,nt),this.setStartAndEnd(He,nt)},parentElement:function(){Bt(this);var He=this.commonAncestorContainer;return He?we(this.commonAncestorContainer,!0):null}}),ke(te)}function Ot(te){te.collapsed=te.startContainer===te.endContainer&&te.startOffset===te.endOffset,te.commonAncestorContainer=te.collapsed?te.startContainer:ue.getCommonAncestor(te.startContainer,te.endContainer)}function Qt(te,I,Z,ye,Me){te.startContainer=I,te.startOffset=Z,te.endContainer=ye,te.endOffset=Me,te.document=ue.getDocument(I),Ot(te)}function An(te){Qt(this,te,0,te,0)}pt(An,Qt),xe.extend(An,{rangeProperties:zi,RangeIterator:Xe,copyComparisonConstants:ke,createPrototypeRange:pt,inspect:ze,toHtml:Et,getRangeDocument:je,rangesEqual:function(te,I){return te.startContainer===I.startContainer&&te.startOffset===I.startOffset&&te.endContainer===I.endContainer&&te.endOffset===I.endOffset}}),q.DomRange=An}),S.createCoreModule("WrappedRange",["DomRange"],function(q,re){var ue,xe,Te=q.dom,me=q.util,pe=Te.DomPosition,Ge=q.DomRange,Le=Te.getBody,_e=Te.getContentDocument,he=Te.isCharacterDataNode;if(q.features.implementsDomRange&&(function(){var fe,Ie=Ge.rangeProperties;function je(Se){for(var Fe=Ie.length,ze;Fe--;)ze=Ie[Fe],Se[ze]=Se.nativeRange[ze];Se.collapsed=Se.startContainer===Se.endContainer&&Se.startOffset===Se.endOffset}function Ue(Se,Fe,ze,Xe,lt){var wt=Se.startContainer!==Fe||Se.startOffset!=ze,Yt=Se.endContainer!==Xe||Se.endOffset!=lt,zt=!Se.equals(Se.nativeRange);(wt||Yt||zt)&&(Se.setEnd(Xe,lt),Se.setStart(Fe,ze))}var ot;ue=function(Se){if(!Se)throw re.createError("WrappedRange: Range must be specified");this.nativeRange=Se,je(this)},Ge.createPrototypeRange(ue,Ue),fe=ue.prototype,fe.selectNode=function(Se){this.nativeRange.selectNode(Se),je(this)},fe.cloneContents=function(){return this.nativeRange.cloneContents()},fe.surroundContents=function(Se){this.nativeRange.surroundContents(Se),je(this)},fe.collapse=function(Se){this.nativeRange.collapse(Se),je(this)},fe.cloneRange=function(){return new ue(this.nativeRange.cloneRange())},fe.refresh=function(){je(this)},fe.toString=function(){return this.nativeRange.toString()};var it=document.createTextNode("test");Le(document).appendChild(it);var Ke=document.createRange();Ke.setStart(it,0),Ke.setEnd(it,0);try{Ke.setStart(it,1),fe.setStart=function(Se,Fe){this.nativeRange.setStart(Se,Fe),je(this)},fe.setEnd=function(Se,Fe){this.nativeRange.setEnd(Se,Fe),je(this)},ot=function(Se){return function(Fe){this.nativeRange[Se](Fe),je(this)}}}catch{fe.setStart=function(Fe,ze){try{this.nativeRange.setStart(Fe,ze)}catch{this.nativeRange.setEnd(Fe,ze),this.nativeRange.setStart(Fe,ze)}je(this)},fe.setEnd=function(Fe,ze){try{this.nativeRange.setEnd(Fe,ze)}catch{this.nativeRange.setStart(Fe,ze),this.nativeRange.setEnd(Fe,ze)}je(this)},ot=function(Fe,ze){return function(Xe){try{this.nativeRange[Fe](Xe)}catch{this.nativeRange[ze](Xe),this.nativeRange[Fe](Xe)}je(this)}}}fe.setStartBefore=ot("setStartBefore","setEndBefore"),fe.setStartAfter=ot("setStartAfter","setEndAfter"),fe.setEndBefore=ot("setEndBefore","setStartBefore"),fe.setEndAfter=ot("setEndAfter","setStartAfter"),fe.selectNodeContents=function(Se){this.setStartAndEnd(Se,0,Te.getNodeLength(Se))},Ke.selectNodeContents(it),Ke.setEnd(it,3);var dt=document.createRange();dt.selectNodeContents(it),dt.setEnd(it,4),dt.setStart(it,2),Ke.compareBoundaryPoints(Ke.START_TO_END,dt)==-1&&Ke.compareBoundaryPoints(Ke.END_TO_START,dt)==1?fe.compareBoundaryPoints=function(Se,Fe){return Fe=Fe.nativeRange||Fe,Se==Fe.START_TO_END?Se=Fe.END_TO_START:Se==Fe.END_TO_START&&(Se=Fe.START_TO_END),this.nativeRange.compareBoundaryPoints(Se,Fe)}:fe.compareBoundaryPoints=function(Se,Fe){return this.nativeRange.compareBoundaryPoints(Se,Fe.nativeRange||Fe)};var ce=document.createElement("div");ce.innerHTML="123";var ve=ce.firstChild,Ce=Le(document);Ce.appendChild(ce),Ke.setStart(ve,1),Ke.setEnd(ve,2),Ke.deleteContents(),ve.data=="13"&&(fe.deleteContents=function(){this.nativeRange.deleteContents(),je(this)},fe.extractContents=function(){var Se=this.nativeRange.extractContents();return je(this),Se}),Ce.removeChild(ce),Ce=null,me.isHostMethod(Ke,"createContextualFragment")&&(fe.createContextualFragment=function(Se){return this.nativeRange.createContextualFragment(Se)}),Le(document).removeChild(it),fe.getName=function(){return"WrappedRange"},q.WrappedRange=ue,q.createNativeRange=function(Se){return Se=_e(Se,re,"createNativeRange"),Se.createRange()}})(),q.features.implementsTextRange){var be=function(fe){var Ie=fe.parentElement(),je=fe.duplicate();je.collapse(!0);var Ue=je.parentElement();je=fe.duplicate(),je.collapse(!1);var ot=je.parentElement(),it=Ue==ot?Ue:Te.getCommonAncestor(Ue,ot);return it==Ie?it:Te.getCommonAncestor(Ie,it)},De=function(fe){return fe.compareEndPoints("StartToEnd",fe)==0},G=function(fe,Ie,je,Ue,ot){var it=fe.duplicate();it.collapse(je);var Ke=it.parentElement();if(Te.isOrIsAncestorOf(Ie,Ke)||(Ke=Ie),!Ke.canHaveHTML){var dt=new pe(Ke.parentNode,Te.getNodeIndex(Ke));return{boundaryPosition:dt,nodeInfo:{nodeIndex:dt.offset,containerElement:dt.node}}}var ce=Te.getDocument(Ke).createElement("span");ce.parentNode&&Te.removeNode(ce);for(var ve,Ce=je?"StartToStart":"StartToEnd",Se,Fe,ze,Xe,lt=ot&&ot.containerElement==Ke?ot.nodeIndex:0,wt=Ke.childNodes.length,Yt=wt,zt=Yt;zt==wt?Ke.appendChild(ce):Ke.insertBefore(ce,Ke.childNodes[zt]),it.moveToElementText(ce),ve=it.compareEndPoints(Ce,fe),!(ve==0||lt==Yt);){if(ve==-1){if(Yt==lt+1)break;lt=zt}else Yt=Yt==lt+1?lt:zt;zt=Math.floor((lt+Yt)/2),Ke.removeChild(ce)}if(Xe=ce.nextSibling,ve==-1&&Xe&&he(Xe)){it.setEndPoint(je?"EndToStart":"EndToEnd",fe);var gn;if(/[\r\n]/.test(Xe.data)){var yn=it.duplicate(),jt=yn.text.replace(/\r\n/g,"\r").length;for(gn=yn.moveStart("character",jt);(ve=yn.compareEndPoints("StartToEnd",yn))==-1;)gn++,yn.moveStart("character",1)}else gn=it.text.length;ze=new pe(Xe,gn)}else Se=(Ue||!je)&&ce.previousSibling,Fe=(Ue||je)&&ce.nextSibling,Fe&&he(Fe)?ze=new pe(Fe,0):Se&&he(Se)?ze=new pe(Se,Se.data.length):ze=new pe(Ke,Te.getNodeIndex(ce));return Te.removeNode(ce),{boundaryPosition:ze,nodeInfo:{nodeIndex:zt,containerElement:Ke}}},ie=function(fe,Ie){var je,Ue,ot=fe.offset,it=Te.getDocument(fe.node),Ke,dt,ce=Le(it).createTextRange(),ve=he(fe.node);return ve?(je=fe.node,Ue=je.parentNode):(dt=fe.node.childNodes,je=ot<dt.length?dt[ot]:null,Ue=fe.node),Ke=it.createElement("span"),Ke.innerHTML="&#feff;",je?Ue.insertBefore(Ke,je):Ue.appendChild(Ke),ce.moveToElementText(Ke),ce.collapse(!Ie),Ue.removeChild(Ke),ve&&ce[Ie?"moveStart":"moveEnd"]("character",ot),ce};xe=function(fe){this.textRange=fe,this.refresh()},xe.prototype=new Ge(document),xe.prototype.refresh=function(){var fe,Ie,je,Ue=be(this.textRange);De(this.textRange)?Ie=fe=G(this.textRange,Ue,!0,!0).boundaryPosition:(je=G(this.textRange,Ue,!0,!1),fe=je.boundaryPosition,Ie=G(this.textRange,Ue,!1,!1,je.nodeInfo).boundaryPosition),this.setStart(fe.node,fe.offset),this.setEnd(Ie.node,Ie.offset)},xe.prototype.getName=function(){return"WrappedTextRange"},Ge.copyComparisonConstants(xe);var ae=function(fe){if(fe.collapsed)return ie(new pe(fe.startContainer,fe.startOffset),!0);var Ie=ie(new pe(fe.startContainer,fe.startOffset),!0),je=ie(new pe(fe.endContainer,fe.endOffset),!1),Ue=Le(Ge.getRangeDocument(fe)).createTextRange();return Ue.setEndPoint("StartToStart",Ie),Ue.setEndPoint("EndToEnd",je),Ue};if(xe.rangeToTextRange=ae,xe.prototype.toTextRange=function(){return ae(this)},q.WrappedTextRange=xe,!q.features.implementsDomRange||q.config.preferTextRange){var Ae=(function(fe){return fe("return this;")()})(Function);typeof Ae.Range>"u"&&(Ae.Range=xe),q.createNativeRange=function(fe){return fe=_e(fe,re,"createNativeRange"),Le(fe).createTextRange()},q.WrappedRange=xe}}q.createRange=function(fe){return fe=_e(fe,re,"createRange"),new q.WrappedRange(q.createNativeRange(fe))},q.createRangyRange=function(fe){return fe=_e(fe,re,"createRangyRange"),new Ge(fe)},me.createAliasForDeprecatedMethod(q,"createIframeRange","createRange"),me.createAliasForDeprecatedMethod(q,"createIframeRangyRange","createRangyRange"),q.addShimListener(function(fe){var Ie=fe.document;typeof Ie.createRange>"u"&&(Ie.createRange=function(){return q.createRange(Ie)}),Ie=fe=null})}),S.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(q,re){q.config.checkSelectionRanges=!0;var ue="boolean",xe="number",Te=q.dom,me=q.util,pe=me.isHostMethod,Ge=q.DomRange,Le=q.WrappedRange,_e=q.DOMException,he=Te.DomPosition,be,De,G=q.features,ie="Control",ae=Te.getDocument,Ae=Te.getBody,fe=Ge.rangesEqual;function Ie(ee){return typeof ee=="string"?/^backward(s)?$/i.test(ee):!!ee}function je(ee,ke){if(ee){if(Te.isWindow(ee))return ee;if(ee instanceof Bt)return ee.win;var Ye=Te.getContentDocument(ee,re,ke);return Te.getWindow(Ye)}else return window}function Ue(ee){return je(ee,"getWinSelection").getSelection()}function ot(ee){return je(ee,"getDocSelection").document.selection}function it(ee){var ke=!1;return ee.anchorNode&&(ke=Te.comparePoints(ee.anchorNode,ee.anchorOffset,ee.focusNode,ee.focusOffset)==1),ke}var Ke=pe(window,"getSelection"),dt=me.isHostObject(document,"selection");G.implementsWinGetSelection=Ke,G.implementsDocSelection=dt;var ce=dt&&(!Ke||q.config.preferTextRange);if(ce)be=ot,q.isSelectionValid=function(ee){var ke=je(ee,"isSelectionValid").document,Ye=ke.selection;return Ye.type!="None"||ae(Ye.createRange().parentElement())==ke};else if(Ke)be=Ue,q.isSelectionValid=function(){return!0};else return re.fail("Neither document.selection or window.getSelection() detected."),!1;q.getNativeSelection=be;var ve=be();if(!ve)return re.fail("Native selection was null (possibly issue 138?)"),!1;var Ce=q.createNativeRange(document),Se=Ae(document),Fe=me.areHostProperties(ve,["anchorNode","focusNode","anchorOffset","focusOffset"]);G.selectionHasAnchorAndFocus=Fe;var ze=pe(ve,"extend");G.selectionHasExtend=ze;var Xe=pe(ve,"setBaseAndExtent");G.selectionHasSetBaseAndExtent=Xe;var lt=typeof ve.rangeCount==xe;G.selectionHasRangeCount=lt;var wt=!1,Yt=!0,zt=ze?function(ee,ke){var Ye=Ge.getRangeDocument(ke),pt=q.createRange(Ye);pt.collapseToPoint(ke.endContainer,ke.endOffset),ee.addRange(Be(pt)),ee.extend(ke.startContainer,ke.startOffset)}:null;me.areHostMethods(ve,["addRange","getRangeAt","removeAllRanges"])&&typeof ve.rangeCount==xe&&G.implementsDomRange&&(function(){var ee=window.getSelection();if(ee){for(var ke=ee.rangeCount,Ye=ke>1,pt=[],Ot=it(ee),Qt=0;Qt<ke;++Qt)pt[Qt]=ee.getRangeAt(Qt);var An=Te.createTestElement(document,"",!1),te=An.appendChild(document.createTextNode("   ")),I=document.createRange();if(I.setStart(te,1),I.collapse(!0),ee.removeAllRanges(),ee.addRange(I),Yt=ee.rangeCount==1,ee.removeAllRanges(),!Ye){var Z=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(Z&&parseInt(Z[1])>=36)wt=!1;else{var ye=I.cloneRange();I.setStart(te,0),ye.setEnd(te,3),ye.setStart(te,2),ee.addRange(I),ee.addRange(ye),wt=ee.rangeCount==2}}for(Te.removeNode(An),ee.removeAllRanges(),Qt=0;Qt<ke;++Qt)Qt==0&&Ot?zt?zt(ee,pt[Qt]):(q.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),ee.addRange(pt[Qt])):ee.addRange(pt[Qt])}})(),G.selectionSupportsMultipleRanges=wt,G.collapsedNonEditableSelectionsSupported=Yt;var gn=!1,yn;Se&&pe(Se,"createControlRange")&&(yn=Se.createControlRange(),me.areHostProperties(yn,["item","add"])&&(gn=!0)),G.implementsControlRange=gn,Fe?De=function(ee){return ee.anchorNode===ee.focusNode&&ee.anchorOffset===ee.focusOffset}:De=function(ee){return ee.rangeCount?ee.getRangeAt(ee.rangeCount-1).collapsed:!1};function jt(ee,ke,Ye){var pt=Ye?"end":"start",Ot=Ye?"start":"end";ee.anchorNode=ke[pt+"Container"],ee.anchorOffset=ke[pt+"Offset"],ee.focusNode=ke[Ot+"Container"],ee.focusOffset=ke[Ot+"Offset"]}function Ee(ee){var ke=ee.nativeSelection;ee.anchorNode=ke.anchorNode,ee.anchorOffset=ke.anchorOffset,ee.focusNode=ke.focusNode,ee.focusOffset=ke.focusOffset}function Ze(ee){ee.anchorNode=ee.focusNode=null,ee.anchorOffset=ee.focusOffset=0,ee.rangeCount=0,ee.isCollapsed=!0,ee._ranges.length=0,we(ee)}function we(ee){ee.type=ee.rangeCount==0?"None":De(ee)?"Caret":"Range"}function Be(ee){var ke;return ee instanceof Ge?(ke=q.createNativeRange(ee.getDocument()),ke.setEnd(ee.endContainer,ee.endOffset),ke.setStart(ee.startContainer,ee.startOffset)):ee instanceof Le?ke=ee.nativeRange:G.implementsDomRange&&ee instanceof Te.getWindow(ee.startContainer).Range&&(ke=ee),ke}function Qe(ee){if(!ee.length||ee[0].nodeType!=1)return!1;for(var ke=1,Ye=ee.length;ke<Ye;++ke)if(!Te.isAncestorOf(ee[0],ee[ke]))return!1;return!0}function qe(ee){var ke=ee.getNodes();if(!Qe(ke))throw re.createError("getSingleElementFromRange: range "+ee.inspect()+" did not consist of a single element");return ke[0]}function ht(ee){return!!ee&&typeof ee.text<"u"}function ut(ee,ke){var Ye=new Le(ke);ee._ranges=[Ye],jt(ee,Ye,!1),ee.rangeCount=1,ee.isCollapsed=Ye.collapsed,we(ee)}function an(ee){if(ee._ranges.length=0,ee.docSelection.type=="None")Ze(ee);else{var ke=ee.docSelection.createRange();if(ht(ke))ut(ee,ke);else{ee.rangeCount=ke.length;for(var Ye,pt=ae(ke.item(0)),Ot=0;Ot<ee.rangeCount;++Ot)Ye=q.createRange(pt),Ye.selectNode(ke.item(Ot)),ee._ranges.push(Ye);ee.isCollapsed=ee.rangeCount==1&&ee._ranges[0].collapsed,jt(ee,ee._ranges[ee.rangeCount-1],!1),we(ee)}}}function un(ee,ke){for(var Ye=ee.docSelection.createRange(),pt=qe(ke),Ot=ae(Ye.item(0)),Qt=Ae(Ot).createControlRange(),An=0,te=Ye.length;An<te;++An)Qt.add(Ye.item(An));try{Qt.add(pt)}catch{throw re.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}Qt.select(),an(ee)}var kn;pe(ve,"getRangeAt")?kn=function(ee,ke){try{return ee.getRangeAt(ke)}catch{return null}}:Fe&&(kn=function(ee){var ke=ae(ee.anchorNode),Ye=q.createRange(ke);return Ye.setStartAndEnd(ee.anchorNode,ee.anchorOffset,ee.focusNode,ee.focusOffset),Ye.collapsed!==this.isCollapsed&&Ye.setStartAndEnd(ee.focusNode,ee.focusOffset,ee.anchorNode,ee.anchorOffset),Ye});function Bt(ee,ke,Ye){this.nativeSelection=ee,this.docSelection=ke,this._ranges=[],this.win=Ye,this.refresh()}Bt.prototype=q.selectionPrototype;function Rn(ee){ee.win=ee.anchorNode=ee.focusNode=ee._ranges=null,ee.rangeCount=ee.anchorOffset=ee.focusOffset=0,ee.detached=!0,we(ee)}var Tn=[];function So(ee,ke){for(var Ye=Tn.length,pt,Ot;Ye--;)if(pt=Tn[Ye],Ot=pt.selection,ke=="deleteAll")Rn(Ot);else if(pt.win==ee)return ke=="delete"?(Tn.splice(Ye,1),!0):Ot;return ke=="deleteAll"&&(Tn.length=0),null}var Mi=function(ee){if(ee&&ee instanceof Bt)return ee.refresh(),ee;ee=je(ee,"getNativeSelection");var ke=So(ee),Ye=be(ee),pt=dt?ot(ee):null;return ke?(ke.nativeSelection=Ye,ke.docSelection=pt,ke.refresh()):(ke=new Bt(Ye,pt,ee),Tn.push({win:ee,selection:ke})),ke};q.getSelection=Mi,me.createAliasForDeprecatedMethod(q,"getIframeSelection","getSelection");var Et=Bt.prototype;function zi(ee,ke){for(var Ye=ae(ke[0].startContainer),pt=Ae(Ye).createControlRange(),Ot=0,Qt,An=ke.length;Ot<An;++Ot){Qt=qe(ke[Ot]);try{pt.add(Qt)}catch{throw re.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}pt.select(),an(ee)}if(!ce&&Fe&&me.areHostMethods(ve,["removeAllRanges","addRange"])){Et.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),Ze(this)};var Ti=function(ee,ke){zt(ee.nativeSelection,ke),ee.refresh()};lt?Et.addRange=function(ee,ke){if(gn&&dt&&this.docSelection.type==ie)un(this,ee);else if(Ie(ke)&&ze)Ti(this,ee);else{var Ye;wt?Ye=this.rangeCount:(this.removeAllRanges(),Ye=0);var pt=Be(ee).cloneRange();try{this.nativeSelection.addRange(pt)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==Ye+1){if(q.config.checkSelectionRanges){var Ot=kn(this.nativeSelection,this.rangeCount-1);Ot&&!fe(Ot,ee)&&(ee=new Le(Ot))}this._ranges[this.rangeCount-1]=ee,jt(this,ee,uo(this.nativeSelection)),this.isCollapsed=De(this),we(this)}else this.refresh()}}:Et.addRange=function(ee,ke){Ie(ke)&&ze?Ti(this,ee):(this.nativeSelection.addRange(Be(ee)),this.refresh())},Et.setRanges=function(ee){if(gn&&dt&&ee.length>1)zi(this,ee);else{this.removeAllRanges();for(var ke=0,Ye=ee.length;ke<Ye;++ke)this.addRange(ee[ke])}}}else if(pe(ve,"empty")&&pe(Ce,"select")&&gn&&ce)Et.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var ee;if(this.anchorNode)ee=ae(this.anchorNode);else if(this.docSelection.type==ie){var ke=this.docSelection.createRange();ke.length&&(ee=ae(ke.item(0)))}if(ee){var Ye=Ae(ee).createTextRange();Ye.select(),this.docSelection.empty()}}}catch{}Ze(this)},Et.addRange=function(ee){this.docSelection.type==ie?un(this,ee):(q.WrappedTextRange.rangeToTextRange(ee).select(),this._ranges[0]=ee,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,jt(this,ee,!1),we(this))},Et.setRanges=function(ee){this.removeAllRanges();var ke=ee.length;ke>1?zi(this,ee):ke&&this.addRange(ee[0])};else return re.fail("No means of selecting a Range or TextRange was found"),!1;Et.getRangeAt=function(ee){if(ee<0||ee>=this.rangeCount)throw new _e("INDEX_SIZE_ERR");return this._ranges[ee].cloneRange()};var Eo;if(ce)Eo=function(ee){var ke;q.isSelectionValid(ee.win)?ke=ee.docSelection.createRange():(ke=Ae(ee.win.document).createTextRange(),ke.collapse(!0)),ee.docSelection.type==ie?an(ee):ht(ke)?ut(ee,ke):Ze(ee)};else if(pe(ve,"getRangeAt")&&typeof ve.rangeCount==xe)Eo=function(ee){if(gn&&dt&&ee.docSelection.type==ie)an(ee);else if(ee._ranges.length=ee.rangeCount=ee.nativeSelection.rangeCount,ee.rangeCount){for(var ke=0,Ye=ee.rangeCount;ke<Ye;++ke)ee._ranges[ke]=new q.WrappedRange(ee.nativeSelection.getRangeAt(ke));jt(ee,ee._ranges[ee.rangeCount-1],uo(ee.nativeSelection)),ee.isCollapsed=De(ee),we(ee)}else Ze(ee)};else if(Fe&&typeof ve.isCollapsed==ue&&typeof Ce.collapsed==ue&&G.implementsDomRange)Eo=function(ee){var ke,Ye=ee.nativeSelection;Ye.anchorNode?(ke=kn(Ye,0),ee._ranges=[ke],ee.rangeCount=1,Ee(ee),ee.isCollapsed=De(ee),we(ee)):Ze(ee)};else return re.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Et.refresh=function(ee){var ke=ee?this._ranges.slice(0):null,Ye=this.anchorNode,pt=this.anchorOffset;if(Eo(this),ee){var Ot=ke.length;if(Ot!=this._ranges.length||this.anchorNode!=Ye||this.anchorOffset!=pt)return!0;for(;Ot--;)if(!fe(ke[Ot],this._ranges[Ot]))return!0;return!1}};var lo=function(ee,ke){var Ye=ee.getAllRanges();ee.removeAllRanges();for(var pt=0,Ot=Ye.length;pt<Ot;++pt)fe(ke,Ye[pt])||ee.addRange(Ye[pt]);ee.rangeCount||Ze(ee)};gn&&dt?Et.removeRange=function(ee){if(this.docSelection.type==ie){for(var ke=this.docSelection.createRange(),Ye=qe(ee),pt=ae(ke.item(0)),Ot=Ae(pt).createControlRange(),Qt,An=!1,te=0,I=ke.length;te<I;++te)Qt=ke.item(te),Qt!==Ye||An?Ot.add(ke.item(te)):An=!0;Ot.select(),an(this)}else lo(this,ee)}:Et.removeRange=function(ee){lo(this,ee)};var uo;!ce&&Fe&&G.implementsDomRange?(uo=it,Et.isBackward=function(){return uo(this)}):uo=Et.isBackward=function(){return!1},Et.isBackwards=Et.isBackward,Et.toString=function(){for(var ee=[],ke=0,Ye=this.rangeCount;ke<Ye;++ke)ee[ke]=""+this._ranges[ke];return ee.join("")};function $i(ee,ke){if(ee.win.document!=ae(ke))throw new _e("WRONG_DOCUMENT_ERR")}function qi(ee,ke){if(ke<0||ke>(Te.isCharacterDataNode(ee)?ee.length:ee.childNodes.length))throw new _e("INDEX_SIZE_ERR")}Et.collapse=function(ee,ke){$i(this,ee);var Ye=q.createRange(ee);Ye.collapseToPoint(ee,ke),this.setSingleRange(Ye),this.isCollapsed=!0},Et.collapseToStart=function(){if(this.rangeCount){var ee=this._ranges[0];this.collapse(ee.startContainer,ee.startOffset)}else throw new _e("INVALID_STATE_ERR")},Et.collapseToEnd=function(){if(this.rangeCount){var ee=this._ranges[this.rangeCount-1];this.collapse(ee.endContainer,ee.endOffset)}else throw new _e("INVALID_STATE_ERR")},Et.selectAllChildren=function(ee){$i(this,ee);var ke=q.createRange(ee);ke.selectNodeContents(ee),this.setSingleRange(ke)},Xe?Et.setBaseAndExtent=function(ee,ke,Ye,pt){this.nativeSelection.setBaseAndExtent(ee,ke,Ye,pt),this.refresh()}:ze&&(Et.setBaseAndExtent=function(ee,ke,Ye,pt){qi(ee,ke),qi(Ye,pt),$i(this,ee),$i(this,Ye);var Ot=q.createRange(node),Qt=Te.comparePoints(ee,ke,Ye,pt)==-1;Qt?Ot.setStartAndEnd(Ye,pt,ee,ke):Ot.setStartAndEnd(ee,ke,Ye,pt),this.setSingleRange(Ot,Qt)}),Et.deleteFromDocument=function(){if(gn&&dt&&this.docSelection.type==ie){for(var ee=this.docSelection.createRange(),ke;ee.length;)ke=ee.item(0),ee.remove(ke),Te.removeNode(ke);this.refresh()}else if(this.rangeCount){var Ye=this.getAllRanges();if(Ye.length){this.removeAllRanges();for(var pt=0,Ot=Ye.length;pt<Ot;++pt)Ye[pt].deleteContents();this.addRange(Ye[Ot-1])}}},Et.eachRange=function(ee,ke){for(var Ye=0,pt=this._ranges.length;Ye<pt;++Ye)if(ee(this.getRangeAt(Ye)))return ke},Et.getAllRanges=function(){var ee=[];return this.eachRange(function(ke){ee.push(ke)}),ee},Et.setSingleRange=function(ee,ke){this.removeAllRanges(),this.addRange(ee,ke)},Et.callMethodOnEachRange=function(ee,ke){var Ye=[];return this.eachRange(function(pt){Ye.push(pt[ee].apply(pt,ke||[]))}),Ye};function vr(ee){return function(ke,Ye){var pt;this.rangeCount?(pt=this.getRangeAt(0),pt["set"+(ee?"Start":"End")](ke,Ye)):(pt=q.createRange(this.win.document),pt.setStartAndEnd(ke,Ye)),this.setSingleRange(pt,this.isBackward())}}Et.setStart=vr(!0),Et.setEnd=vr(!1),q.rangePrototype.select=function(ee){Mi(this.getDocument()).setSingleRange(this,ee)},Et.changeEachRange=function(ee){var ke=[],Ye=this.isBackward();this.eachRange(function(pt){ee(pt),ke.push(pt)}),this.removeAllRanges(),Ye&&ke.length==1?this.addRange(ke[0],"backward"):this.setRanges(ke)},Et.containsNode=function(ee,ke){return this.eachRange(function(Ye){return Ye.containsNode(ee,ke)},!0)||!1},Et.getBookmark=function(ee){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[ee])}},Et.moveToBookmark=function(ee){for(var ke=[],Ye=0,pt,Ot;pt=ee.rangeBookmarks[Ye++];)Ot=q.createRange(this.win),Ot.moveToBookmark(pt),ke.push(Ot);ee.backward?this.setSingleRange(ke[0],"backward"):this.setRanges(ke)},Et.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Et.restoreRanges=function(ee){this.removeAllRanges();for(var ke=0,Ye;Ye=ee.ranges[ke];++ke)this.addRange(Ye,ee.backward&&ke==0)},Et.toHtml=function(){var ee=[];return this.eachRange(function(ke){ee.push(Ge.toHtml(ke))}),ee.join("")},G.implementsTextRange&&(Et.getNativeTextRange=function(){var ee;if(ee=this.docSelection){var ke=ee.createRange();if(ht(ke))return ke;throw re.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return q.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw re.createError("getNativeTextRange: selection contains no range")}});function qo(ee){var ke=[],Ye=new he(ee.anchorNode,ee.anchorOffset),pt=new he(ee.focusNode,ee.focusOffset),Ot=typeof ee.getName=="function"?ee.getName():"Selection";if(typeof ee.rangeCount<"u")for(var Qt=0,An=ee.rangeCount;Qt<An;++Qt)ke[Qt]=Ge.inspect(ee.getRangeAt(Qt));return"["+Ot+"(Ranges: "+ke.join(", ")+")(anchor: "+Ye.inspect()+", focus: "+pt.inspect()+"]"}Et.getName=function(){return"WrappedSelection"},Et.inspect=function(){return qo(this)},Et.detach=function(){So(this.win,"delete"),Rn(this)},Bt.detachAll=function(){So(null,"deleteAll")},Bt.inspect=qo,Bt.isDirectionBackward=Ie,q.Selection=Bt,q.selectionPrototype=Et,q.addShimListener(function(ee){typeof ee.getSelection>"u"&&(ee.getSelection=function(){return Mi(ee)}),ee=null})});var oe=!1,W=function(q){oe||(oe=!0,!S.initialized&&S.config.autoInitialize&&N())};return T&&(document.readyState=="complete"?W():(d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",W,!1),P(window,"load",W))),S})})(Rd)),Rd.exports}var ite=bm();const Nv=Ga(ite);var Pd={exports:{}},Mv;function rte(){return Mv||(Mv=1,(function(n,e){(function(t,o){n.exports=t(bm())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(o,i){var r=o.dom,s=r.DomPosition,a=r.arrayContains,l=o.util,d=l.forEach,c="span",p=l.isHostMethod(document,"createElementNS");function f(G,ie){for(var ae in G)if(G.hasOwnProperty(ae)&&ie(ae,G[ae])===!1)return!1;return!0}function h(G){return G.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function v(G,ie){return!!G&&new RegExp("(?:^|\\s)"+ie+"(?:\\s|$)").test(G)}function y(G,ie){if(typeof G.classList=="object")return G.classList.contains(ie);var ae=typeof G.className=="string",Ae=ae?G.className:G.getAttribute("class");return v(Ae,ie)}function g(G,ie){if(typeof G.classList=="object")G.classList.add(ie);else{var ae=typeof G.className=="string",Ae=ae?G.className:G.getAttribute("class");Ae?v(Ae,ie)||(Ae+=" "+ie):Ae=ie,ae?G.className=Ae:G.setAttribute("class",Ae)}}var _=(function(){function G(ie,ae,Ae){return ae&&Ae?" ":""}return function(ie,ae){if(typeof ie.classList=="object")ie.classList.remove(ae);else{var Ae=typeof ie.className=="string",fe=Ae?ie.className:ie.getAttribute("class");fe=fe.replace(new RegExp("(^|\\s)"+ae+"(\\s|$)"),G),Ae?ie.className=fe:ie.setAttribute("class",fe)}}})();function b(G){var ie=typeof G.className=="string";return ie?G.className:G.getAttribute("class")}function C(G){return G&&G.split(/\s+/).sort().join(" ")}function T(G){return C(b(G))}function M(G,ie){return T(G)==T(ie)}function S(G,ie){for(var ae=ie.split(/\s+/),Ae=0,fe=ae.length;Ae<fe;++Ae)if(!y(G,h(ae[Ae])))return!1;return!0}function k(G){var ie=G.parentNode;return ie&&ie.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(ie.nodeName)}function A(G,ie,ae,Ae,fe){var Ie=G.node,je=G.offset,Ue=Ie,ot=je;Ie==Ae&&je>fe&&++ot,Ie==ie&&(je==ae||je==ae+1)&&(Ue=Ae,ot+=fe-ae),Ie==ie&&je>ae+1&&--ot,G.node=Ue,G.offset=ot}function $(G,ie,ae){G.node==ie&&G.offset>ae&&--G.offset}function B(G,ie,ae,Ae){ae==-1&&(ae=ie.childNodes.length);var fe=G.parentNode,Ie=r.getNodeIndex(G);d(Ae,function(je){A(je,fe,Ie,ie,ae)}),ie.childNodes.length==ae?ie.appendChild(G):ie.insertBefore(G,ie.childNodes[ae])}function O(G,ie){var ae=G.parentNode,Ae=r.getNodeIndex(G);d(ie,function(fe){$(fe,ae,Ae)}),r.removeNode(G)}function P(G,ie,ae,Ae,fe){for(var Ie,je=[];Ie=G.firstChild;)B(Ie,ie,ae++,fe),je.push(Ie);return O(G,fe),je}function E(G,ie){return P(G,G.parentNode,r.getNodeIndex(G),!0,ie)}function D(G,ie){var ae=G.cloneRange();ae.selectNodeContents(ie);var Ae=ae.intersection(G),fe=Ae?Ae.toString():"";return fe!=""}function N(G){for(var ie=G.getNodes([3]),ae=0,Ae;(Ae=ie[ae])&&!D(G,Ae);)++ae;for(var fe=ie.length-1;(Ae=ie[fe])&&!D(G,Ae);)--fe;return ie.slice(ae,fe+1)}function F(G,ie){if(G.attributes.length!=ie.attributes.length)return!1;for(var ae=0,Ae=G.attributes.length,fe,Ie,je;ae<Ae;++ae)if(fe=G.attributes[ae],je=fe.name,je!="class"&&(Ie=ie.attributes.getNamedItem(je),fe===null!=(Ie===null)||fe.specified!=Ie.specified||fe.specified&&fe.nodeValue!==Ie.nodeValue))return!1;return!0}function Y(G,ie){for(var ae=0,Ae=G.attributes.length,fe;ae<Ae;++ae)if(fe=G.attributes[ae].name,!(ie&&a(ie,fe))&&G.attributes[ae].specified&&fe!="class")return!0;return!1}var L=r.getComputedStyleProperty,j=(function(){var G=document.createElement("div");return typeof G.isContentEditable=="boolean"?function(ie){return ie&&ie.nodeType==1&&ie.isContentEditable}:function(ie){return!ie||ie.nodeType!=1||ie.contentEditable=="false"?!1:ie.contentEditable=="true"||j(ie.parentNode)}})();function le(G){var ie;return G&&G.nodeType==1&&((ie=G.parentNode)&&ie.nodeType==9&&ie.designMode=="on"||j(G)&&!j(G.parentNode))}function z(G){return(j(G)||G.nodeType!=1&&j(G.parentNode))&&!le(G)}var V=/^inline(-block|-table)?$/i;function J(G){return G&&G.nodeType==1&&!V.test(L(G,"display"))}var oe=/[^\r\n\t\f \u200B]/;function W(G){if(G.data.length==0)return!0;if(oe.test(G.data))return!1;var ie=L(G.parentNode,"whiteSpace");switch(ie){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(G.data))return!1}return J(G.previousSibling)||J(G.nextSibling)}function q(G){var ie=[],ae,Ae;for(ae=0;Ae=G[ae++];)ie.push(new s(Ae.startContainer,Ae.startOffset),new s(Ae.endContainer,Ae.endOffset));return ie}function re(G,ie){for(var ae=0,Ae,fe,Ie,je=G.length;ae<je;++ae)Ae=G[ae],fe=ie[ae*2],Ie=ie[ae*2+1],Ae.setStartAndEnd(fe.node,fe.offset,Ie.node,Ie.offset)}function ue(G,ie){return r.isCharacterDataNode(G)?ie==0?!!G.previousSibling:ie==G.length?!!G.nextSibling:!0:ie>0&&ie<G.childNodes.length}function xe(G,ie,ae,Ae){var fe,Ie,je=ae==0;if(r.isAncestorOf(ie,G))return G;if(r.isCharacterDataNode(ie)){var Ue=r.getNodeIndex(ie);if(ae==0)ae=Ue;else if(ae==ie.length)ae=Ue+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+ae+" in "+ie.data);ie=ie.parentNode}if(ue(ie,ae)){fe=ie.cloneNode(!1),Ie=ie.parentNode,fe.id&&fe.removeAttribute("id");for(var ot,it=0;ot=ie.childNodes[ae];)B(ot,fe,it++,Ae);return B(fe,Ie,r.getNodeIndex(ie)+1,Ae),ie==G?fe:xe(G,Ie,r.getNodeIndex(fe),Ae)}else if(G!=ie){fe=ie.parentNode;var Ke=r.getNodeIndex(ie);return je||Ke++,xe(G,fe,Ke,Ae)}return G}function Te(G,ie){return G.namespaceURI==ie.namespaceURI&&G.tagName.toLowerCase()==ie.tagName.toLowerCase()&&M(G,ie)&&F(G,ie)&&L(G,"display")=="inline"&&L(ie,"display")=="inline"}function me(G){var ie=G?"nextSibling":"previousSibling";return function(ae,Ae){var fe=ae.parentNode,Ie=ae[ie];if(Ie){if(Ie&&Ie.nodeType==3)return Ie}else if(Ae&&(Ie=fe[ie],Ie&&Ie.nodeType==1&&Te(fe,Ie))){var je=Ie[G?"firstChild":"lastChild"];if(je&&je.nodeType==3)return je}return null}}var pe=me(!1),Ge=me(!0);function Le(G){this.isElementMerge=G.nodeType==1,this.textNodes=[];var ie=this.isElementMerge?G.lastChild:G;ie&&(this.textNodes[0]=ie)}Le.prototype={doMerge:function(G){var ie=this.textNodes,ae=ie[0];if(ie.length>1){var Ae=r.getNodeIndex(ae),fe=[],Ie=0,je;d(ie,function(Ue,ot){je=Ue.parentNode,ot>0&&(je.removeChild(Ue),je.hasChildNodes()||r.removeNode(je),G&&d(G,function(it){it.node==Ue&&(it.node=ae,it.offset+=Ie),it.node==je&&it.offset>Ae&&(--it.offset,it.offset==Ae+1&&ot<ie.length-1&&(it.node=ae,it.offset=Ie))})),fe[ot]=Ue.data,Ie+=Ue.data.length}),ae.data=fe.join("")}return ae.data},getLength:function(){for(var G=this.textNodes.length,ie=0;G--;)ie+=this.textNodes[G].length;return ie},toString:function(){var G=[];return d(this.textNodes,function(ie,ae){G[ae]="'"+ie.data+"'"}),"[Merge("+G.join(",")+")]"}};var _e=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],he={};function be(G,ie,ae){var Ae,fe,Ie,je,Ue=this;Ue.cssClass=Ue.className=G;var ot=null,it={};if(typeof ie=="object"&&ie!==null){for(typeof ie.elementTagName<"u"&&(ie.elementTagName=ie.elementTagName.toLowerCase()),ae=ie.tagNames,ot=ie.elementProperties,it=ie.elementAttributes,fe=0;je=_e[fe++];)ie.hasOwnProperty(je)&&(Ue[je]=ie[je]);Ae=ie.normalize}else Ae=ie;Ue.normalize=typeof Ae>"u"?!0:Ae,Ue.attrExceptions=[];var Ke=document.createElement(Ue.elementTagName);Ue.elementProperties=Ue.copyPropertiesToElement(ot,Ke,!0),f(it,function(ce,ve){Ue.attrExceptions.push(ce),it[ce]=""+ve}),Ue.elementAttributes=it,Ue.elementSortedClassName=Ue.elementProperties.hasOwnProperty("className")?C(Ue.elementProperties.className+" "+G):G,Ue.applyToAnyTagName=!1;var dt=typeof ae;if(dt=="string")ae=="*"?Ue.applyToAnyTagName=!0:Ue.tagNames=h(ae.toLowerCase()).split(/\s*,\s*/);else if(dt=="object"&&typeof ae.length=="number")for(Ue.tagNames=[],fe=0,Ie=ae.length;fe<Ie;++fe)ae[fe]=="*"?Ue.applyToAnyTagName=!0:Ue.tagNames.push(ae[fe].toLowerCase());else Ue.tagNames=[Ue.elementTagName]}be.prototype={elementTagName:c,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(G,ie,ae){var Ae,fe,Ie={},je,Ue,ot,it;for(var Ke in G)if(G.hasOwnProperty(Ke))if(Ue=G[Ke],ot=ie[Ke],Ke=="className")g(ie,Ue),g(ie,this.className),ie[Ke]=C(ie[Ke]),ae&&(Ie[Ke]=Ue);else if(Ke=="style"){fe=ot,ae&&(Ie[Ke]=je={});for(Ae in G[Ke])G[Ke].hasOwnProperty(Ae)&&(fe[Ae]=Ue[Ae],ae&&(je[Ae]=fe[Ae]));this.attrExceptions.push(Ke)}else ie[Ke]=Ue,ae&&(Ie[Ke]=ie[Ke],it=he.hasOwnProperty(Ke)?he[Ke]:Ke,this.attrExceptions.push(it));return ae?Ie:""},copyAttributesToElement:function(G,ie){for(var ae in G)G.hasOwnProperty(ae)&&!/^class(?:Name)?$/i.test(ae)&&ie.setAttribute(ae,G[ae])},appliesToElement:function(G){return a(this.tagNames,G.tagName.toLowerCase())},getEmptyElements:function(G){var ie=this;return G.getNodes([1],function(ae){return ie.appliesToElement(ae)&&!ae.hasChildNodes()})},hasClass:function(G){return G.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(G))&&y(G,this.className)},getSelfOrAncestorWithClass:function(G){for(;G;){if(this.hasClass(G))return G;G=G.parentNode}return null},isModifiable:function(G){return!this.applyToEditableOnly||z(G)},isIgnorableWhiteSpaceNode:function(G){return this.ignoreWhiteSpace&&G&&G.nodeType==3&&W(G)},postApply:function(G,ie,ae,Ae){var fe=G[0],Ie=G[G.length-1],je=[],Ue,ot=fe,it=Ie,Ke=0,dt=Ie.length,ce;d(G,function(Fe){ce=pe(Fe,!Ae),ce?(Ue||(Ue=new Le(ce),je.push(Ue)),Ue.textNodes.push(Fe),Fe===fe&&(ot=Ue.textNodes[0],Ke=ot.length),Fe===Ie&&(it=Ue.textNodes[0],dt=Ue.getLength())):Ue=null});var ve=Ge(Ie,!Ae);if(ve&&(Ue||(Ue=new Le(Ie),je.push(Ue)),Ue.textNodes.push(ve)),je.length){for(var Ce=0,Se=je.length;Ce<Se;++Ce)je[Ce].doMerge(ae);ie.setStartAndEnd(ot,Ke,it,dt)}},createContainer:function(G){var ie=r.getDocument(G),ae=p&&!r.isHtmlNamespace(G)&&G.namespaceURI?ie.createElementNS(G.namespaceURI,this.elementTagName):ie.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,ae,!1),this.copyAttributesToElement(this.elementAttributes,ae),g(ae,this.className),this.onElementCreate&&this.onElementCreate(ae,this),ae},elementHasProperties:function(G,ie){var ae=this;return f(ie,function(Ae,fe){if(Ae=="className")return S(G,fe);if(typeof fe=="object"){if(!ae.elementHasProperties(G[Ae],fe))return!1}else if(G[Ae]!==fe)return!1})},elementHasAttributes:function(G,ie){return f(ie,function(ae,Ae){if(G.getAttribute(ae)!==Ae)return!1})},applyToTextNode:function(G,ie){if(k(G)){var ae=G.parentNode;if(ae.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(ae)&&this.elementHasProperties(ae,this.elementProperties)&&this.elementHasAttributes(ae,this.elementAttributes))g(ae,this.className);else{var Ae=G.parentNode,fe=this.createContainer(Ae);Ae.insertBefore(fe,G),fe.appendChild(G)}}},isRemovable:function(G){return G.tagName.toLowerCase()==this.elementTagName&&T(G)==this.elementSortedClassName&&this.elementHasProperties(G,this.elementProperties)&&!Y(G,this.attrExceptions)&&this.elementHasAttributes(G,this.elementAttributes)&&this.isModifiable(G)},isEmptyContainer:function(G){var ie=G.childNodes.length;return G.nodeType==1&&this.isRemovable(G)&&(ie==0||ie==1&&this.isEmptyContainer(G.firstChild))},removeEmptyContainers:function(G){var ie=this,ae=G.getNodes([1],function(Ie){return ie.isEmptyContainer(Ie)}),Ae=[G],fe=q(Ae);d(ae,function(Ie){O(Ie,fe)}),re(Ae,fe)},undoToTextNode:function(G,ie,ae,Ae){if(!ie.containsNode(ae)){var fe=ie.cloneRange();fe.selectNode(ae),fe.isPointInRange(ie.endContainer,ie.endOffset)&&(xe(ae,ie.endContainer,ie.endOffset,Ae),ie.setEndAfter(ae)),fe.isPointInRange(ie.startContainer,ie.startOffset)&&(ae=xe(ae,ie.startContainer,ie.startOffset,Ae))}this.isRemovable(ae)?E(ae,Ae):_(ae,this.className)},splitAncestorWithClass:function(G,ie,ae){var Ae=this.getSelfOrAncestorWithClass(G);Ae&&xe(Ae,G,ie,ae)},undoToAncestor:function(G,ie){this.isRemovable(G)?E(G,ie):_(G,this.className)},applyToRange:function(G,ie){var ae=this;ie=ie||[];var Ae=q(ie||[]);G.splitBoundariesPreservingPositions(Ae),ae.removeEmptyElements&&ae.removeEmptyContainers(G);var fe=N(G);if(fe.length){d(fe,function(Ue){!ae.isIgnorableWhiteSpaceNode(Ue)&&!ae.getSelfOrAncestorWithClass(Ue)&&ae.isModifiable(Ue)&&ae.applyToTextNode(Ue,Ae)});var Ie=fe[fe.length-1];G.setStartAndEnd(fe[0],0,Ie,Ie.length),ae.normalize&&ae.postApply(fe,G,Ae,!1),re(ie,Ae)}var je=ae.getEmptyElements(G);d(je,function(Ue){g(Ue,ae.className)})},applyToRanges:function(G){for(var ie=G.length;ie--;)this.applyToRange(G[ie],G);return G},applyToSelection:function(G){var ie=o.getSelection(G);ie.setRanges(this.applyToRanges(ie.getAllRanges()))},undoToRange:function(G,ie){var ae=this;ie=ie||[];var Ae=q(ie);G.splitBoundariesPreservingPositions(Ae),ae.removeEmptyElements&&ae.removeEmptyContainers(G,Ae);var fe=N(G),Ie,je,Ue=fe[fe.length-1];if(fe.length){ae.splitAncestorWithClass(G.endContainer,G.endOffset,Ae),ae.splitAncestorWithClass(G.startContainer,G.startOffset,Ae);for(var ot=0,it=fe.length;ot<it;++ot)Ie=fe[ot],je=ae.getSelfOrAncestorWithClass(Ie),je&&ae.isModifiable(Ie)&&ae.undoToAncestor(je,Ae);G.setStartAndEnd(fe[0],0,Ue,Ue.length),ae.normalize&&ae.postApply(fe,G,Ae,!0),re(ie,Ae)}var Ke=ae.getEmptyElements(G);d(Ke,function(dt){_(dt,ae.className)})},undoToRanges:function(G){for(var ie=G.length;ie--;)this.undoToRange(G[ie],G);return G},undoToSelection:function(G){var ie=o.getSelection(G),ae=o.getSelection(G).getAllRanges();this.undoToRanges(ae),ie.setRanges(ae)},isAppliedToRange:function(G){if(G.collapsed||G.toString()=="")return!!this.getSelfOrAncestorWithClass(G.commonAncestorContainer);var ie=G.getNodes([3]);if(ie.length){for(var ae=0,Ae;Ae=ie[ae++];)if(!this.isIgnorableWhiteSpaceNode(Ae)&&D(G,Ae)&&this.isModifiable(Ae)&&!this.getSelfOrAncestorWithClass(Ae))return!1}return!0},isAppliedToRanges:function(G){var ie=G.length;if(ie==0)return!1;for(;ie--;)if(!this.isAppliedToRange(G[ie]))return!1;return!0},isAppliedToSelection:function(G){var ie=o.getSelection(G);return this.isAppliedToRanges(ie.getAllRanges())},toggleRange:function(G){this.isAppliedToRange(G)?this.undoToRange(G):this.applyToRange(G)},toggleSelection:function(G){this.isAppliedToSelection(G)?this.undoToSelection(G):this.applyToSelection(G)},getElementsWithClassIntersectingRange:function(G){var ie=[],ae=this;return G.getNodes([3],function(Ae){var fe=ae.getSelfOrAncestorWithClass(Ae);fe&&!a(ie,fe)&&ie.push(fe)}),ie},detach:function(){}};function De(G,ie,ae){return new be(G,ie,ae)}be.util={hasClass:y,addClass:g,removeClass:_,getClass:b,hasSameClasses:M,hasAllClasses:S,replaceWithOwnChildren:E,elementsHaveSameNonClassAttributes:F,elementHasNonClassAttributes:Y,splitNodeAt:xe,isEditableElement:j,isEditingHost:le,isEditable:z},o.CssClassApplier=o.ClassApplier=be,o.createClassApplier=De,l.createAliasForDeprecatedMethod(o,"createCssClassApplier","createClassApplier",i)}),t})})(Pd)),Pd.exports}rte();var Tv={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},$v=Mu.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var n=this;Nv.init(),Mu.extensions.button.prototype.init.call(this),this.colorPicker=new ym({parent:this.button,color:"#000",onDone:function(e){n.coloredText&&n.coloredText.isAppliedToSelection()&&n.coloredText.undoToSelection(),n.coloredText=Nv.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),n.coloredText.toggleSelection(),n.base.checkContentChanged(),n.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(n){return n.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),ste=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ate=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Rv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Pv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))};(function(n){ste(e,n);function e(t){var o=n.call(this,t)||this;o.labelMap=new Map;var i=t.lf,r=t.graphModel;return o.lf=i,o.graphModel=r,o.state={tick:0},o}return e.prototype.componentDidMount=function(){var t=this,o=this.props.graphModel;this.editor=new Mu(".lf-label-editor",cs(Tv,{autoLink:!0,extensions:{colorPicker:new $v}})),o.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),o.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new Mu(".lf-label-editor",cs(Tv,{autoLink:!0,extensions:{colorPicker:new $v}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,o=this.props,i=o.lf.extension,r=o.graphModel,s=Pv(Pv([],Rv(r.nodes),!1),Rv(r.edges),!1),a=i.label;if(a){var l=[];return Vt(s,function(d){var c,p,f=d.getData(),h=(p=(c=f.properties)===null||c===void 0?void 0:c._label)!==null&&p!==void 0?p:[];Vt(h,function(v){var y=t.labelMap,g=new Wee(v,d,r);y.set(g.id,g),l.push(Pe(Gee,{label:g,element:d,graphModel:r},g.id))})}),l}return null},e.prototype.render=function(){return Pe("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=ate([no],e),e})(Kt);var lte=(function(){function n(e){var t=e.lf,o=this;this.lf=t,this.lf.setPatternItems=function(i){o.setPatternItems(i)}}return n.prototype.render=function(e,t){var o=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.panelEl.addEventListener("touchmove",function(i){i.preventDefault()},{passive:!1}),this.shapeList.forEach(function(i){var r;(r=o.panelEl)===null||r===void 0||r.appendChild(o.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},n.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},n.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},n.prototype.createDndItem=function(e){var t=this,o=document.createElement("div");o.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),o.appendChild(i),e.label){var r=document.createElement("div");r.innerText=e.label,r.className="lf-dnd-text",o.appendChild(r)}return e.disabled?(o.classList.add("disabled"),o.onpointerdown=function(){e.callback&&e.callback(t.lf,t.domContainer)},o):(o.onpointerdown=function(s){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer),s.preventDefault()},o.ondblclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:s,data:e})},o.onclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:s,data:e})},o.oncontextmenu=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:s,data:e})},o)},n.pluginName="dndPanel",n})(),ute=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},dte=(function(){function n(e){var t=e.lf,o=e.LogicFlow,i=e.options,r=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){r.updateViewPortBounds(),r.isShow&&r.updateViewPort()},this.render=function(a,l){r.container=l,r.lf.on("history:change",function(){r.isShow&&r.setView()}),r.lf.on("graph:transform",function(){r.isShow&&r.setView(!1)})},this.show=function(a,l){r.isShow||(r.initMiniMap(),r.lf.on("graph:resize",r.onGraphResize),r.createMiniMap(a,l),r.setView(!0)),r.isShow=!0},this.hide=function(){r.isShow&&(r.lf.off("graph:resize",r.onGraphResize),r.lfMap.destroy(),r.translateX=0,r.translateY=0,r.removeMiniMap(),r.lf.emit("miniMap:close",{})),r.isShow=!1},this.updatePosition=function(a){if(typeof a=="object")(a.left!==void 0||a.right!==void 0)&&(r.leftPosition=a.left,r.rightPosition=a.right),(a.top!==void 0||a.bottom!==void 0)&&(r.topPosition=a.top,r.bottomPosition=a.bottom);else switch(a){case"left-top":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=0,r.bottomPosition=void 0;break;case"right-top":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=0,r.bottomPosition=void 0;break;case"left-bottom":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=void 0,r.bottomPosition=0;break;case"right-bottom":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=void 0,r.bottomPosition=0;break}r.updateMiniMapPosition()},this.reset=function(){r.lf.resetTranslate(),r.lf.resetZoom()},this.setShowEdge=function(a){r.showEdge!==a&&(r.showEdge=a,r.setView())},this.startDrag=function(a){document.addEventListener("pointermove",r.drag),document.addEventListener("pointerup",r.drop);var l=a.x,d=a.y;r.startPosition={x:l,y:d}},this.drag=function(a){var l=a.x,d=a.y,c=(l-r.startPosition.x)/r.scale,p=(d-r.startPosition.y)/r.scale,f=r.viewPortLeft+c+r.viewPortWidth/r.scale/2,h=r.viewPortTop+p+r.viewPortHeight/r.scale/2;r.startPosition={x:l,y:d},r.lf.focusOn({coordinate:{x:f,y:h}})},this.drop=function(){document.removeEventListener("pointermove",r.drag),document.removeEventListener("pointerup",r.drop)},this.mapClick=function(a){var l=a.offsetX,d=a.offsetY,c=r.translateX+l/r.scale,p=r.translateY+d/r.scale;r.lf.focusOn({coordinate:{x:c,y:p}})},this.lf=t,this.LFCtor=o,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var s={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=s,this.elementAreaBounds=s,this.viewPortBounds=s}return n.prototype.setOption=function(e){var t=e.width,o=t===void 0?150:t,i=e.height,r=i===void 0?220:i,s=e.showEdge,a=s===void 0?!1:s,l=e.isShowHeader,d=l===void 0?!1:l,c=e.isShowCloseIcon,p=c===void 0?!1:c,f=e.leftPosition,h=e.topPosition,v=e.rightPosition,y=v===void 0?0:v,g=e.bottomPosition,_=g===void 0?0:g,b=e.headerTitle,C=b===void 0?"导航":b;this.width=o,this.height=r,this.showEdge=a,this.isShowHeader=d,this.isShowCloseIcon=p,this.leftPosition=f,this.rightPosition=f!==void 0?void 0:y,this.topPosition=h,this.bottomPosition=h!==void 0?void 0:_,this.headerTitle=C},n.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins,isMiniMap:!0}),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},n.prototype.createMiniMap=function(e,t){var o,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(o=this.container)===null||o===void 0||o.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var r=document.createElement("div");r.className="lf-mini-map-header",r.innerText=this.headerTitle,i.appendChild(r);var s=document.createElement("span");s.className="lf-mini-map-close",s.addEventListener("click",this.hide),i.appendChild(s)},n.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},n.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},n.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},n.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},o=e.nodes;o&&o.length>0&&o.forEach(function(i){var r,s,a=i.x,l=i.y,d=(r=i.width)!==null&&r!==void 0?r:200,c=(s=i.height)!==null&&s!==void 0?s:200,p=a-d/2,f=a+d/2,h=l-c/2,v=l+c/2;t.left=Math.min(p,t.left),t.right=Math.max(f,t.right),t.top=Math.min(h,t.top),t.bottom=Math.max(v,t.bottom)}),this.elementAreaBounds=t},n.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,o=e.TRANSLATE_Y,i=e.SCALE_X,r=e.SCALE_Y,s=this.lf.graphModel,a=s.width,l=s.height;this.viewPortBounds={left:-t/i,right:(-t+a)/i,top:-o/r,bottom:(-o+l)/r}},n.prototype.resetData=function(e){var t=e.nodes,o=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&o.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?o:[]}},n.prototype.setView=function(e){var t,o;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),r=this.resetData(i),s=this.lf.viewMap,a=this.lf.graphModel.modelMap,l=this.lfMap.viewMap;try{for(var d=ute(s.keys()),c=d.next();!c.done;c=d.next()){var p=c.value;l.has(p)||this.lfMap.register({type:p,view:s.get(p),model:a.get(p)})}}catch($){t={error:$}}finally{try{c&&!c.done&&(o=d.return)&&o.call(d)}finally{if(t)throw t.error}}this.lfMap.render(r),this.updateBounds(r)}else this.updateBounds();var f=this.bounds,h=f.left,v=f.top,y=f.right,g=f.bottom,_=y-h,b=g-v,C=this.width/_,T=this.height/b,M=Math.min(C,T);this.scale=M;var S=h-(this.width/M-_)/2,k=v-(this.height/M-b)/2;if(this.lfMap.graphModel.transformModel.translate(-S+this.translateX,-k+this.translateY),this.translateX=S,this.translateY=k,this.miniMapWrap.firstChild){var A=this.miniMapWrap.firstChild.style;A.pointerEvents="none",A.transform="matrix(".concat(M,", 0, 0, ").concat(M,", 0, 0)"),A.transformOrigin="left top",A.height="".concat(this.height/M,"px"),A.width="".concat(this.width/M,"px"),this.updateViewPort()}},n.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),o=t.TRANSLATE_X,i=t.TRANSLATE_Y,r=t.SCALE_X,s=t.SCALE_Y,a=this.lf.graphModel,l=a.width,d=a.height;this.viewPortLeft=-o/r,this.viewPortTop=-i/s,this.viewPortWidth=l/r*this.scale,this.viewPortHeight=d/s*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},n.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.style.touchAction="none",e.addEventListener("pointerdown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},n.prototype.destroy=function(){this.lf.off("graph:resize",this.onGraphResize)},n.pluginName="miniMap",n})(),Lv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Bv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},cte=(function(){function n(e){var t=e.lf,o=e.options,i=this,r;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.originStatusSaved=!1,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(s){var a=s.e;i.handleMouseDown(a)},this.draw=function(s){if(i.lf.graphModel.editConfigModel.isPinching){i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),i.originStatusSaved=!1,i.cleanupSelectionState();return}var a=i.lf.getPointByClient(s.clientX,s.clientY).domOverlayPosition,l=a.x,d=a.y;if(i.endPoint={x:l,y:d},i.startPoint){var c=i.startPoint,p=c.x,f=c.y,h=p,v=f,y=l-p,g=d-f;l<p&&(h=l,y=p-l),d<f&&(v=d,g=f-d),i.wrapper&&(i.wrapper.style.left="".concat(h,"px"),i.wrapper.style.top="".concat(v,"px"),i.wrapper.style.width="".concat(y,"px"),i.wrapper.style.height="".concat(g,"px"))}},this.drawOff=function(s){if(i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),i.originStatusSaved=!1,i.mouseDownInfo){var a=i.mouseDownInfo,l=a.x,d=a.y,c=a.time,p=Math.abs(s.clientX-l)<5&&Math.abs(s.clientY-d)<5&&Date.now()-c<200;if(p){i.lf.clearSelectElements(),i.cleanupSelectionState();return}}var f=Dt(i.startPoint),h=Dt(i.endPoint);if(document.removeEventListener("pointermove",i.draw),i.exclusiveMode||document.removeEventListener("pointerup",i.drawOff),f&&h){var l=f.x,d=f.y,v=h.x,y=h.y,g=[Math.min(l,v),Math.min(d,y)],_=[Math.max(l,v),Math.max(d,y)];if(i.lf.emit("selection:selected-area",{topLeft:g,bottomRight:_}),Math.abs(v-l)<10&&Math.abs(y-d)<10){i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0);return}var b=i.lf.graphModel.getAreaElement(g,_,i.isWholeEdge,i.isWholeNode,!0),C=i.lf.graphModel,T=C.dynamicGroup,M=C.group,S=[],k=i.lf.getSelectElements(),A=new Set(Bv(Bv([],Lv(k.nodes.map(function(O){return O.id})),!1),Lv(k.edges.map(function(O){return O.id})),!1));b.forEach(function(O){if(M){var P=M.getNodeGroup(O.id);if(b.includes(P))return}if(T){var P=T.getGroupByNodeId(O.id);if(b.includes(P))return}if(i.exclusiveMode&&A.has(O.id)){i.lf.deselectElementById(O.id);return}i.lf.selectElementById(O.id,!0),S.push(O)}),i.startPoint=void 0,i.endPoint=void 0,S.length>0&&i.lf.emit("selection:drop",{e:s}),i.lf.emit("selection:selected",{elements:S,leftTopPoint:g,rightBottomPoint:_})}i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0)},this.lf=t,this.exclusiveMode=(r=o==null?void 0:o.exclusiveMode)!==null&&r!==void 0?r:!1,t.openSelectionSelect=function(){i.openSelectionSelect()},t.closeSelectionSelect=function(){i.closeSelectionSelect()},t.setSelectionSelectMode=function(s){i.setExclusiveMode(s)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return n.prototype.render=function(e,t){this.container=t},n.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("pointermove",this.draw),document.removeEventListener("pointerup",this.drawOff)},n.prototype.setExclusiveMode=function(e){e===void 0&&(e=!1),this.exclusiveMode!==e&&(this.cleanupSelectionState(),this.exclusiveMode=e,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},n.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.style.touchAction="none",this.container.addEventListener("pointerdown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},n.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("pointerdown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},n.prototype.handleMouseDown=function(e){var t;if(!(!this.container||this.disabled)&&!this.lf.graphModel.editConfigModel.isPinching){var o=e.button===2;if(!o){this.cleanupSelectionState(),this.mouseDownInfo={x:e.clientX,y:e.clientY,time:Date.now()},this.originStatusSaved||(this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.originStatusSaved=!0),this.lf.updateEditConfig({stopMoveGraph:!0});var i=this.lf.getPointByClient(e.clientX,e.clientY).domOverlayPosition,r=i.x,s=i.y;this.startPoint={x:r,y:s},this.endPoint={x:r,y:s};var a=document.createElement("div");a.className="lf-selection-select",a.oncontextmenu=function(d){d.preventDefault()},a.style.top="".concat(this.startPoint.y,"px"),a.style.left="".concat(this.startPoint.x,"px"),(t=this.container)===null||t===void 0||t.appendChild(a),this.wrapper=a,document.addEventListener("pointermove",this.draw),document.addEventListener("pointerup",this.drawOff)}}},n.prototype.setSelectionSense=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),this.isWholeEdge=e,this.isWholeNode=t},n.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},n.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var e=Dt(this.endPoint),t=new PointerEvent("pointerup",{clientX:e.x,clientY:e.y});this.drawOff(t)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},n.prototype.open=function(){this.disabled=!1},n.prototype.close=function(){this.disabled=!0},n.pluginName="selectionSelect",n})();var xm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),as=function(){return as=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},as.apply(this,arguments)},ga=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},pte={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function fte(n){for(var e=n,t=1;t<e.length-1;){var o=ga(e[t-1],2),i=o[0],r=o[1],s=ga(e[t],2),a=s[0],l=s[1],d=ga(e[t+1],2),c=d[0],p=d[1];i===a&&a===c||r===l&&l===p?e.splice(t,1):t++}return e}function hte(n,e,t,o){var i=[n[0],n[1]],r=[n[0],n[1]];switch(t){case"tl":return e==="tr"?(i[1]+=o,r[0]+=o):e==="lb"&&(i[0]+=o,r[1]+=o),[i,r];case"tr":return e==="tl"?(i[1]+=o,r[0]-=o):e==="rb"&&(i[0]-=o,r[1]+=o),[i,r];case"bl":return e==="br"?(i[1]-=o,r[0]+=o):e==="lt"&&(i[0]+=o,r[1]-=o),[i,r];case"br":return e==="bl"?(i[1]-=o,r[0]-=o):e==="rt"&&(i[0]-=o,r[1]-=o),[i,r];default:return[]}}function vte(n,e,t,o){var i,r="",s="";n[0]===e[0]?r=n[1]>e[1]?"t":"b":n[1]===e[1]&&(r=n[0]>e[0]?"l":"r"),e[0]===t[0]?s=e[1]>t[1]?"t":"b":e[1]===t[1]&&(s=e[0]>t[0]?"l":"r");var a=Math.min(Math.hypot(e[0]-n[0],e[1]-n[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,o)||1/5*o,l="".concat(r).concat(s),d=pte[l]||"-",c="L ".concat(n[0]," ").concat(n[1]);if(d==="-")c+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var p=ga(hte(e,l,d,a),2),f=p[0],h=p[1];f&&h&&(c+="L ".concat(f[0]," ").concat(f[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(h[0]," ").concat(h[1]),i=ga(h,2),e[0]=i[0],e[1]=i[1])}return c}function _te(n,e){var t=0,o="";if(n.length===2)o+="M".concat(n[t][0]," ").concat(n[t++][1]," L ").concat(n[t][0]," ").concat(n[t][1]);else{for(o+="M".concat(n[t][0]," ").concat(n[t++][1]);t+1<n.length;){var i=n[t-1],r=n[t],s=n[t+++1];o+=vte(i,r,s,e)}o+="L ".concat(n[t][0]," ").concat(n[t][1])}return o}(function(n){xm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.points,i=t.isAnimation,r=t.arrowConfig,s=t.radius,a=s===void 0?5:s,l=t.getEdgeStyle(),d=t.getEdgeAnimationStyle(),c=fte(o.split(" ").map(function(h){return h.split(",").map(function(v){return+v})})),p=_te(c,a),f=as(as(as({style:i?d:{}},l),r),{fill:"none"});return et("path",as({d:p},f))},e})(Ds);(function(n){xm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(Es);var wm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Tu=function(){return Tu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Tu.apply(this,arguments)},Iv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},jv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},gte=(function(n){wm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.id,i=t.x,r=t.y,s=t.width,a=t.height,l=t.properties,d=this.props.model.getNodeStyle();return et("svg",{x:i-s/2,y:r-a/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[l.labelText?et("text",{x:0,y:-5,fontSize:"16px",fill:d.stroke},l.labelText):"",l.disabledDelete?"":et("text",{x:l.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:d.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,o)},"x")])},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.id,l=this.props.model.getNodeStyle();return et("g",{},[et("rect",Tu(Tu({},l),{x:o-r/2,y:i-s/2,width:r,height:s,id:a})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var o=this.props.graphModel;o.deleteNode(t)},e})(fu),mte=(function(n){wm(e,n);function e(){var t=n.apply(this,jv([],Iv(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},n.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,o;this.points=[],((o=this.properties)===null||o===void 0?void 0:o.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var o=t.x,i=t.y;this.x=o,this.y=i},e.prototype.updatePointsByNodes=function(t){var o=this,i=[],r=1/0,s=1/0,a=-1/0,l=-1/0;t.forEach(function(d){var c=o.graphModel.getNodeModelById(d);if(c){var p=c.width,f=c.height,h=c.x,v=c.y;r=Math.min(r,h-p/2-o.d),s=Math.min(s,v-f/2-o.d),a=Math.max(a,h+p/2+o.d),l=Math.max(l,v+f/2+o.d)}}),i.push([r,s],[a,s],[a,l],[r,l]),![r,s,a,l].some(function(d){return Math.abs(d)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(a+r)/2,y:(l+s)/2}))},e.prototype.resize=function(t){var o;this.isResize=!0;for(var i=t.width,r=t.height,s={x:i/this.width,y:r/this.height},a=(this.properties.node_selection_ids||[]).slice(),l=[],d=new Set;a.length;){var c=a.shift(),p=(o=this.graphModel.nodesMap[c])===null||o===void 0?void 0:o.model;if(p){if(!Bl(p)){l.push(p);continue}d.has(p.id)||(d.add(p.id),a.push.apply(a,jv([],Iv(p.properties.node_selection_ids||[]),!1)))}}var f={x:this.x-this.width/2,y:this.y-this.height/2},h=n.prototype.resize.call(this,t),v={x:this.x-this.width/2,y:this.y-this.height/2};return l.forEach(function(y){y.width=y.width*s.x,y.height=y.height*s.y;var g=(y.x-f.x)*s.x+v.x-y.x,_=(y.y-f.y)*s.y+v.y-y.y;y.move(g,_,!0)}),this.isResize=!1,h},e})(uu),Vc="node-selection";(function(){function n(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:Vc,view:gte,model:mte})}return Object.defineProperty(n.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),n.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},n.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},n.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,o=this.lf.getGraphRawData(),i=t.filter(function(r){return r!==e.currentClickNode.id});return o.nodes.find(function(r){if(r.type==="node-selection"){var s=qa(r,"properties.node_selection_ids",[]);return i.every(function(a){return s.includes(a)})}return!1})},n.prototype.onNodeChange=function(e,t){var o=e.graphModel.nodes.filter(function(i){if(!Bl(i))return!1;var r=i.properties.node_selection_ids||[];return r.includes(t.id)});Promise.resolve().then(function(){o.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},n.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(o){var i;if(!(!o.e.shiftKey||o.data.type===Vc)){t.currentClickNode=o.data;var r=!1;t.selectNodesIds.includes(o.data.id)&&((i=t.lf.getNodeModelById(o.data.id))===null||i===void 0||i.setSelected(!1),r=!0);var s=e.getSelectElements(!0).nodes;t.selectNodes=s,t.selectNodes.length===1?r?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(o,i,r){if(t.onNodeChange(e,o),Bl(o)&&!o.isResize){var s=o.properties.node_selection_ids||[];return e.graphModel.moveNodes(s,i,r,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(o){return Bl(o)||t.onNodeChange(e,o),!0})},n.pluginName="node-selection",n})();var Bl=function(n){return!!(n&&n.type===Vc)},yte=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),$u=function(){return $u=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$u.apply(this,arguments)};(function(n){yte(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.properties;return et("text",{x:o-r/2+5,y:i-s/2+16,fontSize:12,fill:"blue"},a.moreText)},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=this.props.model.getNodeStyle();return et("g",{},[et("rect",$u($u({},a),{fill:"#FFFFFF",x:o-r/2,y:i-s/2})),this.getLabelShape()])},e})(Br);var bte=wC();const xte=Ga(bte);function wte(n,e="id",t="parentId",o="children"){const i=[],r=new Map;for(const s of n)r.set(s[e],{...s,[o]:[]});for(const s of n){const a=r.get(s[e]),l=s[t];l!=null&&r.has(l)?r.get(l)[o].push(a):i.push(a)}return i}class Cm{constructor({lf:e}){this.lf=e,this.elk=new xte}async layout(e){const t=JSON.parse(JSON.stringify(e)),{nodes:o,edges:i}=t,r=new Map(o.map(h=>[h.id,h])),s=o.map(h=>{var y;let v={id:h.id,parentId:((y=h.properties)==null?void 0:y.loop_parent_key)||null};return h.children&&h.children.length>0?v.layoutOptions={"elk.padding":"[top=112, right=32, bottom=32, left=32]","elk.nodeSize.constraints":"MINIMUM_SIZE","elk.nodeSize.minimum":"[600, 420]","elk.spacing.nodeNode":100,"elk.layered.spacing.nodeNodeBetweenLayers":120}:(v.width=h.properties.width||420,v.height=h.properties.height||100,v.layoutOptions={"elk.nodeSize.constraints":"FIXED"}),v}),a=new Map;i.forEach(h=>{a.set(h.id,{...h})});const l=wte(s),d=i.map(h=>({id:h.id,sources:[h.sourceNodeId],targets:[h.targetNodeId]})),c={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"RIGHT","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.nodePlacement.bk.fixedAlignment":"TOP","elk.spacing.nodeNode":200,"elk.layered.spacing.nodeNodeBetweenLayers":200,"elk.layered.considerHierarchy":"true","elk.spacing.componentComponent":80},children:l,edges:d},p=await this.elk.layout(c);function f(h,v=null,y=0,g=0){for(const _ of h){const b=r.get(_.id);if(!b)continue;let C,T;v?(C=y+_.x,T=g+_.y):(C=_.x,T=_.y),b.x=C+_.width/2,b.y=T+_.height/2,b.properties||(b.properties={}),b.width=_.width,b.height=_.height,b.properties.width=_.width,b.properties.height=_.height,_.children&&_.children.length>0&&f(_.children,_,C,T)}}f(p.children),i.forEach(h=>{const v=a.get(h.id),y=p.edges.find(g=>g.id===h.id);if(y&&y.sections&&y.sections.length>0){const g=y.sections[0];if(g){v&&(h.sourceAnchorId=v.sourceAnchorId,h.targetAnchorId=v.targetAnchorId),h.startPoint={...g.startPoint},h.endPoint={...g.endPoint};const _=g.startPoint,b=g.endPoint,C=b.x-_.x,T=b.y-_.y;let A=50+Math.sqrt(C*C+T*T)*.3;A=Math.max(10,Math.min(A,100));const O={x:_.x+Math.abs(C)*.3,y:_.y},P={x:b.x-Math.abs(C)*.3,y:b.y};Math.abs(T)>Math.abs(C)?(O.x=_.x,O.y=_.y+Math.abs(T)*.3,P.x=b.x,P.y=b.y-Math.abs(T)*.3):(O.x=_.x+Math.abs(C)*.3,O.y=_.y,P.x=b.x-Math.abs(C)*.3,P.y=b.y),h.pointsList=[{..._},O,P,{...b}],h.properties||(h.properties={}),h.properties.offset=Math.round(A)}}else if(v&&(h.sourceAnchorId=v.sourceAnchorId,h.targetAnchorId=v.targetAnchorId,h.type=v.type||"custom-bezier-edge",h.startPoint&&h.endPoint&&(!h.pointsList||h.pointsList.length===0))){const g=h.endPoint.x-h.startPoint.x,_=h.endPoint.y-h.startPoint.y;let M=50+Math.sqrt(g*g+_*_)*.3;M=Math.max(10,Math.min(M,100));const A={x:h.startPoint.x+Math.abs(g)*.3,y:h.startPoint.y},$={x:h.endPoint.x-Math.abs(g)*.3,y:h.endPoint.y};Math.abs(_)>Math.abs(g)?(A.x=h.startPoint.x,A.y=h.startPoint.y+Math.abs(_)*.3,$.x=h.endPoint.x,$.y=h.endPoint.y-Math.abs(_)*.3):(A.x=h.startPoint.x+Math.abs(g)*.3,A.y=h.startPoint.y,$.x=h.endPoint.x-Math.abs(g)*.3,$.y=h.endPoint.y),h.pointsList=[{...h.startPoint},A,$,{...h.endPoint}],h.properties||(h.properties={}),h.properties.offset=Math.round(M)}}),this.lf.clearSelectElements(),this.lf.clearData(),this.lf.graphModel.graphDataToModel(t),this.fitView(t.nodes),t.nodes.forEach(h=>{if(h.children&&h.children.length){let v=this.lf.graphModel.getElement(h.id);v&&v.setZIndex(-9999)}})}fitView(e){if(!e||e.length===0){this.lf.resetZoom(),this.lf.resetTranslate();return}const{width:t,height:o}=this.lf.graphModel;let i=1/0,r=1/0,s=-1/0,a=-1/0;e.forEach(v=>{const y=(v.width||v.properties.width)/2,g=(v.height||v.properties.height)/2;i=Math.min(i,v.x-y),r=Math.min(r,v.y-g),s=Math.max(s,v.x+y),a=Math.max(a,v.y+g)});const l=s-i,d=a-r;if(l===0||d===0)return;const c=.1,p=t/(l*(1+c)),f=o/(d*(1+c));let h=Math.min(p,f);h>1?h=1:h<.3&&(h=.3),this.lf.zoom(h),this.lf.translateCenter()}}ci(Cm,"pluginName","elk");class km{constructor({lf:e}){this.lf=e,this.padding={top:94,right:16,bottom:16,left:16},this.resize_padding=30,this.handleNodeDrag=this.handleNodeDrag.bind(this),e.on("node:drag",this.handleNodeDrag)}handleNodeDrag({data:e}){this.lf.off("node:drag",this.handleNodeDrag);try{const t=this.lf.graphModel.getNodeModelById(e.id);if(!t)return;const{x:o,y:i,width:r,height:s}=t,a=t.getProperties();if(a.loop_parent_key){const l=this.lf.graphModel.getNodeModelById(a.loop_parent_key);if(l){const{x:d,y:c,width:p,height:f}=l,h=o-r/2,v=o+r/2,y=i-s/2,g=i+s/2,_=d-p/2+this.padding.left,b=d+p/2-this.padding.right,C=c-f/2+this.padding.top,T=c+f/2-this.padding.bottom;let M=p,S=f,k=d,A=c,$=!1;if(h<_){const B=_-h+this.resize_padding;M+=B,k-=B/2,$=!0}if(v>b){const B=v-b+this.resize_padding;M+=B,k+=B/2,$=!0}if(y<C){const B=C-y+this.resize_padding;S+=B,A-=B/2,$=!0}if(g>T){const B=g-T+this.resize_padding;S+=B,A+=B/2,$=!0}$&&(l.x=k,l.y=A,l._width=l.width=M,l._height=l.height=S)}}}finally{this.lf.on("node:drag",this.handleNodeDrag)}}}ci(km,"pluginName","groupAutoResize");var Cte=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Er=function(){return Er=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Er.apply(this,arguments)},kte=(function(n){Cte(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,o=t.width,i=t.height,r=t.radius;eo(o)||(this.width=o),eo(i)||(this.height=i),eo(r)||(this.radius=r)},e.prototype.getTextStyle=function(){var t=this.properties,o=t.refX,i=o===void 0?0:o,r=t.refY,s=r===void 0?0:r,a=t.textStyle,l=n.prototype.getTextStyle.call(this);return Er(Er(Er({},l),Dt(a)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(s,")")})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.properties.style;return Er(Er({},t),Dt(o)||{})},e})(Ba),Sm={};function Jt(n,e){var t=n.type,o=n.component,i=n.effect,r=n.view,s=n.model;if(!t)throw new Error("You should specify type in config");Sm[t]={component:o,effect:i},e.register({type:t,view:r||Nte,model:s||kte})}var Hs=!1,Os=new Map,Ns=new Map,Ru=Je({});function Ste(n,e,t,o,i){Hs&&(i.isMiniMap&&Ate(t,i.flowId),Ru[n]=Vm(Qv({render:function(){return St(Kv,{to:t},[St(e,{node:o,graph:i})])},provide:function(){return{getNode:function(){return o},getGraph:function(){return i}}}})))}function Ete(n,e){if(Hs&&(delete Ru[n],Os.has(e))){var t=Ns.get(e)||[],o=t.indexOf(n);o>-1&&(t.splice(o,1),t.length===0?Dte(e):Ns.set(e,t))}}function Fv(){return Hs}function Em(){return Hs=!0,Qv({props:{flowId:{type:String,required:!0}},setup:function(n){return function(){var e=[];return Object.keys(Ru).forEach(function(t){if(t.startsWith(n.flowId)){if(Os.has(n.flowId)){var o=Ns.get(n.flowId)||[];o.includes(t)||(o.push(t),Ns.set(n.flowId,o))}e.push(Ru[t])}}),St(se,{},e.map(function(t){return St(t)}))}}})}function Ate(n,e){if(!(!e||!n||!Hs)){var t=Em();if(!Os.has(e)){var o=document.createElement("div");n.appendChild(o);var i=rr(t,{flowId:e});i.mount(o),Os.set(e,i),Ns.set(e,[])}}}function Dte(n){if(!(!n||!Hs)){var e=Os.get(n);e&&(e.unmount(),Os.delete(n),Ns.delete(n))}}var Ote=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Nte=(function(n){Ote(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var o=document.createElement("div");o.className="custom-vue-node-content",this.root=o,t.appendChild(o),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var o=this.getComponentContainer(),i=this.props,r=i.model,s=i.graphModel;if(o){var a=Sm[r.type].component;a&&(Fv()?Ste(this.targetId(),a,o,r,s):(this.vm=rr({render:function(){return St(a,{node:r,graph:s})},provide:function(){return{getNode:function(){return r},getGraph:function(){return s}}}}),(t=this.vm)===null||t===void 0||t.mount(o)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){Fv()&&Ete(this.targetId(),this.props.graphModel.flowId),this.unmountVueComponent()},e})(ja);const Mte={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},Tte={class:"custom-line-popup"};function $te(n,e,t,o,i,r){return ri((w(),R("div",Tte,[u("button",{class:"delete-btn",onClick:e[0]||(e[0]=Ct((...s)=>r.handleDelete&&r.handleDelete(...s),["stop"]))},"删 除")],512)),[[Si,i.isDeleteConfirmShow]])}const Rte=Ne(Mte,[["render",$te],["__scopeId","data-v-4b6cc0a8"]]),Pte=70,Lte=36;let Bte=class extends Ds{constructor(e){super(e),this.isMounted=!1,this.r=St(Rte,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=rr({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=Pte,customHeight:o=Lte}=e.getProperties(),i=e.id,{startPoint:r,endPoint:s,arrowConfig:a,pointsList:l}=e;let d={x:(r.x+s.x-t)/2,y:(r.y+s.y-o)/2,width:t,height:o};if(l.length>2){let p=Math.round(l.length/2);d.x=l[p-1].x+5,d.y=l[p-1].y}const c={width:t,height:o};return setTimeout(()=>{const p=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(p))},0),et("foreignObject",{...d,id:"line_"+i},[et("div",{id:i,style:c,className:"vue-app-wrapper"})])}},Ite=class extends Es{initEdgeData(e){super.initEdgeData(e)}createId(){return Ki("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(r=>r.id===this.sourceAnchorId),o=this.graphModel.getNodeModelById(this.targetNodeId),i=o==null?void 0:o.getDefaultAnchor().find(r=>r.id===this.targetAnchorId);if(t){const r={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(r)}if(i){const r={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(r)}this.pointsList=[],this.initPoints()}};const jte={type:"custom-edge",view:Bte,model:Ite},Fte={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){const e=this.getGraphModel(),t=this.getModel();if(e.getNodeModelById(t.sourceNodeId).properties.isTriggerNode){this.isDeleteConfirmShow=!1;return}const i=e.getSelectElements(!0);i.nodes.length===0&&i.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},Vte={class:"custom-line-popup"};function Hte(n,e,t,o,i,r){return ri((w(),R("div",Vte,[u("div",{class:"minus-circle-outlined",onClick:e[0]||(e[0]=Ct((...s)=>r.handleDelete&&r.handleDelete(...s),["stop"]))})],512)),[[Si,i.isDeleteConfirmShow]])}const Ute=Ne(Fte,[["render",Hte],["__scopeId","data-v-8519e918"]]);class zte extends $c{constructor(e){super(e),this.isMounted=!1,this.r=St(Ute,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=rr({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getEndArrow(){const{model:e}=this.props,{stroke:t,strokeWidth:o}=e.getArrowStyle();return et("path",{stroke:t,strokeWidth:o,d:"M -9 -7 0 0 -9 7",fill:"none"})}getText(){const{model:e}=this.props,{startPoint:t,endPoint:o,pointsList:i}=e,r=e.id,s=24,a=24,l=s/2,d=a/2,c=_=>{const{x:b,y:C}=t,{x:T,y:M}=i[1],{x:S,y:k}=i[2],{x:A,y:$}=o,B=_*_,O=B*_,P=1-_,E=P*P,D=E*P;return{x:b*D+3*T*E*_+3*S*P*B+A*O,y:C*D+3*M*E*_+3*k*P*B+$*O}},p=(_=5)=>{let b=0,C=c(0);for(let T=1;T<=_;T++){const M=T/_,S=c(M),k=S.x-C.x,A=S.y-C.y;b+=Math.sqrt(k*k+A*A),C=S}return b},f=_=>{const b=_/2;let C=0,T=1,M=.5,S=1e-4;for(;T-C>S;)M=(C+T)/2,k(M)<b?C=M:T=M;function k(A){let $=0,B=c(0);const O=5;for(let P=1;P<=O;P++){const E=P/O*A,D=c(E),N=D.x-B.x,F=D.y-B.y;$+=Math.sqrt(N*N+F*F),B=D}return $}return c(M)},h=p(),v=f(h),y={x:v.x-l,y:v.y-d,width:s,height:a},g={width:s,height:a};return setTimeout(()=>{var b,C;const _=(b=document.querySelector(`#line_${r}`))==null?void 0:b.querySelector(".vue-app-wrapper");!this.isMounted&&_?(this.isMounted=!0,this.app.mount(_)):(C=this.r)!=null&&C.component&&(this.r.component.props.isSelected=e.isSelected,this.r.component.props.isHovered=e.isHovered,this.r.component.props.properties=e.getProperties())},0),et("foreignObject",{...y,id:`line_${r}`},[et("div",{id:r,style:g,className:"vue-app-wrapper"})])}}class qte extends mc{initEdgeData(e){super.initEdgeData(e)}setAttributes(e){super.setAttributes(e);let t=this.getProperties().offset;t&&(this.offset=t,this.pointsList=[],this.initPoints())}createId(){return Ki("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#37e1ffff":e.stroke="#2475FC",e.strokeWidth=2,e}getArrowStyle(){return{...super.getArrowStyle(),...this.arrowStyle,refX:0,refY:0}}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(r=>r.id===this.sourceAnchorId),o=this.graphModel.getNodeModelById(this.targetNodeId),i=o==null?void 0:o.getDefaultAnchor().find(r=>r.id===this.targetAnchorId);if(t){const r={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(r)}if(i){const r={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(r)}this.pointsList=[],this.initPoints()}}const Gte={type:"custom-bezier-edge",view:zte,model:qte},Xte={name:"QuestionNode",components:{PopupMenu:Iu},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{type:"node",excludedNodeTypes:[],nodeListTabActive:1}},mounted(){this.getGraph().eventCenter.on("custom:showPopupMenu",this.onShowPopupMenu)},methods:{onShowPopupMenu(n){const{type:e,loop_parent_key:t}=n.model.properties;if(t){let o=["custom-group","batch-group","end-node","qa-node"];this.getGraph().getNodeModelById(t).type=="batch-group"&&o.push("terminate-node"),this.excludedNodeTypes=o}else this.excludedNodeTypes=["explain-node","terminate-node"]},handleAddNode(n){this.$emit("click-item",n)}}};function Wte(n,e,t,o,i,r){const s=Pt("PopupMenu");return w(),Q(s,{onAddNode:r.handleAddNode,type:i.type,excludedNodeTypes:i.excludedNodeTypes,active:i.nodeListTabActive,"onUpdate:active":e[0]||(e[0]=a=>i.nodeListTabActive=a)},null,8,["onAddNode","type","excludedNodeTypes","active"])}const Yte=Ne(Xte,[["render",Wte]]),Vv=444,Hv=620;class Jte{constructor({lf:e}){ci(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${Vv}px`,this.__menuDOM.style.height=`${Hv}px`,this.isMounted=!1,this.r=St(Yte,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:t,event:o})=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{node:t,event:o,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=rr({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:o,model:i})=>{this._activeData=i,this._activeAnchorData=o,this.createMenu()}),e.on("node:click",({data:o})=>{this.hideMenu()}),e.on("edge:click",({data:o})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,o=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,o])}showMenu(){const[e,t]=this.getContextMenuPosition(),o=this.lf.graphModel.height-64,i=this.lf.graphModel.width-64;this.__menuDOM.style.display="flex";const r=Math.min(525,o-20),s=Vv;let a=e+10;a+s>i&&(a=e-s-20),a<0&&(a=4),this.__menuDOM.style.left=`${a}px`;let l=t;t+r>o?l=t-(t+r-o)-10:l=t-10,l<0&&(l=4),this.__menuDOM.style.top=`${l}px`,this.__menuDOM.style.height=`${r>0?r:Hv}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class Am{constructor({lf:e}){ci(this,"handleHistoryKeyDown",e=>{if(this.isInputElement(e.target))return;const{ctrlKey:t,key:o,metaKey:i}=e,r=t||i;if(r&&o.toLowerCase()==="z"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.undo();return}if(r&&(o.toLowerCase()==="y"||o.toLowerCase()==="z"&&e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.redo();return}});this.lf=e,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const e=this.lf.getGraphData(),t=this.lf.getSelectElements(!0);let o=[...t.nodes,...t.edges].map(i=>i.id);return{nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),selectedElementIds:o||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(e="change"){if(this.isProcessing)return;const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const e=this.historyStack.pop();this.redoStack.push(e);const t=this.historyStack[this.historyStack.length-1];this.restoreState(t),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const e=this.redoStack.pop();this.historyStack.push(e),this.restoreState(e),this.notifyHistoryChange()}restoreState(e){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),e.nodes.forEach(t=>{t.width=t.properties.width,t.height=t.properties.height}),this.lf.graphModel.graphDataToModel({nodes:e.nodes||[],edges:e.edges||[]}),e.selectedElementIds&&e.selectedElementIds.length>0&&e.selectedElementIds.forEach(t=>{this.lf.selectElementById(t,!0)})}finally{this.isProcessing=!1}}isInputElement(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return!0;let o=e;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return!0;o=o.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(t=>{this.lf.on(t,()=>{this.saveCurrentState(t)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(e,t,o){this.maxHistorySize=o&&o.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(e){this.historyStack=[],this.redoStack=[];const t={nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(t),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(e){typeof e=="function"&&this.historyChangeCallbacks.push(e)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(e=>{try{const t=this.historyStack.map((r,s)=>({index:s,timestamp:r.timestamp,operation:r.operation,nodeCount:r.nodes?r.nodes.length:0,edgeCount:r.edges?r.edges.length:0,nodes:r.nodes||[],edges:r.edges||[],selectedElementIds:r.selectedElementIds||[]})),o=this.redoStack.map((r,s)=>({index:s,timestamp:r.timestamp,operation:r.operation,nodeCount:r.nodes?r.nodes.length:0,edgeCount:r.edges?r.edges.length:0,nodes:r.nodes||[],edges:r.edges||[],selectedElementIds:r.selectedElementIds||[]})),i=this.historyStack.length-1;e({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:t[i],historyDetails:t,redoDetails:o,currentHistoryIndex:i})}catch(t){console.error("History change callback error:",t)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(e="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(e="commit"){this.isProcessing=!1,this.saveCurrentState(e)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}ci(Am,"pluginName","canvasHistory");class Dm{constructor({lf:e}){ci(this,"wheelEventListener",e=>{if(e.shiftKey){e.preventDefault();const t=this.lf.getTransform();let o=t.SCALE_X,i=t.SCALE_Y;e.deltaY>0?this.lf.translate(-100*o,100*i):this.lf.translate(100*o,-100*i)}else if(e.ctrlKey){e.preventDefault();const{transformModel:t}=this.lf.graphModel,[o,i]=t.HtmlPointToCanvasPoint([e.clientX,e.clientY]),r=this.lf.getTransform();this.zoom=r.SCALE_X,e.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[o,i])}});ci(this,"keydownListener",e=>{var s;const t=(s=e==null?void 0:e.key)==null?void 0:s.toLowerCase(),{graphModel:{eventCenter:o}}=this.lf,i=e.target,r=i===document.body||this.lf.container.contains(i);if(e.ctrlKey){if(t==="c"){if(!r)return;let a=this.lf.getSelectElements(!0);if(a=JSON.parse(JSON.stringify(a)),a.nodes.length===0)return;a.edges=[];const l=a.nodes.filter(d=>d.type!=="start-node"&&d.type!=="custom-group"&&d.properties.isTriggerNode!=!0);if(l.length>0){this.basePointX=20,this.basePointY=20;let d={x:1/0,y:1/0};l.forEach(c=>{c.id="",c.nodeSortKey="",c.properties.id="",c.properties.next_node_key="",c.properties.nodeSortKey="",c.properties.node_key="",!c.width&&c.properties.width&&(c.width=c.properties.width),!c.height&&c.properties.height&&(c.height=c.properties.height),c.x<d.x&&(d.x=c.x),c.y<d.y&&(d.y=c.y)}),this.clipboard={nodes:l,basePoint:d}}else this.clipboard=null;return}if(t==="v"){if(!r||!this.clipboard||this.clipboard.nodes.length===0)return;if(this.clipboard&&this.clipboard.nodes.length>0){const a={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};o.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:a}),this.basePointX+=20,this.basePointY+=20}return}}if(t==="delete"&&r){o.emit("custom:keyoard:delete");return}e.ctrlKey&&!this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});ci(this,"keyupListener",e=>{!e.ctrlKey&&this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=e,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}ci(Dm,"pluginName","custom-keyboard");function Om(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],d="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,d=`【${c}】`;let p={label:s,value:d,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return p.children&&p.children.length>0&&(p.children=Om(p.children,p)),p})}class on extends ja{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=St(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=rr({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let o=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:o},t.model.width=i,t.model.height=o,t.model._width=i,t.model._height=o,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:o=>{t.model.properties.anchorList=o},setData:o=>{o.dataRaw=o.node_params,Tt(()=>{t.model.properties={...t.model.properties,...o};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model.height=i||o.height||t.model.properties.height,t.model._height=i||o.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:o=>{t.model.properties.node_name=o,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:o,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(v=>v.sourceAnchorId),i=t.map(v=>v.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,d=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=et("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:d,fill:"#fff",stroke:"#2475FC","stroke-width":2}),p=et("g",{className:"custom-anchor-arrow",transform:`translate(${s-d-2}, ${a-d-2})`},[et("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),et("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),f=et("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-d-2}, ${a-d-2})`},[et("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),et("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),et("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return et("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:v=>{v.stopPropagation();const{graphModel:y,model:g}=this.props;l==="right"&&!r&&y.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:g})}},c,p,f)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class rn extends Ba{createId(){return Ki(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(r=>r.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let o=JSON.parse(t.properties.node_params);return{sys_global:o.start.sys_global,diy_global:o.start.diy_global,all_global:[...o.start.sys_global,...o.start.diy_global]}}getAllParentVariable(){var l,d,c;const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(p=>p.type==="start-node");r&&(t.add(r.id),e.push(r));const s=p=>{var f;for(let h=0;h<p.length;h++){let y=p[h].sourceNode;if(!t.has(y.id)){if(t.add(y.id),fs.includes(y.type))if(y.type==="zm-plugins-node"){let g=Fo(y.properties.node_params);(Qw.includes(g.plugin.name)||(f=g.plugin)!=null&&f.output_obj.length)&&e.push(y)}else e.push(y);s(y.incoming.edges)}}};s(o);let a=[];if(this.properties.loop_parent_key){let p=i.find(f=>f.id==this.properties.loop_parent_key);p&&(e.filter(h=>h.id==this.properties.loop_parent_key).length>0||e.push(p))}for(const p of e){if(!fs.includes(p.type))continue;let f=JSON.parse(p.properties.node_params),h={label:p.properties.node_name,value:p.id,node_id:p.id,node_type:p.properties.node_type,typ:"node",children:[],loop_parent_key:p.properties.loop_parent_key};if(p.type==="http-node"&&(h.children=f.curl.output),p.type==="http-tool-node"&&(h.children=f.curl.output),p.type==="zm-workflow-node"&&(h.children=f.workflow.output),p.type==="voice-synthesis-node"&&(h.children=f.text_to_audio.output),p.type==="voice-clone-node"&&(h.children=f.voice_clone.output),p.type==="zm-plugins-node"&&(h.children=f.plugin.output||f.plugin.output_obj),p.type==="code-run-node"&&(h.children=f.code_run.output),p.type==="parameter-extraction-node"&&(h.children=f.params_extractor.output),p.type==="qa-node"&&(h.children=f.question.outputs),p.type==="start-node"&&(h.children=[...f.start.diy_global,...f.start.sys_global]),p.type==="custom-group"&&(this.properties.loop_parent_key==p.id?h.children=[...((l=f.loop)==null?void 0:l.intermediate_params)||[],...((d=f.loop)==null?void 0:d.loop_arrays)||[]]:h.children=f.loop.output),p.type==="batch-group"&&(this.properties.loop_parent_key==p.id?h.children=[...((c=f.batch)==null?void 0:c.batch_arrays)||[]]:h.children=f.batch.output),p.type==="import-library-node"&&(h.children=f.library_import.outputs),p.type==="json-node"&&(h.children=f.json_encode.output),p.type==="json-reverse-node"&&(h.children=f.json_decode.output),p.type==="select-data-node"&&(h.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),p.type==="knowledge-base-node"&&(h.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),p.type==="ai-dialogue-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),p.type==="specify-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),p.type==="immediately-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),p.type==="problem-optimization-node"&&(h.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),p.type==="mcp-node"&&(h.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),p.type==="image-generation-node"){let v=f.image_generation.image_num;if(v>0){let y=[];for(let g=0;g<+v;g++){let _=String.fromCharCode(97+g);y.push({key:`picture_url_${_}`,typ:"string",name:`picture_url_${_}`,label:`picture_url_${_}`})}h.children=y}}h.children=Array.isArray(h.children)?h.children:[],h.children.forEach(v=>{v.node_id=p.id,v.node_name=p.properties.node_name,v.node_type=p.properties.node_type}),h.children=Om(h.children,null),a.push(h)}return a}getTriggerNodes(){const{nodes:e}=this.graphModel;return e.filter(o=>o.properties.isTriggerNode)}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const $p="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",Kte={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[],node_header_bg_color:""}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.isShowMenu=!1,this.$emit("handleMenu",n)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){this.isShowMenu=!1;let n=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",n)},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(n.target)&&n.target!==this.$el.querySelector(".node-menu-btn")&&n.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImgUrl(){return xa(this.node_type)},updateTitle(n){this.setTitle(n)}}},Zte=["data-node-name","data-node-type"],Qte={class:"node-header-left"},ene={key:0,class:"node-icon"},tne=["src"],nne={class:"node-title"},one={key:0,class:"node-menu-wrapper"},ine={class:"node-menus"},rne=["onClick"],sne={class:"node-body"};function ane(n,e,t,o,i,r){return w(),R("div",{class:xt(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[u("div",{class:xt(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[u("div",{class:"node-header",style:Fn({background:t.properties.node_header_bg_color||"none"})},[u("div",Qte,[t.iconUrl||t.iconName?(w(),R("span",ene,[u("img",{src:t.iconUrl||r.getImgUrl(t.iconName),alt:""},null,8,tne)])):ne("",!0),u("span",nne,H(t.title),1)]),u("div",null,[t.hideMenus?ne("",!0):(w(),R("div",one,[u("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=Ct((...s)=>r.showMenu&&r.showMenu(...s),["stop"]))},[...e[2]||(e[2]=[u("img",{class:"btn-icon",src:$p,alt:""},null,-1)])]),ri(u("div",ine,[(w(!0),R(se,null,ge(r.allMenus,s=>(w(),R("div",{class:"node-menu",key:s.key,onClick:Ct(a=>r.handleMenu(s),["stop"])},H(s.name),9,rne))),128)),u("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=Ct(s=>r.handleDelete(n.item),["stop"]))},"删除")],512),[[Si,i.isShowMenu]])]))])],4),u("div",sne,[bi(n.$slots,"default",{},void 0,!0)])],2)],10,Zte)}const sn=Ne(Kte,[["render",ane],["__scopeId","data-v-9e6fff32"]]),lne={name:"StartNode",components:{NodeCommon:sn},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{outputs:[],show:!1}},computed:{options(){return[...this.outputs]}},watch:{properties:{handler(n,e){const t=n.node_params||"{}",o=e.node_params||"{}";t!=o&&this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.outputs=n.trigger.outputs,this.$nextTick(()=>{this.resetSize()})}}},une={class:"start-node"},dne={class:"start-node-options"},cne={class:"options-list"},pne={class:"option-label"},fne={class:"option-type"};function hne(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,"icon-url":t.properties.node_icon,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",une,[u("div",dne,[e[0]||(e[0]=u("div",{class:"options-title"},"输出",-1)),u("div",cne,[(w(!0),R(se,null,ge(r.options,a=>(w(),R("div",{class:xt(["options-item",{"is-required":a.required}]),key:a.key},[u("div",pne,H(a.key),1),u("div",fne,H(a.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}const vne=Ne(lne,[["render",hne],["__scopeId","data-v-b11bcdb2"]]);let _ne=class extends on{constructor(e){super(e),this.renderVue(vne,e)}},gne=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const mne={type:"session-trigger-node",model:gne,view:_ne},yne={name:"StartNode",components:{NodeCommon:sn},inject:["resetSize","setData","getGraph","getNode"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(n,e){const t=n.node_params||"{}",o=e.node_params||"{}";t!=o&&this.reset()},deep:!0}},mounted(){this.reset();const n=this.getGraph();n.eventCenter.on("custom:trigger-add",this.onTriggerAdd),n.eventCenter.on("custom:trigger-change",this.onTriggerChange)},beforeUnmount(){const n=this.getGraph();n.eventCenter.off("custom:trigger-change",this.onTriggerChange),n.eventCenter.off("custom:trigger-add",this.onTriggerAdd)},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.trigger_list=n.start.trigger_list,this.$nextTick(()=>{this.resetSize()})},update(){let n=JSON.parse(this.properties.node_params);n.start.sys_global=this.sys_global,n.start.diy_global=this.diy_global,n.start.trigger_list=this.trigger_list,this.setData({node_params:JSON.stringify(n)})},onTriggerAdd(n){const{trigger:e}=JSON.parse(n.properties.node_params);this.trigger_list.push(e);const{outputs:t}=e,o=new Map(this.diy_global.map((i,r)=>[i.key,{item:i,index:r}]));t&&Array.isArray(t)&&t.forEach(i=>{if(o.has(i.key)){const{index:r}=o.get(i.key);this.diy_global[r]=i}else this.diy_global.push(i)}),this.update()},onTriggerChange(n){const t=this.getNode().getTriggerNodes(),o=[];t.forEach(i=>{const s=JSON.parse(i.properties.node_params).trigger||null;s&&(s.trigger_name=i.properties.node_name,o.push(s))}),this.trigger_list=o,this.update()}}},bne={class:"start-node"},xne={class:"start-node-options"},wne={class:"options-list"},Cne={class:"option-label"},kne={class:"option-type"};function Sne(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:x(()=>[u("div",bne,[u("div",xne,[e[0]||(e[0]=u("div",{class:"options-title"},"输出",-1)),u("div",wne,[(w(!0),R(se,null,ge(r.options,a=>(w(),R("div",{class:xt(["options-item",{"is-required":a.required}]),key:a.key},[u("div",Cne,H(a.key),1),u("div",kne,H(a.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Ene=Ne(yne,[["render",Sne],["__scopeId","data-v-65229b4e"]]);let Ane=class extends on{constructor(e){super(e),this.renderVue(Ene,e)}},Dne=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(r,s,a,l)=>{if(r.id==s.id)return!1;const d=r.graphModel.edges.map(p=>p.sourceAnchorId),c=a.id;return a.type==="right"&&!d.includes(c)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(r,s,a,l)=>r.properties.loop_parent_key?r.properties.loop_parent_key===s.properties.loop_parent_key:!s.properties.loop_parent_key};this.sourceRules=[e,t];const o=["session-trigger-node"],i={message:"只允许连接左边的锚点",validate:(r,s,a,l)=>r.id==s.id?!1:l.type==="left"||o.includes(r.type)};this.targetRules=[i]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+25,id:l+"-anchor_left",type:"anchor_left",isHovered:s,isSelected:a,nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const One={type:"start-node",model:Dne,view:Ane},tl={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(n){const e=n,t=__(),{allModelList:o}=Va(t);let i=g_(o.value).newList;const r=X(""),s=()=>{if(!e.useModel){r.value="";return}for(const a of i)if(a.children){for(const l of a.children)if(e.useModel==l.name&&e.modelConfigId==a.id){r.value=l.show_model_name||l.deployment_name||l.name;return}}};return ct(()=>[e.useModel,e.modelConfigId],()=>{s()},{immediate:!0}),(a,l)=>(w(),R("span",null,H(r.value),1))}},hr={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(n,{expose:e}){const t=n,o=Ve("getNode"),i=X([]),r=X("");function s(){let p=o().getAllParentVariable();i.value=a(p)}function a(p){return p.forEach(f=>{f.typ=="node"?f.node_type==1?f.value="global":f.value=f.node_id:f.value=f.key,f.children&&f.children.length>0&&(f.children=a(f.children))}),p}const l=(p,f)=>{for(const h of p){if(h.value===f)return h.label;if(h.children&&h.children.length>0){const v=l(h.children,f);if(v)return v}}return null},d=()=>{if(!t.value||t.value.length===0)return"";s();let p=[];t.value.forEach(f=>{const h=l(i.value,f);h&&p.push(h)}),r.value=p.join("/")},c=()=>{d()};return ct(()=>t.value,()=>{d()},{immediate:!0}),e({refresh:c}),(p,f)=>(w(),R("span",null,H(r.value),1))}},Nne={class:"ai-dialogue-node"},Mne={class:"field-list"},Tne={class:"field-item"},$ne={class:"field-item-content"},Rne={class:"field-value"},Pne={class:"field-key"},Lne={class:"field-item"},Bne={class:"field-item-content"},Ine={class:"field-value"},jne={class:"field-key"},Fne={class:"field-item"},Vne={class:"field-item-content"},Hne={class:"category-list"},Une={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("resetSize"),i=Vn(),{modelList:r}=Va(i),s=X([]),a=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[]});function l(p){if(p&&typeof p=="string"){let f=p.split("."),h=f[0],v=f.filter((y,g)=>g>0).join(".");return[h,v]}else if(p&&typeof p=="object"&&p.length===2)return p;return["global","question"]}const d=()=>{const p=e.properties.dataRaw||e.properties.node_params||"{}";let f={};try{f=JSON.parse(p).cate||{}}catch{f={}}f=JSON.parse(JSON.stringify(f));for(let h in f)if(h==="question_value")a.question_value=l(f.question_value);else if(h=="categorys")if(f.categorys&&f.categorys.length>0){let v=f.categorys.map(y=>({...y}));a[h]=v}else a[h]=[{category:"",next_node_key:"",key:Ht(16)}];else a[h]=f[h];!a.model_config_id&&r.value.length>0&&(a.model_config_id=r.value[0].id,a.use_model=r.value[0].children[0].name),Tt(()=>{o()})},c=()=>{const p=a.model_config_id?+a.model_config_id:a.model_config_id,f=JSON.stringify({cate:{...a,question_value:a.question_value.join("."),model_config_id:p}});t({...e.node,...a,node_params:f})};return ct(()=>e.properties,(p,f)=>{const h=p.dataRaw||p.node_params||"{}",v=f.dataRaw||f.node_params||"{}";h!=v&&d()},{deep:!0}),at(()=>{d(),o(),c()}),Wn(()=>{}),(p,f)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Nne,[u("div",Mne,[u("div",Tne,[f[0]||(f[0]=u("div",{class:"field-item-label"},"用户问题",-1)),u("div",$ne,[u("div",Rne,[u("span",Pne,[m(hr,{ref:"questionTextRef",value:a.question_value},null,8,["value"])])])])]),u("div",Lne,[f[1]||(f[1]=u("div",{class:"field-item-label"},"LLM模型",-1)),u("div",Bne,[u("div",Ine,[u("span",jne,[m(tl,{useModel:a.use_model,modelConfigId:a.model_config_id},null,8,["useModel","modelConfigId"])])])])]),u("div",Fne,[f[3]||(f[3]=u("div",{class:"field-item-label"},"问题分类",-1)),u("div",Vne,[u("div",Hne,[(w(!0),R(se,null,ge(a.categorys,h=>(w(),R("div",{class:"field-value category-value",key:h.key},[u("span",null,H(h.category),1)]))),128)),f[2]||(f[2]=u("div",{class:"field-value category-value"},[u("span",null,"默认分类")],-1))])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zne=Ne(Une,[["__scopeId","data-v-ee162e6d"]]);let qne=class extends on{constructor(e){super(e),this.renderVue(zne,e)}},Gne=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getAnchorPos(){return eC(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let d=[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}],c=this.getAnchorPos(),p=o-r/2;for(let f=0;f<c.length;f++)d.push({id:c[f].id,x:t+i/2,y:p+132+f*32,type:"right",nodeId:e});return d.push({id:l+"-anchor_right",x:t+i/2,y:r/2+o-28,type:"right",nodeId:e}),d}};const Xne={type:"question-node",model:Gne,view:qne},Wne={name:"QuestionNode",components:{NodeCommon:sn},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},Yne={class:"question-node"},Jne={class:"node-desc"};function Kne(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[u("div",Yne,[u("div",Jne,H(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const Zne=Ne(Wne,[["render",Kne],["__scopeId","data-v-8a22228d"]]);let Qne=class extends on{constructor(e){super(e),this.renderVue(Zne,e)}},eoe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let d=[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&d.push({x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}),d}};const toe={type:"action-node",model:eoe,view:Qne},Nm=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...Nm(t.children)):e.push(t)}),e},noe={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open","resize"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(o=>{let i="";this.type==="textarea"?o.nodeName==="BR"?i=`
`:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:i=o.textContent:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:o.nodeName==="BR"?i="":i=o.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let o={};this.selectedList.forEach(r=>{!o[r.value]&&t.indexOf(r.value)!==-1&&(o[r.value]=r)});let i=Object.values(o);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],o=Nm(this.options),i=[...t,...o].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const r=new Set;i.forEach(s=>{const a=new RegExp(`(${s.value})`,"g");if(a.test(this.defaultValue)&&!r.has(s.value)){let l=s.node_name+"."+s.text;l=l.replace(/\./g,"/"),e=e.replace(a,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${l}</span>`),r.add(s.value),this.selectOption(s,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue,this.$nextTick(()=>{this.$emit("resize")})},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),o=t.startOffset,i=t.startContainer;let r="";if(i.nodeType===Node.TEXT_NODE)r=i.textContent.slice(0,o);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?r+=l.textContent.slice(0,o):r+=l.textContent)}}return r.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,o=e.startContainer;let i="";if(o.nodeType===Node.TEXT_NODE)i=o.textContent.slice(0,t);else if(o.nodeType===Node.ELEMENT_NODE){const s=o.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?i+=l.textContent.slice(0,t):i+=l.textContent)}}const r=i.lastIndexOf("/");return r===-1?"":i.slice(r+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),o=await this.getDropdownListSize();let i=t.bottom,r=t.left;const s=window.innerWidth,a=window.innerHeight;return r+o.width>s&&(r=s-o.width),i+o.height>a&&(i=t.top-o.height),{top:i,left:r,x:r,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let o=t.dataset.value;const i=this.options.find(r=>r.value==o);this.selectedList.push(i),this.selectedIdSet.add(o)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.onChange()},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const r=i.getRangeAt(0),s=r.startOffset,a=r.startContainer;let l=s-t,d=a;if(l<0){let c=a.previousSibling;for(;c;){if(c.nodeType===Node.TEXT_NODE){l=c.textContent.length-t,d=c;break}c=c.previousSibling}}if(d.nodeType===Node.TEXT_NODE){d.replaceData(l,t," ");const c=document.createElement("span");c.contentEditable="false",c.classList.add("j-mention-at"),c.style=this.atTextStyle,c.textContent=`${n}`;for(const h in e)c.dataset[h]=e[h];const p=document.createRange();p.setStart(d,l),p.insertNode(c);let f=c.nextSibling;r.setStart(f,1),r.setEnd(f,1),i.removeAllRanges(),i.addRange(r)}},onSelectOption(n,e,t){let o=t[t.length-1];delete o.children,this.selectOption(o)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1,this.showAtList=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const o={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,o),this.initShowOptionList(),this.updateValue())}}};function ooe(n,e,t,o,i,r){return w(),R("span",{ref:"JMention",class:xt(["j-mention",["type-"+t.type]])},null,2)}const vn=Ne(noe,[["render",ooe]]),ioe={class:"ai-dialogue-node"},roe={class:"field-list"},soe={class:"field-item"},aoe={class:"field-item-content"},loe={class:"field-list-item"},uoe={class:"field-text"},doe={key:1},coe={class:"field-item"},poe={class:"field-item-content"},foe={class:"field-value"},hoe={class:"field-key"},voe={key:0,class:"field-item menu-list-box"},_oe={class:"field-text"},goe={key:1},moe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=X([]),l=Je({answer_text:"",answer_type:"text",reply_content_list:[],menu_content:[{menu_type:"1",serial_no:"1",content:""},{menu_type:"1",serial_no:"2",content:""}],outputs:[{key:"question",typ:"string",subs:[]},{key:"question_multiple",typ:"array<object>",subs:[]}]}),d=()=>{o(),i();let v=e.properties.nodeSortKey,y=o().edges;if(l.answer_type=="text")l.menu_content.forEach((g,_)=>{let b=v+"-anchor_"+_,C=y.find(T=>T.sourceAnchorId==b);C&&o().eventCenter.emit("custom:edge:delete",C)});else{let g=v+"-anchor_right",_=y.find(b=>b.sourceAnchorId==g);_&&o().eventCenter.emit("custom:edge:delete",_)}};ct(()=>l.answer_type,v=>{d()});const c=()=>{var _;h();const v=e.properties.dataRaw||e.properties.node_params||"{}";let y=JSON.parse(v).question||{};y=JSON.parse(JSON.stringify(y)),l.answer_text=y.answer_text||"",l.answer_type=y.answer_type||"text",l.reply_content_list=y.reply_content_list||[];let g=y.reply_content_list||[];if(g.length>0){let b=((_=g[0].smart_menu)==null?void 0:_.menu_content)||[];b.length>0&&(l.menu_content=b)}Tt(()=>{r()})},p=()=>{const v=JSON.stringify({question:{...l}});t({...e.node,node_params:v})},f=v=>{p()},h=()=>{let v=i().getAllParentVariable();a.value=v||[]};return ct(()=>e.properties,c,{deep:!0}),at(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",f)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",f)}),(v,y)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",ioe,[u("div",roe,[u("div",soe,[u("div",{class:"field-item-label",onClick:d},"提问内容"),u("div",aoe,[u("div",loe,[u("div",uoe,[l.answer_text.length>0?(w(),Q(vn,{key:0,options:a.value,defaultValue:l.answer_text,ref:"atInputRef"},null,8,["options","defaultValue"])):(w(),R("span",doe,"--"))])])])]),u("div",coe,[y[0]||(y[0]=u("div",{class:"field-item-label"},"回答方式",-1)),u("div",poe,[u("div",foe,[u("span",hoe,H(l.answer_type=="text"?"直接回答":"智能菜单回答"),1)])])]),l.answer_type=="menu"?(w(),R("div",voe,[(w(!0),R(se,null,ge(l.menu_content,(g,_)=>(w(),R("div",{class:"menu-list-item",key:_},[u("div",_oe,[g.content.length>0?(w(),Q(vn,{key:0,options:a.value,defaultValue:g.content,ref_for:!0,ref:"atInputRef"},null,8,["options","defaultValue"])):(w(),R("span",goe,"--"))])]))),128))])):ne("",!0)])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},yoe=Ne(moe,[["__scopeId","data-v-997c8a34"]]);let boe=class extends on{constructor(e){super(e),this.renderVue(yoe,e)}},xoe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){var c;const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let d={};try{d=JSON.parse(this.properties.dataRaw).question}catch{}if(d.answer_type=="menu"){let p=[];if(d.reply_content_list&&d.reply_content_list.length>0){let f=((c=d.reply_content_list[0].smart_menu)==null?void 0:c.menu_content)||[],h=o-r/2;f.forEach((v,y)=>{p.push({id:l+"-anchor_"+y,x:t+i/2,y:h+132+y*32,type:"right",nodeId:e})})}return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},...p]}else return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const woe={type:"qa-node",model:xoe,view:boe},Coe={class:"ai-dialogue-node"},koe={class:"field-list"},Soe={class:"field-item"},Eoe={class:"field-item-content"},Aoe={class:"field-value"},Doe={class:"field-item"},Ooe={class:"field-item-content"},Noe={class:"field-value"},Moe={class:"field-key"},Toe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=Vn(),{modelList:a}=Va(s),l=X(null),d=X([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),p=X([]);function f(_){if(_){let b=_.split("."),C=b[0],T=b.filter((M,S)=>S>0).join(".");return[C,T]}return["global","question"]}const h=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(_).llm||{}}catch{b={}}y();const{model_config_id:C,use_model:T,context_pair:M,temperature:S,max_token:k,prompt:A,prompt_tags:$,question_value:B,enable_thinking:O,libs_node_key:P}=JSON.parse(JSON.stringify(b));c.model_config_id=C,c.use_model=T,c.context_pair=M||0,c.temperature=S,c.max_token=k,c.prompt=A,c.enable_thinking=O,c.prompt_tags=$||[],c.libs_node_key=P,c.question_value=f(B),!c.model_config_id&&a.value.length>0&&(c.model_config_id=a.value[0].id,c.use_model=a.value[0].children[0].name),Tt(()=>{r()})},v=()=>{const _=JSON.stringify({llm:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t({...e.node,...c,node_params:_})},y=()=>{let _=i().getAllParentVariable();p.value=_},g=_=>{y(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(b=>{if(b.node_id==_.node_id){let C=b.label.split("/");C[0]=_.node_name,b.label=C.join("/"),b.node_name=_.node_name}}),v(),l.value.refresh()};return ct(()=>e.properties,h,{deep:!0}),at(()=>{h(),r(),o().eventCenter.on("custom:setNodeName",g)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",g)}),(_,b)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Coe,[u("div",koe,[u("div",Soe,[b[0]||(b[0]=u("div",{class:"field-item-label"},"用户问题",-1)),u("div",Eoe,[u("div",Aoe,[m(hr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),u("div",Doe,[b[1]||(b[1]=u("div",{class:"field-item-label"},"LLM模型",-1)),u("div",Ooe,[u("div",Noe,[u("span",Moe,[m(tl,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])])]),b[2]||(b[2]=u("div",{class:"field-item"},[u("div",{class:"field-item-label"},"输出"),u("div",{class:"field-item-content"},[u("div",{class:"field-value is-required"},[u("span",{class:"field-key"},"AI回复内容"),u("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},$oe=Ne(Toe,[["__scopeId","data-v-8011e2e3"]]);let Roe=class extends on{constructor(e){super(e),this.renderVue($oe,e)}},Poe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Loe={type:"ai-dialogue-node",model:Poe,view:Roe},Boe={class:"ai-dialogue-node"},Ioe={class:"field-list"},joe={class:"field-item"},Foe={class:"field-item-content"},Voe={class:"field-value"},Hoe={class:"field-key"},Uoe={class:"field-type"},zoe={class:"field-item"},qoe={class:"field-item-content"},Goe={class:"field-text"},Xoe={class:"right-arrow"},Woe={class:"field-text2"},Yoe={class:"field-item"},Joe={class:"field-item-content"},Koe={class:"field-text"},Zoe={class:"right-arrow"},Qoe={class:"field-text2"},eie={key:0,class:"field-item"},tie={class:"field-item-content"},nie={class:"field-text"},oie={class:"right-arrow"},iie={class:"field-text2"},rie={key:1,class:"field-item"},sie={class:"field-item-content"},aie={class:"field-list-item"},lie={class:"field-item"},uie={class:"field-item-content"},die={class:"field-key"},cie={class:"field-type"},pie={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[]});function l(y){return y.forEach(g=>{g.cu_key=Math.random()*1e4,g.subs&&g.subs.length?l(g.subs):g.subs=[]}),y}const d=X([]),c=()=>{const y=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(y).curl||{}}catch{g={}}f(),g=JSON.parse(JSON.stringify(g));for(let _ in g){if(_=="headers"||_=="params"||_=="body"){g[_]&&g[_].length>0?a[_]=g[_].map(b=>({...b,cu_key:Math.random()*1e4})):a[_]=[];continue}if(_=="output"){a.output=l(g[_]);continue}a[_]=g[_]}Tt(()=>{r()})},p=()=>{const y=JSON.stringify({curl:{...a}});t({...e.node,...a,node_params:y})},f=()=>{let y=i().getAllParentVariable();y.forEach(g=>{g.tags=g.tags||[]}),d.value=y},h=y=>{vo.includes(y.node_type)&&(f(),Tt(()=>{a.body_raw_tags&&a.body_raw_tags.length>0&&a.body_raw_tags.forEach(_=>{if(_.node_id==y.node_id){let b=_.label.split("/");b[0]=y.node_name,_.label=b.join("/"),_.node_name=y.node_name}}),["headers","params","body"].forEach(_=>{a[_].forEach(C=>{C.tags&&C.tags.length>0&&C.tags.forEach(T=>{if(T.node_id==y.node_id){let M=T.label.split("/");M[0]=y.node_name,T.label=M.join("/"),T.node_name=y.node_name}})})}),p()}))},v=()=>{};return ct(()=>e.properties,c,{deep:!0}),at(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",h)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",h)}),(y,g)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:v},{default:x(()=>[u("div",Boe,[u("div",Ioe,[u("div",joe,[g[0]||(g[0]=u("div",{class:"field-item-label"},"请求地址",-1)),u("div",Foe,[u("div",Voe,[u("span",Hoe,H(a.method),1),u("span",Uoe,H(a.rawurl),1)])])]),u("div",zoe,[g[1]||(g[1]=u("div",{class:"field-item-label"},"HEADERS",-1)),u("div",qoe,[(w(!0),R(se,null,ge(a.headers,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",Goe,H(_.key),1),u("div",Xoe,[m(K(tr))]),u("div",Woe,[m(vn,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),u("div",Yoe,[g[2]||(g[2]=u("div",{class:"field-item-label"},"PARAMS",-1)),u("div",Joe,[(w(!0),R(se,null,ge(a.params,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",Koe,H(_.key),1),u("div",Zoe,[m(K(tr))]),u("div",Qoe,[m(vn,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),a.type==1?(w(),R("div",eie,[g[3]||(g[3]=u("div",{class:"field-item-label"},"BODY",-1)),u("div",tie,[(w(!0),R(se,null,ge(a.body,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",nie,H(_.key),1),u("div",oie,[m(K(tr))]),u("div",iie,[m(vn,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):ne("",!0),a.type==2?(w(),R("div",rie,[g[4]||(g[4]=u("div",{class:"field-item-label"},"BODY",-1)),u("div",sie,[u("div",aie,H(a.body_raw),1)])])):ne("",!0),u("div",lie,[g[5]||(g[5]=u("div",{class:"field-item-label"},"输出字段",-1)),u("div",uie,[(w(!0),R(se,null,ge(a.output,_=>(w(),R("div",{class:"field-value",key:_.cu_key},[u("span",die,H(_.key),1),u("span",cie,H(_.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},fie=Ne(pie,[["__scopeId","data-v-75591691"]]);let hie=class extends on{constructor(e){super(e),this.renderVue(fie,e)}},vie=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+26,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+26,id:l+"-anchor_right",type:"right",nodeId:e}]}};const _ie={type:"http-node",model:vie,view:hie},gie={class:"ai-dialogue-node"},mie={class:"field-list"},yie={class:"field-item"},bie={class:"field-item-content"},xie={class:"field-value"},wie={class:"field-key"},Cie={class:"field-type"},kie={class:"field-item"},Sie={class:"field-item-content"},Eie={class:"field-text"},Aie={class:"right-arrow"},Die={class:"field-text2"},Oie={class:"field-item"},Nie={class:"field-item-content"},Mie={class:"field-text"},Tie={class:"right-arrow"},$ie={class:"field-text2"},Rie={key:0,class:"field-item"},Pie={class:"field-item-content"},Lie={class:"field-text"},Bie={class:"right-arrow"},Iie={class:"field-text2"},jie={key:1,class:"field-item"},Fie={class:"field-item-content"},Vie={class:"field-list-item"},Hie={class:"field-item"},Uie={class:"field-item-content"},zie={class:"field-key"},qie={class:"field-type"},Gie={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function l(y){return y.forEach(g=>{g.cu_key=Math.random()*1e4,g.subs&&g.subs.length?l(g.subs):g.subs=[]}),y}const d=X([]),c=()=>{const y=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(y).curl||{}}catch{g={}}f(),g=JSON.parse(JSON.stringify(g));for(let _ in g){if(_=="headers"||_=="params"||_=="body"){g[_]&&g[_].length>0?a[_]=g[_].map(b=>({...b,cu_key:Math.random()*1e4})):a[_]=[];continue}if(_=="output"){a.output=l(g[_]);continue}a[_]=g[_]}Tt(()=>{r()})},p=()=>{const y=JSON.stringify({curl:{...a}});t({...e.node,...a,node_params:y})},f=()=>{let y=i().getAllParentVariable();y.forEach(g=>{g.tags=g.tags||[]}),d.value=y},h=y=>{vo.includes(y.node_type)&&(f(),Tt(()=>{a.body_raw_tags&&a.body_raw_tags.length>0&&a.body_raw_tags.forEach(_=>{if(_.node_id==y.node_id){let b=_.label.split("/");b[0]=y.node_name,_.label=b.join("/"),_.node_name=y.node_name}}),["headers","params","body"].forEach(_=>{a[_].forEach(C=>{C.tags&&C.tags.length>0&&C.tags.forEach(T=>{if(T.node_id==y.node_id){let M=T.label.split("/");M[0]=y.node_name,T.label=M.join("/"),T.node_name=y.node_name}})})}),p()}))},v=()=>{};return ct(()=>e.properties,c,{deep:!0}),at(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",h)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",h)}),(y,g)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-url":e.properties.node_icon,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:v},{default:x(()=>[u("div",gie,[u("div",mie,[u("div",yie,[g[0]||(g[0]=u("div",{class:"field-item-label"},"请求地址",-1)),u("div",bie,[u("div",xie,[u("span",wie,H(a.method),1),u("span",Cie,H(a.rawurl),1)])])]),u("div",kie,[g[1]||(g[1]=u("div",{class:"field-item-label"},"HEADERS",-1)),u("div",Sie,[(w(!0),R(se,null,ge(a.headers,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",Eie,H(_.key),1),u("div",Aie,[m(K(tr))]),u("div",Die,[m(vn,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),u("div",Oie,[g[2]||(g[2]=u("div",{class:"field-item-label"},"PARAMS",-1)),u("div",Nie,[(w(!0),R(se,null,ge(a.params,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",Mie,H(_.key),1),u("div",Tie,[m(K(tr))]),u("div",$ie,[m(vn,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),a.type==1?(w(),R("div",Rie,[g[3]||(g[3]=u("div",{class:"field-item-label"},"BODY",-1)),u("div",Pie,[(w(!0),R(se,null,ge(a.body,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",Lie,H(_.key),1),u("div",Bie,[m(K(tr))]),u("div",Iie,[m(vn,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):ne("",!0),a.type==2?(w(),R("div",jie,[g[4]||(g[4]=u("div",{class:"field-item-label"},"BODY",-1)),u("div",Fie,[u("div",Vie,H(a.body_raw),1)])])):ne("",!0),u("div",Hie,[g[5]||(g[5]=u("div",{class:"field-item-label"},"输出字段",-1)),u("div",Uie,[(w(!0),R(se,null,ge(a.output,_=>(w(),R("div",{class:"field-value",key:_.cu_key},[u("span",zie,H(_.key),1),u("span",qie,H(_.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-url","isSelected","isHovered","node-key","node_type"]))}},Xie=Ne(Gie,[["__scopeId","data-v-132ccf74"]]);let Wie=class extends on{constructor(e){super(e),this.renderVue(Xie,e)}},Yie=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+26,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+26,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Jie={type:"http-tool-node",model:Yie,view:Wie},Kie={class:"ai-dialogue-node"},Zie={class:"field-list"},Qie={class:"field-item"},ere={class:"field-item-content"},tre={class:"field-value"},nre={class:"field-item"},ore={class:"field-item-content"},ire={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Vn(),t=We(()=>e.robotInfo.rrf_weight),o=n,i=Ve("setData"),r=Ve("getGraph"),s=Ve("getNode"),a=Ve("resetSize"),l=X(null),d=X([]),c=Je({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[],rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),p=X([]);function f(T){if(T){let M=T.split("."),S=M[0],k=M.filter((A,$)=>$>0).join(".");return[S,k]}return["global","question"]}const h=()=>{const T=o.properties.dataRaw||o.properties.node_params||"{}";let M={};try{M=JSON.parse(T).libs||{}}catch{M={}}b(),M=JSON.parse(JSON.stringify(M));for(let S in M)S=="library_ids"?c[S]=M[S]?M[S].split(","):[]:S=="question_value"?c.question_value=f(M.question_value):S=="rrf_weight"?c.rrf_weight=M[S]?JSON.parse(M[S]):M[S]:c[S]=M[S];(!c.rrf_weight||Object.keys(c.rrf_weight).length==0)&&(c.rrf_weight=t.value),Tt(()=>{a()})},v=()=>{const T=JSON.stringify({libs:{...c,rerank_model_config_id:c.rerank_model_config_id?+c.rerank_model_config_id:void 0,question_value:c.question_value.join("."),library_ids:c.library_ids.join(","),rrf_weight:JSON.stringify(c.rrf_weight),recall_neighbor_switch:c.recall_neighbor_switch,recall_neighbor_before_num:c.recall_neighbor_before_num,recall_neighbor_after_num:c.recall_neighbor_before_num}});i({...o.node,node_params:T})},y=X([]),g=We(()=>y.value.filter(T=>c.library_ids.includes(T.id))),_=async()=>{const T=await Ha({type:""});T&&(y.value=T.data||[],Tt(()=>{a()}))},b=()=>{let T=s().getAllParentVariable();p.value=T},C=()=>{b(),v(),l.value.refresh()};return ct(()=>o.properties,h,{deep:!0}),at(()=>{_(),h(),r().eventCenter.on("custom:setNodeName",C)}),Wn(()=>{r().eventCenter.off("custom:setNodeName",C)}),(T,M)=>(w(),Q(sn,{properties:n.properties,title:o.properties.node_name,menus:d.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Kie,[u("div",Zie,[u("div",Qie,[M[0]||(M[0]=u("div",{class:"field-item-label"},"用户问题",-1)),u("div",ere,[u("div",tre,[m(hr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),M[2]||(M[2]=u("div",{class:"field-item"},[u("div",{class:"field-item-label"},"输出字段"),u("div",{class:"field-item-content"},[u("div",{class:"field-value is-required"},[u("span",{class:"field-key"},"知识库引用"),u("span",{class:"field-type"},"string")])])],-1)),u("div",nre,[M[1]||(M[1]=u("div",{class:"field-item-label"},"知识库",-1)),u("div",ore,[(w(!0),R(se,null,ge(g.value,S=>(w(),R("div",{class:"library-item",key:S.id},H(S.library_name),1))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},rre=Ne(ire,[["__scopeId","data-v-87b15d8d"]]);let sre=class extends on{constructor(e){super(e),this.renderVue(rre,e)}},are=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const lre={type:"knowledge-base-node",model:are,view:sre},ure={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:sn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function dre(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:r.handleMenu,style:{width:"420px",height:"94px"}},{default:x(()=>[...e[0]||(e[0]=[u("div",{class:"end-node"},[u("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const cre=Ne(ure,[["render",dre],["__scopeId","data-v-5d6d3499"]]);let pre=class extends on{constructor(e){super(e),this.renderVue(cre,e)}},fre=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}]}};const hre={type:"end-node",model:fre,view:pre},vre={class:"explain-node"},_re={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Ve("resetSize"),t=n;ct(()=>t.properties,(r,s)=>{const a=r.node_params||"{}",l=s.node_params||"{}";a!=l&&i()},{deep:!0});const o=Je({content:""}),i=()=>{if(!t.properties||!t.properties.node_params)return;let r=JSON.parse(t.properties.node_params);Object.assign(o,r),Tt(()=>{e()})};return at(()=>{i()}),(r,s)=>{const a=Vi;return w(),Q(sn,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",vre,[m(a,{"auto-size":"",bordered:!1,class:"explain-textarea",value:o.content,"onUpdate:value":s[0]||(s[0]=l=>o.content=l),placeholder:""},null,8,["value"])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}}};let gre=class extends on{constructor(e){super(e),this.renderVue(_re,e)}},mre=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[]}};const yre={type:"explain-node",model:mre,view:gre},bre={class:"ai-dialogue-node"},xre={class:"field-list"},wre={class:"field-item"},Cre={class:"field-item-content"},kre={class:"field-text"},Sre={class:"right-arrow"},Ere={class:"field-text"},Are={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=Je({list:[]}),l=X([]),d=()=>{const v=e.properties.dataRaw||e.properties.node_params||"{}";let y=[];try{y=JSON.parse(v).assign||[]}catch(g){}f(),y.forEach(g=>{g.tags=g.tags||[]}),a.list=y,Tt(()=>{c()})},c=()=>{let v=JSON.parse(e.properties.node_params);v.assign=[...a.list],t({...e.node,node_params:JSON.stringify(v)})};function p(v){return v?v.split(".")[1]:""}const f=()=>{let v=i().getAllParentVariable();v.forEach(y=>{y.tags=y.tags||[]}),l.value=v},h=v=>{vo.includes(v.node_type)&&(f(),Tt(()=>{a.list.forEach(y=>{y.tags&&y.tags.length>0&&y.tags.forEach(g=>{if(g.node_id==v.node_id){let _=g.label.split("/");_[0]=v.node_name,g.label=_.join("/"),g.node_name=v.node_name}})}),c()}))};return ct(()=>e.properties,d,{deep:!0}),at(()=>{d(),r(),o().eventCenter.on("custom:setNodeName",h)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",h)}),(v,y)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",bre,[u("div",xre,[u("div",wre,[y[0]||(y[0]=u("div",{class:"field-item-label"},"变量",-1)),u("div",Cre,[(w(!0),R(se,null,ge(a.list,(g,_)=>(w(),R("div",{class:"field-list-item",key:_},[u("div",kre,[m(vn,{options:l.value,"default-value":g.value,defaultSelectedList:g.tags},null,8,["options","default-value","defaultSelectedList"])]),u("div",Sre,[m(K(tr))]),u("div",Ere,H(p(g.variable)),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Dre=Ne(Are,[["__scopeId","data-v-d3d3de5a"]]);let Ore=class extends on{constructor(e){super(e),this.renderVue(Dre,e)}},Nre=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Mre={type:"variable-assignment-node",model:Nre,view:Ore},Tre={class:"judge-node"},$re={class:"if-box-label"},Rre={class:"if-box-content"},Pre={class:"condition-box"},Lre={key:0,class:"condition-left-box"},Bre={class:"connection-text"},Ire={key:1,class:"condition-line"},jre={class:"condition-body"},Fre={class:"field-items"},Vre={class:"field-name"},Hre={class:"field-rule"},Ure={class:"field-value"},zre={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("resetSize"),o=Ve("getNode"),i=Ve("updateAnchorList"),r=Je({term:[]}),s=X([]),a=X([]);function l(){let _=o().getAllParentVariable();s.value=d(_)}function d(_){return _.forEach(b=>{b.typ=="node"?b.node_type==1?b.value="global":b.value=b.node_id:b.value=b.key,b.children&&b.children.length>0&&(b.children=d(b.children))}),_}let c=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],p=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function f(_){let b="";if(_.variable&&_.variable.length>0){let C=s.value.filter(T=>T.key==_.variable[0]);C&&C.length&&(b=C[0].typ),b=="object"&&(C[0]&&C[0].children&&(C=C[0].subs.filter(T=>T.key==_.variable[1])),C&&C.length&&(b=C[0].typ),b=="object"&&(C[0]&&C[0].children&&(C=C[0].subs.filter(T=>T.key==_.variable[2])),C&&C.length&&(b=C[0].typ)))}return b}function h(_){if(!_.variable)return[];let b=f(_);return b==""?_.is_mult?p:c:b=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:b.includes("array")?p:c}const v=_=>{let b=h(_),C=b.findIndex(T=>T.value==_.type);return b[C].label},y=()=>{try{let _=JSON.parse(e.properties.node_params).term||[];_=_.map(b=>{let C=b.terms.map(T=>{let M="";for(let S=0;S<Lo.length;S++)if(T.variable.indexOf(Lo[S])>-1){M=Lo[S];break}if(M!=""){let S=T.variable.split(".");T.variable=[S[0],M]}else T.variable=T.variable.split(".");return{...T,type:T.type>0?T.type:1,key:Math.random()*1e4}});return{...b,is_or:b.is_or?1:0,terms:C,key:Math.random()*1e4}}),r.term=_,Tt(()=>{t(),g()})}catch(_){}},g=()=>{const _=e.properties.nodeSortKey;let b=[],C=56;for(let T=0;T<r.term.length;T++){let M=r.term[T];if(M){let S=0,k=C,A=8,$=2,B=24,O=M.terms.length;S=O*B+A*2+$*(O-1),T>0&&T<r.term.length&&(k+=8),C=k+S,b.push({id:_+"-anchor_"+T,offsetHeight:S,offsetTop:k})}}b.length>0&&b.push({id:_+"-anchor_right",offsetHeight:24,offsetTop:C+8}),i(b)};return ct(()=>e.properties.node_params,(_,b)=>{_!=b&&y()},{deep:!0}),at(()=>{l(),y()}),(_,b)=>(w(),Q(sn,{properties:n.properties,title:n.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Tre,[(w(!0),R(se,null,ge(r.term,(C,T)=>(w(),R("div",{class:"if-box",ref_for:!0,ref:M=>a.value[T]=M,key:T},[u("div",$re,H(T==0?"if":"else if"),1),u("div",Rre,[u("div",Pre,[C.terms.length>1?(w(),R("div",Lre,[u("span",Bre,H(C.is_or==1?"or":"and"),1)])):ne("",!0),C.terms.length>1?(w(),R("div",Ire)):ne("",!0),u("div",jre,[u("div",Fre,[(w(!0),R(se,null,ge(C.terms,(M,S)=>(w(),R("div",{class:"field-item",key:S},[u("span",Vre,[m(hr,{value:M.variable},null,8,["value"])]),u("span",Hre,H(v(M)),1),u("span",Ure,H(M.value),1)]))),128))])])])])]))),128)),b[0]||(b[0]=u("div",{class:"else-box"},[u("div",{class:"else-box-label"},"else"),u("div",{class:"else-box-content"},[u("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},qre=Ne(zre,[["__scopeId","data-v-c6053472"]]);let Gre=class extends on{constructor(e){super(e),this.renderVue(qre,e)}},Xre=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(d=>d.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s,anchorList:a}=this.properties;let l=[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e}];if(a)for(let d=0;d<a.length;d++){let{offsetTop:c,offsetHeight:p}=a[d],f=o-r/2;l.push({id:a[d].id,nodeId:e,x:t+i/2,y:f+c+p/2,type:"right"})}return l}};const Wre={type:"judge-node",model:Xre,view:Gre},Yre={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:sn,AtText:vn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){this.formState.content&&vo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.reply={...this.formState},this.setData({node_params:JSON.stringify(n)})}}},Jre={class:"specify-reply-node"},Kre={class:"static-field-list"},Zre={class:"static-field-item"},Qre={class:"static-field-item-content"},ese={class:"static-field-value"};function tse(n,e,t,o,i,r){const s=Pt("AtText"),a=Pt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[u("div",Jre,[u("div",Kre,[u("div",Zre,[e[0]||(e[0]=u("div",{class:"static-field-item-label"},"消息内容",-1)),u("div",Qre,[u("div",ese,[i.formState.content.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",class:"text-input",onResize:r.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):ne("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const nse=Ne(Yre,[["render",tse],["__scopeId","data-v-e094e9fc"]]);let ose=class extends on{constructor(e){super(e),this.renderVue(nse,e)}},ise=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(d=>d.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const rse={type:"specify-reply-node",model:ise,view:ose},sse={name:"ImmediatelyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:sn,AtText:vn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).immediately_reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){this.formState.content&&vo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.immediately_reply={...this.formState},this.setData({node_params:JSON.stringify(n)})}}},ase={class:"specify-reply-node"},lse={class:"static-field-list"},use={class:"static-field-item"},dse={class:"static-field-item-content"},cse={class:"static-field-value"};function pse(n,e,t,o,i,r){const s=Pt("AtText"),a=Pt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[u("div",ase,[u("div",lse,[u("div",use,[e[0]||(e[0]=u("div",{class:"static-field-item-label"},"消息内容",-1)),u("div",dse,[u("div",cse,[i.formState.content.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",class:"text-input",onResize:r.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):ne("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const fse=Ne(sse,[["render",pse],["__scopeId","data-v-ae3e2f90"]]);let hse=class extends on{constructor(e){super(e),this.renderVue(fse,e)}},vse=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(d=>d.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const _se={type:"immediately-reply-node",model:vse,view:hse},gse={class:"ai-dialogue-node"},mse={class:"field-list"},yse={class:"field-item"},bse={class:"field-item-content"},xse={class:"field-value"},wse={class:"field-item"},Cse={class:"field-item-content"},kse={class:"field-value"},Sse={class:"field-key"},Ese={class:"field-item"},Ase={class:"field-item-content"},Dse={class:"field-key"},Ose={class:"field-type"},Nse={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=Vn(),{modelList:a}=Va(s),l=X(null),d=X([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),p=X([]),f=X([]);function h(M){if(M){let S=M.split("."),k=S[0],A=S.filter(($,B)=>B>0).join(".");return[k,A]}return["global","question"]}function v(M){return M.forEach(S=>{S.cu_key=Math.random()*1e4,S.subs&&S.subs.length?v(S.subs):S.subs=[]}),M}const y=()=>{const M=e.properties.dataRaw||e.properties.node_params||"{}";let S={};try{S=JSON.parse(M).params_extractor||{}}catch{S={}}S=JSON.parse(JSON.stringify(S)),_(),b();for(let k in S){if(k=="output"){c.output=v(S[k]);continue}if(k=="question_value"){c.question_value=h(S[k]);continue}c[k]=S[k]}!c.model_config_id&&a.value.length>0&&(c.model_config_id=a.value[0].id,c.use_model=a.value[0].children[0].name),Tt(()=>{r()})},g=()=>{const M=JSON.stringify({params_extractor:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t({...e.node,...c,node_params:M})},_=()=>{let M=i().getAllParentVariable();M.forEach(S=>{S.tags=S.tags||[]}),p.value=M};function b(){let M=i().getAllParentVariable();f.value=C(M)}function C(M){return M.forEach(S=>{S.typ=="node"?S.node_type==1?S.value="global":S.value=S.node_id:S.value=S.key,S.children&&S.children.length>0&&(S.children=C(S.children))}),M}const T=M=>{vo.includes(M.node_type)&&(_(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(S=>{if(S.node_id==M.node_id){let k=S.label.split("/");k[0]=M.node_name,S.label=k.join("/"),S.node_name=M.node_name}}),g(),l.value.refresh())};return ct(()=>e.properties.dataRaw,(M,S)=>{M!=S&&y()},{deep:!0}),at(()=>{y(),r(),o().eventCenter.on("custom:setNodeName",T)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",T)}),(M,S)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",gse,[u("div",mse,[u("div",yse,[S[0]||(S[0]=u("div",{class:"field-item-label"},"用户问题",-1)),u("div",bse,[u("div",xse,[m(hr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),u("div",wse,[S[1]||(S[1]=u("div",{class:"field-item-label"},"LLM模型",-1)),u("div",Cse,[u("div",kse,[u("span",Sse,[m(tl,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])])]),u("div",Ese,[S[2]||(S[2]=u("div",{class:"field-item-label"},"输出字段",-1)),u("div",Ase,[(w(!0),R(se,null,ge(c.output,k=>(w(),R("div",{class:xt(["field-value",{"is-required":k.required}]),key:k.cu_key},[u("span",Dse,H(k.key),1),u("span",Ose,H(k.typ),1)],2))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Mse=Ne(Nse,[["__scopeId","data-v-d6ba1358"]]);let Tse=class extends on{constructor(e){super(e),this.renderVue(Mse,e)}},$se=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Rse={type:"parameter-extraction-node",model:$se,view:Tse},Pse={class:"ai-dialogue-node"},Lse={class:"static-field-list"},Bse={class:"static-field-item"},Ise={class:"static-field-item-content"},jse={class:"static-field-value"},Fse={class:"static-field-item"},Vse={class:"static-field-item-content"},Hse={class:"static-field-value"},Use={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=X(null),o=Ve("setData"),i=Ve("getGraph"),r=Ve("getNode"),s=Ve("resetSize"),a=Vn(),{modelList:l}=Va(a),d=X([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),p=X([]);function f(_){if(_){let b=_.split("."),C=b[0],T=b.filter((M,S)=>S>0).join(".");return[C,T]}return["global","question"]}const h=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(_).question_optimize||{}}catch{b={}}y();const{model_config_id:C,use_model:T,context_pair:M,temperature:S,max_token:k,prompt:A,prompt_tags:$,question_value:B,enable_thinking:O}=JSON.parse(JSON.stringify(b));c.model_config_id=C,c.use_model=T,c.context_pair=M||0,c.temperature=S,c.max_token=k,c.prompt=A,c.enable_thinking=O,c.prompt_tags=$||[],c.question_value=f(B),!c.model_config_id&&l.value.length>0&&(c.model_config_id=l.value[0].id,c.use_model=l.value[0].children[0].name),Tt(()=>{s()})},v=()=>{const _={...c,node_params:JSON.stringify({question_optimize:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}})};o(_)},y=()=>{let _=r().getAllParentVariable();p.value=_},g=_=>{y(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(b=>{if(b.node_id==_.node_id){let C=b.label.split("/");C[0]=_.node_name,b.label=C.join("/"),b.node_name=_.node_name}}),v(),t.value.refresh()};return ct(()=>e.properties,h,{deep:!0}),at(()=>{h(),Tt(()=>{s()}),i().eventCenter.on("custom:setNodeName",g)}),Wn(()=>{i().eventCenter.off("custom:setNodeName",g)}),(_,b)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Pse,[u("div",Lse,[u("div",Bse,[b[0]||(b[0]=u("div",{class:"static-field-item-label"},"用户问题",-1)),u("div",Ise,[u("div",jse,[m(hr,{ref_key:"questionTextRef",ref:t,value:c.question_value},null,8,["value"])])])]),u("div",Fse,[b[1]||(b[1]=u("div",{class:"static-field-item-label"},"LLM模型",-1)),u("div",Vse,[u("div",Hse,[m(tl,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])]),b[2]||(b[2]=u("div",{class:"static-field-item"},[u("div",{class:"static-field-item-label"},"输出"),u("div",{class:"static-field-item-content"},[u("div",{class:"static-field-value"},[u("span",{class:"static-field-key"},"问题优化结果"),u("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zse=Ne(Use,[["__scopeId","data-v-46ea1dcf"]]);let qse=class extends on{constructor(e){super(e),this.renderVue(zse,e)}},Gse=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Xse={type:"problem-optimization-node",model:Gse,view:qse},Fa="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Wse={class:"add-data-node"},Yse={class:"static-field-list"},Jse={class:"static-field-item"},Kse={class:"static-field-item-content"},Zse={class:"static-field-value"},Qse={class:"static-field-item"},eae={class:"static-field-item-content"},tae={key:0,class:"static-field-value"},nae={class:"field-name"},oae={class:"field-name"},iae={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("resetSize"),i=Ve("getNode"),r=Ve("getGraph"),s=X(null);let a={};const l=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),d=X([]),c=()=>{let v=i().getAllParentVariable();d.value=v||[]},p=()=>{let v=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(v),c(),l.formData=a.form_insert,f(),Tt(()=>{o()})},f=()=>{a.form_insert=Xn(l.formData),t({...e.node,node_params:JSON.stringify(a)})};ct(()=>e.properties.dataRaw,(v,y)=>{v!==y&&p()}),at(()=>{r().eventCenter.on("custom:setNodeName",h),p()}),Hc(()=>{r().eventCenter.off("custom:setNodeName",h)});const h=v=>{!l.formData.datas||l.formData.datas.length==0||vo.includes(v.node_type)&&(c(),l.formData.datas.forEach(y=>{y.atTags&&y.atTags.length>0&&y.atTags.forEach(g=>{if(g.node_id==v.node_id){let _=g.label.split("/");_[0]=v.node_name,g.label=_.join("/"),g.node_name=v.node_name}})}),f(),Tt(()=>{s.value.map(y=>y.refresh()),o()}))};return(v,y)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Wse,[u("div",Yse,[u("div",Jse,[y[0]||(y[0]=u("div",{class:"static-field-item-label"},"数据表",-1)),u("div",Kse,[u("div",Zse,H(l.formData.form_name||"--"),1)])]),u("div",Qse,[y[2]||(y[2]=u("div",{class:"static-field-item-label"},"插入数据",-1)),u("div",eae,[l.formData.datas.length==0?(w(),R("div",tae,"--")):ne("",!0),(w(!0),R(se,null,ge(l.formData.datas,g=>(w(),R("div",{class:"static-field-value",key:g.id},[u("span",nae,[m(vn,{options:d.value,"default-value":g.value,defaultSelectedList:g.atTags,ref_for:!0,ref_key:"atInputRef",ref:s},null,8,["options","default-value","defaultSelectedList"])]),y[1]||(y[1]=u("span",{class:"field-arrow"},[u("img",{src:Fa,alt:""})],-1)),u("span",oae,H(g.name),1)]))),128))])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},rae=Ne(iae,[["__scopeId","data-v-3262ce94"]]);let sae=class extends on{constructor(e){super(e),this.renderVue(rae,e)}},aae=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const lae={type:"add-data-node",model:aae,view:sae},uae={class:"node-box"},dae={class:"static-field-list"},cae={class:"static-field-item"},pae={class:"static-field-item-content"},fae={class:"static-field-value"},hae={class:"static-field-item",style:{"align-items":"center"}},vae={class:"static-field-item-content"},_ae={key:0,class:"static-field-value"},gae={class:"condition-box"},mae={key:0,class:"condition-left-box"},yae={class:"connection-text"},bae={key:1,class:"condition-line"},xae={class:"condition-body"},wae={class:"field-items"},Cae={class:"field-name"},kae={class:"field-rule"},Sae={class:"field-value"},Eae={class:"static-field-item"},Aae={class:"static-field-item-content"},Dae={class:"options-list"},Oae={class:"option-label"},Nae={class:"option-label"},Mae={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("resetSize"),i=Ve("getNode"),r=ur();let s={};const a=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),l=X([]),d=()=>{let g=i().getAllParentVariable();l.value=g||[]},c=()=>{let g=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(g),d();let _=f(s.form_update.where||[]);s.form_update.where=_,a.formData=s.form_update,a.formData.form_id&&v(a.formData.form_id),p(),Tt(()=>{o()})},p=()=>{let g={...Xn(a.formData)};g.where=h(g.where),s.form_update=g,t({...e.node,node_params:JSON.stringify(s)})},f=g=>{let _=[];return g.forEach(b=>{let C=JSON.parse(JSON.stringify(b)),T=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=T[0],T.shift(),C.rule=T.join("_"),_.push(C)}),_},h=g=>{let _=[];return g.forEach(b=>{let C=JSON.parse(JSON.stringify(b));C.form_field_id=C.form_field_id*1,C.rule=b.field_type+"_"+b.rule,_.push(C)}),_},v=async g=>{r.getFormFieldList({form_id:g}).then(_=>{_.forEach(b=>{b.id=b.id*1}),a.fieldList=_}).catch(()=>{})},y=(g,_)=>Qc(_,g);return ct(()=>e.properties.dataRaw,(g,_)=>{g!==_&&c()}),at(()=>{c()}),(g,_)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[u("div",uae,[u("div",dae,[u("div",cae,[_[0]||(_[0]=u("div",{class:"static-field-item-label"},"数据表",-1)),u("div",pae,[u("div",fae,H(a.formData.form_name||"--"),1)])]),u("div",hae,[_[2]||(_[2]=u("div",{class:"static-field-item-label"},"更新条件",-1)),u("div",vae,[a.formData.where.length==0?(w(),R("span",_ae,"--")):ne("",!0),u("div",gae,[a.formData.where.length>1?(w(),R("div",mae,[u("span",yae,H(a.formData.typ==1?"且":"或"),1)])):ne("",!0),a.formData.where.length>1?(w(),R("div",bae)):ne("",!0),u("div",xae,[u("div",wae,[(w(!0),R(se,null,ge(a.formData.where,b=>(w(),R("div",{class:"field-item",key:b.id},[u("span",Cae,H(b.field_name),1),u("span",kae,H(y(b.field_type,b.rule)),1),u("span",Sae,[m(vn,{options:l.value,"default-value":b.rule_value1,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"]),b.rule_value2?(w(),R(se,{key:0},[_[1]||(_[1]=u("span",null,"-",-1)),m(vn,{options:l.value,"default-value":b.rule_value2,defaultSelectedList:b.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ne("",!0)])]))),128))])])])])]),u("div",Eae,[_[4]||(_[4]=u("div",{class:"static-field-item-label"},"更新数据",-1)),u("div",Aae,[u("div",Dae,[(w(!0),R(se,null,ge(a.formData.datas,b=>(w(),R("div",{class:"options-item",key:b.key},[u("div",Oae,[m(vn,{options:l.value,"default-value":b.value,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"])]),_[3]||(_[3]=u("span",{class:"field-arrow"},[u("img",{src:Fa,alt:""})],-1)),u("div",Nae,H(b.name),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Tae=Ne(Mae,[["__scopeId","data-v-2e2e7e8f"]]);let $ae=class extends on{constructor(e){super(e),this.renderVue(Tae,e)}},Rae=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Pae={type:"update-data-node",model:Rae,view:$ae},Lae={class:"node-box"},Bae={class:"static-field-list"},Iae={class:"static-field-item"},jae={class:"static-field-item-content"},Fae={class:"static-field-value"},Vae={class:"static-field-item",style:{"align-items":"center"}},Hae={class:"static-field-item-content"},Uae={key:0,class:"static-field-value"},zae={class:"condition-box"},qae={key:0,class:"condition-left-box"},Gae={class:"connection-text"},Xae={key:1,class:"condition-line"},Wae={class:"condition-body"},Yae={class:"field-items"},Jae={class:"field-name"},Kae={class:"field-rule"},Zae={class:"field-value"},Qae={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("resetSize"),o=Ve("setData"),i=Ve("getNode"),r=ur();let s={};const a=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),l=X([]),d=()=>{let g=i().getAllParentVariable();l.value=g||[]},c=()=>{let g=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(g),d();let _=h(s.form_delete.where||[]);s.form_delete.where=_,a.formData=s.form_delete,a.formData.form_id&&v(a.formData.form_id),p(),Tt(()=>{t()})},p=()=>{let g={...Xn(a.formData)};g.where=f(g.where),s.form_delete=g,o({...e.node,node_params:JSON.stringify(s)})},f=g=>{let _=[];return g.forEach(b=>{let C=JSON.parse(JSON.stringify(b));C.form_field_id=C.form_field_id*1,C.rule=b.field_type+"_"+b.rule,_.push(C)}),_},h=g=>{let _=[];return g.forEach(b=>{let C=JSON.parse(JSON.stringify(b)),T=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=T[0],T.shift(),C.rule=T.join("_"),_.push(C)}),_},v=async g=>{r.getFormFieldList({form_id:g}).then(_=>{_.forEach(b=>{b.id=b.id*1}),a.fieldList=_,Tt(()=>{t()})}).catch(()=>{})},y=(g,_)=>Qc(_,g);return ct(()=>e.properties.dataRaw,(g,_)=>{g!==_&&c()}),at(()=>{c()}),(g,_)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[u("div",Lae,[u("div",Bae,[u("div",Iae,[_[0]||(_[0]=u("div",{class:"static-field-item-label"},"数据表",-1)),u("div",jae,[u("div",Fae,H(a.formData.form_name||"--"),1)])]),u("div",Vae,[_[2]||(_[2]=u("div",{class:"static-field-item-label"},"删除条件",-1)),u("div",Hae,[a.formData.where.length==0?(w(),R("span",Uae,"--")):ne("",!0),u("div",zae,[a.formData.where.length>1?(w(),R("div",qae,[u("span",Gae,H(a.formData.typ==1?"且":"或"),1)])):ne("",!0),a.formData.where.length>1?(w(),R("div",Xae)):ne("",!0),u("div",Wae,[u("div",Yae,[(w(!0),R(se,null,ge(a.formData.where,b=>(w(),R("div",{class:"field-item",key:b.id},[u("span",Jae,H(b.field_name),1),u("span",Kae,H(y(b.field_type,b.rule)),1),u("span",Zae,[m(vn,{options:l.value,"default-value":b.rule_value1,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"]),b.rule_value2?(w(),R(se,{key:0},[_[1]||(_[1]=u("span",null,"-",-1)),m(vn,{options:l.value,"default-value":b.rule_value2,defaultSelectedList:b.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ne("",!0)])]))),128))])])])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},ele=Ne(Qae,[["__scopeId","data-v-316570df"]]);let tle=class extends on{constructor(e){super(e),this.renderVue(ele,e)}},nle=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const ole={type:"delete-data-node",model:nle,view:tle},ile={class:"node-box"},rle={class:"static-field-list"},sle={class:"static-field-item"},ale={class:"static-field-item-content"},lle={class:"static-field-value"},ule={class:"static-field-item",style:{"align-items":"center"}},dle={class:"static-field-item-content"},cle={key:0,class:"static-field-value"},ple={class:"condition-box"},fle={key:0,class:"condition-left-box"},hle={class:"connection-text"},vle={key:1,class:"condition-line"},_le={class:"condition-body"},gle={class:"field-items"},mle={class:"field-name"},yle={class:"field-rule"},ble={class:"field-value"},xle={class:"static-field-item"},wle={class:"static-field-item-content"},Cle={class:"options-list"},kle={class:"option-label"},Sle={class:"option-type"},Ele={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("resetSize"),i=Ve("getNode"),r=Ve("getGraph"),s=ur();let a={};const l=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),d=X([]),c=()=>{let C=i().getAllParentVariable();d.value=C||[]},p=()=>{let C=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(C),c();let T=h(a.form_select.where||[]);a.form_select.where=T,l.formData=a.form_select,l.formData.form_id&&g(l.formData.form_id),f(),Tt(()=>{o()})},f=()=>{let C={...Xn(l.formData)};C.where=v(C.where),a.form_select=C,t({...e.node,node_params:JSON.stringify(a)})},h=C=>{let T=[];return C.forEach(M=>{let S=JSON.parse(JSON.stringify(M)),k=S.rule.split("_");S.form_field_id=S.form_field_id*1,S.field_type=k[0],k.shift(),S.rule=k.join("_"),T.push(S)}),T},v=C=>{let T=[];return C.forEach(M=>{let S=JSON.parse(JSON.stringify(M));S.form_field_id=S.form_field_id*1,S.rule=M.field_type+"_"+M.rule,T.push(S)}),T},y=async()=>{const C=await s.getFormList();C&&(l.tableList=C)},g=async C=>{s.getFormFieldList({form_id:C}).then(T=>{T.forEach(M=>{M.id=M.id*1}),l.fieldList=T}).catch(()=>{})},_=(C,T)=>Qc(T,C),b=()=>{p()};return ct(()=>e.properties.dataRaw,(C,T)=>{C!==T&&p()}),at(()=>{y(),p(),r().eventCenter.on("custom:setNodeName",b)}),Wn(()=>{r().eventCenter.off("custom:setNodeName",b)}),(C,T)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[u("div",ile,[u("div",rle,[u("div",sle,[T[0]||(T[0]=u("div",{class:"static-field-item-label"},"数据表",-1)),u("div",ale,[u("div",lle,H(l.formData.form_name||"--"),1)])]),u("div",ule,[T[2]||(T[2]=u("div",{class:"static-field-item-label"},"查询条件",-1)),u("div",dle,[l.formData.where.length==0?(w(),R("span",cle,"--")):ne("",!0),u("div",ple,[l.formData.where.length>1?(w(),R("div",fle,[u("span",hle,H(l.formData.typ==1?"且":"或"),1)])):ne("",!0),l.formData.where.length>1?(w(),R("div",vle)):ne("",!0),u("div",_le,[u("div",gle,[(w(!0),R(se,null,ge(l.formData.where,M=>(w(),R("div",{class:"field-item",key:M.id},[u("span",mle,H(M.field_name),1),u("span",yle,H(_(M.field_type,M.rule)),1),u("span",ble,[m(vn,{options:d.value,"default-value":M.rule_value1,defaultSelectedList:M.atTags},null,8,["options","default-value","defaultSelectedList"]),M.rule_value2?(w(),R(se,{key:0},[T[1]||(T[1]=u("span",null,"-",-1)),m(vn,{options:d.value,"default-value":M.rule_value2,defaultSelectedList:M.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ne("",!0)])]))),128))])])])])]),u("div",xle,[T[3]||(T[3]=u("div",{class:"static-field-item-label"},"查询字段",-1)),u("div",wle,[u("div",Cle,[(w(!0),R(se,null,ge(l.formData.fields,M=>(w(),R("div",{class:"options-item",key:M.key},[u("div",kle,H(M.name),1),u("div",Sle,H(M.type),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Ale=Ne(Ele,[["__scopeId","data-v-748b22e0"]]);let Dle=class extends on{constructor(e){super(e),this.renderVue(Ale,e)}},Ole=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Nle={type:"select-data-node",model:Ole,view:Dle},Mle={class:"ai-dialogue-node"},Tle={class:"field-list"},$le={class:"field-item"},Rle={class:"field-item-content"},Ple={class:"field-text"},Lle={class:"right-arrow"},Ble={class:"field-text"},Ile={class:"field-item"},jle={class:"field-item-content"},Fle={class:"field-key"},Vle={class:"field-type"},Hle=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,Ule={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=Je({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),l=X([]);function d(y){return y.forEach(g=>{g.cu_key=Math.random()*1e4,g.subs&&g.subs.length?d(g.subs):g.subs=[]}),y}const c=()=>{const y=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(y).code_run||{}}catch{g={}}h(),g=JSON.parse(JSON.stringify(g));for(let _ in g){if(_=="params"){g[_]&&g[_].length>0?a[_]=g[_].map(b=>({...b,cu_key:Math.random()*1e4})):a[_]=[];continue}if(_=="output"){a.output=d(g[_]);continue}a[_]=g[_]}a.main_func=a.main_func||Hle,a.params=a.params.map(_=>{let b="";for(let C=0;C<Lo.length;C++)if(_.variable.indexOf(Lo[C])>-1){b=Lo[C];break}if(b!=""){let C=_.variable.split(".");_.variable=[C[0],b]}else _.variable=_.variable.split(".");return{..._,key:Math.random()*1e4}}),Tt(()=>{r()})},p=()=>{const y=JSON.stringify({code_run:{...a,params:f()}});t({...e.node,...a,node_params:y})};function f(){let y=[];return a.params.forEach(g=>{y.push({field:g.field,variable:g.variable&&g.variable.length>0?g.variable.join("."):""})}),y}const h=()=>{let y=i().getAllParentVariable();l.value=y},v=y=>{vo.includes(y.node_type)&&(h(),Tt(()=>{p()}))};return ct(()=>e.properties,c,{deep:!0}),at(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",v)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",v)}),(y,g)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Mle,[u("div",Tle,[u("div",$le,[g[0]||(g[0]=u("div",{class:"field-item-label"},"输入参数",-1)),u("div",Rle,[(w(!0),R(se,null,ge(a.params,_=>(w(),R("div",{class:"field-list-item",key:_.cu_key},[u("div",Ple,[m(hr,{value:_.variable},null,8,["value"])]),u("div",Lle,[m(K(tr))]),u("div",Ble,H(_.field),1)]))),128))])]),u("div",Ile,[g[1]||(g[1]=u("div",{class:"field-item-label"},"输出字段",-1)),u("div",jle,[(w(!0),R(se,null,ge(a.output,_=>(w(),R("div",{class:"field-value",key:_.cu_key},[u("span",Fle,H(_.key),1),u("span",Vle,H(_.typ),1)]))),128))])]),g[2]||(g[2]=u("div",{class:"field-item"},[u("div",{class:"field-item-label"},"异常处理"),u("div",{class:"field-item-content"},[u("div",{class:"field-value"},[u("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zle=Ne(Ule,[["__scopeId","data-v-cdf93be1"]]);let qle=class extends on{constructor(e){super(e),this.renderVue(zle,e)}},Gle=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(o,i,r,s)=>{if(o.id==i.id)return!1;const a=o.graphModel.edges.map(d=>d.sourceAnchorId),l=r.id;return r.type==="right"&&!a.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(o,i,r,s)=>o.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:o+r/2-28,id:l+"-anchor_right_exception",type:"right",nodeId:e}]}};const Xle={type:"code-run-node",model:Gle,view:qle},Wle={name:"QuestionNode",components:{NodeCommon:sn,AtText:vn},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}},valueOptions:[]}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.valueOptions=this.getNode().getAllParentVariable()||[],this.loadProvider(),this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.$nextTick(()=>{this.resetSize()})},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParams=JSON.parse(this.properties.node_params||"{}"),this.$nextTick(()=>{const t=this.$refs.atTextRef;(Array.isArray(t)?t:t?[t]:[]).forEach(i=>{i&&i.refresh&&i.refresh()}),this.resetSize()}))},deep:!0}},methods:{onUpatateNodeName(n){var o,i;this.valueOptions=this.getNode().getAllParentVariable()||[];const e=r=>{!Array.isArray(r)||r.length===0||r.forEach(s=>{if(s&&s.node_id==n.node_id){if(s.label){let a=s.label.split("/");a[0]=n.node_name,s.label=a.join("/")}s.node_name=n.node_name}})},t=((i=(o=this.nodeParams)==null?void 0:o.mcp)==null?void 0:i.tag_map)||{};Object.keys(t).forEach(r=>{e(t[r])}),this.$nextTick(()=>{const r=this.$refs.atTextRef;(Array.isArray(r)?r:r?[r]:[]).forEach(a=>{a&&a.refresh&&a.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.resetSize()})},loadProvider(){var n;x_({provider_id:((n=this.nodeParams)==null?void 0:n.mcp.provider_id)||""}).then(e=>{var o;this.mcpInfo=(e==null?void 0:e.data)||{};let t=Fo((o=this.mcpInfo)==null?void 0:o.tools,[]);this.toolInfo=t.find(i=>{var r;return i.name==((r=this.nodeParams)==null?void 0:r.mcp.tool_name)}),this.$nextTick(()=>{this.resetSize()})})},update(n){let e=this.nodeParams;e.mcp.arguments=n.arguments,e.mcp.tag_map=n.tag_map,this.setData({node_params:JSON.stringify(e)})},getArgValue(n){var t,o,i;const e=(i=(o=(t=this.nodeParams)==null?void 0:t.mcp)==null?void 0:o.arguments)==null?void 0:i[n];return e==null?"":String(e)},getArgTags(n){var t,o,i;const e=(i=(o=(t=this.nodeParams)==null?void 0:t.mcp)==null?void 0:o.tag_map)==null?void 0:i[n];return Array.isArray(e)?e:[]}},computed:{propList(){var o;const n=((o=this.toolInfo)==null?void 0:o.inputSchema)||{},e=(n==null?void 0:n.properties)||{},t=Array.isArray(n==null?void 0:n.required)?n.required:[];return Object.keys(e).map(i=>(e[i],{key:i,required:t.includes(i)}))}}},Yle={class:"_main"},Jle={class:"label"};function Kle(n,e,t,o,i,r){const s=Pt("at-text"),a=Ai,l=Pt("node-common");return w(),Q(l,{properties:t.properties,title:t.properties.node_name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,style:{"min-width":"320px","min-height":"94px"}},{default:x(()=>[u("div",Yle,[(w(!0),R(se,null,ge(r.propList,d=>(w(),R("div",{key:d.key},[u("span",Jle,H(d.key)+"：",1),r.getArgValue(d.key)?(w(),Q(a,{key:0},{default:x(()=>[m(s,{options:i.valueOptions,defaultSelectedList:r.getArgTags(d.key),defaultValue:r.getArgValue(d.key),ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Q(a,{key:1},{default:x(()=>[...e[0]||(e[0]=[U("--",-1)])]),_:1}))]))),128))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key"])}const Zle=Ne(Wle,[["render",Kle],["__scopeId","data-v-0f29b8dd"]]);let Qle=class extends on{constructor(e){super(e),this.renderVue(Zle,e)}},eue=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const tue={type:"mcp-node",model:eue,view:Qle},nue={name:"feishu-table-render",components:{AtText:vn},props:{business:{type:String},nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{BatchActions:Vd,batchActionParam:{},operatorMap:M_(),actionState:{}}},async mounted(){Vd.includes(this.business)&&await this.initParams(),this.dataFormat()},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{async initParams(){await Ho({name:"feishu_bitable",action:"default/get-schema",params:{}}).then(n=>{var t;let e=(n==null?void 0:n.data)||{};this.batchActionParam=T_(((t=e[this.business])==null?void 0:t.params)||{})})},dataFormat(){var o,i,r,s,a;let n=((r=(i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},{config_name:e,table_name:t}=((a=(s=this.nodeParams)==null?void 0:s.plugin)==null?void 0:a.params)||{};this.actionState={...n,config_name:e,table_name:t}}}},oue={class:"_main"},iue={key:0},rue={key:1},sue={key:2},aue={key:3},lue={key:4},uue={key:0,class:"field-box"},due={key:0},cue={key:1},pue={key:1},fue={key:5},hue={key:0,class:"field-box"},vue={class:"arrow-icon"},_ue={key:0},gue={key:1},mue={key:1},yue={key:0,class:"field-box"},bue={key:1},xue={key:0,class:"field-box"},wue={key:0},Cue={key:1},kue={key:1},Sue={key:10},Eue={class:"label"},Aue={key:0,class:"field-box"},Due={key:1};function Oue(n,e,t,o,i,r){var l,d;const s=Ai,a=Pt("at-text");return w(),R("div",oue,[u("div",null,[e[0]||(e[0]=u("span",{class:"label"},"配置：",-1)),m(s,null,{default:x(()=>{var c;return[U(H(((c=i.actionState)==null?void 0:c.config_name)||"--"),1)]}),_:1})]),["create_bitable","create_tables","table_add_members","update_advanced","roles_list"].includes(t.business)?ne("",!0):(w(),R("div",iue,[e[1]||(e[1]=u("span",{class:"label"},"数据表：",-1)),m(s,null,{default:x(()=>{var c,p,f,h,v,y,g;return[(p=(c=i.actionState)==null?void 0:c.tag_map)!=null&&p.table_id&&((h=(f=i.actionState)==null?void 0:f.tag_map)!=null&&h.table_id.length)?(w(),Q(a,{key:0,class:"batch-render-at",options:t.valueOptions,defaultSelectedList:i.actionState.tag_map.table_id,defaultValue:(v=i.actionState)==null?void 0:v.table_id},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R(se,{key:1},[U(H(((y=i.actionState)==null?void 0:y.table_name)||((g=i.actionState)==null?void 0:g.table_id)||"--"),1)],64))]}),_:1})])),t.business=="create_bitable"?(w(),R("div",rue,[e[2]||(e[2]=u("span",{class:"label"},"多维表名称：",-1)),m(s,null,{default:x(()=>{var c,p,f;return[m(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.name)||[],defaultValue:((f=i.actionState)==null?void 0:f.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_tables"?(w(),R("div",sue,[e[3]||(e[3]=u("span",{class:"label"},"数据表名称：",-1)),m(s,null,{default:x(()=>{var c,p,f;return[m(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.name)||[],defaultValue:((f=i.actionState)==null?void 0:f.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_views"?(w(),R("div",aue,[e[4]||(e[4]=u("span",{class:"label"},"视图名称：",-1)),m(s,null,{default:x(()=>{var c,p,f;return[m(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.view_name)||[],defaultValue:((f=i.actionState)==null?void 0:f.view_name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_record"?(w(),R("div",lue,[e[7]||(e[7]=u("span",{class:"label"},"插入数据：",-1)),Array.isArray(i.actionState.fields)?(w(),R("div",uue,[(w(!0),R(se,null,ge(i.actionState.fields,c=>(w(),Q(s,{class:"field-tag",key:c.field_name},{default:x(()=>[u("span",null,H(c.field_name),1),e[5]||(e[5]=u("span",{class:"arrow-icon"},[u("img",{src:Fa})],-1)),c.value?(w(),R("span",due,[m(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",cue))]),_:2},1024))),128))])):(w(),R("div",pue,[m(s,null,{default:x(()=>[...e[6]||(e[6]=[U("--",-1)])]),_:1})]))])):t.business=="delete_record"?(w(),R("div",fue,[e[9]||(e[9]=u("span",{class:"label"},"删除ID：",-1)),i.actionState.record_id?(w(),Q(s,{key:0},{default:x(()=>[m(a,{options:t.valueOptions,defaultSelectedList:i.actionState.record_tags,defaultValue:i.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[8]||(e[8]=[U("--",-1)])]),_:1}))])):t.business=="search_records"?(w(),R(se,{key:6},[u("div",null,[e[11]||(e[11]=u("span",{class:"label"},"查询条件：",-1)),Array.isArray((d=(l=i.actionState)==null?void 0:l.filter)==null?void 0:d.conditions)&&i.actionState.filter.conditions.length?(w(),R("div",hue,[(w(!0),R(se,null,ge(i.actionState.filter.conditions,c=>(w(),Q(s,{class:"field-tag",key:c.field_id},{default:x(()=>{var p;return[u("span",null,H(c.field_name),1),u("span",vue,H((p=i.operatorMap[c.operator])==null?void 0:p.label),1),c.value?(w(),R("span",_ue,[m(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",gue))]}),_:2},1024))),128))])):(w(),R("div",mue,[m(s,null,{default:x(()=>[...e[10]||(e[10]=[U("--",-1)])]),_:1})]))]),u("div",null,[e[13]||(e[13]=u("span",{class:"label"},"查询字段：",-1)),Array.isArray(i.actionState.field_names)&&i.actionState.field_names.length?(w(),R("div",yue,[(w(!0),R(se,null,ge(i.actionState.field_names,c=>(w(),Q(s,{class:"field-tag",key:c.field},{default:x(()=>[U(H(c),1)]),_:2},1024))),128))])):(w(),R("div",bue,[m(s,null,{default:x(()=>[...e[12]||(e[12]=[U("--",-1)])]),_:1})]))])],64)):t.business=="update_record"?(w(),R(se,{key:7},[u("div",null,[e[15]||(e[15]=u("span",{class:"label"},"更新ID：",-1)),i.actionState.record_id?(w(),Q(s,{key:0},{default:x(()=>[m(a,{options:t.valueOptions,defaultSelectedList:i.actionState.record_tags,defaultValue:i.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[14]||(e[14]=[U("--",-1)])]),_:1}))]),u("div",null,[e[18]||(e[18]=u("span",{class:"label"},"更新数据：",-1)),Array.isArray(i.actionState.fields)?(w(),R("div",xue,[(w(!0),R(se,null,ge(i.actionState.fields,c=>(w(),Q(s,{class:"field-tag",key:c.field_name},{default:x(()=>[u("span",null,H(c.field_name),1),e[16]||(e[16]=u("span",{class:"arrow-icon"},[u("img",{src:Fa})],-1)),c.value?(w(),R("span",wue,[m(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",Cue))]),_:2},1024))),128))])):(w(),R("div",kue,[m(s,null,{default:x(()=>[...e[17]||(e[17]=[U("--",-1)])]),_:1})]))])],64)):t.business=="update_advanced"?(w(),R(se,{key:8},[u("div",null,[e[20]||(e[20]=u("span",{class:"label"},"多维表名称：",-1)),i.actionState.name?(w(),Q(s,{key:0},{default:x(()=>{var c,p;return[m(a,{options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.name)||[],defaultValue:i.actionState.name},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[19]||(e[19]=[U("--",-1)])]),_:1}))]),u("div",null,[e[21]||(e[21]=u("span",{class:"label"},"高级权限：",-1)),m(s,null,{default:x(()=>[U(H(i.actionState.is_advanced==0?"不设置":i.actionState.is_advanced==1?"开启":"关闭"),1)]),_:1})])],64)):t.business=="table_add_members"?(w(),R(se,{key:9},[u("div",null,[e[22]||(e[22]=u("span",{class:"label"},"多维表：",-1)),m(s,null,{default:x(()=>{var c,p,f;return[m(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.app_token)||[],defaultValue:((f=i.actionState)==null?void 0:f.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})]),u("div",null,[e[24]||(e[24]=u("span",{class:"label"},"协作者角色：",-1)),i.actionState.role_id?(w(),Q(s,{key:0},{default:x(()=>{var c,p;return[m(a,{options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.role_id)||[],defaultValue:i.actionState.role_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[23]||(e[23]=[U("--",-1)])]),_:1}))]),u("div",null,[e[26]||(e[26]=u("span",{class:"label"},"协作者ID：",-1)),i.actionState.member_id?(w(),Q(s,{key:0},{default:x(()=>{var c,p;return[m(a,{options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.member_id)||[],defaultValue:i.actionState.member_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[25]||(e[25]=[U("--",-1)])]),_:1}))])],64)):t.business=="roles_list"?(w(),R("div",Sue,[e[27]||(e[27]=u("span",{class:"label"},"多维表：",-1)),m(s,null,{default:x(()=>{var c,p,f;return[m(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:p.app_token)||[],defaultValue:((f=i.actionState)==null?void 0:f.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):i.BatchActions.includes(t.business)?(w(!0),R(se,{key:11},ge(i.batchActionParam,(c,p)=>(w(),R("div",{key:p},[u("span",Eue,H(c.name)+"：",1),i.actionState[p]?(w(),R("div",Aue,[m(s,null,{default:x(()=>{var f;return[m(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=i.actionState)==null?void 0:f.tag_map[p])||[],defaultValue:i.actionState[p].toString()},null,8,["options","defaultSelectedList","defaultValue"])]}),_:2},1024)])):(w(),R("div",Due,[m(s,null,{default:x(()=>[...e[28]||(e[28]=[U("--",-1)])]),_:1})]))]))),128)):ne("",!0)])}const Nue=Ne(nue,[["render",Oue],["__scopeId","data-v-8f2ebef3"]]),Mue={name:"feishu-table-render",components:{AtText:vn,QuestionCircleOutlined:ft},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{operatorMap:M_(),actionState:{}}},mounted(){this.dataFormat()},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{dataFormat(){var i,r;let n=((r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)||{},e=(n==null?void 0:n.arguments)||{},{config_name:t,table_name:o}=n||{};this.actionState={...n,...e,config_name:t,table_name:o},this.actionState},getFieldLabel(n){var e,t;return((t=(e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])==null?void 0:t.name)||(n==null?void 0:n.name)},getFieldValue(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.value)??""}return(n==null?void 0:n.value)??""},getFieldTags(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.atTags)??[]}return(n==null?void 0:n.atTags)??[]}}},Tue={class:"_main"},$ue={class:"label"},Rue={class:"hint"},Pue={key:0},Lue={key:1},Bue={key:0,class:"field-box"},Iue={key:0},jue={key:1},Fue={key:1};function Vue(n,e,t,o,i,r){var d,c;const s=Ai,a=Pt("QuestionCircleOutlined"),l=Pt("at-text");return w(),R("div",Tue,[u("div",null,[e[0]||(e[0]=u("span",{class:"label"},"公众号：",-1)),m(s,null,{default:x(()=>{var p;return[U(H(((p=i.actionState)==null?void 0:p.app_name)||"--"),1)]}),_:1})]),u("div",null,[u("span",$ue,[e[2]||(e[2]=U("接收人 ",-1)),u("span",Rue,[m(a),e[1]||(e[1]=u("span",{class:"hint-pop"},"接收人openid",-1))]),e[3]||(e[3]=U("： ",-1))]),(d=i.actionState)!=null&&d.touser?(w(),R("span",Pue,[m(l,{options:t.valueOptions,defaultSelectedList:[],defaultValue:(((c=i.actionState)==null?void 0:c.touser)||"").toString()},null,8,["options","defaultValue"])])):(w(),R("span",Lue,[m(s,null,{default:x(()=>[...e[4]||(e[4]=[U("--",-1)])]),_:1})]))]),u("div",null,[e[5]||(e[5]=u("span",{class:"label"},"消息类型：",-1)),m(s,null,{default:x(()=>{var p;return[U(H(((p=i.actionState)==null?void 0:p.msg_type_name)||"--"),1)]}),_:1})]),u("div",null,[e[8]||(e[8]=u("span",{class:"label"},"回复内容：",-1)),Array.isArray(i.actionState.fields)?(w(),R("div",Bue,[(w(!0),R(se,null,ge(i.actionState.fields,p=>(w(),Q(s,{class:"field-tag",key:p.field_name},{default:x(()=>[u("span",null,H(r.getFieldLabel(p)),1),e[6]||(e[6]=u("span",{class:"arrow-icon"},[u("img",{src:Fa})],-1)),r.getFieldValue(p)?(w(),R("span",Iue,[m(l,{options:t.valueOptions,defaultSelectedList:r.getFieldTags(p),defaultValue:r.getFieldValue(p).toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",jue))]),_:2},1024))),128))])):(w(),R("div",Fue,[m(s,null,{default:x(()=>[...e[7]||(e[7]=[U("--",-1)])]),_:1})]))])])}const Hue=Ne(Mue,[["render",Vue],["__scopeId","data-v-ee438a34"]]),Uue={name:"feishu-table-render",inject:["getGraph","setData"],components:{AtText:vn},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{atTextRef:null,actionState:{}}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.dataFormat()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{onUpatateNodeName(n){var o;if(!vo.includes(n.node_type))return;const e=i=>{!Array.isArray(i)||i.length===0||i.forEach(r=>{if(r&&r.node_id==n.node_id){if(r.label){let s=r.label.split("/");s[0]=n.node_name,r.label=s.join("/")}r.node_name=n.node_name}})};(((o=this.actionState)==null?void 0:o.rendering)||[]).forEach(i=>{e(i==null?void 0:i.tags)}),this.$nextTick(()=>{const i=this.$refs.atTextRef;(Array.isArray(i)?i:i?[i]:[]).forEach(s=>{s&&s.refresh&&s.refresh()}),this.update(),this.dataFormat(),this.$emit("updateSize")})},update(){this.setData({node_params:JSON.stringify(this.nodeParams)})},dataFormat(){var o,i,r;let n=((i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)||{},e=(n==null?void 0:n.arguments)||{},t=(n==null?void 0:n.rendering)||{};if(Array.isArray(n==null?void 0:n.rendering)){const s=((r=n==null?void 0:n.arguments)==null?void 0:r.tag_map)||(n==null?void 0:n.tag_map)||{};n.rendering.forEach(a=>{if(a&&(!Array.isArray(a.tags)||a.tags.length===0)){const l=a.key,d=l&&s?s[l]:null;Array.isArray(d)&&d.length&&(a.tags=d)}})}this.actionState={...n,...e,...t}},getFieldLabel(n){var e,t;return((t=(e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])==null?void 0:t.name)||(n==null?void 0:n.name)},getFieldValue(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.value)??""}return(n==null?void 0:n.value)??""},getFieldTags(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.atTags)??[]}return(n==null?void 0:n.atTags)??[]}}},zue={class:"_main"},que={key:0},Gue={class:"label"};function Xue(n,e,t,o,i,r){var l,d;const s=Ai,a=Pt("at-text");return w(),R("div",zue,[(l=i.actionState)!=null&&l.use_plugin_config?(w(),R("div",que,[e[0]||(e[0]=u("span",{class:"label"},"配置：",-1)),m(s,null,{default:x(()=>{var c;return[U(H(((c=i.actionState)==null?void 0:c.config_name)||"--"),1)]}),_:1})])):ne("",!0),(w(!0),R(se,null,ge(((d=i.actionState)==null?void 0:d.rendering)||[],(c,p)=>(w(),R("div",{key:c.key||p},[u("span",Gue,H(c.label)+"：",1),c.value?(w(),Q(s,{key:0},{default:x(()=>[m(a,{options:t.valueOptions,defaultSelectedList:c.tags,defaultValue:c.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Q(s,{key:1},{default:x(()=>[...e[1]||(e[1]=[U("--",-1)])]),_:1}))]))),128))])}const Wue=Ne(Uue,[["render",Xue],["__scopeId","data-v-f069d729"]]),Yue={name:"QuestionNode",components:{AtText:vn,FeishuTableRender:Nue,OfficialSendMessageRender:Hue,DynamicRender:Wue,NodeCommon:sn},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"删除",key:"delete",color:"#fb363f"}],formState:{},nodeParams:{},info:{},isMultiNode:!1,pluginData:{},valueOptions:[]}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},computed:{pluginName(){var n,e;return((e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.name)||null},business(){var n,e,t;return((t=(e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.params)==null?void 0:t.business)||null},isFeishuTbPlugin(){return this.pluginName==="feishu_bitable"},isOfficialSendMessagePlugin(){return this.pluginName==="official_send_message"}},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParamsFormat(),this.formStateFormat())},deep:!0}},methods:{onUpatateNodeName(n){var o,i,r,s,a,l;if(!vo.includes(n.node_type))return;this.valueOptions=this.getNode().getAllParentVariable()||[];const e=d=>{!Array.isArray(d)||d.length===0||d.forEach(c=>{if(c&&c.node_id==n.node_id){if(c.label){let p=c.label.split("/");p[0]=n.node_name,c.label=p.join("/")}c.node_name=n.node_name}})};this.formState&&typeof this.formState=="object"&&Object.keys(this.formState).forEach(d=>{var c;e((c=this.formState[d])==null?void 0:c.tags)});const t=[];(i=(o=this.nodeParams)==null?void 0:o.plugin)!=null&&i.tag_map&&t.push(this.nodeParams.plugin.tag_map),(l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)!=null&&l.tag_map&&t.push(this.nodeParams.plugin.params.arguments.tag_map),t.forEach(d=>{!d||typeof d!="object"||Object.keys(d).forEach(c=>{e(d[c])})}),this.$nextTick(()=>{const d=this.$refs.atTextRef;(Array.isArray(d)?d:d?[d]:[]).forEach(p=>{p&&p.refresh&&p.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.updateSize()})},async init(){this.valueOptions=this.getNode().getAllParentVariable(),this.nodeParamsFormat(),await this.loadPluginInfo(),await this.loadPluginParams(),this.updateSize()},loadPluginInfo(){return w_({name:this.pluginName}).then(n=>{var t;let e=(n==null?void 0:n.data)||{};this.info=e.remote||{},this.isMultiNode=((t=e==null?void 0:e.local)==null?void 0:t.multiNode)||!1}).catch(()=>{this.info={icon:this.properties.node_icon||""},this.isMultiNode=!1})},loadPluginParams(){return Ho({name:this.pluginName,action:"default/get-schema",params:{}}).then(n=>{this.pluginData=(n==null?void 0:n.data)||{},this.formStateFormat(),this.update(this.pluginData)}).catch(()=>{this.pluginData={},this.formStateFormat(),this.update(this.pluginData)})},nodeParamsFormat(){this.nodeParams=JSON.parse(this.properties.node_params)},formStateFormat(){if(this.isFeishuTbPlugin||this.isOfficialSendMessagePlugin)return;let n=JSON.parse(JSON.stringify(this.pluginData));const e={official_account_profile:this.officialAccountHandle,official_batch_tag:this.officialTagHandle,official_send_template_message:this.officialTemplateHandle,official_article:this.officialArticleHandle,official_draft:this.officialDraftHandle};e[this.pluginName]?e[this.pluginName](n):this.defaultHandle(n),this.updateSize()},update(n){var l,d,c,p,f;typeof n=="string"&&(n=JSON.parse(n));const e=JSON.parse(this.properties.node_params),t=this.business&&(n!=null&&n[this.business])?n[this.business]:n,o=ba(this.pluginName)||this.isMultiNode,i=o?((d=(l=e==null?void 0:e.plugin)==null?void 0:l.params)==null?void 0:d.arguments)||{}:((c=e==null?void 0:e.plugin)==null?void 0:c.params)||{},r={...i};for(const h in this.formState||{}){const v=this.formState[h]||{},y=(v==null?void 0:v.enum_component)||(v==null?void 0:v.radio_component),g=v==null?void 0:v.enum_default;y&&(r[h]==null||String(r[h]).trim()==="")&&g!=null&&g!==""&&(r[h]=g);const _=v==null?void 0:v.setting_cache_component;if(_===!0||_===1||_==="true"||_==="1"){const C=String((v==null?void 0:v.value)??"");if(C!=="")r[h]=C;else{const T=localStorage.getItem(this.getCacheKey(h));T!=null&&(r[h]=String(T))}}}e.plugin=e.plugin||{},e.plugin.params=e.plugin.params||{};const s=(f=(p=e==null?void 0:e.plugin)==null?void 0:p.params)==null?void 0:f.use_plugin_config;e.plugin.params.use_plugin_config=t&&Object.prototype.hasOwnProperty.call(t,"use_plugin_config")?!!t.use_plugin_config:!!s,o?e.plugin.params.arguments={...i,...r,tag_map:i.tag_map||{}}:e.plugin.params={...e.plugin.params,...r},e.plugin.output_obj=Di((t==null?void 0:t.output)||{});const a=JSON.stringify(e);this.properties.node_params!==a&&this.setData({...this.properties,node_params:a})},defaultHandle(n){var o,i,r,s,a,l,d,c,p,f,h,v,y;let e,t;ba(this.pluginName)||this.isMultiNode?(this.formState=((o=n==null?void 0:n[this.business])==null?void 0:o.params)||{},e=((s=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:s.arguments)||{},t=((c=(d=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:d.arguments)==null?void 0:c.tag_map)||{}):(e=((f=(p=this.nodeParams)==null?void 0:p.plugin)==null?void 0:f.params)||{},t=((v=(h=this.nodeParams)==null?void 0:h.plugin)==null?void 0:v.tag_map)||{},this.formState=n);for(let g in this.formState){this.formState[g].value=String(e[g]||""),this.formState[g].tags=t[g]||[];const _=(y=this.formState[g])==null?void 0:y.setting_cache_component;if((_===!0||_===1||_==="true"||_==="1")&&!String(this.formState[g].value||"").trim()){const T=localStorage.getItem(this.getCacheKey(g));T!=null&&(this.formState[g].value=String(T))}}this.isMultiNode&&this.ensureMultiNodeRendering()},getCacheKey(n){let e="",t="";const o=typeof window<"u"?String(window.location.hash||""):"";return o.includes("?")&&(o.split("?")[1]||"").split("&").forEach(s=>{const[a,l]=s.split("=");a==="id"&&(e=decodeURIComponent(l||"")),a==="robot_key"&&(t=decodeURIComponent(l||""))}),e||(e=String(localStorage.getItem("last_local_robot_id")||"")),`${e||t||""}:${this.pluginName}:${n}`},ensureMultiNodeRendering(){var r,s,a,l,d,c,p,f,h,v,y,g,_,b,C,T;const n=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.rendering;if(Array.isArray(n)&&n.length){const M=((p=(c=(d=(l=this.nodeParams)==null?void 0:l.plugin)==null?void 0:d.params)==null?void 0:c.arguments)==null?void 0:p.tag_map)||((h=(f=this.nodeParams)==null?void 0:f.plugin)==null?void 0:h.tag_map)||{};let S=!1;const k=n.map(A=>{var P,E;const $=A==null?void 0:A.key;if((Array.isArray(A==null?void 0:A.tags)?A.tags:[]).length)return A;const O=Array.isArray(M==null?void 0:M[$])?M[$]:Array.isArray((E=(P=this.formState)==null?void 0:P[$])==null?void 0:E.tags)?this.formState[$].tags:[];return O.length?(S=!0,{...A,tags:O}):A});if(S){const A=JSON.parse(this.properties.node_params);A.plugin=A.plugin||{},A.plugin.params=A.plugin.params||{},A.plugin.params.rendering=k,(y=(v=this.nodeParams)==null?void 0:v.plugin)!=null&&y.params&&(this.nodeParams.plugin.params.rendering=k),this.setData({...this.properties,node_params:JSON.stringify(A)})}return}const e=Object.keys(this.formState||{}).filter(M=>M!=="app_secret").filter(M=>{var S,k;return!((k=(S=this.formState)==null?void 0:S[M])!=null&&k.hide_official_component)}).filter(M=>{var S,k;return!((k=(S=this.formState)==null?void 0:S[M])!=null&&k.advanced_settings)}).filter(M=>{var A,$;const S=($=(A=this.formState)==null?void 0:A[M])==null?void 0:$.plugin_config_component;return!(S===!0||S===1||S==="true"||S==="1")}).filter(M=>{var A,$;const S=($=(A=this.formState)==null?void 0:A[M])==null?void 0:$.setting_cache_component;return!(S===!0||S===1||S==="true"||S==="1")}).sort((M,S)=>{var k,A,$,B;return+(((A=(k=this.formState)==null?void 0:k[M])==null?void 0:A.sort_num)||0)-+(((B=($=this.formState)==null?void 0:$[S])==null?void 0:B.sort_num)||0)}),t=((b=(_=(g=this.nodeParams)==null?void 0:g.plugin)==null?void 0:_.params)==null?void 0:b.arguments)||{},o=e.map(M=>{var B,O,P;const S=((B=this.formState)==null?void 0:B[M])||{};let k=(S==null?void 0:S.name)||M,A=String((S==null?void 0:S.value)??"");const $=Array.isArray(S==null?void 0:S.tags)?S.tags:[];if(M==="app_id"&&(k="公众号名称",A=String(t.app_name??((P=(O=this.formState)==null?void 0:O.app_name)==null?void 0:P.value)??"")),S!=null&&S.enum_component||S!=null&&S.radio_component){const E=((S==null?void 0:S.enum)||[]).find(D=>String(D==null?void 0:D.value)===A)||((S==null?void 0:S.enum)||[]).find(D=>String(D==null?void 0:D.value)===(S==null?void 0:S.enum_default));E&&E.name&&(A=String(E.name))}return{label:k,value:A,tags:$,key:M}});if(!o.length)return;const i=JSON.parse(this.properties.node_params);i.plugin=i.plugin||{},i.plugin.params=i.plugin.params||{},i.plugin.params.rendering=o,(T=(C=this.nodeParams)==null?void 0:C.plugin)!=null&&T.params&&(this.nodeParams.plugin.params.rendering=o),this.setData({...this.properties,node_params:JSON.stringify(i)})},officialAccountHandle(n){var e,t,o,i,r,s,a,l,d,c,p;if((e=n==null?void 0:n[this.business])==null||delete e.params.app_id,(t=n==null?void 0:n[this.business])==null||delete t.params.app_secret,(o=n==null?void 0:n[this.business])!=null&&o.params)if(this.business==="getTagFans"){let f=((s=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:s.arguments)||{},h=((c=(d=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:d.arguments)==null?void 0:c.tag_map)||{};this.formState={app_name:{type:"string",name:"公众号名称",value:f.app_name,tags:[]}},f.tag_type==1?this.formState.tag_name={type:"string",name:"标签名称",value:f.tag_name,tags:[]}:(p=h==null?void 0:h.tagid)!=null&&p.length?this.formState.tagid={type:"string",name:"标签名称",value:f.tagid,tags:h.tagid||[]}:this.formState.tagid={type:"string",name:"标签ID",value:f.tagid,tags:[]},this.formState.next_openid={type:"string",name:"上批尾用户openid",value:f.next_openid,tags:h.next_openid||[]},this.updateSize();return}else n[this.business].params={app_name:{type:"string",name:"公众号名称"},...n[this.business].params};this.defaultHandle(n)},officialTemplateHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};switch(this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},template_name:{type:"string",name:"模板名称",value:n.template_name,tags:[]},touser:{type:"string",name:"接收者",value:n.touser,tags:e.touser||[]}},n.link_type){case 0:this.formState.link_type={type:"string",name:"模板跳转",value:"不跳转",tags:[]};break;case 1:this.formState.link_type={type:"string",name:"模板跳转",value:"跳转链接",tags:[]},this.formState.url={type:"string",name:"跳转链接",value:n.url,tags:e.url||[]};break;case 2:this.formState.link_type={type:"string",name:"模板跳转",value:"跳转小程序",tags:[]},this.formState.miniprogram_app={type:"string",name:"小程序APPID",...n.miniprogram.appid},this.formState.miniprogram_path={type:"string",name:"小程序路径",...n.miniprogram.pagepath};break}this.updateSize()},officialTagHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},openid_list:{type:"string",name:"粉丝openid列表",value:n.openid_list,tags:[]}},n.tag_type==1?this.formState.tag_name={type:"string",name:"标签名称",value:n.tag_name,tags:[]}:this.formState.tagid={type:"string",name:"标签名称",value:n.tagid,tags:e.tagid||[]},this.updateSize()},officialArticleHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};this.formState={url:{type:"string",name:"",value:n.url,tags:e.url||[]},number:{type:"string",name:"",value:n.number,tags:e.number||[]}},this.updateSize()},officialDraftHandle(){var o,i,r,s,a,l,d;let n=((r=(i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},e=((d=(l=(a=(s=this.nodeParams)==null?void 0:s.plugin)==null?void 0:a.params)==null?void 0:l.arguments)==null?void 0:d.tag_map)||{},t=n.article_type?n.article_type=="news"?"图文消息":"图片消息":"--";switch(this.business){case"add_draft":this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},article_type:{type:"string",name:"文章类型",value:t,tags:[]}};break;case"update_draft":case"publish_draft":case"delete_draft":case"preview_message":case"get_draft":default:this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},media_id:{type:"string",name:"文章ID",value:n.media_id,tags:e.media_id||[]}},this.business==="preview_message"&&(this.formState.account={type:"string",name:"接收用户",value:n.account,tags:e.account||[]});break}this.updateSize()},updateSize(){this.$nextTick(()=>{this.resetSize()})}}},Jue={key:0,class:"ding-group-node"},Kue={key:1,class:"ding-group-node"},Zue={class:"label"};function Que(n,e,t,o,i,r){const s=Pt("DynamicRender"),a=Pt("FeishuTableRender"),l=Pt("OfficialSendMessageRender"),d=Pt("at-text"),c=Ai,p=Pt("node-common");return w(),Q(p,{properties:t.properties,title:t.properties.node_name,iconUrl:t.properties.node_icon||i.info.icon,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,style:{"min-width":"320px","min-height":"157px"}},{default:x(()=>[i.isMultiNode?(w(),R("div",Jue,[m(s,{nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])])):(w(),R("div",Kue,[r.isFeishuTbPlugin?(w(),Q(a,{key:0,nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):ne("",!0),r.isOfficialSendMessagePlugin?(w(),Q(l,{key:1,nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):(w(!0),R(se,{key:2},ge(i.formState,(f,h)=>(w(),R("div",{key:h},[u("span",Zue,H(f.name||h)+"：",1),f.value?(w(),Q(c,{key:0},{default:x(()=>[m(d,{options:i.valueOptions,defaultSelectedList:f.tags,defaultValue:f.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Q(c,{key:1},{default:x(()=>[...e[0]||(e[0]=[U("--",-1)])]),_:1}))]))),128))]))]),_:1},8,["properties","title","iconUrl","isSelected","isHovered","node-key"])}const ede=Ne(Yue,[["render",Que],["__scopeId","data-v-13999bab"]]);let tde=class extends on{constructor(e){super(e),this.renderVue(ede,e)}},nde=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const ode={type:"zm-plugins-node",model:nde,view:tde},ide="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cg%20clip-path='url(%23cmdkkm1o9__clip0_12048_97931)'%20stroke='%23fff'%20stroke-width='1.16667'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M6.79163%2013.2109H5.04163V14.9609'/%3e%3cpath%20d='M14.9584%2014.9609H13.2084V13.2109'/%3e%3cpath%20d='M13.2084%206.78906H14.9584V5.03906'/%3e%3cpath%20d='M5.04163%205.03906H6.79163V6.78906'/%3e%3cpath%20d='M6.79163%205.125C5.21015%206.16842%204.16663%207.96112%204.16663%209.99757C4.16663%2010.295%204.18888%2010.5871%204.23181%2010.8726'/%3e%3cpath%20d='M10.875%2015.7708C10.5896%2015.8137%2010.2974%2015.8359%2010%2015.8359C7.96357%2015.8359%206.17086%2014.7924%205.12744%2013.2109'/%3e%3cpath%20d='M15.7682%209.125C15.8111%209.41043%2015.8334%209.70262%2015.8334%2010C15.8334%2012.0364%2014.7898%2013.8291%2013.2084%2014.8726'/%3e%3cpath%20d='M9.125%204.22925C9.41043%204.18632%209.70262%204.16406%2010%204.16406C12.0364%204.16406%2013.8291%205.20758%2014.8726%206.78906'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='cmdkkm1o9__clip0_12048_97931'%3e%3cpath%20fill='%23fff'%20transform='translate(3%203)'%20d='M0%200H14V14H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",rde={class:"preview-img-box"},sde={class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},ade={class:"custom-slick-arrow",style:{right:"10px"}},lde=["onClick","src"],ude={style:{display:"none"}},dde={__name:"index",props:{currentImageList:{type:Array,default:()=>[]}},setup(n){const e=n,t=X(!1),o=X(0),i=r=>{o.value=r,t.value=!0};return(r,s)=>{const a=Ay,l=Dy,d=Oy;return w(),R("div",rde,[m(a,{arrows:"",dots:!1},{prevArrow:x(()=>[u("div",sde,[m(K(Ey))])]),nextArrow:x(()=>[u("div",ade,[m(K(Bu))])]),default:x(()=>[(w(!0),R(se,null,ge(e.currentImageList,(c,p)=>(w(),R("div",{class:"img-list-item",key:c},[u("img",{onClick:f=>i(p),src:c,alt:""},null,8,lde)]))),128))]),_:1}),u("div",ude,[m(d,{preview:{visible:t.value,current:o.value,onVisibleChange:c=>t.value=c}},{default:x(()=>[(w(!0),R(se,null,ge(e.currentImageList,c=>(w(),Q(l,{key:c,src:c},null,8,["src"]))),128))]),_:1},8,["preview"])])])}}},Mm=Ne(dde,[["__scopeId","data-v-b3d114c5"]]),cde={class:"modal-title-block"},pde={key:0,class:"run-detail"},fde={class:"flex-content-box"},hde={class:"test-model-box"},vde={key:2,class:"input-list-box"},_de={class:"add-btn-box"},gde={key:0,class:"result-list-box loading-box"},mde={key:1,class:"result-list-box"},yde=["onClick"],bde={class:"status-block"},xde={class:"icon-name-box"},wde=["src"],Cde={class:"node-name"},kde={key:0,class:"time-tag"},Sde={class:"right-active-icon"},Ede={class:"save-btn-box"},Ade={class:"preview-box"},Dde={class:"preview-title"},Ode={class:"icon-name-box"},Nde=["src"],Mde={class:"node-name"},Tde={key:0,class:"time-tag"},$de={key:0,class:"preview-content-block"},Rde={class:"preview-img-box"},Pde={class:"preview-content-block"},Lde={class:"title-block"},Bde={class:"preview-code-box"},Ide={class:"preview-content-block"},jde={class:"title-block"},Fde={class:"preview-code-box"},Vde={class:"preview-content-block"},Hde={class:"title-block"},Ude={class:"preview-code-box"},zde={__name:"run-test",props:{loop_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const o=Vn(),i=We(()=>o.robotInfo.isLockedByOther),r=n;We(()=>[]);const s=X(!1),a=X(""),l=X([]),d=We(()=>a.value?l.value.filter(D=>D.node_key==a.value)[0]:null),c=We(()=>{let D=[];if(d.value&&d.value.node_type==33){let N=d.value.output;for(let F in N)F.includes("picture_url_")&&D.push(N[F])}return D}),p=X(!1),f=Je({is_draft:!0,robot_key:o.robotInfo.robot_key,question:"",openid:""}),h=async()=>{if(i.value){mt.warning("当前已有其他用户在编辑中，无法运行测试");return}o.robotInfo.loop_save_canvas_status++,await Tt();let D=localStorage.getItem("workflow_loop_run_test_data")||"{}";D=JSON.parse(D),f.question=D.question||"",f.openid=D.openid||"",f.global=D.global||"",l.value=[],a.value="",setTimeout(()=>{_()},1e3),s.value=!0},v=X([]),y=X(!1),g=X(!1),_=()=>{ey({robot_key:f.robot_key,loop_node_key:r.loop_node_key}).then(D=>{y.value=D.data.is_need_question,g.value=D.data.is_need_openid,y.value||(f.question=""),v.value=D.data.loop_test_params.map(N=>({...N,field:{...N.field,Vals:b(N.field)}}))})};function b(D){return D.typ=="string"||D.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const C=(D,N)=>{D.splice(N,1)},T=D=>{D.push({value:"",key:Math.random()*1e4})},M=X(null),S=X(0),k=X(0),A=()=>{M.value.validate().then(()=>{let D={...f,loop_node_key:r.loop_node_key},N=JSON.parse(JSON.stringify(v.value));N.forEach(F=>{F.field.typ.includes("array")&&(F.field.Vals=F.field.Vals.map(Y=>Y.value))}),D.loop_test_params=JSON.stringify(N),p.value=!0,l.value=[],localStorage.setItem("workflow_loop_run_test_data",JSON.stringify({...D})),Qm({...D}).then(F=>{mt.success("测试结果生成完成");let Y=F.data.node_logs||[];S.value=F.data.use_token,k.value=F.data.use_mills,$(Y)}).catch(F=>{l.value=[];let Y=F.data.node_logs||[];Y&&Y.length&&$(Y)}).finally(()=>{p.value=!1})})},$=D=>{var N;l.value=D.map(F=>({...F,is_success:F.error_msg==="<nil>",node_icon:xa(F.node_type)})),a.value=(N=l.value[0])==null?void 0:N.node_key},B=D=>{a.value=D.node_key},O=D=>{Ts(JSON.stringify(d.value[D])),mt.success("复制成功")};function P(D){return D.field.key.replace(D.node_key+".","")}return e({open:()=>{h()}}),(D,N)=>{const F=Ai,Y=ko,L=en,j=Cn,le=Mn,z=In,V=Xt,J=xn,oe=ho,W=_n;return w(),R("div",null,[m(W,{open:s.value,"onUpdate:open":N[5]||(N[5]=q=>s.value=q),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[u("div",cde,[N[6]||(N[6]=U("运行测试 ",-1)),l.value.length?(w(),R("div",pde,[u("span",null,"总耗时："+H(K(Kc)(k.value)),1),u("span",null,"token消耗："+H(S.value)+" Tokens",1)])):ne("",!0)])]),default:x(()=>[u("div",fde,[u("div",hde,[N[13]||(N[13]=u("div",{class:"top-title"},"开始节点参数",-1)),m(J,{model:f,ref_key:"formRef",ref:M,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[y.value?(w(),Q(j,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:x(()=>[m(Y,{gap:4},{default:x(()=>[N[8]||(N[8]=U("question ",-1)),m(F,{style:{margin:"0"}},{default:x(()=>[...N[7]||(N[7]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[m(L,{placeholder:"请输入",value:f.question,"onUpdate:value":N[0]||(N[0]=q=>f.question=q)},null,8,["value"])]),_:1})):ne("",!0),g.value?(w(),Q(j,{key:1,name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:x(()=>[m(Y,{gap:4},{default:x(()=>[N[10]||(N[10]=U("openid ",-1)),m(F,{style:{margin:"0"}},{default:x(()=>[...N[9]||(N[9]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[m(L,{placeholder:"请输入",value:f.openid,"onUpdate:value":N[1]||(N[1]=q=>f.openid=q)},null,8,["value"])]),_:1})):ne("",!0),(w(!0),R(se,null,ge(v.value,q=>(w(),Q(j,{key:q.node_key,rules:[{required:q.field.required,message:`请输入${q.node_name}`}]},{label:x(()=>[m(Y,{gap:4},{default:x(()=>[U(H(q.node_name)+" "+H(P(q)),1),m(F,{style:{margin:"0"}},{default:x(()=>[U(H(q.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[q.field.typ=="string"?(w(),Q(L,{key:0,placeholder:"请输入",value:q.field.Vals,"onUpdate:value":re=>q.field.Vals=re},null,8,["value","onUpdate:value"])):ne("",!0),q.field.typ=="number"?(w(),Q(le,{key:1,style:{width:"100%"},placeholder:"请输入",value:q.field.Vals,"onUpdate:value":re=>q.field.Vals=re},null,8,["value","onUpdate:value"])):ne("",!0),q.field.typ.includes("array")?(w(),R("div",vde,[(w(!0),R(se,null,ge(q.field.Vals,(re,ue)=>(w(),R("div",{class:"input-list-item",key:ue},[m(z,null,{default:x(()=>[m(L,{placeholder:"请输入",value:re.value,"onUpdate:value":xe=>re.value=xe},null,8,["value","onUpdate:value"])]),_:2},1024),q.field.Vals.length>1?(w(),Q(K(Ut),{key:0,onClick:xe=>C(q.field.Vals,ue)},null,8,["onClick"])):ne("",!0)]))),128)),u("div",_de,[m(V,{onClick:re=>T(q.field.Vals),block:"",type:"dashed"},{default:x(()=>[...N[11]||(N[11]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ne("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),p.value?(w(),R("div",gde,[p.value?(w(),Q(oe,{key:0,tip:"测试结果生成中..."})):ne("",!0)])):ne("",!0),l.value.length>0?(w(),R("div",mde,[(w(!0),R(se,null,ge(l.value,(q,re)=>(w(),R("div",{class:xt(["list-item-block",{active:a.value==q.node_key}]),onClick:ue=>B(q),key:re},[u("div",bde,[q.is_success?(w(),Q(K(za),{key:0,style:{color:"#138b1b"}})):(w(),Q(K(Lu),{key:1,style:{color:"#d81e06"}}))]),u("div",xde,[u("img",{src:q.node_icon,alt:""},null,8,wde),u("div",Cde,H(q.node_name),1)]),q.is_success?(w(),R("div",kde,H(q.use_time)+"ms",1)):ne("",!0),u("div",Sde,[m(K(Bu))])],10,yde))),128))])):ne("",!0),u("div",Ede,[m(V,{loading:p.value,onClick:A,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[m(K(ai)),N[12]||(N[12]=U("运行测试",-1))]),_:1},8,["loading"])])]),u("div",Ade,[d.value?(w(),R(se,{key:0},[u("div",Dde,[N[14]||(N[14]=u("div",{class:"title-text"},"日志详情",-1)),u("div",Ode,[u("img",{src:d.value.node_icon,alt:""},null,8,Nde),u("div",Mde,H(d.value.node_name),1)]),d.value.is_success?(w(),R("div",Tde,H(d.value.use_time)+"ms",1)):ne("",!0)]),c.value.length>0?(w(),R("div",$de,[N[15]||(N[15]=u("div",{class:"title-block"},"生成图像日志",-1)),u("div",Rde,[m(Mm,{currentImageList:c.value},null,8,["currentImageList"])])])):ne("",!0),u("div",Pde,[u("div",Lde,[N[16]||(N[16]=U("输入",-1)),m(K(Po),{onClick:N[2]||(N[2]=q=>O("input"))})]),u("div",Bde,[m(K(Bo),{data:d.value.input},null,8,["data"])])]),u("div",Ide,[u("div",jde,[N[17]||(N[17]=U("输出",-1)),m(K(Po),{onClick:N[3]||(N[3]=q=>O("node_output"))})]),u("div",Fde,[m(K(Bo),{data:d.value.node_output},null,8,["data"])])]),u("div",Vde,[u("div",Hde,[N[18]||(N[18]=U("运行日志",-1)),m(K(Po),{onClick:N[4]||(N[4]=q=>O("output"))})]),u("div",Ude,[m(K(Bo),{data:d.value.output},null,8,["data"])])])],64)):ne("",!0)])])]),_:1},8,["open"])])}}},qde=Ne(zde,[["__scopeId","data-v-f3ffaa8e"]]),Gde={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(w(),R(se,null,[u("div",{class:xt(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),u("div",{class:xt(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),u("div",{class:xt(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),u("div",{class:xt(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},Xde=Ne(Gde,[["__scopeId","data-v-82fe400e"]]),Wde={class:"custom-group-content"},Yde={class:"top-block"},Jde={class:"title-block"},Kde={class:"title-text"},Zde={class:"btn-block"},Qde={class:"info-block"},ece={class:"info-item"},tce={class:"info-content"},nce={key:0,class:"label-text"},oce={key:1,class:"label-text"},ice={key:2,class:"label-value"},rce={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("getGraph"),o=Ve("getNode"),i=Ve("addNode"),r=Ve("setData"),s=Ve("resetSize"),a=X(["custom-group","batch-group","end-node","qa-node"]),l=X(!1),d=We(()=>o().id),c=b=>{i(b),l.value=!1},p=()=>{l.value=!0},f=X(null),h=()=>{f.value.open()},v=Je({loop_type:"array",loop_number:"",loop_arrays:[{key:"",typ:"array",value:"",cu_key:Math.random()*1e4}],intermediate_params:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}],output:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}]}),y=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(b).loop||{}}catch{C={}}C=JSON.parse(JSON.stringify(C)),v.loop_type=C.loop_type,v.loop_number=C.loop_number,v.loop_arrays=C.loop_arrays,v.intermediate_params=C.intermediate_params,v.output=C.output,Tt(()=>{s()})},g=()=>{const b=JSON.stringify({loop:{...v}});r({...e.node,...v,node_params:b})};ct(()=>e.properties,()=>{y()},{deep:!0});const _=()=>{let b=o();t().deleteNode(b.id)};return at(()=>{y(),s(),g()}),(b,C)=>{const T=Zt,M=jr,S=Vr,k=Fr,A=Hr;return w(),R("div",Wde,[m(Xde,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),u("div",{class:"header-box",style:Fn({background:n.properties.node_header_bg_color})},[u("div",Yde,[u("div",Jde,[C[2]||(C[2]=u("img",{src:ide,alt:""},null,-1)),u("div",Kde,H(e.properties.node_name),1)]),u("div",Zde,[m(M,{title:null,trigger:"click",open:l.value,"onUpdate:open":C[0]||(C[0]=$=>l.value=$),arrow:!1,placement:"right"},{content:x(()=>[m(Iu,{style:{height:"550px"},excludedNodeTypes:a.value,onAddNode:c,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:x(()=>[m(T,{title:"新建内部节点"},{default:x(()=>[u("div",{class:"btn-item",onClick:Ct(p,["stop"])},[m(K(Bn))])]),_:1})]),_:1},8,["open"]),m(T,{title:"运行测试"},{default:x(()=>[u("div",{class:"btn-item",onClick:Ct(h,["stop"])},[m(K(ai))])]),_:1}),m(A,{trigger:"click"},{overlay:x(()=>[m(k,null,{default:x(()=>[m(S,{onClick:_},{default:x(()=>[...C[4]||(C[4]=[u("div",{style:{color:"#fb363f"}},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[u("div",{class:"btn-item",onClick:C[1]||(C[1]=Ct(()=>{},["stop"]))},[...C[3]||(C[3]=[u("img",{class:"btn-icon",src:$p,alt:""},null,-1)])])]),_:1})])]),u("div",Qde,[u("div",ece,[C[5]||(C[5]=u("div",{class:"info-label"},"循环类型",-1)),u("div",tce,[v.loop_type=="array"?(w(),R("div",nce,"使用数组循环")):ne("",!0),v.loop_type=="number"?(w(),R("div",oce,"指定循环次数")):ne("",!0),v.loop_type=="number"?(w(),R("div",ice,H(v.loop_number),1)):ne("",!0)])])])],4),C[6]||(C[6]=u("div",{class:"node-body"},[u("div",{class:"node-content"})],-1)),m(qde,{ref_key:"runTestRef",ref:f,loop_node_key:d.value},null,8,["loop_node_key"])])}}},sce=Ne(rce,[["__scopeId","data-v-c9c034b0"]]);function Tm(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],d="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,d=`【${c}】`;let p={label:s,value:d,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return p.children&&p.children.length>0&&(p.children=Tm(p.children,p)),p})}let ace=class extends el.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:o,height:i,x:r,y:s}=t;return this.div=et("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(et("foreignObject",{x:r-o/2,y:s-i/2,width:o,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=St(sce,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=rr({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,o=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:o,height:t},this.props.model._width=o,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,Tt(()=>{this.props.model.properties={...this.props.model.properties,...t};let o=null;this.r&&this.r.el&&(o=this.r.el.clientHeight),this.props.model._height=o||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),o=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(o)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(v=>v.sourceAnchorId),i=t.map(v=>v.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,d=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=et("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:d,fill:"#fff",stroke:"#2475FC","stroke-width":2}),p=et("g",{className:"custom-anchor-arrow",transform:`translate(${s-d-2}, ${a-d-2})`},[et("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),et("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),f=et("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-d-2}, ${a-d-2})`},[et("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),et("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),et("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return et("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:v=>{v.stopPropagation();const{graphModel:y,model:g}=this.props;l==="right"&&!r&&y.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:g})}},c,p,f)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}},lce=class extends el.model{initNodeData(e){super.initNodeData(e),this.DEFAULT_TOP_Z_INDEX=Number.MAX_SAFE_INTEGER,this.DEFAULT_BOTTOM_Z_INDEX=1,this.topGroupZIndex=1,this.width=e.width||600,this.height=e.height||420,this.zIndex=1,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}setSelected(e){super.setSelected(e)}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(d=>d.type==="start-node");r&&(t.add(r.id),e.push(r));const s=d=>{for(let c=0;c<d.length;c++){let f=d[c].sourceNode;t.has(f.id)||(t.add(f.id),fs.includes(f.type)&&e.push(f),s(f.incoming.edges))}};s(o),i.filter(d=>d.properties.loop_parent_key==this.id).forEach(d=>{e.push(d)});let l=[];for(const d of e){if(!fs.includes(d.type))continue;let c=JSON.parse(d.properties.node_params),p={label:d.properties.node_name,value:d.id,node_id:d.id,node_type:d.properties.node_type,typ:"node",children:[],loop_parent_key:d.properties.loop_parent_key,group_node_key:this.id};if(d.type==="http-node"&&(p.children=c.curl.output),d.type==="http-tool-node"&&(p.children=c.curl.output),d.type==="code-run-node"&&(p.children=c.code_run.output),d.type==="parameter-extraction-node"&&(p.children=c.params_extractor.output),d.type==="start-node"&&(p.children=[...c.start.diy_global,...c.start.sys_global]),d.type==="custom-group"&&(p.children=c.loop.output),d.type==="import-library-node"&&(p.children=c.library_import.outputs),d.type==="qa-node"&&(p.children=c.question.outputs),d.type==="json-node"&&(p.children=c.json_encode.output),d.type==="json-reverse-node"&&(p.children=c.json_decode.output),d.type==="select-data-node"&&(p.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),d.type==="knowledge-base-node"&&(p.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),d.type==="ai-dialogue-node"&&(p.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),d.type==="specify-reply-node"&&(p.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),d.type==="immediately-reply-node"&&(p.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),d.type==="problem-optimization-node"&&(p.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),d.type==="mcp-node"&&(p.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),d.type==="image-generation-node"){let f=c.image_generation.image_num;if(f>0){let h=[];for(let v=0;v<+f;v++){let y=String.fromCharCode(97+v);h.push({key:`picture_url_${y}`,typ:"string",name:`picture_url_${y}`,label:`picture_url_${y}`})}p.children=h}}if(d.type==="zm-plugins-node"){let f=c.plugin.output_obj?JSON.parse(JSON.stringify(c.plugin.output_obj)):[];const h=v=>{v.forEach(y=>{y.name=y.key||"",y.subs&&y.subs.length>0&&h(y.subs)})};h(f),p.children=f||[]}p.children.forEach(f=>{f.node_id=d.id,f.node_name=d.properties.node_name,f.node_type=d.properties.node_type}),p.children=Tm(p.children,null),l.push(p)}return l}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}};const uce={type:"custom-group",view:ace,model:lce},dce={name:"groupStartNode",components:{NodeCommon:sn},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{}},computed:{},watch:{properties:{handler(){},deep:!0}},mounted(){},methods:{}};function cce(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"200px"}},null,8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const pce=Ne(dce,[["render",cce],["__scopeId","data-v-d1edd3b9"]]);let fce=class extends on{constructor(e){super(e),this.renderVue(pce,e)}},hce=class extends rn{setAttributes(){this.width=200,this.height=72;const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const vce={type:"group-start-node",model:hce,view:fce},_ce={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:sn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function gce(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:r.handleMenu,style:{width:"420px",height:"94px"}},{default:x(()=>[...e[0]||(e[0]=[u("div",{class:"end-node"},[u("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const mce=Ne(_ce,[["render",gce],["__scopeId","data-v-ce48c961"]]);let yce=class extends on{constructor(e){super(e),this.renderVue(mce,e)}},bce=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}]}};const xce={type:"terminate-node",model:bce,view:yce},wce={class:"start-node"},Cce={key:0,class:"start-node-options"},kce={class:"options-list"},Sce={class:"options-item"},Ece={key:0,class:"option-label"},Ace={key:1,class:"option-label"},Dce={key:2,class:"option-label"},Oce={key:0},Nce={key:1,class:"start-node-options"},Mce={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Ve("resetSize"),t=n;ct(()=>t.properties,(s,a)=>{const l=s.node_params||"{}",d=a.node_params||"{}";l!=d&&r()},{deep:!0});let o={1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六",0:"星期日"};const i=Je({type:"select_time",every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""}),r=()=>{if(!t.properties||!t.properties.node_params)return;let a=JSON.parse(t.properties.node_params).trigger.cron_config||{};Object.assign(i,a),Tt(()=>{e()})};return at(()=>{r()}),(s,a)=>(w(),Q(sn,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",wce,[i.type=="select_time"?(w(),R("div",Cce,[a[1]||(a[1]=u("div",{class:"options-title"},"执行时间",-1)),u("div",kce,[u("div",Sce,[i.every_type=="day"?(w(),R("div",Ece," 每天 "+H(i.hour_minute),1)):ne("",!0),i.every_type=="week"?(w(),R("div",Ace," 每周 "+H(K(o)[i.week_number])+" "+H(i.hour_minute),1)):ne("",!0),i.every_type=="month"?(w(),R("div",Dce,[a[0]||(a[0]=U(" 每月 ",-1)),i.month_day?(w(),R("span",Oce,H(i.month_day)+"号",1)):ne("",!0),U(" "+H(i.hour_minute),1)])):ne("",!0)])])])):(w(),R("div",Nce,[...a[2]||(a[2]=[u("div",{class:"options-title"},"执行时间",-1),u("div",{class:"options-list"},[u("div",{class:"options-item"},[u("div",{class:"option-label"},"Linux Crontab代码")])],-1)])]))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Tce=Ne(Mce,[["__scopeId","data-v-3d63d637"]]);let $ce=class extends on{constructor(e){super(e),this.renderVue(Tce,e)}},Rce=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const Pce={type:"timing-trigger-node",model:Rce,view:$ce},Lce={class:"start-node"},Bce={class:"start-node-options"},Ice={class:"options-list"},jce={class:"options-item"},Fce={class:"option-label"},Vce={class:"start-node-options"},Hce={class:"options-list"},Uce={class:"option-label"},zce={key:0,class:"options-item"},qce={class:"start-node-options"},Gce={class:"options-list"},Xce={class:"option-label"},Wce={class:"option-type"},Yce={key:0,class:"options-item"},Jce={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Rs(),t=Ve("resetSize"),o=n,i=We(()=>e.officialList);ct(()=>o.properties,(f,h)=>{const v=f.node_params||"{}",y=h.node_params||"{}";v!=y&&c()},{deep:!0});let r={message:"私信消息",subscribe_unsubscribe:"关注/取消关注事件",qrcode_scan:"扫描带参数二维码事件",menu_click:"自定义菜单事件"};const s=Je({msg_type:"",app_ids:[]}),a=We(()=>s.app_ids.map(f=>i.value.find(h=>h.app_id==f)).filter(Boolean)),l=X([]),d=We(()=>[...l.value]),c=()=>{if(!o.properties||!o.properties.node_params)return;let f=JSON.parse(o.properties.node_params);l.value=f.trigger.outputs||[];let h=f.trigger.trigger_official_config;s.msg_type=h.msg_type,s.app_ids=h.app_ids?h.app_ids.split(","):[],Tt(()=>{t()})},p=()=>{let f=i.value.find(h=>h.app_id=="sdwdw");a.value};return at(()=>{c()}),(f,h)=>(w(),Q(sn,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Lce,[u("div",Bce,[h[0]||(h[0]=u("div",{class:"options-title"},"触发事件",-1)),u("div",Ice,[u("div",jce,[u("div",Fce,H(K(r)[s.msg_type]),1)])])]),u("div",Vce,[u("div",{class:"options-title",onClick:p},"公众号"),u("div",Hce,[(w(!0),R(se,null,ge(a.value.slice(0,1),v=>(w(),R("div",{class:"options-item",key:v.app_id},[u("div",Uce,H(v.app_name),1)]))),128)),a.value.length>1?(w(),R("div",zce,[...h[1]||(h[1]=[u("div",{class:"option-label"},"...",-1)])])):ne("",!0)])]),u("div",qce,[h[3]||(h[3]=u("div",{class:"options-title"},"输出",-1)),u("div",Gce,[(w(!0),R(se,null,ge(d.value.slice(0,2),v=>(w(),R("div",{class:xt(["options-item",{"is-required":v.required}]),key:v.key},[u("div",Xce,H(v.key),1),u("div",Wce,H(v.typ),1)],2))),128)),d.value.length>2?(w(),R("div",Yce,[...h[2]||(h[2]=[u("div",{class:"option-label"},"...",-1)])])):ne("",!0)])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Kce=Ne(Jce,[["__scopeId","data-v-06de59d3"]]);let Zce=class extends on{constructor(e){super(e),this.renderVue(Kce,e)}},Qce=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const epe={type:"official-trigger-node",model:Qce,view:Zce},tpe="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cpath%20d='M12.4647%206.7C12.573%206.69991%2012.6803%206.72119%2012.7804%206.76263C12.8805%206.80406%2012.9714%206.86484%2013.048%206.94148C13.1246%207.01811%2013.1853%207.1091%2013.2266%207.20923C13.268%207.30936%2013.2892%207.41667%2013.289%207.525V14.675C13.289%2014.8937%2013.2022%2015.1034%2013.0476%2015.2581C12.893%2015.4128%2012.6834%2015.4998%2012.4647%2015.5H5.32363C5.21533%2015.5001%205.10807%2015.4788%205.00801%2015.4374C4.90796%2015.3959%204.81706%2015.3351%204.74055%2015.2585C4.66403%2015.1818%204.6034%2015.0908%204.56212%2014.9907C4.52084%2014.8906%204.49973%2014.7833%204.5%2014.675V7.525C4.5%207.30643%204.58673%207.0968%204.74115%206.94212C4.89557%206.78744%205.10506%206.70036%205.32363%206.7H12.4654H12.4647ZM8.8945%208.7625C8.82228%208.76241%208.75075%208.77658%208.68402%208.80419C8.61729%208.83181%208.55667%208.87233%208.50563%208.92343C8.4546%208.97453%208.41415%209.0352%208.38662%209.10197C8.35909%209.16873%208.34501%209.24028%208.34519%209.3125V10.55H7.10906C7.00013%2010.5497%206.89358%2010.5818%206.80294%2010.6423C6.71231%2010.7027%206.64168%2010.7887%206.60005%2010.8894C6.55841%2010.99%206.54765%2011.1008%206.56912%2011.2076C6.59059%2011.3144%206.64332%2011.4124%206.72063%2011.4891C6.82375%2011.5922%206.96331%2011.65%207.10906%2011.65H8.34519V12.8875C8.34537%2012.9961%208.37768%2013.1021%208.43804%2013.1924C8.4984%2013.2826%208.58412%2013.3529%208.68439%2013.3946C8.78466%2013.4362%208.895%2013.4472%209.00151%2013.4262C9.10803%2013.4052%209.20595%2013.3532%209.28294%2013.2766C9.334%2013.2255%209.37449%2013.1648%209.40209%2013.0981C9.42969%2013.0313%209.44387%2012.9597%209.44381%2012.8875V11.65H10.6799C10.7887%2011.6501%2010.8951%2011.618%2010.9856%2011.5576C11.0761%2011.4972%2011.1466%2011.4113%2011.1882%2011.3108C11.2298%2011.2103%2011.2406%2011.0996%2011.2193%2010.993C11.198%2010.8863%2011.1454%2010.7883%2011.0684%2010.7116C11.0174%2010.6604%2010.9569%2010.6198%2010.8902%2010.5921C10.8236%2010.5644%2010.7521%2010.5501%2010.6799%2010.55H9.44313V9.3125C9.44313%209.16675%209.38527%209.02696%209.28228%208.92383C9.17928%208.82071%209.03956%208.76268%208.89381%208.7625H8.8945ZM14.8139%204.5C14.9839%204.5003%2015.1477%204.56357%2015.2738%204.67758C15.3999%204.7916%2015.4792%204.94828%2015.4966%205.11737L15.5%205.1875V12.0666C15.5003%2012.1982%2015.4628%2012.327%2015.392%2012.4379C15.3213%2012.5488%2015.2202%2012.637%2015.1007%2012.6922C14.9813%2012.7473%2014.8486%2012.7671%2014.7183%2012.7491C14.588%2012.731%2014.4656%2012.676%2014.3656%2012.5905C14.2316%2012.4752%2014.1471%2012.3127%2014.1298%2012.1367L14.1264%2012.0666V6.14931C14.1263%206.08512%2014.1038%206.02296%2014.0628%205.97361C14.0217%205.92427%2013.9647%205.89084%2013.9016%205.87912L13.8521%205.87431H7.93269C7.76272%205.87433%207.5988%205.81127%207.47268%205.69734C7.34655%205.58341%207.2672%205.42672%207.25%205.25762L7.24656%205.1875C7.24649%205.01749%207.30941%204.85349%207.42318%204.72715C7.53694%204.60082%207.69348%204.52112%207.86256%204.50344L7.93338%204.5H14.8125H14.8139Z'%20fill='%23fff'/%3e%3c/svg%3e",npe={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(w(),R(se,null,[u("div",{class:xt(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),u("div",{class:xt(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),u("div",{class:xt(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),u("div",{class:xt(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},ope=Ne(npe,[["__scopeId","data-v-e7122931"]]),ipe={class:"custom-group-content"},rpe={class:"top-block"},spe={class:"title-block"},ape={class:"title-text"},lpe={class:"btn-block"},upe={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("getGraph"),o=Ve("getNode"),i=Ve("addNode");Ve("setData");const r=Ve("resetSize"),s=X(["custom-group","batch-group","end-node","terminate-node","qa-node"]),a=X(!1),l=We(()=>o().id),d=g=>{i(g),a.value=!1},c=()=>{a.value=!0},p=X(null),f=()=>{let g=h.batch_arrays[0];g&&g.key&&g.typ&&g.value?p.value.open():mt.error("请填写执行数组")},h=Je({chan_number:10,max_run_number:500,batch_arrays:[{key:"",typ:"",value:"",_id:ls(16)}],output:[{key:"",typ:"",value:"",_id:ls(16)}]}),v=()=>{const g=e.properties.dataRaw||e.properties.node_params||"{}";let _={};try{_=JSON.parse(g).batch||{}}catch{_={}}h.chan_number=_.chan_number,h.batch_arrays=_.batch_arrays,h.output=_.output,Tt(()=>{r()})};ct(()=>e.properties,(g,_)=>{JSON.stringify(g)!==JSON.stringify(_)&&v()},{deep:!0});const y=()=>{let g=o();t().deleteNode(g.id)};return at(()=>{v(),r()}),(g,_)=>{const b=Zt,C=jr,T=Vr,M=Fr,S=Hr;return w(),R("div",ipe,[m(ope,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),u("div",{class:"header-box",style:Fn({background:n.properties.node_header_bg_color})},[u("div",rpe,[u("div",spe,[_[2]||(_[2]=u("img",{src:tpe,alt:""},null,-1)),u("div",ape,H(e.properties.node_name),1)]),u("div",lpe,[m(C,{title:null,trigger:"click",open:a.value,"onUpdate:open":_[0]||(_[0]=k=>a.value=k),placement:"right"},{content:x(()=>[m(Iu,{excludedNodeTypes:s.value,onAddNode:d,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:x(()=>[m(b,{title:"新建内部节点"},{default:x(()=>[u("div",{class:"btn-item",onClick:Ct(c,["stop"])},[m(K(Bn))])]),_:1})]),_:1},8,["open"]),m(b,{title:"运行测试"},{default:x(()=>[u("div",{class:"btn-item",onClick:Ct(f,["stop"])},[m(K(ai))])]),_:1}),m(S,{trigger:"click"},{overlay:x(()=>[m(M,null,{default:x(()=>[m(T,{onClick:y},{default:x(()=>[..._[4]||(_[4]=[u("div",{style:{color:"#fb363f"}},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[u("div",{class:"btn-item",onClick:_[1]||(_[1]=Ct(()=>{},["stop"]))},[..._[3]||(_[3]=[u("img",{class:"btn-icon",src:$p,alt:""},null,-1)])])]),_:1})])]),_[5]||(_[5]=Hm('<div class="info-block" data-v-1aeb9262><div class="info-item" data-v-1aeb9262><div class="info-label" data-v-1aeb9262>执行数组</div><div class="info-content" data-v-1aeb9262><div class="label-text" data-v-1aeb9262>input</div></div></div></div>',1))],4),_[6]||(_[6]=u("div",{class:"node-body"},[u("div",{class:"node-content"})],-1)),m(I_,{ref_key:"runTestRef",ref:p,batch_node_key:l.value},null,8,["batch_node_key"])])}}},dpe=Ne(upe,[["__scopeId","data-v-1aeb9262"]]);function $m(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],d="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,d=`【${c}】`;let p={label:s,value:d,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return p.children&&p.children.length>0&&(p.children=$m(p.children,p)),p})}class cpe extends el.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:o,height:i,x:r,y:s}=t;return this.div=et("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(et("foreignObject",{x:r-o/2,y:s-i/2,width:o,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=St(dpe,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=rr({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,o=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:o,height:t},this.props.model._width=o,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,Tt(()=>{this.props.model.properties={...this.props.model.properties,...t};let o=null;this.r&&this.r.el&&(o=this.r.el.clientHeight),this.props.model._height=o||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),o=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(o)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(v=>v.sourceAnchorId),i=t.map(v=>v.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,d=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=et("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:d,fill:"#fff",stroke:"#2475FC","stroke-width":2}),p=et("g",{className:"custom-anchor-arrow",transform:`translate(${s-d-2}, ${a-d-2})`},[et("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),et("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),f=et("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-d-2}, ${a-d-2})`},[et("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),et("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),et("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return et("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:v=>{v.stopPropagation();const{graphModel:y,model:g}=this.props;l==="right"&&!r&&y.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:g})}},c,p,f)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}}class ppe extends el.model{initNodeData(e){super.initNodeData(e),this.width=e.width||600,this.height=e.height||420,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(d=>d.type==="start-node");r&&(t.add(r.id),e.push(r));const s=d=>{for(let c=0;c<d.length;c++){let f=d[c].sourceNode;t.has(f.id)||(t.add(f.id),fs.includes(f.type)&&e.push(f),s(f.incoming.edges))}};s(o),i.filter(d=>d.properties.loop_parent_key==this.id).forEach(d=>{e.push(d)});let l=[];for(const d of e){if(!fs.includes(d.type))continue;let c=JSON.parse(d.properties.node_params),p={label:d.properties.node_name,value:d.id,node_id:d.id,node_type:d.properties.node_type,typ:"node",children:[],loop_parent_key:d.properties.loop_parent_key,group_node_key:this.id};if(d.type==="http-node"&&(p.children=c.curl.output),d.type==="http-tool-node"&&(p.children=c.curl.output),d.type==="code-run-node"&&(p.children=c.code_run.output),d.type==="parameter-extraction-node"&&(p.children=c.params_extractor.output),d.type==="start-node"&&(p.children=[...c.start.diy_global,...c.start.sys_global]),d.type==="custom-group"&&(p.children=c.loop.output),d.type==="import-library-node"&&(p.children=c.library_import.outputs),d.type==="json-node"&&(p.children=c.json_encode.output),d.type==="json-reverse-node"&&(p.children=c.json_decode.output),d.type==="select-data-node"&&(p.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),d.type==="knowledge-base-node"&&(p.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),d.type==="ai-dialogue-node"&&(p.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),d.type==="specify-reply-node"&&(p.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),d.type==="immediately-reply-node"&&(p.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),d.type==="problem-optimization-node"&&(p.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),d.type==="mcp-node"&&(p.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),d.type==="image-generation-node"){let f=c.image_generation.image_num;if(f>0){let h=[];for(let v=0;v<+f;v++){let y=String.fromCharCode(97+v);h.push({key:`picture_url_${y}`,typ:"string",name:`picture_url_${y}`,label:`picture_url_${y}`})}p.children=h}}if(d.type==="zm-plugins-node"){let f=c.plugin.output_obj?JSON.parse(JSON.stringify(c.plugin.output_obj)):[];const h=v=>{v.forEach(y=>{y.name=y.key||"",y.subs&&y.subs.length>0&&h(y.subs)})};h(f),p.children=f||[]}p.children.forEach(f=>{f.node_id=d.id,f.node_name=d.properties.node_name,f.node_type=d.properties.node_type}),p.children=$m(p.children,null),l.push(p)}return l}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const fpe={type:"batch-group",view:cpe,model:ppe},hpe={class:"ai-dialogue-node"},vpe={class:"field-list"},_pe={class:"field-item"},gpe={class:"field-item-content"},mpe={class:"field-value"},ype={class:"field-key"},bpe={class:"field-item"},xpe={class:"field-item-content"},wpe={class:"field-value"},Cpe={class:"field-key"},kpe={class:"field-item"},Spe={class:"options-list"},Epe={class:"option-label"},Ape={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("getNode"),o=Ve("resetSize"),i=X([]),r=X([]),s=Je({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[],image_watermark:"1",image_optimize_prompt:"1"}),a=We(()=>{let c=["msg"];if(s.image_num>0)for(let p=0;p<+s.image_num;p++){let f=String.fromCharCode(97+p);c.push(`picture_url_${f}`)}return c}),l=()=>{const c=e.properties.dataRaw||e.properties.node_params||"{}";let p={};try{d(),p=JSON.parse(c).image_generation||{},s.model_config_id=p.model_config_id,s.use_model=p.use_model,s.size=p.size,s.image_num=p.image_num,s.prompt=p.prompt,s.prompt_tags=p.prompt_tags,s.input_images=p.input_images,s.image_watermark=p.image_watermark,s.image_optimize_prompt=p.image_optimize_prompt}catch{p={}}Tt(()=>{o()})};function d(){let c=t().getAllParentVariable();i.value=c||[]}return ct(()=>e.properties,(c,p)=>{const f=c.dataRaw||c.node_params||"{}",h=p.dataRaw||p.node_params||"{}";f!=h&&l()},{deep:!0}),at(()=>{l(),o()}),Wn(()=>{}),(c,p)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:r.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",hpe,[u("div",vpe,[u("div",_pe,[p[0]||(p[0]=u("div",{class:"field-item-label"},"模型",-1)),u("div",gpe,[u("div",mpe,[u("span",ype,[m(tl,{useModel:s.use_model,modelConfigId:s.model_config_id},null,8,["useModel","modelConfigId"])])])])]),u("div",bpe,[p[1]||(p[1]=u("div",{class:"field-item-label"},"提示词",-1)),u("div",xpe,[u("div",wpe,[u("span",Cpe,[m(vn,{options:i.value,defaultSelectedList:s.prompt_tags,defaultValue:s.prompt,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])])])])]),u("div",kpe,[p[3]||(p[3]=u("div",{class:"field-item-label"},"输出",-1)),u("div",Spe,[(w(!0),R(se,null,ge(a.value,f=>(w(),R("div",{class:"options-item",key:f},[u("div",Epe,H(f),1),p[2]||(p[2]=u("div",{class:"option-type"},"string",-1))]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Dpe=Ne(Ape,[["__scopeId","data-v-59537c8a"]]);let Ope=class extends on{constructor(e){super(e),this.renderVue(Dpe,e)}},Npe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Mpe={type:"image-generation-node",model:Npe,view:Ope},Tpe={class:"ai-dialogue-node"},$pe={class:"field-list"},Rpe={class:"field-item"},Ppe={class:"field-item-content"},Lpe={class:"field-list-item"},Bpe={class:"field-text"},Ipe={key:1},jpe={class:"field-item"},Fpe={class:"field-item-content"},Vpe={class:"field-key"},Hpe={class:"field-type"},Upe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph"),i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=X([]),l=Je({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),d=()=>{const h=e.properties.dataRaw||e.properties.node_params||"{}";let v={};try{v=JSON.parse(h).json_encode||{}}catch{v={}}f(),v=JSON.parse(JSON.stringify(v)),l.input_variable=v.input_variable,l.input_tags=v.input_tags||[],l.output=v.output,Tt(()=>{r()})},c=()=>{const h=JSON.stringify({json_encode:{...l}});t({...e.node,node_params:h})},p=h=>{vo.includes(h.node_type)&&Tt(()=>{c()})},f=()=>{let h=i().getAllParentVariable();a.value=h||[]};return ct(()=>e.properties,d,{deep:!0}),at(()=>{d(),r(),o().eventCenter.on("custom:setNodeName",p)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",p)}),(h,v)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Tpe,[u("div",$pe,[u("div",Rpe,[v[0]||(v[0]=u("div",{class:"field-item-label"},"输入参数",-1)),u("div",Ppe,[u("div",Lpe,[u("div",Bpe,[l.input_variable.length>0?(w(),Q(vn,{key:0,options:a.value,defaultSelectedList:l.input_tags,defaultValue:l.input_variable,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R("span",Ipe,"--"))])])])]),u("div",jpe,[v[1]||(v[1]=u("div",{class:"field-item-label"},"输出字段",-1)),u("div",Fpe,[(w(!0),R(se,null,ge(l.output,(y,g)=>(w(),R("div",{class:"field-value",key:g},[u("span",Vpe,H(y.key),1),u("span",Hpe,H(y.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zpe=Ne(Upe,[["__scopeId","data-v-f18561b5"]]);let qpe=class extends on{constructor(e){super(e),this.renderVue(zpe,e)}},Gpe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Xpe={type:"json-node",model:Gpe,view:qpe},Wpe={class:"ai-dialogue-node"},Ype={class:"field-list"},Jpe={class:"field-item"},Kpe={class:"field-item-content"},Zpe={class:"field-list-item"},Qpe={class:"field-text"},efe={class:"field-item"},tfe={class:"field-item-content"},nfe={class:"field-key"},ofe={class:"field-type"},ife={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=Ve("setData"),o=Ve("getGraph");Ve("getNode");const i=Ve("resetSize"),r=X([]),s=Je({input_variable:[],output:[{key:"",typ:"object",subs:[]}]}),a=()=>{const c=e.properties.dataRaw||e.properties.node_params||"{}";let p={};try{p=JSON.parse(c).json_decode||{}}catch{p={}}p=JSON.parse(JSON.stringify(p)),s.input_variable=v_(p.input_variable),s.output=p.output,Tt(()=>{i()})},l=()=>{const c=JSON.stringify({json_decode:{input_variable:s.input_variable?s.input_variable.join("."):"",...s}});t({...e.node,node_params:c})},d=c=>{vo.includes(c.node_type)&&Tt(()=>{l()})};return ct(()=>e.properties,a,{deep:!0}),at(()=>{a(),i(),o().eventCenter.on("custom:setNodeName",d)}),Wn(()=>{o().eventCenter.off("custom:setNodeName",d)}),(c,p)=>(w(),Q(sn,{properties:n.properties,title:e.properties.node_name,menus:r.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Wpe,[u("div",Ype,[u("div",Jpe,[p[0]||(p[0]=u("div",{class:"field-item-label"},"输入参数",-1)),u("div",Kpe,[u("div",Zpe,[u("div",Qpe,[m(hr,{value:s.input_variable},null,8,["value"])])])])]),u("div",efe,[p[1]||(p[1]=u("div",{class:"field-item-label"},"输出字段",-1)),u("div",tfe,[(w(!0),R(se,null,ge(s.output,(f,h)=>(w(),R("div",{class:"field-value",key:h},[u("span",nfe,H(f.key),1),u("span",ofe,H(f.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},rfe=Ne(ife,[["__scopeId","data-v-8655c63e"]]);let sfe=class extends on{constructor(e){super(e),this.renderVue(rfe,e)}},afe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const lfe={type:"json-reverse-node",model:afe,view:sfe},ufe={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:sn,AtText:vn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{use_model:"",text:"",text_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var o,i;this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}",e=JSON.parse(n),t=((o=e==null?void 0:e.text_to_audio)==null?void 0:o.arguments)||{};this.formState.use_model=t.use_model||"--",this.formState.text=t.text||"",this.formState.text_tags=((i=t==null?void 0:t.tag_map)==null?void 0:i.text)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]}}},dfe={class:"specify-reply-node"},cfe={class:"static-field-list"},pfe={class:"static-field-item"},ffe={class:"static-field-item-content"},hfe={class:"static-field-value"},vfe={class:"static-field-item"},_fe={class:"static-field-item-content"},gfe={class:"static-field-value"},mfe={key:1};function yfe(n,e,t,o,i,r){const s=Pt("at-text"),a=Pt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[u("div",dfe,[u("div",cfe,[u("div",pfe,[e[0]||(e[0]=u("div",{class:"static-field-item-label"},"语音模型",-1)),u("div",ffe,[u("div",hfe,H(i.formState.use_model),1)])]),u("div",vfe,[e[1]||(e[1]=u("div",{class:"static-field-item-label"},"文本",-1)),u("div",_fe,[u("div",gfe,[i.formState.text.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.text_tags,defaultValue:i.formState.text,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R("span",mfe,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const bfe=Ne(ufe,[["render",yfe],["__scopeId","data-v-5a0b558e"]]);let xfe=class extends on{constructor(e){super(e),this.renderVue(bfe,e)}},wfe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(d=>d.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Cfe={type:"voice-synthesis-node",model:wfe,view:xfe},kfe={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:sn,AtText:vn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{file_url:"",file_url_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var o,i;this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}",e=JSON.parse(n),t=((o=e==null?void 0:e.voice_clone)==null?void 0:o.arguments)||{};this.formState.file_url=t.file_url||"--",this.formState.file_url_tags=((i=t==null?void 0:t.tag_map)==null?void 0:i.file_url)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]}}},Sfe={class:"specify-reply-node"},Efe={class:"static-field-list"},Afe={class:"static-field-item"},Dfe={class:"static-field-item-content"},Ofe={class:"static-field-value"},Nfe={key:1};function Mfe(n,e,t,o,i,r){const s=Pt("at-text"),a=Pt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[u("div",Sfe,[u("div",Efe,[u("div",Afe,[e[0]||(e[0]=u("div",{class:"static-field-item-label"},"复刻音频",-1)),u("div",Dfe,[u("div",Ofe,[i.formState.file_url.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.file_url_tags,defaultValue:i.formState.file_url,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R("span",Nfe,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Tfe=Ne(kfe,[["render",Mfe],["__scopeId","data-v-09ea7580"]]);let $fe=class extends on{constructor(e){super(e),this.renderVue(Tfe,e)}},Rfe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(d=>d.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Pfe={type:"voice-clone-node",model:Rfe,view:$fe},Lfe={class:"start-node"},Bfe={class:"start-node-options"},Ife={class:"options-list"},jfe={class:"options-item"},Ffe={class:"option-label"},Vfe={class:"start-node"},Hfe={class:"start-node-options"},Ufe={class:"options-list"},zfe={class:"options-item"},qfe={class:"option-label"},Gfe={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Ve("resetSize"),t=n;ct(()=>t.properties,(r,s)=>{const a=r.node_params||"{}",l=s.node_params||"{}";a!=l&&i()},{deep:!0});const o=Je({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""}),i=()=>{if(!t.properties||!t.properties.node_params)return;let s=JSON.parse(t.properties.node_params).trigger.trigger_web_hook_config;Object.assign(o,s),Tt(()=>{e()})};return at(()=>{i()}),(r,s)=>(w(),Q(sn,{title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Lfe,[u("div",Bfe,[s[0]||(s[0]=u("div",{class:"options-title"},"请求地址",-1)),u("div",Ife,[u("div",jfe,[u("div",Ffe,H(o.url),1)])])])]),u("div",Vfe,[u("div",Hfe,[s[1]||(s[1]=u("div",{class:"options-title"},"请求方式",-1)),u("div",Ufe,[u("div",zfe,[u("div",qfe,H(o.method),1)])])])])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Xfe=Ne(Gfe,[["__scopeId","data-v-9df22500"]]);let Wfe=class extends on{constructor(e){super(e),this.renderVue(Xfe,e)}},Yfe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const Jfe={type:"webhook-trigger-node",model:Yfe,view:Wfe},Kfe={class:"ai-dialogue-node"},Zfe={class:"field-list"},Qfe={class:"field-item"},ehe={class:"field-item-content"},the={class:"field-value"},nhe={class:"field-key"},ohe={class:"field-item"},ihe={class:"field-item-content"},rhe={class:"field-value"},she={class:"field-key"},ahe={class:"field-item"},lhe={class:"field-item-content"},uhe={class:"field-value"},dhe={class:"field-key"},che={key:0,class:"field-item"},phe={class:"field-item-content"},fhe={class:"field-value"},hhe={class:"field-key"},vhe={key:1,class:"field-item"},_he={class:"field-item-content"},ghe={class:"field-value"},mhe={class:"field-key"},yhe={key:2,class:"field-item"},bhe={class:"field-item-content"},xhe={class:"field-value"},whe={class:"field-key"},Che={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Rs(),t=We(()=>e.libraryLists),o=n,i=Ve("getNode"),r=Ve("resetSize"),s=X([]),a=X([]),l=Je({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),d=We(()=>t.value.filter(v=>l.library_id.includes(v.id))),c=We(()=>{var v;return(v=d.value[0])==null?void 0:v.library_name}),p=We(()=>d.value&&d.value.length?d.value[0].type:-1),f=()=>{const v=o.properties.dataRaw||o.properties.node_params||"{}";let y={};try{h(),y=JSON.parse(v).library_import||{};for(let g in y)g=="library_id"?l.library_id=y[g]?y[g].split(","):[]:l[g]=y[g]}catch{image_generation={}}Tt(()=>{r()})};function h(){let v=i().getAllParentVariable();s.value=v||[]}return ct(()=>o.properties,(v,y)=>{const g=v.dataRaw||v.node_params||"{}",_=y.dataRaw||y.node_params||"{}";g!=_&&f()},{deep:!0}),at(()=>{f(),r()}),Wn(()=>{}),(v,y)=>(w(),Q(sn,{properties:n.properties,title:o.properties.node_name,menus:a.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:x(()=>[u("div",Kfe,[u("div",Zfe,[u("div",Qfe,[y[0]||(y[0]=u("div",{class:"field-item-label"},"知识库",-1)),u("div",ehe,[u("div",the,[u("span",nhe,H(c.value),1)])])]),p.value==2?(w(),R(se,{key:0},[u("div",ohe,[y[1]||(y[1]=u("div",{class:"field-item-label"},"分段问题",-1)),u("div",ihe,[u("div",rhe,[u("span",she,[m(vn,{options:s.value,defaultValue:l.qa_question},null,8,["options","defaultValue"])])])])]),u("div",ahe,[y[2]||(y[2]=u("div",{class:"field-item-label"},"分段答案",-1)),u("div",lhe,[u("div",uhe,[u("span",dhe,[m(vn,{options:s.value,defaultValue:l.qa_answer},null,8,["options","defaultValue"])])])])])],64)):ne("",!0),p.value!=2&&p.value>=0?(w(),R(se,{key:1},[l.import_type=="content"?(w(),R("div",che,[y[3]||(y[3]=u("div",{class:"field-item-label"},"文档标题",-1)),u("div",phe,[u("div",fhe,[u("span",hhe,[m(vn,{options:s.value,defaultValue:l.normal_title},null,8,["options","defaultValue"])])])])])):ne("",!0),l.import_type=="content"?(w(),R("div",vhe,[y[4]||(y[4]=u("div",{class:"field-item-label"},"文档内容",-1)),u("div",_he,[u("div",ghe,[u("span",mhe,[m(vn,{options:s.value,defaultValue:l.normal_content},null,8,["options","defaultValue"])])])])])):ne("",!0),l.import_type=="url"?(w(),R("div",yhe,[y[5]||(y[5]=u("div",{class:"field-item-label"},"文档URL",-1)),u("div",bhe,[u("div",xhe,[u("span",whe,[m(vn,{options:s.value,defaultValue:l.normal_url},null,8,["options","defaultValue"])])])])])):ne("",!0)],64)):ne("",!0)])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},khe=Ne(Che,[["__scopeId","data-v-08a0e459"]]);let She=class extends on{constructor(e){super(e),this.renderVue(khe,e)}},Ehe=class extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(d=>d.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Ahe={type:"import-library-node",model:Ehe,view:She},Dhe={name:"ZmWorkflowNode",components:{NodeCommon:sn},inject:["getNode","getGraph","resetSize","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],robotAvatar:"",nodeParams:{},options:[]}},mounted(){this.init()},methods:{init(){var n,e,t;this.nodeParams=Fo(this.properties.node_params),this.robotAvatar=(t=(e=(n=this.nodeParams)==null?void 0:n.workflow)==null?void 0:e.robot_info)==null?void 0:t.robot_avatar,this.loadRobotNode()},handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},loadRobotNode(){var n,e;n_({robot_id:(e=(n=this.nodeParams)==null?void 0:n.workflow)==null?void 0:e.robot_id}).then(t=>{var i,r;let o=Fo((i=t==null?void 0:t.data)==null?void 0:i.node_params);this.options=((r=o==null?void 0:o.start)==null?void 0:r.diy_global)||[],this.update(),this.$nextTick(()=>{this.resetSize()})})},update(){var t;let n=this.nodeParams,e=((t=n==null?void 0:n.workflow)==null?void 0:t.params)||[];if(!Array.isArray(e)||!e.length){let o=JSON.parse(JSON.stringify(this.options));for(let i of o)i.variable=String(i.variable||"");n.workflow.params=o,this.setData({node_params:JSON.stringify(n)})}}}},Ohe={class:"start-node"},Nhe={class:"start-node-options"},Mhe={class:"options-list",style:{"max-height":"82px",overflow:"hidden"}},The={class:"option-label"},$he={class:"option-type"};function Rhe(n,e,t,o,i,r){const s=Pt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-url":i.robotAvatar,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[u("div",Ohe,[u("div",Nhe,[e[0]||(e[0]=u("div",{class:"options-title"},"输入参数",-1)),u("div",Mhe,[(w(!0),R(se,null,ge(i.options,a=>(w(),R("div",{class:xt(["options-item",{"is-required":a.required}]),key:a.key},[u("div",The,H(a.key),1),u("div",$he,H(a.typ),1)],2))),128))])]),e[1]||(e[1]=u("div",{class:"start-node-options"},[u("div",{class:"options-title"},"异常处理"),u("div",{class:"options-list"},[u("div",{class:"options-item"},[u("div",{class:"option-label"},"运行代码报错时执行该分支")])])],-1))])]),_:1},8,["properties","title","menus","icon-url","isSelected","isHovered","node-key","onHandleMenu"])}const Phe=Ne(Dhe,[["render",Rhe],["__scopeId","data-v-d1e8118b"]]);class Lhe extends on{constructor(e){super(e),this.renderVue(Phe,e)}}class Bhe extends rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),d=s.id;return s.type==="right"&&!l.includes(d)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:o+r/2-28,id:l+"-anchor_right_exception",type:"right",nodeId:e}]}}const Ihe={type:"zm-workflow-node",model:Bhe,view:Lhe};function jhe(n){Jt(mne,n),Jt(One,n),Jt(Xne,n),Jt(toe,n),Jt(_ie,n),Jt(Jie,n),Jt(woe,n),Jt(Loe,n),Jt(lre,n),Jt(hre,n),Jt(xce,n),Jt(yre,n),Jt(Wre,n),Jt(Mre,n),Jt(rse,n),Jt(_se,n),Jt(Rse,n),Jt(Xse,n),Jt(lae,n),Jt(Pae,n),Jt(ole,n),Jt(Nle,n),Jt(Xle,n),Jt(tue,n),Jt(ode,n),Jt(uce,n),Jt(vce,n),Jt(Pce,n),Jt(epe,n),Jt(fpe,n),Jt(Mpe,n),Jt(Xpe,n),Jt(lfe,n),Jt(Cfe,n),Jt(Pfe,n),Jt(Jfe,n),Jt(Ahe,n),Jt(Ihe,n)}const Fhe={class:"logic-flow-wrapper"},Uv="dont_show_delete_node_confirm",Vhe={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(n,{expose:e,emit:t}){const o=t;let i=null;const r=X(null),{setStorage:s,getStorage:a}=Xm(),l=X(a(Uv)||!1),d=X(null),c=X(!1),p=X(null),f=X(null),h=Em(),v=X(""),y=X([]),g={nodes:[]},_={width:160,height:140,bottomPosition:24,rightPosition:16},b={exclusiveMode:!1},C=_e=>{i&&i.zoom(_e)};function T(){if(f.value){i=new HQ({container:f.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[lte,dte,Jte,cte,Am,Dm,Hee,km,Cm],pluginsOptions:{miniMap:_,selectionSelect:b,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),r.value=i,jhe(i),Jt(jte,i),Jt(Gte,i),i.setDefaultEdgeType("custom-bezier-edge"),i.on("graph:rendered",({graphModel:be})=>{v.value=be.flowId});let _e={},he=[];i.on("node:dragstart",({data:be})=>{let De=i.graphModel.getElement(be.id);_e[De.id]=De.zIndex,he=[];let G=i.graphModel.dynamicGroup.getGroupByNodeId(be.id);G?(G.properties.width=G._width,G.properties.height=G._height):De.properties.loop_parent_key||(De.properties.disabled_add_group=!0),be.children&&be.children.length>0?(De.setZIndex(-9999),he=be.children||[],he.forEach(ie=>{let ae=i.getNodeModelById(ie);_e[ae.id]=ae.zIndex,ae.setZIndex(999999)})):De.setZIndex(999999),De.refreshBranch()}),i.on("node:drop",({data:be})=>{let De=i.graphModel.getElement(be.id),G=i.graphModel.dynamicGroup.getGroupByNodeId(be.id);be.properties.loop_parent_key&&!G&&i.getNodeModelById(be.properties.loop_parent_key).addChild(be.id),be.children&&be.children.length?(De.setZIndex(-9999),be.children.forEach(ie=>{let ae=i.getNodeModelById(ie);ae.setZIndex(_e[ae.id])})):De.setZIndex(_e[De.id]),De.refreshBranch()}),i.on("node:drag",({data:be})=>{const De=be.id,G=i.graphModel.getNodeEdges(De),ie=i.graphModel.dynamicGroup.getGroupByNodeId(be.id);setTimeout(()=>{G.forEach(ae=>{if(ae.type==="custom-bezier-edge"){const{startPoint:Ae,endPoint:fe}=ae,Ie=fe.x-Ae.x,je=fe.y-Ae.y;let Ke=10+Math.sqrt(Ie*Ie+je*je)*.3;const dt=10,ce=1e3;Ke=Math.round(Ke),Ke=Math.max(dt,Math.min(Ke,ce)),ae.setProperties({offset:Ke})}}),ie&&ie.refreshBranch()},0)}),i.on("node:add",()=>{}),i.on("custom:addNode",be=>{N(be)}),i.on("custom:addGroupNode",({data:be,group_id:De})=>{F(be,De)}),i.on("group:add-node",({childId:be})=>{i.getNodeModelById(be).properties.loop_parent_key}),i.on("element:click",be=>{y.value=[be.data]}),i.on("node:click",({data:be})=>{ue(be)}),i.on("blank:click",()=>{Le()}),i.on("selection:selected",be=>{let De=[];be.elements.forEach(G=>{let ie=i.getDataById(G.id);(G.BaseType==="node"||G.BaseType==="edge")&&De.push(ie)}),y.value=De}),i.on("node:delete",({data:be})=>{let De=JSON.parse(JSON.stringify(be));me(De)}),i.on("edge:delete",({data:be})=>{let De=JSON.parse(JSON.stringify(be));pe(De)}),i.on("custom:node:delete",be=>{J(be)}),i.on("custom:edge:delete",be=>{oe(be)}),i.on("custom:keyoard:delete",()=>{W()}),i.on("custom:paste",L),i.render(g),i.setZoomMiniSize(.01),i.setZoomMaxSize(8)}}const M=_e=>{const he=jp(),be=JSON.parse(_e.properties.node_params),{trigger_list:De}=be.start,G=[],ie=[];let ae=0;return De.forEach(Ae=>{const fe=`trigger_${Ae.trigger_type}`,Ie=Ki(fe),je=he[fe],Ue=Ie.substring(0,8)+Ie.substring(Ie.length-8),ot=Ki(fe),it=jd(Ae);it.id=Ie,it.x=_e.x-600,it.y=_e.y+ae,it.properties.node_key=Ie,it.properties.nodeSortKey=Ue;const Ke={id:ot,sourceNodeId:Ie,targetNodeId:_e.id,properties:{isTriggerEdge:!0}};ae+=je.height+50,G.push(it),ie.push(Ke)}),{nodes:G,edges:ie}},S=()=>{const _e=JSON.parse(JSON.stringify(i.getGraphRawData())),he=[],be=[],De=[];return _e.edges.forEach(G=>{G.properties.isTriggerEdge||be.push(G)}),_e.nodes.forEach(G=>{G.properties.isTriggerNode?De.push(G):he.push(G)}),_e.nodes=he,_e.edges=be,_e.triggers=De,_e},k=_e=>{const he=jp();let be={nodes:[],edges:[]};_e.nodes.forEach(G=>{let ie=he[G.type];G.properties.node_icon_name=ie.properties.node_icon_name,G.properties.node_header_bg_color||(G.properties.node_header_bg_color=ie.properties.node_header_bg_color||"#fff"),G.properties.width||(G.properties.width=ie.width),G.properties.height||(G.properties.height=ie.height),G.type=="start-node"&&(be=M(G))}),_e.nodes.unshift(...be.nodes),i.clearData(),i.graphModel.graphDataToModel(_e),i.graphModel.translateCenter(),i.extension.miniMap.show(),be.edges.forEach(G=>{i.graphModel.addEdge(G)});const De=i.extension.canvasHistory;De&&De.setInitialState(_e),A(_e.nodes)},A=_e=>{Tt(()=>{_e.forEach(he=>{if(he.loop_parent_key){const be=i.getNodeModelById(he.loop_parent_key);be&&(be.addChild(he.id),i.graphModel.dynamicGroup.sendNodeToFront(be))}})})};let $={};const B=()=>{const{nodes:_e}=i.graphModel,he=_e.find(G=>G.type==="start-node"),be=he.x-600,De=he.y;return{x:be,y:De}},O=(_e,he)=>{const be=he.x-he.width/2,De=he.x+he.width/2,G=he.y-he.height/2,ie=he.y+he.height/2,ae=_e.x-_e._width/2,Ae=_e.x+_e._width/2,fe=_e.y-_e._height/2,Ie=_e.y+_e._height/2;let je=!1,Ue=_e._width,ot=_e._height,it=0,Ke=0;if(De>Ae-20){const dt=De-Ae+50;Ue+=dt,it+=dt/2,je=!0}if(be<ae+20){const dt=ae-be+50;Ue+=dt,it-=dt/2,je=!0}if(ie>Ie-20){const dt=ie-Ie+50;ot+=dt,Ke+=dt/2,je=!0}if(G<fe+20){const dt=fe-G+50;ot+=dt,Ke-=dt/2,je=!0}je&&(_e.properties.width=Ue,_e.properties.height=ot,_e._width=Ue,_e._height=ot,_e.width=Ue,_e.height=ot,_e.x+=it,_e.y+=Ke)},P=_e=>{const he=_e.node||_e,be=_e.anchorData,De=_e.event;if(he.id=he.id||Ki(he.type),he.nodeSortKey=he.id.substring(0,8)+he.id.substring(he.id.length-8),be){let G=i.graphModel.dynamicGroup.getGroupByNodeId(be.nodeId);G?he.properties.loop_parent_key=G.id:he.properties.disabled_add_group=!0}if(_e.isCopy||($[he.type]?($[he.type]=$[he.type]+1,he.properties.node_name=he.properties.node_name+$[he.type]):$[he.type]=1),he.properties.width=he.width,he.properties.height=he.height,he.properties.nodeSortKey=he.nodeSortKey,De){const{transformModel:G}=i.graphModel,{left:ie,top:ae}=f.value.getBoundingClientRect(),[Ae,fe]=G.HtmlPointToCanvasPoint([De.clientX-ie,De.clientY-ae]);he.x=Ae+he.width/2,he.y=fe+he.height/2}else if(!he.x&&!he.y)if(be)he.x=be.x+he.width+100,he.y=be.y+he.height/2-24;else if(_e.isTriggerNode){let G=B();he.x=G.x,he.y=G.y,he.properties.disabled_add_group=!0}else{const{transformModel:G}=i.graphModel,ie=G.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);he.x=ie[0],he.y=ie[1],he.properties.disabled_add_group=!0}return he},E=_e=>{setTimeout(()=>{F({node:{type:"group-start-node",with:200,properties:{node_type:27,node_name:"循环开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},_e.id)},100)},D=_e=>{setTimeout(()=>{F({node:{type:"group-start-node",with:200,properties:{node_type:31,node_name:"批量执行开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},_e.id)},100)},N=_e=>{const he=P(_e),be=_e.model,De=_e.anchorData;let G=!1;if(i.graphModel.nodes.forEach(ae=>{!G&&ae.type=="session-trigger-node"&&(G=!0)}),G&&he.type=="session-trigger-node")return mt.error("请勿添加多个会话触发器");let ie=i.addNode(he);if(ie.type=="custom-group"&&E(ie),ie.type=="batch-group"&&D(ie),_e.isTriggerNode){const{nodes:ae}=i.graphModel,Ae=ae.find(Ie=>Ie.type==="start-node");let fe={type:"custom-bezier-edge",sourceNodeId:he.id,targetNodeId:Ae.id,properties:{isTriggerEdge:!0}};i.graphModel.addEdge(fe),i.graphModel.eventCenter.emit("custom:trigger-add",he)}if(De){let ae=ie.anchors.find(fe=>fe.type==="left");i.graphModel.addEdge({type:"custom-bezier-edge",sourceNodeId:be.id,targetNodeId:ie.id,sourceAnchorId:De.id,targetAnchorId:ae.id,startPoint:{x:De.x,y:De.y},endPoint:{x:ae.x,y:ae.y}});const Ae=i.graphModel.dynamicGroup.getGroupByNodeId(De.nodeId);if(Ae&&Ae.id){const fe=i.getNodeModelById(Ae.id);fe.addChild(ie.id),O(fe,ie),i.graphModel.dynamicGroup.sendNodeToFront(fe)}}i.graphModel.clearSelectElements(),ie.setSelected(!0)},F=(_e,he)=>{const be=_e.node||_e;be.id=Ki(be.type),be.nodeSortKey=be.id.substring(0,8)+be.id.substring(be.id.length-8),be.properties.width=be.width,be.properties.height=be.height,be.properties.nodeSortKey=be.nodeSortKey,be.properties.loop_parent_key=he;const De=i.getNodeModelById(he);be.x=De.x,be.y=De.y;let G=0;i.graphModel.nodes.forEach(ae=>{ae.zIndex>G&&(G=ae.zIndex)}),G=G+99;let ie=i.addNode(be);De.addChild(ie.id),ie.setZIndex(G),i.graphModel.clearSelectElements(),i.graphModel.dynamicGroup.sendNodeToFront(De)},Y=async()=>{const _e=i.getGraphRawData(),he=i.extension.canvasHistory;he&&he.beginTransaction(),i.extension.elk.layout(_e).then(()=>{he&&he.commitTransaction("auto-layout")}).catch(be=>{mt.error("布局失败，请检查"+be),he&&he.rollbackTransaction()})},L=({originalNodes:_e,basePoint:he,pasteBasePoint:be})=>{const De=i.extension.canvasHistory;De&&De.beginTransaction();try{const G=_e.map(ae=>{const Ae=ae.x-he.x,fe=ae.y-he.y,Ie=JSON.parse(JSON.stringify(ae));return Ie.x=be.x+Ae,Ie.y=be.y+fe,P({node:Ie,isCopy:!0})}),{nodes:ie}=i.addElements({nodes:G});i.clearSelectElements(),ie.forEach(ae=>{ae.setSelected(!0)})}finally{De&&De.commitTransaction("paste")}},j=_e=>{_e.height&&(_e.properties.height=_e.height);let he=i.getNodeModelById(_e.id);he.height=_e.properties.height||_e.height||he.height,he.properties=_e.properties,_e.properties.node_type==2&&_e.properties.node_sub_type==21&&he.graphModel.getNodeEdges(_e.id).forEach(De=>{De.sourceNodeId==he.id&&(he.getAnchorInfo(De.sourceAnchorId)||he.graphModel.deleteEdgeById(De.id))}),he.refreshBranch()};function le(_e){return i.getNodeModelById(_e.id)}function z(_e){return i.getEdgeModelById(_e.id)}function V(){const{nodes:_e}=i.getGraphData();return _e.filter(be=>be.properties.isTriggerNode)}const J=_e=>{_e&&_e.id&&(y.value=[_e]),q()},oe=_e=>{_e&&_e.id&&(y.value=[_e]),q()},W=()=>{let _e=i.getSelectElements(!0);y.value=[..._e.nodes,..._e.edges],q()},q=()=>{if(y.value.length===0)return;const _e=y.value.filter(De=>le(De)?!["start-node","group-start-node"].includes(De.type):!0);if(_e.length===0){y.value=[];return}const he=y.value.filter(De=>De.properties.isTriggerNode===!0);if(he.length>0&&V().length-he.length<1){mt.error("请至少保留一个触发器！");return}const be=()=>{const De=i.extension.canvasHistory;De&&De.replaceLastState("replace-before-delete");let G=!1;_e.forEach(ie=>{le(ie)?(ie.properties.isTriggerNode&&(G=!0),i.deleteNode(ie.id)):z(ie)&&i.deleteEdge(ie.id)}),G&&i.graphModel.eventCenter.emit("custom:trigger-change",null),De&&De.saveCurrentState("delete"),y.value=[],i.clearSelectElements()};if(l.value){be();return}if(_e.length>1||_e.length===1&&le(_e[0])){const De=_e.length>1?"批量删除":"删除节点",G=`确定要删除选中的 ${_e.length} 个元素吗？`;let ie=!1;_n.confirm({title:De,content:St("div",{},[St("p",G),St(s_,{class:"dont-show-again-checkbox",onChange:ae=>{ie=ae.target.checked}},()=>"不再提示")]),onOk:()=>{ie&&(l.value=!0,s(Uv,!0)),be()},onCancel:()=>{}})}else be()},re=["group-start-node","terminate-node"],ue=_e=>{const he=JSON.parse(JSON.stringify(_e));he.properties.dataRaw=he.properties.dataRaw||he.properties.node_params,o("selectNode",he),!re.includes(_e.type)&&(p.value=he,c.value=!0)},xe=_e=>{p.value.properties=_e,j(JSON.parse(JSON.stringify(p.value)))},Te=_e=>{p.value.properties.node_name=_e,j(JSON.parse(JSON.stringify(p.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:_e,node_id:p.value.id,node_type:p.value.type})},me=_e=>{o("onDeleteNode",_e),p.value&&_e.id===p.value.id&&(c.value=!1,setTimeout(()=>{p.value=null},350))},pe=_e=>{o("onDeleteEdge",_e)},Ge=()=>{o("runTest")},Le=()=>{o("blankClick"),c.value&&(c.value=!1),y.value.length>0&&(y.value=[],i.clearSelectElements())};return at(()=>{T()}),Hc(()=>{i&&i.destroy&&i.destroy()}),e({lfRef:r,setData:k,getData:S,updateNode:j}),(_e,he)=>(w(),R("div",Fhe,[u("div",{ref_key:"containerRef",ref:f,class:"logic-flow-container"},null,512),m(K(h),{"flow-id":v.value},null,8,["flow-id"]),K(i)?(w(),Q(CE,{key:0,lf:K(i),onRunTest:Ge,onAddNode:N,onZoomChange:C,onAutoLayout:Y},null,8,["lf"])):ne("",!0),p.value?(w(),Q(hW,{key:1,ref_key:"nodeFormDrawerRef",ref:d,open:c.value,"onUpdate:open":he[0]||(he[0]=be=>c.value=be),destroyOnClose:!0,"node-id":p.value.id,node:p.value.properties,"node-type":p.value.type,lf:K(i),onUpdateNode:xe,onChangeTitle:Te},null,8,["open","node-id","node","node-type","lf"])):ne("",!0)]))}},Hhe={class:"modal-title-block"},Uhe={key:0,class:"run-detail"},zhe={class:"flex-content-box"},qhe={class:"test-model-box"},Ghe={class:"option-desc"},Xhe={key:2,class:"input-list-box"},Whe={class:"add-btn-box"},Yhe={class:"input-list-box"},Jhe={class:"add-btn-box"},Khe={key:0,class:"result-list-box loading-box"},Zhe={key:1,class:"result-list-box"},Qhe=["onClick"],eve={class:"status-block"},tve={class:"icon-name-box"},nve=["src"],ove={class:"node-name"},ive={key:0,class:"time-tag"},rve={class:"right-active-icon"},sve={class:"save-btn-box"},ave={class:"preview-box"},lve={class:"preview-title"},uve={class:"icon-name-box"},dve=["src"],cve={class:"node-name"},pve={key:0,class:"time-tag"},fve={key:0,class:"preview-content-block"},hve={class:"preview-img-box"},vve={class:"preview-content-block"},_ve={class:"title-block"},gve={class:"preview-code-box"},mve={class:"preview-content-block"},yve={class:"title-block"},bve={class:"preview-code-box"},xve={class:"preview-content-block"},wve={class:"title-block"},Cve={class:"preview-code-box"},kve={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(n,{expose:e,emit:t}){const o={openid:"38fjp8344ru43",question:"你好",question_multiple:'{"type":"text", "text":"这是什么"}',conversationid:"12345"},i=n,r=X(!1),s=We(()=>i.start_node_params.diy_global||[]),a=We(()=>{let z=i.start_node_params.trigger_list||[],V=!1;return z.forEach(J=>{var oe;J.trigger_type==1&&(V=(oe=J.chat_config)==null?void 0:oe.question_multiple_switch)}),V}),l=t,d=Ms().query,c=X(!1),p=X(""),f=X([]),h=We(()=>p.value?f.value.filter(z=>z.node_key==p.value)[0]:null),v=We(()=>{let z=[];if(h.value&&h.value.node_type==33){let V=h.value.output;for(let J in V)J.includes("picture_url_")&&z.push(V[J])}return z}),y=X(!1),g=Je({is_draft:!0,robot_key:d.robot_key,global:"",globalState:{},question:"",question_multiple:[{value:""}],dialogue_id:"",session_id:""}),_=()=>{if(r.value=!1,T(),i.isLockedByOther){mt.warning("当前已有其他用户在编辑中，无法运行测试");return}l("save","automatic");let z=localStorage.getItem("workflow_run_test_data")||"{}";z=JSON.parse(z),g.global=z.global||"",g.question="",g.question_multiple=[{value:""}],g.dialogue_id="",g.session_id="",f.value=[],p.value="",l("getGlobal"),Tt(()=>{i.start_node_params,s.value.forEach(V=>{g.globalState[V.key]=b(V)});try{let V=z.global?JSON.parse(z.global):{};for(let J in g.globalState)V[J]&&(Array.isArray(V[J])?g.globalState[J]=V[J].map(oe=>({value:typeof oe=="object"?JSON.stringify(oe):oe,key:Math.random()*1e3})):g.globalState[J]=V[J])}catch(V){}}),c.value=!0};function b(z){return z.typ=="string"||z.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function C(){let z={};return s.value.forEach(V=>{if(V.typ=="string"){const J=(g.globalState[V.key]||"").trim();z[V.key]=J||(o[V.key]??"")}if(V.typ=="number"){const J=g.globalState[V.key];if(J!==""&&J!=null)z[V.key]=+J;else{const oe=o[V.key];z[V.key]=oe!=null&&oe!==""&&!isNaN(Number(oe))?Number(oe):""}}if(V.typ.includes("array")){let J=g.globalState[V.key].map(oe=>(oe.value=typeof oe.value=="string"?oe.value.trim():oe.value,id(oe.value)?JSON.parse(oe.value):oe.value)).filter(oe=>oe);if((!Array.isArray(J)||J.length===0)&&o[V.key]){const oe=o[V.key];id(oe)?J=[JSON.parse(oe)]:J=[oe]}z[V.key]=J}V.typ==="object"&&id(V.value)&&(z[V.key]=JSON.parse(V.value))}),JSON.stringify(z)}function T(){const V=i.lf.getGraphData().nodes.find(J=>J.type==="session-trigger-node");if(V){const oe=JSON.parse(V.properties.node_params||"{}").trigger||{};return oe.chat_config?oe.chat_config.question_multiple_switch:!1}}const M=(z,V)=>{g.globalState[z].splice(V,1)},S=z=>{g.globalState[z].push({value:"",key:Math.random()*1e4})},k=z=>{g.question_multiple.splice(z,1)},A=z=>{g.question_multiple.push({value:""})},$=X(null),B=X(0),O=X(0),P=()=>{$.value.validate().then(()=>{let z={...g};const V=T();z.global=C(),delete z.globalState;let J=z.question_multiple.filter(W=>W.value);z.question_multiple=JSON.stringify(J.map(W=>W.value)),y.value=!0,f.value=[];const oe=le();Object.keys(oe).length&&localStorage.setItem("workflow_run_test_data",JSON.stringify({global:JSON.stringify(oe)})),ty({...z,question_multiple_switch:V}).then(W=>{g.dialogue_id=W.data.dialog_id,g.session_id=W.data.session_id;let q=W.data.node_logs||[];B.value=W.data.use_token,O.value=W.data.use_mills,E(q)}).catch(W=>{f.value=[],r.value=!1;let q=W.data.node_logs||[];q&&q.length&&E(q)}).finally(()=>{y.value=!1})})},E=z=>{var J;z[z.length-1].node_type==43?(r.value=!0,mt.success("请继续填写问答参数")):(mt.success("测试结果生成完成"),g.question="",g.question_multiple=[{value:""}],r.value=!1),f.value=z.map(oe=>{let W=xa(oe.node_type);return oe.node_type==45&&(W=oe.node_icon||xa(oe.node_type)),{...oe,is_success:oe.error_msg==="<nil>",node_icon:W}}),p.value=(J=f.value[0])==null?void 0:J.node_key},D=z=>{p.value=z.node_key},N=z=>{Ts(JSON.stringify(h.value[z])),mt.success("复制成功")},F=()=>{_()};function Y(z){const V=o[z.key];return V?`${V}`:"请输入"}function L(z){try{return JSON.parse(z)}catch{return null}}function j(z,V){return JSON.stringify(z)===JSON.stringify(V)}function le(){const z={};return s.value.forEach(V=>{const J=V.key;if(V.typ==="string"){const oe=String(g.globalState[J]||"").trim();if(!oe)return;const W=o[J];if(W!=null&&oe===String(W))return;z[J]=oe;return}if(V.typ==="number"){const oe=g.globalState[J];if(oe===""||oe==null)return;const W=+oe,q=o[J];if(q!=null&&!isNaN(Number(q))&&W===Number(q))return;z[J]=W;return}if(V.typ.includes("array")){const W=(Array.isArray(g.globalState[J])?g.globalState[J]:[]).map(ue=>String((ue==null?void 0:ue.value)||"").trim()).filter(ue=>ue).map(ue=>{const xe=L(ue);return xe??ue});if(!W.length)return;let q=[];const re=o[J];if(re!=null){const ue=L(String(re));q=ue!=null?[ue]:[String(re)]}if(q.length&&j(W,q))return;z[J]=W;return}}),z}return e({open:F}),(z,V)=>{const J=Ai,oe=Zt,W=ko,q=en,re=Mn,ue=In,xe=Xt,Te=Cn,me=xn,pe=ho,Ge=_n;return w(),R("div",null,[m(Ge,{open:c.value,"onUpdate:open":V[5]||(V[5]=Le=>c.value=Le),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[u("div",Hhe,[U(" 运行测试"+H(g.dialogue_id)+" ",1),f.value.length?(w(),R("div",Uhe,[u("span",null,"总耗时："+H(K(Kc)(O.value)),1),u("span",null,"token消耗："+H(B.value)+" Tokens",1)])):ne("",!0)])]),default:x(()=>[u("div",zhe,[u("div",qhe,[V[12]||(V[12]=u("div",{class:"top-title"},"开始节点参数",-1)),m(me,{model:g,ref_key:"formRef",ref:$,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[ri(u("div",null,[(w(!0),R(se,null,ge(s.value,Le=>(w(),Q(Te,{name:["globalState",Le.key],key:Le.key,rules:[{required:Le.required,message:`请输入${Le.key}`}]},{label:x(()=>[m(W,{gap:4},{default:x(()=>[U(H(Le.key)+" ",1),m(J,{style:{margin:"0"}},{default:x(()=>[U(H(Le.typ),1)]),_:2},1024),m(oe,{title:Le.desc},{default:x(()=>[u("div",Ghe,H(Le.desc),1)]),_:2},1032,["title"])]),_:2},1024)]),default:x(()=>[Le.typ=="string"?(w(),Q(q,{key:0,placeholder:Y(Le),value:g.globalState[Le.key],"onUpdate:value":_e=>g.globalState[Le.key]=_e},null,8,["placeholder","value","onUpdate:value"])):ne("",!0),Le.typ=="number"?(w(),Q(re,{key:1,style:{width:"100%"},placeholder:Y(Le),value:g.globalState[Le.key],"onUpdate:value":_e=>g.globalState[Le.key]=_e},null,8,["placeholder","value","onUpdate:value"])):ne("",!0),Le.typ.includes("array")?(w(),R("div",Xhe,[(w(!0),R(se,null,ge(g.globalState[Le.key],(_e,he)=>(w(),R("div",{class:"input-list-item",key:he},[m(ue,null,{default:x(()=>[m(q,{placeholder:Y(Le),value:_e.value,"onUpdate:value":be=>_e.value=be},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),g.globalState[Le.key].length>1?(w(),Q(K(Ut),{key:0,onClick:be=>M(Le.key,he)},null,8,["onClick"])):ne("",!0)]))),128)),u("div",Whe,[m(xe,{onClick:_e=>S(Le.key),block:"",type:"dashed"},{default:x(()=>[...V[6]||(V[6]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ne("",!0)]),_:2},1032,["name","rules"]))),128))],512),[[Si,!r.value]]),r.value?(w(),R(se,{key:0},[m(Te,null,{label:x(()=>[m(W,{gap:4},{default:x(()=>[V[8]||(V[8]=U("question ",-1)),m(J,{style:{margin:"0"}},{default:x(()=>[...V[7]||(V[7]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[m(q,{placeholder:"请输入question",value:g.question,"onUpdate:value":V[0]||(V[0]=Le=>g.question=Le)},null,8,["value"])]),_:1}),a.value?(w(),Q(Te,{key:0},{label:x(()=>[m(W,{gap:4},{default:x(()=>[V[10]||(V[10]=U("question_multiple ",-1)),m(J,{style:{margin:"0"}},{default:x(()=>[...V[9]||(V[9]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[u("div",Yhe,[(w(!0),R(se,null,ge(g.question_multiple,(Le,_e)=>(w(),R("div",{class:"input-list-item",key:_e},[m(ue,null,{default:x(()=>[m(q,{placeholder:"请输入",value:Le.value,"onUpdate:value":he=>Le.value=he},null,8,["value","onUpdate:value"])]),_:2},1024),g.question_multiple.length>1?(w(),Q(K(Ut),{key:0,onClick:he=>k(_e)},null,8,["onClick"])):ne("",!0)]))),128)),u("div",Jhe,[m(xe,{onClick:V[1]||(V[1]=Le=>A()),block:"",type:"dashed"},{default:x(()=>[...V[11]||(V[11]=[U("添加",-1)])]),_:1})])])]),_:1})):ne("",!0)],64)):ne("",!0)]),_:1},8,["model"]),y.value?(w(),R("div",Khe,[y.value?(w(),Q(pe,{key:0,tip:"测试结果生成中..."})):ne("",!0)])):ne("",!0),f.value.length>0?(w(),R("div",Zhe,[(w(!0),R(se,null,ge(f.value,(Le,_e)=>(w(),R("div",{class:xt(["list-item-block",{active:p.value==Le.node_key}]),onClick:he=>D(Le),key:_e},[u("div",eve,[Le.is_success?(w(),Q(K(za),{key:0,style:{color:"#138b1b"}})):(w(),Q(K(Lu),{key:1,style:{color:"#d81e06"}}))]),u("div",tve,[u("img",{src:Le.node_icon,alt:""},null,8,nve),u("div",ove,H(Le.node_name),1)]),Le.is_success?(w(),R("div",ive,H(Le.use_time)+"ms",1)):ne("",!0),u("div",rve,[m(K(Bu))])],10,Qhe))),128))])):ne("",!0),u("div",sve,[m(xe,{loading:y.value,onClick:P,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[m(K(ai)),U(H(r.value?"继续测试":"运行测试"),1)]),_:1},8,["loading"])])]),u("div",ave,[h.value?(w(),R(se,{key:0},[u("div",lve,[V[13]||(V[13]=u("div",{class:"title-text"},"日志详情",-1)),u("div",uve,[u("img",{src:h.value.node_icon,alt:""},null,8,dve),u("div",cve,H(h.value.node_name),1)]),h.value.is_success?(w(),R("div",pve,H(h.value.use_time)+"ms",1)):ne("",!0)]),v.value.length>0?(w(),R("div",fve,[V[14]||(V[14]=u("div",{class:"title-block"},"生成图像日志",-1)),u("div",hve,[m(Mm,{currentImageList:v.value},null,8,["currentImageList"])])])):ne("",!0),u("div",vve,[u("div",_ve,[V[15]||(V[15]=U("输入",-1)),m(K(Po),{onClick:V[2]||(V[2]=Le=>N("input"))})]),u("div",gve,[m(K(Bo),{data:h.value.input},null,8,["data"])])]),u("div",mve,[u("div",yve,[V[16]||(V[16]=U("输出",-1)),m(K(Po),{onClick:V[3]||(V[3]=Le=>N("node_output"))})]),u("div",bve,[m(K(Bo),{data:h.value.node_output},null,8,["data"])])]),u("div",xve,[u("div",wve,[V[17]||(V[17]=U("运行日志",-1)),m(K(Po),{onClick:V[4]||(V[4]=Le=>N("output"))})]),u("div",Cve,[m(K(Bo),{data:h.value.output},null,8,["data"])])])],64)):ne("",!0)])])]),_:1},8,["open"])])}}},Sve=Ne(kve,[["__scopeId","data-v-99089487"]]),Eve=["data-lf"],Ave={class:"header-content"},Dve={key:1,class:"robot-status-box status-0"},Ove={key:0,class:"header-right"},Nve={key:0,class:"last-save-time"},Mve={key:0,class:"auto-save-hint"},Tve={style:{display:"flex","align-items":"center",gap:"8px"}},$ve={class:"lock-config"},Rve={style:{"margin-top":"24px","text-align":"right"}},Pve={key:1,class:"lock-tip"},Lve={class:"lock-info"},Bve={__name:"page-header",props:{lf:{default:()=>null,type:Object},saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(n,{expose:e,emit:t}){const o=Vn(),i=We(()=>o.robotInfo),r=t,s=n,a=X(null),l=e_(),d=We(()=>{var A;const k=(A=l.userInfo)==null?void 0:A.role_type;return k==1||k==2}),c=X(!1),p=X(10),f=X(!1),h=async()=>{f.value=!0;try{await oy({draft_exptime:p.value}),mt.success("编辑锁设置已保存"),c.value=!1}catch{mt.error("保存失败，请稍后重试")}finally{f.value=!1}};at(async()=>{var k;try{const A=await ny(),$=+((k=A==null?void 0:A.data)==null?void 0:k.draft_exptime);typeof $=="number"&&(p.value=Math.max(10,Math.min(60,Math.round($))))}catch{}});const v=()=>{},y=()=>{r("edit")},g=(k="handle")=>{const A=hs();let $=!1;const B=[],O=P=>{$=!0;const E=(P==null?void 0:P.component)||"未命名组件",D=(P==null?void 0:P.typeDisplay)||(P==null?void 0:P.type)||"";(Array.isArray(P==null?void 0:P.errors)?P.errors:[]).forEach(F=>{B.push(`【${E}${D?" - "+D:""}】字段「${F.field_name}」：${F.message}`)})};if(A.on&&A.on("workflow:validate:error",O),A.emit&&A.emit("workflow:validate",{action:"save"}),A.off&&A.off("workflow:validate:error",O),$){_n.warning({title:"表单未完成",content:B.length?St("div",B.map(P=>St("div",P))):"请完善必填项后再保存"});return}r("save",k)},_=()=>{const k=hs();let A=!1;const $=[],B=O=>{A=!0;const P=(O==null?void 0:O.component)||"未命名组件",E=(O==null?void 0:O.typeDisplay)||(O==null?void 0:O.type)||"";(Array.isArray(O==null?void 0:O.errors)?O.errors:[]).forEach(N=>{$.push(`【${P}${E?" - "+E:""}】字段「${N.field_name}」：${N.message}`)})};if(k.on&&k.on("workflow:validate:error",B),k.emit&&k.emit("workflow:validate",{action:"release"}),k.off&&k.off("workflow:validate:error",B),A){_n.warning({title:"表单未完成",content:$.length?St("div",$.map(O=>St("div",O))):"请完善必填项后再发布"});return}r("release")},b=()=>{r("getGlobal")},C=()=>{r("getVersionRecord")},T=()=>{r("edit")},M=()=>{a.value.open()};function S(k,A="YY-MM-DD HH:mm:ss"){return!k||k<=0?"--":yo(k*1e3).format(A)}return e({openRunTest:M}),(k,A)=>{const $=Xt,B=Zt,O=On,P=Mn,E=jr;return w(),R("div",{class:"page-header","data-lf":n.lf},[u("div",Ave,[m(CC),i.value.start_node_key!=""?(w(),R("div",{key:0,class:"robot-status-box status-1",onClick:y},[m(K(za),{class:"robot-status-icon"}),A[6]||(A[6]=u("div",{class:"robot-status-text"},"已发布",-1))])):(w(),R("div",Dve,[m(K(Yc),{class:"robot-status-icon"}),A[7]||(A[7]=u("div",{class:"robot-status-text"},"未发布",-1))]))]),s.showRight?(w(),R("div",Ove,[n.currentVersion==""&&n.isEditing?(w(),R(se,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(w(),R("div",Nve,[U(H(S(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+H(i.value.draft_save_type=="handle"?"手动":"自动")+"保存草稿 ",1),n.isEditing&&!n.isLockedByOther&&(!n.autoSaveEnabled||!n.isLeader)?(w(),R("span",Mve,"你可能已在其他页面编辑，已停止自动保存")):ne("",!0)])):ne("",!0),n.isLockedByOther?ne("",!0):(w(),R(se,{key:1},[m($,{class:"save-draft",onClick:A[0]||(A[0]=D=>g("handle"))},{default:x(()=>[...A[8]||(A[8]=[U("保存草稿",-1)])]),_:1}),m($,{type:"primary",loading:s.saveLoading,class:"publish-robot",onClick:_},{default:x(()=>[...A[9]||(A[9]=[U("发布机器人",-1)])]),_:1},8,["loading"])],64))],64)):ne("",!0),!n.isEditing&&!n.currentVersion||n.isLockedByOther?(w(),Q($,{key:1,disabled:n.isLockedByOther,type:"primary",class:"ml8",onClick:T},{icon:x(()=>[m(K(Dr))]),default:x(()=>[A[10]||(A[10]=U(" 编辑 ",-1))]),_:1},8,["disabled"])):ne("",!0),m(B,{title:"历史发布详情"},{default:x(()=>[m($,{onClick:A[1]||(A[1]=D=>C())},{default:x(()=>[m(K(Ny))]),_:1})]),_:1}),d.value?(w(),Q(E,{key:2,trigger:"click",placement:"bottomRight",open:c.value,"onUpdate:open":A[5]||(A[5]=D=>c.value=D),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onOnOpenChange:v},{title:x(()=>[u("div",Tve,[m(O,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),A[11]||(A[11]=u("span",{style:{color:"#262626"}},"编辑锁设置",-1)),A[12]||(A[12]=u("span",{style:{color:"#8c8c8c","font-weight":"normal"}},"不同的IP和UserAgent都会限制",-1))])]),content:x(()=>[u("div",$ve,[A[13]||(A[13]=u("span",{style:{color:"#595959"}},"编辑结束后锁",-1)),m(P,{value:p.value,"onUpdate:value":A[2]||(A[2]=D=>p.value=D),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),A[14]||(A[14]=u("span",{style:{color:"#595959"}},"分钟后才能编辑",-1))]),u("div",Rve,[m($,{class:"ml8",onClick:A[3]||(A[3]=D=>c.value=!1)},{default:x(()=>[...A[15]||(A[15]=[U("取 消",-1)])]),_:1}),m($,{type:"primary",class:"ml8",loading:f.value,onClick:h},{default:x(()=>[...A[16]||(A[16]=[U("保 存",-1)])]),_:1},8,["loading"])])]),default:x(()=>[m($,{class:"",onClick:A[4]||(A[4]=D=>c.value=!0),style:{padding:"5px 9px"}},{default:x(()=>[m(O,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):ne("",!0)])):ne("",!0),n.isLockedByOther?(w(),R("div",Pve,[A[17]||(A[17]=u("div",null,"当前已有用户正在编辑中，无法编辑保存草稿或发布工作流",-1)),u("div",Lve,"（"+H("用户："+n.loginUserName||"--")+" "+H("IP："+n.lockRemoteAddr||"--")+" "+H("User Agent："+n.lockUserAgent||"--")+"）",1)])):ne("",!0),m(Sve,{ref_key:"runTestRef",ref:a,lf:n.lf,start_node_params:n.start_node_params,onGetGlobal:b,onSave:g,isLockedByOther:n.isLockedByOther},null,8,["lf","start_node_params","isLockedByOther"])],8,Eve)}}},Ive=Ne(Bve,[["__scopeId","data-v-1c13b7e1"]]),jve={class:"form-box"},Fve={class:"form-item"},Vve={class:"form-content"},Hve={class:"version-input-box"},Uve={class:"form-item"},zve={class:"form-content"},zv="wf_uni_identifier",qve={__name:"version-model",emits:["ok"],setup(n,{expose:e,emit:t}){const o=Ms().query,i=X(!1);let r="";const s=Vn(),a=X(""),l=X(""),d=X(""),c=X(""),p=X(!1),f=t,h=b=>{_(),c.value="",r=b,i.value=!0},v=()=>{try{let b=localStorage.getItem(zv);return b||(b=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(zv,b)),b}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},y=()=>{try{const b=navigator.userAgent||"",C=navigator.platform||"";let T="Unknown";/Windows/i.test(b)?T="Windows":/Macintosh|Mac OS X/i.test(b)?T="MacOS":/Linux/i.test(b)?T="Linux":/Android/i.test(b)?T="Android":/iPhone|iPad|iPod/i.test(b)&&(T="iOS");let M="Unknown",S="";const k=b.match(/Edg\/([\d\.]+)/)||b.match(/Chrome\/([\d\.]+)/)||b.match(/Firefox\/([\d\.]+)/)||b.match(/Version\/([\d\.]+).*Safari/);return k&&(b.includes("Edg/")?M="Edge":b.includes("Chrome/")?M="Chrome":b.includes("Firefox/")?M="Firefox":b.includes("Safari")&&!b.includes("Chrome")&&(M="Safari"),S=k[1]),`platform=${C}; os=${T}; browser=${M}/${S}; ua=${b}`}catch{return"ua=unknown"}},g=()=>{p.value=!0,ry({robot_key:o.robot_key,node_list:r,version:`${a.value}.${l.value}.${d.value}`,version_desc:c.value,uni_identifier:v(),user_agent:y(),draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0}).then(async b=>{await s.getRobot(o.id),s.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0,uni_identifier:v(),user_agent:y()}),i.value=!1,b&&b.res==0&&(mt.success("发布成功"),f("ok"))}).finally(()=>{p.value=!1})},_=()=>{iy({robot_key:o.robot_key}).then(b=>{let C=b.data.version_params||[];a.value=C[0],l.value=C[1],d.value=C[2]})};return e({show:h}),(b,C)=>{const T=Mn,M=Vi,S=_n;return w(),R("div",null,[m(S,{open:i.value,"onUpdate:open":C[4]||(C[4]=k=>i.value=k),title:"发布","ok-text":"立即发布",onOk:g,confirmLoading:p.value,width:600},{default:x(()=>[u("div",jve,[u("div",Fve,[C[8]||(C[8]=u("div",{class:"form-label"},"版本号：",-1)),u("div",Vve,[u("div",Hve,[C[5]||(C[5]=U(" v ",-1)),m(T,{value:a.value,"onUpdate:value":C[0]||(C[0]=k=>a.value=k),precision:0,min:0,max:1e3},null,8,["value"]),C[6]||(C[6]=u("span",null,".",-1)),m(T,{value:l.value,"onUpdate:value":C[1]||(C[1]=k=>l.value=k),precision:0,min:0,max:1e3},null,8,["value"]),C[7]||(C[7]=u("span",null,".",-1)),m(T,{value:d.value,"onUpdate:value":C[2]||(C[2]=k=>d.value=k),precision:0,min:0,max:1e3},null,8,["value"])])])]),u("div",Uve,[C[9]||(C[9]=u("div",{class:"form-label"},"版本描述：",-1)),u("div",zve,[m(M,{value:c.value,"onUpdate:value":C[3]||(C[3]=k=>c.value=k),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},Gve=Ne(qve,[["__scopeId","data-v-6e65e672"]]),Xve={class:"version-detail"},Wve={class:"version-desc flex-center"},Yve={class:"version-file-box"},Jve={class:"version-text"},Kve={class:"version-text"},Zve=["onClick"],Qve={class:"version-header"},e_e={class:"version-title"},t_e={class:"time-text flex-center"},n_e={class:"version-file-box"},o_e={class:"version-text"},i_e={class:"version-text"},r_e={class:"version-desc"},s_e={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(n,{expose:e,emit:t}){const o=Ms().query,i=X(!1),r=X(""),s=X(""),a=t,l=n,d=Vn(),c=We(()=>d.robotInfo),p=X([]),f=()=>{i.value=!0,h(),Ld({robot_key:o.robot_key}).then(_=>{const b=(_==null?void 0:_.data)||{};r.value=b.remote_addr||"",s.value=b.user_agent||""})},h=()=>{sy({robot_key:o.robot_key}).then(_=>{p.value=_.data.versions||[]})},v=_=>{_n.confirm({title:`确定要恢复到v${_.version}版吗`,icon:null,content:St("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){Bp({robot_key:o.robot_key,version_id:_.version_id}).then(b=>{a("setVersion",b.data),i.value=!1,b.res==0&&mt.success("设置成功")})},onCancel(){}})},y=_=>{_==""?o_({robot_key:o.robot_key,data_type:1}).then(b=>{a("preview",b.data,_),i.value=!1}):Bp({robot_key:o.robot_key,version_id:_}).then(b=>{a("preview",b.data,_),i.value=!1})};function g(_,b="YYYY-MM-DD HH:mm:ss"){return _<=0?"--":yo(_*1e3).format(b)}return e({showDrawer:f}),(_,b)=>{const C=On,T=jr,M=Vr,S=Fr,k=Hr,A=Ty;return w(),R("div",null,[m(A,{open:i.value,"onUpdate:open":b[2]||(b[2]=$=>i.value=$),title:"发布详情",placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:x(()=>[u("div",Xve,[c.value.draft_save_time&&c.value.draft_save_time!=0?(w(),R("div",{key:0,class:"version-list",onClick:b[0]||(b[0]=$=>y(""))},[b[3]||(b[3]=u("div",{class:"version-header"},[u("div",{class:"version-title"},"当前最新草稿")],-1)),u("div",Wve,[U(" 最近保存于"+H(g(c.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),u("div",Yve,[m(T,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:x(()=>[u("div",Jve," IP："+H(r.value||"--"),1),u("div",Kve," User Agent："+H(s.value||"--"),1)]),default:x(()=>[m(C,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):ne("",!0),(w(!0),R(se,null,ge(p.value,($,B)=>(w(),R("div",{class:"version-list",onClick:O=>y($.version_id),key:$.version},[u("div",Qve,[u("div",e_e,[U(" v"+H($.version)+" ",1),u("span",t_e,[U(H(g($.create_time))+" ",1),u("div",n_e,[m(T,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:x(()=>[u("div",o_e," IP："+H($.last_edit_ip||"--"),1),u("div",i_e," User Agent："+H($.last_edit_user_agent||"--"),1)]),default:x(()=>[m(C,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),m(k,null,{overlay:x(()=>[m(S,null,{default:x(()=>[m(M,{disabled:l.isLockedByOther,onClick:O=>v($)},{default:x(()=>[...b[4]||(b[4]=[U(" 恢复到此版本 ",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024)]),default:x(()=>[u("div",{class:"hover-btn-box",onClick:b[1]||(b[1]=Ct(()=>{},["stop"]))},[m(K(My))])]),_:2},1024)]),u("div",r_e,H($.version_desc),1)],8,Zve))),128))])]),_:1},8,["open"])])}}},a_e=Ne(s_e,[["__scopeId","data-v-8bc6bcdb"]]),l_e={class:"workflow-page"},u_e={class:"page-body"},d_e={class:"page-left"},c_e={class:"page-container"},qv="wf_uni_identifier",p_e=300*1e3,Gv=60*1e3,f_e=20*1e3,Xv="wf_autosave_leader_",Wv=120*1e3,Yv="当前草稿已经不是最新的草稿版本，保存后会覆盖，确认保存么？",h_e={__name:"index",setup(n){const e=__(),t=Ms(),o=t.query,i=X(t.query.robot_key),r=()=>{try{let we=localStorage.getItem(qv);return we||(we=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(qv,we)),we}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},s=()=>{try{const we=navigator.userAgent||"",Be=navigator.platform||"";let Qe="Unknown";/Windows/i.test(we)?Qe="Windows":/Macintosh|Mac OS X/i.test(we)?Qe="MacOS":/Linux/i.test(we)?Qe="Linux":/Android/i.test(we)?Qe="Android":/iPhone|iPad|iPod/i.test(we)&&(Qe="iOS");let qe="Unknown",ht="";const ut=we.match(/Edg\/([\d\.]+)/)||we.match(/Chrome\/([\d\.]+)/)||we.match(/Firefox\/([\d\.]+)/)||we.match(/Version\/([\d\.]+).*Safari/);return ut&&(we.includes("Edg/")?qe="Edge":we.includes("Chrome/")?qe="Chrome":we.includes("Firefox/")?qe="Firefox":we.includes("Safari")&&!we.includes("Chrome")&&(qe="Safari"),ht=ut[1]),`platform=${Be}; os=${Qe}; browser=${qe}/${ht}; ua=${we}`}catch{return"ua=unknown"}},a=X(null),l=X(null),d=Rs(),c=Vn(),p=We(()=>{var we;return(we=l.value)==null?void 0:we.lfRef});We(()=>d.triggerList);const f=X(""),h=X(""),v=X(null),y=We(()=>c.robotInfo.loop_save_canvas_status);ct(y,we=>{we>0&&ie("automatic")});const g=tC(),_=X(!0),b=X(!1),C=X(!0);let T=null,M=null,S=Date.now(),k="";const A=X(""),$=X(""),B=X(""),O=X(!1),P=`${Date.now()}_${Math.random()}`;let E=null;const D=()=>`${Xv}${i.value}`,N=()=>`wf_open_tabs_${i.value}`;function F(){try{const we=parseInt(localStorage.getItem(N())||"0",10)||0;localStorage.setItem(N(),String(we+1))}catch(we){console.warn("incrementOpenTabs error",we)}}function Y(){try{const we=parseInt(localStorage.getItem(N())||"0",10)||0,Be=Math.max(0,we-1);Be<=0?setTimeout(()=>{localStorage.removeItem(N()),localStorage.removeItem(D())},0):localStorage.setItem(N(),String(Be))}catch(we){console.warn("decrementOpenTabs error",we)}}function L(){try{const we=Date.now();for(let Be=0;Be<localStorage.length;Be++){const Qe=localStorage.key(Be);if(Qe&&Qe.startsWith(Xv)){const qe=localStorage.getItem(Qe);let ht=null;try{ht=qe?JSON.parse(qe):null}catch{ht=null}(!ht||typeof ht.ts!="number"||we-ht.ts>Gv)&&localStorage.removeItem(Qe)}}}catch(we){console.warn("cleanupExpiredLeaderKeys error",we)}}function j(){try{const we=localStorage.getItem(D());return we?JSON.parse(we):null}catch{return null}}function le(){localStorage.setItem(D(),JSON.stringify({tabId:P,ts:Date.now()}))}function z(){const we=j();return!we||Date.now()-we.ts>Gv?(le(),!0):we.tabId===P}function V(){const we=j();we&&we.tabId===P&&localStorage.removeItem(D())}function J(we){try{const Be=localStorage.getItem(we),Qe=Be?JSON.parse(Be):null;Qe&&Qe.tabId===P&&localStorage.removeItem(we)}catch{}}function oe(we){we.key===D()&&(ot(),L(),O.value=z())}function W(){document.visibilityState==="visible"&&(O.value=z()),L(),ot()}function q(){re(),L(),O.value=z(),E=setInterval(()=>{const we=z();O.value=we,we&&localStorage.setItem(D(),JSON.stringify({tabId:P,ts:Date.now()}))},f_e),window.addEventListener("storage",oe),document.addEventListener("visibilitychange",W),window.addEventListener("beforeunload",()=>{V(),Y()}),window.addEventListener("pagehide",()=>{V(),Y()})}function re(){E&&clearInterval(E),E=null,window.removeEventListener("storage",oe),document.removeEventListener("visibilitychange",W),window.removeEventListener("beforeunload",V)}function ue(){try{const we=G();return JSON.stringify(we)}catch{return""}}function xe(){Te(),k=ue(),S=Date.now(),M=setInterval(()=>{if(!_.value)return;const we=ue();we&&we!==k&&(k=we,S=Date.now(),me())},2*1e3)}function Te(){M&&clearInterval(M),M=null}function me(){try{if(!_.value||b.value)return;(!C.value||!z())&&(le(),C.value=!0),ot()}catch{}}function pe(){Ge(),T=setInterval(()=>{_.value&&C.value&&Date.now()-S>=p_e&&(C.value=!1,mt.warning("已超过5分钟无改动，自动保存已暂停"),ot())},30*1e3)}function Ge(){T&&clearInterval(T),T=null}async function Le(){try{const we=await Ld({robot_key:i.value,uni_identifier:r(),user_agent:s()}),Be=(we==null?void 0:we.data)||{};b.value=!Be.lock_res,A.value=Be.remote_addr||"",$.value=Be.user_agent||"",B.value=Be.login_user_name||"",c.setIsLockedByOther(b.value),ot()}catch{b.value=!1,c.setIsLockedByOther(b.value)}}async function _e(){try{const we=await Ld({robot_key:i.value,uni_identifier:r(),user_agent:s()}),Be=(we==null?void 0:we.data)||{};return Be.lock_res?(b.value=!1,A.value="",$.value="",B.value="",c.setIsLockedByOther(b.value),!0):(b.value=!Be.lock_res,A.value=Be.remote_addr||"",$.value=Be.user_agent||"",B.value=Be.login_user_name||"",c.setIsLockedByOther(b.value),!1)}catch{return b.value=!1,c.setIsLockedByOther(b.value),!0}}function he(we){we=we||[];let Be=[],Qe=[];we.forEach(qe=>{if(qe.node_type==0){let ht=JSON.parse(qe.node_info_json);ht.type=="custom-edge"&&(ht.pointsList=[],ht.type="custom-bezier-edge"),Qe.push(ht)}else{const ht=g[qe.node_type];qe.type=ht;let ut=JSON.parse(qe.node_info_json);qe.node_type!=0&&(ut.type=g[qe.node_type],ut.id=qe.node_key||Ki(ut.type),ut.x=ut.x||0,ut.y=ut.y||0),qe.node_type==-1&&(qe.node_params=ut.dataRaw),ut.nodeSortKey?qe.nodeSortKey=ut.nodeSortKey:qe.nodeSortKey=ut.id.substring(0,8)+ut.id.substring(ut.id.length-8),qe.dataRaw=ut.dataRaw||qe.node_params,delete qe.node_info_json,ut.loop_parent_key=qe.loop_parent_key,ut.properties=qe,ut.properties.width=ut.width,ut.properties.height=ut.height,Be.push(ut)}}),De({nodes:Be,edges:Qe})}const be=we=>{a.value.open(we,!0)},De=we=>{l.value.setData(we)},G=()=>{let we=l.value.getData(),Be=[],Qe={};return we.edges.forEach(qe=>{let ht={node_key:qe.id,node_name:"edge",node_type:0},ut={...qe};ht.node_info_json=ut,Be.push(ht),qe.sourceAnchorId&&(Qe[qe.sourceAnchorId]=qe.targetNodeId),qe.targetAnchorId&&(Qe[qe.targetAnchorId]=qe.sourceNodeId)}),we.nodes.forEach(qe=>{var an;let ht={...qe.properties,node_type:+qe.properties.node_type,node_key:qe.id};ht.node_info_json={type:qe.type,x:qe.x,y:qe.y,width:qe.properties.width,height:qe.properties.height,id:qe.id,nodeSortKey:ht.nodeSortKey,dataRaw:qe.properties.node_params},ht.next_node_key=Qe[ht.nodeSortKey+"-anchor_right"]||"",ht.prev_node_key=Qe[ht.nodeSortKey+"-anchor_left"]||"";let ut=JSON.parse(ht.node_params);if(ht.node_type==1,ht.node_type==2&&ut.term&&ut.term.length>0&&ut.term.forEach((un,kn)=>{let Bt=ht.nodeSortKey+"-anchor_"+kn;un.next_node_key=Qe[Bt]||""}),ht.node_type==3&&ut.cate&&ut.cate.categorys&&ut.cate.categorys.length>0&&ut.cate.categorys.forEach((un,kn)=>{let Bt=ht.nodeSortKey+"-anchor_"+kn;un.next_node_key=Qe[Bt]||""}),ht.node_type==43&&ut.question.answer_type=="menu"&&ut.question&&ut.question.reply_content_list&&ut.question.reply_content_list.length>0&&(((an=ut.question.reply_content_list[0].smart_menu)==null?void 0:an.menu_content)||[]).forEach((kn,Bt)=>{let Rn=ht.nodeSortKey+"-anchor_"+Bt;kn.next_node_key=Qe[Rn]||""}),ht.node_type==17){let un=Qe[ht.nodeSortKey+"-anchor_right_exception"];un&&(ut.code_run.exception=un)}if(ht.node_type==41){let un=Qe[ht.nodeSortKey+"-anchor_right_exception"];un&&(ut.workflow.exception=un)}ht.node_params=ut,delete ht.dataRaw,Be.push(ht)}),Be},ie=async we=>{if(b.value){we==="handle"&&mt.warning("当前已有其他用户在编辑中，无法保存");return}if(!_.value||!C.value&&we==="automatic")return;let Be=G();if(we==="handle"){const Qe=+c.robotInfo.draft_save_time||0,qe={robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:Qe,re_cover_save:0,uni_identifier:r(),user_agent:s()},ht=await je(qe,!1);ht.saved?mt.success("保存成功"):ht.behind;return}try{await _r({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id);const Qe=+c.robotInfo.draft_save_time||yo().unix();c.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:Qe})}catch{}};let ae=null,Ae=!1,fe=!1,Ie=0;async function je(we,Be){var Qe,qe;try{const ht={...we,uni_identifier:r(),user_agent:s()},ut=await _r(ht);if(!(((Qe=ut==null?void 0:ut.data)==null?void 0:Qe.behind_draft)==1||(ut==null?void 0:ut.behind_draft)==1)){await c.getRobot(o.id);const un=+c.robotInfo.draft_save_time||yo().unix();return c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:un}),{saved:!0,behind:!1}}if(Be){const un=Date.now();if(Ae||fe&&un-Ie<Wv)return C.value=!1,ot(),{saved:!1,behind:!0};Ae=!0,fe=!0,Ie=un}return await new Promise(un=>{_n.confirm({title:"提示",icon:null,content:Yv,okText:"确 定",cancelText:"取 消",async onOk(){var Rn;const kn={...we,re_cover_save:1,uni_identifier:r(),user_agent:s()},Bt=await _r(kn);if(Bt&&Bt.res==0||!((Rn=Bt==null?void 0:Bt.data)!=null&&Rn.behind_draft)){await c.getRobot(o.id);const Tn=+c.robotInfo.draft_save_time||yo().unix();c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Tn})}Be&&(C.value=!0,ot(),Ae=!1,fe=!1,Ie=Date.now()),un({saved:!0,behind:!0})},onCancel(){Be&&(C.value=!1,ot(),Ae=!1,Ie=Date.now()),un({saved:!1,behind:!0})}})})}catch(ht){if(!(((qe=ht==null?void 0:ht.data)==null?void 0:qe.behind_draft)==1||(ht==null?void 0:ht.behind_draft)==1))return{saved:!1,behind:!1};if(Be){const an=Date.now();if(Ae||fe&&an-Ie<Wv)return C.value=!1,ot(),{saved:!1,behind:!0};Ae=!0,fe=!0,Ie=an}return await new Promise(an=>{_n.confirm({title:"提示",icon:null,content:Yv,okText:"确 定",cancelText:"取 消",async onOk(){var Bt;const un={...we,re_cover_save:1,uni_identifier:r(),user_agent:s()},kn=await _r(un);if(kn&&kn.res==0||!((Bt=kn==null?void 0:kn.data)!=null&&Bt.behind_draft)){await c.getRobot(o.id);const Rn=+c.robotInfo.draft_save_time||yo().unix();c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Rn})}Be&&(C.value=!0,ot(),Ae=!1,fe=!1,Ie=Date.now()),an({saved:!0,behind:!0})},onCancel(){Be&&(C.value=!1,ot(),Ae=!1,Ie=Date.now()),an({saved:!1,behind:!0})}})})}}async function Ue(){if(b.value||!_.value||!C.value)return;const we=G(),Be=+c.robotInfo.draft_save_time||0,Qe={robot_key:i.value,data_type:1,node_list:JSON.stringify(we),draft_save_type:"automatic",draft_save_time:Be,re_cover_save:0,uni_identifier:r()};await je(Qe,!0)}function ot(){ae&&clearInterval(ae),ae=null,O.value=z(),_.value&&C.value&&!b.value&&z()&&(ae=setInterval(()=>{Ue()},60*1e3))}Hc(()=>{ae&&clearInterval(ae),Ge(),Te(),re(),V(),Y()});const it=X(null),Ke=X(!1),dt=we=>{it.value.show(we)},ce=async()=>{if(b.value){mt.warning("当前已有其他用户在编辑中，无法发布");return}let we=G(),Be=[];for(let Qe=0;Qe<we.length;Qe++){let qe=we[Qe];qe.node_type==0||qe.node_type==-1||qe.node_type==43||qe.loop_parent_key||(qe.node_type==1?qe.next_node_key==""&&Be.push(qe):qe.node_type==7||qe.node_type==3?qe.prev_node_key==""&&Be.push(qe):(qe.next_node_key==""||qe.prev_node_key=="")&&Be.push(qe))}if(Be.length>0){mt.error("存在未关联的节点，请先关联");return}try{await _r({robot_key:i.value,data_type:1,node_list:JSON.stringify(we),draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id),c.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0}),dt(JSON.stringify(we))}catch{Ke.value=!1}};let ve=X(null);const Ce=we=>{ve.value=we,we.properties.node_sub_type!=51&&me()},Se=()=>{me()},Fe=async()=>SC({model_type:"LLM"}).then(we=>{let Be=we.data||[],{newList:Qe}=g_(Be);c.setModelList(Qe)}),ze=X({diy_global:[],sys_global:[]}),Xe=()=>{let Be=G().filter(Qe=>Qe.node_type==1);Be.length>0&&(ze.value=Be[0].node_params.start)},lt=X(null),wt=()=>{C.value=!1,ot(),lt.value.showDrawer()},Yt=we=>{if(b.value){mt.warning("当前已有其他用户在编辑中，无法恢复");return}const Be=G();_r({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}).then(()=>{c.getRobot(o.id).then(()=>{c.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0})}),f.value="",h.value=null,he(we),mt.success("已保存当前草稿并恢复版本"),_.value=!0,C.value=!0,ot()})},zt=async(we,Be)=>{if(!b.value){const Qe=G();try{await _r({robot_key:i.value,data_type:1,node_list:JSON.stringify(Qe),draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id),c.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0})}catch{}}h.value=Be,clearInterval(ae),he(we)},gn=()=>{v.value.openRunTest()},yn=async()=>{if(b.value){mt.warning("当前已有其他用户在编辑中，无法编辑");return}await _e()&&(_.value=!0,C.value=!0,k=ue(),S=Date.now(),xe(),ot(),mt.success("已进入编辑模式"),be(1))},jt=we=>{we=Array.isArray(we)?we:[];let Be=[],Qe=[];if(we.forEach(qe=>{qe.node_type==21&&(qe.has_loaded===""||qe.plugin_version!==qe.remote_plugin_version?Qe.push(qe):qe.has_loaded==="false"&&Be.push(qe))}),Be.length||Qe.length){let qe=[...new Set([...Be.map(an=>an.node_name),...Qe.map(an=>an.node_name)])];const ht={"font-weight":500,"margin-top":"8px","margin-bottom":"4px"},ut={color:"#8c8c8c"};_n.confirm({title:"工作流异常修复",content:St("div",{},[St("div",{style:ht},"以下插件状态异常，是否自动安装插件并开启？"),St("div",{style:ut},qe.join("、"))]),onOk:async()=>{const an=[];Be.length&&an.push(hC({name:Be.map(un=>un.plugin_name).toString()})),Qe.length&&an.push(vC({download_data:JSON.stringify(Qe.map(un=>({url:un.latest_version_detail_url,version_id:un.latest_version_detail_id})))})),await Promise.all(an),mt.success("操作完成，即将重新加载..."),setTimeout(()=>{window.location.reload()},1200)}})}},Ee=async()=>{await Fe(),await d.getTriggerList(i.value),d.getTriggerOfficialMsg(i.value),await e.getAllmodelList(),d.getAllLibraryList();const we=await o_({robot_key:i.value,data_type:1});he(we.data),jt(we.data)};return Gi("handleAutoSaveDraft",async(we="automatic")=>{await ie(we)}),at(async()=>{F(),await Ee(),await Le(),b.value?(_.value=!1,C.value=!1,mt.warning("其他人在编辑，已切换为查看模式")):await _e()?(_.value=!0,C.value=!0):(_.value=!1,C.value=!1),q(),ot();let we=D();ct(()=>t.query.robot_key,Be=>{!Be||Be===i.value||(J(we),Y(),i.value=Be,we=D(),F(),q(),ot())}),pe(),xe(),t.query.show_tips&&mt.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)}),(we,Be)=>(w(),R("div",l_e,[m(Ive,{ref_key:"pageHeaderRef",ref:v,onEdit:yn,onSave:ie,onRelease:ce,onGetGlobal:Xe,onGetVersionRecord:wt,lf:p.value,currentVersion:h.value,start_node_params:ze.value,saveLoading:Ke.value,isEditing:_.value,isLockedByOther:b.value,lockRemoteAddr:A.value,lockUserAgent:$.value,loginUserName:B.value,autoSaveEnabled:C.value,isLeader:O.value},null,8,["lf","currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),u("div",u_e,[u("div",d_e,[m(RC)]),u("div",c_e,[m(Vhe,{ref_key:"workflowCanvasRef",ref:l,onSelectedNode:Ce,onOnDeleteNode:Se,onRunTest:gn},null,512)])]),m(kC,{ref_key:"addRobotAlertRef",ref:a},null,512),m(Gve,{ref_key:"versionModelRef",ref:it},null,512),m(a_e,{ref_key:"publishDetailRef",ref:lt,onPreview:zt,onSetVersion:Yt,isLockedByOther:b.value},null,8,["isLockedByOther"])]))}},Cme=Ne(h_e,[["__scopeId","data-v-867cb616"]]);export{Cme as default};
