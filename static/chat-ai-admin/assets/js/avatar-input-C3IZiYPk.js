import{u as U}from"../../index-DSFcP5NQ.js";import{_ as B}from"./emoji-mart-BBMRoEa3.js";import{F as M,a0 as V,a1 as A,p as N,M as z,b as h}from"./ui-antd-Dl1wwwCD.js";import{r as t,w as D,a as y,b as n,q as J,y as b,t as x,p as v,e as C,u as m,v as R}from"./vue-chunks-BdaA73Wf.js";const S={class:"avatar-uploader"},q=["src"],E={class:"ant-upload-text"},T=["src"],G={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(l,{emit:I}){const{t:i}=U("views.public-library.add.components.avatar-input");function g(e){return new Promise((s,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>s(a.result),a.onerror=d=>r(d)})}const _=I,F=l,o=t([]),f=t(!1),u=t("");D(()=>F.value,e=>{u.value=e},{immediate:!0});const O=M.useInjectFormItemContext(),j=()=>{let e={imageUrl:u.value,file:o.value[0].originFileObj};_("change",e),_("update:value",e.imageUrl),O.onFieldChange()},k=e=>e.type==="image/jpeg"||e.type==="image/png"?e.size/1024<100?(o.value=[e],g(e).then(a=>{u.value=a,f.value=!1,j()}),!1):(h.error(i("msg_size_error")),!1):(h.error(i("msg_format_error")),!1),c=t(!1),w=t(""),p=t(""),L=()=>{c.value=!1,p.value=""},P=async e=>{!e.url&&!e.preview&&(e.preview=await g(e.originFileObj)),w.value=e.url||e.preview,c.value=!0,p.value=e.name||e.url.substring(e.url.lastIndexOf("/")+1)};return(e,s)=>{const r=N,a=z;return n(),y("div",S,[l.value?(n(),y("img",{key:0,class:"avatar",src:l.value,alt:"avatar"},null,8,q)):J("",!0),b(r,{class:"upload-upload","file-list":o.value,"onUpdate:fileList":s[0]||(s[0]=d=>o.value=d),"list-type":"picture-card","show-upload-list":!1,"before-upload":k,accept:".jpg,.png,.jpeg",onPreview:P},{default:x(()=>[v("div",null,[f.value?(n(),C(m(V),{key:0})):(n(),C(m(A),{key:1})),v("div",E,R(m(i)("btn_upload_photo")),1)])]),_:1},8,["file-list"]),b(a,{open:c.value,title:p.value,footer:null,onCancel:L},{default:x(()=>[v("img",{alt:"example",style:{width:"100%"},src:w.value},null,8,T)]),_:1},8,["open","title"])])}}},X=B(G,[["__scopeId","data-v-3877d178"]]);export{X as A};
//# sourceMappingURL=avatar-input-C3IZiYPk.js.map
