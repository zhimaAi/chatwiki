import{b as U,W as L,M as B,k as _}from"../../index-CzPebXix.js";import{F as N}from"./index-BgVvqN-n.js";import{P as M}from"./PlusOutlined-BlmIiILr.js";import{d as s,w as V,N as w,O as l,a6 as A,j as h,U as x,X as d,S as y,u as P}from"./vue-chunks-BRsu9_To.js";import{_ as J}from"./index-7Ecr060x.js";const G={class:"avatar-uploader"},R=["src"],S=["src"],z={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:b}){function m(e){return new Promise((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=p=>r(p)})}const v=b,k=n,o=s([]),g=s(!1),i=s("");V(()=>k.value,e=>{i.value=e},{immediate:!0});const C=N.useInjectFormItemContext(),O=()=>{let e={imageUrl:i.value,file:o.value[0].originFileObj};v("change",e),v("update:value",e.imageUrl),C.onFieldChange()},j=e=>e.type==="image/jpeg"||e.type==="image/png"?e.size/1024<100?(o.value=[e],m(e).then(a=>{i.value=a,g.value=!1,O()}),!1):(_.error("知识库封面图片大小不能超过100kb"),!1):(_.error("知识库封面只支持JPG、PNG格式的图片"),!1),u=s(!1),f=s(""),c=s(""),F=()=>{u.value=!1,c.value=""},I=async e=>{!e.url&&!e.preview&&(e.preview=await m(e.originFileObj)),f.value=e.url||e.preview,u.value=!0,c.value=e.name||e.url.substring(e.url.lastIndexOf("/")+1)};return(e,t)=>{const r=J,a=B;return l(),w("div",G,[n.value?(l(),w("img",{key:0,class:"avatar",src:n.value,alt:"avatar"},null,8,R)):A("",!0),h(r,{class:"upload-upload","file-list":o.value,"onUpdate:fileList":t[0]||(t[0]=p=>o.value=p),"list-type":"picture-card","show-upload-list":!1,"before-upload":j,accept:".jpg,.png,.jpeg",onPreview:I},{default:x(()=>[d("div",null,[g.value?(l(),y(P(L),{key:0})):(l(),y(P(M),{key:1})),t[1]||(t[1]=d("div",{class:"ant-upload-text"},"上传照片",-1))])]),_:1},8,["file-list"]),h(a,{open:u.value,title:c.value,footer:null,onCancel:F},{default:x(()=>[d("img",{alt:"example",style:{width:"100%"},src:f.value},null,8,S)]),_:1},8,["open","title"])])}}},q=U(z,[["__scopeId","data-v-d297d489"]]);export{q as A};
