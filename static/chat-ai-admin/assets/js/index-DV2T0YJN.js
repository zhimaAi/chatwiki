import{cp as J,cq as X,_ as K,j as W,A as Z,cr as tt,cs as et,ct as at,cu as lt}from"../../index-DxV-PNCd.js";import{P as st}from"./page-tabs-B1r79lJe.js";import{G as q,E as G,T as N,M as nt,d as B,X as it,H as ot,y as dt,R,z as _t}from"./ui-antd-AfNpv4wx.js";import{f as c,ac as h,ad as u,k as s,ar as o,G as m,at as d,as as n,r as P,o as rt,u as M,ae as S,az as w,F as ut,ax as ct}from"./vue-chunks-CGLjTDrY.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";const pt={__name:"detail-modal",setup(O,{expose:z}){const k=c(!1),f=c(!1),r=c([]),i=(t,p)=>{k.value=!0,f.value=!0,p==1?D(t):_(t)},D=t=>{J({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:t.library_id,data_id:t.data_id}).then(p=>{r.value=p.data||[]}).finally(()=>{f.value=!1})},_=t=>{X({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:t.library_id,group_id:t.group_id}).then(p=>{r.value=p.data||[]}).finally(()=>{f.value=!1})};return z({show:i}),(t,p)=>{const g=G,y=N,C=q,Y=nt;return u(),h("div",null,[s(Y,{open:k.value,"onUpdate:open":p[0]||(p[0]=v=>k.value=v),title:"机器人分布详情",width:624,footer:null},{default:o(()=>[s(C,{"data-source":r.value,loading:f.value,pagination:!1,scroll:{y:500}},{default:o(()=>[s(g,{key:"index","data-index":"index",title:"排名",width:100},{default:o(({index:v})=>[m(d(v+1),1)]),_:1}),s(g,{key:"robot_name",title:"机器人",width:140},{default:o(({record:v})=>[m(d(v.robot_name),1)]),_:1}),s(g,{key:"tip",title:"触发次数",width:120},{default:o(({record:v})=>[s(y,{gap:12},{default:o(()=>[n("span",null,d(v.tip),1)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading"])]),_:1},8,["open"])])}}},vt={class:"library-page"},mt={class:"statics-block"},yt={class:"statics-item"},gt={class:"num"},ft={class:"search-box"},bt={class:"tab-box"},ht={class:"library-page-body"},xt={class:"list-box"},kt={key:0},wt={key:1,class:"qa-list-box"},Dt={class:"list-item"},Ct={class:"list-content"},Yt={class:"list-item",style:{color:"#8c8c8c"}},Lt={class:"list-content"},Mt={key:0},St={key:0},zt=["onClick"],Rt={__name:"index",setup(O){const z=W(),k=c([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),f=c(0),r=c([B().startOf("month"),B()]),i=c(1),D=c([]),_=P({begin_date_ymd:r.value[0].format("YYYYMMDD"),end_date_ymd:r.value[1].format("YYYYMMDD"),library_id:void 0}),t=P({page:1,size:100,total:0}),p=[{label:"按内容",value:1},{label:"按知识库分组",value:3},{label:"按知识库",value:2}],g=c([]),y=c(!1),C=()=>{y.value=!0,et({..._,...t}).then(l=>{let e=l.data.list||[];e=e.map(b=>({...b})),g.value=e,t.total=+l.data.total}).finally(()=>{y.value=!1})},Y=()=>{y.value=!0,at({..._,...t}).then(l=>{let e=l.data.list||[];e=e.map(b=>({...b})),g.value=e,t.total=+l.data.total}).finally(()=>{y.value=!1})},v=()=>{y.value=!0,lt({..._,...t}).then(l=>{let e=l.data.list||[];e=e.map(b=>({...b})),g.value=e,t.total=+l.data.total}).finally(()=>{y.value=!1})},U=()=>{t.total=0,i.value==1?t.size=100:t.size=20,L()},V=l=>{t.page=l.current,t.size=l.pageSize,i.value==1&&C(),i.value==2&&Y(),i.value==3&&v()},L=()=>{t.page=1,i.value==1&&C(),i.value==2&&Y(),i.value==3&&v()},F=()=>{_.begin_date_ymd="",_.end_date_ymd="",r.value&&r.value.length>0&&(_.begin_date_ymd=r.value[0].format("YYYYMMDD"),_.end_date_ymd=r.value[1].format("YYYYMMDD")),L()},T=c(null),j=l=>{T.value.show({begin_date_ymd:_.begin_date_ymd,end_date_ymd:_.end_date_ymd,library_id:l.library_id,data_id:l.data_id,group_id:l.group_id},i.value)},A=()=>{tt().then(l=>{f.value=l.data.tip_total})};return rt(()=>{L(),A(),Z().then(l=>{D.value=l.data})}),(l,e)=>{const b=it,E=ot,Q=_t,$=dt,x=G,H=N,I=q;return u(),h("div",vt,[s(st,{class:"mb-16",tabs:k.value,active:"/trigger-statics/list"},null,8,["tabs"]),n("div",mt,[n("div",yt,[e[3]||(e[3]=n("div",{class:"title"},"合计触发次数",-1)),n("div",gt,d(f.value),1)])]),n("div",ft,[s(b,{value:r.value,"onUpdate:value":e[0]||(e[0]=a=>r.value=a),allowClear:!1,onChange:F,style:{width:"256px"},presets:M(z)},null,8,["value","presets"])]),n("div",bt,[e[4]||(e[4]=n("div",{class:"main-title"},"触发次数排行榜",-1)),s(E,{onChange:U,value:i.value,"onUpdate:value":e[1]||(e[1]=a=>i.value=a),options:p},null,8,["value"]),i.value==1||i.value==3?(u(),S($,{key:0,placeholder:"全部知识库",allowClear:"",onChange:L,value:_.library_id,"onUpdate:value":e[2]||(e[2]=a=>_.library_id=a),style:{width:"220px"}},{default:o(()=>[(u(!0),h(ut,null,ct(D.value,a=>(u(),S(Q,{value:a.id},{default:o(()=>[m(d(a.library_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])):w("",!0)]),n("div",ht,[n("div",xt,[s(I,{"data-source":g.value,sticky:"",loading:y.value,pagination:{current:t.page,total:t.total,pageSize:t.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:V,scroll:{x:800}},{default:o(()=>[s(x,{key:"index","data-index":"index",title:"排名",width:100},{default:o(({index:a})=>[m(d(a+(t.page-1)*t.size+1),1)]),_:1}),i.value==1?(u(),S(x,{key:"content","data-index":"content",title:"知识内容",width:380},{default:o(({record:a})=>[a.content?(u(),h("div",kt,d(a.content),1)):(u(),h("div",wt,[n("div",Dt,[e[5]||(e[5]=n("div",{class:"list-label"},"问题",-1)),n("div",Ct,d(a.question),1)]),n("div",Yt,[e[6]||(e[6]=n("div",{class:"list-label"},"答案",-1)),n("div",Lt,d(a.answer),1)])]))]),_:1})):w("",!0),i.value==3?(u(),S(x,{key:"group_name",title:"知识库分组",width:120},{default:o(({record:a})=>[m(d(a.group_name),1)]),_:1})):w("",!0),s(x,{key:"library_name",title:"所属知识库",width:140},{default:o(({record:a})=>[m(d(a.library_name)+" ",1),i.value==1?(u(),h("span",Mt,[s(M(R)),m(" "+d(a.group_name||"未分组")+" ",1),a.library_file_name?(u(),h("span",St,[s(M(R)),m(" "+d(a.library_file_name),1)])):w("",!0)])):w("",!0)]),_:1}),s(x,{key:"tip",title:"触发次数",width:100},{default:o(({record:a})=>[s(H,{gap:12},{default:o(()=>[n("span",null,d(a.tip),1),n("a",{onClick:Tt=>j(a)},[e[7]||(e[7]=m("详情",-1)),s(M(R))],8,zt)]),_:2},1024)]),_:1}),s(x,{key:"percentage",title:"占比",width:100},{default:o(({record:a})=>[m(d(a.percentage)+"% ",1)]),_:1})]),_:1},8,["data-source","loading","pagination"])])]),s(pt,{ref_key:"detailModalRef",ref:T},null,512)])}}},Vt=K(Rt,[["__scopeId","data-v-1aad7f62"]]);export{Vt as default};
