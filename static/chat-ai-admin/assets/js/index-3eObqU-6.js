import{X as _e,Y as o,_ as t,k as M,a5 as s,a6 as ue,a3 as te,G as J,a7 as h,ag as W,f as $,w as se,o as oe,y as F,b as ie,a1 as z,u as C,ae as S,F as N,a9 as D,ad as V,q as ae,a2 as q,n as ne,H as le,J as K,aa as he}from"./vue-chunks-Ci-XTWEs.js";import{u as ce}from"./useEventBus-BwH2zX88.js";import{g as pe}from"./index-Bu5ae_-0.js";import{aa as Q,aj as Z,b1 as ee,h as ve,b as j,d as X}from"../../index-CPkdGIiL.js";import{u as me}from"./useIM-iZh2iz29.js";import{B as U,M as fe,S as ge,P as ye}from"./pull-up.esm-D94Swpvl.js";import{O as ke}from"./observe-dom.esm-CyCedSm-.js";import{ah as be,au as Le,aw as Te,v as Se,u as we,I as xe}from"./ui-antd-Bw8cEW5z.js";import{_ as Ce}from"./index-AGdtDeuS.js";import{h as $e}from"./index-S7PCNZdQ.js";import"./utils-ChQO-_r6.js";import"./index-CvIjQ1XU.js";const Re=(c={})=>Q.get({url:"/manage/getReceiverList",params:c}),Me=(c={})=>Q.post({url:"/chat/message",data:c}),Ie=(c={})=>Q.post({url:"/manage/setReceiverRead",data:c}),Y=_e("chatMonitor",{state:()=>({im:null,selectedRobotId:"",robotList:[],selectedReceiverId:"",receiverList:[],receiverListPage:{page:0,size:10},activeChat:null,chatMessagePageSize:10,messageList:[],messageListScrollTop:0,chatMessageLoadCompleted:!1,messageListLoading:!1}),getters:{},actions:{async init(){this.selectedRobotId="",this.selectedReceiverId="",this.robotList=[],this.receiverList=[],this.messageList=[],this.receiverListPage={page:0,size:10},this.messageListScrollTop=0,this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.activeChat=null,await this.getRobotList(),await this.getReceiverList(),this.receiverList.length>0&&await this.switchChat(this.receiverList[0]),this.initIM()},closeIM(){this.im&&this.im.close()},initIM(){const c=me(),d=ve();this.im=c,c.connect(d.user_id),c.on("message",e=>{!e.data||e.msg_type!=="receiver_notify"||((e.change=="create"||e.change=="update")&&this.onAddReceiver(e),e.change=="delete"&&this.onDeleteReceiver(e),(e.change=="c_message"||e.change=="ai_message")&&this.onAddMessage(e))})},onAddMessage(c){if(!this.activeChat)return;const d=ce();let e=c.data;if(this.activeChat.session_id==e.session_id){if(e.displayName=e.name||e.nickname,e.dispayTime=ee(e.create_time),e.uid=Z(32),e.loading=!1,e.menu_json&&typeof e.menu_json=="string"&&(e.menu_json=JSON.parse(e.menu_json)),e.quote_file&&typeof e.quote_file=="string"&&(e.quote_file=JSON.parse(e.quote_file)),e.reply_content_list&&typeof e.reply_content_list=="string")try{e.reply_content_list=JSON.parse(e.reply_content_list)}catch{e.reply_content_list=[]}this.messageList.push(e),d.emit("onAddMessage",e)}},onAddReceiver(c){let d=c.data;d.displayName=d.name||d.nickname,d.come_from=JSON.parse(d.come_from);let e=this.receiverList.find(n=>n.session_id==d.session_id);e?Object.assign(e,d):(this.selectedRobotId==""||this.selectedRobotId==d.robot_id)&&this.receiverList.unshift(d)},onDeleteReceiver(c){let d=c.data,e=this.receiverList.findIndex(n=>n.id==d);e!=-1&&(this.activeChat&&this.activeChat.id==d&&(this.activeChat=null),this.receiverList.splice(e,1))},async getRobotList(c){return pe(c).then(d=>(this.robotList=d.data||[],d))},async getReceiverList(c){return c!=null&&c.page?this.receiverListPage.page=c==null?void 0:c.page:this.receiverListPage.page++,Re({...this.receiverListPage,robot_id:this.selectedRobotId,...c}).then(d=>{let e=d.data.list||[];for(let n=0;n<e.length;n++)e[n].displayName=e[n].name||e[n].nickname,e[n].come_from&&(e[n].come_from=JSON.parse(e[n].come_from));return this.receiverListPage.page==1?this.receiverList=e:this.receiverList=this.receiverList.concat(e),d})},changeRobot(c){this.activeChat=null,this.resetReceiverList(c)},resetReceiverList(c){return this.receiverListPage.page=0,this.receiverList=[],this.getReceiverList(c)},async getChatMessage(){if(this.messageListLoading)return;this.messageListLoading=!0;let c=0,d=this.messageList.filter(n=>!n.isWelcome);d.length>0&&(c=d[0].id);let e={robot_key:this.activeChat.robot_key,openid:this.activeChat.openid,min_id:c,size:this.chatMessagePageSize,rel_user_id:this.activeChat.rel_user_id};return Me(e).then(n=>{var L,g;this.messageListLoading=!1;let i=n.data.list||[];const u=((L=n==null?void 0:n.data)==null?void 0:L.customer)||{},m=((g=n==null?void 0:n.data)==null?void 0:g.robot)||{};i.sort((a,f)=>a.id-f.id);for(let a=0;a<i.length;a++){if(i[a].displayName=i[a].name||i[a].nickname,i[a].is_customer==1?(i[a].displayName=i[a].displayName||u.name,i[a].avatar=i[a].avatar||u.avatar):(i[a].displayName=i[a].displayName||m.robot_name,i[a].avatar=i[a].avatar||m.robot_avatar),i[a].uid=Z(32),i[a].menu_json&&typeof i[a].menu_json=="string"&&(i[a].menu_json=JSON.parse(i[a].menu_json)),i[a].quote_file&&typeof i[a].quote_file=="string"&&(i[a].quote_file=JSON.parse(i[a].quote_file)),i[a].reply_content_list&&typeof i[a].reply_content_list=="string")try{i[a].reply_content_list=JSON.parse(i[a].reply_content_list)}catch{i[a].reply_content_list=[]}i[a].dispayTime=ee(i[a].create_time)}return this.messageList=[...i,...this.messageList],i.length<this.chatMessagePageSize&&(this.chatMessageLoadCompleted=!0),n}).catch(n=>{this.messageListLoading=!1})},claerUnread(){return Ie({id:this.selectedReceiverId})},async switchChat(c){this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.messageList=[],this.messageListScrollTop=0,this.selectedReceiverId=c.id,this.activeChat=c,this.claerUnread(),await this.getChatMessage()}}}),Ne={class:"no-data"},Be={class:"no-data-text"},De={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(c){const d=c;return(e,n)=>{const i=X;return t(),o("div",Ne,[M(i,{name:"empty",style:ue({"font-size":`${d.size}px`})},null,8,["style"]),s("div",Be,[te(e.$slots,"default",{},()=>[J(h(d.text),1)],!0)])])}}},re=j(De,[["__scopeId","data-v-35f939c8"]]),Oe={key:1,class:"chat-list"},Ae=["onClick"],He={class:"avatar"},qe=["src","alt"],je={class:"chat-info"},ze={class:"nickname"},Pe={class:"last-message"},Ue={class:"webapp-source"},Je={key:0,class:"loading-wrapper"},Fe={key:1,class:"finished-text"},Ee={__name:"chat-list ",emits:["switchChat"],setup(c,{expose:d,emit:e}){U.use(fe),U.use(ge),U.use(ke),U.use(ye);const n=e,i=Y(),{getReceiverList:u}=i,{receiverList:m,selectedReceiverId:L}=W(i),g=$(null);let a=null;const f=$(!1),w=$(!1),I=()=>{a=new U(g.value,{scrollY:!0,click:!0,observeDOM:!0,mouseWheel:!0,bounce:!1,scrollbar:{fade:!0,interactive:!0},pullUpLoad:!0}),a.on("pullingUp",()=>{y()})},y=async k=>{if(f.value||w.value){a.finishPullUp();return}f.value=!0;try{(await u(k)).data.list.length===0&&!k.keyword&&(w.value=!0)}catch(x){console.error("加载更多数据失败:",x)}finally{f.value=!1,a.finishPullUp()}},v=k=>{n("switchChat",k)};return se(m,k=>{k.length>0&&F(()=>{a&&a.refresh()})}),oe(()=>{F(()=>{I()})}),ie(()=>{a&&a.destroy()}),d({getData:y}),(k,x)=>{const b=be;return t(),o("div",{class:"scroll-wrapper",ref_key:"scrollRef",ref:g},[C(m).length==0?(t(),z(re,{key:0,size:"140",text:"暂无机器人接待中会话"})):(t(),o("div",Oe,[(t(!0),o(N,null,D(C(m),l=>(t(),o("div",{key:l.id,class:V(["chat-item",{active:l.id===C(L)}]),onClick:B=>v(l)},[s("div",He,[s("img",{src:l.avatar,alt:l.displayName},null,8,qe),l.unread>0?(t(),o("span",{key:0,class:V(["dot",{plus:l.unread>9}])},h(l.unread),3)):S("",!0)]),s("div",je,[s("div",ze,h(l.displayName),1),s("div",Pe,h(l.last_chat_message),1),s("div",Ue,"来自："+h(l.come_from.app_name),1)])],10,Ae))),128)),f.value?(t(),o("div",Je,[M(b,{size:"small"}),x[0]||(x[0]=s("span",{class:"loading-text"},"加载中...",-1))])):S("",!0),w.value?(t(),o("div",Fe,"没有更多了")):S("",!0)]))],512)}}},Ve=j(Ee,[["__scopeId","data-v-4087dd63"]]),We={__name:"chat-message-scroll",props:{topTriggerDistance:{type:Number,default:10},bottomTriggerDistance:{type:Number,default:40},isLoading:{type:Boolean,default:!1},scrollTop:{type:Number,default:0}},emits:["scroll-top","scroll-bottom","scroll"],setup(c,{expose:d,emit:e}){const n=c,i=e,u=$(null),m=$({scrollTop:0,scrollHeight:0,clientHeight:0,scrollDirection:"down",scrollStartDiff:n.topTriggerDistance,scrollEndDiff:n.bottomTriggerDistance}),L=$(null),g=v=>{const{scrollTop:k}=v,x=m.value.scrollTop-k;m.value.scrollDirection=x>0?"up":"down",Object.assign(m.value,{scrollTop:k,scrollHeight:v.scrollHeight,clientHeight:v.clientHeight})},a=()=>{const{scrollTop:v,scrollHeight:k,clientHeight:x,scrollStartDiff:b,scrollEndDiff:l,scrollDirection:B}=m.value;i("scroll",{...m.value}),n.isLoading||(Math.abs(v)<=b&&B==="up"&&i("scroll-top",{...m.value}),Math.abs(k-v-x)<=l&&B==="down"&&i("scroll-bottom",{...m.value}))},f=v=>{g(v.target),L.value&&(clearTimeout(L.value),L.value=null),L.value=setTimeout(()=>{a()},100)};function w(){u.value&&(u.value.scrollTop=0)}function I(){u.value&&(u.value.scrollTop=u.value.scrollHeight)}function y(){return u.value&&Object.assign(m.value,{scrollTop:u.value.scrollTop,scrollHeight:u.value.scrollHeight,clientHeight:u.value.clientHeight}),JSON.parse(JSON.stringify(m.value))}return se(()=>n.scrollTop,v=>{u.value&&(u.value.scrollTop=v)}),d({scrollToTop:w,scrollToBottom:I,getState:y}),(v,k)=>(t(),o("div",{class:"chat-message-scroll",ref_key:"scrollContainer",ref:u,onScroll:f},[te(v.$slots,"default",{},void 0,!0)],544))}},Ye=j(We,[["__scopeId","data-v-23d37ca8"]]),Ge={class:"chat-message-warpper"},Qe={class:"chat-message-content"},Xe={key:0,class:"is-loaded"},Ke={class:"avatar"},Ze=["src","alt"],et={class:"message-content"},tt={class:"message-info"},st={class:"nickname"},ot={class:"time"},it={key:0,class:"reply-list"},at={key:0,class:"reply-item reply-text"},nt=["innerHTML"],lt={key:1,class:"reply-item reply-image"},ct={class:"message-content"},rt=["src"],dt={key:2,class:"reply-item reply-url"},_t={class:"url-row"},ut=["href"],ht={key:3,class:"reply-item reply-card"},pt={class:"card-row"},vt=["src"],mt={class:"card-title-box"},ft={class:"card-title"},gt={key:4,class:"reply-item reply-imageText"},yt=["href"],kt=["src"],bt={class:"imageText-text"},Lt={class:"imageText-title"},Tt={class:"imageText-desc"},St={key:5,class:"reply-item reply-smartMenu"},wt={class:"smart-menu-box"},xt={key:0,class:"card-title"},Ct={class:"card-text"},$t={key:0,class:"line-text"},Rt={key:1,class:"empty-line"},Mt=["innerHTML"],It={key:3,href:"javascript:;",class:"link"},Nt={key:0},Bt={key:1,class:"message-bubble"},Dt={key:0,class:"text-content"},Ot={key:1},At={key:1,class:"image-content"},Ht=["src"],qt={key:2,class:"image-content"},jt=["src"],zt={key:3,class:"menu-content"},Pt={class:"menus-label"},Ut={key:0,class:"menu-items"},Jt=["onClick"],Ft={key:4,class:"answer-reference-box"},Et=["onClick"],Vt={__name:"chat-message",emits:["openLibrary"],setup(c,{expose:d,emit:e}){const n=e,i=$(null),u=Y(),{getChatMessage:m}=u,{messageList:L,messageListScrollTop:g,messageListLoading:a,chatMessageLoadCompleted:f,activeChat:w}=W(u),I=()=>{};function y(T,p,R){let H=K(T);p.robot_key=w.value.robot_key,p.robot_id=w.value.robot_id,H.forEach(r=>{r.message_id=R.id,r.openid=R.openid,r.robot_key=w.value.robot_key,r.robot_id=w.value.robot_id}),n("openLibrary",H,K(p))}function v(T){const p=[];return(Array.isArray(T)?T:[]).forEach(R=>{const H=String((R==null?void 0:R.menu_type)||""),r=String((R==null?void 0:R.content)||"");if(H==="0")if(r==="")p.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(r)){const G=/href\s*=\s*['"]\s*#\s*['"]/i.test(r)?r.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):r.replace(/href=/ig,'target="_blank" href=');p.push({kind:"html",html:G})}else p.push({kind:"text",text:r});else H==="1"&&p.push({kind:"keyword",text:r,serial_no:(R==null?void 0:R.serial_no)||""})}),p.slice(0,20)}const k=T=>{const{scrollTop:p}=T;g.value=p},x=async()=>{if(f.value)return;let T=i.value.getState();await m(),F(()=>{let p=i.value.getState();p.scrollDirection=="up"&&(g.value=p.scrollHeight-T.scrollHeight)})},b=async()=>{},l=()=>{i.value.scrollToBottom()},B=()=>{i.value.scrollToTop()};function A(T){try{return T?Array.isArray(T)?T:typeof T=="string"?JSON.parse(T||"[]"):[]:[]}catch{return[]}}return d({scrollToTop:B,scrollToBottom:l}),(T,p)=>{const R=X,H=ae("viewer");return t(),o("div",Ge,[M(Ye,{ref_key:"scrollViewRef",ref:i,scrollTop:C(g),"onUpdate:scrollTop":p[0]||(p[0]=r=>le(g)?g.value=r:null),"is-loading":C(a),onScroll:k,onScrollTop:x,onScrollBottom:b},{default:q(()=>[s("div",Qe,[C(f)?(t(),o("div",Xe,"没用更多聊天记录了")):S("",!0),(t(!0),o(N,null,D(C(L),(r,G)=>(t(),o("div",{key:G,class:V(["message-item",r.is_customer==0?"right":""])},[s("div",Ke,[s("img",{src:r.avatar,alt:r.displayName},null,8,Ze)]),s("div",et,[s("div",tt,[s("span",st,h(r.displayName),1),p[1]||(p[1]=s("i",{class:"gap"},null,-1)),s("span",ot,h(r.dispayTime),1)]),A(r.reply_content_list).length?(t(),o("div",it,[(t(!0),o(N,null,D(A(r.reply_content_list),(_,P)=>{var E;return t(),o(N,{key:P},[(_.reply_type||_.type)==="text"?(t(),o("div",at,[s("div",{class:"message-content",innerHTML:_.description},null,8,nt)])):(_.reply_type||_.type)==="image"?(t(),o("div",lt,[s("div",ct,[ne(s("img",{class:"msg-img",src:_.pic||_.thumb_url},null,8,rt),[[H]])])])):(_.reply_type||_.type)==="url"?(t(),o("div",dt,[s("div",_t,[s("a",{class:"url-link",href:_.url,target:"_blank"},h(_.url),9,ut)])])):(_.reply_type||_.type)==="card"?(t(),o("div",ht,[s("div",pt,[_.thumb_url?(t(),o("img",{key:0,src:_.thumb_url,class:"card-thumb"},null,8,vt)):S("",!0),s("div",mt,[M(R,{class:"think-icon",name:"applet"}),s("span",ft,h(_.title),1)])])])):(_.reply_type||_.type)==="imageText"?(t(),o("div",gt,[s("a",{class:"imageText-row",href:_.url,target:"_blank"},[_.thumb_url?(t(),o("img",{key:0,src:_.thumb_url,class:"imageText-thumb"},null,8,kt)):S("",!0),s("div",bt,[s("div",Lt,h(_.title),1),s("div",Tt,h(_.description),1)])],8,yt)])):(_.reply_type||_.type)==="smartMenu"?(t(),o("div",St,[s("div",wt,[_.smart_menu&&_.smart_menu.menu_description?(t(),o("div",xt,h(_.smart_menu.menu_description),1)):S("",!0),s("div",Ct,[(t(!0),o(N,null,D(v(((E=_.smart_menu)==null?void 0:E.menu_content)||[]),(O,de)=>(t(),o("div",{key:de,class:"reply-line"},[O.kind==="text"?(t(),o("span",$t,h(O.text),1)):O.kind==="newline"?(t(),o("div",Rt)):O.kind==="html"?(t(),o("span",{key:2,innerHTML:O.html},null,8,Mt)):O.kind==="keyword"?(t(),o("a",It,[O.serial_no?(t(),o("div",Nt,h(O.serial_no),1)):S("",!0),J(" "+h(O.text),1)])):S("",!0)]))),128))])])])):S("",!0)],64)}),128))])):S("",!0),r.msg_type==1&&r.content==""?S("",!0):(t(),o("div",Bt,[r.msg_type==1?(t(),o("div",Dt,[r.is_customer==0?(t(),z(Ce,{key:0,content:r.content},null,8,["content"])):(t(),o("div",Ot,h(r.content),1))])):r.received_message_type=="image"&&r.media_id_to_oss_url?(t(),o("div",At,[s("img",{src:r.media_id_to_oss_url,alt:"image"},null,8,Ht)])):r.msg_type==3?(t(),o("div",qt,[s("img",{src:r.content,alt:"image"},null,8,jt)])):r.msg_type==2?(t(),o("div",zt,[s("div",Pt,h(r.menu_json.content),1),r.menu_json.question&&r.menu_json.question.length>0?(t(),o("div",Ut,[(t(!0),o(N,null,D(r.menu_json.question,(_,P)=>(t(),o("div",{key:P,class:"menu-item",onClick:E=>I(_)},h(_),9,Jt))),128))])):S("",!0)])):S("",!0),r.quote_file&&r.quote_file.length?(t(),o("div",Ft,[p[2]||(p[2]=s("div",{class:"answer-reference-label"},"回答参考",-1)),s("div",null,[(t(!0),o(N,null,D(r.quote_file,(_,P)=>(t(),o("div",{class:"list-item",key:P},[M(R,{name:"attachment"}),s("span",{onClick:E=>y(r.quote_file,_,r)},h(_.file_name),9,Et)]))),128))])])):S("",!0)]))])],2))),128))])]),_:1},8,["scrollTop","is-loading"])])}}},Wt=j(Vt,[["__scopeId","data-v-30e28281"]]),Yt={class:"library-info-content"},Gt={class:"file-list"},Qt=["onClick"],Xt={class:"document-items"},Kt={class:"document-item-header"},Zt={class:"left-box"},es={class:"document-title"},ts={key:0,class:"document-title"},ss={class:"document-size"},os={class:"document-item-body"},is={class:"document-similarity"},as={key:0,class:"document-content"},ns={key:1,class:"document-content"},ls={class:"document-content"},cs={class:"fragment-img"},rs=["src"],ds={__name:"library-info-alert",setup(c,{expose:d}){const e=he(),n=$(!1),i=$([]),u=$(null),m=()=>{i.value=[],u.value=null},L=(y,v)=>{m(),i.value=y,u.value=v.id,n.value=!0,f(v)},g=y=>{y.id!=u.value&&(u.value=y.id,f(y))},a=$([]),f=y=>{$e({message_id:y.message_id,file_id:y.id,robot_key:y.robot_key,openid:y.openid}).then(v=>{a.value=v.data||[]})},w=()=>{e.push("/library/preview?id="+u.value)},I=()=>{n.value=!1};return d({open:L}),(y,v)=>{const k=X,x=Te,b=ae("viewer");return t(),z(x,{class:"library-info-alert",open:n.value,"onUpdate:open":v[0]||(v[0]=l=>n.value=l),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:q(()=>[s("span",{class:"close-btn",onClick:I},[M(C(Le))])]),default:q(()=>[s("div",Yt,[s("div",Gt,[(t(!0),o(N,null,D(i.value,l=>(t(),o("div",{class:V(["file-item",{active:u.value==l.id}]),key:l.id,onClick:B=>g(l)},h(l.file_name),11,Qt))),128))]),s("div",Xt,[(t(!0),o(N,null,D(a.value,l=>(t(),o("div",{class:"document-item",key:l.id},[s("div",Kt,[s("div",Zt,[s("span",es,"id："+h(l.id),1),l.title?(t(),o("span",ts,h(l.title),1)):S("",!0),s("span",ss," 共"+h(l.word_total)+"个字符 ",1)]),s("div",{class:"right-box"},[s("a",{onClick:w},"查看源文档>")])]),s("div",os,[s("div",is,[v[1]||(v[1]=J(" 相似度： ")),M(k,{name:"similarity",style:{"font-size":"16px"}}),J(h(l.similarity),1)]),l.question?(t(),o("div",as,"Q："+h(l.question),1)):S("",!0),l.answer?(t(),o("div",ns,"A："+h(l.answer),1)):S("",!0),s("div",ls,h(l.content),1),ne((t(),o("div",cs,[(t(!0),o(N,null,D(l.images,(B,A)=>(t(),o("img",{key:A,src:B,alt:""},null,8,rs))),128))])),[[b]])])]))),128))])])]),_:1},8,["open"])}}},_s=j(ds,[["__scopeId","data-v-1eece137"]]),us={key:0,class:"chat-box-warpper"},hs={class:"chat-box-header"},ps={class:"nickname"},vs={class:"chat-source"},ms={class:"chat-box-content"},fs={key:1},gs={__name:"chat-box",setup(c,{expose:d}){const e=Y(),{activeChat:n}=W(e),i=$(null),u=()=>{i.value.scrollToBottom()},m=()=>{i.value.scrollToTop()},L=$(null),g=(a,f)=>{L.value.open(a,f)};return d({scrollToTop:m,scrollToBottom:u}),(a,f)=>(t(),o(N,null,[C(n)?(t(),o("div",us,[s("div",hs,[s("div",ps,h(C(n).name||C(n).nickname),1),s("div",vs," 来自："+h(C(n).come_from.robot_name)+" - "+h(C(n).come_from.app_name),1)]),s("div",ms,[M(Wt,{ref_key:"chatMessageRef",ref:i,onOpenLibrary:g},null,512)])])):(t(),o("div",fs)),M(_s,{ref_key:"libraryInfoAlertRef",ref:L},null,512)],64))}},ys=j(gs,[["__scopeId","data-v-d67bf9eb"]]),ks={class:"chat-monitor-page"},bs={class:"page-left"},Ls={class:"app-list-box"},Ts={class:"search-box"},Ss={class:"chat-list-wrapper"},ws={class:"page-body"},xs={__name:"index",setup(c){const d=ce(),e=Y(),{init:n,changeRobot:i,switchChat:u,closeIM:m}=e,{robotList:L,selectedRobotId:g,activeChat:a}=W(e),f=$(null),w=$(null),I=$(""),y=()=>{const b={keyword:I.value,page:1};i(b)},v=async b=>{var l;await u(b),(l=w.value)==null||l.scrollToBottom()},k=()=>{F(()=>{var b;(b=w.value)==null||b.scrollToBottom()})},x=()=>{const b={keyword:I.value,page:1};f.value&&f.value.getData(b)};return oe(async()=>{await n(),F(()=>{var b;(b=w.value)==null||b.scrollToBottom()}),d.on("onAddMessage",k)}),ie(()=>{d.off("onAddMessage",k),m()}),(b,l)=>{const B=Se,A=we,T=xe;return t(),o("div",ks,[s("div",bs,[s("div",Ls,[M(A,{value:C(g),"onUpdate:value":l[0]||(l[0]=p=>le(g)?g.value=p:null),style:{width:"100%"},onChange:y},{default:q(()=>[M(B,{value:""},{default:q(()=>l[2]||(l[2]=[J("全部应用")])),_:1,__:[2]}),(t(!0),o(N,null,D(C(L),p=>(t(),z(B,{value:p.id,key:p.id},{default:q(()=>[s("span",null,h(p.robot_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),s("div",Ts,[M(T,{value:I.value,"onUpdate:value":l[1]||(l[1]=p=>I.value=p),placeholder:"搜索客户昵称或openld，按enter搜索","enter-button":"",style:{width:"100%"},onSearch:x,allowClear:"",onPressEnter:x},null,8,["value"])]),s("div",Ss,[M(Ve,{ref_key:"chatListRef",ref:f,onSwitchChat:v},null,512)])]),s("div",ws,[C(a)?(t(),z(ys,{key:0,ref_key:"chatBoxRef",ref:w},null,512)):(t(),z(re,{key:1,style:{background:"#F2F4F7"},size:"250"},{default:q(()=>l[3]||(l[3]=[s("div",null,[s("p",null,"请在左侧列表先选择会话"),s("p",null,"通过本功能，可以实时查看机器人接待中的会话消息，监控机器人回复效果")],-1)])),_:1,__:[3]}))])])}}},js=j(xs,[["__scopeId","data-v-0d77ff6e"]]);export{js as default};
