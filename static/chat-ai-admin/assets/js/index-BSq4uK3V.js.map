{"version":3,"file":"index-BSq4uK3V.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/database/role-permission/index.vue"],"sourcesContent":["<template>\r\n  <cu-scroll>\r\n    <div class=\"content-box\">\r\n      <div class=\"page-title\">权限管理</div>\r\n      <div class=\"add-btn-block\" v-if=\"currentPermission == 4\">\r\n        <a-button type=\"primary\" @click=\"openAddModal\" :icon=\"h(PlusOutlined)\">添加协助者</a-button>\r\n      </div>\r\n      <div class=\"list-content\">\r\n        <a-table :columns=\"columns\" :data-source=\"tableData\" :pagination=\"false\">\r\n          <!-- @change=\"onTableChange\" -->\r\n\r\n          <template #bodyCell=\"{ column, record }\">\r\n            <template v-if=\"column.key === 'name'\">\r\n              <div class=\"user-block\">\r\n                <a-avatar shape=\"square\" :src=\"record.avatar\" :size=\"40\">\r\n                  <template #icon><UserOutlined v-if=\"!record.avatar\" /></template>\r\n                </a-avatar>\r\n                <div class=\"name-box\">\r\n                  <div class=\"name\">{{ record.user_name }}</div>\r\n                  <div class=\"remark-text\">{{ record.name }}</div>\r\n                </div>\r\n              </div>\r\n            </template>\r\n\r\n            <template v-if=\"column.key === 'operate_rights'\">\r\n              <div class=\"hover-btn-box\" v-if=\"currentPermission == 2 || record.user_name == user_name\">\r\n                <span v-if=\"record.operate_rights == 4\">管理</span>\r\n                <span v-if=\"record.operate_rights == 2\">编辑</span>\r\n                <span v-if=\"record.operate_rights == 1\">查看</span>\r\n              </div>\r\n              <template v-else-if=\"record.role_type == 1 || record.is_creator == 1\">\r\n                <div class=\"hover-btn-box\">管理</div>\r\n              </template>\r\n              <a-popover\r\n                v-else\r\n                placement=\"bottomRight\"\r\n                :title=\"null\"\r\n                :overlayInnerStyle=\"{ padding: '2px' }\"\r\n              >\r\n                <template #content>\r\n                  <div class=\"role-menu-box\">\r\n                    <div class=\"role-menu\" @click=\"handleChangeStatus(record, 4)\">\r\n                      <div class=\"menu-header\">\r\n                        <UserOutlined />\r\n                        <span class=\"title\">管理</span>\r\n                      </div>\r\n                      <div class=\"desc\">可编辑，可删除，可查看</div>\r\n                      <div class=\"check-box\" v-if=\"record.operate_rights == 4\">\r\n                        <CheckOutlined />\r\n                      </div>\r\n                    </div>\r\n                    <div class=\"role-menu\" @click=\"handleChangeStatus(record, 2)\">\r\n                      <div class=\"menu-header\">\r\n                        <EditOutlined />\r\n                        <span class=\"title\">编辑</span>\r\n                      </div>\r\n                      <div class=\"desc\">可编辑，可查看</div>\r\n                      <div class=\"check-box\" v-if=\"record.operate_rights == 2\">\r\n                        <CheckOutlined />\r\n                      </div>\r\n                    </div>\r\n                    <div class=\"role-menu\" @click=\"handleChangeStatus(record, 1)\">\r\n                      <div class=\"menu-header\">\r\n                        <EyeOutlined />\r\n                        <span class=\"title\">查看</span>\r\n                      </div>\r\n                      <div class=\"desc\">仅查看</div>\r\n                      <div class=\"check-box\" v-if=\"record.operate_rights == 1\">\r\n                        <CheckOutlined />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </template>\r\n                <div class=\"hover-btn-box\">\r\n                  <span v-if=\"record.operate_rights == 4\">管理</span>\r\n                  <span v-if=\"record.operate_rights == 2\">编辑</span>\r\n                  <span v-if=\"record.operate_rights == 1\">查看</span>\r\n                  <DownOutlined />\r\n                </div>\r\n              </a-popover>\r\n            </template>\r\n            <template v-if=\"column.key === 'action'\">\r\n              <template v-if=\"currentPermission == 4 && record.user_name != user_name\">\r\n                <a @click=\"handleDel(record)\" v-if=\"record.role_type != 1 && record.is_creator != 1\"\r\n                  >移除</a\r\n                >\r\n              </template>\r\n            </template>\r\n          </template>\r\n        </a-table>\r\n      </div>\r\n    </div>\r\n    <AddCollaborator @ok=\"getData\" ref=\"addCollaboratorRef\" />\r\n  </cu-scroll>\r\n</template>\r\n<script setup>\r\nimport { ref, reactive, h, createVNode, computed } from 'vue'\r\nimport {\r\n  PlusOutlined,\r\n  UserOutlined,\r\n  DownOutlined,\r\n  EditOutlined,\r\n  EyeOutlined,\r\n  CheckOutlined,\r\n  ExclamationCircleOutlined\r\n} from '@ant-design/icons-vue'\r\n\r\nimport {\r\n  savePermissionManage,\r\n  getPartnerManageList,\r\n  deletePermissionManage\r\n} from '@/api/department/index.js'\r\nimport { message, Modal } from 'ant-design-vue'\r\nimport AddCollaborator from '@/components/add-collaborator/add-collaborator.vue'\r\nimport { getDatabasePermission } from '@/utils/permission'\r\nimport { useUserStore } from '@/stores/modules/user'\r\nconst userStore = useUserStore()\r\n\r\nconst user_name = computed(() => {\r\n  return userStore.user_name\r\n})\r\n\r\nimport { useRoute } from 'vue-router'\r\nconst query = useRoute().query\r\nconst currentPermission = ref(getDatabasePermission(query.form_id))\r\n\r\nconst tableData = ref([])\r\nconst queryParams = reactive({\r\n  object_id: query.form_id,\r\n  object_type: 3\r\n})\r\n\r\n// \"operate_rights\": \"4\",  // 权限 4:可管理  2:可编辑 1:查看\r\nconst getData = () => {\r\n  getPartnerManageList({ ...queryParams }).then((res) => {\r\n    let list = res.data || []\r\n    tableData.value = list\r\n  })\r\n}\r\n\r\ngetData()\r\n\r\nconst addCollaboratorRef = ref(null)\r\n\r\nconst openAddModal = () => {\r\n  addCollaboratorRef.value.show(tableData.value, [\r\n    {\r\n      object_id: +query.form_id,\r\n      object_type: 3,\r\n      operate_rights: 4\r\n    }\r\n  ])\r\n}\r\n\r\nconst handleChangeStatus = (record, operate_rights) => {\r\n  let right_str = operate_rights == 4 ? '管理' : operate_rights == 2 ? '编辑' : '查看'\r\n  Modal.confirm({\r\n    title: '提示?',\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: '确认修改该协作者权限为' + '【' + right_str + '】',\r\n    okText: '确认',\r\n    cancelText: '取消',\r\n    onOk: () => {\r\n      let data = [\r\n        {\r\n          object_id: +record.object_id,\r\n          object_type: +record.object_type,\r\n          operate_rights: +operate_rights\r\n        }\r\n      ]\r\n      savePermissionManage({\r\n        identity_ids: record.identity_id,\r\n        identity_type: record.identity_type,\r\n        object_array: JSON.stringify(data)\r\n      }).then((res) => {\r\n        message.success('修改成功')\r\n        getData()\r\n      })\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst handleDel = (record) => {\r\n  Modal.confirm({\r\n    title: '提示?',\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: '确认删除该条数据',\r\n    okText: '确认',\r\n    okType: 'danger',\r\n    cancelText: '取消',\r\n    onOk: () => {\r\n      deletePermissionManage({\r\n        identity_id: record.identity_id,\r\n        identity_type: record.identity_type,\r\n        object_id: record.object_id,\r\n        object_type: record.object_type\r\n      }).then((res) => {\r\n        message.success('删除成功')\r\n        getData()\r\n      })\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst columns = ref([\r\n  {\r\n    title: '姓名',\r\n    dataIndex: 'name',\r\n    key: 'name'\r\n  },\r\n  {\r\n    title: '权限',\r\n    dataIndex: 'operate_rights',\r\n    key: 'operate_rights'\r\n  },\r\n  {\r\n    title: '操作',\r\n    dataIndex: 'action',\r\n    key: 'action',\r\n    width: 80\r\n  }\r\n])\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.content-box {\r\n  // padding: 24px;\r\n  padding-right: 24px;\r\n}\r\n.page-title {\r\n  display: flex;\r\n  align-items: center;\r\n  background-color: #fff;\r\n  color: #000000;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 600;\r\n  line-height: 24px;\r\n  justify-content: space-between;\r\n  padding-right: 24px;\r\n  padding-bottom: 16px;\r\n}\r\n.list-content {\r\n  margin-top: 16px;\r\n}\r\n\r\n.user-block {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  .name-box {\r\n    flex: 1;\r\n    color: #595959;\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n  }\r\n  .remark-text {\r\n    margin-top: 2px;\r\n    font-size: 12px;\r\n    color: #8c8c8c;\r\n    line-height: 20px;\r\n  }\r\n}\r\n\r\n.hover-btn-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n  width: fit-content;\r\n  height: 24px;\r\n  font-size: 14px;\r\n  padding: 0 8px;\r\n  border-radius: 6px;\r\n  color: #595959;\r\n  cursor: pointer;\r\n  transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r\n  &:hover {\r\n    background: #e4e6eb;\r\n  }\r\n}\r\n\r\n.role-menu-box {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 2px;\r\n  .role-menu {\r\n    padding: 5px 16px;\r\n    border-radius: 6px;\r\n    color: #262626;\r\n    cursor: pointer;\r\n    position: relative;\r\n    &.active {\r\n      color: #2475fc;\r\n    }\r\n    &:hover {\r\n      background: #f2f4f7;\r\n    }\r\n    .check-box {\r\n      position: absolute;\r\n      top: 16px;\r\n      right: 16px;\r\n      color: #2475fc;\r\n    }\r\n    .menu-header {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    .desc {\r\n      color: #8c8c8c;\r\n      margin-top: 4px;\r\n      line-height: 22px;\r\n      padding-left: 24px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["userStore","useUserStore","user_name","computed","query","useRoute","currentPermission","ref","getDatabasePermission","tableData","queryParams","reactive","getData","getPartnerManageList","res","list","addCollaboratorRef","openAddModal","handleChangeStatus","record","operate_rights","right_str","Modal","createVNode","ExclamationCircleOutlined","data","savePermissionManage","message","handleDel","deletePermissionManage","columns","_createBlock","_component_cu_scroll","_createElementVNode","_hoisted_1","_cache","_openBlock","_createElementBlock","_hoisted_2","_createVNode","_component_a_button","h","_unref","PlusOutlined","_hoisted_3","_component_a_table","_withCtx","column","_hoisted_4","_component_a_avatar","UserOutlined","_hoisted_5","_hoisted_6","_toDisplayString","_hoisted_7","_Fragment","_hoisted_8","_hoisted_12","_component_a_popover","_hoisted_13","$event","_hoisted_15","_hoisted_16","CheckOutlined","_hoisted_18","EditOutlined","_hoisted_19","_hoisted_21","EyeOutlined","_hoisted_22","_hoisted_23","DownOutlined","_hoisted_27","AddCollaborator"],"mappings":"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"}