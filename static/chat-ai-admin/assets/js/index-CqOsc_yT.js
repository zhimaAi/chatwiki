import{c as G,ah as pe,ag as me,r as z,E as we,a as y,b as _,p as r,y as s,v as l,u as o,t as u,_ as A,q as $,e as N,F as Y,l as J,z as Q,D as W}from"./vue-chunks-BdaA73Wf.js";import{k as Ke,u as Le,l as Pe,s as H,m as Ve,n as Me,o as Be,p as Oe,q as Ue}from"./index-C67uUbSa.js";import{u as ye,ar as ge,as as be,at as Ye}from"../../index-DSFcP5NQ.js";import{u as fe}from"./robot-CIzNpArp.js";import{_ as he}from"./emoji-mart-BBMRoEa3.js";import{H as ve,m as Se,a1 as $e,B as Re,u as Ce,a5 as Ne,ac as ue,q as xe,an as je,a9 as Fe,J as Ae,x as Ie,b as I,M as Z,$ as ze,Z as Te,G as Je}from"./ui-antd-Dl1wwwCD.js";import{d as Qe}from"./utils-CvB22N-W.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";import"./index-Cg7-0swo.js";const We={class:"user-model-page"},Ge={class:"switch-block"},He={class:"switch-title"},Ze={class:"switch-desc"},Xe={class:"search-block"},et={class:"left-block"},tt={class:"search-item"},ot={class:"search-item"},at={class:"right-block"},nt={class:"list-box"},st={key:0,class:"tags-wra flex"},lt={class:"popover-cont flex"},it={key:0,class:"more-tag"},_t={key:1,class:"tags-wra flex"},ct={class:"popover-cont flex"},rt={key:0,class:"more-tag"},dt={key:2,style:{color:"#595959"}},ut=["onClick"],pt=["onClick"],yt=["onClick"],ht={__name:"keywords-reply",setup(ke){const{t:e}=ye("views.robot.robot-config.auto-reply.keywords-reply"),x=fe(),P=G(()=>x.keywordReplySwitchStatus==="1"),g=G(()=>x.keywordReplyAiReplyStatus==="1"),k=pe().query,R=me(),O=z([{title:e("col_rule_name"),dataIndex:"name",key:"name",width:120},{title:e("col_fuzzy_match"),dataIndex:"half_keyword",key:"half_keyword",width:220},{title:e("col_exact_match"),dataIndex:"full_keyword",key:"full_keyword",width:220},{title:e("col_reply_content"),dataIndex:"reply_content",key:"reply_content",width:120},{title:e("col_enabled_status"),dataIndex:"switch_status",key:"switch_status",width:120},{title:e("col_action"),dataIndex:"action",key:"action",width:120}]),v=we({page:1,size:10,total:0}),X=ge(),S=z([]),U=z(!1),E=z(""),q=z(""),T=()=>{q.value,E.value;const d={robot_id:k.id,keyword:q.value||"",reply_type:E.value||"",page:v.page,size:v.size};U.value=!0,Ke({...d}).then(c=>{const m=(c==null?void 0:c.data)||{list:[],total:0,page:v.page,size:v.size};S.value=(m.list||[]).map(p=>({...p,full_keyword:Array.isArray(p.full_keyword)?p.full_keyword:[],half_keyword:Array.isArray(p.half_keyword)?p.half_keyword:[],reply_content:Array.isArray(p.reply_content)?p.reply_content:[],switch_status:String(p.switch_status??"0")})),v.total=+m.total||0}).finally(()=>{U.value=!1})};T();const D=d=>{v.page=d.current,v.size=d.pageSize,T()},j=()=>{v.page=1,T()},ee=d=>{E.value=d,j()},te=()=>{R.push({path:"/robot/ability/auto-reply/add-rule",query:{id:k.id,robot_key:k.robot_key}})},oe=d=>{R.push({path:"/robot/ability/auto-reply/add-rule",query:{id:k.id,robot_key:k.robot_key,rule_id:d.id}})},F=d=>{R.push({path:"/robot/ability/auto-reply/add-rule",query:{id:k.id,robot_key:k.robot_key,copy_id:d.id}})},ae=d=>{const c=d?"1":"0";if(c==="0"){Z.confirm({title:e("title_tip"),content:e("msg_close_warning"),onOk:()=>{H({robot_id:k.id,ability_type:"robot_auto_reply",switch_status:c}).then(m=>{m&&m.res==0&&(x.setKeywordReplySwitchStatus(c),I.success(e("msg_operation_success")),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:k.id}})))})}});return}H({robot_id:k.id,ability_type:"robot_auto_reply",switch_status:c}).then(m=>{m&&m.res==0&&(x.setKeywordReplySwitchStatus(c),I.success(e("msg_operation_success")),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:k.id}})))})},ne=(d,c)=>{const m=c;Le({id:d.id,robot_id:k.id,switch_status:m}).then(p=>{p&&p.res==0&&(d.switch_status=m,I.success(e("msg_operation_success")))})},se=d=>{const c=d?"1":"0";Ve({robot_id:k.id,ability_type:"robot_auto_reply",ai_reply_status:c}).then(m=>{m&&m.res==0&&(x.setKeywordReplyAiReplyStatus(c),I.success(e("msg_operation_success")))})},le=d=>{Z.confirm({title:e("title_confirm_delete"),okText:e("btn_confirm"),onOk:()=>{Pe({id:d.id,robot_id:k.id}).then(c=>{c&&c.res==0&&(I.success(e("msg_delete_success")),T())})}})};function ie(d){return be()[d]||""}function _e(d){if(!Array.isArray(d))return"";const c=d.map(p=>ie(p==null?void 0:p.type)).filter(p=>!!p);return[...new Set(c)].join("/")}return(d,c)=>{const m=ve,p=Se,ce=Re,V=Ce,re=Ne,de=xe,M=je,t=Fe,a=Ae,i=Ie;return _(),y("div",We,[r("div",Ge,[r("span",He,l(o(e)("auto_reply")),1),s(m,{onChange:ae,checked:P.value,"checked-children":o(e)("switch_on"),"un-checked-children":o(e)("switch_off")},null,8,["checked","checked-children","un-checked-children"]),r("span",Ze,l(o(e)("auto_reply_desc")),1)]),s(p,{"show-icon":""},{message:u(()=>[r("p",null,l(o(e)("keyword_reply_tip")),1)]),_:1}),r("div",Xe,[r("div",et,[s(ce,{type:"primary",onClick:te},{icon:u(()=>[s(o($e))]),default:u(()=>[A(" "+l(o(e)("btn_add_rule")),1)]),_:1}),r("div",tt,[s(V,{modelValue:E.value,"onUpdate:modelValue":c[0]||(c[0]=n=>E.value=n),placeholder:o(e)("label_reply_type"),allowClear:"",options:o(X),style:{width:"240px"},onChange:ee},null,8,["modelValue","placeholder","options"])]),r("div",ot,[s(re,{value:q.value,"onUpdate:value":c[1]||(c[1]=n=>q.value=n),placeholder:o(e)("ph_search_keyword"),allowClear:"",style:{width:"240px"},onSearch:j},null,8,["value","placeholder"])])]),r("div",at,[r("span",null,l(o(e)("continue_reply")),1),s(de,null,{title:u(()=>[A(l(o(e)("continue_reply_tip")),1)]),default:u(()=>[s(o(ue)),c[2]||(c[2]=A("： ",-1))]),_:1}),s(m,{onChange:se,checked:g.value,"checked-children":o(e)("switch_on"),"un-checked-children":o(e)("switch_off")},null,8,["checked","checked-children","un-checked-children"])])]),r("div",nt,[s(i,{columns:O.value,"data-source":S.value,loading:U.value,pagination:{current:v.page,total:v.total,pageSize:v.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:D},{bodyCell:u(({column:n,record:h})=>[n.key==="half_keyword"?(_(),y("div",st,[(_(!0),y(Y,null,J(h.half_keyword,(w,b)=>Q((_(),y("div",{class:"tag",key:b},[s(M,null,{default:u(()=>[A(l(w),1)]),_:2},1024)])),[[W,b<3]])),128)),s(t,null,{content:u(()=>[r("div",lt,[(_(!0),y(Y,null,J(h.half_keyword,(w,b)=>Q((_(),y("div",{class:"tag",key:b},[s(M,null,{default:u(()=>[A(l(w),1)]),_:2},1024)])),[[W,b>=3]])),128))])]),default:u(()=>[h.half_keyword.length>3?(_(),y("div",it,"+"+l(h.half_keyword.length-3),1)):$("",!0)]),_:2},1024)])):$("",!0),n.key==="full_keyword"?(_(),y("div",_t,[(_(!0),y(Y,null,J(h.full_keyword,(w,b)=>Q((_(),y("div",{class:"tag",key:b},[s(M,null,{default:u(()=>[A(l(w),1)]),_:2},1024)])),[[W,b<3]])),128)),s(t,null,{content:u(()=>[r("div",ct,[(_(!0),y(Y,null,J(h.full_keyword,(w,b)=>Q((_(),y("div",{class:"tag",key:b},[s(M,null,{default:u(()=>[A(l(w),1)]),_:2},1024)])),[[W,b>=3]])),128))])]),default:u(()=>[h.full_keyword.length>3?(_(),y("div",rt,"+"+l(h.full_keyword.length-3),1)):$("",!0)]),_:2},1024)])):$("",!0),n.key==="reply_content"?(_(),y("span",dt,l(_e(h.reply_content)||"--"),1)):$("",!0),n.key==="switch_status"?(_(),N(m,{key:3,checked:h.switch_status,checkedValue:"1","un-checkedValue":"0","checked-children":o(e)("switch_on"),"un-checked-children":o(e)("switch_off"),onChange:w=>ne(h,w)},null,8,["checked","checked-children","un-checked-children","onChange"])):$("",!0),n.key==="action"?(_(),N(a,{key:4,gap:8},{default:u(()=>[r("a",{onClick:w=>oe(h)},l(o(e)("btn_edit")),9,ut),r("a",{onClick:w=>le(h)},l(o(e)("btn_delete")),9,pt),r("a",{onClick:w=>F(h)},l(o(e)("btn_copy")),9,yt)]),_:2},1024)):$("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},kt=he(ht,[["__scopeId","data-v-73f5c71b"]]),mt={class:"user-model-page"},wt={class:"switch-block"},gt={class:"switch-title"},bt={class:"switch-desc"},ft={class:"search-block"},vt={class:"left-block"},St={class:"search-item"},$t={class:"list-box"},Rt={key:0},Ct={key:1},xt={key:2},At={key:0,style:{color:"#595959"}},It={key:1,style:{color:"#595959"}},zt={key:3,style:{color:"#595959"}},Tt={key:4,style:{color:"#595959","white-space":"pre-wrap"}},Et=["onClick"],qt=["onClick"],Dt=["onClick"],Kt={__name:"received-reply",setup(ke){const{t:e}=ye("views.robot.robot-config.auto-reply.received-reply"),x=fe(),P=G(()=>x.keywordReplySwitchStatus==="1"),g=pe().query,k=me(),R=z(g.rule_type||"receive_reply_message_type"),O=[{title:e("col_message_type"),dataIndex:"message_type",key:"message_type",width:120},{title:e("col_reply_content"),dataIndex:"reply_content",key:"reply_content",width:120},{title:e("col_reply_method"),dataIndex:"reply_num",key:"reply_num",width:120},{title:e("col_create_time"),dataIndex:"create_time",key:"create_time",width:120},{title:e("col_enabled_status"),dataIndex:"switch_status",key:"switch_status",width:120},{title:e("col_action"),dataIndex:"action",key:"action",width:120}],v=[{title:e("col_duration"),dataIndex:"duration",key:"duration",width:220},{title:e("col_reply_content"),dataIndex:"reply_content",key:"reply_content",width:120},{title:e("col_reply_method"),dataIndex:"reply_num",key:"reply_num",width:120},{title:e("col_priority"),dataIndex:"priority_num",key:"priority_num",width:120},{title:e("col_create_time"),dataIndex:"create_time",key:"create_time",width:120},{title:e("col_enabled_status"),dataIndex:"switch_status",key:"switch_status",width:120},{title:e("col_action"),dataIndex:"action",key:"action",width:120}],X=G(()=>R.value==="receive_reply_duration"?v:O),S=we({page:1,size:10,total:0}),U=ge(),E=z([]),q=z(!1),T=z(""),D=()=>{const t={robot_id:g.id,rule_type:R.value,reply_type:T.value||"",page:S.page,size:S.size};q.value=!0,Me({...t}).then(a=>{const i=(a==null?void 0:a.data)||{list:[],total:0,page:S.page,size:S.size};E.value=(i.list||[]).map(n=>({...n,reply_content:Array.isArray(n.reply_content)?n.reply_content:[],switch_status:String(n.switch_status??"0"),duration_type:n.duration_type||"",start_duration:n.start_duration||"",end_duration:n.end_duration||"",priority_num:n.priority_num??"",message_type:String(n.message_type??""),specify_message_type:Array.isArray(n.specify_message_type)?n.specify_message_type:[]})),S.total=+i.total||0}).finally(()=>{q.value=!1})};D();const j=t=>{S.page=t.current,S.size=t.pageSize,D()},ee=()=>{S.page=1,D()},te=t=>{T.value=t,ee()},oe=()=>{S.page=1,D()};async function F(t){const a=Number(t.priority_num);if(!Number.isInteger(a)||a<0){I.error(e("msg_priority_invalid"));return}try{await Be({id:t.id,robot_id:g.id,priority_num:a}),I.success(e("msg_priority_updated")),D()}catch{}}const ae=()=>{k.push({path:"/robot/ability/auto-reply/add-reply",query:{id:g.id,robot_key:g.robot_key,rule_type:R.value}})},ne=t=>{k.push({path:"/robot/ability/auto-reply/add-reply",query:{id:g.id,robot_key:g.robot_key,rule_id:t.id}})},se=t=>{k.push({path:"/robot/ability/auto-reply/add-reply",query:{id:g.id,robot_key:g.robot_key,copy_id:t.id}})},le=t=>{const a=t?"1":"0";if(a==="0"){Z.confirm({title:e("title_tip"),content:e("msg_close_warning"),onOk:()=>{H({robot_id:g.id,ability_type:"robot_auto_reply",switch_status:a}).then(i=>{i&&i.res==0&&(x.setKeywordReplySwitchStatus(a),I.success(e("msg_operation_success")),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:g.id}})))})}});return}H({robot_id:g.id,ability_type:"robot_auto_reply",switch_status:a}).then(i=>{i&&i.res==0&&(x.setKeywordReplySwitchStatus(a),I.success(e("msg_operation_success")),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:g.id}})))})},ie=(t,a)=>{const i=a;Oe({id:t.id,robot_id:g.id,switch_status:i}).then(n=>{n&&n.res==0&&(t.switch_status=i,I.success(e("msg_operation_success")))})},_e=t=>{Z.confirm({title:e("title_confirm_delete"),okText:e("btn_confirm"),onOk:()=>{Ue({id:t.id,robot_id:g.id}).then(a=>{a&&a.res==0&&(I.success(e("msg_delete_success")),D())})}})};function d(t){return be()[t]||""}function c(t){if(!Array.isArray(t))return"";const a=t.map(n=>d(n==null?void 0:n.type)).filter(n=>!!n);return[...new Set(a)].join("/")}function m(t){const a={1:e("week_monday"),2:e("week_tuesday"),3:e("week_wednesday"),4:e("week_thursday"),5:e("week_friday"),6:e("week_saturday"),7:e("week_sunday")},i=String(t||"");return a[i]||i}function p(t){const a=String(t||"");return a?/^\d{4}-\d{2}-\d{2}/.test(a)?a.slice(0,10):a:""}function ce(t,a="YYYY-MM-DD"){return t?Qe(t*1e3).format(a):""}function V(t){const a=String(t||"");return a?/^\d{2}:\d{2}/.test(a)?a.slice(0,5):a:""}function re(t){const a=(t==null?void 0:t.duration_type)||"",i=(t==null?void 0:t.week_duration)||"",n=(t==null?void 0:t.start_duration)||"",h=(t==null?void 0:t.end_duration)||"";if(a==="week"){const w=Array.isArray(i)?i.map(K=>String(K)):i?[String(i)]:[],b=w.length?w.map(K=>m(K)).join("、"):"",B=`${V(n)} ${e("label_to")} ${V(h)}`;return b?`${e("label_every_week")}${b}：${B}`:`${e("label_every_week")}：${B}`}if(a==="day")return`${e("label_every_day")}：${p(n)} ${e("label_to")} ${p(h)}`;if(a==="time_range"){const w=(t==null?void 0:t.start_day)||"",b=(t==null?void 0:t.end_day)||"",B=`${p(w)} ${V(n)}`.trim(),K=`${p(b)} ${V(h)}`.trim();return`${e("label_custom_time")}：
${B} ${e("label_to")} ${K}`}return`${a||""}：${n||""} ${e("label_to")} ${h||""}`}function de(t){return Ye()[String(t)]||String(t)}function M(t){if(String((t==null?void 0:t.message_type)??"")==="0")return e("msg_all_messages");const i=Array.isArray(t==null?void 0:t.specify_message_type)?t.specify_message_type:[];return i.length?i.map(de).join("/"):"--"}return(t,a)=>{const i=ve,n=Se,h=ze,w=Te,b=Re,B=Ce,K=xe,Ee=Je,qe=Ae,De=Ie;return _(),y("div",mt,[r("div",wt,[r("span",gt,l(o(e)("auto_reply")),1),s(i,{onChange:le,checked:P.value,"checked-children":o(e)("switch_on"),"un-checked-children":o(e)("switch_off")},null,8,["checked","checked-children","un-checked-children"]),r("span",bt,l(o(e)("auto_reply_desc")),1)]),s(n,{"show-icon":""},{message:u(()=>[r("p",null,l(o(e)("received_reply_tip")),1),r("p",null,l(o(e)("received_reply_tip2")),1)]),_:1}),s(w,{activeKey:R.value,"onUpdate:activeKey":a[0]||(a[0]=f=>R.value=f),onChange:oe,style:{"margin-top":"8px"}},{default:u(()=>[s(h,{key:"receive_reply_message_type",tab:o(e)("tab_default_reply")},null,8,["tab"]),s(h,{key:"receive_reply_duration",tab:o(e)("tab_time_reply")},null,8,["tab"])]),_:1},8,["activeKey"]),r("div",ft,[r("div",vt,[s(b,{type:"primary",onClick:ae},{icon:u(()=>[s(o($e))]),default:u(()=>[A(" "+l(R.value==="receive_reply_message_type"?o(e)("btn_add_reply"):o(e)("btn_add_time_reply")),1)]),_:1}),r("div",St,[s(B,{modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=f=>T.value=f),placeholder:o(e)("label_reply_content"),allowClear:"",options:o(U),style:{width:"240px"},onChange:te},null,8,["modelValue","placeholder","options"])])])]),r("div",$t,[s(De,{columns:X.value,"data-source":E.value,loading:q.value,pagination:{current:S.page,total:S.total,pageSize:S.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:j},{headerCell:u(({column:f})=>[f.key==="priority_num"?(_(),y("span",Rt,[A(l(o(e)("col_priority"))+" ",1),s(K,{title:o(e)("col_priority_tip")},{default:u(()=>[s(o(ue))]),_:1},8,["title"])])):f.key==="switch_status"?(_(),y("span",Ct,[A(l(o(e)("col_enabled_status"))+" ",1),s(K,{title:R.value==="receive_reply_message_type"?o(e)("col_enabled_tip_default"):o(e)("col_enabled_tip_time")},{default:u(()=>[s(o(ue))]),_:1},8,["title"])])):(_(),y("span",xt,l(f.title),1))]),bodyCell:u(({column:f,record:C})=>[f.key==="message_type"?(_(),y("span",At,l(M(C)),1)):$("",!0),f.key==="reply_content"?(_(),y("span",It,l(c(C.reply_content)||"--"),1)):$("",!0),f.key==="reply_num"?(_(),y(Y,{key:2},[A(l(C.reply_num==0?o(e)("reply_all"):o(e)("reply_random")),1)],64)):$("",!0),f.key==="create_time"?(_(),y("span",zt,l(ce(C.create_time)||"--"),1)):$("",!0),f.key==="duration"?(_(),y("span",Tt,l(re(C)),1)):$("",!0),f.key==="priority_num"?(_(),N(Ee,{key:5,value:C.priority_num,"onUpdate:value":L=>C.priority_num=L,min:1,max:100,precision:0,style:{width:"96px"},onBlur:L=>F(C),onPressEnter:L=>F(C)},null,8,["value","onUpdate:value","onBlur","onPressEnter"])):$("",!0),f.key==="switch_status"?(_(),N(i,{key:6,checked:C.switch_status,checkedValue:"1","un-checkedValue":"0","checked-children":o(e)("switch_on"),"un-checked-children":o(e)("switch_off"),onChange:L=>ie(C,L)},null,8,["checked","checked-children","un-checked-children","onChange"])):$("",!0),f.key==="action"?(_(),N(qe,{key:7,gap:8},{default:u(()=>[r("a",{onClick:L=>ne(C)},l(o(e)("btn_edit")),9,Et),r("a",{onClick:L=>_e(C)},l(o(e)("btn_delete")),9,qt),r("a",{onClick:L=>se(C)},l(o(e)("btn_copy")),9,Dt)]),_:2},1024)):$("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Lt=he(Kt,[["__scopeId","data-v-a96e3a57"]]),Pt={class:"auto-reply-home"},Vt={__name:"index",setup(ke){const e=pe(),{t:x}=ye("views.robot.robot-config.auto-reply.index"),P=z(e.query.active_key||"keywords");return(g,k)=>{const R=ze,O=Te;return _(),y("div",Pt,[s(O,{activeKey:P.value,"onUpdate:activeKey":k[0]||(k[0]=v=>P.value=v)},{default:u(()=>[s(R,{key:"keywords",tab:o(x)("tab_keywords")},{default:u(()=>[s(kt)]),_:1},8,["tab"]),s(R,{key:"received",tab:o(x)("tab_received")},{default:u(()=>[s(Lt)]),_:1},8,["tab"])]),_:1},8,["activeKey"])])}}},Zt=he(Vt,[["__scopeId","data-v-5d24964a"]]);export{Zt as default};
//# sourceMappingURL=index-CqOsc_yT.js.map
