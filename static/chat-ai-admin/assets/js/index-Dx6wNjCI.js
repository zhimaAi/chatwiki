import{b as J,bG as E,ap as R,aV as U}from"../../index-BZRrEp3V.js";import{e as q,ab as G,f as r,r as z,o as A,Y as F,k as l,a5 as v,a2 as n,_ as u,a1 as w,ae as D,G as d,u as h,J as P}from"./vue-chunks-Ci-XTWEs.js";import{C as X}from"./config-page-menu-YLcmRqiC.js";import{C}from"./index-C70Vlv3T.js";import{F as j,e as Y,X as $,p as H,am as V,B as K,M as Q,a as W}from"./ui-antd-BWf8LxGy.js";import"./utils-ChQO-_r6.js";import"./index-UUVUVnDU.js";const Z={class:"ai-config-page"},ee={class:"page-container"},ae={class:"ai-config-form"},oe={__name:"index",setup(le){const M=E(),x=G(),S=q(()=>x.query.library_id),i=r(),m=r(!1);let _={};const a=z({library_name:"",library_intro:"",ai_summary:"",ai_summary_model:"",access_rights:"",model_config_id:"",use_model:"",use_model_icon:"",use_model_name:"",use_model_switch:"",statistics_set:"",summary_model_icon:"",summary_model_name:"",summary_model_config_id:""}),c=["azure","ollama","xinference","openaiAgent"],f=["azure"],p=r(""),y=r(""),N=e=>{a.use_model=c.includes(e.rawData.model_define)&&e.rawData.deployment_name?e.rawData.deployment_name:e.rawData.name,a.use_model_icon=e.icon,a.use_model_name=e.use_model_name,a.model_config_id=e.rawData.id,p.value=e.rawData.model_define},O=e=>{a.ai_summary_model=c.includes(e.rawData.model_define)&&e.rawData.deployment_name?e.rawData.deployment_name:e.rawData.name,a.summary_model_icon=e.icon,a.summary_model_name=e.summary_model_name,a.summary_model_config_id=e.rawData.id,y.value=e.rawData.model_define},B=async()=>{try{await i.value.validate(),_.use_model!=a.use_model?Q.confirm({title:"确定切换模型为"+a.use_model+"吗？",content:"切换模型后，文档会重新向量化，会消耗token",okText:"确定",cancelText:"取消",onOk(){g()}}):g()}catch(e){console.error("表单验证失败:",e)}},g=()=>{let e={...P(a)};f.indexOf(p.value)>-1&&(e.use_model="默认"),f.indexOf(y.value)>-1&&(e.ai_summary_model="默认"),m.value=!0,U(e).then(()=>{W.success("保存成功"),m.value=!1,_=JSON.parse(JSON.stringify(e)),M.getLibraryInfo()}).catch(()=>{m.value=!1})},L=()=>{R({id:S.value}).then(e=>{let o=e.data||{};o.use_model=o.use_model||void 0,o.ai_summary_model=o.ai_summary_model||void 0,_=JSON.parse(JSON.stringify(o)),Object.assign(a,o)})};return A(()=>{L()}),(e,o)=>{const k=H,b=$,t=Y,T=K,I=j;return u(),F("div",Z,[l(X),v("div",ee,[v("div",ae,[l(I,{ref_key:"formRef",ref:i,model:a,"label-col":{span:4},"wrapper-col":{span:8}},{default:n(()=>[l(t,null,{label:n(()=>[o[5]||(o[5]=d(" 嵌入  ")),l(k,null,{title:n(()=>o[4]||(o[4]=[d("开启嵌入功能后，才能在机器人中关联本知识库。")])),default:n(()=>[l(h(V))]),_:1})]),default:n(()=>[l(b,{checked:a.use_model_switch,"onUpdate:checked":o[0]||(o[0]=s=>a.use_model_switch=s),unCheckedValue:"0",checkedValue:"1"},null,8,["checked"])]),_:1}),a.use_model_switch==1?(u(),w(t,{key:0,label:"嵌入模型",name:"use_model",rules:[{required:!0,message:"请选择嵌入模型"}]},{default:n(()=>[l(C,{modelValue:a.use_model,"onUpdate:modelValue":o[1]||(o[1]=s=>a.use_model=s),placeholder:"请选择嵌入模型","label-key":"use_model_name","value-key":"value",modelType:"TEXT EMBEDDING","model-config-id":a.model_config_id,onChange:N},null,8,["modelValue","model-config-id"])]),_:1})):D("",!0),l(t,null,{label:n(()=>[o[7]||(o[7]=d(" AI智能总结  ")),l(k,null,{title:n(()=>o[6]||(o[6]=[d("开启后，搜索知识库时，由大模型自动总结文档，并给出总结后的结果")])),default:n(()=>[l(h(V))]),_:1})]),default:n(()=>[l(b,{checked:a.ai_summary,"onUpdate:checked":o[2]||(o[2]=s=>a.ai_summary=s),unCheckedValue:"0",checkedValue:"1"},null,8,["checked"])]),_:1}),a.ai_summary==1?(u(),w(t,{key:1,label:"总结模型",name:"ai_summary_model",rules:[{required:!0,message:"请选择总结模型"}]},{default:n(()=>[l(C,{modelValue:a.ai_summary_model,"onUpdate:modelValue":o[3]||(o[3]=s=>a.ai_summary_model=s),placeholder:"请选择总结模型","label-key":"summary_model_name","value-key":"value",modelType:"LLM","model-config-id":a.summary_model_config_id,onChange:O},null,8,["modelValue","model-config-id"])]),_:1})):D("",!0),l(t,{"wrapper-col":{offset:4,span:8}},{default:n(()=>[l(T,{type:"primary",loading:m.value,onClick:B},{default:n(()=>o[8]||(o[8]=[d("保存")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},8,["model"])])])])}}},ue=J(oe,[["__scopeId","data-v-ea4ce910"]]);export{ue as default};
