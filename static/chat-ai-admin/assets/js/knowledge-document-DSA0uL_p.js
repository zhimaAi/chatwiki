import{_ as Gl}from"./cu-scroll-D9utH_KS.js";import{_ as Me,az as Es,aA as Nl,aB as Wl,aC as Gs,aD as vt,aE as Ns,d as Qt,aF as Ws,al as Jt,aG as Al,aH as As,aI as Hs,aJ as Ps,aK as Bs,c as Xt,aL as Xe,aM as Ks,aN as Ys,a4 as Vs,aO as js,aP as Qs,ad as Dl,a as Js,ac as Ol,ab as Ml,aQ as Xs,av as Zs,aR as eo,aS as to,an as lo,aT as so,aU as oo,aV as no,aW as ao}from"../../index-CB2DywzJ.js";import{e as fe,r as de,q as Hl,ac as u,ad as n,k as l,ar as s,as as t,n as pt,ae as x,az as f,u as C,at as v,F as B,ax as he,G as y,B as ne,av as Zt,aw as gt,f as p,o as Vt,ah as Pl,ai as ve,af as io,J as jt,b as uo,y as ro,A as Rl}from"./vue-chunks-CGLjTDrY.js";import{E as _o,v as el,a9 as co,ae as It,bz as po,bA as fo,af as vo,bB as mo,G as Bl,b as H,M as ge,W as mt,o as Kl,T as tl,y as ht,z as kt,D as ll,av as yo,I as Ae,a6 as Je,a0 as ft,k as Yl,ar as Qe,h as Vl,i as jl,B as sl,am as Ql,bC as go,aT as ho,d as Se,F as yt,e as Ut,w as Jl,x as Xl,V as ko,aQ as Zl,aA as bo,bn as wo,bD as xo,n as Co,m as $o,Q as So,aO as Il,az as Ul,aB as Lo,a5 as qo,bu as Do,al as Oo,ai as Pt,aR as Ot,bE as Bt,bF as Mo,ab as Ro,ah as Io,$ as Uo}from"./ui-antd-BHaxN-GS.js";import{E as zo}from"./edit-subsection-DAORtKkq.js";import{M as es,R as To}from"./rename-modal-DBMH9fRA.js";import{U as ts}from"./upload-input-CIR73kDV.js";import{t as zl}from"./validate-8MtiUsxW.js";import{M as Tl}from"./model-select-h2ELC74y.js";import{O as Fo}from"./open-grapg-modal-CQIAWCLM.js";import{_ as Eo}from"./page-alert-DcOtfX2y.js";import{_ as Go}from"./default-cover-Bm8pZ2KF.js";import{d as No}from"./vuedraggable.umd-B2hsG2dX.js";const Wo={class:"subsection-box"},Ao=["onDblclick"],Ho={class:"list-item"},Po={class:"list-content"},Bo={class:"status-error"},Ko=["onClick","innerHTML"],Yo={class:"similar-question-list"},Vo={class:"list-item list-item-answer"},jo=["innerHTML"],Qo={class:"fragment-img"},Jo=["src"],Xo={class:"zm-line1"},Zo={class:"zm-line1"},en={class:"right-opration"},tn=["onClick"],ln=["onClick"],sn=["onClick"],on=["onClick"],nn={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(U,{expose:j,emit:le}){const Q=le,L=U,X=fe(()=>{var O,N;return((N=(O=L.paragraphLists)==null?void 0:O[0])==null?void 0:N.meta_list)||[]}),G=de({selectedRowKeys:[]}),$=O=>{G.selectedRowKeys=O},b=()=>{G.selectedRowKeys=[]},_=O=>{Q("openEditSubscription",O)},z=O=>{ge.confirm({title:"提示",icon:l(mt),content:"确认是否删除该问答?",onOk(){return new Promise((N,Y)=>{Nl({id:O}).then(ae=>{H.success("删除成功"),Q("handleDelParagraph",O),N()}).catch(()=>{N()})})},onCancel(){}})},F=(O,N)=>{Es({id:O.id,category_id:N}).then(Y=>{H.success("设置成功"),Q("getList")})},m=(O,N,Y)=>{let ae=Y.field,A=Y.order;A?A=A==="ascend"?"asc":"desc":ae="",Q("handleSort",{sort_field:ae,sort_type:A})};function R(O,N,Y={}){if(!N||!O)return O;const{highlightClass:ae="highlight",caseSensitive:A=!1,wholeWord:K=!1}=Y,D=A?"g":"gi";let r;return K?r=new RegExp(`\\b${h(N)}\\b`,D):r=new RegExp(h(N),D),O.replace(r,c=>`<span class="${ae}">${c}</span>`)}function h(O){return O.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return j({handleOpenEditModal:_,state:G,resetSelect:b}),(O,N)=>{const Y=el,ae=It,A=_o,K=Bl,D=Hl("viewer");return n(),u("div",Wo,[l(K,{"data-source":U.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:G.selectedRowKeys,onChange:$},pagination:!1,loading:L.isLoading,scroll:{x:1200},onChange:m},{default:s(()=>[l(A,{key:"id","data-index":"id",width:700},{title:s(()=>[y("问答（共"+v(L.total)+"个）",1)]),default:s(({record:r})=>[t("div",{class:"qa-list-box",onDblclick:c=>_(r)},[t("div",Ho,[N[0]||(N[0]=t("div",{class:"list-label"},"问题",-1)),t("div",Po,[r.status==2?(n(),x(Y,{key:0,placement:"top"},{title:s(()=>[t("span",null,v(r.errmsg),1)]),default:s(()=>[t("span",null,[t("span",Bo,[l(C(co))])])]),_:2},1024)):f("",!0),t("span",{onClick:c=>_(r),innerHTML:R(r.question,L.search),class:"question-text"},null,8,Ko),r.similar_questions&&r.similar_questions.length?(n(),x(ae,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[t("div",Yo,[(n(!0),u(B,null,he(r.similar_questions,(c,W)=>(n(),u("div",{class:"similar-question-list-item",key:W},v(c),1))),128))])]),title:s(()=>[t("span",null,"共 "+v(r.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[t("a",null,"（"+v(r.similar_questions.length)+"）",1)]),_:2},1024)):f("",!0)])]),t("div",Vo,[N[1]||(N[1]=t("div",{class:"list-label"},"答案",-1)),t("div",{class:"list-content",innerHTML:R(r.answer,L.search)},null,8,jo)]),pt((n(),u("div",Qo,[(n(!0),u(B,null,he(r.images,(c,W)=>(n(),u("img",{key:W,src:c,alt:""},null,8,Jo))),128))])),[[D]])],40,Ao)]),_:1}),l(A,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),l(A,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),l(A,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),(n(!0),u(B,null,he(X.value,r=>(n(),x(A,{key:`meta_${r.key}`,"data-index":`meta_${r.key}`,width:160},{title:s(()=>{var c;return[l(Y,{title:((c=r.name)==null?void 0:c.length)>8?r.name:""},{default:s(()=>[t("div",Xo,v(r.name),1)]),_:2},1032,["title"])]}),default:s(({record:c})=>{var W;return[l(Y,{title:((W=c[`meta_${r.key}`])==null?void 0:W.length)>8?c[`meta_${r.key}`]:""},{default:s(()=>[t("div",Zo,v(c[`meta_${r.key}`]),1)]),_:2},1032,["title"])]}),_:2},1032,["data-index"]))),128)),l(A,{title:"操作",key:"action","data-index":"action",width:120,fixed:"right"},{default:s(({record:r,index:c})=>[t("div",en,[r.category_id>0?(n(),u("div",{key:0,class:"hover-btn-box",onClick:W=>F(r,0)},[l(C(po),{style:{color:"#F59A23"}})],8,tn)):(n(),u("div",{key:1,class:"hover-btn-box",onClick:W=>F(r,4)},[l(C(fo))],8,ln)),t("div",{class:"hover-btn-box",onClick:ne(W=>_(r),["stop"])},[l(C(vo))],8,sn),t("div",{class:"hover-btn-box",onClick:ne(W=>z(r.id),["stop"])},[l(C(mo))],8,on)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},an=Me(nn,[["__scopeId","data-v-1c35157d"]]),un={class:"alert-box"},rn={class:"upload-file-box"},dn={key:0,class:"hight-set"},_n={key:0,class:"set-box"},cn={class:"form-item"},pn={class:"form-item-body"},fn={class:"form-item"},vn={class:"form-item-body"},mn={class:"form-item"},yn={class:"form-item-body"},gn={key:1,class:"set-box"},hn={class:"form-item"},kn={class:"form-item-body"},bn={class:"form-item"},wn={class:"form-item-body"},xn={class:"form-item"},Cn={class:"form-item-body"},$n={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(U,{expose:j,emit:le}){const Q=Wl(),{qa_index_type:L}=Q;Zt();const G=gt().query,$=p(!1),b=p(!1),_=p([]),z=le,F=p([]),m=U,R=fe(()=>m.library_id||G.id),h=de({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),O=p(!0),N=r=>{h.group_id=void 0,r>=0&&(h.group_id=r),$.value=!0},Y=()=>{let r=new FormData;_.value.forEach(c=>{r.append("library_files",c)}),Gs(r).then(c=>{let W=[];for(let J in c.data)W.push({lable:c.data[J],value:J});F.value=W})},ae=()=>{if(_.value.length==0){H.error("请选择文件");return}b.value=!0;let r=new FormData;r.append("library_id",R.value);let c=!1;if(_.value.forEach(W=>{(W.name.includes(".xlsx")||W.name.includes(".csv"))&&(c=!0),r.append("library_files",W)}),c){if(!h.question_column)return b.value=!1,H.error("请选择问题所在列");if(!h.answer_column)return b.value=!1,H.error("请选择答案所在列");r.append("question_column",h.question_column),r.append("answer_column",h.answer_column),h.similar_column&&r.append("similar_column",h.similar_column)}else r.append("question_lable",h.question_lable),r.append("answer_lable",h.answer_lable),r.append("similar_label",h.similar_label);r.append("group_id",h.group_id>=0?h.group_id:0),r.append("is_qa_doc",1),r.append("qa_index_type",L),vt(r).then(W=>{z("ok"),$.value=!1,_.value=[],b.value=!1}).catch(()=>{b.value=!1})},A=()=>{_.value=[]},K=p(1),D=r=>{h.question_column=void 0,h.answer_column=void 0,h.similar_column=void 0,h.question_lable="问题：",h.answer_lable="答案：",h.similar_label="相似问法：",_.value=r,r&&r.length>0&&(r[0].type.includes(".document")?K.value=2:(K.value=1,Y()))};return j({show:N}),(r,c)=>{const W=Kl,J=kt,P=ht,be=tl,T=Ae,xe=ge;return n(),u("div",null,[l(xe,{width:680,open:$.value,"onUpdate:open":c[9]||(c[9]=S=>$.value=S),"confirm-loading":b.value,maskClosable:!1,title:"上传文档",onOk:ae,onCancel:A},{default:s(()=>[t("div",un,[l(W,{"show-icon":""},{message:s(()=>[...c[10]||(c[10]=[t("div",null,[y(" 通过word或者Excel形式导入问答，建议您参考"),t("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),y("  "),t("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),y("创建导入文档 ")],-1),t("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),t("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])]),_:1})]),l(be,{align:"center",style:{margin:"16px 0"}},{default:s(()=>[c[11]||(c[11]=t("div",null,"所属分组：",-1)),l(P,{value:h.group_id,"onUpdate:value":c[0]||(c[0]=S=>h.group_id=S),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),u(B,null,he(m.groupLists.filter(S=>S.id>=0),S=>(n(),x(J,{value:S.id},{default:s(()=>[y(v(S.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),t("div",rn,[l(ts,{type:2,value:_.value,"onUpdate:value":c[1]||(c[1]=S=>_.value=S),onChange:D},null,8,["value"])]),_.value.length>0?(n(),u("div",dn,[t("a",{onClick:c[2]||(c[2]=S=>O.value=!O.value)},[c[12]||(c[12]=y("高级设置： ",-1)),O.value?(n(),x(C(yo),{key:1})):(n(),x(C(ll),{key:0}))]),O.value?(n(),u(B,{key:0},[K.value==1?(n(),u("div",_n,[t("div",cn,[c[13]||(c[13]=t("div",{class:"form-item-label required"},"问题所在列：",-1)),t("div",pn,[l(P,{value:h.question_column,"onUpdate:value":c[3]||(c[3]=S=>h.question_column=S),placeholder:"请选择列名",style:{width:"100%"}},{default:s(()=>[(n(!0),u(B,null,he(F.value,S=>(n(),x(J,{value:S.value,key:S.value},{default:s(()=>[y(v(S.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",fn,[c[14]||(c[14]=t("div",{class:"form-item-label"},"相似问法所在列：",-1)),t("div",vn,[l(P,{value:h.similar_column,"onUpdate:value":c[4]||(c[4]=S=>h.similar_column=S),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),u(B,null,he(F.value,S=>(n(),x(J,{value:S.value,key:S.value},{default:s(()=>[y(v(S.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",mn,[c[15]||(c[15]=t("div",{class:"form-item-label required"},"答案所在列：",-1)),t("div",yn,[l(P,{value:h.answer_column,"onUpdate:value":c[5]||(c[5]=S=>h.answer_column=S),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),u(B,null,he(F.value,S=>(n(),x(J,{value:S.value,key:S.value},{default:s(()=>[y(v(S.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):f("",!0),K.value==2?(n(),u("div",gn,[t("div",hn,[c[16]||(c[16]=t("div",{class:"form-item-label"},"问题开始标识符：",-1)),t("div",kn,[l(T,{placeholder:"请输入标识符",value:h.question_lable,"onUpdate:value":c[6]||(c[6]=S=>h.question_lable=S)},null,8,["value"])])]),t("div",bn,[c[17]||(c[17]=t("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),t("div",wn,[l(T,{placeholder:"请输入标识符",value:h.similar_label,"onUpdate:value":c[7]||(c[7]=S=>h.similar_label=S)},null,8,["value"])])]),t("div",xn,[c[18]||(c[18]=t("div",{class:"form-item-label"},"答案开始标识符：",-1)),t("div",Cn,[l(T,{placeholder:"请输入标识符",value:h.answer_lable,"onUpdate:value":c[8]||(c[8]=S=>h.answer_lable=S)},null,8,["value"])])])])):f("",!0)],64)):f("",!0)])):f("",!0)]),_:1},8,["open","confirm-loading"])])}}},ls=Me($n,[["__scopeId","data-v-d745cbba"]]),Sn={class:"form-item"},Ln={class:"form-content"},qn={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(U,{expose:j,emit:le}){const Q=gt().query,L=p(!1),X=le,G=p("新建分组"),$=U,b=de({group_name:"",id:"",library_id:Q.id}),_=F=>{b.group_name=F.group_name||"",b.id=F.id||"",G.value=F.id?"编辑分组":"新建分组",b.library_id=F.library_id,L.value=!0},z=()=>{if(!b.group_name)return H.error("请输入分组名称");Ns({...b,group_type:$.group_type}).then(F=>{H.success(`${G.value}成功`),L.value=!1,X("ok")})};return j({show:_}),(F,m)=>{const R=Ae,h=ge;return n(),u("div",null,[l(h,{open:L.value,"onUpdate:open":m[1]||(m[1]=O=>L.value=O),title:G.value,onOk:z},{default:s(()=>[t("div",Sn,[m[2]||(m[2]=t("div",{class:"form-label"},"分组名称：",-1)),t("div",Ln,[l(R,{maxLength:15,value:b.group_name,"onUpdate:value":m[0]||(m[0]=O=>b.group_name=O),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},ss=Me(qn,[["__scopeId","data-v-853bcd54"]]),Dn={class:"qa-list-wrapper"},On={class:"group-head-box"},Mn={class:"head-title"},Rn={class:"flex-between-box"},In={class:"search-box"},Un={class:"classify-box"},zn=["onClick"],Tn={class:"classify-title"},Fn={class:"right-content"},En={key:0,class:"btn-box"},Gn={class:"hover-btn-wrap"},Nn=["onClick"],Wn=["onClick"],An={class:"main-content-box"},Hn={class:"head-content"},Pn={class:"title"},Bn={class:"pover-group-content-box"},Kn={class:"group-head-box"},Yn={class:"head-title"},Vn={class:"flex-between-box"},jn={class:"search-box"},Qn={class:"classify-box classify-scroll-box"},Jn=["onClick"],Xn={class:"classify-title"},Zn={class:"right-content"},ea={key:0,class:"btn-box"},ta={class:"hover-btn-wrap"},la=["onClick"],sa=["onClick"],oa={class:"btn-right-box"},na={class:"des-content-block"},aa={key:0,class:"alert-icon-box"},ia={class:"content-block"},ua={class:"pagination-box"},Fl="qa_document_group_box_width",Mt=180,Kt=256,ra={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(U){const j=p(null),le=p(null),L=gt().query,X=p(""),G=p([]),$=p(-1),b=p([]),_=fe(()=>G.value.find(I=>I.id==$.value)||{}),z=fe(()=>G.value.filter(I=>I.group_name.includes(X.value))),F=U,m=fe(()=>F.library_id||L.id),R=p([]),h=p(localStorage.getItem("qa_document_group_hide_key")==1),O=p(0),N=p(0),Y={1:"本地文档",2:"在线文档",3:"自定义文档",4:"手工新增问答",5:"导入问答"},ae={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},A=p({is_qa_doc:"1",library_id:m.value}),K=p({page:1,size:100}),D=de({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:m.value,search:""}),r=I=>{D.sort_field=I.sort_field,D.sort_type=I.sort_type,c()},c=()=>{K.value.page=1,S()},W=(I,g)=>{K.value.page=I,K.value.size=g,S()},J=()=>{h.value=!h.value,localStorage.setItem("qa_document_group_hide_key",h.value?1:2)},P=()=>{Hs({id:m.value}).then(()=>{H.success("操作完成"),S()})},be=p(null),T=I=>{I.group_id||$.value>=0&&(I.group_id=$.value),be.value.showModal(JSON.parse(JSON.stringify(I)))},xe=p(!1),S=()=>{xe.value=!0,Ws({...K.value,...D,group_id:$.value}).then(I=>{xe.value=!1;let g=I.data,we=g.list||[];we.forEach(ce=>{ce.status_text=ae[ce.status],ce.similar_questions&&(ce.similar_questions=JSON.parse(ce.similar_questions)),Array.isArray(ce.meta_list)&&ce.meta_list.forEach(ue=>{ue.type==1&&ue.value>0&&(ue.value=Se(ue.value*1e3).format("YYYY-MM-DD HH:mm")),ue.key=="source"&&(ue.value=Y[ue.value]),ce[`meta_${ue.key}`]=ue.value})}),R.value=we,O.value=g.total,N.value=g.exception_total,j.value&&j.value.resetSelect()})};S();const Re=()=>{Jt({library_id:m.value}).then(I=>{let we=(I.data||[]).reduce((ce,ue)=>ce+ +ue.total,0);G.value=[{group_name:"全部分组",id:-1,total:we},...I.data]})};Re();const He=p(null),te=I=>{He.value.show({...I,library_id:m.value})},Le=()=>{Re(),S()},Ze=I=>{$.value=I.id,c()},Ce=I=>{ge.confirm({title:`确认删除分组${I.group_name}`,icon:l(mt),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){Al({id:I.id}).then(()=>{H.success("删除成功"),Re(),$.value==I.id&&($.value=-1,c())})}})},_e=p(null),zt=()=>{_e.value.show($.value)},Pe=p(!1),Ue=de({group_id:void 0,ids:""}),qe=()=>{if(j.value.state.selectedRowKeys.length==0)return H.error("请选择你要移动的问答");Ue.ids=j.value.state.selectedRowKeys.join(","),Ue.group_id=void 0,Pe.value=!0},se=()=>{if(j.value.state.selectedRowKeys.length==0)return H.error("请选择你要删除的问答");ge.confirm({title:"提示",icon:l(mt),content:"确认是否删除所选问答?",onOk(){Nl({id:j.value.state.selectedRowKeys.join(",")}).then(I=>{H.success("删除成功"),S()})},onCancel(){}})},Be=()=>{if(!Ue.group_id)return H.error("请选择分组");Bs({...Ue}).then(()=>{Pe.value=!1,H.success("移动成功"),Le()})},ze=p(Mt),et=p(!1);Vt(()=>{const I=parseInt(localStorage.getItem(Fl));I&&I>=Mt&&I<=Kt&&(ze.value=I)});let Ie=!1,tt=0,Ke=0;const lt=I=>{h.value||(Ie=!0,et.value=!0,tt=I.clientX,Ke=ze.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",st),document.addEventListener("mouseup",bt))},st=I=>{if(!Ie)return;let g=Ke+(I.clientX-tt);g=Math.max(Mt,Math.min(Kt,g)),ze.value=g},bt=()=>{Ie&&(Ie=!1,et.value=!1,localStorage.setItem(Fl,ze.value),document.body.style.cursor="",document.removeEventListener("mousemove",st),document.removeEventListener("mouseup",bt))},Ye=p(!1),Tt=()=>{let I="";j.value.state.selectedRowKeys.length>0&&(I=j.value.state.selectedRowKeys.join(",")),As({library_id:L.id,export_type:2,group_id:$.value,data_ids:I}).then(g=>{Ye.value=!0})},Ft=()=>{Ps.push({path:"/library/details/export-record",query:L})},ot=I=>{if(I==2){if(j.value.state.selectedRowKeys.length==0)return H.error("请选择你要修改的问答");b.value=j.value.state.selectedRowKeys}le.value.show(I==2)};return(I,g)=>{const we=Qt,ce=el,ue=Ae,De=jl,nt=Vl,at=Yl,wt=Gl,Oe=It,w=sl,Et=go,ke=kt,xt=ht,Ct=tl,Fe=ge,$t=ho;return n(),u(B,null,[t("div",Dn,[t("div",{class:ve(["group-content-box",[{collapsed:h.value},{"no-transition":et.value}]]),style:Pl(h.value?{}:{width:ze.value+"px",minWidth:Mt+"px",maxWidth:Kt+"px"})},[t("div",On,[t("div",Mn,[l(ce,{title:"收起问答分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:J},[l(we,{name:"put-away"})])]),_:1}),t("div",Rn,[g[18]||(g[18]=t("div",null,"问答分组",-1)),l(ce,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:g[0]||(g[0]=q=>te({}))},[l(C(Je))])]),_:1})])]),t("div",In,[l(ue,{value:X.value,"onUpdate:value":g[2]||(g[2]=q=>X.value=q),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[l(C(ft),{onClick:g[1]||(g[1]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),t("div",Un,[l(wt,{style:{"padding-right":"24px"}},{default:s(()=>[(n(!0),u(B,null,he(z.value,q=>(n(),u("div",{class:ve(["classify-item",{active:q.id==$.value}]),onClick:Ee=>Ze(q),key:q.id},[t("div",Tn,v(q.group_name),1),t("div",Fn,[t("div",{class:ve(["num",{"num-block":q.id<=0}])},v(q.total),3),q.id>0?(n(),u("div",En,[l(at,{placement:"bottomRight"},{overlay:s(()=>[l(nt,null,{default:s(()=>[l(De,null,{default:s(()=>[t("div",{onClick:ne(Ee=>te(q),["stop"])},"重命名",8,Nn)]),_:2},1024),l(De,null,{default:s(()=>[t("div",{onClick:ne(Ee=>Ce(q),["stop"])},"删 除",8,Wn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",Gn,[l(C(Qe))])]),_:2},1024)])):f("",!0)])],10,zn))),128))]),_:1})]),h.value?f("",!0):(n(),u("div",{key:0,class:"resize-bar",onMousedown:lt},null,32))],6),t("div",An,[l(wt,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[t("div",Hn,[t("div",Pn,[h.value?(n(),x(Oe,{key:0,title:null,placement:"bottom"},{content:s(()=>[t("div",Bn,[t("div",Kn,[t("div",Yn,[t("div",Vn,[g[19]||(g[19]=t("div",null,"问答分组",-1)),l(ce,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:g[3]||(g[3]=q=>te({}))},[l(C(Je))])]),_:1})])]),t("div",jn,[l(ue,{allowClear:"",value:X.value,"onUpdate:value":g[5]||(g[5]=q=>X.value=q),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[l(C(ft),{onClick:g[4]||(g[4]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),t("div",Qn,[(n(!0),u(B,null,he(z.value,q=>(n(),u("div",{class:ve(["classify-item",{active:q.id==$.value}]),onClick:Ee=>Ze(q),key:q.id},[t("div",Xn,v(q.group_name),1),t("div",Zn,[t("div",{class:ve(["num",{"num-block":q.id<=0}])},v(q.total),3),q.id>0?(n(),u("div",ea,[l(at,{placement:"bottomRight"},{overlay:s(()=>[l(nt,null,{default:s(()=>[l(De,null,{default:s(()=>[t("div",{onClick:ne(Ee=>te(q),["stop"])},"重命名",8,la)]),_:2},1024),l(De,null,{default:s(()=>[t("div",{onClick:ne(Ee=>Ce(q),["stop"])},"删 除",8,sa)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",ta,[l(C(Qe))])]),_:2},1024)])):f("",!0)])],10,Jn))),128))])])]),default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:J},[l(we,{name:"expand"})])]),_:1})):f("",!0),t("div",null,v(_.value.group_name),1),t("div",oa,[t("div",null,[l(ue,{onChange:c,value:D.search,"onUpdate:value":g[6]||(g[6]=q=>D.search=q),placeholder:"搜索问答"},{suffix:s(()=>[l(C(ft))]),_:1},8,["value"])]),l(w,{onClick:g[7]||(g[7]=q=>ot(1))},{default:s(()=>[g[20]||(g[20]=y("元数据 ",-1)),l(C(Ql))]),_:1}),l(at,null,{overlay:s(()=>[l(nt,null,{default:s(()=>[l(De,{key:"1"},{default:s(()=>[t("div",{onClick:se},"批量删除")]),_:1}),l(De,{key:"2"},{default:s(()=>[t("div",{onClick:qe},"批量移动")]),_:1}),l(De,{key:"2"},{default:s(()=>[t("div",{onClick:g[8]||(g[8]=q=>ot(2))},"修改元数据")]),_:1})]),_:1})]),default:s(()=>[l(w,null,{default:s(()=>[g[21]||(g[21]=y("批量操作 ",-1)),l(C(ll))]),_:1})]),_:1}),l(w,{onClick:g[9]||(g[9]=q=>zt())},{default:s(()=>[...g[22]||(g[22]=[y("导入",-1)])]),_:1}),l(w,{onClick:g[10]||(g[10]=q=>Tt())},{default:s(()=>[...g[23]||(g[23]=[y("导出",-1)])]),_:1}),l(w,{onClick:g[11]||(g[11]=q=>T({})),type:"primary",icon:l(C(Je))},{default:s(()=>[...g[24]||(g[24]=[y("问答",-1)])]),_:1},8,["icon"])])]),t("div",na,[N.value>0?(n(),u("div",aa,[l(we,{name:"alert-icon"}),t("div",null,v(N.value)+"个问答学习失败",1),t("a",{onClick:P},"重新学习")])):f("",!0)])]),t("div",ia,[l(an,{ref_key:"subsectionBoxRef",ref:j,total:O.value,isLoading:xe.value,paragraphLists:R.value,search:D.search,onOpenEditSubscription:T,onHandleDelParagraph:Le,onGetList:S,onHandleSort:r},null,8,["total","isLoading","paragraphLists","search"]),t("div",ua,[l(Et,{current:K.value.page,"onUpdate:current":g[12]||(g[12]=q=>K.value.page=q),"page-size":K.value.size,"onUpdate:pageSize":g[13]||(g[13]=q=>K.value.size=q),total:O.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:W},null,8,["current","page-size","total"])])])]),_:1})])]),l(zo,{detailsInfo:A.value,onHandleEdit:Le,ref_key:"editSubscriptionRef",ref:be},null,8,["detailsInfo"]),l(ss,{ref_key:"addGroupRef",ref:He,onOk:Le},null,512),l(ls,{groupLists:G.value,library_id:U.library_id,onOk:Le,ref_key:"qaUploadModalRef",ref:_e},null,8,["groupLists","library_id"]),l(Fe,{open:Pe.value,"onUpdate:open":g[15]||(g[15]=q=>Pe.value=q),title:"批量移动分组",onOk:Be},{default:s(()=>[l(Ct,{align:"center",style:{margin:"24px 0"}},{default:s(()=>[g[25]||(g[25]=t("div",null,"移动到分组：",-1)),l(xt,{value:Ue.group_id,"onUpdate:value":g[14]||(g[14]=q=>Ue.group_id=q),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),u(B,null,he(G.value.filter(q=>q.id>=0),q=>(n(),x(ke,{value:q.id},{default:s(()=>[y(v(q.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["open"]),l(Fe,{open:Ye.value,"onUpdate:open":g[17]||(g[17]=q=>Ye.value=q),title:null,footer:null,width:640},{default:s(()=>[l($t,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:s(()=>[l(w,{style:{"margin-right":"16px"},onClick:g[16]||(g[16]=q=>Ye.value=!1)},{default:s(()=>[...g[26]||(g[26]=[y("知道了",-1)])]),_:1}),l(w,{onClick:Ft,type:"primary"},{default:s(()=>[...g[27]||(g[27]=[y("去下载",-1)])]),_:1})]),_:1})]),_:1},8,["open"]),l(es,{ref_key:"metaRef",ref:le,"library-id":m.value,"qa-ids":b.value,onChange:Le},null,8,["library-id","qa-ids"])],64)}}},jr=Me(ra,[["__scopeId","data-v-d2c8ace0"]]),os="/assets/img/default-bg-Dmt81D3f.png",da={class:"form-box"},_a={class:"upload-document-type-box"},ca=["onClick"],pa={class:"right-block"},fa={class:"title-block"},va={class:"title-text"},ma={class:"desc"},ya={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(U,{expose:j,emit:le}){const Q=Zt(),L=gt(),X=yt.useForm,G=p(!1),$=p("添加自定义文档"),b=U,_=de({library_id:L.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),z=p([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),F=A=>{_.qa_index_type=A},m=de({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:R,validate:h,validateInfos:O}=X(_,m),N=()=>{G.value=!0,R(),_.file_name="",_.is_qa_doc=0,_.qa_index_type=1,_.library_id=b.libraryInfo.id||L.query.id,b.libraryInfo.type==2&&(_.is_qa_doc=1)},Y=p(!1),ae=()=>{h().then(()=>{let A={...jt(_),group_id:b.group_id};Y.value=!0,vt(A).then(K=>{H.success(`${$.value}成功`),G.value=!1,Q.push("/library/preview?id="+K.data.file_ids[0])}).finally(()=>{Y.value=!1})})};return j({add:N}),(A,K)=>{const D=Ae,r=Ut,c=Xl,W=Jl,J=Qt,P=yt,be=ge;return n(),u("div",null,[l(be,{open:G.value,"onUpdate:open":K[2]||(K[2]=T=>G.value=T),title:$.value,onOk:ae,width:"472px",confirmLoading:Y.value},{default:s(()=>[t("div",da,[l(P,{layout:"vertical"},{default:s(()=>[l(r,io({label:"文档名称"},C(O).file_name),{default:s(()=>[l(D,{type:"text",placeholder:"请输入文档名称",value:_.file_name,"onUpdate:value":K[0]||(K[0]=T=>_.file_name=T)},null,8,["value"])]),_:1},16),f("",!0),_.is_qa_doc==1?(n(),x(r,{key:1,label:"索引方式",required:""},{default:s(()=>[t("div",_a,[(n(!0),u(B,null,he(z.value,T=>(n(),u("div",{class:ve(["type-item",{active:_.qa_index_type==T.value}]),key:T.value,onClick:xe=>F(T.value)},[t("div",pa,[t("div",fa,[l(J,{name:_.qa_index_type==T.value?T.iconNameActive:T.iconName},null,8,["name"]),t("div",va,v(T.title),1)]),t("div",ma,v(T.desc),1)]),_.qa_index_type==T.value?(n(),x(J,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):f("",!0)],10,ca))),128))])]),_:1})):f("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},ga=Me(ya,[["__scopeId","data-v-a4f74280"]]),ha="/assets/img/guide-image-DSu20zRj.png",ka={class:"container"},ba={class:"guide-content"},wa={class:"content-box"},xa={__name:"guide-learning-tips",setup(U,{expose:j}){const le=Xt(),Q=p(!1),L=p(!1),X=p(""),G=()=>{setTimeout(()=>{Q.value=!0},500)},$=()=>{le.setGuideLearningTips(L.value),Q.value=!1},b=()=>{le.setGuideLearningTips(L.value),Q.value=!1};return j({show:G}),(_,z)=>{const F=ko,m=sl,R=ge;return n(),u("div",ka,[l(R,{open:Q.value,"onUpdate:open":z[1]||(z[1]=h=>Q.value=h),title:X.value,onOk:$,onCancel:b,width:"472px"},{footer:s(()=>[l(m,{type:"primary",onClick:$},{default:s(()=>[...z[5]||(z[5]=[y("我知道了",-1)])]),_:1})]),default:s(()=>[t("div",ba,[z[4]||(z[4]=t("img",{src:ha,alt:"操作引导",class:"guide-image"},null,-1)),t("div",wa,[z[3]||(z[3]=t("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),l(F,{checked:L.value,"onUpdate:checked":z[0]||(z[0]=h=>L.value=h)},{default:s(()=>[...z[2]||(z[2]=[t("div",{class:"content-check"},"不再显示此提示",-1)])]),_:1},8,["checked"])])])]),_:1},8,["open","title"])])}}},Ca=Me(xa,[["__scopeId","data-v-33a87814"]]),$a={__name:"edit-online-doc",emits:["ok"],setup(U,{expose:j,emit:le}){const Q=le,L=de({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),X=p(!1),G=p({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),$=p(!1),b=m=>{m=JSON.parse(JSON.stringify(m)),L.id=m.id||"",L.file_name=m.file_name||"",L.doc_auto_renew_frequency=+m.doc_auto_renew_frequency||1,m.doc_auto_renew_minute>0&&(L.doc_auto_renew_minute=Xe(m.doc_auto_renew_minute)),X.value=!!m.from_update_info,$.value=!0},_=p(!1),z=p(null),F=()=>{z.value.validate().then(()=>{_.value=!0,Ks({...L,doc_auto_renew_minute:L.doc_auto_renew_minute?Xe(L.doc_auto_renew_minute):0}).then(()=>{$.value=!1,_.value=!1,Q("ok")})}).catch(()=>{_.value=!1})};return j({show:b}),(m,R)=>{const h=Ae,O=Ut,N=kt,Y=ht,ae=Zl,A=yt,K=ge;return n(),u("div",null,[l(K,{open:$.value,"onUpdate:open":R[3]||(R[3]=D=>$.value=D),"confirm-loading":_.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:F},{default:s(()=>[l(A,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:z,model:L,rules:G.value},{default:s(()=>[l(O,{name:"file_name",label:"文件名称"},{default:s(()=>[l(h,{value:L.file_name,"onUpdate:value":R[0]||(R[0]=D=>L.file_name=D),placeholder:"请输入",disabled:X.value},null,8,["value","disabled"])]),_:1}),l(O,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:s(()=>[l(Y,{value:L.doc_auto_renew_frequency,"onUpdate:value":R[1]||(R[1]=D=>L.doc_auto_renew_frequency=D),style:{width:"100%"}},{default:s(()=>[l(N,{value:1},{default:s(()=>[...R[4]||(R[4]=[y("不自动更新",-1)])]),_:1}),l(N,{value:2},{default:s(()=>[...R[5]||(R[5]=[y("每天",-1)])]),_:1}),l(N,{value:3},{default:s(()=>[...R[6]||(R[6]=[y("每3天",-1)])]),_:1}),l(N,{value:4},{default:s(()=>[...R[7]||(R[7]=[y("每7天",-1)])]),_:1}),l(N,{value:5},{default:s(()=>[...R[8]||(R[8]=[y("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),L.doc_auto_renew_frequency>1?(n(),x(O,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[l(ae,{valueFormat:"HH:mm",value:L.doc_auto_renew_minute,"onUpdate:value":R[2]||(R[2]=D=>L.doc_auto_renew_minute=D),format:"HH:mm"},null,8,["value"])]),_:1})):f("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},ns="/assets/img/empty-document-3OyxWwx_.svg",Sa={key:0,class:"base-data-drawer"},La={class:"base-cover"},qa=["src"],Da={class:"base-title zm-line1"},Oa={class:"base-update"},Ma={key:0},Ra={key:1},Ia={key:2},Ua={key:3},za={key:4},Ta={key:5,class:"ml4"},Fa={class:"base-meta-grid"},Ea={class:"meta-item"},Ga={class:"value"},Na={class:"meta-item"},Wa={class:"value"},Aa={class:"meta-item"},Ha={class:"value"},Pa={class:"base-hits-grid"},Ba={class:"hits-item"},Ka={class:"value"},Ya={class:"hits-item"},Va={class:"value"},ja={class:"hits-item"},Qa={class:"value"},Ja={__name:"base-data-drawer",props:{open:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["close","editOnline"],setup(U,{emit:j}){const le=j,Q=U;function L(){le("close")}const X=b=>{const _=Number((b==null?void 0:b.status)??-1);return[0,1,5,6,10].includes(_)?"loading":[3,7,8,9].includes(_)?"error":"success"},G=b=>{if(!b)return"";const _=X(b),z=b.thumb_path||b.cover_url||b.cover||b.article_cover_url||"";return z||(_==="loading"?Go:_==="error"?ns:"")},$=fe(()=>G(Q.record));return(b,_)=>{const z=bo;return n(),x(z,{open:U.open,placement:"right",width:400,title:"基础数据",onClose:L},{default:s(()=>[U.record?(n(),u("div",Sa,[t("div",La,[$.value?(n(),u("img",{key:0,src:$.value,alt:""},null,8,qa)):f("",!0)]),t("div",Da,v(U.record.file_name),1),t("div",Oa,[t("span",null,"更新于 "+v(U.record.update_time),1),_[1]||(_[1]=t("span",{class:"sep"},"|",-1)),t("span",null,[U.record.doc_auto_renew_frequency==1?(n(),u("span",Ma,"不自动更新")):f("",!0),U.record.doc_auto_renew_frequency==2?(n(),u("span",Ra,"每天")):f("",!0),U.record.doc_auto_renew_frequency==3?(n(),u("span",Ia,"每3天")):f("",!0),U.record.doc_auto_renew_frequency==4?(n(),u("span",Ua,"每7天")):f("",!0),U.record.doc_auto_renew_frequency==5?(n(),u("span",za,"每30天")):f("",!0),U.record.doc_auto_renew_frequency>1&&U.record.doc_auto_renew_minute>0?(n(),u("span",Ta,v(C(Xe)(U.record.doc_auto_renew_minute)),1)):f("",!0),t("a",{class:"ml12 btn-hover-block",onClick:_[0]||(_[0]=F=>le("editOnline",U.record))},"修改")])]),t("div",Fa,[t("div",Ea,[t("div",Ga,v(U.record.file_ext||"--"),1),_[2]||(_[2]=t("div",{class:"label"},"文件格式",-1))]),_[5]||(_[5]=t("div",{class:"line-vertical"},null,-1)),t("div",Na,[t("div",Wa,v(U.record.file_size_str||"--"),1),_[3]||(_[3]=t("div",{class:"label"},"文档大小",-1))]),_[6]||(_[6]=t("div",{class:"line-vertical"},null,-1)),t("div",Aa,[t("div",Ha,v(U.record.paragraph_count??"-"),1),_[4]||(_[4]=t("div",{class:"label"},"文档分段",-1))])]),t("div",Pa,[t("div",Ba,[t("div",Ka,v(U.record.total_hits??0),1),_[7]||(_[7]=t("div",{class:"label"},"合计触发",-1))]),_[10]||(_[10]=t("div",{class:"line-vertical"},null,-1)),t("div",Ya,[t("div",Va,v(U.record.today_hits??0),1),_[8]||(_[8]=t("div",{class:"label"},"今日触发",-1))]),_[11]||(_[11]=t("div",{class:"line-vertical"},null,-1)),t("div",ja,[t("div",Qa,v(U.record.yesterday_hits??0),1),_[9]||(_[9]=t("div",{class:"label"},"昨日触发",-1))])])])):f("",!0)]),_:1},8,["open"])}}},Xa=Me(Ja,[["__scopeId","data-v-b6f975c8"]]),Za={class:"form-item"},ei={class:"form-content"},ti={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(U,{expose:j,emit:le}){const Q=p(!1),L=le,X=p("修改分组"),G=U,$=de({group_id:"",file_id:""}),b=p([]),_=m=>{$.group_id=m.group_id||"0",$.file_id=m.id||"",F(),Q.value=!0},z=()=>{if(!$.group_id)return H.error("请选择分组");Ys({...$,library_id:G.libraryId,sense:G.sense}).then(m=>{H.success(`${X.value}成功`),Q.value=!1,L("ok")})},F=()=>{Jt({library_id:G.libraryId,group_type:1}).then(m=>{b.value=m.data||[]})};return j({show:_}),(m,R)=>{const h=kt,O=ht,N=ge;return n(),u("div",null,[l(N,{open:Q.value,"onUpdate:open":R[1]||(R[1]=Y=>Q.value=Y),title:X.value,onOk:z},{default:s(()=>[t("div",Za,[R[2]||(R[2]=t("div",{class:"form-label"},"分组名称：",-1)),t("div",ei,[l(O,{value:$.group_id,"onUpdate:value":R[0]||(R[0]=Y=>$.group_id=Y),style:{width:"100%"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),u(B,null,he(b.value,Y=>(n(),x(h,{value:Y.id},{default:s(()=>[y(v(Y.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},li=Me(ti,[["__scopeId","data-v-40485b34"]]),si="/assets/img/feishu-redirct-example-qgH_904t.png",oi={key:0,class:"file-list"},ni={__name:"add-feishu-document",props:{libraryId:{type:[Number,String],default:""}},emits:["ok"],setup(U,{expose:j,emit:le}){const Q=le,L=U,X=Xt(),G=`${window.location.origin}/manage/feishuUserAuthLogin/callback`,$=p(null),b={feishu_app_id:"",feishu_app_secret:"",user_access_token:"",file_type:1,feishu_document_id_list:[]},_=p(!1),z=p(!1),F=p(1),m=de({feishu_document_id_list:[]}),R=de({feishu_app_id:{message:"请输入飞书 AppId",required:!0},feishu_app_secret:{message:"请输入飞书 AppSecret",required:!0}}),h=p([]);function O(D=null){Object.assign(m,JSON.parse(JSON.stringify(b))),D?(Object.assign(m,D),N(),F.value=2):F.value=1,_.value=!0}function N(){const{feishu_app_id:D,feishu_app_secret:r,user_access_token:c}=m;js({feishu_app_id:D,feishu_app_secret:r,user_access_token:c}).then(W=>{h.value=Y((W==null?void 0:W.data)||[])})}function Y(D=[]){return D.map(r=>{if(Array.isArray(r.children)){r.checkable=!1;const c=Y(r.children);return{...r,children:c}}return r.checkable=!0,r}).filter(r=>{var c;return!!(r.type==="docx"||r.type==="folder"&&((c=r.children)!=null&&c.length))})}function ae(D=[]){const r=[];function c(W){for(const J of W)J.type==="docx"&&J.token&&r.push(J.token),Array.isArray(J.children)&&c(J.children)}return c(D),r}const A=D=>{Vs(D),H.success("复制成功")};function K(){$.value.validate().then(()=>{if(F.value==1){H.loading("正在进行验证...");let D="";const r={feishu_app_id:m.feishu_app_id,feishu_app_secret:m.feishu_app_secret},c={...r,id:L.libraryId};let W={...r,token:X.getToken??"",feishu_frontend_auth_redirect_url:Qs(`${D}/#/library/details/knowledge-document?${Dl(c)}`)};window.location.href=`${D}/manage/feishuUserAuthLogin/redirect?${Dl(W)}`}else{if(m.file_type==2){if(!m.feishu_document_id_list.length)return H.error("请选择同步文件")}else if(m.feishu_document_id_list=ae(h.value),!m.feishu_document_id_list.length)return H.error("暂无可同步文件");let D={library_id:L.libraryId,doc_type:6,...m,doc_auto_renew_minute:Xe(m.doc_auto_renew_minute),feishu_document_id_list:m.feishu_document_id_list.toString()};delete D.file_type,delete D.user_access_token,z.value=!0,vt(D).then(r=>{Q("ok"),H.success("添加完成"),_.value=!1}).finally(()=>{z.value=!1})}})}return j({show:O}),(D,r)=>{const c=wo,W=It,J=Kl,P=Ae,be=Ut,T=yt,xe=Xl,S=Jl,Re=xo,He=ge;return n(),x(He,{open:_.value,"onUpdate:open":r[5]||(r[5]=te=>_.value=te),"confirm-loading":z.value,maskClosable:!1,title:F.value==1?"导入飞书知识库":"请选择需要同步的文件",width:"646px",onOk:K},{default:s(()=>[F.value==1?(n(),u(B,{key:0},[l(J,{class:"zm-alert-info","show-icon":"",type:"info"},{message:s(()=>[r[7]||(r[7]=y(" 请先在",-1)),r[8]||(r[8]=t("a",{href:"https://open.feishu.cn/document/server-docs/api-call-guide/terminology",target:"_blank"},"飞书开发者后台",-1)),r[9]||(r[9]=y("创建自建应用获取App ID 和 App Secret，并将需要同步的 ",-1)),r[10]||(r[10]=t("a",{href:"https://open.feishu.cn/document/server-docs/docs/wiki-v2/wiki-qa#b5da330b",target:"_blank"},"知识库授权给对应应用",-1)),r[11]||(r[11]=y("； ",-1)),l(W,null,{title:s(()=>[l(c,{width:"600px",src:C(si)},null,8,["src"])]),default:s(()=>[r[6]||(r[6]=y(" 在飞书应用中填写重定向URL：",-1)),t("a",{onClick:r[0]||(r[0]=te=>A(G)),title:"点击复制"},v(G))]),_:1}),r[12]||(r[12]=y(" 。完成后，系统将自动同步知识库目录下.docx格式的云文档 ",-1))]),_:1}),l(T,{class:"mt16",layout:"vertical",ref_key:"formRef",ref:$,model:m,rules:R},{default:s(()=>[l(be,{name:"feishu_app_id",label:"AppId"},{default:s(()=>[l(P,{value:m.feishu_app_id,"onUpdate:value":r[1]||(r[1]=te=>m.feishu_app_id=te),valueModifiers:{trim:!0},placeholder:"请输入飞书 AppId"},null,8,["value"])]),_:1}),l(be,{name:"feishu_app_secret",label:"AppSecret"},{default:s(()=>[l(P,{value:m.feishu_app_secret,"onUpdate:value":r[2]||(r[2]=te=>m.feishu_app_secret=te),valueModifiers:{trim:!0},placeholder:"请输入飞书 AppSecret"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])],64)):(n(),x(T,{key:1,layout:"vertical",ref_key:"formRef",ref:$,model:m,rules:R},{default:s(()=>[l(be,{label:"文件范围"},{default:s(()=>[l(S,{value:m.file_type,"onUpdate:value":r[3]||(r[3]=te=>m.file_type=te)},{default:s(()=>[l(xe,{value:1},{default:s(()=>[...r[13]||(r[13]=[y("权限范围内所有文件",-1)])]),_:1}),l(xe,{value:2},{default:s(()=>[...r[14]||(r[14]=[y("部分文件",-1)])]),_:1})]),_:1},8,["value"]),m.file_type==2?(n(),u("div",oi,[l(Re,{checkedKeys:m.feishu_document_id_list,"onUpdate:checkedKeys":r[4]||(r[4]=te=>m.feishu_document_id_list=te),multiple:"",checkable:"","field-names":{key:"token"},"tree-data":h.value},{title:s(({name:te,type:Le})=>[Le==="docx"?(n(),u(B,{key:0},[y(v(te)+".docx",1)],64)):(n(),u(B,{key:1},[y(v(te),1)],64))]),_:1},8,["checkedKeys","tree-data"])])):f("",!0)]),_:1})]),_:1},8,["model","rules"]))]),_:1},8,["open","confirm-loading","title"])}}},ai=Me(ni,[["__scopeId","data-v-2705ffd4"]]),ii={class:"details-library-page"},ui={class:"group-head-box"},ri={class:"head-title"},di={class:"flex-between-box"},_i={class:"classify-box",style:{"margin-top":"16px"}},ci=["onClick"],pi={key:0,class:"drag-btn"},fi={key:1,style:{width:"20px"}},vi={class:"classify-title"},mi={class:"right-content"},yi={key:0,class:"btn-box"},gi={class:"hover-btn-wrap"},hi=["onClick"],ki=["onClick"],bi={class:"main-content-box"},wi={class:"group-header-title"},xi={class:"pover-group-content-box"},Ci={class:"group-head-box"},$i={class:"head-title"},Si={class:"flex-between-box"},Li={class:"search-box"},qi={class:"classify-box classify-scroll-box"},Di=["onClick"],Oi={class:"classify-title"},Mi={class:"right-content"},Ri={key:0,class:"btn-box"},Ii={class:"hover-btn-wrap"},Ui=["onClick"],zi=["onClick"],Ti={class:"title"},Fi={key:1,class:"title-text"},Ei={class:"list-tools"},Gi={class:"tools-items"},Ni={class:"tool-item"},Wi={class:"view-toggle"},Ai={key:0,class:"tool-item"},Hi={class:"sort-left"},Pi={class:"sort-text"},Bi={class:"right-box"},Ki={key:0,class:"status-box"},Yi={class:"status-item"},Vi={class:"status-content"},ji={key:0,class:"status-item"},Qi={class:"status-content content-tip"},Ji={key:1,class:"status-item"},Xi={class:"status-content content-tip"},Zi={key:1,class:"status-select-box"},eu={class:"tool-item"},tu={class:"tool-item"},lu={class:"dropdown-btn-menu"},su={key:0,class:"desc"},ou={key:1,class:"desc"},nu={class:"dropdown-btn-menu"},au={class:"dropdown-btn-menu"},iu={class:"dropdown-btn-menu"},uu={class:"dropdown-btn-menu"},ru={key:1,class:"folder-view"},du={key:0,class:"empty-folder"},_u={class:"empty-inner"},cu=["src"],pu={key:1,class:"folder-grid"},fu=["onClick"],vu=["src"],mu={key:1,class:"thumb-img",src:os},yu={key:2,class:"status-badge"},gu={key:3,class:"learn-percent"},hu={key:4,style:{"margin-left":"2px"}},ku={class:"folder-meta"},bu={key:0,class:"name zm-line1"},wu=["href"],xu={class:"name name-2line"},Cu={key:1,class:"name name-2line"},$u={class:"desc"},Su={class:"file-ext"},Lu={key:2,class:"list-content"},qu={class:"zm-line1"},Du={key:2,class:"title-box"},Ou={key:0,class:"doc-name-td"},Mu=["href"],Ru=["onClick"],Iu={key:0},Uu={key:1},zu=["onClick"],Tu={key:0},Fu={key:1},Eu={key:2,class:"url-remark"},Gu=["onClick"],Nu={key:0,class:"pdf-progress-box"},Wu={class:"progress-title"},Au={class:"status-box"},Hu=["onClick"],Pu={class:"progress-bar"},Bu={class:"num-box"},Ku={key:0,class:"status-tag running"},Yu={key:2,class:"status-tag running"},Vu={key:3,class:"status-tag complete"},ju={class:"status-tag status-error"},Qu=["onClick"],Ju={class:"status-tag status-error"},Xu={key:6,class:"status-tag"},Zu={key:7,class:"status-tag"},er={key:8,class:"status-tag running"},tr={class:"status-tag error"},lr={key:10,class:"status-tag cancel"},sr={key:11,class:"status-tag subning"},or={class:"status-tag"},nr=["onClick"],ar={key:1,class:"status-tag running"},ir={key:2,class:"status-tag complete"},ur={class:"status-tag error"},rr=["onClick"],dr={class:"zm-line1 reason-text"},_r={key:4,class:"status-tag running"},cr={class:"status-tag warning"},pr={class:"reason-text"},fr=["onClick"],vr={key:4},mr={key:5,class:"text-block"},yr={class:"time-content-box"},gr={class:"update-tooltip"},hr={class:"update-tooltip-title"},kr={class:"update-tooltip-value"},br={class:"update-icon-box"},wr={class:"update-tooltip-time"},xr={class:"update-tooltip-value"},Cr={class:"update-trigger-text"},$r=["onClick"],Sr=["onClick"],Lr={class:"zm-line1"},qr={class:"upload-file-box"},Dr={class:"select-card-box"},Or=["onClick"],Mr={class:"card-title"},Rr={key:0,class:"card-switch-box"},Ir={class:"card-desc"},Ur={key:0,class:"card-switch"},El="qa_document_group_box_width",Rt=180,Yt=256,zr={__name:"knowledge-document",props:{type:{type:[Number,String],default:()=>2},library_id:{type:[Number,String],default:()=>""}},setup(U){const{setStorage:j}=lo("localStorage"),le=Wl(),{changeGraphSwitch:Q}=le,L=Js(),X=fe(()=>{var o;return((o=L.companyInfo)==null?void 0:o.neo4j_status)=="true"}),G=fe(()=>{var o;return((o=L.companyInfo)==null?void 0:o.ali_ocr_switch)=="1"}),$=U,b=fe(()=>$.library_id||K.id),_=p(localStorage.getItem("document_group_hide_key")==1),z=p(""),F=p([]),m=p(-1),R=fe(()=>F.value.find(o=>o.id==m.value)||{}),h=fe(()=>F.value.filter(o=>o.group_name.includes(z.value))),O=Xt(),N={1:"本地文档",2:"在线文档",3:"自定义文档",4:"手工新增问答",5:"导入问答"},Y=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],ae=gt(),A=Zt(),K=ae.query,D=p(!1),r=p(null),c=p(null),W=p(null),J=p(!1),P=p({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0}),be=de({selectedRowKeys:[]}),T=de({use_model:"",model_config_id:""}),xe=(o,e)=>{let i=e.modelName,k=e.modelId;Ce.value.length>0?ge.confirm({title:`确定切换模型为${i}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){T.use_model=i,T.model_config_id=k,S()},onCancel(){}}):(T.use_model=i,T.model_config_id=k,S())},S=(o=!0,e=null)=>{ao({...jt(P.value),use_model:T.use_model,model_config_id:T.model_config_id}).then(()=>{P.value.use_model=T.use_model,P.value.model_config_id=T.model_config_id,typeof e=="function"&&e(),o&&H.success("保存成功")})},Re=p([]),He=o=>{Re.value=o},te=p([]),Le=o=>{te.value=o,Ze()},Ze=()=>{if(!P.value.id){setTimeout(()=>{Ze()},100);return}if(te.value.length>0&&!P.value.use_model){let o=null,e=null;for(let i of te.value)if(i.model_define==="chatwiki"){o=i;for(let k of o.children)if(k.name==="text-embedding-v2"){e=k;break}break}o||(o=te.value[0],e=o.children[0]),o&&(T.use_model=e.name,T.model_config_id=e.model_config_id,S(!1))}},Ce=p([]),_e=p("list"),zt=p(null);function Pe(){_e.value="folder",localStorage.setItem(Fe(),"folder"),m.value=-1,We.value=!1,w.page=1,w.size=50,w.file_name=void 0,w.status="",w.sort_field="",w.sort_type="",se.order_field="",se.order_type="DESC",be.selectedRowKeys=[],qe.value=!1,_.value||St(),$e()}function Ue(){_e.value="list",localStorage.setItem(Fe(),"list"),w.size=10,m.value=-1,w.page=1,w.file_name=void 0,w.status="",w.sort_field="",w.sort_type="",se.order_field="",se.order_type="DESC",be.selectedRowKeys=[],qe.value=!1,_.value&&St(),$e()}const qe=p(!1),se=de({order_field:"",order_type:"DESC"});function Be(o){o==="default"?(se.order_field="",se.order_type="DESC",w.sort_field="",w.sort_type=""):(se.order_field=o,se.order_type="DESC",w.sort_field=o,w.sort_type="DESC"),w.page=1,qe.value=!1,pe(),Ne()}function ze(){se.order_field&&(se.order_type=se.order_type==="DESC"?"ASC":"DESC",w.sort_type=se.order_type,w.page=1,pe())}function et(){qe.value=!qe.value}function Ie(o){const e=Number((o==null?void 0:o.status)??-1);return[0,1,5,6,10].includes(e)?"loading":[4].includes(e)?"wait":[3,7,8,9].includes(e)?"error":"success"}const tt=p(0);let Ke=null;const lt={};function st(o){try{const e=tt.value,i=Number((o==null?void 0:o.ocr_pdf_index)??0),k=Number((o==null?void 0:o.ocr_pdf_total)??0);if(k>0&&i>=0)return Math.max(0,Math.min(100,parseInt(i/k*100)));const E=String((o==null?void 0:o.id)||"0");lt[E]||(lt[E]=Date.now());const M=(Date.now()-lt[E])/1e3,V=20+Number(E)%6*5,me=Math.floor(10+M*V);return Math.max(10,Math.min(95,me))}catch{}return null}const bt=fe(()=>{const o=F.value||[],e=Ce.value||[],i=$.type==3?"official_article_update_time":"update_time",k=E=>{if(!E.length)return null;const M=E.filter(V=>!!V[i]).sort((V,me)=>String(V[i]).localeCompare(String(me[i])));return M.length?M[M.length-1]:E[E.length-1]};return o.map(E=>{const M=E.id===-1?e:e.filter(me=>Number(me.group_id||0)===Number(E.id)),V=k(M);return{id:E.id,group_name:E.group_name,total:E.total,last_update:V&&V[i]||"",last_update_ts:V&&V[i]?Se(V[i]).valueOf():0,cover_status:V?Ie(V):"success",cover_src:V?we(V):""}})}),Ye=fe(()=>{const o=[...bt.value],{order_field:e,order_type:i}=se;return(e==="update_time"||e==="library_num")&&o.sort((k,E)=>{let M=0,V=0;return e==="update_time"?(M=k.last_update_ts||0,V=E.last_update_ts||0):e==="library_num"&&(M=Number(k.total||0),V=Number(E.total||0)),i==="ASC"?M-V:V-M}),o}),Tt=fe(()=>{const o=Ce.value||[],e=$.type==3?"official_article_update_time":"update_time";return o.map(i=>{const k=i[e]?Se(i[e]).valueOf():0;return{__type:"file",id:i.id,title:i.file_name||i.doc_url||"",update_ts:k,cover_src:we(i)||"",cover_status:Ie(i),status_label:ce(i),origin:i}})}),Ft=fe(()=>{const o=Ce.value||[],e=$.type==3?"official_article_update_time":"update_time";return o.filter(i=>Number(i.group_id||0)<=0).map(i=>{const k=i[e]?Se(i[e]).valueOf():0;return{__type:"file",id:i.id,title:i.file_name||i.doc_url||"",update_ts:k,cover_src:we(i)||"",cover_status:Ie(i),status_label:ce(i),origin:i}})}),ot=fe(()=>We.value?Tt.value:[...Ye.value.map(o=>({__type:"group",...o})),...Ft.value]);function I(o){o.__type==="group"?(We.value=!0,Nt({id:o.id,group_name:o.group_name,total:o.total})):Ge(o.origin)}function g(o){if(!o)return"--";const e=Se(o),i=Se();return e.isSame(i,"day")?e.format("HH:mm:ss"):i.diff(e,"year")>=1?e.format("YYYY/MM/DD"):e.format("MM/DD")}function we(o){const e=Ie(o),i=o.thumb_path||o.cover_url||o.cover||o.article_cover_url||"";return i||(e==="wait"||e==="loading"||e==="error"?os:"")}function ce(o){const e=Number((o==null?void 0:o.status)??-1);return e===0?"转换中":e===1?"学习中":e===2?"学习完成":e===3?"转换失败":e===4?"待学习":e===5?"待获取":e===6?"获取中":e===7?"获取失败":e===8?"转化异常":e===9?"取消解析":e===10?"正在分段":""}const ue=p(!1),De=p(null);function nt(o){De.value=o,ue.value=!0}function at(o){if(!o)return"--";const e=Se(o);return e.isValid()?e.format("YY-MM-DD"):o}function wt(o){const e=Number((o==null?void 0:o.doc_auto_renew_frequency)||0);if(!e)return"--";let i="";if(e===1)return"不自动更新";e===2&&(i="每天"),e===3&&(i="每3天"),e===4&&(i="每7天"),e===5&&(i="每30天");const k=Number((o==null?void 0:o.doc_auto_renew_minute)||0);if(k>0){let E=Xe(k);return typeof E=="string"&&/^0\d:\d{2}$/.test(E)&&(E=E.slice(1)),`${i}${E}更新`}return"更新"}const Oe=de({learned_err_count:0,learned_count:0,learned_wait_count:0}),w=de({library_id:b.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),Et=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],ke=p([]),xt=[{title:"文档名称",dataIndex:"file_name",key:"file_name",resizable:!0,minWidth:180,maxWidth:600,width:300},{title:"大小/分段",dataIndex:"file_size_str",key:"file_size",resizable:!0,minWidth:120,maxWidth:360,width:140},{title:"合计",dataIndex:"total_hits",key:"total_hits",resizable:!0,minWidth:80,maxWidth:200,width:80,sorter:!0},{title:"昨日",dataIndex:"yesterday_hits",key:"yesterday_hits",resizable:!0,minWidth:80,maxWidth:200,width:80,sorter:!0},{title:"今日",dataIndex:"today_hits",key:"today_hits",resizable:!0,minWidth:80,maxWidth:200,width:80,sorter:!0},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",resizable:!0,minWidth:120,maxWidth:400,width:200},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",resizable:!0,minWidth:120,maxWidth:320,width:160},{title:"状态",dataIndex:"status",key:"status",resizable:!0,minWidth:130,maxWidth:200,width:130},{title:"更新时间/频率",dataIndex:"update_info",key:"update_info",resizable:!0,minWidth:130,maxWidth:600,width:130},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],Ct=()=>`qa_document_columns_widths_${b.value||0}`,Fe=()=>`qa_document_view_mode_${b.value||0}`,$t=()=>{try{const o=localStorage.getItem(Ct())||"{}",e=JSON.parse(o);return typeof e=="object"&&e?e:{}}catch{return{}}},q=o=>{const e=$t();return o.map(i=>{const k=e[i.key];if(typeof k=="number"){let E=k;return typeof i.minWidth=="number"&&(E=Math.max(i.minWidth,E)),typeof i.maxWidth=="number"&&(E=Math.min(i.maxWidth,E)),{...i,width:E}}return i})},Ee=(o,e)=>{const i=$t();i[o]=e,localStorage.setItem(Ct(),JSON.stringify(i))},as=o=>{$e()},is=(o,e,i)=>{w.page=o.current,w.size=o.pageSize,w.sort_field="",w.sort_type="",i.order&&i.field&&(w.sort_field=i.field,w.sort_type=i.order=="ascend"?"ASC":"DESC"),pe()},$e=()=>{w.page=1,pe(!1),Ne()};let ol=!1;const nl=({id:o})=>{Ce.value.length==1&&(ol=!0),to({id:o}).then(()=>{ol&&w.page>1&&w.page--,pe(),Ne(),H.success("删除成功")})},Ge=(o,e={})=>{let i=ae.name;if(o.status=="4"){if(i=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+o.id+"&page="+w.page);return}if(e.open_new===!0){let k=A.resolve({path:"/library/document-segmentation",query:{document_id:o.id,page:w.page}});window.open(k.href,"_blank");return}return A.push({path:"/library/document-segmentation",query:{document_id:o.id,page:w.page}})}if(o.status=="3"&&P.value.type!=2)return H.error("学习失败,不可预览");if(o.status=="0")return H.error("转换中,稍候可预览");if(o.status=="1")return H.error("学习中,不可预览");if(o.status=="6")return H.error("获取中,不可预览");if(o.status=="7")return H.error("获取失败,不可预览");if(o.status=="10")return H.error("正在分段,不可预览");if(e.open_new===!0||i=="libraryConfig"){const k=A.resolve({name:"libraryPreview",query:{id:o.id,...e}});window.open(k.href,"_blank");return}A.push({name:"libraryPreview",query:{id:o.id,...e}})},pe=(o=!1)=>{let e=jt(w);e.status==0&&(e.status=""),e.group_id=m.value,D.value=!0,Xs(e).then(i=>{var dt;let k=i.data.info;!T.use_model&&T.use_model!=k.use_model&&(T.use_model=k.use_model,T.model_config_id=k.model_config_id),P.value={...k},J.value=k.graph_switch==1,o||(k.graph_switch=="0"||!X.value?ke.value=xt.filter(ee=>!["graph_status","graph_entity_count"].includes(ee.key)):ke.value=xt,$.type!=3&&(ke.value=ke.value.filter(ee=>ee.key!="official_article_update_time")),ke.value=q(ke.value));let E=i.data.list||[],M=i.data.count_data||{};if(!o){let ee=((dt=E==null?void 0:E[0])==null?void 0:dt.meta_list)||[],ye=[];ee.forEach(Ve=>{ke.value.findIndex(re=>re.dataIndex==Ve.key)>-1||ye.push({title:Ve.name,key:`meta_${Ve.key}`,dataIndex:`meta_${Ve.key}`,width:160})}),ke.value.splice(ke.value.length-1,0,...ye)}w.total=i.data.total,Oe.learned_count=M.learned_count,Oe.learned_err_count=M.learned_err_count,Oe.learned_wait_count=M.learned_wait_count;let V=!1;const me=E.map(ee=>(["1","6","0","5"].includes(ee.status)&&(V=!0),ee.file_size_str=Zs(ee.file_size),ee.update_time=Se(ee.update_time*1e3).format("YYYY-MM-DD HH:mm"),ee.official_article_update_time=Se(ee.official_article_update_time*1e3).format("YYYY-MM-DD HH:mm"),ee.doc_last_renew_time_desc=ee.doc_last_renew_time>0?Se(ee.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",Array.isArray(ee.meta_list)&&ee.meta_list.forEach(ye=>{ye.type==1&&ye.value>0&&(ye.value=Se(ye.value*1e3).format("YYYY-MM-DD HH:mm")),ye.key=="source"&&(ye.value=N[ye.value]),ee[`meta_${ye.key}`]=ye.value}),ee));Ce.value=o?[...Ce.value,...me]:me,V&&us(),!V&&clearInterval(it.value)}).finally(()=>{D.value=!1})},it=p(null),us=()=>{clearInterval(it.value),it.value=setInterval(()=>{pe()},1e3*5)},al=p(null),rs=o=>{if(te.value.length==0){ge.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){A.push({path:"/user/model"})}});return}let{key:e}=o;e==1&&ps(),e==2&&ds(),e==3&&al.value.add(),e==4&&W.value.show()},Z=de({open:!1,urls:"",library_id:b.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(o,e)=>zl(e)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),ds=()=>{Z.open=!0,Z.confirmLoading=!1,Z.urls="",Z.doc_auto_renew_minute="02:00",Z.doc_auto_renew_frequency=1},il=p(null),_s=()=>{il.value.validate().then(()=>{Z.confirmLoading=!0,vt({library_id:Z.library_id,urls:JSON.stringify(zl(Z.urls)),doc_auto_renew_frequency:Z.doc_auto_renew_frequency,doc_auto_renew_minute:Xe(Z.doc_auto_renew_minute),doc_type:2,group_id:m.value}).then(()=>{Z.open=!1,Z.confirmLoading=!1,$e()})}).catch(()=>{Z.confirmLoading=!1})},cs=()=>{Z.open=!1},ie=de({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ul=fe(()=>ie.fileList.filter(o=>o.type==="application/pdf").length>0),rl=p(null),ps=()=>{if(P.value.type==2){rl.value.show();return}ie.fileList=[],ie.open=!0},fs=()=>{ie.fileList=[]},vs=o=>{ie.fileList=o},ms=()=>{if(r.value&&!O.getGuideLearningTips&&ie.fileList.length>1&&r.value.show(),ie.fileList.length==0){H.error("请选择文件");return}ie.confirmLoading=!0;let o=new FormData;o.append("library_id",w.library_id),o.append("group_id",m.value||0);let e=!1;ie.fileList.forEach(i=>{(i.name.includes(".xlsx")||i.name.includes(".csv"))&&(e=!0),o.append("library_files",i)}),ul.value&&o.append("pdf_parse_type",ie.pdf_parse_type),vt(o).then(i=>{pe(),ie.open=!1,ie.fileList=[],ie.confirmLoading=!1,e&&i.data.file_ids.length==1&&A.push("/library/document-segmentation?document_id="+i.data.file_ids[0])}).catch(()=>{ie.confirmLoading=!1})},dl=p(null),_l=o=>{dl.value.show(o)},cl=o=>{A.push({path:"/library/document-segmentation",query:{document_id:o.id}})},pl=o=>{oo({id:o.id}).then(()=>{pe()})},ys=()=>{if(J.value){J.value=!1;let o={graph_model_config_id:P.value.graph_model_config_id,graph_use_model:P.value.graph_use_model};if((!o.graph_model_config_id||!o.graph_use_model)&&Re.value.length>0){let i=Re.value[0].children[0];o.graph_use_model=i.name,o.graph_model_config_id=i.model_config_id}c.value.show(o)}else P.value.graph_switch=0,S(!1,()=>{pe(),Q(0)})},gs=o=>{J.value=!0,P.value.graph_switch=1,P.value.graph_model_config_id=o.graph_model_config_id,P.value.graph_use_model=o.graph_use_model,S(!1,()=>{pe(),Q(1)})},hs=o=>{if(o.key==4&&!G.value)return!1;ie.pdf_parse_type=o.key},ks=()=>{window.open("#/user/aliocr")},fl=p(null),Gt=(o,e=!1)=>{fl.value.show({...o,from_update_info:e})},bs=o=>{no({id:o.id}).then(e=>{H.success("更新成功"),pe()})},ws=o=>{ge.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){so({id:o.id}).then(e=>{H.success("取消成功"),pe()})}})},xs=o=>{j("graph:autoOpenFileId",o.id),A.push({path:"/library/details/knowledge-graph",query:{id:b.value}})},vl=o=>{let e=`/manage/downloadLibraryFile?id=${o.id}&token=${O.getToken}`;var i=document.createElement("a");i.href=e,i.style.display="none",i.click()},St=()=>{_.value=!_.value,localStorage.setItem("document_group_hide_key",_.value?1:2)},Ne=()=>{Jt({library_id:b.value,group_type:1,order_field:se.order_field,order_type:se.order_type}).then(o=>{let i=(o.data||[]).reduce((k,E)=>k+ +E.total,0);F.value=[{group_name:"全部分组",id:-1,total:i},...o.data]})};Ne();const ml=p(null),ut=o=>{ml.value.show({...o,library_id:b.value})},yl=p(null),gl=o=>{yl.value.show({...o,sense:1})},Lt=()=>{Ne(),pe()},We=p(!1),Nt=o=>{m.value=o.id,$e()},Cs=()=>{We.value=!1,m.value=-1,$e()},Wt=p(null),Te=p(null);function $s(){try{Te.value&&Te.value.disconnect(),Te.value=new IntersectionObserver(o=>{const e=o[0];e&&e.isIntersecting&&Ss()},{root:null,threshold:.1}),ro(()=>{Wt.value&&Te.value.observe(Wt.value)})}catch{}}function Ss(){_e.value!=="folder"||!(w.page*w.size<(w.total||0))||D.value||(w.page++,pe(!0))}const At=o=>{ge.confirm({title:`确认删除分组${o.group_name}`,icon:l(mt),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){Al({id:o.id,sense:1}).then(()=>{H.success("删除成功"),Ne(),m.value==o.id&&(m.value=-1,$e())})}})},rt=p(Rt),qt=p(!1);Vt(()=>{const o=parseInt(localStorage.getItem(El));o&&o>=Rt&&o<=Yt&&(rt.value=o);const e=localStorage.getItem(Fe());e==="folder"||e==="list"?(_e.value=e,w.size=e==="folder"?50:10):localStorage.setItem(Fe(),"list"),Ls(),$s(),Ke=setInterval(()=>{tt.value++},1500)});const Ls=()=>{const{user_access_token:o,feishu_app_id:e,feishu_app_secret:i,...k}=K;o&&e&&i&&(A.replace({query:k}),W.value.show({user_access_token:o,feishu_app_id:e,feishu_app_secret:i}))};let Dt=!1,hl=0,kl=0;const qs=o=>{_.value||(Dt=!0,qt.value=!0,hl=o.clientX,kl=rt.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",bl),document.addEventListener("mouseup",wl))},bl=o=>{if(!Dt)return;let e=kl+(o.clientX-hl);e=Math.max(Rt,Math.min(Yt,e)),rt.value=e},wl=()=>{Dt&&(Dt=!1,qt.value=!1,localStorage.setItem(El,rt.value),document.body.style.cursor="",document.removeEventListener("mousemove",bl),document.removeEventListener("mouseup",wl))},Ds=o=>o.draggedContext.element.id>0&&o.relatedContext.element.id>0,Os=async()=>{try{const o=F.value.filter(e=>e.id>0).map((e,i)=>({id:e.id,sort:F.value.length-i}));await eo({library_id:b.value,sense:1,sort_group:JSON.stringify(o)}),H.success("排序已保存")}catch(o){console.error("排序保存失败:",o),Ne()}},xl=p(null),Ms=o=>{xl.value.show(o==2)};Vt(()=>{K.page&&(w.page=+K.page),pe()});const Rs=(o,e)=>{let i=o;typeof e.minWidth=="number"&&(i=Math.max(e.minWidth,i)),typeof e.maxWidth=="number"&&(i=Math.min(e.maxWidth,i)),e.width=i,ke.value=ke.value.map(k=>k.key===e.key?{...k,width:i}:k),Ee(e.key,i)};return uo(()=>{it.value&&clearInterval(it.value),Ke&&clearInterval(Ke),Te.value&&Te.value.disconnect(),Te.value&&Te.value.disconnect()}),(o,e)=>{const i=Qt,k=el,E=Ae,M=jl,V=Vl,me=Yl,dt=Gl,ee=It,ye=Co,Ve=$o,re=tl,je=kt,Cl=ht,Is=So,$l=sl,Ht=Lo,Us=Do,_t=Oo,zs=Bl,ct=Ut,Sl=yt,Ll=ge,Ts=Uo,Fs=Zl,ql=Hl("copy");return n(),u("div",ii,[t("div",{class:ve(["group-content-box",[{collapsed:_.value},{"no-transition":qt.value}]]),style:Pl(_.value?{}:{width:rt.value+"px",minWidth:Rt+"px",maxWidth:Yt+"px"})},[t("div",ui,[t("div",ri,[l(k,{title:"收起问答分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:St},[l(i,{name:"put-away"})])]),_:1}),t("div",di,[e[27]||(e[27]=t("div",null,"知识分组",-1)),l(k,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:e[0]||(e[0]=a=>ut({}))},[l(C(Je))])]),_:1})])]),f("",!0)]),t("div",_i,[l(dt,{style:{"padding-right":"24px"}},{default:s(()=>[l(C(No),{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=a=>F.value=a),"item-key":"id",disabled:qt.value,onEnd:Os,move:Ds,handle:".drag-btn"},{item:s(({element:a})=>[t("div",{class:ve(["classify-item",{active:a.id==m.value}]),onClick:d=>Nt(a)},[a.id>0?(n(),u("span",pi,[l(i,{name:"drag"})])):(n(),u("span",fi)),t("div",vi,v(a.group_name),1),t("div",mi,[t("div",{class:ve(["num",{"num-block":a.id<=0}])},v(a.total),3),a.id>0?(n(),u("div",yi,[l(me,{placement:"bottomRight"},{overlay:s(()=>[l(V,null,{default:s(()=>[l(M,null,{default:s(()=>[t("div",{onClick:ne(d=>ut(a),["stop"])},"重命名",8,hi)]),_:2},1024),l(M,null,{default:s(()=>[t("div",{onClick:ne(d=>At(a),["stop"])},"删 除",8,ki)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",gi,[l(C(Qe))])]),_:2},1024)])):f("",!0)])],10,ci)]),_:1},8,["modelValue","disabled"])]),_:1})]),_.value?f("",!0):(n(),u("div",{key:0,class:"resize-bar",onMousedown:qs},null,32))],6),t("div",bi,[l(dt,{scrollbar:!1},{default:s(()=>[t("div",wi,[_.value?(n(),x(ee,{key:0,title:null,placement:"bottom"},{content:s(()=>[t("div",xi,[t("div",Ci,[t("div",$i,[t("div",Si,[e[28]||(e[28]=t("div",null,"问答分组",-1)),l(k,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:e[4]||(e[4]=a=>ut({}))},[l(C(Je))])]),_:1})])]),t("div",Li,[l(E,{allowClear:"",value:z.value,"onUpdate:value":e[6]||(e[6]=a=>z.value=a),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[l(C(ft),{onClick:e[5]||(e[5]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),t("div",qi,[(n(!0),u(B,null,he(h.value,a=>(n(),u("div",{class:ve(["classify-item",{active:a.id==m.value}]),onClick:d=>Nt(a),key:a.id},[t("div",Oi,v(a.group_name),1),t("div",Mi,[t("div",{class:ve(["num",{"num-block":a.id<=0}])},v(a.total),3),a.id>0?(n(),u("div",Ri,[l(me,{placement:"bottomRight"},{overlay:s(()=>[l(V,null,{default:s(()=>[l(M,null,{default:s(()=>[t("div",{onClick:ne(d=>ut(a),["stop"])},"重命名",8,Ui)]),_:2},1024),l(M,null,{default:s(()=>[t("div",{onClick:ne(d=>At(a),["stop"])},"删 除",8,zi)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",Ii,[l(C(Qe))])]),_:2},1024)])):f("",!0)])],10,Di))),128))])])]),default:s(()=>[_e.value!=="folder"||_e.value==="list"?(n(),u("div",{key:0,class:"hover-btn-wrap",onClick:St},[l(i,{name:"expand"})])):f("",!0)]),_:1})):f("",!0),t("div",Ti,[We.value?(n(),x(Ve,{key:0},{default:s(()=>[l(ye,null,{default:s(()=>[t("a",{class:"breadcrumb-a",onClick:Cs},"知识库文档")]),_:1}),m.value===-1?(n(),x(ye,{key:0},{default:s(()=>[...e[29]||(e[29]=[y("全部分组",-1)])]),_:1})):(n(),x(ye,{key:1},{default:s(()=>[y(v(R.value.group_name),1)]),_:1}))]),_:1})):(n(),u("span",Fi,"知识库文档"))])]),t("div",Ei,[t("div",Gi,[t("div",Ni,[t("div",Wi,[t("div",{class:ve(["toggle-seg",{active:_e.value==="folder"}]),onClick:Pe,"aria-label":"文件夹视图"},[l(i,{class:"toggle-icon",name:_e.value==="folder"?"folder-icon-active":"folder-icon"},null,8,["name"])],2),t("div",{class:ve(["toggle-seg",{active:_e.value==="list"}]),onClick:Ue,"aria-label":"缩略图视图"},[l(i,{class:"toggle-icon",name:_e.value==="list"?"thumbnail-icon-active":"thumbnail-icon"},null,8,["name"])],2)])]),_e.value==="folder"&&We.value?(n(),u("div",Ai,[t("div",{class:"sort-btn",ref_key:"sortBtnRef",ref:zt},[t("div",Hi,[t("span",Pi,v(se.order_field==="total_hits"?"合计":se.order_field==="today_hits"?"今日":se.order_field==="yesterday_hits"?"昨日":"默认"),1),se.order_field?se.order_type==="DESC"?(n(),x(i,{key:"desc",class:"sort-icon active",name:"sort-down-icon",onClick:ne(ze,["stop"])})):(n(),x(i,{key:"asc",class:"sort-icon active",name:"sort-top-icon",onClick:ne(ze,["stop"])})):(n(),x(i,{key:"default",class:"sort-icon active",name:"sort-icon"}))]),l(me,{open:qe.value,"onUpdate:open":e[11]||(e[11]=a=>qe.value=a),trigger:"click"},{overlay:s(()=>[l(V,{selectedKeys:[se.order_field||"default"]},{default:s(()=>[(n(),x(M,{key:"default",onClick:e[7]||(e[7]=a=>Be("default"))},{default:s(()=>[...e[30]||(e[30]=[y("默认",-1)])]),_:1})),(n(),x(M,{key:"total_hits",onClick:e[8]||(e[8]=a=>Be("total_hits"))},{default:s(()=>[...e[31]||(e[31]=[y("合计",-1)])]),_:1})),(n(),x(M,{key:"today_hits",onClick:e[9]||(e[9]=a=>Be("today_hits"))},{default:s(()=>[...e[32]||(e[32]=[y("今日",-1)])]),_:1})),(n(),x(M,{key:"yesterday_hits",onClick:e[10]||(e[10]=a=>Be("yesterday_hits"))},{default:s(()=>[...e[33]||(e[33]=[y("昨日",-1)])]),_:1}))]),_:1},8,["selectedKeys"])]),default:s(()=>[t("span",{class:ve(["sort-arrow",{active:qe.value}]),onClick:ne(et,["prevent"])},[l(C(ll))],2)]),_:1},8,["open"])],512)])):f("",!0),pt(l(re,{align:"center",class:"tool-item custom-select-box"},{default:s(()=>[e[34]||(e[34]=t("span",null,"嵌入模型：",-1)),l(Tl,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:T.use_model,modeId:T.model_config_id,style:{width:"240px"},onChange:xe,onLoaded:Le},null,8,["modeName","modeId"])]),_:1},512),[[Rl,!1]])]),t("div",Bi,[P.value.type==0?(n(),u("div",Ki,[t("div",Yi,[e[35]||(e[35]=t("div",{class:"status-label"},"已学习：",-1)),t("div",Vi,v(Oe.learned_count),1)]),Oe.learned_wait_count>0?(n(),u("div",ji,[e[36]||(e[36]=t("div",{class:"status-label"},"，未学习：",-1)),t("div",Qi,v(Oe.learned_wait_count),1)])):f("",!0),Oe.learned_err_count>0?(n(),u("div",Ji,[e[37]||(e[37]=t("div",{class:"status-label"},"，学习失败：",-1)),t("div",Xi,v(Oe.learned_err_count),1)])):f("",!0)])):f("",!0),P.value.type==0?(n(),u("div",Zi,[l(Cl,{value:w.status,"onUpdate:value":e[12]||(e[12]=a=>w.status=a),style:{width:"150px"},placeholder:"请选择",onChange:as},{default:s(()=>[(n(),u(B,null,he(Et,a=>l(je,{key:a.id,value:a.id},{default:s(()=>[y(v(a.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):f("",!0),t("div",eu,[l(E,{style:{width:"140px"},value:w.file_name,"onUpdate:value":e[13]||(e[13]=a=>w.file_name=a),placeholder:"文档名称搜索",onChange:$e},{suffix:s(()=>[l(C(ft),{onClick:$e,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),X.value?(n(),x(re,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:s(()=>[pt(l(Tl,{modelType:"LLM",onLoaded:He},null,512),[[Rl,!1]]),e[38]||(e[38]=t("span",null,"生成知识图谱：",-1)),l(Is,{checked:J.value,"onUpdate:checked":e[14]||(e[14]=a=>J.value=a),onChange:ys,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})):f("",!0),$.type!=3?(n(),x($l,{key:3,onClick:e[15]||(e[15]=a=>Ms(1))},{default:s(()=>[e[39]||(e[39]=y("元数据 ",-1)),l(C(Ql))]),_:1})):f("",!0),t("div",tu,[l(me,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:s(()=>[l(V,{onClick:rs},{default:s(()=>[(n(),x(M,{key:1},{default:s(()=>[t("div",lu,[l(re,{class:"title-block",gap:4},{default:s(()=>[l(i,{name:"doc-icon"}),e[40]||(e[40]=t("div",{class:"title"},"本地文档",-1))]),_:1}),P.value.type==2?(n(),u("div",su," 上传本地 docx/csv/xlsx 等格式文件 ")):(n(),u("div",ou," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),P.value.type!=2?(n(),x(M,{key:2},{default:s(()=>[t("div",nu,[l(re,{class:"title-block",gap:4},{default:s(()=>[l(i,{name:"link-icon"}),e[41]||(e[41]=t("div",{class:"title"},"在线数据",-1))]),_:1}),e[42]||(e[42]=t("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):f("",!0),(n(),x(M,{key:3},{default:s(()=>[t("div",au,[l(re,{class:"title-block",gap:4},{default:s(()=>[l(i,{name:"cu-doc-icon"}),e[43]||(e[43]=t("div",{class:"title"},"自定义文档",-1))]),_:1}),e[44]||(e[44]=t("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1})),P.value.type==0?(n(),x(M,{key:4},{default:s(()=>[t("div",iu,[l(re,{class:"title-block",gap:4},{default:s(()=>[l(i,{name:"feishu-doc"}),e[45]||(e[45]=t("div",{class:"title"},"飞书知识库",-1))]),_:1}),e[46]||(e[46]=t("div",{class:"desc"},"在线获取飞书知识库下docx格式云文档内容",-1))])]),_:1})):f("",!0),_e.value==="folder"?(n(),x(M,{key:5},{default:s(()=>[t("div",uu,[l(re,{class:"title-block",gap:4},{default:s(()=>[l(i,{name:"group-default-icon"}),e[47]||(e[47]=t("div",{class:"title"},"添加分组",-1))]),_:1}),e[48]||(e[48]=t("div",{class:"desc"},"便于文档更好的归类",-1))])]),_:1})):f("",!0)]),_:1})]),default:s(()=>[U.type!=3?(n(),x($l,{key:0,type:"primary"},{icon:s(()=>[l(C(Je))]),default:s(()=>[e[49]||(e[49]=t("span",null,"添加内容",-1))]),_:1})):f("",!0)]),_:1})])])]),P.value.type==0&&_e.value==="list"?(n(),x(Eo,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:s(()=>[...e[50]||(e[50]=[t("div",null,[t("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),t("p",null,"2、未学习的文档数据不会被检索到。")],-1)])]),_:1})):f("",!0),_e.value==="folder"?(n(),u("div",ru,[We.value&&ot.value.length===0?(n(),u("div",du,[t("div",_u,[t("img",{src:C(ns),alt:"",class:"empty-img"},null,8,cu),e[51]||(e[51]=t("div",{class:"empty-text"},"暂无文档",-1))])])):(n(),u("div",pu,[(n(!0),u(B,null,he(ot.value,a=>(n(),u("div",{key:`${a.__type}-${a.id}`,class:ve(["folder-card",[`card-${a.__type}`]]),onClick:d=>I(a)},[t("div",{class:ve(["folder-thumb",["status-"+(a.cover_status||"success")]])},[a.__type==="group"?(n(),x(i,{key:0,name:"group-icon",class:"folder-type-icon"})):(n(),u(B,{key:1},[a.cover_src?(n(),u("img",{key:0,src:a.cover_src,alt:"",class:"thumb-img"},null,8,vu)):(n(),u("img",mu)),a.status_label&&a.cover_status!=="success"?(n(),u("div",yu,[a.cover_status==="error"&&a.origin.errmsg&&a.origin.errmsg!="success"?(n(),x(k,{key:0},{title:s(()=>[t("span",null,v(a.origin.errmsg),1)]),default:s(()=>[l(i,{style:{color:"rgba(0, 0, 0, 0.4)","font-size":"16px","vertical-align":"sub"},name:"tip-icon-two"}),y(" "+v(a.status_label),1)]),_:2},1024)):f("",!0),a.cover_status==="error"&&!a.origin.errmsg?(n(),x(i,{key:1,style:{color:"rgba(0, 0, 0, 0.4)","font-size":"16px","vertical-align":"sub"},name:"tip-icon-two"})):f("",!0),a.cover_status==="wait"?(n(),x(i,{key:2,style:{color:"rgba(0, 0, 0, 0.4)","font-size":"16px","vertical-align":"sub"},name:"time-default-icon"})):f("",!0),a.origin.errmsg=="success"&&a.cover_status==="loading"&&st(a.origin)!==null?(n(),u("span",gu,v(st(a.origin))+"%",1)):f("",!0),!a.origin.errmsg||a.origin.errmsg=="success"?(n(),u("span",hu,v(a.status_label),1)):f("",!0)])):f("",!0)],64))],2),t("div",ku,[a.__type==="group"?(n(),u("div",bu,v(a.group_name),1)):(n(),u(B,{key:1},[a.origin.doc_type==2?(n(),x(ee,{key:0,title:null},{content:s(()=>[e[52]||(e[52]=y(" 原链接：",-1)),t("a",{href:a.origin.doc_url,target:"_blank"},v(a.origin.doc_url),9,wu),pt(l(C(Il),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[ql,`${a.origin.doc_url}`]])]),default:s(()=>[t("div",xu,v(a.title),1)]),_:2},1024)):(n(),u("div",Cu,v(a.title),1))],64)),t("div",$u,[a.__type==="group"?(n(),u(B,{key:0},[t("span",null,v(a.total||"0")+"个知识库",1),t("span",null,v(g(a.last_update_ts)),1)],64)):(n(),u(B,{key:1},[t("span",Su,[l(i,{name:["docx","excel","html","pdf","txt","xlsx","ofd","csv","md"].some(d=>String(a.origin.file_ext||"").includes(d))?a.origin.file_ext:"file_ext",class:"file-icon"},null,8,["name"]),y(" "+v(a.origin.file_ext||"--"),1)]),t("span",null,v(g(a.update_ts)),1)],64))])]),a.__type==="group"&&a.id>0?(n(),x(me,{key:0},{overlay:s(()=>[l(V,null,{default:s(()=>[l(M,{onClick:d=>ut({id:a.id,group_name:a.group_name})},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"edit"}),e[53]||(e[53]=t("div",null,"重命名",-1))]),_:1})]),_:1},8,["onClick"]),l(M,{onClick:d=>At({id:a.id,group_name:a.group_name})},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"delete"}),e[54]||(e[54]=t("div",null,"删除",-1))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[t("div",{class:"card-more",onClick:e[16]||(e[16]=ne(()=>{},["stop"]))},[l(C(Qe))])]),_:2},1024)):f("",!0),a.__type==="file"?(n(),x(me,{key:1},{overlay:s(()=>[l(V,null,{default:s(()=>[l(M,{onClick:d=>nt(a.origin)},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"base-data-icon"}),e[55]||(e[55]=t("div",null,"基础数据",-1))]),_:1})]),_:1},8,["onClick"]),l(M,{onClick:d=>Ge(a.origin)},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"preview-icon"}),e[56]||(e[56]=t("div",null,"预览",-1))]),_:1})]),_:1},8,["onClick"]),l(M,{onClick:d=>cl(a.origin)},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(C(Ul),{class:"action-icon"}),e[57]||(e[57]=t("div",null,"重新分段",-1))]),_:1})]),_:1},8,["onClick"]),l(M,{onClick:d=>_l(a.origin)},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"edit"}),e[58]||(e[58]=t("div",null,"重命名",-1))]),_:1})]),_:1},8,["onClick"]),l(M,{onClick:d=>gl(a.origin)},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"group-default-icon"}),e[59]||(e[59]=t("div",null,"修改分组",-1))]),_:1})]),_:1},8,["onClick"]),l(M,{onClick:d=>vl(a.origin)},{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"down-file"}),e[60]||(e[60]=t("div",null,"下载文档",-1))]),_:1})]),_:1},8,["onClick"]),l(Ht,{title:"确定要删除吗?",placement:"topRight",trigger:"click",onConfirm:d=>nl(a.origin)},{default:s(()=>[l(M,null,{default:s(()=>[l(re,{gap:8,align:"center"},{default:s(()=>[l(i,{name:"delete"}),e[61]||(e[61]=t("div",null,"删除",-1))]),_:1})]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),default:s(()=>[t("div",{class:"card-more",onClick:e[17]||(e[17]=ne(()=>{},["stop"]))},[l(C(Qe))])]),_:2},1024)):f("",!0)],10,fu))),128)),t("div",{ref_key:"folderScrollSentinel",ref:Wt,class:"scroll-sentinel"},null,512)])),l(Xa,{open:ue.value,"onUpdate:open":e[18]||(e[18]=a=>ue.value=a),record:De.value,onClose:e[19]||(e[19]=a=>ue.value=!1),onEditOnline:Gt},null,8,["open","record"])])):(n(),u("div",Lu,[l(zs,{onResizeColumn:Rs,columns:ke.value,"data-source":Ce.value,scroll:{x:1e3},"row-key":"id",pagination:{current:w.page,total:w.total,pageSize:w.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:is},{headerCell:s(({column:a})=>{var d;return[a.key.indexOf("meta_")>-1?(n(),x(k,{key:0,title:((d=a.title)==null?void 0:d.length)>8?a.title:""},{default:s(()=>[t("div",qu,v(a.title),1)]),_:2},1032,["title"])):a.key==="file_name"?(n(),u(B,{key:1},[y(" 文档名称 (共"+v(w.total||0)+"个) ",1)],64)):a.key==="graph_entity_count"?(n(),u("div",Du,[e[62]||(e[62]=t("div",{class:"zm-line1"},"实体数",-1)),l(k,{title:"知识图谱实体数"},{default:s(()=>[l(C(Io))]),_:1})])):f("",!0)]}),bodyCell:s(({column:a,record:d})=>[a.key==="file_name"?(n(),u("div",Ou,[l(k,{title:`.${d.file_ext}`},{default:s(()=>[l(i,{name:["docx","excel","html","pdf","txt","xlsx","ofd","csv","md"].some(oe=>String(d.file_ext||"").includes(oe))?d.file_ext:"file_ext",class:"file-icon"},null,8,["name"])]),_:2},1032,["title"]),d.doc_type==2?(n(),x(ee,{key:0,title:null},{content:s(()=>[e[63]||(e[63]=y(" 原链接：",-1)),t("a",{href:d.doc_url,target:"_blank"},v(d.doc_url),9,Mu),pt(l(C(Il),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[ql,`${d.doc_url}`]])]),default:s(()=>[t("a",{onClick:oe=>Ge(d,{open_new:!0})},[l(k,{title:C(Ol)(["5","6","7"].includes(d.status)?d.doc_url:d.file_name,d,14,2,12),placement:"top"},{default:s(()=>[t("span",{class:"doc-name-text",ref:oe=>C(Ml)(oe,d)},[["5","6","7"].includes(d.status)?(n(),u("span",Iu,v(d.doc_url),1)):(n(),u("span",Uu,v(d.file_name),1))],512)]),_:2},1032,["title"])],8,Ru)]),_:2},1024)):(n(),u("a",{key:1,onClick:oe=>Ge(d,{open_new:!0})},[l(k,{title:C(Ol)(["5","6","7"].includes(d.status)?d.doc_url:d.file_name,d,14,2,12),placement:"top"},{default:s(()=>[t("span",{class:"doc-name-text",ref:oe=>C(Ml)(oe,d)},[["5","6","7"].includes(d.status)?(n(),u("span",Tu,v(d.doc_url),1)):(n(),u("span",Fu,v(d.file_name),1))],512)]),_:2},1032,["title"])],8,zu)),d.doc_type==2&&d.remark?(n(),u("div",Eu," 备注："+v(d.remark),1)):f("",!0)])):f("",!0),a.key==="graph_entity_count"?(n(),u("a",{key:1,onClick:oe=>xs(d)},v(d.graph_entity_count),9,Gu)):f("",!0),a.key==="status"?(n(),u(B,{key:2},[d.file_ext=="pdf"&&d.pdf_parse_type>=2?(n(),u(B,{key:0},[d.status==0?(n(),u("div",Nu,[t("div",Wu,[t("span",Au,[l(C(qo)),e[64]||(e[64]=y("文档解析中",-1))]),t("a",{onClick:oe=>ws(d)},"取消",8,Hu)]),t("div",Pu,[l(Us,{size:"small",class:"progress-bar-box",percent:parseInt(d.ocr_pdf_index/d.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),t("div",Bu,v(d.ocr_pdf_index)+" / "+v(d.ocr_pdf_total),1)])])):f("",!0)],64)):(n(),u(B,{key:1},[d.status==0?(n(),u("span",Ku,[l(_t,{size:"small"}),e[65]||(e[65]=y(" 转换中",-1))])):f("",!0)],64)),d.status==1?(n(),u("span",Yu,[l(_t,{size:"small"}),e[66]||(e[66]=y(" 学习中",-1))])):f("",!0),d.status==2?(n(),u("span",Vu,[l(C(Pt)),e[67]||(e[67]=y(" 学习完成",-1))])):f("",!0),d.status==3?(n(),x(k,{key:4,placement:"top"},{title:s(()=>[t("span",null,v(d.errmsg),1)]),default:s(()=>[t("span",null,[t("span",ju,[l(C(Ot)),e[68]||(e[68]=y(" 转换失败",-1))]),P.value.type==2?(n(),u("a",{key:0,class:"ml8",onClick:oe=>Ge(d)},"学习",8,Qu)):f("",!0)])]),_:2},1024)):f("",!0),d.status==8?(n(),x(k,{key:5,placement:"top"},{title:s(()=>[t("span",null,v(d.errmsg),1)]),default:s(()=>[t("span",null,[t("span",Ju,[l(C(Ot)),e[69]||(e[69]=y(" 转化异常",-1))])])]),_:2},1024)):f("",!0),d.status==4?(n(),u("span",Xu,[l(C(Bt)),e[70]||(e[70]=y(" 待学习",-1))])):f("",!0),d.status==5?(n(),u("span",Zu,[l(C(Bt)),e[71]||(e[71]=y(" 待获取",-1))])):f("",!0),d.status==6?(n(),u("span",er,[l(_t,{size:"small"}),e[72]||(e[72]=y(" 获取中",-1))])):f("",!0),d.status==7?(n(),x(k,{key:9,placement:"top"},{title:s(()=>[t("span",null,v(d.errmsg),1)]),default:s(()=>[t("span",tr,[l(C(Ot)),e[73]||(e[73]=y(" 获取失败",-1))])]),_:2},1024)):f("",!0),d.status==9?(n(),u("span",lr,[l(C(mt)),e[74]||(e[74]=y(" 取消解析",-1))])):f("",!0),d.status==10?(n(),u("span",sr,[l(_t,{size:"small"}),e[75]||(e[75]=y(" 正在分段 ",-1))])):f("",!0)],64)):f("",!0),a.key==="graph_status"?(n(),u(B,{key:3},[d.graph_status==0?(n(),u(B,{key:0},[t("span",or,[l(C(Bt)),e[76]||(e[76]=y(" 待生成",-1))]),t("a",{class:"ml8",onClick:oe=>pl(d)},"生成",8,nr)],64)):d.graph_status==1?(n(),u("span",ar,[l(C(Mo)),e[77]||(e[77]=y(" 排队中",-1))])):d.graph_status==2?(n(),u("span",ir,[l(C(Pt)),e[78]||(e[78]=y(" 生成完成",-1))])):d.graph_status==3?(n(),u(B,{key:3},[t("span",ur,[l(C(Ot)),e[79]||(e[79]=y(" 生成失败",-1))]),t("a",{class:"ml8",onClick:oe=>pl(d)},"生成",8,rr),d.graph_err_msg?(n(),x(k,{key:0,title:d.graph_err_msg},{default:s(()=>[t("div",dr,"原因："+v(d.graph_err_msg),1)]),_:2},1032,["title"])):f("",!0)],64)):d.graph_status==4?(n(),u("span",_r,[l(_t,{size:"small"}),e[80]||(e[80]=y(" 生成中",-1))])):d.graph_status==5?(n(),u(B,{key:5},[t("span",cr,[l(C(Pt)),e[81]||(e[81]=y(" 部分成功",-1))]),t("div",pr,[y(" 失败数："+v(d.graph_err_count||0)+" ",1),t("a",{class:"ml8",onClick:oe=>Ge(d,{graph_status:3})},"详情",8,fr)])],64)):f("",!0)],64)):f("",!0),a.key==="file_size"?(n(),u("span",vr,v(d.doc_type==3?"-":d.file_size_str)+" / "+v(d.status==0||d.status==1?"-":d.paragraph_count),1)):f("",!0),a.key==="update_info"?(n(),u("div",mr,[t("span",yr,[y(v(at(d.update_time))+" ",1),l(ee,{title:null,placement:"top",overlayClassName:"update-popover"},{content:s(()=>[t("div",gr,[t("div",hr,[e[82]||(e[82]=y(" 更新频率：",-1)),t("span",kr,v(wt(d)),1),t("div",br,[l(i,{name:"edit",class:"edit-icon",onClick:ne(oe=>Gt(d,!0),["stop"])},null,8,["onClick"])])]),t("div",wr,[e[84]||(e[84]=y(" 更新时间：",-1)),t("span",xr,v(d.update_time),1),l(Ht,{title:"确认更新?",onConfirm:oe=>bs(d)},{default:s(()=>[...e[83]||(e[83]=[t("a",{class:"ml4 btn-hover-block"},"更新",-1)])]),_:1},8,["onConfirm"])])])]),default:s(()=>[t("span",Cr,[d.doc_type==2&&d.doc_auto_renew_frequency?(n(),u(B,{key:0},[e[85]||(e[85]=t("span",{class:"ml4"},"/",-1)),l(i,{class:"update-icon",name:d.doc_auto_renew_frequency==1?"forbid-update-icon":"update-icon"},null,8,["name"])],64)):f("",!0)])]),_:2},1024)])])):f("",!0),a.key==="action"?(n(),x(re,{key:6,gap:8},{default:s(()=>[l(k,null,{title:s(()=>[...e[86]||(e[86]=[y("重新分段",-1)])]),default:s(()=>[l(C(Ul),{class:"btn-hover-block",onClick:oe=>cl(d)},null,8,["onClick"])]),_:2},1024),l(me,null,{overlay:s(()=>[l(V,null,{default:s(()=>[d.doc_type==2?(n(),x(M,{key:0},{default:s(()=>[t("div",{onClick:oe=>Gt(d)},"编辑",8,$r)]),_:2},1024)):f("",!0),l(M,{disabled:d.status==6||d.status==7||d.status==0},{default:s(()=>[t("div",{onClick:oe=>Ge(d)},"预览",8,Sr)]),_:2},1032,["disabled"]),l(M,{onClick:oe=>_l(d)},{default:s(()=>[...e[87]||(e[87]=[t("div",null,"重命名",-1)])]),_:1},8,["onClick"]),l(Ht,{title:"确定要删除吗?",onConfirm:oe=>nl(d),placement:"topRight"},{default:s(()=>[l(M,null,{default:s(()=>[...e[88]||(e[88]=[t("span",null,"删除",-1)])]),_:1})]),_:1},8,["onConfirm"]),l(M,{onClick:oe=>gl(d)},{default:s(()=>[...e[89]||(e[89]=[t("div",null,"修改分组",-1)])]),_:1},8,["onClick"]),l(M,{onClick:oe=>vl(d)},{default:s(()=>[...e[90]||(e[90]=[t("div",null,"下载文档",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[t("div",{class:"table-btn",onClick:e[20]||(e[20]=ne(()=>{},["prevent"]))},[l(C(Ro),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):f("",!0),a.key.indexOf("meta_")>-1&&d[a.key]?(n(),x(k,{key:7,title:d[a.key].length>8?d[a.key]:""},{default:s(()=>[t("div",Lr,v(d[a.key]),1)]),_:2},1032,["title"])):f("",!0)]),_:1},8,["columns","data-source","pagination"])]))]),_:1})]),l(Ll,{open:ie.open,"onUpdate:open":e[22]||(e[22]=a=>ie.open=a),"confirm-loading":ie.confirmLoading,maskClosable:!1,title:"上传文档",onOk:ms,onCancel:fs,width:"740px"},{default:s(()=>[l(Sl,{class:"mt24"},{default:s(()=>[l(ct,{required:"",label:""},{default:s(()=>[t("div",qr,[l(ts,{type:P.value.type,maxCount:20,value:ie.fileList,"onUpdate:value":e[21]||(e[21]=a=>ie.fileList=a),onChange:vs},null,8,["type","value"])])]),_:1}),ul.value?(n(),x(ct,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:s(()=>[t("div",Dr,[(n(),u(B,null,he(Y,a=>t("div",{key:a.key,class:ve(["select-card-item",{active:ie.pdf_parse_type==a.key},{disabled:a.key==4&&!G.value}]),onClick:ne(d=>hs(a),["stop"])},[l(i,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Mr,[l(i,{name:a.icon,style:{"font-size":"16px"}},null,8,["name"]),y(" "+v(a.title)+" ",1),a.key==4&&!G.value?(n(),u("div",Rr,"未开启")):f("",!0)]),t("div",Ir,v(a.desc),1),a.key==4&&!G.value?(n(),u("div",Ur,[e[91]||(e[91]=y(" 未开启阿里云OCR ",-1)),t("div",{class:"card-switch-btn",onClick:ne(ks,["stop"])},"去开启")])):f("",!0)],10,Or)),64))])]),_:1})):f("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),l(ls,{onOk:pe,ref_key:"qaUploadModalRef",ref:rl},null,512),l(Ll,{open:Z.open,"onUpdate:open":e[26]||(e[26]=a=>Z.open=a),"confirm-loading":Z.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:_s,onCancel:cs},{default:s(()=>[l(Sl,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:il,model:Z,rules:Z.rules},{default:s(()=>[l(ct,{name:"urls",label:"网页链接"},{default:s(()=>[l(Ts,{style:{height:"120px"},value:Z.urls,"onUpdate:value":e[23]||(e[23]=a=>Z.urls=a),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),l(ct,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:s(()=>[l(Cl,{value:Z.doc_auto_renew_frequency,"onUpdate:value":e[24]||(e[24]=a=>Z.doc_auto_renew_frequency=a),style:{width:"100%"}},{default:s(()=>[l(je,{value:1},{default:s(()=>[...e[92]||(e[92]=[y("不自动更新",-1)])]),_:1}),l(je,{value:2},{default:s(()=>[...e[93]||(e[93]=[y("每天",-1)])]),_:1}),l(je,{value:3},{default:s(()=>[...e[94]||(e[94]=[y("每3天",-1)])]),_:1}),l(je,{value:4},{default:s(()=>[...e[95]||(e[95]=[y("每7天",-1)])]),_:1}),l(je,{value:5},{default:s(()=>[...e[96]||(e[96]=[y("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),Z.doc_auto_renew_frequency>1?(n(),x(ct,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[l(Fs,{valueFormat:"HH:mm",value:Z.doc_auto_renew_minute,"onUpdate:value":e[25]||(e[25]=a=>Z.doc_auto_renew_minute=a),format:"HH:mm"},null,8,["value"])]),_:1})):f("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),l(ga,{libraryInfo:P.value,group_id:m.value,onOk:$e,ref_key:"addCustomDocumentRef",ref:al},null,8,["libraryInfo","group_id"]),l(To,{onOk:$e,ref_key:"renameModalRef",ref:dl},null,512),l(Fo,{onOk:gs,ref_key:"openGrapgModalRef",ref:c},null,512),l(Ca,{ref_key:"guideLearningTipsRef",ref:r},null,512),l($a,{onOk:pe,ref_key:"editOnlineDocRef",ref:fl},null,512),l(ss,{group_type:"1",ref_key:"addGroupRef",ref:ml,onOk:Lt},null,512),l(li,{libraryId:b.value,sense:1,ref_key:"editGroupRef",ref:yl,onOk:Lt},null,8,["libraryId"]),l(ai,{ref_key:"feishuRef",ref:W,libraryId:b.value,onOk:Lt},null,8,["libraryId"]),l(es,{ref_key:"metaRef",ref:xl,"library-id":b.value,onChange:Lt},null,8,["library-id"])])}}},Qr=Me(zr,[["__scopeId","data-v-e35fec04"]]);export{Qr as K,jr as Q};
