import{b as L,d as H,ac as Q}from"../../index-CuuB1UbP.js";import{aa as W,f,o as X,Y as l,_ as a,a1 as D,k as i,F as w,a9 as B,a5 as e,a7 as d,G as S,ae as U,B as M,r as Z,e as pe,a2 as g,u as K,l as ee,ab as ve,ad as Y}from"./vue-chunks-Ci-XTWEs.js";import{E as te}from"./empty-box-DwDQI8pT.js";import{c as fe,a as ne,s as G,b as se,r as he,u as me,d as ge,o as ke,e as ye}from"./index-Dmsgh_44.js";import{L as ae}from"./loading-box-B5mKot5H.js";import{U as oe}from"./update-modal-D5dh9lJC.js";import{x as le,au as $e,a8 as be,B as ie,z as Ce,ao as xe,aw as Pe,k as we,F as De,e as Re,I as ce,M as E,a as q,X as Oe,T as Ie}from"./ui-antd-DhoCz7ZP.js";import{_ as Se}from"./tool-icon-IWVrYlVb.js";import{_ as Te}from"./no-permission-DtJ3NYHG.js";import{_ as Ae}from"./main-tab-rgBCXMFa.js";import"./utils-ChQO-_r6.js";import"./empty-BFmzY9bl.js";import"./list-tabs-9JfQ5j74.js";const Me={class:"_plugin-box"},ze={key:1,class:"plugin-list"},Be=["onClick"],Ue={class:"type-tag"},qe={class:"base-info"},je=["src"],Ne={class:"info"},Ee={class:"head"},Fe={class:"name zm-line1"},Le={class:"source"},Ve={class:"desc zm-line1"},Je={class:"version"},Ge={class:"action-box"},Ke={class:"left"},Xe={class:"right"},Ye=["href"],He=["onClick"],Qe={key:1},We=["onClick"],Ze={__name:"remotePlugins",props:{filterData:{type:Object,default:null}},emits:["installReport"],setup(j,{expose:T,emit:R}){const $=R,h=j,v=W(),m=f(null),C=f(!0),k=f([]),c=f({});X(()=>{P()});function O(){k.value=[],P()}async function P(){C.value=!0,await A(),fe(h.filterData).then(_=>{let b=(_==null?void 0:_.data)||[];b.forEach(n=>{var t;let{local:o,has_update:s}=((t=c.value)==null?void 0:t[n.name])||{};n.local=o,n.has_update=s}),k.value=b}).finally(()=>{C.value=!1})}async function A(){await ne().then(_=>{let b=(_==null?void 0:_.data)||[];$("installReport",b.length);let n={};b.forEach(o=>{n[o.local.name]={local:o.local,has_update:o.remote.latest_version!=o.local.version}}),c.value=n})}function r(_){v.push({path:"/plugins/detail",query:{name:_.name}})}function x(_){m.value.show(_,_.latest_version_detail,_.local||null)}return T({search:O}),(_,b)=>{const n=H,o=le;return a(),l("div",Me,[C.value?(a(),D(ae,{key:0})):k.value.length?(a(),l("div",ze,[(a(!0),l(w,null,B(k.value,s=>(a(),l("div",{onClick:t=>r(s),key:s.name,class:"plugin-item"},[e("div",Ue,d(s.filter_type_title),1),e("div",qe,[e("img",{class:"avatar",src:s.icon},null,8,je),e("div",Ne,[e("div",Ee,[e("span",Fe,d(s.title),1)]),e("div",Le,d(s.author),1)])]),e("div",Ve,d(s.description),1),e("div",Je,"版本：v"+d(s.latest_version),1),e("div",Ge,[e("div",Ke,[i(n,{name:"download"}),S(" "+d(s.installed_count||0),1)]),e("div",Xe,[s.help_url?(a(),l(w,{key:0},[e("a",{onClick:b[0]||(b[0]=M(()=>{},["stop"])),class:"c595959",href:s.help_url,target:"_blank"},"使用说明",8,Ye),i(o,{type:"vertical"})],64)):U("",!0),s.local?(a(),l(w,{key:1},[s.has_update?(a(),l("a",{key:0,onClick:M(t=>x(s),["stop"])},"更新",8,He)):(a(),l("span",Qe,"已安装"))],64)):(a(),l("a",{key:2,onClick:M(t=>x(s),["stop"])},"安装",8,We))])])],8,Be))),128))])):(a(),D(te,{key:2,title:"暂无可用插件"})),i(oe,{ref_key:"updateRef",ref:m,onOk:P},null,512)])}}},et=L(Ze,[["__scopeId","data-v-eb3d4766"]]),tt={class:"head-box"},nt={class:"base-info-box"},st=["src"],at={class:"info-box"},ot={class:"left"},lt={class:"name zm-line1"},it={class:"right"},ct={class:"link"},ut={class:"tools-box"},dt={class:"info"},_t={class:"tit zm-line1"},rt={class:"btns"},pt=["onClick"],vt=["onClick"],ft={class:"body-box"},ht={key:0,class:"no-auth-box"},mt={key:1,class:"action-box"},gt={class:"tit"},kt={class:"desc"},yt={class:"params"},$t={class:"params-box"},bt={class:"field"},Ct={class:"name"},xt={class:"type"},Pt={key:0,class:"required"},wt={class:"desc"},Dt={__name:"feishu-config-box",emits:["del","edit","auth"],setup(j,{expose:T,emit:R}){const $=f(!1),h=f({}),v=f({}),m=f({}),C=f(!1),k=f(!1),c=Z({}),O=pe(()=>Object.keys(v.value).length);function P(s){h.value=s,r(),x(),$.value=!0}function A(){$.value=!1}function r(){se({name:h.value.name}).then(s=>{v.value=Q(s==null?void 0:s.data,{})})}function x(){he({name:h.value.name,action:"default/get-schema",params:{}}).then(s=>{let t=(s==null?void 0:s.data)||{};for(let y in t)t[y].type!="node"&&delete t[y];m.value=t})}function _(){Object.assign(c,{name:"",appid:"",app_secret:"",is_default:!1}),(!v.value||!Object.keys(v.value).length)&&(c.is_default=!0),C.value=!0}function b(s,t){for(let y in v.value)v.value[y].is_default=y==t;G({name:h.value.name,data:JSON.stringify(v.value)}).then(y=>{r()})}function n(s,t){E.confirm({title:"提示",content:"确认删除该配置？",onOk:()=>{delete v.value[t],G({name:h.value.name,data:JSON.stringify(v.value)}).then(y=>{r(),q.success("已删除")})}})}function o(){try{if(k.value=!0,!c.name)throw"请输入凭证名称";if(v.value[c.name])throw"凭证名称已存在";if(!c.appid)throw"请输入APP ID";if(!c.app_secret)throw"请输入APP Secret";G({name:h.value.name,data:JSON.stringify({...v.value,[c.name]:c})}).then(s=>{C.value=!1,r(),q.success("已保存")}).finally(()=>{k.value=!1})}catch(s){k.value=!1,q.error(s)}}return T({show:P,hide:A}),(s,t)=>{const y=xe,u=ie,I=be,ue=Pe,de=we,V=ce,J=Re,_e=De,re=E;return a(),l("div",null,[i(ue,{open:$.value,"onUpdate:open":t[1]||(t[1]=p=>$.value=p),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:g(()=>[e("div",tt,[e("div",nt,[e("img",{class:"avatar",src:h.value.icon},null,8,st),e("div",at,[e("div",ot,[e("div",lt,d(h.value.title),1),e("div",null,d(h.value.author),1)]),e("div",it,[i(K($e),{onClick:t[0]||(t[0]=p=>$.value=!1),class:"icon"})])])]),e("div",ct,d(h.value.description),1),O.value>0?(a(),D(I,{key:0,placement:"bottom"},{content:g(()=>[e("div",ut,[(a(!0),l(w,null,B(v.value,(p,N)=>(a(),l("div",{key:N,class:"tool-item"},[t[7]||(t[7]=e("img",{class:"cover",src:Se},null,-1)),e("div",dt,[e("div",_t,d(p.name),1),e("div",rt,[p.is_default?(a(),D(y,{key:0,color:"#f50"},{default:g(()=>t[6]||(t[6]=[S("默认")])),_:1,__:[6]})):(a(),l("a",{key:1,onClick:z=>b(p,N)},"设为默认",8,pt)),e("a",{onClick:z=>n(p,N)},"删除",8,vt)])])]))),128))])]),default:g(()=>[i(u,{type:"primary",icon:ee(K(Ce)),class:"auth-btn",onClick:_},{default:g(()=>[S(" 已授权"+d(O.value)+"个凭证 ",1)]),_:1},8,["icon"])]),_:1})):(a(),D(u,{key:1,type:"primary",class:"auth-btn",onClick:_},{default:g(()=>t[8]||(t[8]=[S("立即授权")])),_:1,__:[8]}))]),e("div",ft,[O.value?(a(),l("div",mt,[(a(!0),l(w,null,B(m.value,(p,N)=>(a(),l("div",{key:N,class:"action-item"},[e("div",gt,d(p.title),1),e("div",kt,d(p.desc),1),e("div",yt,[(a(!0),l(w,null,B(Object.keys(p.params).slice(0,3),(z,F)=>(a(),D(y,{key:F,bordered:!1},{default:g(()=>[S(d(z),1)]),_:2},1024))),128)),i(I,{placement:"right"},{content:g(()=>[e("div",$t,[(a(!0),l(w,null,B(p.params,(z,F)=>(a(),l("div",{key:F,class:"param-item"},[e("div",bt,[e("span",Ct,d(F),1),e("span",xt,d(z.type),1),z.required?(a(),l("span",Pt,"必填")):U("",!0)]),e("div",wt,d(z.desc),1)]))),128))])]),default:g(()=>[t[12]||(t[12]=e("a",null,"参数",-1))]),_:2,__:[12]},1024)])]))),128))])):(a(),l("div",ht,[t[9]||(t[9]=e("img",{src:Te},null,-1)),t[10]||(t[10]=e("div",{class:"tit"},"需要授权",-1)),t[11]||(t[11]=e("div",{class:"desc"},"授权后，配置将显示在这里",-1)),e("a",{class:"link",onClick:_},"立即授权")]))])]),_:1},8,["open"]),i(re,{open:C.value,"onUpdate:open":t[5]||(t[5]=p=>C.value=p),"confirm-loading":k.value,title:"API Key授权配置",width:"620px",onOk:o},{default:g(()=>[i(de,{type:"info","show-icon":"",message:"配置凭据后，工作流可直接调用此插件"}),i(_e,{class:"mt16",model:c,"label-col":{span:4},"wrapper-col":{span:20}},{default:g(()=>[i(J,{label:"凭证名称",name:"name",rules:[{required:!0,message:"请输入凭证名称!"}]},{default:g(()=>[i(V,{value:c.name,"onUpdate:value":t[2]||(t[2]=p=>c.name=p),valueModifiers:{trim:!0},maxlength:16,placeholder:"请输入凭证名称"},null,8,["value"]),t[13]||(t[13]=e("div",{class:"tip-desc"},"仅用于区分多个授权配置的名称，不用于接口调用",-1))]),_:1,__:[13]}),i(J,{label:"APP ID",name:"appid",rules:[{required:!0,message:"请输入APP ID!"}]},{default:g(()=>[i(V,{value:c.appid,"onUpdate:value":t[3]||(t[3]=p=>c.appid=p),valueModifiers:{trim:!0},placeholder:"请输入APP ID"},null,8,["value"])]),_:1}),i(J,{label:"APP Secret",name:"app_secret",rules:[{required:!0,message:"请输入APP Secret!"}]},{default:g(()=>[i(V,{value:c.app_secret,"onUpdate:value":t[4]||(t[4]=p=>c.app_secret=p),valueModifiers:{trim:!0},placeholder:"请输入APP Secret"},null,8,["value"]),t[14]||(t[14]=e("div",{class:"tip-desc"},"如何获取APP ID和APP Secret",-1))]),_:1,__:[14]})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},Rt=L(Dt,[["__scopeId","data-v-25612f86"]]),Ot={class:"_plugin-box"},It={key:1,class:"plugin-list"},St=["onClick"],Tt={class:"type-tag"},At={class:"base-info"},Mt=["src"],zt={class:"info"},Bt={class:"head"},Ut={class:"name zm-line1"},qt={class:"source"},jt={class:"desc zm-line1"},Nt={class:"version"},Et={key:0,class:"tag"},Ft={class:"action-box"},Lt={class:"right"},Vt=["onClick"],Jt=["href"],Gt=["onClick"],Kt=["onClick"],Xt={class:"text-center mt24"},Yt={__name:"installPlugins",props:{filterData:{type:Object,default:null}},emits:["installReport","tabChange"],setup(j,{expose:T,emit:R}){const $=R,h=j,v=W(),m=f(null),C=f(null),k=f(!0),c=f([]);X(()=>{P()});function O(){c.value=[],P()}function P(){k.value=!0,ne(h.filterData).then(n=>{let o=(n==null?void 0:n.data)||[];$("installReport",o.length),o=o.map(s=>{var t,y;return{...s.remote,local:s.local,has_update:((t=s.remote)==null?void 0:t.latest_version)!=((y=s.local)==null?void 0:y.version),installing:!1}}),c.value=o}).finally(()=>{k.value=!1})}async function A(n){const o=()=>n.local.has_loaded=!n.local.has_loaded;if(!n.local.has_loaded)E.confirm({title:"确认关闭该插件？",content:"关闭后，其他应用的位置都不可使用！确认关闭？",okText:"确定",cancelText:"取消",onOk:()=>{ge({name:n.name}).then(()=>{q.success("已关闭")}).catch(o)},onCancel:o});else{if(n.name=="feishu_bitable"){let{data:s}=await se({name:n.name});if(s=Q(s,{}),!Object.keys(s).length)return o(),E.confirm({title:"授权飞书应用接口权限",content:ee("div",{style:{color:" red"}},"请先完成信息配置，获取接口权限"),okText:"确定",cancelText:"取消",onOk:()=>{r(n)}})}ke({name:n.name}).then(()=>{q.success("已开启")}).catch(o)}}function r(n){C.value.show(n)}function x(n){E.confirm({title:"确认删除该插件？",content:"删除后，其他应用的位置都不可使用！确认删除？",okText:"确定",cancelText:"取消",onOk:()=>{me({name:n.name}).then(()=>{q.success("已删除"),P()})}})}function _(n){v.push({path:"/plugins/detail",query:{name:n.name}})}function b(n){m.value.show(n,n.latest_version_detail,n.local)}return T({search:O}),(n,o)=>{const s=Oe,t=le,y=ie;return a(),l("div",Ot,[k.value?(a(),D(ae,{key:0})):c.value.length?(a(),l("div",It,[(a(!0),l(w,null,B(c.value,u=>(a(),l("div",{onClick:I=>_(u),key:u.name,class:"plugin-item"},[e("div",Tt,d(u.filter_type_title),1),e("div",At,[e("img",{class:"avatar",src:u.icon},null,8,Mt),e("div",zt,[e("div",Bt,[e("span",Ut,d(u.title),1)]),e("div",qt,d(u.author),1)])]),e("div",jt,d(u.description),1),e("div",Nt,[S("版本：v"+d(u.local.version)+" ",1),u.has_update?(a(),l("span",Et,"有更新")):U("",!0)]),e("div",Ft,[e("div",{class:"left",onClick:o[0]||(o[0]=M(()=>{},["stop"]))},[i(s,{checked:u.local.has_loaded,"onUpdate:checked":I=>u.local.has_loaded=I,onChange:I=>A(u)},null,8,["checked","onUpdate:checked","onChange"])]),e("div",Lt,[e("span",{class:"zm-link-pointer",onClick:M(I=>x(u),["stop"])},"删除",8,Vt),u.help_url?(a(),l(w,{key:0},[i(t,{type:"vertical"}),e("a",{onClick:o[1]||(o[1]=M(()=>{},["stop"])),class:"c595959",href:u.help_url,target:"_blank"},"使用说明",8,Jt)],64)):U("",!0),u.name=="feishu_bitable"?(a(),l(w,{key:1},[i(t,{type:"vertical"}),e("a",{onClick:M(I=>r(u),["stop"])},"配置",8,Gt)],64)):U("",!0),u.has_update?(a(),l(w,{key:2},[i(t,{type:"vertical"}),e("a",{onClick:M(I=>b(u),["stop"])},"更新",8,Kt)],64)):U("",!0)])])],8,St))),128))])):(a(),D(te,{key:2,title:"暂未安装插件"},{desc:g(()=>[o[4]||(o[4]=e("div",null,[S("更多功能可到 "),e("a",null,"探索>插件广场"),S(" 中去添加")],-1)),e("div",Xt,[i(y,{class:"btn",type:"primary",onClick:o[2]||(o[2]=u=>$("tabChange",3))},{default:g(()=>o[3]||(o[3]=[S("去添加")])),_:1,__:[3]})])]),_:1})),i(oe,{ref_key:"updateRef",ref:m,onOk:P},null,512),i(Rt,{ref_key:"feishuRef",ref:C},null,512)])}}},Ht=L(Yt,[["__scopeId","data-v-ecee2f6e"]]),Qt={class:"_container"},Wt={class:"header"},Zt={class:"main-tab-box"},en={class:"content"},tn={class:"filter-box"},nn={class:"radio-tabs"},sn=["onClick"],an=["src"],on={__name:"index",setup(j){const T=ve(),R=f(null),$=f(null),h=f(localStorage.getItem("zm:explore:active")||"2"),v=f([]),m=Z({title:"",filter_type:0});X(()=>{T.query.active>1&&R.value.change(T.query.active),C()});function C(){ye().then(r=>{v.value=(r==null?void 0:r.data)||[]})}function k(){$.value.search()}function c(r){m.filter_type=r,k()}function O(r){r>1&&(h.value=r)}function P(r){R.value.change(r)}function A(){R.value.update()}return(r,x)=>{const _=H,b=ce;return a(),l("div",Qt,[e("div",Wt,[e("div",Zt,[i(Ae,{ref_key:"tabRef",ref:R,onChange:O},null,512)])]),e("div",en,[e("div",tn,[e("div",nn,[e("div",{onClick:x[0]||(x[0]=n=>c(0)),class:Y(["radio-tab",{active:m.filter_type==0}])},[i(_,{name:"icon-all"}),x[2]||(x[2]=e("span",null,"全部",-1))],2),(a(!0),l(w,null,B(v.value,n=>(a(),l("div",{onClick:o=>c(n.id),key:n.id,class:Y(["radio-tab",{active:n.id==m.filter_type}])},[e("img",{class:"icon",src:n.id==m.filter_type?n.icon_active_path:n.icon_path},null,8,an),e("span",null,d(n.type_title),1)],10,sn))),128))]),i(b,{value:m.title,"onUpdate:value":x[1]||(x[1]=n=>m.title=n),valueModifiers:{trim:!0},onChange:k,style:{width:"360px"},allowClear:"",placeholder:"搜索插件"},{suffix:g(()=>[i(K(Ie))]),_:1},8,["value"])]),h.value==3?(a(),D(et,{key:0,onInstallReport:A,filterData:m,ref_key:"pluginRef",ref:$},null,8,["filterData"])):(a(),D(Ht,{key:1,onTabChange:P,onInstallReport:A,filterData:m,ref_key:"pluginRef",ref:$},null,8,["filterData"]))])])}}},yn=L(on,[["__scopeId","data-v-8d5dbecc"]]);export{yn as default};
