import{X as ce,r as Y,f as S,d as pe,e as ve,o as oe,Y as p,_ as c,F as X,a1 as Q,ae as K,k as n,a2 as f,G as M,l as he,u as z,a5 as t,n as fe,A as ge,a9 as te,ad as ue,a7 as F,a6 as ye,a3 as ke,w as ne,ao as be,ag as re,b as xe}from"./vue-chunks-yZ4gwLzA.js";import{ah as we,bP as Se,b6 as $e,bQ as Le,j as Ce,d as ie,bR as Ae,b as Z,bB as Ne,bb as ee,F as Ue,au as Re,av as Ie,aw as Me}from"../../index-CuFGOJXl.js";import{W as qe}from"./index-CjPPItip.js";import{u as Te}from"./useEventBus-DbXWCKa0.js";import{M as de}from"./model-select-Bwhjt5Cl.js";import{ai as Be,B as Oe,aw as Fe,J as Ee,p as me,ad as H,H as ze,q as je,R as Ke,W as Ve,aC as Pe,G as Je,M as He,a as ae,I as We,N as Ge,E as Qe,bj as Ye}from"./ui-antd-BKjlZQNA.js";import{M as Xe}from"./index-BMSQkwth.js";import"./utils-smNh_pj2.js";import"./index-DXUrEY-q.js";const Ze=ce("searchStore",{state:()=>({indeterminate:!1,checkAll:!1,checkedList:[],activeKey:"all"}),getters:{getIndeterminate(){return this.indeterminate},getCheckAll(){return this.checkAll},getCheckedList(){return this.checkedList},getActiveKey(){return this.activeKey}},actions:{setIndeterminate(y){this.indeterminate=y},setCheckAll(y){this.checkAll=y},setCheckedList(y){this.checkedList=y},setActiveKey(y){this.activeKey=y}},persist:{enabled:!0,strategies:[{key:"searchStore",storage:localStorage,paths:["indeterminate","checkAll","checkedList","activeKey"]}]}}),_e=ce("search-lirary",()=>{const y=Te(),i=Y({reasoning_content:"",show_reasoning:!1,content:"",quote_file:[],id:"",finish:!1,debug:[],error:[],recall_time:0,request_time:0,loading:!1});let $=null;const q=S(0),L=S(""),U=Y({context_pair:"",create_time:"",id:"",max_token:"",model_config_id:"",rerank_model_config_id:"",rerank_status:"",rerank_use_model:"",search_type:"",similarity:"",size:"",temperature:"",update_time:"",use_model:"",user_id:"",summary_switch:0}),C=(v,o)=>{if(v=="reasoning_content"){let d=i.reasoning_content||"";i.reasoning_content=d+o,i.show_reasoning=!0}if(v=="sending"){let d=i.content||"";i.content=d+o}if(v=="quote_file"&&(i.quote_file=o.length>0?o:[]),v=="ai_message"){if(o.menu_json&&o.msg_type==2){let d=JSON.parse(o.menu_json);i.question=d.question}i.id=o.id,i.content=o.content,o.quote_file&&typeof o.quote_file=="string"&&(i.quote_file=JSON.parse(o.quote_file))}v=="finish"&&(i.finish=!0),v=="debug"&&(i.debug=o.length>0?o:[]),v=="error"&&(i.error=o.length>0?o:[]),v=="recall_time"&&(i.recall_time=o||0),v=="request_time"&&(i.request_time=o||0),y.emit("updateAiMessage",i)},k=()=>{i.loading=!1};return{searchFormState:U,dialogue_id:q,openid:L,messageObj:i,getLibrarySearchFn:async()=>{$&&($.abort(),$=null);const v=await Le();try{let o=v.data;Object.assign(U,{...o})}catch(o){Promise.reject(o)}return v},searchMessage:(v,o,d)=>{we(32),i.content="",i.finish=!1;let T={model_config_id:d.model_config_id,use_model:d.use_model,temperature:d.temperature,max_token:d.max_token,size:d.size,similarity:d.similarity,search_type:d.search_type,question:v,id:o.join(","),recall_type:1,summary_switch:d.summary_switch};d.rerank_status&&(T.rerank_status=d.rerank_status),d.rerank_use_model&&(T.rerank_use_model=d.rerank_use_model),d.prompt&&(T.prompt=d.prompt),d.rerank_status==1&&(T.rerank_model_config_id=d.rerank_model_config_id),$=Se(T),$.onMessage=h=>{if(h.event!=="sending"&&$e(h),h.event=="dialogue_id"&&(q.value=h.data),h.event=="reasoning_content"&&C("reasoning_content",h.data),h.event=="sending"&&C("sending",h.data),h.event=="ai_message"){let w=JSON.parse(h.data);C("ai_message",w)}if(h.event=="quote_file"){let w=JSON.parse(h.data);C("quote_file",w)}if(h.event=="finish"&&C("finish",h.data),h.event=="debug"){let w=JSON.parse(h.data);C("debug",w)}if(h.event=="error"){let w=h.data;C("error",w)}if(h.event=="recall_time"){let w=h.data;C("recall_time",w)}},$.onClose=()=>{k(),$=null}}}}),De={class:"prompt-form"},et={class:"form-item"},tt={class:"form-item-label"},st={class:"prompt-form-item"},at={class:"prompt-form-item"},nt={class:"prompt-form-item-content"},ot={key:0,class:"prompt-form-item-tip"},it={class:"prompt-form-item"},lt={class:"prompt-form-item-label"},rt={class:"form-item-body"},dt={class:"number-box"},ct={class:"number-slider-box"},ut={class:"number-input-box"},mt={class:"prompt-form-item"},_t={class:"prompt-form-item-label"},pt={class:"form-item-body"},vt={class:"number-box"},ht={class:"number-slider-box"},ft={class:"number-input-box"},gt={class:"recall-settings-box"},yt={class:"form-box prompt-form"},kt={class:"form-item is-required"},bt={class:"form-item-body"},xt={class:"retrieval-mode-items"},wt=["onClick"],St={class:"retrieval-mode-title"},$t={class:"title-text"},Lt={class:"retrieval-mode-desc"},Ct={key:0,class:"form-item"},At={class:"form-item"},Nt={class:"form-item-label"},Ut={class:"form-item-body"},Rt={class:"number-box"},It={class:"number-slider-box"},Mt={class:"number-input-box"},qt={key:1,class:"form-item"},Tt={class:"form-item-label"},Bt={class:"form-item-body"},Ot={class:"number-box"},Ft={class:"number-slider-box"},Et={class:"number-input-box"},zt={class:"form-item"},jt={class:"form-item-label"},Kt={key:0,class:"form-item-body"},Vt=pe({__name:"search-drawer",setup(y){let{role_permission:i,role_type:$}=Ce();const q=ve(()=>$==1||i.includes("SearchSets")),L=_e(),{getLibrarySearchFn:U}=L,C=S([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),k=S(!1),s=Y({use_model:"",model_config_id:"",prompt_type:"0",prompt:"",temperature:.5,max_token:2e3,context_pair:0,search_type:1,top_k:5,size:0,similarity:.4,rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,summary_switch:0,rrf_weight:{}}),V=()=>{b()},v=S([]),o=x=>{if(v.value=x,(!s.model_config_id||!s.use_model)&&v.value.length>0){let e=v.value[0];if(e){let R=e.children[0];s.use_model=R.name,s.model_config_id=R.model_config_id}}},d=x=>{s.search_type=x,b()},T=x=>{let e={...x};e.max_token=parseFloat(e.max_token),e.temperature=parseFloat(e.temperature),e.context_pair=parseFloat(e.context_pair),e.search_type=parseFloat(e.search_type),e.rerank_status=parseFloat(e.rerank_status),e.similarity=parseFloat(e.similarity),e.top_k=parseFloat(e.size),e.summary_switch=+e.summary_switch,e.rerank_use_model===""&&(e.rerank_use_model=void 0),e.rrf_weight=e.rrf_weight?JSON.parse(e.rrf_weight):e.rrf_weight,Object.keys(e).forEach(R=>{s[R]=e[R]})},u=((x,e)=>{let R;return function(...g){const N=()=>{clearTimeout(R),x(...g)};clearTimeout(R),R=setTimeout(N,e)}})(()=>{b()},500),b=()=>{let x={...s};if(!x.prompt&&s.prompt_type=="1")return ae.error("请输入自定义提示词");x.rrf_weight=JSON.stringify(s.rrf_weight),(s.search_type==3||s.search_type==4)&&delete x.similarity,s.prompt_type=="0"&&delete x.prompt,x.size=x.top_k,Ae(x).then(e=>{ae.success("保存成功")})},O=S(!1),l=S(""),m=()=>{s.prompt_type=="1"?(l.value=s.prompt,O.value=!0):b()},B=()=>{if(l.value)s.prompt=l.value,O.value=!1,b();else return ae.error("请输入提示语")},j=()=>{s.prompt_type="0",O.value=!1},W=x=>{},A=async()=>{let x=await U();T(x.data),k.value=!0};return oe(()=>{}),(x,e)=>{const R=Oe,r=me,g=ze,N=Ee,I=Ke,P=je,_=Ve,E=Pe,J=Je,G=ie,le=He,D=Fe;return c(),p(X,null,[q.value?(c(),Q(R,{key:0,onClick:A,icon:he(z(Be))},{default:f(()=>[...e[20]||(e[20]=[M("搜索设置",-1)])]),_:1},8,["icon"])):K("",!0),n(D,{open:k.value,"onUpdate:open":e[19]||(e[19]=a=>k.value=a),class:"custom-class","root-class-name":"root-class-name",title:"搜索设置",width:"472",placement:"right",onAfterOpenChange:W},{default:f(()=>[t("div",De,[e[31]||(e[31]=t("div",{class:"prompt-form-label"},"模型设置",-1)),t("div",et,[t("div",tt,[n(N,{align:"center"},{default:f(()=>[e[22]||(e[22]=t("span",null,"AI智能总结",-1)),n(r,null,{title:f(()=>[...e[21]||(e[21]=[M("开启后，搜索知识库时，由大模型自动总结文档，并给出总结后的结果",-1)])]),default:f(()=>[n(z(H),{class:"question-icon"})]),_:1}),n(g,{style:{"margin-left":"24px"},onChange:b,checked:s.summary_switch,"onUpdate:checked":e[0]||(e[0]=a=>s.summary_switch=a),checkedValue:1,unCheckedValue:0,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})])]),fe(t("div",null,[t("div",st,[e[23]||(e[23]=t("div",{class:"prompt-form-item-label"},[t("span",{style:{color:"red"}},"* "),t("span",null,"模型选择")],-1)),n(de,{modelType:"LLM",modeName:s.use_model,"onUpdate:modeName":e[1]||(e[1]=a=>s.use_model=a),modeId:s.model_config_id,"onUpdate:modeId":e[2]||(e[2]=a=>s.model_config_id=a),style:{width:"100%"},onLoaded:o,onChange:V},null,8,["modeName","modeId"])]),t("div",at,[e[26]||(e[26]=t("div",{class:"prompt-form-item-label"},[t("span",{style:{color:"red"}},"* "),t("span",null,"提示词")],-1)),n(P,{value:s.prompt_type,"onUpdate:value":e[3]||(e[3]=a=>s.prompt_type=a),onChange:m},{default:f(()=>[n(I,{value:"0"},{default:f(()=>[...e[24]||(e[24]=[M("默认提示词",-1)])]),_:1}),n(I,{value:"1"},{default:f(()=>[...e[25]||(e[25]=[M("自定义提示词",-1)])]),_:1})]),_:1},8,["value"]),t("div",nt,[s.prompt_type=="0"?(c(),p("div",ot," 将提交的内容进行智能总结,不要随意发挥 ")):(c(),Q(_,{key:1,onBlur:b,maxLength:500,style:{height:"80px"},value:s.prompt,"onUpdate:value":e[4]||(e[4]=a=>s.prompt=a),placeholder:"请输入自定义提示词"},null,8,["value"]))])]),t("div",it,[t("div",lt,[e[28]||(e[28]=t("span",null,"温度",-1)),n(r,null,{title:f(()=>[...e[27]||(e[27]=[M("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:f(()=>[n(z(H),{class:"question-icon"})]),_:1})]),t("div",rt,[t("div",dt,[t("div",ct,[n(E,{onBlur:b,class:"custom-slider",value:s.temperature,"onUpdate:value":e[5]||(e[5]=a=>s.temperature=a),min:0,max:2,step:.1},null,8,["value"])]),t("div",ut,[n(J,{onBlur:b,value:s.temperature,"onUpdate:value":e[6]||(e[6]=a=>s.temperature=a),min:0,max:2,step:.1},null,8,["value"])])])])]),t("div",mt,[t("div",_t,[e[30]||(e[30]=t("span",null,"最大token",-1)),n(r,null,{title:f(()=>[...e[29]||(e[29]=[t("div",null,"问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:f(()=>[n(z(H),{class:"question-icon"})]),_:1})]),t("div",pt,[t("div",vt,[t("div",ht,[n(E,{onBlur:b,class:"custom-slider",value:s.max_token,"onUpdate:value":e[7]||(e[7]=a=>s.max_token=a),min:0,max:100*1024},null,8,["value"])]),t("div",ft,[n(J,{onBlur:b,value:s.max_token,"onUpdate:value":e[8]||(e[8]=a=>s.max_token=a),min:0,max:100*1024},null,8,["value"])])])])])],512),[[ge,s.summary_switch==1]])]),t("div",gt,[t("div",yt,[e[39]||(e[39]=t("div",{class:"prompt-form-label"},"召回设置",-1)),t("div",kt,[e[32]||(e[32]=t("div",{class:"form-item-label"},[t("span",null,"检索模式")],-1)),t("div",bt,[t("div",xt,[(c(!0),p(X,null,te(C.value,a=>(c(),p("div",{class:ue(["retrieval-mode-item",{active:s.search_type==a.value}]),key:a.value,onClick:se=>d(a.value)},[s.search_type==a.value?(c(),Q(G,{key:0,class:"check-arrow",name:"check-arrow-filled"})):K("",!0),t("div",St,[n(G,{name:a.iconName,class:"title-icon"},null,8,["name"]),t("span",$t,F(a.title),1),a.isRecommendation?(c(),Q(G,{key:0,class:"recommendation-icon",name:"recommendation"})):K("",!0)]),t("div",Lt,F(a.desc),1)],10,wt))),128))])])]),s.search_type==1?(c(),p("div",Ct,[n(qe,{onSave:z(u),rrf_weight:s.rrf_weight,"onUpdate:rrf_weight":e[9]||(e[9]=a=>s.rrf_weight=a)},null,8,["onSave","rrf_weight"])])):K("",!0),t("div",At,[t("div",Nt,[e[34]||(e[34]=t("span",null,"Top K ",-1)),n(r,null,{title:f(()=>[...e[33]||(e[33]=[M("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:f(()=>[n(z(H),{class:"question-icon"})]),_:1})]),t("div",Ut,[t("div",Rt,[t("div",It,[n(E,{onBlur:b,class:"custom-slider",value:s.top_k,"onUpdate:value":e[10]||(e[10]=a=>s.top_k=a),min:1,max:500},null,8,["value"])]),t("div",Mt,[n(J,{onBlur:b,value:s.top_k,"onUpdate:value":e[11]||(e[11]=a=>s.top_k=a),min:1,max:500},null,8,["value"])])])])]),s.search_type!=3&&s.search_type!=4?(c(),p("div",qt,[t("div",Tt,[e[36]||(e[36]=t("span",null,"相似度阈值 ",-1)),n(r,null,{title:f(()=>[...e[35]||(e[35]=[M("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:f(()=>[n(z(H),{class:"question-icon"})]),_:1})]),t("div",Bt,[t("div",Ot,[t("div",Ft,[n(E,{onBlur:b,class:"custom-slider",value:s.similarity,"onUpdate:value":e[12]||(e[12]=a=>s.similarity=a),min:0,max:1,step:.01},null,8,["value"])]),t("div",Et,[n(J,{onBlur:b,value:s.similarity,"onUpdate:value":e[13]||(e[13]=a=>s.similarity=a),min:0,max:1,step:.01},null,8,["value"])])])])])):K("",!0),t("div",zt,[t("div",jt,[e[38]||(e[38]=t("span",null,"Rerank模型 ",-1)),n(r,null,{title:f(()=>[...e[37]||(e[37]=[M("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:f(()=>[n(z(H),{class:"question-icon"})]),_:1}),n(g,{onChange:b,style:{float:"right"},checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":e[14]||(e[14]=a=>s.rerank_status=a),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),s.rerank_status==1?(c(),p("div",Kt,[n(de,{modelType:"RERANK",modeName:s.rerank_use_model,"onUpdate:modeName":e[15]||(e[15]=a=>s.rerank_use_model=a),modeId:s.rerank_model_config_id,"onUpdate:modeId":e[16]||(e[16]=a=>s.rerank_model_config_id=a),style:{width:"100%"},placeholder:"请选择Rerank模型",onChange:b},null,8,["modeName","modeId"])])):K("",!0)])])]),n(le,{open:O.value,"onUpdate:open":e[18]||(e[18]=a=>O.value=a),onCancel:j,title:"请输入自定义提示词",onOk:B},{default:f(()=>[n(_,{value:l.value,"onUpdate:value":e[17]||(e[17]=a=>l.value=a),placeholder:"请输入",style:{"min-height":"300px"},"allow-clear":""},null,8,["value"])]),_:1},8,["open"])]),_:1},8,["open"])],64)}}}),Pt=Z(Vt,[["__scopeId","data-v-df5025b6"]]),Jt={class:"no-data"},Ht={class:"no-data-text"},Wt={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(y){const i=y;return($,q)=>{const L=ie;return c(),p("div",Jt,[n(L,{name:"empty-document",style:ye({"font-size":`${i.size}px`,color:"white"})},null,8,["style"]),t("div",Ht,[ke($.$slots,"default",{},()=>[M(F(i.text),1)],!0)])])}}},Gt=Z(Wt,[["__scopeId","data-v-f4fa2763"]]),Qt={class:"search-box-warpper"},Yt={class:"search-box-content"},Xt={class:"search-set-box"},Zt={key:0,class:"search-content"},Dt={class:"search-input-box"},es={key:1,class:"search-content search-main"},ts={class:"search-input-box"},ss={key:1,class:"search-content-box"},as={class:"search-tip-box"},ns={key:0,class:"tip"},os={key:1,class:"tip complete"},is={key:0,class:"container"},ls={key:1,class:"intelligent-answer"},rs=["innerHTML"],ds={key:1},cs={class:"section-box"},us={key:0,class:"section-label"},ms={class:"section-item-nav"},_s={class:"section-item-nav-left"},ps=["onClick"],vs={key:0},hs={class:"section-item-nav-right"},fs=["innerHTML"],gs={__name:"search-box",props:{librarySearchData:{type:Object,default:null},messageObj:{type:Object,default:null},library_ids:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1}},emits:["search","defaultParmas"],setup(y,{expose:i,emit:$}){const q=$,L=y,U=new Xe({html:!0,linkify:!0,typographer:!0}),C=S(""),k=S(""),s=S(!1),V=S(!1),v=S({});ne(()=>L.messageObj.content,()=>{C.value=U.render(L.messageObj.content)}),ne(()=>L.messageObj.error,l=>{l&&ee(l)});const o=async()=>{if(!L.library_ids.length)return ee("请在左侧的知识库选择项内至少选择一个知识库");if(!k.value)return ee("请输入消息内容");q("search",k.value),s.value=!0};function d(l){return l.match(/^-?\d+(?:\.\d{0,2})?/)[0]}const T=(l,m)=>{if(!l||!m.trim())return l;const B=m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),j=new RegExp(`(${B})`,"gi");return l.replace(j,'<span class="highlight">$1</span>')},h=l=>{if(!l.file_name){window.open(`#/library/details/categary-manage?id=${l.library_id}`);return}window.open(`#/library/preview?id=${l.file_id}`)},w=S(L.librarySearchData),u=Y({rerank_status:"",rerank_use_model:"",prompt:"",model_config_id:"",use_model:"",temperature:.5,max_token:2e3,similarity:.4,search_type:1,summary_switch:0}),b=S({}),O=l=>{w.value=l;let m={model_config_id:l.model_config_id||u.model_config_id,use_model:l.use_model||u.use_model,temperature:l.temperature||u.temperature,max_token:l.max_token||u.max_token,size:200,similarity:l.similarity||u.similarity,search_type:l.search_type||u.search_type,summary_switch:l.summary_switch||u.summary_switch,question:k.value,id:L.library_ids.join(","),recall_type:1,rrf_weight:l.rrf_weight};l.rerank_status&&(m.rerank_status=l.rerank_status),l.rerank_use_model&&(m.rerank_use_model=l.rerank_use_model),l.prompt&&(m.prompt=l.prompt),l.rerank_status==1&&(m.rerank_model_config_id=l.rerank_model_config_id),V.value=!0,b.value=Object.assign(m),q("defaultParmas",b.value),Ne(m).then(B=>{v.value=B.data}).catch(()=>{}).finally(()=>{V.value=!1})};return oe(async()=>{}),i({handleRecallTest:O}),(l,m)=>{const B=ie,j=We,W=me;return c(),p("div",Qt,[t("div",Yt,[t("div",Xt,[n(Pt)]),s.value?(c(),p("div",es,[t("div",ts,[n(j,{class:"search-input",onPressEnter:o,value:k.value,"onUpdate:value":m[1]||(m[1]=A=>k.value=A),"allow-clear":"",placeholder:"输入关键词搜索"},{suffix:f(()=>[t("div",{class:"search-icon-box",onClick:o},[n(B,{class:"search-icon",name:"search-right"})])]),_:1},8,["value"])]),!C.value&&y.messageObj.finish&&!v.value.length?(c(),Q(Gt,{key:0,style:{"margin-top":"100px"},size:"250"},{default:f(()=>[...m[4]||(m[4]=[t("div",null,[t("p",{style:{color:"#262626","font-size":"16px","font-weight":"600","line-height":"24px"}},"暂无任何内容")],-1)])]),_:1})):(c(),p("div",ss,[t("div",as,[n(B,{class:"nav-icon",name:"search-tip"}),y.messageObj.finish?(c(),p("span",os,"智能回答生成完毕")):(c(),p("span",ns,"智能回答生成中..."))]),!y.messageObj.content&&!y.messageObj.finish&&!y.isError?(c(),p("div",is,[...m[5]||(m[5]=[be('<div class="rect-container rect1" data-v-ed22a746><div class="rect" data-v-ed22a746></div></div><div class="rect-container rect2" data-v-ed22a746><div class="rect" data-v-ed22a746></div></div><div class="rect-container rect3" data-v-ed22a746><div class="rect" data-v-ed22a746></div></div>',3)])])):(c(),p("div",ls,[C.value?(c(),p("div",{key:0,innerHTML:C.value},null,8,rs)):(c(),p("div",ds,"暂无任何内容"))])),t("div",cs,[m[7]||(m[7]=t("div",{class:"tips"},[t("div",{class:"tips-text"},"以上内容由大模型生成"),t("div",{class:"tips-line"})],-1)),v.value.length?(c(),p("div",us,[m[6]||(m[6]=M("相关分段 ",-1)),t("div",null,"("+F(v.value.length)+")",1)])):K("",!0),(c(!0),p(X,null,te(v.value,A=>(c(),p("div",{class:"section-item",key:A.id},[t("div",ms,[t("div",_s,[n(B,{class:"section-item-icon",name:"document"}),t("div",{class:"section-item-label",onClick:x=>h(A)},[M(F(A.file_name),1),A.file_name?K("",!0):(c(),p("span",vs,F(A.library_name)+"-精选",1))],8,ps)]),t("div",hs,"相似度："+F(d(A.similarity)),1)]),n(W,{overlayClassName:"search-content-tip",placement:"top"},{title:f(()=>[M(F(A.content),1)]),default:f(()=>[t("div",{class:"section-item-content",innerHTML:T(A.content,k.value)},null,8,fs)]),_:2},1024)]))),128))])]))])):(c(),p("div",Zt,[m[2]||(m[2]=t("div",{class:"search-label"},"知识搜索",-1)),m[3]||(m[3]=t("div",{class:"search-tip"},"快速搜索所选择的知识库中内容",-1)),t("div",Dt,[n(j,{class:"search-input",onPressEnter:o,value:k.value,"onUpdate:value":m[0]||(m[0]=A=>k.value=A),"allow-clear":"",placeholder:"输入关键词搜索"},{suffix:f(()=>[t("div",{class:"search-icon-box",onClick:o},[n(B,{class:"search-icon",name:"search-right"})])]),_:1},8,["value"])])]))])])}}},ys=Z(gs,[["__scopeId","data-v-ed22a746"]]),ks={class:"cu-tabs"},bs=["onClick"],xs={__name:"contain-tabs",props:{value:{type:[Number,String],required:!0},tabs:{type:Array,required:!0,default:()=>[]}},emits:["update:value","change"],setup(y,{emit:i}){const $=i,q=y,L=U=>{$("update:value",U),$("change",U)};return(U,C)=>(c(),p("div",ks,[(c(!0),p(X,null,te(y.tabs,k=>(c(),p("div",{class:ue(["tab-item",{active:q.value===k.value}]),onClick:s=>L(k.value),key:k.value},F(k.title),11,bs))),128))]))}},ws=Z(xs,[["__scopeId","data-v-a6e0ef08"]]),Ss={class:"chat-monitor-page"},$s={class:"page-left"},Ls={class:"toolbar-box"},Cs={class:"library-checkbox-box"},As={class:"app-list-box"},Ns={class:"list-box",ref:"scrollContainer"},Us={class:"list-item"},Rs={class:"list-item-box"},Is={class:"library-icon"},Ms=["onClick"],qs={class:"page-body"},Ts={__name:"index",setup(y){const i=Ze();let{getIndeterminate:$,getCheckAll:q,getCheckedList:L,getActiveKey:U}=re(i);const C=_e(),{getLibrarySearchFn:k,searchMessage:s}=C,{messageObj:V}=re(C),v=S(null),o=S(null),d=S("all"),T=S([{title:"全部",value:"all"},{title:"普通",value:"0"},{title:"问答",value:"2"}]),h=S({}),w=S([]),u=Y({indeterminate:!1,checkAll:!1,checkedList:[]}),b=r=>{h.value=r},O=S(!1),l=async r=>{var N;O.value=!1;let g=await k();if(o.value=g.data,o.value.id||(o.value=Object.assign(h.value)),o.value,!o.value.model_config_id||!o.value.use_model)return O.value=!0,ee("请在搜索设置中配置好相应配置后再使用");(N=v.value)==null||N.handleRecallTest(o.value),s(r,u.checkedList,o.value)},m=r=>{Object.assign(u,{checkedList:r.target.checked?w.value.map(g=>g.id):[],indeterminate:!!u.checkedList.length&&u.checkedList.length<w.value.length}),i.setCheckedList(u.checkedList),i.setIndeterminate(u.indeterminate)},B=r=>{i.setCheckedList(r)},j=r=>{window.open(`#/library/details/knowledge-document?id=${r}`)};ne(()=>u.checkedList,r=>{u.indeterminate=!!r.length&&r.length<w.value.length,u.checkAll=r.length>=w.value.length,i.setIndeterminate(u.indeterminate),i.setCheckAll(u.checkAll)});const W=()=>{w.value.forEach(r=>{r.type==0,r.type==2}),T.value=[{title:"全部",value:"all"},{title:"普通",value:"0"},{title:"问答",value:"2"}]},A=(r,g)=>{if(g.length===0)return!1;const N=new Set(r);return g.every(I=>N.has(I))},x=(r,g)=>!g.some(N=>r.includes(N)),e=async()=>{let r=d.value==="all"?"":d.value;await Ue({type:r}).then(g=>{var P;let N=g.data||[];N.forEach(_=>{_.file_size_str=Re(_.file_size),_.avatar||(_.avatar=_.type==0?Ie:Me)}),w.value=N;const I=w.value.map(_=>_.id);if((P=L.value)!=null&&P.length&&(I!=null&&I.length)){const _=L.value,E=I,J=A(_,E),G=x(_,E),D=_.length>=E.length&&J,se={checkAll:D,indeterminate:!D&&!G};i.$patch(se),Object.assign(u,se)}else{const _={checkAll:!1,indeterminate:!1};i.$patch(_),Object.assign(u,_)}u.checkedList=L.value,u.indeterminate=$.value,!q.value&&L.value.length==0&&!$.value&&U.value=="all"&&(i.setCheckAll(!0),u.checkedList=I,i.setCheckedList(I)),d.value==="all"&&W()})},R=r=>{i.setActiveKey(r),e()};return oe(async()=>{U.value&&(d.value=U.value),await e();let r=await k();o.value=r.data}),xe(()=>{}),(r,g)=>{const N=Ge,I=Ye,P=Qe;return c(),p("div",Ss,[t("div",$s,[t("div",Ls,[n(ws,{tabs:T.value,value:d.value,"onUpdate:value":g[0]||(g[0]=_=>d.value=_),onChange:R},null,8,["tabs","value"])]),t("div",Cs,[t("div",As,[n(N,{checked:u.checkAll,"onUpdate:checked":g[1]||(g[1]=_=>u.checkAll=_),indeterminate:u.indeterminate,onChange:m},{default:f(()=>[...g[3]||(g[3]=[M(" 全选/取消 ",-1)])]),_:1},8,["checked","indeterminate"])]),n(P,{value:u.checkedList,"onUpdate:value":g[2]||(g[2]=_=>u.checkedList=_),onChange:B},{default:f(()=>[t("div",Ns,[(c(!0),p(X,null,te(w.value,_=>(c(),p("div",{class:"list-item-wraapper",key:_.id},[t("div",Us,[n(N,{value:_.id},null,8,["value"]),t("div",Rs,[t("div",Is,[n(I,{preview:!1,width:32,src:_.avatar},null,8,["src"])]),t("div",{class:"library-name",onClick:E=>j(_.id)},F(_.library_name),9,Ms)])])]))),128))],512)]),_:1},8,["value"])])]),t("div",qs,[n(ys,{ref_key:"searchBoxRef",ref:v,onDefaultParmas:b,onSearch:l,isError:O.value,messageObj:z(V),librarySearchData:o.value,library_ids:u.checkedList},null,8,["isError","messageObj","librarySearchData","library_ids"])])])}}},Js=Z(Ts,[["__scopeId","data-v-23754b52"]]);export{Js as default};
