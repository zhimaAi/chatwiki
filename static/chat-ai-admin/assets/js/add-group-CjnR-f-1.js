import{j as re}from"./index-Btdd0zUd.js";import{j as ne,u as le,O as se,P as ue}from"./index-AgSL8KLK.js";import{f as v,w as ie,ac as O,ad as u,k as d,ar as _,ah as E,ae as w,as as k,u as x,r as V,e as H,o as pe,az as $,af as R,ax as _e,G as de,at as ve,F as me,l as ce,av as fe,aw as ge}from"./vue-chunks-CGLjTDrY.js";import{_ as q,o as be,p as ye}from"../../index-C5-B0r5-.js";import{F as G,a5 as ke,a6 as we,u as he,M as j,b as U,e as xe,I as J,y as Le,z as Ae,$ as Ce,aR as Ie}from"./ui-antd-B11sc9DP.js";import{u as Re}from"./robot-jPE-s270.js";const Oe={class:"avatar-uploader"},Ue=["src"],Fe={key:1},Me=["src"],Pe={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(F,{emit:M}){function C(a){return new Promise((m,I)=>{const s=new FileReader;s.readAsDataURL(a),s.onload=()=>m(s.result),s.onerror=T=>I(T)})}const f=M,g=F,i=v([]),p=v(!1),h=v("");ie(()=>g.value,a=>{h.value=a},{immediate:!0});const P=G.useInjectFormItemContext(),o=()=>{let a={imageUrl:h.value,file:i.value[0].originFileObj};f("change",a),f("update:value",a.imageUrl),P.onFieldChange()},l=a=>a.type==="image/jpeg"||a.type==="image/png"?a.size/1024<100?(i.value=[a],C(a).then(s=>{h.value=s,p.value=!1,o()}),!1):(U.error("机器人头像图片大小不能超过100kb"),!1):(U.error("机器人头像只支持JPG、PNG格式的图片"),!1),b=v(!1),L=v(""),e=v(""),B=()=>{b.value=!1,e.value=""},A=async a=>{!a.url&&!a.preview&&(a.preview=await C(a.originFileObj)),L.value=a.url||a.preview,b.value=!0,e.value=a.name||a.url.substring(a.url.lastIndexOf("/")+1)};return(a,m)=>{const I=he,s=j;return u(),O("div",Oe,[d(I,{"file-list":i.value,"onUpdate:fileList":m[0]||(m[0]=T=>i.value=T),"list-type":g.listType,"show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:A,style:E(g.style)},{default:_(()=>[F.value?(u(),O("img",{key:0,class:"avatar",style:E(g.style),src:F.value,alt:"avatar"},null,12,Ue)):(u(),O("div",Fe,[p.value?(u(),w(x(ke),{key:0})):(u(),w(x(we),{key:1})),m[1]||(m[1]=k("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),d(s,{open:b.value,title:e.value,footer:null,onCancel:B},{default:_(()=>[k("img",{alt:"example",style:{width:"100%"},src:L.value},null,8,Me)]),_:1},8,["open","title"])])}}},W=q(Pe,[["__scopeId","data-v-34012a20"]]),Te={class:"form-box"},Se={class:"robot-avatar-box"},$e={key:0,class:"form-item-tip"},je={__name:"add-robot-alert",emits:["addRobot","editRobot","ok"],setup(F,{expose:M,emit:C}){const f=Re(),g=C;let i="";const p=ge(),h=fe(),P=G.useForm,o=v(!1),l=v(!1),b=v(!1),L=v([]),e=V({robot_name:"",en_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0,group_id:"0"}),B=H(()=>e.application_type==0?o.value?"编辑机器人基本信息":"新建聊天机器人":o.value?"编辑工作流基本信息":"新建工作流"),A=H(()=>f.robotInfo),{getRobot:a}=f,m=V({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}],en_name:[]}),{validate:I,validateInfos:s,clearValidate:T}=P(e,m),z=r=>{e.robot_avatar=r.file},K=()=>{let r={robot_name:e.robot_name,en_name:e.en_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||i,group_id:e.group_id||"0"};b.value=!0;let t=le,c="机器人创建成功";o.value&&(t=se,r.id=p.query.id,c="机器人编辑成功",r.robot_avatar==i&&delete r.robot_avatar),t(r,e.application_type).then(y=>{if(b.value=!1,y.res!=0)return U.error(y.msg);if(U.success(c),!o.value&&p.query.robot_key){g("addRobot"),l.value=!1;return}o.value?(a(p.query.id),g("editRobot"),l.value=!1):e.application_type==0?h.push("/robot/config/basic-config?id="+y.data.id+"&robot_key="+y.data.robot_key):(window.open("/#/robot/config/workflow?id="+y.data.id+"&robot_key="+y.data.robot_key+"&show_tips=1"),l.value=!1,g("ok"))}).catch(()=>{b.value=!1})},Z=async()=>{let r=await re({model_type:"LLM"});return!r||r.data.length==0?(j.confirm({title:"请先添加LLM模型服务商?",icon:ce(Ie,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){h.push("/user/model")},onCancel(){}}),!1):!0},Q=async(r,t)=>{r==0?i=be:i=ye,o.value=t;let c=await Z();Y(),c&&(e.robot_avatar="",e.robot_avatar_url=i,e.robot_name="",e.en_name="",e.robot_intro="",e.application_type=r,l.value=!0,o.value&&A.value&&(e.robot_name=A.value.robot_name,e.en_name=A.value.en_name,e.robot_intro=A.value.robot_intro,e.robot_avatar_url=A.value.robot_avatar_url)),r==0?m.en_name=[]:m.en_name=[{required:!0,message:"请输入工作流名称",trigger:"change"},{validator:async(y,S,D)=>!S||/^[a-zA-Z0-9_\.\-]+$/.test(S)?Promise.resolve():Promise.reject('只能输入英文数字和字符"_"、"."、"-"')}]},X=r=>{e.group_id=r||"0"},Y=()=>{ne().then(r=>{L.value=r.data||[]})},ee=()=>{T()},te=()=>{!o.value&&e.application_type!=0&&(e.robot_name||(e.robot_name=e.en_name)),I().then(()=>{K()}).catch(r=>{})};return pe(()=>{}),M({open:Q,setGroupId:X}),(r,t)=>{const c=xe,y=J,S=Ae,D=Le,N=Ce,ae=G,oe=j;return u(),w(oe,{width:o.value?"472px":"746px",open:l.value,"onUpdate:open":t[7]||(t[7]=n=>l.value=n),confirmLoading:b.value,title:B.value,onOk:te,onCancel:ee},{default:_(()=>[k("div",Te,[d(ae,{layout:"vertical"},{default:_(()=>[o.value?(u(),w(c,R({key:0,ref:"name",label:""},x(s).robot_avatar_url),{default:_(()=>[k("div",Se,[d(W,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":t[0]||(t[0]=n=>e.robot_avatar_url=n),onChange:z},null,8,["value"]),t[8]||(t[8]=k("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))])]),_:1},16)):$("",!0),e.application_type!=0?(u(),w(c,R({key:1,required:"",ref:"en_name",label:"工作流名称"},x(s).en_name),{default:_(()=>[d(y,{value:e.en_name,"onUpdate:value":t[1]||(t[1]=n=>e.en_name=n),maxLength:50,placeholder:"请输入"},null,8,["value"]),t[9]||(t[9]=k("div",{class:"form-item-tip"},'只能输入英文数字和字符"_"、"."、"-"，最多不超过50个字符',-1))]),_:1},16)):$("",!0),d(c,R({ref:"name",label:e.application_type==0?"应用名称":"备注名"},x(s).robot_name),{default:_(()=>[d(y,{value:e.robot_name,"onUpdate:value":t[2]||(t[2]=n=>e.robot_name=n),maxLength:20,placeholder:"请输入"},null,8,["value"]),e.application_type!=0?(u(),O("div",$e,"仅用作后台显示，不超过20个字")):$("",!0)]),_:1},16,["label"]),d(c,R({ref:"group_id",label:"分组"},x(s).group_id),{default:_(()=>[d(D,{value:e.group_id,"onUpdate:value":t[3]||(t[3]=n=>e.group_id=n),style:{width:"100%"},placeholder:"请选择分组"},{default:_(()=>[(u(!0),O(me,null,_e(L.value,n=>(u(),w(S,{value:n.id},{default:_(()=>[de(ve(n.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},16),d(c,R({label:"简介"},x(s).robot_intro),{default:_(()=>[o.value?(u(),w(N,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":t[5]||(t[5]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(u(),w(N,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":t[4]||(t[4]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),o.value?$("",!0):(u(),w(c,R({key:2,ref:"name",label:"机器人头像"},x(s).robot_avatar_url),{default:_(()=>[d(W,{value:e.robot_avatar_url,"onUpdate:value":t[6]||(t[6]=n=>e.robot_avatar_url=n),onChange:z},null,8,["value"]),t[10]||(t[10]=k("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))]),_:1},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},We=q(je,[["__scopeId","data-v-ecb0d32d"]]),Be={class:"form-item"},Ve={class:"form-content"},Ge={__name:"add-group",emits:["ok"],setup(F,{expose:M,emit:C}){const f=v(!1),g=C,i=v("新建分组"),p=V({group_name:"",id:""}),h=o=>{p.group_name=o.group_name||"",p.id=o.id||"",i.value=o.id?"编辑分组":"新建分组",f.value=!0},P=()=>{if(!p.group_name)return U.error("请输入分组名称");ue({...p}).then(o=>{U.success(`${i.value}成功`),f.value=!1,g("ok")})};return M({show:h}),(o,l)=>{const b=J,L=j;return u(),O("div",null,[d(L,{open:f.value,"onUpdate:open":l[1]||(l[1]=e=>f.value=e),title:i.value,onOk:P,zIndex:2e3},{default:_(()=>[k("div",Be,[l[2]||(l[2]=k("div",{class:"form-label"},"分组名称：",-1)),k("div",Ve,[d(b,{maxLength:15,value:p.group_name,"onUpdate:value":l[0]||(l[0]=e=>p.group_name=e),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Je=q(Ge,[["__scopeId","data-v-0d119043"]]);export{W as A,We as a,Je as b};
