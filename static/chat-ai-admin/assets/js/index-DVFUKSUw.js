import{w as J}from"./index-CyL7qnQS.js";import{_ as R,a6 as L,j as V}from"../../index-C1Xsov4S.js";import{aa as F,f,e as G,r as U,a1 as N,_,a2 as i,a5 as o,k as s,Y as m,ae as h,G as k,F as z,ab as K,ac as j,u as g,a7 as Y,o as H}from"./vue-chunks-DCKTEHpB.js";import{b as E,I as P,N as Q,ap as A,F as W,af as X,aN as Z,aO as ee,aJ as te,M as oe,a as se,d as S,T as ae,y as ne,Y as O}from"./ui-antd-D64OvTpt.js";import{P as le}from"./styles-DhjR_7YG.js";import{dG as ie}from"./util-Dg3pR2y4.js";import"./utils-D9NMMoMR.js";import"./thirdMcp-Dm2RMTBn.js";import"./index-BsqRrb1q.js";const de={class:"flex-content-box"},ue={class:"test-model-box"},re={key:0,class:"result-list-box"},_e=["onClick"],ce={class:"status-block"},pe={class:"icon-name-box"},ve=["src"],me={class:"node-name"},ge={key:0,class:"time-tag"},fe={class:"right-active-icon"},ye={class:"preview-box"},ke={class:"preview-title"},he={class:"icon-name-box"},xe=["src"],be={class:"node-name"},we={key:0,class:"time-tag"},Ce={class:"preview-content-block"},Ye={class:"title-block"},qe={class:"preview-code-box"},De={__name:"logs-detail",emits:["save","getGlobal"],setup(T,{expose:q,emit:$}){const x=F().query,d=f(!1),c=f(""),t=f([]),p=G(()=>c.value?t.value.filter(r=>r.node_key==c.value)[0]:null),u=U({robot_key:x.robot_key,question:"",openid:""}),D=r=>{u.question=r.question||"",u.openid=r.openid||"",t.value=[],c.value="",b(r.node_logs),d.value=!0},b=r=>{var e;t.value=r.map(a=>({...a,is_success:a.error_msg==="<nil>",node_icon:ie(a.node_type)})),c.value=(e=t.value[0])==null?void 0:e.node_key},w=r=>{c.value=r.node_key},M=()=>{L(JSON.stringify(p.value.output)),se.success("复制成功")};return q({show:D}),(r,e)=>{const a=A,n=Q,y=P,C=E,v=W,I=oe;return _(),N(I,{open:d.value,"onUpdate:open":e[2]||(e[2]=l=>d.value=l),title:"日志详情",footer:null,width:880,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:i(()=>[o("div",de,[o("div",ue,[e[7]||(e[7]=o("div",{class:"top-title"},"开始节点参数",-1)),s(v,{model:u,ref:"formRef",layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:i(()=>[s(C,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:i(()=>[s(n,{gap:4},{default:i(()=>[e[4]||(e[4]=k("question ",-1)),s(a,{style:{margin:"0"}},{default:i(()=>[...e[3]||(e[3]=[k("string",-1)])]),_:1})]),_:1})]),default:i(()=>[s(y,{readonly:"",placeholder:"请输入",value:u.question,"onUpdate:value":e[0]||(e[0]=l=>u.question=l)},null,8,["value"])]),_:1}),s(C,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:i(()=>[s(n,{gap:4},{default:i(()=>[e[6]||(e[6]=k("openid ",-1)),s(a,{style:{margin:"0"}},{default:i(()=>[...e[5]||(e[5]=[k("string",-1)])]),_:1})]),_:1})]),default:i(()=>[s(y,{readonly:"",placeholder:"请输入",value:u.openid,"onUpdate:value":e[1]||(e[1]=l=>u.openid=l)},null,8,["value"])]),_:1})]),_:1},8,["model"]),t.value.length>0?(_(),m("div",re,[(_(!0),m(z,null,K(t.value,(l,B)=>(_(),m("div",{class:j(["list-item-block",{active:c.value==l.node_key}]),onClick:Re=>w(l),key:B},[o("div",ce,[l.is_success?(_(),N(g(X),{key:0,style:{color:"#138b1b"}})):(_(),N(g(Z),{key:1,style:{color:"#d81e06"}}))]),o("div",pe,[o("img",{src:l.node_icon,alt:""},null,8,ve),o("div",me,Y(l.node_name),1)]),l.is_success?(_(),m("div",ge,Y(l.use_time)+"ms",1)):h("",!0),o("div",fe,[s(g(ee))])],10,_e))),128))])):h("",!0)]),o("div",ye,[p.value?(_(),m(z,{key:0},[o("div",ke,[e[8]||(e[8]=o("div",{class:"title-text"},"日志详情",-1)),o("div",he,[o("img",{src:p.value.node_icon,alt:""},null,8,xe),o("div",be,Y(p.value.node_name),1)]),p.value.is_success?(_(),m("div",we,Y(p.value.use_time)+"ms",1)):h("",!0)]),o("div",Ce,[o("div",Ye,[e[9]||(e[9]=k("运行日志",-1)),s(g(te),{onClick:M})]),o("div",qe,[s(g(le),{data:p.value.output},null,8,["data"])])])],64)):h("",!0)])])]),_:1},8,["open"])}}},Me=R(De,[["__scopeId","data-v-1ed7190f"]]),Ie={class:"user-model-page"},Ne={class:"list-wrapper"},Se={class:"content-wrapper"},$e={class:"search-block"},ze=["onClick"],Oe={__name:"index",setup(T){const q=F().query,$=V(),x=f([]),d=f([S().subtract(6,"day"),S()]),c=f(!1),t=U({robot_id:q.id,page:1,size:20,total:0,openid:"",question:"",start_date:d.value[0].format("YYYY-MM-DD"),end_date:d.value[1].format("YYYY-MM-DD")}),p=e=>{t.page=e.current,t.size=e.pageSize,b()},u=()=>{t.page=1,b()},D=e=>{t.start_date="",t.end_date="",d.value&&d.value.length>0&&(t.start_date=d.value[0].format("YYYY-MM-DD"),t.end_date=d.value[1].format("YYYY-MM-DD")),u()},b=()=>{c.value=!0,J({...t}).then(e=>{let a=e.data.list||[];x.value=a.map(n=>(n.duration_mills_desc=`${n.duration_mills}ms`,n.total_token_desc=`${(n.total_token/1e3).toFixed(3)}`,n.create_time_desc=S(n.create_time*1e3).format("YYYY-MM-DD HH:mm:ss"),n.node_logs=n.node_logs?JSON.parse(n.node_logs):[],n)),t.total=+e.data.total||0}).finally(()=>{c.value=!1})},w=f(null),M=e=>{w.value.show({...e})},r=[{title:"openid",dataIndex:"openid",key:"openid",width:150},{title:"question",dataIndex:"question",key:"question",width:250},{title:"工作流版本",key:"version",dataIndex:"version",width:130},{title:"耗时",key:"duration_mills_desc",dataIndex:"duration_mills_desc",width:130},{title:"token消耗（K）",key:"total_token_desc",dataIndex:"total_token_desc",width:130},{title:"调用时间",key:"create_time_desc",dataIndex:"create_time_desc",width:150},{title:"操作",key:"action",width:100}];return H(()=>{u()}),(e,a)=>{const n=ae,y=P,C=ne;return _(),m("div",Ie,[a[3]||(a[3]=o("div",{class:"page-title"},"调用日志",-1)),o("div",Ne,[o("div",Se,[o("div",$e,[s(n,{value:d.value,"onUpdate:value":a[0]||(a[0]=v=>d.value=v),allowClear:!1,onChange:D,style:{width:"256px"},presets:g($)},null,8,["value","presets"]),s(y,{style:{width:"256px"},value:t.openid,"onUpdate:value":a[1]||(a[1]=v=>t.openid=v),onChange:u,placeholder:"请输入openid"},{suffix:i(()=>[s(g(O))]),_:1},8,["value"]),s(y,{style:{width:"256px"},value:t.question,"onUpdate:value":a[2]||(a[2]=v=>t.question=v),onChange:u,placeholder:"请输入问题"},{suffix:i(()=>[s(g(O))]),_:1},8,["value"])]),s(C,{class:"table-list",columns:r,"data-source":x.value,loading:c.value,sticky:"",pagination:{current:t.page,total:t.total,pageSize:t.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:p},{bodyCell:i(({column:v,record:I})=>[v.key==="action"?(_(),m("a",{key:0,onClick:l=>M(I)},"查看明细",8,ze)):h("",!0)]),_:1},8,["data-source","loading","pagination"])]),s(Me,{ref_key:"logsDetailRef",ref:w},null,512)])])}}},Ke=R(Oe,[["__scopeId","data-v-cd68dc6f"]]);export{Ke as default};
