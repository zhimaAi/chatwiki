import{_ as Je}from"./cu-scroll-RG6yxhtf.js";import{u as qe}from"./robot-DM4IWDeQ.js";import{n as F,b as oe,B as ge,d as ke,M as me,a3 as Pe,a5 as Qe,k as Z,bK as He,bL as Xe,bM as We,h as Ze}from"../../index-M_xDbIir.js";import{a3 as ue,a2 as Se,d as r,z as P,q as et,w as Ie,N as f,O as u,X as e,j as o,U as n,F as B,a1 as re,u as J,S as G,Z as x,_ as T,b as ae,o as tt,x as Oe,a6 as X,H as ye,I as $e,a5 as ot,ae as De,af as Ce,W as fe,ag as nt}from"./vue-chunks-BRsu9_To.js";import{a as at,_ as st}from"./RadioButton-Bb2kU0Fd.js";import{R as lt}from"./dayjs-DGNhaBdA.js";import{C as Ue}from"./index-DDHNcNyv.js";import{R as it}from"./index-CYQ0SJ7O.js";import{_ as rt}from"./index-CsySi7_q.js";import{u as ut}from"./index-71hSlXGB.js";import{_ as Le}from"./index-BF4PinvW.js";import{_ as we}from"./index-B0RyY99D.js";import{a as ze,_ as dt}from"./index-Bg1_T7h9.js";import{L as _t,M as Ye,N as mt,O as ct}from"./index-mwk_dyAT.js";import{U as Te}from"./index-C8hUWloT.js";import{u as Ne}from"./util-BwuffJOK.js";import{M as pt}from"./index-BMSQkwth.js";import{S as vt,a as ft}from"./index-khLftDou.js";import{T as be,_ as he}from"./index-WJK8Aswe.js";import{L as yt}from"./LeftOutlined-DbHJ8blF.js";import{_ as Re}from"./TextArea-C57yjED6.js";import{_ as Ke}from"./index-tezmKtYb.js";import{M as gt}from"./model-select-Cwu3Of2q.js";import{F as _e,_ as Ae}from"./index-V0sRhm34.js";import{Q as Fe}from"./QuestionCircleOutlined-B5SgdGK5.js";import{D as kt}from"./DownOutlined-CI2wWtcJ.js";import{M as wt,_ as bt}from"./index-B3CPYV6x.js";import"./index-D7wU2qJF.js";import{D as ht}from"./dropdown-DCrM-GKY.js";import{_ as xt}from"./index-pt58wSpn.js";import{_ as $t}from"./index-RSdO8Qbf.js";import{_ as Dt}from"./index-CSIZCO5e.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-DRzYyKbC.js";import"./Checkbox-pA5GUfu7.js";import"./index-Cs0K2ZaB.js";import"./index-D48_VNbE.js";import"./colors-C56HAaAp.js";import"./ClockCircleOutlined-DkyJWIQA.js";import"./useMergedState-C0iIHNGF.js";import"./Trigger-CkoSoTBd.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./shallowequal-C0xnIuy8.js";import"./index-Btmz2D3B.js";import"./move-DD64vPeJ.js";import"./slide-DzpBPoRp.js";import"./index-CMIXnI2Z.js";import"./index-Bm5IPe57.js";import"./CheckOutlined-DVulUWsT.js";import"./useRefs-CRRjy_qY.js";import"./index-D8nD-csV.js";import"./List-DKTpjnke.js";import"./collapseMotion-Brd6xpAT.js";import"./CaretDownFilled-BzxZQg7Y.js";import"./index-SuSZ4kHz.js";import"./responsiveObserve-CRSSr9-w.js";import"./index-D_6sH2t0.js";import"./RightOutlined-og3IpneX.js";import"./index-Bn-th77D.js";import"./index-Dob-Z8xa.js";import"./CaretDownOutlined-C4FFiOW0.js";import"./SearchOutlined-KUcJKUZw.js";import"./index-UA7y0weg.js";import"./Input-Bx6Hhp2b.js";import"./inputProps-DsSGhBt6.js";import"./Search-w33R1D1l.js";import"./isPlainObject-A-SljaBF.js";import"./Password-5njtOUlo.js";import"./index-BR_iTZbN.js";import"./index-BSroSjtu.js";import"./DownloadOutlined-Cn7Sl8HY.js";import"./Dropdown-Dh4cjnmT.js";import"./pick-BW-qU63h.js";import"./hasIn-DEwqUvIo.js";import"./PlusOutlined-DQ91YM1E.js";import"./UpOutlined-DzDRcb4z.js";import"./Col-CFWsj1wI.js";const Ct={class:"zm-date"},Mt={class:"date-btn"},qt={class:"date-content"},Ve={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(H,{emit:K}){const $=ue().query,C=Se(),i=H,g=r(1),l=K;let c=P([{label:"今日",value:!0,key:2,start_date:F().startOf("day"),end_date:F().endOf("day")},{label:"昨日",value:!1,key:3,start_date:F().subtract(1,"day").startOf("day"),end_date:F().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_date:F().subtract(6,"day").startOf("day"),end_date:F().endOf("day").subtract(1,"millisecond")},{label:"自定义",value:!1,key:5,start_date:F().startOf("month").startOf("day"),end_date:F().endOf("day")}]);const a=r(null),O=r(null),I=r([]),h=y=>y>=F().subtract(0,"day"),S=()=>{let y=g.value,s=null;c.forEach(m=>{m.key==y&&(s=m)}),I.value=[s.start_date,s.end_date],a.value=s.start_date.startOf("day").format("YYYYMMDD"),O.value=s.end_date.endOf("day").format("YYYYMMDD"),N()},z=(y,s)=>{a.value=y[0].startOf("day").format("YYYYMMDD"),O.value=y[1].endOf("day").format("YYYYMMDD"),g.value=5,N()},N=()=>{l("dateChange",{start_time:a.value,end_time:O.value})};return et(()=>{$.start_date&&$.end_date?(g.value=5,I.value=[F($.start_date),F($.end_date)],a.value=F($.start_date).format("YYYYMMDD"),O.value=F($.end_date).format("YYYYMMDD"),N(),setTimeout(()=>{C.push({path:C.path,query:{id:$.id,robot_key:$.robot_key}})},400)):(g.value=parseInt(i.datekey),S())}),Ie(()=>i.datekey,(y,s)=>{g.value=parseInt(i.datekey.split("-")[0]),S()}),(y,s)=>{const m=at,M=st,w=lt;return u(),f("div",Ct,[e("div",Mt,[o(M,{value:g.value,"onUpdate:value":s[0]||(s[0]=q=>g.value=q),onChange:S},{default:n(()=>[(u(!0),f(B,null,re(J(c),q=>(u(),G(m,{class:"date-btn-button",value:q.key,key:q.key},{default:n(()=>[x(T(q.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",qt,[o(w,{value:I.value,"onUpdate:value":s[1]||(s[1]=q=>I.value=q),onChange:z,format:"YYYY-MM-DD",disabledDate:h,allowClear:!1},null,8,["value"])])])}}},St={class:"ai-generate-wrapper"},It={class:"form-box-wrapper ai-generate-wrapper-box"},Ot={class:"ai-generate-wrapper-left"},Ut={class:"form-box-wrapper-options"},Lt={class:"form-item flex1"},zt={class:"form-content"},Yt={class:"form-item generate-btn-box"},Tt={key:0,class:"progress-box"},Nt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(H,{expose:K,emit:$}){const C=r(10),i=r(!1),g=r(!1),l=P({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),c=H,a=$,O=r(""),I=["azure","ollama","xinference","openaiAgent"],h=r(!1),S=()=>{h.value=!0},z=()=>{i.value=!1},N=async()=>{var k;g.value=!0;try{let v={library_id:(k=c.detailsInfo)==null?void 0:k.library_id,model_config_id:l.model_config_id,use_model:l.use_model,num:l.count};h.value=!1,i.value=!0,q()}finally{g.value=!1}},y=r(!1),s=r(!1);let m=null;const M=ae(()=>C.value>=100?"success":"active"),w=ae(()=>({"0%":"#108ee9","100%":"#87d068"})),q=()=>{y.value=!0,s.value=!1,C.value=0,m=setInterval(()=>{C.value<100?(C.value+=Math.floor(Math.random()*10)+1,C.value>100&&(C.value=100)):(clearInterval(m),y.value=!1,s.value=!0)},800)},Y=()=>{a("handleDownload")},L=k=>{l.use_model=I.includes(k.rawData.model_define)&&k.rawData.deployment_name?k.rawData.deployment_name:k.rawData.name,l.use_model_icon=k.icon,l.use_model_name=k.use_model_name,l.model_config_id=k.rawData.id,O.value=k.rawData.model_define},E=r([]),p=k=>{E.value=k,Oe(()=>{(!l.ai_chunk_model||!Number(l.ai_chunk_model_config_id))&&_()})},_=()=>{if(E.value.length>0){let k=null,v=null;for(let Q of E.value)if(Q.model_define==="tongyi"){k=Q;for(let j of k.children)if(j.name==="qwen-max"){v=j;break}break}k||(k=E.value[0],v=k.children[0]),k&&v&&(l.use_model=v.name,l.model_config_id=v.model_config_id,l.ai_chunk_model=v.name,l.ai_chunk_model_config_id=v.model_config_id)}},D=k=>{if(y.value)return k.preventDefault(),k.returnValue="数据正在生成中，确定要离开吗？","数据正在生成中，确定要离开吗？"};return tt(()=>{clearInterval(m),window.removeEventListener("beforeunload",D)}),K({showModal:S,hideModal:z}),(k,v)=>{const Q=ke,j=ge,ee=me,se=rt,W=it;return u(),f("div",null,[o(ee,{open:h.value,"onUpdate:open":v[1]||(v[1]=V=>h.value=V),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:n(()=>v[3]||(v[3]=[e("div",{class:"custom-modal-header"},[e("span",null,"AI智能总结")],-1)])),footer:n(()=>v[6]||(v[6]=[])),default:n(()=>[e("div",St,[e("div",It,[e("div",Ot,[e("div",Ut,[e("div",Lt,[v[4]||(v[4]=e("div",{class:"form-label required"},"请选择生成未知问题总结的大模型",-1)),e("div",zt,[o(Ue,{modelValue:l.use_model,"onUpdate:modelValue":v[0]||(v[0]=V=>l.use_model=V),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":l.model_config_id,onChange:L,onLoaded:p},null,8,["modelValue","model-config-id"])])])]),e("div",Yt,[o(j,{onClick:N,loading:g.value,class:"generate-btn"},{default:n(()=>[o(Q,{name:"ai-generate-white",style:{"font-size":"16px"}}),v[5]||(v[5]=x(" 开始总结 "))]),_:1,__:[5]},8,["loading"])])])])])]),_:1},8,["open"]),o(ee,{open:i.value,"onUpdate:open":v[2]||(v[2]=V=>i.value=V),title:"生成数据",footer:null,width:746},{default:n(()=>[C.value<100?(u(),f("div",Tt,[o(se,{type:"circle",percent:C.value,status:M.value,"stroke-color":w.value},null,8,["percent","status","stroke-color"]),v[7]||(v[7]=e("div",{class:"tip"},"数据生成中，请勿关闭页面",-1))])):(u(),G(W,{key:1,status:"success",title:"生成完成"},{subTitle:n(()=>v[8]||(v[8]=[x(" 您可以去未知问题总结中下载生成的数据 ")])),extra:n(()=>[o(j,{onClick:Y,type:"primary"},{default:n(()=>v[9]||(v[9]=[x("去下载")])),_:1,__:[9]})]),_:1}))]),_:1},8,["open"])])}}},Rt=oe(Nt,[["__scopeId","data-v-8157c68d"]]),Kt={class:"list-wrapper"},At={class:"content-wrapper"},Ft={class:"tip-icon"},Vt={class:"search-block"},Gt={key:0},Et={key:1},jt={__name:"index",setup(H){const K=ue().query,$=r(1),C=r([]),i=P({robot_id:K.id,start_day:"",end_day:"",page:1,size:10,total:0}),g=r(null),l=S=>{i.page=S.current,i.size=S.pageSize,I()},c=()=>{i.page=1,I()},a=()=>{$.value=2,g.value&&g.value.hideModal()},O=S=>{i.start_day=S.start_time,i.end_day=S.end_time,c()},I=()=>{ut({...i}).then(S=>{let z=S.data.list;C.value=z,i.total=+S.data.total})},h=[{title:"未知问题",dataIndex:"question",key:"question",width:"60%"},{title:"触发日期",dataIndex:"show_date",key:"show_date",width:"20%"},{title:"当日出现次数",key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return(S,z)=>{const N=Le,y=we,s=ze;return u(),f(B,null,[e("div",Kt,[e("div",At,[o(N,{"show-icon":"",class:"alert-box"},{icon:n(()=>[e("div",Ft,[o(J(Pe))])]),message:n(()=>z[0]||(z[0]=[e("div",{class:"tip-title"},"统计用户在与机器人对话中，没有从知识库中检索出知识的用户问题",-1),e("div",{class:"tip-content"},[e("p",null," 1. 如果您认为知识库里面有对应的知识，只是没有检索出来，可能是您设置的召回阈值过高或者top K较少。您调整机器人的召回设置来提升召回率。 ")],-1)])),_:1}),e("div",Vt,[o(Ve,{datekey:"4",onDateChange:O})]),o(s,{class:"table-list",columns:h,"data-source":C.value,pagination:{current:i.page,total:i.total,pageSize:i.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:l},{bodyCell:n(({column:m,record:M})=>[m.key==="question"?(u(),f(B,{key:0},[M.question.length>100?(u(),f("div",Gt,[o(y,{overlayClassName:"search-content-tip",placement:"top"},{title:n(()=>[x(T(M.question),1)]),default:n(()=>[e("div",null,T(M.question.slice(0,100)+"..."),1)]),_:2},1024)])):(u(),f("div",Et,T(M.question),1))],64)):X("",!0)]),_:1},8,["data-source","pagination"])])]),o(Rt,{ref_key:"aiGenerateRef",ref:g,onHandleDownload:a},null,512)],64)}}},Bt=oe(jt,[["__scopeId","data-v-9638ffbb"]]),Jt={class:"custom-modal-header"},Pt={key:1},Qt={key:2},Ht={class:"form-box-wrapper"},Xt={class:"form-item"},Wt={class:"form-content"},Zt={class:"form-item"},eo={class:"form-content"},to={class:"form-item"},oo={class:"form-content"},no={class:"form-item"},ao={class:"form-label-box"},so={class:"form-content"},lo={class:"form-item"},io={class:"form-content"},ro={key:0,class:"error-tip"},uo={class:"form-item"},_o={class:"form-content"},mo={class:"upload-box-wrapper"},co={key:0},po={class:"ai-generate-wrapper"},vo={class:"form-box-wrapper ai-generate-wrapper-box"},fo={class:"ai-generate-wrapper-left"},yo={class:"form-box-wrapper-options"},go={class:"form-item flex1"},ko={class:"form-content"},wo={class:"form-item flex1"},bo={class:"form-content dual-inputs"},ho={class:"input-group"},xo={class:"form-label-input-box"},$o={class:"form-box-wrapper-content"},Do={class:"problem-box"},Co={class:"problem-content"},Mo={class:"problem-box"},qo={class:"problem-content"},So={class:"form-item generate-btn-box"},Io={class:"result-nav"},Oo={key:0,class:"tip"},Uo={key:1,class:"result-nav-text"},Lo={key:0,class:"container"},zo={class:"result-container"},Yo=["innerHTML"],To={class:"result-footer"},No={__name:"import-library-modal",emits:["ok"],setup(H,{expose:K,emit:$}){const C=r(!1),i=r(!1),g=r(!1),l=r(!1),c=r(!1),a=P({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),O=new pt({html:!0,linkify:!0,typographer:!0}),I=r(""),h=P({finish:"",content:""});Ie(()=>h.content,()=>{I.value=O.render(h.content)});const S=$,z=r(""),N=["azure","ollama","xinference","openaiAgent"],y=r("1"),s=r(!1),m=r(""),M=r(""),w=r(""),q=r(""),Y=r(""),L=r([]),E=r(""),p=r("0"),_=r([]),D=()=>{Qe({type:2}).then(d=>{p.value="0",_.value=d.data||[]})};D();const k=()=>{j()},v=d=>{var t;D(),i.value=!1,g.value=!1,c.value=!1,m.value="",M.value="",E.value=d.id||"",w.value=d.answer||"",L.value=d.images||[],q.value=d.question||"",Y.value=d.similar_questions?d.similar_questions.join(`
`):"",p.value=d.group_id||"0",a.library_id=d.library_id||"",a.library_id||(a.library_id=(t=_.value[0])==null?void 0:t.id),j(),s.value=!0},Q=r([]),j=()=>{We({library_id:a.library_id}).then(d=>{Q.value=d.data||[]})},ee=()=>{if(xe(),!q.value)return Z.error("请输入分段问题");if(!w.value)return Z.error("请输入分段答案");if(w.value.length>1e4)return;let d={title:m.value,content:M.value,question:q.value,answer:w.value,images:L.value,library_id:a.library_id};d.group_id=p.value||0;let t=Y.value.trim();t?(t=t.split(`
`),d.similar_questions=JSON.stringify(t)):d.similar_questions="[]";let R=new FormData;for(let A in d)Ne.isArray(d[A])?d[A].forEach(ie=>{R.append(A,ie)}):R.append(A,d[A]);Xe(R).then(A=>{_t({id:E.value,to_library_id:a.library_id}).then(ie=>{Z.success("导入成功"),s.value=!1,S("ok")})})},se=()=>{if(!a.library_id)return Z.error("请选择知识库");i.value=!0},W=r(""),V=async()=>{h.content="",W.value="",l.value=!0,c.value=!0;try{let d={library_id:a.library_id,model_config_id:a.model_config_id,use_model:a.use_model,num:a.count,question:q.value,answer:w.value};const t=await He(d);W.value=t.data.map(R=>R).join(`
`),h.content=t.data.map((R,A)=>`<div class="dialog-message">${A+1}. ${R}</div>`).join(""),g.value=!0}finally{l.value=!1}},ce=()=>{Y.value?Y.value+=`
${W.value}`:Y.value+=W.value,Z.success("保存成功"),g.value=!1,i.value=!1,c.value=!1},pe=d=>{a.use_model=N.includes(d.rawData.model_define)&&d.rawData.deployment_name?d.rawData.deployment_name:d.rawData.name,a.use_model_icon=d.icon,a.use_model_name=d.use_model_name,a.model_config_id=d.rawData.id,z.value=d.rawData.model_define},ne=r([]),U=d=>{ne.value=d,Oe(()=>{(!a.ai_chunk_model||!Number(a.ai_chunk_model_config_id))&&te()})},te=()=>{if(ne.value.length>0){let d=null,t=null;for(let R of ne.value)if(R.model_define==="tongyi"){d=R;for(let A of d.children)if(A.name==="qwen-max"){t=A;break}break}d||(d=ne.value[0],t=d.children[0]),d&&t&&(a.use_model=t.name,a.model_config_id=t.model_config_id,a.ai_chunk_model=t.name,a.ai_chunk_model_config_id=t.model_config_id)}};function le(d){return d.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const xe=()=>{Y.value=le(Y.value)};return K({showModal:v}),(d,t)=>{const R=ge,A=ft,ie=vt,ve=Re,de=ke,Ge=he,Ee=be,je=Ke,Be=me;return u(),f("div",null,[o(Be,{open:s.value,"onUpdate:open":t[11]||(t[11]=b=>s.value=b),onOk:ee,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:i.value?c.value?"944px":"472px":"746px","ok-button-props":{style:{display:i.value?"none":"block"}}},{title:n(()=>[e("div",Jt,[i.value?(u(),G(R,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=b=>i.value=!1)},{icon:n(()=>[o(J(yt),{style:{"font-size":"12px"}})]),_:1})):X("",!0),i.value?(u(),f("span",Pt,"AI生成相似问法")):(u(),f("span",Qt,"导入知识库"))])]),footer:n(()=>[i.value?X("",!0):(u(),f(B,{key:0},[o(R,{onClick:t[10]||(t[10]=b=>s.value=!1)},{default:n(()=>t[29]||(t[29]=[x("取消")])),_:1,__:[29]}),o(R,{type:"primary",onClick:ee},{default:n(()=>t[30]||(t[30]=[x("确定")])),_:1,__:[30]})],64))]),default:n(()=>[ye(e("div",Ht,[e("div",Xt,[t[12]||(t[12]=e("div",{class:"form-label required"},"问题请选择要导入的问答知识库：",-1)),e("div",Wt,[o(ie,{onChange:k,value:a.library_id,"onUpdate:value":t[1]||(t[1]=b=>a.library_id=b),style:{width:"100%"},placeholder:"请选择"},{default:n(()=>[(u(!0),f(B,null,re(_.value,b=>(u(),G(A,{value:b.id,key:b.id},{default:n(()=>[x(T(b.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Zt,[t[13]||(t[13]=e("div",{class:"form-label required"},"所属分类：",-1)),e("div",eo,[o(ie,{value:p.value,"onUpdate:value":t[2]||(t[2]=b=>p.value=b),style:{width:"100%"}},{default:n(()=>[(u(!0),f(B,null,re(Q.value,b=>(u(),G(A,{value:b.id},{default:n(()=>[x(T(b.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",to,[t[14]||(t[14]=e("div",{class:"form-label required"},"分段问题：",-1)),e("div",oo,[o(ve,{placeholder:"请输入分段问题",value:q.value,"onUpdate:value":t[3]||(t[3]=b=>q.value=b),style:{height:"100px"}},null,8,["value"])])]),e("div",no,[e("div",ao,[t[16]||(t[16]=e("div",{class:"form-label required"},"相似问法",-1)),e("div",{class:"ai-generate",onClick:se},[o(de,{name:"ai-generate",style:{"font-size":"14px"}}),t[15]||(t[15]=e("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),e("div",so,[o(ve,{placeholder:"请输入相似问法",value:Y.value,"onUpdate:value":t[4]||(t[4]=b=>Y.value=b),style:{height:"100px"},onBlur:xe},null,8,["value"]),t[17]||(t[17]=e("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),e("div",lo,[t[18]||(t[18]=e("div",{class:"form-label required"},"分段答案：",-1)),e("div",io,[o(ve,{placeholder:"请输入分段答案",value:w.value,"onUpdate:value":t[5]||(t[5]=b=>w.value=b),maxlength:1e4,style:{height:"100px"}},null,8,["value"]),w.value.length>1e4?(u(),f("div",ro,"分段答案最多支持10000个字符")):X("",!0)])]),e("div",uo,[t[20]||(t[20]=e("div",{class:"form-label"},"附件",-1)),e("div",_o,[e("div",mo,[o(Ee,{activeKey:y.value,"onUpdate:activeKey":t[6]||(t[6]=b=>y.value=b),size:"small"},{default:n(()=>[o(Ge,{key:"1"},{tab:n(()=>[e("span",null,[o(de,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),t[19]||(t[19]=x(" 图片 ")),L.value.length?(u(),f("span",co,"("+T(L.value.length)+")",1)):X("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(Te,{value:L.value,"onUpdate:value":t[7]||(t[7]=b=>L.value=b)},null,8,["value"])])])])],512),[[$e,!i.value]]),ye(e("div",po,[e("div",vo,[e("div",fo,[e("div",yo,[e("div",go,[t[21]||(t[21]=e("div",{class:"form-label required"},"相似问法模型：",-1)),e("div",ko,[o(Ue,{modelValue:a.use_model,"onUpdate:modelValue":t[8]||(t[8]=b=>a.use_model=b),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":a.model_config_id,onChange:pe,onLoaded:U},null,8,["modelValue","model-config-id"])])]),e("div",wo,[e("div",bo,[e("div",ho,[t[23]||(t[23]=e("div",{class:"form-label required"},"问题个数：",-1)),e("div",xo,[o(je,{value:a.count,"onUpdate:value":t[9]||(t[9]=b=>a.count=b),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),t[22]||(t[22]=x("个 "))])])])])]),e("div",$o,[e("div",Do,[t[24]||(t[24]=e("div",{class:"problem"},"问题",-1)),e("div",Co,T(q.value),1)]),e("div",Mo,[t[25]||(t[25]=e("div",{class:"problem"},"答案",-1)),e("div",qo,T(w.value),1)])]),e("div",So,[o(R,{onClick:V,loading:l.value,class:"generate-btn"},{default:n(()=>[o(de,{name:"ai-generate-white",style:{"font-size":"16px"}}),t[26]||(t[26]=x(" 开始生成 "))]),_:1,__:[26]},8,["loading"])])]),e("div",{class:ot(["ai-generate-wrapper-right",{"show-result":c.value}])},[e("div",Io,[o(de,{name:"generate-icon",style:{"font-size":"14px"}}),l.value?(u(),f("span",Oo,"相似问法生成中...")):(u(),f("div",Uo,"相似问法生成完毕"))]),!h.content&&l.value&&!C.value?(u(),f("div",Lo,t[27]||(t[27]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)]))):X("",!0),e("div",zo,[e("div",{class:"dialog-content",innerHTML:I.value},null,8,Yo)]),e("div",To,[o(R,{class:"result-footer-btn",type:"primary",onClick:ce},{default:n(()=>t[28]||(t[28]=[x("保存相似问法")])),_:1,__:[28]})])],2)])],512),[[$e,i.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Ro=oe(No,[["__scopeId","data-v-1b574462"]]),Ko={class:"form-box"},Ao={__name:"auto-cluster-modal",emits:["ok"],setup(H,{expose:K,emit:$}){const C=$,i=ue().query,g=r(!1),l=P({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:i.id}),c=_e.useForm;r(!1);const a=y=>{l.unknown_summary_model_config_id=y.unknown_summary_model_config_id||"",l.unknown_summary_use_model=y.unknown_summary_use_model||"",l.unknown_summary_similarity=y.unknown_summary_similarity||"",l.unknown_summary_status=y.unknown_summary_status||"",g.value=!0},O=P({unknown_summary_similarity:[{required:!0,message:"请输入相似度阈值",trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:"请选择使用的向量模型",trigger:"change"}]}),{validate:I,validateInfos:h}=c(l,O),S=y=>{y.length},z=()=>{I().then(()=>{N()}).catch(y=>{})},N=()=>{Ye({...l}).then(y=>{Z.success("保存成功"),g.value=!1,C("ok")})};return K({show:a}),(y,s)=>{const m=Ae,M=we,w=Ke,q=_e,Y=me;return u(),f("div",null,[o(Y,{open:g.value,"onUpdate:open":s[3]||(s[3]=L=>g.value=L),title:"自动聚类设置",onOk:z},{default:n(()=>[e("div",Ko,[o(q,{layout:"vertical"},{default:n(()=>[o(m,De(Ce(J(h).unknown_summary_model_config_id)),{label:n(()=>s[4]||(s[4]=[x("请设置使用的向量模型 ")])),default:n(()=>[o(gt,{modelType:"TEXT EMBEDDING",modeName:l.unknown_summary_use_model,"onUpdate:modeName":s[0]||(s[0]=L=>l.unknown_summary_use_model=L),modeId:l.unknown_summary_model_config_id,"onUpdate:modeId":s[1]||(s[1]=L=>l.unknown_summary_model_config_id=L),onLoaded:S,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),o(m,De(Ce(J(h).unknown_summary_similarity)),{label:n(()=>[s[6]||(s[6]=x("相似度阈值 ")),o(M,null,{title:n(()=>s[5]||(s[5]=[x("语意相似度大于指定阈值的问题会自动聚类")])),default:n(()=>[o(J(Fe),{class:"ml4"})]),_:1})]),default:n(()=>[o(w,{placeholder:"请输入相似度阈值",style:{width:"100%"},value:l.unknown_summary_similarity,"onUpdate:value":s[2]||(s[2]=L=>l.unknown_summary_similarity=L),min:0,max:1,precision:2,step:.1},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open"])])}}},Fo=oe(Ao,[["__scopeId","data-v-3a707038"]]),Vo={class:"form-box"},Go={class:"upload-box-wrapper"},Eo={key:0},jo={__name:"set-answer-modal",emits:["ok"],setup(H,{expose:K,emit:$}){const C=$,i=ue().query,g=r("1"),l=r(!1),c=P({id:i.id,question:"",unknown_list:"",answer:"",images:[]}),a=_e.useForm,O=r(!1),I=s=>{Object.assign(c,JSON.parse(JSON.stringify(s))),l.value=!0},h=P({question:[{required:!0,message:"请输入问题",trigger:"change"}],unknown_list:[{required:!0,message:"请输入相似问法",trigger:"change"}],answer:[{required:!0,message:"请输入答案",trigger:"change"}]}),{validate:S,validateInfos:z}=a(c,h),N=()=>{S().then(()=>{y()}).catch(s=>{})},y=()=>{let s={...c},m=s.unknown_list.trim();m?(m=m.split(`
`),s.unknown_list=JSON.stringify(m)):s.unknown_list="[]";let M=new FormData;for(let w in s)Ne.isArray(s[w])?s[w].forEach(q=>{M.append(w,q)}):M.append(w,s[w]);O.value=!0,mt(M).then(w=>{Z.success("保存成功"),l.value=!1,C("ok")}).finally(()=>{O.value=!1})};return K({show:I}),(s,m)=>{const M=Re,w=Ae,q=ke,Y=he,L=be,E=Te,p=_e,_=me;return u(),f("div",null,[o(_,{open:l.value,"onUpdate:open":m[5]||(m[5]=D=>l.value=D),title:"设置答案",onOk:N,width:746,confirmLoading:O.value},{default:n(()=>[e("div",Vo,[o(p,{layout:"vertical"},{default:n(()=>[o(w,fe({label:"问题"},J(z).question),{default:n(()=>[o(M,{placeholder:"请输入问题",value:c.question,"onUpdate:value":m[0]||(m[0]=D=>c.question=D),style:{height:"100px"}},null,8,["value"])]),_:1},16),o(w,fe({label:"相似问法(一行一个，最多可添加100个相似问法)"},J(z).unknown_list),{default:n(()=>[o(M,{placeholder:"请输入相似问法",value:c.unknown_list,"onUpdate:value":m[1]||(m[1]=D=>c.unknown_list=D),style:{height:"100px"}},null,8,["value"])]),_:1},16),o(w,fe({label:"答案"},J(z).answer),{default:n(()=>[o(M,{placeholder:"请输入分段答案",value:c.answer,"onUpdate:value":m[2]||(m[2]=D=>c.answer=D),maxlength:1e4,style:{height:"100px"}},null,8,["value"])]),_:1},16),o(w,{label:"附件"},{default:n(()=>[e("div",Go,[o(L,{activeKey:g.value,"onUpdate:activeKey":m[3]||(m[3]=D=>g.value=D),size:"small"},{default:n(()=>[o(Y,{key:"1"},{tab:n(()=>[e("span",null,[o(q,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),m[6]||(m[6]=x(" 图片 ")),c.images.length?(u(),f("span",Eo,"("+T(c.images.length)+")",1)):X("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(E,{value:c.images,"onUpdate:value":m[4]||(m[4]=D=>c.images=D)},null,8,["value"])])]),_:1})]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Bo=oe(jo,[["__scopeId","data-v-a5711fe0"]]),Jo={class:"user-model-page"},Po={class:"search-block"},Qo={class:"left-block"},Ho={class:"right-block"},Xo={class:"list-box"},Wo={class:"qa-list-box"},Zo={class:"list-item"},en={class:"list-content"},tn={class:"classify-scroll-box"},on={key:0,class:"list-item"},nn={class:"list-content"},an={class:"fragment-img"},sn=["src"],ln={class:"import-td-box"},rn={key:0,class:"status-block success"},un={key:1,class:"status-block none"},dn=["href"],_n=["onClick"],mn=["onClick"],cn={__name:"index",setup(H){const K=Ze(),$=qe(),{getRobot:C}=$,i=ae(()=>$.robotInfo),g=ae(()=>i.value.unknown_summary_status==1),l=ue().query;Se(),r(2);const c=P({start_day:"",end_day:""}),a=P({page:1,size:10,total:0}),O=r([]),I=r(!1),h=()=>{let p={robot_id:l.id,...c,...a};I.value=!0,ct({...p}).then(_=>{O.value=_.data.list.map(D=>({...D,images:D.images?JSON.parse(D.images):[],unknown_list:D.unknown_list?JSON.parse(D.unknown_list):[]})),a.total=+_.data.total||0}).finally(()=>{I.value=!1})};h();const S=p=>{let _=K.getToken,D=c.start_day,k=c.end_day,v=`/manage/getUnknownIssueSummary?robot_id=${l.id}&token=${_}&start_day=${D}&end_day=${k}&export=${p}`;window.location.href=v},z=p=>{a.page=p.current,a.size=p.pageSize,h()},N=()=>{a.page=1,h()},y=p=>{c.start_day=p.start_time,c.end_day=p.end_time,N()},s=r(null),m=p=>{s.value.showModal({id:p.id,library_id:p.to_library_id>0?p.to_library_id:"",answer:p.answer,question:p.question,similar_questions:p.unknown_list,images:p.images})},M=r(null),w=()=>{M.value.show({unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:i.value.unknown_summary_status})},q=p=>{p?M.value.show({unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:1}):Ye({id:l.id,unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:0}).then(_=>{Z.success("保存成功"),C(l.id)})},Y=r(null),L=p=>{Y.value.show({id:p.id,question:p.question,answer:p.answer,unknown_list:p.unknown_list.join(`
`),images:p.images})},E=()=>{C(l.id)};return(p,_)=>{const D=Le,k=we,v=xt,Q=ge,j=bt,ee=wt,se=ht,W=$t,V=dt,ce=Dt,pe=ze,ne=nt("viewer");return u(),f("div",Jo,[o(D,{"show-icon":"",style:{"padding-top":"16px"}},{message:n(()=>_[2]||(_[2]=[e("p",null,"1、开启后，系统将自动将语意相近的未知问题聚类，生成聚类问题",-1),e("p",null,"2、您可以将聚类问题导出，添加回复后更新到知识库单面。",-1)])),_:1}),e("div",Po,[e("div",Qo,[_[5]||(_[5]=e("span",null,"自动聚类",-1)),o(k,null,{title:n(()=>_[3]||(_[3]=[x("开启后，系统将自动将语意相近的未知问题累类，生成聚类问题")])),default:n(()=>[o(J(Fe)),_[4]||(_[4]=x("： "))]),_:1,__:[4]}),o(v,{onChange:q,checked:g.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("a",{onClick:w},"设置")]),e("div",Ho,[o(Ve,{datekey:"4",onDateChange:y}),o(Q,{type:"primary",onClick:N},{default:n(()=>_[6]||(_[6]=[x("查询")])),_:1,__:[6]}),o(se,null,{overlay:n(()=>[o(ee,null,{default:n(()=>[o(j,{onClick:_[0]||(_[0]=U=>S("docx")),key:"1"},{default:n(()=>_[7]||(_[7]=[x("下载为docx")])),_:1,__:[7]}),o(j,{onClick:_[1]||(_[1]=U=>S("xlsx")),key:"2"},{default:n(()=>_[8]||(_[8]=[x("下载为xlsx")])),_:1,__:[8]})]),_:1})]),default:n(()=>[o(Q,{type:"primary"},{default:n(()=>[_[9]||(_[9]=x(" 下载 ")),o(J(kt))]),_:1,__:[9]})]),_:1})])]),e("div",Xo,[o(pe,{"data-source":O.value,loading:I.value,pagination:{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:z},{default:n(()=>[o(V,{key:"question",title:"聚类问题",width:480},{default:n(({record:U})=>[e("div",Wo,[e("div",Zo,[_[10]||(_[10]=e("div",{class:"list-label"},"问题",-1)),e("div",en,[x(T(U.question)+" ",1),U.unknown_total>0?(u(),G(W,{key:0,placement:"topLeft"},{content:n(()=>[e("div",tn,[(u(!0),f(B,null,re(U.unknown_list,(te,le)=>(u(),f("div",{class:"list-item",key:le},T(te),1))),128))])]),title:n(()=>[e("span",null,"共聚类了"+T(U.unknown_total)+"个未知问题",1)]),default:n(()=>[e("a",null,"（"+T(U.unknown_total)+"） ",1)]),_:2},1024)):X("",!0)])]),U.answer?(u(),f("div",on,[_[11]||(_[11]=e("div",{class:"list-label"},"答案",-1)),e("div",nn,T(U.answer),1)])):X("",!0),ye((u(),f("div",an,[(u(!0),f(B,null,re(U.images,(te,le)=>(u(),f("img",{key:le,src:te,alt:""},null,8,sn))),128))])),[[ne]])])]),_:1}),o(V,{key:"show_date",title:"触发日期",width:120},{default:n(({record:U})=>[x(T(U.show_date),1)]),_:1}),o(V,{key:"to_library_id",title:"是否导入知识库",width:160},{default:n(({record:U})=>[e("div",ln,[U.to_library_id>0?(u(),f("div",rn,_[12]||(_[12]=[e("span",null,null,-1),x(" 已导入 ")]))):(u(),f("div",un,_[13]||(_[13]=[e("span",null,null,-1),x(" 未导入 ")]))),e("a",{href:`/#/library/details/knowledge-document?id=${U.to_library_id}`,target:"_blank"},T(U.to_library_name),9,dn)])]),_:1}),o(V,{key:"action",title:"操作",width:135},{default:n(({record:U})=>[o(ce,{gap:8},{default:n(()=>[e("a",{onClick:te=>L(U)},"设置答案",8,_n),e("a",{onClick:te=>m(U)},"导入知识库",8,mn)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])]),o(Ro,{onOk:h,ref_key:"importLibraryModalRef",ref:s},null,512),o(Fo,{onOk:E,ref_key:"autoClusterModalRef",ref:M},null,512),o(Bo,{onOk:h,ref_key:"setAnswerModalRef",ref:Y},null,512)])}}},pn=oe(cn,[["__scopeId","data-v-993551f2"]]),vn={class:"user-model-page"},Me="/robot/config/unknown_issue/activeKey",fn={__name:"unknow-index",setup(H){const K=qe(),$=r(+localStorage.getItem(Me)||1),C=ae(()=>K.robotInfo),i=ae(()=>C.value.unknown_summary_status==1),g=()=>{localStorage.setItem(Me,$.value)};return(l,c)=>{const a=he,O=be,I=Je;return u(),f(B,null,[o(O,{class:"tab-wrapper",activeKey:$.value,"onUpdate:activeKey":c[0]||(c[0]=h=>$.value=h),onChange:g},{default:n(()=>[i.value?(u(),f(B,{key:0},[(u(),G(a,{key:2,tab:"未知问题总结"})),(u(),G(a,{key:1,tab:"未知问题统计"}))],64)):(u(),f(B,{key:1},[(u(),G(a,{key:1,tab:"未知问题统计"})),(u(),G(a,{key:2,tab:"未知问题总结"}))],64))]),_:1},8,["activeKey"]),e("div",vn,[o(I,null,{default:n(()=>[$.value==1?(u(),G(Bt,{key:0})):(u(),G(pn,{key:1}))]),_:1})])],64)}}},ja=oe(fn,[["__scopeId","data-v-70d9105a"]]);export{ja as default};
