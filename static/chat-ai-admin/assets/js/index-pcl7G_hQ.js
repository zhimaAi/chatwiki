import{_ as rt}from"./cu-scroll-C_QJcxx1.js";import{aw as et,f as h,q as ct,ac as u,ad as l,k as n,ar as r,at as v,as as i,az as I,n as W,F as B,ax as J,G as g,ae as L,u as p,ah as A,B as Y,r as ut}from"./vue-chunks-CGLjTDrY.js";import{C as _t,S as dt}from"./classification-mark-modal-BIw1WBrz.js";import{_ as st,a_ as pt,az as vt,aY as ft,aB as gt,bB as K,aI as mt}from"../../index-C5-B0r5-.js";import{c as X,E as yt}from"./edit-subsection-xJH9lVnk.js";import{E as ht,bE as bt,ai as kt,v as xt,aR as Ct,al as St,aN as Lt,bz as j,bA as Z,k as qt,h as wt,i as Mt,am as Ot,az as Et,ab as $t,G as zt,b as at,M as tt,W as It,bG as Bt,y as Nt,z as Pt,B as Dt}from"./ui-antd-B11sc9DP.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./index-B2MTQrOC.js";import"./index-GO4nEZEO.js";import"./util-BwuffJOK.js";import"./model-select-DkFuDwQt.js";import"./index-Btdd0zUd.js";import"./editor-code-DDvPSeJb.js";const Rt={class:"subsection-box"},Ft=["onClick"],Ht={key:1,class:"file-name-text",style:{color:"#f40"}},Jt={key:2,class:"qa-list-box"},Qt={class:"list-item"},Vt={class:"list-content"},Tt={key:0,class:"list-item"},Gt={class:"list-content"},At={class:"list-item"},jt={class:"list-content"},Ut={class:"fragment-img"},Wt=["src"],Yt={key:3,class:"common-list-box"},Kt={class:"top-block"},Xt={class:"title"},Zt={class:"title"},te=["innerHTML"],ee={class:"fragment-img"},se=["src"],ae={key:0,class:"status-tag"},ne={key:1,class:"status-tag complete"},ie={class:"status-tag status-error"},oe={key:3,class:"status-tag running"},le={class:"right-opration"},re={key:0,class:"hover-btn-box"},ce={class:"hover-btn-box"},ue=["onClick"],_e=["onClick"],de={class:"hover-btn-box"},pe=["onClick"],ve=["onClick"],fe={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(E,{expose:U,emit:Q}){const N=Q,P=E,d=et().query,m=(c,o)=>{let{id:f,title:x,content:H,question:z,answer:C,images:w,category_id:M,library_id:O}=c,S=c.similar_questions||[];tt.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${o+1}】吗?`,onOk(){return new Promise((e,s)=>{ft({id:f,library_id:O,title:x,content:H,question:z,answer:C,images:w,category_id:M,similar_questions:JSON.stringify(S)}).then(t=>{N("handleConvert",c),e()}).catch(()=>{e()})})},onCancel(){}})},D=c=>{N("openEditSubscription",c)},R=c=>{tt.confirm({title:"提示",icon:n(It),content:"是否取消该标记?",onOk(){k(c,{})},onCancel(){}})},y=h([]),$=()=>{pt({library_id:d.id}).then(c=>{y.value=c.data||[],N("getStatrList",c.data||[])})};$();const b=h(null),q=()=>{b.value.show()},F=c=>{var f;let o=(f=y.value.filter(x=>x.id==c.category_id)[0])==null?void 0:f.type;return o?X[o]:"#F59A23"},k=(c,o={})=>{vt({id:c.id,category_id:o.id||0}).then(f=>{at.success("修改成功"),o.id?c.category_id=o.id:N("handleDelParagraph",c.id),$()})},T=c=>{window.open(`/#/library/preview?id=${c.file_id}`)};return U({handleOpenEditModal:D}),(c,o)=>{const f=ht,x=xt,H=St,z=Lt,C=Mt,w=wt,M=qt,O=zt,S=ct("viewer");return l(),u("div",Rt,[n(O,{"data-source":E.paragraphLists,pagination:!1},{default:r(()=>[n(f,{key:"id","data-index":"id",width:1148},{title:r(()=>[E.isQaLibray?(l(),u(B,{key:0},[g(" 问答（共"+v(P.total)+"个） ",1)],64)):(l(),u(B,{key:1},[g("分段 （共"+v(P.total)+"个分段）",1)],64))]),default:r(({record:e,index:s})=>[e.file_name?(l(),u("a",{key:0,class:"file-name-text",onClick:t=>T(e)},v(e.file_name),9,Ft)):(l(),u("div",Ht,"原文档已删除")),E.isQaLibray?(l(),u("div",Jt,[i("div",Qt,[o[0]||(o[0]=i("div",{class:"list-label"},"问题",-1)),i("div",Vt,v(e.question),1)]),e.similar_questions&&e.similar_questions.length?(l(),u("div",Tt,[o[1]||(o[1]=i("div",{class:"list-label"},"相似问法",-1)),i("div",Gt,v(e.similar_questions.join("/")),1)])):I("",!0),i("div",At,[o[2]||(o[2]=i("div",{class:"list-label"},"答案",-1)),i("div",jt,v(e.answer),1)]),W((l(),u("div",Ut,[(l(!0),u(B,null,J(e.images,(t,_)=>(l(),u("img",{key:_,src:t,alt:""},null,8,Wt))),128))])),[[S]])])):(l(),u("div",Yt,[i("div",Kt,[i("div",Xt,"分段"+v(s+1),1),i("div",Zt,v(e.title),1),i("span",null,"共"+v(e.word_total)+"个字符",1)]),i("div",{class:"content-box",innerHTML:e.content},null,8,te),W((l(),u("div",ee,[(l(!0),u(B,null,J(e.images,(t,_)=>(l(),u("img",{key:_,src:t,alt:""},null,8,se))),128))])),[[S]])]))]),_:1}),n(f,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:r(({record:e})=>[e.status==0?(l(),u("span",ae,[n(p(bt)),o[3]||(o[3]=g(" 未转换",-1))])):I("",!0),e.status==1?(l(),u("span",ne,[n(p(kt)),o[4]||(o[4]=g(" 已转换",-1))])):I("",!0),e.status==2?(l(),L(x,{key:2,placement:"top"},{title:r(()=>[i("span",null,v(e.errmsg),1)]),default:r(()=>[i("span",null,[i("span",ie,[n(p(Ct)),o[5]||(o[5]=g(" 转换异常",-1))])])]),_:2},1024)):I("",!0),e.status==3?(l(),u("span",oe,[n(H,{size:"small"}),o[6]||(o[6]=g(" 转换中",-1))])):I("",!0)]),_:1}),n(f,{title:"操作",key:"action","data-index":"action",width:120},{default:r(({record:e,index:s})=>[i("div",le,[E.isQaLibray?(l(),u("div",re,[e.category_id>0?(l(),L(z,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>k(e,{})},{default:r(()=>[n(p(j),{style:A({color:F(e),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),L(p(Z),{key:1,onClick:t=>k(e,y.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])):(l(),L(M,{key:1},{overlay:r(()=>[n(w,null,{default:r(()=>[(l(!0),u(B,null,J(y.value,t=>(l(),L(C,{key:t.id},{default:r(()=>[i("div",{class:"start-item",onClick:_=>k(e,t)},[n(p(j),{style:A({color:p(X)[t.type]})},null,8,["style"]),i("div",null,v(t.name||"-"),1)],8,ue)]),_:2},1024))),128)),n(C,null,{default:r(()=>[i("div",{class:"start-item",onClick:q},[n(p(Ot)),o[7]||(o[7]=i("div",null,"标记设置",-1))])]),_:1})]),_:2},1024)]),default:r(()=>[i("div",ce,[e.category_id>0?(l(),L(z,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>k(e,{})},{default:r(()=>[n(p(j),{style:A({color:F(e),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),L(p(Z),{key:1,onClick:t=>k(e,y.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024)),n(x,null,{title:r(()=>[...o[8]||(o[8]=[g("重新转换",-1)])]),default:r(()=>[i("div",{class:"hover-btn-box",onClick:t=>m(e,s)},[n(p(Et))],8,_e)]),_:2},1024),n(M,{placement:"bottomRight"},{overlay:r(()=>[n(w,null,{default:r(()=>[n(C,null,{default:r(()=>[i("div",{onClick:Y(t=>D(e),["stop"])},"编辑",8,pe)]),_:2},1024),n(C,null,{default:r(()=>[i("div",{onClick:Y(t=>R(e),["stop"])},"删除",8,ve)]),_:2},1024)]),_:2},1024)]),default:r(()=>[i("div",de,[n(p($t))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),n(_t,{onOk:$,ref_key:"classificationMarkModalRef",ref:b},null,512)])}}},ge=st(fe,[["__scopeId","data-v-226cf81c"]]),me={class:"robot-page"},ye={class:"search-content-block"},he={class:"selct-star-box"},be={class:"scroll-box"},ke={class:"content-block"},xe={__name:"index",setup(E){const Q=gt().type,P=et().query,V=h([]),d=h([]),m=h(0),D={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},R={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},y=h({}),$=s=>{V.value=s},b=h({page:1,size:30}),q=ut({status:-1,category_id:-1,library_id:P.id}),F=()=>{b.value.page=1,m.value=0,d.value=[],e()},k=s=>{q.category_id=s,F()},T=()=>{mt({id:P.id}).then(()=>at.success("操作完成"))},c=h(null),o=s=>{c.value.showModal(JSON.parse(JSON.stringify(s)))},f=s=>{if(!s.id){b.value.page=1,e();return}let t=d.value,_=t.findIndex(a=>a.id==s.id);if(_>-1){let a=t[_];a.title=s.title,a.content=s.content,a.question=s.question,a.answer=s.answer,a.answer=s.answer,a.images=s.images,a.category_id=s.category_id,a.word_total=s.question.length+s.answer.length+s.content.length,a.similar_questions=JSON.parse(s.similar_questions),t.splice(_,1,a),d.value=t}},x=s=>{let t=d.value,_=t.findIndex(a=>a.id==s);_>-1&&(t.splice(_,1),d.value=t,m.value=--m.value,m.value)},H=()=>{S.value||d.value.length>=m.value||z()},z=()=>{b.value.page++,e()},C=()=>{M()};function w(){clearInterval(O),d.value.filter(t=>t.status==3).length?O=setInterval(()=>{M()},5e3):clearInterval(O)}const M=()=>{K({page:1,size:d.value.length,...q}).then(s=>{let _=s.data.list||[];_.forEach(a=>{a.status_text=R[a.status],a.graph_status_text=D[a.graph_status],a.similar_questions&&(a.similar_questions=JSON.parse(a.similar_questions))}),d.value=_,w()})};let O=null;const S=h(!1),e=()=>{S.value=!0,K({...b.value,...q}).then(s=>{S.value=!1;let t=s.data,_=t.list||[];t.info&&(y.value={...t.info,library_id:t.info.id,is_qa_doc:t.info.type==2?1:0}),_.forEach(a=>{a.status_text=R[a.status],a.graph_status_text=D[a.graph_status],a.similar_questions&&(a.similar_questions=JSON.parse(a.similar_questions))}),b.value.page==1&&(d.value=[]),d.value=[...d.value,..._],m.value=t.total,w()})};return e(),(s,t)=>{const _=Pt,a=Nt,nt=Dt,it=Bt,ot=rt;return l(),u("div",me,[i("div",ye,[i("div",he,[p(Q)==0?(l(),L(dt,{key:0,hideId:[0],startLists:V.value,onChange:k},null,8,["startLists"])):I("",!0)]),n(it,null,{default:r(()=>[n(a,{value:q.status,"onUpdate:value":t[0]||(t[0]=G=>q.status=G),placeholder:"请选择",style:{width:"160px"},onChange:F},{default:r(()=>[n(_,{value:-1},{default:r(()=>[...t[1]||(t[1]=[g("全部嵌入状态",-1)])]),_:1}),(l(),u(B,null,J(R,(G,lt)=>n(_,{value:lt},{default:r(()=>[g(v(G),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),n(nt,{onClick:T},{default:r(()=>[...t[2]||(t[2]=[g("重新嵌入向量",-1)])]),_:1})]),_:1})]),i("div",be,[n(ot,{scrollbar:{minSize:0},onOnScrollEnd:H},{default:r(()=>[i("div",ke,[n(ge,{ref:"subsectionBoxRef",isQaLibray:y.value.is_qa_doc,total:m.value,paragraphLists:d.value,onOpenEditSubscription:o,onHandleDelParagraph:x,onHandleConvert:C,onGetStatrList:$},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),n(yt,{detailsInfo:y.value,onHandleEdit:f,onHandleStatrList:$,ref_key:"editSubscriptionRef",ref:c},null,8,["detailsInfo"])])}}},He=st(xe,[["__scopeId","data-v-b5c76612"]]);export{He as default};
