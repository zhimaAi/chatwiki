import{d as A,z as Q,q as be,a as yt,b as z,s as de,e as we,w as ee,h as bt,j as r,F as oe,p as wt,D as Be,l as kt,N as j,O as M,S as ue,a6 as me,U as N,Z as H,k as St,u as se,X as s,H as xt,I as Ct,a1 as he,a5 as it,_ as W,G as Ot,Y as $t,V as Pt,ao as Mt,M as lt,a8 as Xe}from"./vue-chunks-BRsu9_To.js";import{t as L,c5 as Ze,q as X,N as ve,dV as Lt,dW as It,cn as _e,K as We,P as At,I as Se,z as Nt,c9 as ye,A as Ke,dX as jt,dY as zt,ca as Rt,bi as Dt,bo as Et,bB as Tt,bn as Bt,G as st,bk as Ie,bY as Ut,l as Vt,B as qt,d as Ue,M as Gt,k as Ee,dZ as Ft,b as xe,aD as Yt,dE as Ht,bK as Le,aE as Xt,aF as Zt,d_ as Wt,bN as Kt,d$ as Jt,a1 as Qt,bw as en,bx as tn,by as nn}from"../../index-Bo1NSLpy.js";import{h as rt}from"./index-BPmrcBow.js";import{M as on}from"./model-select-BSeLg_eN.js";import{S as an}from"./SettingOutlined-DCgnXzhZ.js";import{Q as ge}from"./QuestionCircleOutlined-VG1FNUnl.js";import"./index-Bb6fuwF7.js";import{_ as ln,R as sn}from"./RadioButton-CWIeNl_M.js";import{S as rn,a as cn,i as un}from"./index-Bs02Ec-o.js";import{_ as dn}from"./index-BtX93E4y.js";import{_ as mn}from"./index-Bbrx8UDU.js";import{_ as ct}from"./index-B4MPC5xv.js";import{_ as pn}from"./index-Dlji98bI.js";import{_ as vn}from"./TextArea--DLJ7VtX.js";import{_ as fn}from"./index-BASw1Isg.js";import{_ as _n}from"./index-DrD42LNC.js";import{M as gn}from"./index-BMSQkwth.js";import"./index-Caod9rOO.js";import{I as hn}from"./Input-CCKFAS4o.js";import{u as yn}from"./useEventBus-BwH2zX88.js";import{C as bn,_ as wn}from"./index-kP7DVVOS.js";import{i as kn}from"./isNumber-DXOrxAqt.js";import{m as Sn,j as ut}from"./index-CuPJUS8f.js";import{u as dt}from"./useMergedState-C0iIHNGF.js";import{L as xn}from"./LeftOutlined-6ERu0fUO.js";import{R as Cn}from"./RightOutlined-zEOifMPB.js";import{E as On}from"./Password-CJww1n-s.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-Cv3f2sEj.js";import"./Checkbox-B_uQPvVs.js";import"./Trigger-DtRTHvld.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./slide-CVAZ5BEM.js";import"./index-BwedndIp.js";import"./List-qVz67bUg.js";import"./DownOutlined-CrhRpWT5.js";import"./CheckOutlined-C6m5maw6.js";import"./SearchOutlined-CFTHZIcT.js";import"./move-DztQgbGg.js";import"./colors-4myZb9T8.js";import"./inputProps--_pnbyjO.js";import"./UpOutlined-DWTDMQqv.js";import"./Search-BF8URtRh.js";import"./isPlainObject-CHj0iPA3.js";import"./index-BeCYXilq.js";function $n(e){const t=A(null),o=Q(L({},e)),i=A([]),a=h=>{t.value===null&&(i.value=[],t.value=Ze(()=>{let g;i.value.forEach(l=>{g=L(L({},g),l)}),L(o,g),t.value=null})),i.value.push(h)};return be(()=>{t.value&&Ze.cancel(t.value)}),[o,a]}function Je(e,t,o,i){const a=t+o,h=(o-i)/2;if(o>i){if(t>0)return{[e]:h};if(t<0&&a<i)return{[e]:-h}}else if(t<0||a>i)return{[e]:t<0?h:-h};return{}}function Pn(e,t,o,i){const{width:a,height:h}=Sn();let g=null;return e<=a&&t<=h?g={x:0,y:0}:(e>a||t>h)&&(g=L(L({},Je("x",o,e,a)),Je("y",i,t,h))),g}var Mn=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(o[i[a]]=e[i[a]]);return o};const Qe=Symbol("previewGroupContext"),Ve={provide:e=>{wt(Qe,e)},inject:()=>yt(Qe,{isPreviewGroup:de(!1),previewUrls:z(()=>new Map),setPreviewUrls:()=>{},current:A(null),setCurrent:()=>{},setShowPreview:()=>{},setMousePosition:()=>{},registerImage:null,rootClassName:""})},Ln=()=>({previewPrefixCls:String,preview:{type:[Boolean,Object],default:!0},icons:{type:Object,default:()=>({})}}),mt=we({compatConfig:{MODE:3},name:"PreviewGroup",inheritAttrs:!1,props:Ln(),setup(e,t){let{slots:o}=t;const i=z(()=>{const S={visible:void 0,onVisibleChange:()=>{},getContainer:void 0,current:0};return typeof e.preview=="object"?ft(e.preview,S):S}),a=Q(new Map),h=A(),g=z(()=>i.value.visible),l=z(()=>i.value.getContainer),E=(S,d)=>{var p,v;(v=(p=i.value).onVisibleChange)===null||v===void 0||v.call(p,S,d)},[U,f]=dt(!!g.value,{value:g,onChange:E}),u=A(null),y=z(()=>g.value!==void 0),I=z(()=>Array.from(a.keys())),w=z(()=>I.value[i.value.current]),b=z(()=>new Map(Array.from(a).filter(S=>{let[,{canPreview:d}]=S;return!!d}).map(S=>{let[d,{url:p}]=S;return[d,p]}))),c=function(S,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;a.set(S,{url:d,canPreview:p})},R=S=>{h.value=S},T=S=>{u.value=S},V=function(S,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=()=>{a.delete(S)};return a.set(S,{url:d,canPreview:p}),v},q=S=>{S==null||S.stopPropagation(),f(!1),T(null)};return ee(w,S=>{R(S)},{immediate:!0,flush:"post"}),bt(()=>{U.value&&y.value&&R(w.value)},{flush:"post"}),Ve.provide({isPreviewGroup:de(!0),previewUrls:b,setPreviewUrls:c,current:h,setCurrent:R,setShowPreview:f,setMousePosition:T,registerImage:V}),()=>{const S=Mn(i.value,[]);return r(oe,null,[o.default&&o.default(),r(pt,X(X({},S),{},{"ria-hidden":!U.value,visible:U.value,prefixCls:e.previewPrefixCls,onClose:q,mousePosition:u.value,src:b.value.get(h.value),icons:e.icons,getContainer:l.value}),null)])}}}),ce={x:0,y:0},In=L(L({},It()),{src:String,alt:String,rootClassName:String,icons:{type:Object,default:()=>({})}}),pt=we({compatConfig:{MODE:3},name:"Preview",inheritAttrs:!1,props:In,emits:["close","afterClose"],setup(e,t){let{emit:o,attrs:i}=t;const{rotateLeft:a,rotateRight:h,zoomIn:g,zoomOut:l,close:E,left:U,right:f,flipX:u,flipY:y}=Q(e.icons),I=de(1),w=de(0),b=Q({x:1,y:1}),[c,R]=$n(ce),T=()=>o("close"),V=de(),q=Q({originX:0,originY:0,deltaX:0,deltaY:0}),S=de(!1),d=Ve.inject(),{previewUrls:p,current:v,isPreviewGroup:n,setCurrent:k}=d,x=z(()=>p.value.size),_=z(()=>Array.from(p.value.keys())),O=z(()=>_.value.indexOf(v.value)),B=z(()=>n.value?p.value.get(v.value):e.src),D=z(()=>n.value&&x.value>1),G=de({wheelDirection:0}),$=()=>{I.value=1,w.value=0,b.x=1,b.y=1,R(ce),o("afterClose")},P=C=>{C?I.value+=.5:I.value++,R(ce)},Y=C=>{I.value>1&&(C?I.value-=.5:I.value--),R(ce)},F=()=>{w.value+=90},K=()=>{w.value-=90},te=()=>{b.x=-b.x},fe=()=>{b.y=-b.y},ne=C=>{C.preventDefault(),C.stopPropagation(),O.value>0&&k(_.value[O.value-1])},m=C=>{C.preventDefault(),C.stopPropagation(),O.value<x.value-1&&k(_.value[O.value+1])},J=ve({[`${e.prefixCls}-moving`]:S.value}),Ne=`${e.prefixCls}-operations-operation`,je=`${e.prefixCls}-operations-icon`,Ce=[{icon:E,onClick:T,type:"close"},{icon:g,onClick:()=>P(),type:"zoomIn"},{icon:l,onClick:()=>Y(),type:"zoomOut",disabled:z(()=>I.value===1)},{icon:h,onClick:F,type:"rotateRight"},{icon:a,onClick:K,type:"rotateLeft"},{icon:u,onClick:te,type:"flipX"},{icon:y,onClick:fe,type:"flipY"}],Oe=()=>{if(e.visible&&S.value){const C=V.value.offsetWidth*I.value,Z=V.value.offsetHeight*I.value,{left:ae,top:re}=ut(V.value),ie=w.value%180!==0;S.value=!1;const le=Pn(ie?Z:C,ie?C:Z,ae,re);le&&R(L({},le))}},ze=C=>{C.button===0&&(C.preventDefault(),C.stopPropagation(),q.deltaX=C.pageX-c.x,q.deltaY=C.pageY-c.y,q.originX=c.x,q.originY=c.y,S.value=!0)},$e=C=>{e.visible&&S.value&&R({x:C.pageX-q.deltaX,y:C.pageY-q.deltaY})},Re=C=>{if(!e.visible)return;C.preventDefault();const Z=C.deltaY;G.value={wheelDirection:Z}},De=C=>{!e.visible||!D.value||(C.preventDefault(),C.keyCode===We.LEFT?O.value>0&&k(_.value[O.value-1]):C.keyCode===We.RIGHT&&O.value<x.value-1&&k(_.value[O.value+1]))},Pe=()=>{e.visible&&(I.value!==1&&(I.value=1),(c.x!==ce.x||c.y!==ce.y)&&R(ce))};let ke=()=>{};return be(()=>{ee([()=>e.visible,S],()=>{ke();let C,Z;const ae=_e(window,"mouseup",Oe,!1),re=_e(window,"mousemove",$e,!1),ie=_e(window,"wheel",Re,{passive:!1}),le=_e(window,"keydown",De,!1);try{window.top!==window.self&&(C=_e(window.top,"mouseup",Oe,!1),Z=_e(window.top,"mousemove",$e,!1))}catch{}ke=()=>{ae.remove(),re.remove(),ie.remove(),le.remove(),C&&C.remove(),Z&&Z.remove()}},{flush:"post",immediate:!0}),ee([G],()=>{const{wheelDirection:C}=G.value;C>0?Y(!0):C<0&&P(!0)})}),Be(()=>{ke()}),()=>{const{visible:C,prefixCls:Z,rootClassName:ae}=e;return r(Lt,X(X({},i),{},{transitionName:e.transitionName,maskTransitionName:e.maskTransitionName,closable:!1,keyboard:!0,prefixCls:Z,onClose:T,afterClose:$,visible:C,wrapClassName:J,rootClassName:ae,getContainer:e.getContainer}),{default:()=>[r("div",{class:[`${e.prefixCls}-operations-wrapper`,ae]},[r("ul",{class:`${e.prefixCls}-operations`},[Ce.map(re=>{let{icon:ie,onClick:le,type:He,disabled:Me}=re;return r("li",{class:ve(Ne,{[`${e.prefixCls}-operations-operation-disabled`]:Me&&(Me==null?void 0:Me.value)}),onClick:le,key:He},[kt(ie,{class:je})])})])]),r("div",{class:`${e.prefixCls}-img-wrapper`,style:{transform:`translate3d(${c.x}px, ${c.y}px, 0)`}},[r("img",{onMousedown:ze,onDblclick:Pe,ref:V,class:`${e.prefixCls}-img`,src:B.value,alt:e.alt,style:{transform:`scale3d(${b.x*I.value}, ${b.y*I.value}, 1) rotate(${w.value}deg)`}},null)]),D.value&&r("div",{class:ve(`${e.prefixCls}-switch-left`,{[`${e.prefixCls}-switch-left-disabled`]:O.value<=0}),onClick:ne},[U]),D.value&&r("div",{class:ve(`${e.prefixCls}-switch-right`,{[`${e.prefixCls}-switch-right-disabled`]:O.value>=x.value-1}),onClick:m},[f])]})}}});var An=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(o[i[a]]=e[i[a]]);return o};const vt=()=>({src:String,wrapperClassName:String,wrapperStyle:{type:Object,default:void 0},rootClassName:String,prefixCls:String,previewPrefixCls:String,width:[Number,String],height:[Number,String],previewMask:{type:[Boolean,Function],default:void 0},placeholder:At.any,fallback:String,preview:{type:[Boolean,Object],default:!0},onClick:{type:Function},onError:{type:Function}}),ft=(e,t)=>{const o=L({},e);return Object.keys(t).forEach(i=>{e[i]===void 0&&(o[i]=t[i])}),o};let Nn=0;const _t=we({compatConfig:{MODE:3},name:"VcImage",inheritAttrs:!1,props:vt(),emits:["click","error"],setup(e,t){let{attrs:o,slots:i,emit:a}=t;const h=z(()=>e.prefixCls),g=z(()=>`${h.value}-preview`),l=z(()=>{const P={visible:void 0,onVisibleChange:()=>{},getContainer:void 0};return typeof e.preview=="object"?ft(e.preview,P):P}),E=z(()=>{var P;return(P=l.value.src)!==null&&P!==void 0?P:e.src}),U=z(()=>e.placeholder&&e.placeholder!==!0||i.placeholder),f=z(()=>l.value.visible),u=z(()=>l.value.getContainer),y=z(()=>f.value!==void 0),I=(P,Y)=>{var F,K;(K=(F=l.value).onVisibleChange)===null||K===void 0||K.call(F,P,Y)},[w,b]=dt(!!f.value,{value:f,onChange:I}),c=A(U.value?"loading":"normal");ee(()=>e.src,()=>{c.value=U.value?"loading":"normal"});const R=A(null),T=z(()=>c.value==="error"),V=Ve.inject(),{isPreviewGroup:q,setCurrent:S,setShowPreview:d,setMousePosition:p,registerImage:v}=V,n=A(Nn++),k=z(()=>e.preview&&!T.value),x=()=>{c.value="normal"},_=P=>{c.value="error",a("error",P)},O=P=>{if(!y.value){const{left:Y,top:F}=ut(P.target);q.value?(S(n.value),p({x:Y,y:F})):R.value={x:Y,y:F}}q.value?d(!0):b(!0),a("click",P)},B=()=>{b(!1),y.value||(R.value=null)},D=A(null);ee(()=>D,()=>{c.value==="loading"&&D.value.complete&&(D.value.naturalWidth||D.value.naturalHeight)&&x()});let G=()=>{};be(()=>{ee([E,k],()=>{if(G(),!q.value)return()=>{};G=v(n.value,E.value,k.value),k.value||G()},{flush:"post",immediate:!0})}),Be(()=>{G()});const $=P=>kn(P)?P+"px":P;return()=>{const{prefixCls:P,wrapperClassName:Y,fallback:F,src:K,placeholder:te,wrapperStyle:fe,rootClassName:ne,width:m,height:J,crossorigin:Ne,decoding:je,alt:Ce,sizes:Oe,srcset:ze,usemap:$e,class:Re,style:De}=L(L({},e),o),Pe=l.value,{icons:ke,maskClassName:C}=Pe,Z=An(Pe,["icons","maskClassName"]),ae=ve(P,Y,ne,{[`${P}-error`]:T.value}),re=T.value&&F?F:E.value,ie={crossorigin:Ne,decoding:je,alt:Ce,sizes:Oe,srcset:ze,usemap:$e,width:m,height:J,class:ve(`${P}-img`,{[`${P}-img-placeholder`]:te===!0},Re),style:L({height:$(J)},De)};return r(oe,null,[r("div",{class:ae,onClick:k.value?O:le=>{a("click",le)},style:L({width:$(m),height:$(J)},fe)},[r("img",X(X(X({},ie),T.value&&F?{src:F}:{onLoad:x,onError:_,src:K}),{},{ref:D}),null),c.value==="loading"&&r("div",{"aria-hidden":"true",class:`${P}-placeholder`},[te||i.placeholder&&i.placeholder()]),i.previewMask&&k.value&&r("div",{class:[`${P}-mask`,C]},[i.previewMask()])]),!q.value&&k.value&&r(pt,X(X({},Z),{},{"aria-hidden":!w.value,visible:w.value,prefixCls:g.value,onClose:B,mousePosition:R.value,src:re,alt:Ce,getContainer:u.value,icons:ke,rootClassName:ne}),null)])}}});_t.PreviewGroup=mt;var jn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z"}},{tag:"path",attrs:{d:"M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z"}}]},name:"rotate-left",theme:"outlined"};function et(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable}))),i.forEach(function(a){zn(e,a,o[a])})}return e}function zn(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var qe=function(t,o){var i=et({},t,o.attrs);return r(Se,et({},i,{icon:jn}),null)};qe.displayName="RotateLeftOutlined";qe.inheritAttrs=!1;var Rn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z"}},{tag:"path",attrs:{d:"M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z"}}]},name:"rotate-right",theme:"outlined"};function tt(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable}))),i.forEach(function(a){Dn(e,a,o[a])})}return e}function Dn(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var Ge=function(t,o){var i=tt({},t,o.attrs);return r(Se,tt({},i,{icon:Rn}),null)};Ge.displayName="RotateRightOutlined";Ge.inheritAttrs=!1;var En={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-in",theme:"outlined"};function nt(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable}))),i.forEach(function(a){Tn(e,a,o[a])})}return e}function Tn(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var Fe=function(t,o){var i=nt({},t,o.attrs);return r(Se,nt({},i,{icon:En}),null)};Fe.displayName="ZoomInOutlined";Fe.inheritAttrs=!1;var Bn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-out",theme:"outlined"};function ot(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable}))),i.forEach(function(a){Un(e,a,o[a])})}return e}function Un(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var Ye=function(t,o){var i=ot({},t,o.attrs);return r(Se,ot({},i,{icon:Bn}),null)};Ye.displayName="ZoomOutOutlined";Ye.inheritAttrs=!1;var Vn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"};function at(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable}))),i.forEach(function(a){qn(e,a,o[a])})}return e}function qn(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var Ae=function(t,o){var i=at({},t,o.attrs);return r(Se,at({},i,{icon:Vn}),null)};Ae.displayName="SwapOutlined";Ae.inheritAttrs=!1;const Te=e=>({position:e||"absolute",inset:0}),Gn=e=>{const{iconCls:t,motionDurationSlow:o,paddingXXS:i,marginXXS:a,prefixCls:h}=e;return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",background:new ye("#000").setAlpha(.5).toRgbString(),cursor:"pointer",opacity:0,transition:`opacity ${o}`,[`.${h}-mask-info`]:L(L({},Dt),{padding:`0 ${i}px`,[t]:{marginInlineEnd:a,svg:{verticalAlign:"baseline"}}})}},Fn=e=>{const{previewCls:t,modalMaskBg:o,paddingSM:i,previewOperationColorDisabled:a,motionDurationSlow:h}=e,g=new ye(o).setAlpha(.1),l=g.clone().setAlpha(.2);return{[`${t}-operations`]:L(L({},Et(e)),{display:"flex",flexDirection:"row-reverse",alignItems:"center",color:e.previewOperationColor,listStyle:"none",background:g.toRgbString(),pointerEvents:"auto","&-operation":{marginInlineStart:i,padding:i,cursor:"pointer",transition:`all ${h}`,userSelect:"none","&:hover":{background:l.toRgbString()},"&-disabled":{color:a,pointerEvents:"none"},"&:last-of-type":{marginInlineStart:0}},"&-progress":{position:"absolute",left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%)"},"&-icon":{fontSize:e.previewOperationSize}})}},Yn=e=>{const{modalMaskBg:t,iconCls:o,previewOperationColorDisabled:i,previewCls:a,zIndexPopup:h,motionDurationSlow:g}=e,l=new ye(t).setAlpha(.1),E=l.clone().setAlpha(.2);return{[`${a}-switch-left, ${a}-switch-right`]:{position:"fixed",insetBlockStart:"50%",zIndex:h+1,display:"flex",alignItems:"center",justifyContent:"center",width:e.imagePreviewSwitchSize,height:e.imagePreviewSwitchSize,marginTop:-e.imagePreviewSwitchSize/2,color:e.previewOperationColor,background:l.toRgbString(),borderRadius:"50%",transform:"translateY(-50%)",cursor:"pointer",transition:`all ${g}`,pointerEvents:"auto",userSelect:"none","&:hover":{background:E.toRgbString()},"&-disabled":{"&, &:hover":{color:i,background:"transparent",cursor:"not-allowed",[`> ${o}`]:{cursor:"not-allowed"}}},[`> ${o}`]:{fontSize:e.previewOperationSize}},[`${a}-switch-left`]:{insetInlineStart:e.marginSM},[`${a}-switch-right`]:{insetInlineEnd:e.marginSM}}},Hn=e=>{const{motionEaseOut:t,previewCls:o,motionDurationSlow:i,componentCls:a}=e;return[{[`${a}-preview-root`]:{[o]:{height:"100%",textAlign:"center",pointerEvents:"none"},[`${o}-body`]:L(L({},Te()),{overflow:"hidden"}),[`${o}-img`]:{maxWidth:"100%",maxHeight:"100%",verticalAlign:"middle",transform:"scale3d(1, 1, 1)",cursor:"grab",transition:`transform ${i} ${t} 0s`,userSelect:"none",pointerEvents:"auto","&-wrapper":L(L({},Te()),{transition:`transform ${i} ${t} 0s`,display:"flex",justifyContent:"center",alignItems:"center","&::before":{display:"inline-block",width:1,height:"50%",marginInlineEnd:-1,content:'""'}})},[`${o}-moving`]:{[`${o}-preview-img`]:{cursor:"grabbing","&-wrapper":{transitionDuration:"0s"}}}}},{[`${a}-preview-root`]:{[`${o}-wrap`]:{zIndex:e.zIndexPopup}}},{[`${a}-preview-operations-wrapper`]:{position:"fixed",insetBlockStart:0,insetInlineEnd:0,zIndex:e.zIndexPopup+1,width:"100%"},"&":[Fn(e),Yn(e)]}]},Xn=e=>{const{componentCls:t}=e;return{[t]:{position:"relative",display:"inline-block",[`${t}-img`]:{width:"100%",height:"auto",verticalAlign:"middle"},[`${t}-img-placeholder`]:{backgroundColor:e.colorBgContainerDisabled,backgroundImage:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQuNSAyLjVoLTEzQS41LjUgMCAwIDAgMSAzdjEwYS41LjUgMCAwIDAgLjUuNWgxM2EuNS41IDAgMCAwIC41LS41VjNhLjUuNSAwIDAgMC0uNS0uNXpNNS4yODEgNC43NWExIDEgMCAwIDEgMCAyIDEgMSAwIDAgMSAwLTJ6bTguMDMgNi44M2EuMTI3LjEyNyAwIDAgMS0uMDgxLjAzSDIuNzY5YS4xMjUuMTI1IDAgMCAxLS4wOTYtLjIwN2wyLjY2MS0zLjE1NmEuMTI2LjEyNiAwIDAgMSAuMTc3LS4wMTZsLjAxNi4wMTZMNy4wOCAxMC4wOWwyLjQ3LTIuOTNhLjEyNi4xMjYgMCAwIDEgLjE3Ny0uMDE2bC4wMTUuMDE2IDMuNTg4IDQuMjQ0YS4xMjcuMTI3IDAgMCAxLS4wMi4xNzV6IiBmaWxsPSIjOEM4QzhDIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L3N2Zz4=')",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"30%"},[`${t}-mask`]:L({},Gn(e)),[`${t}-mask:hover`]:{opacity:1},[`${t}-placeholder`]:L({},Te())}}},Zn=e=>{const{previewCls:t}=e;return{[`${t}-root`]:Rt(e,"zoom"),"&":zt(e,!0)}},gt=Nt("Image",e=>{const t=`${e.componentCls}-preview`,o=Ke(e,{previewCls:t,modalMaskBg:new ye("#000").setAlpha(.45).toRgbString(),imagePreviewSwitchSize:e.controlHeightLG});return[Xn(o),Hn(o),jt(Ke(o,{componentCls:t})),Zn(o)]},e=>({zIndexPopup:e.zIndexPopupBase+80,previewOperationColor:new ye(e.colorTextLightSolid).toRgbString(),previewOperationColorDisabled:new ye(e.colorTextLightSolid).setAlpha(.25).toRgbString(),previewOperationSize:e.fontSizeIcon*1.5})),ht={rotateLeft:r(qe,null,null),rotateRight:r(Ge,null,null),zoomIn:r(Fe,null,null),zoomOut:r(Ye,null,null),close:r(Tt,null,null),left:r(xn,null,null),right:r(Cn,null,null),flipX:r(Ae,null,null),flipY:r(Ae,{rotate:90},null)},Wn=()=>({previewPrefixCls:String,preview:Bt()}),Kn=we({compatConfig:{MODE:3},name:"AImagePreviewGroup",inheritAttrs:!1,props:Wn(),setup(e,t){let{attrs:o,slots:i}=t;const{prefixCls:a,rootPrefixCls:h}=st("image",e),g=z(()=>`${a.value}-preview`),[l,E]=gt(a),U=z(()=>{const{preview:f}=e;if(f===!1)return f;const u=typeof f=="object"?f:{};return L(L({},u),{rootClassName:E.value,transitionName:Ie(h.value,"zoom",u.transitionName),maskTransitionName:Ie(h.value,"fade",u.maskTransitionName)})});return()=>l(r(mt,X(X({},L(L({},o),e)),{},{preview:U.value,icons:ht,previewPrefixCls:g.value}),i))}}),pe=we({name:"AImage",inheritAttrs:!1,props:vt(),setup(e,t){let{slots:o,attrs:i}=t;const{prefixCls:a,rootPrefixCls:h,configProvider:g}=st("image",e),[l,E]=gt(a),U=z(()=>{const{preview:f}=e;if(f===!1)return f;const u=typeof f=="object"?f:{};return L(L({icons:ht},u),{transitionName:Ie(h.value,"zoom",u.transitionName),maskTransitionName:Ie(h.value,"fade",u.maskTransitionName)})});return()=>{var f,u;const y=((u=(f=g.locale)===null||f===void 0?void 0:f.value)===null||u===void 0?void 0:u.Image)||Ut.Image,I=()=>r("div",{class:`${a.value}-mask-info`},[r(On,null,null),y==null?void 0:y.preview]),{previewMask:w=o.previewMask||I}=e;return l(r(_t,X(X({},L(L(L({},i),e),{prefixCls:a.value})),{},{preview:U.value,rootClassName:ve(e.rootClassName,E.value)}),L(L({},o),{previewMask:typeof w=="function"?w:null})))}}});pe.PreviewGroup=Kn;pe.install=function(e){return e.component(pe.name,pe),e.component(pe.PreviewGroup.name,pe.PreviewGroup),e};const Jn={class:"prompt-form"},Qn={class:"form-item"},eo={class:"form-item-label"},to={class:"prompt-form-item"},no={class:"prompt-form-item"},oo={class:"prompt-form-item-content"},ao={key:0,class:"prompt-form-item-tip"},io={class:"prompt-form-item"},lo={class:"prompt-form-item-label"},so={class:"form-item-body"},ro={class:"number-box"},co={class:"number-slider-box"},uo={class:"number-input-box"},mo={class:"prompt-form-item"},po={class:"prompt-form-item-label"},vo={class:"form-item-body"},fo={class:"number-box"},_o={class:"number-slider-box"},go={class:"number-input-box"},ho={class:"recall-settings-box"},yo={class:"form-box prompt-form"},bo={class:"form-item is-required"},wo={class:"form-item-body"},ko={class:"retrieval-mode-items"},So=["onClick"],xo={class:"retrieval-mode-title"},Co={class:"title-text"},Oo={class:"retrieval-mode-desc"},$o={class:"form-item"},Po={class:"form-item-label"},Mo={class:"form-item-body"},Lo={class:"number-box"},Io={class:"number-slider-box"},Ao={class:"number-input-box"},No={key:0,class:"form-item"},jo={class:"form-item-label"},zo={class:"form-item-body"},Ro={class:"number-box"},Do={class:"number-slider-box"},Eo={class:"number-input-box"},To={class:"form-item"},Bo={class:"form-item-label"},Uo={key:0,class:"form-item-body"},Vo=["src"],qo=we({__name:"search-drawer",props:{librarySearchData:{type:Object,default:null},defaultLibrarySearchData:{type:Object,default:null}},setup(e){let{role_permission:t,role_type:o}=Vt();const i=z(()=>o==1||t.includes("SearchSets")),a=e,h=A([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),g=A(!1),l=Q({use_model:"",model_config_id:"",prompt_type:"0",prompt:"",temperature:.5,max_token:2e3,context_pair:0,search_type:1,top_k:5,size:0,similarity:.4,rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,summary_switch:0}),E=A([]),U=()=>{rt({model_type:"RERANK"}).then(v=>{let n=v.data||[];E.value=n.map(k=>({id:k.model_config.id,name:k.model_info.model_name,icon:k.model_info.model_icon_url,children:k.model_info.rerank_model_list}))})},f=(v,n)=>{l.use_model=n.modelName,l.model_config_id=n.modelId,c()},u=A([]),y=v=>{var n,k,x,_,O;if(u.value=v,!((n=a.librarySearchData)!=null&&n.model_config_id)||!((k=a.librarySearchData)!=null&&k.use_model)){if(u.value.length>0){let B=u.value[0];if(B){let D=B.children[0];l.use_model=D.name,l.model_config_id=D.model_config_id}}}else l.use_model=((x=a.librarySearchData)==null?void 0:x.use_model)+"$$",l.model_config_id=((_=a.librarySearchData)==null?void 0:_.model_config_id)+"$$",l.use_model=l.use_model.split("$$")[0],l.model_config_id=(O=a.librarySearchData)==null?void 0:O.model_config_id.split("$$")[0]},I=v=>{l.search_type=v,c()},w=(v,n)=>{l.rerank_model_config_id=n.rerank_model_config_id,c()},b=v=>{let n={...v};n.max_token=parseFloat(n.max_token),n.temperature=parseFloat(n.temperature),n.context_pair=parseFloat(n.context_pair),n.search_type=parseFloat(n.search_type),n.rerank_status=parseFloat(n.rerank_status),n.similarity=parseFloat(n.similarity),n.top_k=parseFloat(n.size),n.summary_switch=+n.summary_switch,n.rerank_use_model===""&&(n.rerank_use_model=void 0),Object.keys(n).forEach(k=>{l[k]=n[k]})},c=()=>{let v={...l};if(!v.prompt&&l.prompt_type=="1")return Ee.error("请输入自定义提示词");(l.search_type==3||l.search_type==4)&&delete v.similarity,l.prompt_type=="0"&&delete v.prompt,v.size=v.top_k,Ft(v).then(n=>{Ee.success("保存成功")})},R=A(!1),T=A(""),V=()=>{l.prompt_type=="1"?(T.value=l.prompt,R.value=!0):c()},q=()=>{if(T.value)l.prompt=T.value,R.value=!1,c();else return Ee.error("请输入提示语")},S=()=>{l.prompt_type="0",R.value=!1},d=v=>{},p=()=>{g.value=!0};return ee(()=>a.librarySearchData,v=>{var n;(n=a.librarySearchData)!=null&&n.id&&b({...Ot(a.librarySearchData)})}),be(()=>{U()}),(v,n)=>{const k=qt,x=ct,_=pn,O=mn,B=sn,D=ln,G=vn,$=fn,P=_n,Y=Ue,F=cn,K=un,te=rn,fe=Gt,ne=dn;return M(),j(oe,null,[i.value?(M(),ue(k,{key:0,onClick:p,icon:St(se(an))},{default:N(()=>n[18]||(n[18]=[H("搜索设置")])),_:1,__:[18]},8,["icon"])):me("",!0),r(ne,{open:g.value,"onUpdate:open":n[17]||(n[17]=m=>g.value=m),class:"custom-class","root-class-name":"root-class-name",title:"搜索设置",width:"472",placement:"right",onAfterOpenChange:d},{default:N(()=>[s("div",Jn,[n[29]||(n[29]=s("div",{class:"prompt-form-label"},"模型设置",-1)),s("div",Qn,[s("div",eo,[r(O,{align:"center"},{default:N(()=>[n[20]||(n[20]=s("span",null,"AI智能总结",-1)),r(x,null,{title:N(()=>n[19]||(n[19]=[H("开启后，搜索知识库时，由大模型自动总结文档，并给出总结后的结果")])),default:N(()=>[r(se(ge),{class:"question-icon"})]),_:1}),r(_,{style:{"margin-left":"24px"},onChange:f,checked:l.summary_switch,"onUpdate:checked":n[0]||(n[0]=m=>l.summary_switch=m),checkedValue:1,unCheckedValue:0,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[20]})])]),xt(s("div",null,[s("div",to,[n[21]||(n[21]=s("div",{class:"prompt-form-item-label"},[s("span",{style:{color:"red"}},"* "),s("span",null,"模型选择")],-1)),r(on,{modelType:"LLM",modeName:l.use_model,"onUpdate:modeName":n[1]||(n[1]=m=>l.use_model=m),modeId:l.model_config_id,"onUpdate:modeId":n[2]||(n[2]=m=>l.model_config_id=m),style:{width:"100%"},onLoaded:y,onChange:f},null,8,["modeName","modeId"])]),s("div",no,[n[24]||(n[24]=s("div",{class:"prompt-form-item-label"},[s("span",{style:{color:"red"}},"* "),s("span",null,"提示词")],-1)),r(D,{value:l.prompt_type,"onUpdate:value":n[3]||(n[3]=m=>l.prompt_type=m),onChange:V},{default:N(()=>[r(B,{value:"0"},{default:N(()=>n[22]||(n[22]=[H("默认提示词")])),_:1,__:[22]}),r(B,{value:"1"},{default:N(()=>n[23]||(n[23]=[H("自定义提示词")])),_:1,__:[23]})]),_:1},8,["value"]),s("div",oo,[l.prompt_type=="0"?(M(),j("div",ao,"将提交的内容进行智能总结,不要随意发挥")):(M(),ue(G,{key:1,onBlur:c,maxLength:500,style:{height:"80px"},value:l.prompt,"onUpdate:value":n[4]||(n[4]=m=>l.prompt=m),placeholder:"请输入自定义提示词"},null,8,["value"]))])]),s("div",io,[s("div",lo,[n[26]||(n[26]=s("span",null,"温度",-1)),r(x,null,{title:N(()=>n[25]||(n[25]=[H("温度越低，回答越严谨。温度越高，回答越发散。")])),default:N(()=>[r(se(ge),{class:"question-icon"})]),_:1})]),s("div",so,[s("div",ro,[s("div",co,[r($,{onBlur:c,class:"custom-slider",value:l.temperature,"onUpdate:value":n[5]||(n[5]=m=>l.temperature=m),min:0,max:2,step:.1},null,8,["value"])]),s("div",uo,[r(P,{onBlur:c,value:l.temperature,"onUpdate:value":n[6]||(n[6]=m=>l.temperature=m),min:0,max:2,step:.1},null,8,["value"])])])])]),s("div",mo,[s("div",po,[n[28]||(n[28]=s("span",null,"最大token",-1)),r(x,null,{title:N(()=>n[27]||(n[27]=[s("div",null,"问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])),default:N(()=>[r(se(ge),{class:"question-icon"})]),_:1})]),s("div",vo,[s("div",fo,[s("div",_o,[r($,{onBlur:c,class:"custom-slider",value:l.max_token,"onUpdate:value":n[7]||(n[7]=m=>l.max_token=m),min:0,max:100*1024},null,8,["value"])]),s("div",go,[r(P,{onBlur:c,value:l.max_token,"onUpdate:value":n[8]||(n[8]=m=>l.max_token=m),min:0,max:100*1024},null,8,["value"])])])])])],512),[[Ct,l.summary_switch==1]])]),s("div",ho,[s("div",yo,[n[37]||(n[37]=s("div",{class:"prompt-form-label"},"召回设置",-1)),s("div",bo,[n[30]||(n[30]=s("div",{class:"form-item-label"},[s("span",null,"检索模式")],-1)),s("div",wo,[s("div",ko,[(M(!0),j(oe,null,he(h.value,m=>(M(),j("div",{class:it(["retrieval-mode-item",{active:l.search_type==m.value}]),key:m.value,onClick:J=>I(m.value)},[l.search_type==m.value?(M(),ue(Y,{key:0,class:"check-arrow",name:"check-arrow-filled"})):me("",!0),s("div",xo,[r(Y,{name:m.iconName,class:"title-icon"},null,8,["name"]),s("span",Co,W(m.title),1),m.isRecommendation?(M(),ue(Y,{key:0,class:"recommendation-icon",name:"recommendation"})):me("",!0)]),s("div",Oo,W(m.desc),1)],10,So))),128))])])]),s("div",$o,[s("div",Po,[n[32]||(n[32]=s("span",null,"Top K ",-1)),r(x,null,{title:N(()=>n[31]||(n[31]=[H("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:N(()=>[r(se(ge),{class:"question-icon"})]),_:1})]),s("div",Mo,[s("div",Lo,[s("div",Io,[r($,{onBlur:c,class:"custom-slider",value:l.top_k,"onUpdate:value":n[9]||(n[9]=m=>l.top_k=m),min:1,max:10},null,8,["value"])]),s("div",Ao,[r(P,{onBlur:c,value:l.top_k,"onUpdate:value":n[10]||(n[10]=m=>l.top_k=m),min:1,max:10},null,8,["value"])])])])]),l.search_type!=3&&l.search_type!=4?(M(),j("div",No,[s("div",jo,[n[34]||(n[34]=s("span",null,"相似度阈值 ",-1)),r(x,null,{title:N(()=>n[33]||(n[33]=[H("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:N(()=>[r(se(ge),{class:"question-icon"})]),_:1})]),s("div",zo,[s("div",Ro,[s("div",Do,[r($,{onBlur:c,class:"custom-slider",value:l.similarity,"onUpdate:value":n[11]||(n[11]=m=>l.similarity=m),min:0,max:1,step:.01},null,8,["value"])]),s("div",Eo,[r(P,{onBlur:c,value:l.similarity,"onUpdate:value":n[12]||(n[12]=m=>l.similarity=m),min:0,max:1,step:.01},null,8,["value"])])])])])):me("",!0),s("div",To,[s("div",Bo,[n[36]||(n[36]=s("span",null,"Rerank模型 ",-1)),r(x,null,{title:N(()=>n[35]||(n[35]=[H("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:N(()=>[r(se(ge),{class:"question-icon"})]),_:1}),r(_,{onChange:c,style:{float:"right"},checkedValue:1,unCheckedValue:0,checked:l.rerank_status,"onUpdate:checked":n[13]||(n[13]=m=>l.rerank_status=m),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),l.rerank_status==1?(M(),j("div",Uo,[r(te,{value:l.rerank_use_model,"onUpdate:value":n[14]||(n[14]=m=>l.rerank_use_model=m),placeholder:"请选择Rerank模型",onChange:w,style:{width:"100%"}},{default:N(()=>[(M(!0),j(oe,null,he(E.value,m=>(M(),ue(K,{key:m.id},{label:N(()=>[r(O,{align:"center",gap:8},{default:N(()=>[s("img",{class:"model-icon",src:m.icon,alt:""},null,8,Vo),H(W(m.name),1)]),_:2},1024)]),default:N(()=>[(M(!0),j(oe,null,he(m.children,J=>(M(),ue(F,{value:J,rerank_model_config_id:m.id,key:J},{default:N(()=>[s("span",null,W(J),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):me("",!0)])])]),r(fe,{open:R.value,"onUpdate:open":n[16]||(n[16]=m=>R.value=m),onCancel:S,title:"请输入自定义提示词",onOk:q},{default:N(()=>[r(G,{value:T.value,"onUpdate:value":n[15]||(n[15]=m=>T.value=m),placeholder:"请输入",style:{"min-height":"300px"},"allow-clear":""},null,8,["value"])]),_:1},8,["open"])]),_:1},8,["open"])],64)}}}),Go=xe(qo,[["__scopeId","data-v-cc7c1d60"]]),Fo={class:"no-data"},Yo={class:"no-data-text"},Ho={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(e){const t=e;return(o,i)=>{const a=Ue;return M(),j("div",Fo,[r(a,{name:"empty-document",style:$t({"font-size":`${t.size}px`,color:"white"})},null,8,["style"]),s("div",Yo,[Pt(o.$slots,"default",{},()=>[H(W(t.text),1)],!0)])])}}},Xo=xe(Ho,[["__scopeId","data-v-22b194ba"]]),Zo={class:"search-box-warpper"},Wo={class:"search-box-content"},Ko={class:"search-set-box"},Jo={key:0,class:"search-content"},Qo={class:"search-input-box"},ea={key:1,class:"search-content search-main"},ta={class:"search-input-box"},na={key:1,class:"search-content-box"},oa={class:"search-tip-box"},aa={key:0,class:"tip"},ia={key:1,class:"tip complete"},la={key:0,class:"container"},sa={key:1,class:"intelligent-answer"},ra=["innerHTML"],ca={key:1},ua={class:"section-box"},da={key:0,class:"section-label"},ma={class:"section-item-nav"},pa={class:"section-item-nav-left"},va=["onClick"],fa={key:0},_a={class:"section-item-nav-right"},ga=["innerHTML"],ha={__name:"search-box",props:{librarySearchData:{type:Object,default:null},messageObj:{type:Object,default:null},library_ids:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1}},emits:["search","defaultParmas"],setup(e,{expose:t,emit:o}){const i=o,a=e,h=new gn({html:!0,linkify:!0,typographer:!0}),g=A(""),l=A(""),E=A(!1),U=A(!1),f=A({});ee(()=>a.messageObj.content,()=>{g.value=h.render(a.messageObj.content)}),ee(()=>a.messageObj.error,d=>{d&&Le(d)});const u=async()=>{if(!a.library_ids.length)return Le("请在左侧的知识库选择项内至少选择一个知识库");if(!l.value)return Le("请输入消息内容");i("search",l.value),E.value=!0};function y(d){return d.match(/^-?\d+(?:\.\d{0,2})?/)[0]}const I=(d,p)=>{if(!d||!p.trim())return d;const v=p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${v})`,"gi");return d.replace(n,'<span class="highlight">$1</span>')},w=d=>{if(!d.file_name){window.open(`#/library/details/categary-manage?id=${d.library_id}`);return}window.open(`#/library/preview?id=${d.file_id}`)},b=A(a.librarySearchData),c=Q({rerank_status:"",rerank_use_model:"",prompt:"",model_config_id:"",use_model:"",temperature:.5,max_token:2e3,similarity:.4,search_type:1,summary_switch:0}),R=A({}),T=d=>{b.value=d;let p={model_config_id:d.model_config_id||c.model_config_id,use_model:d.use_model||c.use_model,temperature:d.temperature||c.temperature,max_token:d.max_token||c.max_token,size:200,similarity:d.similarity||c.similarity,search_type:d.search_type||c.search_type,summary_switch:d.summary_switch||c.summary_switch,question:l.value,id:a.library_ids.join(","),recall_type:1};d.rerank_status&&(p.rerank_status=d.rerank_status),d.rerank_use_model&&(p.rerank_use_model=d.rerank_use_model),d.prompt&&(p.prompt=d.prompt),d.rerank_status==1&&(p.rerank_model_config_id=d.rerank_model_config_id),U.value=!0,R.value=Object.assign(p),i("defaultParmas",R.value),Ht(p).then(v=>{f.value=v.data}).catch(()=>{}).finally(()=>{U.value=!1})},V=A([]);function q(d,p,v){const n=new Set(d.map(k=>k.model_define));return p.filter(k=>{let x=k[v];n.has(x)&&d.filter(_=>{if(_.model_define==x)return _.children=Xt(_.children,k.children),!1})}),d}const S=async()=>{await rt({model_type:"LLM"}).then(d=>{let p=d.data||[],v=[];V.value=p.map(n=>{v=[];for(let k=0;k<n.model_info.llm_model_list.length;k++){const x=n.model_info.llm_model_list[k];v.push({name:x,deployment_name:n.model_config.deployment_name,model_config_id:n.model_config.id,model_define:n.model_info.model_define})}return{model_config_id:n.model_config.id,name:n.model_info.model_name,model_define:n.model_info.model_define,icon:n.model_info.model_icon_url,children:v,deployment_name:n.model_config.deployment_name}}),V.value=q(Yt(V.value,"model_define"),V.value,"model_define")})};return be(async()=>{await S(),setTimeout(()=>{var d,p,v,n,k;if(b.value=a.librarySearchData,a.librarySearchData,!((d=b.value)!=null&&d.model_config_id)||!((p=b.value)!=null&&p.use_model)){if(V.value.length>0){let x=V.value[0];if(x){let _=x.children[0];c.use_model=_.name,c.model_config_id=_.model_config_id}}}else c.use_model=((v=b.value)==null?void 0:v.use_model)+"$$",c.model_config_id=((n=b.value)==null?void 0:n.model_config_id)+"$$",c.use_model=c.use_model.split("$$")[0],c.model_config_id=(k=b.value)==null?void 0:k.model_config_id.split("$$")[0]},500)}),t({handleRecallTest:T}),(d,p)=>{const v=Ue,n=hn,k=ct;return M(),j("div",Zo,[s("div",Wo,[s("div",Ko,[r(Go,{librarySearchData:b.value},null,8,["librarySearchData"])]),E.value?(M(),j("div",ea,[s("div",ta,[r(n,{class:"search-input",onPressEnter:u,value:l.value,"onUpdate:value":p[1]||(p[1]=x=>l.value=x),"allow-clear":"",placeholder:"输入关键词搜索"},{suffix:N(()=>[s("div",{class:"search-icon-box",onClick:u},[r(v,{class:"search-icon",name:"search-right"})])]),_:1},8,["value"])]),!g.value&&e.messageObj.finish&&!f.value.length?(M(),ue(Xo,{key:0,style:{"margin-top":"100px"},size:"250"},{default:N(()=>p[4]||(p[4]=[s("div",null,[s("p",{style:{color:"#262626","font-size":"16px","font-weight":"600","line-height":"24px"}},"暂无任何内容")],-1)])),_:1,__:[4]})):(M(),j("div",na,[s("div",oa,[r(v,{class:"nav-icon",name:"search-tip"}),e.messageObj.finish?(M(),j("span",ia,"智能回答生成完毕")):(M(),j("span",aa,"智能回答生成中..."))]),!e.messageObj.content&&!e.messageObj.finish&&!e.isError?(M(),j("div",la,p[5]||(p[5]=[Mt('<div class="rect-container rect1" data-v-878c4db9><div class="rect" data-v-878c4db9></div></div><div class="rect-container rect2" data-v-878c4db9><div class="rect" data-v-878c4db9></div></div><div class="rect-container rect3" data-v-878c4db9><div class="rect" data-v-878c4db9></div></div>',3)]))):(M(),j("div",sa,[g.value?(M(),j("div",{key:0,innerHTML:g.value},null,8,ra)):(M(),j("div",ca,"暂无任何内容"))])),s("div",ua,[p[7]||(p[7]=s("div",{class:"tips"},[s("div",{class:"tips-text"},"以上内容由大模型生成"),s("div",{class:"tips-line"})],-1)),f.value.length?(M(),j("div",da,[p[6]||(p[6]=H("相关分段 ")),s("div",null,"("+W(f.value.length)+")",1)])):me("",!0),(M(!0),j(oe,null,he(f.value,x=>(M(),j("div",{class:"section-item",key:x.id},[s("div",ma,[s("div",pa,[r(v,{class:"section-item-icon",name:"document"}),s("div",{class:"section-item-label",onClick:_=>w(x)},[H(W(x.file_name),1),x.file_name?me("",!0):(M(),j("span",fa,W(x.library_name)+"-精选",1))],8,va)]),s("div",_a,"相似度："+W(y(x.similarity)),1)]),r(k,{overlayClassName:"search-content-tip",placement:"top"},{title:N(()=>[H(W(x.content),1)]),default:N(()=>[s("div",{class:"section-item-content",innerHTML:I(x.content,l.value)},null,8,ga)]),_:2},1024)]))),128))])]))])):(M(),j("div",Jo,[p[2]||(p[2]=s("div",{class:"search-label"},"知识搜索",-1)),p[3]||(p[3]=s("div",{class:"search-tip"},"快速搜索所选择的知识库中内容",-1)),s("div",Qo,[r(n,{class:"search-input",onPressEnter:u,value:l.value,"onUpdate:value":p[0]||(p[0]=x=>l.value=x),"allow-clear":"",placeholder:"输入关键词搜索"},{suffix:N(()=>[s("div",{class:"search-icon-box",onClick:u},[r(v,{class:"search-icon",name:"search-right"})])]),_:1},8,["value"])])]))])])}}},ya=xe(ha,[["__scopeId","data-v-878c4db9"]]),ba={class:"cu-tabs"},wa=["onClick"],ka={__name:"contain-tabs",props:{value:{type:[Number,String],required:!0},tabs:{type:Array,required:!0,default:()=>[]}},emits:["update:value","change"],setup(e,{emit:t}){const o=t,i=e,a=h=>{o("update:value",h),o("change",h)};return(h,g)=>(M(),j("div",ba,[(M(!0),j(oe,null,he(e.tabs,l=>(M(),j("div",{class:it(["tab-item",{active:i.value===l.value}]),onClick:E=>a(l.value),key:l.value},W(l.title),11,wa))),128))]))}},Sa=xe(ka,[["__scopeId","data-v-9397dcbb"]]),xa=lt("searchStore",{state:()=>({indeterminate:!1,checkAll:!1,checkedList:[],activeKey:"all"}),getters:{getIndeterminate(){return this.indeterminate},getCheckAll(){return this.checkAll},getCheckedList(){return this.checkedList},getActiveKey(){return this.activeKey}},actions:{setIndeterminate(e){this.indeterminate=e},setCheckAll(e){this.checkAll=e},setCheckedList(e){this.checkedList=e},setActiveKey(e){this.activeKey=e}},persist:{enabled:!0,strategies:[{key:"searchStore",storage:localStorage,paths:["indeterminate","checkAll","checkedList","activeKey"]}]}}),Ca=lt("search-lirary",()=>{const e=yn(),t=Q({reasoning_content:"",show_reasoning:!1,content:"",quote_file:[],id:"",finish:!1,debug:[],error:[],recall_time:0,request_time:0,loading:!1});let o=null;const i=A(0),a=A(""),h=Q({context_pair:"",create_time:"",id:"",max_token:"",model_config_id:"",rerank_model_config_id:"",rerank_status:"",rerank_use_model:"",search_type:"",similarity:"",size:"",temperature:"",update_time:"",use_model:"",user_id:"",summary_switch:0}),g=(f,u)=>{if(f=="reasoning_content"){let y=t.reasoning_content||"";t.reasoning_content=y+u,t.show_reasoning=!0}if(f=="sending"){let y=t.content||"";t.content=y+u}if(f=="quote_file"&&(t.quote_file=u.length>0?u:[]),f=="ai_message"){if(u.menu_json&&u.msg_type==2){let y=JSON.parse(u.menu_json);t.question=y.question}t.id=u.id,t.content=u.content,u.quote_file&&typeof u.quote_file=="string"&&(t.quote_file=JSON.parse(u.quote_file))}f=="finish"&&(t.finish=!0),f=="debug"&&(t.debug=u.length>0?u:[]),f=="error"&&(t.error=u.length>0?u:[]),f=="recall_time"&&(t.recall_time=u||0),f=="request_time"&&(t.request_time=u||0),e.emit("updateAiMessage",t)},l=()=>{t.loading=!1};return{searchFormState:h,dialogue_id:i,openid:a,messageObj:t,getLibrarySearchFn:async()=>{o&&(o.abort(),o=null);const f=await Jt();try{let u=f.data;Object.assign(h,{...u})}catch(u){Promise.reject(u)}return f},searchMessage:(f,u,y)=>{Zt(32),t.content="",t.finish=!1;let I={model_config_id:y.model_config_id,use_model:y.use_model,temperature:y.temperature,max_token:y.max_token,size:y.size,similarity:y.similarity,search_type:y.search_type,question:f,id:u.join(","),recall_type:1,summary_switch:y.summary_switch};y.rerank_status&&(I.rerank_status=y.rerank_status),y.rerank_use_model&&(I.rerank_use_model=y.rerank_use_model),y.prompt&&(I.prompt=y.prompt),y.rerank_status==1&&(I.rerank_model_config_id=y.rerank_model_config_id),o=Wt(I),o.onMessage=w=>{if(w.event!=="sending"&&Kt(w),w.event=="dialogue_id"&&(i.value=w.data),w.event=="reasoning_content"&&g("reasoning_content",w.data),w.event=="sending"&&g("sending",w.data),w.event=="ai_message"){let b=JSON.parse(w.data);g("ai_message",b)}if(w.event=="quote_file"){let b=JSON.parse(w.data);g("quote_file",b)}if(w.event=="finish"&&g("finish",w.data),w.event=="debug"){let b=JSON.parse(w.data);g("debug",b)}if(w.event=="error"){let b=w.data;g("error",b)}if(w.event=="recall_time"){let b=w.data;g("recall_time",b)}},o.onClose=()=>{l(),o=null}}}}),Oa={class:"chat-monitor-page"},$a={class:"page-left"},Pa={class:"toolbar-box"},Ma={class:"library-checkbox-box"},La={class:"app-list-box"},Ia={class:"list-box",ref:"scrollContainer"},Aa={class:"list-item"},Na={class:"list-item-box"},ja={class:"library-icon"},za=["onClick"],Ra={class:"page-body"},Da={__name:"index",setup(e){const t=xa();let{getIndeterminate:o,getCheckAll:i,getCheckedList:a,getActiveKey:h}=Xe(t);const g=Ca(),{getLibrarySearchFn:l,searchMessage:E}=g,{messageObj:U}=Xe(g),f=A(null),u=A(null),y=A("all"),I=A([{title:"全部",value:"all"},{title:"普通",value:"0"},{title:"问答",value:"2"}]),w=A({}),b=A([]),c=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),R=_=>{w.value=_},T=A(!1),V=async _=>{var B;T.value=!1;let O=await l();if(u.value=O.data,u.value.id||(u.value=Object.assign(w.value)),u.value,!u.value.model_config_id||!u.value.use_model)return T.value=!0,Le("请在搜索设置中配置好相应配置后再使用");(B=f.value)==null||B.handleRecallTest(u.value),E(_,c.checkedList,u.value)},q=_=>{Object.assign(c,{checkedList:_.target.checked?b.value.map(O=>O.id):[],indeterminate:!!c.checkedList.length&&c.checkedList.length<b.value.length}),t.setCheckedList(c.checkedList),t.setIndeterminate(c.indeterminate)},S=_=>{t.setCheckedList(_)},d=_=>{window.open(`#/library/details/knowledge-document?id=${_}`)};ee(()=>c.checkedList,_=>{c.indeterminate=!!_.length&&_.length<b.value.length,c.checkAll=_.length>=b.value.length,t.setIndeterminate(c.indeterminate),t.setCheckAll(c.checkAll)});const p=()=>{b.value.forEach(_=>{_.type==0,_.type==2}),I.value=[{title:"全部",value:"all"},{title:"普通",value:"0"},{title:"问答",value:"2"}]},v=(_,O)=>{if(O.length===0)return!1;const B=new Set(_);return O.every(D=>B.has(D))},n=(_,O)=>!O.some(B=>_.includes(B)),k=async()=>{let _=y.value==="all"?"":y.value;await Qt({type:_}).then(O=>{var G;let B=O.data||[];B.forEach($=>{$.file_size_str=en($.file_size),$.avatar||($.avatar=$.type==0?tn:nn)}),b.value=B;const D=b.value.map($=>$.id);if((G=a.value)!=null&&G.length&&(D!=null&&D.length)){const $=a.value,P=D,Y=v($,P),F=n($,P),te=$.length>=P.length&&Y,ne={checkAll:te,indeterminate:!te&&!F};t.$patch(ne),Object.assign(c,ne)}else{const $={checkAll:!1,indeterminate:!1};t.$patch($),Object.assign(c,$)}c.checkedList=a.value,c.indeterminate=o.value,!i.value&&a.value.length==0&&!o.value&&h.value=="all"&&(t.setCheckAll(!0),c.checkedList=D,t.setCheckedList(D)),y.value==="all"&&p()})},x=_=>{t.setActiveKey(_),k()};return be(async()=>{h.value&&(y.value=h.value),await k();let _=await l();u.value=_.data}),Be(()=>{}),(_,O)=>{const B=bn,D=pe,G=wn;return M(),j("div",Oa,[s("div",$a,[s("div",Pa,[r(Sa,{tabs:I.value,value:y.value,"onUpdate:value":O[0]||(O[0]=$=>y.value=$),onChange:x},null,8,["tabs","value"])]),s("div",Ma,[s("div",La,[r(B,{checked:c.checkAll,"onUpdate:checked":O[1]||(O[1]=$=>c.checkAll=$),indeterminate:c.indeterminate,onChange:q},{default:N(()=>O[3]||(O[3]=[H(" 全选/取消 ")])),_:1,__:[3]},8,["checked","indeterminate"])]),r(G,{value:c.checkedList,"onUpdate:value":O[2]||(O[2]=$=>c.checkedList=$),onChange:S},{default:N(()=>[s("div",Ia,[(M(!0),j(oe,null,he(b.value,$=>(M(),j("div",{class:"list-item-wraapper",key:$.id},[s("div",Aa,[r(B,{value:$.id},null,8,["value"]),s("div",Na,[s("div",ja,[r(D,{preview:!1,width:32,src:$.avatar},null,8,["src"])]),s("div",{class:"library-name",onClick:P=>d($.id)},W($.library_name),9,za)])])]))),128))],512)]),_:1},8,["value"])])]),s("div",Ra,[r(ya,{ref_key:"searchBoxRef",ref:f,onDefaultParmas:R,onSearch:V,isError:T.value,messageObj:se(U),librarySearchData:u.value,library_ids:c.checkedList},null,8,["isError","messageObj","librarySearchData","library_ids"])])])}}},Ai=xe(Da,[["__scopeId","data-v-a9d74f6c"]]);export{Ai as default};
