import{b as P,b6 as K,as as B,b7 as X,F as W,c4 as ee}from"../../index-BLRnoXQj.js";import{f as l,w as ae,Y as h,_ as r,k as t,a2 as s,a1 as M,a5 as m,u as g,r as T,o as ne,n as te,a4 as q,G as y,F as N,A as oe,ae as le,a9 as se,a7 as R,y as _e}from"./vue-chunks-Ci-XTWEs.js";import{F as D,$ as ie,z as re,o as ue,M as J,a as $,e as de,I as pe,Q as ce,ai as me,g as ve,ar as fe,p as he,ab as ge,q as ke,N as ye,x as be,a4 as we,B as xe,av as Ie,aj as Le,R as Ce}from"./ui-antd-BKz8sshA.js";import{t as Oe}from"./validate-8MtiUsxW.js";import{M as $e}from"./model-select-KZ3YhMAM.js";const Ue={class:"avatar-uploader"},Ae=["src"],Fe={key:1},Se=["src"],ze={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(U,{emit:A}){function I(a){return new Promise((n,d)=>{const _=new FileReader;_.readAsDataURL(a),_.onload=()=>n(_.result),_.onerror=x=>d(x)})}const L=A,v=U,u=l([]),e=l(!1),f=l("");ae(()=>v.value,a=>{f.value=a},{immediate:!0});const C=D.useInjectFormItemContext(),b=()=>{let a={imageUrl:f.value,file:u.value[0].originFileObj};L("change",a),L("update:value",a.imageUrl),C.onFieldChange()},F=a=>a.type==="image/jpeg"||a.type==="image/png"?a.size/1024<100?(u.value=[a],I(a).then(_=>{f.value=_,e.value=!1,b()}),!1):($.error("知识库封面图片大小不能超过100kb"),!1):($.error("知识库封面只支持JPG、PNG格式的图片"),!1),k=l(!1),O=l(""),w=l(""),S=()=>{k.value=!1,w.value=""},z=async a=>{!a.url&&!a.preview&&(a.preview=await I(a.originFileObj)),O.value=a.url||a.preview,k.value=!0,w.value=a.name||a.url.substring(a.url.lastIndexOf("/")+1)};return(a,n)=>{const d=ue,_=J;return r(),h("div",Ue,[t(d,{class:"upload-upload","file-list":u.value,"onUpdate:fileList":n[0]||(n[0]=x=>u.value=x),"list-type":"picture-card","show-upload-list":!1,"before-upload":F,accept:".jpg,.png,.jpeg",onPreview:z},{default:s(()=>[U.value?(r(),h("img",{key:0,class:"avatar",src:U.value,alt:"avatar"},null,8,Ae)):(r(),h("div",Fe,[e.value?(r(),M(g(ie),{key:0})):(r(),M(g(re),{key:1})),n[1]||(n[1]=m("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list"]),t(_,{open:k.value,title:w.value,footer:null,onCancel:S},{default:s(()=>[m("img",{alt:"example",style:{width:"100%"},src:O.value},null,8,Se)]),_:1},8,["open","title"])])}}},Ne=P(ze,[["__scopeId","data-v-5cc20208"]]),qe={class:"form-box"},Me={class:"hight-set-text"},Te={class:"title-block"},j="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",De={__name:"add-qa-library",emits:"ok",setup(U,{expose:A,emit:I}){const L=I,v=l(!0),u=D.useForm,e=T({type:"0",access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:"",avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1,chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_not_merged_text:0,normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:j}),f=T({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:C,validateInfos:b}=u(e,f),F=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file},k=l([]);K().then(a=>{k.value=a.data.map(n=>({label:n.name,value:n.no}))});const O=a=>{a.length&&(e.use_model=a[0].children[0].name,e.model_config_id=a[0].model_config_id)},w=()=>{C().then(()=>{S()}).catch(a=>{})},S=()=>{let a=new FormData,n=JSON.parse(JSON.stringify(e));a.append("type",e.type),a.append("access_rights",e.access_rights),a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",n.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar_file?e.avatar_file:""),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(Oe(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),a.append("chunk_type",e.chunk_type),a.append("normal_chunk_default_separators_no",e.normal_chunk_default_separators_no.join(",")),a.append("normal_chunk_default_chunk_size",e.normal_chunk_default_chunk_size),a.append("normal_chunk_default_not_merged_text",e.normal_chunk_default_not_merged_text),a.append("normal_chunk_default_chunk_overlap",e.normal_chunk_default_chunk_overlap),a.append("semantic_chunk_default_chunk_size",e.semantic_chunk_default_chunk_size),a.append("semantic_chunk_default_chunk_overlap",e.semantic_chunk_default_chunk_overlap),a.append("semantic_chunk_default_threshold",e.semantic_chunk_default_threshold),a.append("graph_switch",e.graph_switch?1:0),a.append("graph_model_config_id",e.graph_model_config_id),a.append("graph_use_model",e.graph_use_model),a.append("ai_chunk_size",e.ai_chunk_size),a.append("ai_chunk_model",e.ai_chunk_model),a.append("ai_chunk_model_config_id",e.ai_chunk_model_config_id),a.append("ai_chunk_prumpt",e.ai_chunk_prumpt),X(a).then(d=>{$.success("创建成功"),L("ok",d.data.id)})};return A({show:()=>{e.type=2,e.avatar=B,e.avatar_file=B,e.library_name="",e.library_intro="",e.chunk_type=1,e.normal_chunk_default_separators_no=[12,11],e.normal_chunk_default_not_merged_text=0,e.normal_chunk_default_chunk_size=512,e.normal_chunk_default_chunk_overlap=50,e.semantic_chunk_default_chunk_size=512,e.semantic_chunk_default_chunk_overlap=50,e.semantic_chunk_default_threshold=50,e.graph_switch=!1,e.ai_chunk_size=5e3,e.ai_chunk_model="",e.ai_chunk_model_config_id="",e.ai_chunk_prumpt=j},handleOk:w}),ne(()=>{}),(a,n)=>{const d=de,_=pe,x=ce,p=he,o=D;return r(),h("div",qe,[t(o,{layout:"vertical"},{default:s(()=>[t(d,q({ref:"name",label:!1},g(b).avatar),{default:s(()=>[t(Ne,{value:e.avatar,"onUpdate:value":n[0]||(n[0]=i=>e.avatar=i),onChange:F},null,8,["value"]),n[6]||(n[6]=m("div",{class:"form-item-tip"},"点击替换，建议尺寸为100*100px，大小不超过100kb",-1))]),_:1,__:[6]},16),t(d,q({ref:"name",label:"知识库名称"},g(b).library_name),{default:s(()=>[t(_,{value:e.library_name,"onUpdate:value":n[1]||(n[1]=i=>e.library_name=i),placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),t(d,q({label:"知识库简介"},g(b).library_intro),{default:s(()=>[t(x,{maxlength:1e3,value:e.library_intro,"onUpdate:value":n[2]||(n[2]=i=>e.library_intro=i),placeholder:"请输入知识库简介，比如 ZHIMA CHATAI 基于大预言模型提供ZHIMA CHATAI 产品帮助"},null,8,["value"])]),_:1},16),m("div",Me,[m("div",Te,[t(g(me)),n[7]||(n[7]=y("高级设置"))]),m("div",{class:"right-btn-box",onClick:n[3]||(n[3]=i=>v.value=!v.value)},[v.value?(r(),h(N,{key:0},[n[8]||(n[8]=y(" 展开 ")),t(g(ve))],64)):(r(),h(N,{key:1},[n[9]||(n[9]=y(" 收起 ")),t(g(fe))],64))])]),te(t(d,null,{label:s(()=>[n[11]||(n[11]=y("文档解析向量模型 ")),t(p,null,{title:s(()=>n[10]||(n[10]=[y("向量模型可以将分段数据转化为向量形式，存储到向量数据库中，便于后续根据用户问题查询匹配。")])),default:s(()=>[t(g(ge),{class:"ml4"})]),_:1})]),default:s(()=>[t($e,{modelType:"TEXT EMBEDDING",modeName:e.use_model,"onUpdate:modeName":n[4]||(n[4]=i=>e.use_model=i),modeId:e.model_config_id,"onUpdate:modeId":n[5]||(n[5]=i=>e.model_config_id=i),onLoaded:O,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},512),[[oe,!v.value]])]),_:1})])}}},Pe=P(De,[["__scopeId","data-v-08f1b92d"]]),Be={class:"modal-box"},Re={class:"filter-block"},je={key:0,class:"empty-block"},Je={class:"list-box"},Qe=["onClick"],Ve={class:"info-block"},He={class:"title"},Ee={class:"desc"},Ge={__name:"import-knowledge-modal",emits:["ok"],setup(U,{expose:A,emit:I}){const L=I;T({});const v=l(!1),u=l(1),e=l(""),f=l(""),C=l(""),b=l(""),F=p=>{C.value=p.id,b.value=p.ids||"",u.value=1,e.value="",f.value="",v.value=!0,n()},k=l(!1),O=()=>{u.value==1?S():_.value.handleOk()},w=p=>{k.value=!0,ee({library_id:p,file_id:C.value,ids:b.value}).then(o=>{$.success("导入成功"),v.value=!1,L("ok")}).finally(()=>{k.value=!1})},S=()=>{if(!f.value)return $.error("请选择导入的知识库");w(f.value)},z=p=>{w(p)},a=l([]),n=p=>{W({library_name:e.value,show_open_docs:1}).then(o=>{a.value=o.data.filter(i=>i.type==2),p&&$.success("刷新成功")})},d=p=>{f.value=p.id},_=l(null),x=()=>{u.value==2&&_e(()=>{_.value&&_.value.show()})};return A({show:F}),(p,o)=>{const i=ye,Q=ke,V=be,H=we,E=xe,G=Le,Y=Ce,Z=J;return r(),h("div",null,[t(Z,{open:v.value,"onUpdate:open":o[4]||(o[4]=c=>v.value=c),"confirm-loading":k.value,title:"导入问答知识库",width:"746px",wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"540px","overflow-y":"auto"},onOk:O},{default:s(()=>[m("div",Be,[t(Q,{value:u.value,"onUpdate:value":o[0]||(o[0]=c=>u.value=c),onChange:x},{default:s(()=>[t(i,{value:1},{default:s(()=>o[5]||(o[5]=[y("导入到已有知识库")])),_:1,__:[5]}),t(i,{value:2},{default:s(()=>o[6]||(o[6]=[y("创建问答知识库并导入")])),_:1,__:[6]})]),_:1},8,["value"]),u.value==1?(r(),h(N,{key:0},[t(V,{style:{"font-size":"14px",color:"#8c8c8c","font-weight":"400"},orientation:"left","orientation-margin":"0px"},{default:s(()=>o[7]||(o[7]=[y(" 请选择要导入的知识库 ")])),_:1,__:[7]}),m("div",Re,[t(H,{value:e.value,"onUpdate:value":o[1]||(o[1]=c=>e.value=c),placeholder:"请输入知识库名称搜索",style:{width:"240px"},onSearch:o[2]||(o[2]=c=>n())},null,8,["value"]),t(E,{onClick:o[3]||(o[3]=c=>n(!0)),icon:t(g(Ie))},{default:s(()=>o[8]||(o[8]=[y("刷新")])),_:1,__:[8]},8,["icon"])]),a.value.length==0?(r(),h("div",je,[t(G)])):le("",!0),m("div",Je,[(r(!0),h(N,null,se(a.value,c=>(r(),h("div",{class:"list-item",onClick:Ye=>d(c),key:c.id},[t(Y,{checked:f.value==c.id},null,8,["checked"]),m("div",Ve,[m("div",He,R(c.library_name),1),m("div",Ee,R(c.library_intro),1)])],8,Qe))),128))])],64)):(r(),M(Pe,{key:1,ref_key:"addQaLibraryRef",ref:_,onOk:z},null,512))])]),_:1},8,["open","confirm-loading"])])}}},aa=P(Ge,[["__scopeId","data-v-10b82b52"]]);export{aa as I};
