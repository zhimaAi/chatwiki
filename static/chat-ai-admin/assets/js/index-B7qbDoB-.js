import{b as qe,d as Fe}from"../../index-0TFHdij1.js";import{f as g,r as ke,w as Se,Y as R,_ as k,a5 as i,ae as Z,k as r,a2 as c,G as U,F as Ve,a9 as Pe,a1 as _e,u as T,a7 as re,ab as We,aa as Je,o as Ge,y as P,b as rt,ad as be,a6 as Ee,B as he}from"./vue-chunks-CXJTX1FC.js";import{e as He}from"./index-DvPlhmYy.js";import{a as _t,y as pt,z as mt,x as ze,A as dt,B as Te}from"./index-lMQ5W3Uj.js";import{M as ct,E as vt,e as ft,P as De}from"./multi-reply-BhaR3qEc.js";import{R as yt,q as gt,a1 as Ue,B as Ae,e as bt,I as Ye,F as ht,k as Re,a as h,Y as kt,ac as St,p as Oe,a9 as wt,M as X}from"./ui-antd-D3ZAJ1Vq.js";import{d as Be}from"./vuedraggable.umd-BsLO8JSn.js";import{L as xt}from"./list-empty-BB4jo9v7.js";import"./utils-yZpnICoG.js";import"./index-BAHM4xhG.js";const Ct={class:"menu-act-editor"},Nt={class:"radio-row"},Ut={key:0,class:"block"},qt={class:"reply-list"},At={key:1,class:"block block-box"},Rt={key:2,class:"block block-box"},Mt={class:"form-grid"},Lt={key:3,class:"block block-box"},$t={__name:"menu-act-editor",props:{value:{type:Object,default:()=>({choose_act_item:0,act_params:{}})}},emits:["update:value","change"],setup(we,{expose:D,emit:J}){var _,d,M,B,le,te,ie,ue,ne,oe;const x=g([]),m=we,F=J,C=ke({choose_act_item:Number(((_=m.value)==null?void 0:_.choose_act_item)||0)}),v=g((((d=m.value)==null?void 0:d.act_params)||{}).replyList&&(((M=m.value)==null?void 0:M.act_params)||{}).replyList.length?(((B=m.value)==null?void 0:B.act_params)||{}).replyList:[{type:"text",description:""}]),S=g(Number((((le=m.value)==null?void 0:le.act_params)||{}).reply_num||0)),L=ke({linkUrl:String((((te=m.value)==null?void 0:te.act_params)||{}).linkUrl||"")}),O=g(String((((ie=m.value)==null?void 0:ie.act_params)||{}).key||"")),N=ke({appid:(((ue=m.value)==null?void 0:ue.act_params)||{}).appid||"",page_path:(((ne=m.value)==null?void 0:ne.act_params)||{}).page_path||"",standbyUrl:(((oe=m.value)==null?void 0:oe.act_params)||{}).standbyUrl||""}),Y=g(null),pe=g(null),G={span:4},xe={span:20},me={card:{appid:[{required:!0,message:"è¯·è¾“å…¥å°ç¨‹åºappID"}],page_path:[{required:!0,message:"è¯·è¾“å…¥å°ç¨‹åºè·¯å¾„"}],standbyUrl:[{required:!0,pattern:/^https?:\/\//,message:"å¤‡ç”¨ç½‘é¡µéœ€ä»¥http://æˆ–https://å¼€å¤´"}]},link:{linkUrl:[{required:!0,message:"è¯·è¾“å…¥é“¾æ¥"},{pattern:/^https?:\/\//,message:"é“¾æ¥éœ€ä»¥http://æˆ–https://å¼€å¤´"}]}};Se(()=>m.value,b=>{C.choose_act_item=Number((b==null?void 0:b.choose_act_item)||0);const l=(b==null?void 0:b.act_params)||{};v.value=Array.isArray(l.replyList)&&l.replyList.length?l.replyList:[{type:"text",description:""}],S.value=Number(l.reply_num||0),L.linkUrl=String(l.linkUrl||""),O.value=String(l.key||""),N.appid=l.appid||"",N.page_path=l.page_path||"",N.standbyUrl=l.standbyUrl||"",x.value=[]},{immediate:!1}),Se(()=>N,()=>{E()},{deep:!0});function H(){v.value.length>=5||v.value.push({type:"text",description:""})}function K(b){const{reply_index:l,...I}=b||{};l>=0&&l<v.value.length&&(v.value[l]=I,E())}function Ce(b){v.value.splice(b,1),E()}async function E(){F("update:value",ee()),F("change",ee())}function ee(){const b={};return C.choose_act_item===1&&Object.assign(b,{replyList:v.value,reply_num:S.value}),C.choose_act_item===2&&Object.assign(b,{linkUrl:L.linkUrl}),C.choose_act_item===3&&Object.assign(b,{appid:N.appid,page_path:N.page_path,standbyUrl:N.standbyUrl}),C.choose_act_item===5&&Object.assign(b,{key:O.value}),{choose_act_item:C.choose_act_item,act_params:b}}async function de(){var l,I;const b=Number(C.choose_act_item||0);if(b===1){if(!v.value.length)return h.error("è¯·æ·»åŠ å›å¤å†…å®¹"),!1;for(const j of x.value)if(j&&j.validate&&!await j.validate())return!1;return!0}if(b===2)try{return await((l=pe.value)==null?void 0:l.validate()),!0}catch{return String(L.linkUrl||"").trim()?h.error("é“¾æ¥éœ€ä»¥http://æˆ–https://å¼€å¤´"):h.error("è¯·è¾“å…¥é“¾æ¥"),!1}if(b===3)try{return await((I=Y.value)==null?void 0:I.validate()),!0}catch{return h.error("è¯·å®Œå–„å°ç¨‹åºå¿…å¡«é¡¹"),!1}return b===5?String(O.value||"").trim()?!0:(h.error("è¯·è¾“å…¥æ¨é€äº‹ä»¶key"),!1):!0}return D({getValue:ee,validate:de}),(b,l)=>{const I=yt,j=gt,V=Ae,Q=Ye,W=bt,o=ht,ce=Re;return k(),R("div",Ct,[i("div",Nt,[r(j,{value:C.choose_act_item,"onUpdate:value":l[0]||(l[0]=q=>C.choose_act_item=q),onChange:E},{default:c(()=>[r(I,{value:1},{default:c(()=>l[7]||(l[7]=[U("å‘é€æ¶ˆæ¯")])),_:1,__:[7]}),r(I,{value:2},{default:c(()=>l[8]||(l[8]=[U("è·³è½¬ç½‘é¡µ")])),_:1,__:[8]}),r(I,{value:3},{default:c(()=>l[9]||(l[9]=[U("è·³è½¬å°ç¨‹åº")])),_:1,__:[9]}),r(I,{value:5},{default:c(()=>l[10]||(l[10]=[U("æ¨é€äº‹ä»¶")])),_:1,__:[10]})]),_:1},8,["value"])]),C.choose_act_item===1?(k(),R("div",Ut,[l[13]||(l[13]=i("div",{class:"label"},"å›å¤å†…å®¹",-1)),i("div",qt,[(k(!0),R(Ve,null,Pe(v.value,(q,z)=>(k(),_e(ct,{key:z,ref_for:!0,ref_key:"replyRefs",ref:x,value:v.value[z],"onUpdate:value":Ne=>v.value[z]=Ne,reply_index:z,onChange:K,onDel:Ce},null,8,["value","onUpdate:value","reply_index"]))),128)),r(V,{type:"dashed",style:{width:"100%"},disabled:v.value.length>=5,onClick:H},{default:c(()=>[r(T(Ue)),U(" æ·»åŠ å›å¤å†…å®¹("+re(v.value.length)+"/5) ",1)]),_:1},8,["disabled"])]),l[14]||(l[14]=i("div",{class:"label"},"å›å¤æ–¹å¼",-1)),r(j,{value:S.value,"onUpdate:value":l[1]||(l[1]=q=>S.value=q),onChange:E},{default:c(()=>[r(I,{value:0},{default:c(()=>l[11]||(l[11]=[U("å…¨éƒ¨å›å¤")])),_:1,__:[11]}),r(I,{value:1},{default:c(()=>l[12]||(l[12]=[U("éšæœºå›å¤ä¸€æ¡")])),_:1,__:[12]})]),_:1},8,["value"])])):C.choose_act_item===2?(k(),R("div",At,[l[15]||(l[15]=i("div",{class:"label"},[i("span",{class:"required"},"*"),U("è·³è½¬é“¾æ¥")],-1)),r(o,{class:"link-form",model:L,rules:me.link,ref_key:"linkForm",ref:pe,layout:"horizontal"},{default:c(()=>[r(W,{name:"linkUrl"},{default:c(()=>[r(Q,{value:L.linkUrl,"onUpdate:value":l[2]||(l[2]=q=>L.linkUrl=q),placeholder:"è¯·è¾“å…¥é“¾æ¥",onBlur:E},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]),l[16]||(l[16]=i("div",{class:"tip"},"è®¢é˜…è€…ç‚¹å‡»è¯¥èœå•ä¼šè·³åˆ°ä»¥ä¸‹é“¾æ¥ã€‚å¿…é¡»ä»¥http://æˆ–https://å¼€å¤´",-1))])):C.choose_act_item===3?(k(),R("div",Rt,[i("div",Mt,[r(o,{model:N,rules:me.card,ref_key:"cardForm",ref:Y,layout:"horizontal",labelCol:G,wrapperCol:xe},{default:c(()=>[r(ce,{type:"info",style:{"margin-bottom":"16px"},message:"å°ç¨‹åºå¡ç‰‡ä»…æ”¯æŒåœ¨å…¬ä¼—å·ï¼Œå¾®ä¿¡å®¢æœå’Œå¾®ä¿¡å°ç¨‹åºä¸­å‘é€ï¼Œå…¶ä»–æ¸ é“ä¼šå‘é€å¤±è´¥ï¼›å…¬ä¼—å·å†…å›å¤å¿…é¡»æ˜¯å…³è”å°ç¨‹åºï¼Œå¾®ä¿¡å°ç¨‹åºå†…å›å¤å¿…é¡»æ˜¯å½“å‰çš„å°ç¨‹åº"}),r(W,{label:"å°ç¨‹åºappID",name:"appid"},{default:c(()=>[r(Q,{value:N.appid,"onUpdate:value":l[3]||(l[3]=q=>N.appid=q),placeholder:"è¯·è¾“å…¥å°ç¨‹åºappID"},null,8,["value"]),l[17]||(l[17]=i("div",{style:{"margin-top":"2px",color:"#FB363F"}},"å°ç¨‹åºå³ä¸Šè§’ä¸‰ä¸ªç‚¹>åå­—>æ›´å¤šèµ„æ–™>Appid;å…¬ä¼—å·å†…å›å¤æ—¶å¿…é¡»è·Ÿå°ç¨‹åºæ˜¯å…³è”å…³ç³»",-1))]),_:1,__:[17]}),r(W,{label:"å°ç¨‹åºè·¯å¾„",name:"page_path"},{default:c(()=>[r(Q,{value:N.page_path,"onUpdate:value":l[4]||(l[4]=q=>N.page_path=q),placeholder:"è¯·è¾“å…¥å°ç¨‹åºè·¯å¾„"},null,8,["value"]),l[18]||(l[18]=i("div",{style:{"margin-top":"2px",color:"#8C8C8C"}},"è¯·è”ç³»å°ç¨‹åºå¼€å‘è€…è·å–è·¯å¾„,æ¯”å¦‚/pages/index/index,æ³¨æ„ï¼Œè·¯å¾„å»ºè®®ä»¥/å¼€å¤´",-1))]),_:1,__:[18]}),r(W,{label:"å¤‡ç”¨ç½‘é¡µ",name:"standbyUrl"},{default:c(()=>[r(Q,{value:N.standbyUrl,"onUpdate:value":l[5]||(l[5]=q=>N.standbyUrl=q),placeholder:"è¯·è¾“å…¥å¤‡ç”¨ç½‘é¡µ"},null,8,["value"]),l[19]||(l[19]=i("div",{style:{"margin-top":"2px",color:"#8C8C8C"}},"å½“ä¸å¡«æ—¶å°†ä½¿ç”¨é»˜è®¤çš„ç½‘é¡µï¼Œæ—§ç‰ˆå¾®ä¿¡å®¢æˆ·ç«¯æ— æ³•æ”¯æŒå°ç¨‹åºï¼Œç”¨æˆ·ç‚¹å‡»èœå•æ—¶å°†ä¼šæ‰“å¼€å¤‡ç”¨ç½‘é¡µ",-1))]),_:1,__:[19]})]),_:1},8,["model","rules"])])])):C.choose_act_item===5?(k(),R("div",Lt,[l[20]||(l[20]=i("div",{class:"label"},[i("span",{class:"required"},"*"),U("è®¾ç½®keyå€¼")],-1)),r(Q,{value:O.value,"onUpdate:value":l[6]||(l[6]=q=>O.value=q),placeholder:"è¯·è¾“å…¥keyå€¼",onBlur:E},null,8,["value"]),l[21]||(l[21]=i("div",{class:"tip"},"è®¾å®škeyå€¼ï¼Œå¯ä»¥ç”¨äºè·Ÿå…¶ä»–ç³»ç»Ÿåšäº¤äº’ã€‚ä¾¿äºåŒæ—¶ä½¿ç”¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿå¼€å‘è·Ÿå°å®¢æœåå°çš„èœå•åŠŸèƒ½ã€‚å¦‚éœ€ä½¿ç”¨å°å®¢æœåå°çš„è‡ªåŠ¨æ‰“æ ‡ç­¾ï¼Œè¯·å‹¿åœ¨å¤šä¸ªèœå•å†…è®¾ç½®ç›¸åŒçš„æ¨é€äº‹ä»¶å€¼ã€‚",-1))])):Z("",!0)])}}},je=qe($t,[["__scopeId","data-v-34421778"]]),It="/assets/img/iphone-bg-2ITDRszc.png",Et={class:"user-model-page"},zt={class:"breadcrumb-wrap"},Tt={class:"mp-list-block"},Dt=["onClick"],Ot=["src"],Bt={class:"mp-name"},jt={class:"search-block"},Ft={class:"flex",style:{gap:"4px","align-items":"center"}},Vt={class:"main"},Pt={class:"main-left"},Wt=["onClick"],Jt={class:"name"},Gt=["onClick"],Ht={class:"text"},Yt=["onClick"],Kt={class:"main-right"},Qt={key:0,class:"editor"},Xt={class:"form-item"},Zt={class:"emoji-row"},en={key:0,class:"form-item"},tn={key:1,class:"editor"},nn={class:"form-item"},an={class:"emoji-row"},sn={class:"form-item"},ln={class:"footer-save"},un=160,on=8,rn=96,_n={__name:"custom-menu",setup(we){const D=We(),J=Je(),x=g([]),m=g(""),F=g(!1),C=g(null),v=g(0),S=g(!1),L=g(!1);function O(){const t=C.value;if(!t){v.value=0;return}const e=t.clientWidth||0,n=un+on,s=Math.floor((e-rn)/n);v.value=Math.max(s,0),z()}const N=async()=>{if(!m.value){h.error("è¯·é€‰æ‹©å…¬ä¼—å·");return}S.value=!0,mt({appid:m.value}).then(t=>{var p;const e=Array.isArray((p=t==null?void 0:t.data)==null?void 0:p.list)?t.data.list:[],n=e.filter(a=>Number(a.menu_level)===1),s=e.filter(a=>Number(a.menu_level)===2);n.length&&(o.value=n.sort((a,y)=>Number(a.seq_id||0)-Number(y.seq_id||0)).map(a=>{const y=Array.isArray(a.sub_menu_list)?a.sub_menu_list:[],w=s.filter(u=>Number(u.parent_menu_id||0)===Number(a.id||0)),A=(y.length?y:w).slice().sort((u,f)=>Number(u.seq_id||0)-Number(f.seq_id||0));return{id:Number(a.id||0),admin_user_id:Number(a.admin_user_id||0),appid:String(a.appid||""),seq_id:Number(a.seq_id||0),menu_name:a.menu_name||"ä¸»èœå•",menu_level:1,parent_menu_id:0,act:E(a),sub_menu_list:A.map((u,f)=>({id:Number(u.id||0),admin_user_id:Number(u.admin_user_id||0),appid:String(u.appid||""),seq_id:Number(u.seq_id||f),menu_name:u.menu_name||"å­èœå•",menu_level:2,parent_menu_id:Number(a.id||0),act:E(u)}))}}),_.value=0,d.value=-1,M.type="root"),P(z),h.success("åŒæ­¥èœå•æˆåŠŸ")}).finally(()=>{S.value=!1})},Y=async()=>{var t,e;try{const n=m.value,s=await He({app_type:"official_account",app_name:""}),p=Array.isArray(s==null?void 0:s.data)?s.data:[];if(x.value=p.filter(a=>a.account_is_verify=="true").map(a=>({id:a.id,appid:a.app_id,name:a.app_name,logo:a.app_avatar,custom_menu_status:String(a.custom_menu_status||"0")})),n){const a=x.value.find(y=>y.appid===n);m.value=a?n:((t=x.value[0])==null?void 0:t.appid)||""}else m.value=((e=x.value[0])==null?void 0:e.appid)||""}catch{x.value=[],m.value=""}};Ge(async()=>{xe(),await Y(),K(),P(O),window.addEventListener("resize",O),ee()}),rt(()=>{window.removeEventListener("resize",O)});function pe(t){m.value=t.appid,F.value=!0,K(),ee()}const G=g(!1),xe=()=>{_t({ability_type:"official_custom_menu"}).then(t=>{var n,s;const e=(s=(n=t==null?void 0:t.data)==null?void 0:n.user_config)==null?void 0:s.switch_status;G.value=String(e||"0")==="1"})},me=t=>{const e=t?"1":"0";if(e==="0"){X.confirm({title:"æç¤º",content:"å…³é—­åï¼Œè¯¥åŠŸèƒ½é»˜è®¤å…³é—­ä¸å†æ”¯æŒä½¿ç”¨ï¼Œæ‰€æœ‰çš„å…¬ä¼—å·èœå•éƒ½ä¼šåœç”¨ï¼Œç¡®è®¤å…³é—­ï¼Ÿ",onOk:()=>{ze({ability_type:"official_custom_menu",switch_status:e}).then(n=>{n&&n.res==0&&(G.value=!1,h.success("æ“ä½œæˆåŠŸ"),P(async()=>{await Y(),K()}))})}});return}ze({ability_type:"official_custom_menu",switch_status:e}).then(n=>{n&&n.res==0&&(G.value=!0,h.success("æ“ä½œæˆåŠŸ"))})},H=g("1"),K=()=>{if(!m.value){H.value="0";return}const t=x.value.find(e=>e.appid===m.value);H.value=String((t==null?void 0:t.custom_menu_status)||"0")},Ce=t=>{const e=t;if(!m.value){h.error("è¯·é€‰æ‹©å…¬ä¼—å·");return}if(e==="0"){X.confirm({title:"æç¤º",content:G.value?"è¯¥å…¬ä¼—å·è‡ªå®šä¹‰èœå•åŠŸèƒ½å°†è¢«åœç”¨ï¼Œç²‰ä¸å°†æ— æ³•çœ‹åˆ°èœå•ã€‚è¯·è°¨æ…æ“ä½œï¼åç»­å¦‚éœ€å¼€å¯èœå•ï¼Œå¯ä»¥å¼€å¯åŠŸèƒ½åä¿å­˜":"å½“å‰èœå•æ˜¯å…³é—­çŠ¶æ€ï¼Œä¿å­˜ä»…æ˜¯æœ¬åœ°ä¿å­˜,ä¸ä¼šåŒæ­¥åˆ°å¾®ä¿¡ã€‚",onOk:async()=>{try{await dt({appid:m.value}),h.success("æ“ä½œæˆåŠŸ")}finally{await Y(),K()}},onCancel:()=>{H.value="1"}});return}X.confirm({title:"æç¤º",content:G.value?"å¼€å¯åï¼Œè¯·ä¿å­˜è¯¥å…¬ä¼—å·çš„èœå•ï¼Œä¿å­˜æˆåŠŸåå°†åŒæ­¥åˆ°å¾®ä¿¡":"å½“å‰èœå•æ˜¯å…³é—­çŠ¶æ€ï¼Œä¿å­˜ä»…æ˜¯æœ¬åœ°ä¿å­˜,ä¸ä¼šåŒæ­¥åˆ°å¾®ä¿¡ã€‚",onOk:async()=>{const n=$e();Te({appid:m.value,menu_json:JSON.stringify(n)}).then(()=>{h.success("ä¿å­˜æˆåŠŸ")}).finally(async()=>{await Y(),K()})},onCancel:()=>{H.value="0"}})};function E(t){const e=Number((t==null?void 0:t.choose_act_item)||0),n=(t==null?void 0:t.act_params)||{},s={};if(e===1){const p=Array.isArray(n.reply_content)?n.reply_content:[];s.replyList=p.map(a=>({type:(a==null?void 0:a.type)||(a==null?void 0:a.reply_type)||"text",description:(a==null?void 0:a.description)||"",thumb_url:(a==null?void 0:a.thumb_url)||(a==null?void 0:a.pic)||"",title:(a==null?void 0:a.title)||"",url:(a==null?void 0:a.url)||"",appid:(a==null?void 0:a.appid)||"",page_path:(a==null?void 0:a.page_path)||"",standbyUrl:(a==null?void 0:a.standbyUrl)||(a==null?void 0:a.standby_url)||"",smart_menu_id:(a==null?void 0:a.smart_menu_id)||"",smart_menu:(a==null?void 0:a.smart_menu)||{}})),s.reply_num=Number(t.reply_num||n.reply_num||0)}else e===2?s.linkUrl=String(n.linkUrl||""):e===3?(s.appid=String(n.appid||""),s.page_path=String(n.pagepath||n.page_path||""),s.standbyUrl=String(n.standbyUrl||n.standby_url||"")):e===5&&(s.key=String(n.key||""));return{choose_act_item:e,act_params:s}}async function ee(){var t;try{const e=await pt({appid:m.value}),n=Array.isArray((t=e==null?void 0:e.data)==null?void 0:t.list)?e.data.list:[],s=n.filter(a=>Number(a.menu_level)===1),p=n.filter(a=>Number(a.menu_level)===2);o.value=s.sort((a,y)=>Number(a.seq_id||0)-Number(y.seq_id||0)).map(a=>{const y=Array.isArray(a.sub_menu_list)?a.sub_menu_list:[],w=p.filter(u=>Number(u.parent_menu_id||0)===Number(a.id||0)),A=(y.length?y:w).slice().sort((u,f)=>Number(u.seq_id||0)-Number(f.seq_id||0));return{id:Number(a.id||0),admin_user_id:Number(a.admin_user_id||0),appid:String(a.appid||""),seq_id:Number(a.seq_id||0),menu_name:a.menu_name||"ä¸»èœå•",menu_level:1,parent_menu_id:0,act:E(a),sub_menu_list:A.map((u,f)=>({id:Number(u.id||0),admin_user_id:Number(u.admin_user_id||0),appid:String(u.appid||""),seq_id:Number(u.seq_id||f),menu_name:u.menu_name||"å­èœå•",menu_level:2,parent_menu_id:Number(a.id||0),act:E(u)}))}}),P(z)}catch{}}const de=()=>{D.query.id&&D.query.robot_key?J.push({path:"/robot/config/function-center",query:{id:D.query.id,robot_key:D.query.robot_key}}):J.push({path:"/explore/index"})},_=g(0),d=g(-1),M=ke({type:"root"}),B=g(null),le=g(null),te=g(!1),ie=new vt(ft),ue=g(null),ne=g(!1);function oe(){return document.body}function b(t){var p,a,y;const e=(t==null?void 0:t.native)||"";if(!e)return;const n=(a=(p=le.value)==null?void 0:p.$el)==null?void 0:a.querySelector("input"),s=String(((y=o.value[_.value])==null?void 0:y.menu_name)||"");if(n&&typeof n.selectionStart=="number"){const w=n.selectionStart,A=n.selectionEnd,u=s.slice(0,w)+e+s.slice(A),f=V(u,5);f!==u&&h.warning("ä¸»èœå•åç§°æœ€å¤šæ”¯æŒ5ä¸ªå­—ç¬¦"),o.value[_.value].menu_name=f,P(()=>{n.focus();const $=(o.value[_.value].menu_name||"").length;n.setSelectionRange($,$)})}else{const w=s+e,A=V(w,5);A!==w&&h.warning("ä¸»èœå•åç§°æœ€å¤šæ”¯æŒ5ä¸ªå­—ç¬¦"),o.value[_.value].menu_name=A}te.value=!1}function l(t){var a,y,w,A,u;const e=(t==null?void 0:t.native)||"";if(!e)return;const n=(y=(a=ue.value)==null?void 0:a.$el)==null?void 0:y.querySelector("input"),s=String(((u=(A=(w=o.value[_.value])==null?void 0:w.sub_menu_list)==null?void 0:A[d.value])==null?void 0:u.menu_name)||""),p=18;if(n&&typeof n.selectionStart=="number"){const f=n.selectionStart,$=n.selectionEnd,se=s.slice(0,f)+e+s.slice($),ge=V(se,p);ge!==se&&h.warning("å­èœå•åç§°æœ€å¤šæ”¯æŒ18ä¸ªå­—ç¬¦"),o.value[_.value].sub_menu_list[d.value].menu_name=ge,P(()=>{n.focus();const Ie=(o.value[_.value].sub_menu_list[d.value].menu_name||"").length;n.setSelectionRange(Ie,Ie)})}else{const f=s+e,$=V(f,p);$!==f&&h.warning("å­èœå•åç§°æœ€å¤šæ”¯æŒ18ä¸ªå­—ç¬¦"),o.value[_.value].sub_menu_list[d.value].menu_name=$}ne.value=!1}function I(){var n,s,p;const t=String(((p=(s=(n=o.value[_.value])==null?void 0:n.sub_menu_list)==null?void 0:s[d.value])==null?void 0:p.menu_name)||""),e=V(t,18);e!==t&&(o.value[_.value].sub_menu_list[d.value].menu_name=e,h.warning("å­èœå•åç§°æœ€å¤šæ”¯æŒ18ä¸ªå­—ç¬¦"))}const j=t=>{try{const e=new Intl.Segmenter("zh",{granularity:"grapheme"});return Array.from(e.segment(String(t))).map(n=>n.segment)}catch{return Array.from(String(t))}},V=(t,e=5)=>j(t).slice(0,e).join(""),Q=()=>{var n;const t=String(((n=o.value[_.value])==null?void 0:n.menu_name)||""),e=V(t,5);e!==t&&(o.value[_.value].menu_name=e,h.warning("ä¸»èœå•åç§°æœ€å¤šæ”¯æŒ5ä¸ªå­—ç¬¦"))};function W(){return{choose_act_item:1,act_params:{replyList:[{type:"text",description:""}],reply_num:0}}}const o=g([{id:0,admin_user_id:0,appid:"",seq_id:0,menu_name:"ä¸»èœå•",menu_level:1,parent_menu_id:0,choose_act_item:0,act_params:{},act:W(),sub_menu_list:[]}]),ce=g(null),q=g(64);function z(){const t=ce.value;if(!t)return;const e=t.clientWidth||0,s=o.value.length<3?32:0,p=8,a=Math.max(o.value.length,1),y=e-s-p*(a-1),w=Math.max(Math.floor(y/a),48);q.value=w}function Ne(){o.value.length>=3||(o.value.push({id:0,admin_user_id:0,appid:m.value,seq_id:0,menu_name:"ä¸»èœå•",menu_level:1,parent_menu_id:0,choose_act_item:0,act_params:{},act:W(),sub_menu_list:[]}),_.value=o.value.length-1,d.value=-1,M.type="root",P(z))}function Ke(t){_.value=t,d.value=-1,M.type="root"}function Qe(t){if(o.value.length<=1){h.warning("è‡³å°‘ä¿ç•™ä¸€ä¸ªä¸»èœå•");return}X.confirm({title:"æç¤º",content:"åˆ é™¤å,è¯¥ä¸»èœå•ä¸‹è®¾ç½®çš„å†…å®¹åŠå­èœå•å°†è¢«å…¨è¢«åˆ é™¤",okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",onOk(){o.value.splice(t,1),_.value>=o.value.length?_.value=o.value.length-1:_.value>t&&(_.value=_.value-1),d.value=-1,M.type="root",P(z)}})}function Xe(t){const e=o.value[t];if(!e||(e.sub_menu_list=e.sub_menu_list||[],e.sub_menu_list.length>=5))return;const n=()=>{e.sub_menu_list.push({id:0,admin_user_id:0,appid:m.value,seq_id:e.sub_menu_list.length,menu_name:"å­èœå•",menu_level:2,parent_menu_id:e.id,choose_act_item:0,act_params:{},act:W()}),_.value=t,d.value=(e.sub_menu_list||[]).length-1,M.type="sub"};e.sub_menu_list.length===0?X.confirm({title:"æç¤º",content:"æ·»åŠ å­èœå•åï¼Œä¸€çº§èœå•çš„å†…å®¹å°†è¢«æ¸…é™¤ã€‚ç¡®å®šæ·»åŠ å­èœå•ï¼Ÿ",okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",onOk(){e.act=W(),n()}}):n()}function Ze(t,e){_.value=t,d.value=e,M.type="sub"}function et(t,e){const n=o.value[t];n&&X.confirm({title:"æç¤º",content:"åˆ é™¤å,è¯¥å­èœå•ä¸‹è®¾ç½®çš„å†…å®¹å°†è¢«å…¨è¢«åˆ é™¤",okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",onOk(){n.sub_menu_list.splice(e,1);const s=(n.sub_menu_list||[]).length;_.value===t&&(s===0?(d.value=-1,M.type="root"):d.value>=s&&(d.value=s-1,M.type="sub"))}})}let ve=null;function tt(){ve=o.value[_.value]||null}function nt(){if(o.value.forEach((t,e)=>{t.seq_id=e}),ve){const t=o.value.findIndex(e=>e===ve);t>=0&&(_.value=t)}ve=null}let ae=null;function at(t){const e=o.value[t];if(!e){ae=null;return}_.value===t&&d.value>=0?ae=(e.sub_menu_list||[])[d.value]||null:ae=null}function st(t){const e=o.value[t];if(e){if((e.sub_menu_list||[]).forEach((n,s)=>{n.seq_id=s}),_.value===t&&ae){const n=(e.sub_menu_list||[]).findIndex(s=>s===ae);n>=0&&(d.value=n),M.type=d.value>=0?"sub":"root"}ae=null}}function lt(t){return(t||[]).map(e=>({...e,status:"1"}))}function it(t){const e={text:"2",image:"4",card:"3",imageText:"1",url:"5",smartMenu:"6"};return(t||[]).map(n=>e[n.type]||"").filter(Boolean)}function Me(t){const e=Number((t==null?void 0:t.choose_act_item)||0),n=(t==null?void 0:t.act_params)||{};return e===1?{item:e,reply_content:lt(n.replyList||[]),reply_type:it(n.replyList||[]),reply_num:Number(n.reply_num||0)}:e===2?{item:e,linkUrl:String(n.linkUrl||"")}:e===3?{item:e,appid:String(n.appid||""),pagepath:String(n.page_path||""),standbyUrl:String(n.standbyUrl||"")}:e===5?{item:e,key:String(n.key||"")}:{item:0}}function fe(t){return/^https?:\/\//.test(String(t||""))}function ut(t){var n;const e=Array.isArray(t)?t:[];if(!e.length)return!1;for(const s of e){const p=(s==null?void 0:s.type)||(s==null?void 0:s.reply_type);if(p==="text"){if(!String((s==null?void 0:s.description)||"").trim())return!1}else if(p==="image"){if(!String((s==null?void 0:s.thumb_url)||"").trim())return!1}else if(p==="imageText"){if(!fe(s==null?void 0:s.url)||!String((s==null?void 0:s.title)||"").trim()||!String((s==null?void 0:s.description)||"").trim()||!String((s==null?void 0:s.thumb_url)||"").trim())return!1}else if(p==="url"){if(!fe(s==null?void 0:s.url)||!String((s==null?void 0:s.title)||"").trim())return!1}else if(p==="card"){if(!String((s==null?void 0:s.title)||"").trim()||!String((s==null?void 0:s.appid)||"").trim()||!String((s==null?void 0:s.page_path)||"").trim()||!String((s==null?void 0:s.thumb_url)||"").trim())return!1}else if(p==="smartMenu"&&!String((s==null?void 0:s.smart_menu_id)||((n=s==null?void 0:s.smart_menu)==null?void 0:n.id)||"").trim())return!1}return!0}function Le(t){const e=Number((t==null?void 0:t.choose_act_item)||0),n=(t==null?void 0:t.act_params)||{};return e===0?!0:e===1?ut(n.replyList):e===2?fe(n.linkUrl):e===3?String(n.appid||"").trim().length>0&&String(n.page_path||"").trim().length>0&&fe(n.standbyUrl):e===5?String(n.key||"").trim().length>0:!0}function $e(){return o.value.map((t,e)=>{var p;const n={admin_user_id:1,appid:m.value,seq_id:e,menu_name:t.menu_name||"ä¸»èœå•",menu_level:1,parent_menu_id:0,choose_act_item:(t.sub_menu_list||[]).length>0?0:Number(((p=t.act)==null?void 0:p.choose_act_item)||0),act_params:(t.sub_menu_list||[]).length>0?{item:0}:Me(t.act),oper_user_id:1,sub_menu_list:(t.sub_menu_list||[]).map((a,y)=>{var u;const w={admin_user_id:1,appid:m.value,seq_id:y,menu_name:a.menu_name||"å­èœå•",menu_level:2,parent_menu_id:Number(t.id||0),choose_act_item:Number(((u=a.act)==null?void 0:u.choose_act_item)||0),act_params:Me(a.act),oper_user_id:1,create_time:ye(),update_time:ye()},A=Number(a.id||0);return A>0&&(w.id=A),w}),create_time:ye(),update_time:ye()},s=Number(t.id||0);return s>0&&(n.id=s),n})}function ye(){return Math.floor(Date.now()/1e3)}async function ot(){if(L.value)return;if(!m.value){h.error("è¯·é€‰æ‹©å…¬ä¼—å·");return}if(B.value&&B.value.getValue){const e=B.value.getValue();if(M.type==="root")o.value[_.value].act=e;else if(M.type==="sub"){const n=o.value[_.value];n&&n.sub_menu_list&&n.sub_menu_list[d.value]&&(n.sub_menu_list[d.value].act=e)}}if(B.value&&B.value.validate&&!await B.value.validate())return;for(let e=0;e<o.value.length;e++){const n=o.value[e],s=String(n.menu_name||"ä¸»èœå•");if((n.sub_menu_list||[]).length===0&&!Le(n.act)){h.error(`è¯·å®Œå–„ä¸»èœå•ã€Œ${s}ã€åŠŸèƒ½é…ç½®`);return}for(let p=0;p<(n.sub_menu_list||[]).length;p++){const a=n.sub_menu_list[p],y=String(a.menu_name||"å­èœå•");if(!Le(a.act)){h.error(`è¯·å®Œå–„ä¸»èœå•ã€Œ${s}ã€ä¸‹çš„å­èœå•ã€Œ${y}ã€åŠŸèƒ½é…ç½®`);return}}}const t=$e();X.confirm({title:"ç¡®è®¤ä¿å­˜å¹¶åº”ç”¨å—ï¼Ÿ",okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",onOk:async()=>{L.value=!0;try{await Te({appid:m.value,menu_json:JSON.stringify(t)}),h.success("ä¿å­˜æˆåŠŸ")}finally{L.value=!1}}})}return Se(()=>o.value.length,()=>{P(z)}),Se(()=>_.value,()=>{P(z)}),(t,e)=>{const n=Fe,s=kt,p=Re,a=Ae,y=Ye,w=Oe,A=wt;return k(),R("div",Et,[i("div",zt,[r(n,{onClick:de,name:"back",style:{"font-size":"20px"}}),i("div",{onClick:de,class:"breadcrumb-title"},"è‡ªå®šä¹‰èœå•"),r(s,{checked:G.value,"checked-children":"å¼€","un-checked-children":"å…³",onChange:me},null,8,["checked"]),e[9]||(e[9]=i("span",{class:"switch-desc"},"å¼€å¯åï¼Œå…¬ä¼—å·æ˜¾ç¤ºè‡ªå®šä¹‰èœå•ï¼›å…³é—­åï¼Œç²‰ä¸å°†æ— æ³•çœ‹åˆ°èœå•ã€‚",-1))]),r(p,null,{message:c(()=>e[10]||(e[10]=[i("p",null,"1. å›å¤æ¶ˆæ¯å¯ä»¥é€‰æ‹©å›å¤å›¾æ–‡ã€å›¾ç‰‡ã€å°ç¨‹åºå¡ç‰‡ã€æ–‡æœ¬ã€æ™ºèƒ½èœå•ã€å¤šå›¾æ–‡ç­‰ï¼Œå¯ä»¥æ·»åŠ å¤šæ¡å›å¤ï¼Œè¯·å€¼é‡ä½¿ç”¨å…³é—­èœå•åŠŸèƒ½ï¼Œä¸€æ—¦å…³é—­èœå•ï¼Œå°†ä¼šåœç”¨è‡ªå®šä¹‰èœå•åŠŸèƒ½ï¼Œç²‰ä¸å°†æ— æ³•çœ‹åˆ°è‡ªå®šä¹‰èœå•ã€‚",-1),i("p",null,"2. å¤åˆ¶åˆ°å…¶ä»–å…¬ä¼—å·åï¼Œåªä¼šå¤åˆ¶é»˜è®¤èœå•ä¸”ä¸ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å¾®ä¿¡ï¼Œéœ€è¦ä¿å­˜åæ‰ä¼šåŒæ­¥åˆ°å¾®ä¿¡ï¼Œè·³è½¬å°ç¨‹åºæ—¶ï¼Œå°ç¨‹åºå¿…é¡»è·Ÿå…¬ä¼—å·æ˜¯å…³è”å…³ç³»ã€‚",-1),i("p",null,"3. å¦‚æœéœ€è¦ç«‹åˆ»æŸ¥çœ‹æ•ˆæœï¼Œè¯·å–æ¶ˆå…³æ³¨åé‡æ–°å…³æ³¨ã€‚",-1)])),_:1}),i("div",Tt,[i("div",{class:be(["mp-list",{expanded:F.value}]),ref_key:"mpListRef",ref:C},[(k(!0),R(Ve,null,Pe(F.value?x.value:x.value.slice(0,v.value),u=>(k(),R("div",{class:be(["mp-card",{selected:u.appid===m.value}]),key:u.id,onClick:f=>pe(u)},[i("img",{src:u.logo,class:"mp-logo"},null,8,Ot),i("span",Bt,re(u.name),1)],10,Dt))),128)),!F.value&&x.value.length>v.value?(k(),_e(a,{key:0,type:"dashed",class:"more-btn",onClick:e[0]||(e[0]=u=>F.value=!0)},{default:c(()=>[U(" æ›´å¤š +"+re(x.value.length-v.value),1)]),_:1})):Z("",!0)],2)]),i("div",jt,[r(T(Oe),{title:"åŒæ­¥èœå•ä¼šæ‹‰å–å…¬ä¼—å·å½“å‰æ­£åœ¨ç”Ÿæ•ˆçš„èœå•ã€‚è¯·æ³¨æ„å›å¤å†…å®¹éƒ¨åˆ†éœ€è¦é‡æ–°å¡«å……å†…å®¹ã€‚"},{default:c(()=>[r(a,{onClick:N,loading:S.value},{default:c(()=>[e[11]||(e[11]=U(" åŒæ­¥èœå• ")),r(T(St),{style:{"font-size":"16px"}})]),_:1,__:[11]},8,["loading"])]),_:1}),i("div",Ft,[r(s,{checked:H.value,"onUpdate:checked":e[1]||(e[1]=u=>H.value=u),checkedValue:"1","un-checkedValue":"0","checked-children":"å¼€","un-checked-children":"å…³",onChange:Ce},null,8,["checked"]),e[12]||(e[12]=i("span",{style:{"font-size":"14px",color:"#8c8c8c"}},"å…³é—­åï¼Œè¯¥å…¬ä¼—å·çš„èœå•åŠŸèƒ½å°†è¢«åœç”¨",-1))])]),i("div",Vt,[i("div",Pt,[i("div",{class:"iphone-mock",style:Ee({backgroundImage:`url(${T(It)})`})},[i("div",{class:"bottom-menu",ref_key:"bottomMenuRef",ref:ce},[r(T(Be),{list:o.value,"item-key":"id",class:"root-menu-draggable",animation:200,"ghost-class":"ghost",onStart:tt,onEnd:nt},{item:c(({element:u,index:f})=>[i("div",{class:be(["root-menu-item",{active:_.value===f&&d.value===-1}]),onClick:$=>Ke(f)},[i("span",Jt,re(u.menu_name||"ä¸»èœå•"),1),r(n,{class:"del-root",name:"delete-line",onClick:he($=>Qe(f),["stop"]),style:{"font-size":"18px"}},null,8,["onClick"]),_.value===f?(k(),R("div",{key:0,class:"submenu-panel",onClick:e[2]||(e[2]=he(()=>{},["stop"]))},[i("div",{class:"submenu-card",style:Ee({width:q.value+"px"})},[r(T(Be),{list:u.sub_menu_list,"item-key":"'k_'+index",class:"sub-menu-draggable",animation:200,"ghost-class":"ghost",onStart:$=>at(f),onEnd:$=>st(f)},{item:c(({element:$,index:se})=>[i("div",{class:be(["sub-menu-item",{active:_.value===f&&d.value===se}]),onClick:he(ge=>Ze(f,se),["stop"])},[i("span",Ht,re($.menu_name||"å­èœå•"),1),r(n,{class:"del",name:"delete-line",onClick:he(ge=>et(f,se),["stop"]),style:{"font-size":"18px"}},null,8,["onClick"])],10,Gt)]),_:2},1032,["list","onStart","onEnd"]),(u.sub_menu_list||[]).length<5?(k(),R("div",{key:0,class:"submenu-add",onClick:$=>Xe(f)},[r(T(Ue))],8,Yt)):Z("",!0)],4),e[13]||(e[13]=i("div",{class:"submenu-arrow"},null,-1))])):Z("",!0)],10,Wt)]),_:1},8,["list"]),o.value.length<3?(k(),R("div",{key:0,class:"root-menu-add",onClick:Ne},[r(T(Ue))])):Z("",!0)],512)],4)]),i("div",Kt,[M.type==="root"?(k(),R("div",Qt,[i("div",Xt,[e[15]||(e[15]=i("div",{class:"label"},[i("span",{class:"required"},"*"),U("ä¸»èœå•åç§°")],-1)),r(y,{ref_key:"rootNameInputRef",ref:le,value:o.value[_.value].menu_name,"onUpdate:value":e[3]||(e[3]=u=>o.value[_.value].menu_name=u),placeholder:"è¯·è¾“å…¥åç§°",onInput:Q,maxLength:"5"},null,8,["value"]),i("div",Zt,[r(A,{open:te.value,"onUpdate:open":e[4]||(e[4]=u=>te.value=u),placement:"bottomLeft",trigger:"click",getPopupContainer:oe},{content:c(()=>[r(T(De),{data:T(ie),emojiSize:18,showPreview:!1,set:"apple",onSelect:b},null,8,["data"])]),default:c(()=>[r(w,{title:"æ’å…¥è¡¨æƒ…"},{default:c(()=>e[14]||(e[14]=[U("ğŸ˜Š")])),_:1,__:[14]})]),_:1},8,["open"])]),e[16]||(e[16]=i("div",{class:"tip"},"æ”¯æŒemojiè¡¨æƒ…ï¼Œä¸»èœå•æœ€å¤šæ”¯æŒ5ä¸ªæ±‰å­—ï¼Œå­èœå•æœ€å¤š18ä¸ªæ±‰å­—",-1))]),(o.value[_.value].sub_menu_list||[]).length===0?(k(),R("div",en,[e[17]||(e[17]=i("div",{class:"label"},"èœå•åŠŸèƒ½",-1)),(k(),_e(je,{ref_key:"actEditorRef",ref:B,key:"root-"+_.value,value:o.value[_.value].act,"onUpdate:value":e[5]||(e[5]=u=>o.value[_.value].act=u)},null,8,["value"]))])):Z("",!0)])):M.type==="sub"?(k(),R("div",tn,[i("div",nn,[e[19]||(e[19]=i("div",{class:"label"},[i("span",{class:"required"},"*"),U("å­èœå•åç§°")],-1)),r(y,{ref_key:"subNameInputRef",ref:ue,value:o.value[_.value].sub_menu_list[d.value].menu_name,"onUpdate:value":e[6]||(e[6]=u=>o.value[_.value].sub_menu_list[d.value].menu_name=u),placeholder:"è¯·è¾“å…¥åç§°",onInput:I,maxLength:"18"},null,8,["value"]),i("div",an,[r(A,{open:ne.value,"onUpdate:open":e[7]||(e[7]=u=>ne.value=u),placement:"bottomLeft",trigger:"click",getPopupContainer:oe},{content:c(()=>[r(T(De),{data:T(ie),emojiSize:18,showPreview:!1,set:"apple",onSelect:l},null,8,["data"])]),default:c(()=>[r(w,{title:"æ’å…¥è¡¨æƒ…"},{default:c(()=>e[18]||(e[18]=[U("ğŸ˜Š")])),_:1,__:[18]})]),_:1},8,["open"])]),e[20]||(e[20]=i("div",{class:"tip"},"æ”¯æŒemojiè¡¨æƒ…ï¼Œä¸»èœå•æœ€å¤šæ”¯æŒ5ä¸ªæ±‰å­—ï¼Œå­èœå•æœ€å¤š18ä¸ªæ±‰å­—",-1))]),i("div",sn,[e[21]||(e[21]=i("div",{class:"label"},"èœå•åŠŸèƒ½",-1)),(k(),_e(je,{ref_key:"actEditorRef",ref:B,key:"sub-"+_.value+"-"+d.value,value:o.value[_.value].sub_menu_list[d.value].act,"onUpdate:value":e[8]||(e[8]=u=>o.value[_.value].sub_menu_list[d.value].act=u)},null,8,["value"]))])])):Z("",!0)])]),i("div",ln,[r(a,{type:"primary",onClick:ot,loading:L.value},{default:c(()=>e[22]||(e[22]=[U("ä¿å­˜å¹¶åº”ç”¨")])),_:1,__:[22]},8,["loading"])])])}}},pn=qe(_n,[["__scopeId","data-v-d28a9cf1"]]),mn={class:"auto-reply-home"},dn={key:1,class:"user-model-page"},cn={class:"empty-wrap"},vn={class:"empty-actions"},fn={__name:"index",setup(we){const D=We(),J=Je(),x=g(!0),m=async()=>{try{const v=await He({app_type:"official_account",app_name:""}),S=Array.isArray(v==null?void 0:v.data)?v.data.filter(L=>L.account_is_verify=="true"):[];x.value=S.length>0}catch{x.value=!1}},F=()=>{const v=J.resolve({path:"/user/official-account"});window.open(v.href,"_blank")},C=()=>{D.query.id&&D.query.robot_key?J.push({path:"/robot/config/function-center",query:{id:D.query.id,robot_key:D.query.robot_key}}):J.push({path:"/explore/index"})};return Ge(m),(v,S)=>{const L=Fe,O=Re,N=Ae;return k(),R("div",mn,[x.value?(k(),_e(pn,{key:0})):(k(),R("div",dn,[i("div",{class:"breadcrumb-wrap",onClick:C},[r(L,{name:"back",style:{"font-size":"20px"}}),S[0]||(S[0]=i("div",{class:"breadcrumb-title"},"è‡ªå®šä¹‰èœå•",-1))]),r(O,{"show-icon":""},{message:c(()=>S[1]||(S[1]=[U(" å¼€å¯åï¼Œç”¨æˆ·å…³æ³¨å…¬ä¼—å·åï¼Œå›å¤æŒ‡å®šçš„å†…å®¹ï¼Œ"),i("span",{style:{color:"#FF4D4F"}},"è¯¥åŠŸèƒ½ä»…æ”¯æŒå…¬ä¼—å·å†…å›å¤",-1)])),_:1}),i("div",cn,[r(xt,{size:"180"},{default:c(()=>S[2]||(S[2]=[i("div",{class:"empty-default"},"æš‚æœªç»‘å®šå…¬ä¼—å·",-1),i("div",{class:"empty-sub"},"è¯·é€‰åˆ°ç³»ç»Ÿè®¾ç½®>å…¬ä¼—å·ç®¡ç†ç»‘å®šå…¬ä¼—å·",-1)])),_:1,__:[2]}),i("div",vn,[r(N,{type:"primary",onClick:F},{default:c(()=>S[3]||(S[3]=[U("ç»‘å®š")])),_:1,__:[3]})])])]))])}}},Un=qe(fn,[["__scopeId","data-v-6aaf5ea3"]]);export{Un as default};
