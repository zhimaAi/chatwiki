import{b as V,d as Z,ac as tt}from"../../index-CuFGOJXl.js";import{aa as et,f as g,o as Y,Y as o,_ as n,a1 as T,k as _,F as R,a9 as q,a5 as t,a7 as i,G as U,ae as F,B as L,e as st,a2 as C,u as H,l as nt,ad as X,r as ht,ab as gt}from"./vue-chunks-yZ4gwLzA.js";import{E as at}from"./empty-box-BtBuqm69.js";import{c as mt,b as ot,s as K,a as lt,r as it,t as yt,u as kt,d as Q,e as $t,o as bt,f as Ct}from"./index-DhTdak07.js";import{L as ct}from"./loading-box-Bi7OKboQ.js";import{U as dt}from"./update-modal-j875WRnk.js";import{z as _t,au as ut,aa as rt,B as pt,a2 as xt,ao as ft,aw as vt,M as W,a as A,p as wt,H as Rt,X as Dt,I as Ot}from"./ui-antd-BKjlZQNA.js";import{_ as Pt}from"./tool-icon-IWVrYlVb.js";import{_ as Tt}from"./no-permission-DtJ3NYHG.js";import{F as It}from"./feishu-config-modal-Drzg7MSG.js";import{_ as Mt}from"./main-tab-Bc5qv-6k.js";import"./utils-smNh_pj2.js";import"./empty-BFmzY9bl.js";/* empty css                                                                     */import"./list-tabs-BFnVvZDT.js";const Bt={class:"_plugin-box"},St={key:1,class:"plugin-list"},zt=["onClick"],qt={class:"type-tag"},Ut={class:"base-info"},jt=["src"],Ft={class:"info"},Lt={class:"head"},Nt={class:"name zm-line1"},Et={class:"source"},At={class:"desc zm-line1"},Vt={class:"version"},Wt={class:"action-box"},Ht={class:"left"},Jt={class:"right"},Gt=["href"],Xt=["onClick"],Yt={key:1},Kt=["onClick"],Qt={__name:"remotePlugins",props:{filterData:{type:Object,default:null}},emits:["installReport"],setup(E,{expose:I,emit:M}){const k=M,p=E,y=et(),c=g(null),O=g(!0),x=g([]),$=g({});Y(()=>{b()});function f(){x.value=[],b()}async function b(){O.value=!0,await B(),mt(p.filterData).then(u=>{let l=(u==null?void 0:u.data)||[];l.forEach(e=>{var S;let{local:r,has_update:h}=((S=$.value)==null?void 0:S[e.name])||{};e.local=r,e.has_update=h}),x.value=l}).finally(()=>{O.value=!1})}async function B(){await ot().then(u=>{let l=(u==null?void 0:u.data)||[];k("installReport",l.length);let e={};l.forEach(r=>{e[r.local.name]={local:r.local,has_update:r.remote.latest_version!=r.local.version}}),$.value=e})}function m(u){y.push({path:"/plugins/detail",query:{name:u.name}})}function v(u){c.value.show(u,u.latest_version_detail,u.local||null)}return I({search:f}),(u,l)=>{const e=Z,r=_t;return n(),o("div",Bt,[O.value?(n(),T(ct,{key:0})):x.value.length?(n(),o("div",St,[(n(!0),o(R,null,q(x.value,h=>(n(),o("div",{onClick:S=>m(h),key:h.name,class:"plugin-item"},[t("div",qt,i(h.filter_type_title),1),t("div",Ut,[t("img",{class:"avatar",src:h.icon},null,8,jt),t("div",Ft,[t("div",Lt,[t("span",Nt,i(h.title),1)]),t("div",Et,i(h.author),1)])]),t("div",At,i(h.description),1),t("div",Vt,"版本：v"+i(h.latest_version),1),t("div",Wt,[t("div",Ht,[_(e,{name:"download"}),U(" "+i(h.installed_count||0),1)]),t("div",Jt,[h.help_url?(n(),o(R,{key:0},[t("a",{onClick:l[0]||(l[0]=L(()=>{},["stop"])),class:"c595959",href:h.help_url,target:"_blank"},"使用说明",8,Gt),_(r,{type:"vertical"})],64)):F("",!0),h.local?(n(),o(R,{key:1},[h.has_update?(n(),o("a",{key:0,onClick:L(S=>v(h),["stop"])},"更新",8,Xt)):(n(),o("span",Yt,"已安装"))],64)):(n(),o("a",{key:2,onClick:L(S=>v(h),["stop"])},"安装",8,Kt))])])],8,zt))),128))])):(n(),T(at,{key:2,title:"暂无可用插件"})),_(dt,{ref_key:"updateRef",ref:c,onOk:b},null,512)])}}},Zt=V(Qt,[["__scopeId","data-v-eb3d4766"]]),te={class:"head-box"},ee={class:"base-info-box"},se=["src"],ne={class:"info-box"},ae={class:"left"},oe={class:"name zm-line1"},le={class:"right"},ie={class:"link"},ce={class:"tools-box"},de={class:"info"},_e={class:"tit zm-line1"},ue={class:"btns"},re=["onClick"],pe=["onClick"],fe={class:"body-box"},ve={key:0,class:"no-auth-box"},he={key:1,class:"action-box"},ge={class:"tit"},me={class:"desc"},ye={class:"params"},ke={class:"params-box"},$e={class:"field"},be={class:"name"},Ce={class:"type"},xe={key:0,class:"required"},we={class:"desc"},Re={__name:"feishu-config-box",emits:["del","edit","auth"],setup(E,{expose:I,emit:M}){const k=g(null),p=g(!1),y=g({}),c=g({}),O=g({}),x=st(()=>Object.keys(c.value).length);function $(l){y.value=l,b(),B(),p.value=!0}function f(){p.value=!1}function b(){lt({name:y.value.name}).then(l=>{c.value=tt(l==null?void 0:l.data,{})})}function B(){it({name:y.value.name,action:"default/get-schema",params:{}}).then(l=>{let e=(l==null?void 0:l.data)||{};for(let r in e)e[r].type!="node"&&delete e[r];O.value=e})}function m(){k.value.show(c.value)}function v(l,e){for(let r in c.value)c.value[r].is_default=r==e;K({name:y.value.name,data:JSON.stringify(c.value)}).then(r=>{b()})}function u(l,e){W.confirm({title:"提示",content:"确认删除该配置？",onOk:()=>{delete c.value[e],K({name:y.value.name,data:JSON.stringify(c.value)}).then(r=>{b(),A.success("已删除")})}})}return I({show:$,hide:f}),(l,e)=>{const r=ft,h=pt,S=rt,J=vt;return n(),o("div",null,[_(J,{open:p.value,"onUpdate:open":e[1]||(e[1]=D=>p.value=D),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:C(()=>[t("div",te,[t("div",ee,[t("img",{class:"avatar",src:y.value.icon},null,8,se),t("div",ne,[t("div",ae,[t("div",oe,i(y.value.title),1),t("div",null,i(y.value.author),1)]),t("div",le,[_(H(ut),{onClick:e[0]||(e[0]=D=>p.value=!1),class:"icon"})])])]),t("div",ie,i(y.value.description),1),x.value>0?(n(),T(S,{key:0,placement:"bottom"},{content:C(()=>[t("div",ce,[(n(!0),o(R,null,q(c.value,(D,N)=>(n(),o("div",{key:N,class:"tool-item"},[e[3]||(e[3]=t("img",{class:"cover",src:Pt},null,-1)),t("div",de,[t("div",_e,i(D.name),1),t("div",ue,[D.is_default?(n(),T(r,{key:0,color:"#f50"},{default:C(()=>[...e[2]||(e[2]=[U("默认",-1)])]),_:1})):(n(),o("a",{key:1,onClick:s=>v(D,N)},"设为默认",8,re)),t("a",{onClick:s=>u(D,N)},"删除",8,pe)])])]))),128))])]),default:C(()=>[_(h,{type:"primary",icon:nt(H(xt)),class:"auth-btn",onClick:m},{default:C(()=>[U(" 已授权"+i(x.value)+"个凭证 ",1)]),_:1},8,["icon"])]),_:1})):(n(),T(h,{key:1,type:"primary",class:"auth-btn",onClick:m},{default:C(()=>[...e[4]||(e[4]=[U("立即授权",-1)])]),_:1}))]),t("div",fe,[x.value?(n(),o("div",he,[(n(!0),o(R,null,q(O.value,(D,N)=>(n(),o("div",{key:N,class:"action-item"},[t("div",ge,i(D.title),1),t("div",me,i(D.desc),1),t("div",ye,[(n(!0),o(R,null,q(Object.keys(D.params).slice(0,3),(s,a)=>(n(),T(r,{key:a,bordered:!1},{default:C(()=>[U(i(s),1)]),_:2},1024))),128)),_(S,{placement:"right"},{content:C(()=>[t("div",ke,[(n(!0),o(R,null,q(D.params,(s,a)=>(n(),o("div",{key:a,class:"param-item"},[t("div",$e,[t("span",be,i(a),1),t("span",Ce,i(s.type),1),s.required?(n(),o("span",xe,"必填")):F("",!0)]),t("div",we,i(s.desc),1)]))),128))])]),default:C(()=>[e[8]||(e[8]=t("a",null,"参数",-1))]),_:2},1024)])]))),128))])):(n(),o("div",ve,[e[5]||(e[5]=t("img",{src:Tt},null,-1)),e[6]||(e[6]=t("div",{class:"tit"},"需要授权",-1)),e[7]||(e[7]=t("div",{class:"desc"},"授权后，配置将显示在这里",-1)),t("a",{class:"link",onClick:m},"立即授权")]))])]),_:1},8,["open"]),_(It,{ref_key:"configModalRef",ref:k,onChange:b},null,512)])}}},De=V(Re,[["__scopeId","data-v-0cc05fed"]]),Oe={class:"head-box"},Pe={class:"base-info-box"},Te=["src"],Ie={class:"info-box"},Me={class:"left"},Be={class:"name zm-line1"},Se={class:"right"},ze={class:"link"},qe={class:"body-box"},Ue={class:"action-box"},je={class:"tit"},Fe={class:"desc"},Le={class:"params"},Ne={class:"params-box"},Ee={class:"field"},Ae={class:"name"},Ve={class:"type"},We={key:0,class:"required"},He={class:"desc"},Je={__name:"config-box",emits:["del","edit","auth"],setup(E,{expose:I,emit:M}){const k=g(!1),p=g({}),y=g({});function c($){p.value=$,x(),k.value=!0}function O(){k.value=!1}function x(){it({name:p.value.name,action:"default/get-schema",params:{}}).then($=>{let f=($==null?void 0:$.data)||{};for(let b in f)f[b].type!="node"&&delete f[b];y.value=f})}return I({show:c,hide:O}),($,f)=>{const b=ft,B=rt,m=vt;return n(),o("div",null,[_(m,{open:k.value,"onUpdate:open":f[1]||(f[1]=v=>k.value=v),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:C(()=>[t("div",Oe,[t("div",Pe,[t("img",{class:"avatar",src:p.value.icon},null,8,Te),t("div",Ie,[t("div",Me,[t("div",Be,i(p.value.title),1),t("div",null,i(p.value.author),1)]),t("div",Se,[_(H(ut),{onClick:f[0]||(f[0]=v=>k.value=!1),class:"icon"})])])]),t("div",ze,i(p.value.description),1)]),t("div",qe,[t("div",Ue,[(n(!0),o(R,null,q(y.value,(v,u)=>(n(),o("div",{key:u,class:"action-item"},[t("div",je,i(v.title),1),t("div",Fe,i(v.desc),1),t("div",Le,[(n(!0),o(R,null,q(Object.keys(v.params).slice(0,3),(l,e)=>(n(),T(b,{key:e,bordered:!1},{default:C(()=>[U(i(l),1)]),_:2},1024))),128)),_(B,{placement:"right"},{content:C(()=>[t("div",Ne,[(n(!0),o(R,null,q(v.params,(l,e)=>(n(),o("div",{key:e,class:"param-item"},[t("div",Ee,[t("span",Ae,i(e),1),t("span",Ve,i(l.type),1),l.required?(n(),o("span",We,"必填")):F("",!0)]),t("div",He,i(l.desc),1)]))),128))])]),default:C(()=>[f[2]||(f[2]=t("a",null,"参数",-1))]),_:2},1024)])]))),128))])])]),_:1},8,["open"])])}}},Ge=V(Je,[["__scopeId","data-v-13aca134"]]),Xe={class:"_plugin-box"},Ye={key:1,class:"plugin-list"},Ke=["onClick"],Qe={class:"type-tag"},Ze={class:"base-info"},ts=["src"],es={class:"info"},ss={class:"head"},ns={class:"name zm-line1"},as={class:"source"},os={class:"version"},ls={key:0,class:"tag"},is={class:"action-box"},cs={class:"right"},ds=["onClick"],_s=["href"],us=["onClick"],rs=["onClick"],ps={class:"text-center mt24"},fs={__name:"installPlugins",props:{filterData:{type:Object,default:null}},emits:["installReport","tabChange"],setup(E,{expose:I,emit:M}){const k=M,p=E,y=et(),c=g(null),O=g(null),x=g(null),$=g(!0),f=g([]),b=["feishu_bitable","official_account_profile","official_batch_tag","official_send_template_message","official_send_message","official_intelligent_api"];Y(()=>{l()});function B(s,a){if(!s)return null;const z=document.createElement("canvas").getContext("2d");z.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const P=z.measureText(s).width,G=(a==null?void 0:a.title_width)||120;return P>G?s:null}function m(){f.value=[],l()}const v=g([]),u=st(()=>p.filterData.filter_type==0||p.filterData.filter_type==5?[...v.value,...f.value]:f.value);function l(){yt(p.filterData).then(s=>{let a=(s==null?void 0:s.data)||[];a=a.map(w=>{var z,P;return{...w.remote,local:w.local,has_update:((z=w.remote)==null?void 0:z.latest_version)!=((P=w.local)==null?void 0:P.version),installing:!1}}),v.value=a}),$.value=!0,ot(p.filterData).then(s=>{let a=(s==null?void 0:s.data)||[];k("installReport",a.length),a=a.map(w=>{var z,P;return{...w.remote,local:w.local,has_update:((z=w.remote)==null?void 0:z.latest_version)!=((P=w.local)==null?void 0:P.version),installing:!1}}),f.value=a}).finally(()=>{$.value=!1})}async function e(s){const a=()=>s.local.has_loaded=!s.local.has_loaded;if(!s.local.has_loaded)W.confirm({title:"确认关闭该插件？",content:"关闭后，其他应用的位置都不可使用！确认关闭？",okText:"确定",cancelText:"取消",onOk:()=>{s.local.type=="trigger"?Q({id:s.trigger_config_id,switch_status:0}).then(()=>{A.success("已关闭")}).catch(a):$t({name:s.name}).then(()=>{A.success("已关闭")}).catch(a)},onCancel(){a()}});else{if(s.local.type=="trigger"){Q({id:s.trigger_config_id,switch_status:1}).then(()=>{A.success("已开启")});return}if(s.name=="feishu_bitable"){let{data:w}=await lt({name:s.name});if(w=tt(w,{}),!Object.keys(w).length)return a(),W.confirm({title:"授权飞书应用接口权限",content:nt("div",{style:{color:" red"}},"请先完成信息配置，获取接口权限"),okText:"确定",cancelText:"取消",onOk:()=>{r(s)}})}bt({name:s.name}).then(()=>{A.success("已开启")}).catch(a)}}function r(s){O.value.show(s)}function h(s){W.confirm({title:"确认删除该插件？",content:"删除后，其他应用的位置都不可使用！确认删除？",okText:"确定",cancelText:"取消",onOk:()=>{kt({name:s.name}).then(()=>{A.success("已删除"),l()})}})}function S(s){s.local.type!="trigger"&&y.push({path:"/plugins/detail",query:{name:s.name}})}function J(s){s.name==="feishu_bitable"?r(s):x.value.show(s)}function D(s){c.value.show(s,s.latest_version_detail,s.local)}function N(s,a){s&&a&&(a.title_width=s.offsetWidth)}return I({search:m}),(s,a)=>{const w=wt,z=Rt,P=_t,G=pt;return n(),o("div",Xe,[$.value?(n(),T(ct,{key:0})):u.value.length?(n(),o("div",Ye,[(n(!0),o(R,null,q(u.value,d=>(n(),o("div",{onClick:j=>S(d),key:d.name,class:X(["plugin-item",{"trigger-plugin-item":d.local.type=="trigger"}])},[t("div",Qe,i(d.filter_type_title),1),t("div",Ze,[t("img",{class:"avatar",src:d.icon},null,8,ts),t("div",es,[t("div",ss,[t("span",ns,i(d.title),1)]),t("div",as,i(d.author),1)])]),_(w,{title:B(d.description,d),placement:"top"},{default:C(()=>[t("div",{class:"desc zm-line1",ref_for:!0,ref:j=>N(j,d)},i(d.description),513)]),_:2},1032,["title"]),t("div",os,[U("版本：v"+i(d.local.version)+" ",1),d.has_update?(n(),o("span",ls,"有更新")):F("",!0)]),t("div",is,[t("div",{class:"left",onClick:a[0]||(a[0]=L(()=>{},["stop"]))},[_(z,{checked:d.local.has_loaded,"onUpdate:checked":j=>d.local.has_loaded=j,onChange:j=>e(d)},null,8,["checked","onUpdate:checked","onChange"])]),t("div",cs,[d.local.type!="trigger"?(n(),o("span",{key:0,class:"zm-link-pointer",onClick:L(j=>h(d),["stop"])},"删除",8,ds)):F("",!0),d.help_url?(n(),o(R,{key:1},[_(P,{type:"vertical"}),t("a",{onClick:a[1]||(a[1]=L(()=>{},["stop"])),class:"c595959",href:d.help_url,target:"_blank"},"使用说明",8,_s)],64)):F("",!0),b.includes(d.name)?(n(),o(R,{key:2},[_(P,{type:"vertical"}),t("a",{onClick:L(j=>J(d),["stop"])},"配置",8,us)],64)):F("",!0),d.has_update?(n(),o(R,{key:3},[_(P,{type:"vertical"}),t("a",{onClick:L(j=>D(d),["stop"])},"更新",8,rs)],64)):F("",!0)])])],10,Ke))),128))])):(n(),T(at,{key:2,title:"暂未安装插件"},{desc:C(()=>[t("div",null,[a[4]||(a[4]=U("更多功能可到 ",-1)),t("a",{onClick:a[2]||(a[2]=d=>k("tabChange",3))},"探索>插件广场"),a[5]||(a[5]=U(" 中去添加",-1))]),t("div",ps,[_(G,{class:"btn",type:"primary",onClick:a[3]||(a[3]=d=>k("tabChange",3))},{default:C(()=>[...a[6]||(a[6]=[U("去添加",-1)])]),_:1})])]),_:1})),_(dt,{ref_key:"updateRef",ref:c,onOk:l},null,512),_(De,{ref_key:"feishuRef",ref:O},null,512),_(Ge,{ref_key:"configRef",ref:x},null,512)])}}},vs=V(fs,[["__scopeId","data-v-99d9f188"]]),hs={class:"_container"},gs={class:"header"},ms={class:"main-tab-box"},ys={class:"content"},ks={class:"filter-box"},$s={class:"radio-tabs"},bs=["onClick"],Cs=["src"],xs={__name:"index",setup(E){const I=gt(),M=g(null),k=g(null),p=g(localStorage.getItem("zm:explore:active")||"2"),y=g([]),c=ht({title:"",filter_type:0});Y(()=>{I.query.active>1&&M.value.change(I.query.active),O()});function O(){Ct().then(m=>{y.value=(m==null?void 0:m.data)||[]})}function x(){k.value.search()}function $(m){c.filter_type=m,x()}function f(m){m>1&&(p.value=m)}function b(m){M.value.change(m)}function B(){M.value.update()}return(m,v)=>{const u=Z,l=Ot;return n(),o("div",hs,[t("div",gs,[t("div",ms,[_(Mt,{ref_key:"tabRef",ref:M,onChange:f},null,512)])]),t("div",ys,[t("div",ks,[t("div",$s,[t("div",{onClick:v[0]||(v[0]=e=>$(0)),class:X(["radio-tab",{active:c.filter_type==0}])},[_(u,{name:"icon-all"}),v[2]||(v[2]=t("span",null,"全部",-1))],2),(n(!0),o(R,null,q(y.value,e=>(n(),o("div",{onClick:r=>$(e.id),key:e.id,class:X(["radio-tab",{active:e.id==c.filter_type}])},[t("img",{class:"icon",src:e.id==c.filter_type?e.icon_active_path:e.icon_path},null,8,Cs),t("span",null,i(e.type_title),1)],10,bs))),128))]),_(l,{value:c.title,"onUpdate:value":v[1]||(v[1]=e=>c.title=e),valueModifiers:{trim:!0},onChange:x,style:{width:"360px"},allowClear:"",placeholder:"搜索插件"},{suffix:C(()=>[_(H(Dt))]),_:1},8,["value"])]),p.value==3?(n(),T(Zt,{key:0,onInstallReport:B,filterData:c,ref_key:"pluginRef",ref:k},null,8,["filterData"])):(n(),T(vs,{key:1,onTabChange:b,onInstallReport:B,filterData:c,ref_key:"pluginRef",ref:k},null,8,["filterData"]))])])}}},Ls=V(xs,[["__scopeId","data-v-b0f3d353"]]);export{Ls as default};
