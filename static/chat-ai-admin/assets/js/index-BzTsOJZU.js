import{aa as q,f as h,o as I,Y as c,_ as a,a1 as m,k as f,F as R,a9 as N,a5 as s,a7 as p,G as C,B as x,ae as M,a2 as D,ab as F}from"./vue-chunks-Ci-XTWEs.js";import{b as T,d as S}from"../../index-OnalErht.js";import{E as O}from"./empty-box-1VHyC8l6.js";import{b as G,a as U,u as X,c as Y,o as j}from"./index-ekVIF3nC.js";import{L as V}from"./loading-box-DcpHkn5J.js";import{U as L}from"./update-modal-Cf1DDPo7.js";import{X as A,x as H,B as J,M as E,a as B}from"./ui-antd-BgeWxFcI.js";import{_ as K}from"./main-tab-BICC7-0v.js";import"./utils-ChQO-_r6.js";import"./empty-BFmzY9bl.js";import"./list-tabs-xpus4ekB.js";const Q={class:"_plugin-box"},W={key:1,class:"plugin-list"},Z=["onClick"],tt={class:"base-info"},st=["src"],et={class:"info"},nt={class:"head"},at={class:"name zm-line1"},ot={class:"source"},lt={class:"desc zm-line2"},ct={class:"version"},it={class:"action-box"},_t={class:"left"},dt={class:"right"},ut=["onClick"],rt={key:1},pt=["onClick"],ht={__name:"remotePlugins",emits:["installReport"],setup(z,{emit:g}){const d=g,k=q(),v=h(null),u=h(!0),_=h([]),i=h({});I(()=>{y()});async function y(){u.value=!0,await P(),G().then(t=>{let e=(t==null?void 0:t.data)||[];e.forEach(l=>{var o;let{local:n,has_update:r}=((o=i.value)==null?void 0:o[l.name])||{};l.local=n,l.has_update=r}),_.value=e}).finally(()=>{u.value=!1})}async function P(){await U().then(t=>{let e=(t==null?void 0:t.data)||[];d("installReport",e.length);let l={};e.forEach(n=>{l[n.local.name]={local:n.local,has_update:n.remote.latest_version!=n.local.version}}),i.value=l})}function w(t){k.push({path:"/plugins/detail",query:{name:t.name}})}function b(t){v.value.show(t,t.latest_version_detail,t.local||null)}return(t,e)=>{const l=S;return a(),c("div",Q,[u.value?(a(),m(V,{key:0})):_.value.length?(a(),c("div",W,[(a(!0),c(R,null,N(_.value,n=>(a(),c("div",{onClick:r=>w(n),key:n.name,class:"plugin-item"},[s("div",tt,[s("img",{class:"avatar",src:n.icon},null,8,st),s("div",et,[s("div",nt,[s("span",at,p(n.title),1)]),s("div",ot,p(n.author),1)])]),s("div",lt,p(n.description),1),s("div",ct,"版本：v"+p(n.latest_version),1),s("div",it,[s("div",_t,[f(l,{name:"download"}),C(" "+p(n.installed_count||0),1)]),s("div",dt,[n.local?(a(),c(R,{key:0},[n.has_update?(a(),c("a",{key:0,onClick:x(r=>b(n),["stop"])},"更新",8,ut)):(a(),c("span",rt,"已安装"))],64)):(a(),c("a",{key:1,onClick:x(r=>b(n),["stop"])},"安装",8,pt))])])],8,Z))),128))])):(a(),m(O,{key:2,title:"暂无可用插件"})),f(L,{ref_key:"updateRef",ref:v,onOk:y},null,512)])}}},vt=T(ht,[["__scopeId","data-v-869cf0a3"]]),ft={class:"_plugin-box"},gt={key:1,class:"plugin-list"},kt=["onClick"],mt={class:"base-info"},yt=["src"],$t={class:"info"},Ct={class:"head"},xt={class:"name zm-line1"},bt={class:"source"},Rt={class:"desc zm-line2"},Pt={class:"version"},wt={key:0,class:"tag"},Bt={class:"action-box"},It={class:"right"},Tt=["onClick"],zt=["onClick"],Mt={class:"text-center mt24"},Dt={__name:"installPlugins",emits:["installReport","tabChange"],setup(z,{emit:g}){const d=g,k=q(),v=h(null),u=h(!0),_=h([]);I(()=>{i()});function i(){u.value=!0,U().then(t=>{let e=(t==null?void 0:t.data)||[];d("installReport",e.length),e=e.map(l=>{var n,r;return{...l.remote,local:l.local,has_update:((n=l.remote)==null?void 0:n.latest_version)!=((r=l.local)==null?void 0:r.version),installing:!1}}),_.value=e}).finally(()=>{u.value=!1})}function y(t){const e=()=>t.local.has_loaded=!t.local.has_loaded;t.local.has_loaded?j({name:t.name}).then(()=>{B.success("已开启")}).catch(()=>e()):E.confirm({title:"确认关闭该插件？",content:"关闭后，其他应用的位置都不可使用！确认关闭？",okText:"确定",cancelText:"取消",onOk:()=>{Y({name:t.name}).then(()=>{B.success("已关闭")}).catch(()=>e())},onCancel:()=>{e()}})}function P(t){E.confirm({title:"确认删除该插件？",content:"删除后，其他应用的位置都不可使用！确认删除？",okText:"确定",cancelText:"取消",onOk:()=>{X({name:t.name}).then(()=>{B.success("已删除"),i()})}})}function w(t){k.push({path:"/plugins/detail",query:{name:t.name}})}function b(t){v.value.show(t,t.latest_version_detail,t.local)}return(t,e)=>{const l=A,n=H,r=J;return a(),c("div",ft,[u.value?(a(),m(V,{key:0})):_.value.length?(a(),c("div",gt,[(a(!0),c(R,null,N(_.value,o=>(a(),c("div",{onClick:$=>w(o),key:o.name,class:"plugin-item"},[s("div",mt,[s("img",{class:"avatar",src:o.icon},null,8,yt),s("div",$t,[s("div",Ct,[s("span",xt,p(o.title),1)]),s("div",bt,p(o.author),1)])]),s("div",Rt,p(o.description),1),s("div",Pt,[C("版本：v"+p(o.local.version)+" ",1),o.has_update?(a(),c("span",wt,"有更新")):M("",!0)]),s("div",Bt,[s("div",{class:"left",onClick:e[0]||(e[0]=x(()=>{},["stop"]))},[f(l,{checked:o.local.has_loaded,"onUpdate:checked":$=>o.local.has_loaded=$,onChange:$=>y(o)},null,8,["checked","onUpdate:checked","onChange"])]),s("div",It,[s("span",{class:"zm-link-pointer",onClick:x($=>P(o),["stop"])},"删除",8,Tt),o.has_update?(a(),c(R,{key:0},[f(n,{type:"vertical"}),s("a",{onClick:x($=>b(o),["stop"])},"更新",8,zt)],64)):M("",!0)])])],8,kt))),128))])):(a(),m(O,{key:2,title:"暂未安装插件"},{desc:D(()=>[e[3]||(e[3]=s("div",null,[C("更多功能可到 "),s("a",null,"探索>插件广场"),C(" 中去添加")],-1)),s("div",Mt,[f(r,{class:"btn",type:"primary",onClick:e[1]||(e[1]=o=>d("tabChange",3))},{default:D(()=>e[2]||(e[2]=[C("去添加")])),_:1,__:[2]})])]),_:1})),f(L,{ref_key:"updateRef",ref:v,onOk:i},null,512)])}}},Et=T(Dt,[["__scopeId","data-v-1c8a1069"]]),qt={class:"_container"},Nt={class:"header"},Ot={class:"main-tab-box"},Ut={class:"content"},Vt={__name:"index",setup(z){const g=F(),d=h(null),k=h(localStorage.getItem("zm:explore:active")||"2");I(()=>{g.query.active>1&&d.value.change(g.query.active)});function v(i){i>1&&(k.value=i)}function u(i){d.value.change(i)}function _(){d.value.update()}return(i,y)=>(a(),c("div",qt,[s("div",Nt,[s("div",Ot,[f(K,{ref_key:"tabRef",ref:d,onChange:v},null,512)])]),s("div",Ut,[k.value==3?(a(),m(vt,{key:0,onInstallReport:_})):(a(),m(Et,{key:1,onTabChange:u,onInstallReport:_}))])]))}},Qt=T(Vt,[["__scopeId","data-v-5846bcd3"]]);export{Qt as default};
