import{c as oe,r as F,w as re,a as d,b as c,y as n,p as m,t as s,u as t,v as i,F as j,l as Y,h as pe,E as se,e as E,q as $,_ as g,i as me,V as fe,z as he,j as ke,J as ve,ag as ge}from"./vue-chunks-BdaA73Wf.js";import{u as G,cf as ye,bD as ae,cg as xe,ch as be,d as we,f as Ce,bl as Fe,ci as qe,cj as ze,ck as $e,cl as De}from"../../index-DSFcP5NQ.js";import{P as Oe}from"./page-tabs-D0DH-kej.js";import{_ as Se}from"./page-alert-DLppgA58.js";import{_ as X}from"./emoji-mart-BBMRoEa3.js";import{ar as Ie,as as Me,b as M,F as Te,c as Ue,r as Ae,s as Le,G as Ne,u as Re,v as Qe,V as Ee,M as W,a$ as je,B as Pe,w as Ve,a0 as Be,b5 as le,ad as Je,aO as He,J as Ke,au as Ye,f as We,g as Ge,i as Xe,x as Ze,O as et}from"./ui-antd-Dl1wwwCD.js";import{M as tt}from"./model-select-CMPvMrAQ.js";import{I as at}from"./import-knowledge-modal-B_fiIwwA.js";import{d as ne}from"./utils-CvB22N-W.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";import"./index-MT9fcN3v.js";import"./validate-8MtiUsxW.js";const lt={class:"ant-upload-drag-icon"},nt={class:"ant-upload-text"},ot={class:"ant-upload-hint"},st={__name:"upload-input",props:{value:{type:Array,default:()=>[]},maxCount:{type:Number,default:1},type:{type:[String,Number],default:0}},emits:["change","update:value"],setup(R,{emit:a}){const{t:q}=G("views.ai-extract-faq.list.components.upload-input"),_=a,v=R;let O=["docx","txt","md"];const T=oe(()=>O.map(h=>`.${h}`).join(",")),e=F([]);re(()=>v.value,h=>{e.value=h},{immediate:!0});let z=null;const f=()=>{if(e.value.length>=v.maxCount)return M.error(q("max_upload_error",{count:v.maxCount}))},C=()=>{e.value.length>v.maxCount&&M.error(q("max_upload_error",{count:v.maxCount}));let h=[...e.value];_("change",h),_("update:value",h)},y=h=>{I(h),C()},I=h=>{for(let S=0;S<e.value.length;S++)if(e.value[S].uid===h.uid){e.value.splice(S,1);break}},D=h=>{const S=h.name.split(".").pop();return O.includes(S.toLowerCase())?h.size/1024/1024<100?(e.value=[...e.value||[],h],e.value.length>v.maxCount&&(e.value=e.value.splice(0,v.maxCount)),z&&clearTimeout(z),z=setTimeout(()=>{C(),clearTimeout(z)},50),!1):(M.error(q("file_size_limit")),!1):(M.error(q("unsupported_file_format")),!1)};return(h,S)=>{const k=Me;return c(),d("div",{class:pe(["upload-input",{disabled:e.value.length>=v.maxCount}])},[n(k,{"file-list":e.value,name:"file",multiple:!0,"max-count":v.maxCount,accept:T.value,beforeUpload:D,onRemove:y,class:"ant-upload-drag"},{default:s(()=>[m("div",lt,[n(t(Ie))]),m("div",nt,i(t(q)("click_or_drag_upload")),1),m("div",ot,[m("p",null,i(t(q)("batch_upload_hint",{count:v.maxCount})),1),m("p",null,[m("span",null,i(t(q)("supported_file_types")),1),(c(!0),d(j,null,Y(t(O),U=>(c(),d("span",{class:"ant-upload-hint-ext",key:U},"."+i(U),1))),128))])])]),_:1},8,["file-list","max-count","accept"]),m("div",{class:"disabled-mask",onClick:f})],2)}}},it=X(st,[["__scopeId","data-v-c9a5d3df"]]),ut={key:0,class:"mt8"},ct={key:1,class:"mt8"},_t={__name:"upload-document",props:{separatorsOptions:{type:Array,default:()=>[]}},emits:["ok"],setup(R,{expose:a,emit:q}){const{t:_}=G("views.ai-extract-faq.list.components.upload-document"),v=q,O=_("default_prompt"),T=R,e=se({faq_files:[],chunk_model:"",chunk_model_config_id:"",chunk_type:1,chunk_size:8e3,chunk_prompt:O,separators_no:[12,11]}),z=F({chunk_model_config_id:[{message:_("confirm_validate_msg_model"),required:!0}],faq_files:[{message:_("confirm_validate_msg_file"),required:!0}]}),f=F(!1),C=()=>{f.value=!0,ye().then(x=>{let u=x.data||{chunk_model:"",chunk_model_config_id:"",chunk_size:8e3,chunk_prompt:O,separators_no:[12,11]};e.faq_files=[],e.chunk_model=u.chunk_model,e.chunk_model_config_id=u.chunk_model_config_id,e.chunk_type=1,e.chunk_size=u.chunk_size||8e3,e.chunk_prompt=u.chunk_prompt||O,e.separators_no=ae(u.separators_no,[12,11]),setTimeout(()=>{!e.chunk_model_config_id&&k.value.length>0&&k.value[0].children&&k.value[0].children.length&&(e.chunk_model_config_id=k.value[0].model_config_id,e.chunk_model=k.value[0].children[0].name)},500)})},y=F(!1),I=F(null),D=()=>{I.value.validate().then(()=>{h()}).catch(()=>{y.value=!1})},h=()=>{let x=new FormData;e.faq_files.forEach(u=>{x.append("faq_files",u)}),x.append("chunk_type",e.chunk_type),x.append("chunk_size",e.chunk_size),x.append("chunk_model",e.chunk_model),x.append("chunk_model_config_id",e.chunk_model_config_id),x.append("chunk_prompt",e.chunk_prompt),x.append("separators_no",JSON.stringify(e.separators_no)),y.value=!0,xe(x).then(u=>{M.success(_("upload_success_msg")),v("ok"),f.value=!1}).finally(()=>{y.value=!1})},S=x=>{e.faq_files=x,I.value.validate(["faq_files"])},k=F([]),U=x=>{k.value=x,me(()=>{})};return a({show:C}),(x,u)=>{const A=Ue,P=Le,Z=Ae,Q=Ne,V=Qe,ee=Re,B=Ee,te=Te,J=W;return c(),d("div",null,[n(J,{open:f.value,"onUpdate:open":u[8]||(u[8]=r=>f.value=r),"confirm-loading":y.value,title:t(_)("modal_title"),width:"746px",onOk:D},{default:s(()=>[n(te,{class:"url-add-form",layout:"vertical",ref_key:"formRef",ref:I,model:e,rules:z.value},{default:s(()=>[n(A,{name:"faq_files",label:null},{default:s(()=>[n(it,{maxCount:10,value:e.faq_files,"onUpdate:value":u[0]||(u[0]=r=>e.faq_files=r),onChange:S},null,8,["value"])]),_:1}),n(A,{name:"chunk_model_config_id",label:t(_)("chunk_model_label")},{default:s(()=>[n(tt,{modelType:"LLM",placeholder:t(_)("chunk_model_placeholder"),modeName:e.chunk_model,"onUpdate:modeName":u[1]||(u[1]=r=>e.chunk_model=r),modeId:e.chunk_model_config_id,"onUpdate:modeId":u[2]||(u[2]=r=>e.chunk_model_config_id=r),style:{width:"100%"},onLoaded:U},null,8,["placeholder","modeName","modeId"])]),_:1},8,["label"]),n(A,{label:t(_)("chunk_type_label")},{default:s(()=>[n(Z,{value:e.chunk_type,"onUpdate:value":u[3]||(u[3]=r=>e.chunk_type=r)},{default:s(()=>[n(P,{value:1},{default:s(()=>[g(i(t(_)("chunk_type_by_length")),1)]),_:1}),n(P,{value:2},{default:s(()=>[g(i(t(_)("chunk_type_by_separator")),1)]),_:1})]),_:1},8,["value"]),e.chunk_type==1?(c(),d("div",ut,[n(Q,{value:e.chunk_size,"onUpdate:value":u[4]||(u[4]=r=>e.chunk_size=r),min:1,max:1e4,step:1,placeholder:t(_)("chunk_size_placeholder"),style:{width:"300px"}},null,8,["value","placeholder"])])):$("",!0),e.chunk_type==2?(c(),d("div",ct,[n(ee,{placeholder:t(_)("separator_placeholder"),style:{width:"300px"},mode:"tags",value:e.separators_no,"onUpdate:value":u[5]||(u[5]=r=>e.separators_no=r)},{default:s(()=>[(c(!0),d(j,null,Y(T.separatorsOptions,r=>(c(),E(V,{value:r.no,key:r.no},{default:s(()=>[g(i(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value"])])):$("",!0)]),_:1},8,["label"]),e.chunk_type==2?(c(),E(A,{key:0,label:t(_)("max_length_label")},{default:s(()=>[n(Q,{value:e.chunk_size,"onUpdate:value":u[6]||(u[6]=r=>e.chunk_size=r),min:1,max:1e4,step:1,placeholder:t(_)("chunk_size_placeholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),_:1},8,["label"])):$("",!0),n(A,{label:t(_)("faq_prompt_label")},{default:s(()=>[n(B,{value:e.chunk_prompt,"onUpdate:value":u[7]||(u[7]=r=>e.chunk_prompt=r),style:{height:"150px"},placeholder:t(_)("faq_prompt_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading","title"])])}}},dt=X(_t,[["__scopeId","data-v-361178aa"]]),rt={class:"list-box"},pt={class:"error-tip"},mt={class:"content-block"},ft={class:"fragment-img"},ht=["src"],kt={__name:"fail-detail",setup(R,{expose:a}){const{t:q}=G("views.ai-extract-faq.list.components.fail-detail"),_=F(!1),v=F([]),O=e=>{_.value=!0,v.value=[],T(e.id)},T=e=>{be({id:e}).then(z=>{let f=z.data||[];v.value=f.map(C=>({...C,images:C.images?JSON.parse(C.images):[]}))})};return a({show:O}),(e,z)=>{const f=W,C=fe("viewer");return c(),d("div",null,[n(f,{wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"650px","overflow-y":"auto"},open:_.value,"onUpdate:open":z[0]||(z[0]=y=>_.value=y),title:t(q)("modal_title"),width:746,footer:null},{default:s(()=>[m("div",rt,[(c(!0),d(j,null,Y(v.value,y=>(c(),d("div",{class:"list-item",key:y.id},[m("div",pt,i(y.split_errmsg),1),m("div",mt,i(y.content),1),he((c(),d("div",ft,[(c(!0),d(j,null,Y(y.images,(I,D)=>(c(),d("img",{key:D,src:I,alt:""},null,8,ht))),128))])),[[C]])]))),128))])]),_:1},8,["open","title"])])}}},vt=X(kt,[["__scopeId","data-v-4b0c26d6"]]),gt={class:"library-page"},yt={class:"library-page-body"},xt={key:0,class:"btn-block"},bt={class:"list-box"},wt=["onClick"],Ct={key:0,class:"status-block status-bule"},Ft={key:1,class:"status-block status-bule"},qt={key:2,class:"status-block status-bule"},zt={key:3,class:"status-block status-green"},$t={key:4,class:"status-block status-red"},Dt={key:0},Ot={key:1},St=["onClick"],It={key:1},Mt={key:2},Tt=["onClick"],Ut={__name:"index",setup(R){const{t:a}=G("views.ai-extract-faq.list.index"),q=we(),_=ge(),v=Ce();let{role_permission:O,role_type:T}=v;const e=oe(()=>T==1||O.includes("UploadDocFaq")),z=F([{title:a("tab_library"),path:"/library/list"},{title:a("tab_database"),path:"/database/list"},{title:a("tab_extract_faq"),path:"/ai-extract-faq/list"},{title:a("tab_trigger_stats"),path:"/trigger-statics/list"}]),f=se({page:1,size:20,total:0}),C=F([]),y=F(!1);function I(l){return Array.isArray(l)?l.map(b=>{let p=H.value.find(w=>w.no===b);return p?p.name:b}):[]}const D=()=>{y.value=!1,qe({...f}).then(l=>{let b=l.data.list||[];H.value,b=b.map(p=>{let w=ne(p.create_time*1e3).format("YY-MM-DD HH:mm"),L=ae(p.separators_no);return{...p,create_time_desc:w,separators_no_desc:I(L).join("、")}}),f.total=+l.data.total,C.value=b,U()}).finally(()=>{y.value=!1})},h=()=>{f.page=1,D()},S=l=>{f.page=l.current,f.size=l.pageSize,D()};let k={};const U=()=>{C.value.forEach(l=>{l.status==2&&x(l.id)})};function x(l){k[l]&&clearInterval(k[l]),k[l]=setInterval(async()=>{try{const p=(await $e({id:l})).data;p.create_time_desc=ne(p.create_time*1e3).format("YY-MM-DD HH:mm");let w=ae(p.separators_no);p.separators_no_desc=I(w).join("、");const L=C.value.findIndex(K=>K.id==l);L!==-1&&C.value.splice(L,1,p),p.status!=2&&u(l)}catch{u(l)}},5e3)}function u(l){k[l]&&(clearInterval(k[l]),delete k[l])}const A=l=>{W.confirm({title:a("delete_confirm_title"),icon:n(et),content:a("delete_confirm_content",{file_name:l.file_name}),okText:a("confirm"),cancelText:a("cancel"),okType:"danger",onOk(){P(l)},onCancel(){}})},P=({id:l})=>{ze({id:l}).then(()=>{M.success(a("delete_success")),D()})},Z=l=>{W.confirm({title:a("resync_confirm_title"),icon:null,okText:a("confirm"),cancelText:a("cancel"),onOk(){De({id:l.id}).then(b=>{M.success(a("resync_success")),D()})},onCancel(){}})},Q=l=>{if(l.status==2||l.status==3){_.push({path:"/ai-extract-faq/details",query:{id:l.id,file_name:l.file_name}});return}let b=a("cannot_view_detail");l.status==0&&(b=a("status_queuing_tip")),l.status==1&&(b=a("status_parsing_tip")),l.status==4&&(b=a("status_failed_tip")),M.error(b)},V=F(null),ee=()=>{V.value.show()},B=F(null),te=l=>{B.value.show({...l})},J=(l,b)=>{let p=q.getToken,w=`/manage/exportFAQFileAllQA?id=${b}&token=${p}&ext=${l}`;window.location.href=w},r=F(null),ie=l=>{r.value.show({...l})},H=F([]),ue=async()=>{Fe().then(l=>{H.value=l.data||[]})};return ke(async()=>{await ue(),D()}),ve(()=>{Object.keys(k).forEach(l=>{clearInterval(k[l])}),k={}}),(l,b)=>{const p=Pe,w=Ve,L=Ke,K=Ge,ce=We,_e=Xe,de=Ze;return c(),d(j,null,[m("div",gt,[n(Oe,{class:"mb-16",tabs:z.value,active:"/ai-extract-faq/list"},null,8,["tabs"]),n(Se,{style:{"margin-bottom":"16px"},title:t(a)("usage_title")},{default:s(()=>[m("div",null,[m("p",null,i(t(a)("usage_desc_1")),1),m("p",null,i(t(a)("usage_desc_2")),1)])]),_:1},8,["title"]),m("div",yt,[e.value?(c(),d("div",xt,[n(p,{onClick:ee,type:"primary",icon:n(t(je))},{default:s(()=>[g(i(t(a)("upload_btn")),1)]),_:1},8,["icon"])])):$("",!0),m("div",bt,[n(de,{"data-source":C.value,loading:y.value,pagination:{current:f.page,total:f.total,pageSize:f.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:S,scroll:{x:800}},{default:s(()=>[n(w,{key:"file_name","data-index":"file_name",title:t(a)("original_doc"),width:200},{default:s(({record:o})=>[m("a",{onClick:N=>Q(o)},i(o.file_name),9,wt)]),_:1},8,["title"]),n(w,{key:"status",title:t(a)("status"),width:140},{default:s(({record:o})=>[o.status==0?(c(),d("div",Ct,[n(t(Be)),g(i(t(a)("status_queuing")),1)])):$("",!0),o.status==1?(c(),d("div",Ft,[n(t(le)),g(i(t(a)("status_parsing")),1)])):$("",!0),o.status==2?(c(),d("div",qt,[n(t(le)),g(i(t(a)("status_extracting")),1)])):$("",!0),o.status==3?(c(),d("div",zt,[n(t(Je)),g(i(t(a)("status_completed")),1)])):$("",!0),o.status==4?(c(),d("div",$t,[n(t(He)),g(i(t(a)("status_failed")),1)])):$("",!0)]),_:1},8,["title"]),n(w,{key:"chunk_size",title:t(a)("chunk_method"),width:200},{default:s(({record:o})=>[o.chunk_type==1?(c(),d("div",Dt,i(t(a)("by_length"))+i(o.chunk_size),1)):$("",!0),o.chunk_type==2?(c(),d("div",Ot,[m("div",null,i(t(a)("by_separator"))+i(o.separators_no_desc),1),m("div",null,i(t(a)("max_length"))+i(o.chunk_size),1)])):$("",!0)]),_:1},8,["title"]),n(w,{key:"count",title:t(a)("total_chunks"),width:110},{default:s(({record:o})=>[g(i(+o.success_count+ +o.fail_count),1)]),_:1},8,["title"]),n(w,{key:"success_count",title:t(a)("success_chunks"),width:140},{default:s(({record:o})=>[g(i(o.success_count),1)]),_:1},8,["title"]),n(w,{key:"fail_count",title:t(a)("failed_chunks"),width:140},{default:s(({record:o})=>[n(L,{gap:12},{default:s(()=>[o.fail_count>0?(c(),d("a",{key:0,onClick:N=>ie(o)},i(o.fail_count),9,St)):(c(),d("span",It,i(o.fail_count),1)),o.status==3||o.status==4?(c(),d("a",Mt,[o.fail_count>0?(c(),E(t(Ye),{key:0,onClick:N=>Z(o)},null,8,["onClick"])):$("",!0)])):$("",!0)]),_:2},1024)]),_:1},8,["title"]),n(w,{key:"qa_count",title:t(a)("qa_count"),width:140},{default:s(({record:o})=>[m("a",{onClick:N=>Q(o)},i(o.qa_count),9,Tt)]),_:1},8,["title"]),n(w,{key:"create_time_desc",title:t(a)("upload_time"),width:150},{default:s(({record:o})=>[g(i(o.create_time_desc),1)]),_:1},8,["title"]),n(w,{key:"key7",title:t(a)("action"),width:190,fixed:"right"},{default:s(({record:o})=>[n(L,{gap:16,wrap:"wrap"},{default:s(()=>[o.status==3?(c(),E(_e,{key:0},{overlay:s(()=>[n(ce,null,{default:s(()=>[n(K,{onClick:N=>J("docx",o.id),key:"1"},{default:s(()=>[g(i(t(a)("download_as_docx")),1)]),_:1},8,["onClick"]),n(K,{onClick:N=>J("xlsx",o.id),key:"2"},{default:s(()=>[g(i(t(a)("download_as_xlsx")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[n(p,{size:"small",type:"link",style:{padding:"0"}},{default:s(()=>[g(i(t(a)("download")),1)]),_:1})]),_:2},1024)):(c(),E(p,{key:1,disabled:"",size:"small",type:"link",style:{padding:"0"}},{default:s(()=>[g(i(t(a)("download")),1)]),_:1})),n(p,{onClick:N=>te(o),disabled:o.status!=3,size:"small",type:"link",style:{padding:"0"}},{default:s(()=>[g(i(t(a)("import_kb")),1)]),_:1},8,["onClick","disabled"]),n(p,{onClick:N=>A(o),size:"small",type:"link",style:{padding:"0"}},{default:s(()=>[g(i(t(a)("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data-source","loading","pagination"])])])]),n(dt,{separatorsOptions:H.value,ref_key:"uploadDocumentRef",ref:V,onOk:h},null,8,["separatorsOptions"]),n(at,{ref_key:"importKnowledgeModalRef",ref:B,onOk:D},null,512),n(vt,{ref_key:"failDetailRef",ref:r},null,512)],64)}}},Xt=X(Ut,[["__scopeId","data-v-f0129898"]]);export{Xt as default};
//# sourceMappingURL=index-CiInOR-M.js.map
