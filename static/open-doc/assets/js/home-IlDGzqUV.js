import{__esm as v}from"./rolldown-runtime-DcCx2Prq.js";import{init_vue_draggable_plus as We,init_vue_router as Xe,init_vue_runtime_esm_bundler as N,lo as Ye,useRoute as et,useRouter as tt}from"./vue-chunks-DkJ44Igi.js";import{Fragment as B,PlusCircleOutlined_default as ot,UploadOutlined_default as nt,__plugin_vue_export_helper_default as K,computed as S,createBaseVNode as n,createBlock as Le,createCommentVNode as M,createElementBlock as d,createTextVNode as H,createVNode as m,getIconTemplateById as it,init___plugin_vue_export_helper as R,init_es as st,init_es$1 as at,init_icon_template as lt,init_open_doc as dt,message_default as E,nextTick as rt,normalizeClass as T,normalizeStyle as ct,onMounted as ut,onUnmounted as _t,openBlock as l,reactive as pt,ref as C,renderList as j,renderSlot as P,resolveComponent as vt,toDisplayString as p,unref as D,useOpenDocStore as ht,vModelText as gt,withCtx as y,withDirectives as kt,withKeys as mt}from"./index-cwQF3kTw.js";var Ve,yt=v({"src/assets/img/home_add.svg"(){Ve="data:image/svg+xml,%3csvg%20width='25'%20height='24'%20viewBox='0%200%2025%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='0.5'%20width='24'%20height='24'%20rx='12'%20fill='%232475FC'/%3e%3cpath%20d='M12.5%207V17'%20stroke='white'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.5%2012H17.5'%20stroke='white'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e"}}),Be,ft=v({"src/assets/img/edit.svg"(){Be="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.875%2018.125H18.125M3.68056%2011.2278V14.5139H6.98337L16.3194%205.17375L13.0221%201.875L3.68056%2011.2278Z'%20stroke='%23262626'%20stroke-width='1.625'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e"}}),He,wt=v({"src/assets/img/delete.svg"(){He="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.90625%204.3125V18.125H16.0938V4.3125H3.90625Z'%20stroke='%23262626'%20stroke-width='1.625'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M8.375%208.375V13.6562'%20stroke='black'%20stroke-width='1.625'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M11.625%208.375V13.6562'%20stroke='black'%20stroke-width='1.625'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.875%204.3125H18.125'%20stroke='black'%20stroke-width='1.625'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M6.75%204.3125L8.08616%201.875H11.9407L13.25%204.3125H6.75Z'%20stroke='black'%20stroke-width='1.625'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e"}}),bt=v({"src/views/open/home/components/action-popover.vue?vue&type=style&index=0&scoped=7900ade6&lang.less"(){}}),Q,Z,$,xt=v({"src/views/open/home/components/action-popover.vue"(){N(),ft(),wt(),bt(),R(),Q={class:"float-action-box"},Z={__name:"action-popover",props:{disabled:{type:Boolean,default:!1},name:{type:String,default:""},menus:{type:Array,default:()=>["edit"]}},emits:["click"],setup(h,{emit:w}){const g=h,k=w,b=c=>{k("click",g.name,c)};return(c,s)=>{const q=vt("a-popover");return g.disabled?P(c.$slots,"default",{key:1},void 0,!0):(l(),Le(q,{key:0,placement:"top","overlay-class-name":"custom-popover"},{content:y(()=>[n("div",Q,[h.menus.includes("edit")?(l(),d("div",{key:0,class:"action-btn","data-type":"edit",onClick:s[0]||(s[0]=a=>b("edit"))},s[2]||(s[2]=[n("img",{class:"action-icon",title:"编辑",src:Be,alt:""},null,-1)]))):M("",!0),h.menus.includes("delete")?(l(),d("div",{key:1,class:"action-btn","data-type":"delete",onClick:s[1]||(s[1]=a=>b("delete"))},s[3]||(s[3]=[n("img",{class:"action-icon",title:"删除",src:He,alt:""},null,-1)]))):M("",!0)])]),title:y(()=>s[4]||(s[4]=[n("span",null,null,-1)])),default:y(()=>[P(c.$slots,"default",{},void 0,!0)]),_:3}))}}},$=K(Z,[["__scopeId","data-v-7900ade6"]])}}),Ct=v({"src/components/icons/arrow-icon.vue?vue&type=style&index=0&scoped=ba5b81d0&lang.less"(){}});function Mt(h,w,g,k,b,c){return l(),d("span",{class:T(["arrow-icon",c.rotationClass])},[(l(),d("svg",{width:g.size,height:g.size,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M12 6L8 10L4 6",stroke:g.color,"stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,8,De)],8,je))],2)}var F,je,De,z,$t=v({"src/components/icons/arrow-icon.vue"(){N(),Ct(),R(),F={props:{direction:{type:String,default:"bottom",validator:h=>["top","right","bottom","left"].includes(h)},color:{type:String,default:"currentColor"},size:{type:[String,Number],default:16}},computed:{rotationClass(){return{top:"rotate-up",left:"rotate-left",right:"rotate-right",bottom:""}[this.direction]}}},je=["width","height"],De=["stroke"],z=K(F,[["render",Mt],["__scopeId","data-v-ba5b81d0"]])}}),St=v({"src/views/open/home/index.vue?vue&type=style&index=0&scoped=337e7d58&lang.less"(){}}),J,G,W,X,Y,ee,te,oe,ne,ie,se,ae,le,de,re,ce,ue,_e,pe,ve,he,ge,ke,me,ye,fe,we,be,xe,Ce,Me,$e,Se,Ee,qe,Ie,Et,qt=v({"src/views/open/home/index.vue"(){N(),yt(),Xe(),dt(),st(),at(),We(),xt(),$t(),lt(),St(),R(),J={class:"open-home-page"},G={class:"page-top"},W={key:0,class:"upload-banner-btn"},X={class:"library-title"},Y={class:"library-desc",id:"library-desc"},ee={class:"search-box-wrapper"},te={class:"search-box",id:"search-box"},oe={class:"keyword-list-wrapper"},ne={class:"keyword-list",id:"keyword-list"},ie=["onClick"],se={class:"question-guide-item"},ae={class:"keyword-text"},le={class:"home-page-body"},de={class:"shortcut-item-header"},re={class:"shortcut-title"},ce={class:"shortcut-icon"},ue={class:"shortcut-name"},_e={class:"shortcut-action"},pe=["onClick"],ve={class:"shortcut-item-body"},he={class:"post-list"},ge=["onClick"],ke={class:"post-icon"},me={class:"post-title"},ye={key:1,class:"shortcut-item sortable-drag"},fe={class:"shortcut-item-header"},we={class:"shortcut-title"},be={class:"shortcut-icon"},xe={class:"shortcut-name"},Ce={class:"shortcut-action"},Me=["onClick"],$e={class:"shortcut-item-body"},Se={class:"post-content"},Ee=["innerHTML"],qe={class:"add-tip"},Ie={__name:"index",setup(h){const w=tt(),g=et(),k=ht(),b=C(null),c=C(null),s=C(!1),q=t=>{s.value=t.type},a=pt({keyword:"",title:"",content:"",question_guide:[]}),A=C(""),x=C([]),O=C([]),Te=S(()=>!s.value),f=S(()=>g.params.id),ze=S(()=>k.previewKey),I=S(()=>k.catalogMap),Ne=()=>{a.keyword="",c.value.focus()},L=()=>{if(k.isEditPage){E.warning("编辑模式不支持搜索功能");return}if(ze.value){E.warning("预览模式不支持搜索功能");return}c.value.blur(),w.push({name:"open-search",params:{id:f.value},query:{v:a.keyword}}),a.keyword=""},V=t=>{if(!(t.is_dir==1&&t.children.length==0)){if(k.isEditPage)return E.warning("编辑模式不支持查看功能");if(t.is_dir==1){if(!t.children.length)return;let e=t.children.filter(o=>o.is_dir==0);if(!e.length)return;w.push({path:`/doc/${e[0].doc_key}`,params:{id:f.value}})}else w.push({path:`/doc/${t.doc_key}`,params:{id:f.value}})}},Ke=(t,e)=>{let o=it(e);if(t.doc_icon)return t.doc_icon;if(I.value[t.id])return I.value[t.id].doc_icon;{let r=o.levels[t.level];return t.is_dir==1?r.folder_icon:r.doc_icon}},Re=async()=>{let t=await k.getHome(f.value),e=t.quick_doc_content_value||[],o=t.quick_doc_content||[];e.forEach((i,u)=>{i.key=o[u].key||i.id}),a.title=t.title,a.content=t.content,a.question_guide=t.question_guide,A.value=t.banner_img_url;const r=(i,u)=>{i.level=I.value[i.id]?.level||0,i.doc_icon=Ke(i,u)};e.forEach(i=>{i.children=i.children.filter(u=>u.is_dir!=1),r(i,t.icon_template_config_id),i.children?.length&&i.children.forEach(u=>{r(u,t.icon_template_config_id)})}),x.value=e,O.value=o},Ae=t=>{const e=t.target.files[0];if(!e)return;const o=2*1024*1024;if(e.size>o){E.error("文件大小不能超过2MB"),t.target.value="";return}let r={key:"banner",action:"change",data:{doc_id:f.value,file:e}};_(r)},Oe=t=>{a.keyword=t.question,L()},Ue=()=>{let t={key:"title",action:"edit",data:{doc_id:f.value,title:a.title,content:a.content}};_(t)},Pe=()=>{let t={key:"content",action:"edit",data:{doc_id:f.value,title:a.title,content:a.content}};_(t)},Qe=(t,e)=>{let o={key:"question",action:t,data:{id:e.id,question:e.question}};_(o)},Ze=()=>{_({key:"question",action:"add",data:{id:"",question:""}})},Fe=()=>{_({key:"shortcut",action:"add",data:{}})},Je=(t,e)=>{let o=O.value[e],r={key:"shortcut",action:t,data:JSON.parse(JSON.stringify(o))};_(r)},Ge=()=>{let e={key:"shortcut",action:"dragEnd",data:{list:x.value.map(o=>({doc_id:o.id*1,key:o.key}))}};_(e)},_=t=>{window.parent&&window.parent.postMessage(t,"*")};function U(t){if(!t.data)return;let{action:e,data:o}=t.data;e==="setEditStatus"&&q(o)}return ut(async()=>{rt(async()=>{window.addEventListener("message",U),await Re(),_({action:"init",key:"init"})})}),_t(()=>{window.removeEventListener("message",U)}),(t,e)=>(l(),d("div",J,[n("div",G,[n("div",{class:"home-page-banner",style:ct({backgroundImage:`url(${A.value})`})},[s.value?(l(),d("div",W,[n("div",{class:"upload-btn",onClick:e[0]||(e[0]=o=>b.value.click())},[m(D(nt),{class:"btn-icon"}),e[8]||(e[8]=n("span",{class:"btn-text"},"修改主图",-1)),n("input",{type:"file",class:"upload-input",ref_key:"uploadBannerInputRef",ref:b,accept:"image/png,image/jpeg",onChange:Ae},null,544)])])):M("",!0),m($,{disabled:!s.value,name:"title",menus:["edit"],onClick:e[1]||(e[1]=()=>Ue())},{default:y(()=>[n("h1",X,p(a.title),1)]),_:1},8,["disabled"]),m($,{disabled:!s.value,name:"content",menus:["edit"],onClick:e[2]||(e[2]=()=>Pe())},{default:y(()=>[n("div",Y,p(!a.content&&s.value?"请输入描述":a.content),1)]),_:1},8,["disabled"]),n("div",ee,[n("div",te,[kt(n("input",{class:"search-input",id:"search-input",ref_key:"searchInputRef",ref:c,name:"search",autocomplete:"off",placeholder:"",type:"text","onUpdate:modelValue":e[3]||(e[3]=o=>a.keyword=o),onKeydown:e[4]||(e[4]=mt(o=>L(),["enter"]))},null,544),[[gt,a.keyword]]),a.keyword?(l(),d("span",{key:0,class:"search-clear",onClick:Ne})):M("",!0),n("span",{class:"search-btn",onClick:e[5]||(e[5]=o=>L())},e[9]||(e[9]=[n("span",{class:"search-icon"},null,-1)]))])])],4),n("div",oe,[n("ul",ne,[(l(!0),d(B,null,j(a.question_guide,o=>(l(),d("li",{class:"keyword-item",key:o.id,onClick:r=>Oe(o)},[m($,{name:"question",disabled:!s.value,menus:["edit","delete"],onClick:(r,i)=>Qe(i,o)},{default:y(()=>[n("div",se,[n("span",ae,p(o.question),1)])]),_:2},1032,["disabled","onClick"])],8,ie))),128)),s.value&&a.question_guide.length<10?(l(),d("li",{key:0,class:"keyword-item add-btn-item",onClick:e[6]||(e[6]=o=>Ze())},e[10]||(e[10]=[n("img",{src:Ve,class:"add-btn"},null,-1)]))):M("",!0)])])]),n("div",le,[n("div",null,[m(D(Ye),{class:"shortcut-list",ref:"el",disabled:Te.value,draggable:".sortable-drag",filter:".add-item",modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=o=>x.value=o),onEnd:Ge},{default:y(()=>[(l(!0),d(B,null,j(x.value,(o,r)=>(l(),Le($,{key:o.key,disabled:!s.value,name:"title",menus:["edit","delete"],onClick:(i,u)=>Je(u,r)},{default:y(()=>[o.is_dir==1?(l(),d("div",{key:0,class:T(["shortcut-item sortable-drag",{"is-empty":o.children==0}])},[n("div",de,[n("div",re,[n("span",ce,p(o.doc_icon),1),n("span",ue,p(o.title),1)]),n("div",_e,[n("a",{class:T(["shortcut-link",{"is-empty-link":o.children==0}]),onClick:i=>V(o)},[e[11]||(e[11]=H("详情 ")),m(z,{direction:"right",color:o.children==0?"#ccc":"currentColor"},null,8,["color"])],10,pe)])]),n("div",ve,[n("div",he,[(l(!0),d(B,null,j(o.children,i=>(l(),d("div",{key:i.id,class:"post-item",onClick:u=>V(i)},[n("span",ke,p(i.doc_icon),1),n("span",me,p(i.title),1)],8,ge))),128))])])],2)):(l(),d("div",ye,[n("div",fe,[n("div",we,[n("span",be,p(o.doc_icon),1),n("span",xe,p(o.title),1)]),n("div",Ce,[n("a",{class:"shortcut-link",onClick:i=>V(o)},[e[12]||(e[12]=H("详情 ")),m(z,{direction:"right"})],8,Me)])]),n("div",$e,[n("div",Se,[n("div",{innerHTML:o.content},null,8,Ee)])])]))]),_:2},1032,["disabled","onClick"]))),128)),s.value&&x.value.length<30?(l(),d("div",{key:0,class:"shortcut-item add-item",onClick:Fe},[n("span",qe,[m(D(ot)),e[13]||(e[13]=H(" 添加文档快捷方式 "))])])):M("",!0)]),_:1},8,["disabled","modelValue"])])])]))}},Et=K(Ie,[["__scopeId","data-v-337e7d58"]])}});qt();export{Et as default};
