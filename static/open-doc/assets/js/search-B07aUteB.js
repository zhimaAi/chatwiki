import{__esm as p}from"./rolldown-runtime-DcCx2Prq.js";import{init_vue_router as Y,init_vue_runtime_esm_bundler as ee,useRoute as te,useRouter as se}from"./vue-chunks-DkJ44Igi.js";import{Fragment as m,__plugin_vue_export_helper_default as oe,computed as x,createBaseVNode as t,createBlock as le,createCommentVNode as _,createElementBlock as i,createVNode as ae,getAiMessage as ie,getSearchResult as re,init___plugin_vue_export_helper as ne,init_open_doc as de,init_open_doc$1 as ce,init_open_sidebar as ue,normalizeClass as _e,onMounted as pe,openBlock as a,open_sidebar_default as he,reactive as ve,ref as we,renderList as y,resolveComponent as ke,toDisplayString as R,useOpenDocStore as ge,vModelText as me,vShow as xe,watch as f,withCtx as b,withDirectives as A,withKeys as ye}from"./index-cwQF3kTw.js";var U,Re=p({"src/assets/img/arrow.svg"(){U="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%206L8%2010L4%206'%20stroke='%238C8C8C'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e"}}),Z,fe=p({"src/assets/img/doc_icon2.svg"(){Z="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3%203C3%202.44772%203.44772%202%204%202H10C11.6569%202%2013%203.34315%2013%205V13C13%2013.5523%2012.5523%2014%2012%2014H6C4.34315%2014%203%2012.6569%203%2011V3Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.66602%208H10.3327'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.66602%205H11.3327'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.66602%2011H7.99935'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e"}}),be=p({"src/views/open/search/index.vue?vue&type=style&index=0&scoped=80ba6c46&lang.less"(){}}),C,H,M,D,E,L,S,T,q,B,V,$,j,I,N,K,O,z,F,J,Ae,Ce=p({"src/views/open/search/index.vue"(){ee(),ue(),Re(),fe(),Y(),de(),ce(),be(),ne(),C={class:"open-search-page"},H={class:"search-page-header-wrapper"},M={class:"search-page-header"},D={class:"search-box",id:"search-box"},E={class:"search-page-body"},L={key:0,class:"search-result-wrapper"},S={key:0,class:"ai-result-box"},T={class:"ai-result-text",id:"ai-result-text"},q=["innerHTML"],B={class:"ai-result-doc-label"},V={class:"label-text"},$={class:"ai-result-doc-items",id:"ai-result-docs"},j={class:"doc-title-box"},I={class:"doc-title"},N={class:"search-result-items",id:"search-result-list"},K={class:"search-result-item-wrap"},O={class:"doc-title-box"},z=["innerHTML"],F=["innerHTML"],J={__name:"index",setup(He){const G=se(),d=te(),P=ge(),c=x(()=>d.query.v),u=x(()=>d.params.id),v=we(null),e=ve({keyword:"",showAiResult:!1,aiResult:{text:"",documents:[]},searchResult:[],isAiResultDocsExpanded:!0}),Q=()=>{e.keyword="",v.value.focus()},w=()=>{if(!e.keyword)return;e.showAiResult=!1,e.aiResult.text="",e.aiResult.documents=[],e.searchResult=[];let l=d.query||{};G.replace({query:{...l,v:e.keyword}}),e.keyword==c.value&&(k(),g())},W=async()=>{let l=d.query.v;await P.getSearch(u.value,l)};let n=null;const k=()=>{n&&(n.abort(),n=null),n=ie({v:e.keyword,id:u.value}),n.onMessage=l=>{l.event=="sending"?(e.showAiResult||(e.showAiResult=!0),e.aiResult.text+=l.data):l.event=="quote_file"&&(e.aiResult.documents=JSON.parse(l.data))}},g=()=>{re({v:e.keyword,id:u.value}).then(l=>{let s=l.data||[];s.forEach(r=>{e.keyword.length&&(r.titleHtml=r.title.replace(new RegExp(e.keyword,"gi"),o=>`<span class="keyword-text">${o}</span>`),r.contentHtml=r.content.replace(new RegExp(e.keyword,"gi"),o=>`<span class="keyword-text">${o}</span>`))}),e.searchResult=s})},X=()=>{e.isAiResultDocsExpanded=!e.isAiResultDocsExpanded},h=()=>{e.keyword=c.value,e.showAiResult=!1,e.aiResult.text="",e.aiResult.documents=[],e.searchResult=[],e.isAiResultDocsExpanded=!0,c.value&&(k(),g())};return pe(async()=>{await W(),h()}),f(u,()=>{h()}),f(c,()=>{h()}),(l,s)=>{const r=ke("router-link");return a(),i("div",C,[t("div",H,[t("div",M,[t("div",D,[A(t("input",{class:"search-input",ref_key:"searchInputRef",ref:v,name:"search",autocomplete:"off",placeholder:"请输入内容搜索",type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>e.keyword=o),onKeydown:ye(w,["enter"])},null,544),[[me,e.keyword]]),e.keyword?(a(),i("span",{key:0,class:"search-clear",onClick:Q})):_("",!0),t("span",{class:"search-btn",onClick:w},s[2]||(s[2]=[t("span",{class:"search-icon"},null,-1)]))]),s[3]||(s[3]=t("div",{class:"action-box"},[t("span",{class:"action-btn"},[t("img",{class:"action-btn-icon",src:he,alt:""})])],-1))])]),t("div",E,[e.searchResult.length>0||e.aiResult.text?(a(),i("div",L,[s[8]||(s[8]=t("h3",{class:"search-result-label"},"为您找到以下结果:",-1)),e.showAiResult?(a(),i("div",S,[s[6]||(s[6]=t("h4",{class:"ai-result-label"},"以下结果由AI生成",-1)),t("div",T,[t("div",{innerHTML:e.aiResult.text},null,8,q)]),e.aiResult.documents.length>0?(a(),i("div",{key:0,class:_e(["ai-result-doc-box",{expanded:e.isAiResultDocsExpanded}])},[t("h4",B,[t("img",{class:"arrow-icon",src:U,alt:"展开收起相关文档",onClick:s[1]||(s[1]=o=>X())}),t("span",V,"相关文档 ("+R(e.aiResult.documents.length)+")",1),s[4]||(s[4]=t("span",{class:"line"},null,-1))]),A(t("ul",$,[(a(!0),i(m,null,y(e.aiResult.documents,o=>(a(),i("li",{class:"ai-result-doc-item-wrap",key:o.doc_key},[ae(r,{class:"ai-result-doc-item",target:"_blank",to:"/doc/"+o.doc_key},{default:b(()=>[t("div",j,[s[5]||(s[5]=t("img",{class:"doc-icon",src:Z,alt:""},null,-1)),t("h3",I,R(o.file_name),1)])]),_:2},1032,["to"])]))),128))],512),[[xe,e.isAiResultDocsExpanded]])],2)):_("",!0)])):_("",!0),t("ul",N,[t("li",K,[(a(!0),i(m,null,y(e.searchResult,o=>(a(),le(r,{class:"search-result-item",target:"_blank",to:`/doc/${o.doc_key}`,key:o.file_id},{default:b(()=>[t("div",O,[s[7]||(s[7]=t("i",{class:"doc-icon"},null,-1)),t("h3",{class:"doc-title",innerHTML:o.titleHtml},null,8,z)]),t("p",{class:"doc-content",innerHTML:o.contentHtml},null,8,F)]),_:2},1032,["to"]))),128))])])])):_("",!0)])])}}},Ae=oe(J,[["__scopeId","data-v-80ba6c46"]])}});Ce();export{Ae as default};
